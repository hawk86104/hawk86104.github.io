import{m as n,e as t,U as e}from"./@tresjs.C4A766dl1736129093919.js";import{_ as r,V as o,by as a}from"./three.ES53pcRR1736129093919.js";import{P as i}from"./tweakpane.BCjFYDHx1736129093919.js";import{d as c,b as l,r as u,w as s,q as p,o as v,D as m,J as f,u as _,e as d,x as g,j as x,g as h,aj as y,ak as b,f as S,al as w,m as z,F as j}from"./@vue.uQKhJ3x71736129093919.js";import{_ as D}from"./@fesjs.C11Gf8kF1736129093919.js";import"./@vueuse.CaPKQ7tQ1736129093919.js";import"./vue-router.Pr1g0CvG1736129093919.js";import"./lodash-es.Dw4PEFNU1736129093919.js";import"./@qlin.BIlp8Yi21736129093919.js";import"./pinia.CtRHBYHM1736129093919.js";import"./vue-demi.Dq6ymT-81736129093919.js";import"./@babel.BBWsvBIa1736129093919.js";import"./@floating-ui.B75jtkXD1736129093919.js";import"./@juggle.BnTvdTVm1736129093919.js";function I(n,t){const e=V();return(I=function(n,t){return e[n-=343]})(n,t)}const k=I;function V(){const n=["u_isoValue","expanded","format","console","TresSphereGeometry","15828lClqXU","gger","then","minFilter",'{}.constructor("return this")( )',"466518iOGVMG","action","log","while (true) {}","call","table","value","apply","RepeatWrapping","wrapT","addBinding","fragmentShader","LinearFilter","Error fetching volume data:","error","input","12749sMQiyk","TresShaderMaterial","u_alphaVal","debu","Clock","6JqjMVc","toString","u_color","magFilter","rotation-x","prototype","test","start","1ADPOoy","Cross Section Settings","getElapsedTime","bind","u_volume","5366259eKbhlk","TresMesh","basicVolumeRendering","string","uniforms","u_time","stateObject","Data3DTexture","9025810PoOMKP","arrayBuffer","length","8BVBnHW","color","4UOoMDG","exception","alphaVal","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","return (function() ","meshRef","constructor","trace","chain","counter","catch","3198601TYGSRR","init","innerWidth","__proto__","isoValue","1094666bEfKQr","addFolder","3382635EFGJgD","Display Settings"];return(V=function(){return n})()}!function(n,t){const e=I,r=V();for(;;)try{if(460520===parseInt(e(361))/1*(-parseInt(e(395))/2)+-parseInt(e(409))/3*(parseInt(e(379))/4)+parseInt(e(397))/5*(parseInt(e(353))/6)+parseInt(e(390))/7+-parseInt(e(377))/8*(parseInt(e(366))/9)+-parseInt(e(374))/10+-parseInt(e(348))/11*(-parseInt(e(404))/12))break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const M=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e.apply(t,arguments);return e=null,n}}:function(){};return n=!1,r}}();!function(){M(this,(function(){const n=I,t=new RegExp("function *\\( *\\)"),e=new RegExp(n(382),"i"),r=C(n(391));t[n(359)](r+n(387))&&e[n(359)](r+n(347))?C():r("0")}))()}();const O=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[I(416)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();O(void 0,(function(){const n=I;let t;try{t=Function(n(383)+n(408)+");")()}catch(o){t=window}const e=t[n(402)]=t[n(402)]||{},r=[n(411),"warn","info",n(346),n(380),n(414),n(386)];for(let a=0;a<r[n(376)];a++){const t=O.constructor[n(358)][n(364)](O),o=r[a],i=e[o]||t;t[n(393)]=O.bind(O),t[n(354)]=i[n(354)][n(364)](i),e[o]=t}}))();const P=[k(357)],R=[k(370),"vertexShader",k(343)],T=41,F=c({__name:k(368),setup(e){var c;const d=k,g=window[d(392)],x=window.innerHeight,h=l(null),y=l(null),b=new(r[d(352)]);b[d(360)]();const S=(new i).addFolder({title:d(398)}),w=S[d(396)]({title:d(362)}),z=new o(.5,.5,.5);w[d(419)](z,"x",{label:"X",min:.02,max:.5,step:.02}),w[d(419)](z,"y",{label:"Y",min:.02,max:.5,step:.02}),w[d(419)](z,"z",{label:"Z",min:.02,max:.5,step:.02}),w[d(400)]=!0;const{camera:j}=n(),D=u({u_camera:{value:null==(c=j[d(415)])?void 0:c.position},u_resolution:{value:new o(g,x,1)},u_dt:{value:.004},u_time:{value:0},u_crossSectionSize:{value:z},u_color:{value:1},u_volume:{value:null},u_isoValue:{value:.2},u_alphaVal:{value:.2}}),I=S[d(396)]({title:"Algorithm Settings"});I[d(419)](D.u_dt,d(415),{label:"dt",min:4e-4,max:.016,step:2e-4}),I[d(419)](D[d(355)],"value",{label:d(378),min:1,max:3,step:1}),I[d(419)](D[d(350)],d(415),{label:d(381),min:.01,max:1,step:.01}),I[d(419)](D[d(399)],"value",{label:d(394),min:0,max:1,step:.04}),s(y,(n=>{const t=d;if(n){const e=new(r[t(373)])(n,T,T,T);e[t(401)]=a,e[t(407)]=r[t(344)],e[t(356)]=r[t(344)],e[t(418)]=r[t(417)],e.needsUpdate=!0,D[t(365)][t(415)]=e}}));const{onLoop:V}=t();return V((()=>{const n=d;D[n(371)][n(415)]=b[n(363)]()})),p((()=>{(()=>{const n=d;fetch("/plugins/volumeRendering/image/nucleon_41x41x41_uint8.raw")[n(406)]((t=>t[n(375)]()))[n(406)]((t=>{const e=n,r=new Uint8Array(t),o=new Uint8Array(68921);for(let n=0;n<r[e(376)];n++)o[n]=r[n];y.value=o}))[n(389)]((t=>{const e=n;console.error(e(345),t)}))})()})),(n,t)=>{const e=d;return v(),m(e(367),{ref_key:e(384),ref:h,"rotation-x":Math.PI/-2},[t[0]||(t[0]=f(e(403),{args:[1,16,16]},null,-1)),f(e(349),{uniforms:D,vertexShader:_("precision mediump float;\n\nuniform vec3 u_camera;\nuniform vec3 u_resolution;\nuniform float u_time;\n\nvarying vec3 v_hitPos;\nvarying vec3 v_hitPosWorldSpace;\nvarying vec3 v_cameraObjectSpace;\n\nvoid main() {\n  vec3 pos = position;\n\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\n\n  v_hitPos = position.xyz;\n\n  v_hitPosWorldSpace = (modelMatrix * vec4(position, 1.0)).xyz;\n\n  v_cameraObjectSpace = (inverse(modelMatrix) * vec4(u_camera, 1.0)).xyz;\n}"),fragmentShader:_("precision mediump int;\nprecision mediump float;\n\nuniform vec3 u_camera;\nuniform vec3 u_resolution;\nuniform mediump sampler3D u_volume;\nuniform vec3 u_crossSectionSize;\nuniform float u_dt;\nuniform float u_time;\nuniform float u_color;\nuniform float u_isoValue;\nuniform float u_alphaVal;\n\nvec3 palette(in float t) {\n  vec3 a = vec3(0.5, 0.5, 0.5);\n  vec3 b = vec3(0.5, 0.5, 0.5);\n  vec3 c = vec3(1.0, 1.0, 1.0);\n  vec3 d = vec3(0.00, 0.33, 0.67);\n\n  return a + b * cos(6.28318 * (c * t + d));\n}\n\nvarying vec3 v_hitPos;\nvarying vec3 v_hitPosWorldSpace;\nvarying vec3 v_cameraObjectSpace;\n\nvec2 intersect_box(vec3 orig, vec3 dir) {\n\n  vec3 box_min = vec3(-u_crossSectionSize);\n  vec3 box_max = vec3(u_crossSectionSize);\n  vec3 inv_dir = 1.0 / dir;\n  vec3 tmin_tmp = (box_min - orig) * inv_dir;\n  vec3 tmax_tmp = (box_max - orig) * inv_dir;\n  vec3 tmin = min(tmin_tmp, tmax_tmp);\n  vec3 tmax = max(tmin_tmp, tmax_tmp);\n  float t0 = max(tmin.x, max(tmin.y, tmin.z));\n  float t1 = min(tmax.x, min(tmax.y, tmax.z));\n  return vec2(t0, t1);\n}\n\nvoid main() {\n  vec3 rayOrigin = vec3(0.0, 0.0, -3.0);\n  rayOrigin = v_cameraObjectSpace;\n\n  vec2 uv = 2.0 * gl_FragCoord.xy / u_resolution.xy - 1.0;\n  vec3 rayDir = normalize(vec3(uv, 1.0));\n  rayDir = normalize(v_hitPos - rayOrigin);\n\n  vec2 t_hit = intersect_box(rayOrigin, rayDir);\n  if (t_hit.x > t_hit.y) {\n    discard;\n  }\n\n  t_hit.x = max(t_hit.x, 0.0);\n\n  float dt = u_dt;\n\n  vec4 color = vec4(0.0);\n\n  vec3 p = rayOrigin + t_hit.x * rayDir + 0.5;\n  for (float t = t_hit.x; t < t_hit.y; t += dt) {\n\n    float textureVal = texture(u_volume, p).r;\n\n    vec4 val_color = vec4(0.0);\n    float val_color_alpha = textureVal * 0.1;\n\n    val_color_alpha = smoothstep(0.0, u_alphaVal, val_color_alpha);\n\n    vec3 red = vec3(1.0, 0.0, 0.0);\n    vec3 white = vec3(1.0);\n    if (abs(u_color - 1.0) <= 0.01) {\n      val_color = vec4(white, val_color_alpha);\n    } else if (abs(u_color - 2.0) <= 0.01) {\n      val_color = vec4(mix(red, white, val_color_alpha), val_color_alpha);\n    } else {\n      val_color = vec4(palette(textureVal), val_color_alpha);\n    }\n\n    color.rgb += (1.0 - color.a) * val_color.a * val_color.rgb;\n    color.a += (1.0 - color.a) * val_color.a;\n\n    if (textureVal > u_isoValue) {\n      float gxLess = texture(u_volume, vec3(p.x - rayDir.x * u_dt, p.y, p.z)).r;\n      float gxMore = texture(u_volume, vec3(p.x + rayDir.x * u_dt, p.y, p.z)).r;\n      float dgx = gxMore - gxLess;\n\n      float gyLess = texture(u_volume, vec3(p.x, p.y - rayDir.y * u_dt, p.z)).r;\n      float gyMore = texture(u_volume, vec3(p.x, p.y + rayDir.y * u_dt, p.z)).r;\n      float dgy = gyMore - gyLess;\n\n      float gzLess = texture(u_volume, vec3(p.x, p.y, p.z - rayDir.z * u_dt)).r;\n      float gzMore = texture(u_volume, vec3(p.x, p.y, p.z + rayDir.z * u_dt)).r;\n      float dgz = gzMore - gzLess;\n      vec3 n = normalize(vec3(dgx, dgy, dgz));\n\n      vec3 lightSource = vec3(1.0);\n      vec3 lightDir = normalize(lightSource);\n      float diffuseStrength = max(dot(n, lightDir), 0.0);\n\n      vec3 viewSource = normalize(rayOrigin);\n      vec3 reflectSource = normalize(reflect(-lightSource, n));\n      float specularStrength = max(0.0, dot(viewSource, reflectSource));\n      specularStrength = pow(specularStrength, 64.0);\n\n      color.rgb = diffuseStrength * val_color.rgb + specularStrength * val_color.rgb;\n      color.rgb *= val_color.rgb;\n      color.a = 0.95;\n      break;\n    }\n\n    if (color.a >= 0.95) {\n      break;\n    }\n\n    p += rayDir * dt;\n  }\n\n  gl_FragColor = color;\n}")},null,8,R)],8,P)}}});function C(n){function t(n){const e=I;if(typeof n===e(369))return function(n){}[e(385)](e(412))[e(416)](e(388));1!==(""+n/n)[e(376)]||n%20==0?function(){return!0}[e(385)](e(351)+e(405))[e(413)](e(410)):function(){return!1}[e(385)](e(351)+e(405))[e(416)](e(372)),t(++n)}try{if(n)return t;t(0)}catch(e){}}function L(){const n=["input","return (function() ","call","bind","3466393zqoCHB","1086IzKMMg","_blank","1803124dVXKhT","function *\\( *\\)","1829080EOZjdp","8ZlNnvX","#201919","length","exception","TresCanvas","https://klacansky.com/open-scivis-datasets/skull/skull_256x256x256_uint8.raw","trace","div","chain","while (true) {}","counter","constructor","basicVolume","gger","action","prototype","apply","45sEHGzi","4eebzFd","1200585DBSphy","9029581kCDqVn","stateObject","21155KqXLQd","table","console","debu","toString","TresPerspectiveCamera"," https://klacansky.com/open-scivis-datasets/skull/skull_256x256x256_uint8.raw ","error","360620VfDLsT","log","test"];return(L=function(){return n})()}const E=Z;!function(n,t){const e=Z,r=L();for(;;)try{if(576856===-parseInt(e(462))/1+parseInt(e(472))/2+parseInt(e(451))/3*(parseInt(e(450))/4)+-parseInt(e(454))/5*(parseInt(e(470))/6)+parseInt(e(469))/7*(parseInt(e(475))/8)+-parseInt(e(449))/9*(parseInt(e(474))/10)+parseInt(e(452))/11)break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const A=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[Z(448)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();!function(){A(this,(function(){const n=Z,t=new RegExp(n(473)),e=new RegExp("\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","i"),r=q("init");t.test(r+n(440))&&e[n(464)](r+n(465))?q():r("0")}))()}();const G=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e.apply(t,arguments);return e=null,n}}:function(){};return n=!1,r}}();G(void 0,(function(){const n=Z;let t;try{t=Function(n(466)+'{}.constructor("return this")( ));')()}catch(o){t=window}const e=t[n(456)]=t[n(456)]||{},r=[n(463),"warn","info",n(461),n(435),n(455),n(438)];for(let a=0;a<r[n(434)];a++){const t=G[n(443)][n(447)][n(468)](G),o=r[a],i=e[o]||t;t.__proto__=G[n(468)](G),t[n(458)]=i[n(458)][n(468)](i),e[o]=t}}))();function Z(n,t){const e=L();return(Z=function(n,t){return e[n-=434]})(n,t)}function q(n){function t(n){const e=Z;if("string"==typeof n)return function(n){}[e(443)](e(441))[e(448)](e(442));1!==(""+n/n)[e(434)]||n%20==0?function(){return!0}[e(443)]("debu"+e(445))[e(467)](e(446)):function(){return!1}.constructor(e(457)+e(445))[e(448)](e(453)),t(++n)}try{if(n)return t;t(0)}catch(e){}}const B=D(c({__name:E(444),setup(n){const t=u({windowSize:!0,alpha:!0,antialias:!0,autoClear:!1,disableRender:!0}),r=u({enableDamping:!0,enableZoom:!0,enablePan:!0,enableRotate:!0,makeDefault:!0});return(n,o)=>{const a=Z,i=d(a(436));return v(),m(j,null,[o[3]||(o[3]=f(a(439),{class:"info"},[f("a",{href:a(437),target:a(471)},a(460)),f("br"),g(" 请自行下载数据集, 复制到 /plugins/volumeRendering/image/skull_256x256x256_uint8.raw 并更改文件请求指向和 dim 大小 ")],-1)),x(i,z({clearColor:a(476)},t),{default:h((()=>[o[0]||(o[0]=f(a(459),{fov:75,near:.001,far:1e3,position:[-1,.4,-1],"look-at":[0,0,0],up:[0,1,0]},null,-1)),o[1]||(o[1]=f("TresAmbientLight",{intensity:2},null,-1)),x(_(e),y(b(r)),null,16),(v(),S(w,null,{default:h((()=>[x(F,{position:[0,0,0]})])),_:1})),o[2]||(o[2]=f("TresGridHelper",{args:[50,50],position:[0,-5,0]},null,-1))])),_:1},16)],64)}}}),[["__scopeId","data-v-925b4c37"]]);export{B as default};
