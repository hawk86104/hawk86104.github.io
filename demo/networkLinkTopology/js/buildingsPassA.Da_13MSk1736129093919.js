import{b as n}from"./pagesShow.vue_vue_type_script_setup_true_lang.BCCAmrnj1736129093919.js";import{cf as t,_ as e,cd as o,ck as i,m as r,cv as u}from"./three.ES53pcRR1736129093919.js";import{m as s,e as a}from"./@tresjs.C4A766dl1736129093919.js";import{d as c,a3 as l,r as p,o as f,f as d,g as v,j as m,aj as h,ak as P}from"./@vue.uQKhJ3x71736129093919.js";import{P as x}from"./tweakpane.BCjFYDHx1736129093919.js";import"./three-custom-shader-material.LMK2zh-z1736129093919.js";import"./buildingsCustomShaderMaterial.DlgvFSb71736129093919.js";import"./@vueuse.CaPKQ7tQ1736129093919.js";const w=g;function g(n,t){const e=b();return(g=function(n,t){return e[n-=390]})(n,t)}!function(n,t){const e=g,o=b();for(;;)try{if(594182===parseInt(e(441))/1*(-parseInt(e(447))/2)+-parseInt(e(428))/3*(parseInt(e(413))/4)+-parseInt(e(393))/5*(-parseInt(e(418))/6)+parseInt(e(426))/7*(-parseInt(e(405))/8)+-parseInt(e(430))/9+parseInt(e(410))/10+-parseInt(e(408))/11*(-parseInt(e(394))/12))break;o.push(o.shift())}catch(i){o.push(o.shift())}}();const S=function(){let n=!0;return function(t,e){const o=n?function(){if(e){const n=e[g(404)](t,arguments);return e=null,n}}:function(){};return n=!1,o}}();function b(){const n=["addPass","log","gger","matrixWorld","apply","4360kJFtFf","buildingsPassA","depthBuffer","2761BCYolQ","depthTexture","9118930jtpuPx","prototype","Color","6584PAnApe","color","while (true) {}","table","set","390kcSDZX","uColor","error","warn","debu","call","length","uWidth","10885IHaZqq","uScalenum","1560esvAPA","#FFF","582300tmagYG","console","chain","uScaleone","counter","value","uniforms","readBuffer","toString","init","bind","37gtSogR","uPosition","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","projectionMatrixInverse","constructor","action","13956KSLHLG","width","DepthTexture","Vector2","stateObject","info","string","73795yEbbxf","35820wPfoip","speed","material","function *\\( *\\)","test","time"];return(b=function(){return n})()}!function(){S(this,(function(){const n=g,t=new RegExp(n(397)),e=new RegExp(n(443),"i"),o=_(n(439));t[n(398)](o+n(432))&&e[n(398)](o+"input")?_():o("0")}))()}();const y=function(){let n=!0;return function(t,e){const o=n?function(){if(e){const n=e[g(404)](t,arguments);return e=null,n}}:function(){};return n=!1,o}}();y(void 0,(function(){const n=g;let t;try{t=Function('return (function() {}.constructor("return this")( ));')()}catch(i){t=window}const e=t.console=t[n(431)]||{},o=[n(401),n(421),n(391),n(420),"exception",n(416),"trace"];for(let r=0;r<o[n(424)];r++){const t=y[n(445)][n(411)].bind(y),i=o[r],u=e[i]||t;t.__proto__=y[n(440)](y),t[n(438)]=u[n(438)][n(440)](u),e[i]=t}}))();const I=c({__name:w(406),props:{color:{default:w(429)},uScalenum:{default:150},uScaleone:{default:24},uWidth:{default:1},speed:{default:1},uPosition:{default:{x:0,y:0}}},setup(n){const c=n,{renderer:p,scene:f,camera:d,sizes:v}=s();let m,h=0,P=null,x=null;l((()=>{const n=g;v[n(448)][n(435)]&&(m=v[n(448)][n(435)],h=v.height.value,(()=>{const n=g;P=new t(p[n(435)]);const s=new(e[n(449)])(m,h);P[n(437)][n(407)]=!0,P[n(437)][n(409)]=s;const a=new o(f[n(435)],d.value);P[n(400)](a),x=new i(new r({uniforms:{time:{value:0},tDiffuse:{value:null},depthTexture:{value:s},uProjectionInverse:{value:d[n(435)][n(444)]},uMatrixWorld:{value:d.value[n(403)]},uColor:{value:new(e[n(412)])(c[n(414)])},uScalenum:{value:c.uScalenum},uScaleone:{value:c[n(433)]},uWidth:{value:c[n(425)]},uPosition:{value:new(e[n(450)])(c[n(442)].x,c[n(442)].y)}},vertexShader:"varying vec2 vUv;\nvarying vec3 vPosition;\n\nvoid main(){\n\tvUv=uv;\n\tvPosition=position;\n\tgl_Position=vec4(position,1.);\n}\n",fragmentShader:"varying vec2 vUv;\nvarying vec3 vPosition;\nuniform sampler2D tDiffuse;\nuniform sampler2D depthTexture;\n\nuniform mat4 uProjectionInverse;\nuniform mat4 uMatrixWorld;\n\nuniform float time;\nuniform vec3 uColor;\nuniform float uScalenum;//最大范围\nuniform float uScaleone;//单条圈间距\nuniform float uWidth;//单条厚度\nuniform vec2 uPosition;//位置\n\nvec3 WorldPosFromDepth(float depth){\n\tfloat z=(depth-.5)*2.;\n\tvec4 clipSpacePosition=vec4(vPosition.xy,z,1.);\n\tvec4 viewSpacePosition=uProjectionInverse*clipSpacePosition;\n\tviewSpacePosition/=viewSpacePosition.w;\n\tvec4 worldSpacePosition=uMatrixWorld*viewSpacePosition;\n\treturn worldSpacePosition.xyz;\n}\nvec3 WorldPosFromDepth2(float depth){\n\t// 规范化设备坐标系 ndc (Normalized Device Coordinates)\n\tvec4 ndc=vec4(vPosition.x,vPosition.y,((depth-.5)*2.),1.);\n\t// 根据视图中的位置和深度逆向MVP (ModelViewProjectionMatrix) 以获取真实渲染的位置\n\tvec4 worldSpacePosition=uMatrixWorld*uProjectionInverse*ndc;\n\t// 由于透视相机视图区域是一个截锥体 在乘以矩阵后，结果不在同一个射影空间上（这意味着 w 分量不是每个顶点的 1）\n\t// 为了完成转换，我们需要将向量的每个分量除以 w 分量本身\n\t// 这一步正常渲染时在GPU中做 我们复原需要手动处理\n\tworldSpacePosition/=worldSpacePosition.w;\n\treturn worldSpacePosition.xyz;\n}\n\nvoid main(){\n\tvec4 base=texture2D(tDiffuse,vUv);//之前的纹理\n\tfloat depth=texture2D(depthTexture,vUv).r;\n\t\n\t// vec3 pos=WorldPosFromDepth(depth);\n\tvec3 pos=WorldPosFromDepth2(depth);\n\tpos.x=pos.x+uPosition.x;\n\tpos.z=pos.z+uPosition.y;\n\tfloat dis=distance(pos.xz,vec2(0,0));\n\tvec3 color=vec3(base);\n\tif(pos.y<=0.){\n\t\tdiscard;\n\t}\n\tif(dis<uScalenum){\n\t\tvec3 scanT=uColor;\n\t\tfloat wave=fract((dis-time*10.)/uScaleone);\n\t\tif(wave<uWidth){\n\t\t\tfloat p=wave/uWidth;\n\t\t\tcolor=mix(color,scanT+.1,p*(1.-(dis/uScalenum)));\n\t\t}\n\t}\n\tgl_FragColor=vec4(color,1.);\n}\n"})),P[n(400)](x);const l=new i(u);P.addPass(l)})())}));const{onLoop:w}=a();return w((({elapsed:n})=>{const t=g;P&&(P.render(),x[t(436)][t(399)][t(435)]+=c[t(395)]/60)})),l((()=>{const n=g;x&&(c[n(414)]&&(x[n(396)][n(436)][n(419)][n(435)]=new(e[n(412)])(c.color)),c.uScalenum&&(x.material.uniforms[n(427)].value=c.uScalenum),c[n(433)]&&(x[n(396)][n(436)][n(433)][n(435)]=c.uScaleone),c[n(425)]&&(x[n(396)][n(436)].uWidth[n(435)]=c[n(425)]),c[n(442)]&&x.material[n(436)][n(442)][n(435)][n(417)](c.uPosition.x,c.uPosition.y))})),(n,t)=>null}});function _(n){function t(n){const e=g;if(typeof n===e(392))return function(n){}[e(445)](e(415))[e(404)](e(434));1!==(""+n/n).length||n%20==0?function(){return!0}[e(445)]("debu"+e(402))[e(423)](e(446)):function(){return!1}[e(445)](e(422)+e(402))[e(404)](e(390)),t(++n)}try{if(n)return t;t(0)}catch(e){}}function j(){const n=["warn","return (function() ","buildingsPassA","toString","#00b4fb","inline","bind","uWidth","apply","stateObject","console","2541411xOSYgy","uScaleone","uPosition","init","5682510bkYYlL","length","1021056aegjPb","while (true) {}","chain","speed","table","color","string","后期效果","constructor",'{}.constructor("return this")( )',"function *\\( *\\)","trace","log","144537jfLJpy","test","uScalenum","debu","info","call","2611548TZMehP","error","input","5Osfhmz","27584XclWlP","gger","单条圈宽度","最大范围","圈颜色","addBinding","单条圈间距","action","4aqIgzg","83883zabDIe","791okVsjf"];return(j=function(){return n})()}const W=k;!function(n,t){const e=k,o=j();for(;;)try{if(256483===parseInt(e(124))/1+parseInt(e(123))/2*(parseInt(e(156))/3)+-parseInt(e(143))/4+-parseInt(e(114))/5*(-parseInt(e(111))/6)+-parseInt(e(125))/7*(parseInt(e(115))/8)+-parseInt(e(137))/9+parseInt(e(141))/10)break;o.push(o.shift())}catch(i){o.push(o.shift())}}();const z=function(){let n=!0;return function(t,e){const o=n?function(){if(e){const n=e[k(134)](t,arguments);return e=null,n}}:function(){};return n=!1,o}}();!function(){z(this,(function(){const n=k,t=new RegExp(n(153)),e=new RegExp("\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","i"),o=A(n(140));t[n(157)](o+n(145))&&e[n(157)](o+n(113))?A():o("0")}))()}();const D=function(){let n=!0;return function(t,e){const o=n?function(){if(e){const n=e.apply(t,arguments);return e=null,n}}:function(){};return n=!1,o}}();function k(n,t){const e=j();return(k=function(n,t){return e[n-=109]})(n,t)}D(void 0,(function(){const n=k;let t;try{t=Function(n(127)+n(152)+");")()}catch(i){t=window}const e=t[n(136)]=t.console||{},o=[n(155),n(126),n(109),n(112),"exception",n(147),n(154)];for(let r=0;r<o[n(142)];r++){const t=D[n(151)].prototype[n(132)](D),i=o[r],u=e[i]||t;t.__proto__=D[n(132)](D),t[n(129)]=u[n(129)].bind(u),e[i]=t}}))();const F=c({__name:W(128),setup(t){const e=W,o=p({color:e(130),uScalenum:250,uScaleone:82,uWidth:.2,speed:10,uPosition:{x:0,y:0}}),i=new x({title:e(150),expanded:!0});return i[e(120)](o,e(148),{label:e(119)}),i.addBinding(o,e(158),{label:e(118),min:1,max:500,step:10}),i[e(120)](o,e(138),{label:e(121),min:1,max:100,step:1}),i[e(120)](o,e(133),{label:e(117),min:0,max:1,step:.01}),i[e(120)](o,e(146),{label:"速度",min:1,max:20,step:1}),i.addBinding(o,e(139),{picker:e(131),label:"位置",expanded:!0,x:{min:-1e3,max:1e3,step:10},y:{min:-1e3,max:1e3,step:10}}),(t,e)=>(f(),d(n,{disableRender:!0,showAxesHelper:!1},{ability:v((()=>[m(I,h(P(o)),null,16)])),_:1}))}});function A(n){function t(n){const e=k;if(typeof n===e(149))return function(n){}[e(151)](e(144))[e(134)]("counter");1!==(""+n/n)[e(142)]||n%20==0?function(){return!0}[e(151)]("debu"+e(116))[e(110)](e(122)):function(){return!1}[e(151)](e(159)+"gger")[e(134)](e(135)),t(++n)}try{if(n)return t;t(0)}catch(e){}}export{F as default};
