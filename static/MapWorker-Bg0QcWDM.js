(function(){"use strict";class n{constructor(){this._controller=new AbortController,this.listeners=new Set}static{this.pendings=new Map}fetch(e,i={}){n.pendings.has(e)||(n.pendings.set(e,this),fetch(e,{...i,signal:this._controller.signal}).then(r=>{this.listeners.forEach(s=>s.resolve(r.clone()))}).catch(r=>{this.listeners.forEach(s=>s.reject(r))}).finally(()=>{n.pendings.delete(e)}))}abort(){this._controller.abort()}}class h{constructor(e,i){this.url=e,this.init=i,this.promise=new Promise((r,s)=>{this.resolve=r,this.reject=s})}ready(){let e=n.pendings.get(this.url);return e||(e=new n,e.fetch(this.url,this.init)),e.listeners.add(this),this.promise}abort(){this.reject("User abort.");const e=n.pendings.get(this.url);e&&(e.listeners.delete(this),e.listeners.size===0&&e.abort())}}let o;async function g(a,e,i=!1){const s=await(await e.ready()).blob(),c=await createImageBitmap(s,i?void 0:{imageOrientation:"flipY"});if(!i)return c;o||(o=new OffscreenCanvas(256,256));const t=o.getContext("2d");if(!t)throw new Error('Offscreencanvas.getContext("2d") error!');const{width:f,height:d}=o;return t.drawImage(c,0,0),t.rect(0,0,f,d),t.strokeStyle="#00FFFF",t.font="20px Arial",t.stroke(),t.fillStyle="#FF4444",t.fillText(`${a[0]}`,10,30),t.fillStyle="#44FF44",t.fillText(`${a[1]}`,10,55),t.fillStyle="#66AAFF",t.fillText(`${a[2]}`,10,80),await createImageBitmap(o,{imageOrientation:"flipY"})}const l=new Map;self.onmessage=async a=>{const{id:e,tileNo:i,url:r,debug:s,abort:c}=a.data;if(c){l.get(e)?.abort(),l.delete(e),self.postMessage({id:e,error:!0});return}try{const t=new h(r,{cache:"force-cache",mode:"cors"});l.set(e,t);const f=await g(i,t,s);self.postMessage({id:e,bitmap:f},[f])}catch{self.postMessage({id:e,error:!0})}finally{l.delete(e)}}})();
