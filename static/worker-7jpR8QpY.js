!function(){"use strict";"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function e(t){if(t.__esModule)return t;var e=t.default;if("function"==typeof e){var r=function t(){return this instanceof t?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(e){var i=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(r,e,i.get?i:{enumerable:!0,get:function(){return t[e]}})}),r}var r={exports:{}},i=e(Object.freeze({__proto__:null,default:{}}));(function(t){var e={},r={exports:{}};!function(t){var e=function(t){return void 0!==t&&null!=t.versions&&null!=t.versions.node&&t+""=="[object process]"};t.exports.isNode=e,t.exports.platform="undefined"!=typeof process&&e(process)?"node":"browser";var r="node"===t.exports.platform&&i;t.exports.isMainThread="node"===t.exports.platform?(!r||r.isMainThread)&&!process.connected:"undefined"!=typeof Window,t.exports.cpus="browser"===t.exports.platform?self.navigator.hardwareConcurrency:i.cpus().length}(r);var n,s=r.exports,o={};function a(){if(n)return o;function t(n,s){var o=this;if(!(this instanceof t))throw new SyntaxError("Constructor must be called with the new operator");if("function"!=typeof n)throw new SyntaxError("Function parameter handler(resolve, reject) missing");var a=[],h=[];this.resolved=!1,this.rejected=!1,this.pending=!0,this[Symbol.toStringTag]="Promise";var u=function(t,e){a.push(t),h.push(e)};this.then=function(r,i){return new t(function(t,n){var s=r?e(r,t,n):t,o=i?e(i,t,n):n;u(s,o)},o)};var c=function(t){return o.resolved=!0,o.rejected=!1,o.pending=!1,a.forEach(function(e){e(t)}),u=function(e,r){e(t)},c=l=function(){},o},l=function(t){return o.resolved=!1,o.rejected=!0,o.pending=!1,h.forEach(function(e){e(t)}),u=function(e,r){r(t)},c=l=function(){},o};this.cancel=function(){return s?s.cancel():l(new r),o},this.timeout=function(t){if(s)s.timeout(t);else{var e=setTimeout(function(){l(new i("Promise timed out after "+t+" ms"))},t);o.always(function(){clearTimeout(e)})}return o},n(function(t){c(t)},function(t){l(t)})}function e(t,e,r){return function(i){try{var n=t(i);n&&"function"==typeof n.then&&"function"==typeof n.catch?n.then(e,r):e(n)}catch(s){r(s)}}}function r(t){this.message=t||"promise cancelled",this.stack=(new Error).stack}function i(t){this.message=t||"timeout exceeded",this.stack=(new Error).stack}return n=1,t.prototype.catch=function(t){return this.then(null,t)},t.prototype.always=function(t){return this.then(t,t)},t.prototype.finally=function(e){var r=this,i=function(){return new t(function(t){return t()}).then(e).then(function(){return r})};return this.then(i,i)},t.all=function(e){return new t(function(t,r){var i=e.length,n=[];i?e.forEach(function(e,s){e.then(function(e){n[s]=e,0==--i&&t(n)},function(t){i=0,r(t)})}):t(n)})},t.defer=function(){var e={};return e.promise=new t(function(t,r){e.resolve=t,e.reject=r}),e},r.prototype=new Error,r.prototype.constructor=Error,r.prototype.name="CancellationError",t.CancellationError=r,i.prototype=new Error,i.prototype.constructor=Error,i.prototype.name="TimeoutError",t.TimeoutError=i,o.Promise=t,o}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=Array(e);r<e;r++)i[r]=t[r];return i}function u(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=y(t))||e){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,s=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw s}}}}function c(t,e,r){return(e=f(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function l(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,i)}return r}function d(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?l(Object(r),!0).forEach(function(e){c(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function m(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function f(t){var e=m(t,"string");return"symbol"==typeof e?e:e+""}function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}function y(t,e){if(t){if("string"==typeof t)return h(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(t,e):void 0}}var x,g,w,b,_,v,M,k,E={exports:{}},z={};function A(){return x||(x=1,z.validateOptions=function(t,e,r){if(t){var i=t?Object.keys(t):[],n=i.find(function(t){return!e.includes(t)});if(n)throw new Error('Object "'+r+'" contains an unknown option "'+n+'"');var s=e.find(function(t){return Object.prototype[t]&&!i.includes(t)});if(s)throw new Error('Object "'+r+'" contains an inherited option "'+s+'" which is not defined in the object itself but in its prototype. Only plain objects are allowed. Please remove the option from the prototype or override it with a value "undefined".');return t}},z.workerOptsNames=["credentials","name","type"],z.forkOptsNames=["cwd","detached","env","execPath","execArgv","gid","serialization","signal","killSignal","silent","stdio","uid","windowsVerbatimArguments","timeout"],z.workerThreadOptsNames=["argv","env","eval","execArgv","stdin","stdout","stderr","workerData","trackUnmanagedFds","transferList","resourceLimits","name"]),z}function S(){return w?g:(w=1,g='!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).worker=n()}(this,(function(){"use strict";function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(n)}function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t={};var r=function(e,n){this.message=e,this.transfer=n},o={};function i(e,n){var t=this;if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if("function"!=typeof e)throw new SyntaxError("Function parameter handler(resolve, reject) missing");var r=[],o=[];this.resolved=!1,this.rejected=!1,this.pending=!0,this[Symbol.toStringTag]="Promise";var a=function(e,n){r.push(e),o.push(n)};this.then=function(e,n){return new i((function(t,r){var o=e?s(e,t,r):t,i=n?s(n,t,r):r;a(o,i)}),t)};var f=function(e){return t.resolved=!0,t.rejected=!1,t.pending=!1,r.forEach((function(n){n(e)})),a=function(n,t){n(e)},f=d=function(){},t},d=function(e){return t.resolved=!1,t.rejected=!0,t.pending=!1,o.forEach((function(n){n(e)})),a=function(n,t){t(e)},f=d=function(){},t};this.cancel=function(){return n?n.cancel():d(new u),t},this.timeout=function(e){if(n)n.timeout(e);else{var r=setTimeout((function(){d(new c("Promise timed out after "+e+" ms"))}),e);t.always((function(){clearTimeout(r)}))}return t},e((function(e){f(e)}),(function(e){d(e)}))}function s(e,n,t){return function(r){try{var o=e(r);o&&"function"==typeof o.then&&"function"==typeof o.catch?o.then(n,t):n(o)}catch(e){t(e)}}}function u(e){this.message=e||"promise cancelled",this.stack=(new Error).stack}function c(e){this.message=e||"timeout exceeded",this.stack=(new Error).stack}return i.prototype.catch=function(e){return this.then(null,e)},i.prototype.always=function(e){return this.then(e,e)},i.prototype.finally=function(e){var n=this,t=function(){return new i((function(e){return e()})).then(e).then((function(){return n}))};return this.then(t,t)},i.all=function(e){return new i((function(n,t){var r=e.length,o=[];r?e.forEach((function(e,i){e.then((function(e){o[i]=e,0==--r&&n(o)}),(function(e){r=0,t(e)}))})):n(o)}))},i.defer=function(){var e={};return e.promise=new i((function(n,t){e.resolve=n,e.reject=t})),e},u.prototype=new Error,u.prototype.constructor=Error,u.prototype.name="CancellationError",i.CancellationError=u,c.prototype=new Error,c.prototype.constructor=Error,c.prototype.name="TimeoutError",i.TimeoutError=c,o.Promise=i,function(n){var t=r,i=o.Promise,s="__workerpool-cleanup__",u={exit:function(){}},c={addAbortListener:function(e){u.abortListeners.push(e)},emit:u.emit};if("undefined"!=typeof self&&"function"==typeof postMessage&&"function"==typeof addEventListener)u.on=function(e,n){addEventListener(e,(function(e){n(e.data)}))},u.send=function(e,n){n?postMessage(e,n):postMessage(e)};else{if("undefined"==typeof process)throw new Error("Script must be executed as a worker");var a;try{a=require("worker_threads")}catch(n){if("object"!==e(n)||null===n||"MODULE_NOT_FOUND"!==n.code)throw n}if(a&&null!==a.parentPort){var f=a.parentPort;u.send=f.postMessage.bind(f),u.on=f.on.bind(f),u.exit=process.exit.bind(process)}else u.on=process.on.bind(process),u.send=function(e){process.send(e)},u.on("disconnect",(function(){process.exit(1)})),u.exit=process.exit.bind(process)}function d(e){return e&&e.toJSON?JSON.parse(JSON.stringify(e)):JSON.parse(JSON.stringify(e,Object.getOwnPropertyNames(e)))}function l(e){return e&&"function"==typeof e.then&&"function"==typeof e.catch}u.methods={},u.methods.run=function(e,n){var t=new Function("return ("+e+").apply(this, arguments);");return t.worker=c,t.apply(t,n)},u.methods.methods=function(){return Object.keys(u.methods)},u.terminationHandler=void 0,u.abortListenerTimeout=1e3,u.abortListeners=[],u.terminateAndExit=function(e){var n=function(){u.exit(e)};if(!u.terminationHandler)return n();var t=u.terminationHandler(e);return l(t)?(t.then(n,n),t):(n(),new i((function(e,n){n(new Error("Worker terminating"))})))},u.cleanup=function(e){if(!u.abortListeners.length)return u.send({id:e,method:s,error:d(new Error("Worker terminating"))}),new i((function(e){e()}));var n,t=u.abortListeners.map((function(e){return e()})),r=new i((function(e,t){n=setTimeout((function(){t(new Error("Timeout occured waiting for abort handler, killing worker"))}),u.abortListenerTimeout)})),o=i.all(t).then((function(){clearTimeout(n),u.abortListeners.length||(u.abortListeners=[])}),(function(){clearTimeout(n),u.exit()}));return new i((function(e,n){o.then(e,n),r.then(e,n)})).then((function(){u.send({id:e,method:s,error:null})}),(function(n){u.send({id:e,method:s,error:n?d(n):null})}))};var p=null;u.on("message",(function(e){if("__workerpool-terminate__"===e)return u.terminateAndExit(0);if(e.method===s)return u.cleanup(e.id);try{var n=u.methods[e.method];if(!n)throw new Error(\'Unknown method "\'+e.method+\'"\');p=e.id;var r=n.apply(n,e.params);l(r)?r.then((function(n){n instanceof t?u.send({id:e.id,result:n.message,error:null},n.transfer):u.send({id:e.id,result:n,error:null}),p=null})).catch((function(n){u.send({id:e.id,result:null,error:d(n)}),p=null})):(r instanceof t?u.send({id:e.id,result:r.message,error:null},r.transfer):u.send({id:e.id,result:r,error:null}),p=null)}catch(n){u.send({id:e.id,result:null,error:d(n)})}})),u.register=function(e,n){if(e)for(var t in e)e.hasOwnProperty(t)&&(u.methods[t]=e[t],u.methods[t].worker=c);n&&(u.terminationHandler=n.onTerminate,u.abortListenerTimeout=n.abortListenerTimeout||1e3),u.send("ready")},u.emit=function(e){if(p){if(e instanceof t)return void u.send({id:p,isEvent:!0,payload:e.message},e.transfer);u.send({id:p,isEvent:!0,payload:e})}},n.add=u.register,n.emit=u.emit}(t),n(t)}));\n//# sourceMappingURL=worker.min.js.map\n')}function T(){if(b)return E.exports;b=1;var t=a().Promise,e=s,r=A(),n=r.validateOptions,o=r.forkOptsNames,h=r.workerThreadOptsNames,c=r.workerOptsNames,l="__workerpool-terminate__",m="__workerpool-cleanup__";function f(){var t=x();if(!t)throw new Error("WorkerPool: workerType = 'thread' is not supported, Node >= 11.7.0 required");return t}function y(){if("function"!=typeof Worker&&("object"!==("undefined"==typeof Worker?"undefined":p(Worker))||"function"!=typeof Worker.prototype.constructor))throw new Error("WorkerPool: Web Workers not supported")}function x(){try{return i}catch(t){if("object"===p(t)&&null!==t&&"MODULE_NOT_FOUND"===t.code)return null;throw t}}function g(){if("browser"===e.platform){if("undefined"==typeof Blob)throw new Error("Blob not supported by the browser");if(!window.URL||"function"!=typeof window.URL.createObjectURL)throw new Error("URL.createObjectURL not supported by the browser");var t=new Blob([S()],{type:"text/javascript"});return window.URL.createObjectURL(t)}return __dirname+"/worker.js"}function w(t,r){if("web"===r.workerType)return y(),_(t,r.workerOpts,Worker);if("thread"===r.workerType)return v(t,n=f(),r);if("process"!==r.workerType&&r.workerType){if("browser"===e.platform)return y(),_(t,r.workerOpts,Worker);var n=x();return n?v(t,n,r):M(t,k(r),i)}return M(t,k(r),i)}function _(t,e,r){n(e,c,"workerOpts");var i=new r(t,e);return i.isBrowserWorker=!0,i.on=function(t,e){this.addEventListener(t,function(t){e(t.data)})},i.send=function(t,e){this.postMessage(t,e)},i}function v(t,e,r){var i,s;n(null==r?void 0:r.workerThreadOpts,h,"workerThreadOpts");var o=new e.Worker(t,d({stdout:null!==(i=null==r?void 0:r.emitStdStreams)&&void 0!==i&&i,stderr:null!==(s=null==r?void 0:r.emitStdStreams)&&void 0!==s&&s},null==r?void 0:r.workerThreadOpts));return o.isWorkerThread=!0,o.send=function(t,e){this.postMessage(t,e)},o.kill=function(){return this.terminate(),!0},o.disconnect=function(){this.terminate()},null!=r&&r.emitStdStreams&&(o.stdout.on("data",function(t){return o.emit("stdout",t)}),o.stderr.on("data",function(t){return o.emit("stderr",t)})),o}function M(t,e,r){n(e.forkOpts,o,"forkOpts");var i=r.fork(t,e.forkArgs,e.forkOpts),s=i.send;return i.send=function(t){return s.call(i,t)},e.emitStdStreams&&(i.stdout.on("data",function(t){return i.emit("stdout",t)}),i.stderr.on("data",function(t){return i.emit("stderr",t)})),i.isChildProcess=!0,i}function k(t){t=t||{};var e=process.execArgv.join(" "),r=-1!==e.indexOf("--inspect"),i=-1!==e.indexOf("--debug-brk"),n=[];return r&&(n.push("--inspect="+t.debugPort),i&&n.push("--debug-brk")),process.execArgv.forEach(function(t){t.indexOf("--max-old-space-size")>-1&&n.push(t)}),Object.assign({},t,{forkArgs:t.forkArgs,forkOpts:Object.assign({},t.forkOpts,{execArgv:(t.forkOpts&&t.forkOpts.execArgv||[]).concat(n),stdio:t.emitStdStreams?"pipe":void 0})})}function z(t){for(var e=new Error(""),r=Object.keys(t),i=0;i<r.length;i++)e[r[i]]=t[r[i]];return e}function T(t,e){Object.values(t.processing).forEach(function(t){var r;return null==t||null===(r=t.options)||void 0===r?void 0:r.on(e)}),Object.values(t.tracking).forEach(function(t){var r;return null==t||null===(r=t.options)||void 0===r?void 0:r.on(e)})}function O(t,e){var r=this,i=e||{};function n(t){for(var e in r.terminated=!0,r.processing)void 0!==r.processing[e]&&r.processing[e].resolver.reject(t);r.processing=Object.create(null)}function s(){var t,e=u(r.requestQueue.splice(0));try{for(e.s();!(t=e.n()).done;){var i=t.value;r.worker.send(i.message,i.transfer)}}catch(n){e.e(n)}finally{e.f()}}this.script=t||g(),this.worker=w(this.script,i),this.debugPort=i.debugPort,this.forkOpts=i.forkOpts,this.forkArgs=i.forkArgs,this.workerOpts=i.workerOpts,this.workerThreadOpts=i.workerThreadOpts,this.workerTerminateTimeout=i.workerTerminateTimeout,t||(this.worker.ready=!0),this.requestQueue=[],this.worker.on("stdout",function(t){T(r,{stdout:t.toString()})}),this.worker.on("stderr",function(t){T(r,{stderr:t.toString()})}),this.worker.on("message",function(t){if(!r.terminated)if("string"==typeof t&&"ready"===t)r.worker.ready=!0,s();else{var e,i=t.id;if(void 0!==(e=r.processing[i])?t.isEvent?e.options&&"function"==typeof e.options.on&&e.options.on(t.payload):(delete r.processing[i],!0===r.terminating&&r.terminate(),t.error?e.resolver.reject(z(t.error)):e.resolver.resolve(t.result)):void 0!==(e=r.tracking[i])&&t.isEvent&&e.options&&"function"==typeof e.options.on&&e.options.on(t.payload),t.method===m){var n=r.tracking[t.id];void 0!==n&&(t.error?(clearTimeout(n.timeoutId),n.resolver.reject(z(t.error))):(r.tracking&&clearTimeout(n.timeoutId),n.resolver.reject(new B(n.error)))),delete r.tracking[i]}}});var o=this.worker;this.worker.on("error",n),this.worker.on("exit",function(t,e){var i="Workerpool Worker terminated Unexpectedly\n";i+="    exitCode: `"+t+"`\n",i+="    signalCode: `"+e+"`\n",i+="    workerpool.script: `"+r.script+"`\n",i+="    spawnArgs: `"+o.spawnargs+"`\n",i+="    spawnfile: `"+o.spawnfile+"`\n",i+="    stdout: `"+o.stdout+"`\n",i+="    stderr: `"+o.stderr+"`\n",n(new Error(i))}),this.processing=Object.create(null),this.tracking=Object.create(null),this.terminating=!1,this.terminated=!1,this.cleaning=!1,this.terminationHandler=null,this.lastId=0}function B(t){this.error=t,this.stack=(new Error).stack}return O.prototype.methods=function(){return this.exec("methods")},O.prototype.exec=function(e,r,i,n){i||(i=t.defer());var s=++this.lastId;this.processing[s]={id:s,resolver:i,options:n};var o={message:{id:s,method:e,params:r},transfer:n&&n.transfer};this.terminated?i.reject(new Error("Worker is terminated")):this.worker.ready?this.worker.send(o.message,o.transfer):this.requestQueue.push(o);var a=this;return i.promise.catch(function(e){if(e instanceof t.CancellationError||e instanceof t.TimeoutError)return a.tracking[s]={id:s,resolver:t.defer(),options:n,error:e},delete a.processing[s],a.tracking[s].resolver.promise=a.tracking[s].resolver.promise.catch(function(t){if(delete a.tracking[s],t instanceof B)throw t.error;var e=a.terminateAndNotify(!0).then(function(){throw t},function(t){throw t});return e}),a.worker.send({id:s,method:m}),a.tracking[s].timeoutId=setTimeout(function(){a.tracking[s].resolver.reject(e)},a.workerTerminateTimeout),a.tracking[s].resolver.promise;throw e})},O.prototype.busy=function(){return this.cleaning||Object.keys(this.processing).length>0},O.prototype.terminate=function(t,e){var r=this;if(t){for(var i in this.processing)void 0!==this.processing[i]&&this.processing[i].resolver.reject(new Error("Worker terminated"));this.processing=Object.create(null)}for(var n=0,s=Object.values(r.tracking);n<s.length;n++){var o=s[n];clearTimeout(o.timeoutId),o.resolver.reject(new Error("Worker Terminating"))}if(r.tracking=Object.create(null),"function"==typeof e&&(this.terminationHandler=e),this.busy())this.terminating=!0;else{var a=function(t){if(r.terminated=!0,r.cleaning=!1,null!=r.worker&&r.worker.removeAllListeners&&r.worker.removeAllListeners("message"),r.worker=null,r.terminating=!1,r.terminationHandler)r.terminationHandler(t,r);else if(t)throw t};if(this.worker){if("function"==typeof this.worker.kill){if(this.worker.killed)return void a(new Error("worker already killed!"));var h=setTimeout(function(){r.worker&&r.worker.kill()},this.workerTerminateTimeout);return this.worker.once("exit",function(){clearTimeout(h),r.worker&&(r.worker.killed=!0),a()}),this.worker.ready?this.worker.send(l):this.requestQueue.push({message:l}),void(this.cleaning=!0)}if("function"!=typeof this.worker.terminate)throw new Error("Failed to terminate worker");this.worker.terminate(),this.worker.killed=!0}a()}},O.prototype.terminateAndNotify=function(e,r){var i=t.defer();return r&&i.promise.timeout(r),this.terminate(e,function(t,e){t?i.reject(t):i.resolve(e)}),i.promise},E.exports=O,E.exports._tryRequireWorkerThreads=x,E.exports._setupProcessWorker=M,E.exports._setupBrowserWorker=_,E.exports._setupWorkerThreadWorker=v,E.exports.ensureWorkerThreads=f,E.exports}function O(){if(v)return _;v=1;var t=65535;function e(){this.ports=Object.create(null),this.length=0}return _=e,e.prototype.nextAvailableStartingAt=function(e){for(;!0===this.ports[e];)e++;if(e>=t)throw new Error("WorkerPool debug port limit reached: "+e+">= "+t);return this.ports[e]=!0,this.length++,e},e.prototype.releasePort=function(t){delete this.ports[t],this.length--},_}function B(){if(k)return M;k=1;var t=a().Promise,e=T(),r=s,i=new(O());function n(t,i){"string"==typeof t?this.script=t||null:(this.script=null,i=t),this.workers=[],this.tasks=[],i=i||{},this.forkArgs=Object.freeze(i.forkArgs||[]),this.forkOpts=Object.freeze(i.forkOpts||{}),this.workerOpts=Object.freeze(i.workerOpts||{}),this.workerThreadOpts=Object.freeze(i.workerThreadOpts||{}),this.debugPortStart=i.debugPortStart||43210,this.nodeWorker=i.nodeWorker,this.workerType=i.workerType||i.nodeWorker||"auto",this.maxQueueSize=i.maxQueueSize||1/0,this.workerTerminateTimeout=i.workerTerminateTimeout||1e3,this.onCreateWorker=i.onCreateWorker||function(){return null},this.onTerminateWorker=i.onTerminateWorker||function(){return null},this.emitStdStreams=i.emitStdStreams||!1,i&&"maxWorkers"in i?(o(i.maxWorkers),this.maxWorkers=i.maxWorkers):this.maxWorkers=Math.max((r.cpus||4)-1,1),i&&"minWorkers"in i&&("max"===i.minWorkers?this.minWorkers=this.maxWorkers:(h(i.minWorkers),this.minWorkers=i.minWorkers,this.maxWorkers=Math.max(this.minWorkers,this.maxWorkers)),this._ensureMinWorkers()),this._boundNext=this._next.bind(this),"thread"===this.workerType&&e.ensureWorkerThreads()}function o(t){if(!u(t)||!c(t)||t<1)throw new TypeError("Option maxWorkers must be an integer number >= 1")}function h(t){if(!u(t)||!c(t)||t<0)throw new TypeError("Option minWorkers must be an integer number >= 0")}function u(t){return"number"==typeof t}function c(t){return Math.round(t)==t}return n.prototype.exec=function(e,r,i){if(r&&!Array.isArray(r))throw new TypeError('Array expected as argument "params"');if("string"==typeof e){var n=t.defer();if(this.tasks.length>=this.maxQueueSize)throw new Error("Max queue size of "+this.maxQueueSize+" reached");var s=this.tasks,o={method:e,params:r,resolver:n,timeout:null,options:i};s.push(o);var a=n.promise.timeout;return n.promise.timeout=function(t){return-1!==s.indexOf(o)?(o.timeout=t,n.promise):a.call(n.promise,t)},this._next(),n.promise}if("function"==typeof e)return this.exec("run",[String(e),r],i);throw new TypeError('Function or string expected as argument "method"')},n.prototype.proxy=function(){if(arguments.length>0)throw new Error("No arguments expected");var t=this;return this.exec("methods").then(function(e){var r={};return e.forEach(function(e){r[e]=function(){return t.exec(e,Array.prototype.slice.call(arguments))}}),r})},n.prototype._next=function(){if(this.tasks.length>0){var t=this._getWorker();if(t){var e=this,r=this.tasks.shift();if(r.resolver.promise.pending){var i=t.exec(r.method,r.params,r.resolver,r.options).then(e._boundNext).catch(function(){if(t.terminated)return e._removeWorker(t)}).then(function(){e._next()});"number"==typeof r.timeout&&i.timeout(r.timeout)}else e._next()}}},n.prototype._getWorker=function(){for(var t=this.workers,e=0;e<t.length;e++){var r=t[e];if(!1===r.busy())return r}return t.length<this.maxWorkers?(r=this._createWorkerHandler(),t.push(r),r):null},n.prototype._removeWorker=function(e){var r=this;return i.releasePort(e.debugPort),this._removeWorkerFromList(e),this._ensureMinWorkers(),new t(function(t,i){e.terminate(!1,function(n){r.onTerminateWorker({forkArgs:e.forkArgs,forkOpts:e.forkOpts,workerThreadOpts:e.workerThreadOpts,script:e.script}),n?i(n):t(e)})})},n.prototype._removeWorkerFromList=function(t){var e=this.workers.indexOf(t);-1!==e&&this.workers.splice(e,1)},n.prototype.terminate=function(e,r){var n=this;this.tasks.forEach(function(t){t.resolver.reject(new Error("Pool terminated"))}),this.tasks.length=0;var s=function(t){i.releasePort(t.debugPort),this._removeWorkerFromList(t)},o=s.bind(this),a=[];return this.workers.slice().forEach(function(t){var i=t.terminateAndNotify(e,r).then(o).always(function(){n.onTerminateWorker({forkArgs:t.forkArgs,forkOpts:t.forkOpts,workerThreadOpts:t.workerThreadOpts,script:t.script})});a.push(i)}),t.all(a)},n.prototype.stats=function(){var t=this.workers.length,e=this.workers.filter(function(t){return t.busy()}).length;return{totalWorkers:t,busyWorkers:e,idleWorkers:t-e,pendingTasks:this.tasks.length,activeTasks:e}},n.prototype._ensureMinWorkers=function(){if(this.minWorkers)for(var t=this.workers.length;t<this.minWorkers;t++)this.workers.push(this._createWorkerHandler())},n.prototype._createWorkerHandler=function(){var t=this.onCreateWorker({forkArgs:this.forkArgs,forkOpts:this.forkOpts,workerOpts:this.workerOpts,workerThreadOpts:this.workerThreadOpts,script:this.script})||{};return new e(t.script||this.script,{forkArgs:t.forkArgs||this.forkArgs,forkOpts:t.forkOpts||this.forkOpts,workerOpts:t.workerOpts||this.workerOpts,workerThreadOpts:t.workerThreadOpts||this.workerThreadOpts,debugPort:i.nextAvailableStartingAt(this.debugPortStart),workerType:this.workerType,workerTerminateTimeout:this.workerTerminateTimeout,emitStdStreams:this.emitStdStreams})},M=n}var P,N,R,F={};function U(){if(N)return P;function t(t,e){this.message=t,this.transfer=e}return N=1,P=t}function C(){return R||(R=1,function(t){var e=U(),r=a().Promise,n="__workerpool-terminate__",s="__workerpool-cleanup__",o=1e3,h={exit:function(){}},u={addAbortListener:function(t){h.abortListeners.push(t)},emit:h.emit};if("undefined"!=typeof self&&"function"==typeof postMessage&&"function"==typeof addEventListener)h.on=function(t,e){addEventListener(t,function(t){e(t.data)})},h.send=function(t,e){e?postMessage(t,e):postMessage(t)};else{if("undefined"==typeof process)throw new Error("Script must be executed as a worker");var c;try{c=i}catch(y){if("object"!==p(y)||null===y||"MODULE_NOT_FOUND"!==y.code)throw y}if(c&&null!==c.parentPort){var l=c.parentPort;h.send=l.postMessage.bind(l),h.on=l.on.bind(l),h.exit=process.exit.bind(process)}else h.on=process.on.bind(process),h.send=function(t){process.send(t)},h.on("disconnect",function(){process.exit(1)}),h.exit=process.exit.bind(process)}function d(t){return t&&t.toJSON?JSON.parse(JSON.stringify(t)):JSON.parse(JSON.stringify(t,Object.getOwnPropertyNames(t)))}function m(t){return t&&"function"==typeof t.then&&"function"==typeof t.catch}h.methods={},h.methods.run=function(t,e){var r=new Function("return ("+t+").apply(this, arguments);");return r.worker=u,r.apply(r,e)},h.methods.methods=function(){return Object.keys(h.methods)},h.terminationHandler=void 0,h.abortListenerTimeout=o,h.abortListeners=[],h.terminateAndExit=function(t){var e=function(){h.exit(t)};if(!h.terminationHandler)return e();var i=h.terminationHandler(t);return m(i)?(i.then(e,e),i):(e(),new r(function(t,e){e(new Error("Worker terminating"))}))},h.cleanup=function(t){if(!h.abortListeners.length)return h.send({id:t,method:s,error:d(new Error("Worker terminating"))}),new r(function(t){t()});var e,i=function(){h.exit()},n=function(){h.abortListeners.length||(h.abortListeners=[])},o=h.abortListeners.map(function(t){return t()}),a=new r(function(t,r){e=setTimeout(function(){r(new Error("Timeout occured waiting for abort handler, killing worker"))},h.abortListenerTimeout)}),u=r.all(o).then(function(){clearTimeout(e),n()},function(){clearTimeout(e),i()});return new r(function(t,e){u.then(t,e),a.then(t,e)}).then(function(){h.send({id:t,method:s,error:null})},function(e){h.send({id:t,method:s,error:e?d(e):null})})};var f=null;h.on("message",function(t){if(t===n)return h.terminateAndExit(0);if(t.method===s)return h.cleanup(t.id);try{var r=h.methods[t.method];if(!r)throw new Error('Unknown method "'+t.method+'"');f=t.id;var i=r.apply(r,t.params);m(i)?i.then(function(r){r instanceof e?h.send({id:t.id,result:r.message,error:null},r.transfer):h.send({id:t.id,result:r,error:null}),f=null}).catch(function(e){h.send({id:t.id,result:null,error:d(e)}),f=null}):(i instanceof e?h.send({id:t.id,result:i.message,error:null},i.transfer):h.send({id:t.id,result:i,error:null}),f=null)}catch(o){h.send({id:t.id,result:null,error:d(o)})}}),h.register=function(t,e){if(t)for(var r in t)t.hasOwnProperty(r)&&(h.methods[r]=t[r],h.methods[r].worker=u);e&&(h.terminationHandler=e.onTerminate,h.abortListenerTimeout=e.abortListenerTimeout||o),h.send("ready")},h.emit=function(t){if(f){if(t instanceof e)return void h.send({id:f,isEvent:!0,payload:t.message},t.transfer);h.send({id:f,isEvent:!0,payload:t})}},t.add=h.register,t.emit=h.emit}(F)),F}var I=s.platform,L=s.isMainThread,W=s.cpus;function j(t,e){return new(B())(t,e)}var D=e.pool=j;function V(t,e){C().add(t,e)}var q=e.worker=V;function Y(t){C().emit(t)}var X=e.workerEmit=Y,H=a().Promise,Z=e.Promise=H,J=e.Transfer=U(),G=e.platform=I,Q=e.isMainThread=L,$=e.cpus=W;t.Promise=Z,t.Transfer=J,t.cpus=$,t.default=e,t.isMainThread=Q,t.platform=G,t.pool=D,t.worker=q,t.workerEmit=X,Object.defineProperty(t,"__esModule",{value:!0})})(r.exports);var n=t(r.exports);const s=new Map([["centerX",Float64Array.BYTES_PER_ELEMENT],["centerY",Float64Array.BYTES_PER_ELEMENT],["centerZ",Float64Array.BYTES_PER_ELEMENT],["minHeight",Float32Array.BYTES_PER_ELEMENT],["maxHeight",Float32Array.BYTES_PER_ELEMENT],["boundingSphereCenterX",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterY",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterZ",Float64Array.BYTES_PER_ELEMENT],["boundingSphereRadius",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointX",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointY",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointZ",Float64Array.BYTES_PER_ELEMENT]]);function o(t){return t>>1^-(1&t)}function a(t,e,r,i,n=!0){let s;if(s=2===i?new Uint16Array(t,e,r):new Uint32Array(t,e,r),!n)return s;let o=0;for(let a=0;a<s.length;++a){let t=s[a];s[a]=o-t,0===t&&++o}return s}function h(t){return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}function u(t){return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}function c(t){const e=t.getUint32(0,!0);let r="";for(let i=0;i<e;++i)r+=String.fromCharCode(t.getUint8(Uint32Array.BYTES_PER_ELEMENT+i));return JSON.parse(r)}const l=1,d=2,m=3,f=4,p={maxDecodingStep:f};function y(t,e){const r=Object.assign({},p,e),i=new DataView(t),{header:n,headerEndPosition:y}=function(t){let e=0;const r={};for(let[i,n]of s){const s=8===n?t.getFloat64:t.getFloat32;r[i]=s.call(t,e,!0),e+=n}return{header:r,headerEndPosition:e}}(i);if(r.maxDecodingStep<l)return{header:n};const{vertexData:x,vertexDataEndPosition:g}=function(t,e){let r=e;const i=t.getUint32(r,!0),n=new Uint16Array(3*i);r+=Uint32Array.BYTES_PER_ELEMENT;const s=Uint16Array.BYTES_PER_ELEMENT,a=i*s,h=r,u=h+a,c=u+a;let l=0,d=0,m=0;for(let f=0;f<i;f++)l+=o(t.getUint16(h+s*f,!0)),d+=o(t.getUint16(u+s*f,!0)),m+=o(t.getUint16(c+s*f,!0)),n[f]=l,n[f+i]=d,n[f+2*i]=m;return r+=3*a,{vertexData:n,vertexDataEndPosition:r}}(i,y);if(r.maxDecodingStep<d)return{header:n,vertexData:x};const{triangleIndices:w,triangleIndicesEndPosition:b}=function(t,e,r){let i=r;const n=e.length/3>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT;i%n!==0&&(i+=n-i%n);const s=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;const o=3*s,h=a(t.buffer,i,o,n);return i+=o*n,{triangleIndicesEndPosition:i,triangleIndices:h}}(i,x,g);if(r.maxDecodingStep<m)return{header:n,vertexData:x,triangleIndices:w};const{westIndices:_,southIndices:v,eastIndices:M,northIndices:k,edgeIndicesEndPosition:E}=function(t,e,r){let i=r;const n=e.length/3>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT,s=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;const o=a(t.buffer,i,s,n,!1);i+=s*n;const h=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;const u=a(t.buffer,i,h,n,!1);i+=h*n;const c=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;const l=a(t.buffer,i,c,n,!1);i+=c*n;const d=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;const m=a(t.buffer,i,d,n,!1);return i+=d*n,{edgeIndicesEndPosition:i,westIndices:o,southIndices:u,eastIndices:l,northIndices:m}}(i,x,b);if(r.maxDecodingStep<f)return{header:n,vertexData:x,triangleIndices:w,westIndices:_,northIndices:k,eastIndices:M,southIndices:v};const{extensions:z}=function(t,e){const r={};if(t.byteLength<=e)return{extensions:r,extensionsEndPosition:e};let i=e;for(;i<t.byteLength;){const e=t.getUint8(i,!0);i+=Uint8Array.BYTES_PER_ELEMENT;const n=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;const s=new DataView(t.buffer,i,n);switch(e){case 1:r.vertexNormals=h(s);break;case 2:r.waterMask=u(s);break;case 4:r.metadata=c(s);break;default:console.warn(`Unknown extension with id ${e}`)}i+=n}return{extensions:r,extensionsEndPosition:i}}(i,E);return{header:n,vertexData:x,triangleIndices:w,westIndices:_,northIndices:k,eastIndices:M,southIndices:v,extensions:z}}
/**
	 * @license
	 * Copyright 2010-2025 Three.js Authors
	 * SPDX-License-Identifier: MIT
	 */const x=1001,g=2e3;class w{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const r=this._listeners;void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e)}hasEventListener(t,e){const r=this._listeners;return void 0!==r&&(void 0!==r[t]&&-1!==r[t].indexOf(e))}removeEventListener(t,e){const r=this._listeners;if(void 0===r)return;const i=r[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){const e=this._listeners;if(void 0===e)return;const r=e[t.type];if(void 0!==r){t.target=this;const e=r.slice(0);for(let r=0,i=e.length;r<i;r++)e[r].call(this,t);t.target=null}}}const b=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function _(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(b[255&t]+b[t>>8&255]+b[t>>16&255]+b[t>>24&255]+"-"+b[255&e]+b[e>>8&255]+"-"+b[e>>16&15|64]+b[e>>24&255]+"-"+b[63&r|128]+b[r>>8&255]+"-"+b[r>>16&255]+b[r>>24&255]+b[255&i]+b[i>>8&255]+b[i>>16&255]+b[i>>24&255]).toLowerCase()}function v(t,e,r){return Math.max(e,Math.min(r,t))}function M(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function k(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}const E=function(t,e,r){return(1-r)*t+r*e};class z{constructor(t=0,e=0){z.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,r=this.y,i=t.elements;return this.x=i[0]*e+i[3]*r+i[6],this.y=i[1]*e+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=v(this.x,t.x,e.x),this.y=v(this.y,t.y,e.y),this}clampScalar(t,e){return this.x=v(this.x,t,e),this.y=v(this.y,t,e),this}clampLength(t,e){const r=this.length();return this.divideScalar(r||1).multiplyScalar(v(r,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const r=this.dot(t)/e;return Math.acos(v(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,r=this.y-t.y;return e*e+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const r=Math.cos(e),i=Math.sin(e),n=this.x-t.x,s=this.y-t.y;return this.x=n*r-s*i+t.x,this.y=n*i+s*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class A{constructor(t=0,e=0,r=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=r,this._w=i}static slerpFlat(t,e,r,i,n,s,o){let a=r[i+0],h=r[i+1],u=r[i+2],c=r[i+3];const l=n[s+0],d=n[s+1],m=n[s+2],f=n[s+3];if(0===o)return t[e+0]=a,t[e+1]=h,t[e+2]=u,void(t[e+3]=c);if(1===o)return t[e+0]=l,t[e+1]=d,t[e+2]=m,void(t[e+3]=f);if(c!==f||a!==l||h!==d||u!==m){let t=1-o;const e=a*l+h*d+u*m+c*f,r=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const n=Math.sqrt(i),s=Math.atan2(n,e*r);t=Math.sin(t*s)/n,o=Math.sin(o*s)/n}const n=o*r;if(a=a*t+l*n,h=h*t+d*n,u=u*t+m*n,c=c*t+f*n,t===1-o){const t=1/Math.sqrt(a*a+h*h+u*u+c*c);a*=t,h*=t,u*=t,c*=t}}t[e]=a,t[e+1]=h,t[e+2]=u,t[e+3]=c}static multiplyQuaternionsFlat(t,e,r,i,n,s){const o=r[i],a=r[i+1],h=r[i+2],u=r[i+3],c=n[s],l=n[s+1],d=n[s+2],m=n[s+3];return t[e]=o*m+u*c+a*d-h*l,t[e+1]=a*m+u*l+h*c-o*d,t[e+2]=h*m+u*d+o*l-a*c,t[e+3]=u*m-o*c-a*l-h*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,r,i){return this._x=t,this._y=e,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const r=t._x,i=t._y,n=t._z,s=t._order,o=Math.cos,a=Math.sin,h=o(r/2),u=o(i/2),c=o(n/2),l=a(r/2),d=a(i/2),m=a(n/2);switch(s){case"XYZ":this._x=l*u*c+h*d*m,this._y=h*d*c-l*u*m,this._z=h*u*m+l*d*c,this._w=h*u*c-l*d*m;break;case"YXZ":this._x=l*u*c+h*d*m,this._y=h*d*c-l*u*m,this._z=h*u*m-l*d*c,this._w=h*u*c+l*d*m;break;case"ZXY":this._x=l*u*c-h*d*m,this._y=h*d*c+l*u*m,this._z=h*u*m+l*d*c,this._w=h*u*c-l*d*m;break;case"ZYX":this._x=l*u*c-h*d*m,this._y=h*d*c+l*u*m,this._z=h*u*m-l*d*c,this._w=h*u*c+l*d*m;break;case"YZX":this._x=l*u*c+h*d*m,this._y=h*d*c+l*u*m,this._z=h*u*m-l*d*c,this._w=h*u*c-l*d*m;break;case"XZY":this._x=l*u*c-h*d*m,this._y=h*d*c-l*u*m,this._z=h*u*m+l*d*c,this._w=h*u*c+l*d*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const r=e/2,i=Math.sin(r);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,r=e[0],i=e[4],n=e[8],s=e[1],o=e[5],a=e[9],h=e[2],u=e[6],c=e[10],l=r+o+c;if(l>0){const t=.5/Math.sqrt(l+1);this._w=.25/t,this._x=(u-a)*t,this._y=(n-h)*t,this._z=(s-i)*t}else if(r>o&&r>c){const t=2*Math.sqrt(1+r-o-c);this._w=(u-a)/t,this._x=.25*t,this._y=(i+s)/t,this._z=(n+h)/t}else if(o>c){const t=2*Math.sqrt(1+o-r-c);this._w=(n-h)/t,this._x=(i+s)/t,this._y=.25*t,this._z=(a+u)/t}else{const t=2*Math.sqrt(1+c-r-o);this._w=(s-i)/t,this._x=(n+h)/t,this._y=(a+u)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let r=t.dot(e)+1;return r<1e-8?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=r),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(v(this.dot(t),-1,1)))}rotateTowards(t,e){const r=this.angleTo(t);if(0===r)return this;const i=Math.min(1,e/r);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const r=t._x,i=t._y,n=t._z,s=t._w,o=e._x,a=e._y,h=e._z,u=e._w;return this._x=r*u+s*o+i*h-n*a,this._y=i*u+s*a+n*o-r*h,this._z=n*u+s*h+r*a-i*o,this._w=s*u-r*o-i*a-n*h,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const r=this._x,i=this._y,n=this._z,s=this._w;let o=s*t._w+r*t._x+i*t._y+n*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=r,this._y=i,this._z=n,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*r+e*this._x,this._y=t*i+e*this._y,this._z=t*n+e*this._z,this.normalize(),this}const h=Math.sqrt(a),u=Math.atan2(h,o),c=Math.sin((1-e)*u)/h,l=Math.sin(e*u)/h;return this._w=s*c+this._w*l,this._x=r*c+this._x*l,this._y=i*c+this._y*l,this._z=n*c+this._z*l,this._onChangeCallback(),this}slerpQuaternions(t,e,r){return this.copy(t).slerp(e,r)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),n=Math.sqrt(r);return this.set(i*Math.sin(t),i*Math.cos(t),n*Math.sin(e),n*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class S{constructor(t=0,e=0,r=0){S.prototype.isVector3=!0,this.x=t,this.y=e,this.z=r}set(t,e,r){return void 0===r&&(r=this.z),this.x=t,this.y=e,this.z=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(O.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(O.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,r=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[3]*r+n[6]*i,this.y=n[1]*e+n[4]*r+n[7]*i,this.z=n[2]*e+n[5]*r+n[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,r=this.y,i=this.z,n=t.elements,s=1/(n[3]*e+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*e+n[4]*r+n[8]*i+n[12])*s,this.y=(n[1]*e+n[5]*r+n[9]*i+n[13])*s,this.z=(n[2]*e+n[6]*r+n[10]*i+n[14])*s,this}applyQuaternion(t){const e=this.x,r=this.y,i=this.z,n=t.x,s=t.y,o=t.z,a=t.w,h=2*(s*i-o*r),u=2*(o*e-n*i),c=2*(n*r-s*e);return this.x=e+a*h+s*c-o*u,this.y=r+a*u+o*h-n*c,this.z=i+a*c+n*u-s*h,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,r=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[4]*r+n[8]*i,this.y=n[1]*e+n[5]*r+n[9]*i,this.z=n[2]*e+n[6]*r+n[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=v(this.x,t.x,e.x),this.y=v(this.y,t.y,e.y),this.z=v(this.z,t.z,e.z),this}clampScalar(t,e){return this.x=v(this.x,t,e),this.y=v(this.y,t,e),this.z=v(this.z,t,e),this}clampLength(t,e){const r=this.length();return this.divideScalar(r||1).multiplyScalar(v(r,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this.z=t.z+(e.z-t.z)*r,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const r=t.x,i=t.y,n=t.z,s=e.x,o=e.y,a=e.z;return this.x=i*a-n*o,this.y=n*s-r*a,this.z=r*o-i*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const r=t.dot(this)/e;return this.copy(t).multiplyScalar(r)}projectOnPlane(t){return T.copy(this).projectOnVector(t),this.sub(T)}reflect(t){return this.sub(T.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const r=this.dot(t)/e;return Math.acos(v(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,r=this.y-t.y,i=this.z-t.z;return e*e+r*r+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,r){const i=Math.sin(e)*t;return this.x=i*Math.sin(r),this.y=Math.cos(e)*t,this.z=i*Math.cos(r),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,r){return this.x=t*Math.sin(e),this.y=r,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=r,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,r=Math.sqrt(1-e*e);return this.x=r*Math.cos(t),this.y=e,this.z=r*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const T=new S,O=new A;class B{constructor(t,e,r,i,n,s,o,a,h){B.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,r,i,n,s,o,a,h)}set(t,e,r,i,n,s,o,a,h){const u=this.elements;return u[0]=t,u[1]=i,u[2]=o,u[3]=e,u[4]=n,u[5]=a,u[6]=r,u[7]=s,u[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this}extractBasis(t,e,r){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const r=t.elements,i=e.elements,n=this.elements,s=r[0],o=r[3],a=r[6],h=r[1],u=r[4],c=r[7],l=r[2],d=r[5],m=r[8],f=i[0],p=i[3],y=i[6],x=i[1],g=i[4],w=i[7],b=i[2],_=i[5],v=i[8];return n[0]=s*f+o*x+a*b,n[3]=s*p+o*g+a*_,n[6]=s*y+o*w+a*v,n[1]=h*f+u*x+c*b,n[4]=h*p+u*g+c*_,n[7]=h*y+u*w+c*v,n[2]=l*f+d*x+m*b,n[5]=l*p+d*g+m*_,n[8]=l*y+d*w+m*v,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],h=t[7],u=t[8];return e*s*u-e*o*h-r*n*u+r*o*a+i*n*h-i*s*a}invert(){const t=this.elements,e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],h=t[7],u=t[8],c=u*s-o*h,l=o*a-u*n,d=h*n-s*a,m=e*c+r*l+i*d;if(0===m)return this.set(0,0,0,0,0,0,0,0,0);const f=1/m;return t[0]=c*f,t[1]=(i*h-u*r)*f,t[2]=(o*r-i*s)*f,t[3]=l*f,t[4]=(u*e-i*a)*f,t[5]=(i*n-o*e)*f,t[6]=d*f,t[7]=(r*a-h*e)*f,t[8]=(s*e-r*n)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,r,i,n,s,o){const a=Math.cos(n),h=Math.sin(n);return this.set(r*a,r*h,-r*(a*s+h*o)+s+t,-i*h,i*a,-i*(-h*s+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(P.makeScale(t,e)),this}rotate(t){return this.premultiply(P.makeRotation(-t)),this}translate(t,e){return this.premultiply(P.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,r,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,r=t.elements;for(let i=0;i<9;i++)if(e[i]!==r[i])return!1;return!0}fromArray(t,e=0){for(let r=0;r<9;r++)this.elements[r]=t[r+e];return this}toArray(t=[],e=0){const r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const P=new B;function N(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function R(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}let F;class U{static getDataURL(t,e="image/png"){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let r;if(t instanceof HTMLCanvasElement)r=t;else{void 0===F&&(F=N("canvas")),F.width=t.width,F.height=t.height;const e=F.getContext("2d");t instanceof ImageData?e.putImageData(t,0,0):e.drawImage(t,0,0,t.width,t.height),r=F}return r.toDataURL(e)}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=N("canvas");e.width=t.width,e.height=t.height;const r=e.getContext("2d");r.drawImage(t,0,0,t.width,t.height);const i=r.getImageData(0,0,t.width,t.height),n=i.data;for(let t=0;t<n.length;t++)n[t]=255*R(n[t]/255);return r.putImageData(i,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*R(e[t]/255)):e[t]=R(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let C=0;class I{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:C++}),this.uuid=_(),this.data=t,this.dataReady=!0,this.version=0}getSize(t){const e=this.data;return"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement?t.set(e.videoWidth,e.videoHeight,0):e instanceof VideoFrame?t.set(e.displayHeight,e.displayWidth,0):null!==e?t.set(e.width,e.height,e.depth||0):t.set(0,0,0),t}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(null!==i){let t;if(Array.isArray(i)){t=[];for(let e=0,r=i.length;e<r;e++)i[e].isDataTexture?t.push(L(i[e].image)):t.push(L(i[e]))}else t=L(i);r.url=t}return e||(t.images[this.uuid]=r),r}}function L(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?U.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let W=0;const j=new S;class D extends w{constructor(t=D.DEFAULT_IMAGE,e=D.DEFAULT_MAPPING,r=1001,i=1001,n=1006,s=1008,o=1023,a=1009,h=D.DEFAULT_ANISOTROPY,u=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:W++}),this.uuid=_(),this.name="",this.source=new I(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=n,this.minFilter=s,this.anisotropy=h,this.format=o,this.internalFormat=null,this.type=a,this.offset=new z(0,0),this.repeat=new z(1,1),this.center=new z(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new B,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(t&&t.depth&&t.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(j).x}get height(){return this.source.getSize(j).y}get depth(){return this.source.getSize(j).z}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.isArrayTexture=t.isArrayTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}setValues(t){for(const e in t){const r=t[e];if(void 0===r){console.warn(`THREE.Texture.setValues(): parameter '${e}' has value of undefined.`);continue}const i=this[e];void 0!==i?i&&r&&i.isVector2&&r.isVector2||i&&r&&i.isVector3&&r.isVector3||i&&r&&i.isMatrix3&&r.isMatrix3?i.copy(r):this[e]=r:console.warn(`THREE.Texture.setValues(): property '${e}' does not exist.`)}}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const r={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),e||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case x:t.x=t.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case x:t.y=t.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}}D.DEFAULT_IMAGE=null,D.DEFAULT_MAPPING=300,D.DEFAULT_ANISOTROPY=1;class V{constructor(t=new S(1/0,1/0,1/0),e=new S(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,r=t.length;e<r;e+=3)this.expandByPoint(Y.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,r=t.count;e<r;e++)this.expandByPoint(Y.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const r=Y.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const r=t.geometry;if(void 0!==r){const i=r.getAttribute("position");if(!0===e&&void 0!==i&&!0!==t.isInstancedMesh)for(let e=0,r=i.count;e<r;e++)!0===t.isMesh?t.getVertexPosition(e,Y):Y.fromBufferAttribute(i,e),Y.applyMatrix4(t.matrixWorld),this.expandByPoint(Y);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),X.copy(t.boundingBox)):(null===r.boundingBox&&r.computeBoundingBox(),X.copy(r.boundingBox)),X.applyMatrix4(t.matrixWorld),this.union(X)}const i=t.children;for(let n=0,s=i.length;n<s;n++)this.expandByObject(i[n],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,Y),Y.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,r;return t.normal.x>0?(e=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),e<=-t.constant&&r>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(K),tt.subVectors(this.max,K),H.subVectors(t.a,K),Z.subVectors(t.b,K),J.subVectors(t.c,K),G.subVectors(Z,H),Q.subVectors(J,Z),$.subVectors(H,J);let e=[0,-G.z,G.y,0,-Q.z,Q.y,0,-$.z,$.y,G.z,0,-G.x,Q.z,0,-Q.x,$.z,0,-$.x,-G.y,G.x,0,-Q.y,Q.x,0,-$.y,$.x,0];return!!it(e,H,Z,J,tt)&&(e=[1,0,0,0,1,0,0,0,1],!!it(e,H,Z,J,tt)&&(et.crossVectors(G,Q),e=[et.x,et.y,et.z],it(e,H,Z,J,tt)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Y).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(Y).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(q[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),q[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),q[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),q[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),q[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),q[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),q[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),q[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(q)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(t){return this.min.fromArray(t.min),this.max.fromArray(t.max),this}}const q=[new S,new S,new S,new S,new S,new S,new S,new S],Y=new S,X=new V,H=new S,Z=new S,J=new S,G=new S,Q=new S,$=new S,K=new S,tt=new S,et=new S,rt=new S;function it(t,e,r,i,n){for(let s=0,o=t.length-3;s<=o;s+=3){rt.fromArray(t,s);const o=n.x*Math.abs(rt.x)+n.y*Math.abs(rt.y)+n.z*Math.abs(rt.z),a=e.dot(rt),h=r.dot(rt),u=i.dot(rt);if(Math.max(-Math.max(a,h,u),Math.min(a,h,u))>o)return!1}return!0}const nt=new V,st=new S,ot=new S;class at{constructor(t=new S,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const r=this.center;void 0!==e?r.copy(e):nt.setFromPoints(t).getCenter(r);let i=0;for(let n=0,s=t.length;n<s;n++)i=Math.max(i,r.distanceToSquared(t[n]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const r=this.center.distanceToSquared(t);return e.copy(t),r>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;st.subVectors(t,this.center);const e=st.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),r=.5*(t-this.radius);this.center.addScaledVector(st,r/t),this.radius+=r}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(ot.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(st.copy(t.center).add(ot)),this.expandByPoint(st.copy(t.center).sub(ot))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(t){return this.radius=t.radius,this.center.fromArray(t.center),this}}class ht{constructor(t,e,r,i,n,s,o,a,h,u,c,l,d,m,f,p){ht.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,r,i,n,s,o,a,h,u,c,l,d,m,f,p)}set(t,e,r,i,n,s,o,a,h,u,c,l,d,m,f,p){const y=this.elements;return y[0]=t,y[4]=e,y[8]=r,y[12]=i,y[1]=n,y[5]=s,y[9]=o,y[13]=a,y[2]=h,y[6]=u,y[10]=c,y[14]=l,y[3]=d,y[7]=m,y[11]=f,y[15]=p,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ht).fromArray(this.elements)}copy(t){const e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this}copyPosition(t){const e=this.elements,r=t.elements;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,r){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,r=t.elements,i=1/ut.setFromMatrixColumn(t,0).length(),n=1/ut.setFromMatrixColumn(t,1).length(),s=1/ut.setFromMatrixColumn(t,2).length();return e[0]=r[0]*i,e[1]=r[1]*i,e[2]=r[2]*i,e[3]=0,e[4]=r[4]*n,e[5]=r[5]*n,e[6]=r[6]*n,e[7]=0,e[8]=r[8]*s,e[9]=r[9]*s,e[10]=r[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,r=t.x,i=t.y,n=t.z,s=Math.cos(r),o=Math.sin(r),a=Math.cos(i),h=Math.sin(i),u=Math.cos(n),c=Math.sin(n);if("XYZ"===t.order){const t=s*u,r=s*c,i=o*u,n=o*c;e[0]=a*u,e[4]=-a*c,e[8]=h,e[1]=r+i*h,e[5]=t-n*h,e[9]=-o*a,e[2]=n-t*h,e[6]=i+r*h,e[10]=s*a}else if("YXZ"===t.order){const t=a*u,r=a*c,i=h*u,n=h*c;e[0]=t+n*o,e[4]=i*o-r,e[8]=s*h,e[1]=s*c,e[5]=s*u,e[9]=-o,e[2]=r*o-i,e[6]=n+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*u,r=a*c,i=h*u,n=h*c;e[0]=t-n*o,e[4]=-s*c,e[8]=i+r*o,e[1]=r+i*o,e[5]=s*u,e[9]=n-t*o,e[2]=-s*h,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*u,r=s*c,i=o*u,n=o*c;e[0]=a*u,e[4]=i*h-r,e[8]=t*h+n,e[1]=a*c,e[5]=n*h+t,e[9]=r*h-i,e[2]=-h,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,r=s*h,i=o*a,n=o*h;e[0]=a*u,e[4]=n-t*c,e[8]=i*c+r,e[1]=c,e[5]=s*u,e[9]=-o*u,e[2]=-h*u,e[6]=r*c+i,e[10]=t-n*c}else if("XZY"===t.order){const t=s*a,r=s*h,i=o*a,n=o*h;e[0]=a*u,e[4]=-c,e[8]=h*u,e[1]=t*c+n,e[5]=s*u,e[9]=r*c-i,e[2]=i*c-r,e[6]=o*u,e[10]=n*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(lt,t,dt)}lookAt(t,e,r){const i=this.elements;return pt.subVectors(t,e),0===pt.lengthSq()&&(pt.z=1),pt.normalize(),mt.crossVectors(r,pt),0===mt.lengthSq()&&(1===Math.abs(r.z)?pt.x+=1e-4:pt.z+=1e-4,pt.normalize(),mt.crossVectors(r,pt)),mt.normalize(),ft.crossVectors(pt,mt),i[0]=mt.x,i[4]=ft.x,i[8]=pt.x,i[1]=mt.y,i[5]=ft.y,i[9]=pt.y,i[2]=mt.z,i[6]=ft.z,i[10]=pt.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const r=t.elements,i=e.elements,n=this.elements,s=r[0],o=r[4],a=r[8],h=r[12],u=r[1],c=r[5],l=r[9],d=r[13],m=r[2],f=r[6],p=r[10],y=r[14],x=r[3],g=r[7],w=r[11],b=r[15],_=i[0],v=i[4],M=i[8],k=i[12],E=i[1],z=i[5],A=i[9],S=i[13],T=i[2],O=i[6],B=i[10],P=i[14],N=i[3],R=i[7],F=i[11],U=i[15];return n[0]=s*_+o*E+a*T+h*N,n[4]=s*v+o*z+a*O+h*R,n[8]=s*M+o*A+a*B+h*F,n[12]=s*k+o*S+a*P+h*U,n[1]=u*_+c*E+l*T+d*N,n[5]=u*v+c*z+l*O+d*R,n[9]=u*M+c*A+l*B+d*F,n[13]=u*k+c*S+l*P+d*U,n[2]=m*_+f*E+p*T+y*N,n[6]=m*v+f*z+p*O+y*R,n[10]=m*M+f*A+p*B+y*F,n[14]=m*k+f*S+p*P+y*U,n[3]=x*_+g*E+w*T+b*N,n[7]=x*v+g*z+w*O+b*R,n[11]=x*M+g*A+w*B+b*F,n[15]=x*k+g*S+w*P+b*U,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],r=t[4],i=t[8],n=t[12],s=t[1],o=t[5],a=t[9],h=t[13],u=t[2],c=t[6],l=t[10],d=t[14];return t[3]*(+n*a*c-i*h*c-n*o*l+r*h*l+i*o*d-r*a*d)+t[7]*(+e*a*d-e*h*l+n*s*l-i*s*d+i*h*u-n*a*u)+t[11]*(+e*h*c-e*o*d-n*s*c+r*s*d+n*o*u-r*h*u)+t[15]*(-i*o*u-e*a*c+e*o*l+i*s*c-r*s*l+r*a*u)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,r){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=r),this}invert(){const t=this.elements,e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],h=t[7],u=t[8],c=t[9],l=t[10],d=t[11],m=t[12],f=t[13],p=t[14],y=t[15],x=c*p*h-f*l*h+f*a*d-o*p*d-c*a*y+o*l*y,g=m*l*h-u*p*h-m*a*d+s*p*d+u*a*y-s*l*y,w=u*f*h-m*c*h+m*o*d-s*f*d-u*o*y+s*c*y,b=m*c*a-u*f*a-m*o*l+s*f*l+u*o*p-s*c*p,_=e*x+r*g+i*w+n*b;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const v=1/_;return t[0]=x*v,t[1]=(f*l*n-c*p*n-f*i*d+r*p*d+c*i*y-r*l*y)*v,t[2]=(o*p*n-f*a*n+f*i*h-r*p*h-o*i*y+r*a*y)*v,t[3]=(c*a*n-o*l*n-c*i*h+r*l*h+o*i*d-r*a*d)*v,t[4]=g*v,t[5]=(u*p*n-m*l*n+m*i*d-e*p*d-u*i*y+e*l*y)*v,t[6]=(m*a*n-s*p*n-m*i*h+e*p*h+s*i*y-e*a*y)*v,t[7]=(s*l*n-u*a*n+u*i*h-e*l*h-s*i*d+e*a*d)*v,t[8]=w*v,t[9]=(m*c*n-u*f*n-m*r*d+e*f*d+u*r*y-e*c*y)*v,t[10]=(s*f*n-m*o*n+m*r*h-e*f*h-s*r*y+e*o*y)*v,t[11]=(u*o*n-s*c*n-u*r*h+e*c*h+s*r*d-e*o*d)*v,t[12]=b*v,t[13]=(u*f*i-m*c*i+m*r*l-e*f*l-u*r*p+e*c*p)*v,t[14]=(m*o*i-s*f*i-m*r*a+e*f*a+s*r*p-e*o*p)*v,t[15]=(s*c*i-u*o*i+u*r*a-e*c*a-s*r*l+e*o*l)*v,this}scale(t){const e=this.elements,r=t.x,i=t.y,n=t.z;return e[0]*=r,e[4]*=i,e[8]*=n,e[1]*=r,e[5]*=i,e[9]*=n,e[2]*=r,e[6]*=i,e[10]*=n,e[3]*=r,e[7]*=i,e[11]*=n,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,r,i))}makeTranslation(t,e,r){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),r=Math.sin(t);return this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const r=Math.cos(e),i=Math.sin(e),n=1-r,s=t.x,o=t.y,a=t.z,h=n*s,u=n*o;return this.set(h*s+r,h*o-i*a,h*a+i*o,0,h*o+i*a,u*o+r,u*a-i*s,0,h*a-i*o,u*a+i*s,n*a*a+r,0,0,0,0,1),this}makeScale(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this}makeShear(t,e,r,i,n,s){return this.set(1,r,n,0,t,1,s,0,e,i,1,0,0,0,0,1),this}compose(t,e,r){const i=this.elements,n=e._x,s=e._y,o=e._z,a=e._w,h=n+n,u=s+s,c=o+o,l=n*h,d=n*u,m=n*c,f=s*u,p=s*c,y=o*c,x=a*h,g=a*u,w=a*c,b=r.x,_=r.y,v=r.z;return i[0]=(1-(f+y))*b,i[1]=(d+w)*b,i[2]=(m-g)*b,i[3]=0,i[4]=(d-w)*_,i[5]=(1-(l+y))*_,i[6]=(p+x)*_,i[7]=0,i[8]=(m+g)*v,i[9]=(p-x)*v,i[10]=(1-(l+f))*v,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,r){const i=this.elements;let n=ut.set(i[0],i[1],i[2]).length();const s=ut.set(i[4],i[5],i[6]).length(),o=ut.set(i[8],i[9],i[10]).length();this.determinant()<0&&(n=-n),t.x=i[12],t.y=i[13],t.z=i[14],ct.copy(this);const a=1/n,h=1/s,u=1/o;return ct.elements[0]*=a,ct.elements[1]*=a,ct.elements[2]*=a,ct.elements[4]*=h,ct.elements[5]*=h,ct.elements[6]*=h,ct.elements[8]*=u,ct.elements[9]*=u,ct.elements[10]*=u,e.setFromRotationMatrix(ct),r.x=n,r.y=s,r.z=o,this}makePerspective(t,e,r,i,n,s,o=2e3,a=!1){const h=this.elements,u=2*n/(e-t),c=2*n/(r-i),l=(e+t)/(e-t),d=(r+i)/(r-i);let m,f;if(a)m=n/(s-n),f=s*n/(s-n);else if(o===g)m=-(s+n)/(s-n),f=-2*s*n/(s-n);else{if(2001!==o)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);m=-s/(s-n),f=-s*n/(s-n)}return h[0]=u,h[4]=0,h[8]=l,h[12]=0,h[1]=0,h[5]=c,h[9]=d,h[13]=0,h[2]=0,h[6]=0,h[10]=m,h[14]=f,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}makeOrthographic(t,e,r,i,n,s,o=2e3,a=!1){const h=this.elements,u=2/(e-t),c=2/(r-i),l=-(e+t)/(e-t),d=-(r+i)/(r-i);let m,f;if(a)m=1/(s-n),f=s/(s-n);else if(o===g)m=-2/(s-n),f=-(s+n)/(s-n);else{if(2001!==o)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);m=-1/(s-n),f=-n/(s-n)}return h[0]=u,h[4]=0,h[8]=0,h[12]=l,h[1]=0,h[5]=c,h[9]=0,h[13]=d,h[2]=0,h[6]=0,h[10]=m,h[14]=f,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}equals(t){const e=this.elements,r=t.elements;for(let i=0;i<16;i++)if(e[i]!==r[i])return!1;return!0}fromArray(t,e=0){for(let r=0;r<16;r++)this.elements[r]=t[r+e];return this}toArray(t=[],e=0){const r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}}const ut=new S,ct=new ht,lt=new S(0,0,0),dt=new S(1,1,1),mt=new S,ft=new S,pt=new S,yt=new ht,xt=new A;class gt{constructor(t=0,e=0,r=0,i=gt.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=r,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,r,i=this._order){return this._x=t,this._y=e,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,r=!0){const i=t.elements,n=i[0],s=i[4],o=i[8],a=i[1],h=i[5],u=i[9],c=i[2],l=i[6],d=i[10];switch(e){case"XYZ":this._y=Math.asin(v(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-s,n)):(this._x=Math.atan2(l,h),this._z=0);break;case"YXZ":this._x=Math.asin(-v(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,h)):(this._y=Math.atan2(-c,n),this._z=0);break;case"ZXY":this._x=Math.asin(v(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-s,h)):(this._y=0,this._z=Math.atan2(a,n));break;case"ZYX":this._y=Math.asin(-v(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(l,d),this._z=Math.atan2(a,n)):(this._x=0,this._z=Math.atan2(-s,h));break;case"YZX":this._z=Math.asin(v(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,h),this._y=Math.atan2(-c,n)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-v(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(l,h),this._y=Math.atan2(o,n)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===r&&this._onChangeCallback(),this}setFromQuaternion(t,e,r){return yt.makeRotationFromQuaternion(t),this.setFromRotationMatrix(yt,e,r)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return xt.setFromEuler(this),this.setFromQuaternion(xt,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}gt.DEFAULT_ORDER="XYZ";class wt{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return 0!==(this.mask&t.mask)}isEnabled(t){return!!(this.mask&1<<t)}}let bt=0;const _t=new S,vt=new A,Mt=new ht,kt=new S,Et=new S,zt=new S,At=new A,St=new S(1,0,0),Tt=new S(0,1,0),Ot=new S(0,0,1),Bt={type:"added"},Pt={type:"removed"},Nt={type:"childadded",child:null},Rt={type:"childremoved",child:null};class Ft extends w{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:bt++}),this.uuid=_(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ft.DEFAULT_UP.clone();const t=new S,e=new gt,r=new A,i=new S(1,1,1);e._onChange(function(){r.setFromEuler(e,!1)}),r._onChange(function(){e.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new ht},normalMatrix:{value:new B}}),this.matrix=new ht,this.matrixWorld=new ht,this.matrixAutoUpdate=Ft.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Ft.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new wt,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return vt.setFromAxisAngle(t,e),this.quaternion.multiply(vt),this}rotateOnWorldAxis(t,e){return vt.setFromAxisAngle(t,e),this.quaternion.premultiply(vt),this}rotateX(t){return this.rotateOnAxis(St,t)}rotateY(t){return this.rotateOnAxis(Tt,t)}rotateZ(t){return this.rotateOnAxis(Ot,t)}translateOnAxis(t,e){return _t.copy(t).applyQuaternion(this.quaternion),this.position.add(_t.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(St,t)}translateY(t){return this.translateOnAxis(Tt,t)}translateZ(t){return this.translateOnAxis(Ot,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Mt.copy(this.matrixWorld).invert())}lookAt(t,e,r){t.isVector3?kt.copy(t):kt.set(t,e,r);const i=this.parent;this.updateWorldMatrix(!0,!1),Et.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Mt.lookAt(Et,kt,this.up):Mt.lookAt(kt,Et,this.up),this.quaternion.setFromRotationMatrix(Mt),i&&(Mt.extractRotation(i.matrixWorld),vt.setFromRotationMatrix(Mt),this.quaternion.premultiply(vt.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(Bt),Nt.child=t,this.dispatchEvent(Nt),Nt.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Pt),Rt.child=t,this.dispatchEvent(Rt),Rt.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Mt.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Mt.multiply(t.parent.matrixWorld)),t.applyMatrix4(Mt),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(Bt),Nt.child=t,this.dispatchEvent(Nt),Nt.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let r=0,i=this.children.length;r<i;r++){const i=this.children[r].getObjectByProperty(t,e);if(void 0!==i)return i}}getObjectsByProperty(t,e,r=[]){this[t]===e&&r.push(this);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].getObjectsByProperty(t,e,r);return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Et,t,zt),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Et,At,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let r=0,i=e.length;r<i;r++)e[r].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let r=0,i=e.length;r<i;r++)e[r].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let r=0,i=e.length;r<i;r++){e[r].updateMatrixWorld(t)}}updateWorldMatrix(t,e){const r=this.parent;if(!0===t&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===e){const t=this.children;for(let e=0,r=t.length;e<r;e++){t[e].updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"==typeof t,r={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const i={};function n(e,r){return void 0===e[r.uuid]&&(e[r.uuid]=r.toJSON(t)),r.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(t=>({...t,boundingBox:t.boundingBox?t.boundingBox.toJSON():void 0,boundingSphere:t.boundingSphere?t.boundingSphere.toJSON():void 0})),i.instanceInfo=this._instanceInfo.map(t=>({...t})),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(t),i.indirectTexture=this._indirectTexture.toJSON(t),null!==this._colorsTexture&&(i.colorsTexture=this._colorsTexture.toJSON(t)),null!==this.boundingSphere&&(i.boundingSphere=this.boundingSphere.toJSON()),null!==this.boundingBox&&(i.boundingBox=this.boundingBox.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=n(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const r=e.shapes;if(Array.isArray(r))for(let e=0,i=r.length;e<i;e++){const i=r[e];n(t.shapes,i)}else n(t.shapes,r)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(n(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let r=0,i=this.material.length;r<i;r++)e.push(n(t.materials,this.material[r]));i.material=e}else i.material=n(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let e=0;e<this.animations.length;e++){const r=this.animations[e];i.animations.push(n(t.animations,r))}}if(e){const e=s(t.geometries),i=s(t.materials),n=s(t.textures),o=s(t.images),a=s(t.shapes),h=s(t.skeletons),u=s(t.animations),c=s(t.nodes);e.length>0&&(r.geometries=e),i.length>0&&(r.materials=i),n.length>0&&(r.textures=n),o.length>0&&(r.images=o),a.length>0&&(r.shapes=a),h.length>0&&(r.skeletons=h),u.length>0&&(r.animations=u),c.length>0&&(r.nodes=c)}return r.object=i,r;function s(t){const e=[];for(const r in t){const i=t[r];delete i.metadata,e.push(i)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let r=0;r<t.children.length;r++){const e=t.children[r];this.add(e.clone())}return this}}Ft.DEFAULT_UP=new S(0,1,0),Ft.DEFAULT_MATRIX_AUTO_UPDATE=!0,Ft.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Ut=new S,Ct=new z;let It=0;class Lt{constructor(t,e,r=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:It++}),this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=r,this.usage=35044,this.updateRanges=[],this.gpuType=1015,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,r){t*=this.itemSize,r*=e.itemSize;for(let i=0,n=this.itemSize;i<n;i++)this.array[t+i]=e.array[r+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,r=this.count;e<r;e++)Ct.fromBufferAttribute(this,e),Ct.applyMatrix3(t),this.setXY(e,Ct.x,Ct.y);else if(3===this.itemSize)for(let e=0,r=this.count;e<r;e++)Ut.fromBufferAttribute(this,e),Ut.applyMatrix3(t),this.setXYZ(e,Ut.x,Ut.y,Ut.z);return this}applyMatrix4(t){for(let e=0,r=this.count;e<r;e++)Ut.fromBufferAttribute(this,e),Ut.applyMatrix4(t),this.setXYZ(e,Ut.x,Ut.y,Ut.z);return this}applyNormalMatrix(t){for(let e=0,r=this.count;e<r;e++)Ut.fromBufferAttribute(this,e),Ut.applyNormalMatrix(t),this.setXYZ(e,Ut.x,Ut.y,Ut.z);return this}transformDirection(t){for(let e=0,r=this.count;e<r;e++)Ut.fromBufferAttribute(this,e),Ut.transformDirection(t),this.setXYZ(e,Ut.x,Ut.y,Ut.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let r=this.array[t*this.itemSize+e];return this.normalized&&(r=M(r,this.array)),r}setComponent(t,e,r){return this.normalized&&(r=k(r,this.array)),this.array[t*this.itemSize+e]=r,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=M(e,this.array)),e}setX(t,e){return this.normalized&&(e=k(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=M(e,this.array)),e}setY(t,e){return this.normalized&&(e=k(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=M(e,this.array)),e}setZ(t,e){return this.normalized&&(e=k(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=M(e,this.array)),e}setW(t,e){return this.normalized&&(e=k(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,r){return t*=this.itemSize,this.normalized&&(e=k(e,this.array),r=k(r,this.array)),this.array[t+0]=e,this.array[t+1]=r,this}setXYZ(t,e,r,i){return t*=this.itemSize,this.normalized&&(e=k(e,this.array),r=k(r,this.array),i=k(i,this.array)),this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=i,this}setXYZW(t,e,r,i,n){return t*=this.itemSize,this.normalized&&(e=k(e,this.array),r=k(r,this.array),i=k(i,this.array),n=k(n,this.array)),this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=i,this.array[t+3]=n,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),35044!==this.usage&&(t.usage=this.usage),t}}class Wt extends Lt{constructor(t,e,r){super(new Uint16Array(t),e,r)}}class jt extends Lt{constructor(t,e,r){super(new Uint32Array(t),e,r)}}class Dt extends Lt{constructor(t,e,r){super(new Float32Array(t),e,r)}}let Vt=0;const qt=new ht,Yt=new Ft,Xt=new S,Ht=new V,Zt=new V,Jt=new S;class Gt extends w{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Vt++}),this.uuid=_(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(function(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}(t)?jt:Wt)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,r=0){this.groups.push({start:t,count:e,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const r=this.attributes.normal;if(void 0!==r){const e=(new B).getNormalMatrix(t);r.applyNormalMatrix(e),r.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return qt.makeRotationFromQuaternion(t),this.applyMatrix4(qt),this}rotateX(t){return qt.makeRotationX(t),this.applyMatrix4(qt),this}rotateY(t){return qt.makeRotationY(t),this.applyMatrix4(qt),this}rotateZ(t){return qt.makeRotationZ(t),this.applyMatrix4(qt),this}translate(t,e,r){return qt.makeTranslation(t,e,r),this.applyMatrix4(qt),this}scale(t,e,r){return qt.makeScale(t,e,r),this.applyMatrix4(qt),this}lookAt(t){return Yt.lookAt(t),Yt.updateMatrix(),this.applyMatrix4(Yt.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Xt).negate(),this.translate(Xt.x,Xt.y,Xt.z),this}setFromPoints(t){const e=this.getAttribute("position");if(void 0===e){const e=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];e.push(i.x,i.y,i.z||0)}this.setAttribute("position",new Dt(e,3))}else{const r=Math.min(t.length,e.count);for(let i=0;i<r;i++){const r=t[i];e.setXYZ(i,r.x,r.y,r.z||0)}t.length>e.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new V);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new S(-1/0,-1/0,-1/0),new S(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let r=0,i=e.length;r<i;r++){const t=e[r];Ht.setFromBufferAttribute(t),this.morphTargetsRelative?(Jt.addVectors(this.boundingBox.min,Ht.min),this.boundingBox.expandByPoint(Jt),Jt.addVectors(this.boundingBox.max,Ht.max),this.boundingBox.expandByPoint(Jt)):(this.boundingBox.expandByPoint(Ht.min),this.boundingBox.expandByPoint(Ht.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new at);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new S,1/0);if(t){const r=this.boundingSphere.center;if(Ht.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const r=e[t];Zt.setFromBufferAttribute(r),this.morphTargetsRelative?(Jt.addVectors(Ht.min,Zt.min),Ht.expandByPoint(Jt),Jt.addVectors(Ht.max,Zt.max),Ht.expandByPoint(Jt)):(Ht.expandByPoint(Zt.min),Ht.expandByPoint(Zt.max))}Ht.getCenter(r);let i=0;for(let e=0,n=t.count;e<n;e++)Jt.fromBufferAttribute(t,e),i=Math.max(i,r.distanceToSquared(Jt));if(e)for(let n=0,s=e.length;n<s;n++){const s=e[n],o=this.morphTargetsRelative;for(let e=0,n=s.count;e<n;e++)Jt.fromBufferAttribute(s,e),o&&(Xt.fromBufferAttribute(t,e),Jt.add(Xt)),i=Math.max(i,r.distanceToSquared(Jt))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const r=e.position,i=e.normal,n=e.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Lt(new Float32Array(4*r.count),4));const s=this.getAttribute("tangent"),o=[],a=[];for(let M=0;M<r.count;M++)o[M]=new S,a[M]=new S;const h=new S,u=new S,c=new S,l=new z,d=new z,m=new z,f=new S,p=new S;function y(t,e,i){h.fromBufferAttribute(r,t),u.fromBufferAttribute(r,e),c.fromBufferAttribute(r,i),l.fromBufferAttribute(n,t),d.fromBufferAttribute(n,e),m.fromBufferAttribute(n,i),u.sub(h),c.sub(h),d.sub(l),m.sub(l);const s=1/(d.x*m.y-m.x*d.y);isFinite(s)&&(f.copy(u).multiplyScalar(m.y).addScaledVector(c,-d.y).multiplyScalar(s),p.copy(c).multiplyScalar(d.x).addScaledVector(u,-m.x).multiplyScalar(s),o[t].add(f),o[e].add(f),o[i].add(f),a[t].add(p),a[e].add(p),a[i].add(p))}let x=this.groups;0===x.length&&(x=[{start:0,count:t.count}]);for(let M=0,k=x.length;M<k;++M){const e=x[M],r=e.start;for(let i=r,n=r+e.count;i<n;i+=3)y(t.getX(i+0),t.getX(i+1),t.getX(i+2))}const g=new S,w=new S,b=new S,_=new S;function v(t){b.fromBufferAttribute(i,t),_.copy(b);const e=o[t];g.copy(e),g.sub(b.multiplyScalar(b.dot(e))).normalize(),w.crossVectors(_,e);const r=w.dot(a[t])<0?-1:1;s.setXYZW(t,g.x,g.y,g.z,r)}for(let M=0,k=x.length;M<k;++M){const e=x[M],r=e.start;for(let i=r,n=r+e.count;i<n;i+=3)v(t.getX(i+0)),v(t.getX(i+1)),v(t.getX(i+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let r=this.getAttribute("normal");if(void 0===r)r=new Lt(new Float32Array(3*e.count),3),this.setAttribute("normal",r);else for(let t=0,e=r.count;t<e;t++)r.setXYZ(t,0,0,0);const i=new S,n=new S,s=new S,o=new S,a=new S,h=new S,u=new S,c=new S;if(t)for(let l=0,d=t.count;l<d;l+=3){const d=t.getX(l+0),m=t.getX(l+1),f=t.getX(l+2);i.fromBufferAttribute(e,d),n.fromBufferAttribute(e,m),s.fromBufferAttribute(e,f),u.subVectors(s,n),c.subVectors(i,n),u.cross(c),o.fromBufferAttribute(r,d),a.fromBufferAttribute(r,m),h.fromBufferAttribute(r,f),o.add(u),a.add(u),h.add(u),r.setXYZ(d,o.x,o.y,o.z),r.setXYZ(m,a.x,a.y,a.z),r.setXYZ(f,h.x,h.y,h.z)}else for(let t=0,l=e.count;t<l;t+=3)i.fromBufferAttribute(e,t+0),n.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),u.subVectors(s,n),c.subVectors(i,n),u.cross(c),r.setXYZ(t+0,u.x,u.y,u.z),r.setXYZ(t+1,u.x,u.y,u.z),r.setXYZ(t+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,r=t.count;e<r;e++)Jt.fromBufferAttribute(t,e),Jt.normalize(),t.setXYZ(e,Jt.x,Jt.y,Jt.z)}toNonIndexed(){function t(t,e){const r=t.array,i=t.itemSize,n=t.normalized,s=new r.constructor(e.length*i);let o=0,a=0;for(let h=0,u=e.length;h<u;h++){o=t.isInterleavedBufferAttribute?e[h]*t.data.stride+t.offset:e[h]*i;for(let t=0;t<i;t++)s[a++]=r[o++]}return new Lt(s,i,n)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Gt,r=this.index.array,i=this.attributes;for(const o in i){const n=t(i[o],r);e.setAttribute(o,n)}const n=this.morphAttributes;for(const o in n){const i=[],s=n[o];for(let e=0,n=s.length;e<n;e++){const n=t(s[e],r);i.push(n)}e.morphAttributes[o]=i}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let o=0,a=s.length;o<a;o++){const t=s[o];e.addGroup(t.start,t.count,t.materialIndex)}return e}toJSON(){const t={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const r in e)void 0!==e[r]&&(t[r]=e[r]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const r=this.attributes;for(const a in r){const e=r[a];t.data.attributes[a]=e.toJSON(t.data)}const i={};let n=!1;for(const a in this.morphAttributes){const e=this.morphAttributes[a],r=[];for(let i=0,n=e.length;i<n;i++){const n=e[i];r.push(n.toJSON(t.data))}r.length>0&&(i[a]=r,n=!0)}n&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere=o.toJSON()),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const r=t.index;null!==r&&this.setIndex(r.clone());const i=t.attributes;for(const h in i){const t=i[h];this.setAttribute(h,t.clone(e))}const n=t.morphAttributes;for(const h in n){const t=[],r=n[h];for(let i=0,n=r.length;i<n;i++)t.push(r[i].clone(e));this.morphAttributes[h]=t}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let h=0,u=s.length;h<u;h++){const t=s[h];this.addGroup(t.start,t.count,t.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"180"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="180");function Qt(t,e){if(!t)throw new Error("Invariant failed")}const $t=new S;function Kt(t,e,r=new S,i){const{x:n,y:s,z:o}=t,a=e.x,h=e.y,u=e.z,c=n*n*a,l=s*s*h,d=o*o*u,m=c+l+d,f=Math.sqrt(1/m);if(!Number.isFinite(f))return;const p=$t.copy(t).multiplyScalar(f);if(m<((null==i?void 0:i.centerTolerance)??.1))return r.copy(p);const y=p.multiply(e).multiplyScalar(2);let x,g,w,b,_=(1-f)*t.length()/(y.length()/2),v=0;do{_-=v,x=1/(1+_*a),g=1/(1+_*h),w=1/(1+_*u);const t=x*x,e=g*g,r=w*w;b=c*t+l*e+d*r-1,v=b/(-2*(c*(t*x)*a+l*(e*g)*h+d*(r*w)*u))}while(Math.abs(b)>1e-12);return r.set(n*x,s*g,o*w)}const te=new S,ee=new S,re=new S,ie=class{constructor(t,e,r){this.radii=new S(t,e,r)}get minimumRadius(){return Math.min(this.radii.x,this.radii.y,this.radii.z)}get maximumRadius(){return Math.max(this.radii.x,this.radii.y,this.radii.z)}reciprocalRadii(t=new S){const{x:e,y:r,z:i}=this.radii;return t.set(1/e,1/r,1/i)}reciprocalRadiiSquared(t=new S){const{x:e,y:r,z:i}=this.radii;return t.set(1/e**2,1/r**2,1/i**2)}projectOnSurface(t,e=new S,r){return Kt(t,this.reciprocalRadiiSquared(),e,r)}getSurfaceNormal(t,e=new S){return e.multiplyVectors(this.reciprocalRadiiSquared(te),t).normalize()}getEastNorthUpVectors(t,e=new S,r=new S,i=new S){this.getSurfaceNormal(t,i),e.set(-t.y,t.x,0).normalize(),r.crossVectors(i,e).normalize()}getEastNorthUpFrame(t,e=new ht){const r=te,i=ee,n=re;return this.getEastNorthUpVectors(t,r,i,n),e.makeBasis(r,i,n).setPosition(t)}getNorthUpEastFrame(t,e=new ht){const r=te,i=ee,n=re;return this.getEastNorthUpVectors(t,r,i,n),e.makeBasis(i,n,r).setPosition(t)}getIntersection(t,e=new S){const r=this.reciprocalRadii(te),i=ee.copy(r).multiply(t.origin),n=re.copy(r).multiply(t.direction),s=i.lengthSq(),o=n.lengthSq(),a=i.dot(n),h=a**2-o*(s-1);if(1===s)return e.copy(t.origin);if(s>1){if(a>=0||h<0)return;const r=Math.sqrt(h),i=(-a-r)/o,n=(-a+r)/o;return t.at(Math.min(i,n),e)}if(s<1){const r=a**2-o*(s-1),i=(-a+Math.sqrt(r))/o;return t.at(i,e)}return a<0?t.at(-a/o,e):void 0}getOsculatingSphereCenter(t,e,r=new S){Qt(this.radii.x===this.radii.y);const i=this.radii.x**2,n=this.radii.z**2,s=te.set(t.x/i,t.y/i,t.z/n).normalize();return r.copy(s.multiplyScalar(-e).add(t))}getNormalAtHorizon(t,e,r=new S){Qt(this.radii.x===this.radii.y);const i=this.radii.x**2,n=this.radii.z**2,s=t,o=e;let a=(s.x*o.x+s.y*o.y)/i+s.z*o.z/n;a/=(s.x**2+s.y**2)/i+s.z**2/n;const h=te.copy(o).multiplyScalar(-a).add(t);return r.set(h.x/i,h.y/i,h.z/n).normalize()}};ie.WGS84=new ie(6378137,6378137,6356752.314245179);let ne=ie;const se=new S,oe=new S,ae=class t{constructor(t=0,e=0,r=0){this.longitude=t,this.latitude=e,this.height=r}set(t,e,r){return this.longitude=t,this.latitude=e,null!=r&&(this.height=r),this}clone(){return new t(this.longitude,this.latitude,this.height)}copy(t){return this.longitude=t.longitude,this.latitude=t.latitude,this.height=t.height,this}equals(t){return t.longitude===this.longitude&&t.latitude===this.latitude&&t.height===this.height}setLongitude(t){return this.longitude=t,this}setLatitude(t){return this.latitude=t,this}setHeight(t){return this.height=t,this}normalize(){return this.longitude<t.MIN_LONGITUDE&&(this.longitude+=2*Math.PI),this}setFromECEF(t,e){const r=((null==e?void 0:e.ellipsoid)??ne.WGS84).reciprocalRadiiSquared(se),i=Kt(t,r,oe,e);if(null==i)throw new Error(`Could not project position to ellipsoid surface: ${t.toArray()}`);const n=se.multiplyVectors(i,r).normalize();this.longitude=Math.atan2(n.y,n.x),this.latitude=Math.asin(n.z);const s=se.subVectors(t,i);return this.height=Math.sign(s.dot(t))*s.length(),this}toECEF(t=new S,e){const r=(null==e?void 0:e.ellipsoid)??ne.WGS84,i=se.multiplyVectors(r.radii,r.radii),n=Math.cos(this.latitude),s=oe.set(n*Math.cos(this.longitude),n*Math.sin(this.longitude),Math.sin(this.latitude)).normalize();return t.multiplyVectors(i,s),t.divideScalar(Math.sqrt(s.dot(t))).add(s.multiplyScalar(this.height))}fromArray(t,e=0){return this.longitude=t[e],this.latitude=t[e+1],this.height=t[e+2],this}toArray(t=[],e=0){return t[e]=this.longitude,t[e+1]=this.latitude,t[e+2]=this.height,t}*[Symbol.iterator](){yield this.longitude,yield this.latitude,yield this.height}};ae.MIN_LONGITUDE=-Math.PI,ae.MAX_LONGITUDE=Math.PI,ae.MIN_LATITUDE=-Math.PI/2,ae.MAX_LATITUDE=Math.PI/2;let he=ae;function ue(t){var e;const{attributes:r,index:i,boundingBox:n,boundingSphere:s}=t;return[{attributes:r,index:i,boundingBox:n,boundingSphere:s},[...Object.values(t.attributes).map(t=>t.array.buffer),null==(e=t.index)?void 0:e.array.buffer].filter(t=>null!=t)]}const ce="This constructor is not a subclass of Float16Array",le="The constructor property value is not an object",de="Attempting to access detached ArrayBuffer",me="Cannot convert undefined or null to object",fe="Cannot mix BigInt and other types, use explicit conversions",pe="@@iterator property is not callable",ye="Reduce of empty array with no initial value",xe="Offset is out of bounds";function ge(t){return(e,...r)=>be(t,e,r)}function we(t,e){return ge(ke(t,e).get)}const{apply:be,construct:_e,defineProperty:ve,get:Me,getOwnPropertyDescriptor:ke,getPrototypeOf:Ee,has:ze,ownKeys:Ae,set:Se,setPrototypeOf:Te}=Reflect,Oe=Proxy,{EPSILON:Be,MAX_SAFE_INTEGER:Pe,isFinite:Ne,isNaN:Re}=Number,{iterator:Fe,species:Ue,toStringTag:Ce,for:Ie}=Symbol,Le=Object,{create:We,defineProperty:je,freeze:De,is:Ve}=Le,qe=Le.prototype,Ye=qe.__lookupGetter__?ge(qe.__lookupGetter__):(t,e)=>{if(null==t)throw Cr(me);let r=Le(t);do{const t=ke(r,e);if(void 0!==t)return Xe(t,"get")?t.get:void 0}while(null!==(r=Ee(r)))},Xe=Le.hasOwn||ge(qe.hasOwnProperty),He=Array,Ze=He.isArray,Je=He.prototype,Ge=ge(Je.join),Qe=ge(Je.push),$e=ge(Je.toLocaleString),Ke=Je[Fe],tr=ge(Ke),{abs:er,trunc:rr}=Math,ir=ArrayBuffer,nr=ir.isView,sr=ir.prototype,or=ge(sr.slice),ar=we(sr,"byteLength"),hr=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null,ur=hr&&we(hr.prototype,"byteLength"),cr=Ee(Uint8Array),lr=cr.from,dr=cr.prototype,mr=dr[Fe],fr=ge(dr.keys),pr=ge(dr.values),yr=ge(dr.entries),xr=ge(dr.set),gr=ge(dr.reverse),wr=ge(dr.fill),br=ge(dr.copyWithin),_r=ge(dr.sort),vr=ge(dr.slice),Mr=ge(dr.subarray),kr=we(dr,"buffer"),Er=we(dr,"byteOffset"),zr=we(dr,"length"),Ar=we(dr,Ce),Sr=Uint8Array,Tr=Uint16Array,Or=(...t)=>be(lr,Tr,t),Br=Uint32Array,Pr=Float32Array,Nr=Ee([][Fe]()),Rr=ge(Nr.next),Fr=ge(function*(){}().next),Ur=Ee(Nr),Cr=TypeError,Ir=RangeError,Lr=WeakSet,Wr=Lr.prototype,jr=ge(Wr.add),Dr=ge(Wr.has),Vr=WeakMap,qr=Vr.prototype,Yr=ge(qr.get),Xr=ge(qr.has),Hr=ge(qr.set),Zr=new Vr,Jr=We(null,{next:{value:function(){const t=Yr(Zr,this);return Rr(t)}},[Fe]:{value:function(){return this}}});function Gr(t){if(t[Fe]===Ke&&Nr.next===Rr)return t;const e=We(Jr);return Hr(Zr,e,tr(t)),e}const Qr=new Vr,$r=We(Ur,{next:{value:function(){const t=Yr(Qr,this);return Fr(t)},writable:!0,configurable:!0}});for(const gn of Ae(Nr))"next"!==gn&&je($r,gn,ke(Nr,gn));function Kr(t){const e=We($r);return Hr(Qr,e,t),e}function ti(t){return null!==t&&"object"==typeof t||"function"==typeof t}function ei(t){return null!==t&&"object"==typeof t}function ri(t){return void 0!==Ar(t)}function ii(t){const e=Ar(t);return"BigInt64Array"===e||"BigUint64Array"===e}function ni(t){if(null===hr)return!1;try{return ur(t),!0}catch{return!1}}function si(t){return function(t){try{return!Ze(t)&&(ar(t),!0)}catch{return!1}}(t)||ni(t)}function oi(t){return!!Ze(t)&&(t[Fe]===Ke&&Nr.next===Rr)}function ai(t){if("string"!=typeof t)return!1;const e=+t;return!(t!==e+""||!Ne(e))&&e===rr(e)}const hi=Ie("__Float16Array__");const ui=1/Be;const ci=6103515625e-14,li=.0009765625,di=li*ci,mi=li*ui;function fi(t){const e=+t;if(!Ne(e)||0===e)return e;const r=e>0?1:-1,i=er(e);if(i<ci)return r*function(t){return t+ui-ui}(i/di)*di;const n=(1+mi)*i,s=n-(n-i);return s>65504||Re(s)?r*(1/0):r*s}const pi=new ir(4),yi=new Pr(pi),xi=new Br(pi),gi=new Tr(512),wi=new Sr(512);for(let gn=0;gn<256;++gn){const t=gn-127;t<-24?(gi[gn]=0,gi[256|gn]=32768,wi[gn]=24,wi[256|gn]=24):t<-14?(gi[gn]=1024>>-t-14,gi[256|gn]=1024>>-t-14|32768,wi[gn]=-t-1,wi[256|gn]=-t-1):t<=15?(gi[gn]=t+15<<10,gi[256|gn]=t+15<<10|32768,wi[gn]=13,wi[256|gn]=13):t<128?(gi[gn]=31744,gi[256|gn]=64512,wi[gn]=24,wi[256|gn]=24):(gi[gn]=31744,gi[256|gn]=64512,wi[gn]=13,wi[256|gn]=13)}function bi(t){yi[0]=fi(t);const e=xi[0],r=e>>23&511;return gi[r]+((8388607&e)>>wi[r])}const _i=new Br(2048);for(let gn=1;gn<1024;++gn){let t=gn<<13,e=0;for(;!(8388608&t);)t<<=1,e-=8388608;t&=-8388609,e+=947912704,_i[gn]=t|e}for(let gn=1024;gn<2048;++gn)_i[gn]=939524096+(gn-1024<<13);const vi=new Br(64);for(let gn=1;gn<31;++gn)vi[gn]=gn<<23;vi[31]=1199570944,vi[32]=2147483648;for(let gn=33;gn<63;++gn)vi[gn]=2147483648+(gn-32<<23);vi[63]=3347054592;const Mi=new Tr(64);for(let gn=1;gn<64;++gn)32!==gn&&(Mi[gn]=1024);function ki(t){const e=t>>10;return xi[0]=_i[Mi[e]+(1023&t)]+vi[e],yi[0]}function Ei(t){const e=+t;return Re(e)||0===e?0:rr(e)}function zi(t){const e=Ei(t);return e<0?0:e<Pe?e:Pe}function Ai(t,e){if(!ti(t))throw Cr("This is not an object");const r=t.constructor;if(void 0===r)return e;if(!ti(r))throw Cr(le);return r[Ue]??e}function Si(t){if(ni(t))return!1;try{return or(t,0,0),!1}catch{}return!0}function Ti(t,e){const r=Re(t),i=Re(e);if(r&&i)return 0;if(r)return 1;if(i||t<e)return-1;if(t>e)return 1;if(0===t&&0===e){const r=Ve(t,0),i=Ve(e,0);if(!r&&i)return-1;if(r&&!i)return 1}return 0}const Oi=new Vr;function Bi(t){return Xr(Oi,t)||!nr(t)&&function(t){if(!ei(t))return!1;const e=Ee(t);if(!ei(e))return!1;const r=e.constructor;if(void 0===r)return!1;if(!ti(r))throw Cr(le);return ze(r,hi)}(t)}function Pi(t){if(!Bi(t))throw Cr("This is not a Float16Array object")}function Ni(t,e){const r=Bi(t),i=ri(t);if(!r&&!i)throw Cr("Species constructor didn't return TypedArray object");if("number"==typeof e){let i;if(r){const e=Ri(t);i=zr(e)}else i=zr(t);if(i<e)throw Cr("Derived constructor created TypedArray object which was too small length")}if(ii(t))throw Cr(fe)}function Ri(t){const e=Yr(Oi,t);if(void 0!==e){if(Si(kr(e)))throw Cr(de);return e}const r=t.buffer;if(Si(r))throw Cr(de);const i=_e(Ii,[r,t.byteOffset,t.length],t.constructor);return Yr(Oi,i)}function Fi(t){const e=zr(t),r=[];for(let i=0;i<e;++i)r[i]=ki(t[i]);return r}const Ui=new Lr;for(const gn of Ae(dr)){if(gn===Ce)continue;const t=ke(dr,gn);Xe(t,"get")&&"function"==typeof t.get&&jr(Ui,t.get)}const Ci=De({get:(t,e,r)=>ai(e)&&Xe(t,e)?ki(Me(t,e)):Dr(Ui,Ye(t,e))?Me(t,e):Me(t,e,r),set:(t,e,r,i)=>ai(e)&&Xe(t,e)?Se(t,e,bi(r)):Se(t,e,r,i),getOwnPropertyDescriptor(t,e){if(ai(e)&&Xe(t,e)){const r=ke(t,e);return r.value=ki(r.value),r}return ke(t,e)},defineProperty:(t,e,r)=>(ai(e)&&Xe(t,e)&&Xe(r,"value")&&(r.value=bi(r.value)),ve(t,e,r))});class Ii{constructor(t,e,r){let i;if(Bi(t))i=_e(Tr,[Ri(t)],new.target);else if(ti(t)&&!si(t)){let e,r;if(ri(t)){e=t,r=zr(t);if(Si(kr(t)))throw Cr(de);if(ii(t))throw Cr(fe);const n=new ir(2*r);i=_e(Tr,[n],new.target)}else{const n=t[Fe];if(null!=n&&"function"!=typeof n)throw Cr(pe);null!=n?oi(t)?(e=t,r=t.length):(e=[...t],r=e.length):(e=t,r=zi(e.length)),i=_e(Tr,[r],new.target)}for(let t=0;t<r;++t)i[t]=bi(e[t])}else i=_e(Tr,arguments,new.target);const n=new Oe(i,Ci);return Hr(Oi,n,i),n}static from(t,...e){const r=this;if(!ze(r,hi))throw Cr(ce);if(r===Ii){if(Bi(t)&&0===e.length){const e=Ri(t),r=new Tr(kr(e),Er(e),zr(e));return new Ii(kr(vr(r)))}if(0===e.length)return new Ii(kr(Or(t,bi)));const r=e[0],i=e[1];return new Ii(kr(Or(t,function(t,...e){return bi(be(r,this,[t,...Gr(e)]))},i)))}let i,n;const s=t[Fe];if(null!=s&&"function"!=typeof s)throw Cr(pe);if(null!=s)oi(t)?(i=t,n=t.length):ri(o=t)&&o[Fe]===mr&&Nr.next===Rr?(i=t,n=zr(t)):(i=[...t],n=i.length);else{if(null==t)throw Cr(me);i=Le(t),n=zi(i.length)}var o;const a=new r(n);if(0===e.length)for(let h=0;h<n;++h)a[h]=i[h];else{const t=e[0],r=e[1];for(let e=0;e<n;++e)a[e]=be(t,r,[i[e],e])}return a}static of(...t){const e=this;if(!ze(e,hi))throw Cr(ce);const r=t.length;if(e===Ii){const e=new Ii(r),i=Ri(e);for(let n=0;n<r;++n)i[n]=bi(t[n]);return e}const i=new e(r);for(let n=0;n<r;++n)i[n]=t[n];return i}keys(){Pi(this);const t=Ri(this);return fr(t)}values(){Pi(this);const t=Ri(this);return Kr(function*(){for(const e of pr(t))yield ki(e)}())}entries(){Pi(this);const t=Ri(this);return Kr(function*(){for(const[e,r]of yr(t))yield[e,ki(r)]}())}at(t){Pi(this);const e=Ri(this),r=zr(e),i=Ei(t),n=i>=0?i:r+i;if(!(n<0||n>=r))return ki(e[n])}with(t,e){Pi(this);const r=Ri(this),i=zr(r),n=Ei(t),s=n>=0?n:i+n,o=+e;if(s<0||s>=i)throw Ir(xe);const a=new Tr(kr(r),Er(r),zr(r)),h=new Ii(kr(vr(a)));return Ri(h)[s]=bi(o),h}map(t,...e){Pi(this);const r=Ri(this),i=zr(r),n=e[0],s=Ai(r,Ii);if(s===Ii){const e=new Ii(i),s=Ri(e);for(let o=0;o<i;++o){const e=ki(r[o]);s[o]=bi(be(t,n,[e,o,this]))}return e}const o=new s(i);Ni(o,i);for(let a=0;a<i;++a){const e=ki(r[a]);o[a]=be(t,n,[e,a,this])}return o}filter(t,...e){Pi(this);const r=Ri(this),i=zr(r),n=e[0],s=[];for(let a=0;a<i;++a){const e=ki(r[a]);be(t,n,[e,a,this])&&Qe(s,e)}const o=new(Ai(r,Ii))(s);return Ni(o),o}reduce(t,...e){Pi(this);const r=Ri(this),i=zr(r);if(0===i&&0===e.length)throw Cr(ye);let n,s;0===e.length?(n=ki(r[0]),s=1):(n=e[0],s=0);for(let o=s;o<i;++o)n=t(n,ki(r[o]),o,this);return n}reduceRight(t,...e){Pi(this);const r=Ri(this),i=zr(r);if(0===i&&0===e.length)throw Cr(ye);let n,s;0===e.length?(n=ki(r[i-1]),s=i-2):(n=e[0],s=i-1);for(let o=s;o>=0;--o)n=t(n,ki(r[o]),o,this);return n}forEach(t,...e){Pi(this);const r=Ri(this),i=zr(r),n=e[0];for(let s=0;s<i;++s)be(t,n,[ki(r[s]),s,this])}find(t,...e){Pi(this);const r=Ri(this),i=zr(r),n=e[0];for(let s=0;s<i;++s){const e=ki(r[s]);if(be(t,n,[e,s,this]))return e}}findIndex(t,...e){Pi(this);const r=Ri(this),i=zr(r),n=e[0];for(let s=0;s<i;++s){const e=ki(r[s]);if(be(t,n,[e,s,this]))return s}return-1}findLast(t,...e){Pi(this);const r=Ri(this),i=zr(r),n=e[0];for(let s=i-1;s>=0;--s){const e=ki(r[s]);if(be(t,n,[e,s,this]))return e}}findLastIndex(t,...e){Pi(this);const r=Ri(this),i=zr(r),n=e[0];for(let s=i-1;s>=0;--s){const e=ki(r[s]);if(be(t,n,[e,s,this]))return s}return-1}every(t,...e){Pi(this);const r=Ri(this),i=zr(r),n=e[0];for(let s=0;s<i;++s)if(!be(t,n,[ki(r[s]),s,this]))return!1;return!0}some(t,...e){Pi(this);const r=Ri(this),i=zr(r),n=e[0];for(let s=0;s<i;++s)if(be(t,n,[ki(r[s]),s,this]))return!0;return!1}set(t,...e){Pi(this);const r=Ri(this),i=Ei(e[0]);if(i<0)throw Ir(xe);if(null==t)throw Cr(me);if(ii(t))throw Cr(fe);if(Bi(t))return xr(Ri(this),Ri(t),i);if(ri(t)){if(Si(kr(t)))throw Cr(de)}const n=zr(r),s=Le(t),o=zi(s.length);if(i===1/0||o+i>n)throw Ir(xe);for(let a=0;a<o;++a)r[a+i]=bi(s[a])}reverse(){Pi(this);const t=Ri(this);return gr(t),this}toReversed(){Pi(this);const t=Ri(this),e=new Tr(kr(t),Er(t),zr(t)),r=new Ii(kr(vr(e))),i=Ri(r);return gr(i),r}fill(t,...e){Pi(this);const r=Ri(this);return wr(r,bi(t),...Gr(e)),this}copyWithin(t,e,...r){Pi(this);const i=Ri(this);return br(i,t,e,...Gr(r)),this}sort(t){Pi(this);const e=Ri(this),r=void 0!==t?t:Ti;return _r(e,(t,e)=>r(ki(t),ki(e))),this}toSorted(t){Pi(this);const e=Ri(this);if(void 0!==t&&"function"!=typeof t)throw new Cr("The comparison function must be either a function or undefined");const r=void 0!==t?t:Ti,i=new Tr(kr(e),Er(e),zr(e)),n=new Ii(kr(vr(i))),s=Ri(n);return _r(s,(t,e)=>r(ki(t),ki(e))),n}slice(t,e){Pi(this);const r=Ri(this),i=Ai(r,Ii);if(i===Ii){const i=new Tr(kr(r),Er(r),zr(r));return new Ii(kr(vr(i,t,e)))}const n=zr(r),s=Ei(t),o=void 0===e?n:Ei(e);let a,h;a=s===-1/0?0:s<0?n+s>0?n+s:0:n<s?n:s,h=o===-1/0?0:o<0?n+o>0?n+o:0:n<o?n:o;const u=h-a>0?h-a:0,c=new i(u);if(Ni(c,u),0===u)return c;if(Si(kr(r)))throw Cr(de);let l=0;for(;a<h;)c[l]=ki(r[a]),++a,++l;return c}subarray(t,e){Pi(this);const r=Ri(this),i=Ai(r,Ii),n=new Tr(kr(r),Er(r),zr(r)),s=Mr(n,t,e),o=new i(kr(s),Er(s),zr(s));return Ni(o),o}indexOf(t,...e){Pi(this);const r=Ri(this),i=zr(r);let n=Ei(e[0]);if(n===1/0)return-1;n<0&&(n+=i,n<0&&(n=0));for(let s=n;s<i;++s)if(Xe(r,s)&&ki(r[s])===t)return s;return-1}lastIndexOf(t,...e){Pi(this);const r=Ri(this),i=zr(r);let n=e.length>=1?Ei(e[0]):i-1;if(n===-1/0)return-1;n>=0?n=n<i-1?n:i-1:n+=i;for(let s=n;s>=0;--s)if(Xe(r,s)&&ki(r[s])===t)return s;return-1}includes(t,...e){Pi(this);const r=Ri(this),i=zr(r);let n=Ei(e[0]);if(n===1/0)return!1;n<0&&(n+=i,n<0&&(n=0));const s=Re(t);for(let o=n;o<i;++o){const e=ki(r[o]);if(s&&Re(e)||e===t)return!0}return!1}join(t){Pi(this);const e=Fi(Ri(this));return Ge(e,t)}toLocaleString(...t){Pi(this);const e=Fi(Ri(this));return $e(e,...Gr(t))}get[Ce](){if(Bi(this))return"Float16Array"}}je(Ii,"BYTES_PER_ELEMENT",{value:2}),je(Ii,hi,{}),Te(Ii,cr);const Li=Ii.prototype;je(Li,"BYTES_PER_ELEMENT",{value:2}),je(Li,Fe,{value:Li.values,writable:!0,configurable:!0}),Te(Li,dr);const Wi=E;var ji=Uint8Array,Di=Uint16Array,Vi=Uint32Array,qi=new ji([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Yi=new ji([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Xi=function(t,e){for(var r=new Di(31),i=0;i<31;++i)r[i]=e+=1<<t[i-1];var n=new Vi(r[30]);for(i=1;i<30;++i)for(var s=r[i];s<r[i+1];++s)n[s]=s-r[i]<<5|i;return[r,n]},Hi=Xi(qi,2),Zi=Hi[0],Ji=Hi[1];Zi[28]=258,Ji[258]=28,Xi(Yi,0);for(var Gi=new Di(32768),Qi=0;Qi<32768;++Qi){var $i=(43690&Qi)>>>1|(21845&Qi)<<1;$i=(61680&($i=(52428&$i)>>>2|(13107&$i)<<2))>>>4|(3855&$i)<<4,Gi[Qi]=((65280&$i)>>>8|(255&$i)<<8)>>>1}var Ki=new ji(288);for(Qi=0;Qi<144;++Qi)Ki[Qi]=8;for(Qi=144;Qi<256;++Qi)Ki[Qi]=9;for(Qi=256;Qi<280;++Qi)Ki[Qi]=7;for(Qi=280;Qi<288;++Qi)Ki[Qi]=8;var tn=new ji(32);for(Qi=0;Qi<32;++Qi)tn[Qi]=5;var en=new ji(0),rn=typeof TextDecoder<"u"&&new TextDecoder;try{rn.decode(en,{stream:!0})}catch{}const nn=class t{constructor(t=0,e=0,r=0,i=0){this.west=t,this.south=e,this.east=r,this.north=i}get width(){let t=this.east;return t<this.west&&(t+=2*Math.PI),t-this.west}get height(){return this.north-this.south}set(t,e,r,i){return this.west=t,this.south=e,this.east=r,this.north=i,this}clone(){return new t(this.west,this.south,this.east,this.north)}copy(t){return this.west=t.west,this.south=t.south,this.east=t.east,this.north=t.north,this}equals(t){return t.west===this.west&&t.south===this.south&&t.east===this.east&&t.north===this.north}at(t,e,r=new he){return r.set(this.west+(this.east-this.west)*t,this.north+(this.south-this.north)*e)}fromArray(t,e=0){return this.west=t[e],this.south=t[e+1],this.east=t[e+2],this.north=t[e+3],this}toArray(t=[],e=0){return t[e]=this.west,t[e+1]=this.south,t[e+2]=this.east,t[e+3]=this.north,t}*[Symbol.iterator](){yield this.west,yield this.south,yield this.east,yield this.north}};nn.MAX=new nn(he.MIN_LONGITUDE,he.MIN_LATITUDE,he.MAX_LONGITUDE,he.MAX_LATITUDE);let sn=nn;function*on(t,e,r,i,n){if(r>=i)return;const s=2**r,o=r+1,a=2**o,h=Math.floor(t/s*a),u=Math.floor(e/s*a),c=[[h,u,o],[h+1,u,o],[h,u+1,o],[h+1,u+1,o]];if(o<i)for(const l of c)for(const t of on(...l,i,n))yield t;else for(const l of c)yield(n??new an).set(...l)}class an{constructor(t=0,e=0,r=0){this.x=t,this.y=e,this.z=r}set(t,e,r){return this.x=t,this.y=e,null!=r&&(this.z=r),this}clone(){return new an(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}getParent(t=new an){const e=2**this.z,r=this.x/e,i=this.y/e,n=this.z-1,s=2**n;return t.set(Math.floor(r*s),Math.floor(i*s),n)}*traverseChildren(t,e){const{x:r,y:i,z:n}=this;for(const s of on(r,i,n,n+t,e))yield s}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const hn=new z;class un{constructor(t=2,e=1,r=sn.MAX){this.width=t,this.height=e,this.rectangle=r}clone(){return new un(this.width,this.height,this.rectangle.clone())}copy(t){return this.width=t.width,this.height=t.height,this.rectangle.copy(t.rectangle),this}getSize(t,e=new z){return e.set(this.width<<t,this.height<<t)}getTile(t,e,r=new an){const i=this.getSize(e,hn),{rectangle:n}=this,s=n.width/i.x,o=n.height/i.y,{west:a,south:h,east:u}=n;let c=t.longitude;u<a&&(c+=2*Math.PI);let l=Math.floor((c-a)/s);l>=i.x&&(l=i.x-1);let d=Math.floor((t.latitude-h)/o);return d>=i.y&&(d=i.y-1),r.x=l,r.y=d,r.z=e,r}getRectangle(t,e=new sn){const r=this.getSize(t.z,hn),{rectangle:i}=this,n=i.width/r.x,s=i.height/r.y,{west:o,north:a}=i;return e.west=t.x*n+o,e.east=(t.x+1)*n+o,e.north=a-(r.y-t.y-1)*s,e.south=a-(r.y-t.y)*s,e}}function cn(t,e){if(!t)throw new Error("Invariant failed")}function ln(t){return t>=0?1:-1}function dn(t,e,r=new S,i=255){if(0===t&&0===e)return r.setScalar(0);let n=t/i*2-1,s=e/i*2-1;const o=1-(Math.abs(n)+Math.abs(s));if(o<0){const t=n;n=(1-Math.abs(s))*ln(t),s=(1-Math.abs(t))*ln(s)}return r.set(n,s,o).normalize()}const mn=new he,fn=new S;class pn extends Gt{constructor(t,e){super(),this.data=t;const{header:r,vertexData:i,triangleIndices:n,extensions:s}=t;if(null==i||null==n)throw new Error;this.position=new S(r.boundingSphereCenterX,r.boundingSphereCenterY,r.boundingSphereCenterZ);const o=new Lt(n,1);this.setIndex(o);const a=this.createPositionAttribute(i,{rectangle:e,minHeight:t.header.minHeight,maxHeight:t.header.maxHeight});this.setAttribute("position",a);const h=this.createUvAttribute(i);if(this.setAttribute("uv",h),null!=s?.vertexNormals){const t=this.createPackedEncodedNormalAttribute(s.vertexNormals);this.setAttribute("packedOctNormal",t)}}computeBoundingSphere(){const{header:t}=this.data;this.boundingSphere=new at(new S,t.boundingSphereRadius)}computeVertexNormals(){const t=this.data.extensions?.vertexNormals;if(null==t)return void super.computeVertexNormals();cn(t.length%2==0);const e=new Float32Array(t.length/2*3);for(let i=0,n=0;i<e.length;i+=3,n+=2){const r=dn(t[n],t[n+1],fn);e[i]=r.x,e[i+1]=r.y,e[i+2]=r.z}const r=new Lt(e,3);this.setAttribute("normal",r),this.normalizeNormals()}createPositionAttribute(t,e){cn(t.length%3==0);const r=t.length/3,i=t.subarray(0,r),n=t.subarray(r,2*r),s=t.subarray(2*r,3*r),o=new Float32Array(3*r),{rectangle:a,minHeight:h,maxHeight:u}=e,{west:c,south:l,east:d,north:m}=a;for(let f=0,p=0;f<o.length;f+=3,++p){const t=i[p],e=n[p],r=s[p];mn.longitude=Wi(c,d,t/32767),mn.latitude=Wi(l,m,e/32767),mn.height=Wi(h,u,r/32767);const a=mn.toECEF(fn).sub(this.position);o[f]=a.x,o[f+1]=a.y,o[f+2]=a.z}return new Lt(o,3)}createUvAttribute(t){cn(t.length%3==0);const e=t.length/3,r=t.subarray(0,e),i=t.subarray(e,2*e),n=new Int16Array(2*e);for(let s=0,o=0;s<n.length;s+=2,++o)n[s]=r[o],n[s+1]=i[o];return new Lt(n,2,!0)}createPackedEncodedNormalAttribute(t){cn(t.length%2==0);const e=new Float32Array(t.length/2);for(let r=0,i=0;r<e.length;++r,i+=2){const n=t[i],s=t[i+1];e[r]=256*n+s}return new Lt(e,1)}}function yn(t,e){return new n.Transfer(t,e)}const xn={toCreasedNormals:function(t,e){const r=function(t,e=Math.PI/3){const r=Math.cos(e),i=100*(1+1e-10),n=[new S,new S,new S],s=new S,o=new S,a=new S,h=new S;function u(t){return`${~~(t.x*i)},${~~(t.y*i)},${~~(t.z*i)}`}const c=t.index?t.toNonIndexed():t,l=c.attributes.position,d={};for(let p=0,y=l.count/3;p<y;p++){const t=3*p,e=n[0].fromBufferAttribute(l,t+0),r=n[1].fromBufferAttribute(l,t+1),i=n[2].fromBufferAttribute(l,t+2);s.subVectors(i,r),o.subVectors(e,r);const a=(new S).crossVectors(s,o).normalize();for(let s=0;s<3;s++){const t=u(n[s]);t in d||(d[t]=[]),d[t].push(a)}}const m=new Float32Array(3*l.count),f=new Lt(m,3,!1);for(let p=0,y=l.count/3;p<y;p++){const t=3*p,e=n[0].fromBufferAttribute(l,t+0),i=n[1].fromBufferAttribute(l,t+1),c=n[2].fromBufferAttribute(l,t+2);s.subVectors(c,i),o.subVectors(e,i),a.crossVectors(s,o).normalize();for(let s=0;s<3;s++){const e=d[u(n[s])];h.set(0,0,0);for(let t=0,i=e.length;t<i;t++){const i=e[t];a.dot(i)>r&&h.add(i)}h.normalize(),f.setXYZ(t+s,h.x,h.y,h.z)}}return c.setAttribute("normal",f),c}(function(t,e=new Gt){for(const[r,i]of Object.entries(t.attributes))e.setAttribute(r,new Lt(i.array,i.itemSize,i.normalized));if(e.index=null!=t.index?new Lt(t.index.array,t.index.itemSize,t.index.normalized):null,null!=t.boundingBox){const{min:r,max:i}=t.boundingBox;e.boundingBox=new V(new S(r.x,r.y,r.z),new S(i.x,i.y,i.z))}if(null!=t.boundingSphere){const{center:r,radius:i}=t.boundingSphere;e.boundingSphere=new at(new S(r.x,r.y,r.z),i)}return e}(t),e),i=r.getAttribute("normal"),n=new S,s=new S,o=new S;for(let u=0;u<i.count;u+=3)n.fromBufferAttribute(i,u+0),s.fromBufferAttribute(i,u+1),o.fromBufferAttribute(i,u+2),(n.length()<.5||s.length()<.5||o.length()<.5)&&(i.setXYZ(u+0,0,0,1),i.setXYZ(u+1,0,0,1),i.setXYZ(u+2,0,0,1));const[a,h]=ue(r);return yn(a,h)},createTerrainGeometry:function(t,e,{x:r,y:i,z:n},s=!0){const o=y(t),a=(new un).copy(e).getRectangle({x:r,y:i,z:n}),h=new pn(o,a);h.computeBoundingSphere(),s&&h.computeVertexNormals();const[u,c]=ue(h);return yn({geometry:u,position:h.position,header:o.header},c)}};n.worker(xn)}();
