import{_ as t,n,aW as e,bf as o,p as r,b$ as a,ak as i,am as c}from"./three.fIUcjaNz1730883607874.js";import{a as s,m as l,e as u,U as p,H as f}from"./@tresjs.C3WO4ZW41730883607874.js";import{u as d,_ as m}from"./colorList.7eYcYSPU1730883607874.js";import{P as h}from"./tweakpane.BCjFYDHx1730883607874.js";import{d as x,r as g,a6 as S,w as v,o as b,D as C,J as w,aj as y,ak as z,f as P,g as j,j as _,u as I,al as D,m as T,F as M}from"./@vue.Cfu43fwq1730883607874.js";import"./@vueuse.BSum2YDk1730883607874.js";import"./pinia.DKpn0rzI1730883607874.js";import"./vue-demi.Dq6ymT-81730883607874.js";import"./@fesjs.DQmvwjPe1730883607874.js";import"./vue-router.BDLCs4Ld1730883607874.js";import"./lodash-es.BBTWvufR1730883607874.js";import"./@qlin.BIlp8Yi21730883607874.js";import"./@babel.BBWsvBIa1730883607874.js";import"./@floating-ui.B75jtkXD1730883607874.js";import"./@juggle.BnTvdTVm1730883607874.js";const F=L;!function(t,n){const e=L,o=R();for(;;)try{if(341311===-parseInt(e(448))/1*(parseInt(e(418))/2)+parseInt(e(449))/3+parseInt(e(424))/4*(-parseInt(e(397))/5)+parseInt(e(445))/6*(parseInt(e(401))/7)+parseInt(e(404))/8*(parseInt(e(428))/9)+-parseInt(e(422))/10+-parseInt(e(450))/11*(parseInt(e(415))/12))break;o.push(o.shift())}catch(r){o.push(o.shift())}}();const A=function(){let t=!0;return function(n,e){const o=t?function(){if(e){const t=e[L(436)](n,arguments);return e=null,t}}:function(){};return t=!1,o}}();function R(){const t=["secondPass","133788tPNBED","length","init","8NWpMQd","toString","boxSize","bind","2923490MaXCGg","FrontSide","8gCzXXd","uniforms","gger","warn","9AlPkhY","value","constructor","test","function *\\( *\\)",'{}.constructor("return this")( )',"TresBoxGeometry","rotate","apply","ratio","action","console","input","rtTexture","trace","steps","magFilter","1152NnyPrM","addBinding","table","50199YzESWB","438906UxCXtU","11CBpRBA","debu","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","call","272905AleSgk","colorsStops","counter","minFilter","9814JRrlzP","texture","info","4314248eyyKCJ","TresMesh","return (function() ","while (true) {}","LinearFilter","__proto__","chain","generateMipmaps","alphaCorrection","uRatio"];return(R=function(){return t})()}!function(){A(this,(function(){const t=L,n=new RegExp(t(432)),e=new RegExp(t(395),"i"),o=H(t(417));n[t(431)](o+t(410))&&e[t(431)](o+t(440))?H():o("0")}))()}();const E=function(){let t=!0;return function(n,e){const o=t?function(){if(e){const t=e[L(436)](n,arguments);return e=null,t}}:function(){};return t=!1,o}}();E(void 0,(function(){const t=L;let n;try{n=Function(t(406)+t(433)+");")()}catch(r){n=window}const e=n[t(439)]=n[t(439)]||{},o=["log",t(427),t(403),"error","exception",t(447),t(442)];for(let a=0;a<o.length;a++){const n=E[t(430)].prototype[t(421)](E),r=o[a],i=e[r]||n;n[t(409)]=E[t(421)](E),n[t(419)]=i[t(419)][t(421)](i),e[r]=n}}))();const k=[F(435)],W=["args"];function L(t,n){const e=R();return(L=function(t,n){return e[t-=394]})(t,n)}const N=x({__name:F(414),props:{rtTexture:{default:{texture:null}},boxSize:{}},async setup(e){const o=F;let r,a;const i=g({steps:156,alphaCorrection:7.7,ratio:1}),c=new h;c[o(446)](i,o(443),{label:"循环次数",min:1,max:300,step:1}),c[o(446)](i,o(412),{label:"亮度",min:0,max:10,step:.1}),c[o(446)](i,"ratio",{label:"对比度",min:0,max:1,step:.1});const l=d(),u=e,p=([r,a]=S((()=>s(["./plugins/tvtVolumeRendering/rawData/eyeResult256.png"]))),r=await r,a(),r);p[o(411)]=!1,p[o(400)]=t[o(408)],p[o(444)]=n;const f={vertexShader:"varying vec3 worldSpaceCoords;\nvarying vec4 projectedCoords;\n\nuniform float boxWidth;\nuniform float boxHeight;\nuniform float boxDepth;\n\nvoid main()\n{\n\tworldSpaceCoords=(modelMatrix*vec4(position+vec3(boxWidth/2.,boxHeight/2.,boxDepth/2.),1.)).xyz;\n\tgl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);\n\tprojectedCoords=projectionMatrix*modelViewMatrix*vec4(position,1.);\n}",fragmentShader:"varying vec3 worldSpaceCoords;\nvarying vec4 projectedCoords;\nuniform sampler2D tex,cubeTex,transferTex;\nuniform float steps;\nuniform float alphaCorrection;\nuniform float boxWidth;\nuniform float boxHeight;\nuniform float boxDepth;\nuniform float uRatio;\n\nconst int MAX_STEPS=887;\n\nfloat linearScale(float domainStart,float domainEnd,float rangeStart,float rangeEnd,float value){\n\treturn((rangeEnd-rangeStart)*(value-domainStart))/(domainEnd-domainStart)+rangeStart;\n}\n\nconst float slicesPerSide=16.;\nconst float zDepth=slicesPerSide*slicesPerSide-1.;\n\nvec4 sampleAs3DTexture(vec3 texCoord)\n{\n\ttexCoord.x=linearScale(0.,boxWidth,0.,1.,texCoord.x);\n\ttexCoord.y=linearScale(0.,boxHeight,0.,1.,texCoord.y);\n\t\n\tvec4 colorSlice1,colorSlice2;\n\tvec2 texCoordSlice1,texCoordSlice2;\n\t\n\t\n\t\n\tfloat zSliceNumber1=floor(texCoord.z*zDepth);\n\t\n\t\n\tfloat zSliceNumber2=min(zSliceNumber1+1.,zDepth);\n\t\n\t\n\t\n\ttexCoord.xy/=slicesPerSide;\n\t\n\ttexCoordSlice1=texCoordSlice2=texCoord.xy;\n\t\n\t\n\ttexCoordSlice1.x+=(mod(zSliceNumber1,slicesPerSide)/slicesPerSide);\n\ttexCoordSlice1.y+=floor((zDepth-zSliceNumber1)/slicesPerSide)/slicesPerSide;\n\t\n\ttexCoordSlice2.x+=(mod(zSliceNumber2,slicesPerSide)/slicesPerSide);\n\ttexCoordSlice2.y+=floor((zDepth-zSliceNumber2)/slicesPerSide)/slicesPerSide;\n\t\n\t\n\t\n\tcolorSlice1=texture2D(cubeTex,texCoordSlice1);\n\tcolorSlice2=texture2D(cubeTex,texCoordSlice2);\n\t\n\t\n\tcolorSlice1.rgb=texture2D(transferTex,vec2(colorSlice1.a,1.)).rgb;\n\tcolorSlice2.rgb=texture2D(transferTex,vec2(colorSlice2.a,1.)).rgb;\n\t\n\t\n\tfloat zDifference=mod(texCoord.z*zDepth,1.);\n\t\n\t\n\treturn mix(colorSlice1,colorSlice2,zDifference);\n}\n\nvoid main(void){\n\t\n\t\n\tvec2 texc=vec2(((projectedCoords.x/projectedCoords.w)+1.)/2.,\n\t((projectedCoords.y/projectedCoords.w)+1.)/2.);\n\t\n\t\n\tvec3 backPos=texture2D(tex,texc).xyz;\n\t\n\t\n\tvec3 frontPos=worldSpaceCoords;\n\t\n\t\n\t\n\tif((backPos.x==0.)&&(backPos.y==0.))\n\t{\n\t\tgl_FragColor=vec4(0.);\n\t\treturn;\n\t}\n\t\n\t\n\tvec3 dir=backPos-frontPos;\n\t\n\tfloat rayLength=length(dir);\n\t\n\t\n\tfloat delta=1./steps;\n\t\n\t\n\tvec3 deltaDirection=normalize(dir)*delta;\n\tfloat deltaDirectionLength=length(deltaDirection);\n\t\n\t\n\tvec3 currentPosition=frontPos;\n\t\n\t\n\tvec4 accumulatedColor=vec4(.0,.0,.0,uRatio);\n\t\n\t\n\tfloat accumulatedAlpha=0.;\n\t\n\t\n\tfloat accumulatedLength=0.;\n\t\n\t\n\t\n\tfloat alphaScaleFactor=25.6*delta;\n\t\n\tvec4 colorSample;\n\tfloat alphaSample;\n\t\n\t\n\tfor(int i=0;i<MAX_STEPS;i++)\n\t{\n\t\t\n\t\tcolorSample=sampleAs3DTexture(currentPosition);\n\t\t\n\t\t\n\t\talphaSample=colorSample.a*alphaCorrection;\n\t\t\n\t\t\n\t\talphaSample*=(1.-accumulatedAlpha);\n\t\t\n\t\t\n\t\talphaSample*=alphaScaleFactor;\n\t\t\n\t\t\n\t\taccumulatedColor+=colorSample*alphaSample;\n\t\t\n\t\t\n\t\taccumulatedAlpha+=alphaSample;\n\t\t\n\t\t\n\t\tcurrentPosition+=deltaDirection;\n\t\taccumulatedLength+=deltaDirectionLength;\n\t\t\n\t\t\n\t\tif(accumulatedLength>=rayLength||accumulatedAlpha>=1.)\n\t\tbreak;\n\t}\n\t\n\tgl_FragColor=accumulatedColor;\n\t\n}",side:t[o(423)],uniforms:{tex:{value:u[o(441)][o(402)]},cubeTex:{value:p},transferTex:{value:null},steps:{value:i[o(443)]},alphaCorrection:{value:i[o(412)]},boxWidth:{value:u[o(420)][0]},boxHeight:{value:u[o(420)][1]},boxDepth:{value:u[o(420)][2]},uRatio:{value:i[o(437)]}}};return v((()=>l[o(398)]),(()=>{f[o(425)].transferTex.value=l.updateTransferFunction()}),{deep:!0,immediate:!0}),v((()=>[i[o(443)],i[o(412)],i[o(437)]]),(([t,n,e])=>{const r=o;f[r(425)][r(443)][r(429)]=t,f.uniforms[r(412)][r(429)]=n,f[r(425)][r(413)].value=e})),(t,n)=>{const r=o;return b(),C(r(405),{rotate:[0,Math.PI/2,0]},[w(r(434),{args:e[r(420)]},null,8,W),w("TresShaderMaterial",y(z(f)),null,16)],8,k)}}});function H(t){function n(t){const e=L;if("string"==typeof t)return function(t){}[e(430)](e(407))[e(436)](e(399));1!==(""+t/t)[e(416)]||t%20==0?function(){return!0}.constructor(e(394)+e(426))[e(396)](e(438)):function(){return!1}.constructor(e(394)+e(426)).apply("stateObject"),n(++t)}try{if(t)return n;n(0)}catch(e){}}const B=O;function X(){const t=["constructor","firstScene","toneMappingExposure","chain","22zgJYwC","Mesh","bind","return (function() ","NearestFilter","input",'{}.constructor("return this")( )',"ShaderMaterial","height","length","string","ClampToEdgeWrapping","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","627ZXuTeh","BoxGeometry","339882HOYKSO","BackSide","warn","gger","action","call","counter","rtTexture","2112foNjua","test","1225987aiFBmz","trace","log","function *\\( *\\)","add","toString","stateObject","apply","1055660lVGxPn","init","prototype","4CBaCPl","debu","console","table","331480nfShGF","render","width","324506wvwhnc","value","info","error","setRenderTarget","ACESFilmicToneMapping","WebGLRenderTarget","2402fpbklP","Scene","4752zmLNUx"];return(X=function(){return t})()}!function(t,n){const e=O,o=X();for(;;)try{if(310729===parseInt(e(286))/1+-parseInt(e(293))/2*(parseInt(e(313))/3)+-parseInt(e(279))/4*(-parseInt(e(276))/5)+parseInt(e(258))/6+parseInt(e(268))/7+parseInt(e(266))/8*(-parseInt(e(295))/9)+parseInt(e(283))/10*(-parseInt(e(300))/11))break;o.push(o.shift())}catch(r){o.push(o.shift())}}();const G=function(){let t=!0;return function(n,e){const o=t?function(){if(e){const t=e.apply(n,arguments);return e=null,t}}:function(){};return t=!1,o}}();!function(){G(this,(function(){const t=O,n=new RegExp(t(271)),e=new RegExp(t(312),"i"),o=V(t(277));n[t(267)](o+t(299))&&e[t(267)](o+t(305))?V():o("0")}))()}();const Z=function(){let t=!0;return function(n,e){const o=t?function(){if(e){const t=e[O(275)](n,arguments);return e=null,t}}:function(){};return t=!1,o}}();Z(void 0,(function(){const t=O;let n;try{n=Function(t(303)+t(306)+");")()}catch(r){n=window}const e=n[t(281)]=n[t(281)]||{},o=[t(270),t(260),t(288),t(289),"exception",t(282),t(269)];for(let a=0;a<o[t(309)];a++){const n=Z[t(296)][t(278)][t(302)](Z),r=o[a],i=e[r]||n;n.__proto__=Z[t(302)](Z),n.toString=i[t(273)][t(302)](i),e[r]=n}}))();const $=x({__name:B(297),setup(n){const a=B,i=[1,1,1],{camera:c,renderer:s,scene:p,sizes:f}=l();s.value.toneMapping=t[a(291)],s[a(287)][a(298)]=100000.2;const d=new(t[a(292)])(f[a(285)][a(287)],f[a(308)][a(287)],{minFilter:t[a(304)],magFilter:t[a(304)],wrapS:e,wrapT:t[a(311)],format:o,type:r,generateMipmaps:!1,stencilBuffer:!0}),m=new(t[a(294)]),h=new(t[a(257)])(...i),x=new(t[a(307)])({vertexShader:"varying vec3 worldSpaceCoords;\n\nuniform float boxWidth;\nuniform float boxHeight;\nuniform float boxDepth;\n\nvoid main()\n{\n  \n  worldSpaceCoords=position+vec3(boxWidth/2.,boxHeight/2.,boxDepth/2.);\n  gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);\n}",fragmentShader:"varying vec3 worldSpaceCoords;\n\nvoid main()\n{\n  \n  gl_FragColor=vec4(worldSpaceCoords.x,worldSpaceCoords.y,worldSpaceCoords.z,1);\n}",side:t[a(259)],uniforms:{boxWidth:{value:i[0]},boxHeight:{value:i[1]},boxDepth:{value:i[2]}}});m[a(272)](new(t[a(301)])(h,x));const{onLoop:g}=u();return g((()=>{const t=a;s.value[t(290)](d),s[t(287)][t(284)](m,c[t(287)]),s[t(287)].setRenderTarget(null),s[t(287)][t(284)](p[t(287)],c[t(287)])})),(t,n)=>{const e=a;return b(),P(D,null,{default:j((()=>[_(N,{rtTexture:I(d),boxSize:i},null,8,[e(265)])])),_:1})}}});function O(t,n){const e=X();return(O=function(t,n){return e[t-=257]})(t,n)}function V(t){function n(t){const e=O;if(typeof t===e(310))return function(t){}[e(296)]("while (true) {}")[e(275)](e(264));1!==(""+t/t).length||t%20==0?function(){return!0}[e(296)](e(280)+e(261))[e(263)](e(262)):function(){return!1}[e(296)](e(280)+e(261))[e(275)](e(274)),n(++t)}try{if(t)return n;n(0)}catch(e){}}function U(){const t=["debu","gger","console","log","787832MidguW","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","1277269GPQhgA","3nGssRX","call","info","constructor","8716768sLUVXm","table","apply","error","prototype","action","function *\\( *\\)","input","warn","407832gcHFvn","length","517035aQzCmH","#6600fa","exception","string","rawDataImg","bind","#CC6600","1219800MeRxhb","trace","toString","TresPerspectiveCamera","#F2F200","while (true) {}","test","2534715TaWoOn",'{}.constructor("return this")( )'];return(U=function(){return t})()}const J=K;!function(t,n){const e=K,o=U();for(;;)try{if(313191===parseInt(e(443))/1+-parseInt(e(441))/2*(parseInt(e(466))/3)+parseInt(e(463))/4+parseInt(e(457))/5+parseInt(e(450))/6+parseInt(e(465))/7+-parseInt(e(432))/8)break;o.push(o.shift())}catch(r){o.push(o.shift())}}();const Y=function(){let t=!0;return function(n,e){const o=t?function(){if(e){const t=e[K(434)](n,arguments);return e=null,t}}:function(){};return t=!1,o}}();!function(){Y(this,(function(){const t=K,n=new RegExp(t(438)),e=new RegExp(t(464),"i"),o=tt("init");n[t(456)](o+"chain")&&e[t(456)](o+t(439))?tt():o("0")}))()}();const Q=function(){let t=!0;return function(n,e){const o=t?function(){if(e){const t=e[K(434)](n,arguments);return e=null,t}}:function(){};return t=!1,o}}();function K(t,n){const e=U();return(K=function(t,n){return e[t-=430]})(t,n)}Q(void 0,(function(){const t=K,n=function(){const t=K;let n;try{n=Function("return (function() "+t(458)+");")()}catch(e){n=window}return n}(),e=n[t(461)]=n[t(461)]||{},o=[t(462),t(440),t(430),t(435),t(445),t(433),t(451)];for(let r=0;r<o[t(442)];r++){const n=Q.constructor[t(436)][t(448)](Q),a=o[r],i=e[a]||n;n.__proto__=Q[t(448)](Q),n[t(452)]=i[t(452)][t(448)](i),e[a]=n}}))();const q=x({__name:J(447),setup(t){const n=g({shadowMapType:a,outputColorSpace:i,toneMapping:c,renderMode:"manual"});return(t,e)=>{const o=K;return b(),C(M,null,[_(m,{curColorList:[[o(444),.1],[o(449),.7],[o(454),1]]}),_(I(f),T(n,{"window-size":""}),{default:j((()=>[e[0]||(e[0]=w(o(453),{position:[-1,1,1],fov:40,near:.01,far:3e3},null,-1)),_(I(p)),_($)])),_:1},16)],64)}}});function tt(t){function n(t){const e=K;if(typeof t===e(446))return function(t){}[e(431)](e(455))[e(434)]("counter");1!==(""+t/t)[e(442)]||t%20==0?function(){return!0}.constructor(e(459)+e(460))[e(467)](e(437)):function(){return!1}[e(431)](e(459)+e(460)).apply("stateObject"),n(++t)}try{if(t)return n;n(0)}catch(e){}}export{q as default};
