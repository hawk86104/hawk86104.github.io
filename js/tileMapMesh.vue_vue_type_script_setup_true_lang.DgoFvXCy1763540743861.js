import{j as e,k as t,l as o,d as r,V as s,dq as n}from"./three.rXKzP9fQ1763540743861.js";import{F as i,_ as a}from"./@tresjs.BCHtwiaC1763540743861.js";import{b as p,P as m,M as h,T as l,a as u}from"./TerrainMeshProvider.uZe7Hgbs1763540743861.js";import"./Fetch.CIMEiaKn1763540743861.js";import{U as c,M as d}from"./CoordUtil.BerJhsxi1763540743861.js";import{d as g,a6 as w,w as f,H as b,o as k,u as x}from"./@vue.Co_gxueH1763540743861.js";function y(e){return new Worker(""+new URL("../static/MartiniWorker-Ryjx9cZO.js",import.meta.url).href,{name:e?.name})}class M{constructor(){this.maxZoom=12,this.coordType=c,this.utmZone=50,this._useWorker=!0,this.source="https://api.maptiler.com/tiles/terrain-rgb-v2/[z]/[x]/[y].webp?key=L55MtSxL94Yb4hQeWewp"}set useWorker(e){this._useWorker=e,this._useWorker||(this._worker?.terminate(),this._worker=void 0)}get useWorker(){return this._useWorker}async getTile(e){return this._useWorker?this.getInWorkerThread(e):this.getInMainThread()}async getInMainThread(){return new e}async getInWorkerThread(o){this._worker||(this._worker=new p(y));const r={tileNo:o,id:this.getId(o),url:this.getUrl(o),maxZ:this.maxZoom,coordType:this.coordType,utmZone:this.utmZone},s=await this._worker.postMessage(r),n=new e;return n.setAttribute("position",new t(s.positions,3)),n.setAttribute("uv",new t(s.uv,2)),n.setIndex(new t(s.triangles,1)),n}async abort(e){this._useWorker&&this._worker?.postMessage({id:this.getId(e),abort:!0})}async dispose(e,t){t.dispose(),this._useWorker&&this._worker?.postMessage({id:this.getId(e),dispose:!0})}getId(e){return e.join("-")}getUrl(e){const[t,o,r]=e;return this.source.replace("[x]",t+"").replace("[y]",o+"").replace("[z]",r+"")}}const _=["object","rotation"],W=g({__name:"tileMapMesh",props:{bbox:{default:[104.955976,20.149765,120.998419,30.528687]},maxZoom:{default:20},opposite:{type:Boolean,default:!1},genBright:{default:1},genContrast:{default:1},genSaturation:{default:1},monochrome:{default:"#fff"},isMonochrome:{type:Boolean,default:!1},mapCenter:{},tweenInstance:{default:null}},setup(e,{expose:t}){const p=e,{renderer:c,scene:g}=i(),y=new m;y.coordType=d;const W=new M;W.source="https://api.maptiler.com/tiles/terrain-rgb-v2/[z]/[x]/[y].webp?key=L55MtSxL94Yb4hQeWewp",W.coordType=d;const j=new h;j.source="https://webrd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",j.showTileNo=!1,j.useWorker=!0;const T=new l(y,j);if(T.showBoundingBox=!1,T.wireframe=!1,T.flatShading=!1,T.useStandardMaterial=!1,T.filter={opposite:p.opposite,monochrome:p.isMonochrome?{r:.299,g:.587,b:.114}:null,genBright:p.genBright,genContrast:p.genContrast,genSaturation:p.genSaturation},p.monochrome){let e=new o(p.monochrome);T.filter&&(T.filter.monochrome={r:e.r,g:e.g,b:e.b})}const I=new u;I.provider=T,I.bbox=p.bbox,I.maxZoom=p.maxZoom;const v=new r(60,window.innerWidth/window.innerHeight,1,1e8);v.up=new s(0,1,0),v.position.set(p.mapCenter[0],p.mapCenter[2],-p.mapCenter[1]),v.lookAt(new s(v.position.x,0,v.position.z-2e3)),I.camera=v;let C=null;w(()=>{c&&!C&&(C=new n(v,c.domElement),C.enableDamping=!0,C.dampingFactor=.05,C.minDistance=600,C.position0.set(v.position.x,v.position.y,v.position.z),C.target.set(v.position.x,0,v.position.z-2e3))}),f(()=>[p.opposite,p.isMonochrome,p.monochrome],([e,t,r])=>{if(T.filter){let s=new o(r);T.filter.opposite=e,T.filter.monochrome=t?{r:s.r,g:s.g,b:s.b}:null}}),f(()=>[p.genBright,p.genContrast,p.genSaturation],([e,t,o])=>{T.filter&&(T.filter.genBright=e,T.filter.genContrast=t,T.filter.genSaturation=o)});const{onBeforeRender:z}=a();return z(()=>{if(c){p.tweenInstance?.update(),C&&C.update(),I.update();const e=50*Math.abs(v.position.y);v.far=e+5e3,v.updateProjectionMatrix(),c.render(g.value,v)}}),t({camera:v,map:I,orbitControl:C}),(e,t)=>(k(),b("primitive",{object:x(I),rotation:[-Math.PI/2,0,0]},null,8,_))}});export{W as _};
