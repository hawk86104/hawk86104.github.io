import{importShared as e}from"./3d-tiles-renderer.CPyPbRB51767152766904.js";import{_sfc_main as a}from"./pagesShow.vue_vue_type_script_setup_true_lang.Tj6UkPyb1767152766904.js";import{useLoop as r}from"./index.BGo9PN8R1767152766904.js";const t=await e("three"),n=({startFrame:e,endFrame:a,fps:r,frameName:n,textureDataURL:o,textureImageURL:s,loop:i,numberOfFrames:m,autoPlay:p,animationNames:l,onStart:u,onEnd:c,onLoopEnd:f,onFrame:w,play:h,pause:d,flipX:y,alphaTest:g,asSprite:S})=>{let x={frames:[],meta:{version:"1.0",size:{w:1,h:1},scale:"1"}},z=new t.Texture;const A=new t.SpriteMaterial({toneMapped:!1,transparent:!0,map:z,alphaTest:g}),_=new t.MeshBasicMaterial({toneMapped:!1,side:t.DoubleSide,map:z,transparent:!0,alphaTest:g}),v=new t.Sprite(A),F=new t.Mesh(new t.PlaneGeometry(1,1),_);let C=A,j=v;const b=new t.Group;b.add(j);let L=window.performance.now(),B=0,M=n||"";const N=1e3/r,R=new t.Vector3(1,1,1),T=e=>{R.copy(e)},P=y?-1:1;let k=S;k=k,k?(C=A,j=v,b.add(v),b.remove(F)):(C=_,j=F,b.remove(v),b.add(F));const O=(e,a)=>{const r=a/e;return j.scale.set(1,r,1),j.scale},U=(e,a)=>{if(null===e){if(a&&m){const e=a.image.width,r=a.image.height,t=e/m,n=r;if(x={frames:[],meta:{version:"1.0",size:{w:e,h:r},scale:"1"}},parseInt(t.toString(),10)===t)for(let a=0;a<m;a++)x.frames.push({frame:{x:a*t,y:0,w:t,h:n},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:t,h:n},sourceSize:{w:t,h:r}})}}else if(a){x=e,x.frames=Array.isArray(e.frames)?e.frames:D();const{w:r,h:t}=G(e.frames).sourceSize,n=O(r,t);T(n),C&&(C.map=a)}var r;a.premultiplyAlpha=!1,z=r=a,C&&(C.map=r),E()},D=()=>{const e={},a=x,r=l;if(r)for(let t=0;t<r.length;t++){e[r[t]]=[];for(const n in a.frames){const o=a.frames[n],s=o.frame,i=s.x,m=s.y,p=s.w,l=s.h,u=o.sourceSize.w,c=o.sourceSize.h;"string"==typeof n&&-1!==n.toLowerCase().indexOf(r[t].toLowerCase())&&e[r[t]].push({x:i,y:m,w:p,h:l,frame:s,sourceSize:{w:u,h:c}})}}return e},E=()=>{if(!x||!C.map)return;const{meta:{size:e},frames:a}=x,{w:r,h:o}=Array.isArray(a)?a[0].sourceSize:n&&a[n]?a[n][0].sourceSize:{w:0,h:0};C.map.wrapS=C.map.wrapT=t.RepeatWrapping,C.map.center.set(0,0),C.map.repeat.set(1*P/(e.w/r),1/(e.h/o));const s=1/((e.h-1)/o);C.map.offset.x=0,C.map.offset.y=1-s,u&&u({currentFrameName:n,currentFrame:B})},G=e=>{if(Array.isArray(e))return e[0];if("object"==typeof e&&null!==e){return e[Object.keys(e)[0]][0]}return{w:0,h:0}};return{group:b,init:async()=>{await async function(e,a,r){const n=new t.TextureLoader,o=fetch(e).then(e=>e.json()),s=new Promise(e=>{n.load(a,e)});await Promise.all([o,s]).then(e=>{r(e[0],e[1])})}(o,s,U)},update:()=>{var r,t;null!=(r=x)&&r.frames&&null!=(t=C)&&t.map&&(d||((()=>{if(!x||!C.map)return;const r=window.performance.now(),t=r-L,{meta:{size:o},frames:s}=x,{w:i,h:m}=G(s).sourceSize,p=Array.isArray(s)?s:n?s[n]:[];let l=0,u=0;const c=a||p.length-1;if(B>c&&(B=e,null==f||f({currentFrameName:n,currentFrame:B})),t<=N)return;L=r-t%N,O(i,m);const w=(o.w-1)/i,h=(o.h-1)/m,{frame:{x:d,y:y},sourceSize:{w:g,h:S}}=p[B],z=1/w,A=1/h;l=P>0?z*(d/g):z*(d/g)-C.map.repeat.x,u=Math.abs(1-A)-A*(y/S),C.map.offset.x=l,C.map.offset.y=u,B+=1})(),w&&w({currentFrameName:M,currentFrame:B})))},playAnimation:()=>{d=!1},pauseAnimation:()=>{d=!0},setFrameName:e=>{M!==(n=e)&&n&&(B=0,M=n)}}},{withAsyncContext:o,defineComponent:s}=await e("vue"),{unref:i,openBlock:m,createElementBlock:p}=await e("vue"),l=["object"],u=await e("three"),c=s({__name:"fireC",async setup(e){let a,t;const s=n({startFrame:0,fps:40,autoPlay:!0,loop:!0,textureImageURL:"./plugins/digitalCity/image/spriteAnimator/flame.png",textureDataURL:"./plugins/digitalCity/image/spriteAnimator/flame.json",alphaTest:.101,asSprite:!0});[a,t]=o(()=>s.init()),await a,t(),s.group.children[0].material.map.colorSpace=u.SRGBColorSpace,s.group.children[0].geometry.translate(0,.344,0);const{onBeforeRender:c}=r();return c(()=>{s.update()}),(e,a)=>(m(),p("primitive",{object:i(s).group,renderOrder:9999},null,8,l))}}),{defineComponent:f}=await e("vue"),{createVNode:w,Suspense:h,withCtx:d,openBlock:y,createBlock:g}=await e("vue"),S=f({__name:"fireC",setup:e=>(e,r)=>(y(),g(a,null,{ability:d(()=>[(y(),g(h,null,{default:d(()=>[w(c,{position:[10,30,0],scale:100})]),_:1}))]),_:1}))});export{S as default};
