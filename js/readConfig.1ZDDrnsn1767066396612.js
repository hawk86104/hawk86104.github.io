import{i as e}from"./3d-tiles-renderer.CbgZh8zU1767066396612.js";import{K as t}from"./@tresjs.B1f7s3pS1767066396612.js";import{b as a,_ as o,a as n}from"./_virtual___federation__.CfDTGK1q1767066396612.js";import{u as l,g as s,a as i,B as r,o as c,p as u,e as d,q as m,r as p,s as f,j as h}from"./naive-ui.CmwCmbKm1767066396612.js";import{_ as g}from"./@fesjs.BK66sTPr1767066396612.js";import{P as v}from"./tweakpane.CqZAnw7f1767066396612.js";class _{constructor(e){this.path="",this.resPath="",this.config=null,this.loading=null,this.remoteName=e}setPath(e){this.path===e&&this.config||(this.path=e,this.config=null,this.loading=null,a(this.remoteName,{url:()=>Promise.resolve(e),format:"esm",from:"vite"}))}setResPath(e){this.resPath=e,window.__REMOTE_ASSET_MAP__??={}}async loadConfig(){return this.config?this.config:(this.loading||(this.loading=o(this.remoteName,"./config").then(e=>n(e)).then(e=>(this.validateConfig(e),this.config=e,window.__REMOTE_ASSET_MAP__[e.name]=this.resPath,e)).finally(()=>{this.loading=null})),this.loading)}async loadComponentModule(e){if(!this.config)throw new Error(`[Remote ${this.remoteName}] config not loaded`);return o(this.remoteName,e).then(e=>n(e))}getConfig(){return this.config}async reload(){return this.config=null,this.loading=null,this.loadConfig()}validateConfig(e){if(!e?.name||!Array.isArray(e.components))throw new Error(`[Remote ${this.remoteName}] config schema invalid`)}}class w{constructor(){this.remotes=new Map}static getInstance(){return this.instance||(this.instance=new w),this.instance}registerRemote(e,t,a){let o=this.remotes.get(e);return o||(o=new _(e),this.remotes.set(e,o)),o.setResPath(t),o.setPath(a),o}getRemote(e){return this.remotes.get(e)}async loadRemoteConfig(e){const t=this.remotes.get(e);if(!t)throw new Error(`Remote "${e}" not registered`);return t.loadConfig()}getRemoteConfig(e){return this.remotes.get(e)?.getConfig()}async loadAll(){return Promise.all([...this.remotes.values()].map(e=>e.loadConfig()))}}const y=w.getInstance(),{defineComponent:b}=await e("vue"),{unref:C,createVNode:k,createTextVNode:j,withCtx:N,openBlock:x,createBlock:D}=await e("vue"),{ref:B}=await e("vue"),R=b({__name:"ServiceLoader",emits:["loaded"],setup(e,{emit:t}){const a=t,o=l(),n=B("http://dcser.icegl.cn"),c=B(!1),u=async()=>{if(n.value){c.value=!0;try{y.registerRemote("base",n.value+"/",n.value+"/assets/remoteEntry.js");const e=await y.loadRemoteConfig("base");a("loaded",e),o.success("服务加载成功")}catch(e){o.error("服务加载失败")}finally{c.value=!1}}else o.warning("请输入服务地址")};return(e,t)=>(x(),D(C(s),{vertical:"",size:"large"},{default:N(()=>[k(C(i),{value:n.value,"onUpdate:value":t[0]||(t[0]=e=>n.value=e),placeholder:"请输入服务地址",clearable:""},null,8,["value"]),k(C(r),{type:"primary",block:"",loading:c.value,onClick:u},{default:N(()=>[...t[1]||(t[1]=[j(" 应用服务 ",-1)])]),_:1},8,["loading"])]),_:1}))}}),{defineComponent:P}=await e("vue"),{toDisplayString:T,createTextVNode:S,unref:E,withCtx:O,createVNode:z,renderList:M,Fragment:V,openBlock:A,createElementBlock:$,normalizeClass:I,createBlock:L}=await e("vue"),F=g(P({__name:"ServiceViewer",props:{data:{},selectedType:{}},emits:["select","reset"],setup(e,{emit:t}){const a=e,o=t;return(e,t)=>(A(),L(E(s),{vertical:"",size:"large"},{default:O(()=>[z(E(c),{bordered:"",size:"small"},{default:O(()=>[z(E(u),{label:"名称"},{default:O(()=>[S(T(a.data.name),1)]),_:1}),z(E(u),{label:"版本"},{default:O(()=>[z(E(d),{type:"info"},{default:O(()=>[S(T(a.data.version),1)]),_:1})]),_:1}),z(E(u),{label:"描述"},{default:O(()=>[S(T(a.data.description),1)]),_:1})]),_:1}),z(E(m),{bordered:"",hoverable:"",clickable:""},{default:O(()=>[(A(!0),$(V,null,M(a.data.components,a=>(A(),L(E(p),{class:I({"n-list-item--active":e.selectedType&&a.type===e.selectedType}),key:a.type,onClick:e=>(e=>{o("select",e)})(a)},{default:O(()=>[z(E(f),{title:a.name,description:a.type},{"header-extra":O(()=>[z(E(d),{size:"small"},{default:O(()=>[...t[1]||(t[1]=[S("点击载入调试",-1)])]),_:1})]),_:1},8,["title","description"])]),_:2},1032,["class","onClick"]))),128))]),_:1}),z(E(r),{type:"warning",block:"",onClick:t[0]||(t[0]=e=>o("reset"))},{default:O(()=>[...t[2]||(t[2]=[S(" 删除当前服务 / 重新加载 ",-1)])]),_:1})]),_:1}))}}),[["__scopeId","data-v-e8a20270"]]);const{withAsyncContext:G,defineComponent:K}=await e("vue"),{resolveDynamicComponent:U,normalizeProps:q,openBlock:H,createBlock:J,mergeProps:Q,createCommentVNode:W}=await e("vue"),{shallowRef:X,onBeforeUnmount:Y}=await e("vue"),Z=K({__name:"oneRemoteCom",props:{remoteName:{},comName:{},attrsData:{},config:{}},async setup(e){let t,a;const o=e,n=X(null),l=y.getRemote(o.remoteName);l&&(n.value=([t,a]=G(()=>l.loadComponentModule(`./${o.comName}`)),t=await t,a(),t));const s=function(e,t,a){const o=new v({container:e,title:"配置"});return Object.entries(t).forEach(([e,t])=>{switch(t.com){case"Select":o.addBinding(a,e,{label:t.name,options:t.options?.reduce((e,t)=>(e[t.label]=t.value,e),{})}).on("change",t=>{a[e]=t.value});break;case"ColorPicker":o.addBinding(a,e,{label:t.name,picker:"inline"}).on("change",t=>{a[e]=t.value});break;case"Switch":o.addBinding(a,e,{label:t.name}).on("change",t=>{a[e]=t.value});break;case"Slider":o.addBinding(a,e,{label:t.name,min:t.min,max:t.max,step:t.step}).on("change",t=>{a[e]=t.value});break;default:console.warn(`未知组件类型：${t.com}`)}}),o}(document.getElementById("pane"),o.config,o.attrsData);return Y(()=>{s&&s.dispose()}),(e,t)=>n.value?(H(),J(U(n.value),q(Q({key:0},e.attrsData)),null,16)):W("",!0)}}),{defineComponent:ee}=await e("vue"),{openBlock:te,createBlock:ae,createCommentVNode:oe,unref:ne,withCtx:le,createVNode:se,createElementVNode:ie,mergeProps:re,Suspense:ce,resolveComponent:ue,Fragment:de,createElementBlock:me}=await e("vue"),{SRGBColorSpace:pe,BasicShadowMap:fe,NoToneMapping:he}=await e("three"),{nextTick:ge,reactive:ve,ref:_e}=await e("vue"),we=ee({__name:"readConfig",setup(e){const a=ve({clearColor:"#201919",shadows:!0,alpha:!1,shadowMapType:fe,outputColorSpace:pe,toneMapping:he}),o=e=>{n.value=e,console.log("服务配置加载完成：",e)},n=_e(null),l=_e(null),s=_e(null),i=_e(null),r=e=>{console.log("选中组件",e),l.value&&l.value.comName===e.type||(l.value=null,s.value={},i.value=null,ge(()=>{s.value=e?.default||{},i.value=e?.config||null,l.value={remoteName:"base",comName:e.type,position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]},e.defaultObject3D?.position&&(l.value.position=[e.defaultObject3D.position.x,e.defaultObject3D.position.y,e.defaultObject3D.position.z]),e.defaultObject3D?.rotation&&(l.value.rotation=[e.defaultObject3D.rotation.x,e.defaultObject3D.rotation.y,e.defaultObject3D.rotation.z]),e.defaultObject3D?.scale&&(l.value.scale=[e.defaultObject3D.scale.x,e.defaultObject3D.scale.y,e.defaultObject3D.scale.z])}))},c=()=>{l.value=null,n.value=null};return(e,u)=>{const d=ue("TresCanvas");return te(),me(de,null,[se(ne(h),null,{default:le(()=>[n.value?(te(),ae(F,{key:1,data:n.value,selectedType:l.value?.comName,onSelect:r,onReset:c,style:{"z-index":"99999",position:"absolute",left:"10px",top:"50px"}},null,8,["data","selectedType"])):(te(),ae(R,{key:0,onLoaded:o,style:{"z-index":"99999",position:"absolute",left:"10px",top:"50px"}}))]),_:1}),se(d,re(a,{"window-size":""}),{default:le(()=>[u[0]||(u[0]=ie("TresPerspectiveCamera",{position:[5,5,5]},null,-1)),se(ne(t)),(te(),ae(ce,null,{default:le(()=>[l.value?(te(),ae(Z,re({key:0},l.value,{attrsData:s.value,config:i.value}),null,16,["attrsData","config"])):oe("",!0)]),_:1})),u[1]||(u[1]=ie("TresGridHelper",{"position-y":.1},null,-1))]),_:1},16)],64)}}});export{we as default};
