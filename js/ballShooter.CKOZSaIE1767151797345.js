import{importShared as e}from"./3d-tiles-renderer.BWkWgmMi1767151797345.js";import{useTresContext as t,OrbitControls_default as n}from"./index.DdZsEhdb1767151797345.js";import{_sfc_main as o}from"./XRcom.vue_vue_type_script_setup_true_lang.CPYO09lF1767151797345.js";const{BufferGeometry:r,Float32BufferAttribute:a}=await e("three");class s extends r{constructor(e=1,t=1,n=1,o=1,r=1,s=1){super();const i=e/2,l=t/2,c=n/2,u=e/(o=Math.floor(o)),d=t/(r=Math.floor(r)),m=n/(s=Math.floor(s)),h=[];let p=-i,f=-l,w=-c;for(let a=0;a<=o;a++)h.push(p,-l,-c,p,l,-c),h.push(p,l,-c,p,l,c),h.push(p,l,c,p,-l,c),h.push(p,-l,c,p,-l,-c),p+=u;for(let a=0;a<=r;a++)h.push(-i,f,-c,i,f,-c),h.push(i,f,-c,i,f,c),h.push(i,f,c,-i,f,c),h.push(-i,f,c,-i,f,-c),f+=d;for(let a=0;a<=s;a++)h.push(-i,-l,w,-i,l,w),h.push(-i,l,w,i,l,w),h.push(i,l,w,i,-l,w),h.push(i,-l,w,-i,-l,w),w+=m;this.setAttribute("position",new a(h,3))}}const{Clock:i,Vector3:l,Quaternion:c,Matrix4:u}=await e("three"),d=new l(1,1,1),m=new l;let h=null;async function p(){null===h&&(h=await import("https://cdn.skypack.dev/@dimforge/rapier3d-compat@0.15.0"),await h.init());const e=new l(0,-9.81,0),t=new h.World(e),n=[],o=new WeakMap,r=new l,a=new c,s=new u;function p(e,t=0,a=0){const s=function(e){const t=e.parameters;if("BoxGeometry"===e.type){const e=void 0!==t.width?t.width/2:.5,n=void 0!==t.height?t.height/2:.5,o=void 0!==t.depth?t.depth/2:.5;return h.ColliderDesc.cuboid(e,n,o)}if("SphereGeometry"===e.type||"IcosahedronGeometry"===e.type){const e=void 0!==t.radius?t.radius:1;return h.ColliderDesc.ball(e)}return null}(e.geometry);if(null===s)return;s.setMass(t),s.setRestitution(a);const i=e.isInstancedMesh?function(e,t,n){const o=e.instanceMatrix.array,a=[];for(let s=0;s<e.count;s++){const e=r.fromArray(o,16*s+12);a.push(f(e,null,t,n))}return a}(e,t,s):f(e.position,e.quaternion,t,s);t>0&&(n.push(e),o.set(e,i))}function f(e,n,o,r){const a=o>0?h.RigidBodyDesc.dynamic():h.RigidBodyDesc.fixed();a.setTranslation(...e),null!==n&&a.setRotation(n);const s=t.createRigidBody(a);return t.createCollider(r,s),s}const w=new i;return setInterval(function(){t.timestep=w.getDelta(),t.step();for(let e=0,t=n.length;e<t;e++){const t=n[e];if(t.isInstancedMesh){const e=t.instanceMatrix.array,n=o.get(t);for(let t=0;t<n.length;t++){const o=n[t],r=o.translation();a.copy(o.rotation()),s.compose(r,a,d).toArray(e,16*t)}t.instanceMatrix.needsUpdate=!0,t.computeBoundingSphere()}else{const e=o.get(t);t.position.copy(e.translation()),t.quaternion.copy(e.rotation())}}},1e3/60),{addScene:function(e){e.traverse(e=>{if(e.isMesh){const t=e.userData.physics;t&&p(e,t.mass,t.restitution)}})},addMesh:p,setMeshPosition:function(e,t,n=0){let r=o.get(e);e.isInstancedMesh&&(r=r[n]),r.setAngvel(m),r.setLinvel(m),r.setTranslation(t)},setMeshVelocity:function(e,t,n=0){let r=o.get(e);e.isInstancedMesh&&(r=r[n]),r.setLinvel(t)}}}const{withAsyncContext:f,defineComponent:w}=await e("vue"),{unref:y,createElementVNode:M,Fragment:g,openBlock:v,createElementBlock:B}=await e("vue"),x=["geometry","material"],D=["rotation-z","geometry","material"],C=["rotation-z","geometry","material"],L=["rotation-x","geometry","material"],R=["rotation-x","geometry","material"],_=["object"],{onMounted:b}=await e("vue"),k=await e("three"),P=w({__name:"physicsBalls",props:{XRcom:{default:null}},async setup(e){let n,o;const r=e,a=new k.BoxGeometry(6,2,6),s=new k.MeshNormalMaterial({visible:!1}),i={physics:{mass:0}},l=new k.IcosahedronGeometry(.08,3),c=new k.MeshLambertMaterial,u=new k.InstancedMesh(l,c,800);u.instanceMatrix.setUsage(k.DynamicDrawUsage),u.userData.physics={mass:1,restitution:1.1};const d=new k.Matrix4,m=new k.Color;for(let t=0;t<u.count;t++){const e=4*Math.random()-2,n=4*Math.random(),o=4*Math.random()-2;d.setPosition(e,n,o),u.setMatrixAt(t,d),u.setColorAt(t,m.setHex(16777215*Math.random()))}const{scene:h}=t(),w=([n,o]=f(()=>p()),n=await n,o(),n);b(()=>{w.addScene(h.value)});let P=0;const S=new k.Vector3;function A(e){e.userData.isSelecting&&(w.setMeshPosition(u,e.position,P),S.x=2*(Math.random()-.5),S.y=2*(Math.random()-.5),S.z=Math.random()-9,S.applyQuaternion(e.quaternion),w.setMeshVelocity(u,S,P),++P===u.count&&(P=0))}return r.XRcom.onBeforeLoop(()=>{A(r.XRcom.controller0),A(r.XRcom.controller1)}),(e,t)=>(v(),B(g,null,[M("TresMesh",{name:"floor",position:[0,-1,0],geometry:y(a),material:y(s),userData:i},null,8,x),M("TresMesh",{name:"wallPX",position:[4,3,0],"rotation-z":Math.PI/2,geometry:y(a),material:y(s),userData:i},null,8,D),M("TresMesh",{name:"wallNX",position:[-4,3,0],"rotation-z":Math.PI/2,geometry:y(a),material:y(s),userData:i},null,8,C),M("TresMesh",{name:"wallPZ",position:[0,3,4],"rotation-x":Math.PI/2,geometry:y(a),material:y(s),userData:i},null,8,L),M("TresMesh",{name:"wallNZ",position:[0,3,-4],"rotation-x":Math.PI/2,geometry:y(a),material:y(s),userData:i},null,8,R),M("primitive",{object:y(u)},null,8,_)],64))}}),{defineComponent:S}=await e("vue"),{unref:A,createElementVNode:E,createVNode:I,openBlock:T,createBlock:V,createCommentVNode:X,Suspense:z,withCtx:G,Fragment:N,createElementBlock:F}=await e("vue"),j=["geometry"],{ref:q,watch:U}=await e("vue"),H=await e("three"),Q=S({__name:"ballShooterSence",setup(e){const t=new s(6,6,6,10,10,10),n=function(){this?.userData&&(this.userData.isSelecting=!0)},r=function(){this?.userData&&(this.userData.isSelecting=!1)},a=function(e){let t,n;switch(e.targetRayMode){case"tracked-pointer":return t=new H.BufferGeometry,t.setAttribute("position",new H.Float32BufferAttribute([0,0,0,0,0,-1],3)),t.setAttribute("color",new H.Float32BufferAttribute([.5,.5,.5,0,0,0],3)),n=new H.LineBasicMaterial({vertexColors:!0,blending:H.AdditiveBlending}),new H.Line(t,n);case"gaze":return t=new H.RingGeometry(.02,.04,32).translate(0,0,-1),n=new H.MeshBasicMaterial({opacity:.5,transparent:!0}),new H.Mesh(t,n)}return new H.Group},i=q(null);return U(i,e=>{e&&(e.controller0.addEventListener("selectstart",n),e.controller0.addEventListener("selectend",r),e.controller0.addEventListener("connected",function(e){this.add(a(e.data))}),e.controller0.addEventListener("disconnected",function(){this.remove(this.children[0])}),e.controller1.addEventListener("selectstart",n),e.controller1.addEventListener("selectend",r),e.controller1.addEventListener("connected",function(e){this.add(a(e.data))}),e.controller1.addEventListener("disconnected",function(){this.remove(this.children[0])}))}),(e,n)=>(T(),F(N,null,[E("TresLineSegments",{position:[0,3,0],geometry:A(t)},[...n[0]||(n[0]=[E("TresLineBasicMaterial",{color:8421504},null,-1)])],8,j),I(o,{ref_key:"XRcomRef",ref:i,sessionInit:{optionalFeatures:["depth-sensing"],depthSensing:{usagePreference:["gpu-optimized"],dataFormatPreference:[]}}},null,512),(T(),V(z,null,{default:G(()=>[i.value?(T(),V(P,{key:0,XRcom:i.value},null,8,["XRcom"])):X("",!0)]),_:1}))],64))}}),{defineComponent:W}=await e("vue"),{createElementVNode:Z,unref:J,createVNode:K,resolveComponent:O,normalizeProps:Y,guardReactiveProps:$,withCtx:ee,openBlock:te,createBlock:ne}=await e("vue"),{reactive:oe}=await e("vue"),re=W({__name:"ballShooter",setup(e){const t=oe({clearColor:"#444444",antialias:!0,renderMode:"demand",windowSize:!0});return(e,o)=>{const r=O("TresCanvas");return te(),ne(r,Y($(t)),{default:ee(()=>[o[0]||(o[0]=Z("TresPerspectiveCamera",{position:[0,1.6,3],fov:50,near:.1,far:100},null,-1)),K(J(n)),o[1]||(o[1]=Z("TresHemisphereLight",{args:[12303291,8947848,3]},null,-1)),o[2]||(o[2]=Z("TresDirectionalLight",{position:[1,1,1],intensity:3},null,-1)),K(Q)]),_:1},16)}}});export{re as default};
