import{ab as e,C as a,cv as o,cw as t,cx as l,cy as r,n as i,ap as s,as as n,c6 as u}from"./three.Bj3hPI0l1746335712058.js";import{C as d,e as p,a as c}from"./@tresjs.CIKSfeCC1746335712058.js";import{z as m}from"./three-custom-shader-material.CpCBu6881746335712058.js";import{b as f,a as y}from"./buildingsCustomShaderMaterial.DyBo--wu1746335712058.js";import{d as h,b as w,a3 as g,w as v,H as b,o as C,u as x,r as S,a5 as B,h as T,e as _,f as j,J as M,j as A,I as L,M as R,ak as O,al as H,F as G,m as W}from"./@vue.DK6ok9LJ1746335712058.js";const k=async()=>{const e=await d("./plugins/digitalCity/model/shanghai.FBX");let a=null,o=null,t=null;return e.traverse((e=>{"CITY_UNTRIANGULATED"===e.name&&(a=e),"LANDMASS"===e.name&&(o=e),"ROADS"===e.name&&(t=e)})),{model:e,city:a,land:o,roads:t}},F=["object"],D=h({__name:"buildingsModelCustomShader",props:{model:{},bulidingsColor:{default:"#e523ff"},landColor:{default:"#112233"},topColor:{default:"#ffff00"},opacity:{default:.9},gradient:{type:Boolean,default:!0}},setup(o){const t=o,l=w(0),r=t.model.city;r.renderOrder=1001;const i=t.model.land;(()=>{const{geometry:o}=r;o.computeBoundingBox(),o.computeBoundingSphere();const{max:i,min:s}=o.boundingBox;if(r.material.__csm)return;const n=new m({baseMaterial:r.material,vertexShader:y,fragmentShader:f,silent:!0,uniforms:{uMax:{value:i},uMin:{value:s},uBorderWidth:{value:5},uCircleTime:{value:5},uColor:{value:new a(t.bulidingsColor)},uOpacity:{value:t.opacity},uLightColor:{value:new a("#ffffff")},uTopColor:{value:new a(t.topColor)},uTime:l,uGradient:{value:t.gradient}},depthWrite:!0,depthTest:!0,transparent:!0,side:e});r.material.dispose(),r.material=n})();const{onLoop:s}=p();s((({delta:e})=>{l.value+=e})),g((()=>{t.bulidingsColor&&r.material.uniforms.uColor.value.setStyle(t.bulidingsColor),t.landColor&&((a,o)=>{let l;l=Array.isArray(i.material)?i.material:[i.material],l.forEach((a=>{a[o].setStyle(t.landColor),a.side=e}))})(0,"color"),t.opacity&&(r.material.uniforms.uOpacity.value=t.opacity)})),v(t,((e,a)=>{r.material.uniforms.uGradient.value=e.gradient}));const n=t.model.model.clone();return(e,a)=>(C(),b("primitive",{object:x(n)},null,8,F))}}),E=["object"],I=h({__name:"buildingsLines",props:{builds:{},width:{default:1},color:{default:"#FFF"},opacity:{default:1},style:{default:"Wireframe"}},setup(e){const s=e;let n=null,u=null;if("Wireframe"===s.style){const e=new o(s.builds.geometry);let a=(new t).fromEdgesGeometry(e),i=new l({color:s.color,linewidth:s.width,opacity:s.opacity,transparent:!0,depthWrite:!0,depthTest:!0});i.resolution.set(window.innerWidth,window.innerHeight),n=new r(a,i),n.applyMatrix4(s.builds.matrix.clone())}else{u={transparent:!0,uniforms:{uColor:{value:new a(s.color)},uOpacity:{value:s.opacity}},vertexShader:"\n       void main() {\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:" \n        uniform vec3 uColor;\n\t\t\t\tuniform float uOpacity;\n        void main() {\n          gl_FragColor = vec4(uColor, uOpacity);\n        }\n      "};const e=new o(s.builds.geometry),t=new i(u);n=new LineSegments(e,t),n.applyMatrix4(s.builds.matrix.clone()),n.material.linewidth=s.width,n.renderOrder=1e3}return g((()=>{"Shader"===s.style&&(s.color&&(u.uniforms.uColor.value=new a(s.color)),s.opacity&&(u.uniforms.uOpacity.value=s.opacity)),"Wireframe"===s.style&&(s.color&&(n.material.color=new a(s.color)),s.opacity&&(n.material.opacity=s.opacity)),s.width&&(n.material.linewidth=s.width)})),(e,a)=>(C(),b("primitive",{object:x(n)},null,8,E))}}),N={key:1,args:[1e3],position:[0,19,0]},P={key:2,args:[6e3,100],position:[0,19,0]},U=h({__name:"pagesShow",props:{showBuildings:{type:Boolean,default:!0},autoRotate:{type:Boolean,default:!0},showAxesHelper:{type:Boolean,default:!0},showGridHelper:{type:Boolean,default:!0},disableRender:{type:Boolean,default:!1}},async setup(e){let a,o;const t=e,l=S({clearColor:"#000000",shadows:!0,alpha:!1,useLegacyLights:!0,shadowMapType:u,outputColorSpace:n,toneMapping:s,disableRender:t.disableRender}),r=S({autoRotate:t.autoRotate,enableDamping:!0});let i=null;t.showBuildings&&([a,o]=B((()=>k())),a=await a,o(),i=a);const d=w(),p=w();return(e,a)=>{const o=T("TresCanvas");return C(),_(o,W({ref_key:"tcRef",ref:p},l,{"window-size":""}),{default:j((()=>[M("TresPerspectiveCamera",{ref_key:"perspectiveCameraRef",ref:d,position:[600,750,-1221],fov:45,near:1,far:1e5},null,512),A(x(c),O(H(r)),null,16),a[0]||(a[0]=M("TresAmbientLight",{color:"#ffffff"},null,-1)),a[1]||(a[1]=M("TresDirectionalLight",{position:[100,100,0],intensity:.5,color:"#ffffff"},null,-1)),t.showBuildings&&x(i)?(C(),b(G,{key:0},[A(D,{model:x(i)},null,8,["model"]),A(I,{builds:x(i).city,color:"#000"},null,8,["builds"])],64)):L("",!0),R(e.$slots,"ability"),t.showAxesHelper?(C(),b("TresAxesHelper",N)):L("",!0),t.showGridHelper?(C(),b("TresGridHelper",P)):L("",!0)])),_:3},16)}}});export{D as _,I as a,U as b,k as l};
