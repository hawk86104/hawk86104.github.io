import{importShared as p}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{Pane as k}from"./tweakpane.BQRZXf8M1767148983502.js";import{OrbitControls as y}from"./OrbitControls.CSbAbrSE1767148983502.js";import{Fs as T,_l as E}from"./index.DTe2qqjO1767148983502.js";import{MERC as _,PlaneProvider as R,MartiniTerrainProvider as z,MapProvider as I,TerrainMeshProvider as V,Map as j,lonLatToWebMerctor as g}from"./TerrainMeshProvider.DkO8ghB01767148983502.js";import{raycasterEvent as N}from"./raycasterEvent.BFa5J5oX1767148983502.js";import{flyToNative as x}from"./utils.Dy5vlvhc1767148983502.js";const{defineComponent:$}=await p("vue"),{unref:F,openBlock:L,createElementBlock:W}=await p("vue"),D=["object","rotation"],u=await p("three"),{watchEffect:H,watch:B}=await p("vue"),U=$({__name:"tileMapMesh",props:{bbox:{default:[104.955976,20.149765,120.998419,30.528687]},maxZoom:{default:20},opposite:{type:Boolean,default:!1},genBright:{default:1},genContrast:{default:1},genSaturation:{default:1},monochrome:{default:"#fff"},isMonochrome:{type:Boolean,default:!1},mapCenter:{},tweenInstance:{default:null}},setup(C,{expose:d}){const t=C,{renderer:a,scene:r}=T(),i=new R;i.coordType=_;const c=new z;c.source="https://api.maptiler.com/tiles/terrain-rgb-v2/[z]/[x]/[y].webp?key=L55MtSxL94Yb4hQeWewp",c.coordType=_;const m=new I;m.source="https://webrd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",m.showTileNo=!1,m.useWorker=!0;const e=new V(i,m);if(e.showBoundingBox=!1,e.wireframe=!1,e.flatShading=!1,e.useStandardMaterial=!1,e.filter={opposite:t.opposite,monochrome:t.isMonochrome?{r:.299,g:.587,b:.114}:null,genBright:t.genBright,genContrast:t.genContrast,genSaturation:t.genSaturation},t.monochrome){let s=new u.Color(t.monochrome);e.filter&&(e.filter.monochrome={r:s.r,g:s.g,b:s.b})}const n=new j;n.provider=e,n.bbox=t.bbox,n.maxZoom=t.maxZoom;const o=new u.PerspectiveCamera(60,window.innerWidth/window.innerHeight,1,1e7*10);o.up=new u.Vector3(0,1,0),o.position.set(t.mapCenter[0],t.mapCenter[2],-t.mapCenter[1]),o.lookAt(new u.Vector3(o.position.x,0,o.position.z-2e3)),n.camera=o;let l=null;H(()=>{a&&!l&&(l=new y(o,a.domElement),l.enableDamping=!0,l.dampingFactor=.05,l.minDistance=600,l.position0.set(o.position.x,o.position.y,o.position.z),l.target.set(o.position.x,0,o.position.z-2e3))}),B(()=>[t.opposite,t.isMonochrome,t.monochrome],([s,f,w])=>{if(e.filter){let v=new u.Color(w);e.filter.opposite=s,e.filter.monochrome=f?{r:v.r,g:v.g,b:v.b}:null}}),B(()=>[t.genBright,t.genContrast,t.genSaturation],([s,f,w])=>{e.filter&&(e.filter.genBright=s,e.filter.genContrast=f,e.filter.genSaturation=w)});const{onBeforeRender:S}=E();return S(()=>{if(a){t.tweenInstance?.update(),l&&l.update(),n.update();const s=Math.abs(o.position.y)*50;o.far=s+5e3,o.updateProjectionMatrix(),a.render(r.value,o)}}),d({camera:o,map:n,orbitControl:l}),(s,f)=>(L(),W("primitive",{object:F(n),rotation:[-Math.PI/2,0,0]},null,8,D))}}),{defineComponent:Z}=await p("vue"),{mergeProps:M,createVNode:b,resolveComponent:A,withCtx:G,Fragment:O,openBlock:Q,createElementBlock:Y}=await p("vue"),{reactive:P,shallowRef:q}=await p("vue"),h=await p("three"),ae=Z({__name:"tileMap",setup(C){const d=g(118.779958,32.017136),t=[d[0],d[1],5e3],a=q(),r=P({opposite:!0,genBright:1.3,genContrast:1,genSaturation:1,isMonochrome:!0,monochrome:"#4688b5",mapCenter:t,tweenInstance:null}),i=new k({title:"参数"});i.addBinding(r,"opposite",{label:"反色"}),i.addBinding(r,"genBright",{label:"高亮",min:.1,max:3,step:.1}),i.addBinding(r,"genContrast",{label:"对比度",min:.1,max:3,step:.1}),i.addBinding(r,"genSaturation",{label:"饱和度",min:.1,max:3,step:.1}),i.addBinding(r,"isMonochrome",{label:"单色滤镜"}),i.addBinding(r,"monochrome",{label:"滤镜颜色"});const c={at:g(118.7425,31.9998),xjk:g(118.7842,32.0418),nss:g(118.7503,31.9082)};i.addBlade({view:"list",label:"飞去",options:[{text:"奥体中心",value:"at"},{text:"新街口",value:"xjk"},{text:"牛首山",value:"nss"}],value:"at"}).on("change",e=>{const n=new h.Vector3(c[e.value][0],2e3,-c[e.value][1]);r.tweenInstance=x(a.value.camera,n,a.value.orbitControl,[0,-300],4e3)});const m=P({clearColor:"#201919",antialias:!0,logarithmicDepthBuffer:!0,renderMode:"manual",outputColorSpace:h.SRGBColorSpace,toneMapping:h.NoToneMapping});return setTimeout(()=>{const e=c.at,n=new h.Vector3(e[0],1600,-e[1]);r.tweenInstance=x(a.value.camera,n,a.value.orbitControl,[-2e3,-2e3],2e3)},1e3),(e,n)=>{const o=A("TresCanvas");return Q(),Y(O,null,[b(o,M(m,{"window-size":""}),{default:G(()=>[b(U,M(r,{ref_key:"tileMapMeshRef",ref:a,bbox:[80,16,128,50]}),null,16)]),_:1},16),b(N,{tileMapRef:a.value},null,8,["tileMapRef"])],64)}}});export{ae as default};
