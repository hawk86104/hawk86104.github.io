import{F as e,_ as o,g as a}from"./@tresjs.BCHtwiaC1763540743861.js";import{o as n,d as t,u as i}from"./index.Crdf3MNx1763540743861.js";import{c as s,a as l,b as r,d as c,e as u,f as p,g as m}from"./fresnelShader.D0xmqjjf1763540743861.js";import{g as d}from"./gsap.CY1N3EIL1763540743861.js";import{G as _,az as w,dz as g,V as y,l as v,f,h,n as b}from"./three.rXKzP9fQ1763540743861.js";import{d as j,a as x,a8 as S,q as O,w as k,a6 as z,H as A,o as M,J as B,a9 as C,u as G,F as L,X as N,h as R,e as U,N as P}from"./@vue.Co_gxueH1763540743861.js";const T=["object"],E=["position"],I={class:"organ-tooltip"},K={class:"tooltip-content"},F=["onClick"],X=j({__name:"model",props:{modelPath:{},lungs_glow_color:{},lungs_glow_color2:{},body_glow_color:{},body_glow_color2:{},body_c:{},body_p:{},body_opacity:{},fault_glow_color:{},fault_opacity:{},fault_c:{},fault_p:{},organ_glow_color:{},organ_emissive:{},organ_opacity:{},organ_roughness:{},organ_metalness:{},bone_glow_color:{},bone_emissive:{},bone_opacity:{},neuron_glow_color:{},neuron_glow_color2:{},neuron_c:{},neuron_p:{},neuron_opacity:{}},async setup(j){let X,H;const q=j,D=x([]),{camera:J}=e(),V=x(null);let W=new _;const Y={map:([X,H]=S(()=>n("./plugins/humanMedicine/image/fresnel/brainXRayLight.png")),X=await X,H(),X)},$=([X,H]=S(()=>t(["./plugins/humanMedicine/image/fresnel/mat.png","./plugins/humanMedicine/image/fresnel/normal1.jpg"])),X=await X,H(),X);$.forEach((e,o)=>{e.wrapS=e.wrapT=w,e.repeat.set(.5,.5)});const Q=new g({matcap:$[0],normalMap:$[1],transparent:!0,opacity:.9}),Z=s(q,Y),ee=l(J,q),oe=r(J,q),ae=c(),ne=u(q,Y),te=p(q),ie=m(q),se=["brain","Liver","Stomach","Large_Intestine","Small_Intestine","Bladder","Pancreas","Gallbladder","Kidney_L","Kidney_R","Adrenal_Gland_L","Adrenal_Gland_R","Spleen","Appendix"],le={brain:{title:"大脑",description:"人体最复杂的器官，是神经系统的中枢，负责思考、记忆、感觉、运动控制等众多功能"},Liver:{title:"肝脏",description:"人体最大的实质性器官，负责代谢、解毒等重要功能"},Stomach:{title:"胃",description:"消化系统的扩张部分，负责食物的暂时储存和初步消化"},Large_Intestine:{title:"大肠",description:"主要负责吸收水分和电解质，形成和储存粪便"},Small_Intestine:{title:"小肠",description:"消化和吸收的主要场所，将食物分解成可被吸收的小分子"},Bladder:{title:"膀胱",description:"储存尿液的器官，当尿液积累到一定量时，通过排尿反射将其排出体外"},Pancreas:{title:"胰腺",description:"既是外分泌腺也是内分泌腺，外分泌部分泌胰液帮助消化，内分泌部产生胰岛素等激素调节血糖"},Gallbladder:{title:"胆囊",description:"储存和浓缩胆汁的器官，胆汁由肝脏产生，有助于脂肪的消化和吸收"},Kidney_L:{title:"左肾",description:"主要负责过滤血液，形成尿液，调节水、电解质和酸碱平衡，维持体内环境稳定"},Kidney_R:{title:"右肾",description:"主要负责过滤血液，形成尿液，调节水、电解质和酸碱平衡，维持体内环境稳定"},Adrenal_Gland_L:{title:"左肾上腺",description:"分泌多种激素，包括肾上腺素、去甲肾上腺素、皮质醇等，参与调节血压、应激反应等"},Adrenal_Gland_R:{title:"右肾上腺",description:"分泌多种激素，包括肾上腺素、去甲肾上腺素、皮质醇等，参与调节血压、应激反应等"},Spleen:{title:"脾脏",description:"免疫系统的重要组成部分，负责过滤血液中的病原体和老化血细胞，参与免疫反应"},Appendix:{title:"阑尾",description:"位于盲肠末端的细小管状器官，虽然在现代人类中功能不明确，但可能与免疫系统有关"}},re=new Set(["skin","skin01","skin02"]),ce=new Set(["jie","jie2","jie3","line"]),ue=new Set(["r1","r2","l1","l2","l3"]),pe=new Set(["neuron"]),me=new Set(se),de=new Set(["bone"]);let _e,we=new y,ge=new y,ye=new y,ve=null,fe="";const he=async e=>{const{scene:o}=await i(e);o.traverse(e=>{e.isMesh&&re.has(e.name)&&(e.material=Z),e.isMesh&&ce.has(e.name)&&(e.material=Q),e.isMesh&&ue.has(e.name)&&(e.material=ee),e.isMesh&&pe.has(e.name)&&(e.material=oe),e.isMesh&&de.has(e.name)&&(e.material=ie),e.isMesh&&me.has(e.name)&&(e.material=te)}),W.clear(),W.add(C(o));const a=o.clone();ve=a,window.addEventListener("click",e=>{const o=new f;o.x=e.clientX/window.innerWidth*2-1,o.y=-e.clientY/window.innerHeight*2+1;const a=new h;a.setFromCamera(o,J.value);const n=a.intersectObject(W,!0);if(n.length>0&&n[1]&&n[1].object){_e=n[1].object;const e=_e.name;if(!me.has(e))return void console.log(`当前器官 ${e} 不能被选中`);if(we=_e.position.clone(),ye=_e.scale.clone(),ge=new y(-20,20,10),d.to(_e.position,{duration:2,x:ge.x,y:ge.y,z:ge.z,ease:"power1.inOut",onUpdate:()=>{},onComplete:()=>{}}),d.to(_e.scale,{duration:2,x:.7,y:.7,z:.7,ease:"power1.inOut",onUpdate:()=>{J.value.lookAt(_e.position)},onComplete:()=>{}}),D.value.push({id:Date.now(),position:new y(-15,1,10),title:le[e]?.title||"未知器官",description:le[e]?.description||"暂无详细信息"}),d.to(J.value.position,{duration:2,x:-50,y:70,z:200,ease:"power1.inOut",onUpdate:()=>{J.value.lookAt(new y(-30,0,0))},onComplete:()=>{J.value.lookAt(new y(-30,0,0))}}),fe===_e.name)return;se.includes(_e.name)&&(_e instanceof b&&(_e.material=ne,se.forEach(e=>{if(e!==_e.name){const o=W.getObjectByName(e);o instanceof b&&(o.material=ae)}}),ie.opacity=.2,oe.uniforms.c.value=.4),fe=_e.name,console.log("鼠标悬停的物体名称：",fe))}else fe&&(ie.opacity=q.bone_opacity,oe.uniforms.c.value=q.neuron_c,fe="")})},be=J.value.position.clone(),je=e=>{D.value=D.value.filter(o=>o.id!==e),d.to(J.value.position,{duration:2,x:be.x,y:be.y,z:be.z,ease:"power1.inOut",onUpdate:()=>{J.value.lookAt(be)},onComplete:()=>{J.value.lookAt(be)}}),d.to(_e.position,{duration:2,x:we.x,y:we.y,z:we.z,ease:"power1.inOut",onUpdate:()=>{},onComplete:()=>{}}),d.to(_e.scale,{duration:2,x:ye.x,y:ye.y,z:ye.z,ease:"power1.inOut",onUpdate:()=>{},onComplete:()=>{}}),console.log("srcModel",ve),W.getObjectByName(fe)?.traverse(e=>{e.isMesh&&(e.material=ve.getObjectByName(e.name).material,e.castShadow=!0,e.receiveShadow=!0),se.forEach(e=>{const o=W.getObjectByName(e);o instanceof b&&(o.material=ve.getObjectByName(e).material,o.castShadow=!0,o.receiveShadow=!0)})})};O(()=>{he(q.modelPath)}),k(()=>q.modelPath,async e=>{await he(e)});const{onBeforeRender:xe}=o();return xe(()=>{const e=W.getObjectByName("jie");e&&(e.rotation.x+=.01,e.rotation.y+=.01);const o=W.getObjectByName("jie2");o&&(o.rotation.x-=.005,o.rotation.y+=.005);const a=W.getObjectByName("jie3");a&&(a.rotation.x-=.003,a.rotation.y+=.003),ee.uniforms.time.value+=.001}),xe(({delta:e})=>{J.value.position&&V.value&&(ee.uniforms.view_vector.value=J.value.position,oe.uniforms.view_vector.value=J.value.position,Z.uniforms.uTime.value+=e)}),k(()=>J.value,e=>{Z.uniforms.view_vector.value=e}),z(()=>{Z.uniforms.glowColor.value=new v(q.body_glow_color),Z.uniforms.c.value=q.body_c,Z.uniforms.p.value=q.body_p,Z.uniforms.uOpacity.value=q.body_opacity}),z(()=>{ne.uniforms.glowColor.value=new v(q.fault_glow_color),ne.uniforms.uOpacity.value=q.fault_opacity,ne.uniforms.c.value=q.fault_c,ne.uniforms.p.value=q.fault_p}),z(()=>{te.color=new v(q.organ_glow_color),te.emissive=new v(q.organ_emissive),te.opacity=q.organ_opacity,te.roughness=q.organ_roughness,te.metalness=q.organ_metalness}),z(()=>{ie.color=new v(q.bone_glow_color),ie.emissive=new v(q.bone_emissive),ie.opacity=q.bone_opacity}),z(()=>{oe.uniforms.glow_color.value=new v(q.neuron_glow_color),oe.uniforms.glow_color2.value=new v(q.neuron_glow_color2),oe.uniforms.c.value=q.neuron_c,oe.uniforms.p.value=q.neuron_p,oe.opacity=q.neuron_opacity}),(e,o)=>(M(),A("TresGroup",null,[B("TresGroup",{ref_key:"coneGroup",ref:V},[B("primitive",{object:C(G(W)),scale:.5,position:[-1,-5,0]},null,8,T)],512),(M(!0),A(L,null,N(D.value,e=>(M(),A("TresGroup",{key:e.id,position:e.position.toArray()},[R(G(a),{transform:"",sprite:""},{default:U(()=>[B("div",I,[B("div",K,[B("h3",null,P(e.title),1),B("p",null,P(e.description),1),B("button",{onClick:o=>je(e.id)},"×",8,F)])])]),_:2},1024)],8,E))),128))]))}});export{X as _};
