import{F as e}from"./@tresjs.BCHtwiaC1763540743861.js";import{_ as o}from"./Line2.vue_vue_type_script_setup_true_lang.CHVMnI-f1763540743861.js";import{i as r,y as t}from"./index.Crdf3MNx1763540743861.js";import{c as s,g as a}from"./utils.D7CR8Ywg1763540743861.js";import{_ as i}from"./iconText.vue_vue_type_script_setup_true_lang.BJmpbuqr1763540743861.js";import{_ as n}from"./selectPanel.vue_vue_type_style_index_0_lang.CFOANz7D1763540743861.js";import{_ as l}from"./pointList.vue_vue_type_script_setup_true_lang.DgvEE_Wc1763540743861.js";import"./index.d2-zW_AZ1763540743861.js";import{u as p}from"./commonData.BQ6HGNAS1763540743861.js";import{_ as c}from"./rippleMesh.vue_vue_type_script_setup_true_lang.DiD_IFD51763540743861.js";import{d as u,a9 as f,a as d,q as m,W as y,w as h,H as g,o as v,J as _,b as x,I as j,h as b,F as w,X as P,u as I,m as T}from"./@vue.Co_gxueH1763540743861.js";import{f as k,bS as E,bb as M,h as C}from"./three.rXKzP9fQ1763540743861.js";const F=["rotate-x"],O=["groupChildrenIndex","visible"],X=["args"],S=["color","opacity"],Y=["rotate-x","geometry"],L=u({__name:"oneAreaFloor",props:{areasPrimary:{default:null},showIconText:{default:!0},clickArea:{default:!1},opacity:{default:1},floorId:{default:""}},setup(u){const L=u,A=p(),G={resolution:518,mix:.3,sharpMix:1,blurDepthScale:.2,roughness:1,metalness:.2,normalMap:r.getItem("waterdudv.jpg"),normalScale:new k(.001,.001),reflectorOffset:0},D={digital:"#0099ff",clothes:"#ff33ff",catering:"#E2C166",car:"#00ffff",gift:"#ff6600",empty:"#666666",other:"#eeeeee"},H=(e,o)=>N[o].prop["area-color"]?N[o].prop["area-color"]:e&&D[e]||D.other,J={depth:.4,bevelEnabled:!1},N=[];L.areasPrimary.forEach(e=>{if(e?.geometry&&"Polygon"===e?.geometry.type){s(e,A.centerPos),e.properties.centerXY=a(e,A.centerPos);const o=new E;e.geometry.coordinates.forEach(e=>{for(let r=0;r<e.length;r++){const[t,s]=e[r];0===r&&o.moveTo(t,-s),o.lineTo(t,-s)}});const r=[];o.getPoints().forEach(e=>{r.push([e.x,e.y,J.depth+.02])}),N.push({shape:o,prop:f(e.properties),linePos:r,jid:e.id})}});const W=A.buildingsPrimary,q=new E;W[0].geometry.coordinates.forEach(e=>{for(let o=0;o<e.length;o++){const[r,t]=e[o];0===o&&q.moveTo(r,-t),q.lineTo(r,-t)}});const R=new M(q,{depth:.1,bevelEnabled:!1}),U=d(-1),$=d(null),{camera:z}=e(),B=d(new C);function K(e){if(L.clickArea){var o=new k;o.x=e.clientX/window.innerWidth*2-1,o.y=-e.clientY/window.innerHeight*2+1,B.value.setFromCamera(o,z.value);var r=B.value.intersectObjects($.value.children.filter(e=>e.hasOwnProperty("groupChildrenIndex")));if(r.length>0){const e=r[0].object.groupChildrenIndex;U.value!==e?U.value=e:U.value=-1}}}m(()=>{document.addEventListener("click",K,!1)}),y(()=>{document.removeEventListener("click",K,!1)});const Q=e=>{const o=[];return N[e].linePos.forEach(e=>{o.push({x:e[0],y:-e[1]})}),o};return h(()=>A.selectFloorId,e=>{U.value=-1}),(e,r)=>(v(),g("TresGroup",null,[_("TresGroup",{"rotate-x":-Math.PI/2,position:[0,.15,0],ref_key:"tgRef",ref:$},[(v(),g(w,null,P(N,(e,r)=>(v(),g(w,{key:`${r}`},[_("TresMesh",{"render-order":1,groupChildrenIndex:r,visible:u.opacity>.01},[_("TresExtrudeGeometry",{args:[e.shape,J]},null,8,X),_("TresMeshStandardMaterial",{color:H(e.prop.type,r),roughness:0,metalness:1,polygonOffset:"",polygonOffsetFactor:1,polygonOffsetUnits:1,opacity:.78*u.opacity,transparent:""},null,8,S)],8,O),u.opacity>.01?(v(),x(o,{key:0,points:e.linePos,"line-width":1.6*u.opacity,color:"#ffffff",opacity:.6*u.opacity*u.opacity},null,8,["points","line-width","opacity"])):j("",!0),b(i,{visible:I(A).selectFloorId===u.floorId,position:[e.prop.centerXY.x,-e.prop.centerXY.y,J.depth],showName:e.prop.name,icon:e.prop.icon,iconColor:e.prop["icon-color"]},null,8,["visible","position","showName","icon","iconColor"]),U.value===r?(v(),x(n,{key:1,color:H(e.prop.type,r),itemProp:e.prop,jid:e.jid,position:[e.prop.centerXY.x,-e.prop.centerXY.y,J.depth+.68]},null,8,["color","itemProp","jid","position"])):j("",!0)],64))),64))],8,F),-1!==U.value?(v(),x(I(c),{key:0,name:"rippleMesh",renderOrder:9999,"position-y":.14,positionSrc:Q(U.value),height:.789,color:H(N[U.value].prop.type,U.value),opacity:1,num:5,scale:1.08},null,8,["positionSrc","color"])):j("",!0),u.opacity>.01?(v(),g("TresMesh",{key:1,"rotate-x":-Math.PI/2,"render-order":2,scale:1.02,position:[0,0,0],geometry:I(R)},[b(t,T({color:"black"},G,{opacity:u.opacity,transparent:u.opacity<.6}),null,16,["opacity","transparent"])],8,Y)):j("",!0),b(l,{"rotate-x":-Math.PI/2,visible:I(A).selectFloorId===u.floorId},null,8,["rotate-x","visible"])]))}});export{L as _};
