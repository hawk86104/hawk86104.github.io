import"./@fesjs.Ctw9zm691766394917683.js";import"./Resource.CDqX8L841766394917683.js";/* empty css                                                                             */import{_ as e}from"./default.vue_vue_type_script_setup_true_lang.D9M3cb9D1766394917683.js";import"./three-mesh-ui.module.DmuekFrv1766394917683.js";import"./global.DqhrwlAY1766394917683.js";/* empty css                                                              */import"./shapeConfigurator.vue_vue_type_style_index_1_scoped_abbf0cc1_lang.CXJ66YiI1766394917683.js";import"./three-custom-shader-material.-uIL0IHF1766394917683.js";import{F as o,_ as r}from"./@tresjs.CC-VM6g11766394917683.js";import{u as a}from"./index.BDxfaoh81766394917683.js";import{d as i,ae as n,w as t,G as s,o as l,I as u,a9 as m,aa as d,r as p,t as f,h as v,u as c,e as h,m as _,F as g}from"./@vue.BxPWGdWw1766394917683.js";import{k as j,d as C,a6 as y,bd as b}from"./three.F31Lz30M1766394917683.js";import"./SPE.BkhJ-FkA1766394917683.js";import"./Fetch.CIMEiaKn1766394917683.js";import{P as x}from"./tweakpane.CqZAnw7f1766394917683.js";import{b as D}from"./pagesShow.vue_vue_type_script_setup_true_lang.CFx_Yi121766394917683.js";import"./vue-router.BpdVHiiA1766394917683.js";import"./lodash-es.DWe8oqPO1766394917683.js";import"./pinia.DlDVALGD1766394917683.js";import"./@qlin.y-0Z8WnK1766394917683.js";import"./@babel.BPq7uOAK1766394917683.js";import"./@floating-ui.Bhq4ibgf1766394917683.js";import"./@juggle.Vc7cP4_P1766394917683.js";import"./color.bym48rte1766394917683.js";import"./color-string.C9EhxirS1766394917683.js";import"./color-name.gyPnsvCn1766394917683.js";import"./lodash.BSx7WrW_1766394917683.js";import"./@amap.fjyZdsU91766394917683.js";import"./object-hash.BlsCJiuO1766394917683.js";import"./jszip.CCQtYoU41766394917683.js";import"./postprocessing.DnKKyAPS1766394917683.js";import"./@vueuse.PX2Ih8Bm1766394917683.js";import"./buildingsCustomShaderMaterial.DyBo--wu1766394917683.js";const w={renderOrder:2200},z=["args"],N=i({__name:"depthBufferDiffuse",props:{radius:{default:100},shieldColor:{default:"#ffff00"},rimColor:{default:"#ffffff"},threshold:{default:.005}},setup(e){const i=e,{sizes:p,camera:f}=o(),v=p.aspectRatio.value,c=p.width.value,h=p.height.value,_=a({height:c*v,width:h*v,depth:!0,isLoop:!0}),g={blending:b,transparent:!0,depthWrite:!1,depthTest:!0,side:y,vertexShader:"\n        varying vec2 vUv;\n        varying vec3 vNormal;\n        varying vec3 vPosition;\n        void main() {\n            vUv = uv;\n            vec4 worldPos = modelMatrix * vec4(position, 1.0);\n            vec4 modelNormal = modelMatrix * vec4(normal, 0.0);\n            vec4 mvPosition = viewMatrix * worldPos;\n            gl_Position = projectionMatrix * mvPosition;\n            vNormal = modelNormal.xyz;\n            vPosition = worldPos.xyz;\n        }\n    ",fragmentShader:"\n        uniform sampler2D uDepthTexture; \n        uniform vec2 uResolution;\n        uniform float uNear;\n        uniform float uFar;\n        uniform float uThreshold;\n        uniform vec3 uShieldColor;\n        uniform vec3 uRimColor;\n\n        varying vec2 vUv;\n        varying vec3 vNormal;\n        varying vec3 vPosition;\n\n        #include <packing>\n\n        float LinearizeDepth(float depth) {\n            float zNdc = 2.0 * depth - 1.0;\n            float zEye = (2.0 * uFar * uNear) / ((uFar + uNear) - zNdc * (uFar - uNear));\n            float linearDepth = (zEye - uNear) / (uFar - uNear);\n            return linearDepth;\n        }\n\n        void main() {\n            vec3 normal = normalize(vNormal);\n            if(gl_FrontFacing) {\n                normal *= -1.0;\n            }\n\n            vec3 viewDirection = normalize(cameraPosition - vPosition);\n            float fresnel = 1. + dot(normal, viewDirection);\n            fresnel = pow(fresnel, 4.0);\n\n            vec2 worldCoords = gl_FragCoord.xy/uResolution;\n\n            float sceneDepth = LinearizeDepth(texture2D(uDepthTexture, worldCoords).r);\n            float bubbleDepth = LinearizeDepth(gl_FragCoord.z);\n\n            float difference = abs(sceneDepth - bubbleDepth);\n            float normalizedDistance = clamp(difference / uThreshold, 0.0, 1.0);\n            vec4 intersection = mix(vec4(1.0), vec4(0.0), normalizedDistance);\n            intersection.rgb *= uRimColor;\n\n            vec4 color = vec4(uShieldColor, 0.3);\n            gl_FragColor = color + intersection + vec4(uRimColor, 1.0) * fresnel;\n        }\n    ",uniforms:{uDepthTexture:{value:n(_?.value?.depthTexture)},uResolution:{value:new C(c,h)},uNear:{value:f.value?.near??1},uFar:{value:f.value?.far??1e4},uThreshold:{value:i.threshold},uShieldColor:{value:new j(i.shieldColor)},uRimColor:{value:new j(i.rimColor)}}},{onRender:x}=r();return x(()=>{}),t(()=>[i.rimColor,i.shieldColor,i.threshold],([e,o,r])=>{g.uniforms.uRimColor.value.setStyle(e),g.uniforms.uShieldColor.value.setStyle(o),g.uniforms.uThreshold.value=r}),(e,o)=>(l(),s("TresMesh",w,[u("TresSphereGeometry",{args:[i.radius,64,64]},null,8,z),u("TresShaderMaterial",m(d(g)),null,16)]))}}),P=i({__name:"depthBufferDiffuse",setup(o){const r=p({shieldColor:"#ffff00",rimColor:"#ffffff",threshold:2e-4,radius:100}),a=new x;a.addBinding(r,"shieldColor",{label:"圈颜色"}),a.addBinding(r,"rimColor",{label:"条颜色"}),a.addBinding(r,"threshold",{label:"线条参数",min:1e-5,max:.002,step:1e-5}),a.addBinding(r,"radius",{label:"大小",min:10,max:200,step:1});const i=f(null);return t(()=>i.value?.contextReady,e=>{e&&i.value.context.context.camera.activeCamera.value.position.set(-135,250,320)}),(o,a)=>(l(),s(g,null,[v(c(e)),v(D,{ref_key:"pagesShowRef",ref:i},{ability:h(()=>[v(c(N),_({position:[0,30,0]},r),null,16)]),_:1},512)],64))}});export{P as default};
