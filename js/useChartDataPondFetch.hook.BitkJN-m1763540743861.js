import{a as e}from"./axios.BTiLLHcy1763540743861.js";import{v as t,y as a,C as r,z as s,x as n,w as o}from"./global.BBGVMLjY1763540743861.js";import{c,w as l,a9 as u}from"./@vue.Co_gxueH1763540743861.js";const i="javascript:",d=e=>{if("string"==typeof e){if(e.startsWith(i)){const a=e.split(i)[1];let r;try{r=new Function(`${a}`)()}catch(t){console.log(t),window.$message.error("js内容解析有误！")}return r}return e}for(const a in e)if(Object.prototype.hasOwnProperty.call(e,a)){const t=e[a];e[a]=d(t)}return e},f=(n,o)=>{if(!n||!o)return;const{requestOriginUrl:c,requestParams:l}=o,{requestUrl:u,requestContentType:i,requestDataType:f,requestHttpType:p,requestParamsBodyType:q,requestSQLContent:y,requestParams:m}=n;if(f===t.STATIC)return;if(!u)return;let C={...l.Header,...m.Header};C=d(C);let g={},P={...m.Params};P=d(P);let w=new FormData;switch(q){case a.NONE:break;case a.JSON:C["Content-Type"]=r.JSON,g=d(m.Body.json),"string"==typeof g&&(g=JSON.parse(g));break;case a.XML:C["Content-Type"]=r.XML,g=d(m.Body.xml);break;case a.X_WWW_FORM_URLENCODED:{C["Content-Type"]=r.FORM_URLENCODED;const e=m.Body["x-www-form-urlencoded"];for(const t in e)w.set(t,d(e[t]));g=w;break}case a.FORM_DATA:{C["Content-Type"]=r.FORM_DATA;const e=m.Body["form-data"];for(const t in e)w.set(t,d(e[t]));g=w;break}}i===s.SQL&&(C["Content-Type"]=r.JSON,g=y);try{const t=new Function("return `"+`${c}${u}`.trim()+"`")();return e({url:t,method:p,data:g,params:P,headers:C})}catch(b){console.log(b),window.$message.error("URL地址格式有误！")}},p=new Map,q=(e,t,a)=>{if(!a)return;let r=0;clearInterval(r);const s=async()=>{try{const s=await f(u(t.value.dataPondRequestConfig),u(e));if(s)try{a.forEach(e=>{e.updateCallback(o(s?.data,s,e.filter))})}catch(r){return console.error(r),r}}catch(r){return r}};l(()=>t.value.dataPondRequestConfig.requestParams.Params,()=>{s()},{immediate:!1,deep:!0}),s();const c=t.value.dataPondRequestConfig.requestInterval,i=t.value.dataPondRequestConfig.requestIntervalUnit,d=e.requestInterval,p=e.requestIntervalUnit,q=c||d;q&&(r=setInterval(s,n(q,c?i:p)))},y=()=>({addGlobalDataInterface:(e,t,a)=>{const r=t(),{requestDataPond:s}=r.getRequestGlobalConfig,n=e.request.requestDataPondId,o=p.get(n)||[];o.push({updateCallback:a,filter:e.filter}),p.set(n,o)},clearMittDataPondMap:()=>{p.clear()},initDataPond:e=>{const{requestGlobalConfig:t}=e(),a=e();for(let r of p.keys()){const e=c(()=>t.requestDataPond.find(e=>e.dataPondId===r));e&&q(a.requestGlobalConfig,e,p.get(r))}}});export{f as c,y as u};
