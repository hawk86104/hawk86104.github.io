{"version":3,"file":"obliquePhoto.vue_vue_type_script_setup_true_lang.BUTwkNtD1767105581793.js","sources":["../../src/plugins/simpleGIS/components/obliquePhoto.vue"],"sourcesContent":["<!--\n * @Description: \n * @Version: 1.668\n * @Autor: 地虎降天龙\n * @Date: 2025-09-01 09:14:44\n * @LastEditors: 地虎降天龙\n * @LastEditTime: 2025-09-29 12:33:04\n-->\n<template>\n    <TresGroup ref=\"groupRef\">\n        <primitive :object=\"tiles.group\" />\n    </TresGroup>\n</template>\n\n<script lang=\"ts\" setup>\nimport { useTres, useLoop } from '@tresjs/core'\nimport { TilesRenderer } from '3d-tiles-renderer'\nimport { watch, ref } from 'vue'\nimport { alignmentCenter, applyTransform } from '../common/utils'\n\nconst props = withDefaults(\n    defineProps<{\n        tilesUrl?: string\n        isRotation?: boolean\n        isRranslation?: boolean\n    }>(),\n    {\n        tilesUrl: './plugins/geokit/tiles/tileset.json',\n        isRotation: false,\n        isRranslation: true,\n    },\n)\n\nconst groupRef = ref(null as any)\nconst { camera, renderer, sizes } = useTres()\nconst setCameraAndRenderer = (newTiles: any, camera: any, renderer: any) => {\n    newTiles.setCamera(camera)\n    newTiles.setResolutionFromRenderer(camera, renderer)\n}\nconst makeNewTiles = () => {\n    let newTiles = new TilesRenderer(props.tilesUrl as string) as any\n    newTiles.fetchOptions.mode = 'cors'\n\n    newTiles.addEventListener('load-tile-set', () => {\n        alignmentCenter(newTiles, props.isRotation, props.isRranslation)\n    })\n    newTiles.addEventListener('dispose-model', ({ scene }) => {\n        scene.traverse((c: any) => {\n            if (c.material) {\n                c.material.dispose()\n            }\n        })\n    })\n\n    setCameraAndRenderer(newTiles, camera.value, renderer)\n    return newTiles\n}\nlet tiles = makeNewTiles()\n\nwatch(\n    () => [props.isRotation, props.isRranslation],\n    () => {\n        if (tiles.group) {\n            applyTransform(tiles.group, props.isRotation, props.isRranslation)\n        }\n    },\n)\n\nwatch(\n    camera,\n    () => {\n        if (camera.value) {\n            setCameraAndRenderer(tiles, camera.value, renderer)\n        }\n    },\n    { immediate: true },\n)\nconst { onBeforeRender } = useLoop()\nonBeforeRender(() => {\n    if (camera.value && sizes.width.value && tiles.update) {\n        camera.value.updateMatrixWorld()\n        tiles.update()\n    }\n})\nwatch(\n    () => props.tilesUrl,\n    (tilesUrl) => {\n        if (tilesUrl !== tiles.rootURL) {\n            tiles.dispose()\n            tiles = makeNewTiles()\n        }\n    },\n)\ndefineExpose({\n    group: groupRef,\n    tilesGroup: tiles.group,\n})\n</script>\n"],"names":["useTres","camera","renderer","TilesRenderer","useLoop"],"mappings":"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"}