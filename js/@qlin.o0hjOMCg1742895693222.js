class t{constructor(){this.middlewares=[]}use(t){return this.middlewares.push(t),this}compose(){return(t,e)=>{let r=-1;const n=o=>{if(o<=r)return Promise.reject(new Error("next() called multiple times"));r=o;let c=this.middlewares[o];if(r===this.middlewares.length&&(c=e),!c)return Promise.resolve();try{return Promise.resolve(c(t,n.bind(null,o+1)))}catch(a){return Promise.reject(a)}};return n(0)}}}const e=async(t,e)=>{t.config.method?t.config.method=t.config.method.toUpperCase():t.config.method="POST",await e()};const r="object"==typeof global&&global&&global.Object===Object&&global;var n="object"==typeof self&&self&&self.Object===Object&&self;const o=r||n||Function("return this")();const c=o.Symbol;var a=Object.prototype,i=a.hasOwnProperty,u=a.toString,s=c?c.toStringTag:void 0;var f=Object.prototype.toString;var l="[object Null]",p="[object Undefined]",y=c?c.toStringTag:void 0;function h(t){return null==t?void 0===t?p:l:y&&y in Object(t)?function(t){var e=i.call(t,s),r=t[s];try{t[s]=void 0;var n=!0}catch{}var o=u.call(t);return n&&(e?t[s]=r:delete t[s]),o}(t):function(t){return f.call(t)}(t)}function b(t){return null!=t&&"object"==typeof t}var d="[object Symbol]";function v(t){return"symbol"==typeof t||b(t)&&h(t)==d}function g(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}const j=Array.isArray;var m=1/0,_=c?c.prototype:void 0,w=_?_.toString:void 0;function O(t){if("string"==typeof t)return t;if(j(t))return g(t,O)+"";if(v(t))return w?w.call(t):"";var e=t+"";return"0"==e&&1/t==-m?"-0":e}function A(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var T="[object AsyncFunction]",S="[object Function]",x="[object GeneratorFunction]",P="[object Proxy]";function k(t){if(!A(t))return!1;var e=h(t);return e==S||e==x||e==T||e==P}const E=o["__core-js_shared__"];var I,q=(I=/[^.]+$/.exec(E&&E.keys&&E.keys.IE_PROTO||""))?"Symbol(src)_1."+I:"";var z=Function.prototype.toString;function U(t){if(null!=t){try{return z.call(t)}catch{}try{return t+""}catch{}}return""}var $=/^\[object .+?Constructor\]$/,D=Function.prototype,M=Object.prototype,C=D.toString,F=M.hasOwnProperty,R=RegExp("^"+C.call(F).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function B(t){return!(!A(t)||function(t){return!!q&&q in t}(t))&&(k(t)?R:$).test(U(t))}function H(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return B(r)?r:void 0}const L=H(o,"WeakMap");var N=Object.create,V=function(){function t(){}return function(e){if(!A(e))return{};if(N)return N(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();const W=V;var J=Date.now;function G(t){return function(){return t}}var Q=function(){try{var t=H(Object,"defineProperty");return t({},"",{}),t}catch{}}();const K=Q;var X=K?function(t,e){return K(t,"toString",{configurable:!0,enumerable:!1,value:G(e),writable:!0})}:function(t){return t};var Y=function(t){var e=0,r=0;return function(){var n=J(),o=16-(n-r);if(r=n,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(X);const Z=Y;var tt=9007199254740991,et=/^(?:0|[1-9]\d*)$/;function rt(t,e){var r=typeof t;return!!(e=e??tt)&&("number"==r||"symbol"!=r&&et.test(t))&&t>-1&&t%1==0&&t<e}function nt(t,e,r){"__proto__"==e&&K?K(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}function ot(t,e){return t===e||t!=t&&e!=e}var ct=Object.prototype.hasOwnProperty;function at(t,e,r){var n=t[e];(!ct.call(t,e)||!ot(n,r)||void 0===r&&!(e in t))&&nt(t,e,r)}function it(t,e,r,n){var o=!r;r||(r={});for(var c=-1,a=e.length;++c<a;){var i=e[c],u=n?n(r[i],t[i],i,r,t):void 0;void 0===u&&(u=t[i]),o?nt(r,i,u):at(r,i,u)}return r}var ut=Math.max;var st=9007199254740991;function ft(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=st}function lt(t){return null!=t&&ft(t.length)&&!k(t)}var pt=Object.prototype;function yt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||pt)}function ht(t){return b(t)&&"[object Arguments]"==h(t)}var bt=Object.prototype,dt=bt.hasOwnProperty,vt=bt.propertyIsEnumerable,gt=ht(function(){return arguments}())?ht:function(t){return b(t)&&dt.call(t,"callee")&&!vt.call(t,"callee")};const jt=gt;var mt="object"==typeof exports&&exports&&!exports.nodeType&&exports,_t=mt&&"object"==typeof module&&module&&!module.nodeType&&module,wt=_t&&_t.exports===mt?o.Buffer:void 0;const Ot=(wt?wt.isBuffer:void 0)||function(){return!1};var At={};function Tt(t){return function(e){return t(e)}}At["[object Float32Array]"]=At["[object Float64Array]"]=At["[object Int8Array]"]=At["[object Int16Array]"]=At["[object Int32Array]"]=At["[object Uint8Array]"]=At["[object Uint8ClampedArray]"]=At["[object Uint16Array]"]=At["[object Uint32Array]"]=!0,At["[object Arguments]"]=At["[object Array]"]=At["[object ArrayBuffer]"]=At["[object Boolean]"]=At["[object DataView]"]=At["[object Date]"]=At["[object Error]"]=At["[object Function]"]=At["[object Map]"]=At["[object Number]"]=At["[object Object]"]=At["[object RegExp]"]=At["[object Set]"]=At["[object String]"]=At["[object WeakMap]"]=!1;var St="object"==typeof exports&&exports&&!exports.nodeType&&exports,xt=St&&"object"==typeof module&&module&&!module.nodeType&&module,Pt=xt&&xt.exports===St&&r.process;const kt=function(){try{return xt&&xt.require&&xt.require("util").types||Pt&&Pt.binding&&Pt.binding("util")}catch{}}();var Et=kt&&kt.isTypedArray,It=Et?Tt(Et):function(t){return b(t)&&ft(t.length)&&!!At[h(t)]};const qt=It;var zt=Object.prototype.hasOwnProperty;function Ut(t,e){var r=j(t),n=!r&&jt(t),o=!r&&!n&&Ot(t),c=!r&&!n&&!o&&qt(t),a=r||n||o||c,i=a?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],u=i.length;for(var s in t)(e||zt.call(t,s))&&(!a||!("length"==s||o&&("offset"==s||"parent"==s)||c&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||rt(s,u)))&&i.push(s);return i}function $t(t,e){return function(r){return t(e(r))}}const Dt=$t(Object.keys,Object);var Mt=Object.prototype.hasOwnProperty;function Ct(t){return lt(t)?Ut(t):function(t){if(!yt(t))return Dt(t);var e=[];for(var r in Object(t))Mt.call(t,r)&&"constructor"!=r&&e.push(r);return e}(t)}var Ft=Object.prototype.hasOwnProperty;function Rt(t){if(!A(t))return function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}(t);var e=yt(t),r=[];for(var n in t)"constructor"==n&&(e||!Ft.call(t,n))||r.push(n);return r}function Bt(t){return lt(t)?Ut(t,!0):Rt(t)}var Ht=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Lt=/^\w*$/;const Nt=H(Object,"create");var Vt=Object.prototype.hasOwnProperty;var Wt=Object.prototype.hasOwnProperty;function Jt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Gt(t,e){for(var r=t.length;r--;)if(ot(t[r][0],e))return r;return-1}Jt.prototype.clear=function(){this.__data__=Nt?Nt(null):{},this.size=0},Jt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Jt.prototype.get=function(t){var e=this.__data__;if(Nt){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return Vt.call(e,t)?e[t]:void 0},Jt.prototype.has=function(t){var e=this.__data__;return Nt?void 0!==e[t]:Wt.call(e,t)},Jt.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Nt&&void 0===e?"__lodash_hash_undefined__":e,this};var Qt=Array.prototype.splice;function Kt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Kt.prototype.clear=function(){this.__data__=[],this.size=0},Kt.prototype.delete=function(t){var e=this.__data__,r=Gt(e,t);return!(r<0)&&(r==e.length-1?e.pop():Qt.call(e,r,1),--this.size,!0)},Kt.prototype.get=function(t){var e=this.__data__,r=Gt(e,t);return r<0?void 0:e[r][1]},Kt.prototype.has=function(t){return Gt(this.__data__,t)>-1},Kt.prototype.set=function(t,e){var r=this.__data__,n=Gt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};const Xt=H(o,"Map");function Yt(t,e){var r=t.__data__;return function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}(e)?r["string"==typeof e?"string":"hash"]:r.map}function Zt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Zt.prototype.clear=function(){this.size=0,this.__data__={hash:new Jt,map:new(Xt||Kt),string:new Jt}},Zt.prototype.delete=function(t){var e=Yt(this,t).delete(t);return this.size-=e?1:0,e},Zt.prototype.get=function(t){return Yt(this,t).get(t)},Zt.prototype.has=function(t){return Yt(this,t).has(t)},Zt.prototype.set=function(t,e){var r=Yt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};var te="Expected a function";function ee(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(te);var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],c=r.cache;if(c.has(o))return c.get(o);var a=t.apply(this,n);return r.cache=c.set(o,a)||c,a};return r.cache=new(ee.Cache||Zt),r}ee.Cache=Zt;var re=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ne=/\\(\\)?/g,oe=function(t){var e=ee(t,(function(t){return 500===r.size&&r.clear(),t})),r=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(re,(function(t,r,n,o){e.push(n?o.replace(ne,"$1"):r||t)})),e}));const ce=oe;function ae(t,e){return j(t)?t:function(t,e){if(j(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!v(t))||Lt.test(t)||!Ht.test(t)||null!=e&&t in Object(e)}(t,e)?[t]:ce(function(t){return null==t?"":O(t)}(t))}var ie=1/0;function ue(t){if("string"==typeof t||v(t))return t;var e=t+"";return"0"==e&&1/t==-ie?"-0":e}function se(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}var fe=c?c.isConcatSpreadable:void 0;function le(t){return j(t)||jt(t)||!!(fe&&t&&t[fe])}function pe(t,e,r,n,o){var c=-1,a=t.length;for(r||(r=le),o||(o=[]);++c<a;){var i=t[c];e>0&&r(i)?e>1?pe(i,e-1,r,n,o):se(o,i):n||(o[o.length]=i)}return o}function ye(t){return(null==t?0:t.length)?pe(t,1):[]}const he=$t(Object.getPrototypeOf,Object);var be="[object Object]",de=Function.prototype,ve=Object.prototype,ge=de.toString,je=ve.hasOwnProperty,me=ge.call(Object);function _e(t){if(!b(t)||h(t)!=be)return!1;var e=he(t);if(null===e)return!0;var r=je.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&ge.call(r)==me}function we(t){var e=this.__data__=new Kt(t);this.size=e.size}we.prototype.clear=function(){this.__data__=new Kt,this.size=0},we.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},we.prototype.get=function(t){return this.__data__.get(t)},we.prototype.has=function(t){return this.__data__.has(t)},we.prototype.set=function(t,e){var r=this.__data__;if(r instanceof Kt){var n=r.__data__;if(!Xt||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new Zt(n)}return r.set(t,e),this.size=r.size,this};var Oe="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ae=Oe&&"object"==typeof module&&module&&!module.nodeType&&module,Te=Ae&&Ae.exports===Oe?o.Buffer:void 0,Se=Te?Te.allocUnsafe:void 0;function xe(){return[]}var Pe=Object.prototype.propertyIsEnumerable,ke=Object.getOwnPropertySymbols,Ee=ke?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,c=[];++r<n;){var a=t[r];e(a,r,t)&&(c[o++]=a)}return c}(ke(t),(function(e){return Pe.call(t,e)})))}:xe;const Ie=Ee;var qe=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)se(e,Ie(t)),t=he(t);return e}:xe;const ze=qe;function Ue(t,e,r){var n=e(t);return j(t)?n:se(n,r(t))}function $e(t){return Ue(t,Ct,Ie)}function De(t){return Ue(t,Bt,ze)}const Me=H(o,"DataView");const Ce=H(o,"Promise");const Fe=H(o,"Set");var Re="[object Map]",Be="[object Promise]",He="[object Set]",Le="[object WeakMap]",Ne="[object DataView]",Ve=U(Me),We=U(Xt),Je=U(Ce),Ge=U(Fe),Qe=U(L),Ke=h;(Me&&Ke(new Me(new ArrayBuffer(1)))!=Ne||Xt&&Ke(new Xt)!=Re||Ce&&Ke(Ce.resolve())!=Be||Fe&&Ke(new Fe)!=He||L&&Ke(new L)!=Le)&&(Ke=function(t){var e=h(t),r="[object Object]"==e?t.constructor:void 0,n=r?U(r):"";if(n)switch(n){case Ve:return Ne;case We:return Re;case Je:return Be;case Ge:return He;case Qe:return Le}return e});const Xe=Ke;var Ye=Object.prototype.hasOwnProperty;const Ze=o.Uint8Array;function tr(t){var e=new t.constructor(t.byteLength);return new Ze(e).set(new Ze(t)),e}var er=/\w*$/;var rr=c?c.prototype:void 0,nr=rr?rr.valueOf:void 0;var or="[object Boolean]",cr="[object Date]",ar="[object Map]",ir="[object Number]",ur="[object RegExp]",sr="[object Set]",fr="[object String]",lr="[object Symbol]",pr="[object ArrayBuffer]",yr="[object DataView]",hr="[object Float32Array]",br="[object Float64Array]",dr="[object Int8Array]",vr="[object Int16Array]",gr="[object Int32Array]",jr="[object Uint8Array]",mr="[object Uint8ClampedArray]",_r="[object Uint16Array]",wr="[object Uint32Array]";function Or(t,e,r){var n=t.constructor;switch(e){case pr:return tr(t);case or:case cr:return new n(+t);case yr:return function(t,e){var r=e?tr(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}(t,r);case hr:case br:case dr:case vr:case gr:case jr:case mr:case _r:case wr:return function(t,e){var r=e?tr(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}(t,r);case ar:return new n;case ir:case fr:return new n(t);case ur:return function(t){var e=new t.constructor(t.source,er.exec(t));return e.lastIndex=t.lastIndex,e}(t);case sr:return new n;case lr:return function(t){return nr?Object(nr.call(t)):{}}(t)}}var Ar=kt&&kt.isMap,Tr=Ar?Tt(Ar):function(t){return b(t)&&"[object Map]"==Xe(t)};const Sr=Tr;var xr=kt&&kt.isSet,Pr=xr?Tt(xr):function(t){return b(t)&&"[object Set]"==Xe(t)};const kr=Pr;var Er="[object Arguments]",Ir="[object Function]",qr="[object Object]",zr={};function Ur(t,e,r,n,o,c){var a,i=1&e,u=2&e,s=4&e;if(r&&(a=o?r(t,n,o,c):r(t)),void 0!==a)return a;if(!A(t))return t;var f=j(t);if(f){if(a=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&Ye.call(t,"index")&&(r.index=t.index,r.input=t.input),r}(t),!i)return function(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}(t,a)}else{var l=Xe(t),p=l==Ir||"[object GeneratorFunction]"==l;if(Ot(t))return function(t,e){if(e)return t.slice();var r=t.length,n=Se?Se(r):new t.constructor(r);return t.copy(n),n}(t,i);if(l==qr||l==Er||p&&!o){if(a=u||p?{}:function(t){return"function"!=typeof t.constructor||yt(t)?{}:W(he(t))}(t),!i)return u?function(t,e){return it(t,ze(t),e)}(t,function(t,e){return t&&it(e,Bt(e),t)}(a,t)):function(t,e){return it(t,Ie(t),e)}(t,function(t,e){return t&&it(e,Ct(e),t)}(a,t))}else{if(!zr[l])return o?t:{};a=Or(t,l,i)}}c||(c=new we);var y=c.get(t);if(y)return y;c.set(t,a),kr(t)?t.forEach((function(n){a.add(Ur(n,e,r,n,t,c))})):Sr(t)&&t.forEach((function(n,o){a.set(o,Ur(n,e,r,o,t,c))}));var h=f?void 0:(s?u?De:$e:u?Bt:Ct)(t);return function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););}(h||t,(function(n,o){h&&(n=t[o=n]),at(a,o,Ur(n,e,r,o,t,c))})),a}zr[Er]=zr["[object Array]"]=zr["[object ArrayBuffer]"]=zr["[object DataView]"]=zr["[object Boolean]"]=zr["[object Date]"]=zr["[object Float32Array]"]=zr["[object Float64Array]"]=zr["[object Int8Array]"]=zr["[object Int16Array]"]=zr["[object Int32Array]"]=zr["[object Map]"]=zr["[object Number]"]=zr[qr]=zr["[object RegExp]"]=zr["[object Set]"]=zr["[object String]"]=zr["[object Symbol]"]=zr["[object Uint8Array]"]=zr["[object Uint8ClampedArray]"]=zr["[object Uint16Array]"]=zr["[object Uint32Array]"]=!0,zr["[object Error]"]=zr[Ir]=zr["[object WeakMap]"]=!1;var $r="[object String]";function Dr(t,e){return e.length<2?t:function(t,e){for(var r=0,n=(e=ae(e,t)).length;null!=t&&r<n;)t=t[ue(e[r++])];return r&&r==n?t:void 0}(t,function(t,e,r){var n=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(r=r>o?o:r)<0&&(r+=o),o=e>r?0:r-e>>>0,e>>>=0;for(var c=Array(o);++n<o;)c[n]=t[n+e];return c}(e,0,-1))}function Mr(t,e){return null==(t=Dr(t,e=ae(e,t)))||delete t[ue(function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0}(e))]}function Cr(t){return _e(t)?void 0:t}var Fr=function(t){return Z(function(t,e,r){return e=ut(void 0===e?t.length-1:e,0),function(){for(var n=arguments,o=-1,c=ut(n.length-e,0),a=Array(c);++o<c;)a[o]=n[e+o];o=-1;for(var i=Array(e+1);++o<e;)i[o]=n[o];return i[e]=r(a),function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}(t,this,i)}}(t,void 0,ye),t+"")}((function(t,e){var r={};if(null==t)return r;var n=!1;e=g(e,(function(e){return e=ae(e,t),n||(n=e.length>1),e})),it(t,De(t),r),n&&(r=Ur(r,7,Cr));for(var o=e.length;o--;)Mr(r,e[o]);return r}));const Rr=Fr;function Br(t){return"[object URLSearchParams]"===Object.prototype.toString.call(t)}function Hr(t){return{GET:{request_body:!1},POST:{request_body:!0},PUT:{request_body:!0},DELETE:{request_body:!0},HEAD:{request_body:!1},OPTIONS:{request_body:!1},PATCH:{request_body:!0}}[t=t.toUpperCase()].request_body}function Lr(t){_e(t)&&Object.entries(t).forEach((([e,r])=>{"string"==typeof r?t[e]=r.trim():_e(r)&&Lr(r)}))}const Nr=async(t,e)=>{Hr(t.config.method)&&Lr(t.config.params),await e()};const Vr=async(t,e)=>{t.reqHeaders=new Headers(t.config.headers),t.reqHeaders.has("Content-Type")||(t.config.params instanceof FormData?function(t){for(const[e,r]of t.entries())if(r instanceof Blob)return!0;return!1}(t.config.params)||t.reqHeaders.set("Content-Type","application/x-www-form-urlencoded"):_e(t.config.params)&&t.reqHeaders.set("Content-Type","application/json")),await e()};const Wr=async(t,e)=>{t.config.baseURL&&!function(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}(t.config.url)&&(t.config.url=function(t,e){return e?`${t.replace(/\/+$/,"")}/${e.replace(/^\/+/,"")}`:t}(t.config.baseURL,t.config.url)),await e()},Jr=t=>Br(t)?t.toString():"string"==typeof t?t:_e(t)?JSON.stringify(t):"";async function Gr(t,e){if(t.config.params){const e=Jr(t.config.params);e&&(t.key=`${t.config.url}${e}${t.config.method}`)}else t.key=`${t.config.url}${t.config.method}`;await e()}const Qr=()=>{const t=new Map,e=new Map,r=new Map;return async(n,o)=>{if(n.key)if(n.config.mergeRequest){const t=await function(t){if(e.get(t.key))return new Promise((e=>{const n=r.get(t.key)||[];r.set(t.key,n.concat(e))}));e.set(t.key,!0)}(n);if(t)return void Object.keys(t).forEach((e=>{n[e]=t[e]}))}else{if(t.get(n.key)&&!n.config.mergeRequest)return void(n.error={type:"REPEAT",msg:"重复请求"});t.set(n.key,!0)}await o(),n.key&&(n.config.mergeRequest?function(t){const n=r.get(t.key);n&&n.length>0&&n.forEach((e=>{t.error?e({error:t.error}):e({response:t.response})})),r.delete(t.key),e.delete(t.key)}(n):t.delete(n.key))}},Kr="__REQUEST_CACHE:",Xr={ram:"ram",session:"sessionStorage",local:"localStorage"},Yr=18e4;function Zr(t,e="ram"){return e!==Xr.ram?`${Kr}${t}`:t}function tn(t){return _e(t)||function(t){return"string"==typeof t||!j(t)&&b(t)&&h(t)==$r}(t)||Array.isArray(t)||Br(t)}function en({expire:t,cacheTime:e}){return!(!e||t>=Date.now())}class rn{constructor(){this.data=new Map}get(t){const e=this.data.get(t);return e&&en(e)?(this.data.delete(t),null):e?e.data:null}set(t,e){this.data.forEach(((t,e,r)=>{en(t)&&r.delete(e)})),this.data.size>1e3?console.warn("Request: raw cache is exceed 1000 item, please check cache size"):this.data.set(t,e)}delete(t){this.data.delete(t)}}const nn=()=>{const t=new rn;const e=new Map,r=new Map;return async(n,o)=>{if(function(t){return!(!t.config.cacheData||!t.key&&(console.warn(`request: ${t.config.url} 请求参数无法序列化，无法缓存，请移除相关配置`),1))}(n)){const c=function(t){return"object"==typeof t.config.cacheData?t.config.cacheData:{cacheType:"ram",cacheTime:Yr}}(n),a=function({key:e,cacheType:r="ram"}){const n=Zr(e,r);if(r===Xr.ram)return t.get(n);{const t=window[Xr[r]],e=t.getItem(n)||null;try{const r=JSON.parse(e);return r&&!en(r)?r.data:(t.removeItem(n),null)}catch{return t.removeItem(n),null}}}({key:n.key,cacheType:c.cacheType});if(a)return void(n.response=a);const i=await function(t,n){const o=Zr(t.key,n.cacheType);if(e.get(o))return new Promise((t=>{const e=r.get(o)||[];r.set(o,e.concat(t))}));e.set(o,!0)}(n,c);if(i)return void Object.keys(i).forEach((t=>{n[t]=i[t]}));await o(),tn(n.response)||console.warn(`request: ${n.config.url} 响应数据无法序列化，无法缓存，请移除相关配置`),!n.error&&n.response&&tn(n.response)?(function(t,n){const o=Zr(t.key,n.cacheType),c=r.get(o);c&&c.length>0&&c.forEach((e=>{e({response:t.response})})),r.delete(o),e.delete(o)}(n,c),function({key:e,cacheType:r="ram",data:n,cacheTime:o=Yr}){const c=Zr(e,r),a={cacheType:r,data:n,cacheTime:o,expire:Date.now()+o};if(r!==Xr.ram){const t=window[Xr[r]];try{t.setItem(c,JSON.stringify(a))}catch{for(const e in t)e.startsWith(Kr)&&Object.prototype.hasOwnProperty.call(t,e)&&t.removeItem(e)}}else t.set(c,a)}({key:n.key,data:n.response,...c})):function(t,n){const o=Zr(t.key,n.cacheType),c=r.get(o);c&&c.length>0?(c.shift()(),r.set(o,c)):(r.delete(o),e.delete(o))}(n,c)}else await o()}},on=t=>new Promise(((e,r)=>{setTimeout((()=>{r({type:"TIMEOUT",msg:"请求超时"})}),t)})),cn=t=>{if(Hr(t.config.method)){const e=t.config.params;if(_e(e)){if(["application/x-www-form-urlencoded","multipart/form-data"].includes(t.reqHeaders.get("Content-Type"))){const t=new FormData;return Object.keys(e).forEach((r=>{t.append(r,e[r])})),t}return JSON.stringify(e)}return e}},an=t=>{const e={};return t.forEach(((t,r)=>{e[r]=t})),e},un=t=>fetch((t=>{if(!Hr(t.config.method)){let e;return Br(t.config.params)&&(e=t.config.params.toString()),_e(t.config.params)&&(e=new URLSearchParams(t.config.params).toString()),e?`${t.config.url}?${e}`:t.config.url}return t.config.url})(t),{...Rr(t.config,["baseURL","timeout","requestInterceptor","responseInterceptor","transformData","errorHandler","responseType"]),headers:an(t.reqHeaders),body:cn(t)}).then((async e=>{if("opaqueredirect"===e.type&&(location.href=e.url),e.ok){const r=e.headers.get("content-type");let n;n=/application\/json/i.test(r)||"json"===t.config.responseType?await e.json():/text|xml/.test(r)||"text"===t.config.responseType?await e.text():"arrayBuffer"===t.config.responseType?await e.arrayBuffer():"formData"===t.config.responseType?await e.formData():(t.config.responseType,await e.blob());let o={status:e.status,data:n,headers:an(e.headers)};return"function"==typeof t.config.responseInterceptor&&(o=await t.config.responseInterceptor(o)),k(t.config.transformData)&&(o.data=await t.config.transformData(n,o)),o}return Promise.reject({response:{status:e.status,headers:an(e.headers)}})}));async function sn(t,e){await Promise.race([on(t.config.timeout),un(t)]).then((e=>{t.response=e})).catch((e=>{t.error=e})),await e()}function fn(t){let e=[];return"function"==typeof t?e=[t]:Array.isArray(t)&&(e=t),e}function ln(t){const e=fn(t);return async(t,r)=>{let n=t;for(const o of e)n=await o(n,r);return n}}function pn(t){const e=fn(t);return async(t,r)=>{let n=t;for(const o of e)n=await o(n,r);return n}}function yn(r){const n={timeout:1e4,credentials:"include",...r},o=(new t).use(e).use(Wr).use(Vr).use(Nr).use(Gr).use(nn()).use(Qr()).use(sn).compose(),c=ln(n.requestInterceptor),a=pn(n.responseInterceptor);return async(t,e,r)=>{const i={config:{url:t,params:e,...n,...r}};return null!=r&&r.requestInterceptor?i.config=await ln(r.requestInterceptor)(i.config,c):n.requestInterceptor&&(i.config=await c(i.config)),null!=r&&r.responseInterceptor&&(i.config.responseInterceptor=t=>pn(r.responseInterceptor)(t,a)),o(i).then((async()=>{var t,e;return i.response?i.response:(i.error.config||(i.error.config=i.config),null==(e=(t=i.config).errorHandler)||e.call(t,i.error),Promise.reject(i.error))}))}}export{yn as C};
