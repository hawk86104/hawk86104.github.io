import{i as e}from"./3d-tiles-renderer.CbgZh8zU1767066396612.js";import{P as t}from"./tweakpane.CqZAnw7f1767066396612.js";import{l as a,_ as o,b as n}from"./pagesShow.vue_vue_type_script_setup_true_lang.BYHBnewB1767066396612.js";import{h as i}from"./heatmap.js-fix.BJV_bZ8C1767066396612.js";import{r}from"./utils.DguR31dd1767066396612.js";import{m as s}from"./three.BD1hRFgo1767066396612.js";import{d as l}from"./pinia.CiNhMlOJ1767066396612.js";import{c as u,d as p,a as c}from"./three-mesh-bvh.BBErpT9w1767066396612.js";import{_ as m}from"./@fesjs.BK66sTPr1767066396612.js";const{MathUtils:d}=await e("three"),v=(e,t)=>e.getValueAt(t)+-10,{ref:h}=await e("vue"),f=l("buildingsHeatmap",()=>{const e=h(!1),t=h(0);return{showDiv:e,temperature:t,setShowDiv:function(t){e.value=t},setTemperature:function(e){t.value=e}}}),{defineComponent:y}=await e("vue"),{unref:w,createElementVNode:g,Fragment:x,openBlock:_,createElementBlock:b}=await e("vue"),j=["object","rotation-x"],M=["object"],{watchEffect:B}=await e("vue"),D=await e("three"),S=y({__name:"buildingsHeatmap",props:{model:{},opacity:{default:1}},setup(e){D.BufferGeometry.prototype.computeBoundsTree=u,D.BufferGeometry.prototype.disposeBoundsTree=p,D.Mesh.prototype.raycast=c;const t=e,a=((e=250,t=250,a=!0)=>{const o=document.createElement("heatmap-canvas");return o.style.position="absolute",a||(o.style.display="none"),o.style.top="0",o.style.left="0",document.body.appendChild(o),i.create({container:o,width:e,height:t,blur:".8",radius:10,gradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"}})})();((e,t)=>{if(!t){let a=0;for(t=[];a<1e3;)t.push({x:d.randInt(1,e._config.width),y:d.randInt(1,e._config.height),value:d.randInt(-10,36)}),a++}e.setData({max:36,min:-10,data:t})})(a);const o=new D.Texture(a._renderer.canvas);o.needsUpdate=!0;const n=t.model.city.clone();delete n.geometry.attributes.normal,delete n.geometry.attributes.uv;const l=n.geometry.clone().applyMatrix4(n.matrix),m=t.model.land.clone();delete m.geometry.attributes.normal;const h=m.geometry.clone().applyMatrix4(m.matrix),y=s([l,h]);y.applyMatrix4((new D.Matrix4).makeRotationX(Math.PI/2)),r(y),y.computeBoundsTree();const S=(k=o,new D.ShaderMaterial({vertexShader:"\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t\t\tvUv = uv;\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform sampler2D heightMap;\n\t\tuniform float uOpacity;\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tgl_FragColor = vec4(texture2D(heightMap, vUv.xy).rgb, uOpacity);\n    }\n\t\t",uniforms:{uOpacity:{value:t.opacity},heightMap:{type:"t",value:k}},depthWrite:!0,depthTest:!0,transparent:!0,side:D.DoubleSide}));var k;const E=new D.Mesh(y,S);B(()=>{t.opacity&&(S.uniforms.uOpacity.value=t.opacity)});const P=f(),T=e=>{if(e){const t={x:e.uv.x*a._config.width,y:(1-e.uv.y)*a._config.height};console.log("数值：",e),console.log("数值———：",v(a,t)),P.setTemperature(v(a,t))}},U=e=>{e&&P.$patch({showDiv:!0})},C=e=>{e&&P.setShowDiv(!1)};return(e,a)=>(_(),b(x,null,[g("primitive",{object:w(E),"rotation-x":-Math.PI/2,onPointermove:T,onPointerenter:U,onPointerleave:C},null,40,j),g("primitive",{object:t.model.model.children[0].clone()},null,8,M)],64))}}),{unref:k,toDisplayString:E,vShow:P,normalizeStyle:T,withDirectives:U,openBlock:C,createElementBlock:I}=await e("vue"),{ref:O,onMounted:V,onUnmounted:F}=await e("vue"),A=m({__name:"dataDiv",setup(e){const t=f(),a=O({top:0,left:0});function o(e){a.value.left=e.clientX+5+"px",a.value.top=e.clientY-20+"px"}return V(()=>{window.addEventListener("mousemove",o)}),F(()=>{window.removeEventListener("mousemove",o)}),(e,o)=>U((C(),I("div",{class:"title",style:T(a.value)},"温度："+E(k(t).temperature)+"℃ ",5)),[[P,k(t).showDiv]])}},[["__scopeId","data-v-fac3e7fd"]]),{withAsyncContext:G,defineComponent:H}=await e("vue"),{unref:L,mergeProps:N,createVNode:R,withCtx:X,Fragment:z,openBlock:K,createElementBlock:W}=await e("vue"),{reactive:Y,ref:Z}=await e("vue"),$=H({__name:"heatmap2",async setup(e){let i,r;const s=Z(!1),l=([i,r]=G(()=>a()),i=await i,r(),i);s.value=!0;const u=Y({width:1,color:"#000",opacity:1,show:!0}),p=Y({opacity:.9});return new t({title:"参数",expanded:!0}).addBinding(p,"opacity",{label:"透明度",min:0,max:1,step:.1}),(e,t)=>(K(),W(z,null,[R(o,{showBuildings:!1,autoRotate:!1},{ability:X(()=>[R(S,N({model:L(l)},p),null,16,["model"]),R(n,N(u,{builds:L(l).city}),null,16,["builds"])]),_:1}),R(A)],64))}});export{$ as default};
