import{at as dM,bz as sf,bv as BM,bw as AM,aG as _f,by as PM,bA as SM,b1 as CM,b2 as uc,bd as vf,bf as lf,bc as TM,aA as RM,aF as QM,av as EM}from"./vendor.aZqsjRbH1712633233249.js";function DM(){const Ua=new dM;return Ua.setAttribute("position",new sf([-1,3,0,-1,-1,0,3,-1,0],3)),Ua.setAttribute("uv",new sf([0,2,0,0,2,0],2)),Ua}const FM="\nvec4 blur13(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.411764705882353) * direction;\n  vec2 off2 = vec2(3.2941176470588234) * direction;\n  vec2 off3 = vec2(5.176470588235294) * direction;\n  color += texture(image, uv) * 0.1964825501511404;\n  color += texture(image, uv + (off1 / resolution)) * 0.2969069646728344;\n  color += texture(image, uv - (off1 / resolution)) * 0.2969069646728344;\n  color += texture(image, uv + (off2 / resolution)) * 0.09447039785044732;\n  color += texture(image, uv - (off2 / resolution)) * 0.09447039785044732;\n  color += texture(image, uv + (off3 / resolution)) * 0.010381362401148057;\n  color += texture(image, uv - (off3 / resolution)) * 0.010381362401148057;\n  return color;\n}\n",NM="\nfloat smootherstep(float edge0, float edge1, float x) {\n    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);\n}\n",JM="\nin vec3 position;\nin vec2 uv;\n\nout vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n\n    gl_Position = vec4(position, 1.0);\n}\n",GM="\nprecision highp float;\n\nuniform sampler2D tMap;\nuniform vec2 uDirection;\nuniform vec2 uResolution;\n\nin vec2 vUv;\n\nout vec4 FragColor;\n\n".concat(NM,"\n").concat(FM,"\n\nvoid main() {\n    FragColor = blur13(tMap, vUv, uResolution, smootherstep(1.0, 0.0, vUv.y) * uDirection);\n}\n");class WM extends BM{constructor(){super({glslVersion:AM,uniforms:{tMap:{value:null},uDirection:{value:new _f(1,0)},uResolution:{value:new _f}},vertexShader:JM,fragmentShader:GM,blending:PM,depthTest:!1,depthWrite:!1})}}class KM extends SM{constructor({width:a=512,height:t=512,clipBias:i=0,blurIterations:r=8}={}){super(),this.clipBias=i,this.blurIterations=r,this.reflectorPlane=new CM,this.normal=new uc,this.reflectorWorldPosition=new uc,this.cameraWorldPosition=new uc,this.rotationMatrix=new vf,this.lookAtPosition=new uc(0,0,-1),this.clipPlane=new lf,this.view=new uc,this.target=new uc,this.q=new lf,this.textureMatrix=new vf,this.virtualCamera=new TM,this.textureMatrixUniform={value:this.textureMatrix},this.renderTarget=new RM(a,t,{depthBuffer:!1}),this.renderTargetRead=this.renderTarget.clone(),this.renderTargetWrite=this.renderTarget.clone(),this.renderTarget.depthBuffer=!0,this.renderTargetUniform={value:this.blurIterations>0?this.renderTargetRead.texture:this.renderTarget.texture},this.blurMaterial=new WM,this.blurMaterial.uniforms.uResolution.value.set(a,t),this.screenCamera=new QM(-1,1,1,-1,0,1),this.screenTriangle=DM(),this.screen=new EM(this.screenTriangle,this.blurMaterial),this.screen.frustumCulled=!1}setSize(a,t){this.renderTarget.setSize(a,t),this.renderTargetRead.setSize(a,t),this.renderTargetWrite.setSize(a,t),this.blurMaterial.uniforms.uResolution.value.set(a,t)}update(a,t,i){if(this.reflectorWorldPosition.setFromMatrixPosition(this.matrixWorld),this.cameraWorldPosition.setFromMatrixPosition(i.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal.set(0,0,1),this.normal.applyMatrix4(this.rotationMatrix),this.view.subVectors(this.reflectorWorldPosition,this.cameraWorldPosition),this.view.dot(this.normal)>0)return;this.view.reflect(this.normal).negate(),this.view.add(this.reflectorWorldPosition),this.rotationMatrix.extractRotation(i.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition),this.target.subVectors(this.reflectorWorldPosition,this.lookAtPosition),this.target.reflect(this.normal).negate(),this.target.add(this.reflectorWorldPosition),this.virtualCamera.position.copy(this.view),this.virtualCamera.up.set(0,1,0),this.virtualCamera.up.applyMatrix4(this.rotationMatrix),this.virtualCamera.up.reflect(this.normal),this.virtualCamera.lookAt(this.target),this.virtualCamera.far=i.far,this.virtualCamera.updateMatrixWorld(),this.virtualCamera.projectionMatrix.copy(i.projectionMatrix),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.virtualCamera.projectionMatrix),this.textureMatrix.multiply(this.virtualCamera.matrixWorldInverse),this.textureMatrix.multiply(this.matrixWorld),this.reflectorPlane.setFromNormalAndCoplanarPoint(this.normal,this.reflectorWorldPosition),this.reflectorPlane.applyMatrix4(this.virtualCamera.matrixWorldInverse),this.clipPlane.set(this.reflectorPlane.normal.x,this.reflectorPlane.normal.y,this.reflectorPlane.normal.z,this.reflectorPlane.constant);const r=this.virtualCamera.projectionMatrix;this.q.x=(Math.sign(this.clipPlane.x)+r.elements[8])/r.elements[0],this.q.y=(Math.sign(this.clipPlane.y)+r.elements[9])/r.elements[5],this.q.z=-1,this.q.w=(1+r.elements[10])/r.elements[14],this.clipPlane.multiplyScalar(2/this.clipPlane.dot(this.q)),r.elements[2]=this.clipPlane.x,r.elements[6]=this.clipPlane.y,r.elements[10]=this.clipPlane.z+1-this.clipBias,r.elements[14]=this.clipPlane.w;const o=a.getRenderTarget(),s=a.xr.enabled,_=a.shadowMap.autoUpdate;a.xr.enabled=!1,a.shadowMap.autoUpdate=!1,a.setRenderTarget(this.renderTarget),a.state.buffers.depth.setMask(!0),a.autoClear===!1&&a.clear(),a.render(t,this.virtualCamera);const h=this.blurIterations;for(let v=0;v<h;v++){v===0?this.blurMaterial.uniforms.tMap.value=this.renderTarget.texture:this.blurMaterial.uniforms.tMap.value=this.renderTargetRead.texture;const e=(h-v-1)*.5;this.blurMaterial.uniforms.uDirection.value.set(v%2===0?e:0,v%2===0?0:e),a.setRenderTarget(this.renderTargetWrite),a.autoClear===!1&&a.clear(),a.render(this.screen,this.screenCamera);const l=this.renderTargetRead;this.renderTargetRead=this.renderTargetWrite,this.renderTargetWrite=l,this.renderTargetUniform.value=this.renderTargetRead.texture}a.xr.enabled=s,a.shadowMap.autoUpdate=_,a.setRenderTarget(o)}destroy(){this.renderTargetWrite.dispose(),this.renderTargetRead.dispose(),this.renderTarget.dispose(),this.blurMaterial.dispose(),this.screenTriangle.dispose();for(const a in this)this[a]=null;return null}}var x=x||{};x.collision||(x.collision={});x.collision.broadphase||(x.collision.broadphase={});x.collision.broadphase.BroadPhase=class{constructor(a){this._type=a,this._numProxies=0,this._proxyList=null,this._proxyListLast=null,this._proxyPairList=null,this._incremental=!1,this._testCount=0,this._proxyPairPool=null,this._idCount=0,this._convexSweep=new x.collision.broadphase._BroadPhase.ConvexSweepGeometry,this._aabb=new x.collision.broadphase._BroadPhase.AabbGeometry,this.identity=new x.common.Transform,this.zero=new x.common.Vec3,this.rayCastHit=new x.collision.geometry.RayCastHit}createProxy(a,t){return null}destroyProxy(a){}moveProxy(a,t,i){}isOverlapping(a,t){return a._aabbMinX<t._aabbMaxX&&a._aabbMaxX>t._aabbMinX&&a._aabbMinY<t._aabbMaxY&&a._aabbMaxY>t._aabbMinY&&a._aabbMinZ<t._aabbMaxZ?a._aabbMaxZ>t._aabbMinZ:!1}collectPairs(){}getProxyPairList(){return this._proxyPairList}isIncremental(){return this._incremental}getTestCount(){return this._testCount}rayCast(a,t,i){}convexCast(a,t,i,r){}aabbTest(a,t){}};x.collision.geometry||(x.collision.geometry={});x.collision.geometry.Geometry=class{constructor(a){this._type=a,this._volume=0}_updateMass(){}_computeAabb(a,t){}_rayCastLocal(a,t,i,r,o,s,_){return!1}getType(){return this._type}getVolume(){return this._volume}rayCast(a,t,i,r){var o,s,_,h,v,e,l=a;o=l.x,s=l.y,_=l.z;var u=t;h=u.x,v=u.y,e=u.z,o-=i._positionX,s-=i._positionY,_-=i._positionZ,h-=i._positionX,v-=i._positionY,e-=i._positionZ;var b,f,n;b=i._rotation00*o+i._rotation10*s+i._rotation20*_,f=i._rotation01*o+i._rotation11*s+i._rotation21*_,n=i._rotation02*o+i._rotation12*s+i._rotation22*_,o=b,s=f,_=n;var c,z,p;if(c=i._rotation00*h+i._rotation10*v+i._rotation20*e,z=i._rotation01*h+i._rotation11*v+i._rotation21*e,p=i._rotation02*h+i._rotation12*v+i._rotation22*e,h=c,v=z,e=p,this._rayCastLocal(o,s,_,h,v,e,r)){var y,V,M,I,k,X,L=r.position;y=L.x,V=L.y,M=L.z;var m=r.normal;I=m.x,k=m.y,X=m.z;var g,N,A;g=i._rotation00*y+i._rotation01*V+i._rotation02*M,N=i._rotation10*y+i._rotation11*V+i._rotation12*M,A=i._rotation20*y+i._rotation21*V+i._rotation22*M,y=g,V=N,M=A;var F,P,Y;F=i._rotation00*I+i._rotation01*k+i._rotation02*X,P=i._rotation10*I+i._rotation11*k+i._rotation12*X,Y=i._rotation20*I+i._rotation21*k+i._rotation22*X,I=F,k=P,X=Y,y+=i._positionX,V+=i._positionY,M+=i._positionZ;var R=r.position;R.x=y,R.y=V,R.z=M;var C=r.normal;return C.x=I,C.y=k,C.z=X,!0}return!1}};x.collision.geometry.ConvexGeometry=class extends x.collision.geometry.Geometry{constructor(a){super(a),this._gjkMargin=x.common.Setting.defaultGJKMargin,this._useGjkRayCast=!1}getGjkMergin(){return this._gjkMargin}setGjkMergin(a){a<0&&(a=0),this._gjkMargin=a}computeLocalSupportingVertex(a,t){}rayCast(a,t,i,r){return this._useGjkRayCast?x.collision.narrowphase.detector.gjkepa.GjkEpa.instance.rayCast(this,i,a,t,r):super.rayCast(a,t,i,r)}};x.collision.broadphase._BroadPhase||(x.collision.broadphase._BroadPhase={});x.collision.broadphase._BroadPhase.ConvexSweepGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(){super(-1)}init(a,t,i){this.c=a;var r,o,s,_=i;r=_.x,o=_.y,s=_.z;var h,v,e,l,u,b;l=t._rotation00*r+t._rotation10*o+t._rotation20*s,u=t._rotation01*r+t._rotation11*o+t._rotation21*s,b=t._rotation02*r+t._rotation12*o+t._rotation22*s,h=l,v=u,e=b,this.localTranslation=new x.common.Vec3;var f=this.localTranslation;f.x=h,f.y=v,f.z=e,this._gjkMargin=a._gjkMargin}computeLocalSupportingVertex(a,t){this.c.computeLocalSupportingVertex(a,t);var i=this.localTranslation;if(a.x*i.x+a.y*i.y+a.z*i.z>0){var r=this.localTranslation,o=t.x+r.x,s=t.y+r.y,_=t.z+r.z;t.x=o,t.y=s,t.z=_}}};x.collision.broadphase._BroadPhase.AabbGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(){super(-1),this.min=new x.common.Vec3,this.max=new x.common.Vec3}computeLocalSupportingVertex(a,t){t.x=a.x>0?this.max.x:this.min.x,t.y=a.y>0?this.max.y:this.min.y,t.z=a.z>0?this.max.z:this.min.z}};x.collision.broadphase.BroadPhaseProxyCallback=class{constructor(){}process(a){}};x.collision.broadphase.BroadPhaseType=class{};x.collision.broadphase.Proxy=class{constructor(a,t){this.userData=a,this._id=t,this._prev=null,this._next=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}getId(){return this._id}getFatAabb(){var a=new x.collision.geometry.Aabb;return a._minX=this._aabbMinX,a._minY=this._aabbMinY,a._minZ=this._aabbMinZ,a._maxX=this._aabbMaxX,a._maxY=this._aabbMaxY,a._maxZ=this._aabbMaxZ,a}getFatAabbTo(a){a._minX=this._aabbMinX,a._minY=this._aabbMinY,a._minZ=this._aabbMinZ,a._maxX=this._aabbMaxX,a._maxY=this._aabbMaxY,a._maxZ=this._aabbMaxZ}};x.collision.broadphase.ProxyPair=class{constructor(){this._p1=null,this._p2=null}getProxy1(){return this._p1}getProxy2(){return this._p2}getNext(){return this._next}};x.collision.broadphase.bruteforce||(x.collision.broadphase.bruteforce={});x.collision.broadphase.bruteforce.BruteForceBroadPhase=class extends x.collision.broadphase.BroadPhase{constructor(){super(1),this._incremental=!1}createProxy(a,t){var i=new x.collision.broadphase.Proxy(a,this._idCount++);return this._numProxies++,this._proxyList==null?(this._proxyList=i,this._proxyListLast=i):(this._proxyListLast._next=i,i._prev=this._proxyListLast,this._proxyListLast=i),i._aabbMinX=t._minX,i._aabbMinY=t._minY,i._aabbMinZ=t._minZ,i._aabbMaxX=t._maxX,i._aabbMaxY=t._maxY,i._aabbMaxZ=t._maxZ,i}destroyProxy(a){this._numProxies--;var t=a._prev,i=a._next;t!=null&&(t._next=i),i!=null&&(i._prev=t),a==this._proxyList&&(this._proxyList=this._proxyList._next),a==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),a._next=null,a._prev=null,a.userData=null}moveProxy(a,t,i){a._aabbMinX=t._minX,a._aabbMinY=t._minY,a._aabbMinZ=t._minZ,a._aabbMaxX=t._maxX,a._aabbMaxY=t._maxY,a._aabbMaxZ=t._maxZ}collectPairs(){var a=this._proxyPairList;if(a!=null){for(;a._p1=null,a._p2=null,a=a._next,a!=null;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}this._testCount=0;for(var t=this._proxyList;t!=null;){for(var i=t._next,r=t._next;r!=null;){var o=r._next;if(this._testCount++,t._aabbMinX<r._aabbMaxX&&t._aabbMaxX>r._aabbMinX&&t._aabbMinY<r._aabbMaxY&&t._aabbMaxY>r._aabbMinY&&t._aabbMinZ<r._aabbMaxZ&&t._aabbMaxZ>r._aabbMinZ){var s=this._proxyPairPool;s!=null?(this._proxyPairPool=s._next,s._next=null):s=new x.collision.broadphase.ProxyPair;var _=s;this._proxyPairList==null?this._proxyPairList=_:(_._next=this._proxyPairList,this._proxyPairList=_),_._p1=t,_._p2=r}r=o}t=i}}rayCast(a,t,i){var r,o,s,_,h,v,e=a;r=e.x,o=e.y,s=e.z;var l=t;_=l.x,h=l.y,v=l.z;for(var u=this._proxyList;u!=null;){var b=u._next,f=r,n=o,c=s,z=_,p=h,y=v,V=f<z?f:z,M=n<p?n:p,I=c<y?c:y,k=f>z?f:z,X=n>p?n:p,L=c>y?c:y,m=u._aabbMinX,g=u._aabbMinY,N=u._aabbMinZ,A=u._aabbMaxX,F=u._aabbMaxY,P=u._aabbMaxZ,Y;if(m>k||A<V||g>X||F<M||N>L||P<I)Y=!1;else{var R=z-f,C=p-n,d=y-c,Z=R<0?-R:R,$=C<0?-C:C,K=d<0?-d:d,E=(A-m)*.5,J=(F-g)*.5,B=(P-N)*.5,Q=(A+m)*.5,U=(F+g)*.5,G=(P+N)*.5,D=f-Q,H=n-U,j=c-G,ia,sa,W=H*d-j*C;if((W<0?-W:W)-(J*K+B*$)>0)sa=!0;else{var q=j*R-D*d;sa=(q<0?-q:q)-(B*Z+E*K)>0}if(sa)ia=!0;else{var na=D*C-H*R;ia=(na<0?-na:na)-(E*$+J*Z)>0}Y=!ia}Y&&i.process(u),u=b}}convexCast(a,t,i,r){for(var o=this._proxyList;o!=null;){var s=o._next,_=this._aabb.min;_.x=o._aabbMinX,_.y=o._aabbMinY,_.z=o._aabbMinZ;var h=this._aabb.max;h.x=o._aabbMaxX,h.y=o._aabbMaxY,h.z=o._aabbMaxZ,this._convexSweep.init(a,t,i);var v=x.collision.narrowphase.detector.gjkepa.GjkEpa.instance;v.computeClosestPointsImpl(this._convexSweep,this._aabb,t,this.identity,null,!1)==0&&v.distance<=0&&r.process(o),o=s}}aabbTest(a,t){for(var i=this._proxyList;i!=null;){var r=i._next;a._minX<i._aabbMaxX&&a._maxX>i._aabbMinX&&a._minY<i._aabbMaxY&&a._maxY>i._aabbMinY&&a._minZ<i._aabbMaxZ&&a._maxZ>i._aabbMinZ&&t.process(i),i=r}}};x.collision.broadphase.bvh||(x.collision.broadphase.bvh={});x.collision.broadphase.bvh.BvhBroadPhase=class extends x.collision.broadphase.BroadPhase{constructor(){super(2),this._incremental=!0,this._tree=new x.collision.broadphase.bvh.BvhTree;var a=new Array(1024);this.movedProxies=a,this.numMovedProxies=0}collide(a,t){this._testCount++;var i=a._height==0,r=t._height==0;if(a==t){if(i)return;this.collide(a._children[0],t),this.collide(a._children[1],t);return}if(a._aabbMinX<t._aabbMaxX&&a._aabbMaxX>t._aabbMinX&&a._aabbMinY<t._aabbMaxY&&a._aabbMaxY>t._aabbMinY&&a._aabbMinZ<t._aabbMaxZ&&a._aabbMaxZ>t._aabbMinZ){if(i&&r){var o=a._proxy,s=t._proxy,_=this._proxyPairPool;_!=null?(this._proxyPairPool=_._next,_._next=null):_=new x.collision.broadphase.ProxyPair;var h=_;this._proxyPairList==null?this._proxyPairList=h:(h._next=this._proxyPairList,this._proxyPairList=h),h._p1=o,h._p2=s;return}r||a._height>t._height?(this.collide(a._children[0],t),this.collide(a._children[1],t)):(this.collide(t._children[0],a),this.collide(t._children[1],a))}}rayCastRecursive(a,t,i,r,o,s,_,h){var v,e,l,u,b,f;v=t,e=i,l=r,u=o,b=s,f=_;var n=v,c=e,z=l,p=u,y=b,V=f,M=n<p?n:p,I=c<y?c:y,k=z<V?z:V,X=n>p?n:p,L=c>y?c:y,m=z>V?z:V,g=a._aabbMinX,N=a._aabbMinY,A=a._aabbMinZ,F=a._aabbMaxX,P=a._aabbMaxY,Y=a._aabbMaxZ,R;if(g>X||F<M||N>L||P<I||A>m||Y<k)R=!1;else{var C=p-n,d=y-c,Z=V-z,$=C<0?-C:C,K=d<0?-d:d,E=Z<0?-Z:Z,J=(F-g)*.5,B=(P-N)*.5,Q=(Y-A)*.5,U=(F+g)*.5,G=(P+N)*.5,D=(Y+A)*.5,H=n-U,j=c-G,ia=z-D,sa,W,q=j*Z-ia*d;if((q<0?-q:q)-(B*E+Q*K)>0)W=!0;else{var na=ia*C-H*Z;W=(na<0?-na:na)-(Q*$+J*E)>0}if(W)sa=!0;else{var oa=H*d-j*C;sa=(oa<0?-oa:oa)-(J*K+B*$)>0}R=!sa}if(R){if(a._height==0){h.process(a._proxy);return}this.rayCastRecursive(a._children[0],v,e,l,u,b,f,h),this.rayCastRecursive(a._children[1],v,e,l,u,b,f,h)}}convexCastRecursive(a,t,i,r,o){var s=this._aabb.min;s.x=a._aabbMinX,s.y=a._aabbMinY,s.z=a._aabbMinZ;var _=this._aabb.max;_.x=a._aabbMaxX,_.y=a._aabbMaxY,_.z=a._aabbMaxZ,this._convexSweep.init(t,i,r);var h=x.collision.narrowphase.detector.gjkepa.GjkEpa.instance;if(h.computeClosestPointsImpl(this._convexSweep,this._aabb,i,this.identity,null,!1)==0&&h.distance<=0){if(a._height==0){o.process(a._proxy);return}this.convexCastRecursive(a._children[0],t,i,r,o),this.convexCastRecursive(a._children[1],t,i,r,o)}}aabbTestRecursive(a,t,i){if(a._aabbMinX<t._maxX&&a._aabbMaxX>t._minX&&a._aabbMinY<t._maxY&&a._aabbMaxY>t._minY&&a._aabbMinZ<t._maxZ&&a._aabbMaxZ>t._minZ){if(a._height==0){i.process(a._proxy);return}this.aabbTestRecursive(a._children[0],t,i),this.aabbTestRecursive(a._children[1],t,i)}}createProxy(a,t){var i=new x.collision.broadphase.bvh.BvhProxy(a,this._idCount++);this._numProxies++,this._proxyList==null?(this._proxyList=i,this._proxyListLast=i):(this._proxyListLast._next=i,i._prev=this._proxyListLast,this._proxyListLast=i),i._aabbMinX=t._minX,i._aabbMinY=t._minY,i._aabbMinZ=t._minZ,i._aabbMaxX=t._maxX,i._aabbMaxY=t._maxY,i._aabbMaxZ=t._maxZ;var r=x.common.Setting.bvhProxyPadding,o,s,_;o=r,s=r,_=r,i._aabbMinX-=o,i._aabbMinY-=s,i._aabbMinZ-=_,i._aabbMaxX+=o,i._aabbMaxY+=s,i._aabbMaxZ+=_;var h=this._tree,v=h._nodePool;v!=null?(h._nodePool=v._next,v._next=null):v=new x.collision.broadphase.bvh.BvhNode;var e=v;if(e._proxy=i,i._leaf=e,e._aabbMinX=i._aabbMinX,e._aabbMinY=i._aabbMinY,e._aabbMinZ=i._aabbMinZ,e._aabbMaxX=i._aabbMaxX,e._aabbMaxY=i._aabbMaxY,e._aabbMaxZ=i._aabbMaxZ,h._numLeaves++,h.leafList==null?(h.leafList=e,h.leafListLast=e):(h.leafListLast._nextLeaf=e,e._prevLeaf=h.leafListLast,h.leafListLast=e),h._root==null)h._root=e;else{for(var l=h._root;l._height>0;){var u=h._strategy._decideInsertion(l,e);if(u==-1)break;l=l._children[u]}var b=l._parent,f=h._nodePool;f!=null?(h._nodePool=f._next,f._next=null):f=new x.collision.broadphase.bvh.BvhNode;var n=f;if(b==null)h._root=n;else{var c=l._childIndex;b._children[c]=n,n._parent=b,n._childIndex=c}var z=l._childIndex;n._children[z]=l,l._parent=n,l._childIndex=z;var p=l._childIndex^1;for(n._children[p]=e,e._parent=n,e._childIndex=p;n!=null;){if(h._strategy._balancingEnabled){var y=n._height;if(y<2)n=n;else{var V=n._parent,M=n._children[0],I=n._children[1],k=M._height,X=I._height,L=k-X,m=n._childIndex;if(L>1){var g=M._children[0],N=M._children[1],A=g._height,F=N._height;if(A>F){M._children[1]=n,n._parent=M,n._childIndex=1,n._children[0]=N,N._parent=n,N._childIndex=0;var P=M._children[0],Y=M._children[1];M._aabbMinX=P._aabbMinX<Y._aabbMinX?P._aabbMinX:Y._aabbMinX,M._aabbMinY=P._aabbMinY<Y._aabbMinY?P._aabbMinY:Y._aabbMinY,M._aabbMinZ=P._aabbMinZ<Y._aabbMinZ?P._aabbMinZ:Y._aabbMinZ,M._aabbMaxX=P._aabbMaxX>Y._aabbMaxX?P._aabbMaxX:Y._aabbMaxX,M._aabbMaxY=P._aabbMaxY>Y._aabbMaxY?P._aabbMaxY:Y._aabbMaxY,M._aabbMaxZ=P._aabbMaxZ>Y._aabbMaxZ?P._aabbMaxZ:Y._aabbMaxZ;var R=M._children[0]._height,C=M._children[1]._height;M._height=(R>C?R:C)+1;var d=n._children[0],Z=n._children[1];n._aabbMinX=d._aabbMinX<Z._aabbMinX?d._aabbMinX:Z._aabbMinX,n._aabbMinY=d._aabbMinY<Z._aabbMinY?d._aabbMinY:Z._aabbMinY,n._aabbMinZ=d._aabbMinZ<Z._aabbMinZ?d._aabbMinZ:Z._aabbMinZ,n._aabbMaxX=d._aabbMaxX>Z._aabbMaxX?d._aabbMaxX:Z._aabbMaxX,n._aabbMaxY=d._aabbMaxY>Z._aabbMaxY?d._aabbMaxY:Z._aabbMaxY,n._aabbMaxZ=d._aabbMaxZ>Z._aabbMaxZ?d._aabbMaxZ:Z._aabbMaxZ;var $=n._children[0]._height,K=n._children[1]._height;n._height=($>K?$:K)+1}else{M._children[0]=n,n._parent=M,n._childIndex=0,n._children[0]=g,g._parent=n,g._childIndex=0;var E=M._children[0],J=M._children[1];M._aabbMinX=E._aabbMinX<J._aabbMinX?E._aabbMinX:J._aabbMinX,M._aabbMinY=E._aabbMinY<J._aabbMinY?E._aabbMinY:J._aabbMinY,M._aabbMinZ=E._aabbMinZ<J._aabbMinZ?E._aabbMinZ:J._aabbMinZ,M._aabbMaxX=E._aabbMaxX>J._aabbMaxX?E._aabbMaxX:J._aabbMaxX,M._aabbMaxY=E._aabbMaxY>J._aabbMaxY?E._aabbMaxY:J._aabbMaxY,M._aabbMaxZ=E._aabbMaxZ>J._aabbMaxZ?E._aabbMaxZ:J._aabbMaxZ;var B=M._children[0]._height,Q=M._children[1]._height;M._height=(B>Q?B:Q)+1;var U=n._children[0],G=n._children[1];n._aabbMinX=U._aabbMinX<G._aabbMinX?U._aabbMinX:G._aabbMinX,n._aabbMinY=U._aabbMinY<G._aabbMinY?U._aabbMinY:G._aabbMinY,n._aabbMinZ=U._aabbMinZ<G._aabbMinZ?U._aabbMinZ:G._aabbMinZ,n._aabbMaxX=U._aabbMaxX>G._aabbMaxX?U._aabbMaxX:G._aabbMaxX,n._aabbMaxY=U._aabbMaxY>G._aabbMaxY?U._aabbMaxY:G._aabbMaxY,n._aabbMaxZ=U._aabbMaxZ>G._aabbMaxZ?U._aabbMaxZ:G._aabbMaxZ;var D=n._children[0]._height,H=n._children[1]._height;n._height=(D>H?D:H)+1}V!=null?(V._children[m]=M,M._parent=V,M._childIndex=m):(h._root=M,M._parent=null),n=M}else if(L<-1){var j=I._children[0],ia=I._children[1],sa=j._height,W=ia._height;if(sa>W){I._children[1]=n,n._parent=I,n._childIndex=1,n._children[1]=ia,ia._parent=n,ia._childIndex=1;var q=I._children[0],na=I._children[1];I._aabbMinX=q._aabbMinX<na._aabbMinX?q._aabbMinX:na._aabbMinX,I._aabbMinY=q._aabbMinY<na._aabbMinY?q._aabbMinY:na._aabbMinY,I._aabbMinZ=q._aabbMinZ<na._aabbMinZ?q._aabbMinZ:na._aabbMinZ,I._aabbMaxX=q._aabbMaxX>na._aabbMaxX?q._aabbMaxX:na._aabbMaxX,I._aabbMaxY=q._aabbMaxY>na._aabbMaxY?q._aabbMaxY:na._aabbMaxY,I._aabbMaxZ=q._aabbMaxZ>na._aabbMaxZ?q._aabbMaxZ:na._aabbMaxZ;var oa=I._children[0]._height,aa=I._children[1]._height;I._height=(oa>aa?oa:aa)+1;var T=n._children[0],ca=n._children[1];n._aabbMinX=T._aabbMinX<ca._aabbMinX?T._aabbMinX:ca._aabbMinX,n._aabbMinY=T._aabbMinY<ca._aabbMinY?T._aabbMinY:ca._aabbMinY,n._aabbMinZ=T._aabbMinZ<ca._aabbMinZ?T._aabbMinZ:ca._aabbMinZ,n._aabbMaxX=T._aabbMaxX>ca._aabbMaxX?T._aabbMaxX:ca._aabbMaxX,n._aabbMaxY=T._aabbMaxY>ca._aabbMaxY?T._aabbMaxY:ca._aabbMaxY,n._aabbMaxZ=T._aabbMaxZ>ca._aabbMaxZ?T._aabbMaxZ:ca._aabbMaxZ;var _a=n._children[0]._height,w=n._children[1]._height;n._height=(_a>w?_a:w)+1}else{I._children[0]=n,n._parent=I,n._childIndex=0,n._children[1]=j,j._parent=n,j._childIndex=1;var ta=I._children[0],ra=I._children[1];I._aabbMinX=ta._aabbMinX<ra._aabbMinX?ta._aabbMinX:ra._aabbMinX,I._aabbMinY=ta._aabbMinY<ra._aabbMinY?ta._aabbMinY:ra._aabbMinY,I._aabbMinZ=ta._aabbMinZ<ra._aabbMinZ?ta._aabbMinZ:ra._aabbMinZ,I._aabbMaxX=ta._aabbMaxX>ra._aabbMaxX?ta._aabbMaxX:ra._aabbMaxX,I._aabbMaxY=ta._aabbMaxY>ra._aabbMaxY?ta._aabbMaxY:ra._aabbMaxY,I._aabbMaxZ=ta._aabbMaxZ>ra._aabbMaxZ?ta._aabbMaxZ:ra._aabbMaxZ;var la=I._children[0]._height,va=I._children[1]._height;I._height=(la>va?la:va)+1;var xa=n._children[0],za=n._children[1];n._aabbMinX=xa._aabbMinX<za._aabbMinX?xa._aabbMinX:za._aabbMinX,n._aabbMinY=xa._aabbMinY<za._aabbMinY?xa._aabbMinY:za._aabbMinY,n._aabbMinZ=xa._aabbMinZ<za._aabbMinZ?xa._aabbMinZ:za._aabbMinZ,n._aabbMaxX=xa._aabbMaxX>za._aabbMaxX?xa._aabbMaxX:za._aabbMaxX,n._aabbMaxY=xa._aabbMaxY>za._aabbMaxY?xa._aabbMaxY:za._aabbMaxY,n._aabbMaxZ=xa._aabbMaxZ>za._aabbMaxZ?xa._aabbMaxZ:za._aabbMaxZ;var Ma=n._children[0]._height,Xa=n._children[1]._height;n._height=(Ma>Xa?Ma:Xa)+1}V!=null?(V._children[m]=I,I._parent=V,I._childIndex=m):(h._root=I,I._parent=null),n=I}else n=n}}var Za=n._children[0]._height,fa=n._children[1]._height;n._height=(Za>fa?Za:fa)+1;var ba=n._children[0],ea=n._children[1];n._aabbMinX=ba._aabbMinX<ea._aabbMinX?ba._aabbMinX:ea._aabbMinX,n._aabbMinY=ba._aabbMinY<ea._aabbMinY?ba._aabbMinY:ea._aabbMinY,n._aabbMinZ=ba._aabbMinZ<ea._aabbMinZ?ba._aabbMinZ:ea._aabbMinZ,n._aabbMaxX=ba._aabbMaxX>ea._aabbMaxX?ba._aabbMaxX:ea._aabbMaxX,n._aabbMaxY=ba._aabbMaxY>ea._aabbMaxY?ba._aabbMaxY:ea._aabbMaxY,n._aabbMaxZ=ba._aabbMaxZ>ea._aabbMaxZ?ba._aabbMaxZ:ea._aabbMaxZ,n=n._parent}}if(!i._moved){if(i._moved=!0,this.movedProxies.length==this.numMovedProxies){for(var ha=this.numMovedProxies<<1,ma=new Array(ha),ya=ma,da=0,pa=this.numMovedProxies;da<pa;){var Ya=da++;ya[Ya]=this.movedProxies[Ya],this.movedProxies[Ya]=null}this.movedProxies=ya}this.movedProxies[this.numMovedProxies++]=i}return i}destroyProxy(a){this._numProxies--;var t=a._prev,i=a._next;t!=null&&(t._next=i),i!=null&&(i._prev=t),a==this._proxyList&&(this._proxyList=this._proxyList._next),a==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),a._next=null,a._prev=null;var r=a,o=this._tree,s=r._leaf;o._numLeaves--;var _=s._prevLeaf,h=s._nextLeaf;if(_!=null&&(_._nextLeaf=h),h!=null&&(h._prevLeaf=_),s==o.leafList&&(o.leafList=o.leafList._nextLeaf),s==o.leafListLast&&(o.leafListLast=o.leafListLast._prevLeaf),s._nextLeaf=null,s._prevLeaf=null,o._root==s)o._root=null;else{var v=s._parent,e=v._children[s._childIndex^1],l=v._parent;if(l==null)e._parent=null,e._childIndex=0,o._root=e,v._next=null,v._childIndex=0,v._children[0]=null,v._children[1]=null,v._childIndex=0,v._parent=null,v._height=0,v._proxy=null,v._next=o._nodePool,o._nodePool=v;else{e._parent=l;var u=v._childIndex;l._children[u]=e,e._parent=l,e._childIndex=u,v._next=null,v._childIndex=0,v._children[0]=null,v._children[1]=null,v._childIndex=0,v._parent=null,v._height=0,v._proxy=null,v._next=o._nodePool,o._nodePool=v;for(var b=l;b!=null;){if(o._strategy._balancingEnabled){var f=b._height;if(f<2)b=b;else{var n=b._parent,c=b._children[0],z=b._children[1],p=c._height,y=z._height,V=p-y,M=b._childIndex;if(V>1){var I=c._children[0],k=c._children[1],X=I._height,L=k._height;if(X>L){c._children[1]=b,b._parent=c,b._childIndex=1,b._children[0]=k,k._parent=b,k._childIndex=0;var m=c._children[0],g=c._children[1];c._aabbMinX=m._aabbMinX<g._aabbMinX?m._aabbMinX:g._aabbMinX,c._aabbMinY=m._aabbMinY<g._aabbMinY?m._aabbMinY:g._aabbMinY,c._aabbMinZ=m._aabbMinZ<g._aabbMinZ?m._aabbMinZ:g._aabbMinZ,c._aabbMaxX=m._aabbMaxX>g._aabbMaxX?m._aabbMaxX:g._aabbMaxX,c._aabbMaxY=m._aabbMaxY>g._aabbMaxY?m._aabbMaxY:g._aabbMaxY,c._aabbMaxZ=m._aabbMaxZ>g._aabbMaxZ?m._aabbMaxZ:g._aabbMaxZ;var N=c._children[0]._height,A=c._children[1]._height;c._height=(N>A?N:A)+1;var F=b._children[0],P=b._children[1];b._aabbMinX=F._aabbMinX<P._aabbMinX?F._aabbMinX:P._aabbMinX,b._aabbMinY=F._aabbMinY<P._aabbMinY?F._aabbMinY:P._aabbMinY,b._aabbMinZ=F._aabbMinZ<P._aabbMinZ?F._aabbMinZ:P._aabbMinZ,b._aabbMaxX=F._aabbMaxX>P._aabbMaxX?F._aabbMaxX:P._aabbMaxX,b._aabbMaxY=F._aabbMaxY>P._aabbMaxY?F._aabbMaxY:P._aabbMaxY,b._aabbMaxZ=F._aabbMaxZ>P._aabbMaxZ?F._aabbMaxZ:P._aabbMaxZ;var Y=b._children[0]._height,R=b._children[1]._height;b._height=(Y>R?Y:R)+1}else{c._children[0]=b,b._parent=c,b._childIndex=0,b._children[0]=I,I._parent=b,I._childIndex=0;var C=c._children[0],d=c._children[1];c._aabbMinX=C._aabbMinX<d._aabbMinX?C._aabbMinX:d._aabbMinX,c._aabbMinY=C._aabbMinY<d._aabbMinY?C._aabbMinY:d._aabbMinY,c._aabbMinZ=C._aabbMinZ<d._aabbMinZ?C._aabbMinZ:d._aabbMinZ,c._aabbMaxX=C._aabbMaxX>d._aabbMaxX?C._aabbMaxX:d._aabbMaxX,c._aabbMaxY=C._aabbMaxY>d._aabbMaxY?C._aabbMaxY:d._aabbMaxY,c._aabbMaxZ=C._aabbMaxZ>d._aabbMaxZ?C._aabbMaxZ:d._aabbMaxZ;var Z=c._children[0]._height,$=c._children[1]._height;c._height=(Z>$?Z:$)+1;var K=b._children[0],E=b._children[1];b._aabbMinX=K._aabbMinX<E._aabbMinX?K._aabbMinX:E._aabbMinX,b._aabbMinY=K._aabbMinY<E._aabbMinY?K._aabbMinY:E._aabbMinY,b._aabbMinZ=K._aabbMinZ<E._aabbMinZ?K._aabbMinZ:E._aabbMinZ,b._aabbMaxX=K._aabbMaxX>E._aabbMaxX?K._aabbMaxX:E._aabbMaxX,b._aabbMaxY=K._aabbMaxY>E._aabbMaxY?K._aabbMaxY:E._aabbMaxY,b._aabbMaxZ=K._aabbMaxZ>E._aabbMaxZ?K._aabbMaxZ:E._aabbMaxZ;var J=b._children[0]._height,B=b._children[1]._height;b._height=(J>B?J:B)+1}n!=null?(n._children[M]=c,c._parent=n,c._childIndex=M):(o._root=c,c._parent=null),b=c}else if(V<-1){var Q=z._children[0],U=z._children[1],G=Q._height,D=U._height;if(G>D){z._children[1]=b,b._parent=z,b._childIndex=1,b._children[1]=U,U._parent=b,U._childIndex=1;var H=z._children[0],j=z._children[1];z._aabbMinX=H._aabbMinX<j._aabbMinX?H._aabbMinX:j._aabbMinX,z._aabbMinY=H._aabbMinY<j._aabbMinY?H._aabbMinY:j._aabbMinY,z._aabbMinZ=H._aabbMinZ<j._aabbMinZ?H._aabbMinZ:j._aabbMinZ,z._aabbMaxX=H._aabbMaxX>j._aabbMaxX?H._aabbMaxX:j._aabbMaxX,z._aabbMaxY=H._aabbMaxY>j._aabbMaxY?H._aabbMaxY:j._aabbMaxY,z._aabbMaxZ=H._aabbMaxZ>j._aabbMaxZ?H._aabbMaxZ:j._aabbMaxZ;var ia=z._children[0]._height,sa=z._children[1]._height;z._height=(ia>sa?ia:sa)+1;var W=b._children[0],q=b._children[1];b._aabbMinX=W._aabbMinX<q._aabbMinX?W._aabbMinX:q._aabbMinX,b._aabbMinY=W._aabbMinY<q._aabbMinY?W._aabbMinY:q._aabbMinY,b._aabbMinZ=W._aabbMinZ<q._aabbMinZ?W._aabbMinZ:q._aabbMinZ,b._aabbMaxX=W._aabbMaxX>q._aabbMaxX?W._aabbMaxX:q._aabbMaxX,b._aabbMaxY=W._aabbMaxY>q._aabbMaxY?W._aabbMaxY:q._aabbMaxY,b._aabbMaxZ=W._aabbMaxZ>q._aabbMaxZ?W._aabbMaxZ:q._aabbMaxZ;var na=b._children[0]._height,oa=b._children[1]._height;b._height=(na>oa?na:oa)+1}else{z._children[0]=b,b._parent=z,b._childIndex=0,b._children[1]=Q,Q._parent=b,Q._childIndex=1;var aa=z._children[0],T=z._children[1];z._aabbMinX=aa._aabbMinX<T._aabbMinX?aa._aabbMinX:T._aabbMinX,z._aabbMinY=aa._aabbMinY<T._aabbMinY?aa._aabbMinY:T._aabbMinY,z._aabbMinZ=aa._aabbMinZ<T._aabbMinZ?aa._aabbMinZ:T._aabbMinZ,z._aabbMaxX=aa._aabbMaxX>T._aabbMaxX?aa._aabbMaxX:T._aabbMaxX,z._aabbMaxY=aa._aabbMaxY>T._aabbMaxY?aa._aabbMaxY:T._aabbMaxY,z._aabbMaxZ=aa._aabbMaxZ>T._aabbMaxZ?aa._aabbMaxZ:T._aabbMaxZ;var ca=z._children[0]._height,_a=z._children[1]._height;z._height=(ca>_a?ca:_a)+1;var w=b._children[0],ta=b._children[1];b._aabbMinX=w._aabbMinX<ta._aabbMinX?w._aabbMinX:ta._aabbMinX,b._aabbMinY=w._aabbMinY<ta._aabbMinY?w._aabbMinY:ta._aabbMinY,b._aabbMinZ=w._aabbMinZ<ta._aabbMinZ?w._aabbMinZ:ta._aabbMinZ,b._aabbMaxX=w._aabbMaxX>ta._aabbMaxX?w._aabbMaxX:ta._aabbMaxX,b._aabbMaxY=w._aabbMaxY>ta._aabbMaxY?w._aabbMaxY:ta._aabbMaxY,b._aabbMaxZ=w._aabbMaxZ>ta._aabbMaxZ?w._aabbMaxZ:ta._aabbMaxZ;var ra=b._children[0]._height,la=b._children[1]._height;b._height=(ra>la?ra:la)+1}n!=null?(n._children[M]=z,z._parent=n,z._childIndex=M):(o._root=z,z._parent=null),b=z}else b=b}}var va=b._children[0]._height,xa=b._children[1]._height;b._height=(va>xa?va:xa)+1;var za=b._children[0],Ma=b._children[1];b._aabbMinX=za._aabbMinX<Ma._aabbMinX?za._aabbMinX:Ma._aabbMinX,b._aabbMinY=za._aabbMinY<Ma._aabbMinY?za._aabbMinY:Ma._aabbMinY,b._aabbMinZ=za._aabbMinZ<Ma._aabbMinZ?za._aabbMinZ:Ma._aabbMinZ,b._aabbMaxX=za._aabbMaxX>Ma._aabbMaxX?za._aabbMaxX:Ma._aabbMaxX,b._aabbMaxY=za._aabbMaxY>Ma._aabbMaxY?za._aabbMaxY:Ma._aabbMaxY,b._aabbMaxZ=za._aabbMaxZ>Ma._aabbMaxZ?za._aabbMaxZ:Ma._aabbMaxZ,b=b._parent}}}r._leaf=null,s._next=null,s._childIndex=0,s._children[0]=null,s._children[1]=null,s._childIndex=0,s._parent=null,s._height=0,s._proxy=null,s._next=o._nodePool,o._nodePool=s,r.userData=null,r._next=null,r._prev=null,r._moved&&(r._moved=!1)}moveProxy(a,t,i){var r=a;if(!(r._aabbMinX<=t._minX&&r._aabbMaxX>=t._maxX&&r._aabbMinY<=t._minY&&r._aabbMaxY>=t._maxY&&r._aabbMinZ<=t._minZ&&r._aabbMaxZ>=t._maxZ)){r._aabbMinX=t._minX,r._aabbMinY=t._minY,r._aabbMinZ=t._minZ,r._aabbMaxX=t._maxX,r._aabbMaxY=t._maxY,r._aabbMaxZ=t._maxZ;var o=x.common.Setting.bvhProxyPadding,s,_,h;if(s=o,_=o,h=o,r._aabbMinX-=s,r._aabbMinY-=_,r._aabbMinZ-=h,r._aabbMaxX+=s,r._aabbMaxY+=_,r._aabbMaxZ+=h,i!=null){var v,e,l,u,b,f,n,c,z,p,y,V;u=0,b=0,f=0;var M=i;v=M.x,e=M.y,l=M.z,n=u<v?u:v,c=b<e?b:e,z=f<l?f:l,p=u>v?u:v,y=b>e?b:e,V=f>l?f:l,r._aabbMinX+=n,r._aabbMinY+=c,r._aabbMinZ+=z,r._aabbMaxX+=p,r._aabbMaxY+=y,r._aabbMaxZ+=V}if(!r._moved){if(r._moved=!0,this.movedProxies.length==this.numMovedProxies){for(var I=this.numMovedProxies<<1,k=new Array(I),X=k,L=0,m=this.numMovedProxies;L<m;){var g=L++;X[g]=this.movedProxies[g],this.movedProxies[g]=null}this.movedProxies=X}this.movedProxies[this.numMovedProxies++]=r}}}collectPairs(){var a=this._proxyPairList;if(a!=null){for(;a._p1=null,a._p2=null,a=a._next,a!=null;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}if(this._testCount=0,!(this._numProxies<2)){for(var t=this.numMovedProxies/this._numProxies<x.common.Setting.bvhIncrementalCollisionThreshold,i=0,r=this.numMovedProxies;i<r;){var o=i++,s=this.movedProxies[o];if(s._moved){var _=this._tree,h=s._leaf;_._numLeaves--;var v=h._prevLeaf,e=h._nextLeaf;if(v!=null&&(v._nextLeaf=e),e!=null&&(e._prevLeaf=v),h==_.leafList&&(_.leafList=_.leafList._nextLeaf),h==_.leafListLast&&(_.leafListLast=_.leafListLast._prevLeaf),h._nextLeaf=null,h._prevLeaf=null,_._root==h)_._root=null;else{var l=h._parent,u=l._children[h._childIndex^1],b=l._parent;if(b==null)u._parent=null,u._childIndex=0,_._root=u,l._next=null,l._childIndex=0,l._children[0]=null,l._children[1]=null,l._childIndex=0,l._parent=null,l._height=0,l._proxy=null,l._next=_._nodePool,_._nodePool=l;else{u._parent=b;var f=l._childIndex;b._children[f]=u,u._parent=b,u._childIndex=f,l._next=null,l._childIndex=0,l._children[0]=null,l._children[1]=null,l._childIndex=0,l._parent=null,l._height=0,l._proxy=null,l._next=_._nodePool,_._nodePool=l;for(var n=b;n!=null;){if(_._strategy._balancingEnabled){var c=n._height;if(c<2)n=n;else{var z=n._parent,p=n._children[0],y=n._children[1],V=p._height,M=y._height,I=V-M,k=n._childIndex;if(I>1){var X=p._children[0],L=p._children[1],m=X._height,g=L._height;if(m>g){p._children[1]=n,n._parent=p,n._childIndex=1,n._children[0]=L,L._parent=n,L._childIndex=0;var N=p._children[0],A=p._children[1];p._aabbMinX=N._aabbMinX<A._aabbMinX?N._aabbMinX:A._aabbMinX,p._aabbMinY=N._aabbMinY<A._aabbMinY?N._aabbMinY:A._aabbMinY,p._aabbMinZ=N._aabbMinZ<A._aabbMinZ?N._aabbMinZ:A._aabbMinZ,p._aabbMaxX=N._aabbMaxX>A._aabbMaxX?N._aabbMaxX:A._aabbMaxX,p._aabbMaxY=N._aabbMaxY>A._aabbMaxY?N._aabbMaxY:A._aabbMaxY,p._aabbMaxZ=N._aabbMaxZ>A._aabbMaxZ?N._aabbMaxZ:A._aabbMaxZ;var F=p._children[0]._height,P=p._children[1]._height;p._height=(F>P?F:P)+1;var Y=n._children[0],R=n._children[1];n._aabbMinX=Y._aabbMinX<R._aabbMinX?Y._aabbMinX:R._aabbMinX,n._aabbMinY=Y._aabbMinY<R._aabbMinY?Y._aabbMinY:R._aabbMinY,n._aabbMinZ=Y._aabbMinZ<R._aabbMinZ?Y._aabbMinZ:R._aabbMinZ,n._aabbMaxX=Y._aabbMaxX>R._aabbMaxX?Y._aabbMaxX:R._aabbMaxX,n._aabbMaxY=Y._aabbMaxY>R._aabbMaxY?Y._aabbMaxY:R._aabbMaxY,n._aabbMaxZ=Y._aabbMaxZ>R._aabbMaxZ?Y._aabbMaxZ:R._aabbMaxZ;var C=n._children[0]._height,d=n._children[1]._height;n._height=(C>d?C:d)+1}else{p._children[0]=n,n._parent=p,n._childIndex=0,n._children[0]=X,X._parent=n,X._childIndex=0;var Z=p._children[0],$=p._children[1];p._aabbMinX=Z._aabbMinX<$._aabbMinX?Z._aabbMinX:$._aabbMinX,p._aabbMinY=Z._aabbMinY<$._aabbMinY?Z._aabbMinY:$._aabbMinY,p._aabbMinZ=Z._aabbMinZ<$._aabbMinZ?Z._aabbMinZ:$._aabbMinZ,p._aabbMaxX=Z._aabbMaxX>$._aabbMaxX?Z._aabbMaxX:$._aabbMaxX,p._aabbMaxY=Z._aabbMaxY>$._aabbMaxY?Z._aabbMaxY:$._aabbMaxY,p._aabbMaxZ=Z._aabbMaxZ>$._aabbMaxZ?Z._aabbMaxZ:$._aabbMaxZ;var K=p._children[0]._height,E=p._children[1]._height;p._height=(K>E?K:E)+1;var J=n._children[0],B=n._children[1];n._aabbMinX=J._aabbMinX<B._aabbMinX?J._aabbMinX:B._aabbMinX,n._aabbMinY=J._aabbMinY<B._aabbMinY?J._aabbMinY:B._aabbMinY,n._aabbMinZ=J._aabbMinZ<B._aabbMinZ?J._aabbMinZ:B._aabbMinZ,n._aabbMaxX=J._aabbMaxX>B._aabbMaxX?J._aabbMaxX:B._aabbMaxX,n._aabbMaxY=J._aabbMaxY>B._aabbMaxY?J._aabbMaxY:B._aabbMaxY,n._aabbMaxZ=J._aabbMaxZ>B._aabbMaxZ?J._aabbMaxZ:B._aabbMaxZ;var Q=n._children[0]._height,U=n._children[1]._height;n._height=(Q>U?Q:U)+1}z!=null?(z._children[k]=p,p._parent=z,p._childIndex=k):(_._root=p,p._parent=null),n=p}else if(I<-1){var G=y._children[0],D=y._children[1],H=G._height,j=D._height;if(H>j){y._children[1]=n,n._parent=y,n._childIndex=1,n._children[1]=D,D._parent=n,D._childIndex=1;var ia=y._children[0],sa=y._children[1];y._aabbMinX=ia._aabbMinX<sa._aabbMinX?ia._aabbMinX:sa._aabbMinX,y._aabbMinY=ia._aabbMinY<sa._aabbMinY?ia._aabbMinY:sa._aabbMinY,y._aabbMinZ=ia._aabbMinZ<sa._aabbMinZ?ia._aabbMinZ:sa._aabbMinZ,y._aabbMaxX=ia._aabbMaxX>sa._aabbMaxX?ia._aabbMaxX:sa._aabbMaxX,y._aabbMaxY=ia._aabbMaxY>sa._aabbMaxY?ia._aabbMaxY:sa._aabbMaxY,y._aabbMaxZ=ia._aabbMaxZ>sa._aabbMaxZ?ia._aabbMaxZ:sa._aabbMaxZ;var W=y._children[0]._height,q=y._children[1]._height;y._height=(W>q?W:q)+1;var na=n._children[0],oa=n._children[1];n._aabbMinX=na._aabbMinX<oa._aabbMinX?na._aabbMinX:oa._aabbMinX,n._aabbMinY=na._aabbMinY<oa._aabbMinY?na._aabbMinY:oa._aabbMinY,n._aabbMinZ=na._aabbMinZ<oa._aabbMinZ?na._aabbMinZ:oa._aabbMinZ,n._aabbMaxX=na._aabbMaxX>oa._aabbMaxX?na._aabbMaxX:oa._aabbMaxX,n._aabbMaxY=na._aabbMaxY>oa._aabbMaxY?na._aabbMaxY:oa._aabbMaxY,n._aabbMaxZ=na._aabbMaxZ>oa._aabbMaxZ?na._aabbMaxZ:oa._aabbMaxZ;var aa=n._children[0]._height,T=n._children[1]._height;n._height=(aa>T?aa:T)+1}else{y._children[0]=n,n._parent=y,n._childIndex=0,n._children[1]=G,G._parent=n,G._childIndex=1;var ca=y._children[0],_a=y._children[1];y._aabbMinX=ca._aabbMinX<_a._aabbMinX?ca._aabbMinX:_a._aabbMinX,y._aabbMinY=ca._aabbMinY<_a._aabbMinY?ca._aabbMinY:_a._aabbMinY,y._aabbMinZ=ca._aabbMinZ<_a._aabbMinZ?ca._aabbMinZ:_a._aabbMinZ,y._aabbMaxX=ca._aabbMaxX>_a._aabbMaxX?ca._aabbMaxX:_a._aabbMaxX,y._aabbMaxY=ca._aabbMaxY>_a._aabbMaxY?ca._aabbMaxY:_a._aabbMaxY,y._aabbMaxZ=ca._aabbMaxZ>_a._aabbMaxZ?ca._aabbMaxZ:_a._aabbMaxZ;var w=y._children[0]._height,ta=y._children[1]._height;y._height=(w>ta?w:ta)+1;var ra=n._children[0],la=n._children[1];n._aabbMinX=ra._aabbMinX<la._aabbMinX?ra._aabbMinX:la._aabbMinX,n._aabbMinY=ra._aabbMinY<la._aabbMinY?ra._aabbMinY:la._aabbMinY,n._aabbMinZ=ra._aabbMinZ<la._aabbMinZ?ra._aabbMinZ:la._aabbMinZ,n._aabbMaxX=ra._aabbMaxX>la._aabbMaxX?ra._aabbMaxX:la._aabbMaxX,n._aabbMaxY=ra._aabbMaxY>la._aabbMaxY?ra._aabbMaxY:la._aabbMaxY,n._aabbMaxZ=ra._aabbMaxZ>la._aabbMaxZ?ra._aabbMaxZ:la._aabbMaxZ;var va=n._children[0]._height,xa=n._children[1]._height;n._height=(va>xa?va:xa)+1}z!=null?(z._children[k]=y,y._parent=z,y._childIndex=k):(_._root=y,y._parent=null),n=y}else n=n}}var za=n._children[0]._height,Ma=n._children[1]._height;n._height=(za>Ma?za:Ma)+1;var Xa=n._children[0],Za=n._children[1];n._aabbMinX=Xa._aabbMinX<Za._aabbMinX?Xa._aabbMinX:Za._aabbMinX,n._aabbMinY=Xa._aabbMinY<Za._aabbMinY?Xa._aabbMinY:Za._aabbMinY,n._aabbMinZ=Xa._aabbMinZ<Za._aabbMinZ?Xa._aabbMinZ:Za._aabbMinZ,n._aabbMaxX=Xa._aabbMaxX>Za._aabbMaxX?Xa._aabbMaxX:Za._aabbMaxX,n._aabbMaxY=Xa._aabbMaxY>Za._aabbMaxY?Xa._aabbMaxY:Za._aabbMaxY,n._aabbMaxZ=Xa._aabbMaxZ>Za._aabbMaxZ?Xa._aabbMaxZ:Za._aabbMaxZ,n=n._parent}}}s._leaf=null,h._next=null,h._childIndex=0,h._children[0]=null,h._children[1]=null,h._childIndex=0,h._parent=null,h._height=0,h._proxy=null,h._next=_._nodePool,_._nodePool=h;var fa=this._tree,ba=fa._nodePool;ba!=null?(fa._nodePool=ba._next,ba._next=null):ba=new x.collision.broadphase.bvh.BvhNode;var ea=ba;if(ea._proxy=s,s._leaf=ea,ea._aabbMinX=s._aabbMinX,ea._aabbMinY=s._aabbMinY,ea._aabbMinZ=s._aabbMinZ,ea._aabbMaxX=s._aabbMaxX,ea._aabbMaxY=s._aabbMaxY,ea._aabbMaxZ=s._aabbMaxZ,fa._numLeaves++,fa.leafList==null?(fa.leafList=ea,fa.leafListLast=ea):(fa.leafListLast._nextLeaf=ea,ea._prevLeaf=fa.leafListLast,fa.leafListLast=ea),fa._root==null)fa._root=ea;else{for(var ha=fa._root;ha._height>0;){var ma=fa._strategy._decideInsertion(ha,ea);if(ma==-1)break;ha=ha._children[ma]}var ya=ha._parent,da=fa._nodePool;da!=null?(fa._nodePool=da._next,da._next=null):da=new x.collision.broadphase.bvh.BvhNode;var pa=da;if(ya==null)fa._root=pa;else{var Ya=ha._childIndex;ya._children[Ya]=pa,pa._parent=ya,pa._childIndex=Ya}var Qa=ha._childIndex;pa._children[Qa]=ha,ha._parent=pa,ha._childIndex=Qa;var ga=ha._childIndex^1;for(pa._children[ga]=ea,ea._parent=pa,ea._childIndex=ga;pa!=null;){if(fa._strategy._balancingEnabled){var ua=pa._height;if(ua<2)pa=pa;else{var wa=pa._parent,ka=pa._children[0],Sa=pa._children[1],zt=ka._height,Ha=Sa._height,Ba=zt-Ha,nt=pa._childIndex;if(Ba>1){var Ea=ka._children[0],Fa=ka._children[1],Aa=Ea._height,ft=Fa._height;if(Aa>ft){ka._children[1]=pa,pa._parent=ka,pa._childIndex=1,pa._children[0]=Fa,Fa._parent=pa,Fa._childIndex=0;var Wa=ka._children[0],Ka=ka._children[1];ka._aabbMinX=Wa._aabbMinX<Ka._aabbMinX?Wa._aabbMinX:Ka._aabbMinX,ka._aabbMinY=Wa._aabbMinY<Ka._aabbMinY?Wa._aabbMinY:Ka._aabbMinY,ka._aabbMinZ=Wa._aabbMinZ<Ka._aabbMinZ?Wa._aabbMinZ:Ka._aabbMinZ,ka._aabbMaxX=Wa._aabbMaxX>Ka._aabbMaxX?Wa._aabbMaxX:Ka._aabbMaxX,ka._aabbMaxY=Wa._aabbMaxY>Ka._aabbMaxY?Wa._aabbMaxY:Ka._aabbMaxY,ka._aabbMaxZ=Wa._aabbMaxZ>Ka._aabbMaxZ?Wa._aabbMaxZ:Ka._aabbMaxZ;var bt=ka._children[0]._height,it=ka._children[1]._height;ka._height=(bt>it?bt:it)+1;var $a=pa._children[0],_t=pa._children[1];pa._aabbMinX=$a._aabbMinX<_t._aabbMinX?$a._aabbMinX:_t._aabbMinX,pa._aabbMinY=$a._aabbMinY<_t._aabbMinY?$a._aabbMinY:_t._aabbMinY,pa._aabbMinZ=$a._aabbMinZ<_t._aabbMinZ?$a._aabbMinZ:_t._aabbMinZ,pa._aabbMaxX=$a._aabbMaxX>_t._aabbMaxX?$a._aabbMaxX:_t._aabbMaxX,pa._aabbMaxY=$a._aabbMaxY>_t._aabbMaxY?$a._aabbMaxY:_t._aabbMaxY,pa._aabbMaxZ=$a._aabbMaxZ>_t._aabbMaxZ?$a._aabbMaxZ:_t._aabbMaxZ;var gt=pa._children[0]._height,pt=pa._children[1]._height;pa._height=(gt>pt?gt:pt)+1}else{ka._children[0]=pa,pa._parent=ka,pa._childIndex=0,pa._children[0]=Ea,Ea._parent=pa,Ea._childIndex=0;var Ga=ka._children[0],rt=ka._children[1];ka._aabbMinX=Ga._aabbMinX<rt._aabbMinX?Ga._aabbMinX:rt._aabbMinX,ka._aabbMinY=Ga._aabbMinY<rt._aabbMinY?Ga._aabbMinY:rt._aabbMinY,ka._aabbMinZ=Ga._aabbMinZ<rt._aabbMinZ?Ga._aabbMinZ:rt._aabbMinZ,ka._aabbMaxX=Ga._aabbMaxX>rt._aabbMaxX?Ga._aabbMaxX:rt._aabbMaxX,ka._aabbMaxY=Ga._aabbMaxY>rt._aabbMaxY?Ga._aabbMaxY:rt._aabbMaxY,ka._aabbMaxZ=Ga._aabbMaxZ>rt._aabbMaxZ?Ga._aabbMaxZ:rt._aabbMaxZ;var ut=ka._children[0]._height,Da=ka._children[1]._height;ka._height=(ut>Da?ut:Da)+1;var Ta=pa._children[0],Na=pa._children[1];pa._aabbMinX=Ta._aabbMinX<Na._aabbMinX?Ta._aabbMinX:Na._aabbMinX,pa._aabbMinY=Ta._aabbMinY<Na._aabbMinY?Ta._aabbMinY:Na._aabbMinY,pa._aabbMinZ=Ta._aabbMinZ<Na._aabbMinZ?Ta._aabbMinZ:Na._aabbMinZ,pa._aabbMaxX=Ta._aabbMaxX>Na._aabbMaxX?Ta._aabbMaxX:Na._aabbMaxX,pa._aabbMaxY=Ta._aabbMaxY>Na._aabbMaxY?Ta._aabbMaxY:Na._aabbMaxY,pa._aabbMaxZ=Ta._aabbMaxZ>Na._aabbMaxZ?Ta._aabbMaxZ:Na._aabbMaxZ;var Vt=pa._children[0]._height,St=pa._children[1]._height;pa._height=(Vt>St?Vt:St)+1}wa!=null?(wa._children[nt]=ka,ka._parent=wa,ka._childIndex=nt):(fa._root=ka,ka._parent=null),pa=ka}else if(Ba<-1){var et=Sa._children[0],Xt=Sa._children[1],Yt=et._height,Mt=Xt._height;if(Yt>Mt){Sa._children[1]=pa,pa._parent=Sa,pa._childIndex=1,pa._children[1]=Xt,Xt._parent=pa,Xt._childIndex=1;var Ia=Sa._children[0],O=Sa._children[1];Sa._aabbMinX=Ia._aabbMinX<O._aabbMinX?Ia._aabbMinX:O._aabbMinX,Sa._aabbMinY=Ia._aabbMinY<O._aabbMinY?Ia._aabbMinY:O._aabbMinY,Sa._aabbMinZ=Ia._aabbMinZ<O._aabbMinZ?Ia._aabbMinZ:O._aabbMinZ,Sa._aabbMaxX=Ia._aabbMaxX>O._aabbMaxX?Ia._aabbMaxX:O._aabbMaxX,Sa._aabbMaxY=Ia._aabbMaxY>O._aabbMaxY?Ia._aabbMaxY:O._aabbMaxY,Sa._aabbMaxZ=Ia._aabbMaxZ>O._aabbMaxZ?Ia._aabbMaxZ:O._aabbMaxZ;var Va=Sa._children[0]._height,lt=Sa._children[1]._height;Sa._height=(Va>lt?Va:lt)+1;var S=pa._children[0],wt=pa._children[1];pa._aabbMinX=S._aabbMinX<wt._aabbMinX?S._aabbMinX:wt._aabbMinX,pa._aabbMinY=S._aabbMinY<wt._aabbMinY?S._aabbMinY:wt._aabbMinY,pa._aabbMinZ=S._aabbMinZ<wt._aabbMinZ?S._aabbMinZ:wt._aabbMinZ,pa._aabbMaxX=S._aabbMaxX>wt._aabbMaxX?S._aabbMaxX:wt._aabbMaxX,pa._aabbMaxY=S._aabbMaxY>wt._aabbMaxY?S._aabbMaxY:wt._aabbMaxY,pa._aabbMaxZ=S._aabbMaxZ>wt._aabbMaxZ?S._aabbMaxZ:wt._aabbMaxZ;var Bt=pa._children[0]._height,At=pa._children[1]._height;pa._height=(Bt>At?Bt:At)+1}else{Sa._children[0]=pa,pa._parent=Sa,pa._childIndex=0,pa._children[1]=et,et._parent=pa,et._childIndex=1;var yt=Sa._children[0],kt=Sa._children[1];Sa._aabbMinX=yt._aabbMinX<kt._aabbMinX?yt._aabbMinX:kt._aabbMinX,Sa._aabbMinY=yt._aabbMinY<kt._aabbMinY?yt._aabbMinY:kt._aabbMinY,Sa._aabbMinZ=yt._aabbMinZ<kt._aabbMinZ?yt._aabbMinZ:kt._aabbMinZ,Sa._aabbMaxX=yt._aabbMaxX>kt._aabbMaxX?yt._aabbMaxX:kt._aabbMaxX,Sa._aabbMaxY=yt._aabbMaxY>kt._aabbMaxY?yt._aabbMaxY:kt._aabbMaxY,Sa._aabbMaxZ=yt._aabbMaxZ>kt._aabbMaxZ?yt._aabbMaxZ:kt._aabbMaxZ;var mt=Sa._children[0]._height,ht=Sa._children[1]._height;Sa._height=(mt>ht?mt:ht)+1;var xt=pa._children[0],Ra=pa._children[1];pa._aabbMinX=xt._aabbMinX<Ra._aabbMinX?xt._aabbMinX:Ra._aabbMinX,pa._aabbMinY=xt._aabbMinY<Ra._aabbMinY?xt._aabbMinY:Ra._aabbMinY,pa._aabbMinZ=xt._aabbMinZ<Ra._aabbMinZ?xt._aabbMinZ:Ra._aabbMinZ,pa._aabbMaxX=xt._aabbMaxX>Ra._aabbMaxX?xt._aabbMaxX:Ra._aabbMaxX,pa._aabbMaxY=xt._aabbMaxY>Ra._aabbMaxY?xt._aabbMaxY:Ra._aabbMaxY,pa._aabbMaxZ=xt._aabbMaxZ>Ra._aabbMaxZ?xt._aabbMaxZ:Ra._aabbMaxZ;var st=pa._children[0]._height,Ca=pa._children[1]._height;pa._height=(st>Ca?st:Ca)+1}wa!=null?(wa._children[nt]=Sa,Sa._parent=wa,Sa._childIndex=nt):(fa._root=Sa,Sa._parent=null),pa=Sa}else pa=pa}}var vt=pa._children[0]._height,qa=pa._children[1]._height;pa._height=(vt>qa?vt:qa)+1;var at=pa._children[0],Oa=pa._children[1];pa._aabbMinX=at._aabbMinX<Oa._aabbMinX?at._aabbMinX:Oa._aabbMinX,pa._aabbMinY=at._aabbMinY<Oa._aabbMinY?at._aabbMinY:Oa._aabbMinY,pa._aabbMinZ=at._aabbMinZ<Oa._aabbMinZ?at._aabbMinZ:Oa._aabbMinZ,pa._aabbMaxX=at._aabbMaxX>Oa._aabbMaxX?at._aabbMaxX:Oa._aabbMaxX,pa._aabbMaxY=at._aabbMaxY>Oa._aabbMaxY?at._aabbMaxY:Oa._aabbMaxY,pa._aabbMaxZ=at._aabbMaxZ>Oa._aabbMaxZ?at._aabbMaxZ:Oa._aabbMaxZ,pa=pa._parent}}t&&this.collide(this._tree._root,s._leaf),s._moved=!1}this.movedProxies[o]=null}t||this.collide(this._tree._root,this._tree._root),this.numMovedProxies=0}}rayCast(a,t,i){if(this._tree._root!=null){var r,o,s,_,h,v,e=a;r=e.x,o=e.y,s=e.z;var l=t;_=l.x,h=l.y,v=l.z,this.rayCastRecursive(this._tree._root,r,o,s,_,h,v,i)}}convexCast(a,t,i,r){this._tree._root!=null&&this.convexCastRecursive(this._tree._root,a,t,i,r)}aabbTest(a,t){this._tree._root!=null&&this.aabbTestRecursive(this._tree._root,a,t)}getTreeBalance(){return this._tree._getBalance()}};x.collision.broadphase.bvh.BvhInsertionStrategy=class{};x.collision.broadphase.bvh.BvhNode=class{constructor(){this._next=null,this._prevLeaf=null,this._nextLeaf=null;var a=new Array(2);this._children=a,this._childIndex=0,this._parent=null,this._height=0,this._proxy=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}};x.collision.broadphase.bvh.BvhProxy=class extends x.collision.broadphase.Proxy{constructor(a,t){super(a,t),this._leaf=null,this._moved=!1}};x.collision.broadphase.bvh.BvhStrategy=class{constructor(){this._insertionStrategy=0,this._balancingEnabled=!1}_decideInsertion(a,t){switch(this._insertionStrategy){case 0:var i,r,o;i=t._aabbMinX+t._aabbMaxX,r=t._aabbMinY+t._aabbMaxY,o=t._aabbMinZ+t._aabbMaxZ;var s=a._children[0],_=a._children[1],h,v,e,l,u,b;h=s._aabbMinX+s._aabbMaxX,v=s._aabbMinY+s._aabbMaxY,e=s._aabbMinZ+s._aabbMaxZ,l=_._aabbMinX+_._aabbMaxX,u=_._aabbMinY+_._aabbMaxY,b=_._aabbMinZ+_._aabbMaxZ,h-=i,v-=r,e-=o,l-=i,u-=r,b-=o;var f=h*h+v*v+e*e,n=l*l+u*u+b*b;return f<n?0:1;case 1:var c=a._children[0],z=a._children[1],p=a._aabbMaxX-a._aabbMinX,y=a._aabbMaxY-a._aabbMinY,V=a._aabbMaxZ-a._aabbMinZ,M=(p*(y+V)+y*V)*2,I,k,X,L,m,g;I=a._aabbMinX<t._aabbMinX?a._aabbMinX:t._aabbMinX,k=a._aabbMinY<t._aabbMinY?a._aabbMinY:t._aabbMinY,X=a._aabbMinZ<t._aabbMinZ?a._aabbMinZ:t._aabbMinZ,L=a._aabbMaxX>t._aabbMaxX?a._aabbMaxX:t._aabbMaxX,m=a._aabbMaxY>t._aabbMaxY?a._aabbMaxY:t._aabbMaxY,g=a._aabbMaxZ>t._aabbMaxZ?a._aabbMaxZ:t._aabbMaxZ;var N=L-I,A=m-k,F=g-X,P=(N*(A+F)+A*F)*2,Y=P*2,R=(P-M)*2,C=R;if(I=c._aabbMinX<t._aabbMinX?c._aabbMinX:t._aabbMinX,k=c._aabbMinY<t._aabbMinY?c._aabbMinY:t._aabbMinY,X=c._aabbMinZ<t._aabbMinZ?c._aabbMinZ:t._aabbMinZ,L=c._aabbMaxX>t._aabbMaxX?c._aabbMaxX:t._aabbMaxX,m=c._aabbMaxY>t._aabbMaxY?c._aabbMaxY:t._aabbMaxY,g=c._aabbMaxZ>t._aabbMaxZ?c._aabbMaxZ:t._aabbMaxZ,c._height==0){var d=L-I,Z=m-k,$=g-X;C+=(d*(Z+$)+Z*$)*2}else{var K=L-I,E=m-k,J=g-X,B=c._aabbMaxX-c._aabbMinX,Q=c._aabbMaxY-c._aabbMinY,U=c._aabbMaxZ-c._aabbMinZ;C+=(K*(E+J)+E*J)*2-(B*(Q+U)+Q*U)*2}var G=R;if(I=z._aabbMinX<t._aabbMinX?z._aabbMinX:t._aabbMinX,k=z._aabbMinY<t._aabbMinY?z._aabbMinY:t._aabbMinY,X=z._aabbMinZ<t._aabbMinZ?z._aabbMinZ:t._aabbMinZ,L=z._aabbMaxX>t._aabbMaxX?z._aabbMaxX:t._aabbMaxX,m=z._aabbMaxY>t._aabbMaxY?z._aabbMaxY:t._aabbMaxY,g=z._aabbMaxZ>t._aabbMaxZ?z._aabbMaxZ:t._aabbMaxZ,z._height==0){var D=L-I,H=m-k,j=g-X;G+=(D*(H+j)+H*j)*2}else{var ia=L-I,sa=m-k,W=g-X,q=z._aabbMaxX-z._aabbMinX,na=z._aabbMaxY-z._aabbMinY,oa=z._aabbMaxZ-z._aabbMinZ;G+=(ia*(sa+W)+sa*W)*2-(q*(na+oa)+na*oa)*2}return Y<C?Y<G?-1:1:C<G?0:1;default:return console.log("src/oimo/collision/broadphase/bvh/BvhStrategy.hx:37:","invalid BVH insertion strategy: "+this._insertionStrategy),-1}}_splitLeaves(a,t,i){var r=1/(i-t),o,s,_;o=0,s=0,_=0;for(var h=t,v=i;h<v;){var e=h++,l=a[e];l._tmpX=l._aabbMaxX+l._aabbMinX,l._tmpY=l._aabbMaxY+l._aabbMinY,l._tmpZ=l._aabbMaxZ+l._aabbMinZ,o+=l._tmpX,s+=l._tmpY,_+=l._tmpZ}o*=r,s*=r,_*=r;var u,b,f;u=0,b=0,f=0;for(var n=t,c=i;n<c;){var z=n++,p=a[z],y,V,M;y=p._tmpX-o,V=p._tmpY-s,M=p._tmpZ-_,y*=y,V*=V,M*=M,u+=y,b+=V,f+=M}var I=u,k=b,X=f,L=t,m=i-1;if(I>k)if(I>X)for(var g=o;;){for(;;){var N=a[L];if(N._tmpX<=g)break;++L}for(;;){var A=a[m];if(A._tmpX>=g)break;--m}if(L>=m)break;var F=a[L];a[L]=a[m],a[m]=F,++L,--m}else for(var P=_;;){for(;;){var Y=a[L];if(Y._tmpZ<=P)break;++L}for(;;){var R=a[m];if(R._tmpZ>=P)break;--m}if(L>=m)break;var C=a[L];a[L]=a[m],a[m]=C,++L,--m}else if(k>X)for(var d=s;;){for(;;){var Z=a[L];if(Z._tmpY<=d)break;++L}for(;;){var $=a[m];if($._tmpY>=d)break;--m}if(L>=m)break;var K=a[L];a[L]=a[m],a[m]=K,++L,--m}else for(var E=_;;){for(;;){var J=a[L];if(J._tmpZ<=E)break;++L}for(;;){var B=a[m];if(B._tmpZ>=E)break;--m}if(L>=m)break;var Q=a[L];a[L]=a[m],a[m]=Q,++L,--m}return L}};x.collision.broadphase.bvh.BvhTree=class{constructor(){this._root=null,this._numLeaves=0,this._strategy=new x.collision.broadphase.bvh.BvhStrategy,this._nodePool=null,this.leafList=null,this.leafListLast=null;var a=new Array(1024);this.tmp=a}_print(a,t){if(t==null&&(t=""),a!=null)if(a._height==0)console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:39:",t+a._proxy._id);else{this._print(a._children[0],t+"  ");var i,r,o,s;r=a._aabbMaxX-a._aabbMinX,o=a._aabbMaxY-a._aabbMinY,s=a._aabbMaxZ-a._aabbMinZ;var _=r,h=o,v=s;if(_*(h+v)+h*v>0){var e,l,u;e=a._aabbMaxX-a._aabbMinX,l=a._aabbMaxY-a._aabbMinY,u=a._aabbMaxZ-a._aabbMinZ;var b=e,f=l,n=u;i=((b*(f+n)+f*n)*1e3+.5|0)/1e3}else{var c,z,p;c=a._aabbMaxX-a._aabbMinX,z=a._aabbMaxY-a._aabbMinY,p=a._aabbMaxZ-a._aabbMinZ;var y=c,V=z,M=p;i=((y*(V+M)+V*M)*1e3-.5|0)/1e3}console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:42:",t+"#"+a._height+", "+i),this._print(a._children[1],t+"  ")}}_getBalance(){return this.getBalanceRecursive(this._root)}deleteRecursive(a){if(a._height==0){var t=a._prevLeaf,i=a._nextLeaf;t!=null&&(t._nextLeaf=i),i!=null&&(i._prevLeaf=t),a==this.leafList&&(this.leafList=this.leafList._nextLeaf),a==this.leafListLast&&(this.leafListLast=this.leafListLast._prevLeaf),a._nextLeaf=null,a._prevLeaf=null,a._proxy._leaf=null,a._next=null,a._childIndex=0,a._children[0]=null,a._children[1]=null,a._childIndex=0,a._parent=null,a._height=0,a._proxy=null,a._next=this._nodePool,this._nodePool=a;return}this.deleteRecursive(a._children[0]),this.deleteRecursive(a._children[1]),a._next=null,a._childIndex=0,a._children[0]=null,a._children[1]=null,a._childIndex=0,a._parent=null,a._height=0,a._proxy=null,a._next=this._nodePool,this._nodePool=a}decomposeRecursive(a){if(a._height==0){a._childIndex=0,a._parent=null;return}this.decomposeRecursive(a._children[0]),this.decomposeRecursive(a._children[1]),a._next=null,a._childIndex=0,a._children[0]=null,a._children[1]=null,a._childIndex=0,a._parent=null,a._height=0,a._proxy=null,a._next=this._nodePool,this._nodePool=a}buildTopDownRecursive(a,t,i){var r=i-t;if(r==1){var o=a[t],s=o._proxy;return o._aabbMinX=s._aabbMinX,o._aabbMinY=s._aabbMinY,o._aabbMinZ=s._aabbMinZ,o._aabbMaxX=s._aabbMaxX,o._aabbMaxY=s._aabbMaxY,o._aabbMaxZ=s._aabbMaxZ,o}var _=this._strategy._splitLeaves(a,t,i),h=this.buildTopDownRecursive(a,t,_),v=this.buildTopDownRecursive(a,_,i),e=this._nodePool;e!=null?(this._nodePool=e._next,e._next=null):e=new x.collision.broadphase.bvh.BvhNode;var l=e;l._children[0]=h,h._parent=l,h._childIndex=0,l._children[1]=v,v._parent=l,v._childIndex=1;var u=l._children[0],b=l._children[1];l._aabbMinX=u._aabbMinX<b._aabbMinX?u._aabbMinX:b._aabbMinX,l._aabbMinY=u._aabbMinY<b._aabbMinY?u._aabbMinY:b._aabbMinY,l._aabbMinZ=u._aabbMinZ<b._aabbMinZ?u._aabbMinZ:b._aabbMinZ,l._aabbMaxX=u._aabbMaxX>b._aabbMaxX?u._aabbMaxX:b._aabbMaxX,l._aabbMaxY=u._aabbMaxY>b._aabbMaxY?u._aabbMaxY:b._aabbMaxY,l._aabbMaxZ=u._aabbMaxZ>b._aabbMaxZ?u._aabbMaxZ:b._aabbMaxZ;var f=l._children[0]._height,n=l._children[1]._height;return l._height=(f>n?f:n)+1,l}getBalanceRecursive(a){if(a==null||a._height==0)return 0;var t=a._children[0]._height-a._children[1]._height;return t<0&&(t=-t),t+this.getBalanceRecursive(a._children[0])+this.getBalanceRecursive(a._children[1])}};x.collision.geometry.Aabb=class{constructor(){this._minX=0,this._minY=0,this._minZ=0,this._maxX=0,this._maxY=0,this._maxZ=0}init(a,t){var i=a;this._minX=i.x,this._minY=i.y,this._minZ=i.z;var r=t;return this._maxX=r.x,this._maxY=r.y,this._maxZ=r.z,this}getMin(){var a=new x.common.Vec3,t=a;return t.x=this._minX,t.y=this._minY,t.z=this._minZ,a}getMinTo(a){var t=a;t.x=this._minX,t.y=this._minY,t.z=this._minZ}setMin(a){var t=a;return this._minX=t.x,this._minY=t.y,this._minZ=t.z,this}getMax(){var a=new x.common.Vec3,t=a;return t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ,a}getMaxTo(a){var t=a;t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ}setMax(a){var t=a;return this._maxX=t.x,this._maxY=t.y,this._maxZ=t.z,this}getCenter(){var a=new x.common.Vec3,t,i,r;t=this._minX+this._maxX,i=this._minY+this._maxY,r=this._minZ+this._maxZ,t*=.5,i*=.5,r*=.5;var o=a;return o.x=t,o.y=i,o.z=r,a}getCenterTo(a){var t,i,r;t=this._minX+this._maxX,i=this._minY+this._maxY,r=this._minZ+this._maxZ,t*=.5,i*=.5,r*=.5;var o=a;o.x=t,o.y=i,o.z=r}getExtents(){var a=new x.common.Vec3,t,i,r;t=this._maxX-this._minX,i=this._maxY-this._minY,r=this._maxZ-this._minZ,t*=.5,i*=.5,r*=.5;var o=a;return o.x=t,o.y=i,o.z=r,a}getExtentsTo(a){var t,i,r;t=this._maxX-this._minX,i=this._maxY-this._minY,r=this._maxZ-this._minZ,t*=.5,i*=.5,r*=.5;var o=a;o.x=t,o.y=i,o.z=r}combine(a){return this._minX=this._minX<a._minX?this._minX:a._minX,this._minY=this._minY<a._minY?this._minY:a._minY,this._minZ=this._minZ<a._minZ?this._minZ:a._minZ,this._maxX=this._maxX>a._maxX?this._maxX:a._maxX,this._maxY=this._maxY>a._maxY?this._maxY:a._maxY,this._maxZ=this._maxZ>a._maxZ?this._maxZ:a._maxZ,this}combined(a){var t=new x.collision.geometry.Aabb;return t._minX=this._minX<a._minX?this._minX:a._minX,t._minY=this._minY<a._minY?this._minY:a._minY,t._minZ=this._minZ<a._minZ?this._minZ:a._minZ,t._maxX=this._maxX>a._maxX?this._maxX:a._maxX,t._maxY=this._maxY>a._maxY?this._maxY:a._maxY,t._maxZ=this._maxZ>a._maxZ?this._maxZ:a._maxZ,t}overlap(a){return this._minX<a._maxX&&this._maxX>a._minX&&this._minY<a._maxY&&this._maxY>a._minY&&this._minZ<a._maxZ?this._maxZ>a._minZ:!1}getIntersection(a){var t=new x.collision.geometry.Aabb;return t._minX=this._minX>a._minX?this._minX:a._minX,t._minY=this._minY>a._minY?this._minY:a._minY,t._minZ=this._minZ>a._minZ?this._minZ:a._minZ,t._maxX=this._maxX<a._maxX?this._maxX:a._maxX,t._maxY=this._maxY<a._maxY?this._maxY:a._maxY,t._maxZ=this._maxZ<a._maxZ?this._maxZ:a._maxZ,t}getIntersectionTo(a,t){t._minX=this._minX>a._minX?this._minX:a._minX,t._minY=this._minY>a._minY?this._minY:a._minY,t._minZ=this._minZ>a._minZ?this._minZ:a._minZ,t._maxX=this._maxX<a._maxX?this._maxX:a._maxX,t._maxY=this._maxY<a._maxY?this._maxY:a._maxY,t._maxZ=this._maxZ<a._maxZ?this._maxZ:a._maxZ}copyFrom(a){return this._minX=a._minX,this._minY=a._minY,this._minZ=a._minZ,this._maxX=a._maxX,this._maxY=a._maxY,this._maxZ=a._maxZ,this}clone(){var a=new x.collision.geometry.Aabb;return a._minX=this._minX,a._minY=this._minY,a._minZ=this._minZ,a._maxX=this._maxX,a._maxY=this._maxY,a._maxZ=this._maxZ,a}};x.collision.geometry.BoxGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(a){super(1);var t=a;this._halfExtentsX=t.x,this._halfExtentsY=t.y,this._halfExtentsZ=t.z,this._halfAxisXX=a.x,this._halfAxisXY=0,this._halfAxisXZ=0,this._halfAxisYX=0,this._halfAxisYY=a.y,this._halfAxisYZ=0,this._halfAxisZX=0,this._halfAxisZY=0,this._halfAxisZZ=a.z,this._updateMass();var i=a.x<a.y?a.z<a.x?a.z:a.x:a.z<a.y?a.z:a.y;this._gjkMargin>i*.2&&(this._gjkMargin=i*.2)}getHalfExtents(){var a=new x.common.Vec3,t=a;return t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ,a}getHalfExtentsTo(a){var t=a;t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ}_updateMass(){this._volume=8*(this._halfExtentsX*this._halfExtentsY*this._halfExtentsZ);var a,t,i;a=this._halfExtentsX*this._halfExtentsX,t=this._halfExtentsY*this._halfExtentsY,i=this._halfExtentsZ*this._halfExtentsZ,this._inertiaCoeff00=.3333333333333333*(t+i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(i+a),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(a+t)}_computeAabb(a,t){var i,r,o,s,_,h,v,e,l,u,b,f;u=t._rotation00*this._halfAxisXX+t._rotation01*this._halfAxisXY+t._rotation02*this._halfAxisXZ,b=t._rotation10*this._halfAxisXX+t._rotation11*this._halfAxisXY+t._rotation12*this._halfAxisXZ,f=t._rotation20*this._halfAxisXX+t._rotation21*this._halfAxisXY+t._rotation22*this._halfAxisXZ,i=u,r=b,o=f;var n,c,z;n=t._rotation00*this._halfAxisYX+t._rotation01*this._halfAxisYY+t._rotation02*this._halfAxisYZ,c=t._rotation10*this._halfAxisYX+t._rotation11*this._halfAxisYY+t._rotation12*this._halfAxisYZ,z=t._rotation20*this._halfAxisYX+t._rotation21*this._halfAxisYY+t._rotation22*this._halfAxisYZ,s=n,_=c,h=z;var p,y,V;p=t._rotation00*this._halfAxisZX+t._rotation01*this._halfAxisZY+t._rotation02*this._halfAxisZZ,y=t._rotation10*this._halfAxisZX+t._rotation11*this._halfAxisZY+t._rotation12*this._halfAxisZZ,V=t._rotation20*this._halfAxisZX+t._rotation21*this._halfAxisZY+t._rotation22*this._halfAxisZZ,v=p,e=y,l=V,i=i<0?-i:i,r=r<0?-r:r,o=o<0?-o:o,s=s<0?-s:s,_=_<0?-_:_,h=h<0?-h:h,v=v<0?-v:v,e=e<0?-e:e,l=l<0?-l:l;var M,I,k;M=i+s,I=r+_,k=o+h,M+=v,I+=e,k+=l,a._minX=t._positionX-M,a._minY=t._positionY-I,a._minZ=t._positionZ-k,a._maxX=t._positionX+M,a._maxY=t._positionY+I,a._maxZ=t._positionZ+k}computeLocalSupportingVertex(a,t){var i,r,o,s,_,h;i=this._gjkMargin,r=this._gjkMargin,o=this._gjkMargin,i=i<this._halfExtentsX?i:this._halfExtentsX,r=r<this._halfExtentsY?r:this._halfExtentsY,o=o<this._halfExtentsZ?o:this._halfExtentsZ,s=this._halfExtentsX-i,_=this._halfExtentsY-r,h=this._halfExtentsZ-o,t.x=a.x>0?s:-s,t.y=a.y>0?_:-_,t.z=a.z>0?h:-h}_rayCastLocal(a,t,i,r,o,s,_){var h=a,v=t,e=i,l=r,u=o,b=s,f=this._halfExtentsX,n=this._halfExtentsY,c=this._halfExtentsZ,z=l-h,p=u-v,y=b-e,V=0,M=0,I=0,k=1,X=1,L=1;if(z>-1e-6&&z<1e-6){if(h<=-f||h>=f)return!1}else{var m=1/z,g=(-f-h)*m,N=(f-h)*m;if(g>N){var A=g;g=N,N=A}g>0&&(V=g),N<1&&(k=N)}if(p>-1e-6&&p<1e-6){if(v<=-n||v>=n)return!1}else{var F=1/p,P=(-n-v)*F,Y=(n-v)*F;if(P>Y){var R=P;P=Y,Y=R}P>0&&(M=P),Y<1&&(X=Y)}if(y>-1e-6&&y<1e-6){if(e<=-c||e>=c)return!1}else{var C=1/y,d=(-c-e)*C,Z=(c-e)*C;if(d>Z){var $=d;d=Z,Z=$}d>0&&(I=d),Z<1&&(L=Z)}if(V>=1||M>=1||I>=1||k<=0||X<=0||L<=0)return!1;var K=V,E=k,J=0;if(M>K&&(K=M,J=1),I>K&&(K=I,J=2),X<E&&(E=X),L<E&&(E=L),K>E||K==0)return!1;switch(J){case 0:_.normal.init(z>0?-1:1,0,0);break;case 1:_.normal.init(0,p>0?-1:1,0);break;case 2:_.normal.init(0,0,y>0?-1:1);break}return _.position.init(h+K*z,v+K*p,e+K*y),_.fraction=K,!0}};x.collision.geometry.CapsuleGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(a,t){super(4),this._radius=a,this._halfHeight=t,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){var a=this._radius*this._radius,t=this._halfHeight*this._halfHeight,i=6.28318530717958*a*this._halfHeight,r=3.14159265358979*a*this._radius*4/3;this._volume=i+r;var o=this._volume==0?0:1/this._volume,s=o*(i*a*.5+r*a*.4),_=o*(i*(a*.25+t/3)+r*(a*.4+this._halfHeight*this._radius*.75+t));this._inertiaCoeff00=_,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=s,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=_}_computeAabb(a,t){var i,r,o;i=this._radius,r=this._radius,o=this._radius;var s,_,h;s=t._rotation01,_=t._rotation11,h=t._rotation21,s=s<0?-s:s,_=_<0?-_:_,h=h<0?-h:h,s*=this._halfHeight,_*=this._halfHeight,h*=this._halfHeight,i+=s,r+=_,o+=h,a._minX=t._positionX-i,a._minY=t._positionY-r,a._minZ=t._positionZ-o,a._maxX=t._positionX+i,a._maxY=t._positionY+r,a._maxZ=t._positionZ+o}computeLocalSupportingVertex(a,t){a.y>0?t.init(0,this._halfHeight,0):t.init(0,-this._halfHeight,0)}_rayCastLocal(a,t,i,r,o,s,_){var h=a,v=t,e=i,l=r,u=o,b=s,f=this._halfHeight,n=l-h,c=u-v,z=b-e,p=0,y=1,V=n*n+z*z,M=h*n+e*z,I=h*h+e*e-this._radius*this._radius,k=M*M-V*I;if(k<0)return!1;if(V>0){var X=Math.sqrt(k);if(p=(-M-X)/V,y=(-M+X)/V,p>=1||y<=0)return!1}else{if(I>=0)return!1;p=0,y=1}var L=v+c*p,m;if(L>-f&&L<f){if(p>0){m=p;var g=_.normal.init(h+n*m,0,e+z*m),N=Math.sqrt(g.x*g.x+g.y*g.y+g.z*g.z);N>0&&(N=1/N);var A=g.x*N,F=g.y*N,P=g.z*N;return g.x=A,g.y=F,g.z=P,_.position.init(h+m*n,L,e+m*z),_.fraction=m,!0}return!1}var Y=L<0?-f:f,R,C,d,Z,$,K;R=0,C=Y,d=0,Z=a-R,$=t-C,K=i-d;var E,J,B;if(E=r-a,J=o-t,B=s-i,V=E*E+J*J+B*B,M=Z*E+$*J+K*B,I=Z*Z+$*$+K*K-this._radius*this._radius,k=M*M-V*I,k<0)return!1;var Q=(-M-Math.sqrt(k))/V;if(Q<0||Q>1)return!1;var U,G,D,H,j,ia;U=Z+E*Q,G=$+J*Q,D=K+B*Q;var sa=U*U+G*G+D*D;sa>0&&(sa=1/Math.sqrt(sa)),H=U*sa,j=G*sa,ia=D*sa,U+=R,G+=C,D+=d;var W=_.position;W.x=U,W.y=G,W.z=D;var q=_.normal;return q.x=H,q.y=j,q.z=ia,_.fraction=Q,!0}};x.collision.geometry.ConeGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(a,t){super(3),this._radius=a,this._halfHeight=t,this.sinTheta=a/Math.sqrt(a*a+4*t*t),this.cosTheta=2*t/Math.sqrt(a*a+4*t*t),this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){var a=this._radius*this._radius,t=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*a*this._halfHeight*2/3,this._inertiaCoeff00=.05*(3*a+2*t),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3*a,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.05*(3*a+2*t)}_computeAabb(a,t){var i,r,o,s,_,h,v,e,l,u,b,f;i=t._rotation01,r=t._rotation11,o=t._rotation21,s=i*i,_=r*r,h=o*o;var n=s,c=_,z=h;u=Math.sqrt(1-n),b=Math.sqrt(1-c),f=Math.sqrt(1-z),u*=this._radius,b*=this._radius,f*=this._radius,v=i*this._halfHeight,e=r*this._halfHeight,l=o*this._halfHeight;var p,y,V,M,I,k;p=-v,y=-e,V=-l,p-=u,y-=b,V-=f,M=-v,I=-e,k=-l,M+=u,I+=b,k+=f;var X,L,m,g,N,A;X=p>M?p:M,L=y>I?y:I,m=V>k?V:k,X=X>v?X:v,L=L>e?L:e,m=m>l?m:l,g=p<M?p:M,N=y<I?y:I,A=V<k?V:k,g=g<v?g:v,N=N<e?N:e,A=A<l?A:l,a._minX=t._positionX+g,a._minY=t._positionY+N,a._minZ=t._positionZ+A,a._maxX=t._positionX+X,a._maxY=t._positionY+L,a._maxZ=t._positionZ+m}computeLocalSupportingVertex(a,t){var i=a.x,r=a.y,o=a.z;if(r>0&&r*r>this.sinTheta*this.sinTheta*(i*i+r*r+o*o)){t.init(0,this._halfHeight-this._gjkMargin/this.sinTheta,0),t.y<0&&(t.y=0);return}var s=a.x,_=a.z,h=s*s+_*_,v=2*this._halfHeight,e=(v-this._gjkMargin)/v*this._radius-this._gjkMargin/this.cosTheta;e<0&&(e=0);var l=h>0?e/Math.sqrt(h):0,u=this._halfHeight-this._gjkMargin;u<0&&(u=0),t.x=s*l,t.y=-u,t.z=_*l}_rayCastLocal(a,t,i,r,o,s,_){var h=a,v=t,e=i,l=r,u=o,b=s,f=this._halfHeight,n=l-h,c=u-v,z=b-e,p=0,y=1;if(c>-1e-6&&c<1e-6){if(v<=-f||v>=f)return!1}else{var V=1/c,M=(-f-v)*V,I=(f-v)*V;if(M>I){var k=M;M=I,I=k}M>0&&(p=M),I<1&&(y=I)}if(p>=1||y<=0)return!1;var X=0,L=0;v-=f;var m=this.cosTheta*this.cosTheta,g=m*(n*n+c*c+z*z)-c*c,N=m*(h*n+v*c+e*z)-v*c,A=m*(h*h+v*v+e*e)-v*v,F=N*N-g*A;if(g!=0){if(F<0)return!1;var P=Math.sqrt(F);if(g<0){if(c>0){if(X=0,L=(-N+P)/g,L<=0)return!1}else if(X=(-N-P)/g,L=1,X>=1)return!1}else if(X=(-N-P)/g,L=(-N+P)/g,X>=1||L<=0)return!1}else{var Y=-A/(2*N);if(N>0){if(X=0,L=Y,Y<=0)return!1}else if(X=Y,L=1,Y>=1)return!1}v+=f;var R;if(L<=p||y<=X)return!1;if(X<p){if(R=p,R==0)return!1;_.normal.init(0,c>0?-1:1,0)}else{if(R=X,R==0)return!1;var C=_.normal.init(h+n*R,0,e+z*R),d=Math.sqrt(C.x*C.x+C.y*C.y+C.z*C.z);d>0&&(d=1/d);var Z=C.x*d,$=C.y*d,K=C.z*d;C.x=Z,C.y=$,C.z=K;var E=C,J=this.cosTheta,B=E.x*J,Q=E.y*J,U=E.z*J;E.x=B,E.y=Q,E.z=U,_.normal.y+=this.sinTheta}return _.position.init(h+R*n,v+R*c,e+R*z),_.fraction=R,!0}};x.collision.geometry.ConvexHullGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(a){super(5),this._numVertices=a.length;var t=new Array(this._numVertices);this._vertices=t;var i=new Array(this._numVertices);this._tmpVertices=i;for(var r=0,o=this._numVertices;r<o;){var s=r++;this._vertices[s]=a[s],this._tmpVertices[s]=new x.common.Vec3}this._useGjkRayCast=!0,this._updateMass()}getVertices(){return this._vertices}_updateMass(){this._volume=1,this._inertiaCoeff00=1,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=1,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=1;for(var a=this._vertices[0].x,t=this._vertices[0].y,i=this._vertices[0].z,r=this._vertices[0].x,o=this._vertices[0].y,s=this._vertices[0].z,_=1,h=this._numVertices;_<h;){var v=_++,e=this._vertices[v].x,l=this._vertices[v].y,u=this._vertices[v].z;e<a?a=e:e>r&&(r=e),l<t?t=l:l>o&&(o=l),u<i?i=u:u>s&&(s=u)}var b=r-a,f=o-t,n=s-i;this._volume=b*f*n;var c=((a+r)*(a+r)+(t+o)*(t+o)+(i+s)*(i+s))*.25;b=b*b*.25,f=f*f*.25,n=n*n*.25,this._inertiaCoeff00=.3333333333333333*(f+n)+c,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(n+b)+c,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(b+f)+c}_computeAabb(a,t){var i,r,o,s,_,h,v,e,l;v=this._gjkMargin,e=this._gjkMargin,l=this._gjkMargin;var u,b,f,n=this._vertices[0];u=n.x,b=n.y,f=n.z;var c,z,p,y,V,M;y=t._rotation00*u+t._rotation01*b+t._rotation02*f,V=t._rotation10*u+t._rotation11*b+t._rotation12*f,M=t._rotation20*u+t._rotation21*b+t._rotation22*f,c=y,z=V,p=M,c+=t._positionX,z+=t._positionY,p+=t._positionZ,i=c,r=z,o=p,s=c,_=z,h=p;for(var I=1,k=this._numVertices;I<k;){var X=I++,L=this._vertices[X];u=L.x,b=L.y,f=L.z;var m,g,N;m=t._rotation00*u+t._rotation01*b+t._rotation02*f,g=t._rotation10*u+t._rotation11*b+t._rotation12*f,N=t._rotation20*u+t._rotation21*b+t._rotation22*f,c=m,z=g,p=N,c+=t._positionX,z+=t._positionY,p+=t._positionZ,i=i<c?i:c,r=r<z?r:z,o=o<p?o:p,s=s>c?s:c,_=_>z?_:z,h=h>p?h:p}a._minX=i-v,a._minY=r-e,a._minZ=o-l,a._maxX=s+v,a._maxY=_+e,a._maxZ=h+l}computeLocalSupportingVertex(a,t){for(var i=this._vertices[0],r=i.x*a.x+i.y*a.y+i.z*a.z,o=0,s=1,_=this._numVertices;s<_;){var h=s++,v=this._vertices[h],e=v.x*a.x+v.y*a.y+v.z*a.z;e>r&&(r=e,o=h)}var l=this._vertices[o];t.x=l.x,t.y=l.y,t.z=l.z}};x.collision.geometry.CylinderGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(a,t){super(2),this._radius=a,this._halfHeight=t,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){var a=this._radius*this._radius,t=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*a*this._halfHeight*2,this._inertiaCoeff00=.08333333333333333*(3*a+t),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.5*a,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.08333333333333333*(3*a+t)}_computeAabb(a,t){var i,r,o,s,_,h,v,e,l,u,b,f;i=t._rotation01,r=t._rotation11,o=t._rotation21,i=i<0?-i:i,r=r<0?-r:r,o=o<0?-o:o,s=i*i,_=r*r,h=o*o;var n=s,c=_,z=h;u=Math.sqrt(1-n),b=Math.sqrt(1-c),f=Math.sqrt(1-z),u*=this._radius,b*=this._radius,f*=this._radius,v=i*this._halfHeight,e=r*this._halfHeight,l=o*this._halfHeight;var p,y,V;p=u+v,y=b+e,V=f+l,a._minX=t._positionX-p,a._minY=t._positionY-y,a._minZ=t._positionZ-V,a._maxX=t._positionX+p,a._maxY=t._positionY+y,a._maxZ=t._positionZ+V}computeLocalSupportingVertex(a,t){var i=a.x,r=a.z,o=i*i+r*r,s=this._radius-this._gjkMargin;s<0&&(s=0);var _=o>0?s/Math.sqrt(o):0,h=this._halfHeight-this._gjkMargin;h<0&&(h=0),t.x=i*_,t.y=a.y>0?h:-h,t.z=r*_}_rayCastLocal(a,t,i,r,o,s,_){var h=a,v=t,e=i,l=r,u=o,b=s,f=this._halfHeight,n=l-h,c=u-v,z=b-e,p=0,y=1;if(c>-1e-6&&c<1e-6){if(v<=-f||v>=f)return!1}else{var V=1/c,M=(-f-v)*V,I=(f-v)*V;if(M>I){var k=M;M=I,I=k}M>0&&(p=M),I<1&&(y=I)}if(p>=1||y<=0)return!1;var X=0,L=1,m=n*n+z*z,g=h*n+e*z,N=h*h+e*e-this._radius*this._radius,A=g*g-m*N;if(A<0)return!1;if(m>0){var F=Math.sqrt(A);if(X=(-g-F)/m,L=(-g+F)/m,X>=1||L<=0)return!1}else{if(N>=0)return!1;X=0,L=1}var P;if(L<=p||y<=X)return!1;if(X<p){if(P=p,P==0)return!1;_.normal.init(0,c>0?-1:1,0)}else{if(P=X,P==0)return!1;var Y=_.normal.init(h+n*P,0,e+z*P),R=Math.sqrt(Y.x*Y.x+Y.y*Y.y+Y.z*Y.z);R>0&&(R=1/R);var C=Y.x*R,d=Y.y*R,Z=Y.z*R;Y.x=C,Y.y=d,Y.z=Z}return _.position.init(h+P*n,v+P*c,e+P*z),_.fraction=P,!0}};x.collision.geometry.GeometryType=class{};x.collision.geometry.RayCastHit=class{constructor(){this.position=new x.common.Vec3,this.normal=new x.common.Vec3,this.fraction=0}};x.collision.geometry.SphereGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(a){super(0),this._radius=a,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}_updateMass(){this._volume=4.188790204786386*this._radius*this._radius*this._radius,this._inertiaCoeff00=.4*this._radius*this._radius,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.4*this._radius*this._radius,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.4*this._radius*this._radius}_computeAabb(a,t){var i,r,o;i=this._radius,r=this._radius,o=this._radius,a._minX=t._positionX-i,a._minY=t._positionY-r,a._minZ=t._positionZ-o,a._maxX=t._positionX+i,a._maxY=t._positionY+r,a._maxZ=t._positionZ+o}computeLocalSupportingVertex(a,t){t.zero()}_rayCastLocal(a,t,i,r,o,s,_){var h,v,e;h=r-a,v=o-t,e=s-i;var l=h*h+v*v+e*e,u=a*h+t*v+i*e,b=a*a+t*t+i*i-this._radius*this._radius,f=u*u-l*b;if(f<0)return!1;var n=(-u-Math.sqrt(f))/l;if(n<0||n>1)return!1;var c,z,p,y,V,M;c=a+h*n,z=t+v*n,p=i+e*n;var I=c*c+z*z+p*p;I>0&&(I=1/Math.sqrt(I)),y=c*I,V=z*I,M=p*I;var k=_.position;k.x=c,k.y=z,k.z=p;var X=_.normal;return X.x=y,X.y=V,X.z=M,_.fraction=n,!0}};x.collision.narrowphase||(x.collision.narrowphase={});x.collision.narrowphase.CollisionMatrix=class{constructor(){var a=new Array(8);this.detectors=a;var t=this.detectors,i=new Array(8);t[0]=i;var r=this.detectors,o=new Array(8);r[1]=o;var s=this.detectors,_=new Array(8);s[2]=_;var h=this.detectors,v=new Array(8);h[3]=v;var e=this.detectors,l=new Array(8);e[4]=l;var u=this.detectors,b=new Array(8);u[5]=b;var f=new x.collision.narrowphase.detector.GjkEpaDetector,n=0,c=1,z=2,p=3,y=4,V=5;this.detectors[n][n]=new x.collision.narrowphase.detector.SphereSphereDetector,this.detectors[n][c]=new x.collision.narrowphase.detector.SphereBoxDetector(!1),this.detectors[n][z]=f,this.detectors[n][p]=f,this.detectors[n][y]=new x.collision.narrowphase.detector.SphereCapsuleDetector(!1),this.detectors[n][V]=f,this.detectors[c][n]=new x.collision.narrowphase.detector.SphereBoxDetector(!0),this.detectors[c][c]=new x.collision.narrowphase.detector.BoxBoxDetector,this.detectors[c][z]=f,this.detectors[c][p]=f,this.detectors[c][y]=f,this.detectors[c][V]=f,this.detectors[z][n]=f,this.detectors[z][c]=f,this.detectors[z][z]=f,this.detectors[z][p]=f,this.detectors[z][y]=f,this.detectors[z][V]=f,this.detectors[p][n]=f,this.detectors[p][c]=f,this.detectors[p][z]=f,this.detectors[p][p]=f,this.detectors[p][y]=f,this.detectors[p][V]=f,this.detectors[y][n]=new x.collision.narrowphase.detector.SphereCapsuleDetector(!0),this.detectors[y][c]=f,this.detectors[y][z]=f,this.detectors[y][p]=f,this.detectors[y][y]=new x.collision.narrowphase.detector.CapsuleCapsuleDetector,this.detectors[y][V]=f,this.detectors[V][n]=f,this.detectors[V][c]=f,this.detectors[V][z]=f,this.detectors[V][p]=f,this.detectors[V][y]=f,this.detectors[V][V]=f}getDetector(a,t){return this.detectors[a][t]}};x.collision.narrowphase.DetectorResult=class{constructor(){this.numPoints=0,this.normal=new x.common.Vec3;var a=new Array(x.common.Setting.maxManifoldPoints);this.points=a,this.incremental=!1;for(var t=0,i=x.common.Setting.maxManifoldPoints;t<i;){var r=t++;this.points[r]=new x.collision.narrowphase.DetectorResultPoint}}getMaxDepth(){for(var a=0,t=0,i=this.numPoints;t<i;){var r=t++;this.points[r].depth>a&&(a=this.points[r].depth)}return a}clear(){this.numPoints=0;for(var a=0,t=this.points;a<t.length;){var i=t[a];++a,i.position1.zero(),i.position2.zero(),i.depth=0,i.id=0}this.normal.zero()}};x.collision.narrowphase.DetectorResultPoint=class{constructor(){this.position1=new x.common.Vec3,this.position2=new x.common.Vec3,this.depth=0,this.id=0}};x.collision.narrowphase.detector||(x.collision.narrowphase.detector={});x.collision.narrowphase.detector.Detector=class{constructor(a){this.swapped=a}setNormal(a,t,i,r){var o=a.normal;if(o.x=t,o.y=i,o.z=r,this.swapped){var s=a.normal,_=-s.x,h=-s.y,v=-s.z;s.x=_,s.y=h,s.z=v}}addPoint(a,t,i,r,o,s,_,h,v){var e=a.points[a.numPoints++];if(e.depth=h,e.id=v,this.swapped){var l=e.position1;l.x=o,l.y=s,l.z=_;var u=e.position2;u.x=t,u.y=i,u.z=r}else{var b=e.position1;b.x=t,b.y=i,b.z=r;var f=e.position2;f.x=o,f.y=s,f.z=_}}detectImpl(a,t,i,r,o,s){}detect(a,t,i,r,o,s){a.numPoints=0;for(var _=0,h=a.points;_<h.length;){var v=h[_];++_,v.position1.zero(),v.position2.zero(),v.depth=0,v.id=0}a.normal.zero(),this.swapped?this.detectImpl(a,i,t,o,r,s):this.detectImpl(a,t,i,r,o,s)}};x.collision.narrowphase.detector.BoxBoxDetector=class extends x.collision.narrowphase.detector.Detector{constructor(){super(!1),this.clipper=new x.collision.narrowphase.detector._BoxBoxDetector.FaceClipper}detectImpl(a,t,i,r,o,s){var _=t,h=i;a.incremental=!1;var v,e,l,u,b,f,n,c,z;v=r._positionX,e=r._positionY,l=r._positionZ,u=o._positionX,b=o._positionY,f=o._positionZ,n=u-v,c=b-e,z=f-l;var p,y,V,M,I,k,X,L,m,g,N,A,F,P,Y,R,C,d;p=r._rotation00,y=r._rotation10,V=r._rotation20,M=r._rotation01,I=r._rotation11,k=r._rotation21,X=r._rotation02,L=r._rotation12,m=r._rotation22,g=o._rotation00,N=o._rotation10,A=o._rotation20,F=o._rotation01,P=o._rotation11,Y=o._rotation21,R=o._rotation02,C=o._rotation12,d=o._rotation22;var Z=_._halfExtentsX,$=_._halfExtentsY,K=_._halfExtentsZ,E=h._halfExtentsX,J=h._halfExtentsY,B=h._halfExtentsZ,Q,U,G,D,H,j,ia,sa,W,q,na,oa,aa,T,ca,_a,w,ta;Q=p*Z,U=y*Z,G=V*Z,D=M*$,H=I*$,j=k*$,ia=X*K,sa=L*K,W=m*K,q=g*E,na=N*E,oa=A*E,aa=F*J,T=P*J,ca=Y*J,_a=R*B,w=C*B,ta=d*B;var ra=1/0,la=-1,va=0,xa,za,Ma;xa=0,za=0,Ma=0;var Xa=Z,Za=p*q+y*na+V*oa,fa=p*aa+y*T+V*ca,ba=p*_a+y*w+V*ta;Za<0&&(Za=-Za),fa<0&&(fa=-fa),ba<0&&(ba=-ba);var ea=Za+fa+ba,ha=p*n+y*c+V*z,ma=Xa+ea,ya=ha<0,da=ya?-ha:ha;if(da<ma){var pa=ma-da;pa<ra&&(ra=pa,la=0,xa=p,za=y,Ma=V,va=ya?-1:1)}else return;Xa=$;var Ya=M*q+I*na+k*oa,Qa=M*aa+I*T+k*ca,ga=M*_a+I*w+k*ta;Ya<0&&(Ya=-Ya),Qa<0&&(Qa=-Qa),ga<0&&(ga=-ga),ea=Ya+Qa+ga,ha=M*n+I*c+k*z;var ua=Xa+ea,wa=ha<0,ka=wa?-ha:ha;if(ka<ua){var Sa=ua-ka;Sa<ra&&(ra=Sa,la=1,xa=M,za=I,Ma=k,va=wa?-1:1)}else return;Xa=K;var zt=X*q+L*na+m*oa,Ha=X*aa+L*T+m*ca,Ba=X*_a+L*w+m*ta;zt<0&&(zt=-zt),Ha<0&&(Ha=-Ha),Ba<0&&(Ba=-Ba),ea=zt+Ha+Ba,ha=X*n+L*c+m*z;var nt=Xa+ea,Ea=ha<0,Fa=Ea?-ha:ha;if(Fa<nt){var Aa=nt-Fa;Aa<ra&&(ra=Aa,la=2,xa=X,za=L,Ma=m,va=Ea?-1:1)}else return;ra>x.common.Setting.linearSlop?ra-=x.common.Setting.linearSlop:ra=0;var ft=g*Q+N*U+A*G,Wa=g*D+N*H+A*j,Ka=g*ia+N*sa+A*W;ft<0&&(ft=-ft),Wa<0&&(Wa=-Wa),Ka<0&&(Ka=-Ka),Xa=ft+Wa+Ka,ea=E,ha=g*n+N*c+A*z;var bt=Xa+ea,it=ha<0,$a=it?-ha:ha;if($a<bt){var _t=bt-$a;_t<ra&&(ra=_t,la=3,xa=g,za=N,Ma=A,va=it?-1:1)}else return;var gt=F*Q+P*U+Y*G,pt=F*D+P*H+Y*j,Ga=F*ia+P*sa+Y*W;gt<0&&(gt=-gt),pt<0&&(pt=-pt),Ga<0&&(Ga=-Ga),Xa=gt+pt+Ga,ea=J,ha=F*n+P*c+Y*z;var rt=Xa+ea,ut=ha<0,Da=ut?-ha:ha;if(Da<rt){var Ta=rt-Da;Ta<ra&&(ra=Ta,la=4,xa=F,za=P,Ma=Y,va=ut?-1:1)}else return;var Na=R*Q+C*U+d*G,Vt=R*D+C*H+d*j,St=R*ia+C*sa+d*W;Na<0&&(Na=-Na),Vt<0&&(Vt=-Vt),St<0&&(St=-St),Xa=Na+Vt+St,ea=B,ha=R*n+C*c+d*z;var et=Xa+ea,Xt=ha<0,Yt=Xt?-ha:ha;if(Yt<et){var Mt=et-Yt;Mt<ra&&(ra=Mt,la=5,xa=R,za=C,Ma=d,va=Xt?-1:1)}else return;ra>x.common.Setting.linearSlop?ra-=x.common.Setting.linearSlop:ra=0;var Ia,O,Va;if(Ia=y*A-V*N,O=V*g-p*A,Va=p*N-y*g,!(Ia==0&&O==0&&Va==0)){var lt=Ia*Ia+O*O+Va*Va;lt>0&&(lt=1/Math.sqrt(lt)),Ia*=lt,O*=lt,Va*=lt;var S=Ia*D+O*H+Va*j,wt=Ia*ia+O*sa+Va*W;S<0&&(S=-S),wt<0&&(wt=-wt),Xa=S+wt;var Bt=Ia*aa+O*T+Va*ca,At=Ia*_a+O*w+Va*ta;Bt<0&&(Bt=-Bt),At<0&&(At=-At),ea=Bt+At,ha=Ia*n+O*c+Va*z;var yt=Xa+ea,kt=ha<0,mt=kt?-ha:ha;if(mt<yt){var ht=yt-mt;ht<ra&&(ra=ht,la=6,xa=Ia,za=O,Ma=Va,va=kt?-1:1)}else return}if(Ia=y*Y-V*P,O=V*F-p*Y,Va=p*P-y*F,!(Ia==0&&O==0&&Va==0)){var xt=Ia*Ia+O*O+Va*Va;xt>0&&(xt=1/Math.sqrt(xt)),Ia*=xt,O*=xt,Va*=xt;var Ra=Ia*D+O*H+Va*j,st=Ia*ia+O*sa+Va*W;Ra<0&&(Ra=-Ra),st<0&&(st=-st),Xa=Ra+st;var Ca=Ia*q+O*na+Va*oa,vt=Ia*_a+O*w+Va*ta;Ca<0&&(Ca=-Ca),vt<0&&(vt=-vt),ea=Ca+vt,ha=Ia*n+O*c+Va*z;var qa=Xa+ea,at=ha<0,Oa=at?-ha:ha;if(Oa<qa){var tt=qa-Oa;tt<ra&&(ra=tt,la=7,xa=Ia,za=O,Ma=Va,va=at?-1:1)}else return}if(Ia=y*d-V*C,O=V*R-p*d,Va=p*C-y*R,!(Ia==0&&O==0&&Va==0)){var ct=Ia*Ia+O*O+Va*Va;ct>0&&(ct=1/Math.sqrt(ct)),Ia*=ct,O*=ct,Va*=ct;var Pa=Ia*D+O*H+Va*j,Ja=Ia*ia+O*sa+Va*W;Pa<0&&(Pa=-Pa),Ja<0&&(Ja=-Ja),Xa=Pa+Ja;var ja=Ia*q+O*na+Va*oa,La=Ia*aa+O*T+Va*ca;ja<0&&(ja=-ja),La<0&&(La=-La),ea=ja+La,ha=Ia*n+O*c+Va*z;var ot=Xa+ea,It=ha<0,oi=It?-ha:ha;if(oi<ot){var gi=ot-oi;gi<ra&&(ra=gi,la=8,xa=Ia,za=O,Ma=Va,va=It?-1:1)}else return}if(Ia=I*A-k*N,O=k*g-M*A,Va=M*N-I*g,!(Ia==0&&O==0&&Va==0)){var ai=Ia*Ia+O*O+Va*Va;ai>0&&(ai=1/Math.sqrt(ai)),Ia*=ai,O*=ai,Va*=ai;var Ct=Ia*Q+O*U+Va*G,_i=Ia*ia+O*sa+Va*W;Ct<0&&(Ct=-Ct),_i<0&&(_i=-_i),Xa=Ct+_i;var Et=Ia*aa+O*T+Va*ca,Pt=Ia*_a+O*w+Va*ta;Et<0&&(Et=-Et),Pt<0&&(Pt=-Pt),ea=Et+Pt,ha=Ia*n+O*c+Va*z;var Jt=Xa+ea,Ki=ha<0,vi=Ki?-ha:ha;if(vi<Jt){var li=Jt-vi;li<ra&&(ra=li,la=9,xa=Ia,za=O,Ma=Va,va=Ki?-1:1)}else return}if(Ia=I*Y-k*P,O=k*F-M*Y,Va=M*P-I*F,!(Ia==0&&O==0&&Va==0)){var ti=Ia*Ia+O*O+Va*Va;ti>0&&(ti=1/Math.sqrt(ti)),Ia*=ti,O*=ti,Va*=ti;var Oi=Ia*Q+O*U+Va*G,Xi=Ia*ia+O*sa+Va*W;Oi<0&&(Oi=-Oi),Xi<0&&(Xi=-Xi),Xa=Oi+Xi;var zi=Ia*q+O*na+Va*oa,Zt=Ia*_a+O*w+Va*ta;zi<0&&(zi=-zi),Zt<0&&(Zt=-Zt),ea=zi+Zt,ha=Ia*n+O*c+Va*z;var ri=Xa+ea,Wt=ha<0,ni=Wt?-ha:ha;if(ni<ri){var $i=ri-ni;$i<ra&&(ra=$i,la=10,xa=Ia,za=O,Ma=Va,va=Wt?-1:1)}else return}if(Ia=I*d-k*C,O=k*R-M*d,Va=M*C-I*R,!(Ia==0&&O==0&&Va==0)){var Ut=Ia*Ia+O*O+Va*Va;Ut>0&&(Ut=1/Math.sqrt(Ut)),Ia*=Ut,O*=Ut,Va*=Ut;var ji=Ia*Q+O*U+Va*G,Ii=Ia*ia+O*sa+Va*W;ji<0&&(ji=-ji),Ii<0&&(Ii=-Ii),Xa=ji+Ii;var pr=Ia*q+O*na+Va*oa,Wi=Ia*aa+O*T+Va*ca;pr<0&&(pr=-pr),Wi<0&&(Wi=-Wi),ea=pr+Wi,ha=Ia*n+O*c+Va*z;var Lt=Xa+ea,jt=ha<0,Tt=jt?-ha:ha;if(Tt<Lt){var bi=Lt-Tt;bi<ra&&(ra=bi,la=11,xa=Ia,za=O,Ma=Va,va=jt?-1:1)}else return}if(Ia=L*A-m*N,O=m*g-X*A,Va=X*N-L*g,!(Ia==0&&O==0&&Va==0)){var Mi=Ia*Ia+O*O+Va*Va;Mi>0&&(Mi=1/Math.sqrt(Mi)),Ia*=Mi,O*=Mi,Va*=Mi;var vr=Ia*Q+O*U+Va*G,qt=Ia*D+O*H+Va*j;vr<0&&(vr=-vr),qt<0&&(qt=-qt),Xa=vr+qt;var fi=Ia*aa+O*T+Va*ca,dt=Ia*_a+O*w+Va*ta;fi<0&&(fi=-fi),dt<0&&(dt=-dt),ea=fi+dt,ha=Ia*n+O*c+Va*z;var ui=Xa+ea,hi=ha<0,er=hi?-ha:ha;if(er<ui){var Xr=ui-er;Xr<ra&&(ra=Xr,la=12,xa=Ia,za=O,Ma=Va,va=hi?-1:1)}else return}if(Ia=L*Y-m*P,O=m*F-X*Y,Va=X*P-L*F,!(Ia==0&&O==0&&Va==0)){var ro=Ia*Ia+O*O+Va*Va;ro>0&&(ro=1/Math.sqrt(ro)),Ia*=ro,O*=ro,Va*=ro;var Gt=Ia*Q+O*U+Va*G,fr=Ia*D+O*H+Va*j;Gt<0&&(Gt=-Gt),fr<0&&(fr=-fr),Xa=Gt+fr;var mr=Ia*q+O*na+Va*oa,Dt=Ia*_a+O*w+Va*ta;mr<0&&(mr=-mr),Dt<0&&(Dt=-Dt),ea=mr+Dt,ha=Ia*n+O*c+Va*z;var dr=Xa+ea,Pi=ha<0,Dr=Pi?-ha:ha;if(Dr<dr){var Hn=dr-Dr;Hn<ra&&(ra=Hn,la=13,xa=Ia,za=O,Ma=Va,va=Pi?-1:1)}else return}if(Ia=L*d-m*C,O=m*R-X*d,Va=X*C-L*R,!(Ia==0&&O==0&&Va==0)){var oo=Ia*Ia+O*O+Va*Va;oo>0&&(oo=1/Math.sqrt(oo)),Ia*=oo,O*=oo,Va*=oo;var Br=Ia*Q+O*U+Va*G,no=Ia*D+O*H+Va*j;Br<0&&(Br=-Br),no<0&&(no=-no),Xa=Br+no;var yn=Ia*q+O*na+Va*oa,Ao=Ia*aa+O*T+Va*ca;yn<0&&(yn=-yn),Ao<0&&(Ao=-Ao),ea=yn+Ao,ha=Ia*n+O*c+Va*z;var Io=Xa+ea,xi=ha<0,qr=xi?-ha:ha;if(qr<Io){var Ar=Io-qr;Ar<ra&&(ra=Ar,la=14,xa=Ia,za=O,Ma=Va,va=xi?-1:1)}else return}if(la>=6){xa*=va,za*=va,Ma*=va;var yr=(la-6)/3|0,Po=la-6-yr*3,Di,Pr,gr,Rt,Hi,Li,Cn,Ms,je,ps,Te,qe;switch(yr){case 0:Cn=p,Ms=y,je=V;var D_=D*xa+H*za+j*Ma>0,gn=ia*xa+sa*za+W*Ma>0;D_?gn?(Di=D+ia,Pr=H+sa,gr=j+W):(Di=D-ia,Pr=H-sa,gr=j-W):gn?(Di=ia-D,Pr=sa-H,gr=W-j):(Di=D+ia,Pr=H+sa,gr=j+W,Di=-Di,Pr=-Pr,gr=-gr);break;case 1:Cn=M,Ms=I,je=k;var Si=Q*xa+U*za+G*Ma>0,No=ia*xa+sa*za+W*Ma>0;Si?No?(Di=Q+ia,Pr=U+sa,gr=G+W):(Di=Q-ia,Pr=U-sa,gr=G-W):No?(Di=ia-Q,Pr=sa-U,gr=W-G):(Di=Q+ia,Pr=U+sa,gr=G+W,Di=-Di,Pr=-Pr,gr=-gr);break;default:Cn=X,Ms=L,je=m;var Wr=Q*xa+U*za+G*Ma>0,ke=D*xa+H*za+j*Ma>0;Wr?ke?(Di=Q+D,Pr=U+H,gr=G+j):(Di=Q-D,Pr=U-H,gr=G-j):ke?(Di=D-Q,Pr=H-U,gr=j-G):(Di=Q+D,Pr=U+H,gr=G+j,Di=-Di,Pr=-Pr,gr=-gr)}switch(Di=v+Di,Pr=e+Pr,gr=l+gr,Po){case 0:ps=g,Te=N,qe=A;var on=aa*xa+T*za+ca*Ma>0,Tn=_a*xa+w*za+ta*Ma>0;on?Tn?(Rt=aa+_a,Hi=T+w,Li=ca+ta):(Rt=aa-_a,Hi=T-w,Li=ca-ta):Tn?(Rt=_a-aa,Hi=w-T,Li=ta-ca):(Rt=aa+_a,Hi=T+w,Li=ca+ta,Rt=-Rt,Hi=-Hi,Li=-Li);break;case 1:ps=F,Te=P,qe=Y;var Kn=q*xa+na*za+oa*Ma>0,we=_a*xa+w*za+ta*Ma>0;Kn?we?(Rt=q+_a,Hi=na+w,Li=oa+ta):(Rt=q-_a,Hi=na-w,Li=oa-ta):we?(Rt=_a-q,Hi=w-na,Li=ta-oa):(Rt=q+_a,Hi=na+w,Li=oa+ta,Rt=-Rt,Hi=-Hi,Li=-Li);break;default:ps=R,Te=C,qe=d;var k_=q*xa+na*za+oa*Ma>0,Re=aa*xa+T*za+ca*Ma>0;k_?Re?(Rt=q+aa,Hi=na+T,Li=oa+ca):(Rt=q-aa,Hi=na-T,Li=oa-ca):Re?(Rt=aa-q,Hi=T-na,Li=ca-oa):(Rt=q+aa,Hi=na+T,Li=oa+ca,Rt=-Rt,Hi=-Hi,Li=-Li)}Rt=u-Rt,Hi=b-Hi,Li=f-Li;var Vi,Ir,ur;Vi=Di-Rt,Ir=Pr-Hi,ur=gr-Li;var eo=Cn*ps+Ms*Te+je*qe,Rn=Cn*Vi+Ms*Ir+je*ur,ms=ps*Vi+Te*Ir+qe*ur,nn=1/(1-eo*eo),Qn=(eo*ms-Rn)*nn,ci=(ms-eo*Rn)*nn,ho,Fr,En,as,Qe,Ee;ho=Di+Cn*Qn,Fr=Pr+Ms*Qn,En=gr+je*Qn,as=Rt+ps*ci,Qe=Hi+Te*ci,Ee=Li+qe*ci;var De,he,ii;De=-xa,he=-za,ii=-Ma,this.setNormal(a,De,he,ii),this.addPoint(a,ho,Fr,En,as,Qe,Ee,ra,4);return}var ir,Qi,Fi,fo;if(la>=3){va=-va,n=-n,c=-c,z=-z;var So=_;_=h,h=So;var s_=Z;Z=E,E=s_;var Fe=$;$=J,J=Fe;var ts=K;K=B,B=ts,ir=v,Qi=e,Fi=l,v=u,e=b,l=f,u=ir,b=Qi,f=Fi,ir=p,Qi=y,Fi=V,p=g,y=N,V=A,g=ir,N=Qi,A=Fi,ir=M,Qi=I,Fi=k,M=F,I=P,k=Y,F=ir,P=Qi,Y=Fi,ir=X,Qi=L,Fi=m,X=R,L=C,m=d,R=ir,C=Qi,d=Fi,ir=Q,Qi=U,Fi=G,Q=q,U=na,G=oa,q=ir,na=Qi,oa=Fi,ir=D,Qi=H,Fi=j,D=aa,H=T,j=ca,aa=ir,T=Qi,ca=Fi,ir=ia,Qi=sa,Fi=W,ia=_a,sa=w,W=ta,_a=ir,w=Qi,ta=Fi,la-=3,fo=!0}else fo=!1;var Dn,co,Ft,Ni,lr,Vo,ce,Xe,Le,uo,$t,Vr,sr,Jo;switch(la){case 0:Dn=Q,co=U,Ft=G,Ni=p,lr=y,Vo=V,ce=M,Xe=I,Le=k,uo=X,$t=L,Vr=m,sr=$,Jo=K;break;case 1:Dn=D,co=H,Ft=j,Ni=M,lr=I,Vo=k,ce=X,Xe=L,Le=m,uo=p,$t=y,Vr=V,sr=K,Jo=Z;break;default:Dn=ia,co=sa,Ft=W,Ni=X,lr=L,Vo=m,ce=p,Xe=y,Le=V,uo=M,$t=I,Vr=k,sr=Z,Jo=$}if(va<0){Dn=-Dn,co=-co,Ft=-Ft,Ni=-Ni,lr=-lr,Vo=-Vo,ir=ce,Qi=Xe,Fi=Le,ce=uo,Xe=$t,Le=Vr,uo=ir,$t=Qi,Vr=Fi;var Ns=sr;sr=Jo,Jo=Ns}Dn+=v,co+=e,Ft+=l;var Co=1,ko=0,Nr=Ni*g+lr*N+Vo*A;Nr<Co&&(Co=Nr,ko=0),-Nr<Co&&(Co=-Nr,ko=1),Nr=Ni*F+lr*P+Vo*Y,Nr<Co&&(Co=Nr,ko=2),-Nr<Co&&(Co=-Nr,ko=3),Nr=Ni*R+lr*C+Vo*d,Nr<Co&&(Co=Nr,ko=4),-Nr<Co&&(Co=-Nr,ko=5);var Sr,Cr,Lr,Qt,Ji,Yi,Ri,zr,qi,Jr,Gr,ao;switch(ko){case 0:Sr=q+aa,Cr=na+T,Lr=oa+ca,Sr+=_a,Cr+=w,Lr+=ta,Qt=q-aa,Ji=na-T,Yi=oa-ca,Qt+=_a,Ji+=w,Yi+=ta,Ri=q-aa,zr=na-T,qi=oa-ca,Ri-=_a,zr-=w,qi-=ta,Jr=q+aa,Gr=na+T,ao=oa+ca,Jr-=_a,Gr-=w,ao-=ta;break;case 1:Sr=aa-q,Cr=T-na,Lr=ca-oa,Sr+=_a,Cr+=w,Lr+=ta,Qt=aa-q,Ji=T-na,Yi=ca-oa,Qt-=_a,Ji-=w,Yi-=ta,Ri=q+aa,zr=na+T,qi=oa+ca,Ri=-Ri,zr=-zr,qi=-qi,Ri-=_a,zr-=w,qi-=ta,Jr=q+aa,Gr=na+T,ao=oa+ca,Jr=-Jr,Gr=-Gr,ao=-ao,Jr+=_a,Gr+=w,ao+=ta;break;case 2:Sr=q+aa,Cr=na+T,Lr=oa+ca,Sr+=_a,Cr+=w,Lr+=ta,Qt=q+aa,Ji=na+T,Yi=oa+ca,Qt-=_a,Ji-=w,Yi-=ta,Ri=aa-q,zr=T-na,qi=ca-oa,Ri-=_a,zr-=w,qi-=ta,Jr=aa-q,Gr=T-na,ao=ca-oa,Jr+=_a,Gr+=w,ao+=ta;break;case 3:Sr=q-aa,Cr=na-T,Lr=oa-ca,Sr+=_a,Cr+=w,Lr+=ta,Qt=q+aa,Ji=na+T,Yi=oa+ca,Qt=-Qt,Ji=-Ji,Yi=-Yi,Qt+=_a,Ji+=w,Yi+=ta,Ri=q+aa,zr=na+T,qi=oa+ca,Ri=-Ri,zr=-zr,qi=-qi,Ri-=_a,zr-=w,qi-=ta,Jr=q-aa,Gr=na-T,ao=oa-ca,Jr-=_a,Gr-=w,ao-=ta;break;case 4:Sr=q+aa,Cr=na+T,Lr=oa+ca,Sr+=_a,Cr+=w,Lr+=ta,Qt=aa-q,Ji=T-na,Yi=ca-oa,Qt+=_a,Ji+=w,Yi+=ta,Ri=q+aa,zr=na+T,qi=oa+ca,Ri=-Ri,zr=-zr,qi=-qi,Ri+=_a,zr+=w,qi+=ta,Jr=q-aa,Gr=na-T,ao=oa-ca,Jr+=_a,Gr+=w,ao+=ta;break;default:Sr=q+aa,Cr=na+T,Lr=oa+ca,Sr-=_a,Cr-=w,Lr-=ta,Qt=q-aa,Ji=na-T,Yi=oa-ca,Qt-=_a,Ji-=w,Yi-=ta,Ri=q+aa,zr=na+T,qi=oa+ca,Ri=-Ri,zr=-zr,qi=-qi,Ri-=_a,zr-=w,qi-=ta,Jr=aa-q,Gr=T-na,ao=ca-oa,Jr-=_a,Gr-=w,ao-=ta}Sr+=n,Cr+=c,Lr+=z,Qt+=n,Ji+=c,Yi+=z,Ri+=n,zr+=c,qi+=z,Jr+=n,Gr+=c,ao+=z;var be=this.clipper;be.w=sr,be.h=Jo,be.numVertices=0,be.numTmpVertices=0;var ki=this.clipper,en=ki.vertices[ki.numVertices++];en.x=Sr*ce+Cr*Xe+Lr*Le,en.y=Sr*uo+Cr*$t+Lr*Vr,en.wx=Sr,en.wy=Cr,en.wz=Lr;var Yr=this.clipper,Go=Yr.vertices[Yr.numVertices++];Go.x=Qt*ce+Ji*Xe+Yi*Le,Go.y=Qt*uo+Ji*$t+Yi*Vr,Go.wx=Qt,Go.wy=Ji,Go.wz=Yi;var ys=this.clipper,In=ys.vertices[ys.numVertices++];In.x=Ri*ce+zr*Xe+qi*Le,In.y=Ri*uo+zr*$t+qi*Vr,In.wx=Ri,In.wy=zr,In.wz=qi;var gs=this.clipper,Vn=gs.vertices[gs.numVertices++];Vn.x=Jr*ce+Gr*Xe+ao*Le,Vn.y=Jr*uo+Gr*$t+ao*Vr,Vn.wx=Jr,Vn.wy=Gr,Vn.wz=ao,this.clipper.clip(),this.clipper.reduce();var Ci,To,so;fo?(Ci=Ni,To=lr,so=Vo):(Ci=-Ni,To=-lr,so=-Vo),this.setNormal(a,Ci,To,so);for(var Fn=0,Ne=this.clipper.numVertices;Fn<Ne;){var Nn=Fn++,Wo=this.clipper.vertices[Nn],kn,Ye,Ot;kn=Wo.wx,Ye=Wo.wy,Ot=Wo.wz,kn+=v,Ye+=e,Ot+=l;var Ro,Ur,wn;Ro=Dn-kn,Ur=co-Ye,wn=Ft-Ot;var Jn=Ro*Ni+Ur*lr+wn*Vo,fe,Is,Uo;fe=kn+Ni*Jn,Is=Ye+lr*Jn,Uo=Ot+Vo*Jn,Jn>-x.common.Setting.contactPersistenceThreshold&&(fo?this.addPoint(a,kn,Ye,Ot,fe,Is,Uo,Jn,Nn):this.addPoint(a,fe,Is,Uo,kn,Ye,Ot,Jn,Nn))}}};x.collision.narrowphase.detector._BoxBoxDetector||(x.collision.narrowphase.detector._BoxBoxDetector={});x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex=class{constructor(){this.x=0,this.y=0,this.wx=0,this.wy=0,this.wz=0}};x.collision.narrowphase.detector._BoxBoxDetector.FaceClipper=class{constructor(){this.w=0,this.h=0,this.numVertices=0,this.numTmpVertices=0;var a=new Array(8);this.vertices=a;var t=new Array(8);this.tmpVertices=t,this.vertices[0]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[0]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[1]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[1]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[2]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[2]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[3]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[3]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[4]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[4]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[5]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[5]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[6]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[6]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[7]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[7]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex}clip(){for(var a=0,t=this.numVertices;a<t;){var i=a++,r=this.vertices[i],o=this.vertices[(i+1)%this.numVertices],s=this.w+r.x,_=this.w+o.x;if(s>0&&_>0){var h=this.tmpVertices[this.numTmpVertices++];h.x=r.x,h.y=r.y,h.wx=r.wx,h.wy=r.wy,h.wz=r.wz}else if(s>0&&_<=0){var v=this.tmpVertices[this.numTmpVertices++];v.x=r.x,v.y=r.y,v.wx=r.wx,v.wy=r.wy,v.wz=r.wz;var e=s/(s-_),l=this.tmpVertices[this.numTmpVertices++];l.x=r.x+(o.x-r.x)*e,l.y=r.y+(o.y-r.y)*e,l.wx=r.wx+(o.wx-r.wx)*e,l.wy=r.wy+(o.wy-r.wy)*e,l.wz=r.wz+(o.wz-r.wz)*e}else if(s<=0&&_>0){var u=s/(s-_),b=this.tmpVertices[this.numTmpVertices++];b.x=r.x+(o.x-r.x)*u,b.y=r.y+(o.y-r.y)*u,b.wx=r.wx+(o.wx-r.wx)*u,b.wy=r.wy+(o.wy-r.wy)*u,b.wz=r.wz+(o.wz-r.wz)*u}}var f=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=f,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var n=0,c=this.numVertices;n<c;){var z=n++,p=this.vertices[z],y=this.vertices[(z+1)%this.numVertices],V=this.w-p.x,M=this.w-y.x;if(V>0&&M>0){var I=this.tmpVertices[this.numTmpVertices++];I.x=p.x,I.y=p.y,I.wx=p.wx,I.wy=p.wy,I.wz=p.wz}else if(V>0&&M<=0){var k=this.tmpVertices[this.numTmpVertices++];k.x=p.x,k.y=p.y,k.wx=p.wx,k.wy=p.wy,k.wz=p.wz;var X=V/(V-M),L=this.tmpVertices[this.numTmpVertices++];L.x=p.x+(y.x-p.x)*X,L.y=p.y+(y.y-p.y)*X,L.wx=p.wx+(y.wx-p.wx)*X,L.wy=p.wy+(y.wy-p.wy)*X,L.wz=p.wz+(y.wz-p.wz)*X}else if(V<=0&&M>0){var m=V/(V-M),g=this.tmpVertices[this.numTmpVertices++];g.x=p.x+(y.x-p.x)*m,g.y=p.y+(y.y-p.y)*m,g.wx=p.wx+(y.wx-p.wx)*m,g.wy=p.wy+(y.wy-p.wy)*m,g.wz=p.wz+(y.wz-p.wz)*m}}var N=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=N,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var A=0,F=this.numVertices;A<F;){var P=A++,Y=this.vertices[P],R=this.vertices[(P+1)%this.numVertices],C=this.h+Y.y,d=this.h+R.y;if(C>0&&d>0){var Z=this.tmpVertices[this.numTmpVertices++];Z.x=Y.x,Z.y=Y.y,Z.wx=Y.wx,Z.wy=Y.wy,Z.wz=Y.wz}else if(C>0&&d<=0){var $=this.tmpVertices[this.numTmpVertices++];$.x=Y.x,$.y=Y.y,$.wx=Y.wx,$.wy=Y.wy,$.wz=Y.wz;var K=C/(C-d),E=this.tmpVertices[this.numTmpVertices++];E.x=Y.x+(R.x-Y.x)*K,E.y=Y.y+(R.y-Y.y)*K,E.wx=Y.wx+(R.wx-Y.wx)*K,E.wy=Y.wy+(R.wy-Y.wy)*K,E.wz=Y.wz+(R.wz-Y.wz)*K}else if(C<=0&&d>0){var J=C/(C-d),B=this.tmpVertices[this.numTmpVertices++];B.x=Y.x+(R.x-Y.x)*J,B.y=Y.y+(R.y-Y.y)*J,B.wx=Y.wx+(R.wx-Y.wx)*J,B.wy=Y.wy+(R.wy-Y.wy)*J,B.wz=Y.wz+(R.wz-Y.wz)*J}}var Q=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=Q,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var U=0,G=this.numVertices;U<G;){var D=U++,H=this.vertices[D],j=this.vertices[(D+1)%this.numVertices],ia=this.h-H.y,sa=this.h-j.y;if(ia>0&&sa>0){var W=this.tmpVertices[this.numTmpVertices++];W.x=H.x,W.y=H.y,W.wx=H.wx,W.wy=H.wy,W.wz=H.wz}else if(ia>0&&sa<=0){var q=this.tmpVertices[this.numTmpVertices++];q.x=H.x,q.y=H.y,q.wx=H.wx,q.wy=H.wy,q.wz=H.wz;var na=ia/(ia-sa),oa=this.tmpVertices[this.numTmpVertices++];oa.x=H.x+(j.x-H.x)*na,oa.y=H.y+(j.y-H.y)*na,oa.wx=H.wx+(j.wx-H.wx)*na,oa.wy=H.wy+(j.wy-H.wy)*na,oa.wz=H.wz+(j.wz-H.wz)*na}else if(ia<=0&&sa>0){var aa=ia/(ia-sa),T=this.tmpVertices[this.numTmpVertices++];T.x=H.x+(j.x-H.x)*aa,T.y=H.y+(j.y-H.y)*aa,T.wx=H.wx+(j.wx-H.wx)*aa,T.wy=H.wy+(j.wy-H.wy)*aa,T.wz=H.wz+(j.wz-H.wz)*aa}}var ca=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=ca,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}reduce(){if(!(this.numVertices<4)){for(var a=-1/0,t=1/0,i=-1/0,r=1/0,o=null,s=null,_=null,h=null,v=1,e=1,l=-1,u=1,b=0,f=this.numVertices;b<f;){var n=b++,c=this.vertices[n],z=c.x*v+c.y*e,p=c.x*l+c.y*u;z>a&&(a=z,o=c),z<t&&(t=z,s=c),p>i&&(i=p,_=c),p<r&&(r=p,h=c)}var y=this.tmpVertices[this.numTmpVertices++];y.x=o.x,y.y=o.y,y.wx=o.wx,y.wy=o.wy,y.wz=o.wz;var V=this.tmpVertices[this.numTmpVertices++];V.x=_.x,V.y=_.y,V.wx=_.wx,V.wy=_.wy,V.wz=_.wz;var M=this.tmpVertices[this.numTmpVertices++];M.x=s.x,M.y=s.y,M.wx=s.wx,M.wy=s.wy,M.wz=s.wz;var I=this.tmpVertices[this.numTmpVertices++];I.x=h.x,I.y=h.y,I.wx=h.wx,I.wy=h.wy,I.wz=h.wz;var k=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=k,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}}};x.collision.narrowphase.detector.BoxBoxDetectorMacro=class{};x.collision.narrowphase.detector.CachedDetectorData=class{constructor(){}_clear(){this._gjkCache!=null&&this._gjkCache.clear()}};x.collision.narrowphase.detector.CapsuleCapsuleDetector=class extends x.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(a,t,i,r,o,s){var _=t,h=i;a.incremental=!1;var v,e,l,u,b,f;v=r._rotation01,e=r._rotation11,l=r._rotation21,u=o._rotation01,b=o._rotation11,f=o._rotation21;var n=_._halfHeight,c=h._halfHeight,z=_._radius,p=h._radius,y,V,M,I,k,X,L,m,g,N,A,F;y=r._positionX+v*-n,V=r._positionY+e*-n,M=r._positionZ+l*-n,I=r._positionX+v*n,k=r._positionY+e*n,X=r._positionZ+l*n,L=o._positionX+u*-c,m=o._positionY+b*-c,g=o._positionZ+f*-c,N=o._positionX+u*c,A=o._positionY+b*c,F=o._positionZ+f*c;var P,Y,R;P=y-L,Y=V-m,R=M-g;var C,d,Z,$,K,E;C=I-y,d=k-V,Z=X-M,$=N-L,K=A-m,E=F-g;var J=-(P*C+Y*d+R*Z),B=P*$+Y*K+R*E,Q=n*n*4,U=C*$+d*K+Z*E,G=c*c*4,D,H;if(Q==0&&G==0)D=0,H=0;else if(Q==0)D=0,H=B,H<0?H=0:H>G?H=1:H/=G;else if(G==0)H=0,D=J,D<0?D=0:D>Q?D=1:D/=Q;else{var j=Q*G-U*U;j==0?D=0:(D=U*B+G*J,D<0?D=0:D>j?D=1:D/=j),H=D*U+B,H<0?(H=0,D=J,D<0?D=0:D>Q?D=1:D/=Q):H>G?(H=1,D=U+J,D<0?D=0:D>Q?D=1:D/=Q):H/=G}var ia,sa,W,q,na,oa;ia=y+C*D,sa=V+d*D,W=M+Z*D,q=L+$*H,na=m+K*H,oa=g+E*H;var aa,T,ca;aa=ia-q,T=sa-na,ca=W-oa;var _a=aa*aa+T*T+ca*ca;if(!(_a>=(z+p)*(z+p))){var w=Math.sqrt(_a),ta,ra,la;w>0?(ta=aa*(1/w),ra=T*(1/w),la=ca*(1/w)):(ta=1,ra=0,la=0),this.setNormal(a,ta,ra,la);var va,xa,za,Ma,Xa,Za;va=ia+ta*-z,xa=sa+ra*-z,za=W+la*-z,Ma=q+ta*p,Xa=na+ra*p,Za=oa+la*p,this.addPoint(a,va,xa,za,Ma,Xa,Za,z+p-w,0)}}};x.collision.narrowphase.detector.GjkEpaDetector=class extends x.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(a,t,i,r,o,s){var _=x.collision.narrowphase.detector.gjkepa.GjkEpa.instance,h=t,v=i,e=_.computeClosestPointsImpl(h,v,r,o,x.common.Setting.enableGJKCaching?s:null,!0);if(a.incremental=!0,e!=x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED){console.log("src/oimo/collision/narrowphase/detector/GjkEpaDetector.hx:28:","GJK/EPA failed: status="+e);return}var l=h._gjkMargin,u=v._gjkMargin;if(!(_.distance>l+u)){var b,f,n,c,z,p,y=_.closestPoint1;b=y.x,f=y.y,n=y.z;var V=_.closestPoint2;c=V.x,z=V.y,p=V.z;var M,I,k;if(M=b-c,I=f-z,k=n-p,M*M+I*I+k*k!=0){_.distance<0&&(M=-M,I=-I,k=-k);var X=M*M+I*I+k*k;X>0&&(X=1/Math.sqrt(X)),M*=X,I*=X,k*=X,this.setNormal(a,M,I,k),b+=M*-h._gjkMargin,f+=I*-h._gjkMargin,n+=k*-h._gjkMargin,c+=M*v._gjkMargin,z+=I*v._gjkMargin,p+=k*v._gjkMargin,this.addPoint(a,b,f,n,c,z,p,h._gjkMargin+v._gjkMargin-_.distance,0)}}}};x.collision.narrowphase.detector.SphereBoxDetector=class extends x.collision.narrowphase.detector.Detector{constructor(a){super(a)}detectImpl(a,t,i,r,o,s){var _=t,h=i;a.incremental=!1;var v,e,l,u,b,f;v=h._halfExtentsX,e=h._halfExtentsY,l=h._halfExtentsZ,u=-v,b=-e,f=-l;var n=_._radius,c,z,p;c=r._positionX-o._positionX,z=r._positionY-o._positionY,p=r._positionZ-o._positionZ;var y,V,M,I,k,X;I=o._rotation00*c+o._rotation10*z+o._rotation20*p,k=o._rotation01*c+o._rotation11*z+o._rotation21*p,X=o._rotation02*c+o._rotation12*z+o._rotation22*p,y=I,V=k,M=X;var L=u<y&&v>y&&b<V&&e>V&&f<M&&l>M;if(L){var m,g,N;m=y<0?-y:y,g=V<0?-V:V,N=M<0?-M:M,m=v-m,g=e-g,N=l-N;var A,F,P,Y=m,R=g,C=N,d,Z,$,K;Y<R?Y<C?(y>0?(A=1,F=0,P=0):(A=-1,F=0,P=0),Z=0,$=1,K=1,d=Y):(M>0?(A=0,F=0,P=1):(A=0,F=0,P=-1),Z=1,$=1,K=0,d=C):R<C?(V>0?(A=0,F=1,P=0):(A=0,F=-1,P=0),Z=1,$=0,K=1,d=R):(M>0?(A=0,F=0,P=1):(A=0,F=0,P=-1),Z=1,$=1,K=0,d=C);var E,J,B;E=Z*y,J=$*V,B=K*M;var Q,U,G;Q=A*v,U=F*e,G=P*l,Q+=E,U+=J,G+=B;var D,H,j,ia,sa,W,q,na,oa;q=o._rotation00*Q+o._rotation01*U+o._rotation02*G,na=o._rotation10*Q+o._rotation11*U+o._rotation12*G,oa=o._rotation20*Q+o._rotation21*U+o._rotation22*G,D=q,H=na,j=oa;var aa,T,ca;aa=o._rotation00*A+o._rotation01*F+o._rotation02*P,T=o._rotation10*A+o._rotation11*F+o._rotation12*P,ca=o._rotation20*A+o._rotation21*F+o._rotation22*P,ia=aa,sa=T,W=ca,this.setNormal(a,ia,sa,W);var _a,w,ta,ra,la,va;_a=r._positionX+ia*-n,w=r._positionY+sa*-n,ta=r._positionZ+W*-n,ra=o._positionX+D,la=o._positionY+H,va=o._positionZ+j,this.addPoint(a,_a,w,ta,ra,la,va,d,0);return}var xa,za,Ma,Xa=1e-9,Za,fa,ba;Za=Xa,fa=Xa,ba=Xa,v-=Za,e-=fa,l-=ba,u+=Za,b+=fa,f+=ba,xa=y<v?y:v,za=V<e?V:e,Ma=M<l?M:l,xa=xa>u?xa:u,za=za>b?za:b,Ma=Ma>f?Ma:f;var ea,ha,ma;ea=y-xa,ha=V-za,ma=M-Ma;var ya=ea*ea+ha*ha+ma*ma;if(!(ya>=n*n)){ya=Math.sqrt(ya);var da,pa,Ya,Qa,ga,ua,wa,ka,Sa;wa=o._rotation00*xa+o._rotation01*za+o._rotation02*Ma,ka=o._rotation10*xa+o._rotation11*za+o._rotation12*Ma,Sa=o._rotation20*xa+o._rotation21*za+o._rotation22*Ma,da=wa,pa=ka,Ya=Sa;var zt,Ha,Ba;zt=o._rotation00*ea+o._rotation01*ha+o._rotation02*ma,Ha=o._rotation10*ea+o._rotation11*ha+o._rotation12*ma,Ba=o._rotation20*ea+o._rotation21*ha+o._rotation22*ma,Qa=zt,ga=Ha,ua=Ba;var nt,Ea,Fa,Aa=Qa*Qa+ga*ga+ua*ua;Aa>0&&(Aa=1/Math.sqrt(Aa)),nt=Qa*Aa,Ea=ga*Aa,Fa=ua*Aa,this.setNormal(a,nt,Ea,Fa);var ft,Wa,Ka,bt,it,$a;ft=r._positionX+nt*-n,Wa=r._positionY+Ea*-n,Ka=r._positionZ+Fa*-n,bt=o._positionX+da,it=o._positionY+pa,$a=o._positionZ+Ya,this.addPoint(a,ft,Wa,Ka,bt,it,$a,n-ya,0)}}};x.collision.narrowphase.detector.SphereCapsuleDetector=class extends x.collision.narrowphase.detector.Detector{constructor(a){super(a)}detectImpl(a,t,i,r,o,s){var _=t,h=i;a.incremental=!1;var v=h._halfHeight,e=_._radius,l=h._radius,u,b,f;u=o._rotation01,b=o._rotation11,f=o._rotation21;var n,c,z;n=r._positionX,c=r._positionY,z=r._positionZ;var p,y,V,M,I,k;p=o._positionX+u*-v,y=o._positionY+b*-v,V=o._positionZ+f*-v,M=o._positionX+u*v,I=o._positionY+b*v,k=o._positionZ+f*v;var X,L,m;X=n-p,L=c-y,m=z-V;var g,N,A;g=M-p,N=I-y,A=k-V;var F=v*v*4,P=X*g+L*N+m*A;P<0?P=0:P>F?P=1:P/=F;var Y,R,C;Y=p+g*P,R=y+N*P,C=V+A*P;var d,Z,$;d=n-Y,Z=c-R,$=z-C;var K=d*d+Z*Z+$*$;if(!(K>=(e+l)*(e+l))){var E=Math.sqrt(K),J,B,Q;E>0?(J=d*(1/E),B=Z*(1/E),Q=$*(1/E)):(J=1,B=0,Q=0),this.setNormal(a,J,B,Q);var U,G,D,H,j,ia;U=n+J*-e,G=c+B*-e,D=z+Q*-e,H=Y+J*l,j=R+B*l,ia=C+Q*l,this.addPoint(a,U,G,D,H,j,ia,e+l-E,0)}}};x.collision.narrowphase.detector.SphereSphereDetector=class extends x.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(a,t,i,r,o,s){var _=t,h=i;a.incremental=!1;var v,e,l;v=r._positionX-o._positionX,e=r._positionY-o._positionY,l=r._positionZ-o._positionZ;var u=_._radius,b=h._radius,f=v*v+e*e+l*l;if(!(f>=(u+b)*(u+b))){var n=Math.sqrt(f),c,z,p;n>0?(c=v*(1/n),z=e*(1/n),p=l*(1/n)):(c=1,z=0,p=0),this.setNormal(a,c,z,p);var y,V,M,I,k,X;y=r._positionX+c*-u,V=r._positionY+z*-u,M=r._positionZ+p*-u,I=o._positionX+c*b,k=o._positionY+z*b,X=o._positionZ+p*b,this.addPoint(a,y,V,M,I,k,X,u+b-n,0)}}};x.collision.narrowphase.detector.gjkepa||(x.collision.narrowphase.detector.gjkepa={});x.collision.narrowphase.detector.gjkepa.EpaPolyhedron=class{constructor(){var a=new Array(x.common.Setting.maxEPAVertices);this._vertices=a,this._center=new x.common.Vec3,this._numVertices=0,this._triangleList=null,this._triangleListLast=null,this._numTriangles=0,this._trianglePool=null,this._vertexPool=null}dumpHoleEdge(a){}validate(){for(var a=this._triangleList;a!=null;){var t=a._next;if(a._vertices[0]._tmpEdgeLoopOuterTriangle=null,a._vertices[0]._tmpEdgeLoopNext=null,a._adjacentPairIndex[0]==-1)return this._status=2,!1;if(a._adjacentTriangles[0]==null)return this._status=3,!1;if(a._vertices[1]._tmpEdgeLoopOuterTriangle=null,a._vertices[1]._tmpEdgeLoopNext=null,a._adjacentPairIndex[1]==-1)return this._status=2,!1;if(a._adjacentTriangles[1]==null)return this._status=3,!1;if(a._vertices[2]._tmpEdgeLoopOuterTriangle=null,a._vertices[2]._tmpEdgeLoopNext=null,a._adjacentPairIndex[2]==-1)return this._status=2,!1;if(a._adjacentTriangles[2]==null)return this._status=3,!1;a=t}return!0}findEdgeLoop(a,t,i){if(t._tmpDfsId!=a){t._tmpDfsId=a;var r=t.tmp;r.x=i.x,r.y=i.y,r.z=i.z;var o=r,s=t._vertices[0].v,_=o.x-s.x,h=o.y-s.y,v=o.z-s.z;o.x=_,o.y=h,o.z=v;var e=t.tmp,l=t._normal;if(t._tmpDfsVisible=e.x*l.x+e.y*l.y+e.z*l.z>0,!t._tmpDfsVisible){this._status=6;return}for(var u=0;u<3;){var b=u++,f=t._adjacentTriangles[b];if(f!=null){var n=f.tmp;n.x=i.x,n.y=i.y,n.z=i.z;var c=n,z=f._vertices[0].v,p=c.x-z.x,y=c.y-z.y,V=c.z-z.z;c.x=p,c.y=y,c.z=V;var M=f.tmp,I=f._normal;if(f._tmpDfsVisible=M.x*I.x+M.y*I.y+M.z*I.z>0,f._tmpDfsVisible)this.findEdgeLoop(a,f,i);else{var k=t._nextIndex[b],X=t._vertices[b],L=t._vertices[k];X._tmpEdgeLoopNext=L,X._tmpEdgeLoopOuterTriangle=f}}}var m=t._adjacentTriangles[0];if(m!=null){var g=t._adjacentPairIndex[0];m._adjacentTriangles[g]=null,m._adjacentPairIndex[g]=-1,t._adjacentTriangles[0]=null,t._adjacentPairIndex[0]=-1}var N=t._adjacentTriangles[1];if(N!=null){var A=t._adjacentPairIndex[1];N._adjacentTriangles[A]=null,N._adjacentPairIndex[A]=-1,t._adjacentTriangles[1]=null,t._adjacentPairIndex[1]=-1}var F=t._adjacentTriangles[2];if(F!=null){var P=t._adjacentPairIndex[2];F._adjacentTriangles[P]=null,F._adjacentPairIndex[P]=-1,t._adjacentTriangles[2]=null,t._adjacentPairIndex[2]=-1}this._numTriangles--;var Y=t._prev,R=t._next;Y!=null&&(Y._next=R),R!=null&&(R._prev=Y),t==this._triangleList&&(this._triangleList=this._triangleList._next),t==this._triangleListLast&&(this._triangleListLast=this._triangleListLast._prev),t._next=null,t._prev=null,t.removeReferences(),t._next=this._trianglePool,this._trianglePool=t}}_init(a,t,i,r){this._status=0,this._numVertices=4,this._vertices[0]=a,this._vertices[1]=t,this._vertices[2]=i,this._vertices[3]=r;var o=this._center,s=a.v;o.x=s.x,o.y=s.y,o.z=s.z;var _=o,h=t.v,v=_.x+h.x,e=_.y+h.y,l=_.z+h.z;_.x=v,_.y=e,_.z=l;var u=_,b=i.v,f=u.x+b.x,n=u.y+b.y,c=u.z+b.z;u.x=f,u.y=n,u.z=c;var z=u,p=r.v,y=z.x+p.x,V=z.y+p.y,M=z.z+p.z;z.x=y,z.y=V,z.z=M;var I=z,k=I.x*.25,X=I.y*.25,L=I.z*.25;I.x=k,I.y=X,I.z=L;var m=this._trianglePool;m!=null?(this._trianglePool=m._next,m._next=null):m=new x.collision.narrowphase.detector.gjkepa.EpaTriangle;var g=m,N=this._trianglePool;N!=null?(this._trianglePool=N._next,N._next=null):N=new x.collision.narrowphase.detector.gjkepa.EpaTriangle;var A=N,F=this._trianglePool;F!=null?(this._trianglePool=F._next,F._next=null):F=new x.collision.narrowphase.detector.gjkepa.EpaTriangle;var P=F,Y=this._trianglePool;Y!=null?(this._trianglePool=Y._next,Y._next=null):Y=new x.collision.narrowphase.detector.gjkepa.EpaTriangle;var R=Y,C=!0;g.init(a,t,i,this._center,C)||(this._status=1);var d=!0;A.init(a,t,r,this._center,d)||(this._status=1);var Z=!0;P.init(a,i,r,this._center,Z)||(this._status=1);var $=!0;return R.init(t,i,r,this._center,$)||(this._status=1),g.setAdjacentTriangle(A)||(this._status=1),g.setAdjacentTriangle(P)||(this._status=1),g.setAdjacentTriangle(R)||(this._status=1),A.setAdjacentTriangle(P)||(this._status=1),A.setAdjacentTriangle(R)||(this._status=1),P.setAdjacentTriangle(R)||(this._status=1),this._numTriangles++,this._triangleList==null?(this._triangleList=g,this._triangleListLast=g):(this._triangleListLast._next=g,g._prev=this._triangleListLast,this._triangleListLast=g),this._numTriangles++,this._triangleList==null?(this._triangleList=A,this._triangleListLast=A):(this._triangleListLast._next=A,A._prev=this._triangleListLast,this._triangleListLast=A),this._numTriangles++,this._triangleList==null?(this._triangleList=P,this._triangleListLast=P):(this._triangleListLast._next=P,P._prev=this._triangleListLast,this._triangleListLast=P),this._numTriangles++,this._triangleList==null?(this._triangleList=R,this._triangleListLast=R):(this._triangleListLast._next=R,R._prev=this._triangleListLast,this._triangleListLast=R),this._status==0}_addVertex(a,t){this._vertices[this._numVertices++]=a;var i=t._vertices[0];if(this.findEdgeLoop(this._numVertices,t,a.v),this._status!=0)return!1;for(var r=i,o=i,s=null,_=null;;){if(r._tmpEdgeLoopNext==null)return this._dumpAsObjModel(),this._status=4,!1;if(r._tmpEdgeLoopOuterTriangle==null)return this._status=5,!1;var h=this._trianglePool;h!=null?(this._trianglePool=h._next,h._next=null):h=new x.collision.narrowphase.detector.gjkepa.EpaTriangle;var v=h;if(_==null&&(_=v),v.init(r,r._tmpEdgeLoopNext,a,this._center,!1)||(this._status=1),this._status!=0)return!1;if(this._numTriangles++,this._triangleList==null?(this._triangleList=v,this._triangleListLast=v):(this._triangleListLast._next=v,v._prev=this._triangleListLast,this._triangleListLast=v),v.setAdjacentTriangle(r._tmpEdgeLoopOuterTriangle)||(this._status=1),s!=null&&(v.setAdjacentTriangle(s)||(this._status=1)),s=v,r=r._tmpEdgeLoopNext,r==o)break}return s.setAdjacentTriangle(_)||(this._status=1),this._status==0?this.validate():!1}_dumpAsObjModel(){}};x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState=class{};x.collision.narrowphase.detector.gjkepa.EpaTriangle=class{constructor(){this.id=++x.collision.narrowphase.detector.gjkepa.EpaTriangle.count,this._next=null,this._prev=null,this._normal=new x.common.Vec3,this._distanceSq=0,this._tmpDfsId=0,this._tmpDfsVisible=!1;var a=new Array(3);this._vertices=a;var t=new Array(3);this._adjacentTriangles=t;var i=new Array(3);this._adjacentPairIndex=i,this.tmp=new x.common.Vec3;var r=new Array(3);this._nextIndex=r,this._nextIndex[0]=1,this._nextIndex[1]=2,this._nextIndex[2]=0}init(a,t,i,r,o){o==null&&(o=!1);var s,_,h,v,e,l,u,b,f,n,c,z,p=a.v;s=p.x,_=p.y,h=p.z;var y=t.v;v=y.x,e=y.y,l=y.z;var V=i.v;u=V.x,b=V.y,f=V.z;var M=r;n=M.x,c=M.y,z=M.z;var I,k,X,L,m,g,N,A,F;I=v-s,k=e-_,X=l-h,L=u-s,m=b-_,g=f-h,N=s-n,A=_-c,F=h-z;var P,Y,R;P=k*g-X*m,Y=X*L-I*g,R=I*m-k*L;var C=!1,d=N*P+A*Y+F*R;if(d<0)if(o){var Z=t;t=i,i=Z,P*=-1,Y*=-1,R*=-1}else C=!0;this._vertices[0]=a,this._vertices[1]=t,this._vertices[2]=i;var $=this._normal;$.x=P,$.y=Y,$.z=R;var K=a.v,E=t.v,J=i.v,B=this.tmp,Q,U,G,D,H,j,ia,sa,W,q,na,oa,aa,T,ca,_a,w,ta,ra=K;Q=ra.x,U=ra.y,G=ra.z;var la=E;D=la.x,H=la.y,j=la.z;var va=J;ia=va.x,sa=va.y,W=va.z,q=D-Q,na=H-U,oa=j-G,aa=ia-D,T=sa-H,ca=W-j,_a=Q-ia,w=U-sa,ta=G-W;var xa,za,Ma;xa=na*ca-oa*T,za=oa*aa-q*ca,Ma=q*T-na*aa;var Xa,Za,fa,ba,ea,ha,ma,ya,da;Xa=na*Ma-oa*za,Za=oa*xa-q*Ma,fa=q*za-na*xa,ba=T*Ma-ca*za,ea=ca*xa-aa*Ma,ha=aa*za-T*xa,ma=w*Ma-ta*za,ya=ta*xa-_a*Ma,da=_a*za-w*xa;var pa=Q*Xa+U*Za+G*fa,Ya=D*ba+H*ea+j*ha,Qa=ia*ma+sa*ya+W*da,ga=-1,ua,wa,ka;if(ua=0,wa=0,ka=0,pa<0){var Sa,zt,Ha,Ba,nt,Ea,Fa=K;Sa=Fa.x,zt=Fa.y,Ha=Fa.z;var Aa=E;Ba=Aa.x,nt=Aa.y,Ea=Aa.z;var ft,Wa,Ka;ft=Ba-Sa,Wa=nt-zt,Ka=Ea-Ha;var bt=ft*ft+Wa*Wa+Ka*Ka,it=ft*Sa+Wa*zt+Ka*Ha;if(it=-it/bt,it<0){var $a=B;$a.x=Sa,$a.y=zt,$a.z=Ha}else if(it>1){var _t=B;_t.x=Ba,_t.y=nt,_t.z=Ea}else{var gt,pt,Ga;gt=Sa+ft*it,pt=zt+Wa*it,Ga=Ha+Ka*it;var rt=B;rt.x=gt,rt.y=pt,rt.z=Ga}var ut=B.x*B.x+B.y*B.y+B.z*B.z;ga=ut;var Da=B;ua=Da.x,wa=Da.y,ka=Da.z}if(Ya<0){var Ta,Na,Vt,St,et,Xt,Yt=E;Ta=Yt.x,Na=Yt.y,Vt=Yt.z;var Mt=J;St=Mt.x,et=Mt.y,Xt=Mt.z;var Ia,O,Va;Ia=St-Ta,O=et-Na,Va=Xt-Vt;var lt=Ia*Ia+O*O+Va*Va,S=Ia*Ta+O*Na+Va*Vt;if(S=-S/lt,S<0){var wt=B;wt.x=Ta,wt.y=Na,wt.z=Vt}else if(S>1){var Bt=B;Bt.x=St,Bt.y=et,Bt.z=Xt}else{var At,yt,kt;At=Ta+Ia*S,yt=Na+O*S,kt=Vt+Va*S;var mt=B;mt.x=At,mt.y=yt,mt.z=kt}var ht=B.x*B.x+B.y*B.y+B.z*B.z;if(ga<0||ht<ga){ga=ht;var xt=B;ua=xt.x,wa=xt.y,ka=xt.z}}if(Qa<0){var Ra,st,Ca,vt,qa,at,Oa=K;Ra=Oa.x,st=Oa.y,Ca=Oa.z;var tt=J;vt=tt.x,qa=tt.y,at=tt.z;var ct,Pa,Ja;ct=vt-Ra,Pa=qa-st,Ja=at-Ca;var ja=ct*ct+Pa*Pa+Ja*Ja,La=ct*Ra+Pa*st+Ja*Ca;if(La=-La/ja,La<0){var ot=B;ot.x=Ra,ot.y=st,ot.z=Ca}else if(La>1){var It=B;It.x=vt,It.y=qa,It.z=at}else{var oi,gi,ai;oi=Ra+ct*La,gi=st+Pa*La,ai=Ca+Ja*La;var Ct=B;Ct.x=oi,Ct.y=gi,Ct.z=ai}var _i=B.x*B.x+B.y*B.y+B.z*B.z;if(ga<0||_i<ga){ga=_i;var Et=B;ua=Et.x,wa=Et.y,ka=Et.z}}if(ga>0){var Pt=B;Pt.x=ua,Pt.y=wa,Pt.z=ka}else{var Jt=xa*xa+za*za+Ma*Ma;Jt>0&&(Jt=1/Math.sqrt(Jt)),xa*=Jt,za*=Jt,Ma*=Jt;var Ki=Q*xa+U*za+G*Ma,vi=xa*xa+za*za+Ma*Ma;vi=Ki/vi,ua=xa*vi,wa=za*vi,ka=Ma*vi;var li=B;li.x=ua,li.y=wa,li.z=ka}var ti=this.tmp;return this._distanceSq=ti.x*ti.x+ti.y*ti.y+ti.z*ti.z,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=-1,this._adjacentPairIndex[1]=-1,this._adjacentPairIndex[2]=-1,!C}setAdjacentTriangle(a){var t=0,i=this._nextIndex[0],r=this._nextIndex[0];this._vertices[0]==a._vertices[r]&&this._vertices[i]==a._vertices[0]&&(this._adjacentTriangles[0]=a,this._adjacentPairIndex[0]=0,a._adjacentTriangles[0]=this,a._adjacentPairIndex[0]=0,++t);var o=this._nextIndex[0],s=this._nextIndex[1];this._vertices[0]==a._vertices[s]&&this._vertices[o]==a._vertices[1]&&(this._adjacentTriangles[0]=a,this._adjacentPairIndex[0]=1,a._adjacentTriangles[1]=this,a._adjacentPairIndex[1]=0,++t);var _=this._nextIndex[0],h=this._nextIndex[2];this._vertices[0]==a._vertices[h]&&this._vertices[_]==a._vertices[2]&&(this._adjacentTriangles[0]=a,this._adjacentPairIndex[0]=2,a._adjacentTriangles[2]=this,a._adjacentPairIndex[2]=0,++t);var v=this._nextIndex[1],e=this._nextIndex[0];this._vertices[1]==a._vertices[e]&&this._vertices[v]==a._vertices[0]&&(this._adjacentTriangles[1]=a,this._adjacentPairIndex[1]=0,a._adjacentTriangles[0]=this,a._adjacentPairIndex[0]=1,++t);var l=this._nextIndex[1],u=this._nextIndex[1];this._vertices[1]==a._vertices[u]&&this._vertices[l]==a._vertices[1]&&(this._adjacentTriangles[1]=a,this._adjacentPairIndex[1]=1,a._adjacentTriangles[1]=this,a._adjacentPairIndex[1]=1,++t);var b=this._nextIndex[1],f=this._nextIndex[2];this._vertices[1]==a._vertices[f]&&this._vertices[b]==a._vertices[2]&&(this._adjacentTriangles[1]=a,this._adjacentPairIndex[1]=2,a._adjacentTriangles[2]=this,a._adjacentPairIndex[2]=1,++t);var n=this._nextIndex[2],c=this._nextIndex[0];this._vertices[2]==a._vertices[c]&&this._vertices[n]==a._vertices[0]&&(this._adjacentTriangles[2]=a,this._adjacentPairIndex[2]=0,a._adjacentTriangles[0]=this,a._adjacentPairIndex[0]=2,++t);var z=this._nextIndex[2],p=this._nextIndex[1];this._vertices[2]==a._vertices[p]&&this._vertices[z]==a._vertices[1]&&(this._adjacentTriangles[2]=a,this._adjacentPairIndex[2]=1,a._adjacentTriangles[1]=this,a._adjacentPairIndex[1]=2,++t);var y=this._nextIndex[2],V=this._nextIndex[2];return this._vertices[2]==a._vertices[V]&&this._vertices[y]==a._vertices[2]&&(this._adjacentTriangles[2]=a,this._adjacentPairIndex[2]=2,a._adjacentTriangles[2]=this,a._adjacentPairIndex[2]=2,++t),t==1}removeAdjacentTriangles(){var a=this._adjacentTriangles[0];if(a!=null){var t=this._adjacentPairIndex[0];a._adjacentTriangles[t]=null,a._adjacentPairIndex[t]=-1,this._adjacentTriangles[0]=null,this._adjacentPairIndex[0]=-1}var i=this._adjacentTriangles[1];if(i!=null){var r=this._adjacentPairIndex[1];i._adjacentTriangles[r]=null,i._adjacentPairIndex[r]=-1,this._adjacentTriangles[1]=null,this._adjacentPairIndex[1]=-1}var o=this._adjacentTriangles[2];if(o!=null){var s=this._adjacentPairIndex[2];o._adjacentTriangles[s]=null,o._adjacentPairIndex[s]=-1,this._adjacentTriangles[2]=null,this._adjacentPairIndex[2]=-1}}removeReferences(){this._next=null,this._prev=null,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._distanceSq=0,this._vertices[0]=null,this._vertices[1]=null,this._vertices[2]=null,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=0,this._adjacentPairIndex[1]=0,this._adjacentPairIndex[2]=0}dump(){}};x.collision.narrowphase.detector.gjkepa.EpaVertex=class{constructor(){this.randId=Math.random()*1e5|0,this.v=new x.common.Vec3,this.w1=new x.common.Vec3,this.w2=new x.common.Vec3}init(a,t,i){var r=this.v;r.x=a.x,r.y=a.y,r.z=a.z;var o=this.w1;o.x=t.x,o.y=t.y,o.z=t.z;var s=this.w2;return s.x=i.x,s.y=i.y,s.z=i.z,this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null,this}removeReferences(){this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null}};x.collision.narrowphase.detector.gjkepa.GjkCache=class{constructor(){this.prevClosestDir=new x.common.Vec3}clear(){this.prevClosestDir.zero()}};x.common||(x.common={});x.common.Vec3=class{constructor(a,t,i){i==null&&(i=0),t==null&&(t=0),a==null&&(a=0),this.x=a,this.y=t,this.z=i,x.common.Vec3.numCreations++}init(a,t,i){return this.x=a,this.y=t,this.z=i,this}zero(){var a=0,t=0,i=0;return this.x=a,this.y=t,this.z=i,this}add(a){return new x.common.Vec3(this.x+a.x,this.y+a.y,this.z+a.z)}add3(a,t,i){return new x.common.Vec3(this.x+a,this.y+t,this.z+i)}addScaled(a,t){return new x.common.Vec3(this.x+a.x*t,this.y+a.y*t,this.z+a.z*t)}sub(a){return new x.common.Vec3(this.x-a.x,this.y-a.y,this.z-a.z)}sub3(a,t,i){return new x.common.Vec3(this.x-a,this.y-t,this.z-i)}scale(a){return new x.common.Vec3(this.x*a,this.y*a,this.z*a)}scale3(a,t,i){return new x.common.Vec3(this.x*a,this.y*t,this.z*i)}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z}cross(a){return new x.common.Vec3(this.y*a.z-this.z*a.y,this.z*a.x-this.x*a.z,this.x*a.y-this.y*a.x)}addEq(a){var t=this.x+a.x,i=this.y+a.y,r=this.z+a.z;return this.x=t,this.y=i,this.z=r,this}add3Eq(a,t,i){var r=this.x+a,o=this.y+t,s=this.z+i;return this.x=r,this.y=o,this.z=s,this}addScaledEq(a,t){var i=this.x+a.x*t,r=this.y+a.y*t,o=this.z+a.z*t;return this.x=i,this.y=r,this.z=o,this}subEq(a){var t=this.x-a.x,i=this.y-a.y,r=this.z-a.z;return this.x=t,this.y=i,this.z=r,this}sub3Eq(a,t,i){var r=this.x-a,o=this.y-t,s=this.z-i;return this.x=r,this.y=o,this.z=s,this}scaleEq(a){var t=this.x*a,i=this.y*a,r=this.z*a;return this.x=t,this.y=i,this.z=r,this}scale3Eq(a,t,i){var r=this.x*a,o=this.y*t,s=this.z*i;return this.x=r,this.y=o,this.z=s,this}crossEq(a){var t=this.y*a.z-this.z*a.y,i=this.z*a.x-this.x*a.z,r=this.x*a.y-this.y*a.x;return this.x=t,this.y=i,this.z=r,this}mulMat3(a){return new x.common.Vec3(this.x*a.e00+this.y*a.e01+this.z*a.e02,this.x*a.e10+this.y*a.e11+this.z*a.e12,this.x*a.e20+this.y*a.e21+this.z*a.e22)}mulMat4(a){return new x.common.Vec3(this.x*a.e00+this.y*a.e01+this.z*a.e02+a.e03,this.x*a.e10+this.y*a.e11+this.z*a.e12+a.e13,this.x*a.e20+this.y*a.e21+this.z*a.e22+a.e23)}mulTransform(a){var t,i,r,o=this;t=o.x,i=o.y,r=o.z;var s,_,h;s=a._rotation00*t+a._rotation01*i+a._rotation02*r,_=a._rotation10*t+a._rotation11*i+a._rotation12*r,h=a._rotation20*t+a._rotation21*i+a._rotation22*r,t=s,i=_,r=h,t+=a._positionX,i+=a._positionY,r+=a._positionZ;var v=new x.common.Vec3,e=v;return e.x=t,e.y=i,e.z=r,v}mulMat3Eq(a){var t=this.x*a.e00+this.y*a.e01+this.z*a.e02,i=this.x*a.e10+this.y*a.e11+this.z*a.e12,r=this.x*a.e20+this.y*a.e21+this.z*a.e22;return this.x=t,this.y=i,this.z=r,this}mulMat4Eq(a){var t=this.x*a.e00+this.y*a.e01+this.z*a.e02+a.e03,i=this.x*a.e10+this.y*a.e11+this.z*a.e12+a.e13,r=this.x*a.e20+this.y*a.e21+this.z*a.e22+a.e23;return this.x=t,this.y=i,this.z=r,this}mulTransformEq(a){var t,i,r,o=this;t=o.x,i=o.y,r=o.z;var s,_,h;s=a._rotation00*t+a._rotation01*i+a._rotation02*r,_=a._rotation10*t+a._rotation11*i+a._rotation12*r,h=a._rotation20*t+a._rotation21*i+a._rotation22*r,t=s,i=_,r=h,t+=a._positionX,i+=a._positionY,r+=a._positionZ;var v=this;return v.x=t,v.y=i,v.z=r,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}normalized(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return a>0&&(a=1/a),new x.common.Vec3(this.x*a,this.y*a,this.z*a)}normalize(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);a>0&&(a=1/a);var t=this.x*a,i=this.y*a,r=this.z*a;return this.x=t,this.y=i,this.z=r,this}negate(){return new x.common.Vec3(-this.x,-this.y,-this.z)}negateEq(){var a=-this.x,t=-this.y,i=-this.z;return this.x=a,this.y=t,this.z=i,this}copyFrom(a){return this.x=a.x,this.y=a.y,this.z=a.z,this}clone(){return new x.common.Vec3(this.x,this.y,this.z)}toString(){return"Vec3["+(this.x>0?(this.x*1e7+.5|0)/1e7:(this.x*1e7-.5|0)/1e7)+", "+(this.y>0?(this.y*1e7+.5|0)/1e7:(this.y*1e7-.5|0)/1e7)+", "+(this.z>0?(this.z*1e7+.5|0)/1e7:(this.z*1e7-.5|0)/1e7)+"]"}};x.common.Transform=class{constructor(){this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1}identity(){return this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1,this}getPosition(){var a=new x.common.Vec3,t=a;return t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ,a}getPositionTo(a){var t=a;t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ}setPosition(a){var t=a;return this._positionX=t.x,this._positionY=t.y,this._positionZ=t.z,this}translate(a){var t,i,r,o=a;t=o.x,i=o.y,r=o.z,this._positionX+=t,this._positionY+=i,this._positionZ+=r}getRotation(){var a=new x.common.Mat3,t=a;return t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22,a}getRotationTo(a){var t=a;t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22}setRotation(a){var t=a;return this._rotation00=t.e00,this._rotation01=t.e01,this._rotation02=t.e02,this._rotation10=t.e10,this._rotation11=t.e11,this._rotation12=t.e12,this._rotation20=t.e20,this._rotation21=t.e21,this._rotation22=t.e22,this}setRotationXyz(a){var t,i,r,o=a;t=o.x,i=o.y,r=o.z;var s=Math.sin(t),_=Math.sin(i),h=Math.sin(r),v=Math.cos(t),e=Math.cos(i),l=Math.cos(r);this._rotation00=e*l,this._rotation01=-e*h,this._rotation02=_,this._rotation10=v*h+l*s*_,this._rotation11=v*l-s*_*h,this._rotation12=-e*s,this._rotation20=s*h-v*l*_,this._rotation21=l*s+v*_*h,this._rotation22=v*e}rotate(a){var t,i,r,o,s,_,h,v,e,l=a;t=l.e00,i=l.e01,r=l.e02,o=l.e10,s=l.e11,_=l.e12,h=l.e20,v=l.e21,e=l.e22;var u,b,f,n,c,z,p,y,V;u=t*this._rotation00+i*this._rotation10+r*this._rotation20,b=t*this._rotation01+i*this._rotation11+r*this._rotation21,f=t*this._rotation02+i*this._rotation12+r*this._rotation22,n=o*this._rotation00+s*this._rotation10+_*this._rotation20,c=o*this._rotation01+s*this._rotation11+_*this._rotation21,z=o*this._rotation02+s*this._rotation12+_*this._rotation22,p=h*this._rotation00+v*this._rotation10+e*this._rotation20,y=h*this._rotation01+v*this._rotation11+e*this._rotation21,V=h*this._rotation02+v*this._rotation12+e*this._rotation22,this._rotation00=u,this._rotation01=b,this._rotation02=f,this._rotation10=n,this._rotation11=c,this._rotation12=z,this._rotation20=p,this._rotation21=y,this._rotation22=V}rotateXyz(a){var t,i,r,o,s,_,h,v,e,l,u,b,f=a;t=f.x,i=f.y,r=f.z;var n=Math.sin(t),c=Math.sin(i),z=Math.sin(r),p=Math.cos(t),y=Math.cos(i),V=Math.cos(r);o=y*V,s=-y*z,_=c,h=p*z+V*n*c,v=p*V-n*c*z,e=-y*n,l=n*z-p*V*c,u=V*n+p*c*z,b=p*y;var M,I,k,X,L,m,g,N,A;M=o*this._rotation00+s*this._rotation10+_*this._rotation20,I=o*this._rotation01+s*this._rotation11+_*this._rotation21,k=o*this._rotation02+s*this._rotation12+_*this._rotation22,X=h*this._rotation00+v*this._rotation10+e*this._rotation20,L=h*this._rotation01+v*this._rotation11+e*this._rotation21,m=h*this._rotation02+v*this._rotation12+e*this._rotation22,g=l*this._rotation00+u*this._rotation10+b*this._rotation20,N=l*this._rotation01+u*this._rotation11+b*this._rotation21,A=l*this._rotation02+u*this._rotation12+b*this._rotation22,this._rotation00=M,this._rotation01=I,this._rotation02=k,this._rotation10=X,this._rotation11=L,this._rotation12=m,this._rotation20=g,this._rotation21=N,this._rotation22=A}getOrientation(){var a=new x.common.Quat,t,i,r,o,s=this._rotation00,_=this._rotation11,h=this._rotation22,v=s+_+h,e;v>0?(e=Math.sqrt(v+1),o=.5*e,e=.5/e,t=(this._rotation21-this._rotation12)*e,i=(this._rotation02-this._rotation20)*e,r=(this._rotation10-this._rotation01)*e):s>_?s>h?(e=Math.sqrt(s-_-h+1),t=.5*e,e=.5/e,i=(this._rotation01+this._rotation10)*e,r=(this._rotation02+this._rotation20)*e,o=(this._rotation21-this._rotation12)*e):(e=Math.sqrt(h-s-_+1),r=.5*e,e=.5/e,t=(this._rotation02+this._rotation20)*e,i=(this._rotation12+this._rotation21)*e,o=(this._rotation10-this._rotation01)*e):_>h?(e=Math.sqrt(_-h-s+1),i=.5*e,e=.5/e,t=(this._rotation01+this._rotation10)*e,r=(this._rotation12+this._rotation21)*e,o=(this._rotation02-this._rotation20)*e):(e=Math.sqrt(h-s-_+1),r=.5*e,e=.5/e,t=(this._rotation02+this._rotation20)*e,i=(this._rotation12+this._rotation21)*e,o=(this._rotation10-this._rotation01)*e);var l=a;return l.x=t,l.y=i,l.z=r,l.w=o,a}getOrientationTo(a){var t,i,r,o,s=this._rotation00,_=this._rotation11,h=this._rotation22,v=s+_+h,e;v>0?(e=Math.sqrt(v+1),o=.5*e,e=.5/e,t=(this._rotation21-this._rotation12)*e,i=(this._rotation02-this._rotation20)*e,r=(this._rotation10-this._rotation01)*e):s>_?s>h?(e=Math.sqrt(s-_-h+1),t=.5*e,e=.5/e,i=(this._rotation01+this._rotation10)*e,r=(this._rotation02+this._rotation20)*e,o=(this._rotation21-this._rotation12)*e):(e=Math.sqrt(h-s-_+1),r=.5*e,e=.5/e,t=(this._rotation02+this._rotation20)*e,i=(this._rotation12+this._rotation21)*e,o=(this._rotation10-this._rotation01)*e):_>h?(e=Math.sqrt(_-h-s+1),i=.5*e,e=.5/e,t=(this._rotation01+this._rotation10)*e,r=(this._rotation12+this._rotation21)*e,o=(this._rotation02-this._rotation20)*e):(e=Math.sqrt(h-s-_+1),r=.5*e,e=.5/e,t=(this._rotation02+this._rotation20)*e,i=(this._rotation12+this._rotation21)*e,o=(this._rotation10-this._rotation01)*e);var l=a;l.x=t,l.y=i,l.z=r,l.w=o}setOrientation(a){var t,i,r,o,s=a;t=s.x,i=s.y,r=s.z,o=s.w;var _=t,h=i,v=r,e=o,l=2*_,u=2*h,b=2*v,f=_*l,n=h*u,c=v*b,z=_*u,p=h*b,y=_*b,V=e*l,M=e*u,I=e*b;return this._rotation00=1-n-c,this._rotation01=z-I,this._rotation02=y+M,this._rotation10=z+I,this._rotation11=1-f-c,this._rotation12=p-V,this._rotation20=y-M,this._rotation21=p+V,this._rotation22=1-f-n,this}clone(){var a=new x.common.Transform;return a._positionX=this._positionX,a._positionY=this._positionY,a._positionZ=this._positionZ,a._rotation00=this._rotation00,a._rotation01=this._rotation01,a._rotation02=this._rotation02,a._rotation10=this._rotation10,a._rotation11=this._rotation11,a._rotation12=this._rotation12,a._rotation20=this._rotation20,a._rotation21=this._rotation21,a._rotation22=this._rotation22,a}copyFrom(a){return this._positionX=a._positionX,this._positionY=a._positionY,this._positionZ=a._positionZ,this._rotation00=a._rotation00,this._rotation01=a._rotation01,this._rotation02=a._rotation02,this._rotation10=a._rotation10,this._rotation11=a._rotation11,this._rotation12=a._rotation12,this._rotation20=a._rotation20,this._rotation21=a._rotation21,this._rotation22=a._rotation22,this}};x.common.Setting=class{};x.collision.narrowphase.detector.gjkepa.GjkEpa=class{constructor(){var a=new Array(4);this.s=a;var t=new Array(4);this.w1=t;var i=new Array(4);this.w2=i;var r=new Array(3);this.baseDirs=r,this.baseDirs[0]=new x.common.Vec3(1,0,0),this.baseDirs[1]=new x.common.Vec3(0,1,0),this.baseDirs[2]=new x.common.Vec3(0,0,1),this.tl1=new x.common.Vec3,this.tl2=new x.common.Vec3,this.rayX=new x.common.Vec3,this.rayR=new x.common.Vec3,this.tempTransform=new x.common.Transform,this.s[0]=new x.common.Vec3,this.w1[0]=new x.common.Vec3,this.w2[0]=new x.common.Vec3,this.s[1]=new x.common.Vec3,this.w1[1]=new x.common.Vec3,this.w2[1]=new x.common.Vec3,this.s[2]=new x.common.Vec3,this.w1[2]=new x.common.Vec3,this.w2[2]=new x.common.Vec3,this.s[3]=new x.common.Vec3,this.w1[3]=new x.common.Vec3,this.w2[3]=new x.common.Vec3,this.dir=new x.common.Vec3,this.closest=new x.common.Vec3,this.closestPoint1=new x.common.Vec3,this.closestPoint2=new x.common.Vec3,this.polyhedron=new x.collision.narrowphase.detector.gjkepa.EpaPolyhedron}computeClosestPointsImpl(a,t,i,r,o,s){this.c1=a,this.c2=t,this.tf1=i,this.tf2=r;var _=this.s,h=this.w1,v=this.w2,e=this.closest,l=this.dir;if(o!=null?(o._gjkCache==null&&(o._gjkCache=new x.collision.narrowphase.detector.gjkepa.GjkCache),this.loadCache(o._gjkCache)):l.zero(),l.x*l.x+l.y*l.y+l.z*l.z==0){var u,b,f;u=r._positionX-i._positionX,b=r._positionY-i._positionY,f=r._positionZ-i._positionZ;var n=l;n.x=u,n.y=b,n.z=f,l.x*l.x+l.y*l.y+l.z*l.z<1e-6&&l.init(1,0,0)}this.simplexSize=0,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var c=this.s[this.simplexSize],z=this.w1[this.simplexSize];c.x=z.x,c.y=z.y,c.z=z.z;var p=c,y=this.w2[this.simplexSize],V=p.x-y.x,M=p.y-y.y,I=p.z-y.z;p.x=V,p.y=M,p.z=I,this.simplexSize=1;for(var k=0,X=40,L=1e-4,m=L*L;k<X;){var g=0;switch(this.simplexSize){case 1:var N=_[0];e.x=N.x,e.y=N.y,e.z=N.z,g=1;break;case 2:var A,F,P,Y,R,C,d=_[0];A=d.x,F=d.y,P=d.z;var Z=_[1];Y=Z.x,R=Z.y,C=Z.z;var $,K,E;$=Y-A,K=R-F,E=C-P;var J=$*$+K*K+E*E,B=$*A+K*F+E*P;if(B=-B/J,B<0){var Q=e;Q.x=A,Q.y=F,Q.z=P,g=1}else if(B>1){var U=e;U.x=Y,U.y=R,U.z=C,g=2}else{var G,D,H;G=A+$*B,D=F+K*B,H=P+E*B;var j=e;j.x=G,j.y=D,j.z=H,g=3}break;case 3:var ia=_[0],sa=_[1],W=_[2],q,na,oa,aa,T,ca,_a,w,ta,ra,la,va,xa,za,Ma,Xa,Za,fa,ba=ia;q=ba.x,na=ba.y,oa=ba.z;var ea=sa;aa=ea.x,T=ea.y,ca=ea.z;var ha=W;_a=ha.x,w=ha.y,ta=ha.z,ra=aa-q,la=T-na,va=ca-oa,xa=_a-aa,za=w-T,Ma=ta-ca,Xa=q-_a,Za=na-w,fa=oa-ta;var ma,ya,da;ma=la*Ma-va*za,ya=va*xa-ra*Ma,da=ra*za-la*xa;var pa,Ya,Qa,ga,ua,wa,ka,Sa,zt;pa=la*da-va*ya,Ya=va*ma-ra*da,Qa=ra*ya-la*ma,ga=za*da-Ma*ya,ua=Ma*ma-xa*da,wa=xa*ya-za*ma,ka=Za*da-fa*ya,Sa=fa*ma-Xa*da,zt=Xa*ya-Za*ma;var Ha=q*pa+na*Ya+oa*Qa,Ba=aa*ga+T*ua+ca*wa,nt=_a*ka+w*Sa+ta*zt,Ea=-1,Fa,Aa,ft,Wa=0;if(Fa=0,Aa=0,ft=0,Ha<0){var Ka,bt,it,$a,_t,gt,pt=ia;Ka=pt.x,bt=pt.y,it=pt.z;var Ga=sa;$a=Ga.x,_t=Ga.y,gt=Ga.z;var rt,ut,Da;rt=$a-Ka,ut=_t-bt,Da=gt-it;var Ta=rt*rt+ut*ut+Da*Da,Na=rt*Ka+ut*bt+Da*it;Na=-Na/Ta;var Vt;if(Na<0){var St=e;St.x=Ka,St.y=bt,St.z=it,Vt=1}else if(Na>1){var et=e;et.x=$a,et.y=_t,et.z=gt,Vt=2}else{var Xt,Yt,Mt;Xt=Ka+rt*Na,Yt=bt+ut*Na,Mt=it+Da*Na;var Ia=e;Ia.x=Xt,Ia.y=Yt,Ia.z=Mt,Vt=3}var O=e.x*e.x+e.y*e.y+e.z*e.z;Wa=Vt,Ea=O;var Va=e;Fa=Va.x,Aa=Va.y,ft=Va.z}if(Ba<0){var lt,S,wt,Bt,At,yt,kt=sa;lt=kt.x,S=kt.y,wt=kt.z;var mt=W;Bt=mt.x,At=mt.y,yt=mt.z;var ht,xt,Ra;ht=Bt-lt,xt=At-S,Ra=yt-wt;var st=ht*ht+xt*xt+Ra*Ra,Ca=ht*lt+xt*S+Ra*wt;Ca=-Ca/st;var vt;if(Ca<0){var qa=e;qa.x=lt,qa.y=S,qa.z=wt,vt=1}else if(Ca>1){var at=e;at.x=Bt,at.y=At,at.z=yt,vt=2}else{var Oa,tt,ct;Oa=lt+ht*Ca,tt=S+xt*Ca,ct=wt+Ra*Ca;var Pa=e;Pa.x=Oa,Pa.y=tt,Pa.z=ct,vt=3}var Ja=e.x*e.x+e.y*e.y+e.z*e.z;if(Ea<0||Ja<Ea){Wa=vt<<1,Ea=Ja;var ja=e;Fa=ja.x,Aa=ja.y,ft=ja.z}}if(nt<0){var La,ot,It,oi,gi,ai,Ct=ia;La=Ct.x,ot=Ct.y,It=Ct.z;var _i=W;oi=_i.x,gi=_i.y,ai=_i.z;var Et,Pt,Jt;Et=oi-La,Pt=gi-ot,Jt=ai-It;var Ki=Et*Et+Pt*Pt+Jt*Jt,vi=Et*La+Pt*ot+Jt*It;vi=-vi/Ki;var li;if(vi<0){var ti=e;ti.x=La,ti.y=ot,ti.z=It,li=1}else if(vi>1){var Oi=e;Oi.x=oi,Oi.y=gi,Oi.z=ai,li=2}else{var Xi,zi,Zt;Xi=La+Et*vi,zi=ot+Pt*vi,Zt=It+Jt*vi;var ri=e;ri.x=Xi,ri.y=zi,ri.z=Zt,li=3}var Wt=e.x*e.x+e.y*e.y+e.z*e.z;if(Ea<0||Wt<Ea){Wa=li&1|(li&2)<<1,Ea=Wt;var ni=e;Fa=ni.x,Aa=ni.y,ft=ni.z}}if(Ea>0){var $i=e;$i.x=Fa,$i.y=Aa,$i.z=ft,g=Wa}else{var Ut=ma*ma+ya*ya+da*da;Ut>0&&(Ut=1/Math.sqrt(Ut)),ma*=Ut,ya*=Ut,da*=Ut;var ji=q*ma+na*ya+oa*da,Ii=ma*ma+ya*ya+da*da;Ii=ji/Ii,Fa=ma*Ii,Aa=ya*Ii,ft=da*Ii;var pr=e;pr.x=Fa,pr.y=Aa,pr.z=ft,g=7}break;case 4:var Wi=_[0],Lt=_[1],jt=_[2],Tt=_[3],bi,Mi,vr,qt,fi,dt,ui,hi,er,Xr,ro,Gt,fr,mr,Dt,dr,Pi,Dr,Hn,oo,Br,no,yn,Ao,Io,xi,qr,Ar=Wi;bi=Ar.x,Mi=Ar.y,vr=Ar.z;var yr=Lt;qt=yr.x,fi=yr.y,dt=yr.z;var Po=jt;ui=Po.x,hi=Po.y,er=Po.z;var Di=Tt;Xr=Di.x,ro=Di.y,Gt=Di.z,fr=qt-bi,mr=fi-Mi,Dt=dt-vr,dr=ui-bi,Pi=hi-Mi,Dr=er-vr,Hn=Xr-bi,oo=ro-Mi,Br=Gt-vr,no=ui-qt,yn=hi-fi,Ao=er-dt,Io=Xr-qt,xi=ro-fi,qr=Gt-dt;var Pr,gr,Rt,Hi,Li,Cn,Ms,je,ps,Te,qe,D_;Pr=mr*Dr-Dt*Pi,gr=Dt*dr-fr*Dr,Rt=fr*Pi-mr*dr,Hi=Pi*Br-Dr*oo,Li=Dr*Hn-dr*Br,Cn=dr*oo-Pi*Hn,Ms=oo*Dt-Br*mr,je=Br*fr-Hn*Dt,ps=Hn*mr-oo*fr,Te=xi*Ao-qr*yn,qe=qr*no-Io*Ao,D_=Io*yn-xi*no;var gn=fr*Te+mr*qe+Dt*D_>0?1:-1,Si=bi*Pr+Mi*gr+vr*Rt,No=bi*Hi+Mi*Li+vr*Cn,Wr=bi*Ms+Mi*je+vr*ps,ke=qt*Te+fi*qe+dt*D_,on=-1,Tn,Kn,we,k_=0;if(Tn=0,Kn=0,we=0,Si*gn<0){var Re,Vi,Ir,ur,eo,Rn,ms,nn,Qn,ci,ho,Fr,En,as,Qe,Ee,De,he,ii=Wi;Re=ii.x,Vi=ii.y,Ir=ii.z;var ir=Lt;ur=ir.x,eo=ir.y,Rn=ir.z;var Qi=jt;ms=Qi.x,nn=Qi.y,Qn=Qi.z,ci=ur-Re,ho=eo-Vi,Fr=Rn-Ir,En=ms-ur,as=nn-eo,Qe=Qn-Rn,Ee=Re-ms,De=Vi-nn,he=Ir-Qn;var Fi,fo,So;Fi=ho*Qe-Fr*as,fo=Fr*En-ci*Qe,So=ci*as-ho*En;var s_,Fe,ts,Dn,co,Ft,Ni,lr,Vo;s_=ho*So-Fr*fo,Fe=Fr*Fi-ci*So,ts=ci*fo-ho*Fi,Dn=as*So-Qe*fo,co=Qe*Fi-En*So,Ft=En*fo-as*Fi,Ni=De*So-he*fo,lr=he*Fi-Ee*So,Vo=Ee*fo-De*Fi;var ce=Re*s_+Vi*Fe+Ir*ts,Xe=ur*Dn+eo*co+Rn*Ft,Le=ms*Ni+nn*lr+Qn*Vo,uo=-1,$t,Vr,sr,Jo=0;if($t=0,Vr=0,sr=0,ce<0){var Ns,Co,ko,Nr,Sr,Cr,Lr=Wi;Ns=Lr.x,Co=Lr.y,ko=Lr.z;var Qt=Lt;Nr=Qt.x,Sr=Qt.y,Cr=Qt.z;var Ji,Yi,Ri;Ji=Nr-Ns,Yi=Sr-Co,Ri=Cr-ko;var zr=Ji*Ji+Yi*Yi+Ri*Ri,qi=Ji*Ns+Yi*Co+Ri*ko;qi=-qi/zr;var Jr;if(qi<0){var Gr=e;Gr.x=Ns,Gr.y=Co,Gr.z=ko,Jr=1}else if(qi>1){var ao=e;ao.x=Nr,ao.y=Sr,ao.z=Cr,Jr=2}else{var be,ki,en;be=Ns+Ji*qi,ki=Co+Yi*qi,en=ko+Ri*qi;var Yr=e;Yr.x=be,Yr.y=ki,Yr.z=en,Jr=3}var Go=e.x*e.x+e.y*e.y+e.z*e.z;Jo=Jr,uo=Go;var ys=e;$t=ys.x,Vr=ys.y,sr=ys.z}if(Xe<0){var In,gs,Vn,Ci,To,so,Fn=Lt;In=Fn.x,gs=Fn.y,Vn=Fn.z;var Ne=jt;Ci=Ne.x,To=Ne.y,so=Ne.z;var Nn,Wo,kn;Nn=Ci-In,Wo=To-gs,kn=so-Vn;var Ye=Nn*Nn+Wo*Wo+kn*kn,Ot=Nn*In+Wo*gs+kn*Vn;Ot=-Ot/Ye;var Ro;if(Ot<0){var Ur=e;Ur.x=In,Ur.y=gs,Ur.z=Vn,Ro=1}else if(Ot>1){var wn=e;wn.x=Ci,wn.y=To,wn.z=so,Ro=2}else{var Jn,fe,Is;Jn=In+Nn*Ot,fe=gs+Wo*Ot,Is=Vn+kn*Ot;var Uo=e;Uo.x=Jn,Uo.y=fe,Uo.z=Is,Ro=3}var Vs=e.x*e.x+e.y*e.y+e.z*e.z;if(uo<0||Vs<uo){Jo=Ro<<1,uo=Vs;var w_=e;$t=w_.x,Vr=w_.y,sr=w_.z}}if(Le<0){var Js,X_,Je,F_,N_,Or,wo=Wi;Js=wo.x,X_=wo.y,Je=wo.z;var Xo=jt;F_=Xo.x,N_=Xo.y,Or=Xo.z;var Gn,wi,Wn;Gn=F_-Js,wi=N_-X_,Wn=Or-Je;var Qo=Gn*Gn+wi*wi+Wn*Wn,to=Gn*Js+wi*X_+Wn*Je;to=-to/Qo;var J_;if(to<0){var G_=e;G_.x=Js,G_.y=X_,G_.z=Je,J_=1}else if(to>1){var L_=e;L_.x=F_,L_.y=N_,L_.z=Or,J_=2}else{var is,__,v_;is=Js+Gn*to,__=X_+wi*to,v_=Je+Wn*to;var rs=e;rs.x=is,rs.y=__,rs.z=v_,J_=3}var pi=e.x*e.x+e.y*e.y+e.z*e.z;if(uo<0||pi<uo){Jo=J_&1|(J_&2)<<1,uo=pi;var Oo=e;$t=Oo.x,Vr=Oo.y,sr=Oo.z}}var ar;if(uo>0){var Ze=e;Ze.x=$t,Ze.y=Vr,Ze.z=sr,ar=Jo}else{var Gs=Fi*Fi+fo*fo+So*So;Gs>0&&(Gs=1/Math.sqrt(Gs)),Fi*=Gs,fo*=Gs,So*=Gs;var hv=Re*Fi+Vi*fo+Ir*So,ue=Fi*Fi+fo*fo+So*So;ue=hv/ue,$t=Fi*ue,Vr=fo*ue,sr=So*ue;var Ge=e;Ge.x=$t,Ge.y=Vr,Ge.z=sr,ar=7}var $n=e.x*e.x+e.y*e.y+e.z*e.z;k_=ar,on=$n;var Ws=e;Tn=Ws.x,Kn=Ws.y,we=Ws.z}if(No*gn<0){var Ti,Lo,Tr,sn,ks,Y_,We,jn,Xn,os,de,ns,Us,l_,Be,Ae,qn,mi,xo=Wi;Ti=xo.x,Lo=xo.y,Tr=xo.z;var Zr=jt;sn=Zr.x,ks=Zr.y,Y_=Zr.z;var Ho=Tt;We=Ho.x,jn=Ho.y,Xn=Ho.z,os=sn-Ti,de=ks-Lo,ns=Y_-Tr,Us=We-sn,l_=jn-ks,Be=Xn-Y_,Ae=Ti-We,qn=Lo-jn,mi=Tr-Xn;var Yo,Hr,Eo;Yo=de*Be-ns*l_,Hr=ns*Us-os*Be,Eo=os*l_-de*Us;var ws,ae,Os,W_,te,Nt,Kr,Do,Xs;ws=de*Eo-ns*Hr,ae=ns*Yo-os*Eo,Os=os*Hr-de*Yo,W_=l_*Eo-Be*Hr,te=Be*Yo-Us*Eo,Nt=Us*Hr-l_*Yo,Kr=qn*Eo-mi*Hr,Do=mi*Yo-Ae*Eo,Xs=Ae*Hr-qn*Yo;var kv=Ti*ws+Lo*ae+Tr*Os,i0=sn*W_+ks*te+Y_*Nt,U_=We*Kr+jn*Do+Xn*Xs,Ht=-1,Ln,Rr,Yn,Z_=0;if(Ln=0,Rr=0,Yn=0,kv<0){var Hs,h_,bo,es,ss,xe,Zi=Wi;Hs=Zi.x,h_=Zi.y,bo=Zi.z;var Ko=jt;es=Ko.x,ss=Ko.y,xe=Ko.z;var kr,Zo,Ue;kr=es-Hs,Zo=ss-h_,Ue=xe-bo;var cv=kr*kr+Zo*Zo+Ue*Ue,ze=kr*Hs+Zo*h_+Ue*bo;ze=-ze/cv;var Ks;if(ze<0){var wv=e;wv.x=Hs,wv.y=h_,wv.z=bo,Ks=1}else if(ze>1){var Oe=e;Oe.x=es,Oe.y=ss,Oe.z=xe,Ks=2}else{var ei,Zn,_n;ei=Hs+kr*ze,Zn=h_+Zo*ze,_n=bo+Ue*ze;var vn=e;vn.x=ei,vn.y=Zn,vn.z=_n,Ks=3}var d_=e.x*e.x+e.y*e.y+e.z*e.z;Z_=Ks,Ht=d_;var bv=e;Ln=bv.x,Rr=bv.y,Yn=bv.z}if(i0<0){var ie,Pe,c_,O_,fv,uv,b_=jt;ie=b_.x,Pe=b_.y,c_=b_.z;var He=Tt;O_=He.x,fv=He.y,uv=He.z;var zo,_s,vs;zo=O_-ie,_s=fv-Pe,vs=uv-c_;var Ui=zo*zo+_s*_s+vs*vs,Mo=zo*ie+_s*Pe+vs*c_;Mo=-Mo/Ui;var _o;if(Mo<0){var ls=e;ls.x=ie,ls.y=Pe,ls.z=c_,_o=1}else if(Mo>1){var Ls=e;Ls.x=O_,Ls.y=fv,Ls.z=uv,_o=2}else{var Ys,Zs,B_;Ys=ie+zo*Mo,Zs=Pe+_s*Mo,B_=c_+vs*Mo;var Me=e;Me.x=Ys,Me.y=Zs,Me.z=B_,_o=3}var hs=e.x*e.x+e.y*e.y+e.z*e.z;if(Ht<0||hs<Ht){Z_=_o<<1,Ht=hs;var H_=e;Ln=H_.x,Rr=H_.y,Yn=H_.z}}if(U_<0){var $s,Un,pe,Xv,A_,$o,ln=Wi;$s=ln.x,Un=ln.y,pe=ln.z;var po=Tt;Xv=po.x,A_=po.y,$o=po.z;var Kt,$r,vo;Kt=Xv-$s,$r=A_-Un,vo=$o-pe;var js=Kt*Kt+$r*$r+vo*vo,ds=Kt*$s+$r*Un+vo*pe;ds=-ds/js;var qs;if(ds<0){var P_=e;P_.x=$s,P_.y=Un,P_.z=pe,qs=1}else if(ds>1){var jo=e;jo.x=Xv,jo.y=A_,jo.z=$o,qs=2}else{var re,K_,xv;re=$s+Kt*ds,K_=Un+$r*ds,xv=pe+vo*ds;var di=e;di.x=re,di.y=K_,di.z=xv,qs=3}var mo=e.x*e.x+e.y*e.y+e.z*e.z;if(Ht<0||mo<Ht){Z_=qs&1|(qs&2)<<1,Ht=mo;var Qr=e;Ln=Qr.x,Rr=Qr.y,Yn=Qr.z}}var io;if(Ht>0){var $_=e;$_.x=Ln,$_.y=Rr,$_.z=Yn,io=Z_}else{var j_=Yo*Yo+Hr*Hr+Eo*Eo;j_>0&&(j_=1/Math.sqrt(j_)),Yo*=j_,Hr*=j_,Eo*=j_;var Lv=Ti*Yo+Lo*Hr+Tr*Eo,a_=Yo*Yo+Hr*Hr+Eo*Eo;a_=Lv/a_,Ln=Yo*a_,Rr=Hr*a_,Yn=Eo*a_;var Yv=e;Yv.x=Ln,Yv.y=Rr,Yv.z=Yn,io=7}var q_=e.x*e.x+e.y*e.y+e.z*e.z;if(on<0||q_<on){k_=io&1|(io&6)<<1,on=q_;var Bi=e;Tn=Bi.x,Kn=Bi.y,we=Bi.z}}if(Wr*gn<0){var av,Bs,As,cs,bs,Ps,Zv,me,jr,t_,yo,i_,Fo,Ss,qo,ye,si,an,_r=Wi;av=_r.x,Bs=_r.y,As=_r.z;var oe=Lt;cs=oe.x,bs=oe.y,Ps=oe.z;var ge=Tt;Zv=ge.x,me=ge.y,jr=ge.z,t_=cs-av,yo=bs-Bs,i_=Ps-As,Fo=Zv-cs,Ss=me-bs,qo=jr-Ps,ye=av-Zv,si=Bs-me,an=As-jr;var Bo,Er,dn;Bo=yo*qo-i_*Ss,Er=i_*Fo-t_*qo,dn=t_*Ss-yo*Fo;var tv,r_,S_,iv,ne,Bn,Ie,E0,M0;tv=yo*dn-i_*Er,r_=i_*Bo-t_*dn,S_=t_*Er-yo*Bo,iv=Ss*dn-qo*Er,ne=qo*Bo-Fo*dn,Bn=Fo*Er-Ss*Bo,Ie=si*dn-an*Er,E0=an*Bo-ye*dn,M0=ye*Er-si*Bo;var hl=av*tv+Bs*r_+As*S_,D0=cs*iv+bs*ne+Ps*Bn,hr=Zv*Ie+me*E0+jr*M0,On=-1,go,fs,rv,zv=0;if(go=0,fs=0,rv=0,hl<0){var o_,dv,Cs,f_,u_,Ai,Ts=Wi;o_=Ts.x,dv=Ts.y,Cs=Ts.z;var lo=Lt;f_=lo.x,u_=lo.y,Ai=lo.z;var Se,Mv,Rs;Se=f_-o_,Mv=u_-dv,Rs=Ai-Cs;var x_=Se*Se+Mv*Mv+Rs*Rs,ov=Se*o_+Mv*dv+Rs*Cs;ov=-ov/x_;var r0;if(ov<0){var o0=e;o0.x=o_,o0.y=dv,o0.z=Cs,r0=1}else if(ov>1){var nv=e;nv.x=f_,nv.y=u_,nv.z=Ai,r0=2}else{var tr,Ke,An;tr=o_+Se*ov,Ke=dv+Mv*ov,An=Cs+Rs*ov;var us=e;us.x=tr,us.y=Ke,us.z=An,r0=3}var F0=e.x*e.x+e.y*e.y+e.z*e.z;zv=r0,On=F0;var Dv=e;go=Dv.x,fs=Dv.y,rv=Dv.z}if(D0<0){var C_,p0,Bv,n0,m0,N0,e0=Lt;C_=e0.x,p0=e0.y,Bv=e0.z;var s0=Tt;n0=s0.x,m0=s0.y,N0=s0.z;var y0,Fv,cr;y0=n0-C_,Fv=m0-p0,cr=N0-Bv;var pv=y0*y0+Fv*Fv+cr*cr,hn=y0*C_+Fv*p0+cr*Bv;hn=-hn/pv;var Nv;if(hn<0){var Hl=e;Hl.x=C_,Hl.y=p0,Hl.z=Bv,Nv=1}else if(hn>1){var g0=e;g0.x=n0,g0.y=m0,g0.z=N0,Nv=2}else{var I0,cl,dl;I0=C_+y0*hn,cl=p0+Fv*hn,dl=Bv+cr*hn;var Jv=e;Jv.x=I0,Jv.y=cl,Jv.z=dl,Nv=3}var Kl=e.x*e.x+e.y*e.y+e.z*e.z;if(On<0||Kl<On){zv=Nv<<1,On=Kl;var $l=e;go=$l.x,fs=$l.y,rv=$l.z}}if(hr<0){var bl,Bl,Al,jl,fl,ql,ul=Wi;bl=ul.x,Bl=ul.y,Al=ul.z;var rr=Tt;jl=rr.x,fl=rr.y,ql=rr.z;var xs,tn,mv;xs=jl-bl,tn=fl-Bl,mv=ql-Al;var yh=xs*xs+tn*tn+mv*mv,Gv=xs*bl+tn*Bl+mv*Al;Gv=-Gv/yh;var J0;if(Gv<0){var xl=e;xl.x=bl,xl.y=Bl,xl.z=Al,J0=1}else if(Gv>1){var V0=e;V0.x=jl,V0.y=fl,V0.z=ql,J0=2}else{var k0,G0,Mr;k0=bl+xs*Gv,G0=Bl+tn*Gv,Mr=Al+mv*Gv;var zs=e;zs.x=k0,zs.y=G0,zs.z=Mr,J0=3}var ee=e.x*e.x+e.y*e.y+e.z*e.z;if(On<0||ee<On){zv=J0&1|(J0&2)<<1,On=ee;var _0=e;go=_0.x,fs=_0.y,rv=_0.z}}var Pl;if(On>0){var lh=e;lh.x=go,lh.y=fs,lh.z=rv,Pl=zv}else{var W0=Bo*Bo+Er*Er+dn*dn;W0>0&&(W0=1/Math.sqrt(W0)),Bo*=W0,Er*=W0,dn*=W0;var hh=av*Bo+Bs*Er+As*dn,U0=Bo*Bo+Er*Er+dn*dn;U0=hh/U0,go=Bo*U0,fs=Er*U0,rv=dn*U0;var Sl=e;Sl.x=go,Sl.y=fs,Sl.z=rv,Pl=7}var zl=e.x*e.x+e.y*e.y+e.z*e.z;if(on<0||zl<on){k_=Pl&3|(Pl&4)<<1,on=zl;var Ce=e;Tn=Ce.x,Kn=Ce.y,we=Ce.z}}if(ke*gn<0){var w0,z_,Cl,O0,H0,Tl,Ml,X0,v0,M_,Wv,Uv,ev,L0,Av,l0,se,h0,Y0=Lt;w0=Y0.x,z_=Y0.y,Cl=Y0.z;var Qs=jt;O0=Qs.x,H0=Qs.y,Tl=Qs.z;var K0=Tt;Ml=K0.x,X0=K0.y,v0=K0.z,M_=O0-w0,Wv=H0-z_,Uv=Tl-Cl,ev=Ml-O0,L0=X0-H0,Av=v0-Tl,l0=w0-Ml,se=z_-X0,h0=Cl-v0;var yi,cn,wr;yi=Wv*Av-Uv*L0,cn=Uv*ev-M_*Av,wr=M_*L0-Wv*ev;var Ov,c0,ch,ah,p_,$e,Es,th,bh;Ov=Wv*wr-Uv*cn,c0=Uv*yi-M_*wr,ch=M_*cn-Wv*yi,ah=L0*wr-Av*cn,p_=Av*yi-ev*wr,$e=ev*cn-L0*yi,Es=se*wr-h0*cn,th=h0*yi-l0*wr,bh=l0*cn-se*yi;var Rl=w0*Ov+z_*c0+Cl*ch,br=O0*ah+H0*p_+Tl*$e,n_=Ml*Es+X0*th+v0*bh,bn=-1,yv,$0,gv,pl=0;if(yv=0,$0=0,gv=0,Rl<0){var ml,yl,T_,Pv,Pn,Iv,Sv=Lt;ml=Sv.x,yl=Sv.y,T_=Sv.z;var R_=jt;Pv=R_.x,Pn=R_.y,Iv=R_.z;var _e,Q_,Cv;_e=Pv-ml,Q_=Pn-yl,Cv=Iv-T_;var Hv=_e*_e+Q_*Q_+Cv*Cv,or=_e*ml+Q_*yl+Cv*T_;or=-or/Hv;var m_;if(or<0){var ve=e;ve.x=ml,ve.y=yl,ve.z=T_,m_=1}else if(or>1){var Gi=e;Gi.x=Pv,Gi.y=Pn,Gi.z=Iv,m_=2}else{var y_,Sn,j0;y_=ml+_e*or,Sn=yl+Q_*or,j0=T_+Cv*or;var b0=e;b0.x=y_,b0.y=Sn,b0.z=j0,m_=3}var fh=e.x*e.x+e.y*e.y+e.z*e.z;pl=m_,bn=fh;var q0=e;yv=q0.x,$0=q0.y,gv=q0.z}if(br<0){var al,gl,Z0,uh,Il,gh,ih=jt;al=ih.x,gl=ih.y,Z0=ih.z;var Vl=Tt;uh=Vl.x,Il=Vl.y,gh=Vl.z;var d0,B0,kl;d0=uh-al,B0=Il-gl,kl=gh-Z0;var rh=d0*d0+B0*B0+kl*kl,Kv=d0*al+B0*gl+kl*Z0;Kv=-Kv/rh;var Ql;if(Kv<0){var $v=e;$v.x=al,$v.y=gl,$v.z=Z0,Ql=1}else if(Kv>1){var nr=e;nr.x=uh,nr.y=Il,nr.z=gh,Ql=2}else{var g_,rn,wl;g_=al+d0*Kv,rn=gl+B0*Kv,wl=Z0+kl*Kv;var A0=e;A0.x=g_,A0.y=rn,A0.z=wl,Ql=3}var oh=e.x*e.x+e.y*e.y+e.z*e.z;if(bn<0||oh<bn){pl=Ql<<1,bn=oh;var El=e;yv=El.x,$0=El.y,gv=El.z}}if(n_<0){var tl,Dl,P0,nh,eh,Fl,Nl=Lt;tl=Nl.x,Dl=Nl.y,P0=Nl.z;var sv=Tt;nh=sv.x,eh=sv.y,Fl=sv.z;var Tv,jv,Ds;Tv=nh-tl,jv=eh-Dl,Ds=Fl-P0;var xh=Tv*Tv+jv*jv+Ds*Ds,f0=Tv*tl+jv*Dl+Ds*P0;f0=-f0/xh;var Xl;if(f0<0){var Rv=e;Rv.x=tl,Rv.y=Dl,Rv.z=P0,Xl=1}else if(f0>1){var qv=e;qv.x=nh,qv.y=eh,qv.z=Fl,Xl=2}else{var Qv,u0,Zh;Qv=tl+Tv*f0,u0=Dl+jv*f0,Zh=P0+Ds*f0;var S0=e;S0.x=Qv,S0.y=u0,S0.z=Zh,Xl=3}var a0=e.x*e.x+e.y*e.y+e.z*e.z;if(bn<0||a0<bn){pl=Xl&1|(Xl&2)<<1,bn=a0;var Jl=e;yv=Jl.x,$0=Jl.y,gv=Jl.z}}var Gl;if(bn>0){var zh=e;zh.x=yv,zh.y=$0,zh.z=gv,Gl=pl}else{var Ev=yi*yi+cn*cn+wr*wr;Ev>0&&(Ev=1/Math.sqrt(Ev)),yi*=Ev,cn*=Ev,wr*=Ev;var xr=w0*yi+z_*cn+Cl*wr,Ve=yi*yi+cn*cn+wr*wr;Ve=xr/Ve,yv=yi*Ve,$0=cn*Ve,gv=wr*Ve;var le=e;le.x=yv,le.y=$0,le.z=gv,Gl=7}var C0=e.x*e.x+e.y*e.y+e.z*e.z;if(on<0||C0<on){k_=Gl<<1,on=C0;var Wl=e;Tn=Wl.x,Kn=Wl.y,we=Wl.z}}if(on>0){var Fs=e;Fs.x=Tn,Fs.y=Kn,Fs.z=we,g=k_}else e.zero(),g=15;break}if(e.x*e.x+e.y*e.y+e.z*e.z<m){if(!s)return this.distance=0,0;switch(this.simplexSize){case 1:this.pointToTetrahedron();break;case 2:this.lineToTetrahedron();break;case 3:this.triangleToTetrahedron();break}if(this.simplexSize==4){var x0=this.computeDepth(a,t,i,r,_,h,v);return x0!=0?(this.distance=0,x0):(this.distance=-this.depth,0)}return this.distance=0,1}this.shrinkSimplex(g),l.x=e.x,l.y=e.y,l.z=e.z;var Ll=l,Ul=-Ll.x,Ol=-Ll.y,Ih=-Ll.z;Ll.x=Ul,Ll.y=Ol,Ll.z=Ih,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var _v=this.s[this.simplexSize],vv=this.w1[this.simplexSize];_v.x=vv.x,_v.y=vv.y,_v.z=vv.z;var T0=_v,I_=this.w2[this.simplexSize],Yl=T0.x-I_.x,Vh=T0.y-I_.y,dh=T0.z-I_.z;if(T0.x=Yl,T0.y=Vh,T0.z=dh,l.x*l.x+l.y*l.y+l.z*l.z<m)throw new Error("!?");var t0=e.x*l.x+e.y*l.y+e.z*l.z,lv=_[this.simplexSize],kh=lv.x*l.x+lv.y*l.y+lv.z*l.z;if(kh-t0<m)return this.interpolateClosestPoints(),this.distance=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),o!=null&&o._gjkCache!=null&&this.saveCache(o._gjkCache),0;this.simplexSize++,++k}return 2}convexCastImpl(a,t,i,r,o,s,_){this.c1=a,this.c2=t,this.tf1=i,this.tf2=r;var h=this.s;this.w1,this.w2;var v=this.closest,e=this.dir,l,u,b;l=r._positionX-i._positionX,u=r._positionY-i._positionY,b=r._positionZ-i._positionZ;var f=e;if(f.x=l,f.y=u,f.z=b,e.x*e.x+e.y*e.y+e.z*e.z<1e-6&&e.init(1,0,0),this.simplexSize=0,this.c1!=null)this.computeWitnessPoint1(!0);else{var n=this.w1[this.simplexSize];n.x=this.tf1._positionX,n.y=this.tf1._positionY,n.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);var c=this.s[this.simplexSize],z=this.w1[this.simplexSize];c.x=z.x,c.y=z.y,c.z=z.z;var p=c,y=this.w2[this.simplexSize],V=p.x-y.x,M=p.y-y.y,I=p.z-y.z;p.x=V,p.y=M,p.z=I,this.simplexSize=1;var k=0,X=40,L=0,m=this.rayX,g=this.rayR;m.zero(),g.x=s.x,g.y=s.y,g.z=s.z;var N=g,A=N.x-o.x,F=N.y-o.y,P=N.z-o.z;N.x=A,N.y=F,N.z=P;for(var Y=1e-4,R=Y*Y;k<X;){var C=0;switch(this.simplexSize){case 1:var d=h[0];v.x=d.x,v.y=d.y,v.z=d.z,C=1;break;case 2:var Z,$,K,E,J,B,Q=h[0];Z=Q.x,$=Q.y,K=Q.z;var U=h[1];E=U.x,J=U.y,B=U.z;var G,D,H;G=E-Z,D=J-$,H=B-K;var j=G*G+D*D+H*H,ia=G*Z+D*$+H*K;if(ia=-ia/j,ia<0){var sa=v;sa.x=Z,sa.y=$,sa.z=K,C=1}else if(ia>1){var W=v;W.x=E,W.y=J,W.z=B,C=2}else{var q,na,oa;q=Z+G*ia,na=$+D*ia,oa=K+H*ia;var aa=v;aa.x=q,aa.y=na,aa.z=oa,C=3}break;case 3:var T=h[0],ca=h[1],_a=h[2],w,ta,ra,la,va,xa,za,Ma,Xa,Za,fa,ba,ea,ha,ma,ya,da,pa,Ya=T;w=Ya.x,ta=Ya.y,ra=Ya.z;var Qa=ca;la=Qa.x,va=Qa.y,xa=Qa.z;var ga=_a;za=ga.x,Ma=ga.y,Xa=ga.z,Za=la-w,fa=va-ta,ba=xa-ra,ea=za-la,ha=Ma-va,ma=Xa-xa,ya=w-za,da=ta-Ma,pa=ra-Xa;var ua,wa,ka;ua=fa*ma-ba*ha,wa=ba*ea-Za*ma,ka=Za*ha-fa*ea;var Sa,zt,Ha,Ba,nt,Ea,Fa,Aa,ft;Sa=fa*ka-ba*wa,zt=ba*ua-Za*ka,Ha=Za*wa-fa*ua,Ba=ha*ka-ma*wa,nt=ma*ua-ea*ka,Ea=ea*wa-ha*ua,Fa=da*ka-pa*wa,Aa=pa*ua-ya*ka,ft=ya*wa-da*ua;var Wa=w*Sa+ta*zt+ra*Ha,Ka=la*Ba+va*nt+xa*Ea,bt=za*Fa+Ma*Aa+Xa*ft,it=-1,$a,_t,gt,pt=0;if($a=0,_t=0,gt=0,Wa<0){var Ga,rt,ut,Da,Ta,Na,Vt=T;Ga=Vt.x,rt=Vt.y,ut=Vt.z;var St=ca;Da=St.x,Ta=St.y,Na=St.z;var et,Xt,Yt;et=Da-Ga,Xt=Ta-rt,Yt=Na-ut;var Mt=et*et+Xt*Xt+Yt*Yt,Ia=et*Ga+Xt*rt+Yt*ut;Ia=-Ia/Mt;var O;if(Ia<0){var Va=v;Va.x=Ga,Va.y=rt,Va.z=ut,O=1}else if(Ia>1){var lt=v;lt.x=Da,lt.y=Ta,lt.z=Na,O=2}else{var S,wt,Bt;S=Ga+et*Ia,wt=rt+Xt*Ia,Bt=ut+Yt*Ia;var At=v;At.x=S,At.y=wt,At.z=Bt,O=3}var yt=v.x*v.x+v.y*v.y+v.z*v.z;pt=O,it=yt;var kt=v;$a=kt.x,_t=kt.y,gt=kt.z}if(Ka<0){var mt,ht,xt,Ra,st,Ca,vt=ca;mt=vt.x,ht=vt.y,xt=vt.z;var qa=_a;Ra=qa.x,st=qa.y,Ca=qa.z;var at,Oa,tt;at=Ra-mt,Oa=st-ht,tt=Ca-xt;var ct=at*at+Oa*Oa+tt*tt,Pa=at*mt+Oa*ht+tt*xt;Pa=-Pa/ct;var Ja;if(Pa<0){var ja=v;ja.x=mt,ja.y=ht,ja.z=xt,Ja=1}else if(Pa>1){var La=v;La.x=Ra,La.y=st,La.z=Ca,Ja=2}else{var ot,It,oi;ot=mt+at*Pa,It=ht+Oa*Pa,oi=xt+tt*Pa;var gi=v;gi.x=ot,gi.y=It,gi.z=oi,Ja=3}var ai=v.x*v.x+v.y*v.y+v.z*v.z;if(it<0||ai<it){pt=Ja<<1,it=ai;var Ct=v;$a=Ct.x,_t=Ct.y,gt=Ct.z}}if(bt<0){var _i,Et,Pt,Jt,Ki,vi,li=T;_i=li.x,Et=li.y,Pt=li.z;var ti=_a;Jt=ti.x,Ki=ti.y,vi=ti.z;var Oi,Xi,zi;Oi=Jt-_i,Xi=Ki-Et,zi=vi-Pt;var Zt=Oi*Oi+Xi*Xi+zi*zi,ri=Oi*_i+Xi*Et+zi*Pt;ri=-ri/Zt;var Wt;if(ri<0){var ni=v;ni.x=_i,ni.y=Et,ni.z=Pt,Wt=1}else if(ri>1){var $i=v;$i.x=Jt,$i.y=Ki,$i.z=vi,Wt=2}else{var Ut,ji,Ii;Ut=_i+Oi*ri,ji=Et+Xi*ri,Ii=Pt+zi*ri;var pr=v;pr.x=Ut,pr.y=ji,pr.z=Ii,Wt=3}var Wi=v.x*v.x+v.y*v.y+v.z*v.z;if(it<0||Wi<it){pt=Wt&1|(Wt&2)<<1,it=Wi;var Lt=v;$a=Lt.x,_t=Lt.y,gt=Lt.z}}if(it>0){var jt=v;jt.x=$a,jt.y=_t,jt.z=gt,C=pt}else{var Tt=ua*ua+wa*wa+ka*ka;Tt>0&&(Tt=1/Math.sqrt(Tt)),ua*=Tt,wa*=Tt,ka*=Tt;var bi=w*ua+ta*wa+ra*ka,Mi=ua*ua+wa*wa+ka*ka;Mi=bi/Mi,$a=ua*Mi,_t=wa*Mi,gt=ka*Mi;var vr=v;vr.x=$a,vr.y=_t,vr.z=gt,C=7}break;case 4:var qt=h[0],fi=h[1],dt=h[2],ui=h[3],hi,er,Xr,ro,Gt,fr,mr,Dt,dr,Pi,Dr,Hn,oo,Br,no,yn,Ao,Io,xi,qr,Ar,yr,Po,Di,Pr,gr,Rt,Hi=qt;hi=Hi.x,er=Hi.y,Xr=Hi.z;var Li=fi;ro=Li.x,Gt=Li.y,fr=Li.z;var Cn=dt;mr=Cn.x,Dt=Cn.y,dr=Cn.z;var Ms=ui;Pi=Ms.x,Dr=Ms.y,Hn=Ms.z,oo=ro-hi,Br=Gt-er,no=fr-Xr,yn=mr-hi,Ao=Dt-er,Io=dr-Xr,xi=Pi-hi,qr=Dr-er,Ar=Hn-Xr,yr=mr-ro,Po=Dt-Gt,Di=dr-fr,Pr=Pi-ro,gr=Dr-Gt,Rt=Hn-fr;var je,ps,Te,qe,D_,gn,Si,No,Wr,ke,on,Tn;je=Br*Io-no*Ao,ps=no*yn-oo*Io,Te=oo*Ao-Br*yn,qe=Ao*Ar-Io*qr,D_=Io*xi-yn*Ar,gn=yn*qr-Ao*xi,Si=qr*no-Ar*Br,No=Ar*oo-xi*no,Wr=xi*Br-qr*oo,ke=gr*Di-Rt*Po,on=Rt*yr-Pr*Di,Tn=Pr*Po-gr*yr;var Kn=oo*ke+Br*on+no*Tn>0?1:-1,we=hi*je+er*ps+Xr*Te,k_=hi*qe+er*D_+Xr*gn,Re=hi*Si+er*No+Xr*Wr,Vi=ro*ke+Gt*on+fr*Tn,Ir=-1,ur,eo,Rn,ms=0;if(ur=0,eo=0,Rn=0,we*Kn<0){var nn,Qn,ci,ho,Fr,En,as,Qe,Ee,De,he,ii,ir,Qi,Fi,fo,So,s_,Fe=qt;nn=Fe.x,Qn=Fe.y,ci=Fe.z;var ts=fi;ho=ts.x,Fr=ts.y,En=ts.z;var Dn=dt;as=Dn.x,Qe=Dn.y,Ee=Dn.z,De=ho-nn,he=Fr-Qn,ii=En-ci,ir=as-ho,Qi=Qe-Fr,Fi=Ee-En,fo=nn-as,So=Qn-Qe,s_=ci-Ee;var co,Ft,Ni;co=he*Fi-ii*Qi,Ft=ii*ir-De*Fi,Ni=De*Qi-he*ir;var lr,Vo,ce,Xe,Le,uo,$t,Vr,sr;lr=he*Ni-ii*Ft,Vo=ii*co-De*Ni,ce=De*Ft-he*co,Xe=Qi*Ni-Fi*Ft,Le=Fi*co-ir*Ni,uo=ir*Ft-Qi*co,$t=So*Ni-s_*Ft,Vr=s_*co-fo*Ni,sr=fo*Ft-So*co;var Jo=nn*lr+Qn*Vo+ci*ce,Ns=ho*Xe+Fr*Le+En*uo,Co=as*$t+Qe*Vr+Ee*sr,ko=-1,Nr,Sr,Cr,Lr=0;if(Nr=0,Sr=0,Cr=0,Jo<0){var Qt,Ji,Yi,Ri,zr,qi,Jr=qt;Qt=Jr.x,Ji=Jr.y,Yi=Jr.z;var Gr=fi;Ri=Gr.x,zr=Gr.y,qi=Gr.z;var ao,be,ki;ao=Ri-Qt,be=zr-Ji,ki=qi-Yi;var en=ao*ao+be*be+ki*ki,Yr=ao*Qt+be*Ji+ki*Yi;Yr=-Yr/en;var Go;if(Yr<0){var ys=v;ys.x=Qt,ys.y=Ji,ys.z=Yi,Go=1}else if(Yr>1){var In=v;In.x=Ri,In.y=zr,In.z=qi,Go=2}else{var gs,Vn,Ci;gs=Qt+ao*Yr,Vn=Ji+be*Yr,Ci=Yi+ki*Yr;var To=v;To.x=gs,To.y=Vn,To.z=Ci,Go=3}var so=v.x*v.x+v.y*v.y+v.z*v.z;Lr=Go,ko=so;var Fn=v;Nr=Fn.x,Sr=Fn.y,Cr=Fn.z}if(Ns<0){var Ne,Nn,Wo,kn,Ye,Ot,Ro=fi;Ne=Ro.x,Nn=Ro.y,Wo=Ro.z;var Ur=dt;kn=Ur.x,Ye=Ur.y,Ot=Ur.z;var wn,Jn,fe;wn=kn-Ne,Jn=Ye-Nn,fe=Ot-Wo;var Is=wn*wn+Jn*Jn+fe*fe,Uo=wn*Ne+Jn*Nn+fe*Wo;Uo=-Uo/Is;var Vs;if(Uo<0){var w_=v;w_.x=Ne,w_.y=Nn,w_.z=Wo,Vs=1}else if(Uo>1){var Js=v;Js.x=kn,Js.y=Ye,Js.z=Ot,Vs=2}else{var X_,Je,F_;X_=Ne+wn*Uo,Je=Nn+Jn*Uo,F_=Wo+fe*Uo;var N_=v;N_.x=X_,N_.y=Je,N_.z=F_,Vs=3}var Or=v.x*v.x+v.y*v.y+v.z*v.z;if(ko<0||Or<ko){Lr=Vs<<1,ko=Or;var wo=v;Nr=wo.x,Sr=wo.y,Cr=wo.z}}if(Co<0){var Xo,Gn,wi,Wn,Qo,to,J_=qt;Xo=J_.x,Gn=J_.y,wi=J_.z;var G_=dt;Wn=G_.x,Qo=G_.y,to=G_.z;var L_,is,__;L_=Wn-Xo,is=Qo-Gn,__=to-wi;var v_=L_*L_+is*is+__*__,rs=L_*Xo+is*Gn+__*wi;rs=-rs/v_;var pi;if(rs<0){var Oo=v;Oo.x=Xo,Oo.y=Gn,Oo.z=wi,pi=1}else if(rs>1){var ar=v;ar.x=Wn,ar.y=Qo,ar.z=to,pi=2}else{var Ze,Gs,hv;Ze=Xo+L_*rs,Gs=Gn+is*rs,hv=wi+__*rs;var ue=v;ue.x=Ze,ue.y=Gs,ue.z=hv,pi=3}var Ge=v.x*v.x+v.y*v.y+v.z*v.z;if(ko<0||Ge<ko){Lr=pi&1|(pi&2)<<1,ko=Ge;var $n=v;Nr=$n.x,Sr=$n.y,Cr=$n.z}}var Ws;if(ko>0){var Ti=v;Ti.x=Nr,Ti.y=Sr,Ti.z=Cr,Ws=Lr}else{var Lo=co*co+Ft*Ft+Ni*Ni;Lo>0&&(Lo=1/Math.sqrt(Lo)),co*=Lo,Ft*=Lo,Ni*=Lo;var Tr=nn*co+Qn*Ft+ci*Ni,sn=co*co+Ft*Ft+Ni*Ni;sn=Tr/sn,Nr=co*sn,Sr=Ft*sn,Cr=Ni*sn;var ks=v;ks.x=Nr,ks.y=Sr,ks.z=Cr,Ws=7}var Y_=v.x*v.x+v.y*v.y+v.z*v.z;ms=Ws,Ir=Y_;var We=v;ur=We.x,eo=We.y,Rn=We.z}if(k_*Kn<0){var jn,Xn,os,de,ns,Us,l_,Be,Ae,qn,mi,xo,Zr,Ho,Yo,Hr,Eo,ws,ae=qt;jn=ae.x,Xn=ae.y,os=ae.z;var Os=dt;de=Os.x,ns=Os.y,Us=Os.z;var W_=ui;l_=W_.x,Be=W_.y,Ae=W_.z,qn=de-jn,mi=ns-Xn,xo=Us-os,Zr=l_-de,Ho=Be-ns,Yo=Ae-Us,Hr=jn-l_,Eo=Xn-Be,ws=os-Ae;var te,Nt,Kr;te=mi*Yo-xo*Ho,Nt=xo*Zr-qn*Yo,Kr=qn*Ho-mi*Zr;var Do,Xs,kv,i0,U_,Ht,Ln,Rr,Yn;Do=mi*Kr-xo*Nt,Xs=xo*te-qn*Kr,kv=qn*Nt-mi*te,i0=Ho*Kr-Yo*Nt,U_=Yo*te-Zr*Kr,Ht=Zr*Nt-Ho*te,Ln=Eo*Kr-ws*Nt,Rr=ws*te-Hr*Kr,Yn=Hr*Nt-Eo*te;var Z_=jn*Do+Xn*Xs+os*kv,Hs=de*i0+ns*U_+Us*Ht,h_=l_*Ln+Be*Rr+Ae*Yn,bo=-1,es,ss,xe,Zi=0;if(es=0,ss=0,xe=0,Z_<0){var Ko,kr,Zo,Ue,cv,ze,Ks=qt;Ko=Ks.x,kr=Ks.y,Zo=Ks.z;var wv=dt;Ue=wv.x,cv=wv.y,ze=wv.z;var Oe,ei,Zn;Oe=Ue-Ko,ei=cv-kr,Zn=ze-Zo;var _n=Oe*Oe+ei*ei+Zn*Zn,vn=Oe*Ko+ei*kr+Zn*Zo;vn=-vn/_n;var d_;if(vn<0){var bv=v;bv.x=Ko,bv.y=kr,bv.z=Zo,d_=1}else if(vn>1){var ie=v;ie.x=Ue,ie.y=cv,ie.z=ze,d_=2}else{var Pe,c_,O_;Pe=Ko+Oe*vn,c_=kr+ei*vn,O_=Zo+Zn*vn;var fv=v;fv.x=Pe,fv.y=c_,fv.z=O_,d_=3}var uv=v.x*v.x+v.y*v.y+v.z*v.z;Zi=d_,bo=uv;var b_=v;es=b_.x,ss=b_.y,xe=b_.z}if(Hs<0){var He,zo,_s,vs,Ui,Mo,_o=dt;He=_o.x,zo=_o.y,_s=_o.z;var ls=ui;vs=ls.x,Ui=ls.y,Mo=ls.z;var Ls,Ys,Zs;Ls=vs-He,Ys=Ui-zo,Zs=Mo-_s;var B_=Ls*Ls+Ys*Ys+Zs*Zs,Me=Ls*He+Ys*zo+Zs*_s;Me=-Me/B_;var hs;if(Me<0){var H_=v;H_.x=He,H_.y=zo,H_.z=_s,hs=1}else if(Me>1){var $s=v;$s.x=vs,$s.y=Ui,$s.z=Mo,hs=2}else{var Un,pe,Xv;Un=He+Ls*Me,pe=zo+Ys*Me,Xv=_s+Zs*Me;var A_=v;A_.x=Un,A_.y=pe,A_.z=Xv,hs=3}var $o=v.x*v.x+v.y*v.y+v.z*v.z;if(bo<0||$o<bo){Zi=hs<<1,bo=$o;var ln=v;es=ln.x,ss=ln.y,xe=ln.z}}if(h_<0){var po,Kt,$r,vo,js,ds,qs=qt;po=qs.x,Kt=qs.y,$r=qs.z;var P_=ui;vo=P_.x,js=P_.y,ds=P_.z;var jo,re,K_;jo=vo-po,re=js-Kt,K_=ds-$r;var xv=jo*jo+re*re+K_*K_,di=jo*po+re*Kt+K_*$r;di=-di/xv;var mo;if(di<0){var Qr=v;Qr.x=po,Qr.y=Kt,Qr.z=$r,mo=1}else if(di>1){var io=v;io.x=vo,io.y=js,io.z=ds,mo=2}else{var $_,j_,Lv;$_=po+jo*di,j_=Kt+re*di,Lv=$r+K_*di;var a_=v;a_.x=$_,a_.y=j_,a_.z=Lv,mo=3}var Yv=v.x*v.x+v.y*v.y+v.z*v.z;if(bo<0||Yv<bo){Zi=mo&1|(mo&2)<<1,bo=Yv;var q_=v;es=q_.x,ss=q_.y,xe=q_.z}}var Bi;if(bo>0){var av=v;av.x=es,av.y=ss,av.z=xe,Bi=Zi}else{var Bs=te*te+Nt*Nt+Kr*Kr;Bs>0&&(Bs=1/Math.sqrt(Bs)),te*=Bs,Nt*=Bs,Kr*=Bs;var As=jn*te+Xn*Nt+os*Kr,cs=te*te+Nt*Nt+Kr*Kr;cs=As/cs,es=te*cs,ss=Nt*cs,xe=Kr*cs;var bs=v;bs.x=es,bs.y=ss,bs.z=xe,Bi=7}var Ps=v.x*v.x+v.y*v.y+v.z*v.z;if(Ir<0||Ps<Ir){ms=Bi&1|(Bi&6)<<1,Ir=Ps;var Zv=v;ur=Zv.x,eo=Zv.y,Rn=Zv.z}}if(Re*Kn<0){var me,jr,t_,yo,i_,Fo,Ss,qo,ye,si,an,_r,oe,ge,Bo,Er,dn,tv,r_=qt;me=r_.x,jr=r_.y,t_=r_.z;var S_=fi;yo=S_.x,i_=S_.y,Fo=S_.z;var iv=ui;Ss=iv.x,qo=iv.y,ye=iv.z,si=yo-me,an=i_-jr,_r=Fo-t_,oe=Ss-yo,ge=qo-i_,Bo=ye-Fo,Er=me-Ss,dn=jr-qo,tv=t_-ye;var ne,Bn,Ie;ne=an*Bo-_r*ge,Bn=_r*oe-si*Bo,Ie=si*ge-an*oe;var E0,M0,hl,D0,hr,On,go,fs,rv;E0=an*Ie-_r*Bn,M0=_r*ne-si*Ie,hl=si*Bn-an*ne,D0=ge*Ie-Bo*Bn,hr=Bo*ne-oe*Ie,On=oe*Bn-ge*ne,go=dn*Ie-tv*Bn,fs=tv*ne-Er*Ie,rv=Er*Bn-dn*ne;var zv=me*E0+jr*M0+t_*hl,o_=yo*D0+i_*hr+Fo*On,dv=Ss*go+qo*fs+ye*rv,Cs=-1,f_,u_,Ai,Ts=0;if(f_=0,u_=0,Ai=0,zv<0){var lo,Se,Mv,Rs,x_,ov,r0=qt;lo=r0.x,Se=r0.y,Mv=r0.z;var o0=fi;Rs=o0.x,x_=o0.y,ov=o0.z;var nv,tr,Ke;nv=Rs-lo,tr=x_-Se,Ke=ov-Mv;var An=nv*nv+tr*tr+Ke*Ke,us=nv*lo+tr*Se+Ke*Mv;us=-us/An;var F0;if(us<0){var Dv=v;Dv.x=lo,Dv.y=Se,Dv.z=Mv,F0=1}else if(us>1){var C_=v;C_.x=Rs,C_.y=x_,C_.z=ov,F0=2}else{var p0,Bv,n0;p0=lo+nv*us,Bv=Se+tr*us,n0=Mv+Ke*us;var m0=v;m0.x=p0,m0.y=Bv,m0.z=n0,F0=3}var N0=v.x*v.x+v.y*v.y+v.z*v.z;Ts=F0,Cs=N0;var e0=v;f_=e0.x,u_=e0.y,Ai=e0.z}if(o_<0){var s0,y0,Fv,cr,pv,hn,Nv=fi;s0=Nv.x,y0=Nv.y,Fv=Nv.z;var Hl=ui;cr=Hl.x,pv=Hl.y,hn=Hl.z;var g0,I0,cl;g0=cr-s0,I0=pv-y0,cl=hn-Fv;var dl=g0*g0+I0*I0+cl*cl,Jv=g0*s0+I0*y0+cl*Fv;Jv=-Jv/dl;var Kl;if(Jv<0){var $l=v;$l.x=s0,$l.y=y0,$l.z=Fv,Kl=1}else if(Jv>1){var bl=v;bl.x=cr,bl.y=pv,bl.z=hn,Kl=2}else{var Bl,Al,jl;Bl=s0+g0*Jv,Al=y0+I0*Jv,jl=Fv+cl*Jv;var fl=v;fl.x=Bl,fl.y=Al,fl.z=jl,Kl=3}var ql=v.x*v.x+v.y*v.y+v.z*v.z;if(Cs<0||ql<Cs){Ts=Kl<<1,Cs=ql;var ul=v;f_=ul.x,u_=ul.y,Ai=ul.z}}if(dv<0){var rr,xs,tn,mv,yh,Gv,J0=qt;rr=J0.x,xs=J0.y,tn=J0.z;var xl=ui;mv=xl.x,yh=xl.y,Gv=xl.z;var V0,k0,G0;V0=mv-rr,k0=yh-xs,G0=Gv-tn;var Mr=V0*V0+k0*k0+G0*G0,zs=V0*rr+k0*xs+G0*tn;zs=-zs/Mr;var ee;if(zs<0){var _0=v;_0.x=rr,_0.y=xs,_0.z=tn,ee=1}else if(zs>1){var Pl=v;Pl.x=mv,Pl.y=yh,Pl.z=Gv,ee=2}else{var lh,W0,hh;lh=rr+V0*zs,W0=xs+k0*zs,hh=tn+G0*zs;var U0=v;U0.x=lh,U0.y=W0,U0.z=hh,ee=3}var Sl=v.x*v.x+v.y*v.y+v.z*v.z;if(Cs<0||Sl<Cs){Ts=ee&1|(ee&2)<<1,Cs=Sl;var zl=v;f_=zl.x,u_=zl.y,Ai=zl.z}}var Ce;if(Cs>0){var w0=v;w0.x=f_,w0.y=u_,w0.z=Ai,Ce=Ts}else{var z_=ne*ne+Bn*Bn+Ie*Ie;z_>0&&(z_=1/Math.sqrt(z_)),ne*=z_,Bn*=z_,Ie*=z_;var Cl=me*ne+jr*Bn+t_*Ie,O0=ne*ne+Bn*Bn+Ie*Ie;O0=Cl/O0,f_=ne*O0,u_=Bn*O0,Ai=Ie*O0;var H0=v;H0.x=f_,H0.y=u_,H0.z=Ai,Ce=7}var Tl=v.x*v.x+v.y*v.y+v.z*v.z;if(Ir<0||Tl<Ir){ms=Ce&3|(Ce&4)<<1,Ir=Tl;var Ml=v;ur=Ml.x,eo=Ml.y,Rn=Ml.z}}if(Vi*Kn<0){var X0,v0,M_,Wv,Uv,ev,L0,Av,l0,se,h0,Y0,Qs,K0,yi,cn,wr,Ov,c0=fi;X0=c0.x,v0=c0.y,M_=c0.z;var ch=dt;Wv=ch.x,Uv=ch.y,ev=ch.z;var ah=ui;L0=ah.x,Av=ah.y,l0=ah.z,se=Wv-X0,h0=Uv-v0,Y0=ev-M_,Qs=L0-Wv,K0=Av-Uv,yi=l0-ev,cn=X0-L0,wr=v0-Av,Ov=M_-l0;var p_,$e,Es;p_=h0*yi-Y0*K0,$e=Y0*Qs-se*yi,Es=se*K0-h0*Qs;var th,bh,Rl,br,n_,bn,yv,$0,gv;th=h0*Es-Y0*$e,bh=Y0*p_-se*Es,Rl=se*$e-h0*p_,br=K0*Es-yi*$e,n_=yi*p_-Qs*Es,bn=Qs*$e-K0*p_,yv=wr*Es-Ov*$e,$0=Ov*p_-cn*Es,gv=cn*$e-wr*p_;var pl=X0*th+v0*bh+M_*Rl,ml=Wv*br+Uv*n_+ev*bn,yl=L0*yv+Av*$0+l0*gv,T_=-1,Pv,Pn,Iv,Sv=0;if(Pv=0,Pn=0,Iv=0,pl<0){var R_,_e,Q_,Cv,Hv,or,m_=fi;R_=m_.x,_e=m_.y,Q_=m_.z;var ve=dt;Cv=ve.x,Hv=ve.y,or=ve.z;var Gi,y_,Sn;Gi=Cv-R_,y_=Hv-_e,Sn=or-Q_;var j0=Gi*Gi+y_*y_+Sn*Sn,b0=Gi*R_+y_*_e+Sn*Q_;b0=-b0/j0;var fh;if(b0<0){var q0=v;q0.x=R_,q0.y=_e,q0.z=Q_,fh=1}else if(b0>1){var al=v;al.x=Cv,al.y=Hv,al.z=or,fh=2}else{var gl,Z0,uh;gl=R_+Gi*b0,Z0=_e+y_*b0,uh=Q_+Sn*b0;var Il=v;Il.x=gl,Il.y=Z0,Il.z=uh,fh=3}var gh=v.x*v.x+v.y*v.y+v.z*v.z;Sv=fh,T_=gh;var ih=v;Pv=ih.x,Pn=ih.y,Iv=ih.z}if(ml<0){var Vl,d0,B0,kl,rh,Kv,Ql=dt;Vl=Ql.x,d0=Ql.y,B0=Ql.z;var $v=ui;kl=$v.x,rh=$v.y,Kv=$v.z;var nr,g_,rn;nr=kl-Vl,g_=rh-d0,rn=Kv-B0;var wl=nr*nr+g_*g_+rn*rn,A0=nr*Vl+g_*d0+rn*B0;A0=-A0/wl;var oh;if(A0<0){var El=v;El.x=Vl,El.y=d0,El.z=B0,oh=1}else if(A0>1){var tl=v;tl.x=kl,tl.y=rh,tl.z=Kv,oh=2}else{var Dl,P0,nh;Dl=Vl+nr*A0,P0=d0+g_*A0,nh=B0+rn*A0;var eh=v;eh.x=Dl,eh.y=P0,eh.z=nh,oh=3}var Fl=v.x*v.x+v.y*v.y+v.z*v.z;if(T_<0||Fl<T_){Sv=oh<<1,T_=Fl;var Nl=v;Pv=Nl.x,Pn=Nl.y,Iv=Nl.z}}if(yl<0){var sv,Tv,jv,Ds,xh,f0,Xl=fi;sv=Xl.x,Tv=Xl.y,jv=Xl.z;var Rv=ui;Ds=Rv.x,xh=Rv.y,f0=Rv.z;var qv,Qv,u0;qv=Ds-sv,Qv=xh-Tv,u0=f0-jv;var Zh=qv*qv+Qv*Qv+u0*u0,S0=qv*sv+Qv*Tv+u0*jv;S0=-S0/Zh;var a0;if(S0<0){var Jl=v;Jl.x=sv,Jl.y=Tv,Jl.z=jv,a0=1}else if(S0>1){var Gl=v;Gl.x=Ds,Gl.y=xh,Gl.z=f0,a0=2}else{var zh,Ev,xr;zh=sv+qv*S0,Ev=Tv+Qv*S0,xr=jv+u0*S0;var Ve=v;Ve.x=zh,Ve.y=Ev,Ve.z=xr,a0=3}var le=v.x*v.x+v.y*v.y+v.z*v.z;if(T_<0||le<T_){Sv=a0&1|(a0&2)<<1,T_=le;var C0=v;Pv=C0.x,Pn=C0.y,Iv=C0.z}}var Wl;if(T_>0){var Fs=v;Fs.x=Pv,Fs.y=Pn,Fs.z=Iv,Wl=Sv}else{var x0=p_*p_+$e*$e+Es*Es;x0>0&&(x0=1/Math.sqrt(x0)),p_*=x0,$e*=x0,Es*=x0;var Ll=X0*p_+v0*$e+M_*Es,Ul=p_*p_+$e*$e+Es*Es;Ul=Ll/Ul,Pv=p_*Ul,Pn=$e*Ul,Iv=Es*Ul;var Ol=v;Ol.x=Pv,Ol.y=Pn,Ol.z=Iv,Wl=7}var Ih=v.x*v.x+v.y*v.y+v.z*v.z;if(Ir<0||Ih<Ir){ms=Wl<<1,Ir=Ih;var _v=v;ur=_v.x,eo=_v.y,Rn=_v.z}}if(Ir>0){var vv=v;vv.x=ur,vv.y=eo,vv.z=Rn,C=ms}else v.zero(),C=15;break}if(this.shrinkSimplex(C),v.x*v.x+v.y*v.y+v.z*v.z<R){if(L==0||this.simplexSize==4)return _.fraction=L,!1;this.interpolateClosestPoints(),_.fraction=L;var T0=_.normal;T0.x=e.x,T0.y=e.y,T0.z=e.z;var I_=T0,Yl=Math.sqrt(I_.x*I_.x+I_.y*I_.y+I_.z*I_.z);Yl>0&&(Yl=1/Yl);var Vh=I_.x*Yl,dh=I_.y*Yl,t0=I_.z*Yl;I_.x=Vh,I_.y=dh,I_.z=t0;var lv=_.position,kh=this.closestPoint1;lv.x=kh.x,lv.y=kh.y,lv.z=kh.z;var Zl=lv,wh=Zl.x+o.x*L,Kh=Zl.y+o.y*L,sh=Zl.z+o.z*L;return Zl.x=wh,Zl.y=Kh,Zl.z=sh,!0}e.x=v.x,e.y=v.y,e.z=v.z;var Ei=e,e_=-Ei.x,V_=-Ei.y,_h=-Ei.z;if(Ei.x=e_,Ei.y=V_,Ei.z=_h,this.c1!=null)this.computeWitnessPoint1(!0);else{var Bh=this.w1[this.simplexSize];Bh.x=this.tf1._positionX,Bh.y=this.tf1._positionY,Bh.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);var Ah=this.s[this.simplexSize],Mh=this.w1[this.simplexSize];Ah.x=Mh.x,Ah.y=Mh.y,Ah.z=Mh.z;var Vv=Ah,Rh=this.w2[this.simplexSize],Qh=Vv.x-Rh.x,$h=Vv.y-Rh.y,jh=Vv.z-Rh.z;Vv.x=Qh,Vv.y=$h,Vv.z=jh;var ph=h[this.simplexSize],Ph=ph.x-m.x,il=ph.y-m.y,ic=ph.z-m.z;if(ph.x=Ph,ph.y=il,ph.z=ic,e.x*e.x+e.y*e.y+e.z*e.z<R)throw new Error("!?");var Xh=h[this.simplexSize],E_=e,Eh=Xh.x*E_.x+Xh.y*E_.y+Xh.z*E_.z;if(Eh<0){if(g.x*E_.x+g.y*E_.y+g.z*E_.z>=0)return!1;var mh=Eh/(g.x*E_.x+g.y*E_.y+g.z*E_.z);if(L+=mh,L>=1)return!1;var qh=m.x+g.x*mh,Lh=m.y+g.y*mh,ac=m.z+g.z*mh;m.x=qh,m.y=Lh,m.z=ac;for(var Sh=0,R0=this.simplexSize+1;Sh<R0;){var rc=Sh++,vh=h[rc],Yh=-mh,Dh=vh.x+g.x*Yh,Ch=vh.y+g.y*Yh,Q0=vh.z+g.z*Yh;vh.x=Dh,vh.y=Ch,vh.z=Q0}}for(var z0=!1,nc=0,ec=this.simplexSize;nc<ec;){var Fh=nc++,oc=h[Fh].x-h[this.simplexSize].x,tc=h[Fh].y-h[this.simplexSize].y,rl=h[Fh].z-h[this.simplexSize].z;if(oc*oc+tc*tc+rl*rl<R){z0=!0;break}}z0||this.simplexSize++,++k}return!1}interpolateClosestPoints(){switch(this.simplexSize){case 1:var a=this.closestPoint1,t=this.w1[0];a.x=t.x,a.y=t.y,a.z=t.z;var i=this.closestPoint2,r=this.w2[0];i.x=r.x,i.y=r.y,i.z=r.z;break;case 2:var o,s,_,h=this.closest;o=h.x,s=h.y,_=h.z;var v,e,l,u,b,f,n,c,z,p,y,V,M,I,k,X,L,m,g=this.s[0];v=g.x,e=g.y,l=g.z;var N=this.w1[0];u=N.x,b=N.y,f=N.z;var A=this.w2[0];n=A.x,c=A.y,z=A.z;var F=this.s[1];p=F.x,y=F.y,V=F.z;var P=this.w1[1];M=P.x,I=P.y,k=P.z;var Y=this.w2[1];X=Y.x,L=Y.y,m=Y.z;var R=this.s[2];R.x,R.y,R.z;var C=this.w1[2];C.x,C.y,C.z;var d=this.w2[2];d.x,d.y,d.z;var Z,$,K;Z=p-v,$=y-e,K=V-l;var E=Z*Z+$*$+K*K;E!=0&&(E=1/E);var J,B,Q;J=o-v,B=s-e,Q=_-l;var U=(J*Z+B*$+Q*K)*E,G,D,H,j,ia,sa,W,q,na;G=M-u,D=I-b,H=k-f,j=u+G*U,ia=b+D*U,sa=f+H*U,G=X-n,D=L-c,H=m-z,W=n+G*U,q=c+D*U,na=z+H*U;var oa=this.closestPoint1;oa.x=j,oa.y=ia,oa.z=sa;var aa=this.closestPoint2;aa.x=W,aa.y=q,aa.z=na;break;case 3:var T,ca,_a,w=this.closest;T=w.x,ca=w.y,_a=w.z;var ta,ra,la,va,xa,za,Ma,Xa,Za,fa,ba,ea,ha,ma,ya,da,pa,Ya,Qa,ga,ua,wa,ka,Sa,zt,Ha,Ba,nt=this.s[0];ta=nt.x,ra=nt.y,la=nt.z;var Ea=this.w1[0];va=Ea.x,xa=Ea.y,za=Ea.z;var Fa=this.w2[0];Ma=Fa.x,Xa=Fa.y,Za=Fa.z;var Aa=this.s[1];fa=Aa.x,ba=Aa.y,ea=Aa.z;var ft=this.w1[1];ha=ft.x,ma=ft.y,ya=ft.z;var Wa=this.w2[1];da=Wa.x,pa=Wa.y,Ya=Wa.z;var Ka=this.s[2];Qa=Ka.x,ga=Ka.y,ua=Ka.z;var bt=this.w1[2];wa=bt.x,ka=bt.y,Sa=bt.z;var it=this.w2[2];zt=it.x,Ha=it.y,Ba=it.z;var $a,_t,gt,pt,Ga,rt,ut,Da,Ta;$a=fa-ta,_t=ba-ra,gt=ea-la,pt=Qa-ta,Ga=ga-ra,rt=ua-la,ut=T-ta,Da=ca-ra,Ta=_a-la;var Na=$a*$a+_t*_t+gt*gt,Vt=$a*pt+_t*Ga+gt*rt,St=pt*pt+Ga*Ga+rt*rt,et=$a*ut+_t*Da+gt*Ta,Xt=pt*ut+Ga*Da+rt*Ta,Yt=Na*St-Vt*Vt;Yt!=0&&(Yt=1/Yt);var Mt=(et*St-Xt*Vt)*Yt,Ia=(-et*Vt+Xt*Na)*Yt,O,Va,lt,S,wt,Bt,At,yt,kt;O=ha-va,Va=ma-xa,lt=ya-za,S=va+O*Mt,wt=xa+Va*Mt,Bt=za+lt*Mt,O=wa-va,Va=ka-xa,lt=Sa-za,S+=O*Ia,wt+=Va*Ia,Bt+=lt*Ia,O=da-Ma,Va=pa-Xa,lt=Ya-Za,At=Ma+O*Mt,yt=Xa+Va*Mt,kt=Za+lt*Mt,O=zt-Ma,Va=Ha-Xa,lt=Ba-Za,At+=O*Ia,yt+=Va*Ia,kt+=lt*Ia;var mt=this.closestPoint1;mt.x=S,mt.y=wt,mt.z=Bt;var ht=this.closestPoint2;ht.x=At,ht.y=yt,ht.z=kt;break;default:throw new Error("!?")}}loadCache(a){var t=this.dir,i=a.prevClosestDir;t.x=i.x,t.y=i.y,t.z=i.z}saveCache(a){var t=a.prevClosestDir,i=this.closest;t.x=i.x,t.y=i.y,t.z=i.z;var r=t,o=-r.x,s=-r.y,_=-r.z;r.x=o,r.y=s,r.z=_}shrinkSimplex(a){switch(this.simplexSize=a,this.simplexSize=(this.simplexSize&5)+(this.simplexSize>>1&5),this.simplexSize=(this.simplexSize&3)+(this.simplexSize>>2&3),a){case 2:var t=this.s[0],i=this.s[1];t.x=i.x,t.y=i.y,t.z=i.z;var r=this.w1[0],o=this.w1[1];r.x=o.x,r.y=o.y,r.z=o.z;var s=this.w2[0],_=this.w2[1];s.x=_.x,s.y=_.y,s.z=_.z;break;case 4:var h=this.s[0],v=this.s[2];h.x=v.x,h.y=v.y,h.z=v.z;var e=this.w1[0],l=this.w1[2];e.x=l.x,e.y=l.y,e.z=l.z;var u=this.w2[0],b=this.w2[2];u.x=b.x,u.y=b.y,u.z=b.z;break;case 5:var f=this.s[1],n=this.s[2];f.x=n.x,f.y=n.y,f.z=n.z;var c=this.w1[1],z=this.w1[2];c.x=z.x,c.y=z.y,c.z=z.z;var p=this.w2[1],y=this.w2[2];p.x=y.x,p.y=y.y,p.z=y.z;break;case 6:var V=this.s[0],M=this.s[2];V.x=M.x,V.y=M.y,V.z=M.z;var I=this.w1[0],k=this.w1[2];I.x=k.x,I.y=k.y,I.z=k.z;var X=this.w2[0],L=this.w2[2];X.x=L.x,X.y=L.y,X.z=L.z;break;case 8:var m=this.s[0],g=this.s[3];m.x=g.x,m.y=g.y,m.z=g.z;var N=this.w1[0],A=this.w1[3];N.x=A.x,N.y=A.y,N.z=A.z;var F=this.w2[0],P=this.w2[3];F.x=P.x,F.y=P.y,F.z=P.z;break;case 9:var Y=this.s[1],R=this.s[3];Y.x=R.x,Y.y=R.y,Y.z=R.z;var C=this.w1[1],d=this.w1[3];C.x=d.x,C.y=d.y,C.z=d.z;var Z=this.w2[1],$=this.w2[3];Z.x=$.x,Z.y=$.y,Z.z=$.z;break;case 10:var K=this.s[0],E=this.s[3];K.x=E.x,K.y=E.y,K.z=E.z;var J=this.w1[0],B=this.w1[3];J.x=B.x,J.y=B.y,J.z=B.z;var Q=this.w2[0],U=this.w2[3];Q.x=U.x,Q.y=U.y,Q.z=U.z;break;case 11:var G=this.s[2],D=this.s[3];G.x=D.x,G.y=D.y,G.z=D.z;var H=this.w1[2],j=this.w1[3];H.x=j.x,H.y=j.y,H.z=j.z;var ia=this.w2[2],sa=this.w2[3];ia.x=sa.x,ia.y=sa.y,ia.z=sa.z;break;case 12:var W=this.s[0],q=this.s[2];W.x=q.x,W.y=q.y,W.z=q.z;var na=this.w1[0],oa=this.w1[2];na.x=oa.x,na.y=oa.y,na.z=oa.z;var aa=this.w2[0],T=this.w2[2];aa.x=T.x,aa.y=T.y,aa.z=T.z;var ca=this.s[1],_a=this.s[3];ca.x=_a.x,ca.y=_a.y,ca.z=_a.z;var w=this.w1[1],ta=this.w1[3];w.x=ta.x,w.y=ta.y,w.z=ta.z;var ra=this.w2[1],la=this.w2[3];ra.x=la.x,ra.y=la.y,ra.z=la.z;break;case 13:var va=this.s[1],xa=this.s[3];va.x=xa.x,va.y=xa.y,va.z=xa.z;var za=this.w1[1],Ma=this.w1[3];za.x=Ma.x,za.y=Ma.y,za.z=Ma.z;var Xa=this.w2[1],Za=this.w2[3];Xa.x=Za.x,Xa.y=Za.y,Xa.z=Za.z;break;case 14:var fa=this.s[0],ba=this.s[3];fa.x=ba.x,fa.y=ba.y,fa.z=ba.z;var ea=this.w1[0],ha=this.w1[3];ea.x=ha.x,ea.y=ha.y,ea.z=ha.z;var ma=this.w2[0],ya=this.w2[3];ma.x=ya.x,ma.y=ya.y,ma.z=ya.z;break}}computeWitnessPoint1(a){var t,i,r,o,s,_,h=this.dir;o=h.x,s=h.y,_=h.z;var v,e,l,u,b,f;u=this.tf1._rotation00*o+this.tf1._rotation10*s+this.tf1._rotation20*_,b=this.tf1._rotation01*o+this.tf1._rotation11*s+this.tf1._rotation21*_,f=this.tf1._rotation02*o+this.tf1._rotation12*s+this.tf1._rotation22*_,v=u,e=b,l=f;var n,c,z,p=this.dir;if(p.x=v,p.y=e,p.z=l,this.c1.computeLocalSupportingVertex(this.dir,this.w1[this.simplexSize]),a){var y=this.dir,V=Math.sqrt(y.x*y.x+y.y*y.y+y.z*y.z);V>0&&(V=1/V);var M=y.x*V,I=y.y*V,k=y.z*V;y.x=M,y.y=I,y.z=k;var X=this.w1[this.simplexSize],L=this.dir,m=this.c1._gjkMargin,g=X.x+L.x*m,N=X.y+L.y*m,A=X.z+L.z*m;X.x=g,X.y=N,X.z=A}var F=this.w1[this.simplexSize];t=F.x,i=F.y,r=F.z;var P,Y,R;P=this.tf1._rotation00*t+this.tf1._rotation01*i+this.tf1._rotation02*r,Y=this.tf1._rotation10*t+this.tf1._rotation11*i+this.tf1._rotation12*r,R=this.tf1._rotation20*t+this.tf1._rotation21*i+this.tf1._rotation22*r,n=P,c=Y,z=R,n+=this.tf1._positionX,c+=this.tf1._positionY,z+=this.tf1._positionZ;var C=this.w1[this.simplexSize];C.x=n,C.y=c,C.z=z;var d=this.dir;d.x=o,d.y=s,d.z=_}computeWitnessPoint2(a){var t,i,r,o,s,_,h=this.dir;o=h.x,s=h.y,_=h.z;var v,e,l,u,b,f;u=this.tf2._rotation00*o+this.tf2._rotation10*s+this.tf2._rotation20*_,b=this.tf2._rotation01*o+this.tf2._rotation11*s+this.tf2._rotation21*_,f=this.tf2._rotation02*o+this.tf2._rotation12*s+this.tf2._rotation22*_,v=u,e=b,l=f,v=-v,e=-e,l=-l;var n,c,z,p=this.dir;if(p.x=v,p.y=e,p.z=l,this.c2.computeLocalSupportingVertex(this.dir,this.w2[this.simplexSize]),a){var y=this.dir,V=Math.sqrt(y.x*y.x+y.y*y.y+y.z*y.z);V>0&&(V=1/V);var M=y.x*V,I=y.y*V,k=y.z*V;y.x=M,y.y=I,y.z=k;var X=this.w2[this.simplexSize],L=this.dir,m=this.c2._gjkMargin,g=X.x+L.x*m,N=X.y+L.y*m,A=X.z+L.z*m;X.x=g,X.y=N,X.z=A}var F=this.w2[this.simplexSize];t=F.x,i=F.y,r=F.z;var P,Y,R;P=this.tf2._rotation00*t+this.tf2._rotation01*i+this.tf2._rotation02*r,Y=this.tf2._rotation10*t+this.tf2._rotation11*i+this.tf2._rotation12*r,R=this.tf2._rotation20*t+this.tf2._rotation21*i+this.tf2._rotation22*r,n=P,c=Y,z=R,n+=this.tf2._positionX,c+=this.tf2._positionY,z+=this.tf2._positionZ;var C=this.w2[this.simplexSize];C.x=n,C.y=c,C.z=z;var d=this.dir;d.x=o,d.y=s,d.z=_}pointToTetrahedron(){for(var a=0;a<3;){var t=a++,i=this.dir,r=this.baseDirs[t];i.x=r.x,i.y=r.y,i.z=r.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var o=this.s[this.simplexSize],s=this.w1[this.simplexSize];o.x=s.x,o.y=s.y,o.z=s.z;var _=o,h=this.w2[this.simplexSize],v=_.x-h.x,e=_.y-h.y,l=_.z-h.z;if(_.x=v,_.y=e,_.z=l,this.simplexSize++,this.lineToTetrahedron(),this.simplexSize==4)break;this.simplexSize--;var u=this.dir,b=-u.x,f=-u.y,n=-u.z;u.x=b,u.y=f,u.z=n,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var c=this.s[this.simplexSize],z=this.w1[this.simplexSize];c.x=z.x,c.y=z.y,c.z=z.z;var p=c,y=this.w2[this.simplexSize],V=p.x-y.x,M=p.y-y.y,I=p.z-y.z;if(p.x=V,p.y=M,p.z=I,this.simplexSize++,this.lineToTetrahedron(),this.simplexSize==4)break;this.simplexSize--}}lineToTetrahedron(){var a,t,i,r=this.dir;a=r.x,t=r.y,i=r.z;var o,s,_,h,v,e,l,u,b,f=this.s[0];o=f.x,s=f.y,_=f.z;var n=this.s[1];h=n.x,v=n.y,e=n.z,l=o-h,u=s-v,b=_-e;for(var c=0;c<3;){var z=c++,p,y,V,M=this.baseDirs[z];p=M.x,y=M.y,V=M.z;var I,k,X;I=u*V-b*y,k=b*p-l*V,X=l*y-u*p;var L=this.dir;L.x=I,L.y=k,L.z=X,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var m=this.s[this.simplexSize],g=this.w1[this.simplexSize];m.x=g.x,m.y=g.y,m.z=g.z;var N=m,A=this.w2[this.simplexSize],F=N.x-A.x,P=N.y-A.y,Y=N.z-A.z;if(N.x=F,N.y=P,N.z=Y,this.simplexSize++,this.triangleToTetrahedron(),this.simplexSize==4)break;this.simplexSize--;var R=this.dir,C=-R.x,d=-R.y,Z=-R.z;R.x=C,R.y=d,R.z=Z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var $=this.s[this.simplexSize],K=this.w1[this.simplexSize];$.x=K.x,$.y=K.y,$.z=K.z;var E=$,J=this.w2[this.simplexSize],B=E.x-J.x,Q=E.y-J.y,U=E.z-J.z;if(E.x=B,E.y=Q,E.z=U,this.simplexSize++,this.triangleToTetrahedron(),this.simplexSize==4)break;this.simplexSize--}var G=this.dir;G.x=a,G.y=t,G.z=i}triangleToTetrahedron(){var a,t,i,r=this.dir;for(a=r.x,t=r.y,i=r.z;;){var o,s,_,h,v,e,l,u,b,f,n,c,z,p,y,V=this.s[0];o=V.x,s=V.y,_=V.z;var M=this.s[1];h=M.x,v=M.y,e=M.z;var I=this.s[2];l=I.x,u=I.y,b=I.z,f=h-o,n=v-s,c=e-_,z=l-o,p=u-s,y=b-_;var k,X,L;k=n*y-c*p,X=c*z-f*y,L=f*p-n*z;var m=this.dir;m.x=k,m.y=X,m.z=L,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var g=this.s[this.simplexSize],N=this.w1[this.simplexSize];g.x=N.x,g.y=N.y,g.z=N.z;var A=g,F=this.w2[this.simplexSize],P=A.x-F.x,Y=A.y-F.y,R=A.z-F.z;if(A.x=P,A.y=Y,A.z=R,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;var C=this.dir,d=-C.x,Z=-C.y,$=-C.z;C.x=d,C.y=Z,C.z=$,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var K=this.s[this.simplexSize],E=this.w1[this.simplexSize];K.x=E.x,K.y=E.y,K.z=E.z;var J=K,B=this.w2[this.simplexSize],Q=J.x-B.x,U=J.y-B.y,G=J.z-B.z;if(J.x=Q,J.y=U,J.z=G,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;break}var D=this.dir;D.x=a,D.y=t,D.z=i}isValidTetrahedron(){var a=this.s[1].x-this.s[0].x,t=this.s[1].y-this.s[0].y,i=this.s[1].z-this.s[0].z,r=this.s[2].x-this.s[0].x,o=this.s[2].y-this.s[0].y,s=this.s[2].z-this.s[0].z,_=this.s[3].x-this.s[0].x,h=this.s[3].y-this.s[0].y,v=this.s[3].z-this.s[0].z,e=a*(o*v-s*h)-t*(r*v-s*_)+i*(r*h-o*_);return e>1e-12?!0:e<-1e-12}computeDepth(a,t,i,r,o,s,_){for(var h=this.polyhedron;h._numTriangles>0;){var v=h._triangleList;h._numTriangles--;var e=v._prev,l=v._next;e!=null&&(e._next=l),l!=null&&(l._prev=e),v==h._triangleList&&(h._triangleList=h._triangleList._next),v==h._triangleListLast&&(h._triangleListLast=h._triangleListLast._prev),v._next=null,v._prev=null,v.removeReferences(),v._next=h._trianglePool,h._trianglePool=v}for(;h._numVertices>0;){var u=h._vertices[--h._numVertices];u.removeReferences(),u._next=h._vertexPool,h._vertexPool=u}var b=this.polyhedron,f=this.polyhedron,n=f._vertexPool;n!=null?(f._vertexPool=n._next,n._next=null):n=new x.collision.narrowphase.detector.gjkepa.EpaVertex;var c=n.init(o[0],s[0],_[0]),z=this.polyhedron,p=z._vertexPool;p!=null?(z._vertexPool=p._next,p._next=null):p=new x.collision.narrowphase.detector.gjkepa.EpaVertex;var y=p.init(o[1],s[1],_[1]),V=this.polyhedron,M=V._vertexPool;M!=null?(V._vertexPool=M._next,M._next=null):M=new x.collision.narrowphase.detector.gjkepa.EpaVertex;var I=M.init(o[2],s[2],_[2]),k=this.polyhedron,X=k._vertexPool;if(X!=null?(k._vertexPool=X._next,X._next=null):X=new x.collision.narrowphase.detector.gjkepa.EpaVertex,!b._init(c,y,I,X.init(o[3],s[3],_[3])))return x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT;this.simplexSize=0;for(var L=this.s[0],m=this.w1[0],g=this.w2[0],N=0,A=40;N<A;){for(var F=this.polyhedron._triangleList,P=1/0,Y=null;F!=null;){var R=F._next;F._distanceSq<P&&(P=F._distanceSq,Y=F),F=R}var C=Y,d=this.dir,Z=C._normal;d.x=Z.x,d.y=Z.y,d.z=Z.z;var $=d,K=Math.sqrt($.x*$.x+$.y*$.y+$.z*$.z);K>0&&(K=1/K);var E=$.x*K,J=$.y*K,B=$.z*K;$.x=E,$.y=J,$.z=B,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var Q=this.s[this.simplexSize],U=this.w1[this.simplexSize];Q.x=U.x,Q.y=U.y,Q.z=U.z;var G=Q,D=this.w2[this.simplexSize],H=G.x-D.x,j=G.y-D.y,ia=G.z-D.z;G.x=H,G.y=j,G.z=ia;var sa=C._vertices[0],W=C._vertices[1],q=C._vertices[2],na=sa.v,oa=this.dir,aa=na.x*oa.x+na.y*oa.y+na.z*oa.z,T=this.dir,ca=L.x*T.x+L.y*T.y+L.z*T.z;if(ca-aa<1e-6||N==A-1){var _a=this.closest,w=this.dir;_a.x=w.x,_a.y=w.y,_a.z=w.z;var ta=_a,ra=this.dir,la=sa.v,va=this.dir,xa=(ra.x*la.x+ra.y*la.y+ra.z*la.z)/(va.x*va.x+va.y*va.y+va.z*va.z),za=ta.x*xa,Ma=ta.y*xa,Xa=ta.z*xa;ta.x=za,ta.y=Ma,ta.z=Xa;var Za,fa,ba,ea=this.closest;Za=ea.x,fa=ea.y,ba=ea.z;var ha,ma,ya,da,pa,Ya,Qa,ga,ua,wa,ka,Sa,zt,Ha,Ba,nt,Ea,Fa,Aa,ft,Wa,Ka,bt,it,$a,_t,gt,pt=sa.v;ha=pt.x,ma=pt.y,ya=pt.z;var Ga=sa.w1;da=Ga.x,pa=Ga.y,Ya=Ga.z;var rt=sa.w2;Qa=rt.x,ga=rt.y,ua=rt.z;var ut=W.v;wa=ut.x,ka=ut.y,Sa=ut.z;var Da=W.w1;zt=Da.x,Ha=Da.y,Ba=Da.z;var Ta=W.w2;nt=Ta.x,Ea=Ta.y,Fa=Ta.z;var Na=q.v;Aa=Na.x,ft=Na.y,Wa=Na.z;var Vt=q.w1;Ka=Vt.x,bt=Vt.y,it=Vt.z;var St=q.w2;$a=St.x,_t=St.y,gt=St.z;var et,Xt,Yt,Mt,Ia,O,Va,lt,S;et=wa-ha,Xt=ka-ma,Yt=Sa-ya,Mt=Aa-ha,Ia=ft-ma,O=Wa-ya,Va=Za-ha,lt=fa-ma,S=ba-ya;var wt=et*et+Xt*Xt+Yt*Yt,Bt=et*Mt+Xt*Ia+Yt*O,At=Mt*Mt+Ia*Ia+O*O,yt=et*Va+Xt*lt+Yt*S,kt=Mt*Va+Ia*lt+O*S,mt=wt*At-Bt*Bt;mt!=0&&(mt=1/mt);var ht=(yt*At-kt*Bt)*mt,xt=(-yt*Bt+kt*wt)*mt,Ra,st,Ca,vt,qa,at,Oa,tt,ct;Ra=zt-da,st=Ha-pa,Ca=Ba-Ya,vt=da+Ra*ht,qa=pa+st*ht,at=Ya+Ca*ht,Ra=Ka-da,st=bt-pa,Ca=it-Ya,vt+=Ra*xt,qa+=st*xt,at+=Ca*xt,Ra=nt-Qa,st=Ea-ga,Ca=Fa-ua,Oa=Qa+Ra*ht,tt=ga+st*ht,ct=ua+Ca*ht,Ra=$a-Qa,st=_t-ga,Ca=gt-ua,Oa+=Ra*xt,tt+=st*xt,ct+=Ca*xt;var Pa=this.closestPoint1;Pa.x=vt,Pa.y=qa,Pa.z=at;var Ja=this.closestPoint2;Ja.x=Oa,Ja.y=tt,Ja.z=ct;var ja=this.closest;return this.depth=Math.sqrt(ja.x*ja.x+ja.y*ja.y+ja.z*ja.z),x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED}var La=this.polyhedron,ot=La._vertexPool;ot!=null?(La._vertexPool=ot._next,ot._next=null):ot=new x.collision.narrowphase.detector.gjkepa.EpaVertex;var It=ot.init(L,m,g);if(!this.polyhedron._addVertex(It,C))return x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX;++N}return x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE}computeClosestPoints(a,t,i,r,o){return this.computeClosestPointsImpl(a,t,i,r,o,!0)}computeDistance(a,t,i,r,o){return this.computeClosestPointsImpl(a,t,i,r,o,!1)}convexCast(a,t,i,r,o,s,_){return this.convexCastImpl(a,t,i,r,o,s,_)}rayCast(a,t,i,r,o){var s=this.tempTransform,_=t,h=i;s._positionX=h.x,s._positionY=h.y,s._positionZ=h.z;var v=this.tl1,e=this.tl2;v.x=r.x,v.y=r.y,v.z=r.z;var l=v,u=l.x-i.x,b=l.y-i.y,f=l.z-i.z;return l.x=u,l.y=b,l.z=f,e.zero(),this.convexCastImpl(null,a,s,_,v,e,o)}static getInstance(){return x.collision.narrowphase.detector.gjkepa.GjkEpa.instance}};x.collision.narrowphase.detector.gjkepa.GjkEpaLog=class{};x.collision.narrowphase.detector.gjkepa.GjkEpaResultState=class{};x.collision.narrowphase.detector.gjkepa.SimplexUtil=class{static projectOrigin2(a,t,i){var r,o,s,_,h,v,e=a;r=e.x,o=e.y,s=e.z;var l=t;_=l.x,h=l.y,v=l.z;var u,b,f;u=_-r,b=h-o,f=v-s;var n=u*u+b*b+f*f,c=u*r+b*o+f*s;if(c=-c/n,c<0){var z=i;return z.x=r,z.y=o,z.z=s,1}if(c>1){var p=i;return p.x=_,p.y=h,p.z=v,2}var y,V,M;y=r+u*c,V=o+b*c,M=s+f*c;var I=i;return I.x=y,I.y=V,I.z=M,3}static projectOrigin3(a,t,i,r){var o,s,_,h,v,e,l,u,b,f,n,c,z,p,y,V,M,I,k=a;o=k.x,s=k.y,_=k.z;var X=t;h=X.x,v=X.y,e=X.z;var L=i;l=L.x,u=L.y,b=L.z,f=h-o,n=v-s,c=e-_,z=l-h,p=u-v,y=b-e,V=o-l,M=s-u,I=_-b;var m,g,N;m=n*y-c*p,g=c*z-f*y,N=f*p-n*z;var A,F,P,Y,R,C,d,Z,$;A=n*N-c*g,F=c*m-f*N,P=f*g-n*m,Y=p*N-y*g,R=y*m-z*N,C=z*g-p*m,d=M*N-I*g,Z=I*m-V*N,$=V*g-M*m;var K=o*A+s*F+_*P,E=h*Y+v*R+e*C,J=l*d+u*Z+b*$,B=-1,Q,U,G,D=0;if(Q=0,U=0,G=0,K<0){var H,j,ia,sa,W,q,na=a;H=na.x,j=na.y,ia=na.z;var oa=t;sa=oa.x,W=oa.y,q=oa.z;var aa,T,ca;aa=sa-H,T=W-j,ca=q-ia;var _a=aa*aa+T*T+ca*ca,w=aa*H+T*j+ca*ia;w=-w/_a;var ta;if(w<0){var ra=r;ra.x=H,ra.y=j,ra.z=ia,ta=1}else if(w>1){var la=r;la.x=sa,la.y=W,la.z=q,ta=2}else{var va,xa,za;va=H+aa*w,xa=j+T*w,za=ia+ca*w;var Ma=r;Ma.x=va,Ma.y=xa,Ma.z=za,ta=3}var Xa=r.x*r.x+r.y*r.y+r.z*r.z;D=ta,B=Xa;var Za=r;Q=Za.x,U=Za.y,G=Za.z}if(E<0){var fa,ba,ea,ha,ma,ya,da=t;fa=da.x,ba=da.y,ea=da.z;var pa=i;ha=pa.x,ma=pa.y,ya=pa.z;var Ya,Qa,ga;Ya=ha-fa,Qa=ma-ba,ga=ya-ea;var ua=Ya*Ya+Qa*Qa+ga*ga,wa=Ya*fa+Qa*ba+ga*ea;wa=-wa/ua;var ka;if(wa<0){var Sa=r;Sa.x=fa,Sa.y=ba,Sa.z=ea,ka=1}else if(wa>1){var zt=r;zt.x=ha,zt.y=ma,zt.z=ya,ka=2}else{var Ha,Ba,nt;Ha=fa+Ya*wa,Ba=ba+Qa*wa,nt=ea+ga*wa;var Ea=r;Ea.x=Ha,Ea.y=Ba,Ea.z=nt,ka=3}var Fa=r.x*r.x+r.y*r.y+r.z*r.z;if(B<0||Fa<B){D=ka<<1,B=Fa;var Aa=r;Q=Aa.x,U=Aa.y,G=Aa.z}}if(J<0){var ft,Wa,Ka,bt,it,$a,_t=a;ft=_t.x,Wa=_t.y,Ka=_t.z;var gt=i;bt=gt.x,it=gt.y,$a=gt.z;var pt,Ga,rt;pt=bt-ft,Ga=it-Wa,rt=$a-Ka;var ut=pt*pt+Ga*Ga+rt*rt,Da=pt*ft+Ga*Wa+rt*Ka;Da=-Da/ut;var Ta;if(Da<0){var Na=r;Na.x=ft,Na.y=Wa,Na.z=Ka,Ta=1}else if(Da>1){var Vt=r;Vt.x=bt,Vt.y=it,Vt.z=$a,Ta=2}else{var St,et,Xt;St=ft+pt*Da,et=Wa+Ga*Da,Xt=Ka+rt*Da;var Yt=r;Yt.x=St,Yt.y=et,Yt.z=Xt,Ta=3}var Mt=r.x*r.x+r.y*r.y+r.z*r.z;if(B<0||Mt<B){D=Ta&1|(Ta&2)<<1,B=Mt;var Ia=r;Q=Ia.x,U=Ia.y,G=Ia.z}}if(B>0){var O=r;return O.x=Q,O.y=U,O.z=G,D}var Va=m*m+g*g+N*N;Va>0&&(Va=1/Math.sqrt(Va)),m*=Va,g*=Va,N*=Va;var lt=o*m+s*g+_*N,S=m*m+g*g+N*N;S=lt/S,Q=m*S,U=g*S,G=N*S;var wt=r;return wt.x=Q,wt.y=U,wt.z=G,7}static projectOrigin4(a,t,i,r,o){var s,_,h,v,e,l,u,b,f,n,c,z,p,y,V,M,I,k,X,L,m,g,N,A,F,P,Y,R=a;s=R.x,_=R.y,h=R.z;var C=t;v=C.x,e=C.y,l=C.z;var d=i;u=d.x,b=d.y,f=d.z;var Z=r;n=Z.x,c=Z.y,z=Z.z,p=v-s,y=e-_,V=l-h,M=u-s,I=b-_,k=f-h,X=n-s,L=c-_,m=z-h,g=u-v,N=b-e,A=f-l,F=n-v,P=c-e,Y=z-l;var $,K,E,J,B,Q,U,G,D,H,j,ia;$=y*k-V*I,K=V*M-p*k,E=p*I-y*M,J=I*m-k*L,B=k*X-M*m,Q=M*L-I*X,U=L*V-m*y,G=m*p-X*V,D=X*y-L*p,H=P*A-Y*N,j=Y*g-F*A,ia=F*N-P*g;var sa=p*H+y*j+V*ia>0?1:-1,W=s*$+_*K+h*E,q=s*J+_*B+h*Q,na=s*U+_*G+h*D,oa=v*H+e*j+l*ia,aa=-1,T,ca,_a,w=0;if(T=0,ca=0,_a=0,W*sa<0){var ta,ra,la,va,xa,za,Ma,Xa,Za,fa,ba,ea,ha,ma,ya,da,pa,Ya,Qa=a;ta=Qa.x,ra=Qa.y,la=Qa.z;var ga=t;va=ga.x,xa=ga.y,za=ga.z;var ua=i;Ma=ua.x,Xa=ua.y,Za=ua.z,fa=va-ta,ba=xa-ra,ea=za-la,ha=Ma-va,ma=Xa-xa,ya=Za-za,da=ta-Ma,pa=ra-Xa,Ya=la-Za;var wa,ka,Sa;wa=ba*ya-ea*ma,ka=ea*ha-fa*ya,Sa=fa*ma-ba*ha;var zt,Ha,Ba,nt,Ea,Fa,Aa,ft,Wa;zt=ba*Sa-ea*ka,Ha=ea*wa-fa*Sa,Ba=fa*ka-ba*wa,nt=ma*Sa-ya*ka,Ea=ya*wa-ha*Sa,Fa=ha*ka-ma*wa,Aa=pa*Sa-Ya*ka,ft=Ya*wa-da*Sa,Wa=da*ka-pa*wa;var Ka=ta*zt+ra*Ha+la*Ba,bt=va*nt+xa*Ea+za*Fa,it=Ma*Aa+Xa*ft+Za*Wa,$a=-1,_t,gt,pt,Ga=0;if(_t=0,gt=0,pt=0,Ka<0){var rt,ut,Da,Ta,Na,Vt,St=a;rt=St.x,ut=St.y,Da=St.z;var et=t;Ta=et.x,Na=et.y,Vt=et.z;var Xt,Yt,Mt;Xt=Ta-rt,Yt=Na-ut,Mt=Vt-Da;var Ia=Xt*Xt+Yt*Yt+Mt*Mt,O=Xt*rt+Yt*ut+Mt*Da;O=-O/Ia;var Va;if(O<0){var lt=o;lt.x=rt,lt.y=ut,lt.z=Da,Va=1}else if(O>1){var S=o;S.x=Ta,S.y=Na,S.z=Vt,Va=2}else{var wt,Bt,At;wt=rt+Xt*O,Bt=ut+Yt*O,At=Da+Mt*O;var yt=o;yt.x=wt,yt.y=Bt,yt.z=At,Va=3}var kt=o.x*o.x+o.y*o.y+o.z*o.z;Ga=Va,$a=kt;var mt=o;_t=mt.x,gt=mt.y,pt=mt.z}if(bt<0){var ht,xt,Ra,st,Ca,vt,qa=t;ht=qa.x,xt=qa.y,Ra=qa.z;var at=i;st=at.x,Ca=at.y,vt=at.z;var Oa,tt,ct;Oa=st-ht,tt=Ca-xt,ct=vt-Ra;var Pa=Oa*Oa+tt*tt+ct*ct,Ja=Oa*ht+tt*xt+ct*Ra;Ja=-Ja/Pa;var ja;if(Ja<0){var La=o;La.x=ht,La.y=xt,La.z=Ra,ja=1}else if(Ja>1){var ot=o;ot.x=st,ot.y=Ca,ot.z=vt,ja=2}else{var It,oi,gi;It=ht+Oa*Ja,oi=xt+tt*Ja,gi=Ra+ct*Ja;var ai=o;ai.x=It,ai.y=oi,ai.z=gi,ja=3}var Ct=o.x*o.x+o.y*o.y+o.z*o.z;if($a<0||Ct<$a){Ga=ja<<1,$a=Ct;var _i=o;_t=_i.x,gt=_i.y,pt=_i.z}}if(it<0){var Et,Pt,Jt,Ki,vi,li,ti=a;Et=ti.x,Pt=ti.y,Jt=ti.z;var Oi=i;Ki=Oi.x,vi=Oi.y,li=Oi.z;var Xi,zi,Zt;Xi=Ki-Et,zi=vi-Pt,Zt=li-Jt;var ri=Xi*Xi+zi*zi+Zt*Zt,Wt=Xi*Et+zi*Pt+Zt*Jt;Wt=-Wt/ri;var ni;if(Wt<0){var $i=o;$i.x=Et,$i.y=Pt,$i.z=Jt,ni=1}else if(Wt>1){var Ut=o;Ut.x=Ki,Ut.y=vi,Ut.z=li,ni=2}else{var ji,Ii,pr;ji=Et+Xi*Wt,Ii=Pt+zi*Wt,pr=Jt+Zt*Wt;var Wi=o;Wi.x=ji,Wi.y=Ii,Wi.z=pr,ni=3}var Lt=o.x*o.x+o.y*o.y+o.z*o.z;if($a<0||Lt<$a){Ga=ni&1|(ni&2)<<1,$a=Lt;var jt=o;_t=jt.x,gt=jt.y,pt=jt.z}}var Tt;if($a>0){var bi=o;bi.x=_t,bi.y=gt,bi.z=pt,Tt=Ga}else{var Mi=wa*wa+ka*ka+Sa*Sa;Mi>0&&(Mi=1/Math.sqrt(Mi)),wa*=Mi,ka*=Mi,Sa*=Mi;var vr=ta*wa+ra*ka+la*Sa,qt=wa*wa+ka*ka+Sa*Sa;qt=vr/qt,_t=wa*qt,gt=ka*qt,pt=Sa*qt;var fi=o;fi.x=_t,fi.y=gt,fi.z=pt,Tt=7}var dt=o.x*o.x+o.y*o.y+o.z*o.z;w=Tt,aa=dt;var ui=o;T=ui.x,ca=ui.y,_a=ui.z}if(q*sa<0){var hi,er,Xr,ro,Gt,fr,mr,Dt,dr,Pi,Dr,Hn,oo,Br,no,yn,Ao,Io,xi=a;hi=xi.x,er=xi.y,Xr=xi.z;var qr=i;ro=qr.x,Gt=qr.y,fr=qr.z;var Ar=r;mr=Ar.x,Dt=Ar.y,dr=Ar.z,Pi=ro-hi,Dr=Gt-er,Hn=fr-Xr,oo=mr-ro,Br=Dt-Gt,no=dr-fr,yn=hi-mr,Ao=er-Dt,Io=Xr-dr;var yr,Po,Di;yr=Dr*no-Hn*Br,Po=Hn*oo-Pi*no,Di=Pi*Br-Dr*oo;var Pr,gr,Rt,Hi,Li,Cn,Ms,je,ps;Pr=Dr*Di-Hn*Po,gr=Hn*yr-Pi*Di,Rt=Pi*Po-Dr*yr,Hi=Br*Di-no*Po,Li=no*yr-oo*Di,Cn=oo*Po-Br*yr,Ms=Ao*Di-Io*Po,je=Io*yr-yn*Di,ps=yn*Po-Ao*yr;var Te=hi*Pr+er*gr+Xr*Rt,qe=ro*Hi+Gt*Li+fr*Cn,D_=mr*Ms+Dt*je+dr*ps,gn=-1,Si,No,Wr,ke=0;if(Si=0,No=0,Wr=0,Te<0){var on,Tn,Kn,we,k_,Re,Vi=a;on=Vi.x,Tn=Vi.y,Kn=Vi.z;var Ir=i;we=Ir.x,k_=Ir.y,Re=Ir.z;var ur,eo,Rn;ur=we-on,eo=k_-Tn,Rn=Re-Kn;var ms=ur*ur+eo*eo+Rn*Rn,nn=ur*on+eo*Tn+Rn*Kn;nn=-nn/ms;var Qn;if(nn<0){var ci=o;ci.x=on,ci.y=Tn,ci.z=Kn,Qn=1}else if(nn>1){var ho=o;ho.x=we,ho.y=k_,ho.z=Re,Qn=2}else{var Fr,En,as;Fr=on+ur*nn,En=Tn+eo*nn,as=Kn+Rn*nn;var Qe=o;Qe.x=Fr,Qe.y=En,Qe.z=as,Qn=3}var Ee=o.x*o.x+o.y*o.y+o.z*o.z;ke=Qn,gn=Ee;var De=o;Si=De.x,No=De.y,Wr=De.z}if(qe<0){var he,ii,ir,Qi,Fi,fo,So=i;he=So.x,ii=So.y,ir=So.z;var s_=r;Qi=s_.x,Fi=s_.y,fo=s_.z;var Fe,ts,Dn;Fe=Qi-he,ts=Fi-ii,Dn=fo-ir;var co=Fe*Fe+ts*ts+Dn*Dn,Ft=Fe*he+ts*ii+Dn*ir;Ft=-Ft/co;var Ni;if(Ft<0){var lr=o;lr.x=he,lr.y=ii,lr.z=ir,Ni=1}else if(Ft>1){var Vo=o;Vo.x=Qi,Vo.y=Fi,Vo.z=fo,Ni=2}else{var ce,Xe,Le;ce=he+Fe*Ft,Xe=ii+ts*Ft,Le=ir+Dn*Ft;var uo=o;uo.x=ce,uo.y=Xe,uo.z=Le,Ni=3}var $t=o.x*o.x+o.y*o.y+o.z*o.z;if(gn<0||$t<gn){ke=Ni<<1,gn=$t;var Vr=o;Si=Vr.x,No=Vr.y,Wr=Vr.z}}if(D_<0){var sr,Jo,Ns,Co,ko,Nr,Sr=a;sr=Sr.x,Jo=Sr.y,Ns=Sr.z;var Cr=r;Co=Cr.x,ko=Cr.y,Nr=Cr.z;var Lr,Qt,Ji;Lr=Co-sr,Qt=ko-Jo,Ji=Nr-Ns;var Yi=Lr*Lr+Qt*Qt+Ji*Ji,Ri=Lr*sr+Qt*Jo+Ji*Ns;Ri=-Ri/Yi;var zr;if(Ri<0){var qi=o;qi.x=sr,qi.y=Jo,qi.z=Ns,zr=1}else if(Ri>1){var Jr=o;Jr.x=Co,Jr.y=ko,Jr.z=Nr,zr=2}else{var Gr,ao,be;Gr=sr+Lr*Ri,ao=Jo+Qt*Ri,be=Ns+Ji*Ri;var ki=o;ki.x=Gr,ki.y=ao,ki.z=be,zr=3}var en=o.x*o.x+o.y*o.y+o.z*o.z;if(gn<0||en<gn){ke=zr&1|(zr&2)<<1,gn=en;var Yr=o;Si=Yr.x,No=Yr.y,Wr=Yr.z}}var Go;if(gn>0){var ys=o;ys.x=Si,ys.y=No,ys.z=Wr,Go=ke}else{var In=yr*yr+Po*Po+Di*Di;In>0&&(In=1/Math.sqrt(In)),yr*=In,Po*=In,Di*=In;var gs=hi*yr+er*Po+Xr*Di,Vn=yr*yr+Po*Po+Di*Di;Vn=gs/Vn,Si=yr*Vn,No=Po*Vn,Wr=Di*Vn;var Ci=o;Ci.x=Si,Ci.y=No,Ci.z=Wr,Go=7}var To=o.x*o.x+o.y*o.y+o.z*o.z;if(aa<0||To<aa){w=Go&1|(Go&6)<<1,aa=To;var so=o;T=so.x,ca=so.y,_a=so.z}}if(na*sa<0){var Fn,Ne,Nn,Wo,kn,Ye,Ot,Ro,Ur,wn,Jn,fe,Is,Uo,Vs,w_,Js,X_,Je=a;Fn=Je.x,Ne=Je.y,Nn=Je.z;var F_=t;Wo=F_.x,kn=F_.y,Ye=F_.z;var N_=r;Ot=N_.x,Ro=N_.y,Ur=N_.z,wn=Wo-Fn,Jn=kn-Ne,fe=Ye-Nn,Is=Ot-Wo,Uo=Ro-kn,Vs=Ur-Ye,w_=Fn-Ot,Js=Ne-Ro,X_=Nn-Ur;var Or,wo,Xo;Or=Jn*Vs-fe*Uo,wo=fe*Is-wn*Vs,Xo=wn*Uo-Jn*Is;var Gn,wi,Wn,Qo,to,J_,G_,L_,is;Gn=Jn*Xo-fe*wo,wi=fe*Or-wn*Xo,Wn=wn*wo-Jn*Or,Qo=Uo*Xo-Vs*wo,to=Vs*Or-Is*Xo,J_=Is*wo-Uo*Or,G_=Js*Xo-X_*wo,L_=X_*Or-w_*Xo,is=w_*wo-Js*Or;var __=Fn*Gn+Ne*wi+Nn*Wn,v_=Wo*Qo+kn*to+Ye*J_,rs=Ot*G_+Ro*L_+Ur*is,pi=-1,Oo,ar,Ze,Gs=0;if(Oo=0,ar=0,Ze=0,__<0){var hv,ue,Ge,$n,Ws,Ti,Lo=a;hv=Lo.x,ue=Lo.y,Ge=Lo.z;var Tr=t;$n=Tr.x,Ws=Tr.y,Ti=Tr.z;var sn,ks,Y_;sn=$n-hv,ks=Ws-ue,Y_=Ti-Ge;var We=sn*sn+ks*ks+Y_*Y_,jn=sn*hv+ks*ue+Y_*Ge;jn=-jn/We;var Xn;if(jn<0){var os=o;os.x=hv,os.y=ue,os.z=Ge,Xn=1}else if(jn>1){var de=o;de.x=$n,de.y=Ws,de.z=Ti,Xn=2}else{var ns,Us,l_;ns=hv+sn*jn,Us=ue+ks*jn,l_=Ge+Y_*jn;var Be=o;Be.x=ns,Be.y=Us,Be.z=l_,Xn=3}var Ae=o.x*o.x+o.y*o.y+o.z*o.z;Gs=Xn,pi=Ae;var qn=o;Oo=qn.x,ar=qn.y,Ze=qn.z}if(v_<0){var mi,xo,Zr,Ho,Yo,Hr,Eo=t;mi=Eo.x,xo=Eo.y,Zr=Eo.z;var ws=r;Ho=ws.x,Yo=ws.y,Hr=ws.z;var ae,Os,W_;ae=Ho-mi,Os=Yo-xo,W_=Hr-Zr;var te=ae*ae+Os*Os+W_*W_,Nt=ae*mi+Os*xo+W_*Zr;Nt=-Nt/te;var Kr;if(Nt<0){var Do=o;Do.x=mi,Do.y=xo,Do.z=Zr,Kr=1}else if(Nt>1){var Xs=o;Xs.x=Ho,Xs.y=Yo,Xs.z=Hr,Kr=2}else{var kv,i0,U_;kv=mi+ae*Nt,i0=xo+Os*Nt,U_=Zr+W_*Nt;var Ht=o;Ht.x=kv,Ht.y=i0,Ht.z=U_,Kr=3}var Ln=o.x*o.x+o.y*o.y+o.z*o.z;if(pi<0||Ln<pi){Gs=Kr<<1,pi=Ln;var Rr=o;Oo=Rr.x,ar=Rr.y,Ze=Rr.z}}if(rs<0){var Yn,Z_,Hs,h_,bo,es,ss=a;Yn=ss.x,Z_=ss.y,Hs=ss.z;var xe=r;h_=xe.x,bo=xe.y,es=xe.z;var Zi,Ko,kr;Zi=h_-Yn,Ko=bo-Z_,kr=es-Hs;var Zo=Zi*Zi+Ko*Ko+kr*kr,Ue=Zi*Yn+Ko*Z_+kr*Hs;Ue=-Ue/Zo;var cv;if(Ue<0){var ze=o;ze.x=Yn,ze.y=Z_,ze.z=Hs,cv=1}else if(Ue>1){var Ks=o;Ks.x=h_,Ks.y=bo,Ks.z=es,cv=2}else{var wv,Oe,ei;wv=Yn+Zi*Ue,Oe=Z_+Ko*Ue,ei=Hs+kr*Ue;var Zn=o;Zn.x=wv,Zn.y=Oe,Zn.z=ei,cv=3}var _n=o.x*o.x+o.y*o.y+o.z*o.z;if(pi<0||_n<pi){Gs=cv&1|(cv&2)<<1,pi=_n;var vn=o;Oo=vn.x,ar=vn.y,Ze=vn.z}}var d_;if(pi>0){var bv=o;bv.x=Oo,bv.y=ar,bv.z=Ze,d_=Gs}else{var ie=Or*Or+wo*wo+Xo*Xo;ie>0&&(ie=1/Math.sqrt(ie)),Or*=ie,wo*=ie,Xo*=ie;var Pe=Fn*Or+Ne*wo+Nn*Xo,c_=Or*Or+wo*wo+Xo*Xo;c_=Pe/c_,Oo=Or*c_,ar=wo*c_,Ze=Xo*c_;var O_=o;O_.x=Oo,O_.y=ar,O_.z=Ze,d_=7}var fv=o.x*o.x+o.y*o.y+o.z*o.z;if(aa<0||fv<aa){w=d_&3|(d_&4)<<1,aa=fv;var uv=o;T=uv.x,ca=uv.y,_a=uv.z}}if(oa*sa<0){var b_,He,zo,_s,vs,Ui,Mo,_o,ls,Ls,Ys,Zs,B_,Me,hs,H_,$s,Un,pe=t;b_=pe.x,He=pe.y,zo=pe.z;var Xv=i;_s=Xv.x,vs=Xv.y,Ui=Xv.z;var A_=r;Mo=A_.x,_o=A_.y,ls=A_.z,Ls=_s-b_,Ys=vs-He,Zs=Ui-zo,B_=Mo-_s,Me=_o-vs,hs=ls-Ui,H_=b_-Mo,$s=He-_o,Un=zo-ls;var $o,ln,po;$o=Ys*hs-Zs*Me,ln=Zs*B_-Ls*hs,po=Ls*Me-Ys*B_;var Kt,$r,vo,js,ds,qs,P_,jo,re;Kt=Ys*po-Zs*ln,$r=Zs*$o-Ls*po,vo=Ls*ln-Ys*$o,js=Me*po-hs*ln,ds=hs*$o-B_*po,qs=B_*ln-Me*$o,P_=$s*po-Un*ln,jo=Un*$o-H_*po,re=H_*ln-$s*$o;var K_=b_*Kt+He*$r+zo*vo,xv=_s*js+vs*ds+Ui*qs,di=Mo*P_+_o*jo+ls*re,mo=-1,Qr,io,$_,j_=0;if(Qr=0,io=0,$_=0,K_<0){var Lv,a_,Yv,q_,Bi,av,Bs=t;Lv=Bs.x,a_=Bs.y,Yv=Bs.z;var As=i;q_=As.x,Bi=As.y,av=As.z;var cs,bs,Ps;cs=q_-Lv,bs=Bi-a_,Ps=av-Yv;var Zv=cs*cs+bs*bs+Ps*Ps,me=cs*Lv+bs*a_+Ps*Yv;me=-me/Zv;var jr;if(me<0){var t_=o;t_.x=Lv,t_.y=a_,t_.z=Yv,jr=1}else if(me>1){var yo=o;yo.x=q_,yo.y=Bi,yo.z=av,jr=2}else{var i_,Fo,Ss;i_=Lv+cs*me,Fo=a_+bs*me,Ss=Yv+Ps*me;var qo=o;qo.x=i_,qo.y=Fo,qo.z=Ss,jr=3}var ye=o.x*o.x+o.y*o.y+o.z*o.z;j_=jr,mo=ye;var si=o;Qr=si.x,io=si.y,$_=si.z}if(xv<0){var an,_r,oe,ge,Bo,Er,dn=i;an=dn.x,_r=dn.y,oe=dn.z;var tv=r;ge=tv.x,Bo=tv.y,Er=tv.z;var r_,S_,iv;r_=ge-an,S_=Bo-_r,iv=Er-oe;var ne=r_*r_+S_*S_+iv*iv,Bn=r_*an+S_*_r+iv*oe;Bn=-Bn/ne;var Ie;if(Bn<0){var E0=o;E0.x=an,E0.y=_r,E0.z=oe,Ie=1}else if(Bn>1){var M0=o;M0.x=ge,M0.y=Bo,M0.z=Er,Ie=2}else{var hl,D0,hr;hl=an+r_*Bn,D0=_r+S_*Bn,hr=oe+iv*Bn;var On=o;On.x=hl,On.y=D0,On.z=hr,Ie=3}var go=o.x*o.x+o.y*o.y+o.z*o.z;if(mo<0||go<mo){j_=Ie<<1,mo=go;var fs=o;Qr=fs.x,io=fs.y,$_=fs.z}}if(di<0){var rv,zv,o_,dv,Cs,f_,u_=t;rv=u_.x,zv=u_.y,o_=u_.z;var Ai=r;dv=Ai.x,Cs=Ai.y,f_=Ai.z;var Ts,lo,Se;Ts=dv-rv,lo=Cs-zv,Se=f_-o_;var Mv=Ts*Ts+lo*lo+Se*Se,Rs=Ts*rv+lo*zv+Se*o_;Rs=-Rs/Mv;var x_;if(Rs<0){var ov=o;ov.x=rv,ov.y=zv,ov.z=o_,x_=1}else if(Rs>1){var r0=o;r0.x=dv,r0.y=Cs,r0.z=f_,x_=2}else{var o0,nv,tr;o0=rv+Ts*Rs,nv=zv+lo*Rs,tr=o_+Se*Rs;var Ke=o;Ke.x=o0,Ke.y=nv,Ke.z=tr,x_=3}var An=o.x*o.x+o.y*o.y+o.z*o.z;if(mo<0||An<mo){j_=x_&1|(x_&2)<<1,mo=An;var us=o;Qr=us.x,io=us.y,$_=us.z}}var F0;if(mo>0){var Dv=o;Dv.x=Qr,Dv.y=io,Dv.z=$_,F0=j_}else{var C_=$o*$o+ln*ln+po*po;C_>0&&(C_=1/Math.sqrt(C_)),$o*=C_,ln*=C_,po*=C_;var p0=b_*$o+He*ln+zo*po,Bv=$o*$o+ln*ln+po*po;Bv=p0/Bv,Qr=$o*Bv,io=ln*Bv,$_=po*Bv;var n0=o;n0.x=Qr,n0.y=io,n0.z=$_,F0=7}var m0=o.x*o.x+o.y*o.y+o.z*o.z;if(aa<0||m0<aa){w=F0<<1,aa=m0;var N0=o;T=N0.x,ca=N0.y,_a=N0.z}}if(aa>0){var e0=o;return e0.x=T,e0.y=ca,e0.z=_a,w}return o.zero(),15}};x.common.Mat3=class{constructor(a,t,i,r,o,s,_,h,v){v==null&&(v=1),h==null&&(h=0),_==null&&(_=0),s==null&&(s=0),o==null&&(o=1),r==null&&(r=0),i==null&&(i=0),t==null&&(t=0),a==null&&(a=1),this.e00=a,this.e01=t,this.e02=i,this.e10=r,this.e11=o,this.e12=s,this.e20=_,this.e21=h,this.e22=v,x.common.Mat3.numCreations++}init(a,t,i,r,o,s,_,h,v){return this.e00=a,this.e01=t,this.e02=i,this.e10=r,this.e11=o,this.e12=s,this.e20=_,this.e21=h,this.e22=v,this}identity(){var a=1,t=0,i=0,r=0,o=1,s=0,_=0,h=0,v=1;return this.e00=a,this.e01=t,this.e02=i,this.e10=r,this.e11=o,this.e12=s,this.e20=_,this.e21=h,this.e22=v,this}add(a){return new x.common.Mat3(this.e00+a.e00,this.e01+a.e01,this.e02+a.e02,this.e10+a.e10,this.e11+a.e11,this.e12+a.e12,this.e20+a.e20,this.e21+a.e21,this.e22+a.e22)}sub(a){return new x.common.Mat3(this.e00-a.e00,this.e01-a.e01,this.e02-a.e02,this.e10-a.e10,this.e11-a.e11,this.e12-a.e12,this.e20-a.e20,this.e21-a.e21,this.e22-a.e22)}scale(a){return new x.common.Mat3(this.e00*a,this.e01*a,this.e02*a,this.e10*a,this.e11*a,this.e12*a,this.e20*a,this.e21*a,this.e22*a)}mul(a){return new x.common.Mat3(this.e00*a.e00+this.e01*a.e10+this.e02*a.e20,this.e00*a.e01+this.e01*a.e11+this.e02*a.e21,this.e00*a.e02+this.e01*a.e12+this.e02*a.e22,this.e10*a.e00+this.e11*a.e10+this.e12*a.e20,this.e10*a.e01+this.e11*a.e11+this.e12*a.e21,this.e10*a.e02+this.e11*a.e12+this.e12*a.e22,this.e20*a.e00+this.e21*a.e10+this.e22*a.e20,this.e20*a.e01+this.e21*a.e11+this.e22*a.e21,this.e20*a.e02+this.e21*a.e12+this.e22*a.e22)}addEq(a){var t=this.e00+a.e00,i=this.e01+a.e01,r=this.e02+a.e02,o=this.e10+a.e10,s=this.e11+a.e11,_=this.e12+a.e12,h=this.e20+a.e20,v=this.e21+a.e21,e=this.e22+a.e22;return this.e00=t,this.e01=i,this.e02=r,this.e10=o,this.e11=s,this.e12=_,this.e20=h,this.e21=v,this.e22=e,this}subEq(a){var t=this.e00-a.e00,i=this.e01-a.e01,r=this.e02-a.e02,o=this.e10-a.e10,s=this.e11-a.e11,_=this.e12-a.e12,h=this.e20-a.e20,v=this.e21-a.e21,e=this.e22-a.e22;return this.e00=t,this.e01=i,this.e02=r,this.e10=o,this.e11=s,this.e12=_,this.e20=h,this.e21=v,this.e22=e,this}scaleEq(a){var t=this.e00*a,i=this.e01*a,r=this.e02*a,o=this.e10*a,s=this.e11*a,_=this.e12*a,h=this.e20*a,v=this.e21*a,e=this.e22*a;return this.e00=t,this.e01=i,this.e02=r,this.e10=o,this.e11=s,this.e12=_,this.e20=h,this.e21=v,this.e22=e,this}mulEq(a){var t=this.e00*a.e00+this.e01*a.e10+this.e02*a.e20,i=this.e00*a.e01+this.e01*a.e11+this.e02*a.e21,r=this.e00*a.e02+this.e01*a.e12+this.e02*a.e22,o=this.e10*a.e00+this.e11*a.e10+this.e12*a.e20,s=this.e10*a.e01+this.e11*a.e11+this.e12*a.e21,_=this.e10*a.e02+this.e11*a.e12+this.e12*a.e22,h=this.e20*a.e00+this.e21*a.e10+this.e22*a.e20,v=this.e20*a.e01+this.e21*a.e11+this.e22*a.e21,e=this.e20*a.e02+this.e21*a.e12+this.e22*a.e22;return this.e00=t,this.e01=i,this.e02=r,this.e10=o,this.e11=s,this.e12=_,this.e20=h,this.e21=v,this.e22=e,this}prependScale(a,t,i){return new x.common.Mat3(this.e00*a,this.e01*a,this.e02*a,this.e10*t,this.e11*t,this.e12*t,this.e20*i,this.e21*i,this.e22*i)}appendScale(a,t,i){return new x.common.Mat3(this.e00*a,this.e01*t,this.e02*i,this.e10*a,this.e11*t,this.e12*i,this.e20*a,this.e21*t,this.e22*i)}prependRotation(a,t,i,r){var o=Math.sin(a),s=Math.cos(a),_=1-s,h=t*t*_+s,v=t*i*_-r*o,e=t*r*_+i*o,l=i*t*_+r*o,u=i*i*_+s,b=i*r*_-t*o,f=r*t*_-i*o,n=r*i*_+t*o,c=r*r*_+s;return new x.common.Mat3(h*this.e00+v*this.e10+e*this.e20,h*this.e01+v*this.e11+e*this.e21,h*this.e02+v*this.e12+e*this.e22,l*this.e00+u*this.e10+b*this.e20,l*this.e01+u*this.e11+b*this.e21,l*this.e02+u*this.e12+b*this.e22,f*this.e00+n*this.e10+c*this.e20,f*this.e01+n*this.e11+c*this.e21,f*this.e02+n*this.e12+c*this.e22)}appendRotation(a,t,i,r){var o=Math.sin(a),s=Math.cos(a),_=1-s,h=t*t*_+s,v=t*i*_-r*o,e=t*r*_+i*o,l=i*t*_+r*o,u=i*i*_+s,b=i*r*_-t*o,f=r*t*_-i*o,n=r*i*_+t*o,c=r*r*_+s;return new x.common.Mat3(this.e00*h+this.e01*l+this.e02*f,this.e00*v+this.e01*u+this.e02*n,this.e00*e+this.e01*b+this.e02*c,this.e10*h+this.e11*l+this.e12*f,this.e10*v+this.e11*u+this.e12*n,this.e10*e+this.e11*b+this.e12*c,this.e20*h+this.e21*l+this.e22*f,this.e20*v+this.e21*u+this.e22*n,this.e20*e+this.e21*b+this.e22*c)}prependScaleEq(a,t,i){var r=this.e00*a,o=this.e01*a,s=this.e02*a,_=this.e10*t,h=this.e11*t,v=this.e12*t,e=this.e20*i,l=this.e21*i,u=this.e22*i;return this.e00=r,this.e01=o,this.e02=s,this.e10=_,this.e11=h,this.e12=v,this.e20=e,this.e21=l,this.e22=u,this}appendScaleEq(a,t,i){var r=this.e00*a,o=this.e01*t,s=this.e02*i,_=this.e10*a,h=this.e11*t,v=this.e12*i,e=this.e20*a,l=this.e21*t,u=this.e22*i;return this.e00=r,this.e01=o,this.e02=s,this.e10=_,this.e11=h,this.e12=v,this.e20=e,this.e21=l,this.e22=u,this}prependRotationEq(a,t,i,r){var o=Math.sin(a),s=Math.cos(a),_=1-s,h=t*t*_+s,v=t*i*_-r*o,e=t*r*_+i*o,l=i*t*_+r*o,u=i*i*_+s,b=i*r*_-t*o,f=r*t*_-i*o,n=r*i*_+t*o,c=r*r*_+s,z=h*this.e00+v*this.e10+e*this.e20,p=h*this.e01+v*this.e11+e*this.e21,y=h*this.e02+v*this.e12+e*this.e22,V=l*this.e00+u*this.e10+b*this.e20,M=l*this.e01+u*this.e11+b*this.e21,I=l*this.e02+u*this.e12+b*this.e22,k=f*this.e00+n*this.e10+c*this.e20,X=f*this.e01+n*this.e11+c*this.e21,L=f*this.e02+n*this.e12+c*this.e22;return this.e00=z,this.e01=p,this.e02=y,this.e10=V,this.e11=M,this.e12=I,this.e20=k,this.e21=X,this.e22=L,this}appendRotationEq(a,t,i,r){var o=Math.sin(a),s=Math.cos(a),_=1-s,h=t*t*_+s,v=t*i*_-r*o,e=t*r*_+i*o,l=i*t*_+r*o,u=i*i*_+s,b=i*r*_-t*o,f=r*t*_-i*o,n=r*i*_+t*o,c=r*r*_+s,z=this.e00*h+this.e01*l+this.e02*f,p=this.e00*v+this.e01*u+this.e02*n,y=this.e00*e+this.e01*b+this.e02*c,V=this.e10*h+this.e11*l+this.e12*f,M=this.e10*v+this.e11*u+this.e12*n,I=this.e10*e+this.e11*b+this.e12*c,k=this.e20*h+this.e21*l+this.e22*f,X=this.e20*v+this.e21*u+this.e22*n,L=this.e20*e+this.e21*b+this.e22*c;return this.e00=z,this.e01=p,this.e02=y,this.e10=V,this.e11=M,this.e12=I,this.e20=k,this.e21=X,this.e22=L,this}transpose(){return new x.common.Mat3(this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22)}transposeEq(){var a=this.e00,t=this.e10,i=this.e20,r=this.e01,o=this.e11,s=this.e21,_=this.e02,h=this.e12,v=this.e22;return this.e00=a,this.e01=t,this.e02=i,this.e10=r,this.e11=o,this.e12=s,this.e20=_,this.e21=h,this.e22=v,this}determinant(){return this.e00*(this.e11*this.e22-this.e12*this.e21)-this.e01*(this.e10*this.e22-this.e12*this.e20)+this.e02*(this.e10*this.e21-this.e11*this.e20)}trace(){return this.e00+this.e11+this.e22}inverse(){var a=this.e11*this.e22-this.e12*this.e21,t=this.e10*this.e22-this.e12*this.e20,i=this.e10*this.e21-this.e11*this.e20,r=this.e01*this.e22-this.e02*this.e21,o=this.e00*this.e22-this.e02*this.e20,s=this.e00*this.e21-this.e01*this.e20,_=this.e01*this.e12-this.e02*this.e11,h=this.e00*this.e12-this.e02*this.e10,v=this.e00*this.e11-this.e01*this.e10,e=this.e00*a-this.e01*t+this.e02*i;return e!=0&&(e=1/e),new x.common.Mat3(a*e,-r*e,_*e,-t*e,o*e,-h*e,i*e,-s*e,v*e)}inverseEq(){var a=this.e11*this.e22-this.e12*this.e21,t=this.e10*this.e22-this.e12*this.e20,i=this.e10*this.e21-this.e11*this.e20,r=this.e01*this.e22-this.e02*this.e21,o=this.e00*this.e22-this.e02*this.e20,s=this.e00*this.e21-this.e01*this.e20,_=this.e01*this.e12-this.e02*this.e11,h=this.e00*this.e12-this.e02*this.e10,v=this.e00*this.e11-this.e01*this.e10,e=this.e00*a-this.e01*t+this.e02*i;e!=0&&(e=1/e);var l=a*e,u=-r*e,b=_*e,f=-t*e,n=o*e,c=-h*e,z=i*e,p=-s*e,y=v*e;return this.e00=l,this.e01=u,this.e02=b,this.e10=f,this.e11=n,this.e12=c,this.e20=z,this.e21=p,this.e22=y,this}toArray(a){return a==null&&(a=!1),a?[this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22]:[this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22]}copyFrom(a){return this.e00=a.e00,this.e01=a.e01,this.e02=a.e02,this.e10=a.e10,this.e11=a.e11,this.e12=a.e12,this.e20=a.e20,this.e21=a.e21,this.e22=a.e22,this}clone(){return new x.common.Mat3(this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22)}fromQuat(a){var t=a.x,i=a.y,r=a.z,o=a.w,s=2*t,_=2*i,h=2*r,v=t*s,e=i*_,l=r*h,u=t*_,b=i*h,f=t*h,n=o*s,c=o*_,z=o*h;return this.e00=1-e-l,this.e01=u-z,this.e02=f+c,this.e10=u+z,this.e11=1-v-l,this.e12=b-n,this.e20=f-c,this.e21=b+n,this.e22=1-v-e,this}toQuat(){var a=new x.common.Quat,t=this.e00,i=this.e11,r=this.e22,o=t+i+r,s;return o>0?(s=Math.sqrt(o+1),a.w=.5*s,s=.5/s,a.x=(this.e21-this.e12)*s,a.y=(this.e02-this.e20)*s,a.z=(this.e10-this.e01)*s):t>i?t>r?(s=Math.sqrt(t-i-r+1),a.x=.5*s,s=.5/s,a.y=(this.e01+this.e10)*s,a.z=(this.e02+this.e20)*s,a.w=(this.e21-this.e12)*s):(s=Math.sqrt(r-t-i+1),a.z=.5*s,s=.5/s,a.x=(this.e02+this.e20)*s,a.y=(this.e12+this.e21)*s,a.w=(this.e10-this.e01)*s):i>r?(s=Math.sqrt(i-r-t+1),a.y=.5*s,s=.5/s,a.x=(this.e01+this.e10)*s,a.z=(this.e12+this.e21)*s,a.w=(this.e02-this.e20)*s):(s=Math.sqrt(r-t-i+1),a.z=.5*s,s=.5/s,a.x=(this.e02+this.e20)*s,a.y=(this.e12+this.e21)*s,a.w=(this.e10-this.e01)*s),a}fromEulerXyz(a){var t=Math.sin(a.x),i=Math.sin(a.y),r=Math.sin(a.z),o=Math.cos(a.x),s=Math.cos(a.y),_=Math.cos(a.z),h=s*_,v=-s*r,e=i,l=o*r+_*t*i,u=o*_-t*i*r,b=-s*t,f=t*r-o*_*i,n=_*t+o*i*r,c=o*s;return this.e00=h,this.e01=v,this.e02=e,this.e10=l,this.e11=u,this.e12=b,this.e20=f,this.e21=n,this.e22=c,this}toEulerXyz(){var a=this.e02;if(a<=-1){var t=Math.atan2(this.e21,this.e11);return new x.common.Vec3(t*.5,-1.570796326794895,-t*.5)}if(a>=1){var i=Math.atan2(this.e21,this.e11);return new x.common.Vec3(i*.5,1.570796326794895,i*.5)}var r=Math.asin(a),o=Math.atan2(-this.e12,this.e22),s=Math.atan2(-this.e01,this.e00);return new x.common.Vec3(o,r,s)}getRow(a){return a==0?new x.common.Vec3(this.e00,this.e01,this.e02):a==1?new x.common.Vec3(this.e10,this.e11,this.e12):a==2?new x.common.Vec3(this.e20,this.e21,this.e22):null}getCol(a){return a==0?new x.common.Vec3(this.e00,this.e10,this.e20):a==1?new x.common.Vec3(this.e01,this.e11,this.e21):a==2?new x.common.Vec3(this.e02,this.e12,this.e22):null}getRowTo(a,t){a==0?t.init(this.e00,this.e01,this.e02):a==1?t.init(this.e10,this.e11,this.e12):a==2?t.init(this.e20,this.e21,this.e22):t.zero()}getColTo(a,t){a==0?t.init(this.e00,this.e10,this.e20):a==1?t.init(this.e01,this.e11,this.e21):a==2?t.init(this.e02,this.e12,this.e22):t.zero()}fromRows(a,t,i){var r=a.x,o=a.y,s=a.z,_=t.x,h=t.y,v=t.z,e=i.x,l=i.y,u=i.z;return this.e00=r,this.e01=o,this.e02=s,this.e10=_,this.e11=h,this.e12=v,this.e20=e,this.e21=l,this.e22=u,this}fromCols(a,t,i){var r=a.x,o=t.x,s=i.x,_=a.y,h=t.y,v=i.y,e=a.z,l=t.z,u=i.z;return this.e00=r,this.e01=o,this.e02=s,this.e10=_,this.e11=h,this.e12=v,this.e20=e,this.e21=l,this.e22=u,this}toString(){return"Mat3["+(this.e00>0?(this.e00*1e7+.5|0)/1e7:(this.e00*1e7-.5|0)/1e7)+", "+(this.e01>0?(this.e01*1e7+.5|0)/1e7:(this.e01*1e7-.5|0)/1e7)+", "+(this.e02>0?(this.e02*1e7+.5|0)/1e7:(this.e02*1e7-.5|0)/1e7)+",\n     "+(this.e10>0?(this.e10*1e7+.5|0)/1e7:(this.e10*1e7-.5|0)/1e7)+", "+(this.e11>0?(this.e11*1e7+.5|0)/1e7:(this.e11*1e7-.5|0)/1e7)+", "+(this.e12>0?(this.e12*1e7+.5|0)/1e7:(this.e12*1e7-.5|0)/1e7)+",\n     "+(this.e20>0?(this.e20*1e7+.5|0)/1e7:(this.e20*1e7-.5|0)/1e7)+", "+(this.e21>0?(this.e21*1e7+.5|0)/1e7:(this.e21*1e7-.5|0)/1e7)+", "+(this.e22>0?(this.e22*1e7+.5|0)/1e7:(this.e22*1e7-.5|0)/1e7)+"]"}};x.common.Mat4=class{constructor(a,t,i,r,o,s,_,h,v,e,l,u,b,f,n,c){c==null&&(c=1),n==null&&(n=0),f==null&&(f=0),b==null&&(b=0),u==null&&(u=0),l==null&&(l=1),e==null&&(e=0),v==null&&(v=0),h==null&&(h=0),_==null&&(_=0),s==null&&(s=1),o==null&&(o=0),r==null&&(r=0),i==null&&(i=0),t==null&&(t=0),a==null&&(a=1),this.e00=a,this.e01=t,this.e02=i,this.e03=r,this.e10=o,this.e11=s,this.e12=_,this.e13=h,this.e20=v,this.e21=e,this.e22=l,this.e23=u,this.e30=b,this.e31=f,this.e32=n,this.e33=c,x.common.Mat4.numCreations++}init(a,t,i,r,o,s,_,h,v,e,l,u,b,f,n,c){return this.e00=a,this.e01=t,this.e02=i,this.e03=r,this.e10=o,this.e11=s,this.e12=_,this.e13=h,this.e20=v,this.e21=e,this.e22=l,this.e23=u,this.e30=b,this.e31=f,this.e32=n,this.e33=c,this}identity(){var a=1,t=0,i=0,r=0,o=0,s=1,_=0,h=0,v=0,e=0,l=1,u=0,b=0,f=0,n=0,c=1;return this.e00=a,this.e01=t,this.e02=i,this.e03=r,this.e10=o,this.e11=s,this.e12=_,this.e13=h,this.e20=v,this.e21=e,this.e22=l,this.e23=u,this.e30=b,this.e31=f,this.e32=n,this.e33=c,this}add(a){return new x.common.Mat4(this.e00+a.e00,this.e01+a.e01,this.e02+a.e02,this.e03+a.e03,this.e10+a.e10,this.e11+a.e11,this.e12+a.e12,this.e13+a.e13,this.e20+a.e20,this.e21+a.e21,this.e22+a.e22,this.e23+a.e23,this.e30+a.e30,this.e31+a.e31,this.e32+a.e32,this.e33+a.e33)}sub(a){return new x.common.Mat4(this.e00-a.e00,this.e01-a.e01,this.e02-a.e02,this.e03-a.e03,this.e10-a.e10,this.e11-a.e11,this.e12-a.e12,this.e13-a.e13,this.e20-a.e20,this.e21-a.e21,this.e22-a.e22,this.e23-a.e23,this.e30-a.e30,this.e31-a.e31,this.e32-a.e32,this.e33-a.e33)}scale(a){return new x.common.Mat4(this.e00*a,this.e01*a,this.e02*a,this.e03*a,this.e10*a,this.e11*a,this.e12*a,this.e13*a,this.e20*a,this.e21*a,this.e22*a,this.e23*a,this.e30*a,this.e31*a,this.e32*a,this.e33*a)}mul(a){return new x.common.Mat4(this.e00*a.e00+this.e01*a.e10+this.e02*a.e20+this.e03*a.e30,this.e00*a.e01+this.e01*a.e11+this.e02*a.e21+this.e03*a.e31,this.e00*a.e02+this.e01*a.e12+this.e02*a.e22+this.e03*a.e32,this.e00*a.e03+this.e01*a.e13+this.e02*a.e23+this.e03*a.e33,this.e10*a.e00+this.e11*a.e10+this.e12*a.e20+this.e13*a.e30,this.e10*a.e01+this.e11*a.e11+this.e12*a.e21+this.e13*a.e31,this.e10*a.e02+this.e11*a.e12+this.e12*a.e22+this.e13*a.e32,this.e10*a.e03+this.e11*a.e13+this.e12*a.e23+this.e13*a.e33,this.e20*a.e00+this.e21*a.e10+this.e22*a.e20+this.e23*a.e30,this.e20*a.e01+this.e21*a.e11+this.e22*a.e21+this.e23*a.e31,this.e20*a.e02+this.e21*a.e12+this.e22*a.e22+this.e23*a.e32,this.e20*a.e03+this.e21*a.e13+this.e22*a.e23+this.e23*a.e33,this.e30*a.e00+this.e31*a.e10+this.e32*a.e20+this.e33*a.e30,this.e30*a.e01+this.e31*a.e11+this.e32*a.e21+this.e33*a.e31,this.e30*a.e02+this.e31*a.e12+this.e32*a.e22+this.e33*a.e32,this.e30*a.e03+this.e31*a.e13+this.e32*a.e23+this.e33*a.e33)}addEq(a){var t=this.e00+a.e00,i=this.e01+a.e01,r=this.e02+a.e02,o=this.e03+a.e03,s=this.e10+a.e10,_=this.e11+a.e11,h=this.e12+a.e12,v=this.e13+a.e13,e=this.e20+a.e20,l=this.e21+a.e21,u=this.e22+a.e22,b=this.e23+a.e23,f=this.e30+a.e30,n=this.e31+a.e31,c=this.e32+a.e32,z=this.e33+a.e33;return this.e00=t,this.e01=i,this.e02=r,this.e03=o,this.e10=s,this.e11=_,this.e12=h,this.e13=v,this.e20=e,this.e21=l,this.e22=u,this.e23=b,this.e30=f,this.e31=n,this.e32=c,this.e33=z,this}subEq(a){var t=this.e00-a.e00,i=this.e01-a.e01,r=this.e02-a.e02,o=this.e03-a.e03,s=this.e10-a.e10,_=this.e11-a.e11,h=this.e12-a.e12,v=this.e13-a.e13,e=this.e20-a.e20,l=this.e21-a.e21,u=this.e22-a.e22,b=this.e23-a.e23,f=this.e30-a.e30,n=this.e31-a.e31,c=this.e32-a.e32,z=this.e33-a.e33;return this.e00=t,this.e01=i,this.e02=r,this.e03=o,this.e10=s,this.e11=_,this.e12=h,this.e13=v,this.e20=e,this.e21=l,this.e22=u,this.e23=b,this.e30=f,this.e31=n,this.e32=c,this.e33=z,this}scaleEq(a){var t=this.e00*a,i=this.e01*a,r=this.e02*a,o=this.e03*a,s=this.e10*a,_=this.e11*a,h=this.e12*a,v=this.e13*a,e=this.e20*a,l=this.e21*a,u=this.e22*a,b=this.e23*a,f=this.e30*a,n=this.e31*a,c=this.e32*a,z=this.e33*a;return this.e00=t,this.e01=i,this.e02=r,this.e03=o,this.e10=s,this.e11=_,this.e12=h,this.e13=v,this.e20=e,this.e21=l,this.e22=u,this.e23=b,this.e30=f,this.e31=n,this.e32=c,this.e33=z,this}mulEq(a){var t=this.e00*a.e00+this.e01*a.e10+this.e02*a.e20+this.e03*a.e30,i=this.e00*a.e01+this.e01*a.e11+this.e02*a.e21+this.e03*a.e31,r=this.e00*a.e02+this.e01*a.e12+this.e02*a.e22+this.e03*a.e32,o=this.e00*a.e03+this.e01*a.e13+this.e02*a.e23+this.e03*a.e33,s=this.e10*a.e00+this.e11*a.e10+this.e12*a.e20+this.e13*a.e30,_=this.e10*a.e01+this.e11*a.e11+this.e12*a.e21+this.e13*a.e31,h=this.e10*a.e02+this.e11*a.e12+this.e12*a.e22+this.e13*a.e32,v=this.e10*a.e03+this.e11*a.e13+this.e12*a.e23+this.e13*a.e33,e=this.e20*a.e00+this.e21*a.e10+this.e22*a.e20+this.e23*a.e30,l=this.e20*a.e01+this.e21*a.e11+this.e22*a.e21+this.e23*a.e31,u=this.e20*a.e02+this.e21*a.e12+this.e22*a.e22+this.e23*a.e32,b=this.e20*a.e03+this.e21*a.e13+this.e22*a.e23+this.e23*a.e33,f=this.e30*a.e00+this.e31*a.e10+this.e32*a.e20+this.e33*a.e30,n=this.e30*a.e01+this.e31*a.e11+this.e32*a.e21+this.e33*a.e31,c=this.e30*a.e02+this.e31*a.e12+this.e32*a.e22+this.e33*a.e32,z=this.e30*a.e03+this.e31*a.e13+this.e32*a.e23+this.e33*a.e33;return this.e00=t,this.e01=i,this.e02=r,this.e03=o,this.e10=s,this.e11=_,this.e12=h,this.e13=v,this.e20=e,this.e21=l,this.e22=u,this.e23=b,this.e30=f,this.e31=n,this.e32=c,this.e33=z,this}prependScale(a,t,i){return new x.common.Mat4(this.e00*a,this.e01*a,this.e02*a,this.e03*a,this.e10*t,this.e11*t,this.e12*t,this.e13*t,this.e20*i,this.e21*i,this.e22*i,this.e23*i,this.e30,this.e31,this.e32,this.e33)}appendScale(a,t,i){return new x.common.Mat4(this.e00*a,this.e01*t,this.e02*i,this.e03,this.e10*a,this.e11*t,this.e12*i,this.e13,this.e20*a,this.e21*t,this.e22*i,this.e23,this.e30*a,this.e31*t,this.e32*i,this.e33)}prependRotation(a,t,i,r){var o=Math.sin(a),s=Math.cos(a),_=1-s,h=t*t*_+s,v=t*i*_-r*o,e=t*r*_+i*o,l=i*t*_+r*o,u=i*i*_+s,b=i*r*_-t*o,f=r*t*_-i*o,n=r*i*_+t*o,c=r*r*_+s;return new x.common.Mat4(h*this.e00+v*this.e10+e*this.e20,h*this.e01+v*this.e11+e*this.e21,h*this.e02+v*this.e12+e*this.e22,h*this.e03+v*this.e13+e*this.e23,l*this.e00+u*this.e10+b*this.e20,l*this.e01+u*this.e11+b*this.e21,l*this.e02+u*this.e12+b*this.e22,l*this.e03+u*this.e13+b*this.e23,f*this.e00+n*this.e10+c*this.e20,f*this.e01+n*this.e11+c*this.e21,f*this.e02+n*this.e12+c*this.e22,f*this.e03+n*this.e13+c*this.e23,this.e30,this.e31,this.e32,this.e33)}appendRotation(a,t,i,r){var o=Math.sin(a),s=Math.cos(a),_=1-s,h=t*t*_+s,v=t*i*_-r*o,e=t*r*_+i*o,l=i*t*_+r*o,u=i*i*_+s,b=i*r*_-t*o,f=r*t*_-i*o,n=r*i*_+t*o,c=r*r*_+s;return new x.common.Mat4(this.e00*h+this.e01*l+this.e02*f,this.e00*v+this.e01*u+this.e02*n,this.e00*e+this.e01*b+this.e02*c,this.e03,this.e10*h+this.e11*l+this.e12*f,this.e10*v+this.e11*u+this.e12*n,this.e10*e+this.e11*b+this.e12*c,this.e13,this.e20*h+this.e21*l+this.e22*f,this.e20*v+this.e21*u+this.e22*n,this.e20*e+this.e21*b+this.e22*c,this.e23,this.e30*h+this.e31*l+this.e32*f,this.e30*v+this.e31*u+this.e32*n,this.e30*e+this.e31*b+this.e32*c,this.e33)}prependTranslation(a,t,i){return new x.common.Mat4(this.e00+a*this.e30,this.e01+a*this.e31,this.e02+a*this.e32,this.e03+a*this.e33,this.e10+t*this.e30,this.e11+t*this.e31,this.e12+t*this.e32,this.e13+t*this.e33,this.e20+i*this.e30,this.e21+i*this.e31,this.e22+i*this.e32,this.e23+i*this.e33,this.e30,this.e31,this.e32,this.e33)}appendTranslation(a,t,i){return new x.common.Mat4(this.e00,this.e01,this.e02,this.e00*a+this.e01*t+this.e02*i+this.e03,this.e10,this.e11,this.e12,this.e10*a+this.e11*t+this.e12*i+this.e13,this.e20,this.e21,this.e22,this.e20*a+this.e21*t+this.e22*i+this.e23,this.e30,this.e31,this.e32,this.e30*a+this.e31*t+this.e32*i+this.e33)}prependScaleEq(a,t,i){var r=this.e00*a,o=this.e01*a,s=this.e02*a,_=this.e03*a,h=this.e10*t,v=this.e11*t,e=this.e12*t,l=this.e13*t,u=this.e20*i,b=this.e21*i,f=this.e22*i,n=this.e23*i,c=this.e30,z=this.e31,p=this.e32,y=this.e33;return this.e00=r,this.e01=o,this.e02=s,this.e03=_,this.e10=h,this.e11=v,this.e12=e,this.e13=l,this.e20=u,this.e21=b,this.e22=f,this.e23=n,this.e30=c,this.e31=z,this.e32=p,this.e33=y,this}appendScaleEq(a,t,i){var r=this.e00*a,o=this.e01*t,s=this.e02*i,_=this.e03,h=this.e10*a,v=this.e11*t,e=this.e12*i,l=this.e13,u=this.e20*a,b=this.e21*t,f=this.e22*i,n=this.e23,c=this.e30*a,z=this.e31*t,p=this.e32*i,y=this.e33;return this.e00=r,this.e01=o,this.e02=s,this.e03=_,this.e10=h,this.e11=v,this.e12=e,this.e13=l,this.e20=u,this.e21=b,this.e22=f,this.e23=n,this.e30=c,this.e31=z,this.e32=p,this.e33=y,this}prependRotationEq(a,t,i,r){var o=Math.sin(a),s=Math.cos(a),_=1-s,h=t*t*_+s,v=t*i*_-r*o,e=t*r*_+i*o,l=i*t*_+r*o,u=i*i*_+s,b=i*r*_-t*o,f=r*t*_-i*o,n=r*i*_+t*o,c=r*r*_+s,z=h*this.e00+v*this.e10+e*this.e20,p=h*this.e01+v*this.e11+e*this.e21,y=h*this.e02+v*this.e12+e*this.e22,V=h*this.e03+v*this.e13+e*this.e23,M=l*this.e00+u*this.e10+b*this.e20,I=l*this.e01+u*this.e11+b*this.e21,k=l*this.e02+u*this.e12+b*this.e22,X=l*this.e03+u*this.e13+b*this.e23,L=f*this.e00+n*this.e10+c*this.e20,m=f*this.e01+n*this.e11+c*this.e21,g=f*this.e02+n*this.e12+c*this.e22,N=f*this.e03+n*this.e13+c*this.e23,A=this.e30,F=this.e31,P=this.e32,Y=this.e33;return this.e00=z,this.e01=p,this.e02=y,this.e03=V,this.e10=M,this.e11=I,this.e12=k,this.e13=X,this.e20=L,this.e21=m,this.e22=g,this.e23=N,this.e30=A,this.e31=F,this.e32=P,this.e33=Y,this}appendRotationEq(a,t,i,r){var o=Math.sin(a),s=Math.cos(a),_=1-s,h=t*t*_+s,v=t*i*_-r*o,e=t*r*_+i*o,l=i*t*_+r*o,u=i*i*_+s,b=i*r*_-t*o,f=r*t*_-i*o,n=r*i*_+t*o,c=r*r*_+s,z=this.e00*h+this.e01*l+this.e02*f,p=this.e00*v+this.e01*u+this.e02*n,y=this.e00*e+this.e01*b+this.e02*c,V=this.e03,M=this.e10*h+this.e11*l+this.e12*f,I=this.e10*v+this.e11*u+this.e12*n,k=this.e10*e+this.e11*b+this.e12*c,X=this.e13,L=this.e20*h+this.e21*l+this.e22*f,m=this.e20*v+this.e21*u+this.e22*n,g=this.e20*e+this.e21*b+this.e22*c,N=this.e23,A=this.e30*h+this.e31*l+this.e32*f,F=this.e30*v+this.e31*u+this.e32*n,P=this.e30*e+this.e31*b+this.e32*c,Y=this.e33;return this.e00=z,this.e01=p,this.e02=y,this.e03=V,this.e10=M,this.e11=I,this.e12=k,this.e13=X,this.e20=L,this.e21=m,this.e22=g,this.e23=N,this.e30=A,this.e31=F,this.e32=P,this.e33=Y,this}prependTranslationEq(a,t,i){var r=this.e00+a*this.e30,o=this.e01+a*this.e31,s=this.e02+a*this.e32,_=this.e03+a*this.e33,h=this.e10+t*this.e30,v=this.e11+t*this.e31,e=this.e12+t*this.e32,l=this.e13+t*this.e33,u=this.e20+i*this.e30,b=this.e21+i*this.e31,f=this.e22+i*this.e32,n=this.e23+i*this.e33,c=this.e30,z=this.e31,p=this.e32,y=this.e33;return this.e00=r,this.e01=o,this.e02=s,this.e03=_,this.e10=h,this.e11=v,this.e12=e,this.e13=l,this.e20=u,this.e21=b,this.e22=f,this.e23=n,this.e30=c,this.e31=z,this.e32=p,this.e33=y,this}appendTranslationEq(a,t,i){var r=this.e00,o=this.e01,s=this.e02,_=this.e00*a+this.e01*t+this.e02*i+this.e03,h=this.e10,v=this.e11,e=this.e12,l=this.e10*a+this.e11*t+this.e12*i+this.e13,u=this.e20,b=this.e21,f=this.e22,n=this.e20*a+this.e21*t+this.e22*i+this.e23,c=this.e30,z=this.e31,p=this.e32,y=this.e30*a+this.e31*t+this.e32*i+this.e33;return this.e00=r,this.e01=o,this.e02=s,this.e03=_,this.e10=h,this.e11=v,this.e12=e,this.e13=l,this.e20=u,this.e21=b,this.e22=f,this.e23=n,this.e30=c,this.e31=z,this.e32=p,this.e33=y,this}transpose(){return new x.common.Mat4(this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33)}transposeEq(){var a=this.e00,t=this.e10,i=this.e20,r=this.e30,o=this.e01,s=this.e11,_=this.e21,h=this.e31,v=this.e02,e=this.e12,l=this.e22,u=this.e32,b=this.e03,f=this.e13,n=this.e23,c=this.e33;return this.e00=a,this.e01=t,this.e02=i,this.e03=r,this.e10=o,this.e11=s,this.e12=_,this.e13=h,this.e20=v,this.e21=e,this.e22=l,this.e23=u,this.e30=b,this.e31=f,this.e32=n,this.e33=c,this}determinant(){var a=this.e20*this.e31-this.e21*this.e30,t=this.e20*this.e32-this.e22*this.e30,i=this.e20*this.e33-this.e23*this.e30,r=this.e21*this.e32-this.e22*this.e31,o=this.e21*this.e33-this.e23*this.e31,s=this.e22*this.e33-this.e23*this.e32;return this.e00*(this.e11*s-this.e12*o+this.e13*r)-this.e01*(this.e10*s-this.e12*i+this.e13*t)+this.e02*(this.e10*o-this.e11*i+this.e13*a)-this.e03*(this.e10*r-this.e11*t+this.e12*a)}trace(){return this.e00+this.e11+this.e22+this.e33}inverse(){var a=this.e00*this.e11-this.e01*this.e10,t=this.e00*this.e12-this.e02*this.e10,i=this.e00*this.e13-this.e03*this.e10,r=this.e01*this.e12-this.e02*this.e11,o=this.e01*this.e13-this.e03*this.e11,s=this.e02*this.e13-this.e03*this.e12,_=this.e20*this.e31-this.e21*this.e30,h=this.e20*this.e32-this.e22*this.e30,v=this.e20*this.e33-this.e23*this.e30,e=this.e21*this.e32-this.e22*this.e31,l=this.e21*this.e33-this.e23*this.e31,u=this.e22*this.e33-this.e23*this.e32,b=this.e11*u-this.e12*l+this.e13*e,f=this.e10*u-this.e12*v+this.e13*h,n=this.e10*l-this.e11*v+this.e13*_,c=this.e10*e-this.e11*h+this.e12*_,z=this.e01*u-this.e02*l+this.e03*e,p=this.e00*u-this.e02*v+this.e03*h,y=this.e00*l-this.e01*v+this.e03*_,V=this.e00*e-this.e01*h+this.e02*_,M=this.e31*s-this.e32*o+this.e33*r,I=this.e30*s-this.e32*i+this.e33*t,k=this.e30*o-this.e31*i+this.e33*a,X=this.e30*r-this.e31*t+this.e32*a,L=this.e21*s-this.e22*o+this.e23*r,m=this.e20*s-this.e22*i+this.e23*t,g=this.e20*o-this.e21*i+this.e23*a,N=this.e20*r-this.e21*t+this.e22*a,A=this.e00*b-this.e01*f+this.e02*n-this.e03*c;return A!=0&&(A=1/A),new x.common.Mat4(b*A,-z*A,M*A,-L*A,-f*A,p*A,-I*A,m*A,n*A,-y*A,k*A,-g*A,-c*A,V*A,-X*A,N*A)}inverseEq(){var a=this.e00*this.e11-this.e01*this.e10,t=this.e00*this.e12-this.e02*this.e10,i=this.e00*this.e13-this.e03*this.e10,r=this.e01*this.e12-this.e02*this.e11,o=this.e01*this.e13-this.e03*this.e11,s=this.e02*this.e13-this.e03*this.e12,_=this.e20*this.e31-this.e21*this.e30,h=this.e20*this.e32-this.e22*this.e30,v=this.e20*this.e33-this.e23*this.e30,e=this.e21*this.e32-this.e22*this.e31,l=this.e21*this.e33-this.e23*this.e31,u=this.e22*this.e33-this.e23*this.e32,b=this.e11*u-this.e12*l+this.e13*e,f=this.e10*u-this.e12*v+this.e13*h,n=this.e10*l-this.e11*v+this.e13*_,c=this.e10*e-this.e11*h+this.e12*_,z=this.e01*u-this.e02*l+this.e03*e,p=this.e00*u-this.e02*v+this.e03*h,y=this.e00*l-this.e01*v+this.e03*_,V=this.e00*e-this.e01*h+this.e02*_,M=this.e31*s-this.e32*o+this.e33*r,I=this.e30*s-this.e32*i+this.e33*t,k=this.e30*o-this.e31*i+this.e33*a,X=this.e30*r-this.e31*t+this.e32*a,L=this.e21*s-this.e22*o+this.e23*r,m=this.e20*s-this.e22*i+this.e23*t,g=this.e20*o-this.e21*i+this.e23*a,N=this.e20*r-this.e21*t+this.e22*a,A=this.e00*b-this.e01*f+this.e02*n-this.e03*c;A!=0&&(A=1/A);var F=b*A,P=-z*A,Y=M*A,R=-L*A,C=-f*A,d=p*A,Z=-I*A,$=m*A,K=n*A,E=-y*A,J=k*A,B=-g*A,Q=-c*A,U=V*A,G=-X*A,D=N*A;return this.e00=F,this.e01=P,this.e02=Y,this.e03=R,this.e10=C,this.e11=d,this.e12=Z,this.e13=$,this.e20=K,this.e21=E,this.e22=J,this.e23=B,this.e30=Q,this.e31=U,this.e32=G,this.e33=D,this}lookAt(a,t,i,r,o,s,_,h,v){var e=a-r,l=t-o,u=i-s,b=1/Math.sqrt(e*e+l*l+u*u);e*=b,l*=b,u*=b;var f=h*u-v*l,n=v*e-_*u,c=_*l-h*e;b=1/Math.sqrt(f*f+n*n+c*c),f*=b,n*=b,c*=b;var z=l*c-u*n,p=u*f-e*c,y=e*n-l*f;return this.e00=f,this.e01=n,this.e02=c,this.e03=-(f*a+n*t+c*i),this.e10=z,this.e11=p,this.e12=y,this.e13=-(z*a+p*t+y*i),this.e20=e,this.e21=l,this.e22=u,this.e23=-(e*a+l*t+u*i),this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}perspective(a,t,i,r){var o=1/Math.tan(a*.5),s=r/(i-r);return this.e00=o/t,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=o,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=s,this.e23=i*s,this.e30=0,this.e31=0,this.e32=-1,this.e33=0,this}ortho(a,t,i,r){var o=1/(i-r);return this.e00=2/a,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=2/t,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=o,this.e23=i*o,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}toArray(a){return a==null&&(a=!1),a?[this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33]:[this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33]}copyFrom(a){return this.e00=a.e00,this.e01=a.e01,this.e02=a.e02,this.e03=a.e03,this.e10=a.e10,this.e11=a.e11,this.e12=a.e12,this.e13=a.e13,this.e20=a.e20,this.e21=a.e21,this.e22=a.e22,this.e23=a.e23,this.e30=a.e30,this.e31=a.e31,this.e32=a.e32,this.e33=a.e33,this}fromMat3(a){var t=a.e00,i=a.e01,r=a.e02,o=0,s=a.e10,_=a.e11,h=a.e12,v=0,e=a.e20,l=a.e21,u=a.e22,b=0,f=0,n=0,c=0,z=1;return this.e00=t,this.e01=i,this.e02=r,this.e03=o,this.e10=s,this.e11=_,this.e12=h,this.e13=v,this.e20=e,this.e21=l,this.e22=u,this.e23=b,this.e30=f,this.e31=n,this.e32=c,this.e33=z,this}fromTransform(a){var t=this;return t.e00=a._rotation00,t.e01=a._rotation01,t.e02=a._rotation02,t.e10=a._rotation10,t.e11=a._rotation11,t.e12=a._rotation12,t.e20=a._rotation20,t.e21=a._rotation21,t.e22=a._rotation22,t.e03=a._positionX,t.e13=a._positionY,t.e23=a._positionZ,t.e30=0,t.e31=0,t.e32=0,t.e33=1,this}clone(){return new x.common.Mat4(this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33)}toString(){return"Mat4["+(this.e00>0?(this.e00*1e7+.5|0)/1e7:(this.e00*1e7-.5|0)/1e7)+", "+(this.e01>0?(this.e01*1e7+.5|0)/1e7:(this.e01*1e7-.5|0)/1e7)+", "+(this.e02>0?(this.e02*1e7+.5|0)/1e7:(this.e02*1e7-.5|0)/1e7)+", "+(this.e03>0?(this.e03*1e7+.5|0)/1e7:(this.e03*1e7-.5|0)/1e7)+",\n    "+(this.e10>0?(this.e10*1e7+.5|0)/1e7:(this.e10*1e7-.5|0)/1e7)+", "+(this.e11>0?(this.e11*1e7+.5|0)/1e7:(this.e11*1e7-.5|0)/1e7)+", "+(this.e12>0?(this.e12*1e7+.5|0)/1e7:(this.e12*1e7-.5|0)/1e7)+", "+(this.e13>0?(this.e13*1e7+.5|0)/1e7:(this.e13*1e7-.5|0)/1e7)+",\n    "+(this.e20>0?(this.e20*1e7+.5|0)/1e7:(this.e20*1e7-.5|0)/1e7)+", "+(this.e21>0?(this.e21*1e7+.5|0)/1e7:(this.e21*1e7-.5|0)/1e7)+", "+(this.e22>0?(this.e22*1e7+.5|0)/1e7:(this.e22*1e7-.5|0)/1e7)+", "+(this.e23>0?(this.e23*1e7+.5|0)/1e7:(this.e23*1e7-.5|0)/1e7)+",\n    "+(this.e30>0?(this.e30*1e7+.5|0)/1e7:(this.e30*1e7-.5|0)/1e7)+", "+(this.e31>0?(this.e31*1e7+.5|0)/1e7:(this.e31*1e7-.5|0)/1e7)+", "+(this.e32>0?(this.e32*1e7+.5|0)/1e7:(this.e32*1e7-.5|0)/1e7)+", "+(this.e33>0?(this.e33*1e7+.5|0)/1e7:(this.e33*1e7-.5|0)/1e7)+"]"}};x.common.MathUtil=class{static abs(a){return a>0?a:-a}static sin(a){return Math.sin(a)}static cos(a){return Math.cos(a)}static tan(a){return Math.tan(a)}static asin(a){return Math.asin(a)}static acos(a){return Math.acos(a)}static atan(a){return Math.atan(a)}static safeAsin(a){return a<=-1?-1.570796326794895:a>=1?1.570796326794895:Math.asin(a)}static safeAcos(a){return a<=-1?3.14159265358979:a>=1?0:Math.acos(a)}static atan2(a,t){return Math.atan2(a,t)}static sqrt(a){return Math.sqrt(a)}static clamp(a,t,i){return a<t?t:a>i?i:a}static rand(){return Math.random()}static randIn(a,t){return a+Math.random()*(t-a)}static randVec3In(a,t){return new x.common.Vec3(a+Math.random()*(t-a),a+Math.random()*(t-a),a+Math.random()*(t-a))}static randVec3(){return new x.common.Vec3(-1+Math.random()*2,-1+Math.random()*2,-1+Math.random()*2)}};x.common.Pool=class{constructor(){var a=new Array(256);this.stackVec3=a,this.sizeVec3=0;var t=new Array(256);this.stackMat3=t,this.sizeMat3=0;var i=new Array(256);this.stackMat4=i,this.sizeMat4=0;var r=new Array(256);this.stackQuat=r,this.sizeQuat=0}vec3(){return this.sizeVec3==0?new x.common.Vec3:this.stackVec3[--this.sizeVec3]}mat3(){return this.sizeMat3==0?new x.common.Mat3:this.stackMat3[--this.sizeMat3]}mat4(){return this.sizeMat4==0?new x.common.Mat4:this.stackMat4[--this.sizeMat4]}quat(){return this.sizeQuat==0?new x.common.Quat:this.stackQuat[--this.sizeQuat]}dispose(a,t,i,r){if(a!=null){if(a.zero(),this.sizeVec3==this.stackVec3.length){for(var o=this.sizeVec3<<1,s=new Array(o),_=s,h=0,v=this.sizeVec3;h<v;){var e=h++;_[e]=this.stackVec3[e],this.stackVec3[e]=null}this.stackVec3=_}this.stackVec3[this.sizeVec3++]=a}if(t!=null){var l=1,u=0,b=0,f=0,n=1,c=0,z=0,p=0,y=1;if(t.e00=l,t.e01=u,t.e02=b,t.e10=f,t.e11=n,t.e12=c,t.e20=z,t.e21=p,t.e22=y,this.sizeMat3==this.stackMat3.length){for(var V=this.sizeMat3<<1,M=new Array(V),I=M,k=0,X=this.sizeMat3;k<X;){var L=k++;I[L]=this.stackMat3[L],this.stackMat3[L]=null}this.stackMat3=I}this.stackMat3[this.sizeMat3++]=t}if(i!=null){var m=1,g=0,N=0,A=0,F=0,P=1,Y=0,R=0,C=0,d=0,Z=1,$=0,K=0,E=0,J=0,B=1;if(i.e00=m,i.e01=g,i.e02=N,i.e03=A,i.e10=F,i.e11=P,i.e12=Y,i.e13=R,i.e20=C,i.e21=d,i.e22=Z,i.e23=$,i.e30=K,i.e31=E,i.e32=J,i.e33=B,this.sizeMat4==this.stackMat4.length){for(var Q=this.sizeMat4<<1,U=new Array(Q),G=U,D=0,H=this.sizeMat4;D<H;){var j=D++;G[j]=this.stackMat4[j],this.stackMat4[j]=null}this.stackMat4=G}this.stackMat4[this.sizeMat4++]=i}if(r!=null){var ia=0,sa=0,W=0,q=1;if(r.x=ia,r.y=sa,r.z=W,r.w=q,this.sizeQuat==this.stackQuat.length){for(var na=this.sizeQuat<<1,oa=new Array(na),aa=oa,T=0,ca=this.sizeQuat;T<ca;){var _a=T++;aa[_a]=this.stackQuat[_a],this.stackQuat[_a]=null}this.stackQuat=aa}this.stackQuat[this.sizeQuat++]=r}}disposeVec3(a){if(a.zero(),this.sizeVec3==this.stackVec3.length){for(var t=this.sizeVec3<<1,i=new Array(t),r=i,o=0,s=this.sizeVec3;o<s;){var _=o++;r[_]=this.stackVec3[_],this.stackVec3[_]=null}this.stackVec3=r}this.stackVec3[this.sizeVec3++]=a}disposeMat3(a){var t=1,i=0,r=0,o=0,s=1,_=0,h=0,v=0,e=1;if(a.e00=t,a.e01=i,a.e02=r,a.e10=o,a.e11=s,a.e12=_,a.e20=h,a.e21=v,a.e22=e,this.sizeMat3==this.stackMat3.length){for(var l=this.sizeMat3<<1,u=new Array(l),b=u,f=0,n=this.sizeMat3;f<n;){var c=f++;b[c]=this.stackMat3[c],this.stackMat3[c]=null}this.stackMat3=b}this.stackMat3[this.sizeMat3++]=a}disposeMat4(a){var t=1,i=0,r=0,o=0,s=0,_=1,h=0,v=0,e=0,l=0,u=1,b=0,f=0,n=0,c=0,z=1;if(a.e00=t,a.e01=i,a.e02=r,a.e03=o,a.e10=s,a.e11=_,a.e12=h,a.e13=v,a.e20=e,a.e21=l,a.e22=u,a.e23=b,a.e30=f,a.e31=n,a.e32=c,a.e33=z,this.sizeMat4==this.stackMat4.length){for(var p=this.sizeMat4<<1,y=new Array(p),V=y,M=0,I=this.sizeMat4;M<I;){var k=M++;V[k]=this.stackMat4[k],this.stackMat4[k]=null}this.stackMat4=V}this.stackMat4[this.sizeMat4++]=a}disposeQuat(a){var t=0,i=0,r=0,o=1;if(a.x=t,a.y=i,a.z=r,a.w=o,this.sizeQuat==this.stackQuat.length){for(var s=this.sizeQuat<<1,_=new Array(s),h=_,v=0,e=this.sizeQuat;v<e;){var l=v++;h[l]=this.stackQuat[l],this.stackQuat[l]=null}this.stackQuat=h}this.stackQuat[this.sizeQuat++]=a}};x.common.Quat=class{constructor(a,t,i,r){r==null&&(r=1),i==null&&(i=0),t==null&&(t=0),a==null&&(a=0),this.x=a,this.y=t,this.z=i,this.w=r,x.common.Quat.numCreations++}identity(){var a=0,t=0,i=0,r=1;return this.x=a,this.y=t,this.z=i,this.w=r,this}init(a,t,i,r){return this.x=a,this.y=t,this.z=i,this.w=r,this}add(a){return new x.common.Quat(this.x+a.x,this.y+a.y,this.z+a.z,this.w+a.w)}sub(a){return new x.common.Quat(this.x-a.x,this.y-a.y,this.z-a.z,this.w-a.w)}scale(a){return new x.common.Quat(this.x*a,this.y*a,this.z*a,this.w*a)}addEq(a){var t=this.x+a.x,i=this.y+a.y,r=this.z+a.z,o=this.w+a.w;return this.x=t,this.y=i,this.z=r,this.w=o,this}subEq(a){var t=this.x-a.x,i=this.y-a.y,r=this.z-a.z,o=this.w-a.w;return this.x=t,this.y=i,this.z=r,this.w=o,this}scaleEq(a){var t=this.x*a,i=this.y*a,r=this.z*a,o=this.w*a;return this.x=t,this.y=i,this.z=r,this.w=o,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w}normalized(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return a>0&&(a=1/a),new x.common.Quat(this.x*a,this.y*a,this.z*a,this.w*a)}normalize(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);a>0&&(a=1/a);var t=this.x*a,i=this.y*a,r=this.z*a,o=this.w*a;return this.x=t,this.y=i,this.z=r,this.w=o,this}setArc(a,t){var i=a.x,r=a.y,o=a.z,s=t.x,_=t.y,h=t.z,v=i*s+r*_+o*h;if(this.w=Math.sqrt((1+v)*.5),this.w==0)return s=i*i,_=r*r,h=o*o,s<_?s<h?(v=1/Math.sqrt(_+h),this.x=0,this.y=o*v,this.z=-r*v):(v=1/Math.sqrt(s+_),this.z=0,this.x=r*v,this.y=-i*v):_<h?(v=1/Math.sqrt(h+s),this.y=0,this.z=i*v,this.x=-o*v):(v=1/Math.sqrt(s+_),this.z=0,this.x=r*v,this.y=-i*v),this;v=.5/this.w;var e=r*h-o*_,l=o*s-i*h,u=i*_-r*s;return this.x=e*v,this.y=l*v,this.z=u*v,this}slerp(a,t){var i,r,o,s,_=this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w;if(_<0?(_=-_,i=-a.x,r=-a.y,o=-a.z,s=-a.w):(i=a.x,r=a.y,o=a.z,s=a.w),_>.999999){var h=new x.common.Quat(this.x+(i-this.x)*t,this.y+(r-this.y)*t,this.z+(o-this.z)*t,this.w+(s-this.w)*t),v=Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z+h.w*h.w);v>0&&(v=1/v);var e=h.x*v,l=h.y*v,u=h.z*v,b=h.w*v;return h.x=e,h.y=l,h.z=u,h.w=b,h}var f=t*Math.acos(_);i-=this.x*_,r-=this.y*_,o-=this.z*_,s-=this.w*_;var n=1/Math.sqrt(i*i+r*r+o*o+s*s);i*=n,r*=n,o*=n,s*=n;var c=Math.sin(f),z=Math.cos(f);return new x.common.Quat(this.x*z+i*c,this.y*z+r*c,this.z*z+o*c,this.w*z+s*c)}copyFrom(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w,this}clone(){return new x.common.Quat(this.x,this.y,this.z,this.w)}fromMat3(a){var t=a.e00,i=a.e11,r=a.e22,o=t+i+r,s;return o>0?(s=Math.sqrt(o+1),this.w=.5*s,s=.5/s,this.x=(a.e21-a.e12)*s,this.y=(a.e02-a.e20)*s,this.z=(a.e10-a.e01)*s):t>i?t>r?(s=Math.sqrt(t-i-r+1),this.x=.5*s,s=.5/s,this.y=(a.e01+a.e10)*s,this.z=(a.e02+a.e20)*s,this.w=(a.e21-a.e12)*s):(s=Math.sqrt(r-t-i+1),this.z=.5*s,s=.5/s,this.x=(a.e02+a.e20)*s,this.y=(a.e12+a.e21)*s,this.w=(a.e10-a.e01)*s):i>r?(s=Math.sqrt(i-r-t+1),this.y=.5*s,s=.5/s,this.x=(a.e01+a.e10)*s,this.z=(a.e12+a.e21)*s,this.w=(a.e02-a.e20)*s):(s=Math.sqrt(r-t-i+1),this.z=.5*s,s=.5/s,this.x=(a.e02+a.e20)*s,this.y=(a.e12+a.e21)*s,this.w=(a.e10-a.e01)*s),this}toMat3(){var a=new x.common.Mat3,t=this.x,i=this.y,r=this.z,o=this.w,s=2*t,_=2*i,h=2*r,v=t*s,e=i*_,l=r*h,u=t*_,b=i*h,f=t*h,n=o*s,c=o*_,z=o*h;return a.e00=1-e-l,a.e01=u-z,a.e02=f+c,a.e10=u+z,a.e11=1-v-l,a.e12=b-n,a.e20=f-c,a.e21=b+n,a.e22=1-v-e,a}toString(){return"Quat["+(this.x>0?(this.x*1e7+.5|0)/1e7:(this.x*1e7-.5|0)/1e7)+" i,\n    "+(this.y>0?(this.y*1e7+.5|0)/1e7:(this.y*1e7-.5|0)/1e7)+" j,\n    "+(this.z>0?(this.z*1e7+.5|0)/1e7:(this.z*1e7-.5|0)/1e7)+" k,\n    "+(this.w>0?(this.w*1e7+.5|0)/1e7:(this.w*1e7-.5|0)/1e7)+"]"}};x.dynamics||(x.dynamics={});x.dynamics.Contact=class{constructor(){this._next=null,this._prev=null,this._link1=new x.dynamics.ContactLink,this._link2=new x.dynamics.ContactLink,this._s1=null,this._s2=null,this._b1=null,this._b2=null,this._detector=null,this._cachedDetectorData=new x.collision.narrowphase.detector.CachedDetectorData,this._detectorResult=new x.collision.narrowphase.DetectorResult,this._latest=!1,this._shouldBeSkipped=!1,this._manifold=new x.dynamics.constraint.contact.Manifold,this._updater=new x.dynamics.constraint.contact.ManifoldUpdater(this._manifold),this._contactConstraint=new x.dynamics.constraint.contact.ContactConstraint(this._manifold),this._touching=!1}_updateManifold(){if(this._detector!=null){var a=this._touching,t=this._detectorResult;this._detector.detect(t,this._s1._geom,this._s2._geom,this._s1._transform,this._s2._transform,this._cachedDetectorData);var i=t.numPoints;if(this._touching=i>0,this._touching?(this._manifold._buildBasis(t.normal),t.getMaxDepth()>x.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold?this._contactConstraint._positionCorrectionAlgorithm=x.common.Setting.alternativeContactPositionCorrectionAlgorithm:this._contactConstraint._positionCorrectionAlgorithm=x.common.Setting.defaultContactPositionCorrectionAlgorithm,t.incremental?this._updater.incrementalUpdate(t,this._b1._transform,this._b2._transform):this._updater.totalUpdate(t,this._b1._transform,this._b2._transform)):this._manifold._clear(),this._touching&&!a){var r=this._s1._contactCallback,o=this._s2._contactCallback;r==o&&(o=null),r!=null&&r.beginContact(this),o!=null&&o.beginContact(this)}if(!this._touching&&a){var s=this._s1._contactCallback,_=this._s2._contactCallback;s==_&&(_=null),s!=null&&s.endContact(this),_!=null&&_.endContact(this)}if(this._touching){var h=this._s1._contactCallback,v=this._s2._contactCallback;h==v&&(v=null),h!=null&&h.preSolve(this),v!=null&&v.preSolve(this)}}}_postSolve(){var a=this._s1._contactCallback,t=this._s2._contactCallback;a==t&&(t=null),a!=null&&a.postSolve(this),t!=null&&t.postSolve(this)}getShape1(){return this._s1}getShape2(){return this._s2}isTouching(){return this._touching}getManifold(){return this._manifold}getContactConstraint(){return this._contactConstraint}getPrev(){return this._prev}getNext(){return this._next}};x.dynamics.ContactLink=class{constructor(){this._prev=null,this._next=null,this._contact=null,this._other=null}getContact(){return this._contact}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}};x.dynamics.ContactManager=class{constructor(a){this._broadPhase=a,this._collisionMatrix=new x.collision.narrowphase.CollisionMatrix,this._numContacts=0}createContacts(){for(var a=this._broadPhase._proxyPairList;a!=null;){for(var t=a._next;;){var i,r;if(a._p1._id<a._p2._id?(i=a._p1.userData,r=a._p2.userData):(i=a._p2.userData,r=a._p1.userData),!this.shouldCollide(i,r))break;var o=i._rigidBody,s=r._rigidBody,_=o._numContactLinks,h=s._numContactLinks,v;_<h?v=o._contactLinkList:v=s._contactLinkList;for(var e=i._id,l=r._id,u=!1;v!=null;){var b=v._next,f=v._contact;if(f._s1._id==e&&f._s2._id==l){f._latest=!0,u=!0;break}v=b}if(!u){var n=this._contactPool;n!=null?(this._contactPool=n._next,n._next=null):n=new x.dynamics.Contact;var c=n;this._contactList==null?(this._contactList=c,this._contactListLast=c):(this._contactListLast._next=c,c._prev=this._contactListLast,this._contactListLast=c),c._latest=!0;var z=this._collisionMatrix.detectors[i._geom._type][r._geom._type];c._s1=i,c._s2=r,c._b1=i._rigidBody,c._b2=r._rigidBody,c._touching=!1,c._b1._contactLinkList==null?(c._b1._contactLinkList=c._link1,c._b1._contactLinkListLast=c._link1):(c._b1._contactLinkListLast._next=c._link1,c._link1._prev=c._b1._contactLinkListLast,c._b1._contactLinkListLast=c._link1),c._b2._contactLinkList==null?(c._b2._contactLinkList=c._link2,c._b2._contactLinkListLast=c._link2):(c._b2._contactLinkListLast._next=c._link2,c._link2._prev=c._b2._contactLinkListLast,c._b2._contactLinkListLast=c._link2),c._b1._numContactLinks++,c._b2._numContactLinks++,c._link1._other=c._b2,c._link2._other=c._b1,c._link1._contact=c,c._link2._contact=c,c._detector=z;var p=c._contactConstraint;p._s1=i,p._s2=r,p._b1=p._s1._rigidBody,p._b2=p._s2._rigidBody,p._tf1=p._b1._transform,p._tf2=p._b2._transform,this._numContacts++}break}a=t}}destroyOutdatedContacts(){for(var a=this._broadPhase._incremental,t=this._contactList;t!=null;){for(var i=t._next;;){if(t._latest){t._latest=!1,t._shouldBeSkipped=!1;break}if(!a){var r=t._prev,o=t._next;if(r!=null&&(r._next=o),o!=null&&(o._prev=r),t==this._contactList&&(this._contactList=this._contactList._next),t==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),t._next=null,t._prev=null,t._touching){var s=t._s1._contactCallback,_=t._s2._contactCallback;s==_&&(_=null),s!=null&&s.endContact(t),_!=null&&_.endContact(t)}var h=t._link1._prev,v=t._link1._next;h!=null&&(h._next=v),v!=null&&(v._prev=h),t._link1==t._b1._contactLinkList&&(t._b1._contactLinkList=t._b1._contactLinkList._next),t._link1==t._b1._contactLinkListLast&&(t._b1._contactLinkListLast=t._b1._contactLinkListLast._prev),t._link1._next=null,t._link1._prev=null;var e=t._link2._prev,l=t._link2._next;e!=null&&(e._next=l),l!=null&&(l._prev=e),t._link2==t._b2._contactLinkList&&(t._b2._contactLinkList=t._b2._contactLinkList._next),t._link2==t._b2._contactLinkListLast&&(t._b2._contactLinkListLast=t._b2._contactLinkListLast._prev),t._link2._next=null,t._link2._prev=null,t._b1._numContactLinks--,t._b2._numContactLinks--,t._link1._other=null,t._link2._other=null,t._link1._contact=null,t._link2._contact=null,t._s1=null,t._s2=null,t._b1=null,t._b2=null,t._touching=!1,t._cachedDetectorData._clear(),t._manifold._clear(),t._detector=null;var u=t._contactConstraint;u._s1=null,u._s2=null,u._b1=null,u._b2=null,u._tf1=null,u._tf2=null,t._next=this._contactPool,this._contactPool=t,this._numContacts--;break}var b=t._s1,f=t._s2,n=b._rigidBody,c=f._rigidBody,z=!n._sleeping&&n._type!=1,p=!c._sleeping&&c._type!=1;if(!z&&!p){t._shouldBeSkipped=!0;break}var y=b._aabb,V=f._aabb,M=b._proxy,I=f._proxy;if(!(M._aabbMinX<I._aabbMaxX&&M._aabbMaxX>I._aabbMinX&&M._aabbMinY<I._aabbMaxY&&M._aabbMaxY>I._aabbMinY&&M._aabbMinZ<I._aabbMaxZ&&M._aabbMaxZ>I._aabbMinZ)||!this.shouldCollide(b,f)){var k=t._prev,X=t._next;if(k!=null&&(k._next=X),X!=null&&(X._prev=k),t==this._contactList&&(this._contactList=this._contactList._next),t==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),t._next=null,t._prev=null,t._touching){var L=t._s1._contactCallback,m=t._s2._contactCallback;L==m&&(m=null),L!=null&&L.endContact(t),m!=null&&m.endContact(t)}var g=t._link1._prev,N=t._link1._next;g!=null&&(g._next=N),N!=null&&(N._prev=g),t._link1==t._b1._contactLinkList&&(t._b1._contactLinkList=t._b1._contactLinkList._next),t._link1==t._b1._contactLinkListLast&&(t._b1._contactLinkListLast=t._b1._contactLinkListLast._prev),t._link1._next=null,t._link1._prev=null;var A=t._link2._prev,F=t._link2._next;A!=null&&(A._next=F),F!=null&&(F._prev=A),t._link2==t._b2._contactLinkList&&(t._b2._contactLinkList=t._b2._contactLinkList._next),t._link2==t._b2._contactLinkListLast&&(t._b2._contactLinkListLast=t._b2._contactLinkListLast._prev),t._link2._next=null,t._link2._prev=null,t._b1._numContactLinks--,t._b2._numContactLinks--,t._link1._other=null,t._link2._other=null,t._link1._contact=null,t._link2._contact=null,t._s1=null,t._s2=null,t._b1=null,t._b2=null,t._touching=!1,t._cachedDetectorData._clear(),t._manifold._clear(),t._detector=null;var P=t._contactConstraint;P._s1=null,P._s2=null,P._b1=null,P._b2=null,P._tf1=null,P._tf2=null,t._next=this._contactPool,this._contactPool=t,this._numContacts--;break}var Y=y._minX<V._maxX&&y._maxX>V._minX&&y._minY<V._maxY&&y._maxY>V._minY&&y._minZ<V._maxZ&&y._maxZ>V._minZ;t._shouldBeSkipped=!Y;break}t=i}}shouldCollide(a,t){var i=a._rigidBody,r=t._rigidBody;if(i==r||i._type!=0&&r._type!=0||!(a._collisionGroup&t._collisionMask)||!(t._collisionGroup&a._collisionMask))return!1;var o,s;for(i._numJointLinks<r._numJointLinks?(o=i._jointLinkList,s=r):(o=r._jointLinkList,s=i);o!=null;){var _=o._next;if(o._other==s&&!o._joint._allowCollision)return!1;o=_}return!0}_updateContacts(){this._broadPhase.collectPairs(),this.createContacts(),this.destroyOutdatedContacts()}_postSolve(){for(var a=this._contactList;a!=null;){var t=a._next;a._touching&&a._postSolve(),a=t}}getNumContacts(){return this._numContacts}getContactList(){return this._contactList}};x.dynamics.Island=class{constructor(){var a=new Array(x.common.Setting.islandInitialRigidBodyArraySize);this.rigidBodies=a;var t=new Array(x.common.Setting.islandInitialConstraintArraySize);this.solvers=t;var i=new Array(x.common.Setting.islandInitialConstraintArraySize);this.solversSi=i;var r=new Array(x.common.Setting.islandInitialConstraintArraySize);this.solversNgs=r,this.numRigidBodies=0,this.numSolvers=0,this.numSolversSi=0,this.numSolversNgs=0}_clear(){for(;this.numRigidBodies>0;)this.rigidBodies[--this.numRigidBodies]=null;for(;this.numSolvers>0;)this.solvers[--this.numSolvers]=null;for(;this.numSolversSi>0;)this.solversSi[--this.numSolversSi]=null;for(;this.numSolversNgs>0;)this.solversNgs[--this.numSolversNgs]=null}_addRigidBody(a){if(this.numRigidBodies==this.rigidBodies.length){for(var t=this.numRigidBodies<<1,i=new Array(t),r=i,o=0,s=this.numRigidBodies;o<s;){var _=o++;r[_]=this.rigidBodies[_],this.rigidBodies[_]=null}this.rigidBodies=r}a._addedToIsland=!0,this.rigidBodies[this.numRigidBodies++]=a}_addConstraintSolver(a,t){if(this.numSolvers==this.solvers.length){for(var i=this.numSolvers<<1,r=new Array(i),o=r,s=0,_=this.numSolvers;s<_;){var h=s++;o[h]=this.solvers[h],this.solvers[h]=null}this.solvers=o}if(a._addedToIsland=!0,this.solvers[this.numSolvers++]=a,t==x.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE){if(this.numSolversSi==this.solversSi.length){for(var v=this.numSolversSi<<1,e=new Array(v),l=e,u=0,b=this.numSolversSi;u<b;){var f=u++;l[f]=this.solversSi[f],this.solversSi[f]=null}this.solversSi=l}this.solversSi[this.numSolversSi++]=a}if(t==x.dynamics.constraint.PositionCorrectionAlgorithm.NGS){if(this.numSolversNgs==this.solversNgs.length){for(var n=this.numSolversNgs<<1,c=new Array(n),z=c,p=0,y=this.numSolversNgs;p<y;){var V=p++;z[V]=this.solversNgs[V],this.solversNgs[V]=null}this.solversNgs=z}this.solversNgs[this.numSolversNgs++]=a}}_stepSingleRigidBody(a,t){var i=a.dt,r=t._ptransform,o=t._transform;if(r._positionX=o._positionX,r._positionY=o._positionY,r._positionZ=o._positionZ,r._rotation00=o._rotation00,r._rotation01=o._rotation01,r._rotation02=o._rotation02,r._rotation10=o._rotation10,r._rotation11=o._rotation11,r._rotation12=o._rotation12,r._rotation20=o._rotation20,r._rotation21=o._rotation21,r._rotation22=o._rotation22,t._linearContactImpulseX=0,t._linearContactImpulseY=0,t._linearContactImpulseZ=0,t._angularContactImpulseX=0,t._angularContactImpulseY=0,t._angularContactImpulseZ=0,t._autoSleep&&t._velX*t._velX+t._velY*t._velY+t._velZ*t._velZ<x.common.Setting.sleepingVelocityThreshold*x.common.Setting.sleepingVelocityThreshold&&t._angVelX*t._angVelX+t._angVelY*t._angVelY+t._angVelZ*t._angVelZ<x.common.Setting.sleepingAngularVelocityThreshold*x.common.Setting.sleepingAngularVelocityThreshold?(t._sleepTime+=i,t._sleepTime>x.common.Setting.sleepingTimeThreshold&&(t._sleeping=!0,t._sleepTime=0)):t._sleepTime=0,!t._sleeping){if(t._type==0){var s=i*t._linearDamping,_=s*s,h=1/(1+s+_*(.5+s*.16666666666666666+_*.041666666666666664)),v=i*t._angularDamping,e=v*v,l=1/(1+v+e*(.5+v*.16666666666666666+e*.041666666666666664)),u,b,f,n,c,z;u=this.gravityX*t._gravityScale,b=this.gravityY*t._gravityScale,f=this.gravityZ*t._gravityScale,u+=t._forceX*t._invMass,b+=t._forceY*t._invMass,f+=t._forceZ*t._invMass;var p,y,V;p=t._invInertia00*t._torqueX+t._invInertia01*t._torqueY+t._invInertia02*t._torqueZ,y=t._invInertia10*t._torqueX+t._invInertia11*t._torqueY+t._invInertia12*t._torqueZ,V=t._invInertia20*t._torqueX+t._invInertia21*t._torqueY+t._invInertia22*t._torqueZ,n=p,c=y,z=V,t._velX+=u*i,t._velY+=b*i,t._velZ+=f*i,t._velX*=h,t._velY*=h,t._velZ*=h,t._angVelX+=n*i,t._angVelY+=c*i,t._angVelZ+=z*i,t._angVelX*=l,t._angVelY*=l,t._angVelZ*=l}t._integrate(i);for(var M=t._shapeList;M!=null;){var I=M._next,k=M._ptransform,X=M._localTransform,L=t._ptransform,m,g,N,A,F,P,Y,R,C;m=L._rotation00*X._rotation00+L._rotation01*X._rotation10+L._rotation02*X._rotation20,g=L._rotation00*X._rotation01+L._rotation01*X._rotation11+L._rotation02*X._rotation21,N=L._rotation00*X._rotation02+L._rotation01*X._rotation12+L._rotation02*X._rotation22,A=L._rotation10*X._rotation00+L._rotation11*X._rotation10+L._rotation12*X._rotation20,F=L._rotation10*X._rotation01+L._rotation11*X._rotation11+L._rotation12*X._rotation21,P=L._rotation10*X._rotation02+L._rotation11*X._rotation12+L._rotation12*X._rotation22,Y=L._rotation20*X._rotation00+L._rotation21*X._rotation10+L._rotation22*X._rotation20,R=L._rotation20*X._rotation01+L._rotation21*X._rotation11+L._rotation22*X._rotation21,C=L._rotation20*X._rotation02+L._rotation21*X._rotation12+L._rotation22*X._rotation22,k._rotation00=m,k._rotation01=g,k._rotation02=N,k._rotation10=A,k._rotation11=F,k._rotation12=P,k._rotation20=Y,k._rotation21=R,k._rotation22=C;var d,Z,$;d=L._rotation00*X._positionX+L._rotation01*X._positionY+L._rotation02*X._positionZ,Z=L._rotation10*X._positionX+L._rotation11*X._positionY+L._rotation12*X._positionZ,$=L._rotation20*X._positionX+L._rotation21*X._positionY+L._rotation22*X._positionZ,k._positionX=d,k._positionY=Z,k._positionZ=$,k._positionX+=L._positionX,k._positionY+=L._positionY,k._positionZ+=L._positionZ;var K=M._transform,E=M._localTransform,J=t._transform,B,Q,U,G,D,H,j,ia,sa;B=J._rotation00*E._rotation00+J._rotation01*E._rotation10+J._rotation02*E._rotation20,Q=J._rotation00*E._rotation01+J._rotation01*E._rotation11+J._rotation02*E._rotation21,U=J._rotation00*E._rotation02+J._rotation01*E._rotation12+J._rotation02*E._rotation22,G=J._rotation10*E._rotation00+J._rotation11*E._rotation10+J._rotation12*E._rotation20,D=J._rotation10*E._rotation01+J._rotation11*E._rotation11+J._rotation12*E._rotation21,H=J._rotation10*E._rotation02+J._rotation11*E._rotation12+J._rotation12*E._rotation22,j=J._rotation20*E._rotation00+J._rotation21*E._rotation10+J._rotation22*E._rotation20,ia=J._rotation20*E._rotation01+J._rotation21*E._rotation11+J._rotation22*E._rotation21,sa=J._rotation20*E._rotation02+J._rotation21*E._rotation12+J._rotation22*E._rotation22,K._rotation00=B,K._rotation01=Q,K._rotation02=U,K._rotation10=G,K._rotation11=D,K._rotation12=H,K._rotation20=j,K._rotation21=ia,K._rotation22=sa;var W,q,na;W=J._rotation00*E._positionX+J._rotation01*E._positionY+J._rotation02*E._positionZ,q=J._rotation10*E._positionX+J._rotation11*E._positionY+J._rotation12*E._positionZ,na=J._rotation20*E._positionX+J._rotation21*E._positionY+J._rotation22*E._positionZ,K._positionX=W,K._positionY=q,K._positionZ=na,K._positionX+=J._positionX,K._positionY+=J._positionY,K._positionZ+=J._positionZ;var oa,aa,T,ca,_a,w;if(M._geom._computeAabb(M._aabb,M._ptransform),oa=M._aabb._minX,aa=M._aabb._minY,T=M._aabb._minZ,ca=M._aabb._maxX,_a=M._aabb._maxY,w=M._aabb._maxZ,M._geom._computeAabb(M._aabb,M._transform),M._aabb._minX=oa<M._aabb._minX?oa:M._aabb._minX,M._aabb._minY=aa<M._aabb._minY?aa:M._aabb._minY,M._aabb._minZ=T<M._aabb._minZ?T:M._aabb._minZ,M._aabb._maxX=ca>M._aabb._maxX?ca:M._aabb._maxX,M._aabb._maxY=_a>M._aabb._maxY?_a:M._aabb._maxY,M._aabb._maxZ=w>M._aabb._maxZ?w:M._aabb._maxZ,M._proxy!=null){var ta,ra,la;ta=M._transform._positionX-M._ptransform._positionX,ra=M._transform._positionY-M._ptransform._positionY,la=M._transform._positionZ-M._ptransform._positionZ;var va=M.displacement;va.x=ta,va.y=ra,va.z=la,M._rigidBody._world._broadPhase.moveProxy(M._proxy,M._aabb,M.displacement)}M=I}}}_step(a,t,i){for(var r=a.dt,o=!0,s=0,_=this.numRigidBodies;s<_;){var h=s++,v=this.rigidBodies[h],e=v._ptransform,l=v._transform;if(e._positionX=l._positionX,e._positionY=l._positionY,e._positionZ=l._positionZ,e._rotation00=l._rotation00,e._rotation01=l._rotation01,e._rotation02=l._rotation02,e._rotation10=l._rotation10,e._rotation11=l._rotation11,e._rotation12=l._rotation12,e._rotation20=l._rotation20,e._rotation21=l._rotation21,e._rotation22=l._rotation22,v._linearContactImpulseX=0,v._linearContactImpulseY=0,v._linearContactImpulseZ=0,v._angularContactImpulseX=0,v._angularContactImpulseY=0,v._angularContactImpulseZ=0,v._sleeping=!1,v._autoSleep&&v._velX*v._velX+v._velY*v._velY+v._velZ*v._velZ<x.common.Setting.sleepingVelocityThreshold*x.common.Setting.sleepingVelocityThreshold&&v._angVelX*v._angVelX+v._angVelY*v._angVelY+v._angVelZ*v._angVelZ<x.common.Setting.sleepingAngularVelocityThreshold*x.common.Setting.sleepingAngularVelocityThreshold?v._sleepTime+=r:v._sleepTime=0,v._sleepTime<x.common.Setting.sleepingTimeThreshold&&(o=!1),v._type==0){var u=r*v._linearDamping,b=u*u,f=1/(1+u+b*(.5+u*.16666666666666666+b*.041666666666666664)),n=r*v._angularDamping,c=n*n,z=1/(1+n+c*(.5+n*.16666666666666666+c*.041666666666666664)),p,y,V,M,I,k;p=this.gravityX*v._gravityScale,y=this.gravityY*v._gravityScale,V=this.gravityZ*v._gravityScale,p+=v._forceX*v._invMass,y+=v._forceY*v._invMass,V+=v._forceZ*v._invMass;var X,L,m;X=v._invInertia00*v._torqueX+v._invInertia01*v._torqueY+v._invInertia02*v._torqueZ,L=v._invInertia10*v._torqueX+v._invInertia11*v._torqueY+v._invInertia12*v._torqueZ,m=v._invInertia20*v._torqueX+v._invInertia21*v._torqueY+v._invInertia22*v._torqueZ,M=X,I=L,k=m,v._velX+=p*r,v._velY+=y*r,v._velZ+=V*r,v._velX*=f,v._velY*=f,v._velZ*=f,v._angVelX+=M*r,v._angVelY+=I*r,v._angVelZ+=k*r,v._angVelX*=z,v._angVelY*=z,v._angVelZ*=z}}if(o){for(var g=0,N=this.numRigidBodies;g<N;){var A=g++,F=this.rigidBodies[A];F._sleeping=!0,F._sleepTime=0}return}for(var P=0,Y=this.numSolvers;P<Y;){var R=P++,C=this.solvers[R];C.preSolveVelocity(a)}for(var d=0,Z=this.numSolvers;d<Z;){var $=d++,K=this.solvers[$];K.warmStart(a)}for(var E=0,J=t;E<J;){E++;for(var B=0,Q=this.numSolvers;B<Q;){var U=B++,G=this.solvers[U];G.solveVelocity()}}for(var D=0,H=this.numSolvers;D<H;){var j=D++,ia=this.solvers[j];ia.postSolveVelocity(a)}for(var sa=0,W=this.numRigidBodies;sa<W;){var q=sa++,na=this.rigidBodies[q];na._integrate(r)}for(var oa=0,aa=this.numSolversSi;oa<aa;){var T=oa++,ca=this.solversSi[T];ca.preSolvePosition(a)}for(var _a=0,w=i;_a<w;){_a++;for(var ta=0,ra=this.numSolversSi;ta<ra;){var la=ta++,va=this.solversSi[la];va.solvePositionSplitImpulse()}}for(var xa=0,za=this.numRigidBodies;xa<za;){var Ma=xa++,Xa=this.rigidBodies[Ma];Xa._integratePseudoVelocity()}for(var Za=0,fa=this.numSolversNgs;Za<fa;){var ba=Za++,ea=this.solversNgs[ba];ea.preSolvePosition(a)}for(var ha=0,ma=i;ha<ma;){ha++;for(var ya=0,da=this.numSolversNgs;ya<da;){var pa=ya++,Ya=this.solversNgs[pa];Ya.solvePositionNgs(a)}}for(var Qa=0,ga=this.numSolvers;Qa<ga;){var ua=Qa++,wa=this.solvers[ua];wa.postSolve()}for(var ka=0,Sa=this.numRigidBodies;ka<Sa;)for(var zt=ka++,Ha=this.rigidBodies[zt],Ba=Ha._shapeList;Ba!=null;){var nt=Ba._next,Ea=Ba._ptransform,Fa=Ba._localTransform,Aa=Ha._ptransform,ft,Wa,Ka,bt,it,$a,_t,gt,pt;ft=Aa._rotation00*Fa._rotation00+Aa._rotation01*Fa._rotation10+Aa._rotation02*Fa._rotation20,Wa=Aa._rotation00*Fa._rotation01+Aa._rotation01*Fa._rotation11+Aa._rotation02*Fa._rotation21,Ka=Aa._rotation00*Fa._rotation02+Aa._rotation01*Fa._rotation12+Aa._rotation02*Fa._rotation22,bt=Aa._rotation10*Fa._rotation00+Aa._rotation11*Fa._rotation10+Aa._rotation12*Fa._rotation20,it=Aa._rotation10*Fa._rotation01+Aa._rotation11*Fa._rotation11+Aa._rotation12*Fa._rotation21,$a=Aa._rotation10*Fa._rotation02+Aa._rotation11*Fa._rotation12+Aa._rotation12*Fa._rotation22,_t=Aa._rotation20*Fa._rotation00+Aa._rotation21*Fa._rotation10+Aa._rotation22*Fa._rotation20,gt=Aa._rotation20*Fa._rotation01+Aa._rotation21*Fa._rotation11+Aa._rotation22*Fa._rotation21,pt=Aa._rotation20*Fa._rotation02+Aa._rotation21*Fa._rotation12+Aa._rotation22*Fa._rotation22,Ea._rotation00=ft,Ea._rotation01=Wa,Ea._rotation02=Ka,Ea._rotation10=bt,Ea._rotation11=it,Ea._rotation12=$a,Ea._rotation20=_t,Ea._rotation21=gt,Ea._rotation22=pt;var Ga,rt,ut;Ga=Aa._rotation00*Fa._positionX+Aa._rotation01*Fa._positionY+Aa._rotation02*Fa._positionZ,rt=Aa._rotation10*Fa._positionX+Aa._rotation11*Fa._positionY+Aa._rotation12*Fa._positionZ,ut=Aa._rotation20*Fa._positionX+Aa._rotation21*Fa._positionY+Aa._rotation22*Fa._positionZ,Ea._positionX=Ga,Ea._positionY=rt,Ea._positionZ=ut,Ea._positionX+=Aa._positionX,Ea._positionY+=Aa._positionY,Ea._positionZ+=Aa._positionZ;var Da=Ba._transform,Ta=Ba._localTransform,Na=Ha._transform,Vt,St,et,Xt,Yt,Mt,Ia,O,Va;Vt=Na._rotation00*Ta._rotation00+Na._rotation01*Ta._rotation10+Na._rotation02*Ta._rotation20,St=Na._rotation00*Ta._rotation01+Na._rotation01*Ta._rotation11+Na._rotation02*Ta._rotation21,et=Na._rotation00*Ta._rotation02+Na._rotation01*Ta._rotation12+Na._rotation02*Ta._rotation22,Xt=Na._rotation10*Ta._rotation00+Na._rotation11*Ta._rotation10+Na._rotation12*Ta._rotation20,Yt=Na._rotation10*Ta._rotation01+Na._rotation11*Ta._rotation11+Na._rotation12*Ta._rotation21,Mt=Na._rotation10*Ta._rotation02+Na._rotation11*Ta._rotation12+Na._rotation12*Ta._rotation22,Ia=Na._rotation20*Ta._rotation00+Na._rotation21*Ta._rotation10+Na._rotation22*Ta._rotation20,O=Na._rotation20*Ta._rotation01+Na._rotation21*Ta._rotation11+Na._rotation22*Ta._rotation21,Va=Na._rotation20*Ta._rotation02+Na._rotation21*Ta._rotation12+Na._rotation22*Ta._rotation22,Da._rotation00=Vt,Da._rotation01=St,Da._rotation02=et,Da._rotation10=Xt,Da._rotation11=Yt,Da._rotation12=Mt,Da._rotation20=Ia,Da._rotation21=O,Da._rotation22=Va;var lt,S,wt;lt=Na._rotation00*Ta._positionX+Na._rotation01*Ta._positionY+Na._rotation02*Ta._positionZ,S=Na._rotation10*Ta._positionX+Na._rotation11*Ta._positionY+Na._rotation12*Ta._positionZ,wt=Na._rotation20*Ta._positionX+Na._rotation21*Ta._positionY+Na._rotation22*Ta._positionZ,Da._positionX=lt,Da._positionY=S,Da._positionZ=wt,Da._positionX+=Na._positionX,Da._positionY+=Na._positionY,Da._positionZ+=Na._positionZ;var Bt,At,yt,kt,mt,ht;if(Ba._geom._computeAabb(Ba._aabb,Ba._ptransform),Bt=Ba._aabb._minX,At=Ba._aabb._minY,yt=Ba._aabb._minZ,kt=Ba._aabb._maxX,mt=Ba._aabb._maxY,ht=Ba._aabb._maxZ,Ba._geom._computeAabb(Ba._aabb,Ba._transform),Ba._aabb._minX=Bt<Ba._aabb._minX?Bt:Ba._aabb._minX,Ba._aabb._minY=At<Ba._aabb._minY?At:Ba._aabb._minY,Ba._aabb._minZ=yt<Ba._aabb._minZ?yt:Ba._aabb._minZ,Ba._aabb._maxX=kt>Ba._aabb._maxX?kt:Ba._aabb._maxX,Ba._aabb._maxY=mt>Ba._aabb._maxY?mt:Ba._aabb._maxY,Ba._aabb._maxZ=ht>Ba._aabb._maxZ?ht:Ba._aabb._maxZ,Ba._proxy!=null){var xt,Ra,st;xt=Ba._transform._positionX-Ba._ptransform._positionX,Ra=Ba._transform._positionY-Ba._ptransform._positionY,st=Ba._transform._positionZ-Ba._ptransform._positionZ;var Ca=Ba.displacement;Ca.x=xt,Ca.y=Ra,Ca.z=st,Ba._rigidBody._world._broadPhase.moveProxy(Ba._proxy,Ba._aabb,Ba.displacement)}Ba=nt}}};x.dynamics.TimeStep=class{constructor(){this.dt=0,this.invDt=0,this.dtRatio=1}};x.dynamics.World=class{constructor(a,t){switch(a==null&&(a=2),a){case 1:this._broadPhase=new x.collision.broadphase.bruteforce.BruteForceBroadPhase;break;case 2:this._broadPhase=new x.collision.broadphase.bvh.BvhBroadPhase;break}this._contactManager=new x.dynamics.ContactManager(this._broadPhase),t==null&&(t=new x.common.Vec3(0,-9.80665,0)),this._gravity=new x.common.Vec3(t.x,t.y,t.z),this._rigidBodyList=null,this._rigidBodyListLast=null,this._jointList=null,this._jointListLast=null,this._numRigidBodies=0,this._numShapes=0,this._numJoints=0,this._numIslands=0,this._numVelocityIterations=10,this._numPositionIterations=5,this._rayCastWrapper=new x.dynamics._World.RayCastWrapper,this._convexCastWrapper=new x.dynamics._World.ConvexCastWrapper,this._aabbTestWrapper=new x.dynamics._World.AabbTestWrapper,this._island=new x.dynamics.Island;var i=new Array(x.common.Setting.islandInitialConstraintArraySize);this._solversInIslands=i;var r=new Array(x.common.Setting.islandInitialRigidBodyArraySize);this._rigidBodyStack=r,this._timeStep=new x.dynamics.TimeStep,this._pool=new x.common.Pool,this._shapeIdCount=0}_updateContacts(){var a=Date.now()/1e3;this._contactManager._updateContacts();var t=Date.now()/1e3;x.dynamics.common.Performance.broadPhaseCollisionTime=(t-a)*1e3;for(var i=Date.now()/1e3,r=this._contactManager._contactList;r!=null;){var o=r._next;r._shouldBeSkipped||r._updateManifold(),r=o}var s=Date.now()/1e3;x.dynamics.common.Performance.narrowPhaseCollisionTime=(s-i)*1e3}_solveIslands(){var a=Date.now()/1e3;if(x.common.Setting.disableSleeping)for(var t=this._rigidBodyList;t!=null;){var i=t._next;t._sleeping=!1,t._sleepTime=0,t=i}if(this._rigidBodyStack.length<this._numRigidBodies){for(var r=this._rigidBodyStack.length<<1;r<this._numRigidBodies;)r<<=1;var o=new Array(r);this._rigidBodyStack=o}this._numIslands=0;var s=this._island,_=this._gravity;s.gravityX=_.x,s.gravityY=_.y,s.gravityZ=_.z;var h=this._rigidBodyList;for(this._numSolversInIslands=0;h!=null;){for(var v=h._next;!(h._addedToIsland||h._sleeping||h._type==1);){if(h._numContactLinks==0&&h._numJointLinks==0){this._island._stepSingleRigidBody(this._timeStep,h),this._numIslands++;break}this.buildIsland(h),this._island._step(this._timeStep,this._numVelocityIterations,this._numPositionIterations),this._island._clear(),this._numIslands++;break}h=v}for(this._contactManager._postSolve(),h=this._rigidBodyList;h!=null;){var e=h._next;h._addedToIsland=!1,h=e}for(h=this._rigidBodyList;h!=null;){var l=h._next;h._forceX=0,h._forceY=0,h._forceZ=0,h._torqueX=0,h._torqueY=0,h._torqueZ=0,h=l}for(;this._numSolversInIslands>0;)this._solversInIslands[--this._numSolversInIslands]._addedToIsland=!1,this._solversInIslands[this._numSolversInIslands]=null;var u=Date.now()/1e3;x.dynamics.common.Performance.dynamicsTime=(u-a)*1e3}buildIsland(a){var t=1;for(this._island._addRigidBody(a),this._rigidBodyStack[0]=a;t>0;){var i=this._rigidBodyStack[--t];if(this._rigidBodyStack[t]=null,i._type!=1){for(var r=i._contactLinkList;r!=null;){var o=r._next,s=r._contact._contactConstraint,_=r._contact._contactConstraint._solver;if(s.isTouching()&&!_._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){for(var h=this._numSolversInIslands<<1,v=new Array(h),e=v,l=0,u=this._numSolversInIslands;l<u;){var b=l++;e[b]=this._solversInIslands[b],this._solversInIslands[b]=null}this._solversInIslands=e}this._solversInIslands[this._numSolversInIslands++]=_,this._island._addConstraintSolver(_,s._positionCorrectionAlgorithm);var f=r._other;f._addedToIsland||(this._island._addRigidBody(f),this._rigidBodyStack[t++]=f)}r=o}for(var n=i._jointLinkList;n!=null;){var c=n._next,z=n._joint,p=z._solver;if(!p._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){for(var y=this._numSolversInIslands<<1,V=new Array(y),M=V,I=0,k=this._numSolversInIslands;I<k;){var X=I++;M[X]=this._solversInIslands[X],this._solversInIslands[X]=null}this._solversInIslands=M}this._solversInIslands[this._numSolversInIslands++]=p,this._island._addConstraintSolver(p,z._positionCorrectionAlgorithm);var L=n._other;L._addedToIsland||(this._island._addRigidBody(L),this._rigidBodyStack[t++]=L)}n=c}}}}_drawBvh(a,t){a.drawBvh&&this._drawBvhNode(a,t._root,0,a.style.bvhNodeColor)}_drawBvhNode(a,t,i,r){if(t!=null){if(i>=a.drawBvhMinLevel&&i<=a.drawBvhMaxLevel){var o=this._pool,s=o.sizeVec3==0?new x.common.Vec3:o.stackVec3[--o.sizeVec3],_=this._pool,h=_.sizeVec3==0?new x.common.Vec3:_.stackVec3[--_.sizeVec3],v=s;v.x=t._aabbMinX,v.y=t._aabbMinY,v.z=t._aabbMinZ;var e=h;e.x=t._aabbMaxX,e.y=t._aabbMaxY,e.z=t._aabbMaxZ,a.aabb(s,h,r);var l=this._pool,u=null,b=null,f=null;if(s!=null){if(s.zero(),l.sizeVec3==l.stackVec3.length){for(var n=l.sizeVec3<<1,c=new Array(n),z=c,p=0,y=l.sizeVec3;p<y;){var V=p++;z[V]=l.stackVec3[V],l.stackVec3[V]=null}l.stackVec3=z}l.stackVec3[l.sizeVec3++]=s}if(u!=null){var M=1,I=0,k=0,X=0,L=1,m=0,g=0,N=0,A=1;if(u.e00=M,u.e01=I,u.e02=k,u.e10=X,u.e11=L,u.e12=m,u.e20=g,u.e21=N,u.e22=A,l.sizeMat3==l.stackMat3.length){for(var F=l.sizeMat3<<1,P=new Array(F),Y=P,R=0,C=l.sizeMat3;R<C;){var d=R++;Y[d]=l.stackMat3[d],l.stackMat3[d]=null}l.stackMat3=Y}l.stackMat3[l.sizeMat3++]=u}if(b!=null){var Z=1,$=0,K=0,E=0,J=0,B=1,Q=0,U=0,G=0,D=0,H=1,j=0,ia=0,sa=0,W=0,q=1;if(b.e00=Z,b.e01=$,b.e02=K,b.e03=E,b.e10=J,b.e11=B,b.e12=Q,b.e13=U,b.e20=G,b.e21=D,b.e22=H,b.e23=j,b.e30=ia,b.e31=sa,b.e32=W,b.e33=q,l.sizeMat4==l.stackMat4.length){for(var na=l.sizeMat4<<1,oa=new Array(na),aa=oa,T=0,ca=l.sizeMat4;T<ca;){var _a=T++;aa[_a]=l.stackMat4[_a],l.stackMat4[_a]=null}l.stackMat4=aa}l.stackMat4[l.sizeMat4++]=b}if(f!=null){var w=0,ta=0,ra=0,la=1;if(f.x=w,f.y=ta,f.z=ra,f.w=la,l.sizeQuat==l.stackQuat.length){for(var va=l.sizeQuat<<1,xa=new Array(va),za=xa,Ma=0,Xa=l.sizeQuat;Ma<Xa;){var Za=Ma++;za[Za]=l.stackQuat[Za],l.stackQuat[Za]=null}l.stackQuat=za}l.stackQuat[l.sizeQuat++]=f}var fa=this._pool,ba=null,ea=null,ha=null;if(h!=null){if(h.zero(),fa.sizeVec3==fa.stackVec3.length){for(var ma=fa.sizeVec3<<1,ya=new Array(ma),da=ya,pa=0,Ya=fa.sizeVec3;pa<Ya;){var Qa=pa++;da[Qa]=fa.stackVec3[Qa],fa.stackVec3[Qa]=null}fa.stackVec3=da}fa.stackVec3[fa.sizeVec3++]=h}if(ba!=null){var ga=1,ua=0,wa=0,ka=0,Sa=1,zt=0,Ha=0,Ba=0,nt=1;if(ba.e00=ga,ba.e01=ua,ba.e02=wa,ba.e10=ka,ba.e11=Sa,ba.e12=zt,ba.e20=Ha,ba.e21=Ba,ba.e22=nt,fa.sizeMat3==fa.stackMat3.length){for(var Ea=fa.sizeMat3<<1,Fa=new Array(Ea),Aa=Fa,ft=0,Wa=fa.sizeMat3;ft<Wa;){var Ka=ft++;Aa[Ka]=fa.stackMat3[Ka],fa.stackMat3[Ka]=null}fa.stackMat3=Aa}fa.stackMat3[fa.sizeMat3++]=ba}if(ea!=null){var bt=1,it=0,$a=0,_t=0,gt=0,pt=1,Ga=0,rt=0,ut=0,Da=0,Ta=1,Na=0,Vt=0,St=0,et=0,Xt=1;if(ea.e00=bt,ea.e01=it,ea.e02=$a,ea.e03=_t,ea.e10=gt,ea.e11=pt,ea.e12=Ga,ea.e13=rt,ea.e20=ut,ea.e21=Da,ea.e22=Ta,ea.e23=Na,ea.e30=Vt,ea.e31=St,ea.e32=et,ea.e33=Xt,fa.sizeMat4==fa.stackMat4.length){for(var Yt=fa.sizeMat4<<1,Mt=new Array(Yt),Ia=Mt,O=0,Va=fa.sizeMat4;O<Va;){var lt=O++;Ia[lt]=fa.stackMat4[lt],fa.stackMat4[lt]=null}fa.stackMat4=Ia}fa.stackMat4[fa.sizeMat4++]=ea}if(ha!=null){var S=0,wt=0,Bt=0,At=1;if(ha.x=S,ha.y=wt,ha.z=Bt,ha.w=At,fa.sizeQuat==fa.stackQuat.length){for(var yt=fa.sizeQuat<<1,kt=new Array(yt),mt=kt,ht=0,xt=fa.sizeQuat;ht<xt;){var Ra=ht++;mt[Ra]=fa.stackQuat[Ra],fa.stackQuat[Ra]=null}fa.stackQuat=mt}fa.stackQuat[fa.sizeQuat++]=ha}}this._drawBvhNode(a,t._children[0],i+1,r),this._drawBvhNode(a,t._children[1],i+1,r)}}_drawRigidBodies(a){for(var t=a.style,i=this._rigidBodyList;i!=null;){var r=i._next;if(a.drawBases){var o=a.style;a.basis(i._transform,o.basisLength,o.basisColorX,o.basisColorY,o.basisColorZ)}var s=null,_=i._type==0;_||(s=i._type==2?t.kinematicShapeColor:t.staticShapeColor);for(var h=i._shapeList;h!=null;){var v=h._next;if(_&&(h._id&1?s=i._sleeping?t.sleepingShapeColor2:i._sleepTime>x.common.Setting.sleepingTimeThreshold?t.sleepyShapeColor2:t.shapeColor2:s=i._sleeping?t.sleepingShapeColor1:i._sleepTime>x.common.Setting.sleepingTimeThreshold?t.sleepyShapeColor1:t.shapeColor1),a.drawShapes){var e=h._geom,l=h._transform;switch(e._type){case 0:a.sphere(l,e._radius,s);break;case 1:var u=e,b=this._pool,f=b.sizeVec3==0?new x.common.Vec3:b.stackVec3[--b.sizeVec3],n=f;n.x=u._halfExtentsX,n.y=u._halfExtentsY,n.z=u._halfExtentsZ,a.box(l,f,s);var c=this._pool,z=null,p=null,y=null;if(f!=null){if(f.zero(),c.sizeVec3==c.stackVec3.length){for(var V=c.sizeVec3<<1,M=new Array(V),I=M,k=0,X=c.sizeVec3;k<X;){var L=k++;I[L]=c.stackVec3[L],c.stackVec3[L]=null}c.stackVec3=I}c.stackVec3[c.sizeVec3++]=f}if(z!=null){var m=1,g=0,N=0,A=0,F=1,P=0,Y=0,R=0,C=1;if(z.e00=m,z.e01=g,z.e02=N,z.e10=A,z.e11=F,z.e12=P,z.e20=Y,z.e21=R,z.e22=C,c.sizeMat3==c.stackMat3.length){for(var d=c.sizeMat3<<1,Z=new Array(d),$=Z,K=0,E=c.sizeMat3;K<E;){var J=K++;$[J]=c.stackMat3[J],c.stackMat3[J]=null}c.stackMat3=$}c.stackMat3[c.sizeMat3++]=z}if(p!=null){var B=1,Q=0,U=0,G=0,D=0,H=1,j=0,ia=0,sa=0,W=0,q=1,na=0,oa=0,aa=0,T=0,ca=1;if(p.e00=B,p.e01=Q,p.e02=U,p.e03=G,p.e10=D,p.e11=H,p.e12=j,p.e13=ia,p.e20=sa,p.e21=W,p.e22=q,p.e23=na,p.e30=oa,p.e31=aa,p.e32=T,p.e33=ca,c.sizeMat4==c.stackMat4.length){for(var _a=c.sizeMat4<<1,w=new Array(_a),ta=w,ra=0,la=c.sizeMat4;ra<la;){var va=ra++;ta[va]=c.stackMat4[va],c.stackMat4[va]=null}c.stackMat4=ta}c.stackMat4[c.sizeMat4++]=p}if(y!=null){var xa=0,za=0,Ma=0,Xa=1;if(y.x=xa,y.y=za,y.z=Ma,y.w=Xa,c.sizeQuat==c.stackQuat.length){for(var Za=c.sizeQuat<<1,fa=new Array(Za),ba=fa,ea=0,ha=c.sizeQuat;ea<ha;){var ma=ea++;ba[ma]=c.stackQuat[ma],c.stackQuat[ma]=null}c.stackQuat=ba}c.stackQuat[c.sizeQuat++]=y}break;case 2:var ya=e;a.cylinder(l,ya._radius,ya._halfHeight,s);break;case 3:var da=e;a.cone(l,da._radius,da._halfHeight,s);break;case 4:var pa=e;a.capsule(l,pa._radius,pa._halfHeight,s);break;case 5:var Ya=e,Qa=Ya._numVertices,ga=this._pool,ua=ga.sizeVec3==0?new x.common.Vec3:ga.stackVec3[--ga.sizeVec3],wa=this._pool,ka=wa.sizeVec3==0?new x.common.Vec3:wa.stackVec3[--wa.sizeVec3],Sa=this._pool,zt=Sa.sizeVec3==0?new x.common.Vec3:Sa.stackVec3[--Sa.sizeVec3],Ha=this._pool,Ba=Ha.sizeVec3==0?new x.common.Vec3:Ha.stackVec3[--Ha.sizeVec3],nt=this._pool,Ea=nt.sizeVec3==0?new x.common.Vec3:nt.stackVec3[--nt.sizeVec3],Fa=this._pool,Aa=Fa.sizeVec3==0?new x.common.Vec3:Fa.stackVec3[--Fa.sizeVec3],ft=this._pool,Wa=ft.sizeMat3==0?new x.common.Mat3:ft.stackMat3[--ft.sizeMat3],Ka=this._pool,bt=Ka.sizeVec3==0?new x.common.Vec3:Ka.stackVec3[--Ka.sizeVec3],it=Wa;it.e00=l._rotation00,it.e01=l._rotation01,it.e02=l._rotation02,it.e10=l._rotation10,it.e11=l._rotation11,it.e12=l._rotation12,it.e20=l._rotation20,it.e21=l._rotation21,it.e22=l._rotation22;var $a=bt;$a.x=l._positionX,$a.y=l._positionY,$a.z=l._positionZ;for(var _t=0,gt=Qa;_t<gt;){var pt=_t++,Ga=Ya._tmpVertices[pt],rt=Ya._vertices[pt];Ga.x=rt.x,Ga.y=rt.y,Ga.z=rt.z;var ut=Ga,Da=ut.x*Wa.e00+ut.y*Wa.e01+ut.z*Wa.e02,Ta=ut.x*Wa.e10+ut.y*Wa.e11+ut.z*Wa.e12,Na=ut.x*Wa.e20+ut.y*Wa.e21+ut.z*Wa.e22;ut.x=Da,ut.y=Ta,ut.z=Na;var Vt=ut,St=Vt.x+bt.x,et=Vt.y+bt.y,Xt=Vt.z+bt.z;Vt.x=St,Vt.y=et,Vt.z=Xt}if(Qa>30)for(var Yt=0,Mt=Qa;Yt<Mt;){var Ia=Yt++,O=Ya._tmpVertices[Ia];ua.x=O.x,ua.y=O.y,ua.z=O.z;var Va=Ya._tmpVertices[(Ia+1)%Qa];ka.x=Va.x,ka.y=Va.y,ka.z=Va.z,a.line(ua,ka,s)}else if(this._debugDraw.wireframe||Qa>10)for(var lt=0,S=Qa;lt<S;){var wt=lt++,Bt=Ya._tmpVertices[wt];ua.x=Bt.x,ua.y=Bt.y,ua.z=Bt.z;for(var At=0,yt=wt;At<yt;){var kt=At++,mt=Ya._tmpVertices[kt];ka.x=mt.x,ka.y=mt.y,ka.z=mt.z,a.line(ua,ka,s)}}else for(var ht=0,xt=Qa;ht<xt;){var Ra=ht++,st=Ya._tmpVertices[Ra];ua.x=st.x,ua.y=st.y,ua.z=st.z;for(var Ca=0,vt=Ra;Ca<vt;){var qa=Ca++,at=Ya._tmpVertices[qa];ka.x=at.x,ka.y=at.y,ka.z=at.z;for(var Oa=0,tt=qa;Oa<tt;){var ct=Oa++,Pa=Ya._tmpVertices[ct];zt.x=Pa.x,zt.y=Pa.y,zt.z=Pa.z,Ba.x=ka.x,Ba.y=ka.y,Ba.z=ka.z;var Ja=Ba,ja=Ja.x-ua.x,La=Ja.y-ua.y,ot=Ja.z-ua.z;Ja.x=ja,Ja.y=La,Ja.z=ot,Ea.x=zt.x,Ea.y=zt.y,Ea.z=zt.z;var It=Ea,oi=It.x-ua.x,gi=It.y-ua.y,ai=It.z-ua.z;It.x=oi,It.y=gi,It.z=ai,Aa.x=Ba.x,Aa.y=Ba.y,Aa.z=Ba.z;var Ct=Aa,_i=Ct.y*Ea.z-Ct.z*Ea.y,Et=Ct.z*Ea.x-Ct.x*Ea.z,Pt=Ct.x*Ea.y-Ct.y*Ea.x;Ct.x=_i,Ct.y=Et,Ct.z=Pt;var Jt=Ct,Ki=Math.sqrt(Jt.x*Jt.x+Jt.y*Jt.y+Jt.z*Jt.z);Ki>0&&(Ki=1/Ki);var vi=Jt.x*Ki,li=Jt.y*Ki,ti=Jt.z*Ki;Jt.x=vi,Jt.y=li,Jt.z=ti,a.triangle(ua,ka,zt,Aa,Aa,Aa,s);var Oi=-Aa.x,Xi=-Aa.y,zi=-Aa.z;Aa.x=Oi,Aa.y=Xi,Aa.z=zi,a.triangle(ua,zt,ka,Aa,Aa,Aa,s)}}}var Zt=this._pool,ri=null,Wt=null,ni=null;if(ua!=null){if(ua.zero(),Zt.sizeVec3==Zt.stackVec3.length){for(var $i=Zt.sizeVec3<<1,Ut=new Array($i),ji=Ut,Ii=0,pr=Zt.sizeVec3;Ii<pr;){var Wi=Ii++;ji[Wi]=Zt.stackVec3[Wi],Zt.stackVec3[Wi]=null}Zt.stackVec3=ji}Zt.stackVec3[Zt.sizeVec3++]=ua}if(ri!=null){var Lt=1,jt=0,Tt=0,bi=0,Mi=1,vr=0,qt=0,fi=0,dt=1;if(ri.e00=Lt,ri.e01=jt,ri.e02=Tt,ri.e10=bi,ri.e11=Mi,ri.e12=vr,ri.e20=qt,ri.e21=fi,ri.e22=dt,Zt.sizeMat3==Zt.stackMat3.length){for(var ui=Zt.sizeMat3<<1,hi=new Array(ui),er=hi,Xr=0,ro=Zt.sizeMat3;Xr<ro;){var Gt=Xr++;er[Gt]=Zt.stackMat3[Gt],Zt.stackMat3[Gt]=null}Zt.stackMat3=er}Zt.stackMat3[Zt.sizeMat3++]=ri}if(Wt!=null){var fr=1,mr=0,Dt=0,dr=0,Pi=0,Dr=1,Hn=0,oo=0,Br=0,no=0,yn=1,Ao=0,Io=0,xi=0,qr=0,Ar=1;if(Wt.e00=fr,Wt.e01=mr,Wt.e02=Dt,Wt.e03=dr,Wt.e10=Pi,Wt.e11=Dr,Wt.e12=Hn,Wt.e13=oo,Wt.e20=Br,Wt.e21=no,Wt.e22=yn,Wt.e23=Ao,Wt.e30=Io,Wt.e31=xi,Wt.e32=qr,Wt.e33=Ar,Zt.sizeMat4==Zt.stackMat4.length){for(var yr=Zt.sizeMat4<<1,Po=new Array(yr),Di=Po,Pr=0,gr=Zt.sizeMat4;Pr<gr;){var Rt=Pr++;Di[Rt]=Zt.stackMat4[Rt],Zt.stackMat4[Rt]=null}Zt.stackMat4=Di}Zt.stackMat4[Zt.sizeMat4++]=Wt}if(ni!=null){var Hi=0,Li=0,Cn=0,Ms=1;if(ni.x=Hi,ni.y=Li,ni.z=Cn,ni.w=Ms,Zt.sizeQuat==Zt.stackQuat.length){for(var je=Zt.sizeQuat<<1,ps=new Array(je),Te=ps,qe=0,D_=Zt.sizeQuat;qe<D_;){var gn=qe++;Te[gn]=Zt.stackQuat[gn],Zt.stackQuat[gn]=null}Zt.stackQuat=Te}Zt.stackQuat[Zt.sizeQuat++]=ni}var Si=this._pool,No=null,Wr=null,ke=null;if(ka!=null){if(ka.zero(),Si.sizeVec3==Si.stackVec3.length){for(var on=Si.sizeVec3<<1,Tn=new Array(on),Kn=Tn,we=0,k_=Si.sizeVec3;we<k_;){var Re=we++;Kn[Re]=Si.stackVec3[Re],Si.stackVec3[Re]=null}Si.stackVec3=Kn}Si.stackVec3[Si.sizeVec3++]=ka}if(No!=null){var Vi=1,Ir=0,ur=0,eo=0,Rn=1,ms=0,nn=0,Qn=0,ci=1;if(No.e00=Vi,No.e01=Ir,No.e02=ur,No.e10=eo,No.e11=Rn,No.e12=ms,No.e20=nn,No.e21=Qn,No.e22=ci,Si.sizeMat3==Si.stackMat3.length){for(var ho=Si.sizeMat3<<1,Fr=new Array(ho),En=Fr,as=0,Qe=Si.sizeMat3;as<Qe;){var Ee=as++;En[Ee]=Si.stackMat3[Ee],Si.stackMat3[Ee]=null}Si.stackMat3=En}Si.stackMat3[Si.sizeMat3++]=No}if(Wr!=null){var De=1,he=0,ii=0,ir=0,Qi=0,Fi=1,fo=0,So=0,s_=0,Fe=0,ts=1,Dn=0,co=0,Ft=0,Ni=0,lr=1;if(Wr.e00=De,Wr.e01=he,Wr.e02=ii,Wr.e03=ir,Wr.e10=Qi,Wr.e11=Fi,Wr.e12=fo,Wr.e13=So,Wr.e20=s_,Wr.e21=Fe,Wr.e22=ts,Wr.e23=Dn,Wr.e30=co,Wr.e31=Ft,Wr.e32=Ni,Wr.e33=lr,Si.sizeMat4==Si.stackMat4.length){for(var Vo=Si.sizeMat4<<1,ce=new Array(Vo),Xe=ce,Le=0,uo=Si.sizeMat4;Le<uo;){var $t=Le++;Xe[$t]=Si.stackMat4[$t],Si.stackMat4[$t]=null}Si.stackMat4=Xe}Si.stackMat4[Si.sizeMat4++]=Wr}if(ke!=null){var Vr=0,sr=0,Jo=0,Ns=1;if(ke.x=Vr,ke.y=sr,ke.z=Jo,ke.w=Ns,Si.sizeQuat==Si.stackQuat.length){for(var Co=Si.sizeQuat<<1,ko=new Array(Co),Nr=ko,Sr=0,Cr=Si.sizeQuat;Sr<Cr;){var Lr=Sr++;Nr[Lr]=Si.stackQuat[Lr],Si.stackQuat[Lr]=null}Si.stackQuat=Nr}Si.stackQuat[Si.sizeQuat++]=ke}var Qt=this._pool,Ji=null,Yi=null,Ri=null;if(zt!=null){if(zt.zero(),Qt.sizeVec3==Qt.stackVec3.length){for(var zr=Qt.sizeVec3<<1,qi=new Array(zr),Jr=qi,Gr=0,ao=Qt.sizeVec3;Gr<ao;){var be=Gr++;Jr[be]=Qt.stackVec3[be],Qt.stackVec3[be]=null}Qt.stackVec3=Jr}Qt.stackVec3[Qt.sizeVec3++]=zt}if(Ji!=null){var ki=1,en=0,Yr=0,Go=0,ys=1,In=0,gs=0,Vn=0,Ci=1;if(Ji.e00=ki,Ji.e01=en,Ji.e02=Yr,Ji.e10=Go,Ji.e11=ys,Ji.e12=In,Ji.e20=gs,Ji.e21=Vn,Ji.e22=Ci,Qt.sizeMat3==Qt.stackMat3.length){for(var To=Qt.sizeMat3<<1,so=new Array(To),Fn=so,Ne=0,Nn=Qt.sizeMat3;Ne<Nn;){var Wo=Ne++;Fn[Wo]=Qt.stackMat3[Wo],Qt.stackMat3[Wo]=null}Qt.stackMat3=Fn}Qt.stackMat3[Qt.sizeMat3++]=Ji}if(Yi!=null){var kn=1,Ye=0,Ot=0,Ro=0,Ur=0,wn=1,Jn=0,fe=0,Is=0,Uo=0,Vs=1,w_=0,Js=0,X_=0,Je=0,F_=1;if(Yi.e00=kn,Yi.e01=Ye,Yi.e02=Ot,Yi.e03=Ro,Yi.e10=Ur,Yi.e11=wn,Yi.e12=Jn,Yi.e13=fe,Yi.e20=Is,Yi.e21=Uo,Yi.e22=Vs,Yi.e23=w_,Yi.e30=Js,Yi.e31=X_,Yi.e32=Je,Yi.e33=F_,Qt.sizeMat4==Qt.stackMat4.length){for(var N_=Qt.sizeMat4<<1,Or=new Array(N_),wo=Or,Xo=0,Gn=Qt.sizeMat4;Xo<Gn;){var wi=Xo++;wo[wi]=Qt.stackMat4[wi],Qt.stackMat4[wi]=null}Qt.stackMat4=wo}Qt.stackMat4[Qt.sizeMat4++]=Yi}if(Ri!=null){var Wn=0,Qo=0,to=0,J_=1;if(Ri.x=Wn,Ri.y=Qo,Ri.z=to,Ri.w=J_,Qt.sizeQuat==Qt.stackQuat.length){for(var G_=Qt.sizeQuat<<1,L_=new Array(G_),is=L_,__=0,v_=Qt.sizeQuat;__<v_;){var rs=__++;is[rs]=Qt.stackQuat[rs],Qt.stackQuat[rs]=null}Qt.stackQuat=is}Qt.stackQuat[Qt.sizeQuat++]=Ri}var pi=this._pool,Oo=null,ar=null,Ze=null;if(Ba!=null){if(Ba.zero(),pi.sizeVec3==pi.stackVec3.length){for(var Gs=pi.sizeVec3<<1,hv=new Array(Gs),ue=hv,Ge=0,$n=pi.sizeVec3;Ge<$n;){var Ws=Ge++;ue[Ws]=pi.stackVec3[Ws],pi.stackVec3[Ws]=null}pi.stackVec3=ue}pi.stackVec3[pi.sizeVec3++]=Ba}if(Oo!=null){var Ti=1,Lo=0,Tr=0,sn=0,ks=1,Y_=0,We=0,jn=0,Xn=1;if(Oo.e00=Ti,Oo.e01=Lo,Oo.e02=Tr,Oo.e10=sn,Oo.e11=ks,Oo.e12=Y_,Oo.e20=We,Oo.e21=jn,Oo.e22=Xn,pi.sizeMat3==pi.stackMat3.length){for(var os=pi.sizeMat3<<1,de=new Array(os),ns=de,Us=0,l_=pi.sizeMat3;Us<l_;){var Be=Us++;ns[Be]=pi.stackMat3[Be],pi.stackMat3[Be]=null}pi.stackMat3=ns}pi.stackMat3[pi.sizeMat3++]=Oo}if(ar!=null){var Ae=1,qn=0,mi=0,xo=0,Zr=0,Ho=1,Yo=0,Hr=0,Eo=0,ws=0,ae=1,Os=0,W_=0,te=0,Nt=0,Kr=1;if(ar.e00=Ae,ar.e01=qn,ar.e02=mi,ar.e03=xo,ar.e10=Zr,ar.e11=Ho,ar.e12=Yo,ar.e13=Hr,ar.e20=Eo,ar.e21=ws,ar.e22=ae,ar.e23=Os,ar.e30=W_,ar.e31=te,ar.e32=Nt,ar.e33=Kr,pi.sizeMat4==pi.stackMat4.length){for(var Do=pi.sizeMat4<<1,Xs=new Array(Do),kv=Xs,i0=0,U_=pi.sizeMat4;i0<U_;){var Ht=i0++;kv[Ht]=pi.stackMat4[Ht],pi.stackMat4[Ht]=null}pi.stackMat4=kv}pi.stackMat4[pi.sizeMat4++]=ar}if(Ze!=null){var Ln=0,Rr=0,Yn=0,Z_=1;if(Ze.x=Ln,Ze.y=Rr,Ze.z=Yn,Ze.w=Z_,pi.sizeQuat==pi.stackQuat.length){for(var Hs=pi.sizeQuat<<1,h_=new Array(Hs),bo=h_,es=0,ss=pi.sizeQuat;es<ss;){var xe=es++;bo[xe]=pi.stackQuat[xe],pi.stackQuat[xe]=null}pi.stackQuat=bo}pi.stackQuat[pi.sizeQuat++]=Ze}var Zi=this._pool,Ko=null,kr=null,Zo=null;if(Ea!=null){if(Ea.zero(),Zi.sizeVec3==Zi.stackVec3.length){for(var Ue=Zi.sizeVec3<<1,cv=new Array(Ue),ze=cv,Ks=0,wv=Zi.sizeVec3;Ks<wv;){var Oe=Ks++;ze[Oe]=Zi.stackVec3[Oe],Zi.stackVec3[Oe]=null}Zi.stackVec3=ze}Zi.stackVec3[Zi.sizeVec3++]=Ea}if(Ko!=null){var ei=1,Zn=0,_n=0,vn=0,d_=1,bv=0,ie=0,Pe=0,c_=1;if(Ko.e00=ei,Ko.e01=Zn,Ko.e02=_n,Ko.e10=vn,Ko.e11=d_,Ko.e12=bv,Ko.e20=ie,Ko.e21=Pe,Ko.e22=c_,Zi.sizeMat3==Zi.stackMat3.length){for(var O_=Zi.sizeMat3<<1,fv=new Array(O_),uv=fv,b_=0,He=Zi.sizeMat3;b_<He;){var zo=b_++;uv[zo]=Zi.stackMat3[zo],Zi.stackMat3[zo]=null}Zi.stackMat3=uv}Zi.stackMat3[Zi.sizeMat3++]=Ko}if(kr!=null){var _s=1,vs=0,Ui=0,Mo=0,_o=0,ls=1,Ls=0,Ys=0,Zs=0,B_=0,Me=1,hs=0,H_=0,$s=0,Un=0,pe=1;if(kr.e00=_s,kr.e01=vs,kr.e02=Ui,kr.e03=Mo,kr.e10=_o,kr.e11=ls,kr.e12=Ls,kr.e13=Ys,kr.e20=Zs,kr.e21=B_,kr.e22=Me,kr.e23=hs,kr.e30=H_,kr.e31=$s,kr.e32=Un,kr.e33=pe,Zi.sizeMat4==Zi.stackMat4.length){for(var Xv=Zi.sizeMat4<<1,A_=new Array(Xv),$o=A_,ln=0,po=Zi.sizeMat4;ln<po;){var Kt=ln++;$o[Kt]=Zi.stackMat4[Kt],Zi.stackMat4[Kt]=null}Zi.stackMat4=$o}Zi.stackMat4[Zi.sizeMat4++]=kr}if(Zo!=null){var $r=0,vo=0,js=0,ds=1;if(Zo.x=$r,Zo.y=vo,Zo.z=js,Zo.w=ds,Zi.sizeQuat==Zi.stackQuat.length){for(var qs=Zi.sizeQuat<<1,P_=new Array(qs),jo=P_,re=0,K_=Zi.sizeQuat;re<K_;){var xv=re++;jo[xv]=Zi.stackQuat[xv],Zi.stackQuat[xv]=null}Zi.stackQuat=jo}Zi.stackQuat[Zi.sizeQuat++]=Zo}var di=this._pool,mo=null,Qr=null,io=null;if(Aa!=null){if(Aa.zero(),di.sizeVec3==di.stackVec3.length){for(var $_=di.sizeVec3<<1,j_=new Array($_),Lv=j_,a_=0,Yv=di.sizeVec3;a_<Yv;){var q_=a_++;Lv[q_]=di.stackVec3[q_],di.stackVec3[q_]=null}di.stackVec3=Lv}di.stackVec3[di.sizeVec3++]=Aa}if(mo!=null){var Bi=1,av=0,Bs=0,As=0,cs=1,bs=0,Ps=0,Zv=0,me=1;if(mo.e00=Bi,mo.e01=av,mo.e02=Bs,mo.e10=As,mo.e11=cs,mo.e12=bs,mo.e20=Ps,mo.e21=Zv,mo.e22=me,di.sizeMat3==di.stackMat3.length){for(var jr=di.sizeMat3<<1,t_=new Array(jr),yo=t_,i_=0,Fo=di.sizeMat3;i_<Fo;){var Ss=i_++;yo[Ss]=di.stackMat3[Ss],di.stackMat3[Ss]=null}di.stackMat3=yo}di.stackMat3[di.sizeMat3++]=mo}if(Qr!=null){var qo=1,ye=0,si=0,an=0,_r=0,oe=1,ge=0,Bo=0,Er=0,dn=0,tv=1,r_=0,S_=0,iv=0,ne=0,Bn=1;if(Qr.e00=qo,Qr.e01=ye,Qr.e02=si,Qr.e03=an,Qr.e10=_r,Qr.e11=oe,Qr.e12=ge,Qr.e13=Bo,Qr.e20=Er,Qr.e21=dn,Qr.e22=tv,Qr.e23=r_,Qr.e30=S_,Qr.e31=iv,Qr.e32=ne,Qr.e33=Bn,di.sizeMat4==di.stackMat4.length){for(var Ie=di.sizeMat4<<1,E0=new Array(Ie),M0=E0,hl=0,D0=di.sizeMat4;hl<D0;){var hr=hl++;M0[hr]=di.stackMat4[hr],di.stackMat4[hr]=null}di.stackMat4=M0}di.stackMat4[di.sizeMat4++]=Qr}if(io!=null){var On=0,go=0,fs=0,rv=1;if(io.x=On,io.y=go,io.z=fs,io.w=rv,di.sizeQuat==di.stackQuat.length){for(var zv=di.sizeQuat<<1,o_=new Array(zv),dv=o_,Cs=0,f_=di.sizeQuat;Cs<f_;){var u_=Cs++;dv[u_]=di.stackQuat[u_],di.stackQuat[u_]=null}di.stackQuat=dv}di.stackQuat[di.sizeQuat++]=io}var Ai=this._pool,Ts=null,lo=null,Se=null;if(Ts!=null){if(Ts.zero(),Ai.sizeVec3==Ai.stackVec3.length){for(var Mv=Ai.sizeVec3<<1,Rs=new Array(Mv),x_=Rs,ov=0,r0=Ai.sizeVec3;ov<r0;){var o0=ov++;x_[o0]=Ai.stackVec3[o0],Ai.stackVec3[o0]=null}Ai.stackVec3=x_}Ai.stackVec3[Ai.sizeVec3++]=Ts}if(Wa!=null){var nv=1,tr=0,Ke=0,An=0,us=1,F0=0,Dv=0,C_=0,p0=1;if(Wa.e00=nv,Wa.e01=tr,Wa.e02=Ke,Wa.e10=An,Wa.e11=us,Wa.e12=F0,Wa.e20=Dv,Wa.e21=C_,Wa.e22=p0,Ai.sizeMat3==Ai.stackMat3.length){for(var Bv=Ai.sizeMat3<<1,n0=new Array(Bv),m0=n0,N0=0,e0=Ai.sizeMat3;N0<e0;){var s0=N0++;m0[s0]=Ai.stackMat3[s0],Ai.stackMat3[s0]=null}Ai.stackMat3=m0}Ai.stackMat3[Ai.sizeMat3++]=Wa}if(lo!=null){var y0=1,Fv=0,cr=0,pv=0,hn=0,Nv=1,Hl=0,g0=0,I0=0,cl=0,dl=1,Jv=0,Kl=0,$l=0,bl=0,Bl=1;if(lo.e00=y0,lo.e01=Fv,lo.e02=cr,lo.e03=pv,lo.e10=hn,lo.e11=Nv,lo.e12=Hl,lo.e13=g0,lo.e20=I0,lo.e21=cl,lo.e22=dl,lo.e23=Jv,lo.e30=Kl,lo.e31=$l,lo.e32=bl,lo.e33=Bl,Ai.sizeMat4==Ai.stackMat4.length){for(var Al=Ai.sizeMat4<<1,jl=new Array(Al),fl=jl,ql=0,ul=Ai.sizeMat4;ql<ul;){var rr=ql++;fl[rr]=Ai.stackMat4[rr],Ai.stackMat4[rr]=null}Ai.stackMat4=fl}Ai.stackMat4[Ai.sizeMat4++]=lo}if(Se!=null){var xs=0,tn=0,mv=0,yh=1;if(Se.x=xs,Se.y=tn,Se.z=mv,Se.w=yh,Ai.sizeQuat==Ai.stackQuat.length){for(var Gv=Ai.sizeQuat<<1,J0=new Array(Gv),xl=J0,V0=0,k0=Ai.sizeQuat;V0<k0;){var G0=V0++;xl[G0]=Ai.stackQuat[G0],Ai.stackQuat[G0]=null}Ai.stackQuat=xl}Ai.stackQuat[Ai.sizeQuat++]=Se}var Mr=this._pool,zs=null,ee=null,_0=null;if(bt!=null){if(bt.zero(),Mr.sizeVec3==Mr.stackVec3.length){for(var Pl=Mr.sizeVec3<<1,lh=new Array(Pl),W0=lh,hh=0,U0=Mr.sizeVec3;hh<U0;){var Sl=hh++;W0[Sl]=Mr.stackVec3[Sl],Mr.stackVec3[Sl]=null}Mr.stackVec3=W0}Mr.stackVec3[Mr.sizeVec3++]=bt}if(zs!=null){var zl=1,Ce=0,w0=0,z_=0,Cl=1,O0=0,H0=0,Tl=0,Ml=1;if(zs.e00=zl,zs.e01=Ce,zs.e02=w0,zs.e10=z_,zs.e11=Cl,zs.e12=O0,zs.e20=H0,zs.e21=Tl,zs.e22=Ml,Mr.sizeMat3==Mr.stackMat3.length){for(var X0=Mr.sizeMat3<<1,v0=new Array(X0),M_=v0,Wv=0,Uv=Mr.sizeMat3;Wv<Uv;){var ev=Wv++;M_[ev]=Mr.stackMat3[ev],Mr.stackMat3[ev]=null}Mr.stackMat3=M_}Mr.stackMat3[Mr.sizeMat3++]=zs}if(ee!=null){var L0=1,Av=0,l0=0,se=0,h0=0,Y0=1,Qs=0,K0=0,yi=0,cn=0,wr=1,Ov=0,c0=0,ch=0,ah=0,p_=1;if(ee.e00=L0,ee.e01=Av,ee.e02=l0,ee.e03=se,ee.e10=h0,ee.e11=Y0,ee.e12=Qs,ee.e13=K0,ee.e20=yi,ee.e21=cn,ee.e22=wr,ee.e23=Ov,ee.e30=c0,ee.e31=ch,ee.e32=ah,ee.e33=p_,Mr.sizeMat4==Mr.stackMat4.length){for(var $e=Mr.sizeMat4<<1,Es=new Array($e),th=Es,bh=0,Rl=Mr.sizeMat4;bh<Rl;){var br=bh++;th[br]=Mr.stackMat4[br],Mr.stackMat4[br]=null}Mr.stackMat4=th}Mr.stackMat4[Mr.sizeMat4++]=ee}if(_0!=null){var n_=0,bn=0,yv=0,$0=1;if(_0.x=n_,_0.y=bn,_0.z=yv,_0.w=$0,Mr.sizeQuat==Mr.stackQuat.length){for(var gv=Mr.sizeQuat<<1,pl=new Array(gv),ml=pl,yl=0,T_=Mr.sizeQuat;yl<T_;){var Pv=yl++;ml[Pv]=Mr.stackQuat[Pv],Mr.stackQuat[Pv]=null}Mr.stackQuat=ml}Mr.stackQuat[Mr.sizeQuat++]=_0}break}}if(a.drawAabbs){var Pn=h._aabb,Iv=t.aabbColor,Sv=this._pool,R_=Sv.sizeVec3==0?new x.common.Vec3:Sv.stackVec3[--Sv.sizeVec3],_e=this._pool,Q_=_e.sizeVec3==0?new x.common.Vec3:_e.stackVec3[--_e.sizeVec3],Cv=R_;Cv.x=Pn._minX,Cv.y=Pn._minY,Cv.z=Pn._minZ;var Hv=Q_;Hv.x=Pn._maxX,Hv.y=Pn._maxY,Hv.z=Pn._maxZ,a.aabb(R_,Q_,Iv);var or=this._pool,m_=null,ve=null,Gi=null;if(R_!=null){if(R_.zero(),or.sizeVec3==or.stackVec3.length){for(var y_=or.sizeVec3<<1,Sn=new Array(y_),j0=Sn,b0=0,fh=or.sizeVec3;b0<fh;){var q0=b0++;j0[q0]=or.stackVec3[q0],or.stackVec3[q0]=null}or.stackVec3=j0}or.stackVec3[or.sizeVec3++]=R_}if(m_!=null){var al=1,gl=0,Z0=0,uh=0,Il=1,gh=0,ih=0,Vl=0,d0=1;if(m_.e00=al,m_.e01=gl,m_.e02=Z0,m_.e10=uh,m_.e11=Il,m_.e12=gh,m_.e20=ih,m_.e21=Vl,m_.e22=d0,or.sizeMat3==or.stackMat3.length){for(var B0=or.sizeMat3<<1,kl=new Array(B0),rh=kl,Kv=0,Ql=or.sizeMat3;Kv<Ql;){var $v=Kv++;rh[$v]=or.stackMat3[$v],or.stackMat3[$v]=null}or.stackMat3=rh}or.stackMat3[or.sizeMat3++]=m_}if(ve!=null){var nr=1,g_=0,rn=0,wl=0,A0=0,oh=1,El=0,tl=0,Dl=0,P0=0,nh=1,eh=0,Fl=0,Nl=0,sv=0,Tv=1;if(ve.e00=nr,ve.e01=g_,ve.e02=rn,ve.e03=wl,ve.e10=A0,ve.e11=oh,ve.e12=El,ve.e13=tl,ve.e20=Dl,ve.e21=P0,ve.e22=nh,ve.e23=eh,ve.e30=Fl,ve.e31=Nl,ve.e32=sv,ve.e33=Tv,or.sizeMat4==or.stackMat4.length){for(var jv=or.sizeMat4<<1,Ds=new Array(jv),xh=Ds,f0=0,Xl=or.sizeMat4;f0<Xl;){var Rv=f0++;xh[Rv]=or.stackMat4[Rv],or.stackMat4[Rv]=null}or.stackMat4=xh}or.stackMat4[or.sizeMat4++]=ve}if(Gi!=null){var qv=0,Qv=0,u0=0,Zh=1;if(Gi.x=qv,Gi.y=Qv,Gi.z=u0,Gi.w=Zh,or.sizeQuat==or.stackQuat.length){for(var S0=or.sizeQuat<<1,a0=new Array(S0),Jl=a0,Gl=0,zh=or.sizeQuat;Gl<zh;){var Ev=Gl++;Jl[Ev]=or.stackQuat[Ev],or.stackQuat[Ev]=null}or.stackQuat=Jl}or.stackQuat[or.sizeQuat++]=Gi}var xr=this._pool,Ve=null,le=null,C0=null;if(Q_!=null){if(Q_.zero(),xr.sizeVec3==xr.stackVec3.length){for(var Wl=xr.sizeVec3<<1,Fs=new Array(Wl),x0=Fs,Ll=0,Ul=xr.sizeVec3;Ll<Ul;){var Ol=Ll++;x0[Ol]=xr.stackVec3[Ol],xr.stackVec3[Ol]=null}xr.stackVec3=x0}xr.stackVec3[xr.sizeVec3++]=Q_}if(Ve!=null){var Ih=1,_v=0,vv=0,T0=0,I_=1,Yl=0,Vh=0,dh=0,t0=1;if(Ve.e00=Ih,Ve.e01=_v,Ve.e02=vv,Ve.e10=T0,Ve.e11=I_,Ve.e12=Yl,Ve.e20=Vh,Ve.e21=dh,Ve.e22=t0,xr.sizeMat3==xr.stackMat3.length){for(var lv=xr.sizeMat3<<1,kh=new Array(lv),Zl=kh,wh=0,Kh=xr.sizeMat3;wh<Kh;){var sh=wh++;Zl[sh]=xr.stackMat3[sh],xr.stackMat3[sh]=null}xr.stackMat3=Zl}xr.stackMat3[xr.sizeMat3++]=Ve}if(le!=null){var Ei=1,e_=0,V_=0,_h=0,Bh=0,Ah=1,Mh=0,Vv=0,Rh=0,Qh=0,$h=1,jh=0,ph=0,Ph=0,il=0,ic=1;if(le.e00=Ei,le.e01=e_,le.e02=V_,le.e03=_h,le.e10=Bh,le.e11=Ah,le.e12=Mh,le.e13=Vv,le.e20=Rh,le.e21=Qh,le.e22=$h,le.e23=jh,le.e30=ph,le.e31=Ph,le.e32=il,le.e33=ic,xr.sizeMat4==xr.stackMat4.length){for(var Xh=xr.sizeMat4<<1,E_=new Array(Xh),Eh=E_,mh=0,qh=xr.sizeMat4;mh<qh;){var Lh=mh++;Eh[Lh]=xr.stackMat4[Lh],xr.stackMat4[Lh]=null}xr.stackMat4=Eh}xr.stackMat4[xr.sizeMat4++]=le}if(C0!=null){var ac=0,Sh=0,R0=0,rc=1;if(C0.x=ac,C0.y=Sh,C0.z=R0,C0.w=rc,xr.sizeQuat==xr.stackQuat.length){for(var vh=xr.sizeQuat<<1,Yh=new Array(vh),Dh=Yh,Ch=0,Q0=xr.sizeQuat;Ch<Q0;){var z0=Ch++;Dh[z0]=xr.stackQuat[z0],xr.stackQuat[z0]=null}xr.stackQuat=Dh}xr.stackQuat[xr.sizeQuat++]=C0}}h=v}i=r}}_drawConstraints(a){var t=a.style;if(a.drawPairs||a.drawContacts)for(var i=this._contactManager._contactList;i!=null;){var r=i._next;if(a.drawPairs){var o=t.pairColor,s=this._pool,_=s.sizeVec3==0?new x.common.Vec3:s.stackVec3[--s.sizeVec3],h=this._pool,v=h.sizeVec3==0?new x.common.Vec3:h.stackVec3[--h.sizeVec3],e=_;e.x=i._s1._transform._positionX,e.y=i._s1._transform._positionY,e.z=i._s1._transform._positionZ;var l=v;l.x=i._s2._transform._positionX,l.y=i._s2._transform._positionY,l.z=i._s2._transform._positionZ,a.line(_,v,o);var u=this._pool,b=null,f=null,n=null;if(_!=null){if(_.zero(),u.sizeVec3==u.stackVec3.length){for(var c=u.sizeVec3<<1,z=new Array(c),p=z,y=0,V=u.sizeVec3;y<V;){var M=y++;p[M]=u.stackVec3[M],u.stackVec3[M]=null}u.stackVec3=p}u.stackVec3[u.sizeVec3++]=_}if(b!=null){var I=1,k=0,X=0,L=0,m=1,g=0,N=0,A=0,F=1;if(b.e00=I,b.e01=k,b.e02=X,b.e10=L,b.e11=m,b.e12=g,b.e20=N,b.e21=A,b.e22=F,u.sizeMat3==u.stackMat3.length){for(var P=u.sizeMat3<<1,Y=new Array(P),R=Y,C=0,d=u.sizeMat3;C<d;){var Z=C++;R[Z]=u.stackMat3[Z],u.stackMat3[Z]=null}u.stackMat3=R}u.stackMat3[u.sizeMat3++]=b}if(f!=null){var $=1,K=0,E=0,J=0,B=0,Q=1,U=0,G=0,D=0,H=0,j=1,ia=0,sa=0,W=0,q=0,na=1;if(f.e00=$,f.e01=K,f.e02=E,f.e03=J,f.e10=B,f.e11=Q,f.e12=U,f.e13=G,f.e20=D,f.e21=H,f.e22=j,f.e23=ia,f.e30=sa,f.e31=W,f.e32=q,f.e33=na,u.sizeMat4==u.stackMat4.length){for(var oa=u.sizeMat4<<1,aa=new Array(oa),T=aa,ca=0,_a=u.sizeMat4;ca<_a;){var w=ca++;T[w]=u.stackMat4[w],u.stackMat4[w]=null}u.stackMat4=T}u.stackMat4[u.sizeMat4++]=f}if(n!=null){var ta=0,ra=0,la=0,va=1;if(n.x=ta,n.y=ra,n.z=la,n.w=va,u.sizeQuat==u.stackQuat.length){for(var xa=u.sizeQuat<<1,za=new Array(xa),Ma=za,Xa=0,Za=u.sizeQuat;Xa<Za;){var fa=Xa++;Ma[fa]=u.stackQuat[fa],u.stackQuat[fa]=null}u.stackQuat=Ma}u.stackQuat[u.sizeQuat++]=n}var ba=this._pool,ea=null,ha=null,ma=null;if(v!=null){if(v.zero(),ba.sizeVec3==ba.stackVec3.length){for(var ya=ba.sizeVec3<<1,da=new Array(ya),pa=da,Ya=0,Qa=ba.sizeVec3;Ya<Qa;){var ga=Ya++;pa[ga]=ba.stackVec3[ga],ba.stackVec3[ga]=null}ba.stackVec3=pa}ba.stackVec3[ba.sizeVec3++]=v}if(ea!=null){var ua=1,wa=0,ka=0,Sa=0,zt=1,Ha=0,Ba=0,nt=0,Ea=1;if(ea.e00=ua,ea.e01=wa,ea.e02=ka,ea.e10=Sa,ea.e11=zt,ea.e12=Ha,ea.e20=Ba,ea.e21=nt,ea.e22=Ea,ba.sizeMat3==ba.stackMat3.length){for(var Fa=ba.sizeMat3<<1,Aa=new Array(Fa),ft=Aa,Wa=0,Ka=ba.sizeMat3;Wa<Ka;){var bt=Wa++;ft[bt]=ba.stackMat3[bt],ba.stackMat3[bt]=null}ba.stackMat3=ft}ba.stackMat3[ba.sizeMat3++]=ea}if(ha!=null){var it=1,$a=0,_t=0,gt=0,pt=0,Ga=1,rt=0,ut=0,Da=0,Ta=0,Na=1,Vt=0,St=0,et=0,Xt=0,Yt=1;if(ha.e00=it,ha.e01=$a,ha.e02=_t,ha.e03=gt,ha.e10=pt,ha.e11=Ga,ha.e12=rt,ha.e13=ut,ha.e20=Da,ha.e21=Ta,ha.e22=Na,ha.e23=Vt,ha.e30=St,ha.e31=et,ha.e32=Xt,ha.e33=Yt,ba.sizeMat4==ba.stackMat4.length){for(var Mt=ba.sizeMat4<<1,Ia=new Array(Mt),O=Ia,Va=0,lt=ba.sizeMat4;Va<lt;){var S=Va++;O[S]=ba.stackMat4[S],ba.stackMat4[S]=null}ba.stackMat4=O}ba.stackMat4[ba.sizeMat4++]=ha}if(ma!=null){var wt=0,Bt=0,At=0,yt=1;if(ma.x=wt,ma.y=Bt,ma.z=At,ma.w=yt,ba.sizeQuat==ba.stackQuat.length){for(var kt=ba.sizeQuat<<1,mt=new Array(kt),ht=mt,xt=0,Ra=ba.sizeQuat;xt<Ra;){var st=xt++;ht[st]=ba.stackQuat[st],ba.stackQuat[st]=null}ba.stackQuat=ht}ba.stackQuat[ba.sizeQuat++]=ma}}if(a.drawContacts)for(var Ca=i._contactConstraint,vt=i._contactConstraint._manifold._points,qa=0,at=i._contactConstraint._manifold._numPoints;qa<at;){var Oa=qa++,tt=vt[Oa],ct=a.style;Ca._s1._transform,Ca._s2._transform;var Pa=this._pool,Ja=Pa.sizeVec3==0?new x.common.Vec3:Pa.stackVec3[--Pa.sizeVec3],ja=this._pool,La=ja.sizeVec3==0?new x.common.Vec3:ja.stackVec3[--ja.sizeVec3],ot=this._pool,It=ot.sizeVec3==0?new x.common.Vec3:ot.stackVec3[--ot.sizeVec3],oi=this._pool,gi=oi.sizeVec3==0?new x.common.Vec3:oi.stackVec3[--oi.sizeVec3],ai=this._pool,Ct=ai.sizeVec3==0?new x.common.Vec3:ai.stackVec3[--ai.sizeVec3],_i=Ja;_i.x=tt._pos1X,_i.y=tt._pos1Y,_i.z=tt._pos1Z;var Et=La;Et.x=tt._pos2X,Et.y=tt._pos2Y,Et.z=tt._pos2Z;var Pt=It;Pt.x=Ca._manifold._normalX,Pt.y=Ca._manifold._normalY,Pt.z=Ca._manifold._normalZ;var Jt=gi;Jt.x=Ca._manifold._tangentX,Jt.y=Ca._manifold._tangentY,Jt.z=Ca._manifold._tangentZ;var Ki=Ct;if(Ki.x=Ca._manifold._binormalX,Ki.y=Ca._manifold._binormalY,Ki.z=Ca._manifold._binormalZ,tt._disabled)a.point(Ja,ct.disabledContactColor),a.point(La,ct.disabledContactColor),a.line(Ja,La,ct.disabledContactColor);else if(tt._warmStarted){var vi;switch(tt._id&3){case 0:vi=ct.contactColor;break;case 1:vi=ct.contactColor2;break;case 2:vi=ct.contactColor3;break;default:vi=ct.contactColor4}a.point(Ja,vi),a.point(La,vi),a.line(Ja,La,ct.contactColor)}else a.point(Ja,ct.newContactColor),a.point(La,ct.newContactColor),a.line(Ja,La,ct.newContactColor);La.x=Ja.x,La.y=Ja.y,La.z=Ja.z;var li=La,ti=ct.contactNormalLength,Oi=li.x+It.x*ti,Xi=li.y+It.y*ti,zi=li.z+It.z*ti;if(li.x=Oi,li.y=Xi,li.z=zi,a.line(Ja,La,ct.contactNormalColor),a.drawContactBases){La.x=Ja.x,La.y=Ja.y,La.z=Ja.z;var Zt=La,ri=ct.contactTangentLength,Wt=Zt.x+gi.x*ri,ni=Zt.y+gi.y*ri,$i=Zt.z+gi.z*ri;Zt.x=Wt,Zt.y=ni,Zt.z=$i,a.line(Ja,La,ct.contactTangentColor),La.x=Ja.x,La.y=Ja.y,La.z=Ja.z;var Ut=La,ji=ct.contactBinormalLength,Ii=Ut.x+Ct.x*ji,pr=Ut.y+Ct.y*ji,Wi=Ut.z+Ct.z*ji;Ut.x=Ii,Ut.y=pr,Ut.z=Wi,a.line(Ja,La,ct.contactBinormalColor)}var Lt=this._pool,jt=null,Tt=null,bi=null;if(Ja!=null){if(Ja.zero(),Lt.sizeVec3==Lt.stackVec3.length){for(var Mi=Lt.sizeVec3<<1,vr=new Array(Mi),qt=vr,fi=0,dt=Lt.sizeVec3;fi<dt;){var ui=fi++;qt[ui]=Lt.stackVec3[ui],Lt.stackVec3[ui]=null}Lt.stackVec3=qt}Lt.stackVec3[Lt.sizeVec3++]=Ja}if(jt!=null){var hi=1,er=0,Xr=0,ro=0,Gt=1,fr=0,mr=0,Dt=0,dr=1;if(jt.e00=hi,jt.e01=er,jt.e02=Xr,jt.e10=ro,jt.e11=Gt,jt.e12=fr,jt.e20=mr,jt.e21=Dt,jt.e22=dr,Lt.sizeMat3==Lt.stackMat3.length){for(var Pi=Lt.sizeMat3<<1,Dr=new Array(Pi),Hn=Dr,oo=0,Br=Lt.sizeMat3;oo<Br;){var no=oo++;Hn[no]=Lt.stackMat3[no],Lt.stackMat3[no]=null}Lt.stackMat3=Hn}Lt.stackMat3[Lt.sizeMat3++]=jt}if(Tt!=null){var yn=1,Ao=0,Io=0,xi=0,qr=0,Ar=1,yr=0,Po=0,Di=0,Pr=0,gr=1,Rt=0,Hi=0,Li=0,Cn=0,Ms=1;if(Tt.e00=yn,Tt.e01=Ao,Tt.e02=Io,Tt.e03=xi,Tt.e10=qr,Tt.e11=Ar,Tt.e12=yr,Tt.e13=Po,Tt.e20=Di,Tt.e21=Pr,Tt.e22=gr,Tt.e23=Rt,Tt.e30=Hi,Tt.e31=Li,Tt.e32=Cn,Tt.e33=Ms,Lt.sizeMat4==Lt.stackMat4.length){for(var je=Lt.sizeMat4<<1,ps=new Array(je),Te=ps,qe=0,D_=Lt.sizeMat4;qe<D_;){var gn=qe++;Te[gn]=Lt.stackMat4[gn],Lt.stackMat4[gn]=null}Lt.stackMat4=Te}Lt.stackMat4[Lt.sizeMat4++]=Tt}if(bi!=null){var Si=0,No=0,Wr=0,ke=1;if(bi.x=Si,bi.y=No,bi.z=Wr,bi.w=ke,Lt.sizeQuat==Lt.stackQuat.length){for(var on=Lt.sizeQuat<<1,Tn=new Array(on),Kn=Tn,we=0,k_=Lt.sizeQuat;we<k_;){var Re=we++;Kn[Re]=Lt.stackQuat[Re],Lt.stackQuat[Re]=null}Lt.stackQuat=Kn}Lt.stackQuat[Lt.sizeQuat++]=bi}var Vi=this._pool,Ir=null,ur=null,eo=null;if(La!=null){if(La.zero(),Vi.sizeVec3==Vi.stackVec3.length){for(var Rn=Vi.sizeVec3<<1,ms=new Array(Rn),nn=ms,Qn=0,ci=Vi.sizeVec3;Qn<ci;){var ho=Qn++;nn[ho]=Vi.stackVec3[ho],Vi.stackVec3[ho]=null}Vi.stackVec3=nn}Vi.stackVec3[Vi.sizeVec3++]=La}if(Ir!=null){var Fr=1,En=0,as=0,Qe=0,Ee=1,De=0,he=0,ii=0,ir=1;if(Ir.e00=Fr,Ir.e01=En,Ir.e02=as,Ir.e10=Qe,Ir.e11=Ee,Ir.e12=De,Ir.e20=he,Ir.e21=ii,Ir.e22=ir,Vi.sizeMat3==Vi.stackMat3.length){for(var Qi=Vi.sizeMat3<<1,Fi=new Array(Qi),fo=Fi,So=0,s_=Vi.sizeMat3;So<s_;){var Fe=So++;fo[Fe]=Vi.stackMat3[Fe],Vi.stackMat3[Fe]=null}Vi.stackMat3=fo}Vi.stackMat3[Vi.sizeMat3++]=Ir}if(ur!=null){var ts=1,Dn=0,co=0,Ft=0,Ni=0,lr=1,Vo=0,ce=0,Xe=0,Le=0,uo=1,$t=0,Vr=0,sr=0,Jo=0,Ns=1;if(ur.e00=ts,ur.e01=Dn,ur.e02=co,ur.e03=Ft,ur.e10=Ni,ur.e11=lr,ur.e12=Vo,ur.e13=ce,ur.e20=Xe,ur.e21=Le,ur.e22=uo,ur.e23=$t,ur.e30=Vr,ur.e31=sr,ur.e32=Jo,ur.e33=Ns,Vi.sizeMat4==Vi.stackMat4.length){for(var Co=Vi.sizeMat4<<1,ko=new Array(Co),Nr=ko,Sr=0,Cr=Vi.sizeMat4;Sr<Cr;){var Lr=Sr++;Nr[Lr]=Vi.stackMat4[Lr],Vi.stackMat4[Lr]=null}Vi.stackMat4=Nr}Vi.stackMat4[Vi.sizeMat4++]=ur}if(eo!=null){var Qt=0,Ji=0,Yi=0,Ri=1;if(eo.x=Qt,eo.y=Ji,eo.z=Yi,eo.w=Ri,Vi.sizeQuat==Vi.stackQuat.length){for(var zr=Vi.sizeQuat<<1,qi=new Array(zr),Jr=qi,Gr=0,ao=Vi.sizeQuat;Gr<ao;){var be=Gr++;Jr[be]=Vi.stackQuat[be],Vi.stackQuat[be]=null}Vi.stackQuat=Jr}Vi.stackQuat[Vi.sizeQuat++]=eo}var ki=this._pool,en=null,Yr=null,Go=null;if(It!=null){if(It.zero(),ki.sizeVec3==ki.stackVec3.length){for(var ys=ki.sizeVec3<<1,In=new Array(ys),gs=In,Vn=0,Ci=ki.sizeVec3;Vn<Ci;){var To=Vn++;gs[To]=ki.stackVec3[To],ki.stackVec3[To]=null}ki.stackVec3=gs}ki.stackVec3[ki.sizeVec3++]=It}if(en!=null){var so=1,Fn=0,Ne=0,Nn=0,Wo=1,kn=0,Ye=0,Ot=0,Ro=1;if(en.e00=so,en.e01=Fn,en.e02=Ne,en.e10=Nn,en.e11=Wo,en.e12=kn,en.e20=Ye,en.e21=Ot,en.e22=Ro,ki.sizeMat3==ki.stackMat3.length){for(var Ur=ki.sizeMat3<<1,wn=new Array(Ur),Jn=wn,fe=0,Is=ki.sizeMat3;fe<Is;){var Uo=fe++;Jn[Uo]=ki.stackMat3[Uo],ki.stackMat3[Uo]=null}ki.stackMat3=Jn}ki.stackMat3[ki.sizeMat3++]=en}if(Yr!=null){var Vs=1,w_=0,Js=0,X_=0,Je=0,F_=1,N_=0,Or=0,wo=0,Xo=0,Gn=1,wi=0,Wn=0,Qo=0,to=0,J_=1;if(Yr.e00=Vs,Yr.e01=w_,Yr.e02=Js,Yr.e03=X_,Yr.e10=Je,Yr.e11=F_,Yr.e12=N_,Yr.e13=Or,Yr.e20=wo,Yr.e21=Xo,Yr.e22=Gn,Yr.e23=wi,Yr.e30=Wn,Yr.e31=Qo,Yr.e32=to,Yr.e33=J_,ki.sizeMat4==ki.stackMat4.length){for(var G_=ki.sizeMat4<<1,L_=new Array(G_),is=L_,__=0,v_=ki.sizeMat4;__<v_;){var rs=__++;is[rs]=ki.stackMat4[rs],ki.stackMat4[rs]=null}ki.stackMat4=is}ki.stackMat4[ki.sizeMat4++]=Yr}if(Go!=null){var pi=0,Oo=0,ar=0,Ze=1;if(Go.x=pi,Go.y=Oo,Go.z=ar,Go.w=Ze,ki.sizeQuat==ki.stackQuat.length){for(var Gs=ki.sizeQuat<<1,hv=new Array(Gs),ue=hv,Ge=0,$n=ki.sizeQuat;Ge<$n;){var Ws=Ge++;ue[Ws]=ki.stackQuat[Ws],ki.stackQuat[Ws]=null}ki.stackQuat=ue}ki.stackQuat[ki.sizeQuat++]=Go}var Ti=this._pool,Lo=null,Tr=null,sn=null;if(gi!=null){if(gi.zero(),Ti.sizeVec3==Ti.stackVec3.length){for(var ks=Ti.sizeVec3<<1,Y_=new Array(ks),We=Y_,jn=0,Xn=Ti.sizeVec3;jn<Xn;){var os=jn++;We[os]=Ti.stackVec3[os],Ti.stackVec3[os]=null}Ti.stackVec3=We}Ti.stackVec3[Ti.sizeVec3++]=gi}if(Lo!=null){var de=1,ns=0,Us=0,l_=0,Be=1,Ae=0,qn=0,mi=0,xo=1;if(Lo.e00=de,Lo.e01=ns,Lo.e02=Us,Lo.e10=l_,Lo.e11=Be,Lo.e12=Ae,Lo.e20=qn,Lo.e21=mi,Lo.e22=xo,Ti.sizeMat3==Ti.stackMat3.length){for(var Zr=Ti.sizeMat3<<1,Ho=new Array(Zr),Yo=Ho,Hr=0,Eo=Ti.sizeMat3;Hr<Eo;){var ws=Hr++;Yo[ws]=Ti.stackMat3[ws],Ti.stackMat3[ws]=null}Ti.stackMat3=Yo}Ti.stackMat3[Ti.sizeMat3++]=Lo}if(Tr!=null){var ae=1,Os=0,W_=0,te=0,Nt=0,Kr=1,Do=0,Xs=0,kv=0,i0=0,U_=1,Ht=0,Ln=0,Rr=0,Yn=0,Z_=1;if(Tr.e00=ae,Tr.e01=Os,Tr.e02=W_,Tr.e03=te,Tr.e10=Nt,Tr.e11=Kr,Tr.e12=Do,Tr.e13=Xs,Tr.e20=kv,Tr.e21=i0,Tr.e22=U_,Tr.e23=Ht,Tr.e30=Ln,Tr.e31=Rr,Tr.e32=Yn,Tr.e33=Z_,Ti.sizeMat4==Ti.stackMat4.length){for(var Hs=Ti.sizeMat4<<1,h_=new Array(Hs),bo=h_,es=0,ss=Ti.sizeMat4;es<ss;){var xe=es++;bo[xe]=Ti.stackMat4[xe],Ti.stackMat4[xe]=null}Ti.stackMat4=bo}Ti.stackMat4[Ti.sizeMat4++]=Tr}if(sn!=null){var Zi=0,Ko=0,kr=0,Zo=1;if(sn.x=Zi,sn.y=Ko,sn.z=kr,sn.w=Zo,Ti.sizeQuat==Ti.stackQuat.length){for(var Ue=Ti.sizeQuat<<1,cv=new Array(Ue),ze=cv,Ks=0,wv=Ti.sizeQuat;Ks<wv;){var Oe=Ks++;ze[Oe]=Ti.stackQuat[Oe],Ti.stackQuat[Oe]=null}Ti.stackQuat=ze}Ti.stackQuat[Ti.sizeQuat++]=sn}var ei=this._pool,Zn=null,_n=null,vn=null;if(Ct!=null){if(Ct.zero(),ei.sizeVec3==ei.stackVec3.length){for(var d_=ei.sizeVec3<<1,bv=new Array(d_),ie=bv,Pe=0,c_=ei.sizeVec3;Pe<c_;){var O_=Pe++;ie[O_]=ei.stackVec3[O_],ei.stackVec3[O_]=null}ei.stackVec3=ie}ei.stackVec3[ei.sizeVec3++]=Ct}if(Zn!=null){var fv=1,uv=0,b_=0,He=0,zo=1,_s=0,vs=0,Ui=0,Mo=1;if(Zn.e00=fv,Zn.e01=uv,Zn.e02=b_,Zn.e10=He,Zn.e11=zo,Zn.e12=_s,Zn.e20=vs,Zn.e21=Ui,Zn.e22=Mo,ei.sizeMat3==ei.stackMat3.length){for(var _o=ei.sizeMat3<<1,ls=new Array(_o),Ls=ls,Ys=0,Zs=ei.sizeMat3;Ys<Zs;){var B_=Ys++;Ls[B_]=ei.stackMat3[B_],ei.stackMat3[B_]=null}ei.stackMat3=Ls}ei.stackMat3[ei.sizeMat3++]=Zn}if(_n!=null){var Me=1,hs=0,H_=0,$s=0,Un=0,pe=1,Xv=0,A_=0,$o=0,ln=0,po=1,Kt=0,$r=0,vo=0,js=0,ds=1;if(_n.e00=Me,_n.e01=hs,_n.e02=H_,_n.e03=$s,_n.e10=Un,_n.e11=pe,_n.e12=Xv,_n.e13=A_,_n.e20=$o,_n.e21=ln,_n.e22=po,_n.e23=Kt,_n.e30=$r,_n.e31=vo,_n.e32=js,_n.e33=ds,ei.sizeMat4==ei.stackMat4.length){for(var qs=ei.sizeMat4<<1,P_=new Array(qs),jo=P_,re=0,K_=ei.sizeMat4;re<K_;){var xv=re++;jo[xv]=ei.stackMat4[xv],ei.stackMat4[xv]=null}ei.stackMat4=jo}ei.stackMat4[ei.sizeMat4++]=_n}if(vn!=null){var di=0,mo=0,Qr=0,io=1;if(vn.x=di,vn.y=mo,vn.z=Qr,vn.w=io,ei.sizeQuat==ei.stackQuat.length){for(var $_=ei.sizeQuat<<1,j_=new Array($_),Lv=j_,a_=0,Yv=ei.sizeQuat;a_<Yv;){var q_=a_++;Lv[q_]=ei.stackQuat[q_],ei.stackQuat[q_]=null}ei.stackQuat=Lv}ei.stackQuat[ei.sizeQuat++]=vn}}i=r}if(a.drawJoints)for(var Bi=this._jointList;Bi!=null;){var av=Bi._next,Bs=this._pool,As=Bs.sizeVec3==0?new x.common.Vec3:Bs.stackVec3[--Bs.sizeVec3],cs=this._pool,bs=cs.sizeVec3==0?new x.common.Vec3:cs.stackVec3[--cs.sizeVec3],Ps=As;Ps.x=Bi._b1._transform._positionX,Ps.y=Bi._b1._transform._positionY,Ps.z=Bi._b1._transform._positionZ;var Zv=bs;Zv.x=Bi._b2._transform._positionX,Zv.y=Bi._b2._transform._positionY,Zv.z=Bi._b2._transform._positionZ;var me=this._pool,jr=me.sizeVec3==0?new x.common.Vec3:me.stackVec3[--me.sizeVec3],t_=this._pool,yo=t_.sizeVec3==0?new x.common.Vec3:t_.stackVec3[--t_.sizeVec3],i_=this._pool,Fo=i_.sizeVec3==0?new x.common.Vec3:i_.stackVec3[--i_.sizeVec3],Ss=this._pool,qo=Ss.sizeVec3==0?new x.common.Vec3:Ss.stackVec3[--Ss.sizeVec3],ye=this._pool,si=ye.sizeVec3==0?new x.common.Vec3:ye.stackVec3[--ye.sizeVec3],an=this._pool,_r=an.sizeVec3==0?new x.common.Vec3:an.stackVec3[--an.sizeVec3],oe=this._pool,ge=oe.sizeVec3==0?new x.common.Vec3:oe.stackVec3[--oe.sizeVec3],Bo=this._pool,Er=Bo.sizeVec3==0?new x.common.Vec3:Bo.stackVec3[--Bo.sizeVec3],dn=jr;dn.x=Bi._anchor1X,dn.y=Bi._anchor1Y,dn.z=Bi._anchor1Z;var tv=yo;tv.x=Bi._anchor2X,tv.y=Bi._anchor2Y,tv.z=Bi._anchor2Z;var r_=Fo;r_.x=Bi._basisX1X,r_.y=Bi._basisX1Y,r_.z=Bi._basisX1Z;var S_=qo;S_.x=Bi._basisY1X,S_.y=Bi._basisY1Y,S_.z=Bi._basisY1Z;var iv=si;iv.x=Bi._basisZ1X,iv.y=Bi._basisZ1Y,iv.z=Bi._basisZ1Z;var ne=_r;ne.x=Bi._basisX2X,ne.y=Bi._basisX2Y,ne.z=Bi._basisX2Z;var Bn=ge;Bn.x=Bi._basisY2X,Bn.y=Bi._basisY2Y,Bn.z=Bi._basisY2Z;var Ie=Er;if(Ie.x=Bi._basisZ2X,Ie.y=Bi._basisZ2Y,Ie.z=Bi._basisZ2Z,a.line(As,jr,a.style.jointLineColor),a.line(bs,yo,a.style.jointLineColor),a.drawJointLimits)switch(Bi._type){case 0:break;case 1:var E0=a.style.jointRotationalConstraintRadius,M0=a.style.jointLineColor,hl=Bi._lm;this._drawRotationalLimit(a,jr,qo,si,ge,E0,hl.lowerLimit,hl.upperLimit,M0);break;case 2:var D0=Bi,hr=a.style.jointRotationalConstraintRadius,On=a.style.jointLineColor,go=D0._rotLm,fs=D0._translLm;this._drawRotationalLimit(a,yo,qo,si,ge,hr,go.lowerLimit,go.upperLimit,On),this._drawTranslationalLimit(a,jr,Fo,fs.lowerLimit,fs.upperLimit,On);break;case 3:a.style.jointRotationalConstraintRadius;var rv=a.style.jointLineColor,zv=Bi._lm;this._drawTranslationalLimit(a,jr,Fo,zv.lowerLimit,zv.upperLimit,rv);break;case 4:var o_=Bi,dv=a.style.jointRotationalConstraintRadius,Cs=a.style.jointLineColor,f_=o_._lm1,u_=o_._lm2;this._drawRotationalLimit(a,jr,qo,si,qo,dv,o_._angleX-f_.upperLimit,o_._angleX-f_.lowerLimit,Cs),this._drawRotationalLimit(a,yo,_r,ge,_r,dv,u_.lowerLimit-o_._angleZ,u_.upperLimit-o_._angleZ,Cs);break;case 5:var Ai=Bi,Ts=a.style.jointRotationalConstraintRadius,lo=a.style.jointLineColor,Se=Ai._twistLm;this._drawRotationalLimit(a,yo,ge,Er,ge,Ts,Se.lowerLimit-Ai._twistAngle,Se.upperLimit-Ai._twistAngle,lo),this._drawEllipseOnSphere(a,jr,Fo,qo,si,Ai._maxSwingAngle1,Ai._maxSwingAngle2,Ts,lo);var Mv=this._pool,Rs=Mv.sizeVec3==0?new x.common.Vec3:Mv.stackVec3[--Mv.sizeVec3];Rs.x=yo.x,Rs.y=yo.y,Rs.z=yo.z;var x_=Rs,ov=x_.x+_r.x*Ts,r0=x_.y+_r.y*Ts,o0=x_.z+_r.z*Ts;x_.x=ov,x_.y=r0,x_.z=o0;var nv=x_;a.line(yo,nv,lo);var tr=this._pool,Ke=null,An=null,us=null;if(nv!=null){if(nv.zero(),tr.sizeVec3==tr.stackVec3.length){for(var F0=tr.sizeVec3<<1,Dv=new Array(F0),C_=Dv,p0=0,Bv=tr.sizeVec3;p0<Bv;){var n0=p0++;C_[n0]=tr.stackVec3[n0],tr.stackVec3[n0]=null}tr.stackVec3=C_}tr.stackVec3[tr.sizeVec3++]=nv}if(Ke!=null){var m0=1,N0=0,e0=0,s0=0,y0=1,Fv=0,cr=0,pv=0,hn=1;if(Ke.e00=m0,Ke.e01=N0,Ke.e02=e0,Ke.e10=s0,Ke.e11=y0,Ke.e12=Fv,Ke.e20=cr,Ke.e21=pv,Ke.e22=hn,tr.sizeMat3==tr.stackMat3.length){for(var Nv=tr.sizeMat3<<1,Hl=new Array(Nv),g0=Hl,I0=0,cl=tr.sizeMat3;I0<cl;){var dl=I0++;g0[dl]=tr.stackMat3[dl],tr.stackMat3[dl]=null}tr.stackMat3=g0}tr.stackMat3[tr.sizeMat3++]=Ke}if(An!=null){var Jv=1,Kl=0,$l=0,bl=0,Bl=0,Al=1,jl=0,fl=0,ql=0,ul=0,rr=1,xs=0,tn=0,mv=0,yh=0,Gv=1;if(An.e00=Jv,An.e01=Kl,An.e02=$l,An.e03=bl,An.e10=Bl,An.e11=Al,An.e12=jl,An.e13=fl,An.e20=ql,An.e21=ul,An.e22=rr,An.e23=xs,An.e30=tn,An.e31=mv,An.e32=yh,An.e33=Gv,tr.sizeMat4==tr.stackMat4.length){for(var J0=tr.sizeMat4<<1,xl=new Array(J0),V0=xl,k0=0,G0=tr.sizeMat4;k0<G0;){var Mr=k0++;V0[Mr]=tr.stackMat4[Mr],tr.stackMat4[Mr]=null}tr.stackMat4=V0}tr.stackMat4[tr.sizeMat4++]=An}if(us!=null){var zs=0,ee=0,_0=0,Pl=1;if(us.x=zs,us.y=ee,us.z=_0,us.w=Pl,tr.sizeQuat==tr.stackQuat.length){for(var lh=tr.sizeQuat<<1,W0=new Array(lh),hh=W0,U0=0,Sl=tr.sizeQuat;U0<Sl;){var zl=U0++;hh[zl]=tr.stackQuat[zl],tr.stackQuat[zl]=null}tr.stackQuat=hh}tr.stackQuat[tr.sizeQuat++]=us}break;case 6:var Ce=Bi,w0=a.style.jointRotationalConstraintRadius,z_=a.style.jointLineColor,Cl=Ce._translLms[0],O0=Ce._translLms[1],H0=Ce._translLms[2],Tl=Ce._rotLms[0],Ml=Ce._rotLms[1],X0=Ce._rotLms[2];this._drawTranslationalLimit3D(a,jr,Fo,qo,si,Cl,O0,H0,z_);var v0=this._pool,M_=v0.sizeVec3==0?new x.common.Vec3:v0.stackVec3[--v0.sizeVec3],Wv=M_;Wv.x=Ce._axisYX,Wv.y=Ce._axisYY,Wv.z=Ce._axisYZ;var Uv=this._pool,ev=Uv.sizeVec3==0?new x.common.Vec3:Uv.stackVec3[--Uv.sizeVec3];ev.x=Fo.x,ev.y=Fo.y,ev.z=Fo.z;var L0=ev,Av=this._pool,l0=Av.sizeVec3==0?new x.common.Vec3:Av.stackVec3[--Av.sizeVec3];l0.x=Fo.x,l0.y=Fo.y,l0.z=Fo.z;var se=l0,h0=se.y*M_.z-se.z*M_.y,Y0=se.z*M_.x-se.x*M_.z,Qs=se.x*M_.y-se.y*M_.x;se.x=h0,se.y=Y0,se.z=Qs;var K0=se;this._drawRotationalLimit(a,yo,qo,si,qo,w0,Ce._angleX-Tl.upperLimit,Ce._angleX-Tl.lowerLimit,z_),this._drawRotationalLimit(a,yo,L0,K0,L0,w0,Ml.lowerLimit-Ce._angleY,Ml.upperLimit-Ce._angleY,z_),this._drawRotationalLimit(a,yo,_r,ge,_r,w0,X0.lowerLimit-Ce._angleZ,X0.upperLimit-Ce._angleZ,z_);break}a.line(jr,yo,a.style.jointErrorColor);var yi=this._pool,cn=null,wr=null,Ov=null;if(As!=null){if(As.zero(),yi.sizeVec3==yi.stackVec3.length){for(var c0=yi.sizeVec3<<1,ch=new Array(c0),ah=ch,p_=0,$e=yi.sizeVec3;p_<$e;){var Es=p_++;ah[Es]=yi.stackVec3[Es],yi.stackVec3[Es]=null}yi.stackVec3=ah}yi.stackVec3[yi.sizeVec3++]=As}if(cn!=null){var th=1,bh=0,Rl=0,br=0,n_=1,bn=0,yv=0,$0=0,gv=1;if(cn.e00=th,cn.e01=bh,cn.e02=Rl,cn.e10=br,cn.e11=n_,cn.e12=bn,cn.e20=yv,cn.e21=$0,cn.e22=gv,yi.sizeMat3==yi.stackMat3.length){for(var pl=yi.sizeMat3<<1,ml=new Array(pl),yl=ml,T_=0,Pv=yi.sizeMat3;T_<Pv;){var Pn=T_++;yl[Pn]=yi.stackMat3[Pn],yi.stackMat3[Pn]=null}yi.stackMat3=yl}yi.stackMat3[yi.sizeMat3++]=cn}if(wr!=null){var Iv=1,Sv=0,R_=0,_e=0,Q_=0,Cv=1,Hv=0,or=0,m_=0,ve=0,Gi=1,y_=0,Sn=0,j0=0,b0=0,fh=1;if(wr.e00=Iv,wr.e01=Sv,wr.e02=R_,wr.e03=_e,wr.e10=Q_,wr.e11=Cv,wr.e12=Hv,wr.e13=or,wr.e20=m_,wr.e21=ve,wr.e22=Gi,wr.e23=y_,wr.e30=Sn,wr.e31=j0,wr.e32=b0,wr.e33=fh,yi.sizeMat4==yi.stackMat4.length){for(var q0=yi.sizeMat4<<1,al=new Array(q0),gl=al,Z0=0,uh=yi.sizeMat4;Z0<uh;){var Il=Z0++;gl[Il]=yi.stackMat4[Il],yi.stackMat4[Il]=null}yi.stackMat4=gl}yi.stackMat4[yi.sizeMat4++]=wr}if(Ov!=null){var gh=0,ih=0,Vl=0,d0=1;if(Ov.x=gh,Ov.y=ih,Ov.z=Vl,Ov.w=d0,yi.sizeQuat==yi.stackQuat.length){for(var B0=yi.sizeQuat<<1,kl=new Array(B0),rh=kl,Kv=0,Ql=yi.sizeQuat;Kv<Ql;){var $v=Kv++;rh[$v]=yi.stackQuat[$v],yi.stackQuat[$v]=null}yi.stackQuat=rh}yi.stackQuat[yi.sizeQuat++]=Ov}var nr=this._pool,g_=null,rn=null,wl=null;if(bs!=null){if(bs.zero(),nr.sizeVec3==nr.stackVec3.length){for(var A0=nr.sizeVec3<<1,oh=new Array(A0),El=oh,tl=0,Dl=nr.sizeVec3;tl<Dl;){var P0=tl++;El[P0]=nr.stackVec3[P0],nr.stackVec3[P0]=null}nr.stackVec3=El}nr.stackVec3[nr.sizeVec3++]=bs}if(g_!=null){var nh=1,eh=0,Fl=0,Nl=0,sv=1,Tv=0,jv=0,Ds=0,xh=1;if(g_.e00=nh,g_.e01=eh,g_.e02=Fl,g_.e10=Nl,g_.e11=sv,g_.e12=Tv,g_.e20=jv,g_.e21=Ds,g_.e22=xh,nr.sizeMat3==nr.stackMat3.length){for(var f0=nr.sizeMat3<<1,Xl=new Array(f0),Rv=Xl,qv=0,Qv=nr.sizeMat3;qv<Qv;){var u0=qv++;Rv[u0]=nr.stackMat3[u0],nr.stackMat3[u0]=null}nr.stackMat3=Rv}nr.stackMat3[nr.sizeMat3++]=g_}if(rn!=null){var Zh=1,S0=0,a0=0,Jl=0,Gl=0,zh=1,Ev=0,xr=0,Ve=0,le=0,C0=1,Wl=0,Fs=0,x0=0,Ll=0,Ul=1;if(rn.e00=Zh,rn.e01=S0,rn.e02=a0,rn.e03=Jl,rn.e10=Gl,rn.e11=zh,rn.e12=Ev,rn.e13=xr,rn.e20=Ve,rn.e21=le,rn.e22=C0,rn.e23=Wl,rn.e30=Fs,rn.e31=x0,rn.e32=Ll,rn.e33=Ul,nr.sizeMat4==nr.stackMat4.length){for(var Ol=nr.sizeMat4<<1,Ih=new Array(Ol),_v=Ih,vv=0,T0=nr.sizeMat4;vv<T0;){var I_=vv++;_v[I_]=nr.stackMat4[I_],nr.stackMat4[I_]=null}nr.stackMat4=_v}nr.stackMat4[nr.sizeMat4++]=rn}if(wl!=null){var Yl=0,Vh=0,dh=0,t0=1;if(wl.x=Yl,wl.y=Vh,wl.z=dh,wl.w=t0,nr.sizeQuat==nr.stackQuat.length){for(var lv=nr.sizeQuat<<1,kh=new Array(lv),Zl=kh,wh=0,Kh=nr.sizeQuat;wh<Kh;){var sh=wh++;Zl[sh]=nr.stackQuat[sh],nr.stackQuat[sh]=null}nr.stackQuat=Zl}nr.stackQuat[nr.sizeQuat++]=wl}var Ei=this._pool,e_=null,V_=null,_h=null;if(jr!=null){if(jr.zero(),Ei.sizeVec3==Ei.stackVec3.length){for(var Bh=Ei.sizeVec3<<1,Ah=new Array(Bh),Mh=Ah,Vv=0,Rh=Ei.sizeVec3;Vv<Rh;){var Qh=Vv++;Mh[Qh]=Ei.stackVec3[Qh],Ei.stackVec3[Qh]=null}Ei.stackVec3=Mh}Ei.stackVec3[Ei.sizeVec3++]=jr}if(e_!=null){var $h=1,jh=0,ph=0,Ph=0,il=1,ic=0,Xh=0,E_=0,Eh=1;if(e_.e00=$h,e_.e01=jh,e_.e02=ph,e_.e10=Ph,e_.e11=il,e_.e12=ic,e_.e20=Xh,e_.e21=E_,e_.e22=Eh,Ei.sizeMat3==Ei.stackMat3.length){for(var mh=Ei.sizeMat3<<1,qh=new Array(mh),Lh=qh,ac=0,Sh=Ei.sizeMat3;ac<Sh;){var R0=ac++;Lh[R0]=Ei.stackMat3[R0],Ei.stackMat3[R0]=null}Ei.stackMat3=Lh}Ei.stackMat3[Ei.sizeMat3++]=e_}if(V_!=null){var rc=1,vh=0,Yh=0,Dh=0,Ch=0,Q0=1,z0=0,nc=0,ec=0,Fh=0,oc=1,tc=0,rl=0,gc=0,Ic=0,Mc=1;if(V_.e00=rc,V_.e01=vh,V_.e02=Yh,V_.e03=Dh,V_.e10=Ch,V_.e11=Q0,V_.e12=z0,V_.e13=nc,V_.e20=ec,V_.e21=Fh,V_.e22=oc,V_.e23=tc,V_.e30=rl,V_.e31=gc,V_.e32=Ic,V_.e33=Mc,Ei.sizeMat4==Ei.stackMat4.length){for(var pc=Ei.sizeMat4<<1,Vc=new Array(pc),sc=Vc,Th=0,kc=Ei.sizeMat4;Th<kc;){var xc=Th++;sc[xc]=Ei.stackMat4[xc],Ei.stackMat4[xc]=null}Ei.stackMat4=sc}Ei.stackMat4[Ei.sizeMat4++]=V_}if(_h!=null){var mc=0,yc=0,wc=0,zc=1;if(_h.x=mc,_h.y=yc,_h.z=wc,_h.w=zc,Ei.sizeQuat==Ei.stackQuat.length){for(var hf=Ei.sizeQuat<<1,cf=new Array(hf),ib=cf,rb=0,bf=Ei.sizeQuat;rb<bf;){var Xc=rb++;ib[Xc]=Ei.stackQuat[Xc],Ei.stackQuat[Xc]=null}Ei.stackQuat=ib}Ei.stackQuat[Ei.sizeQuat++]=_h}var fn=this._pool,Nh=null,ol=null,_c=null;if(yo!=null){if(yo.zero(),fn.sizeVec3==fn.stackVec3.length){for(var ff=fn.sizeVec3<<1,uf=new Array(ff),ob=uf,nb=0,xf=fn.sizeVec3;nb<xf;){var Lc=nb++;ob[Lc]=fn.stackVec3[Lc],fn.stackVec3[Lc]=null}fn.stackVec3=ob}fn.stackVec3[fn.sizeVec3++]=yo}if(Nh!=null){var zf=1,Mf=0,pf=0,mf=0,yf=1,gf=0,If=0,Vf=0,kf=1;if(Nh.e00=zf,Nh.e01=Mf,Nh.e02=pf,Nh.e10=mf,Nh.e11=yf,Nh.e12=gf,Nh.e20=If,Nh.e21=Vf,Nh.e22=kf,fn.sizeMat3==fn.stackMat3.length){for(var wf=fn.sizeMat3<<1,Xf=new Array(wf),eb=Xf,sb=0,Lf=fn.sizeMat3;sb<Lf;){var Yc=sb++;eb[Yc]=fn.stackMat3[Yc],fn.stackMat3[Yc]=null}fn.stackMat3=eb}fn.stackMat3[fn.sizeMat3++]=Nh}if(ol!=null){var Yf=1,Zf=0,df=0,Bf=0,Af=0,Pf=1,Sf=0,Cf=0,Tf=0,Rf=0,Qf=1,Ef=0,Df=0,Ff=0,Nf=0,Jf=1;if(ol.e00=Yf,ol.e01=Zf,ol.e02=df,ol.e03=Bf,ol.e10=Af,ol.e11=Pf,ol.e12=Sf,ol.e13=Cf,ol.e20=Tf,ol.e21=Rf,ol.e22=Qf,ol.e23=Ef,ol.e30=Df,ol.e31=Ff,ol.e32=Nf,ol.e33=Jf,fn.sizeMat4==fn.stackMat4.length){for(var Gf=fn.sizeMat4<<1,Wf=new Array(Gf),_b=Wf,vb=0,Uf=fn.sizeMat4;vb<Uf;){var Zc=vb++;_b[Zc]=fn.stackMat4[Zc],fn.stackMat4[Zc]=null}fn.stackMat4=_b}fn.stackMat4[fn.sizeMat4++]=ol}if(_c!=null){var Of=0,Hf=0,Kf=0,$f=1;if(_c.x=Of,_c.y=Hf,_c.z=Kf,_c.w=$f,fn.sizeQuat==fn.stackQuat.length){for(var jf=fn.sizeQuat<<1,qf=new Array(jf),lb=qf,hb=0,au=fn.sizeQuat;hb<au;){var dc=hb++;lb[dc]=fn.stackQuat[dc],fn.stackQuat[dc]=null}fn.stackQuat=lb}fn.stackQuat[fn.sizeQuat++]=_c}var un=this._pool,Jh=null,nl=null,vc=null;if(Fo!=null){if(Fo.zero(),un.sizeVec3==un.stackVec3.length){for(var tu=un.sizeVec3<<1,iu=new Array(tu),cb=iu,bb=0,ru=un.sizeVec3;bb<ru;){var Bc=bb++;cb[Bc]=un.stackVec3[Bc],un.stackVec3[Bc]=null}un.stackVec3=cb}un.stackVec3[un.sizeVec3++]=Fo}if(Jh!=null){var ou=1,nu=0,eu=0,su=0,_u=1,vu=0,lu=0,hu=0,cu=1;if(Jh.e00=ou,Jh.e01=nu,Jh.e02=eu,Jh.e10=su,Jh.e11=_u,Jh.e12=vu,Jh.e20=lu,Jh.e21=hu,Jh.e22=cu,un.sizeMat3==un.stackMat3.length){for(var bu=un.sizeMat3<<1,fu=new Array(bu),fb=fu,ub=0,uu=un.sizeMat3;ub<uu;){var Ac=ub++;fb[Ac]=un.stackMat3[Ac],un.stackMat3[Ac]=null}un.stackMat3=fb}un.stackMat3[un.sizeMat3++]=Jh}if(nl!=null){var xu=1,zu=0,Mu=0,pu=0,mu=0,yu=1,gu=0,Iu=0,Vu=0,ku=0,wu=1,Xu=0,Lu=0,Yu=0,Zu=0,du=1;if(nl.e00=xu,nl.e01=zu,nl.e02=Mu,nl.e03=pu,nl.e10=mu,nl.e11=yu,nl.e12=gu,nl.e13=Iu,nl.e20=Vu,nl.e21=ku,nl.e22=wu,nl.e23=Xu,nl.e30=Lu,nl.e31=Yu,nl.e32=Zu,nl.e33=du,un.sizeMat4==un.stackMat4.length){for(var Bu=un.sizeMat4<<1,Au=new Array(Bu),xb=Au,zb=0,Pu=un.sizeMat4;zb<Pu;){var Pc=zb++;xb[Pc]=un.stackMat4[Pc],un.stackMat4[Pc]=null}un.stackMat4=xb}un.stackMat4[un.sizeMat4++]=nl}if(vc!=null){var Su=0,Cu=0,Tu=0,Ru=1;if(vc.x=Su,vc.y=Cu,vc.z=Tu,vc.w=Ru,un.sizeQuat==un.stackQuat.length){for(var Qu=un.sizeQuat<<1,Eu=new Array(Qu),Mb=Eu,pb=0,Du=un.sizeQuat;pb<Du;){var Sc=pb++;Mb[Sc]=un.stackQuat[Sc],un.stackQuat[Sc]=null}un.stackQuat=Mb}un.stackQuat[un.sizeQuat++]=vc}var xn=this._pool,Gh=null,el=null,lc=null;if(qo!=null){if(qo.zero(),xn.sizeVec3==xn.stackVec3.length){for(var Fu=xn.sizeVec3<<1,Nu=new Array(Fu),mb=Nu,yb=0,Ju=xn.sizeVec3;yb<Ju;){var Cc=yb++;mb[Cc]=xn.stackVec3[Cc],xn.stackVec3[Cc]=null}xn.stackVec3=mb}xn.stackVec3[xn.sizeVec3++]=qo}if(Gh!=null){var Gu=1,Wu=0,Uu=0,Ou=0,Hu=1,Ku=0,$u=0,ju=0,qu=1;if(Gh.e00=Gu,Gh.e01=Wu,Gh.e02=Uu,Gh.e10=Ou,Gh.e11=Hu,Gh.e12=Ku,Gh.e20=$u,Gh.e21=ju,Gh.e22=qu,xn.sizeMat3==xn.stackMat3.length){for(var ax=xn.sizeMat3<<1,tx=new Array(ax),gb=tx,Ib=0,ix=xn.sizeMat3;Ib<ix;){var Tc=Ib++;gb[Tc]=xn.stackMat3[Tc],xn.stackMat3[Tc]=null}xn.stackMat3=gb}xn.stackMat3[xn.sizeMat3++]=Gh}if(el!=null){var rx=1,ox=0,nx=0,ex=0,sx=0,_x=1,vx=0,lx=0,hx=0,cx=0,bx=1,fx=0,ux=0,xx=0,zx=0,Mx=1;if(el.e00=rx,el.e01=ox,el.e02=nx,el.e03=ex,el.e10=sx,el.e11=_x,el.e12=vx,el.e13=lx,el.e20=hx,el.e21=cx,el.e22=bx,el.e23=fx,el.e30=ux,el.e31=xx,el.e32=zx,el.e33=Mx,xn.sizeMat4==xn.stackMat4.length){for(var px=xn.sizeMat4<<1,mx=new Array(px),Vb=mx,kb=0,yx=xn.sizeMat4;kb<yx;){var Rc=kb++;Vb[Rc]=xn.stackMat4[Rc],xn.stackMat4[Rc]=null}xn.stackMat4=Vb}xn.stackMat4[xn.sizeMat4++]=el}if(lc!=null){var gx=0,Ix=0,Vx=0,kx=1;if(lc.x=gx,lc.y=Ix,lc.z=Vx,lc.w=kx,xn.sizeQuat==xn.stackQuat.length){for(var wx=xn.sizeQuat<<1,Xx=new Array(wx),wb=Xx,Xb=0,Lx=xn.sizeQuat;Xb<Lx;){var Qc=Xb++;wb[Qc]=xn.stackQuat[Qc],xn.stackQuat[Qc]=null}xn.stackQuat=wb}xn.stackQuat[xn.sizeQuat++]=lc}var zn=this._pool,Wh=null,sl=null,hc=null;if(si!=null){if(si.zero(),zn.sizeVec3==zn.stackVec3.length){for(var Yx=zn.sizeVec3<<1,Zx=new Array(Yx),Lb=Zx,Yb=0,dx=zn.sizeVec3;Yb<dx;){var Ec=Yb++;Lb[Ec]=zn.stackVec3[Ec],zn.stackVec3[Ec]=null}zn.stackVec3=Lb}zn.stackVec3[zn.sizeVec3++]=si}if(Wh!=null){var Bx=1,Ax=0,Px=0,Sx=0,Cx=1,Tx=0,Rx=0,Qx=0,Ex=1;if(Wh.e00=Bx,Wh.e01=Ax,Wh.e02=Px,Wh.e10=Sx,Wh.e11=Cx,Wh.e12=Tx,Wh.e20=Rx,Wh.e21=Qx,Wh.e22=Ex,zn.sizeMat3==zn.stackMat3.length){for(var Dx=zn.sizeMat3<<1,Fx=new Array(Dx),Zb=Fx,db=0,Nx=zn.sizeMat3;db<Nx;){var Dc=db++;Zb[Dc]=zn.stackMat3[Dc],zn.stackMat3[Dc]=null}zn.stackMat3=Zb}zn.stackMat3[zn.sizeMat3++]=Wh}if(sl!=null){var Jx=1,Gx=0,Wx=0,Ux=0,Ox=0,Hx=1,Kx=0,$x=0,jx=0,qx=0,a2=1,t2=0,i2=0,r2=0,o2=0,n2=1;if(sl.e00=Jx,sl.e01=Gx,sl.e02=Wx,sl.e03=Ux,sl.e10=Ox,sl.e11=Hx,sl.e12=Kx,sl.e13=$x,sl.e20=jx,sl.e21=qx,sl.e22=a2,sl.e23=t2,sl.e30=i2,sl.e31=r2,sl.e32=o2,sl.e33=n2,zn.sizeMat4==zn.stackMat4.length){for(var e2=zn.sizeMat4<<1,s2=new Array(e2),Bb=s2,Ab=0,_2=zn.sizeMat4;Ab<_2;){var Fc=Ab++;Bb[Fc]=zn.stackMat4[Fc],zn.stackMat4[Fc]=null}zn.stackMat4=Bb}zn.stackMat4[zn.sizeMat4++]=sl}if(hc!=null){var v2=0,l2=0,h2=0,c2=1;if(hc.x=v2,hc.y=l2,hc.z=h2,hc.w=c2,zn.sizeQuat==zn.stackQuat.length){for(var b2=zn.sizeQuat<<1,f2=new Array(b2),Pb=f2,Sb=0,u2=zn.sizeQuat;Sb<u2;){var Nc=Sb++;Pb[Nc]=zn.stackQuat[Nc],zn.stackQuat[Nc]=null}zn.stackQuat=Pb}zn.stackQuat[zn.sizeQuat++]=hc}var Mn=this._pool,Uh=null,_l=null,cc=null;if(_r!=null){if(_r.zero(),Mn.sizeVec3==Mn.stackVec3.length){for(var x2=Mn.sizeVec3<<1,z2=new Array(x2),Cb=z2,Tb=0,M2=Mn.sizeVec3;Tb<M2;){var Jc=Tb++;Cb[Jc]=Mn.stackVec3[Jc],Mn.stackVec3[Jc]=null}Mn.stackVec3=Cb}Mn.stackVec3[Mn.sizeVec3++]=_r}if(Uh!=null){var p2=1,m2=0,y2=0,g2=0,I2=1,V2=0,k2=0,w2=0,X2=1;if(Uh.e00=p2,Uh.e01=m2,Uh.e02=y2,Uh.e10=g2,Uh.e11=I2,Uh.e12=V2,Uh.e20=k2,Uh.e21=w2,Uh.e22=X2,Mn.sizeMat3==Mn.stackMat3.length){for(var L2=Mn.sizeMat3<<1,Y2=new Array(L2),Rb=Y2,Qb=0,Z2=Mn.sizeMat3;Qb<Z2;){var Gc=Qb++;Rb[Gc]=Mn.stackMat3[Gc],Mn.stackMat3[Gc]=null}Mn.stackMat3=Rb}Mn.stackMat3[Mn.sizeMat3++]=Uh}if(_l!=null){var d2=1,B2=0,A2=0,P2=0,S2=0,C2=1,T2=0,R2=0,Q2=0,E2=0,D2=1,F2=0,N2=0,J2=0,G2=0,W2=1;if(_l.e00=d2,_l.e01=B2,_l.e02=A2,_l.e03=P2,_l.e10=S2,_l.e11=C2,_l.e12=T2,_l.e13=R2,_l.e20=Q2,_l.e21=E2,_l.e22=D2,_l.e23=F2,_l.e30=N2,_l.e31=J2,_l.e32=G2,_l.e33=W2,Mn.sizeMat4==Mn.stackMat4.length){for(var U2=Mn.sizeMat4<<1,O2=new Array(U2),Eb=O2,Db=0,H2=Mn.sizeMat4;Db<H2;){var Wc=Db++;Eb[Wc]=Mn.stackMat4[Wc],Mn.stackMat4[Wc]=null}Mn.stackMat4=Eb}Mn.stackMat4[Mn.sizeMat4++]=_l}if(cc!=null){var K2=0,$2=0,j2=0,q2=1;if(cc.x=K2,cc.y=$2,cc.z=j2,cc.w=q2,Mn.sizeQuat==Mn.stackQuat.length){for(var az=Mn.sizeQuat<<1,tz=new Array(az),Fb=tz,Nb=0,iz=Mn.sizeQuat;Nb<iz;){var Uc=Nb++;Fb[Uc]=Mn.stackQuat[Uc],Mn.stackQuat[Uc]=null}Mn.stackQuat=Fb}Mn.stackQuat[Mn.sizeQuat++]=cc}var pn=this._pool,Oh=null,vl=null,bc=null;if(ge!=null){if(ge.zero(),pn.sizeVec3==pn.stackVec3.length){for(var rz=pn.sizeVec3<<1,oz=new Array(rz),Jb=oz,Gb=0,nz=pn.sizeVec3;Gb<nz;){var Oc=Gb++;Jb[Oc]=pn.stackVec3[Oc],pn.stackVec3[Oc]=null}pn.stackVec3=Jb}pn.stackVec3[pn.sizeVec3++]=ge}if(Oh!=null){var ez=1,sz=0,_z=0,vz=0,lz=1,hz=0,cz=0,bz=0,fz=1;if(Oh.e00=ez,Oh.e01=sz,Oh.e02=_z,Oh.e10=vz,Oh.e11=lz,Oh.e12=hz,Oh.e20=cz,Oh.e21=bz,Oh.e22=fz,pn.sizeMat3==pn.stackMat3.length){for(var uz=pn.sizeMat3<<1,xz=new Array(uz),Wb=xz,Ub=0,zz=pn.sizeMat3;Ub<zz;){var Hc=Ub++;Wb[Hc]=pn.stackMat3[Hc],pn.stackMat3[Hc]=null}pn.stackMat3=Wb}pn.stackMat3[pn.sizeMat3++]=Oh}if(vl!=null){var Mz=1,pz=0,mz=0,yz=0,gz=0,Iz=1,Vz=0,kz=0,wz=0,Xz=0,Lz=1,Yz=0,Zz=0,dz=0,Bz=0,Az=1;if(vl.e00=Mz,vl.e01=pz,vl.e02=mz,vl.e03=yz,vl.e10=gz,vl.e11=Iz,vl.e12=Vz,vl.e13=kz,vl.e20=wz,vl.e21=Xz,vl.e22=Lz,vl.e23=Yz,vl.e30=Zz,vl.e31=dz,vl.e32=Bz,vl.e33=Az,pn.sizeMat4==pn.stackMat4.length){for(var Pz=pn.sizeMat4<<1,Sz=new Array(Pz),Ob=Sz,Hb=0,Cz=pn.sizeMat4;Hb<Cz;){var Kc=Hb++;Ob[Kc]=pn.stackMat4[Kc],pn.stackMat4[Kc]=null}pn.stackMat4=Ob}pn.stackMat4[pn.sizeMat4++]=vl}if(bc!=null){var Tz=0,Rz=0,Qz=0,Ez=1;if(bc.x=Tz,bc.y=Rz,bc.z=Qz,bc.w=Ez,pn.sizeQuat==pn.stackQuat.length){for(var Dz=pn.sizeQuat<<1,Fz=new Array(Dz),Kb=Fz,$b=0,Nz=pn.sizeQuat;$b<Nz;){var $c=$b++;Kb[$c]=pn.stackQuat[$c],pn.stackQuat[$c]=null}pn.stackQuat=Kb}pn.stackQuat[pn.sizeQuat++]=bc}var mn=this._pool,Hh=null,ll=null,fc=null;if(Er!=null){if(Er.zero(),mn.sizeVec3==mn.stackVec3.length){for(var Jz=mn.sizeVec3<<1,Gz=new Array(Jz),jb=Gz,qb=0,Wz=mn.sizeVec3;qb<Wz;){var jc=qb++;jb[jc]=mn.stackVec3[jc],mn.stackVec3[jc]=null}mn.stackVec3=jb}mn.stackVec3[mn.sizeVec3++]=Er}if(Hh!=null){var Uz=1,Oz=0,Hz=0,Kz=0,$z=1,jz=0,qz=0,aM=0,tM=1;if(Hh.e00=Uz,Hh.e01=Oz,Hh.e02=Hz,Hh.e10=Kz,Hh.e11=$z,Hh.e12=jz,Hh.e20=qz,Hh.e21=aM,Hh.e22=tM,mn.sizeMat3==mn.stackMat3.length){for(var iM=mn.sizeMat3<<1,rM=new Array(iM),af=rM,tf=0,oM=mn.sizeMat3;tf<oM;){var qc=tf++;af[qc]=mn.stackMat3[qc],mn.stackMat3[qc]=null}mn.stackMat3=af}mn.stackMat3[mn.sizeMat3++]=Hh}if(ll!=null){var nM=1,eM=0,sM=0,_M=0,vM=0,lM=1,hM=0,cM=0,bM=0,fM=0,uM=1,xM=0,zM=0,MM=0,pM=0,mM=1;if(ll.e00=nM,ll.e01=eM,ll.e02=sM,ll.e03=_M,ll.e10=vM,ll.e11=lM,ll.e12=hM,ll.e13=cM,ll.e20=bM,ll.e21=fM,ll.e22=uM,ll.e23=xM,ll.e30=zM,ll.e31=MM,ll.e32=pM,ll.e33=mM,mn.sizeMat4==mn.stackMat4.length){for(var yM=mn.sizeMat4<<1,gM=new Array(yM),rf=gM,of=0,IM=mn.sizeMat4;of<IM;){var ab=of++;rf[ab]=mn.stackMat4[ab],mn.stackMat4[ab]=null}mn.stackMat4=rf}mn.stackMat4[mn.sizeMat4++]=ll}if(fc!=null){var VM=0,kM=0,wM=0,XM=1;if(fc.x=VM,fc.y=kM,fc.z=wM,fc.w=XM,mn.sizeQuat==mn.stackQuat.length){for(var LM=mn.sizeQuat<<1,YM=new Array(LM),nf=YM,ef=0,ZM=mn.sizeQuat;ef<ZM;){var tb=ef++;nf[tb]=mn.stackQuat[tb],mn.stackQuat[tb]=null}mn.stackQuat=nf}mn.stackQuat[mn.sizeQuat++]=fc}Bi=av}}_drawRotationalLimit(a,t,i,r,o,s,_,h,v){if(_!=h){var e=this._pool,l=e.sizeVec3==0?new x.common.Vec3:e.stackVec3[--e.sizeVec3];l.x=t.x,l.y=t.y,l.z=t.z;var u=l,b=u.x+o.x*s,f=u.y+o.y*s,n=u.z+o.z*s;u.x=b,u.y=f,u.z=n;var c=u;a.line(t,c,v);var z=this._pool,p=null,y=null,V=null;if(c!=null){if(c.zero(),z.sizeVec3==z.stackVec3.length){for(var M=z.sizeVec3<<1,I=new Array(M),k=I,X=0,L=z.sizeVec3;X<L;){var m=X++;k[m]=z.stackVec3[m],z.stackVec3[m]=null}z.stackVec3=k}z.stackVec3[z.sizeVec3++]=c}if(p!=null){var g=1,N=0,A=0,F=0,P=1,Y=0,R=0,C=0,d=1;if(p.e00=g,p.e01=N,p.e02=A,p.e10=F,p.e11=P,p.e12=Y,p.e20=R,p.e21=C,p.e22=d,z.sizeMat3==z.stackMat3.length){for(var Z=z.sizeMat3<<1,$=new Array(Z),K=$,E=0,J=z.sizeMat3;E<J;){var B=E++;K[B]=z.stackMat3[B],z.stackMat3[B]=null}z.stackMat3=K}z.stackMat3[z.sizeMat3++]=p}if(y!=null){var Q=1,U=0,G=0,D=0,H=0,j=1,ia=0,sa=0,W=0,q=0,na=1,oa=0,aa=0,T=0,ca=0,_a=1;if(y.e00=Q,y.e01=U,y.e02=G,y.e03=D,y.e10=H,y.e11=j,y.e12=ia,y.e13=sa,y.e20=W,y.e21=q,y.e22=na,y.e23=oa,y.e30=aa,y.e31=T,y.e32=ca,y.e33=_a,z.sizeMat4==z.stackMat4.length){for(var w=z.sizeMat4<<1,ta=new Array(w),ra=ta,la=0,va=z.sizeMat4;la<va;){var xa=la++;ra[xa]=z.stackMat4[xa],z.stackMat4[xa]=null}z.stackMat4=ra}z.stackMat4[z.sizeMat4++]=y}if(V!=null){var za=0,Ma=0,Xa=0,Za=1;if(V.x=za,V.y=Ma,V.z=Xa,V.w=Za,z.sizeQuat==z.stackQuat.length){for(var fa=z.sizeQuat<<1,ba=new Array(fa),ea=ba,ha=0,ma=z.sizeQuat;ha<ma;){var ya=ha++;ea[ya]=z.stackQuat[ya],z.stackQuat[ya]=null}z.stackQuat=ea}z.stackQuat[z.sizeQuat++]=V}_>h?a.ellipse(t,i,r,s,s,v):a.arc(t,i,r,s,s,_,h,!0,v)}}_drawTranslationalLimit(a,t,i,r,o,s){if(r<o){var _=this._pool,h=_.sizeVec3==0?new x.common.Vec3:_.stackVec3[--_.sizeVec3];h.x=t.x,h.y=t.y,h.z=t.z;var v=h,e=v.x+i.x*r,l=v.y+i.y*r,u=v.z+i.z*r;v.x=e,v.y=l,v.z=u;var b=v,f=this._pool,n=f.sizeVec3==0?new x.common.Vec3:f.stackVec3[--f.sizeVec3];n.x=t.x,n.y=t.y,n.z=t.z;var c=n,z=c.x+i.x*o,p=c.y+i.y*o,y=c.z+i.z*o;c.x=z,c.y=p,c.z=y;var V=c;a.line(b,V,s);var M=this._pool,I=null,k=null,X=null;if(b!=null){if(b.zero(),M.sizeVec3==M.stackVec3.length){for(var L=M.sizeVec3<<1,m=new Array(L),g=m,N=0,A=M.sizeVec3;N<A;){var F=N++;g[F]=M.stackVec3[F],M.stackVec3[F]=null}M.stackVec3=g}M.stackVec3[M.sizeVec3++]=b}if(I!=null){var P=1,Y=0,R=0,C=0,d=1,Z=0,$=0,K=0,E=1;if(I.e00=P,I.e01=Y,I.e02=R,I.e10=C,I.e11=d,I.e12=Z,I.e20=$,I.e21=K,I.e22=E,M.sizeMat3==M.stackMat3.length){for(var J=M.sizeMat3<<1,B=new Array(J),Q=B,U=0,G=M.sizeMat3;U<G;){var D=U++;Q[D]=M.stackMat3[D],M.stackMat3[D]=null}M.stackMat3=Q}M.stackMat3[M.sizeMat3++]=I}if(k!=null){var H=1,j=0,ia=0,sa=0,W=0,q=1,na=0,oa=0,aa=0,T=0,ca=1,_a=0,w=0,ta=0,ra=0,la=1;if(k.e00=H,k.e01=j,k.e02=ia,k.e03=sa,k.e10=W,k.e11=q,k.e12=na,k.e13=oa,k.e20=aa,k.e21=T,k.e22=ca,k.e23=_a,k.e30=w,k.e31=ta,k.e32=ra,k.e33=la,M.sizeMat4==M.stackMat4.length){for(var va=M.sizeMat4<<1,xa=new Array(va),za=xa,Ma=0,Xa=M.sizeMat4;Ma<Xa;){var Za=Ma++;za[Za]=M.stackMat4[Za],M.stackMat4[Za]=null}M.stackMat4=za}M.stackMat4[M.sizeMat4++]=k}if(X!=null){var fa=0,ba=0,ea=0,ha=1;if(X.x=fa,X.y=ba,X.z=ea,X.w=ha,M.sizeQuat==M.stackQuat.length){for(var ma=M.sizeQuat<<1,ya=new Array(ma),da=ya,pa=0,Ya=M.sizeQuat;pa<Ya;){var Qa=pa++;da[Qa]=M.stackQuat[Qa],M.stackQuat[Qa]=null}M.stackQuat=da}M.stackQuat[M.sizeQuat++]=X}var ga=this._pool,ua=null,wa=null,ka=null;if(V!=null){if(V.zero(),ga.sizeVec3==ga.stackVec3.length){for(var Sa=ga.sizeVec3<<1,zt=new Array(Sa),Ha=zt,Ba=0,nt=ga.sizeVec3;Ba<nt;){var Ea=Ba++;Ha[Ea]=ga.stackVec3[Ea],ga.stackVec3[Ea]=null}ga.stackVec3=Ha}ga.stackVec3[ga.sizeVec3++]=V}if(ua!=null){var Fa=1,Aa=0,ft=0,Wa=0,Ka=1,bt=0,it=0,$a=0,_t=1;if(ua.e00=Fa,ua.e01=Aa,ua.e02=ft,ua.e10=Wa,ua.e11=Ka,ua.e12=bt,ua.e20=it,ua.e21=$a,ua.e22=_t,ga.sizeMat3==ga.stackMat3.length){for(var gt=ga.sizeMat3<<1,pt=new Array(gt),Ga=pt,rt=0,ut=ga.sizeMat3;rt<ut;){var Da=rt++;Ga[Da]=ga.stackMat3[Da],ga.stackMat3[Da]=null}ga.stackMat3=Ga}ga.stackMat3[ga.sizeMat3++]=ua}if(wa!=null){var Ta=1,Na=0,Vt=0,St=0,et=0,Xt=1,Yt=0,Mt=0,Ia=0,O=0,Va=1,lt=0,S=0,wt=0,Bt=0,At=1;if(wa.e00=Ta,wa.e01=Na,wa.e02=Vt,wa.e03=St,wa.e10=et,wa.e11=Xt,wa.e12=Yt,wa.e13=Mt,wa.e20=Ia,wa.e21=O,wa.e22=Va,wa.e23=lt,wa.e30=S,wa.e31=wt,wa.e32=Bt,wa.e33=At,ga.sizeMat4==ga.stackMat4.length){for(var yt=ga.sizeMat4<<1,kt=new Array(yt),mt=kt,ht=0,xt=ga.sizeMat4;ht<xt;){var Ra=ht++;mt[Ra]=ga.stackMat4[Ra],ga.stackMat4[Ra]=null}ga.stackMat4=mt}ga.stackMat4[ga.sizeMat4++]=wa}if(ka!=null){var st=0,Ca=0,vt=0,qa=1;if(ka.x=st,ka.y=Ca,ka.z=vt,ka.w=qa,ga.sizeQuat==ga.stackQuat.length){for(var at=ga.sizeQuat<<1,Oa=new Array(at),tt=Oa,ct=0,Pa=ga.sizeQuat;ct<Pa;){var Ja=ct++;tt[Ja]=ga.stackQuat[Ja],ga.stackQuat[Ja]=null}ga.stackQuat=tt}ga.stackQuat[ga.sizeQuat++]=ka}}}_drawTranslationalLimit3D(a,t,i,r,o,s,_,h,v){var e=s.lowerLimit,l=s.upperLimit,u=_.lowerLimit,b=_.upperLimit,f=h.lowerLimit,n=h.upperLimit,c=this._pool;c.sizeVec3==0?new x.common.Vec3:c.stackVec3[--c.sizeVec3];var z=this._pool;z.sizeVec3==0?new x.common.Vec3:z.stackVec3[--z.sizeVec3];var p=this._pool,y=p.sizeVec3==0?new x.common.Vec3:p.stackVec3[--p.sizeVec3];y.x=t.x,y.y=t.y,y.z=t.z;var V=y,M=V.x+i.x*e,I=V.y+i.y*e,k=V.z+i.z*e;V.x=M,V.y=I,V.z=k;var X=V,L=X.x+r.x*u,m=X.y+r.y*u,g=X.z+r.z*u;X.x=L,X.y=m,X.z=g;var N=X,A=N.x+o.x*f,F=N.y+o.y*f,P=N.z+o.z*f;N.x=A,N.y=F,N.z=P;var Y=N,R=this._pool,C=R.sizeVec3==0?new x.common.Vec3:R.stackVec3[--R.sizeVec3];C.x=t.x,C.y=t.y,C.z=t.z;var d=C,Z=d.x+i.x*e,$=d.y+i.y*e,K=d.z+i.z*e;d.x=Z,d.y=$,d.z=K;var E=d,J=E.x+r.x*u,B=E.y+r.y*u,Q=E.z+r.z*u;E.x=J,E.y=B,E.z=Q;var U=E,G=U.x+o.x*n,D=U.y+o.y*n,H=U.z+o.z*n;U.x=G,U.y=D,U.z=H;var j=U,ia=this._pool,sa=ia.sizeVec3==0?new x.common.Vec3:ia.stackVec3[--ia.sizeVec3];sa.x=t.x,sa.y=t.y,sa.z=t.z;var W=sa,q=W.x+i.x*e,na=W.y+i.y*e,oa=W.z+i.z*e;W.x=q,W.y=na,W.z=oa;var aa=W,T=aa.x+r.x*b,ca=aa.y+r.y*b,_a=aa.z+r.z*b;aa.x=T,aa.y=ca,aa.z=_a;var w=aa,ta=w.x+o.x*f,ra=w.y+o.y*f,la=w.z+o.z*f;w.x=ta,w.y=ra,w.z=la;var va=w,xa=this._pool,za=xa.sizeVec3==0?new x.common.Vec3:xa.stackVec3[--xa.sizeVec3];za.x=t.x,za.y=t.y,za.z=t.z;var Ma=za,Xa=Ma.x+i.x*e,Za=Ma.y+i.y*e,fa=Ma.z+i.z*e;Ma.x=Xa,Ma.y=Za,Ma.z=fa;var ba=Ma,ea=ba.x+r.x*b,ha=ba.y+r.y*b,ma=ba.z+r.z*b;ba.x=ea,ba.y=ha,ba.z=ma;var ya=ba,da=ya.x+o.x*n,pa=ya.y+o.y*n,Ya=ya.z+o.z*n;ya.x=da,ya.y=pa,ya.z=Ya;var Qa=ya,ga=this._pool,ua=ga.sizeVec3==0?new x.common.Vec3:ga.stackVec3[--ga.sizeVec3];ua.x=t.x,ua.y=t.y,ua.z=t.z;var wa=ua,ka=wa.x+i.x*l,Sa=wa.y+i.y*l,zt=wa.z+i.z*l;wa.x=ka,wa.y=Sa,wa.z=zt;var Ha=wa,Ba=Ha.x+r.x*u,nt=Ha.y+r.y*u,Ea=Ha.z+r.z*u;Ha.x=Ba,Ha.y=nt,Ha.z=Ea;var Fa=Ha,Aa=Fa.x+o.x*f,ft=Fa.y+o.y*f,Wa=Fa.z+o.z*f;Fa.x=Aa,Fa.y=ft,Fa.z=Wa;var Ka=Fa,bt=this._pool,it=bt.sizeVec3==0?new x.common.Vec3:bt.stackVec3[--bt.sizeVec3];it.x=t.x,it.y=t.y,it.z=t.z;var $a=it,_t=$a.x+i.x*l,gt=$a.y+i.y*l,pt=$a.z+i.z*l;$a.x=_t,$a.y=gt,$a.z=pt;var Ga=$a,rt=Ga.x+r.x*u,ut=Ga.y+r.y*u,Da=Ga.z+r.z*u;Ga.x=rt,Ga.y=ut,Ga.z=Da;var Ta=Ga,Na=Ta.x+o.x*n,Vt=Ta.y+o.y*n,St=Ta.z+o.z*n;Ta.x=Na,Ta.y=Vt,Ta.z=St;var et=Ta,Xt=this._pool,Yt=Xt.sizeVec3==0?new x.common.Vec3:Xt.stackVec3[--Xt.sizeVec3];Yt.x=t.x,Yt.y=t.y,Yt.z=t.z;var Mt=Yt,Ia=Mt.x+i.x*l,O=Mt.y+i.y*l,Va=Mt.z+i.z*l;Mt.x=Ia,Mt.y=O,Mt.z=Va;var lt=Mt,S=lt.x+r.x*b,wt=lt.y+r.y*b,Bt=lt.z+r.z*b;lt.x=S,lt.y=wt,lt.z=Bt;var At=lt,yt=At.x+o.x*f,kt=At.y+o.y*f,mt=At.z+o.z*f;At.x=yt,At.y=kt,At.z=mt;var ht=At,xt=this._pool,Ra=xt.sizeVec3==0?new x.common.Vec3:xt.stackVec3[--xt.sizeVec3];Ra.x=t.x,Ra.y=t.y,Ra.z=t.z;var st=Ra,Ca=st.x+i.x*l,vt=st.y+i.y*l,qa=st.z+i.z*l;st.x=Ca,st.y=vt,st.z=qa;var at=st,Oa=at.x+r.x*b,tt=at.y+r.y*b,ct=at.z+r.z*b;at.x=Oa,at.y=tt,at.z=ct;var Pa=at,Ja=Pa.x+o.x*n,ja=Pa.y+o.y*n,La=Pa.z+o.z*n;Pa.x=Ja,Pa.y=ja,Pa.z=La;var ot=Pa;a.line(Y,Ka,v),a.line(va,ht,v),a.line(j,et,v),a.line(Qa,ot,v),a.line(Y,va,v),a.line(Ka,ht,v),a.line(j,Qa,v),a.line(et,ot,v),a.line(Y,j,v),a.line(Ka,et,v),a.line(va,Qa,v),a.line(ht,ot,v);var It=this._pool;if(Y!=null){if(Y.zero(),It.sizeVec3==It.stackVec3.length){for(var oi=It.sizeVec3<<1,gi=new Array(oi),ai=gi,Ct=0,_i=It.sizeVec3;Ct<_i;){var Et=Ct++;ai[Et]=It.stackVec3[Et],It.stackVec3[Et]=null}It.stackVec3=ai}It.stackVec3[It.sizeVec3++]=Y}var Pt=this._pool;if(j!=null){if(j.zero(),Pt.sizeVec3==Pt.stackVec3.length){for(var Jt=Pt.sizeVec3<<1,Ki=new Array(Jt),vi=Ki,li=0,ti=Pt.sizeVec3;li<ti;){var Oi=li++;vi[Oi]=Pt.stackVec3[Oi],Pt.stackVec3[Oi]=null}Pt.stackVec3=vi}Pt.stackVec3[Pt.sizeVec3++]=j}var Xi=this._pool;if(va!=null){if(va.zero(),Xi.sizeVec3==Xi.stackVec3.length){for(var zi=Xi.sizeVec3<<1,Zt=new Array(zi),ri=Zt,Wt=0,ni=Xi.sizeVec3;Wt<ni;){var $i=Wt++;ri[$i]=Xi.stackVec3[$i],Xi.stackVec3[$i]=null}Xi.stackVec3=ri}Xi.stackVec3[Xi.sizeVec3++]=va}var Ut=this._pool;if(Qa!=null){if(Qa.zero(),Ut.sizeVec3==Ut.stackVec3.length){for(var ji=Ut.sizeVec3<<1,Ii=new Array(ji),pr=Ii,Wi=0,Lt=Ut.sizeVec3;Wi<Lt;){var jt=Wi++;pr[jt]=Ut.stackVec3[jt],Ut.stackVec3[jt]=null}Ut.stackVec3=pr}Ut.stackVec3[Ut.sizeVec3++]=Qa}var Tt=this._pool;if(Ka!=null){if(Ka.zero(),Tt.sizeVec3==Tt.stackVec3.length){for(var bi=Tt.sizeVec3<<1,Mi=new Array(bi),vr=Mi,qt=0,fi=Tt.sizeVec3;qt<fi;){var dt=qt++;vr[dt]=Tt.stackVec3[dt],Tt.stackVec3[dt]=null}Tt.stackVec3=vr}Tt.stackVec3[Tt.sizeVec3++]=Ka}var ui=this._pool;if(et!=null){if(et.zero(),ui.sizeVec3==ui.stackVec3.length){for(var hi=ui.sizeVec3<<1,er=new Array(hi),Xr=er,ro=0,Gt=ui.sizeVec3;ro<Gt;){var fr=ro++;Xr[fr]=ui.stackVec3[fr],ui.stackVec3[fr]=null}ui.stackVec3=Xr}ui.stackVec3[ui.sizeVec3++]=et}var mr=this._pool;if(ht!=null){if(ht.zero(),mr.sizeVec3==mr.stackVec3.length){for(var Dt=mr.sizeVec3<<1,dr=new Array(Dt),Pi=dr,Dr=0,Hn=mr.sizeVec3;Dr<Hn;){var oo=Dr++;Pi[oo]=mr.stackVec3[oo],mr.stackVec3[oo]=null}mr.stackVec3=Pi}mr.stackVec3[mr.sizeVec3++]=ht}var Br=this._pool;if(ot!=null){if(ot.zero(),Br.sizeVec3==Br.stackVec3.length){for(var no=Br.sizeVec3<<1,yn=new Array(no),Ao=yn,Io=0,xi=Br.sizeVec3;Io<xi;){var qr=Io++;Ao[qr]=Br.stackVec3[qr],Br.stackVec3[qr]=null}Br.stackVec3=Ao}Br.stackVec3[Br.sizeVec3++]=ot}}_drawEllipseOnSphere(a,t,i,r,o,s,_,h,v){for(var e=16,l=0,u=6.28318530717958/e,b=this._pool,f=b.sizeVec3==0?new x.common.Vec3:b.stackVec3[--b.sizeVec3],n=this._pool,c=n.sizeQuat==0?new x.common.Quat:n.stackQuat[--n.sizeQuat],z=this._pool,p=z.sizeMat3==0?new x.common.Mat3:z.stackMat3[--z.sizeMat3],y=this._pool,V=y.sizeVec3==0?new x.common.Vec3:y.stackVec3[--y.sizeVec3],M=0,I=e+1;M<I;){var k=M++,X=Math.cos(l)*s,L=Math.sin(l)*_,m=Math.sqrt(X*X+L*L),g=Math.sin(m*.5),N=Math.cos(m*.5),A=f.zero(),F=A.x+r.x*X,P=A.y+r.y*X,Y=A.z+r.z*X;A.x=F,A.y=P,A.z=Y;var R=A,C=R.x+o.x*L,d=R.y+o.y*L,Z=R.z+o.z*L;R.x=C,R.y=d,R.z=Z;var $=1/m*g,K=f.x*$,E=f.y*$,J=f.z*$;f.x=K,f.y=E,f.z=J,c.x=f.x,c.y=f.y,c.z=f.z,c.w=N;var B=c.x,Q=c.y,U=c.z,G=c.w,D=2*B,H=2*Q,j=2*U,ia=B*D,sa=Q*H,W=U*j,q=B*H,na=Q*j,oa=B*j,aa=G*D,T=G*H,ca=G*j;p.e00=1-sa-W,p.e01=q-ca,p.e02=oa+T,p.e10=q+ca,p.e11=1-ia-W,p.e12=na-aa,p.e20=oa-T,p.e21=na+aa,p.e22=1-ia-sa;var _a=this._pool,w=_a.sizeVec3==0?new x.common.Vec3:_a.stackVec3[--_a.sizeVec3],ta=w.x+i.x*h,ra=w.y+i.y*h,la=w.z+i.z*h;w.x=ta,w.y=ra,w.z=la;var va=w,xa=va.x*p.e00+va.y*p.e01+va.z*p.e02,za=va.x*p.e10+va.y*p.e11+va.z*p.e12,Ma=va.x*p.e20+va.y*p.e21+va.z*p.e22;va.x=xa,va.y=za,va.z=Ma;var Xa=va,Za=Xa.x+t.x,fa=Xa.y+t.y,ba=Xa.z+t.z;Xa.x=Za,Xa.y=fa,Xa.z=ba,k>=1&&a.line(V,va,v);var ea=this._pool,ha=null,ma=null,ya=null;if(V!=null){if(V.zero(),ea.sizeVec3==ea.stackVec3.length){for(var da=ea.sizeVec3<<1,pa=new Array(da),Ya=pa,Qa=0,ga=ea.sizeVec3;Qa<ga;){var ua=Qa++;Ya[ua]=ea.stackVec3[ua],ea.stackVec3[ua]=null}ea.stackVec3=Ya}ea.stackVec3[ea.sizeVec3++]=V}if(ha!=null){var wa=1,ka=0,Sa=0,zt=0,Ha=1,Ba=0,nt=0,Ea=0,Fa=1;if(ha.e00=wa,ha.e01=ka,ha.e02=Sa,ha.e10=zt,ha.e11=Ha,ha.e12=Ba,ha.e20=nt,ha.e21=Ea,ha.e22=Fa,ea.sizeMat3==ea.stackMat3.length){for(var Aa=ea.sizeMat3<<1,ft=new Array(Aa),Wa=ft,Ka=0,bt=ea.sizeMat3;Ka<bt;){var it=Ka++;Wa[it]=ea.stackMat3[it],ea.stackMat3[it]=null}ea.stackMat3=Wa}ea.stackMat3[ea.sizeMat3++]=ha}if(ma!=null){var $a=1,_t=0,gt=0,pt=0,Ga=0,rt=1,ut=0,Da=0,Ta=0,Na=0,Vt=1,St=0,et=0,Xt=0,Yt=0,Mt=1;if(ma.e00=$a,ma.e01=_t,ma.e02=gt,ma.e03=pt,ma.e10=Ga,ma.e11=rt,ma.e12=ut,ma.e13=Da,ma.e20=Ta,ma.e21=Na,ma.e22=Vt,ma.e23=St,ma.e30=et,ma.e31=Xt,ma.e32=Yt,ma.e33=Mt,ea.sizeMat4==ea.stackMat4.length){for(var Ia=ea.sizeMat4<<1,O=new Array(Ia),Va=O,lt=0,S=ea.sizeMat4;lt<S;){var wt=lt++;Va[wt]=ea.stackMat4[wt],ea.stackMat4[wt]=null}ea.stackMat4=Va}ea.stackMat4[ea.sizeMat4++]=ma}if(ya!=null){var Bt=0,At=0,yt=0,kt=1;if(ya.x=Bt,ya.y=At,ya.z=yt,ya.w=kt,ea.sizeQuat==ea.stackQuat.length){for(var mt=ea.sizeQuat<<1,ht=new Array(mt),xt=ht,Ra=0,st=ea.sizeQuat;Ra<st;){var Ca=Ra++;xt[Ca]=ea.stackQuat[Ca],ea.stackQuat[Ca]=null}ea.stackQuat=xt}ea.stackQuat[ea.sizeQuat++]=ya}V=va,l+=u}var vt=this._pool;if(f!=null){if(f.zero(),vt.sizeVec3==vt.stackVec3.length){for(var qa=vt.sizeVec3<<1,at=new Array(qa),Oa=at,tt=0,ct=vt.sizeVec3;tt<ct;){var Pa=tt++;Oa[Pa]=vt.stackVec3[Pa],vt.stackVec3[Pa]=null}vt.stackVec3=Oa}vt.stackVec3[vt.sizeVec3++]=f}var Ja=this._pool;if(c!=null){var ja=0,La=0,ot=0,It=1;if(c.x=ja,c.y=La,c.z=ot,c.w=It,Ja.sizeQuat==Ja.stackQuat.length){for(var oi=Ja.sizeQuat<<1,gi=new Array(oi),ai=gi,Ct=0,_i=Ja.sizeQuat;Ct<_i;){var Et=Ct++;ai[Et]=Ja.stackQuat[Et],Ja.stackQuat[Et]=null}Ja.stackQuat=ai}Ja.stackQuat[Ja.sizeQuat++]=c}var Pt=this._pool;if(p!=null){var Jt=1,Ki=0,vi=0,li=0,ti=1,Oi=0,Xi=0,zi=0,Zt=1;if(p.e00=Jt,p.e01=Ki,p.e02=vi,p.e10=li,p.e11=ti,p.e12=Oi,p.e20=Xi,p.e21=zi,p.e22=Zt,Pt.sizeMat3==Pt.stackMat3.length){for(var ri=Pt.sizeMat3<<1,Wt=new Array(ri),ni=Wt,$i=0,Ut=Pt.sizeMat3;$i<Ut;){var ji=$i++;ni[ji]=Pt.stackMat3[ji],Pt.stackMat3[ji]=null}Pt.stackMat3=ni}Pt.stackMat3[Pt.sizeMat3++]=p}var Ii=this._pool;if(V!=null){if(V.zero(),Ii.sizeVec3==Ii.stackVec3.length){for(var pr=Ii.sizeVec3<<1,Wi=new Array(pr),Lt=Wi,jt=0,Tt=Ii.sizeVec3;jt<Tt;){var bi=jt++;Lt[bi]=Ii.stackVec3[bi],Ii.stackVec3[bi]=null}Ii.stackVec3=Lt}Ii.stackVec3[Ii.sizeVec3++]=V}}step(a){this._timeStep.dt>0&&(this._timeStep.dtRatio=a/this._timeStep.dt),this._timeStep.dt=a,this._timeStep.invDt=1/a;var t=Date.now()/1e3;this._updateContacts(),this._solveIslands();var i=Date.now()/1e3;x.dynamics.common.Performance.totalTime=(i-t)*1e3}addRigidBody(a){if(a._world!=null)throw new Error("A rigid body cannot belong to multiple worlds.");this._rigidBodyList==null?(this._rigidBodyList=a,this._rigidBodyListLast=a):(this._rigidBodyListLast._next=a,a._prev=this._rigidBodyListLast,this._rigidBodyListLast=a),a._world=this;for(var t=a._shapeList;t!=null;){var i=t._next;t._proxy=this._broadPhase.createProxy(t,t._aabb),t._id=this._shapeIdCount++,this._numShapes++,t=i}this._numRigidBodies++}removeRigidBody(a){if(a._world!=this)throw new Error("The rigid body doesn't belong to the world.");var t=a._prev,i=a._next;t!=null&&(t._next=i),i!=null&&(i._prev=t),a==this._rigidBodyList&&(this._rigidBodyList=this._rigidBodyList._next),a==this._rigidBodyListLast&&(this._rigidBodyListLast=this._rigidBodyListLast._prev),a._next=null,a._prev=null,a._world=null;for(var r=a._shapeList;r!=null;){var o=r._next;this._broadPhase.destroyProxy(r._proxy),r._proxy=null,r._id=-1;for(var s=r._rigidBody._contactLinkList;s!=null;){var _=s._next,h=s._contact;if(h._s1==r||h._s2==r){var v=s._other;v._sleeping=!1,v._sleepTime=0;var e=this._contactManager,l=h._prev,u=h._next;if(l!=null&&(l._next=u),u!=null&&(u._prev=l),h==e._contactList&&(e._contactList=e._contactList._next),h==e._contactListLast&&(e._contactListLast=e._contactListLast._prev),h._next=null,h._prev=null,h._touching){var b=h._s1._contactCallback,f=h._s2._contactCallback;b==f&&(f=null),b!=null&&b.endContact(h),f!=null&&f.endContact(h)}var n=h._link1._prev,c=h._link1._next;n!=null&&(n._next=c),c!=null&&(c._prev=n),h._link1==h._b1._contactLinkList&&(h._b1._contactLinkList=h._b1._contactLinkList._next),h._link1==h._b1._contactLinkListLast&&(h._b1._contactLinkListLast=h._b1._contactLinkListLast._prev),h._link1._next=null,h._link1._prev=null;var z=h._link2._prev,p=h._link2._next;z!=null&&(z._next=p),p!=null&&(p._prev=z),h._link2==h._b2._contactLinkList&&(h._b2._contactLinkList=h._b2._contactLinkList._next),h._link2==h._b2._contactLinkListLast&&(h._b2._contactLinkListLast=h._b2._contactLinkListLast._prev),h._link2._next=null,h._link2._prev=null,h._b1._numContactLinks--,h._b2._numContactLinks--,h._link1._other=null,h._link2._other=null,h._link1._contact=null,h._link2._contact=null,h._s1=null,h._s2=null,h._b1=null,h._b2=null,h._touching=!1,h._cachedDetectorData._clear(),h._manifold._clear(),h._detector=null;var y=h._contactConstraint;y._s1=null,y._s2=null,y._b1=null,y._b2=null,y._tf1=null,y._tf2=null,h._next=e._contactPool,e._contactPool=h,e._numContacts--}s=_}this._numShapes--,r=o}this._numRigidBodies--}addJoint(a){if(a._world!=null)throw new Error("A joint cannot belong to multiple worlds.");this._jointList==null?(this._jointList=a,this._jointListLast=a):(this._jointListLast._next=a,a._prev=this._jointListLast,this._jointListLast=a),a._world=this,a._link1._other=a._b2,a._link2._other=a._b1,a._b1._jointLinkList==null?(a._b1._jointLinkList=a._link1,a._b1._jointLinkListLast=a._link1):(a._b1._jointLinkListLast._next=a._link1,a._link1._prev=a._b1._jointLinkListLast,a._b1._jointLinkListLast=a._link1),a._b2._jointLinkList==null?(a._b2._jointLinkList=a._link2,a._b2._jointLinkListLast=a._link2):(a._b2._jointLinkListLast._next=a._link2,a._link2._prev=a._b2._jointLinkListLast,a._b2._jointLinkListLast=a._link2),a._b1._numJointLinks++,a._b2._numJointLinks++;var t=a._b1;t._sleeping=!1,t._sleepTime=0;var i=a._b2;i._sleeping=!1,i._sleepTime=0,a._syncAnchors(),this._numJoints++}removeJoint(a){if(a._world!=this)throw new Error("The joint doesn't belong to the world.");var t=a._prev,i=a._next;t!=null&&(t._next=i),i!=null&&(i._prev=t),a==this._jointList&&(this._jointList=this._jointList._next),a==this._jointListLast&&(this._jointListLast=this._jointListLast._prev),a._next=null,a._prev=null,a._world=null;var r=a._link1._prev,o=a._link1._next;r!=null&&(r._next=o),o!=null&&(o._prev=r),a._link1==a._b1._jointLinkList&&(a._b1._jointLinkList=a._b1._jointLinkList._next),a._link1==a._b1._jointLinkListLast&&(a._b1._jointLinkListLast=a._b1._jointLinkListLast._prev),a._link1._next=null,a._link1._prev=null;var s=a._link2._prev,_=a._link2._next;s!=null&&(s._next=_),_!=null&&(_._prev=s),a._link2==a._b2._jointLinkList&&(a._b2._jointLinkList=a._b2._jointLinkList._next),a._link2==a._b2._jointLinkListLast&&(a._b2._jointLinkListLast=a._b2._jointLinkListLast._prev),a._link2._next=null,a._link2._prev=null,a._link1._other=null,a._link2._other=null,a._b1._numJointLinks--,a._b2._numJointLinks--;var h=a._b1;h._sleeping=!1,h._sleepTime=0;var v=a._b2;v._sleeping=!1,v._sleepTime=0,this._numJoints--}setDebugDraw(a){this._debugDraw=a}getDebugDraw(){return this._debugDraw}debugDraw(){if(this._debugDraw!=null){if(this._broadPhase._type==2){var a=this._broadPhase;this._drawBvh(this._debugDraw,a._tree)}this._drawRigidBodies(this._debugDraw),this._drawConstraints(this._debugDraw)}}rayCast(a,t,i){var r=this._rayCastWrapper.begin;r.x=a.x,r.y=a.y,r.z=a.z;var o=this._rayCastWrapper.end;o.x=t.x,o.y=t.y,o.z=t.z,this._rayCastWrapper.callback=i,this._broadPhase.rayCast(a,t,this._rayCastWrapper)}convexCast(a,t,i,r){this._convexCastWrapper.convex=a;var o=this._convexCastWrapper.begin;o._positionX=t._positionX,o._positionY=t._positionY,o._positionZ=t._positionZ,o._rotation00=t._rotation00,o._rotation01=t._rotation01,o._rotation02=t._rotation02,o._rotation10=t._rotation10,o._rotation11=t._rotation11,o._rotation12=t._rotation12,o._rotation20=t._rotation20,o._rotation21=t._rotation21,o._rotation22=t._rotation22;var s=this._convexCastWrapper.translation;s.x=i.x,s.y=i.y,s.z=i.z,this._convexCastWrapper.callback=r,this._broadPhase.convexCast(a,t,i,this._convexCastWrapper)}aabbTest(a,t){this._aabbTestWrapper._aabb.copyFrom(a),this._aabbTestWrapper._callback=t,this._broadPhase.aabbTest(a,this._aabbTestWrapper)}getRigidBodyList(){return this._rigidBodyList}getJointList(){return this._jointList}getBroadPhase(){return this._broadPhase}getContactManager(){return this._contactManager}getNumRigidBodies(){return this._numRigidBodies}getNumJoints(){return this._numJoints}getNumShapes(){return this._numShapes}getNumIslands(){return this._numIslands}getNumVelocityIterations(){return this._numVelocityIterations}setNumVelocityIterations(a){this._numVelocityIterations=a}getNumPositionIterations(){return this._numPositionIterations}setNumPositionIterations(a){this._numPositionIterations=a}getGravity(){return this._gravity}setGravity(a){var t=this._gravity;t.x=a.x,t.y=a.y,t.z=a.z}};x.dynamics._World||(x.dynamics._World={});x.dynamics._World.RayCastWrapper=class extends x.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new x.collision.geometry.RayCastHit,this.begin=new x.common.Vec3,this.end=new x.common.Vec3,this.callback=null}process(a){var t=a.userData;t._geom.rayCast(this.begin,this.end,t._transform,this.rayCastHit)&&this.callback.process(t,this.rayCastHit)}};x.dynamics._World.ConvexCastWrapper=class extends x.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new x.collision.geometry.RayCastHit,this.begin=new x.common.Transform,this.translation=new x.common.Vec3,this.zero=new x.common.Vec3,this.callback=null,this.convex=null}process(a){var t=a.userData,i=t._geom._type;if(!(i<0||i>5)){var r=t._geom;x.collision.narrowphase.detector.gjkepa.GjkEpa.instance.convexCast(this.convex,r,this.begin,t._transform,this.translation,this.zero,this.rayCastHit)&&this.callback.process(t,this.rayCastHit)}}};x.dynamics._World.AabbTestWrapper=class extends x.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this._aabb=new x.collision.geometry.Aabb,this._callback=null}process(a){var t=a.userData,i=t._aabb;i._minX<this._aabb._maxX&&i._maxX>this._aabb._minX&&i._minY<this._aabb._maxY&&i._maxY>this._aabb._minY&&i._minZ<this._aabb._maxZ&&i._maxZ>this._aabb._minZ&&this._callback.process(t)}};x.dynamics.callback||(x.dynamics.callback={});x.dynamics.callback.AabbTestCallback=class{constructor(){}process(a){}};x.dynamics.callback.ContactCallback=class{constructor(){}beginContact(a){}preSolve(a){}postSolve(a){}endContact(a){}};x.dynamics.callback.RayCastCallback=class{constructor(){}process(a,t){}};x.dynamics.callback.RayCastClosest=class extends x.dynamics.callback.RayCastCallback{constructor(){super(),this.position=new x.common.Vec3,this.normal=new x.common.Vec3,this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}clear(){this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}process(a,t){if(t.fraction<this.fraction){this.shape=a,this.hit=!0,this.fraction=t.fraction;var i=this.position,r=t.position;i.x=r.x,i.y=r.y,i.z=r.z;var o=this.normal,s=t.normal;o.x=s.x,o.y=s.y,o.z=s.z}}};x.dynamics.common||(x.dynamics.common={});x.dynamics.common.DebugDraw=class{constructor(){this.p=new x.common.Pool,this.wireframe=!1,this.drawShapes=!0,this.drawBvh=!1,this.drawBvhMinLevel=0,this.drawBvhMaxLevel=65536,this.drawAabbs=!1,this.drawBases=!1,this.drawPairs=!1,this.drawContacts=!1,this.drawJoints=!0,this.drawJointLimits=!1;var a=4,t=3.14159265358979/a,i=8,r=6.28318530717958/i,o=new Array(a+1);this.sphereCoords=o;var s=new Array(a+1);this.tmpSphereVerts=s;var _=new Array(a+1);this.tmpSphereNorms=_;for(var h=0,v=a+1;h<v;){var e=h++,l=e==0||e==a?1:i,u=this.sphereCoords,b=new Array(l);u[e]=b;var f=this.tmpSphereVerts,n=new Array(l);f[e]=n;var c=this.tmpSphereNorms,z=new Array(l);c[e]=z;for(var p=0,y=i;p<y;){var V=p++,M=e*t,I=V*r;this.sphereCoords[e][V]=new x.common.Vec3(Math.sin(M)*Math.cos(I),Math.cos(M),-Math.sin(M)*Math.sin(I)),this.tmpSphereVerts[e][V]=new x.common.Vec3,this.tmpSphereNorms[e][V]=new x.common.Vec3}}var k=new Array(8);this.circleCoords=k;var X=new Array(8);this.circleCoordsShift=X;var L=new Array(8);this.tmpCircleVerts1=L;var m=new Array(8);this.tmpCircleVerts2=m;var g=new Array(8);this.tmpCircleNorms=g;for(var N=.7853981633974475,A=0;A<8;){var F=A++;this.circleCoords[F]=new x.common.Vec3(Math.cos(F*N),0,-Math.sin(F*N)),this.circleCoordsShift[F]=new x.common.Vec3(Math.cos((F+.5)*N),0,-Math.sin((F+.5)*N)),this.tmpCircleVerts1[F]=new x.common.Vec3,this.tmpCircleVerts2[F]=new x.common.Vec3,this.tmpCircleNorms[F]=new x.common.Vec3}this.style=new x.dynamics.common.DebugDrawStyle}aabb(a,t,i){var r=this.p,o=(r.sizeVec3==0?new x.common.Vec3:r.stackVec3[--r.sizeVec3]).init(a.x,a.y,a.z),s=this.p,_=(s.sizeVec3==0?new x.common.Vec3:s.stackVec3[--s.sizeVec3]).init(a.x,a.y,t.z),h=this.p,v=(h.sizeVec3==0?new x.common.Vec3:h.stackVec3[--h.sizeVec3]).init(a.x,t.y,a.z),e=this.p,l=(e.sizeVec3==0?new x.common.Vec3:e.stackVec3[--e.sizeVec3]).init(a.x,t.y,t.z),u=this.p,b=(u.sizeVec3==0?new x.common.Vec3:u.stackVec3[--u.sizeVec3]).init(t.x,a.y,a.z),f=this.p,n=(f.sizeVec3==0?new x.common.Vec3:f.stackVec3[--f.sizeVec3]).init(t.x,a.y,t.z),c=this.p,z=(c.sizeVec3==0?new x.common.Vec3:c.stackVec3[--c.sizeVec3]).init(t.x,t.y,a.z),p=this.p,y=(p.sizeVec3==0?new x.common.Vec3:p.stackVec3[--p.sizeVec3]).init(t.x,t.y,t.z);this.line(o,_,i),this.line(v,l,i),this.line(b,n,i),this.line(z,y,i),this.line(o,v,i),this.line(_,l,i),this.line(b,z,i),this.line(n,y,i),this.line(o,b,i),this.line(_,n,i),this.line(v,z,i),this.line(l,y,i);var V=this.p;if(o!=null){if(o.zero(),V.sizeVec3==V.stackVec3.length){for(var M=V.sizeVec3<<1,I=new Array(M),k=I,X=0,L=V.sizeVec3;X<L;){var m=X++;k[m]=V.stackVec3[m],V.stackVec3[m]=null}V.stackVec3=k}V.stackVec3[V.sizeVec3++]=o}var g=this.p;if(_!=null){if(_.zero(),g.sizeVec3==g.stackVec3.length){for(var N=g.sizeVec3<<1,A=new Array(N),F=A,P=0,Y=g.sizeVec3;P<Y;){var R=P++;F[R]=g.stackVec3[R],g.stackVec3[R]=null}g.stackVec3=F}g.stackVec3[g.sizeVec3++]=_}var C=this.p;if(v!=null){if(v.zero(),C.sizeVec3==C.stackVec3.length){for(var d=C.sizeVec3<<1,Z=new Array(d),$=Z,K=0,E=C.sizeVec3;K<E;){var J=K++;$[J]=C.stackVec3[J],C.stackVec3[J]=null}C.stackVec3=$}C.stackVec3[C.sizeVec3++]=v}var B=this.p;if(l!=null){if(l.zero(),B.sizeVec3==B.stackVec3.length){for(var Q=B.sizeVec3<<1,U=new Array(Q),G=U,D=0,H=B.sizeVec3;D<H;){var j=D++;G[j]=B.stackVec3[j],B.stackVec3[j]=null}B.stackVec3=G}B.stackVec3[B.sizeVec3++]=l}var ia=this.p;if(b!=null){if(b.zero(),ia.sizeVec3==ia.stackVec3.length){for(var sa=ia.sizeVec3<<1,W=new Array(sa),q=W,na=0,oa=ia.sizeVec3;na<oa;){var aa=na++;q[aa]=ia.stackVec3[aa],ia.stackVec3[aa]=null}ia.stackVec3=q}ia.stackVec3[ia.sizeVec3++]=b}var T=this.p;if(n!=null){if(n.zero(),T.sizeVec3==T.stackVec3.length){for(var ca=T.sizeVec3<<1,_a=new Array(ca),w=_a,ta=0,ra=T.sizeVec3;ta<ra;){var la=ta++;w[la]=T.stackVec3[la],T.stackVec3[la]=null}T.stackVec3=w}T.stackVec3[T.sizeVec3++]=n}var va=this.p;if(z!=null){if(z.zero(),va.sizeVec3==va.stackVec3.length){for(var xa=va.sizeVec3<<1,za=new Array(xa),Ma=za,Xa=0,Za=va.sizeVec3;Xa<Za;){var fa=Xa++;Ma[fa]=va.stackVec3[fa],va.stackVec3[fa]=null}va.stackVec3=Ma}va.stackVec3[va.sizeVec3++]=z}var ba=this.p;if(y!=null){if(y.zero(),ba.sizeVec3==ba.stackVec3.length){for(var ea=ba.sizeVec3<<1,ha=new Array(ea),ma=ha,ya=0,da=ba.sizeVec3;ya<da;){var pa=ya++;ma[pa]=ba.stackVec3[pa],ba.stackVec3[pa]=null}ba.stackVec3=ma}ba.stackVec3[ba.sizeVec3++]=y}}basis(a,t,i,r,o){var s=this.p,_=s.sizeVec3==0?new x.common.Vec3:s.stackVec3[--s.sizeVec3],h=this.p,v=h.sizeMat3==0?new x.common.Mat3:h.stackMat3[--h.sizeMat3],e=this.p,l=e.sizeVec3==0?new x.common.Vec3:e.stackVec3[--e.sizeVec3],u=this.p,b=u.sizeVec3==0?new x.common.Vec3:u.stackVec3[--u.sizeVec3],f=this.p,n=f.sizeVec3==0?new x.common.Vec3:f.stackVec3[--f.sizeVec3],c=_;c.x=a._positionX,c.y=a._positionY,c.z=a._positionZ;var z=v;z.e00=a._rotation00,z.e01=a._rotation01,z.e02=a._rotation02,z.e10=a._rotation10,z.e11=a._rotation11,z.e12=a._rotation12,z.e20=a._rotation20,z.e21=a._rotation21,z.e22=a._rotation22,l.init(v.e00,v.e10,v.e20),b.init(v.e01,v.e11,v.e21),n.init(v.e02,v.e12,v.e22);var p=l.x*t,y=l.y*t,V=l.z*t;l.x=p,l.y=y,l.z=V;var M=l,I=M.x+_.x,k=M.y+_.y,X=M.z+_.z;M.x=I,M.y=k,M.z=X;var L=b.x*t,m=b.y*t,g=b.z*t;b.x=L,b.y=m,b.z=g;var N=b,A=N.x+_.x,F=N.y+_.y,P=N.z+_.z;N.x=A,N.y=F,N.z=P;var Y=n.x*t,R=n.y*t,C=n.z*t;n.x=Y,n.y=R,n.z=C;var d=n,Z=d.x+_.x,$=d.y+_.y,K=d.z+_.z;d.x=Z,d.y=$,d.z=K,this.line(_,l,i),this.line(_,b,r),this.line(_,n,o);var E=this.p;if(_!=null){if(_.zero(),E.sizeVec3==E.stackVec3.length){for(var J=E.sizeVec3<<1,B=new Array(J),Q=B,U=0,G=E.sizeVec3;U<G;){var D=U++;Q[D]=E.stackVec3[D],E.stackVec3[D]=null}E.stackVec3=Q}E.stackVec3[E.sizeVec3++]=_}var H=this.p;if(v!=null){var j=1,ia=0,sa=0,W=0,q=1,na=0,oa=0,aa=0,T=1;if(v.e00=j,v.e01=ia,v.e02=sa,v.e10=W,v.e11=q,v.e12=na,v.e20=oa,v.e21=aa,v.e22=T,H.sizeMat3==H.stackMat3.length){for(var ca=H.sizeMat3<<1,_a=new Array(ca),w=_a,ta=0,ra=H.sizeMat3;ta<ra;){var la=ta++;w[la]=H.stackMat3[la],H.stackMat3[la]=null}H.stackMat3=w}H.stackMat3[H.sizeMat3++]=v}var va=this.p;if(l!=null){if(l.zero(),va.sizeVec3==va.stackVec3.length){for(var xa=va.sizeVec3<<1,za=new Array(xa),Ma=za,Xa=0,Za=va.sizeVec3;Xa<Za;){var fa=Xa++;Ma[fa]=va.stackVec3[fa],va.stackVec3[fa]=null}va.stackVec3=Ma}va.stackVec3[va.sizeVec3++]=l}var ba=this.p;if(b!=null){if(b.zero(),ba.sizeVec3==ba.stackVec3.length){for(var ea=ba.sizeVec3<<1,ha=new Array(ea),ma=ha,ya=0,da=ba.sizeVec3;ya<da;){var pa=ya++;ma[pa]=ba.stackVec3[pa],ba.stackVec3[pa]=null}ba.stackVec3=ma}ba.stackVec3[ba.sizeVec3++]=b}var Ya=this.p;if(n!=null){if(n.zero(),Ya.sizeVec3==Ya.stackVec3.length){for(var Qa=Ya.sizeVec3<<1,ga=new Array(Qa),ua=ga,wa=0,ka=Ya.sizeVec3;wa<ka;){var Sa=wa++;ua[Sa]=Ya.stackVec3[Sa],Ya.stackVec3[Sa]=null}Ya.stackVec3=ua}Ya.stackVec3[Ya.sizeVec3++]=n}}ellipse(a,t,i,r,o,s){this.arc(a,t,i,r,o,0,6.28318530717958,!1,s)}arc(a,t,i,r,o,s,_,h,v){var e=this.p,l=e.sizeVec3==0?new x.common.Vec3:e.stackVec3[--e.sizeVec3];l.x=t.x,l.y=t.y,l.z=t.z;var u=l,b=u.x*r,f=u.y*r,n=u.z*r;u.x=b,u.y=f,u.z=n,t=u;var c=this.p,z=c.sizeVec3==0?new x.common.Vec3:c.stackVec3[--c.sizeVec3];z.x=i.x,z.y=i.y,z.z=i.z;var p=z,y=p.x*o,V=p.y*o,M=p.z*o;p.x=y,p.y=V,p.z=M,i=p;var I=.5235987755982984,k=_-s;k<0&&(k=-k);var X=k/I+.5|0;X==0&&(X=1);var L=s,m=(_-s)/X,g=this.p,N=g.sizeVec3==0?new x.common.Vec3:g.stackVec3[--g.sizeVec3];N.x=a.x,N.y=a.y,N.z=a.z;var A=N,F=Math.cos(L),P=A.x+t.x*F,Y=A.y+t.y*F,R=A.z+t.z*F;A.x=P,A.y=Y,A.z=R;var C=A,d=Math.sin(L),Z=C.x+i.x*d,$=C.y+i.y*d,K=C.z+i.z*d;C.x=Z,C.y=$,C.z=K;var E=C,J=E;h&&this.line(a,J,v);for(var B=0,Q=X;B<Q;){B++,L+=m;var U=this.p,G=U.sizeVec3==0?new x.common.Vec3:U.stackVec3[--U.sizeVec3];G.x=a.x,G.y=a.y,G.z=a.z;var D=G,H=Math.cos(L),j=D.x+t.x*H,ia=D.y+t.y*H,sa=D.z+t.z*H;D.x=j,D.y=ia,D.z=sa;var W=D,q=Math.sin(L),na=W.x+i.x*q,oa=W.y+i.y*q,aa=W.z+i.z*q;W.x=na,W.y=oa,W.z=aa;var T=W,ca=T;this.line(J,ca,v);var _a=this.p,w=null,ta=null,ra=null;if(J!=null){if(J.zero(),_a.sizeVec3==_a.stackVec3.length){for(var la=_a.sizeVec3<<1,va=new Array(la),xa=va,za=0,Ma=_a.sizeVec3;za<Ma;){var Xa=za++;xa[Xa]=_a.stackVec3[Xa],_a.stackVec3[Xa]=null}_a.stackVec3=xa}_a.stackVec3[_a.sizeVec3++]=J}if(w!=null){var Za=1,fa=0,ba=0,ea=0,ha=1,ma=0,ya=0,da=0,pa=1;if(w.e00=Za,w.e01=fa,w.e02=ba,w.e10=ea,w.e11=ha,w.e12=ma,w.e20=ya,w.e21=da,w.e22=pa,_a.sizeMat3==_a.stackMat3.length){for(var Ya=_a.sizeMat3<<1,Qa=new Array(Ya),ga=Qa,ua=0,wa=_a.sizeMat3;ua<wa;){var ka=ua++;ga[ka]=_a.stackMat3[ka],_a.stackMat3[ka]=null}_a.stackMat3=ga}_a.stackMat3[_a.sizeMat3++]=w}if(ta!=null){var Sa=1,zt=0,Ha=0,Ba=0,nt=0,Ea=1,Fa=0,Aa=0,ft=0,Wa=0,Ka=1,bt=0,it=0,$a=0,_t=0,gt=1;if(ta.e00=Sa,ta.e01=zt,ta.e02=Ha,ta.e03=Ba,ta.e10=nt,ta.e11=Ea,ta.e12=Fa,ta.e13=Aa,ta.e20=ft,ta.e21=Wa,ta.e22=Ka,ta.e23=bt,ta.e30=it,ta.e31=$a,ta.e32=_t,ta.e33=gt,_a.sizeMat4==_a.stackMat4.length){for(var pt=_a.sizeMat4<<1,Ga=new Array(pt),rt=Ga,ut=0,Da=_a.sizeMat4;ut<Da;){var Ta=ut++;rt[Ta]=_a.stackMat4[Ta],_a.stackMat4[Ta]=null}_a.stackMat4=rt}_a.stackMat4[_a.sizeMat4++]=ta}if(ra!=null){var Na=0,Vt=0,St=0,et=1;if(ra.x=Na,ra.y=Vt,ra.z=St,ra.w=et,_a.sizeQuat==_a.stackQuat.length){for(var Xt=_a.sizeQuat<<1,Yt=new Array(Xt),Mt=Yt,Ia=0,O=_a.sizeQuat;Ia<O;){var Va=Ia++;Mt[Va]=_a.stackQuat[Va],_a.stackQuat[Va]=null}_a.stackQuat=Mt}_a.stackQuat[_a.sizeQuat++]=ra}J=ca}h&&this.line(a,J,v);var lt=this.p;if(J!=null){if(J.zero(),lt.sizeVec3==lt.stackVec3.length){for(var S=lt.sizeVec3<<1,wt=new Array(S),Bt=wt,At=0,yt=lt.sizeVec3;At<yt;){var kt=At++;Bt[kt]=lt.stackVec3[kt],lt.stackVec3[kt]=null}lt.stackVec3=Bt}lt.stackVec3[lt.sizeVec3++]=J}var mt=this.p;if(t!=null){if(t.zero(),mt.sizeVec3==mt.stackVec3.length){for(var ht=mt.sizeVec3<<1,xt=new Array(ht),Ra=xt,st=0,Ca=mt.sizeVec3;st<Ca;){var vt=st++;Ra[vt]=mt.stackVec3[vt],mt.stackVec3[vt]=null}mt.stackVec3=Ra}mt.stackVec3[mt.sizeVec3++]=t}var qa=this.p;if(i!=null){if(i.zero(),qa.sizeVec3==qa.stackVec3.length){for(var at=qa.sizeVec3<<1,Oa=new Array(at),tt=Oa,ct=0,Pa=qa.sizeVec3;ct<Pa;){var Ja=ct++;tt[Ja]=qa.stackVec3[Ja],qa.stackVec3[Ja]=null}qa.stackVec3=tt}qa.stackVec3[qa.sizeVec3++]=i}}cone(a,t,i,r){var o=this.p,s=o.sizeVec3==0?new x.common.Vec3:o.stackVec3[--o.sizeVec3],_=this.p,h=_.sizeVec3==0?new x.common.Vec3:_.stackVec3[--_.sizeVec3],v=this.p,e=v.sizeVec3==0?new x.common.Vec3:v.stackVec3[--v.sizeVec3],l=this.p,u=l.sizeVec3==0?new x.common.Vec3:l.stackVec3[--l.sizeVec3],b=this.p,f=b.sizeMat3==0?new x.common.Mat3:b.stackMat3[--b.sizeMat3],n=u;n.x=a._positionX,n.y=a._positionY,n.z=a._positionZ;var c=f;c.e00=a._rotation00,c.e01=a._rotation01,c.e02=a._rotation02,c.e10=a._rotation10,c.e11=a._rotation11,c.e12=a._rotation12,c.e20=a._rotation20,c.e21=a._rotation21,c.e22=a._rotation22,s.init(f.e00,f.e10,f.e20),h.init(f.e01,f.e11,f.e21),e.init(f.e02,f.e12,f.e22);var z=this.p,p=z.sizeVec3==0?new x.common.Vec3:z.stackVec3[--z.sizeVec3];p.x=u.x,p.y=u.y,p.z=u.z;var y=p,V=y.x+h.x*i,M=y.y+h.y*i,I=y.z+h.z*i;y.x=V,y.y=M,y.z=I;var k=y,X=this.p,L=X.sizeVec3==0?new x.common.Vec3:X.stackVec3[--X.sizeVec3];L.x=u.x,L.y=u.y,L.z=u.z;var m=L,g=-i,N=m.x+h.x*g,A=m.y+h.y*g,F=m.z+h.z*g;m.x=N,m.y=A,m.z=F;var P=m;if(this.wireframe){var Y=this.p,R=Y.sizeVec3==0?new x.common.Vec3:Y.stackVec3[--Y.sizeVec3];R.x=P.x,R.y=P.y,R.z=P.z;var C=R,d=-t,Z=C.x+s.x*d,$=C.y+s.y*d,K=C.z+s.z*d;C.x=Z,C.y=$,C.z=K;var E=C,J=E.x+e.x*0,B=E.y+e.y*0,Q=E.z+e.z*0;E.x=J,E.y=B,E.z=Q;var U=E,G=this.p,D=G.sizeVec3==0?new x.common.Vec3:G.stackVec3[--G.sizeVec3];D.x=P.x,D.y=P.y,D.z=P.z;var H=D,j=H.x+s.x*t,ia=H.y+s.y*t,sa=H.z+s.z*t;H.x=j,H.y=ia,H.z=sa;var W=H,q=W.x+e.x*0,na=W.y+e.y*0,oa=W.z+e.z*0;W.x=q,W.y=na,W.z=oa;var aa=W,T=this.p,ca=T.sizeVec3==0?new x.common.Vec3:T.stackVec3[--T.sizeVec3];ca.x=P.x,ca.y=P.y,ca.z=P.z;var _a=ca,w=_a.x+s.x*0,ta=_a.y+s.y*0,ra=_a.z+s.z*0;_a.x=w,_a.y=ta,_a.z=ra;var la=_a,va=-t,xa=la.x+e.x*va,za=la.y+e.y*va,Ma=la.z+e.z*va;la.x=xa,la.y=za,la.z=Ma;var Xa=la,Za=this.p,fa=Za.sizeVec3==0?new x.common.Vec3:Za.stackVec3[--Za.sizeVec3];fa.x=P.x,fa.y=P.y,fa.z=P.z;var ba=fa,ea=ba.x+s.x*0,ha=ba.y+s.y*0,ma=ba.z+s.z*0;ba.x=ea,ba.y=ha,ba.z=ma;var ya=ba,da=ya.x+e.x*t,pa=ya.y+e.y*t,Ya=ya.z+e.z*t;ya.x=da,ya.y=pa,ya.z=Ya;var Qa=ya;this.ellipse(P,s,e,t,t,r),this.line(k,U,r),this.line(k,aa,r),this.line(k,Xa,r),this.line(k,Qa,r);var ga=this.p,ua=null,wa=null,ka=null;if(U!=null){if(U.zero(),ga.sizeVec3==ga.stackVec3.length){for(var Sa=ga.sizeVec3<<1,zt=new Array(Sa),Ha=zt,Ba=0,nt=ga.sizeVec3;Ba<nt;){var Ea=Ba++;Ha[Ea]=ga.stackVec3[Ea],ga.stackVec3[Ea]=null}ga.stackVec3=Ha}ga.stackVec3[ga.sizeVec3++]=U}if(ua!=null){var Fa=1,Aa=0,ft=0,Wa=0,Ka=1,bt=0,it=0,$a=0,_t=1;if(ua.e00=Fa,ua.e01=Aa,ua.e02=ft,ua.e10=Wa,ua.e11=Ka,ua.e12=bt,ua.e20=it,ua.e21=$a,ua.e22=_t,ga.sizeMat3==ga.stackMat3.length){for(var gt=ga.sizeMat3<<1,pt=new Array(gt),Ga=pt,rt=0,ut=ga.sizeMat3;rt<ut;){var Da=rt++;Ga[Da]=ga.stackMat3[Da],ga.stackMat3[Da]=null}ga.stackMat3=Ga}ga.stackMat3[ga.sizeMat3++]=ua}if(wa!=null){var Ta=1,Na=0,Vt=0,St=0,et=0,Xt=1,Yt=0,Mt=0,Ia=0,O=0,Va=1,lt=0,S=0,wt=0,Bt=0,At=1;if(wa.e00=Ta,wa.e01=Na,wa.e02=Vt,wa.e03=St,wa.e10=et,wa.e11=Xt,wa.e12=Yt,wa.e13=Mt,wa.e20=Ia,wa.e21=O,wa.e22=Va,wa.e23=lt,wa.e30=S,wa.e31=wt,wa.e32=Bt,wa.e33=At,ga.sizeMat4==ga.stackMat4.length){for(var yt=ga.sizeMat4<<1,kt=new Array(yt),mt=kt,ht=0,xt=ga.sizeMat4;ht<xt;){var Ra=ht++;mt[Ra]=ga.stackMat4[Ra],ga.stackMat4[Ra]=null}ga.stackMat4=mt}ga.stackMat4[ga.sizeMat4++]=wa}if(ka!=null){var st=0,Ca=0,vt=0,qa=1;if(ka.x=st,ka.y=Ca,ka.z=vt,ka.w=qa,ga.sizeQuat==ga.stackQuat.length){for(var at=ga.sizeQuat<<1,Oa=new Array(at),tt=Oa,ct=0,Pa=ga.sizeQuat;ct<Pa;){var Ja=ct++;tt[Ja]=ga.stackQuat[Ja],ga.stackQuat[Ja]=null}ga.stackQuat=tt}ga.stackQuat[ga.sizeQuat++]=ka}var ja=this.p,La=null,ot=null,It=null;if(aa!=null){if(aa.zero(),ja.sizeVec3==ja.stackVec3.length){for(var oi=ja.sizeVec3<<1,gi=new Array(oi),ai=gi,Ct=0,_i=ja.sizeVec3;Ct<_i;){var Et=Ct++;ai[Et]=ja.stackVec3[Et],ja.stackVec3[Et]=null}ja.stackVec3=ai}ja.stackVec3[ja.sizeVec3++]=aa}if(La!=null){var Pt=1,Jt=0,Ki=0,vi=0,li=1,ti=0,Oi=0,Xi=0,zi=1;if(La.e00=Pt,La.e01=Jt,La.e02=Ki,La.e10=vi,La.e11=li,La.e12=ti,La.e20=Oi,La.e21=Xi,La.e22=zi,ja.sizeMat3==ja.stackMat3.length){for(var Zt=ja.sizeMat3<<1,ri=new Array(Zt),Wt=ri,ni=0,$i=ja.sizeMat3;ni<$i;){var Ut=ni++;Wt[Ut]=ja.stackMat3[Ut],ja.stackMat3[Ut]=null}ja.stackMat3=Wt}ja.stackMat3[ja.sizeMat3++]=La}if(ot!=null){var ji=1,Ii=0,pr=0,Wi=0,Lt=0,jt=1,Tt=0,bi=0,Mi=0,vr=0,qt=1,fi=0,dt=0,ui=0,hi=0,er=1;if(ot.e00=ji,ot.e01=Ii,ot.e02=pr,ot.e03=Wi,ot.e10=Lt,ot.e11=jt,ot.e12=Tt,ot.e13=bi,ot.e20=Mi,ot.e21=vr,ot.e22=qt,ot.e23=fi,ot.e30=dt,ot.e31=ui,ot.e32=hi,ot.e33=er,ja.sizeMat4==ja.stackMat4.length){for(var Xr=ja.sizeMat4<<1,ro=new Array(Xr),Gt=ro,fr=0,mr=ja.sizeMat4;fr<mr;){var Dt=fr++;Gt[Dt]=ja.stackMat4[Dt],ja.stackMat4[Dt]=null}ja.stackMat4=Gt}ja.stackMat4[ja.sizeMat4++]=ot}if(It!=null){var dr=0,Pi=0,Dr=0,Hn=1;if(It.x=dr,It.y=Pi,It.z=Dr,It.w=Hn,ja.sizeQuat==ja.stackQuat.length){for(var oo=ja.sizeQuat<<1,Br=new Array(oo),no=Br,yn=0,Ao=ja.sizeQuat;yn<Ao;){var Io=yn++;no[Io]=ja.stackQuat[Io],ja.stackQuat[Io]=null}ja.stackQuat=no}ja.stackQuat[ja.sizeQuat++]=It}var xi=this.p,qr=null,Ar=null,yr=null;if(Xa!=null){if(Xa.zero(),xi.sizeVec3==xi.stackVec3.length){for(var Po=xi.sizeVec3<<1,Di=new Array(Po),Pr=Di,gr=0,Rt=xi.sizeVec3;gr<Rt;){var Hi=gr++;Pr[Hi]=xi.stackVec3[Hi],xi.stackVec3[Hi]=null}xi.stackVec3=Pr}xi.stackVec3[xi.sizeVec3++]=Xa}if(qr!=null){var Li=1,Cn=0,Ms=0,je=0,ps=1,Te=0,qe=0,D_=0,gn=1;if(qr.e00=Li,qr.e01=Cn,qr.e02=Ms,qr.e10=je,qr.e11=ps,qr.e12=Te,qr.e20=qe,qr.e21=D_,qr.e22=gn,xi.sizeMat3==xi.stackMat3.length){for(var Si=xi.sizeMat3<<1,No=new Array(Si),Wr=No,ke=0,on=xi.sizeMat3;ke<on;){var Tn=ke++;Wr[Tn]=xi.stackMat3[Tn],xi.stackMat3[Tn]=null}xi.stackMat3=Wr}xi.stackMat3[xi.sizeMat3++]=qr}if(Ar!=null){var Kn=1,we=0,k_=0,Re=0,Vi=0,Ir=1,ur=0,eo=0,Rn=0,ms=0,nn=1,Qn=0,ci=0,ho=0,Fr=0,En=1;if(Ar.e00=Kn,Ar.e01=we,Ar.e02=k_,Ar.e03=Re,Ar.e10=Vi,Ar.e11=Ir,Ar.e12=ur,Ar.e13=eo,Ar.e20=Rn,Ar.e21=ms,Ar.e22=nn,Ar.e23=Qn,Ar.e30=ci,Ar.e31=ho,Ar.e32=Fr,Ar.e33=En,xi.sizeMat4==xi.stackMat4.length){for(var as=xi.sizeMat4<<1,Qe=new Array(as),Ee=Qe,De=0,he=xi.sizeMat4;De<he;){var ii=De++;Ee[ii]=xi.stackMat4[ii],xi.stackMat4[ii]=null}xi.stackMat4=Ee}xi.stackMat4[xi.sizeMat4++]=Ar}if(yr!=null){var ir=0,Qi=0,Fi=0,fo=1;if(yr.x=ir,yr.y=Qi,yr.z=Fi,yr.w=fo,xi.sizeQuat==xi.stackQuat.length){for(var So=xi.sizeQuat<<1,s_=new Array(So),Fe=s_,ts=0,Dn=xi.sizeQuat;ts<Dn;){var co=ts++;Fe[co]=xi.stackQuat[co],xi.stackQuat[co]=null}xi.stackQuat=Fe}xi.stackQuat[xi.sizeQuat++]=yr}var Ft=this.p,Ni=null,lr=null,Vo=null;if(Qa!=null){if(Qa.zero(),Ft.sizeVec3==Ft.stackVec3.length){for(var ce=Ft.sizeVec3<<1,Xe=new Array(ce),Le=Xe,uo=0,$t=Ft.sizeVec3;uo<$t;){var Vr=uo++;Le[Vr]=Ft.stackVec3[Vr],Ft.stackVec3[Vr]=null}Ft.stackVec3=Le}Ft.stackVec3[Ft.sizeVec3++]=Qa}if(Ni!=null){var sr=1,Jo=0,Ns=0,Co=0,ko=1,Nr=0,Sr=0,Cr=0,Lr=1;if(Ni.e00=sr,Ni.e01=Jo,Ni.e02=Ns,Ni.e10=Co,Ni.e11=ko,Ni.e12=Nr,Ni.e20=Sr,Ni.e21=Cr,Ni.e22=Lr,Ft.sizeMat3==Ft.stackMat3.length){for(var Qt=Ft.sizeMat3<<1,Ji=new Array(Qt),Yi=Ji,Ri=0,zr=Ft.sizeMat3;Ri<zr;){var qi=Ri++;Yi[qi]=Ft.stackMat3[qi],Ft.stackMat3[qi]=null}Ft.stackMat3=Yi}Ft.stackMat3[Ft.sizeMat3++]=Ni}if(lr!=null){var Jr=1,Gr=0,ao=0,be=0,ki=0,en=1,Yr=0,Go=0,ys=0,In=0,gs=1,Vn=0,Ci=0,To=0,so=0,Fn=1;if(lr.e00=Jr,lr.e01=Gr,lr.e02=ao,lr.e03=be,lr.e10=ki,lr.e11=en,lr.e12=Yr,lr.e13=Go,lr.e20=ys,lr.e21=In,lr.e22=gs,lr.e23=Vn,lr.e30=Ci,lr.e31=To,lr.e32=so,lr.e33=Fn,Ft.sizeMat4==Ft.stackMat4.length){for(var Ne=Ft.sizeMat4<<1,Nn=new Array(Ne),Wo=Nn,kn=0,Ye=Ft.sizeMat4;kn<Ye;){var Ot=kn++;Wo[Ot]=Ft.stackMat4[Ot],Ft.stackMat4[Ot]=null}Ft.stackMat4=Wo}Ft.stackMat4[Ft.sizeMat4++]=lr}if(Vo!=null){var Ro=0,Ur=0,wn=0,Jn=1;if(Vo.x=Ro,Vo.y=Ur,Vo.z=wn,Vo.w=Jn,Ft.sizeQuat==Ft.stackQuat.length){for(var fe=Ft.sizeQuat<<1,Is=new Array(fe),Uo=Is,Vs=0,w_=Ft.sizeQuat;Vs<w_;){var Js=Vs++;Uo[Js]=Ft.stackQuat[Js],Ft.stackQuat[Js]=null}Ft.stackQuat=Uo}Ft.stackQuat[Ft.sizeQuat++]=Vo}}else{for(var X_=1/Math.sqrt(t*t+4*i*i),Je=2*i*X_,F_=t*X_,N_=0;N_<8;){var Or=N_++,wo=this.tmpCircleNorms[Or],Xo=this.circleCoords[Or];wo.x=Xo.x,wo.y=Xo.y,wo.z=Xo.z;var Gn=wo,wi=Gn.x*Je,Wn=Gn.y*Je,Qo=Gn.z*Je;Gn.x=wi,Gn.y=Wn,Gn.z=Qo,Gn.y+=F_;var to=this.tmpCircleNorms[Or],J_=to.x*f.e00+to.y*f.e01+to.z*f.e02,G_=to.x*f.e10+to.y*f.e11+to.z*f.e12,L_=to.x*f.e20+to.y*f.e21+to.z*f.e22;to.x=J_,to.y=G_,to.z=L_;var is=this.tmpCircleVerts1[Or],__=this.circleCoordsShift[Or];is.x=__.x,is.y=__.y,is.z=__.z;var v_=is,rs=v_.x*Je,pi=v_.y*Je,Oo=v_.z*Je;v_.x=rs,v_.y=pi,v_.z=Oo,v_.y+=F_;var ar=this.tmpCircleVerts1[Or],Ze=ar.x*f.e00+ar.y*f.e01+ar.z*f.e02,Gs=ar.x*f.e10+ar.y*f.e11+ar.z*f.e12,hv=ar.x*f.e20+ar.y*f.e21+ar.z*f.e22;ar.x=Ze,ar.y=Gs,ar.z=hv;var ue=this.tmpCircleVerts2[Or],Ge=this.circleCoords[Or];ue.x=Ge.x,ue.y=Ge.y,ue.z=Ge.z;var $n=ue,Ws=$n.x*f.e00+$n.y*f.e01+$n.z*f.e02,Ti=$n.x*f.e10+$n.y*f.e11+$n.z*f.e12,Lo=$n.x*f.e20+$n.y*f.e21+$n.z*f.e22;$n.x=Ws,$n.y=Ti,$n.z=Lo;var Tr=$n,sn=Tr.x*t,ks=Tr.y*t,Y_=Tr.z*t;Tr.x=sn,Tr.y=ks,Tr.z=Y_;var We=Tr,jn=We.x+u.x,Xn=We.y+u.y,os=We.z+u.z;We.x=jn,We.y=Xn,We.z=os;var de=this.tmpCircleVerts2[Or],ns=-i,Us=de.x+h.x*ns,l_=de.y+h.y*ns,Be=de.z+h.z*ns;de.x=Us,de.y=l_,de.z=Be}for(var Ae=0;Ae<8;){var qn=Ae++,mi=k,xo=this.tmpCircleVerts2[qn],Zr=this.tmpCircleVerts2[(qn+1)%8],Ho=this.tmpCircleVerts1[qn],Yo=this.tmpCircleNorms[qn],Hr=this.tmpCircleNorms[(qn+1)%8];this.triangle(mi,xo,Zr,Ho,Yo,Hr,r),mi=P,xo=this.tmpCircleVerts2[(qn+1)%8],Zr=this.tmpCircleVerts2[qn];var Eo=this.p,ws=Eo.sizeVec3==0?new x.common.Vec3:Eo.stackVec3[--Eo.sizeVec3];ws.x=h.x,ws.y=h.y,ws.z=h.z;var ae=ws,Os=-ae.x,W_=-ae.y,te=-ae.z;ae.x=Os,ae.y=W_,ae.z=te,Ho=ae,this.triangle(mi,xo,Zr,Ho,Ho,Ho,r);var Nt=this.p,Kr=null,Do=null,Xs=null;if(Ho!=null){if(Ho.zero(),Nt.sizeVec3==Nt.stackVec3.length){for(var kv=Nt.sizeVec3<<1,i0=new Array(kv),U_=i0,Ht=0,Ln=Nt.sizeVec3;Ht<Ln;){var Rr=Ht++;U_[Rr]=Nt.stackVec3[Rr],Nt.stackVec3[Rr]=null}Nt.stackVec3=U_}Nt.stackVec3[Nt.sizeVec3++]=Ho}if(Kr!=null){var Yn=1,Z_=0,Hs=0,h_=0,bo=1,es=0,ss=0,xe=0,Zi=1;if(Kr.e00=Yn,Kr.e01=Z_,Kr.e02=Hs,Kr.e10=h_,Kr.e11=bo,Kr.e12=es,Kr.e20=ss,Kr.e21=xe,Kr.e22=Zi,Nt.sizeMat3==Nt.stackMat3.length){for(var Ko=Nt.sizeMat3<<1,kr=new Array(Ko),Zo=kr,Ue=0,cv=Nt.sizeMat3;Ue<cv;){var ze=Ue++;Zo[ze]=Nt.stackMat3[ze],Nt.stackMat3[ze]=null}Nt.stackMat3=Zo}Nt.stackMat3[Nt.sizeMat3++]=Kr}if(Do!=null){var Ks=1,wv=0,Oe=0,ei=0,Zn=0,_n=1,vn=0,d_=0,bv=0,ie=0,Pe=1,c_=0,O_=0,fv=0,uv=0,b_=1;if(Do.e00=Ks,Do.e01=wv,Do.e02=Oe,Do.e03=ei,Do.e10=Zn,Do.e11=_n,Do.e12=vn,Do.e13=d_,Do.e20=bv,Do.e21=ie,Do.e22=Pe,Do.e23=c_,Do.e30=O_,Do.e31=fv,Do.e32=uv,Do.e33=b_,Nt.sizeMat4==Nt.stackMat4.length){for(var He=Nt.sizeMat4<<1,zo=new Array(He),_s=zo,vs=0,Ui=Nt.sizeMat4;vs<Ui;){var Mo=vs++;_s[Mo]=Nt.stackMat4[Mo],Nt.stackMat4[Mo]=null}Nt.stackMat4=_s}Nt.stackMat4[Nt.sizeMat4++]=Do}if(Xs!=null){var _o=0,ls=0,Ls=0,Ys=1;if(Xs.x=_o,Xs.y=ls,Xs.z=Ls,Xs.w=Ys,Nt.sizeQuat==Nt.stackQuat.length){for(var Zs=Nt.sizeQuat<<1,B_=new Array(Zs),Me=B_,hs=0,H_=Nt.sizeQuat;hs<H_;){var $s=hs++;Me[$s]=Nt.stackQuat[$s],Nt.stackQuat[$s]=null}Nt.stackQuat=Me}Nt.stackQuat[Nt.sizeQuat++]=Xs}}}var Un=this.p;if(k!=null){if(k.zero(),Un.sizeVec3==Un.stackVec3.length){for(var pe=Un.sizeVec3<<1,Xv=new Array(pe),A_=Xv,$o=0,ln=Un.sizeVec3;$o<ln;){var po=$o++;A_[po]=Un.stackVec3[po],Un.stackVec3[po]=null}Un.stackVec3=A_}Un.stackVec3[Un.sizeVec3++]=k}var Kt=this.p;if(P!=null){if(P.zero(),Kt.sizeVec3==Kt.stackVec3.length){for(var $r=Kt.sizeVec3<<1,vo=new Array($r),js=vo,ds=0,qs=Kt.sizeVec3;ds<qs;){var P_=ds++;js[P_]=Kt.stackVec3[P_],Kt.stackVec3[P_]=null}Kt.stackVec3=js}Kt.stackVec3[Kt.sizeVec3++]=P}var jo=this.p;if(u!=null){if(u.zero(),jo.sizeVec3==jo.stackVec3.length){for(var re=jo.sizeVec3<<1,K_=new Array(re),xv=K_,di=0,mo=jo.sizeVec3;di<mo;){var Qr=di++;xv[Qr]=jo.stackVec3[Qr],jo.stackVec3[Qr]=null}jo.stackVec3=xv}jo.stackVec3[jo.sizeVec3++]=u}var io=this.p;if(f!=null){var $_=1,j_=0,Lv=0,a_=0,Yv=1,q_=0,Bi=0,av=0,Bs=1;if(f.e00=$_,f.e01=j_,f.e02=Lv,f.e10=a_,f.e11=Yv,f.e12=q_,f.e20=Bi,f.e21=av,f.e22=Bs,io.sizeMat3==io.stackMat3.length){for(var As=io.sizeMat3<<1,cs=new Array(As),bs=cs,Ps=0,Zv=io.sizeMat3;Ps<Zv;){var me=Ps++;bs[me]=io.stackMat3[me],io.stackMat3[me]=null}io.stackMat3=bs}io.stackMat3[io.sizeMat3++]=f}var jr=this.p;if(s!=null){if(s.zero(),jr.sizeVec3==jr.stackVec3.length){for(var t_=jr.sizeVec3<<1,yo=new Array(t_),i_=yo,Fo=0,Ss=jr.sizeVec3;Fo<Ss;){var qo=Fo++;i_[qo]=jr.stackVec3[qo],jr.stackVec3[qo]=null}jr.stackVec3=i_}jr.stackVec3[jr.sizeVec3++]=s}var ye=this.p;if(h!=null){if(h.zero(),ye.sizeVec3==ye.stackVec3.length){for(var si=ye.sizeVec3<<1,an=new Array(si),_r=an,oe=0,ge=ye.sizeVec3;oe<ge;){var Bo=oe++;_r[Bo]=ye.stackVec3[Bo],ye.stackVec3[Bo]=null}ye.stackVec3=_r}ye.stackVec3[ye.sizeVec3++]=h}var Er=this.p;if(e!=null){if(e.zero(),Er.sizeVec3==Er.stackVec3.length){for(var dn=Er.sizeVec3<<1,tv=new Array(dn),r_=tv,S_=0,iv=Er.sizeVec3;S_<iv;){var ne=S_++;r_[ne]=Er.stackVec3[ne],Er.stackVec3[ne]=null}Er.stackVec3=r_}Er.stackVec3[Er.sizeVec3++]=e}}cylinder(a,t,i,r){var o=this.p,s=o.sizeVec3==0?new x.common.Vec3:o.stackVec3[--o.sizeVec3],_=this.p,h=_.sizeVec3==0?new x.common.Vec3:_.stackVec3[--_.sizeVec3],v=this.p,e=v.sizeVec3==0?new x.common.Vec3:v.stackVec3[--v.sizeVec3],l=this.p,u=l.sizeVec3==0?new x.common.Vec3:l.stackVec3[--l.sizeVec3],b=this.p,f=b.sizeMat3==0?new x.common.Mat3:b.stackMat3[--b.sizeMat3],n=u;n.x=a._positionX,n.y=a._positionY,n.z=a._positionZ;var c=f;c.e00=a._rotation00,c.e01=a._rotation01,c.e02=a._rotation02,c.e10=a._rotation10,c.e11=a._rotation11,c.e12=a._rotation12,c.e20=a._rotation20,c.e21=a._rotation21,c.e22=a._rotation22,s.init(f.e00,f.e10,f.e20),h.init(f.e01,f.e11,f.e21),e.init(f.e02,f.e12,f.e22);var z=this.p,p=z.sizeVec3==0?new x.common.Vec3:z.stackVec3[--z.sizeVec3];p.x=u.x,p.y=u.y,p.z=u.z;var y=p,V=y.x+h.x*i,M=y.y+h.y*i,I=y.z+h.z*i;y.x=V,y.y=M,y.z=I;var k=y,X=this.p,L=X.sizeVec3==0?new x.common.Vec3:X.stackVec3[--X.sizeVec3];L.x=u.x,L.y=u.y,L.z=u.z;var m=L,g=-i,N=m.x+h.x*g,A=m.y+h.y*g,F=m.z+h.z*g;m.x=N,m.y=A,m.z=F;var P=m;if(this.wireframe){var Y=this.p,R=Y.sizeVec3==0?new x.common.Vec3:Y.stackVec3[--Y.sizeVec3];R.x=k.x,R.y=k.y,R.z=k.z;var C=R,d=-t,Z=C.x+s.x*d,$=C.y+s.y*d,K=C.z+s.z*d;C.x=Z,C.y=$,C.z=K;var E=C,J=E.x+e.x*0,B=E.y+e.y*0,Q=E.z+e.z*0;E.x=J,E.y=B,E.z=Q;var U=E,G=this.p,D=G.sizeVec3==0?new x.common.Vec3:G.stackVec3[--G.sizeVec3];D.x=k.x,D.y=k.y,D.z=k.z;var H=D,j=H.x+s.x*t,ia=H.y+s.y*t,sa=H.z+s.z*t;H.x=j,H.y=ia,H.z=sa;var W=H,q=W.x+e.x*0,na=W.y+e.y*0,oa=W.z+e.z*0;W.x=q,W.y=na,W.z=oa;var aa=W,T=this.p,ca=T.sizeVec3==0?new x.common.Vec3:T.stackVec3[--T.sizeVec3];ca.x=k.x,ca.y=k.y,ca.z=k.z;var _a=ca,w=_a.x+s.x*0,ta=_a.y+s.y*0,ra=_a.z+s.z*0;_a.x=w,_a.y=ta,_a.z=ra;var la=_a,va=-t,xa=la.x+e.x*va,za=la.y+e.y*va,Ma=la.z+e.z*va;la.x=xa,la.y=za,la.z=Ma;var Xa=la,Za=this.p,fa=Za.sizeVec3==0?new x.common.Vec3:Za.stackVec3[--Za.sizeVec3];fa.x=k.x,fa.y=k.y,fa.z=k.z;var ba=fa,ea=ba.x+s.x*0,ha=ba.y+s.y*0,ma=ba.z+s.z*0;ba.x=ea,ba.y=ha,ba.z=ma;var ya=ba,da=ya.x+e.x*t,pa=ya.y+e.y*t,Ya=ya.z+e.z*t;ya.x=da,ya.y=pa,ya.z=Ya;var Qa=ya,ga=this.p,ua=ga.sizeVec3==0?new x.common.Vec3:ga.stackVec3[--ga.sizeVec3];ua.x=P.x,ua.y=P.y,ua.z=P.z;var wa=ua,ka=-t,Sa=wa.x+s.x*ka,zt=wa.y+s.y*ka,Ha=wa.z+s.z*ka;wa.x=Sa,wa.y=zt,wa.z=Ha;var Ba=wa,nt=Ba.x+e.x*0,Ea=Ba.y+e.y*0,Fa=Ba.z+e.z*0;Ba.x=nt,Ba.y=Ea,Ba.z=Fa;var Aa=Ba,ft=this.p,Wa=ft.sizeVec3==0?new x.common.Vec3:ft.stackVec3[--ft.sizeVec3];Wa.x=P.x,Wa.y=P.y,Wa.z=P.z;var Ka=Wa,bt=Ka.x+s.x*t,it=Ka.y+s.y*t,$a=Ka.z+s.z*t;Ka.x=bt,Ka.y=it,Ka.z=$a;var _t=Ka,gt=_t.x+e.x*0,pt=_t.y+e.y*0,Ga=_t.z+e.z*0;_t.x=gt,_t.y=pt,_t.z=Ga;var rt=_t,ut=this.p,Da=ut.sizeVec3==0?new x.common.Vec3:ut.stackVec3[--ut.sizeVec3];Da.x=P.x,Da.y=P.y,Da.z=P.z;var Ta=Da,Na=Ta.x+s.x*0,Vt=Ta.y+s.y*0,St=Ta.z+s.z*0;Ta.x=Na,Ta.y=Vt,Ta.z=St;var et=Ta,Xt=-t,Yt=et.x+e.x*Xt,Mt=et.y+e.y*Xt,Ia=et.z+e.z*Xt;et.x=Yt,et.y=Mt,et.z=Ia;var O=et,Va=this.p,lt=Va.sizeVec3==0?new x.common.Vec3:Va.stackVec3[--Va.sizeVec3];lt.x=P.x,lt.y=P.y,lt.z=P.z;var S=lt,wt=S.x+s.x*0,Bt=S.y+s.y*0,At=S.z+s.z*0;S.x=wt,S.y=Bt,S.z=At;var yt=S,kt=yt.x+e.x*t,mt=yt.y+e.y*t,ht=yt.z+e.z*t;yt.x=kt,yt.y=mt,yt.z=ht;var xt=yt;this.ellipse(k,s,e,t,t,r),this.ellipse(P,s,e,t,t,r),this.line(U,Aa,r),this.line(aa,rt,r),this.line(Xa,O,r),this.line(Qa,xt,r);var Ra=this.p,st=null,Ca=null,vt=null;if(U!=null){if(U.zero(),Ra.sizeVec3==Ra.stackVec3.length){for(var qa=Ra.sizeVec3<<1,at=new Array(qa),Oa=at,tt=0,ct=Ra.sizeVec3;tt<ct;){var Pa=tt++;Oa[Pa]=Ra.stackVec3[Pa],Ra.stackVec3[Pa]=null}Ra.stackVec3=Oa}Ra.stackVec3[Ra.sizeVec3++]=U}if(st!=null){var Ja=1,ja=0,La=0,ot=0,It=1,oi=0,gi=0,ai=0,Ct=1;if(st.e00=Ja,st.e01=ja,st.e02=La,st.e10=ot,st.e11=It,st.e12=oi,st.e20=gi,st.e21=ai,st.e22=Ct,Ra.sizeMat3==Ra.stackMat3.length){for(var _i=Ra.sizeMat3<<1,Et=new Array(_i),Pt=Et,Jt=0,Ki=Ra.sizeMat3;Jt<Ki;){var vi=Jt++;Pt[vi]=Ra.stackMat3[vi],Ra.stackMat3[vi]=null}Ra.stackMat3=Pt}Ra.stackMat3[Ra.sizeMat3++]=st}if(Ca!=null){var li=1,ti=0,Oi=0,Xi=0,zi=0,Zt=1,ri=0,Wt=0,ni=0,$i=0,Ut=1,ji=0,Ii=0,pr=0,Wi=0,Lt=1;if(Ca.e00=li,Ca.e01=ti,Ca.e02=Oi,Ca.e03=Xi,Ca.e10=zi,Ca.e11=Zt,Ca.e12=ri,Ca.e13=Wt,Ca.e20=ni,Ca.e21=$i,Ca.e22=Ut,Ca.e23=ji,Ca.e30=Ii,Ca.e31=pr,Ca.e32=Wi,Ca.e33=Lt,Ra.sizeMat4==Ra.stackMat4.length){for(var jt=Ra.sizeMat4<<1,Tt=new Array(jt),bi=Tt,Mi=0,vr=Ra.sizeMat4;Mi<vr;){var qt=Mi++;bi[qt]=Ra.stackMat4[qt],Ra.stackMat4[qt]=null}Ra.stackMat4=bi}Ra.stackMat4[Ra.sizeMat4++]=Ca}if(vt!=null){var fi=0,dt=0,ui=0,hi=1;if(vt.x=fi,vt.y=dt,vt.z=ui,vt.w=hi,Ra.sizeQuat==Ra.stackQuat.length){for(var er=Ra.sizeQuat<<1,Xr=new Array(er),ro=Xr,Gt=0,fr=Ra.sizeQuat;Gt<fr;){var mr=Gt++;ro[mr]=Ra.stackQuat[mr],Ra.stackQuat[mr]=null}Ra.stackQuat=ro}Ra.stackQuat[Ra.sizeQuat++]=vt}var Dt=this.p,dr=null,Pi=null,Dr=null;if(aa!=null){if(aa.zero(),Dt.sizeVec3==Dt.stackVec3.length){for(var Hn=Dt.sizeVec3<<1,oo=new Array(Hn),Br=oo,no=0,yn=Dt.sizeVec3;no<yn;){var Ao=no++;Br[Ao]=Dt.stackVec3[Ao],Dt.stackVec3[Ao]=null}Dt.stackVec3=Br}Dt.stackVec3[Dt.sizeVec3++]=aa}if(dr!=null){var Io=1,xi=0,qr=0,Ar=0,yr=1,Po=0,Di=0,Pr=0,gr=1;if(dr.e00=Io,dr.e01=xi,dr.e02=qr,dr.e10=Ar,dr.e11=yr,dr.e12=Po,dr.e20=Di,dr.e21=Pr,dr.e22=gr,Dt.sizeMat3==Dt.stackMat3.length){for(var Rt=Dt.sizeMat3<<1,Hi=new Array(Rt),Li=Hi,Cn=0,Ms=Dt.sizeMat3;Cn<Ms;){var je=Cn++;Li[je]=Dt.stackMat3[je],Dt.stackMat3[je]=null}Dt.stackMat3=Li}Dt.stackMat3[Dt.sizeMat3++]=dr}if(Pi!=null){var ps=1,Te=0,qe=0,D_=0,gn=0,Si=1,No=0,Wr=0,ke=0,on=0,Tn=1,Kn=0,we=0,k_=0,Re=0,Vi=1;if(Pi.e00=ps,Pi.e01=Te,Pi.e02=qe,Pi.e03=D_,Pi.e10=gn,Pi.e11=Si,Pi.e12=No,Pi.e13=Wr,Pi.e20=ke,Pi.e21=on,Pi.e22=Tn,Pi.e23=Kn,Pi.e30=we,Pi.e31=k_,Pi.e32=Re,Pi.e33=Vi,Dt.sizeMat4==Dt.stackMat4.length){for(var Ir=Dt.sizeMat4<<1,ur=new Array(Ir),eo=ur,Rn=0,ms=Dt.sizeMat4;Rn<ms;){var nn=Rn++;eo[nn]=Dt.stackMat4[nn],Dt.stackMat4[nn]=null}Dt.stackMat4=eo}Dt.stackMat4[Dt.sizeMat4++]=Pi}if(Dr!=null){var Qn=0,ci=0,ho=0,Fr=1;if(Dr.x=Qn,Dr.y=ci,Dr.z=ho,Dr.w=Fr,Dt.sizeQuat==Dt.stackQuat.length){for(var En=Dt.sizeQuat<<1,as=new Array(En),Qe=as,Ee=0,De=Dt.sizeQuat;Ee<De;){var he=Ee++;Qe[he]=Dt.stackQuat[he],Dt.stackQuat[he]=null}Dt.stackQuat=Qe}Dt.stackQuat[Dt.sizeQuat++]=Dr}var ii=this.p,ir=null,Qi=null,Fi=null;if(Xa!=null){if(Xa.zero(),ii.sizeVec3==ii.stackVec3.length){for(var fo=ii.sizeVec3<<1,So=new Array(fo),s_=So,Fe=0,ts=ii.sizeVec3;Fe<ts;){var Dn=Fe++;s_[Dn]=ii.stackVec3[Dn],ii.stackVec3[Dn]=null}ii.stackVec3=s_}ii.stackVec3[ii.sizeVec3++]=Xa}if(ir!=null){var co=1,Ft=0,Ni=0,lr=0,Vo=1,ce=0,Xe=0,Le=0,uo=1;if(ir.e00=co,ir.e01=Ft,ir.e02=Ni,ir.e10=lr,ir.e11=Vo,ir.e12=ce,ir.e20=Xe,ir.e21=Le,ir.e22=uo,ii.sizeMat3==ii.stackMat3.length){for(var $t=ii.sizeMat3<<1,Vr=new Array($t),sr=Vr,Jo=0,Ns=ii.sizeMat3;Jo<Ns;){var Co=Jo++;sr[Co]=ii.stackMat3[Co],ii.stackMat3[Co]=null}ii.stackMat3=sr}ii.stackMat3[ii.sizeMat3++]=ir}if(Qi!=null){var ko=1,Nr=0,Sr=0,Cr=0,Lr=0,Qt=1,Ji=0,Yi=0,Ri=0,zr=0,qi=1,Jr=0,Gr=0,ao=0,be=0,ki=1;if(Qi.e00=ko,Qi.e01=Nr,Qi.e02=Sr,Qi.e03=Cr,Qi.e10=Lr,Qi.e11=Qt,Qi.e12=Ji,Qi.e13=Yi,Qi.e20=Ri,Qi.e21=zr,Qi.e22=qi,Qi.e23=Jr,Qi.e30=Gr,Qi.e31=ao,Qi.e32=be,Qi.e33=ki,ii.sizeMat4==ii.stackMat4.length){for(var en=ii.sizeMat4<<1,Yr=new Array(en),Go=Yr,ys=0,In=ii.sizeMat4;ys<In;){var gs=ys++;Go[gs]=ii.stackMat4[gs],ii.stackMat4[gs]=null}ii.stackMat4=Go}ii.stackMat4[ii.sizeMat4++]=Qi}if(Fi!=null){var Vn=0,Ci=0,To=0,so=1;if(Fi.x=Vn,Fi.y=Ci,Fi.z=To,Fi.w=so,ii.sizeQuat==ii.stackQuat.length){for(var Fn=ii.sizeQuat<<1,Ne=new Array(Fn),Nn=Ne,Wo=0,kn=ii.sizeQuat;Wo<kn;){var Ye=Wo++;Nn[Ye]=ii.stackQuat[Ye],ii.stackQuat[Ye]=null}ii.stackQuat=Nn}ii.stackQuat[ii.sizeQuat++]=Fi}var Ot=this.p,Ro=null,Ur=null,wn=null;if(Qa!=null){if(Qa.zero(),Ot.sizeVec3==Ot.stackVec3.length){for(var Jn=Ot.sizeVec3<<1,fe=new Array(Jn),Is=fe,Uo=0,Vs=Ot.sizeVec3;Uo<Vs;){var w_=Uo++;Is[w_]=Ot.stackVec3[w_],Ot.stackVec3[w_]=null}Ot.stackVec3=Is}Ot.stackVec3[Ot.sizeVec3++]=Qa}if(Ro!=null){var Js=1,X_=0,Je=0,F_=0,N_=1,Or=0,wo=0,Xo=0,Gn=1;if(Ro.e00=Js,Ro.e01=X_,Ro.e02=Je,Ro.e10=F_,Ro.e11=N_,Ro.e12=Or,Ro.e20=wo,Ro.e21=Xo,Ro.e22=Gn,Ot.sizeMat3==Ot.stackMat3.length){for(var wi=Ot.sizeMat3<<1,Wn=new Array(wi),Qo=Wn,to=0,J_=Ot.sizeMat3;to<J_;){var G_=to++;Qo[G_]=Ot.stackMat3[G_],Ot.stackMat3[G_]=null}Ot.stackMat3=Qo}Ot.stackMat3[Ot.sizeMat3++]=Ro}if(Ur!=null){var L_=1,is=0,__=0,v_=0,rs=0,pi=1,Oo=0,ar=0,Ze=0,Gs=0,hv=1,ue=0,Ge=0,$n=0,Ws=0,Ti=1;if(Ur.e00=L_,Ur.e01=is,Ur.e02=__,Ur.e03=v_,Ur.e10=rs,Ur.e11=pi,Ur.e12=Oo,Ur.e13=ar,Ur.e20=Ze,Ur.e21=Gs,Ur.e22=hv,Ur.e23=ue,Ur.e30=Ge,Ur.e31=$n,Ur.e32=Ws,Ur.e33=Ti,Ot.sizeMat4==Ot.stackMat4.length){for(var Lo=Ot.sizeMat4<<1,Tr=new Array(Lo),sn=Tr,ks=0,Y_=Ot.sizeMat4;ks<Y_;){var We=ks++;sn[We]=Ot.stackMat4[We],Ot.stackMat4[We]=null}Ot.stackMat4=sn}Ot.stackMat4[Ot.sizeMat4++]=Ur}if(wn!=null){var jn=0,Xn=0,os=0,de=1;if(wn.x=jn,wn.y=Xn,wn.z=os,wn.w=de,Ot.sizeQuat==Ot.stackQuat.length){for(var ns=Ot.sizeQuat<<1,Us=new Array(ns),l_=Us,Be=0,Ae=Ot.sizeQuat;Be<Ae;){var qn=Be++;l_[qn]=Ot.stackQuat[qn],Ot.stackQuat[qn]=null}Ot.stackQuat=l_}Ot.stackQuat[Ot.sizeQuat++]=wn}var mi=this.p,xo=null,Zr=null,Ho=null;if(Aa!=null){if(Aa.zero(),mi.sizeVec3==mi.stackVec3.length){for(var Yo=mi.sizeVec3<<1,Hr=new Array(Yo),Eo=Hr,ws=0,ae=mi.sizeVec3;ws<ae;){var Os=ws++;Eo[Os]=mi.stackVec3[Os],mi.stackVec3[Os]=null}mi.stackVec3=Eo}mi.stackVec3[mi.sizeVec3++]=Aa}if(xo!=null){var W_=1,te=0,Nt=0,Kr=0,Do=1,Xs=0,kv=0,i0=0,U_=1;if(xo.e00=W_,xo.e01=te,xo.e02=Nt,xo.e10=Kr,xo.e11=Do,xo.e12=Xs,xo.e20=kv,xo.e21=i0,xo.e22=U_,mi.sizeMat3==mi.stackMat3.length){for(var Ht=mi.sizeMat3<<1,Ln=new Array(Ht),Rr=Ln,Yn=0,Z_=mi.sizeMat3;Yn<Z_;){var Hs=Yn++;Rr[Hs]=mi.stackMat3[Hs],mi.stackMat3[Hs]=null}mi.stackMat3=Rr}mi.stackMat3[mi.sizeMat3++]=xo}if(Zr!=null){var h_=1,bo=0,es=0,ss=0,xe=0,Zi=1,Ko=0,kr=0,Zo=0,Ue=0,cv=1,ze=0,Ks=0,wv=0,Oe=0,ei=1;if(Zr.e00=h_,Zr.e01=bo,Zr.e02=es,Zr.e03=ss,Zr.e10=xe,Zr.e11=Zi,Zr.e12=Ko,Zr.e13=kr,Zr.e20=Zo,Zr.e21=Ue,Zr.e22=cv,Zr.e23=ze,Zr.e30=Ks,Zr.e31=wv,Zr.e32=Oe,Zr.e33=ei,mi.sizeMat4==mi.stackMat4.length){for(var Zn=mi.sizeMat4<<1,_n=new Array(Zn),vn=_n,d_=0,bv=mi.sizeMat4;d_<bv;){var ie=d_++;vn[ie]=mi.stackMat4[ie],mi.stackMat4[ie]=null}mi.stackMat4=vn}mi.stackMat4[mi.sizeMat4++]=Zr}if(Ho!=null){var Pe=0,c_=0,O_=0,fv=1;if(Ho.x=Pe,Ho.y=c_,Ho.z=O_,Ho.w=fv,mi.sizeQuat==mi.stackQuat.length){for(var uv=mi.sizeQuat<<1,b_=new Array(uv),He=b_,zo=0,_s=mi.sizeQuat;zo<_s;){var vs=zo++;He[vs]=mi.stackQuat[vs],mi.stackQuat[vs]=null}mi.stackQuat=He}mi.stackQuat[mi.sizeQuat++]=Ho}var Ui=this.p,Mo=null,_o=null,ls=null;if(rt!=null){if(rt.zero(),Ui.sizeVec3==Ui.stackVec3.length){for(var Ls=Ui.sizeVec3<<1,Ys=new Array(Ls),Zs=Ys,B_=0,Me=Ui.sizeVec3;B_<Me;){var hs=B_++;Zs[hs]=Ui.stackVec3[hs],Ui.stackVec3[hs]=null}Ui.stackVec3=Zs}Ui.stackVec3[Ui.sizeVec3++]=rt}if(Mo!=null){var H_=1,$s=0,Un=0,pe=0,Xv=1,A_=0,$o=0,ln=0,po=1;if(Mo.e00=H_,Mo.e01=$s,Mo.e02=Un,Mo.e10=pe,Mo.e11=Xv,Mo.e12=A_,Mo.e20=$o,Mo.e21=ln,Mo.e22=po,Ui.sizeMat3==Ui.stackMat3.length){for(var Kt=Ui.sizeMat3<<1,$r=new Array(Kt),vo=$r,js=0,ds=Ui.sizeMat3;js<ds;){var qs=js++;vo[qs]=Ui.stackMat3[qs],Ui.stackMat3[qs]=null}Ui.stackMat3=vo}Ui.stackMat3[Ui.sizeMat3++]=Mo}if(_o!=null){var P_=1,jo=0,re=0,K_=0,xv=0,di=1,mo=0,Qr=0,io=0,$_=0,j_=1,Lv=0,a_=0,Yv=0,q_=0,Bi=1;if(_o.e00=P_,_o.e01=jo,_o.e02=re,_o.e03=K_,_o.e10=xv,_o.e11=di,_o.e12=mo,_o.e13=Qr,_o.e20=io,_o.e21=$_,_o.e22=j_,_o.e23=Lv,_o.e30=a_,_o.e31=Yv,_o.e32=q_,_o.e33=Bi,Ui.sizeMat4==Ui.stackMat4.length){for(var av=Ui.sizeMat4<<1,Bs=new Array(av),As=Bs,cs=0,bs=Ui.sizeMat4;cs<bs;){var Ps=cs++;As[Ps]=Ui.stackMat4[Ps],Ui.stackMat4[Ps]=null}Ui.stackMat4=As}Ui.stackMat4[Ui.sizeMat4++]=_o}if(ls!=null){var Zv=0,me=0,jr=0,t_=1;if(ls.x=Zv,ls.y=me,ls.z=jr,ls.w=t_,Ui.sizeQuat==Ui.stackQuat.length){for(var yo=Ui.sizeQuat<<1,i_=new Array(yo),Fo=i_,Ss=0,qo=Ui.sizeQuat;Ss<qo;){var ye=Ss++;Fo[ye]=Ui.stackQuat[ye],Ui.stackQuat[ye]=null}Ui.stackQuat=Fo}Ui.stackQuat[Ui.sizeQuat++]=ls}var si=this.p,an=null,_r=null,oe=null;if(O!=null){if(O.zero(),si.sizeVec3==si.stackVec3.length){for(var ge=si.sizeVec3<<1,Bo=new Array(ge),Er=Bo,dn=0,tv=si.sizeVec3;dn<tv;){var r_=dn++;Er[r_]=si.stackVec3[r_],si.stackVec3[r_]=null}si.stackVec3=Er}si.stackVec3[si.sizeVec3++]=O}if(an!=null){var S_=1,iv=0,ne=0,Bn=0,Ie=1,E0=0,M0=0,hl=0,D0=1;if(an.e00=S_,an.e01=iv,an.e02=ne,an.e10=Bn,an.e11=Ie,an.e12=E0,an.e20=M0,an.e21=hl,an.e22=D0,si.sizeMat3==si.stackMat3.length){for(var hr=si.sizeMat3<<1,On=new Array(hr),go=On,fs=0,rv=si.sizeMat3;fs<rv;){var zv=fs++;go[zv]=si.stackMat3[zv],si.stackMat3[zv]=null}si.stackMat3=go}si.stackMat3[si.sizeMat3++]=an}if(_r!=null){var o_=1,dv=0,Cs=0,f_=0,u_=0,Ai=1,Ts=0,lo=0,Se=0,Mv=0,Rs=1,x_=0,ov=0,r0=0,o0=0,nv=1;if(_r.e00=o_,_r.e01=dv,_r.e02=Cs,_r.e03=f_,_r.e10=u_,_r.e11=Ai,_r.e12=Ts,_r.e13=lo,_r.e20=Se,_r.e21=Mv,_r.e22=Rs,_r.e23=x_,_r.e30=ov,_r.e31=r0,_r.e32=o0,_r.e33=nv,si.sizeMat4==si.stackMat4.length){for(var tr=si.sizeMat4<<1,Ke=new Array(tr),An=Ke,us=0,F0=si.sizeMat4;us<F0;){var Dv=us++;An[Dv]=si.stackMat4[Dv],si.stackMat4[Dv]=null}si.stackMat4=An}si.stackMat4[si.sizeMat4++]=_r}if(oe!=null){var C_=0,p0=0,Bv=0,n0=1;if(oe.x=C_,oe.y=p0,oe.z=Bv,oe.w=n0,si.sizeQuat==si.stackQuat.length){for(var m0=si.sizeQuat<<1,N0=new Array(m0),e0=N0,s0=0,y0=si.sizeQuat;s0<y0;){var Fv=s0++;e0[Fv]=si.stackQuat[Fv],si.stackQuat[Fv]=null}si.stackQuat=e0}si.stackQuat[si.sizeQuat++]=oe}var cr=this.p,pv=null,hn=null,Nv=null;if(xt!=null){if(xt.zero(),cr.sizeVec3==cr.stackVec3.length){for(var Hl=cr.sizeVec3<<1,g0=new Array(Hl),I0=g0,cl=0,dl=cr.sizeVec3;cl<dl;){var Jv=cl++;I0[Jv]=cr.stackVec3[Jv],cr.stackVec3[Jv]=null}cr.stackVec3=I0}cr.stackVec3[cr.sizeVec3++]=xt}if(pv!=null){var Kl=1,$l=0,bl=0,Bl=0,Al=1,jl=0,fl=0,ql=0,ul=1;if(pv.e00=Kl,pv.e01=$l,pv.e02=bl,pv.e10=Bl,pv.e11=Al,pv.e12=jl,pv.e20=fl,pv.e21=ql,pv.e22=ul,cr.sizeMat3==cr.stackMat3.length){for(var rr=cr.sizeMat3<<1,xs=new Array(rr),tn=xs,mv=0,yh=cr.sizeMat3;mv<yh;){var Gv=mv++;tn[Gv]=cr.stackMat3[Gv],cr.stackMat3[Gv]=null}cr.stackMat3=tn}cr.stackMat3[cr.sizeMat3++]=pv}if(hn!=null){var J0=1,xl=0,V0=0,k0=0,G0=0,Mr=1,zs=0,ee=0,_0=0,Pl=0,lh=1,W0=0,hh=0,U0=0,Sl=0,zl=1;if(hn.e00=J0,hn.e01=xl,hn.e02=V0,hn.e03=k0,hn.e10=G0,hn.e11=Mr,hn.e12=zs,hn.e13=ee,hn.e20=_0,hn.e21=Pl,hn.e22=lh,hn.e23=W0,hn.e30=hh,hn.e31=U0,hn.e32=Sl,hn.e33=zl,cr.sizeMat4==cr.stackMat4.length){for(var Ce=cr.sizeMat4<<1,w0=new Array(Ce),z_=w0,Cl=0,O0=cr.sizeMat4;Cl<O0;){var H0=Cl++;z_[H0]=cr.stackMat4[H0],cr.stackMat4[H0]=null}cr.stackMat4=z_}cr.stackMat4[cr.sizeMat4++]=hn}if(Nv!=null){var Tl=0,Ml=0,X0=0,v0=1;if(Nv.x=Tl,Nv.y=Ml,Nv.z=X0,Nv.w=v0,cr.sizeQuat==cr.stackQuat.length){for(var M_=cr.sizeQuat<<1,Wv=new Array(M_),Uv=Wv,ev=0,L0=cr.sizeQuat;ev<L0;){var Av=ev++;Uv[Av]=cr.stackQuat[Av],cr.stackQuat[Av]=null}cr.stackQuat=Uv}cr.stackQuat[cr.sizeQuat++]=Nv}}else{for(var l0=0;l0<8;){var se=l0++,h0=this.tmpCircleNorms[se],Y0=this.circleCoords[se];h0.x=Y0.x,h0.y=Y0.y,h0.z=Y0.z;var Qs=h0,K0=Qs.x*f.e00+Qs.y*f.e01+Qs.z*f.e02,yi=Qs.x*f.e10+Qs.y*f.e11+Qs.z*f.e12,cn=Qs.x*f.e20+Qs.y*f.e21+Qs.z*f.e22;Qs.x=K0,Qs.y=yi,Qs.z=cn;var wr=this.tmpCircleVerts1[se],Ov=this.tmpCircleNorms[se];wr.x=Ov.x,wr.y=Ov.y,wr.z=Ov.z;var c0=wr,ch=c0.x*t,ah=c0.y*t,p_=c0.z*t;c0.x=ch,c0.y=ah,c0.z=p_;var $e=c0,Es=$e.x+u.x,th=$e.y+u.y,bh=$e.z+u.z;$e.x=Es,$e.y=th,$e.z=bh;var Rl=this.tmpCircleVerts2[se],br=this.tmpCircleVerts1[se];Rl.x=br.x,Rl.y=br.y,Rl.z=br.z;var n_=this.tmpCircleVerts1[se],bn=n_.x+h.x*i,yv=n_.y+h.y*i,$0=n_.z+h.z*i;n_.x=bn,n_.y=yv,n_.z=$0;var gv=this.tmpCircleVerts2[se],pl=-i,ml=gv.x+h.x*pl,yl=gv.y+h.y*pl,T_=gv.z+h.z*pl;gv.x=ml,gv.y=yl,gv.z=T_}for(var Pv=0;Pv<8;){var Pn=Pv++,Iv=k,Sv=this.tmpCircleVerts1[Pn],R_=this.tmpCircleVerts1[(Pn+1)%8],_e=h;this.triangle(Iv,Sv,R_,_e,_e,_e,r),Iv=P,Sv=this.tmpCircleVerts2[(Pn+1)%8],R_=this.tmpCircleVerts2[Pn];var Q_=this.p,Cv=Q_.sizeVec3==0?new x.common.Vec3:Q_.stackVec3[--Q_.sizeVec3];Cv.x=h.x,Cv.y=h.y,Cv.z=h.z;var Hv=Cv,or=-Hv.x,m_=-Hv.y,ve=-Hv.z;Hv.x=or,Hv.y=m_,Hv.z=ve,_e=Hv,this.triangle(Iv,Sv,R_,_e,_e,_e,r);var Gi=this.p,y_=null,Sn=null,j0=null;if(_e!=null){if(_e.zero(),Gi.sizeVec3==Gi.stackVec3.length){for(var b0=Gi.sizeVec3<<1,fh=new Array(b0),q0=fh,al=0,gl=Gi.sizeVec3;al<gl;){var Z0=al++;q0[Z0]=Gi.stackVec3[Z0],Gi.stackVec3[Z0]=null}Gi.stackVec3=q0}Gi.stackVec3[Gi.sizeVec3++]=_e}if(y_!=null){var uh=1,Il=0,gh=0,ih=0,Vl=1,d0=0,B0=0,kl=0,rh=1;if(y_.e00=uh,y_.e01=Il,y_.e02=gh,y_.e10=ih,y_.e11=Vl,y_.e12=d0,y_.e20=B0,y_.e21=kl,y_.e22=rh,Gi.sizeMat3==Gi.stackMat3.length){for(var Kv=Gi.sizeMat3<<1,Ql=new Array(Kv),$v=Ql,nr=0,g_=Gi.sizeMat3;nr<g_;){var rn=nr++;$v[rn]=Gi.stackMat3[rn],Gi.stackMat3[rn]=null}Gi.stackMat3=$v}Gi.stackMat3[Gi.sizeMat3++]=y_}if(Sn!=null){var wl=1,A0=0,oh=0,El=0,tl=0,Dl=1,P0=0,nh=0,eh=0,Fl=0,Nl=1,sv=0,Tv=0,jv=0,Ds=0,xh=1;if(Sn.e00=wl,Sn.e01=A0,Sn.e02=oh,Sn.e03=El,Sn.e10=tl,Sn.e11=Dl,Sn.e12=P0,Sn.e13=nh,Sn.e20=eh,Sn.e21=Fl,Sn.e22=Nl,Sn.e23=sv,Sn.e30=Tv,Sn.e31=jv,Sn.e32=Ds,Sn.e33=xh,Gi.sizeMat4==Gi.stackMat4.length){for(var f0=Gi.sizeMat4<<1,Xl=new Array(f0),Rv=Xl,qv=0,Qv=Gi.sizeMat4;qv<Qv;){var u0=qv++;Rv[u0]=Gi.stackMat4[u0],Gi.stackMat4[u0]=null}Gi.stackMat4=Rv}Gi.stackMat4[Gi.sizeMat4++]=Sn}if(j0!=null){var Zh=0,S0=0,a0=0,Jl=1;if(j0.x=Zh,j0.y=S0,j0.z=a0,j0.w=Jl,Gi.sizeQuat==Gi.stackQuat.length){for(var Gl=Gi.sizeQuat<<1,zh=new Array(Gl),Ev=zh,xr=0,Ve=Gi.sizeQuat;xr<Ve;){var le=xr++;Ev[le]=Gi.stackQuat[le],Gi.stackQuat[le]=null}Gi.stackQuat=Ev}Gi.stackQuat[Gi.sizeQuat++]=j0}Iv=this.tmpCircleVerts1[Pn],Sv=this.tmpCircleVerts2[Pn],R_=this.tmpCircleVerts2[(Pn+1)%8];var C0=this.tmpCircleVerts1[(Pn+1)%8];_e=this.tmpCircleNorms[Pn];var Wl=this.tmpCircleNorms[(Pn+1)%8];this.rect(Iv,Sv,R_,C0,_e,_e,Wl,Wl,r)}}var Fs=this.p;if(k!=null){if(k.zero(),Fs.sizeVec3==Fs.stackVec3.length){for(var x0=Fs.sizeVec3<<1,Ll=new Array(x0),Ul=Ll,Ol=0,Ih=Fs.sizeVec3;Ol<Ih;){var _v=Ol++;Ul[_v]=Fs.stackVec3[_v],Fs.stackVec3[_v]=null}Fs.stackVec3=Ul}Fs.stackVec3[Fs.sizeVec3++]=k}var vv=this.p;if(P!=null){if(P.zero(),vv.sizeVec3==vv.stackVec3.length){for(var T0=vv.sizeVec3<<1,I_=new Array(T0),Yl=I_,Vh=0,dh=vv.sizeVec3;Vh<dh;){var t0=Vh++;Yl[t0]=vv.stackVec3[t0],vv.stackVec3[t0]=null}vv.stackVec3=Yl}vv.stackVec3[vv.sizeVec3++]=P}var lv=this.p;if(u!=null){if(u.zero(),lv.sizeVec3==lv.stackVec3.length){for(var kh=lv.sizeVec3<<1,Zl=new Array(kh),wh=Zl,Kh=0,sh=lv.sizeVec3;Kh<sh;){var Ei=Kh++;wh[Ei]=lv.stackVec3[Ei],lv.stackVec3[Ei]=null}lv.stackVec3=wh}lv.stackVec3[lv.sizeVec3++]=u}var e_=this.p;if(f!=null){var V_=1,_h=0,Bh=0,Ah=0,Mh=1,Vv=0,Rh=0,Qh=0,$h=1;if(f.e00=V_,f.e01=_h,f.e02=Bh,f.e10=Ah,f.e11=Mh,f.e12=Vv,f.e20=Rh,f.e21=Qh,f.e22=$h,e_.sizeMat3==e_.stackMat3.length){for(var jh=e_.sizeMat3<<1,ph=new Array(jh),Ph=ph,il=0,ic=e_.sizeMat3;il<ic;){var Xh=il++;Ph[Xh]=e_.stackMat3[Xh],e_.stackMat3[Xh]=null}e_.stackMat3=Ph}e_.stackMat3[e_.sizeMat3++]=f}var E_=this.p;if(s!=null){if(s.zero(),E_.sizeVec3==E_.stackVec3.length){for(var Eh=E_.sizeVec3<<1,mh=new Array(Eh),qh=mh,Lh=0,ac=E_.sizeVec3;Lh<ac;){var Sh=Lh++;qh[Sh]=E_.stackVec3[Sh],E_.stackVec3[Sh]=null}E_.stackVec3=qh}E_.stackVec3[E_.sizeVec3++]=s}var R0=this.p;if(h!=null){if(h.zero(),R0.sizeVec3==R0.stackVec3.length){for(var rc=R0.sizeVec3<<1,vh=new Array(rc),Yh=vh,Dh=0,Ch=R0.sizeVec3;Dh<Ch;){var Q0=Dh++;Yh[Q0]=R0.stackVec3[Q0],R0.stackVec3[Q0]=null}R0.stackVec3=Yh}R0.stackVec3[R0.sizeVec3++]=h}var z0=this.p;if(e!=null){if(e.zero(),z0.sizeVec3==z0.stackVec3.length){for(var nc=z0.sizeVec3<<1,ec=new Array(nc),Fh=ec,oc=0,tc=z0.sizeVec3;oc<tc;){var rl=oc++;Fh[rl]=z0.stackVec3[rl],z0.stackVec3[rl]=null}z0.stackVec3=Fh}z0.stackVec3[z0.sizeVec3++]=e}}capsule(a,t,i,r){var o=this.p,s=o.sizeVec3==0?new x.common.Vec3:o.stackVec3[--o.sizeVec3],_=this.p,h=_.sizeVec3==0?new x.common.Vec3:_.stackVec3[--_.sizeVec3],v=this.p,e=v.sizeVec3==0?new x.common.Vec3:v.stackVec3[--v.sizeVec3],l=this.p,u=l.sizeVec3==0?new x.common.Vec3:l.stackVec3[--l.sizeVec3],b=this.p,f=b.sizeMat3==0?new x.common.Mat3:b.stackMat3[--b.sizeMat3],n=u;n.x=a._positionX,n.y=a._positionY,n.z=a._positionZ;var c=f;c.e00=a._rotation00,c.e01=a._rotation01,c.e02=a._rotation02,c.e10=a._rotation10,c.e11=a._rotation11,c.e12=a._rotation12,c.e20=a._rotation20,c.e21=a._rotation21,c.e22=a._rotation22,s.init(f.e00,f.e10,f.e20),h.init(f.e01,f.e11,f.e21),e.init(f.e02,f.e12,f.e22);for(var z=4,p=8,y=this.tmpSphereVerts,V=this.tmpSphereNorms,M=0,I=z+1;M<I;)for(var k=M++,X=this.tmpSphereVerts[k].length,L=0,m=X;L<m;){var g=L++,N=V[k][g],A=this.sphereCoords[k][g];N.x=A.x,N.y=A.y,N.z=A.z;var F=N,P=F.x*f.e00+F.y*f.e01+F.z*f.e02,Y=F.x*f.e10+F.y*f.e11+F.z*f.e12,R=F.x*f.e20+F.y*f.e21+F.z*f.e22;F.x=P,F.y=Y,F.z=R}for(var C=0,d=z;C<d;){var Z=C++;if(Z==0)for(var $=z>>1,K=0,E=$+1;K<E;)for(var J=K++,B=this.tmpSphereVerts[J].length,Q=0,U=B;Q<U;){var G=Q++,D=y[J][G],H=V[J][G];D.x=H.x,D.y=H.y,D.z=H.z;var j=D,ia=j.x*t,sa=j.y*t,W=j.z*t;j.x=ia,j.y=sa,j.z=W;var q=j,na=q.x+u.x,oa=q.y+u.y,aa=q.z+u.z;q.x=na,q.y=oa,q.z=aa;var T=q,ca=T.x+h.x*i,_a=T.y+h.y*i,w=T.z+h.z*i;T.x=ca,T.y=_a,T.z=w}if(Z==z>>1)for(var ta=z>>1,ra=ta,la=z+1;ra<la;)for(var va=ra++,xa=this.tmpSphereVerts[va].length,za=0,Ma=xa;za<Ma;){var Xa=za++,Za=y[va][Xa],fa=V[va][Xa];Za.x=fa.x,Za.y=fa.y,Za.z=fa.z;var ba=Za,ea=ba.x*t,ha=ba.y*t,ma=ba.z*t;ba.x=ea,ba.y=ha,ba.z=ma;var ya=ba,da=ya.x+u.x,pa=ya.y+u.y,Ya=ya.z+u.z;ya.x=da,ya.y=pa,ya.z=Ya;var Qa=ya,ga=-i,ua=Qa.x+h.x*ga,wa=Qa.y+h.y*ga,ka=Qa.z+h.z*ga;Qa.x=ua,Qa.y=wa,Qa.z=ka}for(var Sa=0,zt=p;Sa<zt;){var Ha=Sa++,Ba,nt,Ea,Fa,Aa,ft,Wa,Ka;Z==0?this.wireframe?(Ba=y[0][0],nt=y[1][Ha],this.line(Ba,nt,r)):(Ba=y[0][0],nt=y[1][Ha],Ea=y[1][(Ha+1)%p],Aa=V[0][0],ft=V[1][Ha],Wa=V[1][(Ha+1)%p],this.triangle(Ba,nt,Ea,Aa,ft,Wa,r)):Z==z-1?this.wireframe?(Ba=y[z][0],nt=y[Z][(Ha+1)%p],Ea=y[Z][Ha],this.line(Ba,nt,r),this.line(nt,Ea,r)):(Ba=y[z][0],nt=y[Z][(Ha+1)%p],Ea=y[Z][Ha],Aa=V[z][0],ft=V[Z][(Ha+1)%p],Wa=V[Z][Ha],this.triangle(Ba,nt,Ea,Aa,ft,Wa,r)):this.wireframe?(Ba=y[Z][Ha],nt=y[Z][(Ha+1)%p],Ea=y[Z+1][Ha],this.line(Ba,nt,r),this.line(Ba,Ea,r)):(Ba=y[Z][Ha],nt=y[Z][(Ha+1)%p],Ea=y[Z+1][Ha],Fa=y[Z+1][(Ha+1)%p],Aa=V[Z][Ha],ft=V[Z][(Ha+1)%p],Wa=V[Z+1][Ha],Ka=V[Z+1][(Ha+1)%p],this.rect(Ba,Ea,Fa,nt,Aa,Wa,Ka,ft,r))}}var bt=this.p,it=bt.sizeVec3==0?new x.common.Vec3:bt.stackVec3[--bt.sizeVec3];it.x=u.x,it.y=u.y,it.z=u.z;var $a=it,_t=$a.x+h.x*i,gt=$a.y+h.y*i,pt=$a.z+h.z*i;$a.x=_t,$a.y=gt,$a.z=pt;var Ga=$a,rt=this.p,ut=rt.sizeVec3==0?new x.common.Vec3:rt.stackVec3[--rt.sizeVec3];ut.x=u.x,ut.y=u.y,ut.z=u.z;var Da=ut,Ta=-i,Na=Da.x+h.x*Ta,Vt=Da.y+h.y*Ta,St=Da.z+h.z*Ta;Da.x=Na,Da.y=Vt,Da.z=St;var et=Da;if(this.wireframe){var Xt=this.p,Yt=Xt.sizeVec3==0?new x.common.Vec3:Xt.stackVec3[--Xt.sizeVec3];Yt.x=Ga.x,Yt.y=Ga.y,Yt.z=Ga.z;var Mt=Yt,Ia=-t,O=Mt.x+s.x*Ia,Va=Mt.y+s.y*Ia,lt=Mt.z+s.z*Ia;Mt.x=O,Mt.y=Va,Mt.z=lt;var S=Mt,wt=S.x+e.x*0,Bt=S.y+e.y*0,At=S.z+e.z*0;S.x=wt,S.y=Bt,S.z=At;var yt=S,kt=this.p,mt=kt.sizeVec3==0?new x.common.Vec3:kt.stackVec3[--kt.sizeVec3];mt.x=Ga.x,mt.y=Ga.y,mt.z=Ga.z;var ht=mt,xt=ht.x+s.x*t,Ra=ht.y+s.y*t,st=ht.z+s.z*t;ht.x=xt,ht.y=Ra,ht.z=st;var Ca=ht,vt=Ca.x+e.x*0,qa=Ca.y+e.y*0,at=Ca.z+e.z*0;Ca.x=vt,Ca.y=qa,Ca.z=at;var Oa=Ca,tt=this.p,ct=tt.sizeVec3==0?new x.common.Vec3:tt.stackVec3[--tt.sizeVec3];ct.x=Ga.x,ct.y=Ga.y,ct.z=Ga.z;var Pa=ct,Ja=Pa.x+s.x*0,ja=Pa.y+s.y*0,La=Pa.z+s.z*0;Pa.x=Ja,Pa.y=ja,Pa.z=La;var ot=Pa,It=-t,oi=ot.x+e.x*It,gi=ot.y+e.y*It,ai=ot.z+e.z*It;ot.x=oi,ot.y=gi,ot.z=ai;var Ct=ot,_i=this.p,Et=_i.sizeVec3==0?new x.common.Vec3:_i.stackVec3[--_i.sizeVec3];Et.x=Ga.x,Et.y=Ga.y,Et.z=Ga.z;var Pt=Et,Jt=Pt.x+s.x*0,Ki=Pt.y+s.y*0,vi=Pt.z+s.z*0;Pt.x=Jt,Pt.y=Ki,Pt.z=vi;var li=Pt,ti=li.x+e.x*t,Oi=li.y+e.y*t,Xi=li.z+e.z*t;li.x=ti,li.y=Oi,li.z=Xi;var zi=li,Zt=this.p,ri=Zt.sizeVec3==0?new x.common.Vec3:Zt.stackVec3[--Zt.sizeVec3];ri.x=et.x,ri.y=et.y,ri.z=et.z;var Wt=ri,ni=-t,$i=Wt.x+s.x*ni,Ut=Wt.y+s.y*ni,ji=Wt.z+s.z*ni;Wt.x=$i,Wt.y=Ut,Wt.z=ji;var Ii=Wt,pr=Ii.x+e.x*0,Wi=Ii.y+e.y*0,Lt=Ii.z+e.z*0;Ii.x=pr,Ii.y=Wi,Ii.z=Lt;var jt=Ii,Tt=this.p,bi=Tt.sizeVec3==0?new x.common.Vec3:Tt.stackVec3[--Tt.sizeVec3];bi.x=et.x,bi.y=et.y,bi.z=et.z;var Mi=bi,vr=Mi.x+s.x*t,qt=Mi.y+s.y*t,fi=Mi.z+s.z*t;Mi.x=vr,Mi.y=qt,Mi.z=fi;var dt=Mi,ui=dt.x+e.x*0,hi=dt.y+e.y*0,er=dt.z+e.z*0;dt.x=ui,dt.y=hi,dt.z=er;var Xr=dt,ro=this.p,Gt=ro.sizeVec3==0?new x.common.Vec3:ro.stackVec3[--ro.sizeVec3];Gt.x=et.x,Gt.y=et.y,Gt.z=et.z;var fr=Gt,mr=fr.x+s.x*0,Dt=fr.y+s.y*0,dr=fr.z+s.z*0;fr.x=mr,fr.y=Dt,fr.z=dr;var Pi=fr,Dr=-t,Hn=Pi.x+e.x*Dr,oo=Pi.y+e.y*Dr,Br=Pi.z+e.z*Dr;Pi.x=Hn,Pi.y=oo,Pi.z=Br;var no=Pi,yn=this.p,Ao=yn.sizeVec3==0?new x.common.Vec3:yn.stackVec3[--yn.sizeVec3];Ao.x=et.x,Ao.y=et.y,Ao.z=et.z;var Io=Ao,xi=Io.x+s.x*0,qr=Io.y+s.y*0,Ar=Io.z+s.z*0;Io.x=xi,Io.y=qr,Io.z=Ar;var yr=Io,Po=yr.x+e.x*t,Di=yr.y+e.y*t,Pr=yr.z+e.z*t;yr.x=Po,yr.y=Di,yr.z=Pr;var gr=yr;this.ellipse(Ga,s,e,t,t,r),this.ellipse(et,s,e,t,t,r),this.line(yt,jt,r),this.line(Oa,Xr,r),this.line(Ct,no,r),this.line(zi,gr,r);var Rt=this.p,Hi=null,Li=null,Cn=null;if(yt!=null){if(yt.zero(),Rt.sizeVec3==Rt.stackVec3.length){for(var Ms=Rt.sizeVec3<<1,je=new Array(Ms),ps=je,Te=0,qe=Rt.sizeVec3;Te<qe;){var D_=Te++;ps[D_]=Rt.stackVec3[D_],Rt.stackVec3[D_]=null}Rt.stackVec3=ps}Rt.stackVec3[Rt.sizeVec3++]=yt}if(Hi!=null){var gn=1,Si=0,No=0,Wr=0,ke=1,on=0,Tn=0,Kn=0,we=1;if(Hi.e00=gn,Hi.e01=Si,Hi.e02=No,Hi.e10=Wr,Hi.e11=ke,Hi.e12=on,Hi.e20=Tn,Hi.e21=Kn,Hi.e22=we,Rt.sizeMat3==Rt.stackMat3.length){for(var k_=Rt.sizeMat3<<1,Re=new Array(k_),Vi=Re,Ir=0,ur=Rt.sizeMat3;Ir<ur;){var eo=Ir++;Vi[eo]=Rt.stackMat3[eo],Rt.stackMat3[eo]=null}Rt.stackMat3=Vi}Rt.stackMat3[Rt.sizeMat3++]=Hi}if(Li!=null){var Rn=1,ms=0,nn=0,Qn=0,ci=0,ho=1,Fr=0,En=0,as=0,Qe=0,Ee=1,De=0,he=0,ii=0,ir=0,Qi=1;if(Li.e00=Rn,Li.e01=ms,Li.e02=nn,Li.e03=Qn,Li.e10=ci,Li.e11=ho,Li.e12=Fr,Li.e13=En,Li.e20=as,Li.e21=Qe,Li.e22=Ee,Li.e23=De,Li.e30=he,Li.e31=ii,Li.e32=ir,Li.e33=Qi,Rt.sizeMat4==Rt.stackMat4.length){for(var Fi=Rt.sizeMat4<<1,fo=new Array(Fi),So=fo,s_=0,Fe=Rt.sizeMat4;s_<Fe;){var ts=s_++;So[ts]=Rt.stackMat4[ts],Rt.stackMat4[ts]=null}Rt.stackMat4=So}Rt.stackMat4[Rt.sizeMat4++]=Li}if(Cn!=null){var Dn=0,co=0,Ft=0,Ni=1;if(Cn.x=Dn,Cn.y=co,Cn.z=Ft,Cn.w=Ni,Rt.sizeQuat==Rt.stackQuat.length){for(var lr=Rt.sizeQuat<<1,Vo=new Array(lr),ce=Vo,Xe=0,Le=Rt.sizeQuat;Xe<Le;){var uo=Xe++;ce[uo]=Rt.stackQuat[uo],Rt.stackQuat[uo]=null}Rt.stackQuat=ce}Rt.stackQuat[Rt.sizeQuat++]=Cn}var $t=this.p,Vr=null,sr=null,Jo=null;if(Oa!=null){if(Oa.zero(),$t.sizeVec3==$t.stackVec3.length){for(var Ns=$t.sizeVec3<<1,Co=new Array(Ns),ko=Co,Nr=0,Sr=$t.sizeVec3;Nr<Sr;){var Cr=Nr++;ko[Cr]=$t.stackVec3[Cr],$t.stackVec3[Cr]=null}$t.stackVec3=ko}$t.stackVec3[$t.sizeVec3++]=Oa}if(Vr!=null){var Lr=1,Qt=0,Ji=0,Yi=0,Ri=1,zr=0,qi=0,Jr=0,Gr=1;if(Vr.e00=Lr,Vr.e01=Qt,Vr.e02=Ji,Vr.e10=Yi,Vr.e11=Ri,Vr.e12=zr,Vr.e20=qi,Vr.e21=Jr,Vr.e22=Gr,$t.sizeMat3==$t.stackMat3.length){for(var ao=$t.sizeMat3<<1,be=new Array(ao),ki=be,en=0,Yr=$t.sizeMat3;en<Yr;){var Go=en++;ki[Go]=$t.stackMat3[Go],$t.stackMat3[Go]=null}$t.stackMat3=ki}$t.stackMat3[$t.sizeMat3++]=Vr}if(sr!=null){var ys=1,In=0,gs=0,Vn=0,Ci=0,To=1,so=0,Fn=0,Ne=0,Nn=0,Wo=1,kn=0,Ye=0,Ot=0,Ro=0,Ur=1;if(sr.e00=ys,sr.e01=In,sr.e02=gs,sr.e03=Vn,sr.e10=Ci,sr.e11=To,sr.e12=so,sr.e13=Fn,sr.e20=Ne,sr.e21=Nn,sr.e22=Wo,sr.e23=kn,sr.e30=Ye,sr.e31=Ot,sr.e32=Ro,sr.e33=Ur,$t.sizeMat4==$t.stackMat4.length){for(var wn=$t.sizeMat4<<1,Jn=new Array(wn),fe=Jn,Is=0,Uo=$t.sizeMat4;Is<Uo;){var Vs=Is++;fe[Vs]=$t.stackMat4[Vs],$t.stackMat4[Vs]=null}$t.stackMat4=fe}$t.stackMat4[$t.sizeMat4++]=sr}if(Jo!=null){var w_=0,Js=0,X_=0,Je=1;if(Jo.x=w_,Jo.y=Js,Jo.z=X_,Jo.w=Je,$t.sizeQuat==$t.stackQuat.length){for(var F_=$t.sizeQuat<<1,N_=new Array(F_),Or=N_,wo=0,Xo=$t.sizeQuat;wo<Xo;){var Gn=wo++;Or[Gn]=$t.stackQuat[Gn],$t.stackQuat[Gn]=null}$t.stackQuat=Or}$t.stackQuat[$t.sizeQuat++]=Jo}var wi=this.p,Wn=null,Qo=null,to=null;if(Ct!=null){if(Ct.zero(),wi.sizeVec3==wi.stackVec3.length){for(var J_=wi.sizeVec3<<1,G_=new Array(J_),L_=G_,is=0,__=wi.sizeVec3;is<__;){var v_=is++;L_[v_]=wi.stackVec3[v_],wi.stackVec3[v_]=null}wi.stackVec3=L_}wi.stackVec3[wi.sizeVec3++]=Ct}if(Wn!=null){var rs=1,pi=0,Oo=0,ar=0,Ze=1,Gs=0,hv=0,ue=0,Ge=1;if(Wn.e00=rs,Wn.e01=pi,Wn.e02=Oo,Wn.e10=ar,Wn.e11=Ze,Wn.e12=Gs,Wn.e20=hv,Wn.e21=ue,Wn.e22=Ge,wi.sizeMat3==wi.stackMat3.length){for(var $n=wi.sizeMat3<<1,Ws=new Array($n),Ti=Ws,Lo=0,Tr=wi.sizeMat3;Lo<Tr;){var sn=Lo++;Ti[sn]=wi.stackMat3[sn],wi.stackMat3[sn]=null}wi.stackMat3=Ti}wi.stackMat3[wi.sizeMat3++]=Wn}if(Qo!=null){var ks=1,Y_=0,We=0,jn=0,Xn=0,os=1,de=0,ns=0,Us=0,l_=0,Be=1,Ae=0,qn=0,mi=0,xo=0,Zr=1;if(Qo.e00=ks,Qo.e01=Y_,Qo.e02=We,Qo.e03=jn,Qo.e10=Xn,Qo.e11=os,Qo.e12=de,Qo.e13=ns,Qo.e20=Us,Qo.e21=l_,Qo.e22=Be,Qo.e23=Ae,Qo.e30=qn,Qo.e31=mi,Qo.e32=xo,Qo.e33=Zr,wi.sizeMat4==wi.stackMat4.length){for(var Ho=wi.sizeMat4<<1,Yo=new Array(Ho),Hr=Yo,Eo=0,ws=wi.sizeMat4;Eo<ws;){var ae=Eo++;Hr[ae]=wi.stackMat4[ae],wi.stackMat4[ae]=null}wi.stackMat4=Hr}wi.stackMat4[wi.sizeMat4++]=Qo}if(to!=null){var Os=0,W_=0,te=0,Nt=1;if(to.x=Os,to.y=W_,to.z=te,to.w=Nt,wi.sizeQuat==wi.stackQuat.length){for(var Kr=wi.sizeQuat<<1,Do=new Array(Kr),Xs=Do,kv=0,i0=wi.sizeQuat;kv<i0;){var U_=kv++;Xs[U_]=wi.stackQuat[U_],wi.stackQuat[U_]=null}wi.stackQuat=Xs}wi.stackQuat[wi.sizeQuat++]=to}var Ht=this.p,Ln=null,Rr=null,Yn=null;if(zi!=null){if(zi.zero(),Ht.sizeVec3==Ht.stackVec3.length){for(var Z_=Ht.sizeVec3<<1,Hs=new Array(Z_),h_=Hs,bo=0,es=Ht.sizeVec3;bo<es;){var ss=bo++;h_[ss]=Ht.stackVec3[ss],Ht.stackVec3[ss]=null}Ht.stackVec3=h_}Ht.stackVec3[Ht.sizeVec3++]=zi}if(Ln!=null){var xe=1,Zi=0,Ko=0,kr=0,Zo=1,Ue=0,cv=0,ze=0,Ks=1;if(Ln.e00=xe,Ln.e01=Zi,Ln.e02=Ko,Ln.e10=kr,Ln.e11=Zo,Ln.e12=Ue,Ln.e20=cv,Ln.e21=ze,Ln.e22=Ks,Ht.sizeMat3==Ht.stackMat3.length){for(var wv=Ht.sizeMat3<<1,Oe=new Array(wv),ei=Oe,Zn=0,_n=Ht.sizeMat3;Zn<_n;){var vn=Zn++;ei[vn]=Ht.stackMat3[vn],Ht.stackMat3[vn]=null}Ht.stackMat3=ei}Ht.stackMat3[Ht.sizeMat3++]=Ln}if(Rr!=null){var d_=1,bv=0,ie=0,Pe=0,c_=0,O_=1,fv=0,uv=0,b_=0,He=0,zo=1,_s=0,vs=0,Ui=0,Mo=0,_o=1;if(Rr.e00=d_,Rr.e01=bv,Rr.e02=ie,Rr.e03=Pe,Rr.e10=c_,Rr.e11=O_,Rr.e12=fv,Rr.e13=uv,Rr.e20=b_,Rr.e21=He,Rr.e22=zo,Rr.e23=_s,Rr.e30=vs,Rr.e31=Ui,Rr.e32=Mo,Rr.e33=_o,Ht.sizeMat4==Ht.stackMat4.length){for(var ls=Ht.sizeMat4<<1,Ls=new Array(ls),Ys=Ls,Zs=0,B_=Ht.sizeMat4;Zs<B_;){var Me=Zs++;Ys[Me]=Ht.stackMat4[Me],Ht.stackMat4[Me]=null}Ht.stackMat4=Ys}Ht.stackMat4[Ht.sizeMat4++]=Rr}if(Yn!=null){var hs=0,H_=0,$s=0,Un=1;if(Yn.x=hs,Yn.y=H_,Yn.z=$s,Yn.w=Un,Ht.sizeQuat==Ht.stackQuat.length){for(var pe=Ht.sizeQuat<<1,Xv=new Array(pe),A_=Xv,$o=0,ln=Ht.sizeQuat;$o<ln;){var po=$o++;A_[po]=Ht.stackQuat[po],Ht.stackQuat[po]=null}Ht.stackQuat=A_}Ht.stackQuat[Ht.sizeQuat++]=Yn}var Kt=this.p,$r=null,vo=null,js=null;if(jt!=null){if(jt.zero(),Kt.sizeVec3==Kt.stackVec3.length){for(var ds=Kt.sizeVec3<<1,qs=new Array(ds),P_=qs,jo=0,re=Kt.sizeVec3;jo<re;){var K_=jo++;P_[K_]=Kt.stackVec3[K_],Kt.stackVec3[K_]=null}Kt.stackVec3=P_}Kt.stackVec3[Kt.sizeVec3++]=jt}if($r!=null){var xv=1,di=0,mo=0,Qr=0,io=1,$_=0,j_=0,Lv=0,a_=1;if($r.e00=xv,$r.e01=di,$r.e02=mo,$r.e10=Qr,$r.e11=io,$r.e12=$_,$r.e20=j_,$r.e21=Lv,$r.e22=a_,Kt.sizeMat3==Kt.stackMat3.length){for(var Yv=Kt.sizeMat3<<1,q_=new Array(Yv),Bi=q_,av=0,Bs=Kt.sizeMat3;av<Bs;){var As=av++;Bi[As]=Kt.stackMat3[As],Kt.stackMat3[As]=null}Kt.stackMat3=Bi}Kt.stackMat3[Kt.sizeMat3++]=$r}if(vo!=null){var cs=1,bs=0,Ps=0,Zv=0,me=0,jr=1,t_=0,yo=0,i_=0,Fo=0,Ss=1,qo=0,ye=0,si=0,an=0,_r=1;if(vo.e00=cs,vo.e01=bs,vo.e02=Ps,vo.e03=Zv,vo.e10=me,vo.e11=jr,vo.e12=t_,vo.e13=yo,vo.e20=i_,vo.e21=Fo,vo.e22=Ss,vo.e23=qo,vo.e30=ye,vo.e31=si,vo.e32=an,vo.e33=_r,Kt.sizeMat4==Kt.stackMat4.length){for(var oe=Kt.sizeMat4<<1,ge=new Array(oe),Bo=ge,Er=0,dn=Kt.sizeMat4;Er<dn;){var tv=Er++;Bo[tv]=Kt.stackMat4[tv],Kt.stackMat4[tv]=null}Kt.stackMat4=Bo}Kt.stackMat4[Kt.sizeMat4++]=vo}if(js!=null){var r_=0,S_=0,iv=0,ne=1;if(js.x=r_,js.y=S_,js.z=iv,js.w=ne,Kt.sizeQuat==Kt.stackQuat.length){for(var Bn=Kt.sizeQuat<<1,Ie=new Array(Bn),E0=Ie,M0=0,hl=Kt.sizeQuat;M0<hl;){var D0=M0++;E0[D0]=Kt.stackQuat[D0],Kt.stackQuat[D0]=null}Kt.stackQuat=E0}Kt.stackQuat[Kt.sizeQuat++]=js}var hr=this.p,On=null,go=null,fs=null;if(Xr!=null){if(Xr.zero(),hr.sizeVec3==hr.stackVec3.length){for(var rv=hr.sizeVec3<<1,zv=new Array(rv),o_=zv,dv=0,Cs=hr.sizeVec3;dv<Cs;){var f_=dv++;o_[f_]=hr.stackVec3[f_],hr.stackVec3[f_]=null}hr.stackVec3=o_}hr.stackVec3[hr.sizeVec3++]=Xr}if(On!=null){var u_=1,Ai=0,Ts=0,lo=0,Se=1,Mv=0,Rs=0,x_=0,ov=1;if(On.e00=u_,On.e01=Ai,On.e02=Ts,On.e10=lo,On.e11=Se,On.e12=Mv,On.e20=Rs,On.e21=x_,On.e22=ov,hr.sizeMat3==hr.stackMat3.length){for(var r0=hr.sizeMat3<<1,o0=new Array(r0),nv=o0,tr=0,Ke=hr.sizeMat3;tr<Ke;){var An=tr++;nv[An]=hr.stackMat3[An],hr.stackMat3[An]=null}hr.stackMat3=nv}hr.stackMat3[hr.sizeMat3++]=On}if(go!=null){var us=1,F0=0,Dv=0,C_=0,p0=0,Bv=1,n0=0,m0=0,N0=0,e0=0,s0=1,y0=0,Fv=0,cr=0,pv=0,hn=1;if(go.e00=us,go.e01=F0,go.e02=Dv,go.e03=C_,go.e10=p0,go.e11=Bv,go.e12=n0,go.e13=m0,go.e20=N0,go.e21=e0,go.e22=s0,go.e23=y0,go.e30=Fv,go.e31=cr,go.e32=pv,go.e33=hn,hr.sizeMat4==hr.stackMat4.length){for(var Nv=hr.sizeMat4<<1,Hl=new Array(Nv),g0=Hl,I0=0,cl=hr.sizeMat4;I0<cl;){var dl=I0++;g0[dl]=hr.stackMat4[dl],hr.stackMat4[dl]=null}hr.stackMat4=g0}hr.stackMat4[hr.sizeMat4++]=go}if(fs!=null){var Jv=0,Kl=0,$l=0,bl=1;if(fs.x=Jv,fs.y=Kl,fs.z=$l,fs.w=bl,hr.sizeQuat==hr.stackQuat.length){for(var Bl=hr.sizeQuat<<1,Al=new Array(Bl),jl=Al,fl=0,ql=hr.sizeQuat;fl<ql;){var ul=fl++;jl[ul]=hr.stackQuat[ul],hr.stackQuat[ul]=null}hr.stackQuat=jl}hr.stackQuat[hr.sizeQuat++]=fs}var rr=this.p,xs=null,tn=null,mv=null;if(no!=null){if(no.zero(),rr.sizeVec3==rr.stackVec3.length){for(var yh=rr.sizeVec3<<1,Gv=new Array(yh),J0=Gv,xl=0,V0=rr.sizeVec3;xl<V0;){var k0=xl++;J0[k0]=rr.stackVec3[k0],rr.stackVec3[k0]=null}rr.stackVec3=J0}rr.stackVec3[rr.sizeVec3++]=no}if(xs!=null){var G0=1,Mr=0,zs=0,ee=0,_0=1,Pl=0,lh=0,W0=0,hh=1;if(xs.e00=G0,xs.e01=Mr,xs.e02=zs,xs.e10=ee,xs.e11=_0,xs.e12=Pl,xs.e20=lh,xs.e21=W0,xs.e22=hh,rr.sizeMat3==rr.stackMat3.length){for(var U0=rr.sizeMat3<<1,Sl=new Array(U0),zl=Sl,Ce=0,w0=rr.sizeMat3;Ce<w0;){var z_=Ce++;zl[z_]=rr.stackMat3[z_],rr.stackMat3[z_]=null}rr.stackMat3=zl}rr.stackMat3[rr.sizeMat3++]=xs}if(tn!=null){var Cl=1,O0=0,H0=0,Tl=0,Ml=0,X0=1,v0=0,M_=0,Wv=0,Uv=0,ev=1,L0=0,Av=0,l0=0,se=0,h0=1;if(tn.e00=Cl,tn.e01=O0,tn.e02=H0,tn.e03=Tl,tn.e10=Ml,tn.e11=X0,tn.e12=v0,tn.e13=M_,tn.e20=Wv,tn.e21=Uv,tn.e22=ev,tn.e23=L0,tn.e30=Av,tn.e31=l0,tn.e32=se,tn.e33=h0,rr.sizeMat4==rr.stackMat4.length){for(var Y0=rr.sizeMat4<<1,Qs=new Array(Y0),K0=Qs,yi=0,cn=rr.sizeMat4;yi<cn;){var wr=yi++;K0[wr]=rr.stackMat4[wr],rr.stackMat4[wr]=null}rr.stackMat4=K0}rr.stackMat4[rr.sizeMat4++]=tn}if(mv!=null){var Ov=0,c0=0,ch=0,ah=1;if(mv.x=Ov,mv.y=c0,mv.z=ch,mv.w=ah,rr.sizeQuat==rr.stackQuat.length){for(var p_=rr.sizeQuat<<1,$e=new Array(p_),Es=$e,th=0,bh=rr.sizeQuat;th<bh;){var Rl=th++;Es[Rl]=rr.stackQuat[Rl],rr.stackQuat[Rl]=null}rr.stackQuat=Es}rr.stackQuat[rr.sizeQuat++]=mv}var br=this.p,n_=null,bn=null,yv=null;if(gr!=null){if(gr.zero(),br.sizeVec3==br.stackVec3.length){for(var $0=br.sizeVec3<<1,gv=new Array($0),pl=gv,ml=0,yl=br.sizeVec3;ml<yl;){var T_=ml++;pl[T_]=br.stackVec3[T_],br.stackVec3[T_]=null}br.stackVec3=pl}br.stackVec3[br.sizeVec3++]=gr}if(n_!=null){var Pv=1,Pn=0,Iv=0,Sv=0,R_=1,_e=0,Q_=0,Cv=0,Hv=1;if(n_.e00=Pv,n_.e01=Pn,n_.e02=Iv,n_.e10=Sv,n_.e11=R_,n_.e12=_e,n_.e20=Q_,n_.e21=Cv,n_.e22=Hv,br.sizeMat3==br.stackMat3.length){for(var or=br.sizeMat3<<1,m_=new Array(or),ve=m_,Gi=0,y_=br.sizeMat3;Gi<y_;){var Sn=Gi++;ve[Sn]=br.stackMat3[Sn],br.stackMat3[Sn]=null}br.stackMat3=ve}br.stackMat3[br.sizeMat3++]=n_}if(bn!=null){var j0=1,b0=0,fh=0,q0=0,al=0,gl=1,Z0=0,uh=0,Il=0,gh=0,ih=1,Vl=0,d0=0,B0=0,kl=0,rh=1;if(bn.e00=j0,bn.e01=b0,bn.e02=fh,bn.e03=q0,bn.e10=al,bn.e11=gl,bn.e12=Z0,bn.e13=uh,bn.e20=Il,bn.e21=gh,bn.e22=ih,bn.e23=Vl,bn.e30=d0,bn.e31=B0,bn.e32=kl,bn.e33=rh,br.sizeMat4==br.stackMat4.length){for(var Kv=br.sizeMat4<<1,Ql=new Array(Kv),$v=Ql,nr=0,g_=br.sizeMat4;nr<g_;){var rn=nr++;$v[rn]=br.stackMat4[rn],br.stackMat4[rn]=null}br.stackMat4=$v}br.stackMat4[br.sizeMat4++]=bn}if(yv!=null){var wl=0,A0=0,oh=0,El=1;if(yv.x=wl,yv.y=A0,yv.z=oh,yv.w=El,br.sizeQuat==br.stackQuat.length){for(var tl=br.sizeQuat<<1,Dl=new Array(tl),P0=Dl,nh=0,eh=br.sizeQuat;nh<eh;){var Fl=nh++;P0[Fl]=br.stackQuat[Fl],br.stackQuat[Fl]=null}br.stackQuat=P0}br.stackQuat[br.sizeQuat++]=yv}}else{for(var Nl=0;Nl<8;){var sv=Nl++,Tv=this.tmpCircleNorms[sv],jv=this.circleCoords[sv];Tv.x=jv.x,Tv.y=jv.y,Tv.z=jv.z;var Ds=Tv,xh=Ds.x*f.e00+Ds.y*f.e01+Ds.z*f.e02,f0=Ds.x*f.e10+Ds.y*f.e11+Ds.z*f.e12,Xl=Ds.x*f.e20+Ds.y*f.e21+Ds.z*f.e22;Ds.x=xh,Ds.y=f0,Ds.z=Xl;var Rv=this.tmpCircleVerts1[sv],qv=this.tmpCircleNorms[sv];Rv.x=qv.x,Rv.y=qv.y,Rv.z=qv.z;var Qv=Rv,u0=Qv.x*t,Zh=Qv.y*t,S0=Qv.z*t;Qv.x=u0,Qv.y=Zh,Qv.z=S0;var a0=Qv,Jl=a0.x+u.x,Gl=a0.y+u.y,zh=a0.z+u.z;a0.x=Jl,a0.y=Gl,a0.z=zh;var Ev=this.tmpCircleVerts2[sv],xr=this.tmpCircleVerts1[sv];Ev.x=xr.x,Ev.y=xr.y,Ev.z=xr.z;var Ve=this.tmpCircleVerts1[sv],le=Ve.x+h.x*i,C0=Ve.y+h.y*i,Wl=Ve.z+h.z*i;Ve.x=le,Ve.y=C0,Ve.z=Wl;var Fs=this.tmpCircleVerts2[sv],x0=-i,Ll=Fs.x+h.x*x0,Ul=Fs.y+h.y*x0,Ol=Fs.z+h.z*x0;Fs.x=Ll,Fs.y=Ul,Fs.z=Ol}for(var Ih=0;Ih<8;){var _v=Ih++,vv=this.tmpCircleVerts1[_v],T0=this.tmpCircleVerts2[_v],I_=this.tmpCircleVerts2[(_v+1)%8],Yl=this.tmpCircleVerts1[(_v+1)%8],Vh=this.tmpCircleNorms[_v],dh=this.tmpCircleNorms[(_v+1)%8];this.rect(vv,T0,I_,Yl,Vh,Vh,dh,dh,r)}}var t0=this.p;if(Ga!=null){if(Ga.zero(),t0.sizeVec3==t0.stackVec3.length){for(var lv=t0.sizeVec3<<1,kh=new Array(lv),Zl=kh,wh=0,Kh=t0.sizeVec3;wh<Kh;){var sh=wh++;Zl[sh]=t0.stackVec3[sh],t0.stackVec3[sh]=null}t0.stackVec3=Zl}t0.stackVec3[t0.sizeVec3++]=Ga}var Ei=this.p;if(et!=null){if(et.zero(),Ei.sizeVec3==Ei.stackVec3.length){for(var e_=Ei.sizeVec3<<1,V_=new Array(e_),_h=V_,Bh=0,Ah=Ei.sizeVec3;Bh<Ah;){var Mh=Bh++;_h[Mh]=Ei.stackVec3[Mh],Ei.stackVec3[Mh]=null}Ei.stackVec3=_h}Ei.stackVec3[Ei.sizeVec3++]=et}var Vv=this.p;if(u!=null){if(u.zero(),Vv.sizeVec3==Vv.stackVec3.length){for(var Rh=Vv.sizeVec3<<1,Qh=new Array(Rh),$h=Qh,jh=0,ph=Vv.sizeVec3;jh<ph;){var Ph=jh++;$h[Ph]=Vv.stackVec3[Ph],Vv.stackVec3[Ph]=null}Vv.stackVec3=$h}Vv.stackVec3[Vv.sizeVec3++]=u}var il=this.p;if(f!=null){var ic=1,Xh=0,E_=0,Eh=0,mh=1,qh=0,Lh=0,ac=0,Sh=1;if(f.e00=ic,f.e01=Xh,f.e02=E_,f.e10=Eh,f.e11=mh,f.e12=qh,f.e20=Lh,f.e21=ac,f.e22=Sh,il.sizeMat3==il.stackMat3.length){for(var R0=il.sizeMat3<<1,rc=new Array(R0),vh=rc,Yh=0,Dh=il.sizeMat3;Yh<Dh;){var Ch=Yh++;vh[Ch]=il.stackMat3[Ch],il.stackMat3[Ch]=null}il.stackMat3=vh}il.stackMat3[il.sizeMat3++]=f}var Q0=this.p;if(s!=null){if(s.zero(),Q0.sizeVec3==Q0.stackVec3.length){for(var z0=Q0.sizeVec3<<1,nc=new Array(z0),ec=nc,Fh=0,oc=Q0.sizeVec3;Fh<oc;){var tc=Fh++;ec[tc]=Q0.stackVec3[tc],Q0.stackVec3[tc]=null}Q0.stackVec3=ec}Q0.stackVec3[Q0.sizeVec3++]=s}var rl=this.p;if(h!=null){if(h.zero(),rl.sizeVec3==rl.stackVec3.length){for(var gc=rl.sizeVec3<<1,Ic=new Array(gc),Mc=Ic,pc=0,Vc=rl.sizeVec3;pc<Vc;){var sc=pc++;Mc[sc]=rl.stackVec3[sc],rl.stackVec3[sc]=null}rl.stackVec3=Mc}rl.stackVec3[rl.sizeVec3++]=h}var Th=this.p;if(e!=null){if(e.zero(),Th.sizeVec3==Th.stackVec3.length){for(var kc=Th.sizeVec3<<1,xc=new Array(kc),mc=xc,yc=0,wc=Th.sizeVec3;yc<wc;){var zc=yc++;mc[zc]=Th.stackVec3[zc],Th.stackVec3[zc]=null}Th.stackVec3=mc}Th.stackVec3[Th.sizeVec3++]=e}}sphere(a,t,i){var r=this.p,o=r.sizeVec3==0?new x.common.Vec3:r.stackVec3[--r.sizeVec3],s=this.p,_=s.sizeMat3==0?new x.common.Mat3:s.stackMat3[--s.sizeMat3],h=o;h.x=a._positionX,h.y=a._positionY,h.z=a._positionZ;var v=_;v.e00=a._rotation00,v.e01=a._rotation01,v.e02=a._rotation02,v.e10=a._rotation10,v.e11=a._rotation11,v.e12=a._rotation12,v.e20=a._rotation20,v.e21=a._rotation21,v.e22=a._rotation22;for(var e=4,l=8,u=this.tmpSphereVerts,b=this.tmpSphereNorms,f=0,n=e+1;f<n;)for(var c=f++,z=this.tmpSphereVerts[c].length,p=0,y=z;p<y;){var V=p++,M=b[c][V],I=this.sphereCoords[c][V];M.x=I.x,M.y=I.y,M.z=I.z;var k=M,X=k.x*_.e00+k.y*_.e01+k.z*_.e02,L=k.x*_.e10+k.y*_.e11+k.z*_.e12,m=k.x*_.e20+k.y*_.e21+k.z*_.e22;k.x=X,k.y=L,k.z=m;var g=u[c][V],N=b[c][V];g.x=N.x,g.y=N.y,g.z=N.z;var A=g,F=A.x*t,P=A.y*t,Y=A.z*t;A.x=F,A.y=P,A.z=Y;var R=A,C=R.x+o.x,d=R.y+o.y,Z=R.z+o.z;R.x=C,R.y=d,R.z=Z}for(var $=0,K=e;$<K;)for(var E=$++,J=0,B=l;J<B;){var Q=J++,U,G,D,H,j,ia,sa,W;E==0?this.wireframe?(U=u[0][0],G=u[1][Q],this.line(U,G,i)):(U=u[0][0],G=u[1][Q],D=u[1][(Q+1)%l],j=b[0][0],ia=b[1][Q],sa=b[1][(Q+1)%l],this.triangle(U,G,D,j,ia,sa,i)):E==e-1?this.wireframe?(U=u[e][0],G=u[E][(Q+1)%l],D=u[E][Q],this.line(U,G,i),this.line(G,D,i)):(U=u[e][0],G=u[E][(Q+1)%l],D=u[E][Q],j=b[e][0],ia=b[E][(Q+1)%l],sa=b[E][Q],this.triangle(U,G,D,j,ia,sa,i)):this.wireframe?(U=u[E][Q],G=u[E][(Q+1)%l],D=u[E+1][Q],this.line(U,G,i),this.line(U,D,i)):(U=u[E][Q],G=u[E][(Q+1)%l],D=u[E+1][Q],H=u[E+1][(Q+1)%l],j=b[E][Q],ia=b[E][(Q+1)%l],sa=b[E+1][Q],W=b[E+1][(Q+1)%l],this.rect(U,D,H,G,j,sa,W,ia,i))}var q=this.p;if(o!=null){if(o.zero(),q.sizeVec3==q.stackVec3.length){for(var na=q.sizeVec3<<1,oa=new Array(na),aa=oa,T=0,ca=q.sizeVec3;T<ca;){var _a=T++;aa[_a]=q.stackVec3[_a],q.stackVec3[_a]=null}q.stackVec3=aa}q.stackVec3[q.sizeVec3++]=o}var w=this.p;if(_!=null){var ta=1,ra=0,la=0,va=0,xa=1,za=0,Ma=0,Xa=0,Za=1;if(_.e00=ta,_.e01=ra,_.e02=la,_.e10=va,_.e11=xa,_.e12=za,_.e20=Ma,_.e21=Xa,_.e22=Za,w.sizeMat3==w.stackMat3.length){for(var fa=w.sizeMat3<<1,ba=new Array(fa),ea=ba,ha=0,ma=w.sizeMat3;ha<ma;){var ya=ha++;ea[ya]=w.stackMat3[ya],w.stackMat3[ya]=null}w.stackMat3=ea}w.stackMat3[w.sizeMat3++]=_}}box(a,t,i){var r=this.p,o=r.sizeVec3==0?new x.common.Vec3:r.stackVec3[--r.sizeVec3],s=this.p,_=s.sizeVec3==0?new x.common.Vec3:s.stackVec3[--s.sizeVec3],h=this.p,v=h.sizeVec3==0?new x.common.Vec3:h.stackVec3[--h.sizeVec3],e=this.p,l=e.sizeVec3==0?new x.common.Vec3:e.stackVec3[--e.sizeVec3],u=this.p,b=u.sizeMat3==0?new x.common.Mat3:u.stackMat3[--u.sizeMat3],f=l;f.x=a._positionX,f.y=a._positionY,f.z=a._positionZ;var n=b;n.e00=a._rotation00,n.e01=a._rotation01,n.e02=a._rotation02,n.e10=a._rotation10,n.e11=a._rotation11,n.e12=a._rotation12,n.e20=a._rotation20,n.e21=a._rotation21,n.e22=a._rotation22,o.init(b.e00,b.e10,b.e20),_.init(b.e01,b.e11,b.e21),v.init(b.e02,b.e12,b.e22);var c=t.x,z=t.y,p=t.z,y=this.p,V=y.sizeVec3==0?new x.common.Vec3:y.stackVec3[--y.sizeVec3];V.x=l.x,V.y=l.y,V.z=l.z;var M=V,I=-c,k=M.x+o.x*I,X=M.y+o.y*I,L=M.z+o.z*I;M.x=k,M.y=X,M.z=L;var m=M,g=-z,N=m.x+_.x*g,A=m.y+_.y*g,F=m.z+_.z*g;m.x=N,m.y=A,m.z=F;var P=m,Y=-p,R=P.x+v.x*Y,C=P.y+v.y*Y,d=P.z+v.z*Y;P.x=R,P.y=C,P.z=d;var Z=P,$=this.p,K=$.sizeVec3==0?new x.common.Vec3:$.stackVec3[--$.sizeVec3];K.x=l.x,K.y=l.y,K.z=l.z;var E=K,J=-c,B=E.x+o.x*J,Q=E.y+o.y*J,U=E.z+o.z*J;E.x=B,E.y=Q,E.z=U;var G=E,D=-z,H=G.x+_.x*D,j=G.y+_.y*D,ia=G.z+_.z*D;G.x=H,G.y=j,G.z=ia;var sa=G,W=sa.x+v.x*p,q=sa.y+v.y*p,na=sa.z+v.z*p;sa.x=W,sa.y=q,sa.z=na;var oa=sa,aa=this.p,T=aa.sizeVec3==0?new x.common.Vec3:aa.stackVec3[--aa.sizeVec3];T.x=l.x,T.y=l.y,T.z=l.z;var ca=T,_a=-c,w=ca.x+o.x*_a,ta=ca.y+o.y*_a,ra=ca.z+o.z*_a;ca.x=w,ca.y=ta,ca.z=ra;var la=ca,va=la.x+_.x*z,xa=la.y+_.y*z,za=la.z+_.z*z;la.x=va,la.y=xa,la.z=za;var Ma=la,Xa=-p,Za=Ma.x+v.x*Xa,fa=Ma.y+v.y*Xa,ba=Ma.z+v.z*Xa;Ma.x=Za,Ma.y=fa,Ma.z=ba;var ea=Ma,ha=this.p,ma=ha.sizeVec3==0?new x.common.Vec3:ha.stackVec3[--ha.sizeVec3];ma.x=l.x,ma.y=l.y,ma.z=l.z;var ya=ma,da=-c,pa=ya.x+o.x*da,Ya=ya.y+o.y*da,Qa=ya.z+o.z*da;ya.x=pa,ya.y=Ya,ya.z=Qa;var ga=ya,ua=ga.x+_.x*z,wa=ga.y+_.y*z,ka=ga.z+_.z*z;ga.x=ua,ga.y=wa,ga.z=ka;var Sa=ga,zt=Sa.x+v.x*p,Ha=Sa.y+v.y*p,Ba=Sa.z+v.z*p;Sa.x=zt,Sa.y=Ha,Sa.z=Ba;var nt=Sa,Ea=this.p,Fa=Ea.sizeVec3==0?new x.common.Vec3:Ea.stackVec3[--Ea.sizeVec3];Fa.x=l.x,Fa.y=l.y,Fa.z=l.z;var Aa=Fa,ft=Aa.x+o.x*c,Wa=Aa.y+o.y*c,Ka=Aa.z+o.z*c;Aa.x=ft,Aa.y=Wa,Aa.z=Ka;var bt=Aa,it=-z,$a=bt.x+_.x*it,_t=bt.y+_.y*it,gt=bt.z+_.z*it;bt.x=$a,bt.y=_t,bt.z=gt;var pt=bt,Ga=-p,rt=pt.x+v.x*Ga,ut=pt.y+v.y*Ga,Da=pt.z+v.z*Ga;pt.x=rt,pt.y=ut,pt.z=Da;var Ta=pt,Na=this.p,Vt=Na.sizeVec3==0?new x.common.Vec3:Na.stackVec3[--Na.sizeVec3];Vt.x=l.x,Vt.y=l.y,Vt.z=l.z;var St=Vt,et=St.x+o.x*c,Xt=St.y+o.y*c,Yt=St.z+o.z*c;St.x=et,St.y=Xt,St.z=Yt;var Mt=St,Ia=-z,O=Mt.x+_.x*Ia,Va=Mt.y+_.y*Ia,lt=Mt.z+_.z*Ia;Mt.x=O,Mt.y=Va,Mt.z=lt;var S=Mt,wt=S.x+v.x*p,Bt=S.y+v.y*p,At=S.z+v.z*p;S.x=wt,S.y=Bt,S.z=At;var yt=S,kt=this.p,mt=kt.sizeVec3==0?new x.common.Vec3:kt.stackVec3[--kt.sizeVec3];mt.x=l.x,mt.y=l.y,mt.z=l.z;var ht=mt,xt=ht.x+o.x*c,Ra=ht.y+o.y*c,st=ht.z+o.z*c;ht.x=xt,ht.y=Ra,ht.z=st;var Ca=ht,vt=Ca.x+_.x*z,qa=Ca.y+_.y*z,at=Ca.z+_.z*z;Ca.x=vt,Ca.y=qa,Ca.z=at;var Oa=Ca,tt=-p,ct=Oa.x+v.x*tt,Pa=Oa.y+v.y*tt,Ja=Oa.z+v.z*tt;Oa.x=ct,Oa.y=Pa,Oa.z=Ja;var ja=Oa,La=this.p,ot=La.sizeVec3==0?new x.common.Vec3:La.stackVec3[--La.sizeVec3];ot.x=l.x,ot.y=l.y,ot.z=l.z;var It=ot,oi=It.x+o.x*c,gi=It.y+o.y*c,ai=It.z+o.z*c;It.x=oi,It.y=gi,It.z=ai;var Ct=It,_i=Ct.x+_.x*z,Et=Ct.y+_.y*z,Pt=Ct.z+_.z*z;Ct.x=_i,Ct.y=Et,Ct.z=Pt;var Jt=Ct,Ki=Jt.x+v.x*p,vi=Jt.y+v.y*p,li=Jt.z+v.z*p;Jt.x=Ki,Jt.y=vi,Jt.z=li;var ti=Jt;if(this.wireframe)this.line(Z,oa,i),this.line(ea,nt,i),this.line(Ta,yt,i),this.line(ja,ti,i),this.line(Z,ea,i),this.line(oa,nt,i),this.line(Ta,ja,i),this.line(yt,ti,i),this.line(Z,Ta,i),this.line(oa,yt,i),this.line(ea,ja,i),this.line(nt,ti,i);else{var Oi=this.p,Xi=Oi.sizeVec3==0?new x.common.Vec3:Oi.stackVec3[--Oi.sizeVec3];Xi.x=o.x,Xi.y=o.y,Xi.z=o.z;var zi=Xi,Zt=-zi.x,ri=-zi.y,Wt=-zi.z;zi.x=Zt,zi.y=ri,zi.z=Wt;var ni=zi,$i=this.p,Ut=$i.sizeVec3==0?new x.common.Vec3:$i.stackVec3[--$i.sizeVec3];Ut.x=_.x,Ut.y=_.y,Ut.z=_.z;var ji=Ut,Ii=-ji.x,pr=-ji.y,Wi=-ji.z;ji.x=Ii,ji.y=pr,ji.z=Wi;var Lt=ji,jt=this.p,Tt=jt.sizeVec3==0?new x.common.Vec3:jt.stackVec3[--jt.sizeVec3];Tt.x=v.x,Tt.y=v.y,Tt.z=v.z;var bi=Tt,Mi=-bi.x,vr=-bi.y,qt=-bi.z;bi.x=Mi,bi.y=vr,bi.z=qt;var fi=bi;this.rect(Z,oa,nt,ea,ni,ni,ni,ni,i),this.rect(Ta,ja,ti,yt,o,o,o,o,i),this.rect(Z,Ta,yt,oa,Lt,Lt,Lt,Lt,i),this.rect(ea,nt,ti,ja,_,_,_,_,i),this.rect(Z,ea,ja,Ta,fi,fi,fi,fi,i),this.rect(oa,yt,ti,nt,v,v,v,v,i);var dt=this.p,ui=null,hi=null,er=null;if(ni!=null){if(ni.zero(),dt.sizeVec3==dt.stackVec3.length){for(var Xr=dt.sizeVec3<<1,ro=new Array(Xr),Gt=ro,fr=0,mr=dt.sizeVec3;fr<mr;){var Dt=fr++;Gt[Dt]=dt.stackVec3[Dt],dt.stackVec3[Dt]=null}dt.stackVec3=Gt}dt.stackVec3[dt.sizeVec3++]=ni}if(ui!=null){var dr=1,Pi=0,Dr=0,Hn=0,oo=1,Br=0,no=0,yn=0,Ao=1;if(ui.e00=dr,ui.e01=Pi,ui.e02=Dr,ui.e10=Hn,ui.e11=oo,ui.e12=Br,ui.e20=no,ui.e21=yn,ui.e22=Ao,dt.sizeMat3==dt.stackMat3.length){for(var Io=dt.sizeMat3<<1,xi=new Array(Io),qr=xi,Ar=0,yr=dt.sizeMat3;Ar<yr;){var Po=Ar++;qr[Po]=dt.stackMat3[Po],dt.stackMat3[Po]=null}dt.stackMat3=qr}dt.stackMat3[dt.sizeMat3++]=ui}if(hi!=null){var Di=1,Pr=0,gr=0,Rt=0,Hi=0,Li=1,Cn=0,Ms=0,je=0,ps=0,Te=1,qe=0,D_=0,gn=0,Si=0,No=1;if(hi.e00=Di,hi.e01=Pr,hi.e02=gr,hi.e03=Rt,hi.e10=Hi,hi.e11=Li,hi.e12=Cn,hi.e13=Ms,hi.e20=je,hi.e21=ps,hi.e22=Te,hi.e23=qe,hi.e30=D_,hi.e31=gn,hi.e32=Si,hi.e33=No,dt.sizeMat4==dt.stackMat4.length){for(var Wr=dt.sizeMat4<<1,ke=new Array(Wr),on=ke,Tn=0,Kn=dt.sizeMat4;Tn<Kn;){var we=Tn++;on[we]=dt.stackMat4[we],dt.stackMat4[we]=null}dt.stackMat4=on}dt.stackMat4[dt.sizeMat4++]=hi}if(er!=null){var k_=0,Re=0,Vi=0,Ir=1;if(er.x=k_,er.y=Re,er.z=Vi,er.w=Ir,dt.sizeQuat==dt.stackQuat.length){for(var ur=dt.sizeQuat<<1,eo=new Array(ur),Rn=eo,ms=0,nn=dt.sizeQuat;ms<nn;){var Qn=ms++;Rn[Qn]=dt.stackQuat[Qn],dt.stackQuat[Qn]=null}dt.stackQuat=Rn}dt.stackQuat[dt.sizeQuat++]=er}var ci=this.p,ho=null,Fr=null,En=null;if(Lt!=null){if(Lt.zero(),ci.sizeVec3==ci.stackVec3.length){for(var as=ci.sizeVec3<<1,Qe=new Array(as),Ee=Qe,De=0,he=ci.sizeVec3;De<he;){var ii=De++;Ee[ii]=ci.stackVec3[ii],ci.stackVec3[ii]=null}ci.stackVec3=Ee}ci.stackVec3[ci.sizeVec3++]=Lt}if(ho!=null){var ir=1,Qi=0,Fi=0,fo=0,So=1,s_=0,Fe=0,ts=0,Dn=1;if(ho.e00=ir,ho.e01=Qi,ho.e02=Fi,ho.e10=fo,ho.e11=So,ho.e12=s_,ho.e20=Fe,ho.e21=ts,ho.e22=Dn,ci.sizeMat3==ci.stackMat3.length){for(var co=ci.sizeMat3<<1,Ft=new Array(co),Ni=Ft,lr=0,Vo=ci.sizeMat3;lr<Vo;){var ce=lr++;Ni[ce]=ci.stackMat3[ce],ci.stackMat3[ce]=null}ci.stackMat3=Ni}ci.stackMat3[ci.sizeMat3++]=ho}if(Fr!=null){var Xe=1,Le=0,uo=0,$t=0,Vr=0,sr=1,Jo=0,Ns=0,Co=0,ko=0,Nr=1,Sr=0,Cr=0,Lr=0,Qt=0,Ji=1;if(Fr.e00=Xe,Fr.e01=Le,Fr.e02=uo,Fr.e03=$t,Fr.e10=Vr,Fr.e11=sr,Fr.e12=Jo,Fr.e13=Ns,Fr.e20=Co,Fr.e21=ko,Fr.e22=Nr,Fr.e23=Sr,Fr.e30=Cr,Fr.e31=Lr,Fr.e32=Qt,Fr.e33=Ji,ci.sizeMat4==ci.stackMat4.length){for(var Yi=ci.sizeMat4<<1,Ri=new Array(Yi),zr=Ri,qi=0,Jr=ci.sizeMat4;qi<Jr;){var Gr=qi++;zr[Gr]=ci.stackMat4[Gr],ci.stackMat4[Gr]=null}ci.stackMat4=zr}ci.stackMat4[ci.sizeMat4++]=Fr}if(En!=null){var ao=0,be=0,ki=0,en=1;if(En.x=ao,En.y=be,En.z=ki,En.w=en,ci.sizeQuat==ci.stackQuat.length){for(var Yr=ci.sizeQuat<<1,Go=new Array(Yr),ys=Go,In=0,gs=ci.sizeQuat;In<gs;){var Vn=In++;ys[Vn]=ci.stackQuat[Vn],ci.stackQuat[Vn]=null}ci.stackQuat=ys}ci.stackQuat[ci.sizeQuat++]=En}var Ci=this.p,To=null,so=null,Fn=null;if(fi!=null){if(fi.zero(),Ci.sizeVec3==Ci.stackVec3.length){for(var Ne=Ci.sizeVec3<<1,Nn=new Array(Ne),Wo=Nn,kn=0,Ye=Ci.sizeVec3;kn<Ye;){var Ot=kn++;Wo[Ot]=Ci.stackVec3[Ot],Ci.stackVec3[Ot]=null}Ci.stackVec3=Wo}Ci.stackVec3[Ci.sizeVec3++]=fi}if(To!=null){var Ro=1,Ur=0,wn=0,Jn=0,fe=1,Is=0,Uo=0,Vs=0,w_=1;if(To.e00=Ro,To.e01=Ur,To.e02=wn,To.e10=Jn,To.e11=fe,To.e12=Is,To.e20=Uo,To.e21=Vs,To.e22=w_,Ci.sizeMat3==Ci.stackMat3.length){for(var Js=Ci.sizeMat3<<1,X_=new Array(Js),Je=X_,F_=0,N_=Ci.sizeMat3;F_<N_;){var Or=F_++;Je[Or]=Ci.stackMat3[Or],Ci.stackMat3[Or]=null}Ci.stackMat3=Je}Ci.stackMat3[Ci.sizeMat3++]=To}if(so!=null){var wo=1,Xo=0,Gn=0,wi=0,Wn=0,Qo=1,to=0,J_=0,G_=0,L_=0,is=1,__=0,v_=0,rs=0,pi=0,Oo=1;if(so.e00=wo,so.e01=Xo,so.e02=Gn,so.e03=wi,so.e10=Wn,so.e11=Qo,so.e12=to,so.e13=J_,so.e20=G_,so.e21=L_,so.e22=is,so.e23=__,so.e30=v_,so.e31=rs,so.e32=pi,so.e33=Oo,Ci.sizeMat4==Ci.stackMat4.length){for(var ar=Ci.sizeMat4<<1,Ze=new Array(ar),Gs=Ze,hv=0,ue=Ci.sizeMat4;hv<ue;){var Ge=hv++;Gs[Ge]=Ci.stackMat4[Ge],Ci.stackMat4[Ge]=null}Ci.stackMat4=Gs}Ci.stackMat4[Ci.sizeMat4++]=so}if(Fn!=null){var $n=0,Ws=0,Ti=0,Lo=1;if(Fn.x=$n,Fn.y=Ws,Fn.z=Ti,Fn.w=Lo,Ci.sizeQuat==Ci.stackQuat.length){for(var Tr=Ci.sizeQuat<<1,sn=new Array(Tr),ks=sn,Y_=0,We=Ci.sizeQuat;Y_<We;){var jn=Y_++;ks[jn]=Ci.stackQuat[jn],Ci.stackQuat[jn]=null}Ci.stackQuat=ks}Ci.stackQuat[Ci.sizeQuat++]=Fn}}var Xn=this.p;if(Z!=null){if(Z.zero(),Xn.sizeVec3==Xn.stackVec3.length){for(var os=Xn.sizeVec3<<1,de=new Array(os),ns=de,Us=0,l_=Xn.sizeVec3;Us<l_;){var Be=Us++;ns[Be]=Xn.stackVec3[Be],Xn.stackVec3[Be]=null}Xn.stackVec3=ns}Xn.stackVec3[Xn.sizeVec3++]=Z}var Ae=this.p;if(oa!=null){if(oa.zero(),Ae.sizeVec3==Ae.stackVec3.length){for(var qn=Ae.sizeVec3<<1,mi=new Array(qn),xo=mi,Zr=0,Ho=Ae.sizeVec3;Zr<Ho;){var Yo=Zr++;xo[Yo]=Ae.stackVec3[Yo],Ae.stackVec3[Yo]=null}Ae.stackVec3=xo}Ae.stackVec3[Ae.sizeVec3++]=oa}var Hr=this.p;if(ea!=null){if(ea.zero(),Hr.sizeVec3==Hr.stackVec3.length){for(var Eo=Hr.sizeVec3<<1,ws=new Array(Eo),ae=ws,Os=0,W_=Hr.sizeVec3;Os<W_;){var te=Os++;ae[te]=Hr.stackVec3[te],Hr.stackVec3[te]=null}Hr.stackVec3=ae}Hr.stackVec3[Hr.sizeVec3++]=ea}var Nt=this.p;if(nt!=null){if(nt.zero(),Nt.sizeVec3==Nt.stackVec3.length){for(var Kr=Nt.sizeVec3<<1,Do=new Array(Kr),Xs=Do,kv=0,i0=Nt.sizeVec3;kv<i0;){var U_=kv++;Xs[U_]=Nt.stackVec3[U_],Nt.stackVec3[U_]=null}Nt.stackVec3=Xs}Nt.stackVec3[Nt.sizeVec3++]=nt}var Ht=this.p;if(Ta!=null){if(Ta.zero(),Ht.sizeVec3==Ht.stackVec3.length){for(var Ln=Ht.sizeVec3<<1,Rr=new Array(Ln),Yn=Rr,Z_=0,Hs=Ht.sizeVec3;Z_<Hs;){var h_=Z_++;Yn[h_]=Ht.stackVec3[h_],Ht.stackVec3[h_]=null}Ht.stackVec3=Yn}Ht.stackVec3[Ht.sizeVec3++]=Ta}var bo=this.p;if(yt!=null){if(yt.zero(),bo.sizeVec3==bo.stackVec3.length){for(var es=bo.sizeVec3<<1,ss=new Array(es),xe=ss,Zi=0,Ko=bo.sizeVec3;Zi<Ko;){var kr=Zi++;xe[kr]=bo.stackVec3[kr],bo.stackVec3[kr]=null}bo.stackVec3=xe}bo.stackVec3[bo.sizeVec3++]=yt}var Zo=this.p;if(ja!=null){if(ja.zero(),Zo.sizeVec3==Zo.stackVec3.length){for(var Ue=Zo.sizeVec3<<1,cv=new Array(Ue),ze=cv,Ks=0,wv=Zo.sizeVec3;Ks<wv;){var Oe=Ks++;ze[Oe]=Zo.stackVec3[Oe],Zo.stackVec3[Oe]=null}Zo.stackVec3=ze}Zo.stackVec3[Zo.sizeVec3++]=ja}var ei=this.p;if(ti!=null){if(ti.zero(),ei.sizeVec3==ei.stackVec3.length){for(var Zn=ei.sizeVec3<<1,_n=new Array(Zn),vn=_n,d_=0,bv=ei.sizeVec3;d_<bv;){var ie=d_++;vn[ie]=ei.stackVec3[ie],ei.stackVec3[ie]=null}ei.stackVec3=vn}ei.stackVec3[ei.sizeVec3++]=ti}var Pe=this.p;if(l!=null){if(l.zero(),Pe.sizeVec3==Pe.stackVec3.length){for(var c_=Pe.sizeVec3<<1,O_=new Array(c_),fv=O_,uv=0,b_=Pe.sizeVec3;uv<b_;){var He=uv++;fv[He]=Pe.stackVec3[He],Pe.stackVec3[He]=null}Pe.stackVec3=fv}Pe.stackVec3[Pe.sizeVec3++]=l}var zo=this.p;if(b!=null){var _s=1,vs=0,Ui=0,Mo=0,_o=1,ls=0,Ls=0,Ys=0,Zs=1;if(b.e00=_s,b.e01=vs,b.e02=Ui,b.e10=Mo,b.e11=_o,b.e12=ls,b.e20=Ls,b.e21=Ys,b.e22=Zs,zo.sizeMat3==zo.stackMat3.length){for(var B_=zo.sizeMat3<<1,Me=new Array(B_),hs=Me,H_=0,$s=zo.sizeMat3;H_<$s;){var Un=H_++;hs[Un]=zo.stackMat3[Un],zo.stackMat3[Un]=null}zo.stackMat3=hs}zo.stackMat3[zo.sizeMat3++]=b}var pe=this.p;if(o!=null){if(o.zero(),pe.sizeVec3==pe.stackVec3.length){for(var Xv=pe.sizeVec3<<1,A_=new Array(Xv),$o=A_,ln=0,po=pe.sizeVec3;ln<po;){var Kt=ln++;$o[Kt]=pe.stackVec3[Kt],pe.stackVec3[Kt]=null}pe.stackVec3=$o}pe.stackVec3[pe.sizeVec3++]=o}var $r=this.p;if(_!=null){if(_.zero(),$r.sizeVec3==$r.stackVec3.length){for(var vo=$r.sizeVec3<<1,js=new Array(vo),ds=js,qs=0,P_=$r.sizeVec3;qs<P_;){var jo=qs++;ds[jo]=$r.stackVec3[jo],$r.stackVec3[jo]=null}$r.stackVec3=ds}$r.stackVec3[$r.sizeVec3++]=_}var re=this.p;if(v!=null){if(v.zero(),re.sizeVec3==re.stackVec3.length){for(var K_=re.sizeVec3<<1,xv=new Array(K_),di=xv,mo=0,Qr=re.sizeVec3;mo<Qr;){var io=mo++;di[io]=re.stackVec3[io],re.stackVec3[io]=null}re.stackVec3=di}re.stackVec3[re.sizeVec3++]=v}}rect(a,t,i,r,o,s,_,h,v){this.triangle(a,t,i,o,s,_,v),this.triangle(a,i,r,o,_,h,v)}point(a,t){}triangle(a,t,i,r,o,s,_){}line(a,t,i){}};x.dynamics.common.DebugDrawStyle=class{constructor(){this.basisColorZ=new x.common.Vec3(0,0,1),this.basisColorY=new x.common.Vec3(0,1,0),this.basisColorX=new x.common.Vec3(1,0,0),this.basisLength=.5,this.jointRotationalConstraintRadius=.3,this.jointErrorColor=new x.common.Vec3(1,.1,.1),this.jointLineColor=new x.common.Vec3(.8,.8,.8),this.contactBinormalLength=.5,this.contactTangentLength=.5,this.contactNormalLength=.5,this.contactBinormalColor=new x.common.Vec3(.2,.2,1),this.contactTangentColor=new x.common.Vec3(.1,.8,.1),this.contactNormalColor=new x.common.Vec3(1,.1,.1),this.disabledContactColor=new x.common.Vec3(.5,.1,.1),this.newContactColor=new x.common.Vec3(1,1,.1),this.contactColor4=new x.common.Vec3(.8,.1,1),this.contactColor3=new x.common.Vec3(.1,.8,.6),this.contactColor2=new x.common.Vec3(1,.6,.1),this.contactColor=new x.common.Vec3(1,.1,.1),this.pairColor=new x.common.Vec3(1,1,.1),this.bvhNodeColor=new x.common.Vec3(.4,.4,.4),this.aabbColor=new x.common.Vec3(1,.1,.1),this.kinematicShapeColor=new x.common.Vec3(1,.5,.1),this.staticShapeColor=new x.common.Vec3(.7,.7,.7),this.sleepingShapeColor2=new x.common.Vec3(.2,.8,.5),this.sleepingShapeColor1=new x.common.Vec3(.3,.3,.8),this.sleepyShapeColor2=new x.common.Vec3(.6,.8,.3),this.sleepyShapeColor1=new x.common.Vec3(.5,.25,.6),this.shapeColor2=new x.common.Vec3(1,.8,.1),this.shapeColor1=new x.common.Vec3(.7,.2,.4)}};x.dynamics.common.Performance=class{};x.dynamics.constraint||(x.dynamics.constraint={});x.dynamics.constraint.ConstraintSolver=class{constructor(){this._b1=null,this._b2=null,this._addedToIsland=!1}preSolveVelocity(a){}warmStart(a){}solveVelocity(){}postSolveVelocity(a){}preSolvePosition(a){}solvePositionSplitImpulse(){}solvePositionNgs(a){}postSolve(){}};x.dynamics.constraint.PositionCorrectionAlgorithm=class{};x.dynamics.constraint.contact||(x.dynamics.constraint.contact={});x.dynamics.constraint.contact.ContactConstraint=class{constructor(a){this._solver=new x.dynamics.constraint.solver.pgs.PgsContactConstraintSolver(this),this._manifold=a}_getVelocitySolverInfo(a,t){t.b1=this._b1,t.b2=this._b2;var i,r,o,s,_,h,v,e,l;i=this._manifold._normalX,r=this._manifold._normalY,o=this._manifold._normalZ,s=this._manifold._tangentX,_=this._manifold._tangentY,h=this._manifold._tangentZ,v=this._manifold._binormalX,e=this._manifold._binormalY,l=this._manifold._binormalZ;var u=Math.sqrt(this._s1._friction*this._s2._friction),b=Math.sqrt(this._s1._restitution*this._s2._restitution),f=this._manifold._numPoints;t.numRows=0,this._tf1._positionX-this._tf2._positionX,this._tf1._positionY-this._tf2._positionY,this._tf1._positionZ-this._tf2._positionZ;for(var n=0,c=f;n<c;){var z=n++,p=this._manifold._points[z];if(p._depth<0){p._disabled=!0;var y=p._impulse;y.impulseN=0,y.impulseT=0,y.impulseB=0,y.impulseP=0,y.impulseLX=0,y.impulseLY=0,y.impulseLZ=0;continue}else p._disabled=!1;var V=t.rows[t.numRows++];V.friction=u,V.cfm=0;var M=V.jacobianN;M.lin1X=i,M.lin1Y=r,M.lin1Z=o,M.lin2X=i,M.lin2Y=r,M.lin2Z=o,M.ang1X=p._relPos1Y*o-p._relPos1Z*r,M.ang1Y=p._relPos1Z*i-p._relPos1X*o,M.ang1Z=p._relPos1X*r-p._relPos1Y*i,M.ang2X=p._relPos2Y*o-p._relPos2Z*r,M.ang2Y=p._relPos2Z*i-p._relPos2X*o,M.ang2Z=p._relPos2X*r-p._relPos2Y*i,M=V.jacobianT,M.lin1X=s,M.lin1Y=_,M.lin1Z=h,M.lin2X=s,M.lin2Y=_,M.lin2Z=h,M.ang1X=p._relPos1Y*h-p._relPos1Z*_,M.ang1Y=p._relPos1Z*s-p._relPos1X*h,M.ang1Z=p._relPos1X*_-p._relPos1Y*s,M.ang2X=p._relPos2Y*h-p._relPos2Z*_,M.ang2Y=p._relPos2Z*s-p._relPos2X*h,M.ang2Z=p._relPos2X*_-p._relPos2Y*s,M=V.jacobianB,M.lin1X=v,M.lin1Y=e,M.lin1Z=l,M.lin2X=v,M.lin2Y=e,M.lin2Z=l,M.ang1X=p._relPos1Y*l-p._relPos1Z*e,M.ang1Y=p._relPos1Z*v-p._relPos1X*l,M.ang1Z=p._relPos1X*e-p._relPos1Y*v,M.ang2X=p._relPos2Y*l-p._relPos2Z*e,M.ang2Y=p._relPos2Z*v-p._relPos2X*l,M.ang2Z=p._relPos2X*e-p._relPos2Y*v,M=V.jacobianN;var I=M.lin1X*this._b1._velX+M.lin1Y*this._b1._velY+M.lin1Z*this._b1._velZ+(M.ang1X*this._b1._angVelX+M.ang1Y*this._b1._angVelY+M.ang1Z*this._b1._angVelZ)-(M.lin2X*this._b2._velX+M.lin2Y*this._b2._velY+M.lin2Z*this._b2._velZ+(M.ang2X*this._b2._angVelX+M.ang2Y*this._b2._angVelY+M.ang2Z*this._b2._angVelZ));if(I<-x.common.Setting.contactEnableBounceThreshold&&!p._warmStarted?V.rhs=-I*b:V.rhs=0,this._positionCorrectionAlgorithm==x.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE&&p._depth>x.common.Setting.linearSlop){var k=(p._depth-x.common.Setting.linearSlop)*x.common.Setting.velocityBaumgarte*a.invDt;V.rhs<k&&(V.rhs=k)}if(!p._warmStarted){var X=p._impulse;X.impulseN=0,X.impulseT=0,X.impulseB=0,X.impulseP=0,X.impulseLX=0,X.impulseLY=0,X.impulseLZ=0}V.impulse=p._impulse}}_getPositionSolverInfo(a){a.b1=this._b1,a.b2=this._b2;var t,i,r;t=this._manifold._normalX,i=this._manifold._normalY,r=this._manifold._normalZ;var o=this._manifold._numPoints;a.numRows=0;for(var s=0,_=o;s<_;){var h=s++,v=this._manifold._points[h];if(!v._disabled){var e=a.rows[a.numRows++],l=e.jacobianN;l.lin1X=t,l.lin1Y=i,l.lin1Z=r,l.lin2X=t,l.lin2Y=i,l.lin2Z=r,l.ang1X=v._relPos1Y*r-v._relPos1Z*i,l.ang1Y=v._relPos1Z*t-v._relPos1X*r,l.ang1Z=v._relPos1X*i-v._relPos1Y*t,l.ang2X=v._relPos2Y*r-v._relPos2Z*i,l.ang2Y=v._relPos2Z*t-v._relPos2X*r,l.ang2Z=v._relPos2X*i-v._relPos2Y*t,e.rhs=v._depth-x.common.Setting.linearSlop,e.rhs<0&&(e.rhs=0),e.impulse=v._impulse}}}_syncManifold(){this._manifold._updateDepthsAndPositions(this._tf1,this._tf2)}getShape1(){return this._s1}getShape2(){return this._s2}getManifold(){return this._manifold}isTouching(){for(var a=0,t=this._manifold._numPoints;a<t;){var i=a++;if(this._manifold._points[i]._depth>=0)return!0}return!1}};x.dynamics.constraint.contact.ContactImpulse=class{constructor(){this.impulseN=0,this.impulseT=0,this.impulseB=0,this.impulseP=0,this.impulseLX=0,this.impulseLY=0,this.impulseLZ=0}copyFrom(a){this.impulseN=a.impulseN,this.impulseT=a.impulseT,this.impulseB=a.impulseB,this.impulseLX=a.impulseLX,this.impulseLY=a.impulseLY,this.impulseLZ=a.impulseLZ}};x.dynamics.constraint.contact.Manifold=class{constructor(){this._normalX=0,this._normalY=0,this._normalZ=0,this._tangentX=0,this._tangentY=0,this._tangentZ=0,this._binormalX=0,this._binormalY=0,this._binormalZ=0,this._numPoints=0;var a=new Array(x.common.Setting.maxManifoldPoints);this._points=a;for(var t=0,i=x.common.Setting.maxManifoldPoints;t<i;){var r=t++;this._points[r]=new x.dynamics.constraint.contact.ManifoldPoint}}_clear(){for(var a=0,t=this._numPoints;a<t;){var i=a++,r=this._points[i];r._localPos1X=0,r._localPos1Y=0,r._localPos1Z=0,r._localPos2X=0,r._localPos2Y=0,r._localPos2Z=0,r._relPos1X=0,r._relPos1Y=0,r._relPos1Z=0,r._relPos2X=0,r._relPos2Y=0,r._relPos2Z=0,r._pos1X=0,r._pos1Y=0,r._pos1Z=0,r._pos2X=0,r._pos2Y=0,r._pos2Z=0,r._depth=0;var o=r._impulse;o.impulseN=0,o.impulseT=0,o.impulseB=0,o.impulseP=0,o.impulseLX=0,o.impulseLY=0,o.impulseLZ=0,r._warmStarted=!1,r._disabled=!1,r._id=-1}this._numPoints=0}_buildBasis(a){var t=a;this._normalX=t.x,this._normalY=t.y,this._normalZ=t.z;var i=a.x,r=a.y,o=a.z,s=i*i,_=r*r,h=o*o,v,e,l,u,b,f;if(s<_)if(s<h){var n=1/Math.sqrt(_+h);v=0,e=-o*n,l=r*n,u=r*l-o*e,b=-i*l,f=i*e}else{var c=1/Math.sqrt(s+_);v=-r*c,e=i*c,l=0,u=-o*e,b=o*v,f=i*e-r*v}else if(_<h){var z=1/Math.sqrt(s+h);v=o*z,e=0,l=-i*z,u=r*l,b=o*v-i*l,f=-r*v}else{var p=1/Math.sqrt(s+_);v=-r*p,e=i*p,l=0,u=-o*e,b=o*v,f=i*e-r*v}this._tangentX=v,this._tangentY=e,this._tangentZ=l,this._binormalX=u,this._binormalY=b,this._binormalZ=f}_updateDepthsAndPositions(a,t){for(var i=0,r=this._numPoints;i<r;){var o=i++,s=this._points[o],_,h,v;_=a._rotation00*s._localPos1X+a._rotation01*s._localPos1Y+a._rotation02*s._localPos1Z,h=a._rotation10*s._localPos1X+a._rotation11*s._localPos1Y+a._rotation12*s._localPos1Z,v=a._rotation20*s._localPos1X+a._rotation21*s._localPos1Y+a._rotation22*s._localPos1Z,s._relPos1X=_,s._relPos1Y=h,s._relPos1Z=v;var e,l,u;e=t._rotation00*s._localPos2X+t._rotation01*s._localPos2Y+t._rotation02*s._localPos2Z,l=t._rotation10*s._localPos2X+t._rotation11*s._localPos2Y+t._rotation12*s._localPos2Z,u=t._rotation20*s._localPos2X+t._rotation21*s._localPos2Y+t._rotation22*s._localPos2Z,s._relPos2X=e,s._relPos2Y=l,s._relPos2Z=u,s._pos1X=s._relPos1X+a._positionX,s._pos1Y=s._relPos1Y+a._positionY,s._pos1Z=s._relPos1Z+a._positionZ,s._pos2X=s._relPos2X+t._positionX,s._pos2Y=s._relPos2Y+t._positionY,s._pos2Z=s._relPos2Z+t._positionZ;var b,f,n;b=s._pos1X-s._pos2X,f=s._pos1Y-s._pos2Y,n=s._pos1Z-s._pos2Z;var c=b*this._normalX+f*this._normalY+n*this._normalZ;s._depth=-c}}getNormal(){var a=new x.common.Vec3,t=a;return t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ,a}getNormalTo(a){var t=a;t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ}getTangent(){var a=new x.common.Vec3,t=a;return t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ,a}getTangentTo(a){var t=a;t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ}getBinormal(){var a=new x.common.Vec3,t=a;return t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ,a}getBinormalTo(a){var t=a;t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ}getPoints(){return this._points}getNumPoints(){return this._numPoints}};x.dynamics.constraint.contact.ManifoldPoint=class{constructor(){this._localPos1X=0,this._localPos1Y=0,this._localPos1Z=0,this._localPos2X=0,this._localPos2Y=0,this._localPos2Z=0,this._relPos1X=0,this._relPos1Y=0,this._relPos1Z=0,this._relPos2X=0,this._relPos2Y=0,this._relPos2Z=0,this._pos1X=0,this._pos1Y=0,this._pos1Z=0,this._pos2X=0,this._pos2Y=0,this._pos2Z=0,this._depth=0,this._impulse=new x.dynamics.constraint.contact.ContactImpulse,this._warmStarted=!1,this._disabled=!1,this._id=-1}getPosition1(){var a=new x.common.Vec3,t=a;return t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z,a}getPosition1To(a){var t=a;t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z}getPosition2(){var a=new x.common.Vec3,t=a;return t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z,a}getPosition2To(a){var t=a;t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z}getDepth(){return this._depth}isWarmStarted(){return this._warmStarted}getNormalImpulse(){return this._impulse.impulseN}getTangentImpulse(){return this._impulse.impulseT}getBinormalImpulse(){return this._impulse.impulseB}isEnabled(){return!this._disabled}};x.dynamics.constraint.contact.ManifoldUpdater=class{constructor(a){this._manifold=a,this.numOldPoints=0;var t=new Array(x.common.Setting.maxManifoldPoints);this.oldPoints=t;for(var i=0,r=x.common.Setting.maxManifoldPoints;i<r;){var o=i++;this.oldPoints[o]=new x.dynamics.constraint.contact.ManifoldPoint}}removeOutdatedPoints(){for(var a=this._manifold._numPoints,t=a;--t>=0;){var i=this._manifold._points[t],r,o,s;r=i._pos1X-i._pos2X,o=i._pos1Y-i._pos2Y,s=i._pos1Z-i._pos2Z;var _=this._manifold._normalX*r+this._manifold._normalY*o+this._manifold._normalZ*s;if(_>x.common.Setting.contactPersistenceThreshold){this.removeManifoldPoint(t);continue}if(r+=this._manifold._normalX*-_,o+=this._manifold._normalY*-_,s+=this._manifold._normalZ*-_,r*r+o*o+s*s>x.common.Setting.contactPersistenceThreshold*x.common.Setting.contactPersistenceThreshold){this.removeManifoldPoint(t);continue}}}removeManifoldPoint(a){var t=--this._manifold._numPoints;if(a!=t){var i=this._manifold._points[a];this._manifold._points[a]=this._manifold._points[t],this._manifold._points[t]=i}var r=this._manifold._points[t];r._localPos1X=0,r._localPos1Y=0,r._localPos1Z=0,r._localPos2X=0,r._localPos2Y=0,r._localPos2Z=0,r._relPos1X=0,r._relPos1Y=0,r._relPos1Z=0,r._relPos2X=0,r._relPos2Y=0,r._relPos2Z=0,r._pos1X=0,r._pos1Y=0,r._pos1Z=0,r._pos2X=0,r._pos2Y=0,r._pos2Z=0,r._depth=0;var o=r._impulse;o.impulseN=0,o.impulseT=0,o.impulseB=0,o.impulseP=0,o.impulseLX=0,o.impulseLY=0,o.impulseLZ=0,r._warmStarted=!1,r._disabled=!1,r._id=-1}addManifoldPoint(a,t,i){var r=this._manifold._numPoints;if(r==x.common.Setting.maxManifoldPoints){var o=this.computeTargetIndex(a,t,i),s=this._manifold._points[o],_=a.position1;s._pos1X=_.x,s._pos1Y=_.y,s._pos1Z=_.z;var h=a.position2;s._pos2X=h.x,s._pos2Y=h.y,s._pos2Z=h.z,s._relPos1X=s._pos1X-t._positionX,s._relPos1Y=s._pos1Y-t._positionY,s._relPos1Z=s._pos1Z-t._positionZ,s._relPos2X=s._pos2X-i._positionX,s._relPos2Y=s._pos2Y-i._positionY,s._relPos2Z=s._pos2Z-i._positionZ;var v,e,l;v=t._rotation00*s._relPos1X+t._rotation10*s._relPos1Y+t._rotation20*s._relPos1Z,e=t._rotation01*s._relPos1X+t._rotation11*s._relPos1Y+t._rotation21*s._relPos1Z,l=t._rotation02*s._relPos1X+t._rotation12*s._relPos1Y+t._rotation22*s._relPos1Z,s._localPos1X=v,s._localPos1Y=e,s._localPos1Z=l;var u,b,f;u=i._rotation00*s._relPos2X+i._rotation10*s._relPos2Y+i._rotation20*s._relPos2Z,b=i._rotation01*s._relPos2X+i._rotation11*s._relPos2Y+i._rotation21*s._relPos2Z,f=i._rotation02*s._relPos2X+i._rotation12*s._relPos2Y+i._rotation22*s._relPos2Z,s._localPos2X=u,s._localPos2Y=b,s._localPos2Z=f,s._depth=a.depth;var n=s._impulse;n.impulseN=0,n.impulseT=0,n.impulseB=0,n.impulseP=0,n.impulseLX=0,n.impulseLY=0,n.impulseLZ=0,s._id=a.id,s._warmStarted=!1,s._disabled=!1;return}var c=this._manifold._points[r],z=a.position1;c._pos1X=z.x,c._pos1Y=z.y,c._pos1Z=z.z;var p=a.position2;c._pos2X=p.x,c._pos2Y=p.y,c._pos2Z=p.z,c._relPos1X=c._pos1X-t._positionX,c._relPos1Y=c._pos1Y-t._positionY,c._relPos1Z=c._pos1Z-t._positionZ,c._relPos2X=c._pos2X-i._positionX,c._relPos2Y=c._pos2Y-i._positionY,c._relPos2Z=c._pos2Z-i._positionZ;var y,V,M;y=t._rotation00*c._relPos1X+t._rotation10*c._relPos1Y+t._rotation20*c._relPos1Z,V=t._rotation01*c._relPos1X+t._rotation11*c._relPos1Y+t._rotation21*c._relPos1Z,M=t._rotation02*c._relPos1X+t._rotation12*c._relPos1Y+t._rotation22*c._relPos1Z,c._localPos1X=y,c._localPos1Y=V,c._localPos1Z=M;var I,k,X;I=i._rotation00*c._relPos2X+i._rotation10*c._relPos2Y+i._rotation20*c._relPos2Z,k=i._rotation01*c._relPos2X+i._rotation11*c._relPos2Y+i._rotation21*c._relPos2Z,X=i._rotation02*c._relPos2X+i._rotation12*c._relPos2Y+i._rotation22*c._relPos2Z,c._localPos2X=I,c._localPos2Y=k,c._localPos2Z=X,c._depth=a.depth;var L=c._impulse;L.impulseN=0,L.impulseT=0,L.impulseB=0,L.impulseP=0,L.impulseLX=0,L.impulseLY=0,L.impulseLZ=0,c._id=a.id,c._warmStarted=!1,c._disabled=!1,this._manifold._numPoints++}computeTargetIndex(a,t,i){var r=this._manifold._points[0],o=this._manifold._points[1],s=this._manifold._points[2],_=this._manifold._points[3],h=r._depth,v=0;o._depth>h&&(h=o._depth,v=1),s._depth>h&&(h=s._depth,v=2),_._depth>h&&(h=_._depth,v=3);var e,l,u,b=a.position1;e=b.x,l=b.y,u=b.z,e-=t._positionX,l-=t._positionY,u-=t._positionZ;var f=o._relPos1X,n=o._relPos1Y,c=o._relPos1Z,z=s._relPos1X,p=s._relPos1Y,y=s._relPos1Z,V=_._relPos1X,M=_._relPos1Y,I=_._relPos1Z,k,X,L,m,g,N,A,F,P,Y,R,C,d,Z,$,K,E,J;k=z-f,X=p-n,L=y-c,m=e-V,g=l-M,N=u-I,A=V-f,F=M-n,P=I-c,Y=e-z,R=l-p,C=u-y,d=e-f,Z=l-n,$=u-c,K=V-z,E=M-p,J=I-y;var B,Q,U,G,D,H,j,ia,sa;B=X*N-L*g,Q=L*m-k*N,U=k*g-X*m,G=F*C-P*R,D=P*Y-A*C,H=A*R-F*Y,j=Z*J-$*E,ia=$*K-d*J,sa=d*E-Z*K;var W=B*B+Q*Q+U*U,q=G*G+D*D+H*H,na=j*j+ia*ia+sa*sa,oa=W>q?W>na?W:na:q>na?q:na,aa=r._relPos1X,T=r._relPos1Y,ca=r._relPos1Z,_a=s._relPos1X,w=s._relPos1Y,ta=s._relPos1Z,ra=_._relPos1X,la=_._relPos1Y,va=_._relPos1Z,xa,za,Ma,Xa,Za,fa,ba,ea,ha,ma,ya,da,pa,Ya,Qa,ga,ua,wa;xa=_a-aa,za=w-T,Ma=ta-ca,Xa=e-ra,Za=l-la,fa=u-va,ba=ra-aa,ea=la-T,ha=va-ca,ma=e-_a,ya=l-w,da=u-ta,pa=e-aa,Ya=l-T,Qa=u-ca,ga=ra-_a,ua=la-w,wa=va-ta;var ka,Sa,zt,Ha,Ba,nt,Ea,Fa,Aa;ka=za*fa-Ma*Za,Sa=Ma*Xa-xa*fa,zt=xa*Za-za*Xa,Ha=ea*da-ha*ya,Ba=ha*ma-ba*da,nt=ba*ya-ea*ma,Ea=Ya*wa-Qa*ua,Fa=Qa*ga-pa*wa,Aa=pa*ua-Ya*ga;var ft=ka*ka+Sa*Sa+zt*zt,Wa=Ha*Ha+Ba*Ba+nt*nt,Ka=Ea*Ea+Fa*Fa+Aa*Aa,bt=ft>Wa?ft>Ka?ft:Ka:Wa>Ka?Wa:Ka,it=r._relPos1X,$a=r._relPos1Y,_t=r._relPos1Z,gt=o._relPos1X,pt=o._relPos1Y,Ga=o._relPos1Z,rt=_._relPos1X,ut=_._relPos1Y,Da=_._relPos1Z,Ta,Na,Vt,St,et,Xt,Yt,Mt,Ia,O,Va,lt,S,wt,Bt,At,yt,kt;Ta=gt-it,Na=pt-$a,Vt=Ga-_t,St=e-rt,et=l-ut,Xt=u-Da,Yt=rt-it,Mt=ut-$a,Ia=Da-_t,O=e-gt,Va=l-pt,lt=u-Ga,S=e-it,wt=l-$a,Bt=u-_t,At=rt-gt,yt=ut-pt,kt=Da-Ga;var mt,ht,xt,Ra,st,Ca,vt,qa,at;mt=Na*Xt-Vt*et,ht=Vt*St-Ta*Xt,xt=Ta*et-Na*St,Ra=Mt*lt-Ia*Va,st=Ia*O-Yt*lt,Ca=Yt*Va-Mt*O,vt=wt*kt-Bt*yt,qa=Bt*At-S*kt,at=S*yt-wt*At;var Oa=mt*mt+ht*ht+xt*xt,tt=Ra*Ra+st*st+Ca*Ca,ct=vt*vt+qa*qa+at*at,Pa=Oa>tt?Oa>ct?Oa:ct:tt>ct?tt:ct,Ja=r._relPos1X,ja=r._relPos1Y,La=r._relPos1Z,ot=o._relPos1X,It=o._relPos1Y,oi=o._relPos1Z,gi=s._relPos1X,ai=s._relPos1Y,Ct=s._relPos1Z,_i,Et,Pt,Jt,Ki,vi,li,ti,Oi,Xi,zi,Zt,ri,Wt,ni,$i,Ut,ji;_i=ot-Ja,Et=It-ja,Pt=oi-La,Jt=e-gi,Ki=l-ai,vi=u-Ct,li=gi-Ja,ti=ai-ja,Oi=Ct-La,Xi=e-ot,zi=l-It,Zt=u-oi,ri=e-Ja,Wt=l-ja,ni=u-La,$i=gi-ot,Ut=ai-It,ji=Ct-oi;var Ii,pr,Wi,Lt,jt,Tt,bi,Mi,vr;Ii=Et*vi-Pt*Ki,pr=Pt*Jt-_i*vi,Wi=_i*Ki-Et*Jt,Lt=ti*Zt-Oi*zi,jt=Oi*Xi-li*Zt,Tt=li*zi-ti*Xi,bi=Wt*ji-ni*Ut,Mi=ni*$i-ri*ji,vr=ri*Ut-Wt*$i;var qt=Ii*Ii+pr*pr+Wi*Wi,fi=Lt*Lt+jt*jt+Tt*Tt,dt=bi*bi+Mi*Mi+vr*vr,ui=qt>fi?qt>dt?qt:dt:fi>dt?fi:dt,hi=oa,er=0;return(bt>hi&&v!=1||v==0)&&(hi=bt,er=1),Pa>hi&&v!=2&&(hi=Pa,er=2),ui>hi&&v!=3&&(hi=ui,er=3),er}computeRelativePositions(a,t){for(var i=this._manifold._numPoints,r=0,o=i;r<o;){var s=r++,_=this._manifold._points[s],h,v,e;h=a._rotation00*_._localPos1X+a._rotation01*_._localPos1Y+a._rotation02*_._localPos1Z,v=a._rotation10*_._localPos1X+a._rotation11*_._localPos1Y+a._rotation12*_._localPos1Z,e=a._rotation20*_._localPos1X+a._rotation21*_._localPos1Y+a._rotation22*_._localPos1Z,_._relPos1X=h,_._relPos1Y=v,_._relPos1Z=e;var l,u,b;l=t._rotation00*_._localPos2X+t._rotation01*_._localPos2Y+t._rotation02*_._localPos2Z,u=t._rotation10*_._localPos2X+t._rotation11*_._localPos2Y+t._rotation12*_._localPos2Z,b=t._rotation20*_._localPos2X+t._rotation21*_._localPos2Y+t._rotation22*_._localPos2Z,_._relPos2X=l,_._relPos2Y=u,_._relPos2Z=b,_._warmStarted=!0}}findNearestContactPointIndex(a,t,i){for(var r=x.common.Setting.contactPersistenceThreshold*x.common.Setting.contactPersistenceThreshold,o=-1,s=0,_=this._manifold._numPoints;s<_;){var h=s++,v=this._manifold._points[h],e,l,u,b,f,n,c=a.position1;e=c.x,l=c.y,u=c.z;var z=a.position2;b=z.x,f=z.y,n=z.z,e-=t._positionX,l-=t._positionY,u-=t._positionZ,b-=i._positionX,f-=i._positionY,n-=i._positionZ;var p,y,V,M,I,k;p=v._relPos1X-e,y=v._relPos1Y-l,V=v._relPos1Z-u,M=v._relPos2X-b,I=v._relPos2Y-f,k=v._relPos2Z-n;var X=p*p+y*y+V*V,L=M*M+I*I+k*k,m=X<L?X:L;m<r&&(r=m,o=h)}return o}totalUpdate(a,t,i){this.numOldPoints=this._manifold._numPoints;for(var r=0,o=this.numOldPoints;r<o;){var s=r++,_=this.oldPoints[s],h=this._manifold._points[s];_._localPos1X=h._localPos1X,_._localPos1Y=h._localPos1Y,_._localPos1Z=h._localPos1Z,_._localPos2X=h._localPos2X,_._localPos2Y=h._localPos2Y,_._localPos2Z=h._localPos2Z,_._relPos1X=h._relPos1X,_._relPos1Y=h._relPos1Y,_._relPos1Z=h._relPos1Z,_._relPos2X=h._relPos2X,_._relPos2Y=h._relPos2Y,_._relPos2Z=h._relPos2Z,_._pos1X=h._pos1X,_._pos1Y=h._pos1Y,_._pos1Z=h._pos1Z,_._pos2X=h._pos2X,_._pos2Y=h._pos2Y,_._pos2Z=h._pos2Z,_._depth=h._depth,_._impulse.copyFrom(h._impulse),_._id=h._id,_._warmStarted=h._warmStarted,_._disabled=!1}var v=a.numPoints;this._manifold._numPoints=v;for(var e=0,l=v;e<l;){var u=e++,b=this._manifold._points[u],f=a.points[u],n=f.position1;b._pos1X=n.x,b._pos1Y=n.y,b._pos1Z=n.z;var c=f.position2;b._pos2X=c.x,b._pos2Y=c.y,b._pos2Z=c.z,b._relPos1X=b._pos1X-t._positionX,b._relPos1Y=b._pos1Y-t._positionY,b._relPos1Z=b._pos1Z-t._positionZ,b._relPos2X=b._pos2X-i._positionX,b._relPos2Y=b._pos2Y-i._positionY,b._relPos2Z=b._pos2Z-i._positionZ;var z,p,y;z=t._rotation00*b._relPos1X+t._rotation10*b._relPos1Y+t._rotation20*b._relPos1Z,p=t._rotation01*b._relPos1X+t._rotation11*b._relPos1Y+t._rotation21*b._relPos1Z,y=t._rotation02*b._relPos1X+t._rotation12*b._relPos1Y+t._rotation22*b._relPos1Z,b._localPos1X=z,b._localPos1Y=p,b._localPos1Z=y;var V,M,I;V=i._rotation00*b._relPos2X+i._rotation10*b._relPos2Y+i._rotation20*b._relPos2Z,M=i._rotation01*b._relPos2X+i._rotation11*b._relPos2Y+i._rotation21*b._relPos2Z,I=i._rotation02*b._relPos2X+i._rotation12*b._relPos2Y+i._rotation22*b._relPos2Z,b._localPos2X=V,b._localPos2Y=M,b._localPos2Z=I,b._depth=f.depth;var k=b._impulse;k.impulseN=0,k.impulseT=0,k.impulseB=0,k.impulseP=0,k.impulseLX=0,k.impulseLY=0,k.impulseLZ=0,b._id=f.id,b._warmStarted=!1,b._disabled=!1;for(var X=0,L=this.numOldPoints;X<L;){var m=X++,g=this.oldPoints[m];if(b._id==g._id){b._impulse.copyFrom(g._impulse),b._warmStarted=!0;break}}}}incrementalUpdate(a,t,i){this._manifold._updateDepthsAndPositions(t,i);for(var r=0,o=this._manifold._numPoints;r<o;){var s=r++;this._manifold._points[s]._warmStarted=!0}var _=a.points[0],h=this.findNearestContactPointIndex(_,t,i);if(h==-1)this.addManifoldPoint(_,t,i);else{var v=this._manifold._points[h],e=_.position1;v._pos1X=e.x,v._pos1Y=e.y,v._pos1Z=e.z;var l=_.position2;v._pos2X=l.x,v._pos2Y=l.y,v._pos2Z=l.z,v._relPos1X=v._pos1X-t._positionX,v._relPos1Y=v._pos1Y-t._positionY,v._relPos1Z=v._pos1Z-t._positionZ,v._relPos2X=v._pos2X-i._positionX,v._relPos2Y=v._pos2Y-i._positionY,v._relPos2Z=v._pos2Z-i._positionZ;var u,b,f;u=t._rotation00*v._relPos1X+t._rotation10*v._relPos1Y+t._rotation20*v._relPos1Z,b=t._rotation01*v._relPos1X+t._rotation11*v._relPos1Y+t._rotation21*v._relPos1Z,f=t._rotation02*v._relPos1X+t._rotation12*v._relPos1Y+t._rotation22*v._relPos1Z,v._localPos1X=u,v._localPos1Y=b,v._localPos1Z=f;var n,c,z;n=i._rotation00*v._relPos2X+i._rotation10*v._relPos2Y+i._rotation20*v._relPos2Z,c=i._rotation01*v._relPos2X+i._rotation11*v._relPos2Y+i._rotation21*v._relPos2Z,z=i._rotation02*v._relPos2X+i._rotation12*v._relPos2Y+i._rotation22*v._relPos2Z,v._localPos2X=n,v._localPos2Y=c,v._localPos2Z=z,v._depth=_.depth}this.removeOutdatedPoints()}};x.dynamics.constraint.info||(x.dynamics.constraint.info={});x.dynamics.constraint.info.JacobianRow=class{constructor(){this.lin1X=0,this.lin1Y=0,this.lin1Z=0,this.lin2X=0,this.lin2Y=0,this.lin2Z=0,this.ang1X=0,this.ang1Y=0,this.ang1Z=0,this.ang2X=0,this.ang2Y=0,this.ang2Z=0,this.flag=0}updateSparsity(){this.flag=0,(!(this.lin1X==0&&this.lin1Y==0&&this.lin1Z==0)||!(this.lin2X==0&&this.lin2Y==0&&this.lin2Z==0))&&(this.flag|=1),(!(this.ang1X==0&&this.ang1Y==0&&this.ang1Z==0)||!(this.ang2X==0&&this.ang2Y==0&&this.ang2Z==0))&&(this.flag|=2)}};x.dynamics.constraint.info.contact||(x.dynamics.constraint.info.contact={});x.dynamics.constraint.info.contact.ContactSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0;var a=new Array(x.common.Setting.maxManifoldPoints);this.rows=a;for(var t=0,i=this.rows.length;t<i;){var r=t++;this.rows[r]=new x.dynamics.constraint.info.contact.ContactSolverInfoRow}}};x.dynamics.constraint.info.contact.ContactSolverInfoRow=class{constructor(){this.jacobianN=new x.dynamics.constraint.info.JacobianRow,this.jacobianT=new x.dynamics.constraint.info.JacobianRow,this.jacobianB=new x.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.friction=0,this.impulse=null}};x.dynamics.constraint.info.joint||(x.dynamics.constraint.info.joint={});x.dynamics.constraint.info.joint.JointSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0;var a=new Array(x.common.Setting.maxJacobianRows);this.rows=a;for(var t=0,i=this.rows.length;t<i;){var r=t++;this.rows[r]=new x.dynamics.constraint.info.joint.JointSolverInfoRow}}};x.dynamics.constraint.info.joint.JointSolverInfoRow=class{constructor(){this.jacobian=new x.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.minImpulse=0,this.maxImpulse=0,this.motorSpeed=0,this.motorMaxImpulse=0,this.impulse=null}};x.dynamics.constraint.joint||(x.dynamics.constraint.joint={});x.dynamics.constraint.joint.BasisTracker=class{constructor(a){this.joint=a,this.xX=0,this.xY=0,this.xZ=0,this.yX=0,this.yY=0,this.yZ=0,this.zX=0,this.zY=0,this.zZ=0}};x.dynamics.constraint.joint.Joint=class{constructor(a,t){switch(this._link1=new x.dynamics.constraint.joint.JointLink(this),this._link2=new x.dynamics.constraint.joint.JointLink(this),this._positionCorrectionAlgorithm=x.common.Setting.defaultJointPositionCorrectionAlgorithm,this._type=t,this._world=null,this._b1=a.rigidBody1,this._b2=a.rigidBody2,this._allowCollision=a.allowCollision,this._breakForce=a.breakForce,this._breakTorque=a.breakTorque,a.solverType){case 0:this._solver=new x.dynamics.constraint.solver.pgs.PgsJointConstraintSolver(this);break;case 1:this._solver=new x.dynamics.constraint.solver.direct.DirectJointConstraintSolver(this);break}var i=a.localAnchor1;this._localAnchor1X=i.x,this._localAnchor1Y=i.y,this._localAnchor1Z=i.z;var r=a.localAnchor2;this._localAnchor2X=r.x,this._localAnchor2Y=r.y,this._localAnchor2Z=r.z,this._relativeAnchor1X=0,this._relativeAnchor1Y=0,this._relativeAnchor1Z=0,this._relativeAnchor2X=0,this._relativeAnchor2Y=0,this._relativeAnchor2Z=0,this._anchor1X=0,this._anchor1Y=0,this._anchor1Z=0,this._anchor2X=0,this._anchor2Y=0,this._anchor2Z=0,this._localBasisX1X=0,this._localBasisX1Y=0,this._localBasisX1Z=0,this._localBasisY1X=0,this._localBasisY1Y=0,this._localBasisY1Z=0,this._localBasisZ1X=0,this._localBasisZ1Y=0,this._localBasisZ1Z=0,this._localBasisX2X=0,this._localBasisX2Y=0,this._localBasisX2Z=0,this._localBasisY2X=0,this._localBasisY2Y=0,this._localBasisY2Z=0,this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=0;var o=new Array(x.common.Setting.maxJacobianRows);this._impulses=o;for(var s=0,_=x.common.Setting.maxJacobianRows;s<_;){var h=s++;this._impulses[h]=new x.dynamics.constraint.joint.JointImpulse}}buildLocalBasesFromX(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var a=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;a>0&&(a=1/Math.sqrt(a)),this._localBasisX1X*=a,this._localBasisX1Y*=a,this._localBasisX1Z*=a}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{var t=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX2X*=t,this._localBasisX2Y*=t,this._localBasisX2Z*=t}var i,r,o,s,_,h,v,e,l,u,b,f,n,c=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(c<-.999999999){var z,p,y,V=this._localBasisX1X,M=this._localBasisX1Y,I=this._localBasisX1Z,k=V*V,X=M*M,L=I*I,m;k<X?k<L?(m=1/Math.sqrt(X+L),z=0,p=I*m,y=-M*m):(m=1/Math.sqrt(k+X),z=M*m,p=-V*m,y=0):X<L?(m=1/Math.sqrt(L+k),z=-I*m,p=0,y=V*m):(m=1/Math.sqrt(k+X),z=M*m,p=-V*m,y=0),i=z,r=p,o=y,s=0}else{var g,N,A;g=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,N=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,A=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var F=Math.sqrt((1+c)*.5);c=.5/F,g*=c,N*=c,A*=c,i=g,r=N,o=A,s=F}var P=i,Y=r,R=o,C=s,d=2*P,Z=2*Y,$=2*R,K=P*d,E=Y*Z,J=R*$,B=P*Z,Q=Y*$,U=P*$,G=C*d,D=C*Z,H=C*$;_=1-E-J,h=B-H,v=U+D,e=B+H,l=1-K-J,u=Q-G,b=U-D,f=Q+G,n=1-K-E;var j=this._localBasisX1X,ia=this._localBasisX1Y,sa=this._localBasisX1Z,W=j*j,q=ia*ia,na=sa*sa,oa;W<q?W<na?(oa=1/Math.sqrt(q+na),this._localBasisY1X=0,this._localBasisY1Y=sa*oa,this._localBasisY1Z=-ia*oa):(oa=1/Math.sqrt(W+q),this._localBasisY1X=ia*oa,this._localBasisY1Y=-j*oa,this._localBasisY1Z=0):q<na?(oa=1/Math.sqrt(na+W),this._localBasisY1X=-sa*oa,this._localBasisY1Y=0,this._localBasisY1Z=j*oa):(oa=1/Math.sqrt(W+q),this._localBasisY1X=ia*oa,this._localBasisY1Y=-j*oa,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X;var aa,T,ca;aa=_*this._localBasisX1X+h*this._localBasisX1Y+v*this._localBasisX1Z,T=e*this._localBasisX1X+l*this._localBasisX1Y+u*this._localBasisX1Z,ca=b*this._localBasisX1X+f*this._localBasisX1Y+n*this._localBasisX1Z,this._localBasisX2X=aa,this._localBasisX2Y=T,this._localBasisX2Z=ca;var _a,w,ta;_a=_*this._localBasisY1X+h*this._localBasisY1Y+v*this._localBasisY1Z,w=e*this._localBasisY1X+l*this._localBasisY1Y+u*this._localBasisY1Z,ta=b*this._localBasisY1X+f*this._localBasisY1Y+n*this._localBasisY1Z,this._localBasisY2X=_a,this._localBasisY2Y=w,this._localBasisY2Z=ta;var ra,la,va;ra=_*this._localBasisZ1X+h*this._localBasisZ1Y+v*this._localBasisZ1Z,la=e*this._localBasisZ1X+l*this._localBasisZ1Y+u*this._localBasisZ1Z,va=b*this._localBasisZ1X+f*this._localBasisZ1Y+n*this._localBasisZ1Z,this._localBasisZ2X=ra,this._localBasisZ2Y=la,this._localBasisZ2Z=va}buildLocalBasesFromXY(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var a=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;a>0&&(a=1/Math.sqrt(a)),this._localBasisX1X*=a,this._localBasisX1Y*=a,this._localBasisX1Z*=a}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{var t=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX2X*=t,this._localBasisX2Y*=t,this._localBasisX2Z*=t}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){var i=this._localBasisX1X,r=this._localBasisX1Y,o=this._localBasisX1Z,s=i*i,_=r*r,h=o*o,v;s<_?s<h?(v=1/Math.sqrt(_+h),this._localBasisY1X=0,this._localBasisY1Y=o*v,this._localBasisY1Z=-r*v):(v=1/Math.sqrt(s+_),this._localBasisY1X=r*v,this._localBasisY1Y=-i*v,this._localBasisY1Z=0):_<h?(v=1/Math.sqrt(h+s),this._localBasisY1X=-o*v,this._localBasisY1Y=0,this._localBasisY1Z=i*v):(v=1/Math.sqrt(s+_),this._localBasisY1X=r*v,this._localBasisY1Y=-i*v,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{var e=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;e>0&&(e=1/Math.sqrt(e)),this._localBasisZ1X*=e,this._localBasisZ1Y*=e,this._localBasisZ1Z*=e,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0){var l=this._localBasisX2X,u=this._localBasisX2Y,b=this._localBasisX2Z,f=l*l,n=u*u,c=b*b,z;f<n?f<c?(z=1/Math.sqrt(n+c),this._localBasisY2X=0,this._localBasisY2Y=b*z,this._localBasisY2Z=-u*z):(z=1/Math.sqrt(f+n),this._localBasisY2X=u*z,this._localBasisY2Y=-l*z,this._localBasisY2Z=0):n<c?(z=1/Math.sqrt(c+f),this._localBasisY2X=-b*z,this._localBasisY2Y=0,this._localBasisY2Z=l*z):(z=1/Math.sqrt(f+n),this._localBasisY2X=u*z,this._localBasisY2Y=-l*z,this._localBasisY2Z=0),this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X}else{var p=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;p>0&&(p=1/Math.sqrt(p)),this._localBasisZ2X*=p,this._localBasisZ2Y*=p,this._localBasisZ2Z*=p,this._localBasisY2X=this._localBasisZ2Y*this._localBasisX2Z-this._localBasisZ2Z*this._localBasisX2Y,this._localBasisY2Y=this._localBasisZ2Z*this._localBasisX2X-this._localBasisZ2X*this._localBasisX2Z,this._localBasisY2Z=this._localBasisZ2X*this._localBasisX2Y-this._localBasisZ2Y*this._localBasisX2X}}buildLocalBasesFromX1Z2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var a=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;a>0&&(a=1/Math.sqrt(a)),this._localBasisX1X*=a,this._localBasisX1Y*=a,this._localBasisX1Z*=a}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0)this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=1;else{var t=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ2X*=t,this._localBasisZ2Y*=t,this._localBasisZ2Z*=t}var i=this._b1._transform,r=this._b2._transform,o,s,_,h,v,e,l,u,b,f,n,c,z,p,y,V,M,I;V=i._rotation00*this._localBasisX1X+i._rotation01*this._localBasisX1Y+i._rotation02*this._localBasisX1Z,M=i._rotation10*this._localBasisX1X+i._rotation11*this._localBasisX1Y+i._rotation12*this._localBasisX1Z,I=i._rotation20*this._localBasisX1X+i._rotation21*this._localBasisX1Y+i._rotation22*this._localBasisX1Z,o=V,s=M,_=I;var k,X,L;if(k=r._rotation00*this._localBasisZ2X+r._rotation01*this._localBasisZ2Y+r._rotation02*this._localBasisZ2Z,X=r._rotation10*this._localBasisZ2X+r._rotation11*this._localBasisZ2Y+r._rotation12*this._localBasisZ2Z,L=r._rotation20*this._localBasisZ2X+r._rotation21*this._localBasisZ2Y+r._rotation22*this._localBasisZ2Z,z=k,p=X,y=L,l=p*_-y*s,u=y*o-z*_,b=z*s-p*o,l*l+u*u+b*b==0){var m=o,g=s,N=_,A=m*m,F=g*g,P=N*N,Y;A<F?A<P?(Y=1/Math.sqrt(F+P),l=0,u=N*Y,b=-g*Y):(Y=1/Math.sqrt(A+F),l=g*Y,u=-m*Y,b=0):F<P?(Y=1/Math.sqrt(P+A),l=-N*Y,u=0,b=m*Y):(Y=1/Math.sqrt(A+F),l=g*Y,u=-m*Y,b=0)}h=s*b-_*u,v=_*l-o*b,e=o*u-s*l,f=u*y-b*p,n=b*z-l*y,c=l*p-u*z;var R,C,d;R=i._rotation00*o+i._rotation10*s+i._rotation20*_,C=i._rotation01*o+i._rotation11*s+i._rotation21*_,d=i._rotation02*o+i._rotation12*s+i._rotation22*_,this._localBasisX1X=R,this._localBasisX1Y=C,this._localBasisX1Z=d;var Z,$,K;Z=i._rotation00*l+i._rotation10*u+i._rotation20*b,$=i._rotation01*l+i._rotation11*u+i._rotation21*b,K=i._rotation02*l+i._rotation12*u+i._rotation22*b,this._localBasisY1X=Z,this._localBasisY1Y=$,this._localBasisY1Z=K;var E,J,B;E=i._rotation00*h+i._rotation10*v+i._rotation20*e,J=i._rotation01*h+i._rotation11*v+i._rotation21*e,B=i._rotation02*h+i._rotation12*v+i._rotation22*e,this._localBasisZ1X=E,this._localBasisZ1Y=J,this._localBasisZ1Z=B;var Q,U,G;Q=r._rotation00*f+r._rotation10*n+r._rotation20*c,U=r._rotation01*f+r._rotation11*n+r._rotation21*c,G=r._rotation02*f+r._rotation12*n+r._rotation22*c,this._localBasisX2X=Q,this._localBasisX2Y=U,this._localBasisX2Z=G;var D,H,j;D=r._rotation00*l+r._rotation10*u+r._rotation20*b,H=r._rotation01*l+r._rotation11*u+r._rotation21*b,j=r._rotation02*l+r._rotation12*u+r._rotation22*b,this._localBasisY2X=D,this._localBasisY2Y=H,this._localBasisY2Z=j;var ia,sa,W;ia=r._rotation00*z+r._rotation10*p+r._rotation20*y,sa=r._rotation01*z+r._rotation11*p+r._rotation21*y,W=r._rotation02*z+r._rotation12*p+r._rotation22*y,this._localBasisZ2X=ia,this._localBasisZ2Y=sa,this._localBasisZ2Z=W}buildLocalBasesFromXY1X2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var a=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;a>0&&(a=1/Math.sqrt(a)),this._localBasisX1X*=a,this._localBasisX1Y*=a,this._localBasisX1Z*=a}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){var t=this._localBasisX1X,i=this._localBasisX1Y,r=this._localBasisX1Z,o=t*t,s=i*i,_=r*r,h;o<s?o<_?(h=1/Math.sqrt(s+_),this._localBasisY1X=0,this._localBasisY1Y=r*h,this._localBasisY1Z=-i*h):(h=1/Math.sqrt(o+s),this._localBasisY1X=i*h,this._localBasisY1Y=-t*h,this._localBasisY1Z=0):s<_?(h=1/Math.sqrt(_+o),this._localBasisY1X=-r*h,this._localBasisY1Y=0,this._localBasisY1Z=t*h):(h=1/Math.sqrt(o+s),this._localBasisY1X=i*h,this._localBasisY1Y=-t*h,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{var v=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;v>0&&(v=1/Math.sqrt(v)),this._localBasisZ1X*=v,this._localBasisZ1Y*=v,this._localBasisZ1Z*=v,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}var e,l,u,b,f,n,c,z,p,y,V,M,I,k=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(k<-.999999999){var X,L,m,g=this._localBasisX1X,N=this._localBasisX1Y,A=this._localBasisX1Z,F=g*g,P=N*N,Y=A*A,R;F<P?F<Y?(R=1/Math.sqrt(P+Y),X=0,L=A*R,m=-N*R):(R=1/Math.sqrt(F+P),X=N*R,L=-g*R,m=0):P<Y?(R=1/Math.sqrt(Y+F),X=-A*R,L=0,m=g*R):(R=1/Math.sqrt(F+P),X=N*R,L=-g*R,m=0),e=X,l=L,u=m,b=0}else{var C,d,Z;C=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,d=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,Z=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var $=Math.sqrt((1+k)*.5);k=.5/$,C*=k,d*=k,Z*=k,e=C,l=d,u=Z,b=$}var K=e,E=l,J=u,B=b,Q=2*K,U=2*E,G=2*J,D=K*Q,H=E*U,j=J*G,ia=K*U,sa=E*G,W=K*G,q=B*Q,na=B*U,oa=B*G;f=1-H-j,n=ia-oa,c=W+na,z=ia+oa,p=1-D-j,y=sa-q,V=W-na,M=sa+q,I=1-D-H;var aa,T,ca;aa=f*this._localBasisX1X+n*this._localBasisX1Y+c*this._localBasisX1Z,T=z*this._localBasisX1X+p*this._localBasisX1Y+y*this._localBasisX1Z,ca=V*this._localBasisX1X+M*this._localBasisX1Y+I*this._localBasisX1Z,this._localBasisX2X=aa,this._localBasisX2Y=T,this._localBasisX2Z=ca;var _a,w,ta;_a=f*this._localBasisY1X+n*this._localBasisY1Y+c*this._localBasisY1Z,w=z*this._localBasisY1X+p*this._localBasisY1Y+y*this._localBasisY1Z,ta=V*this._localBasisY1X+M*this._localBasisY1Y+I*this._localBasisY1Z,this._localBasisY2X=_a,this._localBasisY2Y=w,this._localBasisY2Z=ta;var ra,la,va;ra=f*this._localBasisZ1X+n*this._localBasisZ1Y+c*this._localBasisZ1Z,la=z*this._localBasisZ1X+p*this._localBasisZ1Y+y*this._localBasisZ1Z,va=V*this._localBasisZ1X+M*this._localBasisZ1Y+I*this._localBasisZ1Z,this._localBasisZ2X=ra,this._localBasisZ2Y=la,this._localBasisZ2Z=va}setSolverInfoRowLinear(a,t,i,r,o,s,_){var h,v,e=x.common.Setting.linearSlop;if(_)h=0,v=1;else{if(o.frequency>0){e=0;var l=6.28318530717958*o.frequency,u=o.dampingRatio;u<x.common.Setting.minSpringDamperDampingRatio&&(u=x.common.Setting.minSpringDamperDampingRatio);var b=s.dt,f=2*u*l,n=l*l;o.useSymplecticEuler?(h=1/(b*f),v=n/f):(h=1/(b*(b*n+f)),v=n/(b*n+f))}else h=0,v=this.getErp(s,!1);i.motorForce>0?(a.motorSpeed=i.motorSpeed,a.motorMaxImpulse=i.motorForce*s.dt):(a.motorSpeed=0,a.motorMaxImpulse=0)}var c=i.lowerLimit,z=i.upperLimit,p,y,V;c>z?(p=0,y=0,V=0):c==z?(p=-1/0,y=1/0,V=t-c):t<c?(p=-1/0,y=0,V=t-c+e,V>0&&(V=0)):t>z?(p=0,y=1/0,V=t-z-e,V<0&&(V=0)):(p=0,y=0,V=0);var M=r==0?0:1/r;a.minImpulse=p,a.maxImpulse=y,a.cfm=h*M,a.rhs=V*v}setSolverInfoRowAngular(a,t,i,r,o,s,_){var h,v,e=x.common.Setting.angularSlop;if(_)h=0,v=1;else{if(o.frequency>0){e=0;var l=6.28318530717958*o.frequency,u=o.dampingRatio;u<x.common.Setting.minSpringDamperDampingRatio&&(u=x.common.Setting.minSpringDamperDampingRatio);var b=s.dt,f=2*u*l,n=l*l;o.useSymplecticEuler?(h=1/(b*f),v=n/f):(h=1/(b*(b*n+f)),v=n/(b*n+f))}else h=0,v=this.getErp(s,!1);i.motorTorque>0?(a.motorSpeed=i.motorSpeed,a.motorMaxImpulse=i.motorTorque*s.dt):(a.motorSpeed=0,a.motorMaxImpulse=0)}var c=i.lowerLimit,z=i.upperLimit,p=(c+z)*.5;t-=p,t=((t+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,t+=p;var y,V,M;c>z?(y=0,V=0,M=0):c==z?(y=-1/0,V=1/0,M=t-c):t<c?(y=-1/0,V=0,M=t-c+e,M>0&&(M=0)):t>z?(y=0,V=1/0,M=t-z-e,M<0&&(M=0)):(y=0,V=0,M=0);var I=r==0?0:1/r;a.minImpulse=y,a.maxImpulse=V,a.cfm=h*I,a.rhs=M*v}getErp(a,t){return t?1:this._positionCorrectionAlgorithm==x.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?a.invDt*x.common.Setting.velocityBaumgarte:0}computeEffectiveInertiaMoment(a,t,i){var r,o,s,_,h,v,e,l,u;e=this._b1._invInertia00*a+this._b1._invInertia01*t+this._b1._invInertia02*i,l=this._b1._invInertia10*a+this._b1._invInertia11*t+this._b1._invInertia12*i,u=this._b1._invInertia20*a+this._b1._invInertia21*t+this._b1._invInertia22*i,r=e,o=l,s=u;var b,f,n;b=this._b2._invInertia00*a+this._b2._invInertia01*t+this._b2._invInertia02*i,f=this._b2._invInertia10*a+this._b2._invInertia11*t+this._b2._invInertia12*i,n=this._b2._invInertia20*a+this._b2._invInertia21*t+this._b2._invInertia22*i,_=b,h=f,v=n;var c=r*a+o*t+s*i,z=_*a+h*t+v*i;if(c>0){var p=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,y=a*this._relativeAnchor1X+t*this._relativeAnchor1Y+i*this._relativeAnchor1Z,V=p-y*y;V>0&&(this._b1._invMass>0?c=1/(1/c+this._b1._mass*V):c=0)}if(z>0){var M=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,I=a*this._relativeAnchor2X+t*this._relativeAnchor2Y+i*this._relativeAnchor2Z,k=M-I*I;k>0&&(this._b2._invMass>0?z=1/(1/z+this._b2._mass*k):z=0)}return c+z==0?0:1/(c+z)}computeEffectiveInertiaMoment2(a,t,i,r,o,s){var _,h,v,e,l,u,b,f,n;b=this._b1._invInertia00*a+this._b1._invInertia01*t+this._b1._invInertia02*i,f=this._b1._invInertia10*a+this._b1._invInertia11*t+this._b1._invInertia12*i,n=this._b1._invInertia20*a+this._b1._invInertia21*t+this._b1._invInertia22*i,_=b,h=f,v=n;var c,z,p;c=this._b2._invInertia00*r+this._b2._invInertia01*o+this._b2._invInertia02*s,z=this._b2._invInertia10*r+this._b2._invInertia11*o+this._b2._invInertia12*s,p=this._b2._invInertia20*r+this._b2._invInertia21*o+this._b2._invInertia22*s,e=c,l=z,u=p;var y=_*a+h*t+v*i,V=e*r+l*o+u*s;if(y>0){var M=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,I=a*this._relativeAnchor1X+t*this._relativeAnchor1Y+i*this._relativeAnchor1Z,k=M*M-I*I;k>0&&(this._b1._invMass>0?y=1/(1/y+this._b1._mass*k):y=0)}if(V>0){var X=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,L=r*this._relativeAnchor2X+o*this._relativeAnchor2Y+s*this._relativeAnchor2Z,m=X*X-L*L;m>0&&(this._b2._invMass>0?V=1/(1/V+this._b2._mass*m):V=0)}return y+V==0?0:1/(y+V)}_syncAnchors(){var a=this._b1._transform,t=this._b2._transform,i,r,o;i=a._rotation00*this._localAnchor1X+a._rotation01*this._localAnchor1Y+a._rotation02*this._localAnchor1Z,r=a._rotation10*this._localAnchor1X+a._rotation11*this._localAnchor1Y+a._rotation12*this._localAnchor1Z,o=a._rotation20*this._localAnchor1X+a._rotation21*this._localAnchor1Y+a._rotation22*this._localAnchor1Z,this._relativeAnchor1X=i,this._relativeAnchor1Y=r,this._relativeAnchor1Z=o;var s,_,h;s=t._rotation00*this._localAnchor2X+t._rotation01*this._localAnchor2Y+t._rotation02*this._localAnchor2Z,_=t._rotation10*this._localAnchor2X+t._rotation11*this._localAnchor2Y+t._rotation12*this._localAnchor2Z,h=t._rotation20*this._localAnchor2X+t._rotation21*this._localAnchor2Y+t._rotation22*this._localAnchor2Z,this._relativeAnchor2X=s,this._relativeAnchor2Y=_,this._relativeAnchor2Z=h,this._anchor1X=this._relativeAnchor1X+a._positionX,this._anchor1Y=this._relativeAnchor1Y+a._positionY,this._anchor1Z=this._relativeAnchor1Z+a._positionZ,this._anchor2X=this._relativeAnchor2X+t._positionX,this._anchor2Y=this._relativeAnchor2Y+t._positionY,this._anchor2Z=this._relativeAnchor2Z+t._positionZ;var v,e,l;v=a._rotation00*this._localBasisX1X+a._rotation01*this._localBasisX1Y+a._rotation02*this._localBasisX1Z,e=a._rotation10*this._localBasisX1X+a._rotation11*this._localBasisX1Y+a._rotation12*this._localBasisX1Z,l=a._rotation20*this._localBasisX1X+a._rotation21*this._localBasisX1Y+a._rotation22*this._localBasisX1Z,this._basisX1X=v,this._basisX1Y=e,this._basisX1Z=l;var u,b,f;u=a._rotation00*this._localBasisY1X+a._rotation01*this._localBasisY1Y+a._rotation02*this._localBasisY1Z,b=a._rotation10*this._localBasisY1X+a._rotation11*this._localBasisY1Y+a._rotation12*this._localBasisY1Z,f=a._rotation20*this._localBasisY1X+a._rotation21*this._localBasisY1Y+a._rotation22*this._localBasisY1Z,this._basisY1X=u,this._basisY1Y=b,this._basisY1Z=f;var n,c,z;n=a._rotation00*this._localBasisZ1X+a._rotation01*this._localBasisZ1Y+a._rotation02*this._localBasisZ1Z,c=a._rotation10*this._localBasisZ1X+a._rotation11*this._localBasisZ1Y+a._rotation12*this._localBasisZ1Z,z=a._rotation20*this._localBasisZ1X+a._rotation21*this._localBasisZ1Y+a._rotation22*this._localBasisZ1Z,this._basisZ1X=n,this._basisZ1Y=c,this._basisZ1Z=z;var p,y,V;p=t._rotation00*this._localBasisX2X+t._rotation01*this._localBasisX2Y+t._rotation02*this._localBasisX2Z,y=t._rotation10*this._localBasisX2X+t._rotation11*this._localBasisX2Y+t._rotation12*this._localBasisX2Z,V=t._rotation20*this._localBasisX2X+t._rotation21*this._localBasisX2Y+t._rotation22*this._localBasisX2Z,this._basisX2X=p,this._basisX2Y=y,this._basisX2Z=V;var M,I,k;M=t._rotation00*this._localBasisY2X+t._rotation01*this._localBasisY2Y+t._rotation02*this._localBasisY2Z,I=t._rotation10*this._localBasisY2X+t._rotation11*this._localBasisY2Y+t._rotation12*this._localBasisY2Z,k=t._rotation20*this._localBasisY2X+t._rotation21*this._localBasisY2Y+t._rotation22*this._localBasisY2Z,this._basisY2X=M,this._basisY2Y=I,this._basisY2Z=k;var X,L,m;X=t._rotation00*this._localBasisZ2X+t._rotation01*this._localBasisZ2Y+t._rotation02*this._localBasisZ2Z,L=t._rotation10*this._localBasisZ2X+t._rotation11*this._localBasisZ2Y+t._rotation12*this._localBasisZ2Z,m=t._rotation20*this._localBasisZ2X+t._rotation21*this._localBasisZ2Y+t._rotation22*this._localBasisZ2Z,this._basisZ2X=X,this._basisZ2Y=L,this._basisZ2Z=m}_getVelocitySolverInfo(a,t){t.b1=this._b1,t.b2=this._b2,t.numRows=0}_getPositionSolverInfo(a){a.b1=this._b1,a.b2=this._b2,a.numRows=0}_checkDestruction(){var a=this._appliedForceX*this._appliedForceX+this._appliedForceY*this._appliedForceY+this._appliedForceZ*this._appliedForceZ,t=this._appliedTorqueX*this._appliedTorqueX+this._appliedTorqueY*this._appliedTorqueY+this._appliedTorqueZ*this._appliedTorqueZ;if(this._breakForce>0&&a>this._breakForce*this._breakForce){this._world.removeJoint(this);return}if(this._breakTorque>0&&t>this._breakTorque*this._breakTorque){this._world.removeJoint(this);return}}getRigidBody1(){return this._b1}getRigidBody2(){return this._b2}getType(){return this._type}getAnchor1(){var a=new x.common.Vec3,t=a;return t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z,a}getAnchor2(){var a=new x.common.Vec3,t=a;return t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z,a}getAnchor1To(a){var t=a;t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z}getAnchor2To(a){var t=a;t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z}getLocalAnchor1(){var a=new x.common.Vec3,t=a;return t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z,a}getLocalAnchor2(){var a=new x.common.Vec3,t=a;return t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z,a}getLocalAnchor1To(a){var t=a;t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z}getLocalAnchor2To(a){var t=a;t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z}getBasis1(){var a=new x.common.Mat3,t,i,r,o,s,_,h,v,e;t=this._basisX1X,i=this._basisY1X,r=this._basisZ1X,o=this._basisX1Y,s=this._basisY1Y,_=this._basisZ1Y,h=this._basisX1Z,v=this._basisY1Z,e=this._basisZ1Z;var l=a;return l.e00=t,l.e01=i,l.e02=r,l.e10=o,l.e11=s,l.e12=_,l.e20=h,l.e21=v,l.e22=e,a}getBasis2(){var a=new x.common.Mat3,t,i,r,o,s,_,h,v,e;t=this._basisX2X,i=this._basisY2X,r=this._basisZ2X,o=this._basisX2Y,s=this._basisY2Y,_=this._basisZ2Y,h=this._basisX2Z,v=this._basisY2Z,e=this._basisZ2Z;var l=a;return l.e00=t,l.e01=i,l.e02=r,l.e10=o,l.e11=s,l.e12=_,l.e20=h,l.e21=v,l.e22=e,a}getBasis1To(a){var t,i,r,o,s,_,h,v,e;t=this._basisX1X,i=this._basisY1X,r=this._basisZ1X,o=this._basisX1Y,s=this._basisY1Y,_=this._basisZ1Y,h=this._basisX1Z,v=this._basisY1Z,e=this._basisZ1Z;var l=a;l.e00=t,l.e01=i,l.e02=r,l.e10=o,l.e11=s,l.e12=_,l.e20=h,l.e21=v,l.e22=e}getBasis2To(a){var t,i,r,o,s,_,h,v,e;t=this._basisX2X,i=this._basisY2X,r=this._basisZ2X,o=this._basisX2Y,s=this._basisY2Y,_=this._basisZ2Y,h=this._basisX2Z,v=this._basisY2Z,e=this._basisZ2Z;var l=a;l.e00=t,l.e01=i,l.e02=r,l.e10=o,l.e11=s,l.e12=_,l.e20=h,l.e21=v,l.e22=e}getAllowCollision(){return this._allowCollision}setAllowCollision(a){this._allowCollision=a}getBreakForce(){return this._breakForce}setBreakForce(a){this._breakForce=a}getBreakTorque(){return this._breakTorque}setBreakTorque(a){this._breakTorque=a}getPositionCorrectionAlgorithm(){return this._positionCorrectionAlgorithm}setPositionCorrectionAlgorithm(a){switch(a){case 0:case 1:case 2:break;default:throw new Error("invalid position correction algorithm id: "+a)}this._positionCorrectionAlgorithm=a}getAppliedForce(){var a=new x.common.Vec3,t=a;return t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ,a}getAppliedForceTo(a){var t=a;t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ}getAppliedTorque(){var a=new x.common.Vec3,t=a;return t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ,a}getAppliedTorqueTo(a){var t=a;t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ}getPrev(){return this._prev}getNext(){return this._next}};x.dynamics.constraint.joint.CylindricalJoint=class extends x.dynamics.constraint.joint.Joint{constructor(a){super(a,2);var t=a.localAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var i=a.localAxis2;this._localBasisX2X=i.x,this._localBasisX2Y=i.y,this._localBasisX2Z=i.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this._basis=new x.dynamics.constraint.joint.BasisTracker(this),this._translSd=a.translationalSpringDamper.clone(),this._translLm=a.translationalLimitMotor.clone(),this._rotSd=a.rotationalSpringDamper.clone(),this._rotLm=a.rotationalLimitMotor.clone()}getInfo(a,t,i){var r=this.getErp(t,i),o=this.linearErrorY*r,s=this.linearErrorZ*r,_=this.angularErrorY*r,h=this.angularErrorZ*r,v,e,l=1/(this._b1._invMass+this._b2._invMass),u=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ);if(this._translSd.frequency<=0||!i){var b=this._impulses[0],f=a.rows[a.numRows++],n=f.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,f.rhs=0,f.cfm=0,f.minImpulse=0,f.maxImpulse=0,f.motorSpeed=0,f.motorMaxImpulse=0,f.impulse=null,f.impulse=b,v=f,this.setSolverInfoRowLinear(v,this.translation,this._translLm,l,this._translSd,t,i),e=v.jacobian,e.lin1X=this._basis.xX,e.lin1Y=this._basis.xY,e.lin1Z=this._basis.xZ,e.lin2X=this._basis.xX,e.lin2Y=this._basis.xY,e.lin2Z=this._basis.xZ,e.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,e.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,e.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,e.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,e.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,e.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}var c=this._impulses[1],z=a.rows[a.numRows++],p=z.jacobian;p.lin1X=0,p.lin1Y=0,p.lin1Z=0,p.lin2X=0,p.lin2Y=0,p.lin2Z=0,p.ang1X=0,p.ang1Y=0,p.ang1Z=0,p.ang2X=0,p.ang2Y=0,p.ang2Z=0,z.rhs=0,z.cfm=0,z.minImpulse=0,z.maxImpulse=0,z.motorSpeed=0,z.motorMaxImpulse=0,z.impulse=null,z.impulse=c,v=z,v.rhs=o,v.cfm=0,v.minImpulse=-1/0,v.maxImpulse=1/0,e=v.jacobian,e.lin1X=this._basis.yX,e.lin1Y=this._basis.yY,e.lin1Z=this._basis.yZ,e.lin2X=this._basis.yX,e.lin2Y=this._basis.yY,e.lin2Z=this._basis.yZ,e.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,e.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,e.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,e.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,e.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,e.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;var y=this._impulses[2],V=a.rows[a.numRows++],M=V.jacobian;if(M.lin1X=0,M.lin1Y=0,M.lin1Z=0,M.lin2X=0,M.lin2Y=0,M.lin2Z=0,M.ang1X=0,M.ang1Y=0,M.ang1Z=0,M.ang2X=0,M.ang2Y=0,M.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=y,v=V,v.rhs=s,v.cfm=0,v.minImpulse=-1/0,v.maxImpulse=1/0,e=v.jacobian,e.lin1X=this._basis.zX,e.lin1Y=this._basis.zY,e.lin1Z=this._basis.zZ,e.lin2X=this._basis.zX,e.lin2Y=this._basis.zY,e.lin2Z=this._basis.zZ,e.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,e.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,e.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,e.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,e.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,e.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX,this._rotSd.frequency<=0||!i){var I=this._impulses[3],k=a.rows[a.numRows++],X=k.jacobian;X.lin1X=0,X.lin1Y=0,X.lin1Z=0,X.lin2X=0,X.lin2Y=0,X.lin2Z=0,X.ang1X=0,X.ang1Y=0,X.ang1Z=0,X.ang2X=0,X.ang2Y=0,X.ang2Z=0,k.rhs=0,k.cfm=0,k.minImpulse=0,k.maxImpulse=0,k.motorSpeed=0,k.motorMaxImpulse=0,k.impulse=null,k.impulse=I,v=k,this.setSolverInfoRowAngular(v,this.angle,this._rotLm,u,this._rotSd,t,i),e=v.jacobian,e.ang1X=this._basis.xX,e.ang1Y=this._basis.xY,e.ang1Z=this._basis.xZ,e.ang2X=this._basis.xX,e.ang2Y=this._basis.xY,e.ang2Z=this._basis.xZ}var L=this._impulses[4],m=a.rows[a.numRows++],g=m.jacobian;g.lin1X=0,g.lin1Y=0,g.lin1Z=0,g.lin2X=0,g.lin2Y=0,g.lin2Z=0,g.ang1X=0,g.ang1Y=0,g.ang1Z=0,g.ang2X=0,g.ang2Y=0,g.ang2Z=0,m.rhs=0,m.cfm=0,m.minImpulse=0,m.maxImpulse=0,m.motorSpeed=0,m.motorMaxImpulse=0,m.impulse=null,m.impulse=L,v=m,v.rhs=_,v.cfm=0,v.minImpulse=-1/0,v.maxImpulse=1/0,e=v.jacobian,e.ang1X=this._basis.yX,e.ang1Y=this._basis.yY,e.ang1Z=this._basis.yZ,e.ang2X=this._basis.yX,e.ang2Y=this._basis.yY,e.ang2Z=this._basis.yZ;var N=this._impulses[5],A=a.rows[a.numRows++],F=A.jacobian;F.lin1X=0,F.lin1Y=0,F.lin1Z=0,F.lin2X=0,F.lin2Y=0,F.lin2Z=0,F.ang1X=0,F.ang1Y=0,F.ang1Z=0,F.ang2X=0,F.ang2Y=0,F.ang2Z=0,A.rhs=0,A.cfm=0,A.minImpulse=0,A.maxImpulse=0,A.motorSpeed=0,A.motorMaxImpulse=0,A.impulse=null,A.impulse=N,v=A,v.rhs=h,v.cfm=0,v.minImpulse=-1/0,v.maxImpulse=1/0,e=v.jacobian,e.ang1X=this._basis.zX,e.ang1Y=this._basis.zY,e.ang1Z=this._basis.zZ,e.ang2X=this._basis.zX,e.ang2Y=this._basis.zY,e.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();var a=this._basis,t=a.joint._b1._invMass,i=a.joint._b2._invMass,r,o,s,_,h,v,e,l,u,b,f,n,c,z,p,y,V,M,I,k,X,L,m,g,N,A,F,P,Y,R,C,d,Z,$,K,E,J=a.joint._basisX1X*a.joint._basisX2X+a.joint._basisX1Y*a.joint._basisX2Y+a.joint._basisX1Z*a.joint._basisX2Z;if(J<-.999999999){var B,Q,U,G=a.joint._basisX1X,D=a.joint._basisX1Y,H=a.joint._basisX1Z,j=G*G,ia=D*D,sa=H*H,W;j<ia?j<sa?(W=1/Math.sqrt(ia+sa),B=0,Q=H*W,U=-D*W):(W=1/Math.sqrt(j+ia),B=D*W,Q=-G*W,U=0):ia<sa?(W=1/Math.sqrt(sa+j),B=-H*W,Q=0,U=G*W):(W=1/Math.sqrt(j+ia),B=D*W,Q=-G*W,U=0),r=B,o=Q,s=U,_=0}else{var q,na,oa;q=a.joint._basisX1Y*a.joint._basisX2Z-a.joint._basisX1Z*a.joint._basisX2Y,na=a.joint._basisX1Z*a.joint._basisX2X-a.joint._basisX1X*a.joint._basisX2Z,oa=a.joint._basisX1X*a.joint._basisX2Y-a.joint._basisX1Y*a.joint._basisX2X;var aa=Math.sqrt((1+J)*.5);J=.5/aa,q*=J,na*=J,oa*=J,r=q,o=na,s=oa,_=aa}h=0,v=0,e=0,l=1;var T,ca,_a,w,ta,ra,la,va;T=h,ca=v,_a=e,w=l,ta=r,ra=o,la=s,va=_;var xa=T*ta+ca*ra+_a*la+w*va;if(xa<0&&(xa=-xa,ta=-ta,ra=-ra,la=-la,va=-va),xa>.999999){var za,Ma,Xa,Za;za=ta-T,Ma=ra-ca,Xa=la-_a,Za=va-w,ta=T+za*(t/(t+i)),ra=ca+Ma*(t/(t+i)),la=_a+Xa*(t/(t+i)),va=w+Za*(t/(t+i));var fa=ta*ta+ra*ra+la*la+va*va;fa>1e-32&&(fa=1/Math.sqrt(fa)),u=ta*fa,b=ra*fa,f=la*fa,n=va*fa}else{var ba=t/(t+i)*Math.acos(xa);ta+=T*-xa,ra+=ca*-xa,la+=_a*-xa,va+=w*-xa;var ea=ta*ta+ra*ra+la*la+va*va;ea>1e-32&&(ea=1/Math.sqrt(ea)),ta*=ea,ra*=ea,la*=ea,va*=ea;var ha=Math.sin(ba),ma=Math.cos(ba);T*=ma,ca*=ma,_a*=ma,w*=ma,u=T+ta*ha,b=ca+ra*ha,f=_a+la*ha,n=w+va*ha}var ya=u,da=b,pa=f,Ya=n,Qa=2*ya,ga=2*da,ua=2*pa,wa=ya*Qa,ka=da*ga,Sa=pa*ua,zt=ya*ga,Ha=da*ua,Ba=ya*ua,nt=Ya*Qa,Ea=Ya*ga,Fa=Ya*ua;c=1-ka-Sa,z=zt-Fa,p=Ba+Ea,y=zt+Fa,V=1-wa-Sa,M=Ha-nt,I=Ba-Ea,k=Ha+nt,X=1-wa-ka;var Aa,ft,Wa;Aa=c*a.joint._basisX1X+z*a.joint._basisX1Y+p*a.joint._basisX1Z,ft=y*a.joint._basisX1X+V*a.joint._basisX1Y+M*a.joint._basisX1Z,Wa=I*a.joint._basisX1X+k*a.joint._basisX1Y+X*a.joint._basisX1Z,L=Aa,m=ft,g=Wa,C=a.xX,d=a.xY,Z=a.xZ,$=a.yX,K=a.yY,E=a.yZ;var Ka=C*L+d*m+Z*g;if(Ka<-.999999999){var bt,it,$a,_t=C,gt=d,pt=Z,Ga=_t*_t,rt=gt*gt,ut=pt*pt,Da;Ga<rt?Ga<ut?(Da=1/Math.sqrt(rt+ut),bt=0,it=pt*Da,$a=-gt*Da):(Da=1/Math.sqrt(Ga+rt),bt=gt*Da,it=-_t*Da,$a=0):rt<ut?(Da=1/Math.sqrt(ut+Ga),bt=-pt*Da,it=0,$a=_t*Da):(Da=1/Math.sqrt(Ga+rt),bt=gt*Da,it=-_t*Da,$a=0),u=bt,b=it,f=$a,n=0}else{var Ta,Na,Vt;Ta=d*g-Z*m,Na=Z*L-C*g,Vt=C*m-d*L;var St=Math.sqrt((1+Ka)*.5);Ka=.5/St,Ta*=Ka,Na*=Ka,Vt*=Ka,u=Ta,b=Na,f=Vt,n=St}var et=u,Xt=b,Yt=f,Mt=n,Ia=2*et,O=2*Xt,Va=2*Yt,lt=et*Ia,S=Xt*O,wt=Yt*Va,Bt=et*O,At=Xt*Va,yt=et*Va,kt=Mt*Ia,mt=Mt*O,ht=Mt*Va;c=1-S-wt,z=Bt-ht,p=yt+mt,y=Bt+ht,V=1-lt-wt,M=At-kt,I=yt-mt,k=At+kt,X=1-lt-S;var xt,Ra,st;if(xt=c*$+z*K+p*E,Ra=y*$+V*K+M*E,st=I*$+k*K+X*E,N=xt,A=Ra,F=st,P=m*F-g*A,Y=g*N-L*F,R=L*A-m*N,P*P+Y*Y+R*R>1e-6){var Ca=P*P+Y*Y+R*R;Ca>0&&(Ca=1/Math.sqrt(Ca)),P*=Ca,Y*=Ca,R*=Ca}else{var vt=L,qa=m,at=g,Oa=vt*vt,tt=qa*qa,ct=at*at,Pa;Oa<tt?Oa<ct?(Pa=1/Math.sqrt(tt+ct),P=0,Y=at*Pa,R=-qa*Pa):(Pa=1/Math.sqrt(Oa+tt),P=qa*Pa,Y=-vt*Pa,R=0):tt<ct?(Pa=1/Math.sqrt(ct+Oa),P=-at*Pa,Y=0,R=vt*Pa):(Pa=1/Math.sqrt(Oa+tt),P=qa*Pa,Y=-vt*Pa,R=0)}N=Y*g-R*m,A=R*L-P*g,F=P*m-Y*L,a.xX=L,a.xY=m,a.xZ=g,a.yX=N,a.yY=A,a.yZ=F,a.zX=P,a.zY=Y,a.zZ=R;var Ja,ja,La;Ja=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,ja=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,La=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;var ot=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,It=ot<=-1?3.14159265358979:ot>=1?0:Math.acos(ot),oi=Ja*Ja+ja*ja+La*La;oi>0&&(oi=1/Math.sqrt(oi)),Ja*=oi,ja*=oi,La*=oi,Ja*=It,ja*=It,La*=It,this.angularErrorY=Ja*this._basis.yX+ja*this._basis.yY+La*this._basis.yZ,this.angularErrorZ=Ja*this._basis.zX+ja*this._basis.zY+La*this._basis.zZ;var gi,ai,Ct;gi=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,ai=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,Ct=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,ot=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=ot<=-1?3.14159265358979:ot>=1?0:Math.acos(ot),gi*this._basis.xX+ai*this._basis.xY+Ct*this._basis.xZ<0&&(this.angle=-this.angle);var _i,Et,Pt;_i=this._anchor2X-this._anchor1X,Et=this._anchor2Y-this._anchor1Y,Pt=this._anchor2Z-this._anchor1Z,this.translation=_i*this._basis.xX+Et*this._basis.xY+Pt*this._basis.xZ,this.linearErrorY=_i*this._basis.yX+Et*this._basis.yY+Pt*this._basis.yZ,this.linearErrorZ=_i*this._basis.zX+Et*this._basis.zY+Pt*this._basis.zZ}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,a}getAxis1To(a){var t=a;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(a){var t=a;t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,a}getLocalAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,a}getLocalAxis1To(a){var t=a;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(a){var t=a;t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTranslationalSpringDamper(){return this._translSd}getRotationalSpringDamper(){return this._rotSd}getTranslationalLimitMotor(){return this._translLm}getRotationalLimitMotor(){return this._rotLm}getAngle(){return this.angle}getTranslation(){return this.translation}};x.dynamics.constraint.joint.JointConfig=class{constructor(){this.rigidBody1=null,this.rigidBody2=null,this.localAnchor1=new x.common.Vec3,this.localAnchor2=new x.common.Vec3,this.allowCollision=!1,this.solverType=x.common.Setting.defaultJointConstraintSolverType,this.positionCorrectionAlgorithm=x.common.Setting.defaultJointPositionCorrectionAlgorithm,this.breakForce=0,this.breakTorque=0}_init(a,t,i){this.rigidBody1=a,this.rigidBody2=t;var r=this.rigidBody1,o,s,_,h=i;o=h.x,s=h.y,_=h.z,o-=r._transform._positionX,s-=r._transform._positionY,_-=r._transform._positionZ;var v,e,l;v=r._transform._rotation00*o+r._transform._rotation10*s+r._transform._rotation20*_,e=r._transform._rotation01*o+r._transform._rotation11*s+r._transform._rotation21*_,l=r._transform._rotation02*o+r._transform._rotation12*s+r._transform._rotation22*_,o=v,s=e,_=l;var u=this.localAnchor1;u.x=o,u.y=s,u.z=_;var b=this.rigidBody2,f,n,c,z=i;f=z.x,n=z.y,c=z.z,f-=b._transform._positionX,n-=b._transform._positionY,c-=b._transform._positionZ;var p,y,V;p=b._transform._rotation00*f+b._transform._rotation10*n+b._transform._rotation20*c,y=b._transform._rotation01*f+b._transform._rotation11*n+b._transform._rotation21*c,V=b._transform._rotation02*f+b._transform._rotation12*n+b._transform._rotation22*c,f=p,n=y,c=V;var M=this.localAnchor2;M.x=f,M.y=n,M.z=c}};x.dynamics.constraint.joint.CylindricalJointConfig=class extends x.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new x.common.Vec3(1,0,0),this.localAxis2=new x.common.Vec3(1,0,0),this.translationalLimitMotor=new x.dynamics.constraint.joint.TranslationalLimitMotor,this.translationalSpringDamper=new x.dynamics.constraint.joint.SpringDamper,this.rotationalLimitMotor=new x.dynamics.constraint.joint.RotationalLimitMotor,this.rotationalSpringDamper=new x.dynamics.constraint.joint.SpringDamper}init(a,t,i,r){this._init(a,t,i);var o,s,_,h=r;o=h.x,s=h.y,_=h.z;var v,e,l;v=a._transform._rotation00*o+a._transform._rotation10*s+a._transform._rotation20*_,e=a._transform._rotation01*o+a._transform._rotation11*s+a._transform._rotation21*_,l=a._transform._rotation02*o+a._transform._rotation12*s+a._transform._rotation22*_,o=v,s=e,_=l;var u=this.localAxis1;u.x=o,u.y=s,u.z=_;var b,f,n,c=r;b=c.x,f=c.y,n=c.z;var z,p,y;z=t._transform._rotation00*b+t._transform._rotation10*f+t._transform._rotation20*n,p=t._transform._rotation01*b+t._transform._rotation11*f+t._transform._rotation21*n,y=t._transform._rotation02*b+t._transform._rotation12*f+t._transform._rotation22*n,b=z,f=p,n=y;var V=this.localAxis2;return V.x=b,V.y=f,V.z=n,this}};x.dynamics.constraint.joint.GenericJoint=class extends x.dynamics.constraint.joint.Joint{constructor(a){super(a,x.dynamics.constraint.joint.JointType.GENERIC);var t,i=a.localBasis1;if(i.e00*(i.e11*i.e22-i.e12*i.e21)-i.e01*(i.e10*i.e22-i.e12*i.e20)+i.e02*(i.e10*i.e21-i.e11*i.e20)<0)t=!0;else{var r=a.localBasis2;t=r.e00*(r.e11*r.e22-r.e12*r.e21)-r.e01*(r.e10*r.e22-r.e12*r.e20)+r.e02*(r.e10*r.e21-r.e11*r.e20)<0}t&&console.log("src/oimo/dynamics/constraint/joint/GenericJoint.hx:50:","[warning] joint basis must be right handed");var o,s,_,h,v,e,l,u,b,f,n,c,z,p,y,V,M,I,k=a.localBasis1;o=k.e00,s=k.e01,_=k.e02,h=k.e10,v=k.e11,e=k.e12,l=k.e20,u=k.e21,b=k.e22;var X=a.localBasis2;f=X.e00,n=X.e01,c=X.e02,z=X.e10,p=X.e11,y=X.e12,V=X.e20,M=X.e21,I=X.e22,this._localBasisX1X=o,this._localBasisX1Y=h,this._localBasisX1Z=l,this._localBasisY1X=s,this._localBasisY1Y=v,this._localBasisY1Z=u,this._localBasisZ1X=_,this._localBasisZ1Y=e,this._localBasisZ1Z=b,this._localBasisX2X=f,this._localBasisX2Y=z,this._localBasisX2Z=V,this._localBasisY2X=n,this._localBasisY2Y=p,this._localBasisY2Z=M,this._localBasisZ2X=c,this._localBasisZ2Y=y,this._localBasisZ2Z=I,this._angleX=0,this._angleY=0,this._angleZ=0,this.translationX=0,this.translationY=0,this.translationZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1;var L=new Array(3);this._translLms=L;var m=new Array(3);this._translSds=m;var g=new Array(3);this._rotLms=g;var N=new Array(3);this._rotSds=N,this._translLms[0]=a.translationalLimitMotors[0].clone(),this._translLms[1]=a.translationalLimitMotors[1].clone(),this._translLms[2]=a.translationalLimitMotors[2].clone(),this._translSds[0]=a.translationalSpringDampers[0].clone(),this._translSds[1]=a.translationalSpringDampers[1].clone(),this._translSds[2]=a.translationalSpringDampers[2].clone(),this._rotLms[0]=a.rotationalLimitMotors[0].clone(),this._rotLms[1]=a.rotationalLimitMotors[1].clone(),this._rotLms[2]=a.rotationalLimitMotors[2].clone(),this._rotSds[0]=a.rotationalSpringDampers[0].clone(),this._rotSds[1]=a.rotationalSpringDampers[1].clone(),this._rotSds[2]=a.rotationalSpringDampers[2].clone()}getInfo(a,t,i){var r,o,s=1/(this._b1._invMass+this._b2._invMass),_=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),h=this.computeEffectiveInertiaMoment(this._axisYX,this._axisYY,this._axisYZ),v=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ);if(this._translSds[0].frequency<=0||!i){var e=this._impulses[0],l=a.rows[a.numRows++],u=l.jacobian;u.lin1X=0,u.lin1Y=0,u.lin1Z=0,u.lin2X=0,u.lin2Y=0,u.lin2Z=0,u.ang1X=0,u.ang1Y=0,u.ang1Z=0,u.ang2X=0,u.ang2Y=0,u.ang2Z=0,l.rhs=0,l.cfm=0,l.minImpulse=0,l.maxImpulse=0,l.motorSpeed=0,l.motorMaxImpulse=0,l.impulse=null,l.impulse=e,r=l,this.setSolverInfoRowLinear(r,this.translationX,this._translLms[0],s,this._translSds[0],t,i),o=r.jacobian,o.lin1X=this._basisX1X,o.lin1Y=this._basisX1Y,o.lin1Z=this._basisX1Z,o.lin2X=this._basisX1X,o.lin2Y=this._basisX1Y,o.lin2Z=this._basisX1Z,o.ang1X=this._relativeAnchor1Y*this._basisX1Z-this._relativeAnchor1Z*this._basisX1Y,o.ang1Y=this._relativeAnchor1Z*this._basisX1X-this._relativeAnchor1X*this._basisX1Z,o.ang1Z=this._relativeAnchor1X*this._basisX1Y-this._relativeAnchor1Y*this._basisX1X,o.ang2X=this._relativeAnchor2Y*this._basisX1Z-this._relativeAnchor2Z*this._basisX1Y,o.ang2Y=this._relativeAnchor2Z*this._basisX1X-this._relativeAnchor2X*this._basisX1Z,o.ang2Z=this._relativeAnchor2X*this._basisX1Y-this._relativeAnchor2Y*this._basisX1X}if(this._translSds[1].frequency<=0||!i){var b=this._impulses[1],f=a.rows[a.numRows++],n=f.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,f.rhs=0,f.cfm=0,f.minImpulse=0,f.maxImpulse=0,f.motorSpeed=0,f.motorMaxImpulse=0,f.impulse=null,f.impulse=b,r=f,this.setSolverInfoRowLinear(r,this.translationY,this._translLms[1],s,this._translSds[1],t,i),o=r.jacobian,o.lin1X=this._basisY1X,o.lin1Y=this._basisY1Y,o.lin1Z=this._basisY1Z,o.lin2X=this._basisY1X,o.lin2Y=this._basisY1Y,o.lin2Z=this._basisY1Z,o.ang1X=this._relativeAnchor1Y*this._basisY1Z-this._relativeAnchor1Z*this._basisY1Y,o.ang1Y=this._relativeAnchor1Z*this._basisY1X-this._relativeAnchor1X*this._basisY1Z,o.ang1Z=this._relativeAnchor1X*this._basisY1Y-this._relativeAnchor1Y*this._basisY1X,o.ang2X=this._relativeAnchor2Y*this._basisY1Z-this._relativeAnchor2Z*this._basisY1Y,o.ang2Y=this._relativeAnchor2Z*this._basisY1X-this._relativeAnchor2X*this._basisY1Z,o.ang2Z=this._relativeAnchor2X*this._basisY1Y-this._relativeAnchor2Y*this._basisY1X}if(this._translSds[2].frequency<=0||!i){var c=this._impulses[2],z=a.rows[a.numRows++],p=z.jacobian;p.lin1X=0,p.lin1Y=0,p.lin1Z=0,p.lin2X=0,p.lin2Y=0,p.lin2Z=0,p.ang1X=0,p.ang1Y=0,p.ang1Z=0,p.ang2X=0,p.ang2Y=0,p.ang2Z=0,z.rhs=0,z.cfm=0,z.minImpulse=0,z.maxImpulse=0,z.motorSpeed=0,z.motorMaxImpulse=0,z.impulse=null,z.impulse=c,r=z,this.setSolverInfoRowLinear(r,this.translationZ,this._translLms[2],s,this._translSds[2],t,i),o=r.jacobian,o.lin1X=this._basisZ1X,o.lin1Y=this._basisZ1Y,o.lin1Z=this._basisZ1Z,o.lin2X=this._basisZ1X,o.lin2Y=this._basisZ1Y,o.lin2Z=this._basisZ1Z,o.ang1X=this._relativeAnchor1Y*this._basisZ1Z-this._relativeAnchor1Z*this._basisZ1Y,o.ang1Y=this._relativeAnchor1Z*this._basisZ1X-this._relativeAnchor1X*this._basisZ1Z,o.ang1Z=this._relativeAnchor1X*this._basisZ1Y-this._relativeAnchor1Y*this._basisZ1X,o.ang2X=this._relativeAnchor2Y*this._basisZ1Z-this._relativeAnchor2Z*this._basisZ1Y,o.ang2Y=this._relativeAnchor2Z*this._basisZ1X-this._relativeAnchor2X*this._basisZ1Z,o.ang2Z=this._relativeAnchor2X*this._basisZ1Y-this._relativeAnchor2Y*this._basisZ1X}if(!this.xSingular&&(this._rotSds[0].frequency<=0||!i)){var y=this._impulses[3],V=a.rows[a.numRows++],M=V.jacobian;M.lin1X=0,M.lin1Y=0,M.lin1Z=0,M.lin2X=0,M.lin2Y=0,M.lin2Z=0,M.ang1X=0,M.ang1Y=0,M.ang1Z=0,M.ang2X=0,M.ang2Y=0,M.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=y,r=V,this.setSolverInfoRowAngular(r,this._angleX,this._rotLms[0],_,this._rotSds[0],t,i),o=r.jacobian,o.ang1X=this._axisXX,o.ang1Y=this._axisXY,o.ang1Z=this._axisXZ,o.ang2X=this._axisXX,o.ang2Y=this._axisXY,o.ang2Z=this._axisXZ}if(!this.ySingular&&(this._rotSds[1].frequency<=0||!i)){var I=this._impulses[4],k=a.rows[a.numRows++],X=k.jacobian;X.lin1X=0,X.lin1Y=0,X.lin1Z=0,X.lin2X=0,X.lin2Y=0,X.lin2Z=0,X.ang1X=0,X.ang1Y=0,X.ang1Z=0,X.ang2X=0,X.ang2Y=0,X.ang2Z=0,k.rhs=0,k.cfm=0,k.minImpulse=0,k.maxImpulse=0,k.motorSpeed=0,k.motorMaxImpulse=0,k.impulse=null,k.impulse=I,r=k,this.setSolverInfoRowAngular(r,this._angleY,this._rotLms[1],h,this._rotSds[1],t,i),o=r.jacobian,o.ang1X=this._axisYX,o.ang1Y=this._axisYY,o.ang1Z=this._axisYZ,o.ang2X=this._axisYX,o.ang2Y=this._axisYY,o.ang2Z=this._axisYZ}if(!this.zSingular&&(this._rotSds[2].frequency<=0||!i)){var L=this._impulses[5],m=a.rows[a.numRows++],g=m.jacobian;g.lin1X=0,g.lin1Y=0,g.lin1Z=0,g.lin2X=0,g.lin2Y=0,g.lin2Z=0,g.ang1X=0,g.ang1Y=0,g.ang1Z=0,g.ang2X=0,g.ang2Y=0,g.ang2Z=0,m.rhs=0,m.cfm=0,m.minImpulse=0,m.maxImpulse=0,m.motorSpeed=0,m.motorMaxImpulse=0,m.impulse=null,m.impulse=L,r=m,this.setSolverInfoRowAngular(r,this._angleZ,this._rotLms[2],v,this._rotSds[2],t,i),o=r.jacobian,o.ang1X=this._axisZX,o.ang1Y=this._axisZY,o.ang1Z=this._axisZZ,o.ang2X=this._axisZX,o.ang2Y=this._axisZY,o.ang2Z=this._axisZZ}}_syncAnchors(){super._syncAnchors(),this._basisX1X,this._basisY1X,this._basisZ1X,this._basisX1Y,this._basisY1Y,this._basisZ1Y,this._basisX1Z,this._basisY1Z,this._basisZ1Z,this._basisX2X,this._basisY2X,this._basisZ2X,this._basisX2Y,this._basisY2Y,this._basisZ2Y,this._basisX2Z,this._basisY2Z,this._basisZ2Z;var a,t,i,r,o,s,_,h,v;a=this._basisX1X,t=this._basisX1Y,i=this._basisX1Z,_=this._basisZ2X,h=this._basisZ2Y,v=this._basisZ2Z,r=h*i-v*t,o=v*a-_*i,s=_*t-h*a,this._axisXX=o*v-s*h,this._axisXY=s*_-r*v,this._axisXZ=r*h-o*_,this._axisYX=r,this._axisYY=o,this._axisYZ=s,this._axisZX=t*s-i*o,this._axisZY=i*r-a*s,this._axisZZ=a*o-t*r;var e=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;e>0&&(e=1/Math.sqrt(e)),this._axisXX*=e,this._axisXY*=e,this._axisXZ*=e;var l=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;l>0&&(l=1/Math.sqrt(l)),this._axisYX*=l,this._axisYY*=l,this._axisYZ*=l;var u=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;u>0&&(u=1/Math.sqrt(u)),this._axisZX*=u,this._axisZY*=u,this._axisZZ*=u,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0;var b,f,n,c,z,p,y,V,M,I,k,X,L,m,g,N,A,F;b=this._basisX1X,f=this._basisY1X,n=this._basisZ1X,c=this._basisX1Y,z=this._basisY1Y,p=this._basisZ1Y,y=this._basisX1Z,V=this._basisY1Z,M=this._basisZ1Z,I=this._basisX2X,k=this._basisY2X,X=this._basisZ2X,L=this._basisX2Y,m=this._basisY2Y,g=this._basisZ2Y,N=this._basisX2Z,A=this._basisY2Z,F=this._basisZ2Z;var P,Y,R,C,d,Z,$,K,E,J,B,Q,U,G;K=b*I+c*L+y*N,E=b*k+c*m+y*A,J=b*X+c*g+y*F,B=f*k+z*m+V*A,Q=f*X+z*g+V*F,U=n*k+p*m+M*A,G=n*X+p*g+M*F,P=K,Y=E,R=J,C=B,d=Q,Z=U,$=G;var D,H,j,ia=R;if(ia<=-1){var sa=Math.atan2(Z,C);D=sa*.5,H=-1.570796326794895,j=-sa*.5}else if(ia>=1){var W=Math.atan2(Z,C);D=W*.5,H=1.570796326794895,j=W*.5}else{var q=Math.asin(ia),na=Math.atan2(-d,$),oa=Math.atan2(-Y,P);D=na,H=q,j=oa}this._angleX=D,this._angleY=H,this._angleZ=j;var aa,T,ca;aa=this._anchor2X-this._anchor1X,T=this._anchor2Y-this._anchor1Y,ca=this._anchor2Z-this._anchor1Z,this.translationX=aa*this._basisX1X+T*this._basisX1Y+ca*this._basisX1Z,this.translationY=aa*this._basisY1X+T*this._basisY1Y+ca*this._basisY1Z,this.translationZ=aa*this._basisZ1X+T*this._basisZ1Y+ca*this._basisZ1Z}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxisX(){var a=new x.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxisY(){var a=new x.common.Vec3,t=a;return t.x=this._axisYX,t.y=this._axisYY,t.z=this._axisYZ,a}getAxisZ(){var a=new x.common.Vec3,t=a;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,a}getTranslationalSpringDampers(){return this._translSds.slice(0)}getRotationalSpringDampers(){return this._translSds.slice(0)}getTranslationalLimitMotors(){return this._translLms.slice(0)}getRotationalLimitMotors(){return this._rotLms.slice(0)}getAngles(){return new x.common.Vec3(this._angleX,this._angleY,this._angleZ)}getTranslations(){return new x.common.Vec3(this.translationX,this.translationY,this.translationZ)}};x.dynamics.constraint.joint.GenericJointConfig=class extends x.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localBasis1=new x.common.Mat3,this.localBasis2=new x.common.Mat3;var a=[];a.push(new x.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),a.push(new x.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),a.push(new x.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),this.translationalLimitMotors=a;var t=[];t.push(new x.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),t.push(new x.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),t.push(new x.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),this.rotationalLimitMotors=t,this.translationalSpringDampers=[new x.dynamics.constraint.joint.SpringDamper,new x.dynamics.constraint.joint.SpringDamper,new x.dynamics.constraint.joint.SpringDamper],this.rotationalSpringDampers=[new x.dynamics.constraint.joint.SpringDamper,new x.dynamics.constraint.joint.SpringDamper,new x.dynamics.constraint.joint.SpringDamper]}init(a,t,i,r,o){this._init(a,t,i);var s=a._transform,_=t._transform,h,v,e,l,u,b,f,n,c,z,p,y,V,M,I,k,X,L,m,g,N,A,F,P,Y,R,C,d,Z,$,K,E,J,B,Q,U,G=r;h=G.e00,v=G.e01,e=G.e02,l=G.e10,u=G.e11,b=G.e12,f=G.e20,n=G.e21,c=G.e22;var D=o;z=D.e00,p=D.e01,y=D.e02,V=D.e10,M=D.e11,I=D.e12,k=D.e20,X=D.e21,L=D.e22;var H,j,ia,sa,W,q,na,oa,aa;H=s._rotation00*h+s._rotation10*l+s._rotation20*f,j=s._rotation00*v+s._rotation10*u+s._rotation20*n,ia=s._rotation00*e+s._rotation10*b+s._rotation20*c,sa=s._rotation01*h+s._rotation11*l+s._rotation21*f,W=s._rotation01*v+s._rotation11*u+s._rotation21*n,q=s._rotation01*e+s._rotation11*b+s._rotation21*c,na=s._rotation02*h+s._rotation12*l+s._rotation22*f,oa=s._rotation02*v+s._rotation12*u+s._rotation22*n,aa=s._rotation02*e+s._rotation12*b+s._rotation22*c,m=H,g=j,N=ia,A=sa,F=W,P=q,Y=na,R=oa,C=aa;var T,ca,_a,w,ta,ra,la,va,xa;T=_._rotation00*z+_._rotation10*V+_._rotation20*k,ca=_._rotation00*p+_._rotation10*M+_._rotation20*X,_a=_._rotation00*y+_._rotation10*I+_._rotation20*L,w=_._rotation01*z+_._rotation11*V+_._rotation21*k,ta=_._rotation01*p+_._rotation11*M+_._rotation21*X,ra=_._rotation01*y+_._rotation11*I+_._rotation21*L,la=_._rotation02*z+_._rotation12*V+_._rotation22*k,va=_._rotation02*p+_._rotation12*M+_._rotation22*X,xa=_._rotation02*y+_._rotation12*I+_._rotation22*L,d=T,Z=ca,$=_a,K=w,E=ta,J=ra,B=la,Q=va,U=xa;var za=this.localBasis1;za.e00=m,za.e01=g,za.e02=N,za.e10=A,za.e11=F,za.e12=P,za.e20=Y,za.e21=R,za.e22=C;var Ma=this.localBasis2;return Ma.e00=d,Ma.e01=Z,Ma.e02=$,Ma.e10=K,Ma.e11=E,Ma.e12=J,Ma.e20=B,Ma.e21=Q,Ma.e22=U,this}};x.dynamics.constraint.joint.JointImpulse=class{constructor(){this.impulse=0,this.impulseM=0,this.impulseP=0}};x.dynamics.constraint.joint.JointLink=class{constructor(a){this._joint=a}getContact(){return this._joint}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}};x.dynamics.constraint.joint.JointMacro=class{};x.dynamics.constraint.joint.JointType=class{};x.dynamics.constraint.joint.PrismaticJoint=class extends x.dynamics.constraint.joint.Joint{constructor(a){super(a,x.dynamics.constraint.joint.JointType.PRISMATIC);var t=a.localAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var i=a.localAxis2;this._localBasisX2X=i.x,this._localBasisX2Y=i.y,this._localBasisX2Z=i.z,this.buildLocalBasesFromX(),this._basis=new x.dynamics.constraint.joint.BasisTracker(this),this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this.angularErrorX=0,this.angularErrorY=0,this.angularErrorZ=0,this._sd=a.springDamper.clone(),this._lm=a.limitMotor.clone()}getInfo(a,t,i){var r=this.getErp(t,i),o=this.linearErrorY*r,s=this.linearErrorZ*r,_=this.angularErrorX*r,h=this.angularErrorY*r,v=this.angularErrorZ*r,e,l,u=1/(this._b1._invMass+this._b2._invMass);if(this._sd.frequency<=0||!i){var b=this._impulses[0],f=a.rows[a.numRows++],n=f.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,f.rhs=0,f.cfm=0,f.minImpulse=0,f.maxImpulse=0,f.motorSpeed=0,f.motorMaxImpulse=0,f.impulse=null,f.impulse=b,e=f,this.setSolverInfoRowLinear(e,this.translation,this._lm,u,this._sd,t,i),l=e.jacobian,l.lin1X=this._basis.xX,l.lin1Y=this._basis.xY,l.lin1Z=this._basis.xZ,l.lin2X=this._basis.xX,l.lin2Y=this._basis.xY,l.lin2Z=this._basis.xZ,l.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,l.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,l.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,l.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,l.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,l.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}var c=this._impulses[1],z=a.rows[a.numRows++],p=z.jacobian;p.lin1X=0,p.lin1Y=0,p.lin1Z=0,p.lin2X=0,p.lin2Y=0,p.lin2Z=0,p.ang1X=0,p.ang1Y=0,p.ang1Z=0,p.ang2X=0,p.ang2Y=0,p.ang2Z=0,z.rhs=0,z.cfm=0,z.minImpulse=0,z.maxImpulse=0,z.motorSpeed=0,z.motorMaxImpulse=0,z.impulse=null,z.impulse=c,e=z,e.rhs=o,e.cfm=0,e.minImpulse=-1/0,e.maxImpulse=1/0,l=e.jacobian,l.lin1X=this._basis.yX,l.lin1Y=this._basis.yY,l.lin1Z=this._basis.yZ,l.lin2X=this._basis.yX,l.lin2Y=this._basis.yY,l.lin2Z=this._basis.yZ,l.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,l.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,l.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,l.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,l.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,l.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;var y=this._impulses[2],V=a.rows[a.numRows++],M=V.jacobian;M.lin1X=0,M.lin1Y=0,M.lin1Z=0,M.lin2X=0,M.lin2Y=0,M.lin2Z=0,M.ang1X=0,M.ang1Y=0,M.ang1Z=0,M.ang2X=0,M.ang2Y=0,M.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=y,e=V,e.rhs=s,e.cfm=0,e.minImpulse=-1/0,e.maxImpulse=1/0,l=e.jacobian,l.lin1X=this._basis.zX,l.lin1Y=this._basis.zY,l.lin1Z=this._basis.zZ,l.lin2X=this._basis.zX,l.lin2Y=this._basis.zY,l.lin2Z=this._basis.zZ,l.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,l.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,l.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,l.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,l.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,l.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX;var I=this._impulses[3],k=a.rows[a.numRows++],X=k.jacobian;X.lin1X=0,X.lin1Y=0,X.lin1Z=0,X.lin2X=0,X.lin2Y=0,X.lin2Z=0,X.ang1X=0,X.ang1Y=0,X.ang1Z=0,X.ang2X=0,X.ang2Y=0,X.ang2Z=0,k.rhs=0,k.cfm=0,k.minImpulse=0,k.maxImpulse=0,k.motorSpeed=0,k.motorMaxImpulse=0,k.impulse=null,k.impulse=I,e=k,e.rhs=_,e.cfm=0,e.minImpulse=-1/0,e.maxImpulse=1/0,l=e.jacobian,l.ang1X=1,l.ang1Y=0,l.ang1Z=0,l.ang2X=1,l.ang2Y=0,l.ang2Z=0;var L=this._impulses[4],m=a.rows[a.numRows++],g=m.jacobian;g.lin1X=0,g.lin1Y=0,g.lin1Z=0,g.lin2X=0,g.lin2Y=0,g.lin2Z=0,g.ang1X=0,g.ang1Y=0,g.ang1Z=0,g.ang2X=0,g.ang2Y=0,g.ang2Z=0,m.rhs=0,m.cfm=0,m.minImpulse=0,m.maxImpulse=0,m.motorSpeed=0,m.motorMaxImpulse=0,m.impulse=null,m.impulse=L,e=m,e.rhs=h,e.cfm=0,e.minImpulse=-1/0,e.maxImpulse=1/0,l=e.jacobian,l.ang1X=0,l.ang1Y=1,l.ang1Z=0,l.ang2X=0,l.ang2Y=1,l.ang2Z=0;var N=this._impulses[5],A=a.rows[a.numRows++],F=A.jacobian;F.lin1X=0,F.lin1Y=0,F.lin1Z=0,F.lin2X=0,F.lin2Y=0,F.lin2Z=0,F.ang1X=0,F.ang1Y=0,F.ang1Z=0,F.ang2X=0,F.ang2Y=0,F.ang2Z=0,A.rhs=0,A.cfm=0,A.minImpulse=0,A.maxImpulse=0,A.motorSpeed=0,A.motorMaxImpulse=0,A.impulse=null,A.impulse=N,e=A,e.rhs=v,e.cfm=0,e.minImpulse=-1/0,e.maxImpulse=1/0,l=e.jacobian,l.ang1X=0,l.ang1Y=0,l.ang1Z=1,l.ang2X=0,l.ang2Y=0,l.ang2Z=1}_syncAnchors(){super._syncAnchors();var a=this._basis,t=a.joint._b1._invMass,i=a.joint._b2._invMass,r,o,s,_,h,v,e,l,u,b,f,n,c,z,p,y,V,M,I,k,X,L,m,g,N,A,F,P,Y,R,C,d,Z,$,K,E,J=a.joint._basisX1X*a.joint._basisX2X+a.joint._basisX1Y*a.joint._basisX2Y+a.joint._basisX1Z*a.joint._basisX2Z;if(J<-.999999999){var B,Q,U,G=a.joint._basisX1X,D=a.joint._basisX1Y,H=a.joint._basisX1Z,j=G*G,ia=D*D,sa=H*H,W;j<ia?j<sa?(W=1/Math.sqrt(ia+sa),B=0,Q=H*W,U=-D*W):(W=1/Math.sqrt(j+ia),B=D*W,Q=-G*W,U=0):ia<sa?(W=1/Math.sqrt(sa+j),B=-H*W,Q=0,U=G*W):(W=1/Math.sqrt(j+ia),B=D*W,Q=-G*W,U=0),r=B,o=Q,s=U,_=0}else{var q,na,oa;q=a.joint._basisX1Y*a.joint._basisX2Z-a.joint._basisX1Z*a.joint._basisX2Y,na=a.joint._basisX1Z*a.joint._basisX2X-a.joint._basisX1X*a.joint._basisX2Z,oa=a.joint._basisX1X*a.joint._basisX2Y-a.joint._basisX1Y*a.joint._basisX2X;var aa=Math.sqrt((1+J)*.5);J=.5/aa,q*=J,na*=J,oa*=J,r=q,o=na,s=oa,_=aa}h=0,v=0,e=0,l=1;var T,ca,_a,w,ta,ra,la,va;T=h,ca=v,_a=e,w=l,ta=r,ra=o,la=s,va=_;var xa=T*ta+ca*ra+_a*la+w*va;if(xa<0&&(xa=-xa,ta=-ta,ra=-ra,la=-la,va=-va),xa>.999999){var za,Ma,Xa,Za;za=ta-T,Ma=ra-ca,Xa=la-_a,Za=va-w,ta=T+za*(t/(t+i)),ra=ca+Ma*(t/(t+i)),la=_a+Xa*(t/(t+i)),va=w+Za*(t/(t+i));var fa=ta*ta+ra*ra+la*la+va*va;fa>1e-32&&(fa=1/Math.sqrt(fa)),u=ta*fa,b=ra*fa,f=la*fa,n=va*fa}else{var ba=t/(t+i)*Math.acos(xa);ta+=T*-xa,ra+=ca*-xa,la+=_a*-xa,va+=w*-xa;var ea=ta*ta+ra*ra+la*la+va*va;ea>1e-32&&(ea=1/Math.sqrt(ea)),ta*=ea,ra*=ea,la*=ea,va*=ea;var ha=Math.sin(ba),ma=Math.cos(ba);T*=ma,ca*=ma,_a*=ma,w*=ma,u=T+ta*ha,b=ca+ra*ha,f=_a+la*ha,n=w+va*ha}var ya=u,da=b,pa=f,Ya=n,Qa=2*ya,ga=2*da,ua=2*pa,wa=ya*Qa,ka=da*ga,Sa=pa*ua,zt=ya*ga,Ha=da*ua,Ba=ya*ua,nt=Ya*Qa,Ea=Ya*ga,Fa=Ya*ua;c=1-ka-Sa,z=zt-Fa,p=Ba+Ea,y=zt+Fa,V=1-wa-Sa,M=Ha-nt,I=Ba-Ea,k=Ha+nt,X=1-wa-ka;var Aa,ft,Wa;Aa=c*a.joint._basisX1X+z*a.joint._basisX1Y+p*a.joint._basisX1Z,ft=y*a.joint._basisX1X+V*a.joint._basisX1Y+M*a.joint._basisX1Z,Wa=I*a.joint._basisX1X+k*a.joint._basisX1Y+X*a.joint._basisX1Z,L=Aa,m=ft,g=Wa,C=a.xX,d=a.xY,Z=a.xZ,$=a.yX,K=a.yY,E=a.yZ;var Ka=C*L+d*m+Z*g;if(Ka<-.999999999){var bt,it,$a,_t=C,gt=d,pt=Z,Ga=_t*_t,rt=gt*gt,ut=pt*pt,Da;Ga<rt?Ga<ut?(Da=1/Math.sqrt(rt+ut),bt=0,it=pt*Da,$a=-gt*Da):(Da=1/Math.sqrt(Ga+rt),bt=gt*Da,it=-_t*Da,$a=0):rt<ut?(Da=1/Math.sqrt(ut+Ga),bt=-pt*Da,it=0,$a=_t*Da):(Da=1/Math.sqrt(Ga+rt),bt=gt*Da,it=-_t*Da,$a=0),u=bt,b=it,f=$a,n=0}else{var Ta,Na,Vt;Ta=d*g-Z*m,Na=Z*L-C*g,Vt=C*m-d*L;var St=Math.sqrt((1+Ka)*.5);Ka=.5/St,Ta*=Ka,Na*=Ka,Vt*=Ka,u=Ta,b=Na,f=Vt,n=St}var et=u,Xt=b,Yt=f,Mt=n,Ia=2*et,O=2*Xt,Va=2*Yt,lt=et*Ia,S=Xt*O,wt=Yt*Va,Bt=et*O,At=Xt*Va,yt=et*Va,kt=Mt*Ia,mt=Mt*O,ht=Mt*Va;c=1-S-wt,z=Bt-ht,p=yt+mt,y=Bt+ht,V=1-lt-wt,M=At-kt,I=yt-mt,k=At+kt,X=1-lt-S;var xt,Ra,st;if(xt=c*$+z*K+p*E,Ra=y*$+V*K+M*E,st=I*$+k*K+X*E,N=xt,A=Ra,F=st,P=m*F-g*A,Y=g*N-L*F,R=L*A-m*N,P*P+Y*Y+R*R>1e-6){var Ca=P*P+Y*Y+R*R;Ca>0&&(Ca=1/Math.sqrt(Ca)),P*=Ca,Y*=Ca,R*=Ca}else{var vt=L,qa=m,at=g,Oa=vt*vt,tt=qa*qa,ct=at*at,Pa;Oa<tt?Oa<ct?(Pa=1/Math.sqrt(tt+ct),P=0,Y=at*Pa,R=-qa*Pa):(Pa=1/Math.sqrt(Oa+tt),P=qa*Pa,Y=-vt*Pa,R=0):tt<ct?(Pa=1/Math.sqrt(ct+Oa),P=-at*Pa,Y=0,R=vt*Pa):(Pa=1/Math.sqrt(Oa+tt),P=qa*Pa,Y=-vt*Pa,R=0)}N=Y*g-R*m,A=R*L-P*g,F=P*m-Y*L,a.xX=L,a.xY=m,a.xZ=g,a.yX=N,a.yY=A,a.yZ=F,a.zX=P,a.zY=Y,a.zZ=R;var Ja,ja,La,ot,It,oi,gi,ai,Ct,_i,Et,Pt,Jt,Ki,vi,li,ti,Oi;Ja=this._basisX1X,ja=this._basisY1X,La=this._basisZ1X,ot=this._basisX1Y,It=this._basisY1Y,oi=this._basisZ1Y,gi=this._basisX1Z,ai=this._basisY1Z,Ct=this._basisZ1Z,_i=this._basisX2X,Et=this._basisY2X,Pt=this._basisZ2X,Jt=this._basisX2Y,Ki=this._basisY2Y,vi=this._basisZ2Y,li=this._basisX2Z,ti=this._basisY2Z,Oi=this._basisZ2Z;var Xi,zi,Zt,ri,Wt,ni,$i,Ut,ji,Ii,pr,Wi,Lt,jt,Tt,bi,Mi,vr;Ii=_i*Ja+Et*ja+Pt*La,pr=_i*ot+Et*It+Pt*oi,Wi=_i*gi+Et*ai+Pt*Ct,Lt=Jt*Ja+Ki*ja+vi*La,jt=Jt*ot+Ki*It+vi*oi,Tt=Jt*gi+Ki*ai+vi*Ct,bi=li*Ja+ti*ja+Oi*La,Mi=li*ot+ti*It+Oi*oi,vr=li*gi+ti*ai+Oi*Ct,Xi=Ii,zi=pr,Zt=Wi,ri=Lt,Wt=jt,ni=Tt,$i=bi,Ut=Mi,ji=vr;var qt,fi,dt,ui,hi=Xi,er=Wt,Xr=ji,ro=hi+er+Xr,Gt;ro>0?(Gt=Math.sqrt(ro+1),ui=.5*Gt,Gt=.5/Gt,qt=(Ut-ni)*Gt,fi=(Zt-$i)*Gt,dt=(ri-zi)*Gt):hi>er?hi>Xr?(Gt=Math.sqrt(hi-er-Xr+1),qt=.5*Gt,Gt=.5/Gt,fi=(zi+ri)*Gt,dt=(Zt+$i)*Gt,ui=(Ut-ni)*Gt):(Gt=Math.sqrt(Xr-hi-er+1),dt=.5*Gt,Gt=.5/Gt,qt=(Zt+$i)*Gt,fi=(ni+Ut)*Gt,ui=(ri-zi)*Gt):er>Xr?(Gt=Math.sqrt(er-Xr-hi+1),fi=.5*Gt,Gt=.5/Gt,qt=(zi+ri)*Gt,dt=(ni+Ut)*Gt,ui=(Zt-$i)*Gt):(Gt=Math.sqrt(Xr-hi-er+1),dt=.5*Gt,Gt=.5/Gt,qt=(Zt+$i)*Gt,fi=(ni+Ut)*Gt,ui=(ri-zi)*Gt);var fr=ui,mr=(fr<=-1?3.14159265358979:fr>=1?0:Math.acos(fr))*2;this.angularErrorX=qt,this.angularErrorY=fi,this.angularErrorZ=dt;var Dt=this.angularErrorX*this.angularErrorX+this.angularErrorY*this.angularErrorY+this.angularErrorZ*this.angularErrorZ;Dt>0&&(Dt=1/Math.sqrt(Dt)),this.angularErrorX*=Dt,this.angularErrorY*=Dt,this.angularErrorZ*=Dt,this.angularErrorX*=mr,this.angularErrorY*=mr,this.angularErrorZ*=mr;var dr,Pi,Dr;dr=this._anchor2X-this._anchor1X,Pi=this._anchor2Y-this._anchor1Y,Dr=this._anchor2Z-this._anchor1Z,this.translation=dr*this._basis.xX+Pi*this._basis.xY+Dr*this._basis.xZ,this.linearErrorY=dr*this._basis.yX+Pi*this._basis.yY+Dr*this._basis.yZ,this.linearErrorZ=dr*this._basis.zX+Pi*this._basis.zY+Dr*this._basis.zZ}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,a}getAxis1To(a){var t=a;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(a){var t=a;t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,a}getLocalAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,a}getLocalAxis1To(a){var t=a;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(a){var t=a;t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getTranslation(){return this.translation}};x.dynamics.constraint.joint.PrismaticJointConfig=class extends x.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new x.common.Vec3(1,0,0),this.localAxis2=new x.common.Vec3(1,0,0),this.limitMotor=new x.dynamics.constraint.joint.TranslationalLimitMotor,this.springDamper=new x.dynamics.constraint.joint.SpringDamper}init(a,t,i,r){this._init(a,t,i);var o,s,_,h=r;o=h.x,s=h.y,_=h.z;var v,e,l;v=a._transform._rotation00*o+a._transform._rotation10*s+a._transform._rotation20*_,e=a._transform._rotation01*o+a._transform._rotation11*s+a._transform._rotation21*_,l=a._transform._rotation02*o+a._transform._rotation12*s+a._transform._rotation22*_,o=v,s=e,_=l;var u=this.localAxis1;u.x=o,u.y=s,u.z=_;var b,f,n,c=r;b=c.x,f=c.y,n=c.z;var z,p,y;z=t._transform._rotation00*b+t._transform._rotation10*f+t._transform._rotation20*n,p=t._transform._rotation01*b+t._transform._rotation11*f+t._transform._rotation21*n,y=t._transform._rotation02*b+t._transform._rotation12*f+t._transform._rotation22*n,b=z,f=p,n=y;var V=this.localAxis2;return V.x=b,V.y=f,V.z=n,this}};x.dynamics.constraint.joint.RagdollJoint=class extends x.dynamics.constraint.joint.Joint{constructor(a){super(a,x.dynamics.constraint.joint.JointType.RAGDOLL);var t=a.localTwistAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var i=a.localSwingAxis1;this._localBasisY1X=i.x,this._localBasisY1Y=i.y,this._localBasisY1Z=i.z;var r=a.localTwistAxis2;this._localBasisX2X=r.x,this._localBasisX2Y=r.y,this._localBasisX2Z=r.z,this.buildLocalBasesFromXY1X2(),this._twistSd=a.twistSpringDamper.clone(),this._twistLm=a.twistLimitMotor.clone(),this._swingSd=a.swingSpringDamper.clone(),this._maxSwingAngle1=a.maxSwingAngle1,this._maxSwingAngle2=a.maxSwingAngle2,this._maxSwingAngle1<x.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle1=x.common.Setting.minRagdollMaxSwingAngle),this._maxSwingAngle2<x.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle2=x.common.Setting.minRagdollMaxSwingAngle),this.dummySwingLm=new x.dynamics.constraint.joint.RotationalLimitMotor,this.dummySwingLm.lowerLimit=-1,this.dummySwingLm.upperLimit=0,this._swingAngle=0,this._twistAngle=0,this.swingError=0,this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.twistAxisX=0,this.twistAxisY=0,this.twistAxisZ=0}getInfo(a,t,i){var r=this.getErp(t,i),o,s,_;o=this.linearErrorX*r,s=this.linearErrorY*r,_=this.linearErrorZ*r;var h=o,v=s,e=_,l,u,b,f,n,c,z,p,y,V,M,I,k,X,L,m,g,N;l=0,u=-this._relativeAnchor1Z,b=this._relativeAnchor1Y,f=this._relativeAnchor1Z,n=0,c=-this._relativeAnchor1X,z=-this._relativeAnchor1Y,p=this._relativeAnchor1X,y=0,V=0,M=-this._relativeAnchor2Z,I=this._relativeAnchor2Y,k=this._relativeAnchor2Z,X=0,L=-this._relativeAnchor2X,m=-this._relativeAnchor2Y,g=this._relativeAnchor2X,N=0,l=-l,u=-u,b=-b,f=-f,n=-n,c=-c,z=-z,p=-p,y=-y,V=-V,M=-M,I=-I,k=-k,X=-X,L=-L,m=-m,g=-g,N=-N;var A=this.computeEffectiveInertiaMoment(this.swingAxisX,this.swingAxisY,this.swingAxisZ),F=this.computeEffectiveInertiaMoment(this._basisX2X,this._basisX2Y,this._basisX2Z),P=this._impulses[0],Y=a.rows[a.numRows++],R=Y.jacobian;R.lin1X=0,R.lin1Y=0,R.lin1Z=0,R.lin2X=0,R.lin2Y=0,R.lin2Z=0,R.ang1X=0,R.ang1Y=0,R.ang1Z=0,R.ang2X=0,R.ang2Y=0,R.ang2Z=0,Y.rhs=0,Y.cfm=0,Y.minImpulse=0,Y.maxImpulse=0,Y.motorSpeed=0,Y.motorMaxImpulse=0,Y.impulse=null,Y.impulse=P;var C=Y;C.rhs=h,C.cfm=0,C.minImpulse=-1/0,C.maxImpulse=1/0;var d=C.jacobian;d.lin1X=1,d.lin1Y=0,d.lin1Z=0,d.lin2X=1,d.lin2Y=0,d.lin2Z=0,d.ang1X=l,d.ang1Y=u,d.ang1Z=b,d.ang2X=V,d.ang2Y=M,d.ang2Z=I;var Z=this._impulses[1],$=a.rows[a.numRows++],K=$.jacobian;K.lin1X=0,K.lin1Y=0,K.lin1Z=0,K.lin2X=0,K.lin2Y=0,K.lin2Z=0,K.ang1X=0,K.ang1Y=0,K.ang1Z=0,K.ang2X=0,K.ang2Y=0,K.ang2Z=0,$.rhs=0,$.cfm=0,$.minImpulse=0,$.maxImpulse=0,$.motorSpeed=0,$.motorMaxImpulse=0,$.impulse=null,$.impulse=Z,C=$,C.rhs=v,C.cfm=0,C.minImpulse=-1/0,C.maxImpulse=1/0,d=C.jacobian,d.lin1X=0,d.lin1Y=1,d.lin1Z=0,d.lin2X=0,d.lin2Y=1,d.lin2Z=0,d.ang1X=f,d.ang1Y=n,d.ang1Z=c,d.ang2X=k,d.ang2Y=X,d.ang2Z=L;var E=this._impulses[2],J=a.rows[a.numRows++],B=J.jacobian;if(B.lin1X=0,B.lin1Y=0,B.lin1Z=0,B.lin2X=0,B.lin2Y=0,B.lin2Z=0,B.ang1X=0,B.ang1Y=0,B.ang1Z=0,B.ang2X=0,B.ang2Y=0,B.ang2Z=0,J.rhs=0,J.cfm=0,J.minImpulse=0,J.maxImpulse=0,J.motorSpeed=0,J.motorMaxImpulse=0,J.impulse=null,J.impulse=E,C=J,C.rhs=e,C.cfm=0,C.minImpulse=-1/0,C.maxImpulse=1/0,d=C.jacobian,d.lin1X=0,d.lin1Y=0,d.lin1Z=1,d.lin2X=0,d.lin2Y=0,d.lin2Z=1,d.ang1X=z,d.ang1Y=p,d.ang1Z=y,d.ang2X=m,d.ang2Y=g,d.ang2Z=N,this.swingError>0&&(this._swingSd.frequency<=0||!i)){var Q=this._impulses[3],U=a.rows[a.numRows++],G=U.jacobian;G.lin1X=0,G.lin1Y=0,G.lin1Z=0,G.lin2X=0,G.lin2Y=0,G.lin2Z=0,G.ang1X=0,G.ang1Y=0,G.ang1Z=0,G.ang2X=0,G.ang2Y=0,G.ang2Z=0,U.rhs=0,U.cfm=0,U.minImpulse=0,U.maxImpulse=0,U.motorSpeed=0,U.motorMaxImpulse=0,U.impulse=null,U.impulse=Q,C=U,this.setSolverInfoRowAngular(C,this.swingError,this.dummySwingLm,A,this._swingSd,t,i),d=C.jacobian,d.ang1X=this.swingAxisX,d.ang1Y=this.swingAxisY,d.ang1Z=this.swingAxisZ,d.ang2X=this.swingAxisX,d.ang2Y=this.swingAxisY,d.ang2Z=this.swingAxisZ}if(this._twistSd.frequency<=0||!i){var D=this._impulses[4],H=a.rows[a.numRows++],j=H.jacobian;j.lin1X=0,j.lin1Y=0,j.lin1Z=0,j.lin2X=0,j.lin2Y=0,j.lin2Z=0,j.ang1X=0,j.ang1Y=0,j.ang1Z=0,j.ang2X=0,j.ang2Y=0,j.ang2Z=0,H.rhs=0,H.cfm=0,H.minImpulse=0,H.maxImpulse=0,H.motorSpeed=0,H.motorMaxImpulse=0,H.impulse=null,H.impulse=D,C=H,this.setSolverInfoRowAngular(C,this._twistAngle,this._twistLm,F,this._twistSd,t,i),d=C.jacobian,d.ang1X=this.twistAxisX,d.ang1Y=this.twistAxisY,d.ang1Z=this.twistAxisZ,d.ang2X=this.twistAxisX,d.ang2Y=this.twistAxisY,d.ang2Z=this.twistAxisZ}}_syncAnchors(){super._syncAnchors(),this._b1._transform,this._b2._transform;var a,t,i,r,o,s;a=this._basisX1X,t=this._basisX1Y,i=this._basisX1Z,r=this._basisX2X,o=this._basisX2Y,s=this._basisX2Z;var _,h,v,e,l,u,b,f,n;_=this._basisX1X,h=this._basisY1X,v=this._basisZ1X,e=this._basisX1Y,l=this._basisY1Y,u=this._basisZ1Y,b=this._basisX1Z,f=this._basisY1Z,n=this._basisZ1Z,this._basisX2X,this._basisY2X,this._basisZ2X,this._basisX2Y,this._basisY2Y,this._basisZ2Y,this._basisX2Z,this._basisY2Z,this._basisZ2Z;var c,z,p,y,V,M,I,k,X,L,m,g,N,A,F,P,Y=a*r+t*o+i*s;if(Y<-.999999999){var R,C,d,Z=a,$=t,K=i,E=Z*Z,J=$*$,B=K*K,Q;E<J?E<B?(Q=1/Math.sqrt(J+B),R=0,C=K*Q,d=-$*Q):(Q=1/Math.sqrt(E+J),R=$*Q,C=-Z*Q,d=0):J<B?(Q=1/Math.sqrt(B+E),R=-K*Q,C=0,d=Z*Q):(Q=1/Math.sqrt(E+J),R=$*Q,C=-Z*Q,d=0),c=R,z=C,p=d,y=0}else{var U,G,D;U=t*s-i*o,G=i*r-a*s,D=a*o-t*r;var H=Math.sqrt((1+Y)*.5);Y=.5/H,U*=Y,G*=Y,D*=Y,c=U,z=G,p=D,y=H}var j=c,ia=z,sa=p,W=y,q=2*j,na=2*ia,oa=2*sa,aa=j*q,T=ia*na,ca=sa*oa,_a=j*na,w=ia*oa,ta=j*oa,ra=W*q,la=W*na,va=W*oa;V=1-T-ca,M=_a-va,I=ta+la,k=_a+va,X=1-aa-ca,L=w-ra,m=ta-la,g=w+ra,N=1-aa-T,this._swingAngle=(y<=-1?3.14159265358979:y>=1?0:Math.acos(y))*2,A=c,F=z,P=p;var xa,za,Ma,Xa,Za,fa;Xa=V*this._basisY2X+k*this._basisY2Y+m*this._basisY2Z,Za=M*this._basisY2X+X*this._basisY2Y+g*this._basisY2Z,fa=I*this._basisY2X+L*this._basisY2Y+N*this._basisY2Z,xa=Xa,za=Za,Ma=fa;var ba=this._basisY1X*xa+this._basisY1Y*za+this._basisY1Z*Ma,ea=this._basisZ1X*xa+this._basisZ1Y*za+this._basisZ1Z*Ma;this._twistAngle=Math.atan2(ea,ba),this.twistAxisX=this._basisX1X+this._basisX2X,this.twistAxisY=this._basisX1Y+this._basisX2Y,this.twistAxisZ=this._basisX1Z+this._basisX2Z;var ha=this.twistAxisX*this.twistAxisX+this.twistAxisY*this.twistAxisY+this.twistAxisZ*this.twistAxisZ;ha>0&&(ha=1/Math.sqrt(ha)),this.twistAxisX*=ha,this.twistAxisY*=ha,this.twistAxisZ*=ha;var ma=Math.sqrt(A*A+F*F+P*P);ma>0&&(ma=1/ma),A*=ma*this._swingAngle,F*=ma*this._swingAngle,P*=ma*this._swingAngle;var ya,da,pa;ya=_*A+e*F+b*P,da=h*A+l*F+f*P,pa=v*A+u*F+n*P,A=ya,F=da,P=pa;var Ya=F,Qa=P,ga=this._maxSwingAngle1,ua=this._maxSwingAngle2,wa=1/(ga*ga),ka=1/(ua*ua),Sa=Ya*Ya*wa+Qa*Qa*ka;if(Sa==0)this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.swingError=0;else{var zt=Math.sqrt(1/Sa),Ha=Ya*zt,Ba=Qa*zt,nt=Ha*wa,Ea=Ba*ka;ma=1/Math.sqrt(nt*nt+Ea*Ea),nt*=ma,Ea*=ma;var Fa=(Ya-Ha)*nt+(Qa-Ba)*Ea;if(Fa>0){this.swingError=Fa,this.swingAxisX=0,this.swingAxisY=nt,this.swingAxisZ=Ea;var Aa,ft,Wa;Aa=_*this.swingAxisX+h*this.swingAxisY+v*this.swingAxisZ,ft=e*this.swingAxisX+l*this.swingAxisY+u*this.swingAxisZ,Wa=b*this.swingAxisX+f*this.swingAxisY+n*this.swingAxisZ,this.swingAxisX=Aa,this.swingAxisY=ft,this.swingAxisZ=Wa;var Ka,bt,it;Ka=V*this.swingAxisX+M*this.swingAxisY+I*this.swingAxisZ,bt=k*this.swingAxisX+X*this.swingAxisY+L*this.swingAxisZ,it=m*this.swingAxisX+g*this.swingAxisY+N*this.swingAxisZ,this.swingAxisX=Ka,this.swingAxisY=bt,this.swingAxisZ=it}else this.swingError=0}this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,a}getAxis1To(a){var t=a;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(a){var t=a;t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,a}getLocalAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,a}getLocalAxis1To(a){var t=a;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(a){var t=a;t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTwistSpringDamper(){return this._twistSd}getTwistLimitMotor(){return this._twistLm}getSwingSpringDamper(){return this._swingSd}getSwingAxis(){var a=new x.common.Vec3,t=a;return t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ,a}getSwingAxisTo(a){var t=a;t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ}getSwingAngle(){return this._swingAngle}getTwistAngle(){return this._twistAngle}};x.dynamics.constraint.joint.RagdollJointConfig=class extends x.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localTwistAxis1=new x.common.Vec3(1,0,0),this.localTwistAxis2=new x.common.Vec3(1,0,0),this.localSwingAxis1=new x.common.Vec3(0,1,0),this.twistSpringDamper=new x.dynamics.constraint.joint.SpringDamper,this.swingSpringDamper=new x.dynamics.constraint.joint.SpringDamper,this.twistLimitMotor=new x.dynamics.constraint.joint.RotationalLimitMotor,this.maxSwingAngle1=3.14159265358979,this.maxSwingAngle2=3.14159265358979}init(a,t,i,r,o){this._init(a,t,i);var s,_,h,v=r;s=v.x,_=v.y,h=v.z;var e,l,u;e=a._transform._rotation00*s+a._transform._rotation10*_+a._transform._rotation20*h,l=a._transform._rotation01*s+a._transform._rotation11*_+a._transform._rotation21*h,u=a._transform._rotation02*s+a._transform._rotation12*_+a._transform._rotation22*h,s=e,_=l,h=u;var b=this.localTwistAxis1;b.x=s,b.y=_,b.z=h;var f,n,c,z=r;f=z.x,n=z.y,c=z.z;var p,y,V;p=t._transform._rotation00*f+t._transform._rotation10*n+t._transform._rotation20*c,y=t._transform._rotation01*f+t._transform._rotation11*n+t._transform._rotation21*c,V=t._transform._rotation02*f+t._transform._rotation12*n+t._transform._rotation22*c,f=p,n=y,c=V;var M=this.localTwistAxis2;M.x=f,M.y=n,M.z=c;var I,k,X,L=o;I=L.x,k=L.y,X=L.z;var m,g,N;m=a._transform._rotation00*I+a._transform._rotation10*k+a._transform._rotation20*X,g=a._transform._rotation01*I+a._transform._rotation11*k+a._transform._rotation21*X,N=a._transform._rotation02*I+a._transform._rotation12*k+a._transform._rotation22*X,I=m,k=g,X=N;var A=this.localSwingAxis1;return A.x=I,A.y=k,A.z=X,this}};x.dynamics.constraint.joint.RevoluteJoint=class extends x.dynamics.constraint.joint.Joint{constructor(a){super(a,1);var t=a.localAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var i=a.localAxis2;this._localBasisX2X=i.x,this._localBasisX2Y=i.y,this._localBasisX2Z=i.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this._basis=new x.dynamics.constraint.joint.BasisTracker(this),this._sd=a.springDamper.clone(),this._lm=a.limitMotor.clone()}getInfo(a,t,i){var r=this.getErp(t,i),o,s,_;o=this.linearErrorX*r,s=this.linearErrorY*r,_=this.linearErrorZ*r;var h=o,v=s,e=_,l=this.angularErrorY*r,u=this.angularErrorZ*r,b,f,n,c,z,p,y,V,M,I,k,X,L,m,g,N,A,F;b=0,f=-this._relativeAnchor1Z,n=this._relativeAnchor1Y,c=this._relativeAnchor1Z,z=0,p=-this._relativeAnchor1X,y=-this._relativeAnchor1Y,V=this._relativeAnchor1X,M=0,I=0,k=-this._relativeAnchor2Z,X=this._relativeAnchor2Y,L=this._relativeAnchor2Z,m=0,g=-this._relativeAnchor2X,N=-this._relativeAnchor2Y,A=this._relativeAnchor2X,F=0,b=-b,f=-f,n=-n,c=-c,z=-z,p=-p,y=-y,V=-V,M=-M,I=-I,k=-k,X=-X,L=-L,m=-m,g=-g,N=-N,A=-A,F=-F;var P=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ),Y=this._impulses[0],R=a.rows[a.numRows++],C=R.jacobian;C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,R.rhs=0,R.cfm=0,R.minImpulse=0,R.maxImpulse=0,R.motorSpeed=0,R.motorMaxImpulse=0,R.impulse=null,R.impulse=Y;var d=R;d.rhs=h,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0;var Z=d.jacobian;Z.lin1X=1,Z.lin1Y=0,Z.lin1Z=0,Z.lin2X=1,Z.lin2Y=0,Z.lin2Z=0,Z.ang1X=b,Z.ang1Y=f,Z.ang1Z=n,Z.ang2X=I,Z.ang2Y=k,Z.ang2Z=X;var $=this._impulses[1],K=a.rows[a.numRows++],E=K.jacobian;E.lin1X=0,E.lin1Y=0,E.lin1Z=0,E.lin2X=0,E.lin2Y=0,E.lin2Z=0,E.ang1X=0,E.ang1Y=0,E.ang1Z=0,E.ang2X=0,E.ang2Y=0,E.ang2Z=0,K.rhs=0,K.cfm=0,K.minImpulse=0,K.maxImpulse=0,K.motorSpeed=0,K.motorMaxImpulse=0,K.impulse=null,K.impulse=$,d=K,d.rhs=v,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,Z=d.jacobian,Z.lin1X=0,Z.lin1Y=1,Z.lin1Z=0,Z.lin2X=0,Z.lin2Y=1,Z.lin2Z=0,Z.ang1X=c,Z.ang1Y=z,Z.ang1Z=p,Z.ang2X=L,Z.ang2Y=m,Z.ang2Z=g;var J=this._impulses[2],B=a.rows[a.numRows++],Q=B.jacobian;if(Q.lin1X=0,Q.lin1Y=0,Q.lin1Z=0,Q.lin2X=0,Q.lin2Y=0,Q.lin2Z=0,Q.ang1X=0,Q.ang1Y=0,Q.ang1Z=0,Q.ang2X=0,Q.ang2Y=0,Q.ang2Z=0,B.rhs=0,B.cfm=0,B.minImpulse=0,B.maxImpulse=0,B.motorSpeed=0,B.motorMaxImpulse=0,B.impulse=null,B.impulse=J,d=B,d.rhs=e,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,Z=d.jacobian,Z.lin1X=0,Z.lin1Y=0,Z.lin1Z=1,Z.lin2X=0,Z.lin2Y=0,Z.lin2Z=1,Z.ang1X=y,Z.ang1Y=V,Z.ang1Z=M,Z.ang2X=N,Z.ang2Y=A,Z.ang2Z=F,this._sd.frequency<=0||!i){var U=this._impulses[3],G=a.rows[a.numRows++],D=G.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,G.rhs=0,G.cfm=0,G.minImpulse=0,G.maxImpulse=0,G.motorSpeed=0,G.motorMaxImpulse=0,G.impulse=null,G.impulse=U,d=G,this.setSolverInfoRowAngular(d,this.angle,this._lm,P,this._sd,t,i),Z=d.jacobian,Z.ang1X=this._basis.xX,Z.ang1Y=this._basis.xY,Z.ang1Z=this._basis.xZ,Z.ang2X=this._basis.xX,Z.ang2Y=this._basis.xY,Z.ang2Z=this._basis.xZ}var H=this._impulses[4],j=a.rows[a.numRows++],ia=j.jacobian;ia.lin1X=0,ia.lin1Y=0,ia.lin1Z=0,ia.lin2X=0,ia.lin2Y=0,ia.lin2Z=0,ia.ang1X=0,ia.ang1Y=0,ia.ang1Z=0,ia.ang2X=0,ia.ang2Y=0,ia.ang2Z=0,j.rhs=0,j.cfm=0,j.minImpulse=0,j.maxImpulse=0,j.motorSpeed=0,j.motorMaxImpulse=0,j.impulse=null,j.impulse=H,d=j,d.rhs=l,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,Z=d.jacobian,Z.ang1X=this._basis.yX,Z.ang1Y=this._basis.yY,Z.ang1Z=this._basis.yZ,Z.ang2X=this._basis.yX,Z.ang2Y=this._basis.yY,Z.ang2Z=this._basis.yZ;var sa=this._impulses[5],W=a.rows[a.numRows++],q=W.jacobian;q.lin1X=0,q.lin1Y=0,q.lin1Z=0,q.lin2X=0,q.lin2Y=0,q.lin2Z=0,q.ang1X=0,q.ang1Y=0,q.ang1Z=0,q.ang2X=0,q.ang2Y=0,q.ang2Z=0,W.rhs=0,W.cfm=0,W.minImpulse=0,W.maxImpulse=0,W.motorSpeed=0,W.motorMaxImpulse=0,W.impulse=null,W.impulse=sa,d=W,d.rhs=u,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,Z=d.jacobian,Z.ang1X=this._basis.zX,Z.ang1Y=this._basis.zY,Z.ang1Z=this._basis.zZ,Z.ang2X=this._basis.zX,Z.ang2Y=this._basis.zY,Z.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();var a=this._basis,t=a.joint._b1._invMass,i=a.joint._b2._invMass,r,o,s,_,h,v,e,l,u,b,f,n,c,z,p,y,V,M,I,k,X,L,m,g,N,A,F,P,Y,R,C,d,Z,$,K,E,J=a.joint._basisX1X*a.joint._basisX2X+a.joint._basisX1Y*a.joint._basisX2Y+a.joint._basisX1Z*a.joint._basisX2Z;if(J<-.999999999){var B,Q,U,G=a.joint._basisX1X,D=a.joint._basisX1Y,H=a.joint._basisX1Z,j=G*G,ia=D*D,sa=H*H,W;j<ia?j<sa?(W=1/Math.sqrt(ia+sa),B=0,Q=H*W,U=-D*W):(W=1/Math.sqrt(j+ia),B=D*W,Q=-G*W,U=0):ia<sa?(W=1/Math.sqrt(sa+j),B=-H*W,Q=0,U=G*W):(W=1/Math.sqrt(j+ia),B=D*W,Q=-G*W,U=0),r=B,o=Q,s=U,_=0}else{var q,na,oa;q=a.joint._basisX1Y*a.joint._basisX2Z-a.joint._basisX1Z*a.joint._basisX2Y,na=a.joint._basisX1Z*a.joint._basisX2X-a.joint._basisX1X*a.joint._basisX2Z,oa=a.joint._basisX1X*a.joint._basisX2Y-a.joint._basisX1Y*a.joint._basisX2X;var aa=Math.sqrt((1+J)*.5);J=.5/aa,q*=J,na*=J,oa*=J,r=q,o=na,s=oa,_=aa}h=0,v=0,e=0,l=1;var T,ca,_a,w,ta,ra,la,va;T=h,ca=v,_a=e,w=l,ta=r,ra=o,la=s,va=_;var xa=T*ta+ca*ra+_a*la+w*va;if(xa<0&&(xa=-xa,ta=-ta,ra=-ra,la=-la,va=-va),xa>.999999){var za,Ma,Xa,Za;za=ta-T,Ma=ra-ca,Xa=la-_a,Za=va-w,ta=T+za*(t/(t+i)),ra=ca+Ma*(t/(t+i)),la=_a+Xa*(t/(t+i)),va=w+Za*(t/(t+i));var fa=ta*ta+ra*ra+la*la+va*va;fa>1e-32&&(fa=1/Math.sqrt(fa)),u=ta*fa,b=ra*fa,f=la*fa,n=va*fa}else{var ba=t/(t+i)*Math.acos(xa);ta+=T*-xa,ra+=ca*-xa,la+=_a*-xa,va+=w*-xa;var ea=ta*ta+ra*ra+la*la+va*va;ea>1e-32&&(ea=1/Math.sqrt(ea)),ta*=ea,ra*=ea,la*=ea,va*=ea;var ha=Math.sin(ba),ma=Math.cos(ba);T*=ma,ca*=ma,_a*=ma,w*=ma,u=T+ta*ha,b=ca+ra*ha,f=_a+la*ha,n=w+va*ha}var ya=u,da=b,pa=f,Ya=n,Qa=2*ya,ga=2*da,ua=2*pa,wa=ya*Qa,ka=da*ga,Sa=pa*ua,zt=ya*ga,Ha=da*ua,Ba=ya*ua,nt=Ya*Qa,Ea=Ya*ga,Fa=Ya*ua;c=1-ka-Sa,z=zt-Fa,p=Ba+Ea,y=zt+Fa,V=1-wa-Sa,M=Ha-nt,I=Ba-Ea,k=Ha+nt,X=1-wa-ka;var Aa,ft,Wa;Aa=c*a.joint._basisX1X+z*a.joint._basisX1Y+p*a.joint._basisX1Z,ft=y*a.joint._basisX1X+V*a.joint._basisX1Y+M*a.joint._basisX1Z,Wa=I*a.joint._basisX1X+k*a.joint._basisX1Y+X*a.joint._basisX1Z,L=Aa,m=ft,g=Wa,C=a.xX,d=a.xY,Z=a.xZ,$=a.yX,K=a.yY,E=a.yZ;var Ka=C*L+d*m+Z*g;if(Ka<-.999999999){var bt,it,$a,_t=C,gt=d,pt=Z,Ga=_t*_t,rt=gt*gt,ut=pt*pt,Da;Ga<rt?Ga<ut?(Da=1/Math.sqrt(rt+ut),bt=0,it=pt*Da,$a=-gt*Da):(Da=1/Math.sqrt(Ga+rt),bt=gt*Da,it=-_t*Da,$a=0):rt<ut?(Da=1/Math.sqrt(ut+Ga),bt=-pt*Da,it=0,$a=_t*Da):(Da=1/Math.sqrt(Ga+rt),bt=gt*Da,it=-_t*Da,$a=0),u=bt,b=it,f=$a,n=0}else{var Ta,Na,Vt;Ta=d*g-Z*m,Na=Z*L-C*g,Vt=C*m-d*L;var St=Math.sqrt((1+Ka)*.5);Ka=.5/St,Ta*=Ka,Na*=Ka,Vt*=Ka,u=Ta,b=Na,f=Vt,n=St}var et=u,Xt=b,Yt=f,Mt=n,Ia=2*et,O=2*Xt,Va=2*Yt,lt=et*Ia,S=Xt*O,wt=Yt*Va,Bt=et*O,At=Xt*Va,yt=et*Va,kt=Mt*Ia,mt=Mt*O,ht=Mt*Va;c=1-S-wt,z=Bt-ht,p=yt+mt,y=Bt+ht,V=1-lt-wt,M=At-kt,I=yt-mt,k=At+kt,X=1-lt-S;var xt,Ra,st;if(xt=c*$+z*K+p*E,Ra=y*$+V*K+M*E,st=I*$+k*K+X*E,N=xt,A=Ra,F=st,P=m*F-g*A,Y=g*N-L*F,R=L*A-m*N,P*P+Y*Y+R*R>1e-6){var Ca=P*P+Y*Y+R*R;Ca>0&&(Ca=1/Math.sqrt(Ca)),P*=Ca,Y*=Ca,R*=Ca}else{var vt=L,qa=m,at=g,Oa=vt*vt,tt=qa*qa,ct=at*at,Pa;Oa<tt?Oa<ct?(Pa=1/Math.sqrt(tt+ct),P=0,Y=at*Pa,R=-qa*Pa):(Pa=1/Math.sqrt(Oa+tt),P=qa*Pa,Y=-vt*Pa,R=0):tt<ct?(Pa=1/Math.sqrt(ct+Oa),P=-at*Pa,Y=0,R=vt*Pa):(Pa=1/Math.sqrt(Oa+tt),P=qa*Pa,Y=-vt*Pa,R=0)}N=Y*g-R*m,A=R*L-P*g,F=P*m-Y*L,a.xX=L,a.xY=m,a.xZ=g,a.yX=N,a.yY=A,a.yZ=F,a.zX=P,a.zY=Y,a.zZ=R;var Ja,ja,La;Ja=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,ja=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,La=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;var ot=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,It=ot<=-1?3.14159265358979:ot>=1?0:Math.acos(ot),oi=Ja*Ja+ja*ja+La*La;oi>0&&(oi=1/Math.sqrt(oi)),Ja*=oi,ja*=oi,La*=oi,Ja*=It,ja*=It,La*=It,this.angularErrorY=Ja*this._basis.yX+ja*this._basis.yY+La*this._basis.yZ,this.angularErrorZ=Ja*this._basis.zX+ja*this._basis.zY+La*this._basis.zZ;var gi,ai,Ct;gi=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,ai=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,Ct=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,ot=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=ot<=-1?3.14159265358979:ot>=1?0:Math.acos(ot),gi*this._basis.xX+ai*this._basis.xY+Ct*this._basis.xZ<0&&(this.angle=-this.angle),this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,a}getAxis1To(a){var t=a;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(a){var t=a;t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,a}getLocalAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,a}getLocalAxis1To(a){var t=a;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(a){var t=a;t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getAngle(){return this.angle}};x.dynamics.constraint.joint.RevoluteJointConfig=class extends x.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new x.common.Vec3(1,0,0),this.localAxis2=new x.common.Vec3(1,0,0),this.springDamper=new x.dynamics.constraint.joint.SpringDamper,this.limitMotor=new x.dynamics.constraint.joint.RotationalLimitMotor}init(a,t,i,r){this._init(a,t,i);var o,s,_,h=r;o=h.x,s=h.y,_=h.z;var v,e,l;v=a._transform._rotation00*o+a._transform._rotation10*s+a._transform._rotation20*_,e=a._transform._rotation01*o+a._transform._rotation11*s+a._transform._rotation21*_,l=a._transform._rotation02*o+a._transform._rotation12*s+a._transform._rotation22*_,o=v,s=e,_=l;var u=this.localAxis1;u.x=o,u.y=s,u.z=_;var b,f,n,c=r;b=c.x,f=c.y,n=c.z;var z,p,y;z=t._transform._rotation00*b+t._transform._rotation10*f+t._transform._rotation20*n,p=t._transform._rotation01*b+t._transform._rotation11*f+t._transform._rotation21*n,y=t._transform._rotation02*b+t._transform._rotation12*f+t._transform._rotation22*n,b=z,f=p,n=y;var V=this.localAxis2;return V.x=b,V.y=f,V.z=n,this}};x.dynamics.constraint.joint.RotationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorTorque=0}setLimits(a,t){return this.lowerLimit=a,this.upperLimit=t,this}setMotor(a,t){return this.motorSpeed=a,this.motorTorque=t,this}clone(){var a=new x.dynamics.constraint.joint.RotationalLimitMotor;return a.lowerLimit=this.lowerLimit,a.upperLimit=this.upperLimit,a.motorSpeed=this.motorSpeed,a.motorTorque=this.motorTorque,a}};x.dynamics.constraint.joint.SphericalJoint=class extends x.dynamics.constraint.joint.Joint{constructor(a){super(a,0),this._sd=a.springDamper.clone()}getInfo(a,t,i){if(!(this._sd.frequency>0&&i)){var r,o,s;r=this._anchor2X-this._anchor1X,o=this._anchor2Y-this._anchor1Y,s=this._anchor2Z-this._anchor1Z;var _,h;if(this._sd.frequency>0){var v=6.28318530717958*this._sd.frequency,e=this._sd.dampingRatio;e<x.common.Setting.minSpringDamperDampingRatio&&(e=x.common.Setting.minSpringDamperDampingRatio);var l=t.dt,u=2*e*v,b=v*v;this._sd.useSymplecticEuler?(_=1/(l*u),h=b/u):(_=1/(l*(l*b+u)),h=b/(l*b+u)),_*=this._b1._invMass+this._b2._invMass}else _=0,h=this.getErp(t,i);var f,n,c;f=r*h,n=o*h,c=s*h;var z=f,p=n,y=c,V,M,I,k,X,L,m,g,N,A,F,P,Y,R,C,d,Z,$;V=0,M=-this._relativeAnchor1Z,I=this._relativeAnchor1Y,k=this._relativeAnchor1Z,X=0,L=-this._relativeAnchor1X,m=-this._relativeAnchor1Y,g=this._relativeAnchor1X,N=0,A=0,F=-this._relativeAnchor2Z,P=this._relativeAnchor2Y,Y=this._relativeAnchor2Z,R=0,C=-this._relativeAnchor2X,d=-this._relativeAnchor2Y,Z=this._relativeAnchor2X,$=0,V=-V,M=-M,I=-I,k=-k,X=-X,L=-L,m=-m,g=-g,N=-N,A=-A,F=-F,P=-P,Y=-Y,R=-R,C=-C,d=-d,Z=-Z,$=-$;var K=this._impulses[0],E=a.rows[a.numRows++],J=E.jacobian;J.lin1X=0,J.lin1Y=0,J.lin1Z=0,J.lin2X=0,J.lin2Y=0,J.lin2Z=0,J.ang1X=0,J.ang1Y=0,J.ang1Z=0,J.ang2X=0,J.ang2Y=0,J.ang2Z=0,E.rhs=0,E.cfm=0,E.minImpulse=0,E.maxImpulse=0,E.motorSpeed=0,E.motorMaxImpulse=0,E.impulse=null,E.impulse=K;var B=E;B.rhs=z,B.cfm=_,B.minImpulse=-1/0,B.maxImpulse=1/0;var Q=B.jacobian;Q.lin1X=1,Q.lin1Y=0,Q.lin1Z=0,Q.lin2X=1,Q.lin2Y=0,Q.lin2Z=0,Q.ang1X=V,Q.ang1Y=M,Q.ang1Z=I,Q.ang2X=A,Q.ang2Y=F,Q.ang2Z=P;var U=this._impulses[1],G=a.rows[a.numRows++],D=G.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,G.rhs=0,G.cfm=0,G.minImpulse=0,G.maxImpulse=0,G.motorSpeed=0,G.motorMaxImpulse=0,G.impulse=null,G.impulse=U,B=G,B.rhs=p,B.cfm=_,B.minImpulse=-1/0,B.maxImpulse=1/0,Q=B.jacobian,Q.lin1X=0,Q.lin1Y=1,Q.lin1Z=0,Q.lin2X=0,Q.lin2Y=1,Q.lin2Z=0,Q.ang1X=k,Q.ang1Y=X,Q.ang1Z=L,Q.ang2X=Y,Q.ang2Y=R,Q.ang2Z=C;var H=this._impulses[2],j=a.rows[a.numRows++],ia=j.jacobian;ia.lin1X=0,ia.lin1Y=0,ia.lin1Z=0,ia.lin2X=0,ia.lin2Y=0,ia.lin2Z=0,ia.ang1X=0,ia.ang1Y=0,ia.ang1Z=0,ia.ang2X=0,ia.ang2Y=0,ia.ang2Z=0,j.rhs=0,j.cfm=0,j.minImpulse=0,j.maxImpulse=0,j.motorSpeed=0,j.motorMaxImpulse=0,j.impulse=null,j.impulse=H,B=j,B.rhs=y,B.cfm=_,B.minImpulse=-1/0,B.maxImpulse=1/0,Q=B.jacobian,Q.lin1X=0,Q.lin1Y=0,Q.lin1Z=1,Q.lin2X=0,Q.lin2Y=0,Q.lin2Z=1,Q.ang1X=m,Q.ang1Y=g,Q.ang1Z=N,Q.ang2X=d,Q.ang2Y=Z,Q.ang2Z=$}}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getSpringDamper(){return this._sd}};x.dynamics.constraint.joint.SphericalJointConfig=class extends x.dynamics.constraint.joint.JointConfig{constructor(){super(),this.springDamper=new x.dynamics.constraint.joint.SpringDamper}init(a,t,i){return this._init(a,t,i),this}};x.dynamics.constraint.joint.SpringDamper=class{constructor(){this.frequency=0,this.dampingRatio=0,this.useSymplecticEuler=!1}setSpring(a,t){return this.frequency=a,this.dampingRatio=t,this}setSymplecticEuler(a){return this.useSymplecticEuler=a,this}clone(){var a=new x.dynamics.constraint.joint.SpringDamper;return a.frequency=this.frequency,a.dampingRatio=this.dampingRatio,a.useSymplecticEuler=this.useSymplecticEuler,a}};x.dynamics.constraint.joint.TranslationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorForce=0}setLimits(a,t){return this.lowerLimit=a,this.upperLimit=t,this}setMotor(a,t){return this.motorSpeed=a,this.motorForce=t,this}clone(){var a=new x.dynamics.constraint.joint.TranslationalLimitMotor;return a.lowerLimit=this.lowerLimit,a.upperLimit=this.upperLimit,a.motorSpeed=this.motorSpeed,a.motorForce=this.motorForce,a}};x.dynamics.constraint.joint.UniversalJoint=class extends x.dynamics.constraint.joint.Joint{constructor(a){super(a,x.dynamics.constraint.joint.JointType.UNIVERSAL);var t=a.localAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var i=a.localAxis2;this._localBasisZ2X=i.x,this._localBasisZ2Y=i.y,this._localBasisZ2Z=i.z,this.buildLocalBasesFromX1Z2(),this._angleX=0,this._angleY=0,this._angleZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._sd1=a.springDamper1.clone(),this._sd2=a.springDamper2.clone(),this._lm1=a.limitMotor1.clone(),this._lm2=a.limitMotor2.clone()}getInfo(a,t,i){var r=this.getErp(t,i),o,s,_;o=this.linearErrorX*r,s=this.linearErrorY*r,_=this.linearErrorZ*r;var h=o,v=s,e=_,l=this._angleY*r,u,b,f,n,c,z,p,y,V,M,I,k,X,L,m,g,N,A;u=0,b=-this._relativeAnchor1Z,f=this._relativeAnchor1Y,n=this._relativeAnchor1Z,c=0,z=-this._relativeAnchor1X,p=-this._relativeAnchor1Y,y=this._relativeAnchor1X,V=0,M=0,I=-this._relativeAnchor2Z,k=this._relativeAnchor2Y,X=this._relativeAnchor2Z,L=0,m=-this._relativeAnchor2X,g=-this._relativeAnchor2Y,N=this._relativeAnchor2X,A=0,u=-u,b=-b,f=-f,n=-n,c=-c,z=-z,p=-p,y=-y,V=-V,M=-M,I=-I,k=-k,X=-X,L=-L,m=-m,g=-g,N=-N,A=-A;var F=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),P=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ),Y=this._impulses[0],R=a.rows[a.numRows++],C=R.jacobian;C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,R.rhs=0,R.cfm=0,R.minImpulse=0,R.maxImpulse=0,R.motorSpeed=0,R.motorMaxImpulse=0,R.impulse=null,R.impulse=Y;var d=R;d.rhs=h,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0;var Z=d.jacobian;Z.lin1X=1,Z.lin1Y=0,Z.lin1Z=0,Z.lin2X=1,Z.lin2Y=0,Z.lin2Z=0,Z.ang1X=u,Z.ang1Y=b,Z.ang1Z=f,Z.ang2X=M,Z.ang2Y=I,Z.ang2Z=k;var $=this._impulses[1],K=a.rows[a.numRows++],E=K.jacobian;E.lin1X=0,E.lin1Y=0,E.lin1Z=0,E.lin2X=0,E.lin2Y=0,E.lin2Z=0,E.ang1X=0,E.ang1Y=0,E.ang1Z=0,E.ang2X=0,E.ang2Y=0,E.ang2Z=0,K.rhs=0,K.cfm=0,K.minImpulse=0,K.maxImpulse=0,K.motorSpeed=0,K.motorMaxImpulse=0,K.impulse=null,K.impulse=$,d=K,d.rhs=v,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,Z=d.jacobian,Z.lin1X=0,Z.lin1Y=1,Z.lin1Z=0,Z.lin2X=0,Z.lin2Y=1,Z.lin2Z=0,Z.ang1X=n,Z.ang1Y=c,Z.ang1Z=z,Z.ang2X=X,Z.ang2Y=L,Z.ang2Z=m;var J=this._impulses[2],B=a.rows[a.numRows++],Q=B.jacobian;if(Q.lin1X=0,Q.lin1Y=0,Q.lin1Z=0,Q.lin2X=0,Q.lin2Y=0,Q.lin2Z=0,Q.ang1X=0,Q.ang1Y=0,Q.ang1Z=0,Q.ang2X=0,Q.ang2Y=0,Q.ang2Z=0,B.rhs=0,B.cfm=0,B.minImpulse=0,B.maxImpulse=0,B.motorSpeed=0,B.motorMaxImpulse=0,B.impulse=null,B.impulse=J,d=B,d.rhs=e,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,Z=d.jacobian,Z.lin1X=0,Z.lin1Y=0,Z.lin1Z=1,Z.lin2X=0,Z.lin2Y=0,Z.lin2Z=1,Z.ang1X=p,Z.ang1Y=y,Z.ang1Z=V,Z.ang2X=g,Z.ang2Y=N,Z.ang2Z=A,!this.xSingular&&(this._sd1.frequency<=0||!i)){var U=this._impulses[3],G=a.rows[a.numRows++],D=G.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,G.rhs=0,G.cfm=0,G.minImpulse=0,G.maxImpulse=0,G.motorSpeed=0,G.motorMaxImpulse=0,G.impulse=null,G.impulse=U,d=G,this.setSolverInfoRowAngular(d,this._angleX,this._lm1,F,this._sd1,t,i),Z=d.jacobian,Z.ang1X=this._axisXX,Z.ang1Y=this._axisXY,Z.ang1Z=this._axisXZ,Z.ang2X=this._axisXX,Z.ang2Y=this._axisXY,Z.ang2Z=this._axisXZ}if(!this.ySingular){var H=this._impulses[4],j=a.rows[a.numRows++],ia=j.jacobian;ia.lin1X=0,ia.lin1Y=0,ia.lin1Z=0,ia.lin2X=0,ia.lin2Y=0,ia.lin2Z=0,ia.ang1X=0,ia.ang1Y=0,ia.ang1Z=0,ia.ang2X=0,ia.ang2Y=0,ia.ang2Z=0,j.rhs=0,j.cfm=0,j.minImpulse=0,j.maxImpulse=0,j.motorSpeed=0,j.motorMaxImpulse=0,j.impulse=null,j.impulse=H,d=j,d.rhs=l,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,Z=d.jacobian,Z.ang1X=this._axisYX,Z.ang1Y=this._axisYY,Z.ang1Z=this._axisYZ,Z.ang2X=this._axisYX,Z.ang2Y=this._axisYY,Z.ang2Z=this._axisYZ}if(!this.zSingular&&(this._sd2.frequency<=0||!i)){var sa=this._impulses[5],W=a.rows[a.numRows++],q=W.jacobian;q.lin1X=0,q.lin1Y=0,q.lin1Z=0,q.lin2X=0,q.lin2Y=0,q.lin2Z=0,q.ang1X=0,q.ang1Y=0,q.ang1Z=0,q.ang2X=0,q.ang2Y=0,q.ang2Z=0,W.rhs=0,W.cfm=0,W.minImpulse=0,W.maxImpulse=0,W.motorSpeed=0,W.motorMaxImpulse=0,W.impulse=null,W.impulse=sa,d=W,this.setSolverInfoRowAngular(d,this._angleZ,this._lm2,P,this._sd2,t,i),Z=d.jacobian,Z.ang1X=this._axisZX,Z.ang1Y=this._axisZY,Z.ang1Z=this._axisZZ,Z.ang2X=this._axisZX,Z.ang2Y=this._axisZY,Z.ang2Z=this._axisZZ}}_syncAnchors(){super._syncAnchors(),this._basisX1X,this._basisY1X,this._basisZ1X,this._basisX1Y,this._basisY1Y,this._basisZ1Y,this._basisX1Z,this._basisY1Z,this._basisZ1Z,this._basisX2X,this._basisY2X,this._basisZ2X,this._basisX2Y,this._basisY2Y,this._basisZ2Y,this._basisX2Z,this._basisY2Z,this._basisZ2Z;var a,t,i,r,o,s,_,h,v;a=this._basisX1X,t=this._basisX1Y,i=this._basisX1Z,_=this._basisZ2X,h=this._basisZ2Y,v=this._basisZ2Z,r=h*i-v*t,o=v*a-_*i,s=_*t-h*a,this._axisXX=o*v-s*h,this._axisXY=s*_-r*v,this._axisXZ=r*h-o*_,this._axisYX=r,this._axisYY=o,this._axisYZ=s,this._axisZX=t*s-i*o,this._axisZY=i*r-a*s,this._axisZZ=a*o-t*r;var e=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;e>0&&(e=1/Math.sqrt(e)),this._axisXX*=e,this._axisXY*=e,this._axisXZ*=e;var l=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;l>0&&(l=1/Math.sqrt(l)),this._axisYX*=l,this._axisYY*=l,this._axisYZ*=l;var u=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;u>0&&(u=1/Math.sqrt(u)),this._axisZX*=u,this._axisZY*=u,this._axisZZ*=u,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0;var b,f,n,c,z,p,y,V,M,I,k,X,L,m,g,N,A,F;b=this._basisX1X,f=this._basisY1X,n=this._basisZ1X,c=this._basisX1Y,z=this._basisY1Y,p=this._basisZ1Y,y=this._basisX1Z,V=this._basisY1Z,M=this._basisZ1Z,I=this._basisX2X,k=this._basisY2X,X=this._basisZ2X,L=this._basisX2Y,m=this._basisY2Y,g=this._basisZ2Y,N=this._basisX2Z,A=this._basisY2Z,F=this._basisZ2Z;var P,Y,R,C,d,Z,$,K,E,J,B,Q,U,G;K=b*I+c*L+y*N,E=b*k+c*m+y*A,J=b*X+c*g+y*F,B=f*k+z*m+V*A,Q=f*X+z*g+V*F,U=n*k+p*m+M*A,G=n*X+p*g+M*F,P=K,Y=E,R=J,C=B,d=Q,Z=U,$=G;var D,H,j,ia=R;if(ia<=-1){var sa=Math.atan2(Z,C);D=sa*.5,H=-1.570796326794895,j=-sa*.5}else if(ia>=1){var W=Math.atan2(Z,C);D=W*.5,H=1.570796326794895,j=W*.5}else{var q=Math.asin(ia),na=Math.atan2(-d,$),oa=Math.atan2(-Y,P);D=na,H=q,j=oa}this._angleX=D,this._angleY=H,this._angleZ=j,this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,a}getAxis1To(a){var t=a;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(a){var t=a;t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z}getLocalAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,a}getLocalAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z,a}getLocalAxis1To(a){var t=a;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(a){var t=a;t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z}getSpringDamper1(){return this._sd1}getSpringDamper2(){return this._sd2}getLimitMotor1(){return this._lm1}getLimitMotor2(){return this._lm2}getAngle1(){return this._angleX}getAngle2(){return this._angleZ}};x.dynamics.constraint.joint.UniversalJointConfig=class extends x.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new x.common.Vec3(1,0,0),this.localAxis2=new x.common.Vec3(1,0,0),this.springDamper1=new x.dynamics.constraint.joint.SpringDamper,this.springDamper2=new x.dynamics.constraint.joint.SpringDamper,this.limitMotor1=new x.dynamics.constraint.joint.RotationalLimitMotor,this.limitMotor2=new x.dynamics.constraint.joint.RotationalLimitMotor}init(a,t,i,r,o){this._init(a,t,i);var s,_,h,v=r;s=v.x,_=v.y,h=v.z;var e,l,u;e=a._transform._rotation00*s+a._transform._rotation10*_+a._transform._rotation20*h,l=a._transform._rotation01*s+a._transform._rotation11*_+a._transform._rotation21*h,u=a._transform._rotation02*s+a._transform._rotation12*_+a._transform._rotation22*h,s=e,_=l,h=u;var b=this.localAxis1;b.x=s,b.y=_,b.z=h;var f,n,c,z=o;f=z.x,n=z.y,c=z.z;var p,y,V;p=t._transform._rotation00*f+t._transform._rotation10*n+t._transform._rotation20*c,y=t._transform._rotation01*f+t._transform._rotation11*n+t._transform._rotation21*c,V=t._transform._rotation02*f+t._transform._rotation12*n+t._transform._rotation22*c,f=p,n=y,c=V;var M=this.localAxis2;return M.x=f,M.y=n,M.z=c,this}};x.dynamics.constraint.solver||(x.dynamics.constraint.solver={});x.dynamics.constraint.solver.ConstraintSolverType=class{};x.dynamics.constraint.solver.common||(x.dynamics.constraint.solver.common={});x.dynamics.constraint.solver.common.ContactSolverMassDataRow=class{constructor(){this.invMLinN1X=0,this.invMLinN1Y=0,this.invMLinN1Z=0,this.invMLinN2X=0,this.invMLinN2Y=0,this.invMLinN2Z=0,this.invMAngN1X=0,this.invMAngN1Y=0,this.invMAngN1Z=0,this.invMAngN2X=0,this.invMAngN2Y=0,this.invMAngN2Z=0,this.invMLinT1X=0,this.invMLinT1Y=0,this.invMLinT1Z=0,this.invMLinT2X=0,this.invMLinT2Y=0,this.invMLinT2Z=0,this.invMAngT1X=0,this.invMAngT1Y=0,this.invMAngT1Z=0,this.invMAngT2X=0,this.invMAngT2Y=0,this.invMAngT2Z=0,this.invMLinB1X=0,this.invMLinB1Y=0,this.invMLinB1Z=0,this.invMLinB2X=0,this.invMLinB2Y=0,this.invMLinB2Z=0,this.invMAngB1X=0,this.invMAngB1Y=0,this.invMAngB1Z=0,this.invMAngB2X=0,this.invMAngB2Y=0,this.invMAngB2Z=0,this.massN=0,this.massTB00=0,this.massTB01=0,this.massTB10=0,this.massTB11=0}};x.dynamics.constraint.solver.common.JointSolverMassDataRow=class{constructor(){this.invMLin1X=0,this.invMLin1Y=0,this.invMLin1Z=0,this.invMLin2X=0,this.invMLin2Y=0,this.invMLin2Z=0,this.invMAng1X=0,this.invMAng1Y=0,this.invMAng1Z=0,this.invMAng2X=0,this.invMAng2Y=0,this.invMAng2Z=0,this.mass=0,this.massWithoutCfm=0}};x.dynamics.constraint.solver.direct||(x.dynamics.constraint.solver.direct={});x.dynamics.constraint.solver.direct.Boundary=class{constructor(a){var t=new Array(a);this.iBounded=t;var i=new Array(a);this.iUnbounded=i;var r=new Array(a);this.signs=r;var o=new Array(a);this.b=o,this.numBounded=0,this.numUnbounded=0,this.matrixId=0}init(a){this.numBounded=a.numBounded;for(var t=0,i=this.numBounded;t<i;){var r=t++;this.iBounded[r]=a.iBounded[r],this.signs[r]=a.signs[r]}this.numUnbounded=a.numUnbounded,this.matrixId=0;for(var o=0,s=this.numUnbounded;o<s;){var _=o++,h=a.iUnbounded[_];this.iUnbounded[_]=h,this.matrixId|=1<<h}}computeImpulses(a,t,i,r,o,s,_){for(var h=0,v=this.numUnbounded;h<v;){var e=h++,l=this.iUnbounded[e],u=a.rows[l],b=i[l];this.b[l]=u.rhs*s-b-u.cfm*r[l]}for(var f=t._invMassWithoutCfm,n=0,c=this.numBounded;n<c;){var z=n++,p=this.iBounded[z],y=this.signs[z],V=a.rows[p],M=r[p],I=y<0?V.minImpulse:y>0?V.maxImpulse:0,k=I-M;if(o[p]=k,k!=0)for(var X=0,L=this.numUnbounded;X<L;){var m=X++,g=this.iUnbounded[m],N=f[p][g]*k,A=g,F=this.b;F[A]=F[A]-N}}for(var P=this.iUnbounded,Y=this.numUnbounded,R=0,C=0,d=Y;C<d;){var Z=C++;R|=1<<P[Z]}var $;t._cacheComputed[R]||(t.computeSubmatrix(R,P,Y),t._cacheComputed[R]=!0),$=t._cachedSubmatrices[R];for(var K=!0,E=0,J=this.numUnbounded;E<J;){for(var B=E++,Q=this.iUnbounded[B],U=a.rows[Q],G=r[Q],D=G,H=0,j=this.numUnbounded;H<j;){var ia=H++,sa=this.iUnbounded[ia];D+=this.b[sa]*$[B][ia]}if(D<U.minImpulse-x.common.Setting.directMlcpSolverEps||D>U.maxImpulse+x.common.Setting.directMlcpSolverEps){K=!1;break}o[Q]=D-G}if(_)return!0;if(!K)return!1;for(var W=0,q=this.numBounded;W<q;){for(var na=W++,oa=this.iBounded[na],aa=a.rows[oa],T=this.signs[na],ca=0,_a=r[oa]+o[oa],w=i[oa],ta=0,ra=a.numRows;ta<ra;){var la=ta++;w+=f[oa][la]*o[la]}if(ca=aa.rhs*s-w-aa.cfm*_a,T<0&&ca>x.common.Setting.directMlcpSolverEps||T>0&&ca<-x.common.Setting.directMlcpSolverEps){K=!1;break}}return K}};x.dynamics.constraint.solver.direct.BoundaryBuildInfo=class{constructor(a){this.size=a,this.numBounded=0;var t=new Array(a);this.iBounded=t;var i=new Array(a);this.signs=i,this.numUnbounded=0;var r=new Array(a);this.iUnbounded=r}};x.dynamics.constraint.solver.direct.BoundaryBuilder=class{constructor(a){this.maxRows=a,this.numBoundaries=0;var t=new Array(1<<a);this.boundaries=t,this.bbInfo=new x.dynamics.constraint.solver.direct.BoundaryBuildInfo(a)}buildBoundariesRecursive(a,t){if(t==a.numRows){this.boundaries[this.numBoundaries]==null&&(this.boundaries[this.numBoundaries]=new x.dynamics.constraint.solver.direct.Boundary(this.maxRows)),this.boundaries[this.numBoundaries++].init(this.bbInfo);return}var i=a.rows[t],r=i.minImpulse>-1/0,o=i.maxImpulse<1/0,s=i.minImpulse==0&&i.maxImpulse==0;if(s){var _=this.bbInfo;_.iBounded[_.numBounded]=t,_.signs[_.numBounded]=0,_.numBounded++,this.buildBoundariesRecursive(a,t+1),this.bbInfo.numBounded--;return}var h=this.bbInfo;if(h.iUnbounded[h.numUnbounded]=t,h.numUnbounded++,this.buildBoundariesRecursive(a,t+1),this.bbInfo.numUnbounded--,r){var v=this.bbInfo;v.iBounded[v.numBounded]=t,v.signs[v.numBounded]=-1,v.numBounded++,this.buildBoundariesRecursive(a,t+1),this.bbInfo.numBounded--}if(o){var e=this.bbInfo;e.iBounded[e.numBounded]=t,e.signs[e.numBounded]=1,e.numBounded++,this.buildBoundariesRecursive(a,t+1),this.bbInfo.numBounded--}}buildBoundaries(a){this.numBoundaries=0;var t=this.bbInfo;t.numBounded=0,t.numUnbounded=0,this.buildBoundariesRecursive(a,0)}};x.dynamics.constraint.solver.direct.BoundarySelector=class{constructor(a){this.n=a;var t=new Array(a);this.indices=t;var i=new Array(a);this.tmpIndices=i;for(var r=0,o=a;r<o;){var s=r++;this.indices[s]=s}}getIndex(a){return this.indices[a]}select(a){for(var t=0;this.indices[t]!=a;)++t;for(;t>0;){var i=this.indices[t];this.indices[t]=this.indices[t-1],this.indices[t-1]=i,--t}}setSize(a){for(var t=0,i=0,r=0,o=this.n;r<o;){var s=r++,_=this.indices[s];_<a?(this.tmpIndices[t]=_,++t):(this.tmpIndices[a+i]=_,++i)}var h=this.indices;this.indices=this.tmpIndices,this.tmpIndices=h}};x.dynamics.constraint.solver.direct.DirectJointConstraintSolver=class extends x.dynamics.constraint.ConstraintSolver{constructor(a){super(),this.joint=a,this.info=new x.dynamics.constraint.info.joint.JointSolverInfo;var t=x.common.Setting.maxJacobianRows;this.massMatrix=new x.dynamics.constraint.solver.direct.MassMatrix(t),this.boundaryBuilder=new x.dynamics.constraint.solver.direct.BoundaryBuilder(t);var i=new Array(t);this.massData=i;for(var r=0,o=this.massData.length;r<o;){var s=r++;this.massData[s]=new x.dynamics.constraint.solver.common.JointSolverMassDataRow}var _=this.boundaryBuilder.boundaries.length;this.velBoundarySelector=new x.dynamics.constraint.solver.direct.BoundarySelector(_),this.posBoundarySelector=new x.dynamics.constraint.solver.direct.BoundarySelector(_);var h=new Array(t);this.relVels=h;var v=new Array(t);this.impulses=v;var e=new Array(t);this.dImpulses=e;var l=new Array(t);this.dTotalImpulses=l;for(var u=0,b=t;u<b;){var f=u++;this.relVels[f]=0,this.impulses[f]=0,this.dImpulses[f]=0,this.dTotalImpulses[f]=0}}preSolveVelocity(a){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(a,this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var t=this.boundaryBuilder;t.numBoundaries=0;var i=t.bbInfo;i.numBounded=0,i.numUnbounded=0,t.buildBoundariesRecursive(this.info,0);for(var r=this.velBoundarySelector,o=this.boundaryBuilder.numBoundaries,s=0,_=0,h=0,v=r.n;h<v;){var e=h++,l=r.indices[e];l<o?(r.tmpIndices[s]=l,++s):(r.tmpIndices[o+_]=l,++_)}var u=r.indices;r.indices=r.tmpIndices,r.tmpIndices=u}warmStart(a){var t=this.joint._positionCorrectionAlgorithm==x.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?x.common.Setting.jointWarmStartingFactorForBaungarte:x.common.Setting.jointWarmStartingFactor;if(t*=a.dtRatio,t<=0){for(var i=0,r=this.info.numRows;i<r;){var o=i++,s=this.info.rows[o],_=s.impulse;_.impulse=0,_.impulseM=0,_.impulseP=0}return}for(var h=0,v=this.info.numRows;h<v;){var e=h++,l=this.info.rows[e],u=l.impulse,b=u.impulse*t;if(b<l.minImpulse?b=l.minImpulse:b>l.maxImpulse&&(b=l.maxImpulse),u.impulse=b,l.motorMaxImpulse>0){var f=u.impulseM*t,n=l.motorMaxImpulse;f<-n?f=-n:f>n&&(f=n),u.impulseM=f}else u.impulseM=0;this.dImpulses[e]=u.impulse+u.impulseM}var c=this.dImpulses,z=!1,p=!1,y,V,M,I,k,X,L,m,g,N,A,F;y=this._b1._velX,V=this._b1._velY,M=this._b1._velZ,I=this._b2._velX,k=this._b2._velY,X=this._b2._velZ,L=this._b1._angVelX,m=this._b1._angVelY,g=this._b1._angVelZ,N=this._b2._angVelX,A=this._b2._angVelY,F=this._b2._angVelZ;for(var P=0,Y=this.info.numRows;P<Y;){var R=P++,C=this.info.rows[R],d=C.jacobian,Z=this.massData[R],$=c[R];d.flag&1&&(y+=Z.invMLin1X*$,V+=Z.invMLin1Y*$,M+=Z.invMLin1Z*$,I+=Z.invMLin2X*-$,k+=Z.invMLin2Y*-$,X+=Z.invMLin2Z*-$,z=!0),d.flag&2&&(L+=Z.invMAng1X*$,m+=Z.invMAng1Y*$,g+=Z.invMAng1Z*$,N+=Z.invMAng2X*-$,A+=Z.invMAng2Y*-$,F+=Z.invMAng2Z*-$,p=!0)}z&&(this._b1._velX=y,this._b1._velY=V,this._b1._velZ=M,this._b2._velX=I,this._b2._velY=k,this._b2._velZ=X),p&&(this._b1._angVelX=L,this._b1._angVelY=m,this._b1._angVelZ=g,this._b2._angVelX=N,this._b2._angVelY=A,this._b2._angVelZ=F)}solveVelocity(){var a=this.info.numRows,t,i,r,o,s,_,h,v,e,l,u,b;t=this._b1._velX,i=this._b1._velY,r=this._b1._velZ,o=this._b2._velX,s=this._b2._velY,_=this._b2._velZ,h=this._b1._angVelX,v=this._b1._angVelY,e=this._b1._angVelZ,l=this._b2._angVelX,u=this._b2._angVelY,b=this._b2._angVelZ;for(var f=0,n=a;f<n;){var c=f++,z=this.info.rows[c],p=z.impulse,y=z.jacobian,V=0;V+=t*y.lin1X+i*y.lin1Y+r*y.lin1Z,V-=o*y.lin2X+s*y.lin2Y+_*y.lin2Z,V+=h*y.ang1X+v*y.ang1Y+e*y.ang1Z,V-=l*y.ang2X+u*y.ang2Y+b*y.ang2Z,this.relVels[c]=V,this.impulses[c]=p.impulse,this.dTotalImpulses[c]=0}for(var M=this.massMatrix._invMassWithoutCfm,I=0,k=a;I<k;){var X=I++,L=this.info.rows[X],m=L.impulse,g=this.massData[X];if(L.motorMaxImpulse>0){var N=m.impulseM,A=N+g.massWithoutCfm*(-L.motorSpeed-this.relVels[X]),F=L.motorMaxImpulse;A<-F?A=-F:A>F&&(A=F),m.impulseM=A;var P=A-N;this.dTotalImpulses[X]=P;for(var Y=0,R=a;Y<R;){var C=Y++,d=C,Z=this.relVels;Z[d]=Z[d]+P*M[X][C]}}}for(var $=!1,K=0,E=this.boundaryBuilder.numBoundaries;K<E;){var J=K++,B=this.velBoundarySelector.indices[J],Q=this.boundaryBuilder.boundaries[B];if(Q.computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,1,!1)){for(var U=0,G=a;U<G;){var D=U++,H=this.info.rows[D],j=H.impulse,ia=this.dImpulses[D];j.impulse+=ia;var sa=D,W=this.dTotalImpulses;W[sa]=W[sa]+ia}var q=this.dTotalImpulses,na=!1,oa=!1,aa,T,ca,_a,w,ta,ra,la,va,xa,za,Ma;aa=this._b1._velX,T=this._b1._velY,ca=this._b1._velZ,_a=this._b2._velX,w=this._b2._velY,ta=this._b2._velZ,ra=this._b1._angVelX,la=this._b1._angVelY,va=this._b1._angVelZ,xa=this._b2._angVelX,za=this._b2._angVelY,Ma=this._b2._angVelZ;for(var Xa=0,Za=this.info.numRows;Xa<Za;){var fa=Xa++,ba=this.info.rows[fa],ea=ba.jacobian,ha=this.massData[fa],ma=q[fa];ea.flag&1&&(aa+=ha.invMLin1X*ma,T+=ha.invMLin1Y*ma,ca+=ha.invMLin1Z*ma,_a+=ha.invMLin2X*-ma,w+=ha.invMLin2Y*-ma,ta+=ha.invMLin2Z*-ma,na=!0),ea.flag&2&&(ra+=ha.invMAng1X*ma,la+=ha.invMAng1Y*ma,va+=ha.invMAng1Z*ma,xa+=ha.invMAng2X*-ma,za+=ha.invMAng2Y*-ma,Ma+=ha.invMAng2Z*-ma,oa=!0)}na&&(this._b1._velX=aa,this._b1._velY=T,this._b1._velZ=ca,this._b2._velX=_a,this._b2._velY=w,this._b2._velZ=ta),oa&&(this._b1._angVelX=ra,this._b1._angVelY=la,this._b1._angVelZ=va,this._b2._angVelX=xa,this._b2._angVelY=za,this._b2._angVelZ=Ma);for(var ya=this.velBoundarySelector,da=0;ya.indices[da]!=B;)++da;for(;da>0;){var pa=ya.indices[da];ya.indices[da]=ya.indices[da-1],ya.indices[da-1]=pa,--da}$=!0;break}}if(!$){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:335:","could not find solution. (velocity)");return}}postSolveVelocity(a){var t,i,r,o,s,_;t=0,i=0,r=0,o=0,s=0,_=0;for(var h=0,v=this.info.numRows;h<v;){var e=h++,l=this.info.rows[e],u=l.impulse,b=l.jacobian;b.flag&1?(t+=b.lin1X*u.impulse,i+=b.lin1Y*u.impulse,r+=b.lin1Z*u.impulse):b.flag&2&&(o+=b.ang1X*u.impulse,s+=b.ang1Y*u.impulse,_+=b.ang1Z*u.impulse)}this.joint._appliedForceX=t*a.invDt,this.joint._appliedForceY=i*a.invDt,this.joint._appliedForceZ=r*a.invDt,this.joint._appliedTorqueX=o*a.invDt,this.joint._appliedTorqueY=s*a.invDt,this.joint._appliedTorqueZ=_*a.invDt}preSolvePosition(a){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var t=this.boundaryBuilder;t.numBoundaries=0;var i=t.bbInfo;i.numBounded=0,i.numUnbounded=0,t.buildBoundariesRecursive(this.info,0);for(var r=this.posBoundarySelector,o=this.boundaryBuilder.numBoundaries,s=0,_=0,h=0,v=r.n;h<v;){var e=h++,l=r.indices[e];l<o?(r.tmpIndices[s]=l,++s):(r.tmpIndices[o+_]=l,++_)}var u=r.indices;r.indices=r.tmpIndices,r.tmpIndices=u;for(var b=0,f=this.info.numRows;b<f;){var n=b++;this.info.rows[n].impulse.impulseP=0}}solvePositionSplitImpulse(){var a=this.info.numRows,t,i,r,o,s,_,h,v,e,l,u,b;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,r=this._b1._pseudoVelZ,o=this._b2._pseudoVelX,s=this._b2._pseudoVelY,_=this._b2._pseudoVelZ,h=this._b1._angPseudoVelX,v=this._b1._angPseudoVelY,e=this._b1._angPseudoVelZ,l=this._b2._angPseudoVelX,u=this._b2._angPseudoVelY,b=this._b2._angPseudoVelZ;for(var f=0,n=a;f<n;){var c=f++,z=this.info.rows[c],p=z.impulse,y=z.jacobian,V=0;V+=t*y.lin1X+i*y.lin1Y+r*y.lin1Z,V-=o*y.lin2X+s*y.lin2Y+_*y.lin2Z,V+=h*y.ang1X+v*y.ang1Y+e*y.ang1Z,V-=l*y.ang2X+u*y.ang2Y+b*y.ang2Z,this.relVels[c]=V,this.impulses[c]=p.impulseP}for(var M=!1,I=0,k=this.boundaryBuilder.numBoundaries;I<k;){var X=I++,L=this.posBoundarySelector.indices[X],m=this.boundaryBuilder.boundaries[L];if(m.computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,x.common.Setting.positionSplitImpulseBaumgarte,!1)){for(var g=0,N=a;g<N;){var A=g++,F=this.info.rows[A],P=F.impulse,Y=this.dImpulses[A];P.impulseP+=Y}var R=this.dImpulses,C=!1,d=!1,Z,$,K,E,J,B,Q,U,G,D,H,j;Z=this._b1._pseudoVelX,$=this._b1._pseudoVelY,K=this._b1._pseudoVelZ,E=this._b2._pseudoVelX,J=this._b2._pseudoVelY,B=this._b2._pseudoVelZ,Q=this._b1._angPseudoVelX,U=this._b1._angPseudoVelY,G=this._b1._angPseudoVelZ,D=this._b2._angPseudoVelX,H=this._b2._angPseudoVelY,j=this._b2._angPseudoVelZ;for(var ia=0,sa=this.info.numRows;ia<sa;){var W=ia++,q=this.info.rows[W],na=q.jacobian,oa=this.massData[W],aa=R[W];na.flag&1&&(Z+=oa.invMLin1X*aa,$+=oa.invMLin1Y*aa,K+=oa.invMLin1Z*aa,E+=oa.invMLin2X*-aa,J+=oa.invMLin2Y*-aa,B+=oa.invMLin2Z*-aa,C=!0),na.flag&2&&(Q+=oa.invMAng1X*aa,U+=oa.invMAng1Y*aa,G+=oa.invMAng1Z*aa,D+=oa.invMAng2X*-aa,H+=oa.invMAng2Y*-aa,j+=oa.invMAng2Z*-aa,d=!0)}C&&(this._b1._pseudoVelX=Z,this._b1._pseudoVelY=$,this._b1._pseudoVelZ=K,this._b2._pseudoVelX=E,this._b2._pseudoVelY=J,this._b2._pseudoVelZ=B),d&&(this._b1._angPseudoVelX=Q,this._b1._angPseudoVelY=U,this._b1._angPseudoVelZ=G,this._b2._angPseudoVelX=D,this._b2._angPseudoVelY=H,this._b2._angPseudoVelZ=j);for(var T=this.posBoundarySelector,ca=0;T.indices[ca]!=L;)++ca;for(;ca>0;){var _a=T.indices[ca];T.indices[ca]=T.indices[ca-1],T.indices[ca-1]=_a,--ca}M=!0;break}}if(!M){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:450:","could not find solution. (split impulse)");return}}solvePositionNgs(a){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var t=this.boundaryBuilder;t.numBoundaries=0;var i=t.bbInfo;i.numBounded=0,i.numUnbounded=0,t.buildBoundariesRecursive(this.info,0);for(var r=this.posBoundarySelector,o=this.boundaryBuilder.numBoundaries,s=0,_=0,h=0,v=r.n;h<v;){var e=h++,l=r.indices[e];l<o?(r.tmpIndices[s]=l,++s):(r.tmpIndices[o+_]=l,++_)}var u=r.indices;r.indices=r.tmpIndices,r.tmpIndices=u;for(var b=this.info.numRows,f=0,n=b;f<n;){var c=f++,z=this.info.rows[c],p=z.impulse;z.jacobian,this.relVels[c]=0,this.impulses[c]=p.impulseP}for(var y=!1,V=0,M=this.boundaryBuilder.numBoundaries;V<M;){var I=V++,k=this.posBoundarySelector.indices[I],X=this.boundaryBuilder.boundaries[k];if(X.computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,x.common.Setting.positionNgsBaumgarte,!1)){for(var L=0,m=b;L<m;){var g=L++,N=this.info.rows[g],A=N.impulse,F=this.dImpulses[g];A.impulseP+=F}var P=this.dImpulses,Y=!1,R=!1,C,d,Z,$,K,E,J,B,Q,U,G,D;C=0,d=0,Z=0,$=0,K=0,E=0,J=0,B=0,Q=0,U=0,G=0,D=0;for(var H=0,j=this.info.numRows;H<j;){var ia=H++,sa=this.info.rows[ia],W=sa.jacobian,q=this.massData[ia],na=P[ia];W.flag&1&&(C+=q.invMLin1X*na,d+=q.invMLin1Y*na,Z+=q.invMLin1Z*na,$+=q.invMLin2X*-na,K+=q.invMLin2Y*-na,E+=q.invMLin2Z*-na,Y=!0),W.flag&2&&(J+=q.invMAng1X*na,B+=q.invMAng1Y*na,Q+=q.invMAng1Z*na,U+=q.invMAng2X*-na,G+=q.invMAng2Y*-na,D+=q.invMAng2Z*-na,R=!0)}if(Y){var oa=this._b1;oa._transform._positionX+=C,oa._transform._positionY+=d,oa._transform._positionZ+=Z;var aa=this._b2;aa._transform._positionX+=$,aa._transform._positionY+=K,aa._transform._positionZ+=E}if(R){var T=this._b1,ca=Math.sqrt(J*J+B*B+Q*Q),_a=ca*.5,w,ta;if(_a<.5){var ra=_a*_a;w=.5*(1-ra*.16666666666666666+ra*ra*.008333333333333333),ta=1-ra*.5+ra*ra*.041666666666666664}else w=Math.sin(_a)/ca,ta=Math.cos(_a);var la,va,xa;la=J*w,va=B*w,xa=Q*w;var za,Ma,Xa,Za;za=la,Ma=va,Xa=xa,Za=ta;var fa,ba,ea,ha,ma=T._transform._rotation00,ya=T._transform._rotation11,da=T._transform._rotation22,pa=ma+ya+da,Ya;pa>0?(Ya=Math.sqrt(pa+1),ha=.5*Ya,Ya=.5/Ya,fa=(T._transform._rotation21-T._transform._rotation12)*Ya,ba=(T._transform._rotation02-T._transform._rotation20)*Ya,ea=(T._transform._rotation10-T._transform._rotation01)*Ya):ma>ya?ma>da?(Ya=Math.sqrt(ma-ya-da+1),fa=.5*Ya,Ya=.5/Ya,ba=(T._transform._rotation01+T._transform._rotation10)*Ya,ea=(T._transform._rotation02+T._transform._rotation20)*Ya,ha=(T._transform._rotation21-T._transform._rotation12)*Ya):(Ya=Math.sqrt(da-ma-ya+1),ea=.5*Ya,Ya=.5/Ya,fa=(T._transform._rotation02+T._transform._rotation20)*Ya,ba=(T._transform._rotation12+T._transform._rotation21)*Ya,ha=(T._transform._rotation10-T._transform._rotation01)*Ya):ya>da?(Ya=Math.sqrt(ya-da-ma+1),ba=.5*Ya,Ya=.5/Ya,fa=(T._transform._rotation01+T._transform._rotation10)*Ya,ea=(T._transform._rotation12+T._transform._rotation21)*Ya,ha=(T._transform._rotation02-T._transform._rotation20)*Ya):(Ya=Math.sqrt(da-ma-ya+1),ea=.5*Ya,Ya=.5/Ya,fa=(T._transform._rotation02+T._transform._rotation20)*Ya,ba=(T._transform._rotation12+T._transform._rotation21)*Ya,ha=(T._transform._rotation10-T._transform._rotation01)*Ya),fa=Za*fa+za*ha+Ma*ea-Xa*ba,ba=Za*ba-za*ea+Ma*ha+Xa*fa,ea=Za*ea+za*ba-Ma*fa+Xa*ha,ha=Za*ha-za*fa-Ma*ba-Xa*ea;var Qa=fa*fa+ba*ba+ea*ea+ha*ha;Qa>1e-32&&(Qa=1/Math.sqrt(Qa)),fa*=Qa,ba*=Qa,ea*=Qa,ha*=Qa;var ga=fa,ua=ba,wa=ea,ka=ha,Sa=2*ga,zt=2*ua,Ha=2*wa,Ba=ga*Sa,nt=ua*zt,Ea=wa*Ha,Fa=ga*zt,Aa=ua*Ha,ft=ga*Ha,Wa=ka*Sa,Ka=ka*zt,bt=ka*Ha;T._transform._rotation00=1-nt-Ea,T._transform._rotation01=Fa-bt,T._transform._rotation02=ft+Ka,T._transform._rotation10=Fa+bt,T._transform._rotation11=1-Ba-Ea,T._transform._rotation12=Aa-Wa,T._transform._rotation20=ft-Ka,T._transform._rotation21=Aa+Wa,T._transform._rotation22=1-Ba-nt;var it,$a,_t,gt,pt,Ga,rt,ut,Da;it=T._transform._rotation00*T._invLocalInertia00+T._transform._rotation01*T._invLocalInertia10+T._transform._rotation02*T._invLocalInertia20,$a=T._transform._rotation00*T._invLocalInertia01+T._transform._rotation01*T._invLocalInertia11+T._transform._rotation02*T._invLocalInertia21,_t=T._transform._rotation00*T._invLocalInertia02+T._transform._rotation01*T._invLocalInertia12+T._transform._rotation02*T._invLocalInertia22,gt=T._transform._rotation10*T._invLocalInertia00+T._transform._rotation11*T._invLocalInertia10+T._transform._rotation12*T._invLocalInertia20,pt=T._transform._rotation10*T._invLocalInertia01+T._transform._rotation11*T._invLocalInertia11+T._transform._rotation12*T._invLocalInertia21,Ga=T._transform._rotation10*T._invLocalInertia02+T._transform._rotation11*T._invLocalInertia12+T._transform._rotation12*T._invLocalInertia22,rt=T._transform._rotation20*T._invLocalInertia00+T._transform._rotation21*T._invLocalInertia10+T._transform._rotation22*T._invLocalInertia20,ut=T._transform._rotation20*T._invLocalInertia01+T._transform._rotation21*T._invLocalInertia11+T._transform._rotation22*T._invLocalInertia21,Da=T._transform._rotation20*T._invLocalInertia02+T._transform._rotation21*T._invLocalInertia12+T._transform._rotation22*T._invLocalInertia22,T._invInertia00=it,T._invInertia01=$a,T._invInertia02=_t,T._invInertia10=gt,T._invInertia11=pt,T._invInertia12=Ga,T._invInertia20=rt,T._invInertia21=ut,T._invInertia22=Da;var Ta,Na,Vt,St,et,Xt,Yt,Mt,Ia;Ta=T._invInertia00*T._transform._rotation00+T._invInertia01*T._transform._rotation01+T._invInertia02*T._transform._rotation02,Na=T._invInertia00*T._transform._rotation10+T._invInertia01*T._transform._rotation11+T._invInertia02*T._transform._rotation12,Vt=T._invInertia00*T._transform._rotation20+T._invInertia01*T._transform._rotation21+T._invInertia02*T._transform._rotation22,St=T._invInertia10*T._transform._rotation00+T._invInertia11*T._transform._rotation01+T._invInertia12*T._transform._rotation02,et=T._invInertia10*T._transform._rotation10+T._invInertia11*T._transform._rotation11+T._invInertia12*T._transform._rotation12,Xt=T._invInertia10*T._transform._rotation20+T._invInertia11*T._transform._rotation21+T._invInertia12*T._transform._rotation22,Yt=T._invInertia20*T._transform._rotation00+T._invInertia21*T._transform._rotation01+T._invInertia22*T._transform._rotation02,Mt=T._invInertia20*T._transform._rotation10+T._invInertia21*T._transform._rotation11+T._invInertia22*T._transform._rotation12,Ia=T._invInertia20*T._transform._rotation20+T._invInertia21*T._transform._rotation21+T._invInertia22*T._transform._rotation22,T._invInertia00=Ta,T._invInertia01=Na,T._invInertia02=Vt,T._invInertia10=St,T._invInertia11=et,T._invInertia12=Xt,T._invInertia20=Yt,T._invInertia21=Mt,T._invInertia22=Ia,T._invInertia00*=T._rotFactor.x,T._invInertia01*=T._rotFactor.x,T._invInertia02*=T._rotFactor.x,T._invInertia10*=T._rotFactor.y,T._invInertia11*=T._rotFactor.y,T._invInertia12*=T._rotFactor.y,T._invInertia20*=T._rotFactor.z,T._invInertia21*=T._rotFactor.z,T._invInertia22*=T._rotFactor.z;var O=this._b2,Va=Math.sqrt(U*U+G*G+D*D),lt=Va*.5,S,wt;if(lt<.5){var Bt=lt*lt;S=.5*(1-Bt*.16666666666666666+Bt*Bt*.008333333333333333),wt=1-Bt*.5+Bt*Bt*.041666666666666664}else S=Math.sin(lt)/Va,wt=Math.cos(lt);var At,yt,kt;At=U*S,yt=G*S,kt=D*S;var mt,ht,xt,Ra;mt=At,ht=yt,xt=kt,Ra=wt;var st,Ca,vt,qa,at=O._transform._rotation00,Oa=O._transform._rotation11,tt=O._transform._rotation22,ct=at+Oa+tt,Pa;ct>0?(Pa=Math.sqrt(ct+1),qa=.5*Pa,Pa=.5/Pa,st=(O._transform._rotation21-O._transform._rotation12)*Pa,Ca=(O._transform._rotation02-O._transform._rotation20)*Pa,vt=(O._transform._rotation10-O._transform._rotation01)*Pa):at>Oa?at>tt?(Pa=Math.sqrt(at-Oa-tt+1),st=.5*Pa,Pa=.5/Pa,Ca=(O._transform._rotation01+O._transform._rotation10)*Pa,vt=(O._transform._rotation02+O._transform._rotation20)*Pa,qa=(O._transform._rotation21-O._transform._rotation12)*Pa):(Pa=Math.sqrt(tt-at-Oa+1),vt=.5*Pa,Pa=.5/Pa,st=(O._transform._rotation02+O._transform._rotation20)*Pa,Ca=(O._transform._rotation12+O._transform._rotation21)*Pa,qa=(O._transform._rotation10-O._transform._rotation01)*Pa):Oa>tt?(Pa=Math.sqrt(Oa-tt-at+1),Ca=.5*Pa,Pa=.5/Pa,st=(O._transform._rotation01+O._transform._rotation10)*Pa,vt=(O._transform._rotation12+O._transform._rotation21)*Pa,qa=(O._transform._rotation02-O._transform._rotation20)*Pa):(Pa=Math.sqrt(tt-at-Oa+1),vt=.5*Pa,Pa=.5/Pa,st=(O._transform._rotation02+O._transform._rotation20)*Pa,Ca=(O._transform._rotation12+O._transform._rotation21)*Pa,qa=(O._transform._rotation10-O._transform._rotation01)*Pa),st=Ra*st+mt*qa+ht*vt-xt*Ca,Ca=Ra*Ca-mt*vt+ht*qa+xt*st,vt=Ra*vt+mt*Ca-ht*st+xt*qa,qa=Ra*qa-mt*st-ht*Ca-xt*vt;var Ja=st*st+Ca*Ca+vt*vt+qa*qa;Ja>1e-32&&(Ja=1/Math.sqrt(Ja)),st*=Ja,Ca*=Ja,vt*=Ja,qa*=Ja;var ja=st,La=Ca,ot=vt,It=qa,oi=2*ja,gi=2*La,ai=2*ot,Ct=ja*oi,_i=La*gi,Et=ot*ai,Pt=ja*gi,Jt=La*ai,Ki=ja*ai,vi=It*oi,li=It*gi,ti=It*ai;O._transform._rotation00=1-_i-Et,O._transform._rotation01=Pt-ti,O._transform._rotation02=Ki+li,O._transform._rotation10=Pt+ti,O._transform._rotation11=1-Ct-Et,O._transform._rotation12=Jt-vi,O._transform._rotation20=Ki-li,O._transform._rotation21=Jt+vi,O._transform._rotation22=1-Ct-_i;var Oi,Xi,zi,Zt,ri,Wt,ni,$i,Ut;Oi=O._transform._rotation00*O._invLocalInertia00+O._transform._rotation01*O._invLocalInertia10+O._transform._rotation02*O._invLocalInertia20,Xi=O._transform._rotation00*O._invLocalInertia01+O._transform._rotation01*O._invLocalInertia11+O._transform._rotation02*O._invLocalInertia21,zi=O._transform._rotation00*O._invLocalInertia02+O._transform._rotation01*O._invLocalInertia12+O._transform._rotation02*O._invLocalInertia22,Zt=O._transform._rotation10*O._invLocalInertia00+O._transform._rotation11*O._invLocalInertia10+O._transform._rotation12*O._invLocalInertia20,ri=O._transform._rotation10*O._invLocalInertia01+O._transform._rotation11*O._invLocalInertia11+O._transform._rotation12*O._invLocalInertia21,Wt=O._transform._rotation10*O._invLocalInertia02+O._transform._rotation11*O._invLocalInertia12+O._transform._rotation12*O._invLocalInertia22,ni=O._transform._rotation20*O._invLocalInertia00+O._transform._rotation21*O._invLocalInertia10+O._transform._rotation22*O._invLocalInertia20,$i=O._transform._rotation20*O._invLocalInertia01+O._transform._rotation21*O._invLocalInertia11+O._transform._rotation22*O._invLocalInertia21,Ut=O._transform._rotation20*O._invLocalInertia02+O._transform._rotation21*O._invLocalInertia12+O._transform._rotation22*O._invLocalInertia22,O._invInertia00=Oi,O._invInertia01=Xi,O._invInertia02=zi,O._invInertia10=Zt,O._invInertia11=ri,O._invInertia12=Wt,O._invInertia20=ni,O._invInertia21=$i,O._invInertia22=Ut;var ji,Ii,pr,Wi,Lt,jt,Tt,bi,Mi;ji=O._invInertia00*O._transform._rotation00+O._invInertia01*O._transform._rotation01+O._invInertia02*O._transform._rotation02,Ii=O._invInertia00*O._transform._rotation10+O._invInertia01*O._transform._rotation11+O._invInertia02*O._transform._rotation12,pr=O._invInertia00*O._transform._rotation20+O._invInertia01*O._transform._rotation21+O._invInertia02*O._transform._rotation22,Wi=O._invInertia10*O._transform._rotation00+O._invInertia11*O._transform._rotation01+O._invInertia12*O._transform._rotation02,Lt=O._invInertia10*O._transform._rotation10+O._invInertia11*O._transform._rotation11+O._invInertia12*O._transform._rotation12,jt=O._invInertia10*O._transform._rotation20+O._invInertia11*O._transform._rotation21+O._invInertia12*O._transform._rotation22,Tt=O._invInertia20*O._transform._rotation00+O._invInertia21*O._transform._rotation01+O._invInertia22*O._transform._rotation02,bi=O._invInertia20*O._transform._rotation10+O._invInertia21*O._transform._rotation11+O._invInertia22*O._transform._rotation12,Mi=O._invInertia20*O._transform._rotation20+O._invInertia21*O._transform._rotation21+O._invInertia22*O._transform._rotation22,O._invInertia00=ji,O._invInertia01=Ii,O._invInertia02=pr,O._invInertia10=Wi,O._invInertia11=Lt,O._invInertia12=jt,O._invInertia20=Tt,O._invInertia21=bi,O._invInertia22=Mi,O._invInertia00*=O._rotFactor.x,O._invInertia01*=O._rotFactor.x,O._invInertia02*=O._rotFactor.x,O._invInertia10*=O._rotFactor.y,O._invInertia11*=O._rotFactor.y,O._invInertia12*=O._rotFactor.y,O._invInertia20*=O._rotFactor.z,O._invInertia21*=O._rotFactor.z,O._invInertia22*=O._rotFactor.z}for(var vr=this.posBoundarySelector,qt=0;vr.indices[qt]!=k;)++qt;for(;qt>0;){var fi=vr.indices[qt];vr.indices[qt]=vr.indices[qt-1],vr.indices[qt-1]=fi,--qt}y=!0;break}}if(!y){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:502:","could not find solution. (NGS)");return}}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}};x.dynamics.constraint.solver.direct.MassMatrix=class{constructor(a){this._size=a;var t=new Array(this._size);this.tmpMatrix=t;var i=new Array(this._size);this._invMass=i;var r=new Array(this._size);this._invMassWithoutCfm=r;for(var o=0,s=this._size;o<s;){var _=o++,h=this.tmpMatrix,v=new Array(this._size);h[_]=v;var e=this._invMass,l=new Array(this._size);e[_]=l;var u=this._invMassWithoutCfm,b=new Array(this._size);u[_]=b;for(var f=0,n=this._size;f<n;){var c=f++;this.tmpMatrix[_][c]=0,this._invMass[_][c]=0,this._invMassWithoutCfm[_][c]=0}}this._maxSubmatrixId=1<<this._size;var z=new Array(this._maxSubmatrixId);this._cacheComputed=z;var p=new Array(this._maxSubmatrixId);this._cachedSubmatrices=p;for(var y=0,V=this._maxSubmatrixId;y<V;){var M=y++,I=M;I=(I&85)+(I>>1&85),I=(I&51)+(I>>2&51),I=(I&15)+(I>>4&15);for(var k=I,X=new Array(k),L=X,m=0,g=k;m<g;){var N=m++,A=new Array(k);L[N]=A;for(var F=0,P=k;F<P;){var Y=F++;L[N][Y]=0}}this._cacheComputed[M]=!1,this._cachedSubmatrices[M]=L}}computeSubmatrix(a,t,i){for(var r=0,o=i;r<o;)for(var s=r++,_=t[s],h=0,v=i;h<v;){var e=h++;this.tmpMatrix[s][e]=this._invMass[_][t[e]]}var l=this.tmpMatrix,u=this._cachedSubmatrices[a],b,f,n,c,z;switch(i){case 4:b=l[0],f=u[0],z=1/b[0],f[0]=z,b[1]=b[1]*z,b[2]=b[2]*z,b[3]=b[3]*z,n=l[1],c=u[1],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n=l[2],c=u[2],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n=l[3],c=u[3],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],b=l[1],f=u[1],z=1/b[1],f[1]=z,f[0]=f[0]*z,b[2]=b[2]*z,b[3]=b[3]*z,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[1],c[1]=-z*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[1],c[1]=-z*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],b=l[2],f=u[2],z=1/b[2],f[2]=z,f[0]=f[0]*z,f[1]=f[1]*z,b[3]=b[3]*z,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[2],n[3]=n[3]-b[3]*n[2],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],n[3]=n[3]-b[3]*n[2],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-z*n[2],n[3]=n[3]-b[3]*n[2],b=l[3],f=u[3],z=1/b[3],f[3]=z,f[0]=f[0]*z,f[1]=f[1]*z,f[2]=f[2]*z,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[3],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],f=u[1],u[0][1]=f[0],f=u[2],u[0][2]=f[0],u[1][2]=f[1],f=u[3],u[0][3]=f[0],u[1][3]=f[1],u[2][3]=f[2];break;case 5:b=l[0],f=u[0],z=1/b[0],f[0]=z,b[1]=b[1]*z,b[2]=b[2]*z,b[3]=b[3]*z,b[4]=b[4]*z,n=l[1],c=u[1],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n=l[2],c=u[2],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n=l[3],c=u[3],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n=l[4],c=u[4],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],b=l[1],f=u[1],z=1/b[1],f[1]=z,f[0]=f[0]*z,b[2]=b[2]*z,b[3]=b[3]*z,b[4]=b[4]*z,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[1],c[1]=-z*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[1],c[1]=-z*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n=l[4],c=u[4],c[0]=c[0]-f[0]*n[1],c[1]=-z*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],b=l[2],f=u[2],z=1/b[2],f[2]=z,f[0]=f[0]*z,f[1]=f[1]*z,b[3]=b[3]*z,b[4]=b[4]*z,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-z*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n=l[4],c=u[4],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-z*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],b=l[3],f=u[3],z=1/b[3],f[3]=z,f[0]=f[0]*z,f[1]=f[1]*z,f[2]=f[2]*z,b[4]=b[4]*z,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[3],n[4]=n[4]-b[4]*n[3],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],n[4]=n[4]-b[4]*n[3],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],n[4]=n[4]-b[4]*n[3],n=l[4],c=u[4],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],c[3]=-z*n[3],n[4]=n[4]-b[4]*n[3],b=l[4],f=u[4],z=1/b[4],f[4]=z,f[0]=f[0]*z,f[1]=f[1]*z,f[2]=f[2]*z,f[3]=f[3]*z,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[4],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],c[2]=c[2]-f[2]*n[4],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],c[2]=c[2]-f[2]*n[4],c[3]=c[3]-f[3]*n[4],f=u[1],u[0][1]=f[0],f=u[2],u[0][2]=f[0],u[1][2]=f[1],f=u[3],u[0][3]=f[0],u[1][3]=f[1],u[2][3]=f[2],f=u[4],u[0][4]=f[0],u[1][4]=f[1],u[2][4]=f[2],u[3][4]=f[3];break;case 6:b=l[0],f=u[0],z=1/b[0],f[0]=z,b[1]=b[1]*z,b[2]=b[2]*z,b[3]=b[3]*z,b[4]=b[4]*z,b[5]=b[5]*z,n=l[1],c=u[1],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n[5]=n[5]-b[5]*n[0],n=l[2],c=u[2],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n[5]=n[5]-b[5]*n[0],n=l[3],c=u[3],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n[5]=n[5]-b[5]*n[0],n=l[4],c=u[4],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n[5]=n[5]-b[5]*n[0],n=l[5],c=u[5],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n[5]=n[5]-b[5]*n[0],b=l[1],f=u[1],z=1/b[1],f[1]=z,f[0]=f[0]*z,b[2]=b[2]*z,b[3]=b[3]*z,b[4]=b[4]*z,b[5]=b[5]*z,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n[5]=n[5]-b[5]*n[1],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[1],c[1]=-z*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n[5]=n[5]-b[5]*n[1],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[1],c[1]=-z*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n[5]=n[5]-b[5]*n[1],n=l[4],c=u[4],c[0]=c[0]-f[0]*n[1],c[1]=-z*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n[5]=n[5]-b[5]*n[1],n=l[5],c=u[5],c[0]=c[0]-f[0]*n[1],c[1]=-z*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n[5]=n[5]-b[5]*n[1],b=l[2],f=u[2],z=1/b[2],f[2]=z,f[0]=f[0]*z,f[1]=f[1]*z,b[3]=b[3]*z,b[4]=b[4]*z,b[5]=b[5]*z,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n[5]=n[5]-b[5]*n[2],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n[5]=n[5]-b[5]*n[2],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-z*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n[5]=n[5]-b[5]*n[2],n=l[4],c=u[4],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-z*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n[5]=n[5]-b[5]*n[2],n=l[5],c=u[5],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-z*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n[5]=n[5]-b[5]*n[2],b=l[3],f=u[3],z=1/b[3],f[3]=z,f[0]=f[0]*z,f[1]=f[1]*z,f[2]=f[2]*z,b[4]=b[4]*z,b[5]=b[5]*z,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[3],n[4]=n[4]-b[4]*n[3],n[5]=n[5]-b[5]*n[3],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],n[4]=n[4]-b[4]*n[3],n[5]=n[5]-b[5]*n[3],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],n[4]=n[4]-b[4]*n[3],n[5]=n[5]-b[5]*n[3],n=l[4],c=u[4],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],c[3]=-z*n[3],n[4]=n[4]-b[4]*n[3],n[5]=n[5]-b[5]*n[3],n=l[5],c=u[5],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],c[3]=-z*n[3],n[4]=n[4]-b[4]*n[3],n[5]=n[5]-b[5]*n[3],b=l[4],f=u[4],z=1/b[4],f[4]=z,f[0]=f[0]*z,f[1]=f[1]*z,f[2]=f[2]*z,f[3]=f[3]*z,b[5]=b[5]*z,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[4],n[5]=n[5]-b[5]*n[4],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],n[5]=n[5]-b[5]*n[4],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],c[2]=c[2]-f[2]*n[4],n[5]=n[5]-b[5]*n[4],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],c[2]=c[2]-f[2]*n[4],c[3]=c[3]-f[3]*n[4],n[5]=n[5]-b[5]*n[4],n=l[5],c=u[5],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],c[2]=c[2]-f[2]*n[4],c[3]=c[3]-f[3]*n[4],c[4]=-z*n[4],n[5]=n[5]-b[5]*n[4],b=l[5],f=u[5],z=1/b[5],f[5]=z,f[0]=f[0]*z,f[1]=f[1]*z,f[2]=f[2]*z,f[3]=f[3]*z,f[4]=f[4]*z,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[5],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[5],c[1]=c[1]-f[1]*n[5],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[5],c[1]=c[1]-f[1]*n[5],c[2]=c[2]-f[2]*n[5],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[5],c[1]=c[1]-f[1]*n[5],c[2]=c[2]-f[2]*n[5],c[3]=c[3]-f[3]*n[5],n=l[4],c=u[4],c[0]=c[0]-f[0]*n[5],c[1]=c[1]-f[1]*n[5],c[2]=c[2]-f[2]*n[5],c[3]=c[3]-f[3]*n[5],c[4]=c[4]-f[4]*n[5],f=u[1],u[0][1]=f[0],f=u[2],u[0][2]=f[0],u[1][2]=f[1],f=u[3],u[0][3]=f[0],u[1][3]=f[1],u[2][3]=f[2],f=u[4],u[0][4]=f[0],u[1][4]=f[1],u[2][4]=f[2],u[3][4]=f[3],f=u[5],u[0][5]=f[0],u[1][5]=f[1],u[2][5]=f[2],u[3][5]=f[3],u[4][5]=f[4];break;default:for(var p=0,y=i;p<y;){var V=p++;b=l[V],f=u[V];var M=1/b[V];f[V]=M;for(var I=0,k=V;I<k;){var X=I++;f[X]=f[X]*M}for(var L=V+1,m=i;L<m;){var g=L++;b[g]=b[g]*M}for(var N=0,A=V;N<A;){var F=N++;n=l[F],c=u[F];for(var P=0,Y=F+1;P<Y;){var R=P++;c[R]=c[R]-f[R]*n[V]}for(var C=V+1,d=i;C<d;){var Z=C++;n[Z]=n[Z]-b[Z]*n[V]}}for(var $=V+1,K=i;$<K;){var E=$++;n=l[E],c=u[E];for(var J=0,B=V;J<B;){var Q=J++;c[Q]=c[Q]-f[Q]*n[V]}c[V]=-M*n[V];for(var U=V+1,G=i;U<G;){var D=U++;n[D]=n[D]-b[D]*n[V]}}}for(var H=1,j=i;H<j;){var ia=H++;f=u[ia];for(var sa=0,W=ia;sa<W;){var q=sa++;u[q][ia]=f[q]}}}}computeInvMass(a,t){var i=this._invMass,r=this._invMassWithoutCfm,o=a.numRows,s=a.b1,_=a.b2,h=s._invMass,v=_._invMass,e,l,u,b,f,n,c,z,p,y,V,M,I,k,X,L,m,g;e=s._invInertia00,l=s._invInertia01,u=s._invInertia02,b=s._invInertia10,f=s._invInertia11,n=s._invInertia12,c=s._invInertia20,z=s._invInertia21,p=s._invInertia22,y=_._invInertia00,V=_._invInertia01,M=_._invInertia02,I=_._invInertia10,k=_._invInertia11,X=_._invInertia12,L=_._invInertia20,m=_._invInertia21,g=_._invInertia22;for(var N=0,A=o;N<A;){var F=N++,P=a.rows[F].jacobian,Y=t[F];if(P.updateSparsity(),P.flag&1?(Y.invMLin1X=P.lin1X*h,Y.invMLin1Y=P.lin1Y*h,Y.invMLin1Z=P.lin1Z*h,Y.invMLin2X=P.lin2X*v,Y.invMLin2Y=P.lin2Y*v,Y.invMLin2Z=P.lin2Z*v):(Y.invMLin1X=0,Y.invMLin1Y=0,Y.invMLin1Z=0,Y.invMLin2X=0,Y.invMLin2Y=0,Y.invMLin2Z=0),P.flag&2){var R,C,d;R=e*P.ang1X+l*P.ang1Y+u*P.ang1Z,C=b*P.ang1X+f*P.ang1Y+n*P.ang1Z,d=c*P.ang1X+z*P.ang1Y+p*P.ang1Z,Y.invMAng1X=R,Y.invMAng1Y=C,Y.invMAng1Z=d;var Z,$,K;Z=y*P.ang2X+V*P.ang2Y+M*P.ang2Z,$=I*P.ang2X+k*P.ang2Y+X*P.ang2Z,K=L*P.ang2X+m*P.ang2Y+g*P.ang2Z,Y.invMAng2X=Z,Y.invMAng2Y=$,Y.invMAng2Z=K}else Y.invMAng1X=0,Y.invMAng1Y=0,Y.invMAng1Z=0,Y.invMAng2X=0,Y.invMAng2Y=0,Y.invMAng2Z=0}for(var E=0,J=o;E<J;)for(var B=E++,Q=a.rows[B].jacobian,U=B,G=o;U<G;){var D=U++;a.rows[D].jacobian;var H=t[D],j=Q.lin1X*H.invMLin1X+Q.lin1Y*H.invMLin1Y+Q.lin1Z*H.invMLin1Z+(Q.ang1X*H.invMAng1X+Q.ang1Y*H.invMAng1Y+Q.ang1Z*H.invMAng1Z)+(Q.lin2X*H.invMLin2X+Q.lin2Y*H.invMLin2Y+Q.lin2Z*H.invMLin2Z)+(Q.ang2X*H.invMAng2X+Q.ang2Y*H.invMAng2Y+Q.ang2Z*H.invMAng2Z);B==D?(i[B][D]=j+a.rows[B].cfm,r[B][D]=j,H.mass=j+a.rows[B].cfm,H.massWithoutCfm=j,H.mass!=0&&(H.mass=1/H.mass),H.massWithoutCfm!=0&&(H.massWithoutCfm=1/H.massWithoutCfm)):(i[B][D]=j,i[D][B]=j,r[B][D]=j,r[D][B]=j)}for(var ia=0,sa=this._maxSubmatrixId;ia<sa;){var W=ia++;this._cacheComputed[W]=!1}}};x.dynamics.constraint.solver.pgs||(x.dynamics.constraint.solver.pgs={});x.dynamics.constraint.solver.pgs.PgsContactConstraintSolver=class extends x.dynamics.constraint.ConstraintSolver{constructor(a){super(),this.constraint=a,this.info=new x.dynamics.constraint.info.contact.ContactSolverInfo;var t=new Array(x.common.Setting.maxManifoldPoints);this.massData=t;for(var i=0,r=this.massData.length;i<r;){var o=i++;this.massData[o]=new x.dynamics.constraint.solver.common.ContactSolverMassDataRow}}preSolveVelocity(a){this.constraint._getVelocitySolverInfo(a,this.info),this._b1=this.info.b1,this._b2=this.info.b2;var t=this._b1._invMass,i=this._b2._invMass,r,o,s,_,h,v,e,l,u,b,f,n,c,z,p,y,V,M;r=this._b1._invInertia00,o=this._b1._invInertia01,s=this._b1._invInertia02,_=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,e=this._b1._invInertia20,l=this._b1._invInertia21,u=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,z=this._b2._invInertia11,p=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,M=this._b2._invInertia22;for(var I=0,k=this.info.numRows;I<k;){var X=I++,L=this.info.rows[X],m=this.massData[X],g=L.jacobianN;m.invMLinN1X=g.lin1X*t,m.invMLinN1Y=g.lin1Y*t,m.invMLinN1Z=g.lin1Z*t,m.invMLinN2X=g.lin2X*i,m.invMLinN2Y=g.lin2Y*i,m.invMLinN2Z=g.lin2Z*i;var N,A,F;N=r*g.ang1X+o*g.ang1Y+s*g.ang1Z,A=_*g.ang1X+h*g.ang1Y+v*g.ang1Z,F=e*g.ang1X+l*g.ang1Y+u*g.ang1Z,m.invMAngN1X=N,m.invMAngN1Y=A,m.invMAngN1Z=F;var P,Y,R;P=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+z*g.ang2Y+p*g.ang2Z,R=y*g.ang2X+V*g.ang2Y+M*g.ang2Z,m.invMAngN2X=P,m.invMAngN2Y=Y,m.invMAngN2Z=R,m.massN=t+i+(m.invMAngN1X*g.ang1X+m.invMAngN1Y*g.ang1Y+m.invMAngN1Z*g.ang1Z)+(m.invMAngN2X*g.ang2X+m.invMAngN2Y*g.ang2Y+m.invMAngN2Z*g.ang2Z),m.massN!=0&&(m.massN=1/m.massN);var C=L.jacobianT,d=L.jacobianB;m.invMLinT1X=C.lin1X*t,m.invMLinT1Y=C.lin1Y*t,m.invMLinT1Z=C.lin1Z*t,m.invMLinT2X=C.lin2X*i,m.invMLinT2Y=C.lin2Y*i,m.invMLinT2Z=C.lin2Z*i,m.invMLinB1X=d.lin1X*t,m.invMLinB1Y=d.lin1Y*t,m.invMLinB1Z=d.lin1Z*t,m.invMLinB2X=d.lin2X*i,m.invMLinB2Y=d.lin2Y*i,m.invMLinB2Z=d.lin2Z*i;var Z,$,K;Z=r*C.ang1X+o*C.ang1Y+s*C.ang1Z,$=_*C.ang1X+h*C.ang1Y+v*C.ang1Z,K=e*C.ang1X+l*C.ang1Y+u*C.ang1Z,m.invMAngT1X=Z,m.invMAngT1Y=$,m.invMAngT1Z=K;var E,J,B;E=b*C.ang2X+f*C.ang2Y+n*C.ang2Z,J=c*C.ang2X+z*C.ang2Y+p*C.ang2Z,B=y*C.ang2X+V*C.ang2Y+M*C.ang2Z,m.invMAngT2X=E,m.invMAngT2Y=J,m.invMAngT2Z=B;var Q,U,G;Q=r*d.ang1X+o*d.ang1Y+s*d.ang1Z,U=_*d.ang1X+h*d.ang1Y+v*d.ang1Z,G=e*d.ang1X+l*d.ang1Y+u*d.ang1Z,m.invMAngB1X=Q,m.invMAngB1Y=U,m.invMAngB1Z=G;var D,H,j;D=b*d.ang2X+f*d.ang2Y+n*d.ang2Z,H=c*d.ang2X+z*d.ang2Y+p*d.ang2Z,j=y*d.ang2X+V*d.ang2Y+M*d.ang2Z,m.invMAngB2X=D,m.invMAngB2Y=H,m.invMAngB2Z=j;var ia=t+i+(m.invMAngT1X*C.ang1X+m.invMAngT1Y*C.ang1Y+m.invMAngT1Z*C.ang1Z)+(m.invMAngT2X*C.ang2X+m.invMAngT2Y*C.ang2Y+m.invMAngT2Z*C.ang2Z),sa=m.invMAngT1X*d.ang1X+m.invMAngT1Y*d.ang1Y+m.invMAngT1Z*d.ang1Z+(m.invMAngT2X*d.ang2X+m.invMAngT2Y*d.ang2Y+m.invMAngT2Z*d.ang2Z),W=sa,q=t+i+(m.invMAngB1X*d.ang1X+m.invMAngB1Y*d.ang1Y+m.invMAngB1Z*d.ang1Z)+(m.invMAngB2X*d.ang2X+m.invMAngB2Y*d.ang2Y+m.invMAngB2Z*d.ang2Z),na=ia*q-sa*W;na!=0&&(na=1/na),m.massTB00=q*na,m.massTB01=-sa*na,m.massTB10=-W*na,m.massTB11=ia*na}}warmStart(a){var t,i,r,o,s,_,h,v,e,l,u,b;t=this._b1._velX,i=this._b1._velY,r=this._b1._velZ,o=this._b2._velX,s=this._b2._velY,_=this._b2._velZ,h=this._b1._angVelX,v=this._b1._angVelY,e=this._b1._angVelZ,l=this._b2._angVelX,u=this._b2._angVelY,b=this._b2._angVelZ;for(var f=0,n=this.info.numRows;f<n;){var c=f++,z=this.info.rows[c],p=z.impulse,y=this.massData[c],V=z.jacobianT,M=z.jacobianB,I=p.impulseN,k=p.impulseLX*V.lin1X+p.impulseLY*V.lin1Y+p.impulseLZ*V.lin1Z,X=p.impulseLX*M.lin1X+p.impulseLY*M.lin1Y+p.impulseLZ*M.lin1Z;p.impulseT=k,p.impulseB=X,p.impulseN*=a.dtRatio,p.impulseT*=a.dtRatio,p.impulseB*=a.dtRatio,t+=y.invMLinN1X*I,i+=y.invMLinN1Y*I,r+=y.invMLinN1Z*I,t+=y.invMLinT1X*k,i+=y.invMLinT1Y*k,r+=y.invMLinT1Z*k,t+=y.invMLinB1X*X,i+=y.invMLinB1Y*X,r+=y.invMLinB1Z*X,o+=y.invMLinN2X*-I,s+=y.invMLinN2Y*-I,_+=y.invMLinN2Z*-I,o+=y.invMLinT2X*-k,s+=y.invMLinT2Y*-k,_+=y.invMLinT2Z*-k,o+=y.invMLinB2X*-X,s+=y.invMLinB2Y*-X,_+=y.invMLinB2Z*-X,h+=y.invMAngN1X*I,v+=y.invMAngN1Y*I,e+=y.invMAngN1Z*I,h+=y.invMAngT1X*k,v+=y.invMAngT1Y*k,e+=y.invMAngT1Z*k,h+=y.invMAngB1X*X,v+=y.invMAngB1Y*X,e+=y.invMAngB1Z*X,l+=y.invMAngN2X*-I,u+=y.invMAngN2Y*-I,b+=y.invMAngN2Z*-I,l+=y.invMAngT2X*-k,u+=y.invMAngT2Y*-k,b+=y.invMAngT2Z*-k,l+=y.invMAngB2X*-X,u+=y.invMAngB2Y*-X,b+=y.invMAngB2Z*-X}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=r,this._b2._velX=o,this._b2._velY=s,this._b2._velZ=_,this._b1._angVelX=h,this._b1._angVelY=v,this._b1._angVelZ=e,this._b2._angVelX=l,this._b2._angVelY=u,this._b2._angVelZ=b}solveVelocity(){var a,t,i,r,o,s,_,h,v,e,l,u;a=this._b1._velX,t=this._b1._velY,i=this._b1._velZ,r=this._b2._velX,o=this._b2._velY,s=this._b2._velZ,_=this._b1._angVelX,h=this._b1._angVelY,v=this._b1._angVelZ,e=this._b2._angVelX,l=this._b2._angVelY,u=this._b2._angVelZ;for(var b=0,f=this.info.numRows;b<f;){var n=b++,c=this.info.rows[n],z=this.massData[n],p=c.impulse,y=0,V=c.jacobianT;y+=a*V.lin1X+t*V.lin1Y+i*V.lin1Z,y-=r*V.lin2X+o*V.lin2Y+s*V.lin2Z,y+=_*V.ang1X+h*V.ang1Y+v*V.ang1Z,y-=e*V.ang2X+l*V.ang2Y+u*V.ang2Z;var M=0;V=c.jacobianB,M+=a*V.lin1X+t*V.lin1Y+i*V.lin1Z,M-=r*V.lin2X+o*V.lin2Y+s*V.lin2Z,M+=_*V.ang1X+h*V.ang1Y+v*V.ang1Z,M-=e*V.ang2X+l*V.ang2Y+u*V.ang2Z;var I=-(y*z.massTB00+M*z.massTB01),k=-(y*z.massTB10+M*z.massTB11),X=p.impulseT,L=p.impulseB;p.impulseT+=I,p.impulseB+=k;var m=c.friction*p.impulseN;if(m==0)p.impulseT=0,p.impulseB=0;else{var g=p.impulseT*p.impulseT+p.impulseB*p.impulseB;if(g>m*m){var N=m/Math.sqrt(g);p.impulseT*=N,p.impulseB*=N}}I=p.impulseT-X,k=p.impulseB-L,a+=z.invMLinT1X*I,t+=z.invMLinT1Y*I,i+=z.invMLinT1Z*I,a+=z.invMLinB1X*k,t+=z.invMLinB1Y*k,i+=z.invMLinB1Z*k,r+=z.invMLinT2X*-I,o+=z.invMLinT2Y*-I,s+=z.invMLinT2Z*-I,r+=z.invMLinB2X*-k,o+=z.invMLinB2Y*-k,s+=z.invMLinB2Z*-k,_+=z.invMAngT1X*I,h+=z.invMAngT1Y*I,v+=z.invMAngT1Z*I,_+=z.invMAngB1X*k,h+=z.invMAngB1Y*k,v+=z.invMAngB1Z*k,e+=z.invMAngT2X*-I,l+=z.invMAngT2Y*-I,u+=z.invMAngT2Z*-I,e+=z.invMAngB2X*-k,l+=z.invMAngB2Y*-k,u+=z.invMAngB2Z*-k}for(var A=0,F=this.info.numRows;A<F;){var P=A++,Y=this.info.rows[P],R=this.massData[P],C=Y.impulse,d=0,Z=Y.jacobianN;d+=a*Z.lin1X+t*Z.lin1Y+i*Z.lin1Z,d-=r*Z.lin2X+o*Z.lin2Y+s*Z.lin2Z,d+=_*Z.ang1X+h*Z.ang1Y+v*Z.ang1Z,d-=e*Z.ang2X+l*Z.ang2Y+u*Z.ang2Z;var $=(Y.rhs-d)*R.massN,K=C.impulseN;C.impulseN+=$,C.impulseN<0&&(C.impulseN=0),$=C.impulseN-K,a+=R.invMLinN1X*$,t+=R.invMLinN1Y*$,i+=R.invMLinN1Z*$,r+=R.invMLinN2X*-$,o+=R.invMLinN2Y*-$,s+=R.invMLinN2Z*-$,_+=R.invMAngN1X*$,h+=R.invMAngN1Y*$,v+=R.invMAngN1Z*$,e+=R.invMAngN2X*-$,l+=R.invMAngN2Y*-$,u+=R.invMAngN2Z*-$}this._b1._velX=a,this._b1._velY=t,this._b1._velZ=i,this._b2._velX=r,this._b2._velY=o,this._b2._velZ=s,this._b1._angVelX=_,this._b1._angVelY=h,this._b1._angVelZ=v,this._b2._angVelX=e,this._b2._angVelY=l,this._b2._angVelZ=u}preSolvePosition(a){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);var t=this._b1._invMass,i=this._b2._invMass,r,o,s,_,h,v,e,l,u,b,f,n,c,z,p,y,V,M;r=this._b1._invInertia00,o=this._b1._invInertia01,s=this._b1._invInertia02,_=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,e=this._b1._invInertia20,l=this._b1._invInertia21,u=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,z=this._b2._invInertia11,p=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,M=this._b2._invInertia22;for(var I=0,k=this.info.numRows;I<k;){var X=I++,L=this.info.rows[X],m=this.massData[X],g=L.jacobianN;m.invMLinN1X=g.lin1X*t,m.invMLinN1Y=g.lin1Y*t,m.invMLinN1Z=g.lin1Z*t,m.invMLinN2X=g.lin2X*i,m.invMLinN2Y=g.lin2Y*i,m.invMLinN2Z=g.lin2Z*i;var N,A,F;N=r*g.ang1X+o*g.ang1Y+s*g.ang1Z,A=_*g.ang1X+h*g.ang1Y+v*g.ang1Z,F=e*g.ang1X+l*g.ang1Y+u*g.ang1Z,m.invMAngN1X=N,m.invMAngN1Y=A,m.invMAngN1Z=F;var P,Y,R;P=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+z*g.ang2Y+p*g.ang2Z,R=y*g.ang2X+V*g.ang2Y+M*g.ang2Z,m.invMAngN2X=P,m.invMAngN2Y=Y,m.invMAngN2Z=R,m.massN=t+i+(m.invMAngN1X*g.ang1X+m.invMAngN1Y*g.ang1Y+m.invMAngN1Z*g.ang1Z)+(m.invMAngN2X*g.ang2X+m.invMAngN2Y*g.ang2Y+m.invMAngN2Z*g.ang2Z),m.massN!=0&&(m.massN=1/m.massN)}for(var C=0,d=this.info.numRows;C<d;){var Z=C++;this.info.rows[Z].impulse.impulseP=0}}solvePositionSplitImpulse(){var a,t,i,r,o,s,_,h,v,e,l,u;a=this._b1._pseudoVelX,t=this._b1._pseudoVelY,i=this._b1._pseudoVelZ,r=this._b2._pseudoVelX,o=this._b2._pseudoVelY,s=this._b2._pseudoVelZ,_=this._b1._angPseudoVelX,h=this._b1._angPseudoVelY,v=this._b1._angPseudoVelZ,e=this._b2._angPseudoVelX,l=this._b2._angPseudoVelY,u=this._b2._angPseudoVelZ;for(var b=0,f=this.info.numRows;b<f;){var n=b++,c=this.info.rows[n],z=this.massData[n],p=c.impulse,y=c.jacobianN,V=0;V+=a*y.lin1X+t*y.lin1Y+i*y.lin1Z,V-=r*y.lin2X+o*y.lin2Y+s*y.lin2Z,V+=_*y.ang1X+h*y.ang1Y+v*y.ang1Z,V-=e*y.ang2X+l*y.ang2Y+u*y.ang2Z;var M=(c.rhs-V)*z.massN*x.common.Setting.positionSplitImpulseBaumgarte,I=p.impulseP;p.impulseP+=M,p.impulseP<0&&(p.impulseP=0),M=p.impulseP-I,a+=z.invMLinN1X*M,t+=z.invMLinN1Y*M,i+=z.invMLinN1Z*M,r+=z.invMLinN2X*-M,o+=z.invMLinN2Y*-M,s+=z.invMLinN2Z*-M,_+=z.invMAngN1X*M,h+=z.invMAngN1Y*M,v+=z.invMAngN1Z*M,e+=z.invMAngN2X*-M,l+=z.invMAngN2Y*-M,u+=z.invMAngN2Z*-M}this._b1._pseudoVelX=a,this._b1._pseudoVelY=t,this._b1._pseudoVelZ=i,this._b2._pseudoVelX=r,this._b2._pseudoVelY=o,this._b2._pseudoVelZ=s,this._b1._angPseudoVelX=_,this._b1._angPseudoVelY=h,this._b1._angPseudoVelZ=v,this._b2._angPseudoVelX=e,this._b2._angPseudoVelY=l,this._b2._angPseudoVelZ=u}solvePositionNgs(a){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);var t=this._b1._invMass,i=this._b2._invMass,r,o,s,_,h,v,e,l,u,b,f,n,c,z,p,y,V,M;r=this._b1._invInertia00,o=this._b1._invInertia01,s=this._b1._invInertia02,_=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,e=this._b1._invInertia20,l=this._b1._invInertia21,u=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,z=this._b2._invInertia11,p=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,M=this._b2._invInertia22;for(var I=0,k=this.info.numRows;I<k;){var X=I++,L=this.info.rows[X],m=this.massData[X],g=L.jacobianN;m.invMLinN1X=g.lin1X*t,m.invMLinN1Y=g.lin1Y*t,m.invMLinN1Z=g.lin1Z*t,m.invMLinN2X=g.lin2X*i,m.invMLinN2Y=g.lin2Y*i,m.invMLinN2Z=g.lin2Z*i;var N,A,F;N=r*g.ang1X+o*g.ang1Y+s*g.ang1Z,A=_*g.ang1X+h*g.ang1Y+v*g.ang1Z,F=e*g.ang1X+l*g.ang1Y+u*g.ang1Z,m.invMAngN1X=N,m.invMAngN1Y=A,m.invMAngN1Z=F;var P,Y,R;P=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+z*g.ang2Y+p*g.ang2Z,R=y*g.ang2X+V*g.ang2Y+M*g.ang2Z,m.invMAngN2X=P,m.invMAngN2Y=Y,m.invMAngN2Z=R,m.massN=t+i+(m.invMAngN1X*g.ang1X+m.invMAngN1Y*g.ang1Y+m.invMAngN1Z*g.ang1Z)+(m.invMAngN2X*g.ang2X+m.invMAngN2Y*g.ang2Y+m.invMAngN2Z*g.ang2Z),m.massN!=0&&(m.massN=1/m.massN)}var C,d,Z,$,K,E,J,B,Q,U,G,D;C=0,d=0,Z=0,$=0,K=0,E=0,J=0,B=0,Q=0,U=0,G=0,D=0;for(var H=0,j=this.info.numRows;H<j;){var ia=H++,sa=this.info.rows[ia],W=this.massData[ia],q=sa.impulse,na=sa.jacobianN,oa=0;oa+=C*na.lin1X+d*na.lin1Y+Z*na.lin1Z,oa-=$*na.lin2X+K*na.lin2Y+E*na.lin2Z,oa+=J*na.ang1X+B*na.ang1Y+Q*na.ang1Z,oa-=U*na.ang2X+G*na.ang2Y+D*na.ang2Z;var aa=(sa.rhs-oa)*W.massN*x.common.Setting.positionNgsBaumgarte,T=q.impulseP;q.impulseP+=aa,q.impulseP<0&&(q.impulseP=0),aa=q.impulseP-T,C+=W.invMLinN1X*aa,d+=W.invMLinN1Y*aa,Z+=W.invMLinN1Z*aa,$+=W.invMLinN2X*-aa,K+=W.invMLinN2Y*-aa,E+=W.invMLinN2Z*-aa,J+=W.invMAngN1X*aa,B+=W.invMAngN1Y*aa,Q+=W.invMAngN1Z*aa,U+=W.invMAngN2X*-aa,G+=W.invMAngN2Y*-aa,D+=W.invMAngN2Z*-aa}var ca=this._b1;ca._transform._positionX+=C,ca._transform._positionY+=d,ca._transform._positionZ+=Z;var _a=this._b2;_a._transform._positionX+=$,_a._transform._positionY+=K,_a._transform._positionZ+=E;var w=this._b1,ta=Math.sqrt(J*J+B*B+Q*Q),ra=ta*.5,la,va;if(ra<.5){var xa=ra*ra;la=.5*(1-xa*.16666666666666666+xa*xa*.008333333333333333),va=1-xa*.5+xa*xa*.041666666666666664}else la=Math.sin(ra)/ta,va=Math.cos(ra);var za,Ma,Xa;za=J*la,Ma=B*la,Xa=Q*la;var Za,fa,ba,ea;Za=za,fa=Ma,ba=Xa,ea=va;var ha,ma,ya,da,pa=w._transform._rotation00,Ya=w._transform._rotation11,Qa=w._transform._rotation22,ga=pa+Ya+Qa,ua;ga>0?(ua=Math.sqrt(ga+1),da=.5*ua,ua=.5/ua,ha=(w._transform._rotation21-w._transform._rotation12)*ua,ma=(w._transform._rotation02-w._transform._rotation20)*ua,ya=(w._transform._rotation10-w._transform._rotation01)*ua):pa>Ya?pa>Qa?(ua=Math.sqrt(pa-Ya-Qa+1),ha=.5*ua,ua=.5/ua,ma=(w._transform._rotation01+w._transform._rotation10)*ua,ya=(w._transform._rotation02+w._transform._rotation20)*ua,da=(w._transform._rotation21-w._transform._rotation12)*ua):(ua=Math.sqrt(Qa-pa-Ya+1),ya=.5*ua,ua=.5/ua,ha=(w._transform._rotation02+w._transform._rotation20)*ua,ma=(w._transform._rotation12+w._transform._rotation21)*ua,da=(w._transform._rotation10-w._transform._rotation01)*ua):Ya>Qa?(ua=Math.sqrt(Ya-Qa-pa+1),ma=.5*ua,ua=.5/ua,ha=(w._transform._rotation01+w._transform._rotation10)*ua,ya=(w._transform._rotation12+w._transform._rotation21)*ua,da=(w._transform._rotation02-w._transform._rotation20)*ua):(ua=Math.sqrt(Qa-pa-Ya+1),ya=.5*ua,ua=.5/ua,ha=(w._transform._rotation02+w._transform._rotation20)*ua,ma=(w._transform._rotation12+w._transform._rotation21)*ua,da=(w._transform._rotation10-w._transform._rotation01)*ua),ha=ea*ha+Za*da+fa*ya-ba*ma,ma=ea*ma-Za*ya+fa*da+ba*ha,ya=ea*ya+Za*ma-fa*ha+ba*da,da=ea*da-Za*ha-fa*ma-ba*ya;var wa=ha*ha+ma*ma+ya*ya+da*da;wa>1e-32&&(wa=1/Math.sqrt(wa)),ha*=wa,ma*=wa,ya*=wa,da*=wa;var ka=ha,Sa=ma,zt=ya,Ha=da,Ba=2*ka,nt=2*Sa,Ea=2*zt,Fa=ka*Ba,Aa=Sa*nt,ft=zt*Ea,Wa=ka*nt,Ka=Sa*Ea,bt=ka*Ea,it=Ha*Ba,$a=Ha*nt,_t=Ha*Ea;w._transform._rotation00=1-Aa-ft,w._transform._rotation01=Wa-_t,w._transform._rotation02=bt+$a,w._transform._rotation10=Wa+_t,w._transform._rotation11=1-Fa-ft,w._transform._rotation12=Ka-it,w._transform._rotation20=bt-$a,w._transform._rotation21=Ka+it,w._transform._rotation22=1-Fa-Aa;var gt,pt,Ga,rt,ut,Da,Ta,Na,Vt;gt=w._transform._rotation00*w._invLocalInertia00+w._transform._rotation01*w._invLocalInertia10+w._transform._rotation02*w._invLocalInertia20,pt=w._transform._rotation00*w._invLocalInertia01+w._transform._rotation01*w._invLocalInertia11+w._transform._rotation02*w._invLocalInertia21,Ga=w._transform._rotation00*w._invLocalInertia02+w._transform._rotation01*w._invLocalInertia12+w._transform._rotation02*w._invLocalInertia22,rt=w._transform._rotation10*w._invLocalInertia00+w._transform._rotation11*w._invLocalInertia10+w._transform._rotation12*w._invLocalInertia20,ut=w._transform._rotation10*w._invLocalInertia01+w._transform._rotation11*w._invLocalInertia11+w._transform._rotation12*w._invLocalInertia21,Da=w._transform._rotation10*w._invLocalInertia02+w._transform._rotation11*w._invLocalInertia12+w._transform._rotation12*w._invLocalInertia22,Ta=w._transform._rotation20*w._invLocalInertia00+w._transform._rotation21*w._invLocalInertia10+w._transform._rotation22*w._invLocalInertia20,Na=w._transform._rotation20*w._invLocalInertia01+w._transform._rotation21*w._invLocalInertia11+w._transform._rotation22*w._invLocalInertia21,Vt=w._transform._rotation20*w._invLocalInertia02+w._transform._rotation21*w._invLocalInertia12+w._transform._rotation22*w._invLocalInertia22,w._invInertia00=gt,w._invInertia01=pt,w._invInertia02=Ga,w._invInertia10=rt,w._invInertia11=ut,w._invInertia12=Da,w._invInertia20=Ta,w._invInertia21=Na,w._invInertia22=Vt;var St,et,Xt,Yt,Mt,Ia,O,Va,lt;St=w._invInertia00*w._transform._rotation00+w._invInertia01*w._transform._rotation01+w._invInertia02*w._transform._rotation02,et=w._invInertia00*w._transform._rotation10+w._invInertia01*w._transform._rotation11+w._invInertia02*w._transform._rotation12,Xt=w._invInertia00*w._transform._rotation20+w._invInertia01*w._transform._rotation21+w._invInertia02*w._transform._rotation22,Yt=w._invInertia10*w._transform._rotation00+w._invInertia11*w._transform._rotation01+w._invInertia12*w._transform._rotation02,Mt=w._invInertia10*w._transform._rotation10+w._invInertia11*w._transform._rotation11+w._invInertia12*w._transform._rotation12,Ia=w._invInertia10*w._transform._rotation20+w._invInertia11*w._transform._rotation21+w._invInertia12*w._transform._rotation22,O=w._invInertia20*w._transform._rotation00+w._invInertia21*w._transform._rotation01+w._invInertia22*w._transform._rotation02,Va=w._invInertia20*w._transform._rotation10+w._invInertia21*w._transform._rotation11+w._invInertia22*w._transform._rotation12,lt=w._invInertia20*w._transform._rotation20+w._invInertia21*w._transform._rotation21+w._invInertia22*w._transform._rotation22,w._invInertia00=St,w._invInertia01=et,w._invInertia02=Xt,w._invInertia10=Yt,w._invInertia11=Mt,w._invInertia12=Ia,w._invInertia20=O,w._invInertia21=Va,w._invInertia22=lt,w._invInertia00*=w._rotFactor.x,w._invInertia01*=w._rotFactor.x,w._invInertia02*=w._rotFactor.x,w._invInertia10*=w._rotFactor.y,w._invInertia11*=w._rotFactor.y,w._invInertia12*=w._rotFactor.y,w._invInertia20*=w._rotFactor.z,w._invInertia21*=w._rotFactor.z,w._invInertia22*=w._rotFactor.z;var S=this._b2,wt=Math.sqrt(U*U+G*G+D*D),Bt=wt*.5,At,yt;if(Bt<.5){var kt=Bt*Bt;At=.5*(1-kt*.16666666666666666+kt*kt*.008333333333333333),yt=1-kt*.5+kt*kt*.041666666666666664}else At=Math.sin(Bt)/wt,yt=Math.cos(Bt);var mt,ht,xt;mt=U*At,ht=G*At,xt=D*At;var Ra,st,Ca,vt;Ra=mt,st=ht,Ca=xt,vt=yt;var qa,at,Oa,tt,ct=S._transform._rotation00,Pa=S._transform._rotation11,Ja=S._transform._rotation22,ja=ct+Pa+Ja,La;ja>0?(La=Math.sqrt(ja+1),tt=.5*La,La=.5/La,qa=(S._transform._rotation21-S._transform._rotation12)*La,at=(S._transform._rotation02-S._transform._rotation20)*La,Oa=(S._transform._rotation10-S._transform._rotation01)*La):ct>Pa?ct>Ja?(La=Math.sqrt(ct-Pa-Ja+1),qa=.5*La,La=.5/La,at=(S._transform._rotation01+S._transform._rotation10)*La,Oa=(S._transform._rotation02+S._transform._rotation20)*La,tt=(S._transform._rotation21-S._transform._rotation12)*La):(La=Math.sqrt(Ja-ct-Pa+1),Oa=.5*La,La=.5/La,qa=(S._transform._rotation02+S._transform._rotation20)*La,at=(S._transform._rotation12+S._transform._rotation21)*La,tt=(S._transform._rotation10-S._transform._rotation01)*La):Pa>Ja?(La=Math.sqrt(Pa-Ja-ct+1),at=.5*La,La=.5/La,qa=(S._transform._rotation01+S._transform._rotation10)*La,Oa=(S._transform._rotation12+S._transform._rotation21)*La,tt=(S._transform._rotation02-S._transform._rotation20)*La):(La=Math.sqrt(Ja-ct-Pa+1),Oa=.5*La,La=.5/La,qa=(S._transform._rotation02+S._transform._rotation20)*La,at=(S._transform._rotation12+S._transform._rotation21)*La,tt=(S._transform._rotation10-S._transform._rotation01)*La),qa=vt*qa+Ra*tt+st*Oa-Ca*at,at=vt*at-Ra*Oa+st*tt+Ca*qa,Oa=vt*Oa+Ra*at-st*qa+Ca*tt,tt=vt*tt-Ra*qa-st*at-Ca*Oa;var ot=qa*qa+at*at+Oa*Oa+tt*tt;ot>1e-32&&(ot=1/Math.sqrt(ot)),qa*=ot,at*=ot,Oa*=ot,tt*=ot;var It=qa,oi=at,gi=Oa,ai=tt,Ct=2*It,_i=2*oi,Et=2*gi,Pt=It*Ct,Jt=oi*_i,Ki=gi*Et,vi=It*_i,li=oi*Et,ti=It*Et,Oi=ai*Ct,Xi=ai*_i,zi=ai*Et;S._transform._rotation00=1-Jt-Ki,S._transform._rotation01=vi-zi,S._transform._rotation02=ti+Xi,S._transform._rotation10=vi+zi,S._transform._rotation11=1-Pt-Ki,S._transform._rotation12=li-Oi,S._transform._rotation20=ti-Xi,S._transform._rotation21=li+Oi,S._transform._rotation22=1-Pt-Jt;var Zt,ri,Wt,ni,$i,Ut,ji,Ii,pr;Zt=S._transform._rotation00*S._invLocalInertia00+S._transform._rotation01*S._invLocalInertia10+S._transform._rotation02*S._invLocalInertia20,ri=S._transform._rotation00*S._invLocalInertia01+S._transform._rotation01*S._invLocalInertia11+S._transform._rotation02*S._invLocalInertia21,Wt=S._transform._rotation00*S._invLocalInertia02+S._transform._rotation01*S._invLocalInertia12+S._transform._rotation02*S._invLocalInertia22,ni=S._transform._rotation10*S._invLocalInertia00+S._transform._rotation11*S._invLocalInertia10+S._transform._rotation12*S._invLocalInertia20,$i=S._transform._rotation10*S._invLocalInertia01+S._transform._rotation11*S._invLocalInertia11+S._transform._rotation12*S._invLocalInertia21,Ut=S._transform._rotation10*S._invLocalInertia02+S._transform._rotation11*S._invLocalInertia12+S._transform._rotation12*S._invLocalInertia22,ji=S._transform._rotation20*S._invLocalInertia00+S._transform._rotation21*S._invLocalInertia10+S._transform._rotation22*S._invLocalInertia20,Ii=S._transform._rotation20*S._invLocalInertia01+S._transform._rotation21*S._invLocalInertia11+S._transform._rotation22*S._invLocalInertia21,pr=S._transform._rotation20*S._invLocalInertia02+S._transform._rotation21*S._invLocalInertia12+S._transform._rotation22*S._invLocalInertia22,S._invInertia00=Zt,S._invInertia01=ri,S._invInertia02=Wt,S._invInertia10=ni,S._invInertia11=$i,S._invInertia12=Ut,S._invInertia20=ji,S._invInertia21=Ii,S._invInertia22=pr;var Wi,Lt,jt,Tt,bi,Mi,vr,qt,fi;Wi=S._invInertia00*S._transform._rotation00+S._invInertia01*S._transform._rotation01+S._invInertia02*S._transform._rotation02,Lt=S._invInertia00*S._transform._rotation10+S._invInertia01*S._transform._rotation11+S._invInertia02*S._transform._rotation12,jt=S._invInertia00*S._transform._rotation20+S._invInertia01*S._transform._rotation21+S._invInertia02*S._transform._rotation22,Tt=S._invInertia10*S._transform._rotation00+S._invInertia11*S._transform._rotation01+S._invInertia12*S._transform._rotation02,bi=S._invInertia10*S._transform._rotation10+S._invInertia11*S._transform._rotation11+S._invInertia12*S._transform._rotation12,Mi=S._invInertia10*S._transform._rotation20+S._invInertia11*S._transform._rotation21+S._invInertia12*S._transform._rotation22,vr=S._invInertia20*S._transform._rotation00+S._invInertia21*S._transform._rotation01+S._invInertia22*S._transform._rotation02,qt=S._invInertia20*S._transform._rotation10+S._invInertia21*S._transform._rotation11+S._invInertia22*S._transform._rotation12,fi=S._invInertia20*S._transform._rotation20+S._invInertia21*S._transform._rotation21+S._invInertia22*S._transform._rotation22,S._invInertia00=Wi,S._invInertia01=Lt,S._invInertia02=jt,S._invInertia10=Tt,S._invInertia11=bi,S._invInertia12=Mi,S._invInertia20=vr,S._invInertia21=qt,S._invInertia22=fi,S._invInertia00*=S._rotFactor.x,S._invInertia01*=S._rotFactor.x,S._invInertia02*=S._rotFactor.x,S._invInertia10*=S._rotFactor.y,S._invInertia11*=S._rotFactor.y,S._invInertia12*=S._rotFactor.y,S._invInertia20*=S._rotFactor.z,S._invInertia21*=S._rotFactor.z,S._invInertia22*=S._rotFactor.z}postSolve(){var a,t,i,r,o,s,_,h,v;a=0,t=0,i=0,r=0,o=0,s=0,_=0,h=0,v=0;for(var e=0,l=this.info.numRows;e<l;){var u=e++,b=this.info.rows[u],f=b.impulse,n=b.jacobianN,c=b.jacobianT,z=b.jacobianB,p=f.impulseN,y=f.impulseT,V=f.impulseB,M,I,k;M=0,I=0,k=0,M+=c.lin1X*y,I+=c.lin1Y*y,k+=c.lin1Z*y,M+=z.lin1X*V,I+=z.lin1Y*V,k+=z.lin1Z*V,f.impulseLX=M,f.impulseLY=I,f.impulseLZ=k,a+=n.lin1X*p,t+=n.lin1Y*p,i+=n.lin1Z*p,r+=n.ang1X*p,o+=n.ang1Y*p,s+=n.ang1Z*p,_+=n.ang2X*p,h+=n.ang2Y*p,v+=n.ang2Z*p,a+=c.lin1X*y,t+=c.lin1Y*y,i+=c.lin1Z*y,r+=c.ang1X*y,o+=c.ang1Y*y,s+=c.ang1Z*y,_+=c.ang2X*y,h+=c.ang2Y*y,v+=c.ang2Z*y,a+=z.lin1X*V,t+=z.lin1Y*V,i+=z.lin1Z*V,r+=z.ang1X*V,o+=z.ang1Y*V,s+=z.ang1Z*V,_+=z.ang2X*V,h+=z.ang2Y*V,v+=z.ang2Z*V}this._b1._linearContactImpulseX+=a,this._b1._linearContactImpulseY+=t,this._b1._linearContactImpulseZ+=i,this._b1._angularContactImpulseX+=r,this._b1._angularContactImpulseY+=o,this._b1._angularContactImpulseZ+=s,this._b2._linearContactImpulseX-=a,this._b2._linearContactImpulseY-=t,this._b2._linearContactImpulseZ-=i,this._b2._angularContactImpulseX-=_,this._b2._angularContactImpulseY-=h,this._b2._angularContactImpulseZ-=v,this.constraint._syncManifold()}};x.dynamics.constraint.solver.pgs.PgsJointConstraintSolver=class extends x.dynamics.constraint.ConstraintSolver{constructor(a){super(),this.joint=a,this.info=new x.dynamics.constraint.info.joint.JointSolverInfo;var t=new Array(x.common.Setting.maxJacobianRows);this.massData=t;for(var i=0,r=this.massData.length;i<r;){var o=i++;this.massData[o]=new x.dynamics.constraint.solver.common.JointSolverMassDataRow}}preSolveVelocity(a){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(a,this.info),this._b1=this.info.b1,this._b2=this.info.b2;var t=this._b1._invMass,i=this._b2._invMass,r,o,s,_,h,v,e,l,u,b,f,n,c,z,p,y,V,M;r=this._b1._invInertia00,o=this._b1._invInertia01,s=this._b1._invInertia02,_=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,e=this._b1._invInertia20,l=this._b1._invInertia21,u=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,z=this._b2._invInertia11,p=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,M=this._b2._invInertia22;for(var I=0,k=this.info.numRows;I<k;){var X=I++,L=this.info.rows[X],m=this.massData[X],g=L.jacobian;if(g.updateSparsity(),g.flag&1?(m.invMLin1X=g.lin1X*t,m.invMLin1Y=g.lin1Y*t,m.invMLin1Z=g.lin1Z*t,m.invMLin2X=g.lin2X*i,m.invMLin2Y=g.lin2Y*i,m.invMLin2Z=g.lin2Z*i):(m.invMLin1X=0,m.invMLin1Y=0,m.invMLin1Z=0,m.invMLin2X=0,m.invMLin2Y=0,m.invMLin2Z=0),g.flag&2){var N,A,F;N=r*g.ang1X+o*g.ang1Y+s*g.ang1Z,A=_*g.ang1X+h*g.ang1Y+v*g.ang1Z,F=e*g.ang1X+l*g.ang1Y+u*g.ang1Z,m.invMAng1X=N,m.invMAng1Y=A,m.invMAng1Z=F;var P,Y,R;P=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+z*g.ang2Y+p*g.ang2Z,R=y*g.ang2X+V*g.ang2Y+M*g.ang2Z,m.invMAng2X=P,m.invMAng2Y=Y,m.invMAng2Z=R}else m.invMAng1X=0,m.invMAng1Y=0,m.invMAng1Z=0,m.invMAng2X=0,m.invMAng2Y=0,m.invMAng2Z=0;m.massWithoutCfm=m.invMLin1X*g.lin1X+m.invMLin1Y*g.lin1Y+m.invMLin1Z*g.lin1Z+(m.invMLin2X*g.lin2X+m.invMLin2Y*g.lin2Y+m.invMLin2Z*g.lin2Z)+(m.invMAng1X*g.ang1X+m.invMAng1Y*g.ang1Y+m.invMAng1Z*g.ang1Z)+(m.invMAng2X*g.ang2X+m.invMAng2Y*g.ang2Y+m.invMAng2Z*g.ang2Z),m.mass=m.massWithoutCfm+L.cfm,m.massWithoutCfm!=0&&(m.massWithoutCfm=1/m.massWithoutCfm),m.mass!=0&&(m.mass=1/m.mass)}}warmStart(a){var t=this.joint._positionCorrectionAlgorithm==x.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?x.common.Setting.jointWarmStartingFactorForBaungarte:x.common.Setting.jointWarmStartingFactor;if(t*=a.dtRatio,t<=0){for(var i=0,r=this.info.numRows;i<r;){var o=i++,s=this.info.rows[o],_=s.impulse;_.impulse=0,_.impulseM=0,_.impulseP=0}return}var h,v,e,l,u,b,f,n,c,z,p,y;h=this._b1._velX,v=this._b1._velY,e=this._b1._velZ,l=this._b2._velX,u=this._b2._velY,b=this._b2._velZ,f=this._b1._angVelX,n=this._b1._angVelY,c=this._b1._angVelZ,z=this._b2._angVelX,p=this._b2._angVelY,y=this._b2._angVelZ;for(var V=0,M=this.info.numRows;V<M;){var I=V++,k=this.info.rows[I],X=this.massData[I],L=k.impulse;k.jacobian,L.impulse*=t,L.impulseM*=t;var m=L.impulse+L.impulseM;h+=X.invMLin1X*m,v+=X.invMLin1Y*m,e+=X.invMLin1Z*m,l+=X.invMLin2X*-m,u+=X.invMLin2Y*-m,b+=X.invMLin2Z*-m,f+=X.invMAng1X*m,n+=X.invMAng1Y*m,c+=X.invMAng1Z*m,z+=X.invMAng2X*-m,p+=X.invMAng2Y*-m,y+=X.invMAng2Z*-m}this._b1._velX=h,this._b1._velY=v,this._b1._velZ=e,this._b2._velX=l,this._b2._velY=u,this._b2._velZ=b,this._b1._angVelX=f,this._b1._angVelY=n,this._b1._angVelZ=c,this._b2._angVelX=z,this._b2._angVelY=p,this._b2._angVelZ=y}solveVelocity(){var a,t,i,r,o,s,_,h,v,e,l,u;a=this._b1._velX,t=this._b1._velY,i=this._b1._velZ,r=this._b2._velX,o=this._b2._velY,s=this._b2._velZ,_=this._b1._angVelX,h=this._b1._angVelY,v=this._b1._angVelZ,e=this._b2._angVelX,l=this._b2._angVelY,u=this._b2._angVelZ;for(var b=0,f=this.info.numRows;b<f;){var n=b++,c=this.info.rows[n],z=this.massData[n],p=c.impulse,y=c.jacobian;if(c.motorMaxImpulse!=0){var V=0;V+=a*y.lin1X+t*y.lin1Y+i*y.lin1Z,V-=r*y.lin2X+o*y.lin2Y+s*y.lin2Z,V+=_*y.ang1X+h*y.ang1Y+v*y.ang1Z,V-=e*y.ang2X+l*y.ang2Y+u*y.ang2Z;var M=(-c.motorSpeed-V)*z.massWithoutCfm,I=p.impulseM;p.impulseM+=M,p.impulseM<-c.motorMaxImpulse?p.impulseM=-c.motorMaxImpulse:p.impulseM>c.motorMaxImpulse&&(p.impulseM=c.motorMaxImpulse),M=p.impulseM-I,y.flag&1&&(a+=z.invMLin1X*M,t+=z.invMLin1Y*M,i+=z.invMLin1Z*M,r+=z.invMLin2X*-M,o+=z.invMLin2Y*-M,s+=z.invMLin2Z*-M),y.flag&2&&(_+=z.invMAng1X*M,h+=z.invMAng1Y*M,v+=z.invMAng1Z*M,e+=z.invMAng2X*-M,l+=z.invMAng2Y*-M,u+=z.invMAng2Z*-M)}}for(var k=0,X=this.info.numRows;k<X;){var L=k++,m=this.info.rows[L],g=this.massData[L],N=m.impulse,A=m.jacobian,F=0;F+=a*A.lin1X+t*A.lin1Y+i*A.lin1Z,F-=r*A.lin2X+o*A.lin2Y+s*A.lin2Z,F+=_*A.ang1X+h*A.ang1Y+v*A.ang1Z,F-=e*A.ang2X+l*A.ang2Y+u*A.ang2Z;var P=(m.rhs-F-N.impulse*m.cfm)*g.mass,Y=N.impulse;N.impulse+=P,N.impulse<m.minImpulse?N.impulse=m.minImpulse:N.impulse>m.maxImpulse&&(N.impulse=m.maxImpulse),P=N.impulse-Y,A.flag&1&&(a+=g.invMLin1X*P,t+=g.invMLin1Y*P,i+=g.invMLin1Z*P,r+=g.invMLin2X*-P,o+=g.invMLin2Y*-P,s+=g.invMLin2Z*-P),A.flag&2&&(_+=g.invMAng1X*P,h+=g.invMAng1Y*P,v+=g.invMAng1Z*P,e+=g.invMAng2X*-P,l+=g.invMAng2Y*-P,u+=g.invMAng2Z*-P)}this._b1._velX=a,this._b1._velY=t,this._b1._velZ=i,this._b2._velX=r,this._b2._velY=o,this._b2._velZ=s,this._b1._angVelX=_,this._b1._angVelY=h,this._b1._angVelZ=v,this._b2._angVelX=e,this._b2._angVelY=l,this._b2._angVelZ=u}postSolveVelocity(a){var t,i,r,o,s,_;t=0,i=0,r=0,o=0,s=0,_=0;for(var h=0,v=this.info.numRows;h<v;){var e=h++,l=this.info.rows[e],u=l.impulse,b=l.jacobian;b.flag&1?(t+=b.lin1X*u.impulse,i+=b.lin1Y*u.impulse,r+=b.lin1Z*u.impulse):b.flag&2&&(o+=b.ang1X*u.impulse,s+=b.ang1Y*u.impulse,_+=b.ang1Z*u.impulse)}this.joint._appliedForceX=t*a.invDt,this.joint._appliedForceY=i*a.invDt,this.joint._appliedForceZ=r*a.invDt,this.joint._appliedTorqueX=o*a.invDt,this.joint._appliedTorqueY=s*a.invDt,this.joint._appliedTorqueZ=_*a.invDt}preSolvePosition(a){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;var t=this._b1._invMass,i=this._b2._invMass,r,o,s,_,h,v,e,l,u,b,f,n,c,z,p,y,V,M;r=this._b1._invInertia00,o=this._b1._invInertia01,s=this._b1._invInertia02,_=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,e=this._b1._invInertia20,l=this._b1._invInertia21,u=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,z=this._b2._invInertia11,p=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,M=this._b2._invInertia22;for(var I=0,k=this.info.numRows;I<k;){var X=I++,L=this.info.rows[X],m=this.massData[X];L.impulse;var g=L.jacobian;m.invMLin1X=g.lin1X*t,m.invMLin1Y=g.lin1Y*t,m.invMLin1Z=g.lin1Z*t,m.invMLin2X=g.lin2X*i,m.invMLin2Y=g.lin2Y*i,m.invMLin2Z=g.lin2Z*i;var N,A,F;N=r*g.ang1X+o*g.ang1Y+s*g.ang1Z,A=_*g.ang1X+h*g.ang1Y+v*g.ang1Z,F=e*g.ang1X+l*g.ang1Y+u*g.ang1Z,m.invMAng1X=N,m.invMAng1Y=A,m.invMAng1Z=F;var P,Y,R;P=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+z*g.ang2Y+p*g.ang2Z,R=y*g.ang2X+V*g.ang2Y+M*g.ang2Z,m.invMAng2X=P,m.invMAng2Y=Y,m.invMAng2Z=R,m.mass=m.invMLin1X*g.lin1X+m.invMLin1Y*g.lin1Y+m.invMLin1Z*g.lin1Z+(m.invMLin2X*g.lin2X+m.invMLin2Y*g.lin2Y+m.invMLin2Z*g.lin2Z)+(m.invMAng1X*g.ang1X+m.invMAng1Y*g.ang1Y+m.invMAng1Z*g.ang1Z)+(m.invMAng2X*g.ang2X+m.invMAng2Y*g.ang2Y+m.invMAng2Z*g.ang2Z),m.mass!=0&&(m.mass=1/m.mass)}for(var C=0,d=this.info.numRows;C<d;){var Z=C++;this.info.rows[Z].impulse.impulseP=0}}solvePositionSplitImpulse(){var a,t,i,r,o,s,_,h,v,e,l,u;a=this._b1._pseudoVelX,t=this._b1._pseudoVelY,i=this._b1._pseudoVelZ,r=this._b2._pseudoVelX,o=this._b2._pseudoVelY,s=this._b2._pseudoVelZ,_=this._b1._angPseudoVelX,h=this._b1._angPseudoVelY,v=this._b1._angPseudoVelZ,e=this._b2._angPseudoVelX,l=this._b2._angPseudoVelY,u=this._b2._angPseudoVelZ;for(var b=0,f=this.info.numRows;b<f;){var n=b++,c=this.info.rows[n],z=this.massData[n],p=c.impulse,y=c.jacobian,V=0;V+=a*y.lin1X+t*y.lin1Y+i*y.lin1Z,V-=r*y.lin2X+o*y.lin2Y+s*y.lin2Z,V+=_*y.ang1X+h*y.ang1Y+v*y.ang1Z,V-=e*y.ang2X+l*y.ang2Y+u*y.ang2Z;var M=(c.rhs*x.common.Setting.positionSplitImpulseBaumgarte-V)*z.mass,I=p.impulseP;p.impulseP+=M,p.impulseP<c.minImpulse?p.impulseP=c.minImpulse:p.impulseP>c.maxImpulse&&(p.impulseP=c.maxImpulse),M=p.impulseP-I,a+=z.invMLin1X*M,t+=z.invMLin1Y*M,i+=z.invMLin1Z*M,r+=z.invMLin2X*-M,o+=z.invMLin2Y*-M,s+=z.invMLin2Z*-M,_+=z.invMAng1X*M,h+=z.invMAng1Y*M,v+=z.invMAng1Z*M,e+=z.invMAng2X*-M,l+=z.invMAng2Y*-M,u+=z.invMAng2Z*-M}this._b1._pseudoVelX=a,this._b1._pseudoVelY=t,this._b1._pseudoVelZ=i,this._b2._pseudoVelX=r,this._b2._pseudoVelY=o,this._b2._pseudoVelZ=s,this._b1._angPseudoVelX=_,this._b1._angPseudoVelY=h,this._b1._angPseudoVelZ=v,this._b2._angPseudoVelX=e,this._b2._angPseudoVelY=l,this._b2._angPseudoVelZ=u}solvePositionNgs(a){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;var t=this._b1._invMass,i=this._b2._invMass,r,o,s,_,h,v,e,l,u,b,f,n,c,z,p,y,V,M;r=this._b1._invInertia00,o=this._b1._invInertia01,s=this._b1._invInertia02,_=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,e=this._b1._invInertia20,l=this._b1._invInertia21,u=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,z=this._b2._invInertia11,p=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,M=this._b2._invInertia22;for(var I=0,k=this.info.numRows;I<k;){var X=I++,L=this.info.rows[X],m=this.massData[X];L.impulse;var g=L.jacobian;m.invMLin1X=g.lin1X*t,m.invMLin1Y=g.lin1Y*t,m.invMLin1Z=g.lin1Z*t,m.invMLin2X=g.lin2X*i,m.invMLin2Y=g.lin2Y*i,m.invMLin2Z=g.lin2Z*i;var N,A,F;N=r*g.ang1X+o*g.ang1Y+s*g.ang1Z,A=_*g.ang1X+h*g.ang1Y+v*g.ang1Z,F=e*g.ang1X+l*g.ang1Y+u*g.ang1Z,m.invMAng1X=N,m.invMAng1Y=A,m.invMAng1Z=F;var P,Y,R;P=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+z*g.ang2Y+p*g.ang2Z,R=y*g.ang2X+V*g.ang2Y+M*g.ang2Z,m.invMAng2X=P,m.invMAng2Y=Y,m.invMAng2Z=R,m.mass=m.invMLin1X*g.lin1X+m.invMLin1Y*g.lin1Y+m.invMLin1Z*g.lin1Z+(m.invMLin2X*g.lin2X+m.invMLin2Y*g.lin2Y+m.invMLin2Z*g.lin2Z)+(m.invMAng1X*g.ang1X+m.invMAng1Y*g.ang1Y+m.invMAng1Z*g.ang1Z)+(m.invMAng2X*g.ang2X+m.invMAng2Y*g.ang2Y+m.invMAng2Z*g.ang2Z),m.mass!=0&&(m.mass=1/m.mass)}var C,d,Z,$,K,E,J,B,Q,U,G,D;C=0,d=0,Z=0,$=0,K=0,E=0,J=0,B=0,Q=0,U=0,G=0,D=0;for(var H=0,j=this.info.numRows;H<j;){var ia=H++,sa=this.info.rows[ia],W=this.massData[ia],q=sa.impulse,na=sa.jacobian,oa=0;oa+=C*na.lin1X+d*na.lin1Y+Z*na.lin1Z,oa-=$*na.lin2X+K*na.lin2Y+E*na.lin2Z,oa+=J*na.ang1X+B*na.ang1Y+Q*na.ang1Z,oa-=U*na.ang2X+G*na.ang2Y+D*na.ang2Z;var aa=(sa.rhs*x.common.Setting.positionNgsBaumgarte-oa)*W.mass,T=q.impulseP;q.impulseP+=aa,q.impulseP<sa.minImpulse?q.impulseP=sa.minImpulse:q.impulseP>sa.maxImpulse&&(q.impulseP=sa.maxImpulse),aa=q.impulseP-T,C+=W.invMLin1X*aa,d+=W.invMLin1Y*aa,Z+=W.invMLin1Z*aa,$+=W.invMLin2X*-aa,K+=W.invMLin2Y*-aa,E+=W.invMLin2Z*-aa,J+=W.invMAng1X*aa,B+=W.invMAng1Y*aa,Q+=W.invMAng1Z*aa,U+=W.invMAng2X*-aa,G+=W.invMAng2Y*-aa,D+=W.invMAng2Z*-aa}var ca=this._b1;ca._transform._positionX+=C,ca._transform._positionY+=d,ca._transform._positionZ+=Z;var _a=this._b2;_a._transform._positionX+=$,_a._transform._positionY+=K,_a._transform._positionZ+=E;var w=this._b1,ta=Math.sqrt(J*J+B*B+Q*Q),ra=ta*.5,la,va;if(ra<.5){var xa=ra*ra;la=.5*(1-xa*.16666666666666666+xa*xa*.008333333333333333),va=1-xa*.5+xa*xa*.041666666666666664}else la=Math.sin(ra)/ta,va=Math.cos(ra);var za,Ma,Xa;za=J*la,Ma=B*la,Xa=Q*la;var Za,fa,ba,ea;Za=za,fa=Ma,ba=Xa,ea=va;var ha,ma,ya,da,pa=w._transform._rotation00,Ya=w._transform._rotation11,Qa=w._transform._rotation22,ga=pa+Ya+Qa,ua;ga>0?(ua=Math.sqrt(ga+1),da=.5*ua,ua=.5/ua,ha=(w._transform._rotation21-w._transform._rotation12)*ua,ma=(w._transform._rotation02-w._transform._rotation20)*ua,ya=(w._transform._rotation10-w._transform._rotation01)*ua):pa>Ya?pa>Qa?(ua=Math.sqrt(pa-Ya-Qa+1),ha=.5*ua,ua=.5/ua,ma=(w._transform._rotation01+w._transform._rotation10)*ua,ya=(w._transform._rotation02+w._transform._rotation20)*ua,da=(w._transform._rotation21-w._transform._rotation12)*ua):(ua=Math.sqrt(Qa-pa-Ya+1),ya=.5*ua,ua=.5/ua,ha=(w._transform._rotation02+w._transform._rotation20)*ua,ma=(w._transform._rotation12+w._transform._rotation21)*ua,da=(w._transform._rotation10-w._transform._rotation01)*ua):Ya>Qa?(ua=Math.sqrt(Ya-Qa-pa+1),ma=.5*ua,ua=.5/ua,ha=(w._transform._rotation01+w._transform._rotation10)*ua,ya=(w._transform._rotation12+w._transform._rotation21)*ua,da=(w._transform._rotation02-w._transform._rotation20)*ua):(ua=Math.sqrt(Qa-pa-Ya+1),ya=.5*ua,ua=.5/ua,ha=(w._transform._rotation02+w._transform._rotation20)*ua,ma=(w._transform._rotation12+w._transform._rotation21)*ua,da=(w._transform._rotation10-w._transform._rotation01)*ua),ha=ea*ha+Za*da+fa*ya-ba*ma,ma=ea*ma-Za*ya+fa*da+ba*ha,ya=ea*ya+Za*ma-fa*ha+ba*da,da=ea*da-Za*ha-fa*ma-ba*ya;var wa=ha*ha+ma*ma+ya*ya+da*da;wa>1e-32&&(wa=1/Math.sqrt(wa)),ha*=wa,ma*=wa,ya*=wa,da*=wa;var ka=ha,Sa=ma,zt=ya,Ha=da,Ba=2*ka,nt=2*Sa,Ea=2*zt,Fa=ka*Ba,Aa=Sa*nt,ft=zt*Ea,Wa=ka*nt,Ka=Sa*Ea,bt=ka*Ea,it=Ha*Ba,$a=Ha*nt,_t=Ha*Ea;w._transform._rotation00=1-Aa-ft,w._transform._rotation01=Wa-_t,w._transform._rotation02=bt+$a,w._transform._rotation10=Wa+_t,w._transform._rotation11=1-Fa-ft,w._transform._rotation12=Ka-it,w._transform._rotation20=bt-$a,w._transform._rotation21=Ka+it,w._transform._rotation22=1-Fa-Aa;var gt,pt,Ga,rt,ut,Da,Ta,Na,Vt;gt=w._transform._rotation00*w._invLocalInertia00+w._transform._rotation01*w._invLocalInertia10+w._transform._rotation02*w._invLocalInertia20,pt=w._transform._rotation00*w._invLocalInertia01+w._transform._rotation01*w._invLocalInertia11+w._transform._rotation02*w._invLocalInertia21,Ga=w._transform._rotation00*w._invLocalInertia02+w._transform._rotation01*w._invLocalInertia12+w._transform._rotation02*w._invLocalInertia22,rt=w._transform._rotation10*w._invLocalInertia00+w._transform._rotation11*w._invLocalInertia10+w._transform._rotation12*w._invLocalInertia20,ut=w._transform._rotation10*w._invLocalInertia01+w._transform._rotation11*w._invLocalInertia11+w._transform._rotation12*w._invLocalInertia21,Da=w._transform._rotation10*w._invLocalInertia02+w._transform._rotation11*w._invLocalInertia12+w._transform._rotation12*w._invLocalInertia22,Ta=w._transform._rotation20*w._invLocalInertia00+w._transform._rotation21*w._invLocalInertia10+w._transform._rotation22*w._invLocalInertia20,Na=w._transform._rotation20*w._invLocalInertia01+w._transform._rotation21*w._invLocalInertia11+w._transform._rotation22*w._invLocalInertia21,Vt=w._transform._rotation20*w._invLocalInertia02+w._transform._rotation21*w._invLocalInertia12+w._transform._rotation22*w._invLocalInertia22,w._invInertia00=gt,w._invInertia01=pt,w._invInertia02=Ga,w._invInertia10=rt,w._invInertia11=ut,w._invInertia12=Da,w._invInertia20=Ta,w._invInertia21=Na,w._invInertia22=Vt;var St,et,Xt,Yt,Mt,Ia,O,Va,lt;St=w._invInertia00*w._transform._rotation00+w._invInertia01*w._transform._rotation01+w._invInertia02*w._transform._rotation02,et=w._invInertia00*w._transform._rotation10+w._invInertia01*w._transform._rotation11+w._invInertia02*w._transform._rotation12,Xt=w._invInertia00*w._transform._rotation20+w._invInertia01*w._transform._rotation21+w._invInertia02*w._transform._rotation22,Yt=w._invInertia10*w._transform._rotation00+w._invInertia11*w._transform._rotation01+w._invInertia12*w._transform._rotation02,Mt=w._invInertia10*w._transform._rotation10+w._invInertia11*w._transform._rotation11+w._invInertia12*w._transform._rotation12,Ia=w._invInertia10*w._transform._rotation20+w._invInertia11*w._transform._rotation21+w._invInertia12*w._transform._rotation22,O=w._invInertia20*w._transform._rotation00+w._invInertia21*w._transform._rotation01+w._invInertia22*w._transform._rotation02,Va=w._invInertia20*w._transform._rotation10+w._invInertia21*w._transform._rotation11+w._invInertia22*w._transform._rotation12,lt=w._invInertia20*w._transform._rotation20+w._invInertia21*w._transform._rotation21+w._invInertia22*w._transform._rotation22,w._invInertia00=St,w._invInertia01=et,w._invInertia02=Xt,w._invInertia10=Yt,w._invInertia11=Mt,w._invInertia12=Ia,w._invInertia20=O,w._invInertia21=Va,w._invInertia22=lt,w._invInertia00*=w._rotFactor.x,w._invInertia01*=w._rotFactor.x,w._invInertia02*=w._rotFactor.x,w._invInertia10*=w._rotFactor.y,w._invInertia11*=w._rotFactor.y,w._invInertia12*=w._rotFactor.y,w._invInertia20*=w._rotFactor.z,w._invInertia21*=w._rotFactor.z,w._invInertia22*=w._rotFactor.z;var S=this._b2,wt=Math.sqrt(U*U+G*G+D*D),Bt=wt*.5,At,yt;if(Bt<.5){var kt=Bt*Bt;At=.5*(1-kt*.16666666666666666+kt*kt*.008333333333333333),yt=1-kt*.5+kt*kt*.041666666666666664}else At=Math.sin(Bt)/wt,yt=Math.cos(Bt);var mt,ht,xt;mt=U*At,ht=G*At,xt=D*At;var Ra,st,Ca,vt;Ra=mt,st=ht,Ca=xt,vt=yt;var qa,at,Oa,tt,ct=S._transform._rotation00,Pa=S._transform._rotation11,Ja=S._transform._rotation22,ja=ct+Pa+Ja,La;ja>0?(La=Math.sqrt(ja+1),tt=.5*La,La=.5/La,qa=(S._transform._rotation21-S._transform._rotation12)*La,at=(S._transform._rotation02-S._transform._rotation20)*La,Oa=(S._transform._rotation10-S._transform._rotation01)*La):ct>Pa?ct>Ja?(La=Math.sqrt(ct-Pa-Ja+1),qa=.5*La,La=.5/La,at=(S._transform._rotation01+S._transform._rotation10)*La,Oa=(S._transform._rotation02+S._transform._rotation20)*La,tt=(S._transform._rotation21-S._transform._rotation12)*La):(La=Math.sqrt(Ja-ct-Pa+1),Oa=.5*La,La=.5/La,qa=(S._transform._rotation02+S._transform._rotation20)*La,at=(S._transform._rotation12+S._transform._rotation21)*La,tt=(S._transform._rotation10-S._transform._rotation01)*La):Pa>Ja?(La=Math.sqrt(Pa-Ja-ct+1),at=.5*La,La=.5/La,qa=(S._transform._rotation01+S._transform._rotation10)*La,Oa=(S._transform._rotation12+S._transform._rotation21)*La,tt=(S._transform._rotation02-S._transform._rotation20)*La):(La=Math.sqrt(Ja-ct-Pa+1),Oa=.5*La,La=.5/La,qa=(S._transform._rotation02+S._transform._rotation20)*La,at=(S._transform._rotation12+S._transform._rotation21)*La,tt=(S._transform._rotation10-S._transform._rotation01)*La),qa=vt*qa+Ra*tt+st*Oa-Ca*at,at=vt*at-Ra*Oa+st*tt+Ca*qa,Oa=vt*Oa+Ra*at-st*qa+Ca*tt,tt=vt*tt-Ra*qa-st*at-Ca*Oa;var ot=qa*qa+at*at+Oa*Oa+tt*tt;ot>1e-32&&(ot=1/Math.sqrt(ot)),qa*=ot,at*=ot,Oa*=ot,tt*=ot;var It=qa,oi=at,gi=Oa,ai=tt,Ct=2*It,_i=2*oi,Et=2*gi,Pt=It*Ct,Jt=oi*_i,Ki=gi*Et,vi=It*_i,li=oi*Et,ti=It*Et,Oi=ai*Ct,Xi=ai*_i,zi=ai*Et;S._transform._rotation00=1-Jt-Ki,S._transform._rotation01=vi-zi,S._transform._rotation02=ti+Xi,S._transform._rotation10=vi+zi,S._transform._rotation11=1-Pt-Ki,S._transform._rotation12=li-Oi,S._transform._rotation20=ti-Xi,S._transform._rotation21=li+Oi,S._transform._rotation22=1-Pt-Jt;var Zt,ri,Wt,ni,$i,Ut,ji,Ii,pr;Zt=S._transform._rotation00*S._invLocalInertia00+S._transform._rotation01*S._invLocalInertia10+S._transform._rotation02*S._invLocalInertia20,ri=S._transform._rotation00*S._invLocalInertia01+S._transform._rotation01*S._invLocalInertia11+S._transform._rotation02*S._invLocalInertia21,Wt=S._transform._rotation00*S._invLocalInertia02+S._transform._rotation01*S._invLocalInertia12+S._transform._rotation02*S._invLocalInertia22,ni=S._transform._rotation10*S._invLocalInertia00+S._transform._rotation11*S._invLocalInertia10+S._transform._rotation12*S._invLocalInertia20,$i=S._transform._rotation10*S._invLocalInertia01+S._transform._rotation11*S._invLocalInertia11+S._transform._rotation12*S._invLocalInertia21,Ut=S._transform._rotation10*S._invLocalInertia02+S._transform._rotation11*S._invLocalInertia12+S._transform._rotation12*S._invLocalInertia22,ji=S._transform._rotation20*S._invLocalInertia00+S._transform._rotation21*S._invLocalInertia10+S._transform._rotation22*S._invLocalInertia20,Ii=S._transform._rotation20*S._invLocalInertia01+S._transform._rotation21*S._invLocalInertia11+S._transform._rotation22*S._invLocalInertia21,pr=S._transform._rotation20*S._invLocalInertia02+S._transform._rotation21*S._invLocalInertia12+S._transform._rotation22*S._invLocalInertia22,S._invInertia00=Zt,S._invInertia01=ri,S._invInertia02=Wt,S._invInertia10=ni,S._invInertia11=$i,S._invInertia12=Ut,S._invInertia20=ji,S._invInertia21=Ii,S._invInertia22=pr;var Wi,Lt,jt,Tt,bi,Mi,vr,qt,fi;Wi=S._invInertia00*S._transform._rotation00+S._invInertia01*S._transform._rotation01+S._invInertia02*S._transform._rotation02,Lt=S._invInertia00*S._transform._rotation10+S._invInertia01*S._transform._rotation11+S._invInertia02*S._transform._rotation12,jt=S._invInertia00*S._transform._rotation20+S._invInertia01*S._transform._rotation21+S._invInertia02*S._transform._rotation22,Tt=S._invInertia10*S._transform._rotation00+S._invInertia11*S._transform._rotation01+S._invInertia12*S._transform._rotation02,bi=S._invInertia10*S._transform._rotation10+S._invInertia11*S._transform._rotation11+S._invInertia12*S._transform._rotation12,Mi=S._invInertia10*S._transform._rotation20+S._invInertia11*S._transform._rotation21+S._invInertia12*S._transform._rotation22,vr=S._invInertia20*S._transform._rotation00+S._invInertia21*S._transform._rotation01+S._invInertia22*S._transform._rotation02,qt=S._invInertia20*S._transform._rotation10+S._invInertia21*S._transform._rotation11+S._invInertia22*S._transform._rotation12,fi=S._invInertia20*S._transform._rotation20+S._invInertia21*S._transform._rotation21+S._invInertia22*S._transform._rotation22,S._invInertia00=Wi,S._invInertia01=Lt,S._invInertia02=jt,S._invInertia10=Tt,S._invInertia11=bi,S._invInertia12=Mi,S._invInertia20=vr,S._invInertia21=qt,S._invInertia22=fi,S._invInertia00*=S._rotFactor.x,S._invInertia01*=S._rotFactor.x,S._invInertia02*=S._rotFactor.x,S._invInertia10*=S._rotFactor.y,S._invInertia11*=S._rotFactor.y,S._invInertia12*=S._rotFactor.y,S._invInertia20*=S._rotFactor.z,S._invInertia21*=S._rotFactor.z,S._invInertia22*=S._rotFactor.z}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}};x.dynamics.rigidbody||(x.dynamics.rigidbody={});x.dynamics.rigidbody.MassData=class{constructor(){this.mass=0,this.localInertia=new x.common.Mat3}};x.dynamics.rigidbody.RigidBody=class{constructor(a){this._next=null,this._prev=null,this._shapeList=null,this._shapeListLast=null,this._numShapes=0,this._contactLinkList=null,this._contactLinkListLast=null,this._numContactLinks=0,this._jointLinkList=null,this._jointLinkListLast=null,this._numJointLinks=0;var t=a.linearVelocity;this._velX=t.x,this._velY=t.y,this._velZ=t.z;var i=a.angularVelocity;this._angVelX=i.x,this._angVelY=i.y,this._angVelZ=i.z,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._ptransform=new x.common.Transform,this._transform=new x.common.Transform;var r=a.position;this._ptransform._positionX=r.x,this._ptransform._positionY=r.y,this._ptransform._positionZ=r.z;var o=a.rotation;this._ptransform._rotation00=o.e00,this._ptransform._rotation01=o.e01,this._ptransform._rotation02=o.e02,this._ptransform._rotation10=o.e10,this._ptransform._rotation11=o.e11,this._ptransform._rotation12=o.e12,this._ptransform._rotation20=o.e20,this._ptransform._rotation21=o.e21,this._ptransform._rotation22=o.e22;var s=this._transform,_=this._ptransform;s._positionX=_._positionX,s._positionY=_._positionY,s._positionZ=_._positionZ,s._rotation00=_._rotation00,s._rotation01=_._rotation01,s._rotation02=_._rotation02,s._rotation10=_._rotation10,s._rotation11=_._rotation11,s._rotation12=_._rotation12,s._rotation20=_._rotation20,s._rotation21=_._rotation21,s._rotation22=_._rotation22,this._type=a.type,this._sleepTime=0,this._sleeping=!1,this._autoSleep=a.autoSleep,this._mass=0,this._invMass=0,this._localInertia00=0,this._localInertia01=0,this._localInertia02=0,this._localInertia10=0,this._localInertia11=0,this._localInertia12=0,this._localInertia20=0,this._localInertia21=0,this._localInertia22=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._invInertia00=0,this._invInertia01=0,this._invInertia02=0,this._invInertia10=0,this._invInertia11=0,this._invInertia12=0,this._invInertia20=0,this._invInertia21=0,this._invInertia22=0,this._linearDamping=a.linearDamping,this._angularDamping=a.angularDamping,this._forceX=0,this._forceY=0,this._forceZ=0,this._torqueX=0,this._torqueY=0,this._torqueZ=0,this._linearContactImpulseX=0,this._linearContactImpulseY=0,this._linearContactImpulseZ=0,this._angularContactImpulseX=0,this._angularContactImpulseY=0,this._angularContactImpulseZ=0,this._rotFactor=new x.common.Vec3(1,1,1),this._addedToIsland=!1,this._gravityScale=1,this._world=null}_integrate(a){switch(this._type){case 1:this._velX=0,this._velY=0,this._velZ=0,this._angVelX=0,this._angVelY=0,this._angVelZ=0,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:var t,i,r,o,s,_;t=this._velX*a,i=this._velY*a,r=this._velZ*a,o=this._angVelX*a,s=this._angVelY*a,_=this._angVelZ*a;var h=t*t+i*i+r*r,v=o*o+s*s+_*_;if(h==0&&v==0)return;if(h>x.common.Setting.maxTranslationPerStep*x.common.Setting.maxTranslationPerStep){var e=x.common.Setting.maxTranslationPerStep/Math.sqrt(h);this._velX*=e,this._velY*=e,this._velZ*=e,t*=e,i*=e,r*=e}if(v>x.common.Setting.maxRotationPerStep*x.common.Setting.maxRotationPerStep){var l=x.common.Setting.maxRotationPerStep/Math.sqrt(v);this._angVelX*=l,this._angVelY*=l,this._angVelZ*=l,o*=l,s*=l,_*=l}this._transform._positionX+=t,this._transform._positionY+=i,this._transform._positionZ+=r;var u=Math.sqrt(o*o+s*s+_*_),b=u*.5,f,n;if(b<.5){var c=b*b;f=.5*(1-c*.16666666666666666+c*c*.008333333333333333),n=1-c*.5+c*c*.041666666666666664}else f=Math.sin(b)/u,n=Math.cos(b);var z,p,y;z=o*f,p=s*f,y=_*f;var V,M,I,k;V=z,M=p,I=y,k=n;var X,L,m,g,N=this._transform._rotation00,A=this._transform._rotation11,F=this._transform._rotation22,P=N+A+F,Y;P>0?(Y=Math.sqrt(P+1),g=.5*Y,Y=.5/Y,X=(this._transform._rotation21-this._transform._rotation12)*Y,L=(this._transform._rotation02-this._transform._rotation20)*Y,m=(this._transform._rotation10-this._transform._rotation01)*Y):N>A?N>F?(Y=Math.sqrt(N-A-F+1),X=.5*Y,Y=.5/Y,L=(this._transform._rotation01+this._transform._rotation10)*Y,m=(this._transform._rotation02+this._transform._rotation20)*Y,g=(this._transform._rotation21-this._transform._rotation12)*Y):(Y=Math.sqrt(F-N-A+1),m=.5*Y,Y=.5/Y,X=(this._transform._rotation02+this._transform._rotation20)*Y,L=(this._transform._rotation12+this._transform._rotation21)*Y,g=(this._transform._rotation10-this._transform._rotation01)*Y):A>F?(Y=Math.sqrt(A-F-N+1),L=.5*Y,Y=.5/Y,X=(this._transform._rotation01+this._transform._rotation10)*Y,m=(this._transform._rotation12+this._transform._rotation21)*Y,g=(this._transform._rotation02-this._transform._rotation20)*Y):(Y=Math.sqrt(F-N-A+1),m=.5*Y,Y=.5/Y,X=(this._transform._rotation02+this._transform._rotation20)*Y,L=(this._transform._rotation12+this._transform._rotation21)*Y,g=(this._transform._rotation10-this._transform._rotation01)*Y),X=k*X+V*g+M*m-I*L,L=k*L-V*m+M*g+I*X,m=k*m+V*L-M*X+I*g,g=k*g-V*X-M*L-I*m;var R=X*X+L*L+m*m+g*g;R>1e-32&&(R=1/Math.sqrt(R)),X*=R,L*=R,m*=R,g*=R;var C=X,d=L,Z=m,$=g,K=2*C,E=2*d,J=2*Z,B=C*K,Q=d*E,U=Z*J,G=C*E,D=d*J,H=C*J,j=$*K,ia=$*E,sa=$*J;this._transform._rotation00=1-Q-U,this._transform._rotation01=G-sa,this._transform._rotation02=H+ia,this._transform._rotation10=G+sa,this._transform._rotation11=1-B-U,this._transform._rotation12=D-j,this._transform._rotation20=H-ia,this._transform._rotation21=D+j,this._transform._rotation22=1-B-Q;var W,q,na,oa,aa,T,ca,_a,w;W=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,q=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,na=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,oa=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,aa=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,T=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,ca=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_a=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,w=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=W,this._invInertia01=q,this._invInertia02=na,this._invInertia10=oa,this._invInertia11=aa,this._invInertia12=T,this._invInertia20=ca,this._invInertia21=_a,this._invInertia22=w;var ta,ra,la,va,xa,za,Ma,Xa,Za;ta=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,ra=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,la=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,va=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,xa=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,za=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,Ma=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,Xa=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Za=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=ta,this._invInertia01=ra,this._invInertia02=la,this._invInertia10=va,this._invInertia11=xa,this._invInertia12=za,this._invInertia20=Ma,this._invInertia21=Xa,this._invInertia22=Za,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;break}}_integratePseudoVelocity(){var a=this._pseudoVelX*this._pseudoVelX+this._pseudoVelY*this._pseudoVelY+this._pseudoVelZ*this._pseudoVelZ,t=this._angPseudoVelX*this._angPseudoVelX+this._angPseudoVelY*this._angPseudoVelY+this._angPseudoVelZ*this._angPseudoVelZ;if(!(a==0&&t==0))switch(this._type){case 1:this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:var i,r,o,s,_,h;i=this._pseudoVelX,r=this._pseudoVelY,o=this._pseudoVelZ,s=this._angPseudoVelX,_=this._angPseudoVelY,h=this._angPseudoVelZ,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._transform._positionX+=i,this._transform._positionY+=r,this._transform._positionZ+=o;var v=Math.sqrt(s*s+_*_+h*h),e=v*.5,l,u;if(e<.5){var b=e*e;l=.5*(1-b*.16666666666666666+b*b*.008333333333333333),u=1-b*.5+b*b*.041666666666666664}else l=Math.sin(e)/v,u=Math.cos(e);var f,n,c;f=s*l,n=_*l,c=h*l;var z,p,y,V;z=f,p=n,y=c,V=u;var M,I,k,X,L=this._transform._rotation00,m=this._transform._rotation11,g=this._transform._rotation22,N=L+m+g,A;N>0?(A=Math.sqrt(N+1),X=.5*A,A=.5/A,M=(this._transform._rotation21-this._transform._rotation12)*A,I=(this._transform._rotation02-this._transform._rotation20)*A,k=(this._transform._rotation10-this._transform._rotation01)*A):L>m?L>g?(A=Math.sqrt(L-m-g+1),M=.5*A,A=.5/A,I=(this._transform._rotation01+this._transform._rotation10)*A,k=(this._transform._rotation02+this._transform._rotation20)*A,X=(this._transform._rotation21-this._transform._rotation12)*A):(A=Math.sqrt(g-L-m+1),k=.5*A,A=.5/A,M=(this._transform._rotation02+this._transform._rotation20)*A,I=(this._transform._rotation12+this._transform._rotation21)*A,X=(this._transform._rotation10-this._transform._rotation01)*A):m>g?(A=Math.sqrt(m-g-L+1),I=.5*A,A=.5/A,M=(this._transform._rotation01+this._transform._rotation10)*A,k=(this._transform._rotation12+this._transform._rotation21)*A,X=(this._transform._rotation02-this._transform._rotation20)*A):(A=Math.sqrt(g-L-m+1),k=.5*A,A=.5/A,M=(this._transform._rotation02+this._transform._rotation20)*A,I=(this._transform._rotation12+this._transform._rotation21)*A,X=(this._transform._rotation10-this._transform._rotation01)*A),M=V*M+z*X+p*k-y*I,I=V*I-z*k+p*X+y*M,k=V*k+z*I-p*M+y*X,X=V*X-z*M-p*I-y*k;var F=M*M+I*I+k*k+X*X;F>1e-32&&(F=1/Math.sqrt(F)),M*=F,I*=F,k*=F,X*=F;var P=M,Y=I,R=k,C=X,d=2*P,Z=2*Y,$=2*R,K=P*d,E=Y*Z,J=R*$,B=P*Z,Q=Y*$,U=P*$,G=C*d,D=C*Z,H=C*$;this._transform._rotation00=1-E-J,this._transform._rotation01=B-H,this._transform._rotation02=U+D,this._transform._rotation10=B+H,this._transform._rotation11=1-K-J,this._transform._rotation12=Q-G,this._transform._rotation20=U-D,this._transform._rotation21=Q+G,this._transform._rotation22=1-K-E;var j,ia,sa,W,q,na,oa,aa,T;j=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,ia=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,sa=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,W=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,q=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,na=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,oa=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,aa=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,T=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=j,this._invInertia01=ia,this._invInertia02=sa,this._invInertia10=W,this._invInertia11=q,this._invInertia12=na,this._invInertia20=oa,this._invInertia21=aa,this._invInertia22=T;var ca,_a,w,ta,ra,la,va,xa,za;ca=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,_a=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,w=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,ta=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,ra=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,la=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,va=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,xa=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,za=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=ca,this._invInertia01=_a,this._invInertia02=w,this._invInertia10=ta,this._invInertia11=ra,this._invInertia12=la,this._invInertia20=va,this._invInertia21=xa,this._invInertia22=za,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;break}}updateMass(){var a,t,i,r,o,s,_,h,v;a=0,t=0,i=0,r=0,o=0,s=0,_=0,h=0,v=0;for(var e=0,l=this._shapeList;l!=null;){var u=l._next,b=l._geom;b._updateMass();var f=l._density*b._volume,n,c,z,p,y,V,M,I,k,X,L,m,g,N,A,F,P,Y;X=l._localTransform._rotation00*b._inertiaCoeff00+l._localTransform._rotation01*b._inertiaCoeff10+l._localTransform._rotation02*b._inertiaCoeff20,L=l._localTransform._rotation00*b._inertiaCoeff01+l._localTransform._rotation01*b._inertiaCoeff11+l._localTransform._rotation02*b._inertiaCoeff21,m=l._localTransform._rotation00*b._inertiaCoeff02+l._localTransform._rotation01*b._inertiaCoeff12+l._localTransform._rotation02*b._inertiaCoeff22,g=l._localTransform._rotation10*b._inertiaCoeff00+l._localTransform._rotation11*b._inertiaCoeff10+l._localTransform._rotation12*b._inertiaCoeff20,N=l._localTransform._rotation10*b._inertiaCoeff01+l._localTransform._rotation11*b._inertiaCoeff11+l._localTransform._rotation12*b._inertiaCoeff21,A=l._localTransform._rotation10*b._inertiaCoeff02+l._localTransform._rotation11*b._inertiaCoeff12+l._localTransform._rotation12*b._inertiaCoeff22,F=l._localTransform._rotation20*b._inertiaCoeff00+l._localTransform._rotation21*b._inertiaCoeff10+l._localTransform._rotation22*b._inertiaCoeff20,P=l._localTransform._rotation20*b._inertiaCoeff01+l._localTransform._rotation21*b._inertiaCoeff11+l._localTransform._rotation22*b._inertiaCoeff21,Y=l._localTransform._rotation20*b._inertiaCoeff02+l._localTransform._rotation21*b._inertiaCoeff12+l._localTransform._rotation22*b._inertiaCoeff22,n=X,c=L,z=m,p=g,y=N,V=A,M=F,I=P,k=Y;var R,C,d,Z,$,K,E,J,B;R=n*l._localTransform._rotation00+c*l._localTransform._rotation01+z*l._localTransform._rotation02,C=n*l._localTransform._rotation10+c*l._localTransform._rotation11+z*l._localTransform._rotation12,d=n*l._localTransform._rotation20+c*l._localTransform._rotation21+z*l._localTransform._rotation22,Z=p*l._localTransform._rotation00+y*l._localTransform._rotation01+V*l._localTransform._rotation02,$=p*l._localTransform._rotation10+y*l._localTransform._rotation11+V*l._localTransform._rotation12,K=p*l._localTransform._rotation20+y*l._localTransform._rotation21+V*l._localTransform._rotation22,E=M*l._localTransform._rotation00+I*l._localTransform._rotation01+k*l._localTransform._rotation02,J=M*l._localTransform._rotation10+I*l._localTransform._rotation11+k*l._localTransform._rotation12,B=M*l._localTransform._rotation20+I*l._localTransform._rotation21+k*l._localTransform._rotation22,n=R,c=C,z=d,p=Z,y=$,V=K,M=E,I=J,k=B,n*=f,c*=f,z*=f,p*=f,y*=f,V*=f,M*=f,I*=f,k*=f;var Q,U,G,D,H,j,ia,sa,W,q=l._localTransform._positionX*l._localTransform._positionX,na=l._localTransform._positionY*l._localTransform._positionY,oa=l._localTransform._positionZ*l._localTransform._positionZ,aa=-l._localTransform._positionX*l._localTransform._positionY,T=-l._localTransform._positionY*l._localTransform._positionZ,ca=-l._localTransform._positionZ*l._localTransform._positionX;Q=na+oa,U=aa,G=ca,D=aa,H=q+oa,j=T,ia=ca,sa=T,W=q+na,n+=Q*f,c+=U*f,z+=G*f,p+=D*f,y+=H*f,V+=j*f,M+=ia*f,I+=sa*f,k+=W*f,e+=f,a+=n,t+=c,i+=z,r+=p,o+=y,s+=V,_+=M,h+=I,v+=k,l=u}this._mass=e,this._localInertia00=a,this._localInertia01=t,this._localInertia02=i,this._localInertia10=r,this._localInertia11=o,this._localInertia12=s,this._localInertia20=_,this._localInertia21=h,this._localInertia22=v;var _a=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,w=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,ta=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,ra=this._localInertia00*_a-this._localInertia01*w+this._localInertia02*ta;if(this._mass>0&&ra>0&&this._type==0){this._invMass=1/this._mass;var la=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,va=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,xa=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,za=this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21,Ma=this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20,Xa=this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20,Za=this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11,fa=this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10,ba=this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10,ea=this._localInertia00*la-this._localInertia01*va+this._localInertia02*xa;(ea<-1e-32||ea>1e-32)&&(ea=1/ea),this._invLocalInertia00=la*ea,this._invLocalInertia01=-za*ea,this._invLocalInertia02=Za*ea,this._invLocalInertia10=-va*ea,this._invLocalInertia11=Ma*ea,this._invLocalInertia12=-fa*ea,this._invLocalInertia20=xa*ea,this._invLocalInertia21=-Xa*ea,this._invLocalInertia22=ba*ea,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._type==0&&(this._type=1);var ha,ma,ya,da,pa,Ya,Qa,ga,ua;ha=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,ma=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,ya=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,da=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,pa=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,Ya=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,Qa=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,ga=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,ua=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=ha,this._invInertia01=ma,this._invInertia02=ya,this._invInertia10=da,this._invInertia11=pa,this._invInertia12=Ya,this._invInertia20=Qa,this._invInertia21=ga,this._invInertia22=ua;var wa,ka,Sa,zt,Ha,Ba,nt,Ea,Fa;wa=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,ka=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,Sa=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,zt=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,Ha=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,Ba=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,nt=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,Ea=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Fa=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=wa,this._invInertia01=ka,this._invInertia02=Sa,this._invInertia10=zt,this._invInertia11=Ha,this._invInertia12=Ba,this._invInertia20=nt,this._invInertia21=Ea,this._invInertia22=Fa,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getPosition(){var a=new x.common.Vec3,t=a;return t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ,a}getPositionTo(a){var t=a;t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ}setPosition(a){var t=a;this._transform._positionX=t.x,this._transform._positionY=t.y,this._transform._positionZ=t.z;var i=this._ptransform,r=this._transform;i._positionX=r._positionX,i._positionY=r._positionY,i._positionZ=r._positionZ,i._rotation00=r._rotation00,i._rotation01=r._rotation01,i._rotation02=r._rotation02,i._rotation10=r._rotation10,i._rotation11=r._rotation11,i._rotation12=r._rotation12,i._rotation20=r._rotation20,i._rotation21=r._rotation21,i._rotation22=r._rotation22;for(var o=this._shapeList;o!=null;){var s=o._next,_=o._ptransform,h=o._localTransform,v=this._ptransform,e,l,u,b,f,n,c,z,p;e=v._rotation00*h._rotation00+v._rotation01*h._rotation10+v._rotation02*h._rotation20,l=v._rotation00*h._rotation01+v._rotation01*h._rotation11+v._rotation02*h._rotation21,u=v._rotation00*h._rotation02+v._rotation01*h._rotation12+v._rotation02*h._rotation22,b=v._rotation10*h._rotation00+v._rotation11*h._rotation10+v._rotation12*h._rotation20,f=v._rotation10*h._rotation01+v._rotation11*h._rotation11+v._rotation12*h._rotation21,n=v._rotation10*h._rotation02+v._rotation11*h._rotation12+v._rotation12*h._rotation22,c=v._rotation20*h._rotation00+v._rotation21*h._rotation10+v._rotation22*h._rotation20,z=v._rotation20*h._rotation01+v._rotation21*h._rotation11+v._rotation22*h._rotation21,p=v._rotation20*h._rotation02+v._rotation21*h._rotation12+v._rotation22*h._rotation22,_._rotation00=e,_._rotation01=l,_._rotation02=u,_._rotation10=b,_._rotation11=f,_._rotation12=n,_._rotation20=c,_._rotation21=z,_._rotation22=p;var y,V,M;y=v._rotation00*h._positionX+v._rotation01*h._positionY+v._rotation02*h._positionZ,V=v._rotation10*h._positionX+v._rotation11*h._positionY+v._rotation12*h._positionZ,M=v._rotation20*h._positionX+v._rotation21*h._positionY+v._rotation22*h._positionZ,_._positionX=y,_._positionY=V,_._positionZ=M,_._positionX+=v._positionX,_._positionY+=v._positionY,_._positionZ+=v._positionZ;var I=o._transform,k=o._localTransform,X=this._transform,L,m,g,N,A,F,P,Y,R;L=X._rotation00*k._rotation00+X._rotation01*k._rotation10+X._rotation02*k._rotation20,m=X._rotation00*k._rotation01+X._rotation01*k._rotation11+X._rotation02*k._rotation21,g=X._rotation00*k._rotation02+X._rotation01*k._rotation12+X._rotation02*k._rotation22,N=X._rotation10*k._rotation00+X._rotation11*k._rotation10+X._rotation12*k._rotation20,A=X._rotation10*k._rotation01+X._rotation11*k._rotation11+X._rotation12*k._rotation21,F=X._rotation10*k._rotation02+X._rotation11*k._rotation12+X._rotation12*k._rotation22,P=X._rotation20*k._rotation00+X._rotation21*k._rotation10+X._rotation22*k._rotation20,Y=X._rotation20*k._rotation01+X._rotation21*k._rotation11+X._rotation22*k._rotation21,R=X._rotation20*k._rotation02+X._rotation21*k._rotation12+X._rotation22*k._rotation22,I._rotation00=L,I._rotation01=m,I._rotation02=g,I._rotation10=N,I._rotation11=A,I._rotation12=F,I._rotation20=P,I._rotation21=Y,I._rotation22=R;var C,d,Z;C=X._rotation00*k._positionX+X._rotation01*k._positionY+X._rotation02*k._positionZ,d=X._rotation10*k._positionX+X._rotation11*k._positionY+X._rotation12*k._positionZ,Z=X._rotation20*k._positionX+X._rotation21*k._positionY+X._rotation22*k._positionZ,I._positionX=C,I._positionY=d,I._positionZ=Z,I._positionX+=X._positionX,I._positionY+=X._positionY,I._positionZ+=X._positionZ;var $,K,E,J,B,Q;if(o._geom._computeAabb(o._aabb,o._ptransform),$=o._aabb._minX,K=o._aabb._minY,E=o._aabb._minZ,J=o._aabb._maxX,B=o._aabb._maxY,Q=o._aabb._maxZ,o._geom._computeAabb(o._aabb,o._transform),o._aabb._minX=$<o._aabb._minX?$:o._aabb._minX,o._aabb._minY=K<o._aabb._minY?K:o._aabb._minY,o._aabb._minZ=E<o._aabb._minZ?E:o._aabb._minZ,o._aabb._maxX=J>o._aabb._maxX?J:o._aabb._maxX,o._aabb._maxY=B>o._aabb._maxY?B:o._aabb._maxY,o._aabb._maxZ=Q>o._aabb._maxZ?Q:o._aabb._maxZ,o._proxy!=null){var U,G,D;U=o._transform._positionX-o._ptransform._positionX,G=o._transform._positionY-o._ptransform._positionY,D=o._transform._positionZ-o._ptransform._positionZ;var H=o.displacement;H.x=U,H.y=G,H.z=D,o._rigidBody._world._broadPhase.moveProxy(o._proxy,o._aabb,o.displacement)}o=s}this._sleeping=!1,this._sleepTime=0}translate(a){var t,i,r,o=a;t=o.x,i=o.y,r=o.z,this._transform._positionX+=t,this._transform._positionY+=i,this._transform._positionZ+=r;var s=this._ptransform,_=this._transform;s._positionX=_._positionX,s._positionY=_._positionY,s._positionZ=_._positionZ,s._rotation00=_._rotation00,s._rotation01=_._rotation01,s._rotation02=_._rotation02,s._rotation10=_._rotation10,s._rotation11=_._rotation11,s._rotation12=_._rotation12,s._rotation20=_._rotation20,s._rotation21=_._rotation21,s._rotation22=_._rotation22;for(var h=this._shapeList;h!=null;){var v=h._next,e=h._ptransform,l=h._localTransform,u=this._ptransform,b,f,n,c,z,p,y,V,M;b=u._rotation00*l._rotation00+u._rotation01*l._rotation10+u._rotation02*l._rotation20,f=u._rotation00*l._rotation01+u._rotation01*l._rotation11+u._rotation02*l._rotation21,n=u._rotation00*l._rotation02+u._rotation01*l._rotation12+u._rotation02*l._rotation22,c=u._rotation10*l._rotation00+u._rotation11*l._rotation10+u._rotation12*l._rotation20,z=u._rotation10*l._rotation01+u._rotation11*l._rotation11+u._rotation12*l._rotation21,p=u._rotation10*l._rotation02+u._rotation11*l._rotation12+u._rotation12*l._rotation22,y=u._rotation20*l._rotation00+u._rotation21*l._rotation10+u._rotation22*l._rotation20,V=u._rotation20*l._rotation01+u._rotation21*l._rotation11+u._rotation22*l._rotation21,M=u._rotation20*l._rotation02+u._rotation21*l._rotation12+u._rotation22*l._rotation22,e._rotation00=b,e._rotation01=f,e._rotation02=n,e._rotation10=c,e._rotation11=z,e._rotation12=p,e._rotation20=y,e._rotation21=V,e._rotation22=M;var I,k,X;I=u._rotation00*l._positionX+u._rotation01*l._positionY+u._rotation02*l._positionZ,k=u._rotation10*l._positionX+u._rotation11*l._positionY+u._rotation12*l._positionZ,X=u._rotation20*l._positionX+u._rotation21*l._positionY+u._rotation22*l._positionZ,e._positionX=I,e._positionY=k,e._positionZ=X,e._positionX+=u._positionX,e._positionY+=u._positionY,e._positionZ+=u._positionZ;var L=h._transform,m=h._localTransform,g=this._transform,N,A,F,P,Y,R,C,d,Z;N=g._rotation00*m._rotation00+g._rotation01*m._rotation10+g._rotation02*m._rotation20,A=g._rotation00*m._rotation01+g._rotation01*m._rotation11+g._rotation02*m._rotation21,F=g._rotation00*m._rotation02+g._rotation01*m._rotation12+g._rotation02*m._rotation22,P=g._rotation10*m._rotation00+g._rotation11*m._rotation10+g._rotation12*m._rotation20,Y=g._rotation10*m._rotation01+g._rotation11*m._rotation11+g._rotation12*m._rotation21,R=g._rotation10*m._rotation02+g._rotation11*m._rotation12+g._rotation12*m._rotation22,C=g._rotation20*m._rotation00+g._rotation21*m._rotation10+g._rotation22*m._rotation20,d=g._rotation20*m._rotation01+g._rotation21*m._rotation11+g._rotation22*m._rotation21,Z=g._rotation20*m._rotation02+g._rotation21*m._rotation12+g._rotation22*m._rotation22,L._rotation00=N,L._rotation01=A,L._rotation02=F,L._rotation10=P,L._rotation11=Y,L._rotation12=R,L._rotation20=C,L._rotation21=d,L._rotation22=Z;var $,K,E;$=g._rotation00*m._positionX+g._rotation01*m._positionY+g._rotation02*m._positionZ,K=g._rotation10*m._positionX+g._rotation11*m._positionY+g._rotation12*m._positionZ,E=g._rotation20*m._positionX+g._rotation21*m._positionY+g._rotation22*m._positionZ,L._positionX=$,L._positionY=K,L._positionZ=E,L._positionX+=g._positionX,L._positionY+=g._positionY,L._positionZ+=g._positionZ;var J,B,Q,U,G,D;if(h._geom._computeAabb(h._aabb,h._ptransform),J=h._aabb._minX,B=h._aabb._minY,Q=h._aabb._minZ,U=h._aabb._maxX,G=h._aabb._maxY,D=h._aabb._maxZ,h._geom._computeAabb(h._aabb,h._transform),h._aabb._minX=J<h._aabb._minX?J:h._aabb._minX,h._aabb._minY=B<h._aabb._minY?B:h._aabb._minY,h._aabb._minZ=Q<h._aabb._minZ?Q:h._aabb._minZ,h._aabb._maxX=U>h._aabb._maxX?U:h._aabb._maxX,h._aabb._maxY=G>h._aabb._maxY?G:h._aabb._maxY,h._aabb._maxZ=D>h._aabb._maxZ?D:h._aabb._maxZ,h._proxy!=null){var H,j,ia;H=h._transform._positionX-h._ptransform._positionX,j=h._transform._positionY-h._ptransform._positionY,ia=h._transform._positionZ-h._ptransform._positionZ;var sa=h.displacement;sa.x=H,sa.y=j,sa.z=ia,h._rigidBody._world._broadPhase.moveProxy(h._proxy,h._aabb,h.displacement)}h=v}this._sleeping=!1,this._sleepTime=0}getRotation(){var a=new x.common.Mat3,t=a;return t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22,a}getRotationTo(a){var t=a;t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22}setRotation(a){var t=a;this._transform._rotation00=t.e00,this._transform._rotation01=t.e01,this._transform._rotation02=t.e02,this._transform._rotation10=t.e10,this._transform._rotation11=t.e11,this._transform._rotation12=t.e12,this._transform._rotation20=t.e20,this._transform._rotation21=t.e21,this._transform._rotation22=t.e22;var i,r,o,s,_,h,v,e,l;i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,r=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,o=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,s=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,_=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,h=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,v=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,e=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=r,this._invInertia02=o,this._invInertia10=s,this._invInertia11=_,this._invInertia12=h,this._invInertia20=v,this._invInertia21=e,this._invInertia22=l;var u,b,f,n,c,z,p,y,V;u=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,b=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,f=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,n=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,c=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,z=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,p=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,y=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,V=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=u,this._invInertia01=b,this._invInertia02=f,this._invInertia10=n,this._invInertia11=c,this._invInertia12=z,this._invInertia20=p,this._invInertia21=y,this._invInertia22=V,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var M=this._ptransform,I=this._transform;M._positionX=I._positionX,M._positionY=I._positionY,M._positionZ=I._positionZ,M._rotation00=I._rotation00,M._rotation01=I._rotation01,M._rotation02=I._rotation02,M._rotation10=I._rotation10,M._rotation11=I._rotation11,M._rotation12=I._rotation12,M._rotation20=I._rotation20,M._rotation21=I._rotation21,M._rotation22=I._rotation22;for(var k=this._shapeList;k!=null;){var X=k._next,L=k._ptransform,m=k._localTransform,g=this._ptransform,N,A,F,P,Y,R,C,d,Z;N=g._rotation00*m._rotation00+g._rotation01*m._rotation10+g._rotation02*m._rotation20,A=g._rotation00*m._rotation01+g._rotation01*m._rotation11+g._rotation02*m._rotation21,F=g._rotation00*m._rotation02+g._rotation01*m._rotation12+g._rotation02*m._rotation22,P=g._rotation10*m._rotation00+g._rotation11*m._rotation10+g._rotation12*m._rotation20,Y=g._rotation10*m._rotation01+g._rotation11*m._rotation11+g._rotation12*m._rotation21,R=g._rotation10*m._rotation02+g._rotation11*m._rotation12+g._rotation12*m._rotation22,C=g._rotation20*m._rotation00+g._rotation21*m._rotation10+g._rotation22*m._rotation20,d=g._rotation20*m._rotation01+g._rotation21*m._rotation11+g._rotation22*m._rotation21,Z=g._rotation20*m._rotation02+g._rotation21*m._rotation12+g._rotation22*m._rotation22,L._rotation00=N,L._rotation01=A,L._rotation02=F,L._rotation10=P,L._rotation11=Y,L._rotation12=R,L._rotation20=C,L._rotation21=d,L._rotation22=Z;var $,K,E;$=g._rotation00*m._positionX+g._rotation01*m._positionY+g._rotation02*m._positionZ,K=g._rotation10*m._positionX+g._rotation11*m._positionY+g._rotation12*m._positionZ,E=g._rotation20*m._positionX+g._rotation21*m._positionY+g._rotation22*m._positionZ,L._positionX=$,L._positionY=K,L._positionZ=E,L._positionX+=g._positionX,L._positionY+=g._positionY,L._positionZ+=g._positionZ;var J=k._transform,B=k._localTransform,Q=this._transform,U,G,D,H,j,ia,sa,W,q;U=Q._rotation00*B._rotation00+Q._rotation01*B._rotation10+Q._rotation02*B._rotation20,G=Q._rotation00*B._rotation01+Q._rotation01*B._rotation11+Q._rotation02*B._rotation21,D=Q._rotation00*B._rotation02+Q._rotation01*B._rotation12+Q._rotation02*B._rotation22,H=Q._rotation10*B._rotation00+Q._rotation11*B._rotation10+Q._rotation12*B._rotation20,j=Q._rotation10*B._rotation01+Q._rotation11*B._rotation11+Q._rotation12*B._rotation21,ia=Q._rotation10*B._rotation02+Q._rotation11*B._rotation12+Q._rotation12*B._rotation22,sa=Q._rotation20*B._rotation00+Q._rotation21*B._rotation10+Q._rotation22*B._rotation20,W=Q._rotation20*B._rotation01+Q._rotation21*B._rotation11+Q._rotation22*B._rotation21,q=Q._rotation20*B._rotation02+Q._rotation21*B._rotation12+Q._rotation22*B._rotation22,J._rotation00=U,J._rotation01=G,J._rotation02=D,J._rotation10=H,J._rotation11=j,J._rotation12=ia,J._rotation20=sa,J._rotation21=W,J._rotation22=q;var na,oa,aa;na=Q._rotation00*B._positionX+Q._rotation01*B._positionY+Q._rotation02*B._positionZ,oa=Q._rotation10*B._positionX+Q._rotation11*B._positionY+Q._rotation12*B._positionZ,aa=Q._rotation20*B._positionX+Q._rotation21*B._positionY+Q._rotation22*B._positionZ,J._positionX=na,J._positionY=oa,J._positionZ=aa,J._positionX+=Q._positionX,J._positionY+=Q._positionY,J._positionZ+=Q._positionZ;var T,ca,_a,w,ta,ra;if(k._geom._computeAabb(k._aabb,k._ptransform),T=k._aabb._minX,ca=k._aabb._minY,_a=k._aabb._minZ,w=k._aabb._maxX,ta=k._aabb._maxY,ra=k._aabb._maxZ,k._geom._computeAabb(k._aabb,k._transform),k._aabb._minX=T<k._aabb._minX?T:k._aabb._minX,k._aabb._minY=ca<k._aabb._minY?ca:k._aabb._minY,k._aabb._minZ=_a<k._aabb._minZ?_a:k._aabb._minZ,k._aabb._maxX=w>k._aabb._maxX?w:k._aabb._maxX,k._aabb._maxY=ta>k._aabb._maxY?ta:k._aabb._maxY,k._aabb._maxZ=ra>k._aabb._maxZ?ra:k._aabb._maxZ,k._proxy!=null){var la,va,xa;la=k._transform._positionX-k._ptransform._positionX,va=k._transform._positionY-k._ptransform._positionY,xa=k._transform._positionZ-k._ptransform._positionZ;var za=k.displacement;za.x=la,za.y=va,za.z=xa,k._rigidBody._world._broadPhase.moveProxy(k._proxy,k._aabb,k.displacement)}k=X}this._sleeping=!1,this._sleepTime=0}setRotationXyz(a){var t,i,r,o=a;t=o.x,i=o.y,r=o.z;var s=Math.sin(t),_=Math.sin(i),h=Math.sin(r),v=Math.cos(t),e=Math.cos(i),l=Math.cos(r);this._transform._rotation00=e*l,this._transform._rotation01=-e*h,this._transform._rotation02=_,this._transform._rotation10=v*h+l*s*_,this._transform._rotation11=v*l-s*_*h,this._transform._rotation12=-e*s,this._transform._rotation20=s*h-v*l*_,this._transform._rotation21=l*s+v*_*h,this._transform._rotation22=v*e;var u,b,f,n,c,z,p,y,V;u=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,b=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,f=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,n=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,c=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,z=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,p=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,y=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,V=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=u,this._invInertia01=b,this._invInertia02=f,this._invInertia10=n,this._invInertia11=c,this._invInertia12=z,this._invInertia20=p,this._invInertia21=y,this._invInertia22=V;var M,I,k,X,L,m,g,N,A;M=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,I=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,k=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,X=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,L=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,m=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,g=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,N=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,A=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=M,this._invInertia01=I,this._invInertia02=k,this._invInertia10=X,this._invInertia11=L,this._invInertia12=m,this._invInertia20=g,this._invInertia21=N,this._invInertia22=A,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var F=this._ptransform,P=this._transform;F._positionX=P._positionX,F._positionY=P._positionY,F._positionZ=P._positionZ,F._rotation00=P._rotation00,F._rotation01=P._rotation01,F._rotation02=P._rotation02,F._rotation10=P._rotation10,F._rotation11=P._rotation11,F._rotation12=P._rotation12,F._rotation20=P._rotation20,F._rotation21=P._rotation21,F._rotation22=P._rotation22;for(var Y=this._shapeList;Y!=null;){var R=Y._next,C=Y._ptransform,d=Y._localTransform,Z=this._ptransform,$,K,E,J,B,Q,U,G,D;$=Z._rotation00*d._rotation00+Z._rotation01*d._rotation10+Z._rotation02*d._rotation20,K=Z._rotation00*d._rotation01+Z._rotation01*d._rotation11+Z._rotation02*d._rotation21,E=Z._rotation00*d._rotation02+Z._rotation01*d._rotation12+Z._rotation02*d._rotation22,J=Z._rotation10*d._rotation00+Z._rotation11*d._rotation10+Z._rotation12*d._rotation20,B=Z._rotation10*d._rotation01+Z._rotation11*d._rotation11+Z._rotation12*d._rotation21,Q=Z._rotation10*d._rotation02+Z._rotation11*d._rotation12+Z._rotation12*d._rotation22,U=Z._rotation20*d._rotation00+Z._rotation21*d._rotation10+Z._rotation22*d._rotation20,G=Z._rotation20*d._rotation01+Z._rotation21*d._rotation11+Z._rotation22*d._rotation21,D=Z._rotation20*d._rotation02+Z._rotation21*d._rotation12+Z._rotation22*d._rotation22,C._rotation00=$,C._rotation01=K,C._rotation02=E,C._rotation10=J,C._rotation11=B,C._rotation12=Q,C._rotation20=U,C._rotation21=G,C._rotation22=D;var H,j,ia;H=Z._rotation00*d._positionX+Z._rotation01*d._positionY+Z._rotation02*d._positionZ,j=Z._rotation10*d._positionX+Z._rotation11*d._positionY+Z._rotation12*d._positionZ,ia=Z._rotation20*d._positionX+Z._rotation21*d._positionY+Z._rotation22*d._positionZ,C._positionX=H,C._positionY=j,C._positionZ=ia,C._positionX+=Z._positionX,C._positionY+=Z._positionY,C._positionZ+=Z._positionZ;var sa=Y._transform,W=Y._localTransform,q=this._transform,na,oa,aa,T,ca,_a,w,ta,ra;na=q._rotation00*W._rotation00+q._rotation01*W._rotation10+q._rotation02*W._rotation20,oa=q._rotation00*W._rotation01+q._rotation01*W._rotation11+q._rotation02*W._rotation21,aa=q._rotation00*W._rotation02+q._rotation01*W._rotation12+q._rotation02*W._rotation22,T=q._rotation10*W._rotation00+q._rotation11*W._rotation10+q._rotation12*W._rotation20,ca=q._rotation10*W._rotation01+q._rotation11*W._rotation11+q._rotation12*W._rotation21,_a=q._rotation10*W._rotation02+q._rotation11*W._rotation12+q._rotation12*W._rotation22,w=q._rotation20*W._rotation00+q._rotation21*W._rotation10+q._rotation22*W._rotation20,ta=q._rotation20*W._rotation01+q._rotation21*W._rotation11+q._rotation22*W._rotation21,ra=q._rotation20*W._rotation02+q._rotation21*W._rotation12+q._rotation22*W._rotation22,sa._rotation00=na,sa._rotation01=oa,sa._rotation02=aa,sa._rotation10=T,sa._rotation11=ca,sa._rotation12=_a,sa._rotation20=w,sa._rotation21=ta,sa._rotation22=ra;var la,va,xa;la=q._rotation00*W._positionX+q._rotation01*W._positionY+q._rotation02*W._positionZ,va=q._rotation10*W._positionX+q._rotation11*W._positionY+q._rotation12*W._positionZ,xa=q._rotation20*W._positionX+q._rotation21*W._positionY+q._rotation22*W._positionZ,sa._positionX=la,sa._positionY=va,sa._positionZ=xa,sa._positionX+=q._positionX,sa._positionY+=q._positionY,sa._positionZ+=q._positionZ;var za,Ma,Xa,Za,fa,ba;if(Y._geom._computeAabb(Y._aabb,Y._ptransform),za=Y._aabb._minX,Ma=Y._aabb._minY,Xa=Y._aabb._minZ,Za=Y._aabb._maxX,fa=Y._aabb._maxY,ba=Y._aabb._maxZ,Y._geom._computeAabb(Y._aabb,Y._transform),Y._aabb._minX=za<Y._aabb._minX?za:Y._aabb._minX,Y._aabb._minY=Ma<Y._aabb._minY?Ma:Y._aabb._minY,Y._aabb._minZ=Xa<Y._aabb._minZ?Xa:Y._aabb._minZ,Y._aabb._maxX=Za>Y._aabb._maxX?Za:Y._aabb._maxX,Y._aabb._maxY=fa>Y._aabb._maxY?fa:Y._aabb._maxY,Y._aabb._maxZ=ba>Y._aabb._maxZ?ba:Y._aabb._maxZ,Y._proxy!=null){var ea,ha,ma;ea=Y._transform._positionX-Y._ptransform._positionX,ha=Y._transform._positionY-Y._ptransform._positionY,ma=Y._transform._positionZ-Y._ptransform._positionZ;var ya=Y.displacement;ya.x=ea,ya.y=ha,ya.z=ma,Y._rigidBody._world._broadPhase.moveProxy(Y._proxy,Y._aabb,Y.displacement)}Y=R}this._sleeping=!1,this._sleepTime=0}rotate(a){var t,i,r,o,s,_,h,v,e,l=a;t=l.e00,i=l.e01,r=l.e02,o=l.e10,s=l.e11,_=l.e12,h=l.e20,v=l.e21,e=l.e22;var u,b,f,n,c,z,p,y,V;u=t*this._transform._rotation00+i*this._transform._rotation10+r*this._transform._rotation20,b=t*this._transform._rotation01+i*this._transform._rotation11+r*this._transform._rotation21,f=t*this._transform._rotation02+i*this._transform._rotation12+r*this._transform._rotation22,n=o*this._transform._rotation00+s*this._transform._rotation10+_*this._transform._rotation20,c=o*this._transform._rotation01+s*this._transform._rotation11+_*this._transform._rotation21,z=o*this._transform._rotation02+s*this._transform._rotation12+_*this._transform._rotation22,p=h*this._transform._rotation00+v*this._transform._rotation10+e*this._transform._rotation20,y=h*this._transform._rotation01+v*this._transform._rotation11+e*this._transform._rotation21,V=h*this._transform._rotation02+v*this._transform._rotation12+e*this._transform._rotation22,this._transform._rotation00=u,this._transform._rotation01=b,this._transform._rotation02=f,this._transform._rotation10=n,this._transform._rotation11=c,this._transform._rotation12=z,this._transform._rotation20=p,this._transform._rotation21=y,this._transform._rotation22=V;var M,I,k,X,L,m,g,N,A;M=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,I=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,k=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,X=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,L=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,m=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,g=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,N=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,A=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=M,this._invInertia01=I,this._invInertia02=k,this._invInertia10=X,this._invInertia11=L,this._invInertia12=m,this._invInertia20=g,this._invInertia21=N,this._invInertia22=A;var F,P,Y,R,C,d,Z,$,K;F=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,P=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,Y=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,R=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,C=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,d=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,Z=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,$=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,K=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=F,this._invInertia01=P,this._invInertia02=Y,this._invInertia10=R,this._invInertia11=C,this._invInertia12=d,this._invInertia20=Z,this._invInertia21=$,this._invInertia22=K,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var E=this._ptransform,J=this._transform;E._positionX=J._positionX,E._positionY=J._positionY,E._positionZ=J._positionZ,E._rotation00=J._rotation00,E._rotation01=J._rotation01,E._rotation02=J._rotation02,E._rotation10=J._rotation10,E._rotation11=J._rotation11,E._rotation12=J._rotation12,E._rotation20=J._rotation20,E._rotation21=J._rotation21,E._rotation22=J._rotation22;for(var B=this._shapeList;B!=null;){var Q=B._next,U=B._ptransform,G=B._localTransform,D=this._ptransform,H,j,ia,sa,W,q,na,oa,aa;H=D._rotation00*G._rotation00+D._rotation01*G._rotation10+D._rotation02*G._rotation20,j=D._rotation00*G._rotation01+D._rotation01*G._rotation11+D._rotation02*G._rotation21,ia=D._rotation00*G._rotation02+D._rotation01*G._rotation12+D._rotation02*G._rotation22,sa=D._rotation10*G._rotation00+D._rotation11*G._rotation10+D._rotation12*G._rotation20,W=D._rotation10*G._rotation01+D._rotation11*G._rotation11+D._rotation12*G._rotation21,q=D._rotation10*G._rotation02+D._rotation11*G._rotation12+D._rotation12*G._rotation22,na=D._rotation20*G._rotation00+D._rotation21*G._rotation10+D._rotation22*G._rotation20,oa=D._rotation20*G._rotation01+D._rotation21*G._rotation11+D._rotation22*G._rotation21,aa=D._rotation20*G._rotation02+D._rotation21*G._rotation12+D._rotation22*G._rotation22,U._rotation00=H,U._rotation01=j,U._rotation02=ia,U._rotation10=sa,U._rotation11=W,U._rotation12=q,U._rotation20=na,U._rotation21=oa,U._rotation22=aa;var T,ca,_a;T=D._rotation00*G._positionX+D._rotation01*G._positionY+D._rotation02*G._positionZ,ca=D._rotation10*G._positionX+D._rotation11*G._positionY+D._rotation12*G._positionZ,_a=D._rotation20*G._positionX+D._rotation21*G._positionY+D._rotation22*G._positionZ,U._positionX=T,U._positionY=ca,U._positionZ=_a,U._positionX+=D._positionX,U._positionY+=D._positionY,U._positionZ+=D._positionZ;var w=B._transform,ta=B._localTransform,ra=this._transform,la,va,xa,za,Ma,Xa,Za,fa,ba;la=ra._rotation00*ta._rotation00+ra._rotation01*ta._rotation10+ra._rotation02*ta._rotation20,va=ra._rotation00*ta._rotation01+ra._rotation01*ta._rotation11+ra._rotation02*ta._rotation21,xa=ra._rotation00*ta._rotation02+ra._rotation01*ta._rotation12+ra._rotation02*ta._rotation22,za=ra._rotation10*ta._rotation00+ra._rotation11*ta._rotation10+ra._rotation12*ta._rotation20,Ma=ra._rotation10*ta._rotation01+ra._rotation11*ta._rotation11+ra._rotation12*ta._rotation21,Xa=ra._rotation10*ta._rotation02+ra._rotation11*ta._rotation12+ra._rotation12*ta._rotation22,Za=ra._rotation20*ta._rotation00+ra._rotation21*ta._rotation10+ra._rotation22*ta._rotation20,fa=ra._rotation20*ta._rotation01+ra._rotation21*ta._rotation11+ra._rotation22*ta._rotation21,ba=ra._rotation20*ta._rotation02+ra._rotation21*ta._rotation12+ra._rotation22*ta._rotation22,w._rotation00=la,w._rotation01=va,w._rotation02=xa,w._rotation10=za,w._rotation11=Ma,w._rotation12=Xa,w._rotation20=Za,w._rotation21=fa,w._rotation22=ba;var ea,ha,ma;ea=ra._rotation00*ta._positionX+ra._rotation01*ta._positionY+ra._rotation02*ta._positionZ,ha=ra._rotation10*ta._positionX+ra._rotation11*ta._positionY+ra._rotation12*ta._positionZ,ma=ra._rotation20*ta._positionX+ra._rotation21*ta._positionY+ra._rotation22*ta._positionZ,w._positionX=ea,w._positionY=ha,w._positionZ=ma,w._positionX+=ra._positionX,w._positionY+=ra._positionY,w._positionZ+=ra._positionZ;var ya,da,pa,Ya,Qa,ga;if(B._geom._computeAabb(B._aabb,B._ptransform),ya=B._aabb._minX,da=B._aabb._minY,pa=B._aabb._minZ,Ya=B._aabb._maxX,Qa=B._aabb._maxY,ga=B._aabb._maxZ,B._geom._computeAabb(B._aabb,B._transform),B._aabb._minX=ya<B._aabb._minX?ya:B._aabb._minX,B._aabb._minY=da<B._aabb._minY?da:B._aabb._minY,B._aabb._minZ=pa<B._aabb._minZ?pa:B._aabb._minZ,B._aabb._maxX=Ya>B._aabb._maxX?Ya:B._aabb._maxX,B._aabb._maxY=Qa>B._aabb._maxY?Qa:B._aabb._maxY,B._aabb._maxZ=ga>B._aabb._maxZ?ga:B._aabb._maxZ,B._proxy!=null){var ua,wa,ka;ua=B._transform._positionX-B._ptransform._positionX,wa=B._transform._positionY-B._ptransform._positionY,ka=B._transform._positionZ-B._ptransform._positionZ;var Sa=B.displacement;Sa.x=ua,Sa.y=wa,Sa.z=ka,B._rigidBody._world._broadPhase.moveProxy(B._proxy,B._aabb,B.displacement)}B=Q}this._sleeping=!1,this._sleepTime=0}rotateXyz(a){var t,i,r,o,s,_,h,v,e,l,u,b,f=a;t=f.x,i=f.y,r=f.z;var n=Math.sin(t),c=Math.sin(i),z=Math.sin(r),p=Math.cos(t),y=Math.cos(i),V=Math.cos(r);o=y*V,s=-y*z,_=c,h=p*z+V*n*c,v=p*V-n*c*z,e=-y*n,l=n*z-p*V*c,u=V*n+p*c*z,b=p*y;var M,I,k,X,L,m,g,N,A;M=o*this._transform._rotation00+s*this._transform._rotation10+_*this._transform._rotation20,I=o*this._transform._rotation01+s*this._transform._rotation11+_*this._transform._rotation21,k=o*this._transform._rotation02+s*this._transform._rotation12+_*this._transform._rotation22,X=h*this._transform._rotation00+v*this._transform._rotation10+e*this._transform._rotation20,L=h*this._transform._rotation01+v*this._transform._rotation11+e*this._transform._rotation21,m=h*this._transform._rotation02+v*this._transform._rotation12+e*this._transform._rotation22,g=l*this._transform._rotation00+u*this._transform._rotation10+b*this._transform._rotation20,N=l*this._transform._rotation01+u*this._transform._rotation11+b*this._transform._rotation21,A=l*this._transform._rotation02+u*this._transform._rotation12+b*this._transform._rotation22,this._transform._rotation00=M,this._transform._rotation01=I,this._transform._rotation02=k,this._transform._rotation10=X,this._transform._rotation11=L,this._transform._rotation12=m,this._transform._rotation20=g,this._transform._rotation21=N,this._transform._rotation22=A;var F,P,Y,R,C,d,Z,$,K;F=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,P=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,Y=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,R=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,C=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,d=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,Z=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,$=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,K=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=F,this._invInertia01=P,this._invInertia02=Y,this._invInertia10=R,this._invInertia11=C,this._invInertia12=d,this._invInertia20=Z,this._invInertia21=$,this._invInertia22=K;var E,J,B,Q,U,G,D,H,j;E=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,J=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,B=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,Q=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,U=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,G=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,D=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,H=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,j=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=E,this._invInertia01=J,this._invInertia02=B,this._invInertia10=Q,this._invInertia11=U,this._invInertia12=G,this._invInertia20=D,this._invInertia21=H,this._invInertia22=j,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var ia=this._ptransform,sa=this._transform;ia._positionX=sa._positionX,ia._positionY=sa._positionY,ia._positionZ=sa._positionZ,ia._rotation00=sa._rotation00,ia._rotation01=sa._rotation01,ia._rotation02=sa._rotation02,ia._rotation10=sa._rotation10,ia._rotation11=sa._rotation11,ia._rotation12=sa._rotation12,ia._rotation20=sa._rotation20,ia._rotation21=sa._rotation21,ia._rotation22=sa._rotation22;for(var W=this._shapeList;W!=null;){var q=W._next,na=W._ptransform,oa=W._localTransform,aa=this._ptransform,T,ca,_a,w,ta,ra,la,va,xa;T=aa._rotation00*oa._rotation00+aa._rotation01*oa._rotation10+aa._rotation02*oa._rotation20,ca=aa._rotation00*oa._rotation01+aa._rotation01*oa._rotation11+aa._rotation02*oa._rotation21,_a=aa._rotation00*oa._rotation02+aa._rotation01*oa._rotation12+aa._rotation02*oa._rotation22,w=aa._rotation10*oa._rotation00+aa._rotation11*oa._rotation10+aa._rotation12*oa._rotation20,ta=aa._rotation10*oa._rotation01+aa._rotation11*oa._rotation11+aa._rotation12*oa._rotation21,ra=aa._rotation10*oa._rotation02+aa._rotation11*oa._rotation12+aa._rotation12*oa._rotation22,la=aa._rotation20*oa._rotation00+aa._rotation21*oa._rotation10+aa._rotation22*oa._rotation20,va=aa._rotation20*oa._rotation01+aa._rotation21*oa._rotation11+aa._rotation22*oa._rotation21,xa=aa._rotation20*oa._rotation02+aa._rotation21*oa._rotation12+aa._rotation22*oa._rotation22,na._rotation00=T,na._rotation01=ca,na._rotation02=_a,na._rotation10=w,na._rotation11=ta,na._rotation12=ra,na._rotation20=la,na._rotation21=va,na._rotation22=xa;var za,Ma,Xa;za=aa._rotation00*oa._positionX+aa._rotation01*oa._positionY+aa._rotation02*oa._positionZ,Ma=aa._rotation10*oa._positionX+aa._rotation11*oa._positionY+aa._rotation12*oa._positionZ,Xa=aa._rotation20*oa._positionX+aa._rotation21*oa._positionY+aa._rotation22*oa._positionZ,na._positionX=za,na._positionY=Ma,na._positionZ=Xa,na._positionX+=aa._positionX,na._positionY+=aa._positionY,na._positionZ+=aa._positionZ;var Za=W._transform,fa=W._localTransform,ba=this._transform,ea,ha,ma,ya,da,pa,Ya,Qa,ga;ea=ba._rotation00*fa._rotation00+ba._rotation01*fa._rotation10+ba._rotation02*fa._rotation20,ha=ba._rotation00*fa._rotation01+ba._rotation01*fa._rotation11+ba._rotation02*fa._rotation21,ma=ba._rotation00*fa._rotation02+ba._rotation01*fa._rotation12+ba._rotation02*fa._rotation22,ya=ba._rotation10*fa._rotation00+ba._rotation11*fa._rotation10+ba._rotation12*fa._rotation20,da=ba._rotation10*fa._rotation01+ba._rotation11*fa._rotation11+ba._rotation12*fa._rotation21,pa=ba._rotation10*fa._rotation02+ba._rotation11*fa._rotation12+ba._rotation12*fa._rotation22,Ya=ba._rotation20*fa._rotation00+ba._rotation21*fa._rotation10+ba._rotation22*fa._rotation20,Qa=ba._rotation20*fa._rotation01+ba._rotation21*fa._rotation11+ba._rotation22*fa._rotation21,ga=ba._rotation20*fa._rotation02+ba._rotation21*fa._rotation12+ba._rotation22*fa._rotation22,Za._rotation00=ea,Za._rotation01=ha,Za._rotation02=ma,Za._rotation10=ya,Za._rotation11=da,Za._rotation12=pa,Za._rotation20=Ya,Za._rotation21=Qa,Za._rotation22=ga;var ua,wa,ka;ua=ba._rotation00*fa._positionX+ba._rotation01*fa._positionY+ba._rotation02*fa._positionZ,wa=ba._rotation10*fa._positionX+ba._rotation11*fa._positionY+ba._rotation12*fa._positionZ,ka=ba._rotation20*fa._positionX+ba._rotation21*fa._positionY+ba._rotation22*fa._positionZ,Za._positionX=ua,Za._positionY=wa,Za._positionZ=ka,Za._positionX+=ba._positionX,Za._positionY+=ba._positionY,Za._positionZ+=ba._positionZ;var Sa,zt,Ha,Ba,nt,Ea;if(W._geom._computeAabb(W._aabb,W._ptransform),Sa=W._aabb._minX,zt=W._aabb._minY,Ha=W._aabb._minZ,Ba=W._aabb._maxX,nt=W._aabb._maxY,Ea=W._aabb._maxZ,W._geom._computeAabb(W._aabb,W._transform),W._aabb._minX=Sa<W._aabb._minX?Sa:W._aabb._minX,W._aabb._minY=zt<W._aabb._minY?zt:W._aabb._minY,W._aabb._minZ=Ha<W._aabb._minZ?Ha:W._aabb._minZ,W._aabb._maxX=Ba>W._aabb._maxX?Ba:W._aabb._maxX,W._aabb._maxY=nt>W._aabb._maxY?nt:W._aabb._maxY,W._aabb._maxZ=Ea>W._aabb._maxZ?Ea:W._aabb._maxZ,W._proxy!=null){var Fa,Aa,ft;Fa=W._transform._positionX-W._ptransform._positionX,Aa=W._transform._positionY-W._ptransform._positionY,ft=W._transform._positionZ-W._ptransform._positionZ;var Wa=W.displacement;Wa.x=Fa,Wa.y=Aa,Wa.z=ft,W._rigidBody._world._broadPhase.moveProxy(W._proxy,W._aabb,W.displacement)}W=q}this._sleeping=!1,this._sleepTime=0}getOrientation(){var a=new x.common.Quat,t,i,r,o,s=this._transform._rotation00,_=this._transform._rotation11,h=this._transform._rotation22,v=s+_+h,e;v>0?(e=Math.sqrt(v+1),o=.5*e,e=.5/e,t=(this._transform._rotation21-this._transform._rotation12)*e,i=(this._transform._rotation02-this._transform._rotation20)*e,r=(this._transform._rotation10-this._transform._rotation01)*e):s>_?s>h?(e=Math.sqrt(s-_-h+1),t=.5*e,e=.5/e,i=(this._transform._rotation01+this._transform._rotation10)*e,r=(this._transform._rotation02+this._transform._rotation20)*e,o=(this._transform._rotation21-this._transform._rotation12)*e):(e=Math.sqrt(h-s-_+1),r=.5*e,e=.5/e,t=(this._transform._rotation02+this._transform._rotation20)*e,i=(this._transform._rotation12+this._transform._rotation21)*e,o=(this._transform._rotation10-this._transform._rotation01)*e):_>h?(e=Math.sqrt(_-h-s+1),i=.5*e,e=.5/e,t=(this._transform._rotation01+this._transform._rotation10)*e,r=(this._transform._rotation12+this._transform._rotation21)*e,o=(this._transform._rotation02-this._transform._rotation20)*e):(e=Math.sqrt(h-s-_+1),r=.5*e,e=.5/e,t=(this._transform._rotation02+this._transform._rotation20)*e,i=(this._transform._rotation12+this._transform._rotation21)*e,o=(this._transform._rotation10-this._transform._rotation01)*e);var l=a;return l.x=t,l.y=i,l.z=r,l.w=o,a}getOrientationTo(a){var t,i,r,o,s=this._transform._rotation00,_=this._transform._rotation11,h=this._transform._rotation22,v=s+_+h,e;v>0?(e=Math.sqrt(v+1),o=.5*e,e=.5/e,t=(this._transform._rotation21-this._transform._rotation12)*e,i=(this._transform._rotation02-this._transform._rotation20)*e,r=(this._transform._rotation10-this._transform._rotation01)*e):s>_?s>h?(e=Math.sqrt(s-_-h+1),t=.5*e,e=.5/e,i=(this._transform._rotation01+this._transform._rotation10)*e,r=(this._transform._rotation02+this._transform._rotation20)*e,o=(this._transform._rotation21-this._transform._rotation12)*e):(e=Math.sqrt(h-s-_+1),r=.5*e,e=.5/e,t=(this._transform._rotation02+this._transform._rotation20)*e,i=(this._transform._rotation12+this._transform._rotation21)*e,o=(this._transform._rotation10-this._transform._rotation01)*e):_>h?(e=Math.sqrt(_-h-s+1),i=.5*e,e=.5/e,t=(this._transform._rotation01+this._transform._rotation10)*e,r=(this._transform._rotation12+this._transform._rotation21)*e,o=(this._transform._rotation02-this._transform._rotation20)*e):(e=Math.sqrt(h-s-_+1),r=.5*e,e=.5/e,t=(this._transform._rotation02+this._transform._rotation20)*e,i=(this._transform._rotation12+this._transform._rotation21)*e,o=(this._transform._rotation10-this._transform._rotation01)*e);var l=a;l.x=t,l.y=i,l.z=r,l.w=o}setOrientation(a){var t,i,r,o,s=a;t=s.x,i=s.y,r=s.z,o=s.w;var _=t,h=i,v=r,e=o,l=2*_,u=2*h,b=2*v,f=_*l,n=h*u,c=v*b,z=_*u,p=h*b,y=_*b,V=e*l,M=e*u,I=e*b;this._transform._rotation00=1-n-c,this._transform._rotation01=z-I,this._transform._rotation02=y+M,this._transform._rotation10=z+I,this._transform._rotation11=1-f-c,this._transform._rotation12=p-V,this._transform._rotation20=y-M,this._transform._rotation21=p+V,this._transform._rotation22=1-f-n;var k,X,L,m,g,N,A,F,P;k=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,X=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,L=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,m=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,g=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,N=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,A=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,F=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,P=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=k,this._invInertia01=X,this._invInertia02=L,this._invInertia10=m,this._invInertia11=g,this._invInertia12=N,this._invInertia20=A,this._invInertia21=F,this._invInertia22=P;var Y,R,C,d,Z,$,K,E,J;Y=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,R=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,C=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,d=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,Z=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,$=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,K=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,E=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,J=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=Y,this._invInertia01=R,this._invInertia02=C,this._invInertia10=d,this._invInertia11=Z,this._invInertia12=$,this._invInertia20=K,this._invInertia21=E,this._invInertia22=J,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var B=this._ptransform,Q=this._transform;B._positionX=Q._positionX,B._positionY=Q._positionY,B._positionZ=Q._positionZ,B._rotation00=Q._rotation00,B._rotation01=Q._rotation01,B._rotation02=Q._rotation02,B._rotation10=Q._rotation10,B._rotation11=Q._rotation11,B._rotation12=Q._rotation12,B._rotation20=Q._rotation20,B._rotation21=Q._rotation21,B._rotation22=Q._rotation22;for(var U=this._shapeList;U!=null;){var G=U._next,D=U._ptransform,H=U._localTransform,j=this._ptransform,ia,sa,W,q,na,oa,aa,T,ca;ia=j._rotation00*H._rotation00+j._rotation01*H._rotation10+j._rotation02*H._rotation20,sa=j._rotation00*H._rotation01+j._rotation01*H._rotation11+j._rotation02*H._rotation21,W=j._rotation00*H._rotation02+j._rotation01*H._rotation12+j._rotation02*H._rotation22,q=j._rotation10*H._rotation00+j._rotation11*H._rotation10+j._rotation12*H._rotation20,na=j._rotation10*H._rotation01+j._rotation11*H._rotation11+j._rotation12*H._rotation21,oa=j._rotation10*H._rotation02+j._rotation11*H._rotation12+j._rotation12*H._rotation22,aa=j._rotation20*H._rotation00+j._rotation21*H._rotation10+j._rotation22*H._rotation20,T=j._rotation20*H._rotation01+j._rotation21*H._rotation11+j._rotation22*H._rotation21,ca=j._rotation20*H._rotation02+j._rotation21*H._rotation12+j._rotation22*H._rotation22,D._rotation00=ia,D._rotation01=sa,D._rotation02=W,D._rotation10=q,D._rotation11=na,D._rotation12=oa,D._rotation20=aa,D._rotation21=T,D._rotation22=ca;var _a,w,ta;_a=j._rotation00*H._positionX+j._rotation01*H._positionY+j._rotation02*H._positionZ,w=j._rotation10*H._positionX+j._rotation11*H._positionY+j._rotation12*H._positionZ,ta=j._rotation20*H._positionX+j._rotation21*H._positionY+j._rotation22*H._positionZ,D._positionX=_a,D._positionY=w,D._positionZ=ta,D._positionX+=j._positionX,D._positionY+=j._positionY,D._positionZ+=j._positionZ;var ra=U._transform,la=U._localTransform,va=this._transform,xa,za,Ma,Xa,Za,fa,ba,ea,ha;xa=va._rotation00*la._rotation00+va._rotation01*la._rotation10+va._rotation02*la._rotation20,za=va._rotation00*la._rotation01+va._rotation01*la._rotation11+va._rotation02*la._rotation21,Ma=va._rotation00*la._rotation02+va._rotation01*la._rotation12+va._rotation02*la._rotation22,Xa=va._rotation10*la._rotation00+va._rotation11*la._rotation10+va._rotation12*la._rotation20,Za=va._rotation10*la._rotation01+va._rotation11*la._rotation11+va._rotation12*la._rotation21,fa=va._rotation10*la._rotation02+va._rotation11*la._rotation12+va._rotation12*la._rotation22,ba=va._rotation20*la._rotation00+va._rotation21*la._rotation10+va._rotation22*la._rotation20,ea=va._rotation20*la._rotation01+va._rotation21*la._rotation11+va._rotation22*la._rotation21,ha=va._rotation20*la._rotation02+va._rotation21*la._rotation12+va._rotation22*la._rotation22,ra._rotation00=xa,ra._rotation01=za,ra._rotation02=Ma,ra._rotation10=Xa,ra._rotation11=Za,ra._rotation12=fa,ra._rotation20=ba,ra._rotation21=ea,ra._rotation22=ha;var ma,ya,da;ma=va._rotation00*la._positionX+va._rotation01*la._positionY+va._rotation02*la._positionZ,ya=va._rotation10*la._positionX+va._rotation11*la._positionY+va._rotation12*la._positionZ,da=va._rotation20*la._positionX+va._rotation21*la._positionY+va._rotation22*la._positionZ,ra._positionX=ma,ra._positionY=ya,ra._positionZ=da,ra._positionX+=va._positionX,ra._positionY+=va._positionY,ra._positionZ+=va._positionZ;var pa,Ya,Qa,ga,ua,wa;if(U._geom._computeAabb(U._aabb,U._ptransform),pa=U._aabb._minX,Ya=U._aabb._minY,Qa=U._aabb._minZ,ga=U._aabb._maxX,ua=U._aabb._maxY,wa=U._aabb._maxZ,U._geom._computeAabb(U._aabb,U._transform),U._aabb._minX=pa<U._aabb._minX?pa:U._aabb._minX,U._aabb._minY=Ya<U._aabb._minY?Ya:U._aabb._minY,U._aabb._minZ=Qa<U._aabb._minZ?Qa:U._aabb._minZ,U._aabb._maxX=ga>U._aabb._maxX?ga:U._aabb._maxX,U._aabb._maxY=ua>U._aabb._maxY?ua:U._aabb._maxY,U._aabb._maxZ=wa>U._aabb._maxZ?wa:U._aabb._maxZ,U._proxy!=null){var ka,Sa,zt;ka=U._transform._positionX-U._ptransform._positionX,Sa=U._transform._positionY-U._ptransform._positionY,zt=U._transform._positionZ-U._ptransform._positionZ;var Ha=U.displacement;Ha.x=ka,Ha.y=Sa,Ha.z=zt,U._rigidBody._world._broadPhase.moveProxy(U._proxy,U._aabb,U.displacement)}U=G}this._sleeping=!1,this._sleepTime=0}getTransform(){var a=this._transform,t=new x.common.Transform;return t._positionX=a._positionX,t._positionY=a._positionY,t._positionZ=a._positionZ,t._rotation00=a._rotation00,t._rotation01=a._rotation01,t._rotation02=a._rotation02,t._rotation10=a._rotation10,t._rotation11=a._rotation11,t._rotation12=a._rotation12,t._rotation20=a._rotation20,t._rotation21=a._rotation21,t._rotation22=a._rotation22,t}getTransformTo(a){var t=this._transform;a._positionX=t._positionX,a._positionY=t._positionY,a._positionZ=t._positionZ,a._rotation00=t._rotation00,a._rotation01=t._rotation01,a._rotation02=t._rotation02,a._rotation10=t._rotation10,a._rotation11=t._rotation11,a._rotation12=t._rotation12,a._rotation20=t._rotation20,a._rotation21=t._rotation21,a._rotation22=t._rotation22}setTransform(a){this._transform._positionX=a._positionX,this._transform._positionY=a._positionY,this._transform._positionZ=a._positionZ,this._transform._rotation00=a._rotation00,this._transform._rotation01=a._rotation01,this._transform._rotation02=a._rotation02,this._transform._rotation10=a._rotation10,this._transform._rotation11=a._rotation11,this._transform._rotation12=a._rotation12,this._transform._rotation20=a._rotation20,this._transform._rotation21=a._rotation21,this._transform._rotation22=a._rotation22;var t,i,r,o,s,_,h,v,e;t=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,i=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,r=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,s=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,_=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,h=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,v=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,e=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=t,this._invInertia01=i,this._invInertia02=r,this._invInertia10=o,this._invInertia11=s,this._invInertia12=_,this._invInertia20=h,this._invInertia21=v,this._invInertia22=e;var l,u,b,f,n,c,z,p,y;l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,u=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,b=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,f=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,n=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,c=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,z=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,p=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,y=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=u,this._invInertia02=b,this._invInertia10=f,this._invInertia11=n,this._invInertia12=c,this._invInertia20=z,this._invInertia21=p,this._invInertia22=y,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var V=this._ptransform,M=this._transform;V._positionX=M._positionX,V._positionY=M._positionY,V._positionZ=M._positionZ,V._rotation00=M._rotation00,V._rotation01=M._rotation01,V._rotation02=M._rotation02,V._rotation10=M._rotation10,V._rotation11=M._rotation11,V._rotation12=M._rotation12,V._rotation20=M._rotation20,V._rotation21=M._rotation21,V._rotation22=M._rotation22;for(var I=this._shapeList;I!=null;){var k=I._next,X=I._ptransform,L=I._localTransform,m=this._ptransform,g,N,A,F,P,Y,R,C,d;g=m._rotation00*L._rotation00+m._rotation01*L._rotation10+m._rotation02*L._rotation20,N=m._rotation00*L._rotation01+m._rotation01*L._rotation11+m._rotation02*L._rotation21,A=m._rotation00*L._rotation02+m._rotation01*L._rotation12+m._rotation02*L._rotation22,F=m._rotation10*L._rotation00+m._rotation11*L._rotation10+m._rotation12*L._rotation20,P=m._rotation10*L._rotation01+m._rotation11*L._rotation11+m._rotation12*L._rotation21,Y=m._rotation10*L._rotation02+m._rotation11*L._rotation12+m._rotation12*L._rotation22,R=m._rotation20*L._rotation00+m._rotation21*L._rotation10+m._rotation22*L._rotation20,C=m._rotation20*L._rotation01+m._rotation21*L._rotation11+m._rotation22*L._rotation21,d=m._rotation20*L._rotation02+m._rotation21*L._rotation12+m._rotation22*L._rotation22,X._rotation00=g,X._rotation01=N,X._rotation02=A,X._rotation10=F,X._rotation11=P,X._rotation12=Y,X._rotation20=R,X._rotation21=C,X._rotation22=d;var Z,$,K;Z=m._rotation00*L._positionX+m._rotation01*L._positionY+m._rotation02*L._positionZ,$=m._rotation10*L._positionX+m._rotation11*L._positionY+m._rotation12*L._positionZ,K=m._rotation20*L._positionX+m._rotation21*L._positionY+m._rotation22*L._positionZ,X._positionX=Z,X._positionY=$,X._positionZ=K,X._positionX+=m._positionX,X._positionY+=m._positionY,X._positionZ+=m._positionZ;var E=I._transform,J=I._localTransform,B=this._transform,Q,U,G,D,H,j,ia,sa,W;Q=B._rotation00*J._rotation00+B._rotation01*J._rotation10+B._rotation02*J._rotation20,U=B._rotation00*J._rotation01+B._rotation01*J._rotation11+B._rotation02*J._rotation21,G=B._rotation00*J._rotation02+B._rotation01*J._rotation12+B._rotation02*J._rotation22,D=B._rotation10*J._rotation00+B._rotation11*J._rotation10+B._rotation12*J._rotation20,H=B._rotation10*J._rotation01+B._rotation11*J._rotation11+B._rotation12*J._rotation21,j=B._rotation10*J._rotation02+B._rotation11*J._rotation12+B._rotation12*J._rotation22,ia=B._rotation20*J._rotation00+B._rotation21*J._rotation10+B._rotation22*J._rotation20,sa=B._rotation20*J._rotation01+B._rotation21*J._rotation11+B._rotation22*J._rotation21,W=B._rotation20*J._rotation02+B._rotation21*J._rotation12+B._rotation22*J._rotation22,E._rotation00=Q,E._rotation01=U,E._rotation02=G,E._rotation10=D,E._rotation11=H,E._rotation12=j,E._rotation20=ia,E._rotation21=sa,E._rotation22=W;var q,na,oa;q=B._rotation00*J._positionX+B._rotation01*J._positionY+B._rotation02*J._positionZ,na=B._rotation10*J._positionX+B._rotation11*J._positionY+B._rotation12*J._positionZ,oa=B._rotation20*J._positionX+B._rotation21*J._positionY+B._rotation22*J._positionZ,E._positionX=q,E._positionY=na,E._positionZ=oa,E._positionX+=B._positionX,E._positionY+=B._positionY,E._positionZ+=B._positionZ;var aa,T,ca,_a,w,ta;if(I._geom._computeAabb(I._aabb,I._ptransform),aa=I._aabb._minX,T=I._aabb._minY,ca=I._aabb._minZ,_a=I._aabb._maxX,w=I._aabb._maxY,ta=I._aabb._maxZ,I._geom._computeAabb(I._aabb,I._transform),I._aabb._minX=aa<I._aabb._minX?aa:I._aabb._minX,I._aabb._minY=T<I._aabb._minY?T:I._aabb._minY,I._aabb._minZ=ca<I._aabb._minZ?ca:I._aabb._minZ,I._aabb._maxX=_a>I._aabb._maxX?_a:I._aabb._maxX,I._aabb._maxY=w>I._aabb._maxY?w:I._aabb._maxY,I._aabb._maxZ=ta>I._aabb._maxZ?ta:I._aabb._maxZ,I._proxy!=null){var ra,la,va;ra=I._transform._positionX-I._ptransform._positionX,la=I._transform._positionY-I._ptransform._positionY,va=I._transform._positionZ-I._ptransform._positionZ;var xa=I.displacement;xa.x=ra,xa.y=la,xa.z=va,I._rigidBody._world._broadPhase.moveProxy(I._proxy,I._aabb,I.displacement)}I=k}this._sleeping=!1,this._sleepTime=0}getMass(){return this._mass}getLocalInertia(){var a=new x.common.Mat3,t=a;return t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22,a}getLocalInertiaTo(a){var t=a;t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22}getMassData(){var a=new x.dynamics.rigidbody.MassData;a.mass=this._mass;var t=a.localInertia;return t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22,a}getMassDataTo(a){a.mass=this._mass;var t=a.localInertia;t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22}setMassData(a){this._mass=a.mass;var t=a.localInertia;this._localInertia00=t.e00,this._localInertia01=t.e01,this._localInertia02=t.e02,this._localInertia10=t.e10,this._localInertia11=t.e11,this._localInertia12=t.e12,this._localInertia20=t.e20,this._localInertia21=t.e21,this._localInertia22=t.e22;var i=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,r=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,o=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,s=this._localInertia00*i-this._localInertia01*r+this._localInertia02*o;if(this._mass>0&&s>0&&this._type==0){this._invMass=1/this._mass;var _=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,h=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,v=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,e=this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21,l=this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20,u=this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20,b=this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11,f=this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10,n=this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10,c=this._localInertia00*_-this._localInertia01*h+this._localInertia02*v;(c<-1e-32||c>1e-32)&&(c=1/c),this._invLocalInertia00=_*c,this._invLocalInertia01=-e*c,this._invLocalInertia02=b*c,this._invLocalInertia10=-h*c,this._invLocalInertia11=l*c,this._invLocalInertia12=-f*c,this._invLocalInertia20=v*c,this._invLocalInertia21=-u*c,this._invLocalInertia22=n*c,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._type==0&&(this._type=1);var z,p,y,V,M,I,k,X,L;z=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,p=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,y=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,V=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,M=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,I=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,k=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,X=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,L=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=z,this._invInertia01=p,this._invInertia02=y,this._invInertia10=V,this._invInertia11=M,this._invInertia12=I,this._invInertia20=k,this._invInertia21=X,this._invInertia22=L;var m,g,N,A,F,P,Y,R,C;m=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,g=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,N=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,A=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,F=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,P=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,Y=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,R=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,C=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=m,this._invInertia01=g,this._invInertia02=N,this._invInertia10=A,this._invInertia11=F,this._invInertia12=P,this._invInertia20=Y,this._invInertia21=R,this._invInertia22=C,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getRotationFactor(){var a=this._rotFactor;return new x.common.Vec3(a.x,a.y,a.z)}setRotationFactor(a){var t=this._rotFactor;t.x=a.x,t.y=a.y,t.z=a.z;var i,r,o,s,_,h,v,e,l;i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,r=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,o=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,s=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,_=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,h=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,v=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,e=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=r,this._invInertia02=o,this._invInertia10=s,this._invInertia11=_,this._invInertia12=h,this._invInertia20=v,this._invInertia21=e,this._invInertia22=l;var u,b,f,n,c,z,p,y,V;u=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,b=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,f=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,n=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,c=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,z=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,p=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,y=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,V=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=u,this._invInertia01=b,this._invInertia02=f,this._invInertia10=n,this._invInertia11=c,this._invInertia12=z,this._invInertia20=p,this._invInertia21=y,this._invInertia22=V,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getLinearVelocity(){var a=new x.common.Vec3,t=a;return t.x=this._velX,t.y=this._velY,t.z=this._velZ,a}getLinearVelocityTo(a){var t=a;t.x=this._velX,t.y=this._velY,t.z=this._velZ}setLinearVelocity(a){if(this._type==1)this._velX=0,this._velY=0,this._velZ=0;else{var t=a;this._velX=t.x,this._velY=t.y,this._velZ=t.z}this._sleeping=!1,this._sleepTime=0}getAngularVelocity(){var a=new x.common.Vec3,t=a;return t.x=this._angVelX,t.y=this._angVelY,t.z=this._angVelZ,a}getAngularVelocityTo(a){var t=a;t.x=this._velX,t.y=this._velY,t.z=this._velZ}setAngularVelocity(a){if(this._type==1)this._angVelX=0,this._angVelY=0,this._angVelZ=0;else{var t=a;this._angVelX=t.x,this._angVelY=t.y,this._angVelZ=t.z}this._sleeping=!1,this._sleepTime=0}addLinearVelocity(a){if(this._type!=1){var t,i,r,o=a;t=o.x,i=o.y,r=o.z,this._velX+=t,this._velY+=i,this._velZ+=r}this._sleeping=!1,this._sleepTime=0}addAngularVelocity(a){if(this._type!=1){var t,i,r,o=a;t=o.x,i=o.y,r=o.z,this._angVelX+=t,this._angVelY+=i,this._angVelZ+=r}this._sleeping=!1,this._sleepTime=0}applyImpulse(a,t){var i,r,o,s=a;i=s.x,r=s.y,o=s.z,this._velX+=i*this._invMass,this._velY+=r*this._invMass,this._velZ+=o*this._invMass;var _,h,v,e,l,u,b=t;e=b.x,l=b.y,u=b.z,e-=this._transform._positionX,l-=this._transform._positionY,u-=this._transform._positionZ,_=l*o-u*r,h=u*i-e*o,v=e*r-l*i;var f,n,c;f=this._invInertia00*_+this._invInertia01*h+this._invInertia02*v,n=this._invInertia10*_+this._invInertia11*h+this._invInertia12*v,c=this._invInertia20*_+this._invInertia21*h+this._invInertia22*v,_=f,h=n,v=c,this._angVelX+=_,this._angVelY+=h,this._angVelZ+=v,this._sleeping=!1,this._sleepTime=0}applyLinearImpulse(a){var t,i,r,o=a;t=o.x,i=o.y,r=o.z,this._velX+=t*this._invMass,this._velY+=i*this._invMass,this._velZ+=r*this._invMass,this._sleeping=!1,this._sleepTime=0}applyAngularImpulse(a){var t,i,r,o=a;t=o.x,i=o.y,r=o.z;var s,_,h;s=this._invInertia00*t+this._invInertia01*i+this._invInertia02*r,_=this._invInertia10*t+this._invInertia11*i+this._invInertia12*r,h=this._invInertia20*t+this._invInertia21*i+this._invInertia22*r,t=s,i=_,r=h,this._angVelX+=t,this._angVelY+=i,this._angVelZ+=r,this._sleeping=!1,this._sleepTime=0}applyForce(a,t){var i,r,o,s=a;i=s.x,r=s.y,o=s.z,this._forceX+=i,this._forceY+=r,this._forceZ+=o;var _,h,v,e,l,u,b=t;e=b.x,l=b.y,u=b.z,e-=this._transform._positionX,l-=this._transform._positionY,u-=this._transform._positionZ,_=l*o-u*r,h=u*i-e*o,v=e*r-l*i,this._torqueX+=_,this._torqueY+=h,this._torqueZ+=v,this._sleeping=!1,this._sleepTime=0}applyForceToCenter(a){var t,i,r,o=a;t=o.x,i=o.y,r=o.z,this._forceX+=t,this._forceY+=i,this._forceZ+=r,this._sleeping=!1,this._sleepTime=0}applyTorque(a){var t,i,r,o=a;t=o.x,i=o.y,r=o.z,this._torqueX+=t,this._torqueY+=i,this._torqueZ+=r,this._sleeping=!1,this._sleepTime=0}getLinearContactImpulse(){var a=new x.common.Vec3,t=a;return t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ,a}getLinearContactImpulseTo(a){var t=a;t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ}getAngularContactImpulse(){var a=new x.common.Vec3,t=a;return t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ,a}getAngularContactImpulseTo(a){var t=a;t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ}getGravityScale(){return this._gravityScale}setGravityScale(a){this._gravityScale=a,this._sleeping=!1,this._sleepTime=0}getLocalPoint(a){var t,i,r,o=a;t=o.x,i=o.y,r=o.z,t-=this._transform._positionX,i-=this._transform._positionY,r-=this._transform._positionZ;var s,_,h;s=this._transform._rotation00*t+this._transform._rotation10*i+this._transform._rotation20*r,_=this._transform._rotation01*t+this._transform._rotation11*i+this._transform._rotation21*r,h=this._transform._rotation02*t+this._transform._rotation12*i+this._transform._rotation22*r,t=s,i=_,r=h;var v=new x.common.Vec3,e=v;return e.x=t,e.y=i,e.z=r,v}getLocalPointTo(a,t){var i,r,o,s=a;i=s.x,r=s.y,o=s.z,i-=this._transform._positionX,r-=this._transform._positionY,o-=this._transform._positionZ;var _,h,v;_=this._transform._rotation00*i+this._transform._rotation10*r+this._transform._rotation20*o,h=this._transform._rotation01*i+this._transform._rotation11*r+this._transform._rotation21*o,v=this._transform._rotation02*i+this._transform._rotation12*r+this._transform._rotation22*o,i=_,r=h,o=v;var e=t;e.x=i,e.y=r,e.z=o}getLocalVector(a){var t,i,r,o=a;t=o.x,i=o.y,r=o.z;var s,_,h;s=this._transform._rotation00*t+this._transform._rotation10*i+this._transform._rotation20*r,_=this._transform._rotation01*t+this._transform._rotation11*i+this._transform._rotation21*r,h=this._transform._rotation02*t+this._transform._rotation12*i+this._transform._rotation22*r,t=s,i=_,r=h;var v=new x.common.Vec3,e=v;return e.x=t,e.y=i,e.z=r,v}getLocalVectorTo(a,t){var i,r,o,s=a;i=s.x,r=s.y,o=s.z;var _,h,v;_=this._transform._rotation00*i+this._transform._rotation10*r+this._transform._rotation20*o,h=this._transform._rotation01*i+this._transform._rotation11*r+this._transform._rotation21*o,v=this._transform._rotation02*i+this._transform._rotation12*r+this._transform._rotation22*o,i=_,r=h,o=v;var e=t;e.x=i,e.y=r,e.z=o}getWorldPoint(a){var t,i,r,o=a;t=o.x,i=o.y,r=o.z;var s,_,h;s=this._transform._rotation00*t+this._transform._rotation01*i+this._transform._rotation02*r,_=this._transform._rotation10*t+this._transform._rotation11*i+this._transform._rotation12*r,h=this._transform._rotation20*t+this._transform._rotation21*i+this._transform._rotation22*r,t=s,i=_,r=h,t+=this._transform._positionX,i+=this._transform._positionY,r+=this._transform._positionZ;var v=new x.common.Vec3,e=v;return e.x=t,e.y=i,e.z=r,v}getWorldPointTo(a,t){var i,r,o,s=a;i=s.x,r=s.y,o=s.z;var _,h,v;_=this._transform._rotation00*i+this._transform._rotation01*r+this._transform._rotation02*o,h=this._transform._rotation10*i+this._transform._rotation11*r+this._transform._rotation12*o,v=this._transform._rotation20*i+this._transform._rotation21*r+this._transform._rotation22*o,i=_,r=h,o=v,i+=this._transform._positionX,r+=this._transform._positionY,o+=this._transform._positionZ;var e=t;e.x=i,e.y=r,e.z=o}getWorldVector(a){var t,i,r,o=a;t=o.x,i=o.y,r=o.z;var s,_,h;s=this._transform._rotation00*t+this._transform._rotation01*i+this._transform._rotation02*r,_=this._transform._rotation10*t+this._transform._rotation11*i+this._transform._rotation12*r,h=this._transform._rotation20*t+this._transform._rotation21*i+this._transform._rotation22*r,t=s,i=_,r=h;var v=new x.common.Vec3,e=v;return e.x=t,e.y=i,e.z=r,v}getWorldVectorTo(a,t){var i,r,o,s=a;i=s.x,r=s.y,o=s.z;var _,h,v;_=this._transform._rotation00*i+this._transform._rotation01*r+this._transform._rotation02*o,h=this._transform._rotation10*i+this._transform._rotation11*r+this._transform._rotation12*o,v=this._transform._rotation20*i+this._transform._rotation21*r+this._transform._rotation22*o,i=_,r=h,o=v;var e=t;e.x=i,e.y=r,e.z=o}getNumShapes(){return this._numShapes}getShapeList(){return this._shapeList}getNumContectLinks(){return this._numContactLinks}getContactLinkList(){return this._contactLinkList}getNumJointLinks(){return this._numJointLinks}getJointLinkList(){return this._jointLinkList}addShape(a){if(this._shapeList==null?(this._shapeList=a,this._shapeListLast=a):(this._shapeListLast._next=a,a._prev=this._shapeListLast,this._shapeListLast=a),this._numShapes++,a._rigidBody=this,this._world!=null){var t=this._world;a._proxy=t._broadPhase.createProxy(a,a._aabb),a._id=t._shapeIdCount++,t._numShapes++}this.updateMass();for(var i=this._shapeList;i!=null;){var r=i._next,o=i._ptransform,s=i._localTransform,_=this._ptransform,h,v,e,l,u,b,f,n,c;h=_._rotation00*s._rotation00+_._rotation01*s._rotation10+_._rotation02*s._rotation20,v=_._rotation00*s._rotation01+_._rotation01*s._rotation11+_._rotation02*s._rotation21,e=_._rotation00*s._rotation02+_._rotation01*s._rotation12+_._rotation02*s._rotation22,l=_._rotation10*s._rotation00+_._rotation11*s._rotation10+_._rotation12*s._rotation20,u=_._rotation10*s._rotation01+_._rotation11*s._rotation11+_._rotation12*s._rotation21,b=_._rotation10*s._rotation02+_._rotation11*s._rotation12+_._rotation12*s._rotation22,f=_._rotation20*s._rotation00+_._rotation21*s._rotation10+_._rotation22*s._rotation20,n=_._rotation20*s._rotation01+_._rotation21*s._rotation11+_._rotation22*s._rotation21,c=_._rotation20*s._rotation02+_._rotation21*s._rotation12+_._rotation22*s._rotation22,o._rotation00=h,o._rotation01=v,o._rotation02=e,o._rotation10=l,o._rotation11=u,o._rotation12=b,o._rotation20=f,o._rotation21=n,o._rotation22=c;var z,p,y;z=_._rotation00*s._positionX+_._rotation01*s._positionY+_._rotation02*s._positionZ,p=_._rotation10*s._positionX+_._rotation11*s._positionY+_._rotation12*s._positionZ,y=_._rotation20*s._positionX+_._rotation21*s._positionY+_._rotation22*s._positionZ,o._positionX=z,o._positionY=p,o._positionZ=y,o._positionX+=_._positionX,o._positionY+=_._positionY,o._positionZ+=_._positionZ;var V=i._transform,M=i._localTransform,I=this._transform,k,X,L,m,g,N,A,F,P;k=I._rotation00*M._rotation00+I._rotation01*M._rotation10+I._rotation02*M._rotation20,X=I._rotation00*M._rotation01+I._rotation01*M._rotation11+I._rotation02*M._rotation21,L=I._rotation00*M._rotation02+I._rotation01*M._rotation12+I._rotation02*M._rotation22,m=I._rotation10*M._rotation00+I._rotation11*M._rotation10+I._rotation12*M._rotation20,g=I._rotation10*M._rotation01+I._rotation11*M._rotation11+I._rotation12*M._rotation21,N=I._rotation10*M._rotation02+I._rotation11*M._rotation12+I._rotation12*M._rotation22,A=I._rotation20*M._rotation00+I._rotation21*M._rotation10+I._rotation22*M._rotation20,F=I._rotation20*M._rotation01+I._rotation21*M._rotation11+I._rotation22*M._rotation21,P=I._rotation20*M._rotation02+I._rotation21*M._rotation12+I._rotation22*M._rotation22,V._rotation00=k,V._rotation01=X,V._rotation02=L,V._rotation10=m,V._rotation11=g,V._rotation12=N,V._rotation20=A,V._rotation21=F,V._rotation22=P;var Y,R,C;Y=I._rotation00*M._positionX+I._rotation01*M._positionY+I._rotation02*M._positionZ,R=I._rotation10*M._positionX+I._rotation11*M._positionY+I._rotation12*M._positionZ,C=I._rotation20*M._positionX+I._rotation21*M._positionY+I._rotation22*M._positionZ,V._positionX=Y,V._positionY=R,V._positionZ=C,V._positionX+=I._positionX,V._positionY+=I._positionY,V._positionZ+=I._positionZ;var d,Z,$,K,E,J;if(i._geom._computeAabb(i._aabb,i._ptransform),d=i._aabb._minX,Z=i._aabb._minY,$=i._aabb._minZ,K=i._aabb._maxX,E=i._aabb._maxY,J=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=d<i._aabb._minX?d:i._aabb._minX,i._aabb._minY=Z<i._aabb._minY?Z:i._aabb._minY,i._aabb._minZ=$<i._aabb._minZ?$:i._aabb._minZ,i._aabb._maxX=K>i._aabb._maxX?K:i._aabb._maxX,i._aabb._maxY=E>i._aabb._maxY?E:i._aabb._maxY,i._aabb._maxZ=J>i._aabb._maxZ?J:i._aabb._maxZ,i._proxy!=null){var B,Q,U;B=i._transform._positionX-i._ptransform._positionX,Q=i._transform._positionY-i._ptransform._positionY,U=i._transform._positionZ-i._ptransform._positionZ;var G=i.displacement;G.x=B,G.y=Q,G.z=U,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=r}}removeShape(a){var t=a._prev,i=a._next;if(t!=null&&(t._next=i),i!=null&&(i._prev=t),a==this._shapeList&&(this._shapeList=this._shapeList._next),a==this._shapeListLast&&(this._shapeListLast=this._shapeListLast._prev),a._next=null,a._prev=null,this._numShapes--,a._rigidBody=null,this._world!=null){var r=this._world;r._broadPhase.destroyProxy(a._proxy),a._proxy=null,a._id=-1;for(var o=a._rigidBody._contactLinkList;o!=null;){var s=o._next,_=o._contact;if(_._s1==a||_._s2==a){var h=o._other;h._sleeping=!1,h._sleepTime=0;var v=r._contactManager,e=_._prev,l=_._next;if(e!=null&&(e._next=l),l!=null&&(l._prev=e),_==v._contactList&&(v._contactList=v._contactList._next),_==v._contactListLast&&(v._contactListLast=v._contactListLast._prev),_._next=null,_._prev=null,_._touching){var u=_._s1._contactCallback,b=_._s2._contactCallback;u==b&&(b=null),u!=null&&u.endContact(_),b!=null&&b.endContact(_)}var f=_._link1._prev,n=_._link1._next;f!=null&&(f._next=n),n!=null&&(n._prev=f),_._link1==_._b1._contactLinkList&&(_._b1._contactLinkList=_._b1._contactLinkList._next),_._link1==_._b1._contactLinkListLast&&(_._b1._contactLinkListLast=_._b1._contactLinkListLast._prev),_._link1._next=null,_._link1._prev=null;var c=_._link2._prev,z=_._link2._next;c!=null&&(c._next=z),z!=null&&(z._prev=c),_._link2==_._b2._contactLinkList&&(_._b2._contactLinkList=_._b2._contactLinkList._next),_._link2==_._b2._contactLinkListLast&&(_._b2._contactLinkListLast=_._b2._contactLinkListLast._prev),_._link2._next=null,_._link2._prev=null,_._b1._numContactLinks--,_._b2._numContactLinks--,_._link1._other=null,_._link2._other=null,_._link1._contact=null,_._link2._contact=null,_._s1=null,_._s2=null,_._b1=null,_._b2=null,_._touching=!1,_._cachedDetectorData._clear(),_._manifold._clear(),_._detector=null;var p=_._contactConstraint;p._s1=null,p._s2=null,p._b1=null,p._b2=null,p._tf1=null,p._tf2=null,_._next=v._contactPool,v._contactPool=_,v._numContacts--}o=s}r._numShapes--}this.updateMass();for(var y=this._shapeList;y!=null;){var V=y._next,M=y._ptransform,I=y._localTransform,k=this._ptransform,X,L,m,g,N,A,F,P,Y;X=k._rotation00*I._rotation00+k._rotation01*I._rotation10+k._rotation02*I._rotation20,L=k._rotation00*I._rotation01+k._rotation01*I._rotation11+k._rotation02*I._rotation21,m=k._rotation00*I._rotation02+k._rotation01*I._rotation12+k._rotation02*I._rotation22,g=k._rotation10*I._rotation00+k._rotation11*I._rotation10+k._rotation12*I._rotation20,N=k._rotation10*I._rotation01+k._rotation11*I._rotation11+k._rotation12*I._rotation21,A=k._rotation10*I._rotation02+k._rotation11*I._rotation12+k._rotation12*I._rotation22,F=k._rotation20*I._rotation00+k._rotation21*I._rotation10+k._rotation22*I._rotation20,P=k._rotation20*I._rotation01+k._rotation21*I._rotation11+k._rotation22*I._rotation21,Y=k._rotation20*I._rotation02+k._rotation21*I._rotation12+k._rotation22*I._rotation22,M._rotation00=X,M._rotation01=L,M._rotation02=m,M._rotation10=g,M._rotation11=N,M._rotation12=A,M._rotation20=F,M._rotation21=P,M._rotation22=Y;var R,C,d;R=k._rotation00*I._positionX+k._rotation01*I._positionY+k._rotation02*I._positionZ,C=k._rotation10*I._positionX+k._rotation11*I._positionY+k._rotation12*I._positionZ,d=k._rotation20*I._positionX+k._rotation21*I._positionY+k._rotation22*I._positionZ,M._positionX=R,M._positionY=C,M._positionZ=d,M._positionX+=k._positionX,M._positionY+=k._positionY,M._positionZ+=k._positionZ;var Z=y._transform,$=y._localTransform,K=this._transform,E,J,B,Q,U,G,D,H,j;E=K._rotation00*$._rotation00+K._rotation01*$._rotation10+K._rotation02*$._rotation20,J=K._rotation00*$._rotation01+K._rotation01*$._rotation11+K._rotation02*$._rotation21,B=K._rotation00*$._rotation02+K._rotation01*$._rotation12+K._rotation02*$._rotation22,Q=K._rotation10*$._rotation00+K._rotation11*$._rotation10+K._rotation12*$._rotation20,U=K._rotation10*$._rotation01+K._rotation11*$._rotation11+K._rotation12*$._rotation21,G=K._rotation10*$._rotation02+K._rotation11*$._rotation12+K._rotation12*$._rotation22,D=K._rotation20*$._rotation00+K._rotation21*$._rotation10+K._rotation22*$._rotation20,H=K._rotation20*$._rotation01+K._rotation21*$._rotation11+K._rotation22*$._rotation21,j=K._rotation20*$._rotation02+K._rotation21*$._rotation12+K._rotation22*$._rotation22,Z._rotation00=E,Z._rotation01=J,Z._rotation02=B,Z._rotation10=Q,Z._rotation11=U,Z._rotation12=G,Z._rotation20=D,Z._rotation21=H,Z._rotation22=j;var ia,sa,W;ia=K._rotation00*$._positionX+K._rotation01*$._positionY+K._rotation02*$._positionZ,sa=K._rotation10*$._positionX+K._rotation11*$._positionY+K._rotation12*$._positionZ,W=K._rotation20*$._positionX+K._rotation21*$._positionY+K._rotation22*$._positionZ,Z._positionX=ia,Z._positionY=sa,Z._positionZ=W,Z._positionX+=K._positionX,Z._positionY+=K._positionY,Z._positionZ+=K._positionZ;var q,na,oa,aa,T,ca;if(y._geom._computeAabb(y._aabb,y._ptransform),q=y._aabb._minX,na=y._aabb._minY,oa=y._aabb._minZ,aa=y._aabb._maxX,T=y._aabb._maxY,ca=y._aabb._maxZ,y._geom._computeAabb(y._aabb,y._transform),y._aabb._minX=q<y._aabb._minX?q:y._aabb._minX,y._aabb._minY=na<y._aabb._minY?na:y._aabb._minY,y._aabb._minZ=oa<y._aabb._minZ?oa:y._aabb._minZ,y._aabb._maxX=aa>y._aabb._maxX?aa:y._aabb._maxX,y._aabb._maxY=T>y._aabb._maxY?T:y._aabb._maxY,y._aabb._maxZ=ca>y._aabb._maxZ?ca:y._aabb._maxZ,y._proxy!=null){var _a,w,ta;_a=y._transform._positionX-y._ptransform._positionX,w=y._transform._positionY-y._ptransform._positionY,ta=y._transform._positionZ-y._ptransform._positionZ;var ra=y.displacement;ra.x=_a,ra.y=w,ra.z=ta,y._rigidBody._world._broadPhase.moveProxy(y._proxy,y._aabb,y.displacement)}y=V}}getType(){return this._type}setType(a){this._type=a,this.updateMass()}wakeUp(){this._sleeping=!1,this._sleepTime=0}sleep(){this._sleeping=!0,this._sleepTime=0}isSleeping(){return this._sleeping}getSleepTime(){return this._sleepTime}setAutoSleep(a){this._autoSleep=a,this._sleeping=!1,this._sleepTime=0}getLinearDamping(){return this._linearDamping}setLinearDamping(a){this._linearDamping=a}getAngularDamping(){return this._angularDamping}setAngularDamping(a){this._angularDamping=a}getPrev(){return this._prev}getNext(){return this._next}};x.dynamics.rigidbody.RigidBodyConfig=class{constructor(){this.position=new x.common.Vec3,this.rotation=new x.common.Mat3,this.linearVelocity=new x.common.Vec3,this.angularVelocity=new x.common.Vec3,this.type=0,this.autoSleep=!0,this.linearDamping=0,this.angularDamping=0}};x.dynamics.rigidbody.RigidBodyType=class{};x.dynamics.rigidbody.Shape=class{constructor(a){this._id=-1,this._localTransform=new x.common.Transform,this._ptransform=new x.common.Transform,this._transform=new x.common.Transform;var t=a.position;this._localTransform._positionX=t.x,this._localTransform._positionY=t.y,this._localTransform._positionZ=t.z;var i=a.rotation;this._localTransform._rotation00=i.e00,this._localTransform._rotation01=i.e01,this._localTransform._rotation02=i.e02,this._localTransform._rotation10=i.e10,this._localTransform._rotation11=i.e11,this._localTransform._rotation12=i.e12,this._localTransform._rotation20=i.e20,this._localTransform._rotation21=i.e21,this._localTransform._rotation22=i.e22;var r=this._ptransform,o=this._localTransform;r._positionX=o._positionX,r._positionY=o._positionY,r._positionZ=o._positionZ,r._rotation00=o._rotation00,r._rotation01=o._rotation01,r._rotation02=o._rotation02,r._rotation10=o._rotation10,r._rotation11=o._rotation11,r._rotation12=o._rotation12,r._rotation20=o._rotation20,r._rotation21=o._rotation21,r._rotation22=o._rotation22;var s=this._transform,_=this._localTransform;s._positionX=_._positionX,s._positionY=_._positionY,s._positionZ=_._positionZ,s._rotation00=_._rotation00,s._rotation01=_._rotation01,s._rotation02=_._rotation02,s._rotation10=_._rotation10,s._rotation11=_._rotation11,s._rotation12=_._rotation12,s._rotation20=_._rotation20,s._rotation21=_._rotation21,s._rotation22=_._rotation22,this._restitution=a.restitution,this._friction=a.friction,this._density=a.density,this._geom=a.geometry,this._collisionGroup=a.collisionGroup,this._collisionMask=a.collisionMask,this._contactCallback=a.contactCallback,this._aabb=new x.collision.geometry.Aabb,this._proxy=null,this.displacement=new x.common.Vec3}getFriction(){return this._friction}setFriction(a){this._friction=a}getRestitution(){return this._restitution}setRestitution(a){this._restitution=a}getLocalTransform(){var a=this._localTransform,t=new x.common.Transform;return t._positionX=a._positionX,t._positionY=a._positionY,t._positionZ=a._positionZ,t._rotation00=a._rotation00,t._rotation01=a._rotation01,t._rotation02=a._rotation02,t._rotation10=a._rotation10,t._rotation11=a._rotation11,t._rotation12=a._rotation12,t._rotation20=a._rotation20,t._rotation21=a._rotation21,t._rotation22=a._rotation22,t}getLocalTransformTo(a){var t=this._localTransform;a._positionX=t._positionX,a._positionY=t._positionY,a._positionZ=t._positionZ,a._rotation00=t._rotation00,a._rotation01=t._rotation01,a._rotation02=t._rotation02,a._rotation10=t._rotation10,a._rotation11=t._rotation11,a._rotation12=t._rotation12,a._rotation20=t._rotation20,a._rotation21=t._rotation21,a._rotation22=t._rotation22}getTransform(){var a=this._transform,t=new x.common.Transform;return t._positionX=a._positionX,t._positionY=a._positionY,t._positionZ=a._positionZ,t._rotation00=a._rotation00,t._rotation01=a._rotation01,t._rotation02=a._rotation02,t._rotation10=a._rotation10,t._rotation11=a._rotation11,t._rotation12=a._rotation12,t._rotation20=a._rotation20,t._rotation21=a._rotation21,t._rotation22=a._rotation22,t}getTransformTo(a){var t=this._transform;a._positionX=t._positionX,a._positionY=t._positionY,a._positionZ=t._positionZ,a._rotation00=t._rotation00,a._rotation01=t._rotation01,a._rotation02=t._rotation02,a._rotation10=t._rotation10,a._rotation11=t._rotation11,a._rotation12=t._rotation12,a._rotation20=t._rotation20,a._rotation21=t._rotation21,a._rotation22=t._rotation22}setLocalTransform(a){var t=this._localTransform;if(t._positionX=a._positionX,t._positionY=a._positionY,t._positionZ=a._positionZ,t._rotation00=a._rotation00,t._rotation01=a._rotation01,t._rotation02=a._rotation02,t._rotation10=a._rotation10,t._rotation11=a._rotation11,t._rotation12=a._rotation12,t._rotation20=a._rotation20,t._rotation21=a._rotation21,t._rotation22=a._rotation22,this._rigidBody!=null){var i=this._rigidBody;i.updateMass();for(var r=i._shapeList;r!=null;){var o=r._next,s=r._ptransform,_=r._localTransform,h=i._ptransform,v,e,l,u,b,f,n,c,z;v=h._rotation00*_._rotation00+h._rotation01*_._rotation10+h._rotation02*_._rotation20,e=h._rotation00*_._rotation01+h._rotation01*_._rotation11+h._rotation02*_._rotation21,l=h._rotation00*_._rotation02+h._rotation01*_._rotation12+h._rotation02*_._rotation22,u=h._rotation10*_._rotation00+h._rotation11*_._rotation10+h._rotation12*_._rotation20,b=h._rotation10*_._rotation01+h._rotation11*_._rotation11+h._rotation12*_._rotation21,f=h._rotation10*_._rotation02+h._rotation11*_._rotation12+h._rotation12*_._rotation22,n=h._rotation20*_._rotation00+h._rotation21*_._rotation10+h._rotation22*_._rotation20,c=h._rotation20*_._rotation01+h._rotation21*_._rotation11+h._rotation22*_._rotation21,z=h._rotation20*_._rotation02+h._rotation21*_._rotation12+h._rotation22*_._rotation22,s._rotation00=v,s._rotation01=e,s._rotation02=l,s._rotation10=u,s._rotation11=b,s._rotation12=f,s._rotation20=n,s._rotation21=c,s._rotation22=z;var p,y,V;p=h._rotation00*_._positionX+h._rotation01*_._positionY+h._rotation02*_._positionZ,y=h._rotation10*_._positionX+h._rotation11*_._positionY+h._rotation12*_._positionZ,V=h._rotation20*_._positionX+h._rotation21*_._positionY+h._rotation22*_._positionZ,s._positionX=p,s._positionY=y,s._positionZ=V,s._positionX+=h._positionX,s._positionY+=h._positionY,s._positionZ+=h._positionZ;var M=r._transform,I=r._localTransform,k=i._transform,X,L,m,g,N,A,F,P,Y;X=k._rotation00*I._rotation00+k._rotation01*I._rotation10+k._rotation02*I._rotation20,L=k._rotation00*I._rotation01+k._rotation01*I._rotation11+k._rotation02*I._rotation21,m=k._rotation00*I._rotation02+k._rotation01*I._rotation12+k._rotation02*I._rotation22,g=k._rotation10*I._rotation00+k._rotation11*I._rotation10+k._rotation12*I._rotation20,N=k._rotation10*I._rotation01+k._rotation11*I._rotation11+k._rotation12*I._rotation21,A=k._rotation10*I._rotation02+k._rotation11*I._rotation12+k._rotation12*I._rotation22,F=k._rotation20*I._rotation00+k._rotation21*I._rotation10+k._rotation22*I._rotation20,P=k._rotation20*I._rotation01+k._rotation21*I._rotation11+k._rotation22*I._rotation21,Y=k._rotation20*I._rotation02+k._rotation21*I._rotation12+k._rotation22*I._rotation22,M._rotation00=X,M._rotation01=L,M._rotation02=m,M._rotation10=g,M._rotation11=N,M._rotation12=A,M._rotation20=F,M._rotation21=P,M._rotation22=Y;var R,C,d;R=k._rotation00*I._positionX+k._rotation01*I._positionY+k._rotation02*I._positionZ,C=k._rotation10*I._positionX+k._rotation11*I._positionY+k._rotation12*I._positionZ,d=k._rotation20*I._positionX+k._rotation21*I._positionY+k._rotation22*I._positionZ,M._positionX=R,M._positionY=C,M._positionZ=d,M._positionX+=k._positionX,M._positionY+=k._positionY,M._positionZ+=k._positionZ;var Z,$,K,E,J,B;if(r._geom._computeAabb(r._aabb,r._ptransform),Z=r._aabb._minX,$=r._aabb._minY,K=r._aabb._minZ,E=r._aabb._maxX,J=r._aabb._maxY,B=r._aabb._maxZ,r._geom._computeAabb(r._aabb,r._transform),r._aabb._minX=Z<r._aabb._minX?Z:r._aabb._minX,r._aabb._minY=$<r._aabb._minY?$:r._aabb._minY,r._aabb._minZ=K<r._aabb._minZ?K:r._aabb._minZ,r._aabb._maxX=E>r._aabb._maxX?E:r._aabb._maxX,r._aabb._maxY=J>r._aabb._maxY?J:r._aabb._maxY,r._aabb._maxZ=B>r._aabb._maxZ?B:r._aabb._maxZ,r._proxy!=null){var Q,U,G;Q=r._transform._positionX-r._ptransform._positionX,U=r._transform._positionY-r._ptransform._positionY,G=r._transform._positionZ-r._ptransform._positionZ;var D=r.displacement;D.x=Q,D.y=U,D.z=G,r._rigidBody._world._broadPhase.moveProxy(r._proxy,r._aabb,r.displacement)}r=o}}}getDensity(){return this._density}setDensity(a){if(this._density=a,this._rigidBody!=null){var t=this._rigidBody;t.updateMass();for(var i=t._shapeList;i!=null;){var r=i._next,o=i._ptransform,s=i._localTransform,_=t._ptransform,h,v,e,l,u,b,f,n,c;h=_._rotation00*s._rotation00+_._rotation01*s._rotation10+_._rotation02*s._rotation20,v=_._rotation00*s._rotation01+_._rotation01*s._rotation11+_._rotation02*s._rotation21,e=_._rotation00*s._rotation02+_._rotation01*s._rotation12+_._rotation02*s._rotation22,l=_._rotation10*s._rotation00+_._rotation11*s._rotation10+_._rotation12*s._rotation20,u=_._rotation10*s._rotation01+_._rotation11*s._rotation11+_._rotation12*s._rotation21,b=_._rotation10*s._rotation02+_._rotation11*s._rotation12+_._rotation12*s._rotation22,f=_._rotation20*s._rotation00+_._rotation21*s._rotation10+_._rotation22*s._rotation20,n=_._rotation20*s._rotation01+_._rotation21*s._rotation11+_._rotation22*s._rotation21,c=_._rotation20*s._rotation02+_._rotation21*s._rotation12+_._rotation22*s._rotation22,o._rotation00=h,o._rotation01=v,o._rotation02=e,o._rotation10=l,o._rotation11=u,o._rotation12=b,o._rotation20=f,o._rotation21=n,o._rotation22=c;var z,p,y;z=_._rotation00*s._positionX+_._rotation01*s._positionY+_._rotation02*s._positionZ,p=_._rotation10*s._positionX+_._rotation11*s._positionY+_._rotation12*s._positionZ,y=_._rotation20*s._positionX+_._rotation21*s._positionY+_._rotation22*s._positionZ,o._positionX=z,o._positionY=p,o._positionZ=y,o._positionX+=_._positionX,o._positionY+=_._positionY,o._positionZ+=_._positionZ;var V=i._transform,M=i._localTransform,I=t._transform,k,X,L,m,g,N,A,F,P;k=I._rotation00*M._rotation00+I._rotation01*M._rotation10+I._rotation02*M._rotation20,X=I._rotation00*M._rotation01+I._rotation01*M._rotation11+I._rotation02*M._rotation21,L=I._rotation00*M._rotation02+I._rotation01*M._rotation12+I._rotation02*M._rotation22,m=I._rotation10*M._rotation00+I._rotation11*M._rotation10+I._rotation12*M._rotation20,g=I._rotation10*M._rotation01+I._rotation11*M._rotation11+I._rotation12*M._rotation21,N=I._rotation10*M._rotation02+I._rotation11*M._rotation12+I._rotation12*M._rotation22,A=I._rotation20*M._rotation00+I._rotation21*M._rotation10+I._rotation22*M._rotation20,F=I._rotation20*M._rotation01+I._rotation21*M._rotation11+I._rotation22*M._rotation21,P=I._rotation20*M._rotation02+I._rotation21*M._rotation12+I._rotation22*M._rotation22,V._rotation00=k,V._rotation01=X,V._rotation02=L,V._rotation10=m,V._rotation11=g,V._rotation12=N,V._rotation20=A,V._rotation21=F,V._rotation22=P;var Y,R,C;Y=I._rotation00*M._positionX+I._rotation01*M._positionY+I._rotation02*M._positionZ,R=I._rotation10*M._positionX+I._rotation11*M._positionY+I._rotation12*M._positionZ,C=I._rotation20*M._positionX+I._rotation21*M._positionY+I._rotation22*M._positionZ,V._positionX=Y,V._positionY=R,V._positionZ=C,V._positionX+=I._positionX,V._positionY+=I._positionY,V._positionZ+=I._positionZ;var d,Z,$,K,E,J;if(i._geom._computeAabb(i._aabb,i._ptransform),d=i._aabb._minX,Z=i._aabb._minY,$=i._aabb._minZ,K=i._aabb._maxX,E=i._aabb._maxY,J=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=d<i._aabb._minX?d:i._aabb._minX,i._aabb._minY=Z<i._aabb._minY?Z:i._aabb._minY,i._aabb._minZ=$<i._aabb._minZ?$:i._aabb._minZ,i._aabb._maxX=K>i._aabb._maxX?K:i._aabb._maxX,i._aabb._maxY=E>i._aabb._maxY?E:i._aabb._maxY,i._aabb._maxZ=J>i._aabb._maxZ?J:i._aabb._maxZ,i._proxy!=null){var B,Q,U;B=i._transform._positionX-i._ptransform._positionX,Q=i._transform._positionY-i._ptransform._positionY,U=i._transform._positionZ-i._ptransform._positionZ;var G=i.displacement;G.x=B,G.y=Q,G.z=U,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=r}}}getAabb(){return this._aabb.clone()}getAabbTo(a){a.copyFrom(this._aabb)}getGeometry(){return this._geom}getRigidBody(){return this._rigidBody}getCollisionGroup(){return this._collisionGroup}setCollisionGroup(a){this._collisionGroup=a}getCollisionMask(){return this._collisionMask}setCollisionMask(a){this._collisionMask=a}getContactCallback(){return this._contactCallback}setContactCallback(a){this._contactCallback=a}getPrev(){return this._prev}getNext(){return this._next}};x.dynamics.rigidbody.ShapeConfig=class{constructor(){this.position=new x.common.Vec3,this.rotation=new x.common.Mat3,this.friction=x.common.Setting.defaultFriction,this.restitution=x.common.Setting.defaultRestitution,this.density=x.common.Setting.defaultDensity,this.collisionGroup=x.common.Setting.defaultCollisionGroup,this.collisionMask=x.common.Setting.defaultCollisionMask,this.geometry=null,this.contactCallback=null}};x.m||(x.m={});x.m.M=class{};x.collision.broadphase.BroadPhaseType._BRUTE_FORCE=1;x.collision.broadphase.BroadPhaseType._BVH=2;x.collision.broadphase.BroadPhaseType.BRUTE_FORCE=1;x.collision.broadphase.BroadPhaseType.BVH=2;x.collision.broadphase.bvh.BvhInsertionStrategy.SIMPLE=0;x.collision.broadphase.bvh.BvhInsertionStrategy.MINIMIZE_SURFACE_AREA=1;x.collision.geometry.GeometryType._SPHERE=0;x.collision.geometry.GeometryType._BOX=1;x.collision.geometry.GeometryType._CYLINDER=2;x.collision.geometry.GeometryType._CONE=3;x.collision.geometry.GeometryType._CAPSULE=4;x.collision.geometry.GeometryType._CONVEX_HULL=5;x.collision.geometry.GeometryType._CONVEX_MIN=0;x.collision.geometry.GeometryType._CONVEX_MAX=5;x.collision.geometry.GeometryType.SPHERE=0;x.collision.geometry.GeometryType.BOX=1;x.collision.geometry.GeometryType.CYLINDER=2;x.collision.geometry.GeometryType.CONE=3;x.collision.geometry.GeometryType.CAPSULE=4;x.collision.geometry.GeometryType.CONVEX_HULL=5;x.collision.narrowphase.detector.BoxBoxDetector.EDGE_BIAS_MULT=1;x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.OK=0;x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.INVALID_TRIANGLE=1;x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_PAIR_INDEX=2;x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_TRIANGLE=3;x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.EDGE_LOOP_BROKEN=4;x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_OUTER_TRIANGLE=5;x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.TRIANGLE_INVISIBLE=6;x.collision.narrowphase.detector.gjkepa.EpaTriangle.count=0;x.common.Vec3.numCreations=0;x.common.Setting.defaultFriction=.2;x.common.Setting.defaultRestitution=.2;x.common.Setting.defaultDensity=1;x.common.Setting.defaultCollisionGroup=1;x.common.Setting.defaultCollisionMask=1;x.common.Setting.maxTranslationPerStep=20;x.common.Setting.maxRotationPerStep=3.14159265358979;x.common.Setting.bvhProxyPadding=.1;x.common.Setting.bvhIncrementalCollisionThreshold=.45;x.common.Setting.defaultGJKMargin=.05;x.common.Setting.enableGJKCaching=!0;x.common.Setting.maxEPAVertices=128;x.common.Setting.maxEPAPolyhedronFaces=128;x.common.Setting.contactEnableBounceThreshold=.5;x.common.Setting.velocityBaumgarte=.2;x.common.Setting.positionSplitImpulseBaumgarte=.4;x.common.Setting.positionNgsBaumgarte=1;x.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold=.05;x.common.Setting.defaultContactPositionCorrectionAlgorithm=0;x.common.Setting.alternativeContactPositionCorrectionAlgorithm=1;x.common.Setting.contactPersistenceThreshold=.05;x.common.Setting.maxManifoldPoints=4;x.common.Setting.defaultJointConstraintSolverType=0;x.common.Setting.defaultJointPositionCorrectionAlgorithm=0;x.common.Setting.jointWarmStartingFactorForBaungarte=.8;x.common.Setting.jointWarmStartingFactor=.95;x.common.Setting.minSpringDamperDampingRatio=1e-6;x.common.Setting.minRagdollMaxSwingAngle=1e-6;x.common.Setting.maxJacobianRows=6;x.common.Setting.directMlcpSolverEps=1e-9;x.common.Setting.islandInitialRigidBodyArraySize=128;x.common.Setting.islandInitialConstraintArraySize=128;x.common.Setting.sleepingVelocityThreshold=.2;x.common.Setting.sleepingAngularVelocityThreshold=.5;x.common.Setting.sleepingTimeThreshold=1;x.common.Setting.disableSleeping=!1;x.common.Setting.linearSlop=.005;x.common.Setting.angularSlop=.017453292519943278;x.collision.narrowphase.detector.gjkepa.GjkEpa.instance=new x.collision.narrowphase.detector.gjkepa.GjkEpa;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState._SUCCEEDED=0;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_FAILED_TO_MAKE_TETRAHEDRON=1;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_DID_NOT_CONVERGE=2;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_INIT=257;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_ADD_VERTEX=258;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_DID_NOT_CONVERGE=259;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED=0;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_FAILED_TO_MAKE_TETRAHEDRON=1;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_DID_NOT_CONVERGE=2;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT=257;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX=258;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE=259;x.common.Mat3.numCreations=0;x.common.Mat4.numCreations=0;x.common.MathUtil.POSITIVE_INFINITY=1/0;x.common.MathUtil.NEGATIVE_INFINITY=-1/0;x.common.MathUtil.PI=3.14159265358979;x.common.MathUtil.TWO_PI=6.28318530717958;x.common.MathUtil.HALF_PI=1.570796326794895;x.common.MathUtil.TO_RADIANS=.017453292519943278;x.common.MathUtil.TO_DEGREES=57.29577951308238;x.common.Quat.numCreations=0;x.dynamics.common.DebugDraw.SPHERE_PHI_DIVISION=8;x.dynamics.common.DebugDraw.SPHERE_THETA_DIVISION=4;x.dynamics.common.DebugDraw.CIRCLE_THETA_DIVISION=8;x.dynamics.common.Performance.broadPhaseCollisionTime=0;x.dynamics.common.Performance.narrowPhaseCollisionTime=0;x.dynamics.common.Performance.dynamicsTime=0;x.dynamics.common.Performance.totalTime=0;x.dynamics.constraint.PositionCorrectionAlgorithm._BAUMGARTE=0;x.dynamics.constraint.PositionCorrectionAlgorithm._SPLIT_IMPULSE=1;x.dynamics.constraint.PositionCorrectionAlgorithm._NGS=2;x.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE=0;x.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE=1;x.dynamics.constraint.PositionCorrectionAlgorithm.NGS=2;x.dynamics.constraint.info.JacobianRow.BIT_LINEAR_SET=1;x.dynamics.constraint.info.JacobianRow.BIT_ANGULAR_SET=2;x.dynamics.constraint.joint.JointType._SPHERICAL=0;x.dynamics.constraint.joint.JointType._REVOLUTE=1;x.dynamics.constraint.joint.JointType._CYLINDRICAL=2;x.dynamics.constraint.joint.JointType._PRISMATIC=3;x.dynamics.constraint.joint.JointType._UNIVERSAL=4;x.dynamics.constraint.joint.JointType._RAGDOLL=5;x.dynamics.constraint.joint.JointType._GENERIC=6;x.dynamics.constraint.joint.JointType.SPHERICAL=0;x.dynamics.constraint.joint.JointType.REVOLUTE=1;x.dynamics.constraint.joint.JointType.CYLINDRICAL=2;x.dynamics.constraint.joint.JointType.PRISMATIC=3;x.dynamics.constraint.joint.JointType.UNIVERSAL=4;x.dynamics.constraint.joint.JointType.RAGDOLL=5;x.dynamics.constraint.joint.JointType.GENERIC=6;x.dynamics.constraint.solver.ConstraintSolverType._ITERATIVE=0;x.dynamics.constraint.solver.ConstraintSolverType._DIRECT=1;x.dynamics.constraint.solver.ConstraintSolverType.ITERATIVE=0;x.dynamics.constraint.solver.ConstraintSolverType.DIRECT=1;x.dynamics.rigidbody.RigidBodyType._DYNAMIC=0;x.dynamics.rigidbody.RigidBodyType._STATIC=1;x.dynamics.rigidbody.RigidBodyType._KINEMATIC=2;x.dynamics.rigidbody.RigidBodyType.DYNAMIC=0;x.dynamics.rigidbody.RigidBodyType.STATIC=1;x.dynamics.rigidbody.RigidBodyType.KINEMATIC=2;x.dynamics.World;x.dynamics.rigidbody.RigidBodyType;x.dynamics.rigidbody.RigidBodyConfig;x.dynamics.rigidbody.RigidBody;x.dynamics.rigidbody.ShapeConfig;x.dynamics.rigidbody.Shape;x.dynamics.constraint.joint.SphericalJointConfig;x.dynamics.constraint.joint.SphericalJoint;x.dynamics.constraint.joint.RevoluteJointConfig;x.dynamics.constraint.joint.RevoluteJoint;x.dynamics.constraint.joint.CylindricalJointConfig;x.dynamics.constraint.joint.CylindricalJoint;x.dynamics.constraint.joint.PrismaticJointConfig;x.dynamics.constraint.joint.PrismaticJoint;x.dynamics.constraint.joint.UniversalJointConfig;x.dynamics.constraint.joint.UniversalJoint;x.dynamics.constraint.joint.RagdollJointConfig;x.dynamics.constraint.joint.RagdollJoint;x.dynamics.constraint.joint.GenericJointConfig;x.dynamics.constraint.joint.GenericJoint;x.dynamics.constraint.joint.JointConfig;x.dynamics.constraint.joint.Joint;x.dynamics.constraint.joint.SpringDamper;x.dynamics.constraint.joint.TranslationalLimitMotor;x.dynamics.constraint.joint.RotationalLimitMotor;x.common.Vec3;x.common.Quat;x.common.Mat3;x.common.MathUtil;x.common.Transform;const UM=x.common.Setting;x.collision.geometry.BoxGeometry;x.collision.geometry.SphereGeometry;x.collision.geometry.ConeGeometry;x.collision.geometry.CylinderGeometry;x.collision.geometry.CapsuleGeometry;x.collision.geometry.ConvexHullGeometry;x.collision.geometry.Geometry;x.dynamics.callback.RayCastClosest;x.dynamics.callback.ContactCallback;UM.defaultGJKMargin=1e-4;x.dynamics.World;x.dynamics.rigidbody.RigidBodyType;x.dynamics.rigidbody.RigidBodyConfig;x.dynamics.rigidbody.RigidBody;x.dynamics.rigidbody.ShapeConfig;x.dynamics.rigidbody.Shape;x.dynamics.constraint.joint.SphericalJointConfig;x.dynamics.constraint.joint.SphericalJoint;x.dynamics.constraint.joint.RevoluteJointConfig;x.dynamics.constraint.joint.RevoluteJoint;x.dynamics.constraint.joint.CylindricalJointConfig;x.dynamics.constraint.joint.CylindricalJoint;x.dynamics.constraint.joint.PrismaticJointConfig;x.dynamics.constraint.joint.PrismaticJoint;x.dynamics.constraint.joint.UniversalJointConfig;x.dynamics.constraint.joint.UniversalJoint;x.dynamics.constraint.joint.RagdollJointConfig;x.dynamics.constraint.joint.RagdollJoint;x.dynamics.constraint.joint.GenericJointConfig;x.dynamics.constraint.joint.GenericJoint;x.dynamics.constraint.joint.Joint;x.common.Vec3;x.common.Quat;const OM=x.common.Setting;x.collision.geometry.BoxGeometry;x.collision.geometry.SphereGeometry;x.collision.geometry.ConeGeometry;x.collision.geometry.CylinderGeometry;x.collision.geometry.CapsuleGeometry;x.collision.geometry.ConvexHullGeometry;x.dynamics.callback.ContactCallback;OM.defaultGJKMargin=1e-4;export{KM as R};
