import{i as e,A as o}from"./3d-tiles-renderer.CbgZh8zU1767066396612.js";import{F as t,_ as a}from"./@tresjs.B1f7s3pS1767066396612.js";import{B as r}from"./three-custom-shader-material.DAA_4JPH1767066396612.js";import{b as n,a as i}from"./tilesCom.vue_vue_type_script_setup_true_lang.miCeX9851767066396612.js";import{ab as s,a as l,ac as p,ad as c}from"./three.BD1hRFgo1767066396612.js";import{U as u,P as m,M as d,T as w,a as g}from"./TerrainMeshProvider.CKffEsKG1767066396612.js";const h=await e("three"),f=e=>{e.onLoadTileSet=o=>{const t=new h.Box3,a=new h.Sphere,r=new h.Matrix4;let n=null,i=0;e.getOrientedBounds(t,r)?(n=(new h.Vector3).setFromMatrixPosition(r),i=n.length()):e.getBoundingSphere(a)&&(n=a.center.clone(),i=n.length());const s=n?.normalize(),l=((e,o)=>{const t=new h.Quaternion,a=(new h.Vector3).crossVectors(e,o);return t.x=a.x,t.y=a.y,t.z=a.z,t.w=1+e.clone().dot(o),t.normalize(),t})(s,new h.Vector3(0,1,0));e.group.quaternion.x=l.x,e.group.quaternion.y=l.y,e.group.quaternion.z=l.z,e.group.quaternion.w=l.w,e.group.position.z=-i}},{defineComponent:v}=await e("vue"),{unref:x,createElementVNode:y,openBlock:B,createElementBlock:b}=await e("vue"),C=["object","rotation"],{watchEffect:M,ref:z}=await e("vue"),S=await e("three"),j=v({__name:"tilesBuildings",props:{bulidingsColor:{default:"#e523ff"},topColor:{default:"#ffff00"},opacity:{default:.8},gradient:{type:Boolean,default:!0},camera:{}},setup(e){const c=e,u=z(0),m=new o("https://jdvop.oss-cn-qingdao.aliyuncs.com/mapv-data/titleset/sz_ns/no.json");m.errorTarget=2,m.addEventListener("load-model",({scene:e})=>{e.traverse(e=>{if(e.isMesh){(e=>{const{geometry:o}=e;o.computeBoundingBox(),o.computeBoundingSphere();const{max:t,min:a}=o.boundingBox,s=new r({baseMaterial:new S.MeshPhongMaterial,vertexShader:i,fragmentShader:n,silent:!0,uniforms:{uMax:{value:t},uMin:{value:a},uBorderWidth:{value:5},uCircleTime:{value:5},uColor:{value:new S.Color(c.bulidingsColor)},uOpacity:{value:c.opacity},uLightColor:{value:new S.Color("#ffffff")},uTopColor:{value:new S.Color(c.topColor)},uTime:u,uGradient:{value:c.gradient}},depthWrite:!0,depthTest:!0,transparent:!0,side:S.DoubleSide});e.material.dispose(),e.material=s})(e),e.receiveShadow=!1,e.castShadow=!1;const o=new S.EdgesGeometry(e.geometry.clone());let t=(new s).fromEdgesGeometry(o),a=new l({color:0,linewidth:1,opacity:1,transparent:!0,depthWrite:!0,depthTest:!0});a.resolution.set(window.innerWidth,window.innerHeight);const m=new p(t,a);m.applyMatrix4(e.matrix.clone()),e.parent.add(m)}});const o=new S.Box3,t=new S.Sphere;m.getBoundingBox(o)?(o.getCenter(m.group.position),m.group.position.multiplyScalar(-1)):m.getBoundingSphere(t)&&(m.group.position.copy(t.center),m.group.position.multiplyScalar(-1))}),f(m);const{renderer:d,sizes:w}=t();M(()=>{w.width.value&&(m.setCamera(c.camera),m.setResolutionFromRenderer(c.camera,d))});const{onBeforeRender:g}=a();return g(({delta:e})=>{u.value+=2*e,c.camera&&w.width.value&&(c.camera.updateMatrixWorld(),m.update())}),(e,o)=>(B(),b("TresGroup",null,[y("primitive",{object:x(m).group,rotation:[-Math.PI/2,0,0]},null,8,C)]))}}),{defineComponent:_}=await e("vue"),{unref:T,openBlock:E,createElementBlock:P}=await e("vue"),V=["object","rotation"],k=await e("three"),{watchEffect:W}=await e("vue"),q=_({__name:"tileMapBuildingsMesh",props:{bbox:{default:[104.955976,20.149765,120.998419,30.528687]},maxZoom:{default:20},mapCenter:{},camera:{}},setup(e,{expose:o}){const r=e,{renderer:n,scene:i}=t(),s=new m;s.coordType=u;const l=new d;l.source="https://webrd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",l.showTileNo=!1,l.useWorker=!0;const p=new w(s,l);p.showBoundingBox=!1,p.wireframe=!1,p.flatShading=!1,p.filter={opposite:!0,genBright:1.3,genContrast:1,genSaturation:1};let h=new k.Color("#4688b5");p.filter.monochrome={r:h.r,g:h.g,b:h.b};const f=new g;f.provider=p,f.bbox=r.bbox,f.maxZoom=r.maxZoom,r.camera.up=new k.Vector3(0,1,0),r.camera.position.set(r.mapCenter[0],r.mapCenter[2],2e3-r.mapCenter[1]),r.camera.lookAt(new k.Vector3(r.camera.position.x,0,r.camera.position.z-3e3)),f.camera=r.camera;let v=null;W(()=>{n&&(v=new c(r.camera,n.domElement),v.enableDamping=!0,v.dampingFactor=.05,v.minDistance=600,v.position0.set(r.camera.position.x,r.camera.position.y,r.camera.position.z),v.target.set(r.camera.position.x,0,r.camera.position.z-2e3))});const{onBeforeRender:x}=a();return x(()=>{if(n){const e=50*Math.abs(r.camera.position.y);r.camera.far=e+5e3,r.camera.updateProjectionMatrix(),v&&(v.update(),v.target.y=0),f.update(),n.render(i.value,r.camera)}}),o({camera:r.camera,map:f}),(e,o)=>(E(),P("primitive",{object:T(f),rotation:[-Math.PI/2,0,0]},null,8,V))}});export{j as _,q as a};
