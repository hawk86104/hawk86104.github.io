import{importShared as u}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{_sfc_main as de}from"./pagesShow.vue_vue_type_script_setup_true_lang.Crq63Xp41767148983502.js";import{_l as ye}from"./index.DTe2qqjO1767148983502.js";const l=await u("three"),_e=({startFrame:A,endFrame:h,fps:w,frameName:n,textureDataURL:x,textureImageURL:V,loop:q,numberOfFrames:z,autoPlay:Me,animationNames:Q,onStart:b,onEnd:De,onLoopEnd:E,onFrame:H,play:Z,pause:C,flipX:N,alphaTest:I,asSprite:ee})=>{let f={frames:[],meta:{version:"1.0",size:{w:1,h:1},scale:"1"}},v=new l.Texture;const F=new l.SpriteMaterial({toneMapped:!1,transparent:!0,map:v,alphaTest:I}),O=new l.MeshBasicMaterial({toneMapped:!1,side:l.DoubleSide,map:v,transparent:!0,alphaTest:I}),y=new l.Sprite(F),R=new l.Mesh(new l.PlaneGeometry(1,1),O);let o=F,d=y;const m=new l.Group;m.add(d);let L=window.performance.now(),p=0,k=n||"";const W=1e3/w,te=e=>{v=e,o&&(o.map=e)},re=new l.Vector3(1,1,1),se=e=>{re.copy(e)},Y=N?-1:1;let B=ee;(e=>{B=e,B?(o=F,d=y,m.add(y),m.remove(R)):(o=O,d=R,m.remove(y),m.add(R))})(B);async function ae(e,t,s){const r=new l.TextureLoader,i=fetch(e).then(a=>a.json()),c=new Promise(a=>{r.load(t,a)});await Promise.all([i,c]).then(a=>{s(a[0],a[1])})}const $=(e,t)=>{const s=t/e;return d.scale.set(1,s,1),d.scale},ne=async()=>{await ae(x,V,le)},oe=e=>{n=e,k!==n&&n&&(p=0,k=n)},ie=()=>{C=!0},ce=()=>{Z=!0,C=!1},le=(e,t)=>{if(e===null){if(t&&z){const s=t.image.width,r=t.image.height,i=s/z,c=r;if(f={frames:[],meta:{version:"1.0",size:{w:s,h:r},scale:"1"}},parseInt(i.toString(),10)===i)for(let a=0;a<z;a++)f.frames.push({frame:{x:a*i,y:0,w:i,h:c},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:i,h:c},sourceSize:{w:i,h:r}})}}else if(t){f=e,f.frames=Array.isArray(e.frames)?e.frames:fe();const{w:s,h:r}=T(e.frames).sourceSize,i=$(s,r);se(i),o&&(o.map=t)}t.premultiplyAlpha=!1,te(t),pe()},fe=()=>{const e={},t=f,s=Q;if(s)for(let r=0;r<s.length;r++){e[s[r]]=[];for(const i in t.frames){const c=t.frames[i],a=c.frame,_=a.x,S=a.y,M=a.w,D=a.h,P=c.sourceSize.w,g=c.sourceSize.h;typeof i=="string"&&i.toLowerCase().indexOf(s[r].toLowerCase())!==-1&&e[s[r]].push({x:_,y:S,w:M,h:D,frame:a,sourceSize:{w:P,h:g}})}}return e},pe=()=>{if(!(f&&o.map))return;const{meta:{size:e},frames:t}=f,{w:s,h:r}=Array.isArray(t)?t[0].sourceSize:n?t[n]?t[n][0].sourceSize:{w:0,h:0}:{w:0,h:0};o.map.wrapS=o.map.wrapT=l.RepeatWrapping,o.map.center.set(0,0),o.map.repeat.set(1*Y/(e.w/s),1/(e.h/r));const c=1/((e.h-1)/r);o.map.offset.x=0,o.map.offset.y=1-c,b&&b({currentFrameName:n,currentFrame:p})},me=()=>{if(!(f&&o.map))return;const e=window.performance.now(),t=e-L,{meta:{size:s},frames:r}=f,{w:i,h:c}=T(r).sourceSize,a=Array.isArray(r)?r:n?r[n]:[];let _=0,S=0;const M=h||a.length-1;if(p>M&&(p=A,E?.({currentFrameName:n,currentFrame:p})),t<=W)return;L=e-t%W,$(i,c);const D=(s.w-1)/i,P=(s.h-1)/c,{frame:{x:g,y:he},sourceSize:{w:X,h:we}}=a[p],j=1/D,G=1/P;_=Y>0?j*(g/X):j*(g/X)-o.map.repeat.x,S=Math.abs(1-G)-G*(he/we),o.map.offset.x=_,o.map.offset.y=S,p+=1},ue=()=>{var e,t;!((e=f)!=null&&e.frames)||!((t=o)!=null&&t.map)||C||(me(),H&&H({currentFrameName:k,currentFrame:p}))},T=e=>{if(Array.isArray(e))return e[0];if(typeof e=="object"&&e!==null){const t=Object.keys(e);return e[t[0]][0]}else return{w:0,h:0}};return{group:m,init:ne,update:ue,playAnimation:ce,pauseAnimation:ie,setFrameName:oe}},{withAsyncContext:Se,defineComponent:ge}=await u("vue"),{unref:Ae,openBlock:xe,createElementBlock:ze}=await u("vue"),Ce=["object"],ve=await u("three"),Fe=ge({__name:"fireC",async setup(A){let h,w;const n=_e({startFrame:0,fps:40,autoPlay:!0,loop:!0,textureImageURL:"./plugins/digitalCity/image/spriteAnimator/flame.png",textureDataURL:"./plugins/digitalCity/image/spriteAnimator/flame.json",alphaTest:.101,asSprite:!0});[h,w]=Se(()=>n.init()),await h,w(),n.group.children[0].material.map.colorSpace=ve.SRGBColorSpace,n.group.children[0].geometry.translate(0,.344,0);const{onBeforeRender:x}=ye();return x(()=>{n.update()}),(V,q)=>(xe(),ze("primitive",{object:Ae(n).group,renderOrder:9999},null,8,Ce))}}),{defineComponent:Re}=await u("vue"),{createVNode:ke,Suspense:Be,withCtx:U,openBlock:J,createBlock:K}=await u("vue"),He=Re({__name:"fireC",setup(A){return(h,w)=>(J(),K(de,null,{ability:U(()=>[(J(),K(Be,null,{default:U(()=>[ke(Fe,{position:[10,30,0],scale:100})]),_:1}))]),_:1}))}});export{He as default};
