import{importShared as a}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{Fs as S,rz as b}from"./index.DTe2qqjO1767148983502.js";import{Reflector as x,ReflectorMaterial as B}from"./OimoPhysicsController.C1pzCmuS1767148983502.js";import{fixSpritesForMirror as u}from"./utils.sbhH34FI1767148983502.js";const{defineComponent:j}=await a("vue"),{unref:f,createElementVNode:p,openBlock:C,createElementBlock:G,createCommentVNode:R}=await a("vue"),k={key:0},E=["object"],H=["object"],{Vector2:V,PlaneGeometry:N,Mesh:F,RepeatWrapping:l,Color:d,GridHelper:P}=await a("three"),{watchEffect:U,watch:h}=await a("vue"),W=j({__name:"reflectorShaderMesh",props:{reflectivity:{default:.2},mirror:{default:.1},mixStrength:{default:9},showGridHelper:{type:Boolean,default:!0},color:{default:"#ffffff"}},setup(_){const e=_,{scene:w}=S(),{textures:g,isLoading:m}=b(["./plugins/floor/image/concrete_wet_floor_basecolor.jpg","./plugins/floor/image/concrete_wet_floor_normal.jpg"]);let r=null,t=null,i=null;return h([g,m],([o,s])=>{if(o&&o.length===2&&!s){o[0].wrapS=l,o[0].wrapT=l,o[1].wrapS=l,o[1].wrapT=l;const n=new x;r=new B({reflectivity:e.reflectivity,mirror:e.mirror,mixStrength:e.mixStrength,color:new d(e.color),map:o[0],normalMap:o[1],normalScale:new V(5,5),fog:w.value.fog,dithering:!0}),r.uniforms.tReflect=n.renderTargetUniform,r.uniforms.uMatrix=n.textureMatrixUniform;const v=new N(10,10);t=new F(v,r),t.name="reflectorShaderMesh",t.position.y=-.01,t.rotation.x=-Math.PI/2,t.add(n),t.onBeforeRender=(y,c,M)=>{t.visible=!1,u(c),n.update(y,c,M),u(c,!1),t.visible=!0},i=new P(9.5,10),i.visible=e.showGridHelper}}),U(()=>{e.reflectivity&&r&&(r.uniforms.uReflectivity.value=e.reflectivity),e.mirror&&r&&(r.uniforms.uMirror.value=e.mirror),e.mixStrength&&r&&(r.uniforms.uMixStrength.value=e.mixStrength),e.color&&r&&(r.uniforms.uColor.value=new d(e.color))}),h(()=>e.showGridHelper,o=>{i.visible=o}),(o,s)=>f(m)?R("",!0):(C(),G("TresGroup",k,[p("primitive",{object:f(t)},null,8,E),p("primitive",{object:f(i),position:[0,.01,0]},null,8,H)]))}});export{W as _sfc_main};
