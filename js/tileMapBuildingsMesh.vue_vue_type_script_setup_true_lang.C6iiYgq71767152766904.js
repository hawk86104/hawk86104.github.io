import{importShared as e,Ai as o}from"./3d-tiles-renderer.CPyPbRB51767152766904.js";import{useTres as t,useLoop as r}from"./index.BGo9PN8R1767152766904.js";import{B as a}from"./three-custom-shader-material.es.BQ3BFm2M1767152766904.js";import{buildingsShaderMaterial_default as n,buildingsShaderMaterial_default$1 as i}from"./tilesCom.vue_vue_type_script_setup_true_lang.CAm-wo0Z1767152766904.js";import{LineSegmentsGeometry as s,LineMaterial as l,LineSegments2 as p}from"./LineSegments2.D7q7jdy-1767152766904.js";import{OrbitControls as c}from"./OrbitControls.BdInhhmQ1767152766904.js";import{UTM as m,PlaneProvider as u,MapProvider as d,TerrainMeshProvider as g,Map as w}from"./TerrainMeshProvider.t5UQMIKv1767152766904.js";const f=await e("three"),h=e=>{e.onLoadTileSet=o=>{const t=new f.Box3,r=new f.Sphere,a=new f.Matrix4;let n=null,i=0;e.getOrientedBounds(t,a)?(n=(new f.Vector3).setFromMatrixPosition(a),i=n.length()):e.getBoundingSphere(r)&&(n=r.center.clone(),i=n.length());const s=n?.normalize(),l=((e,o)=>{const t=new f.Quaternion,r=(new f.Vector3).crossVectors(e,o);return t.x=r.x,t.y=r.y,t.z=r.z,t.w=1+e.clone().dot(o),t.normalize(),t})(s,new f.Vector3(0,1,0));e.group.quaternion.x=l.x,e.group.quaternion.y=l.y,e.group.quaternion.z=l.z,e.group.quaternion.w=l.w,e.group.position.z=-i}},{defineComponent:x}=await e("vue"),{unref:v,createElementVNode:y,openBlock:B,createElementBlock:b}=await e("vue"),C=["object","rotation"],{watchEffect:M,ref:z}=await e("vue"),S=await e("three"),_=x({__name:"tilesBuildings",props:{bulidingsColor:{default:"#e523ff"},topColor:{default:"#ffff00"},opacity:{default:.8},gradient:{type:Boolean,default:!0},camera:{}},setup(e){const c=e,m=z(0),u=new o("https://jdvop.oss-cn-qingdao.aliyuncs.com/mapv-data/titleset/sz_ns/no.json");u.errorTarget=2,u.addEventListener("load-model",({scene:e})=>{e.traverse(e=>{if(e.isMesh){(e=>{const{geometry:o}=e;o.computeBoundingBox(),o.computeBoundingSphere();const{max:t,min:r}=o.boundingBox,s=new a({baseMaterial:new S.MeshPhongMaterial,vertexShader:i,fragmentShader:n,silent:!0,uniforms:{uMax:{value:t},uMin:{value:r},uBorderWidth:{value:5},uCircleTime:{value:5},uColor:{value:new S.Color(c.bulidingsColor)},uOpacity:{value:c.opacity},uLightColor:{value:new S.Color("#ffffff")},uTopColor:{value:new S.Color(c.topColor)},uTime:m,uGradient:{value:c.gradient}},depthWrite:!0,depthTest:!0,transparent:!0,side:S.DoubleSide});e.material.dispose(),e.material=s})(e),e.receiveShadow=!1,e.castShadow=!1;const o=new S.EdgesGeometry(e.geometry.clone());let t=(new s).fromEdgesGeometry(o),r=new l({color:0,linewidth:1,opacity:1,transparent:!0,depthWrite:!0,depthTest:!0});r.resolution.set(window.innerWidth,window.innerHeight);const u=new p(t,r);u.applyMatrix4(e.matrix.clone()),e.parent.add(u)}});const o=new S.Box3,t=new S.Sphere;u.getBoundingBox(o)?(o.getCenter(u.group.position),u.group.position.multiplyScalar(-1)):u.getBoundingSphere(t)&&(u.group.position.copy(t.center),u.group.position.multiplyScalar(-1))}),h(u);const{renderer:d,sizes:g}=t();M(()=>{g.width.value&&(u.setCamera(c.camera),u.setResolutionFromRenderer(c.camera,d))});const{onBeforeRender:w}=r();return w(({delta:e})=>{m.value+=2*e,c.camera&&g.width.value&&(c.camera.updateMatrixWorld(),u.update())}),(e,o)=>(B(),b("TresGroup",null,[y("primitive",{object:v(u).group,rotation:[-Math.PI/2,0,0]},null,8,C)]))}}),{defineComponent:j}=await e("vue"),{unref:T,openBlock:E,createElementBlock:V}=await e("vue"),k=["object","rotation"],P=await e("three"),{watchEffect:W}=await e("vue"),q=j({__name:"tileMapBuildingsMesh",props:{bbox:{default:[104.955976,20.149765,120.998419,30.528687]},maxZoom:{default:20},mapCenter:{},camera:{}},setup(e,{expose:o}){const a=e,{renderer:n,scene:i}=t(),s=new u;s.coordType=m;const l=new d;l.source="https://webrd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",l.showTileNo=!1,l.useWorker=!0;const p=new g(s,l);p.showBoundingBox=!1,p.wireframe=!1,p.flatShading=!1,p.filter={opposite:!0,genBright:1.3,genContrast:1,genSaturation:1};let f=new P.Color("#4688b5");p.filter.monochrome={r:f.r,g:f.g,b:f.b};const h=new w;h.provider=p,h.bbox=a.bbox,h.maxZoom=a.maxZoom,a.camera.up=new P.Vector3(0,1,0),a.camera.position.set(a.mapCenter[0],a.mapCenter[2],2e3-a.mapCenter[1]),a.camera.lookAt(new P.Vector3(a.camera.position.x,0,a.camera.position.z-3e3)),h.camera=a.camera;let x=null;W(()=>{n&&(x=new c(a.camera,n.domElement),x.enableDamping=!0,x.dampingFactor=.05,x.minDistance=600,x.position0.set(a.camera.position.x,a.camera.position.y,a.camera.position.z),x.target.set(a.camera.position.x,0,a.camera.position.z-2e3))});const{onBeforeRender:v}=r();return v(()=>{if(n){const e=50*Math.abs(a.camera.position.y);a.camera.far=e+5e3,a.camera.updateProjectionMatrix(),x&&(x.update(),x.target.y=0),h.update(),n.render(i.value,a.camera)}}),o({camera:a.camera,map:h}),(e,o)=>(E(),V("primitive",{object:T(h),rotation:[-Math.PI/2,0,0]},null,8,k))}});export{_ as _sfc_main,q as _sfc_main$1};
