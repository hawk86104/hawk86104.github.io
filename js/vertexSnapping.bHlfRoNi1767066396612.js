import{i as t}from"./3d-tiles-renderer.CbgZh8zU1767066396612.js";import{N as n,a as e,K as o}from"./@tresjs.B1f7s3pS1767066396612.js";import{_ as i,a}from"./customShaderMaterial.vue_vue_type_script_setup_true_lang.DS9PWjZT1767066396612.js";import"./index.vue_vue_type_script_setup_true_lang.iYOGhvYh1767066396612.js";import{P as s}from"./tweakpane.CqZAnw7f1767066396612.js";const{defineComponent:r}=await t("vue"),{openBlock:u,createElementBlock:l}=await t("vue"),p=["object"],c=await t("three"),{toRef:m,watch:d}=await t("vue"),v=r({__name:"com",props:{uSnappingResolution:{default:6},srcMaterial:{default:()=>new c.MeshStandardMaterial({color:65280,roughness:.5,metalness:.5})}},setup(t){const n=t,e=m(n.uSnappingResolution);return n.srcMaterial.onBeforeCompile=t=>{t.uniforms.uSnappingResolution=e,t.vertexShader=t.vertexShader.replace("#include <common>","\n\t\t\t#include <common>\n\t\t\tuniform float uSnappingResolution;\n\t"),t.vertexShader=t.vertexShader.replace("#include <project_vertex>","\n\t\t\tvec4 mvPosition = vec4( transformed, 1.0 );\n\n\t\t\t#ifdef USE_BATCHING\n\t\t\t\tmvPosition = batchingMatrix * mvPosition;\n\t\t\t#endif\n\n\t\t\t#ifdef USE_INSTANCING\n\t\t\t\tmvPosition = instanceMatrix * mvPosition;\n\t\t\t#endif\n\n\t\t\tmvPosition = modelMatrix * mvPosition;\n\n\t\t\tmvPosition = vec4(\n\t\t\t\tround(mvPosition.x * uSnappingResolution) / uSnappingResolution,\n\t\t\t\tround(mvPosition.y * uSnappingResolution) / uSnappingResolution,\n\t\t\t\tround(mvPosition.z * uSnappingResolution) / uSnappingResolution,\n\t\t\t\t1.0);\n\t\t\tmvPosition = viewMatrix * mvPosition;\n\t\t\tgl_Position = projectionMatrix * mvPosition;\n\t")},d(()=>n.uSnappingResolution,t=>{e.value=t}),(t,n)=>(u(),l("primitive",{object:t.srcMaterial},null,8,p))}});const{defineComponent:g}=await t("vue"),{unref:S,openBlock:f,createElementBlock:P,createCommentVNode:h}=await t("vue"),R=["object"],{watch:x}=await t("vue"),_=g({__name:"model",props:{uSnappingResolution:{default:6}},setup(t){const e=t,{state:o,materials:i}=n("https://opensource.cdn.icegl.cn/model/industry4/MRBike.glb",{draco:!0,decoderPath:"./draco/"}),a=[];return x(()=>o.value,t=>{t?.scene&&Object.values(i.value).forEach(t=>{a.push(function(t,n=6){const e={value:n};return t.onBeforeCompile=t=>{t.uniforms.uSnappingResolution=e,t.vertexShader=t.vertexShader.replace("#include <common>","\n\t\t\t\t#include <common>\n\t\t\t\tuniform float uSnappingResolution;\n\t\t"),t.vertexShader=t.vertexShader.replace("#include <project_vertex>","\n\t\t\t\tvec4 mvPosition = vec4( transformed, 1.0 );\n\t\n\t\t\t\t#ifdef USE_BATCHING\n\t\t\t\t\tmvPosition = batchingMatrix * mvPosition;\n\t\t\t\t#endif\n\t\n\t\t\t\t#ifdef USE_INSTANCING\n\t\t\t\t\tmvPosition = instanceMatrix * mvPosition;\n\t\t\t\t#endif\n\t\n\t\t\t\tmvPosition = modelMatrix * mvPosition;\n\t\n\t\t\t\tmvPosition = vec4(\n\t\t\t\t\tround(mvPosition.x * uSnappingResolution) / uSnappingResolution,\n\t\t\t\t\tround(mvPosition.y * uSnappingResolution) / uSnappingResolution,\n\t\t\t\t\tround(mvPosition.z * uSnappingResolution) / uSnappingResolution,\n\t\t\t\t\t1.0);\n\t\t\t\tmvPosition = viewMatrix * mvPosition;\n\t\t\t\tgl_Position = projectionMatrix * mvPosition;\n\t\t")},e}(t,e.uSnappingResolution))})}),x(()=>e.uSnappingResolution,t=>{a.forEach(n=>{n.value=t})}),(t,n)=>S(o)?(f(),P("primitive",{key:0,object:S(o)?.scene,scale:5,position:[0,-2,0]},null,8,R)):h("",!0)}}),{defineComponent:M}=await t("vue"),{createElementVNode:w,unref:y,createVNode:j,Suspense:C,withCtx:b,openBlock:T,createBlock:B,mergeProps:N}=await t("vue"),k={position:[5,.9,-5],name:"torus"},{ACESFilmicToneMapping:E}=await t("three"),{reactive:I}=await t("vue"),A=M({__name:"vertexSnapping",setup(t){const n=I({alpha:!0,toneMapping:E,windowSize:!0,clearColor:"#000000"}),r=I({uSnappingResolution:3,modelSnappingResolution:6}),u=new s;return u.addBinding(r,"uSnappingResolution",{label:"圆环扭结-分辨率",min:0,max:20,step:.01}),u.addBinding(r,"modelSnappingResolution",{label:"自行车模型-分辨率",min:0,max:20,step:.01}),(t,s)=>(T(),B(y(e),N(n,{"window-size":""}),{default:b(()=>[s[1]||(s[1]=w("TresPerspectiveCamera",{position:[8,6,8],fov:45,near:1,far:1e3},null,-1)),j(y(o)),s[2]||(s[2]=w("TresAmbientLight",{intensity:.5},null,-1)),s[3]||(s[3]=w("TresDirectionalLight",{position:[7,10,-5.5],intensity:5},null,-1)),s[4]||(s[4]=w("TresMesh",{position:[-5,.5,5],"receive-shadow":"","cast-shadow":"",name:"cube"},[w("TresCylinderGeometry",{args:[1.5,1.5,2]}),w("TresMeshStandardMaterial",{color:16737826,roughness:0,metalness:0})],-1)),w("TresMesh",k,[s[0]||(s[0]=w("TresTorusKnotGeometry",{args:[1,.35,100,32]},null,-1)),j(v,{uSnappingResolution:r.uSnappingResolution},null,8,["uSnappingResolution"])]),(T(),B(C,null,{default:b(()=>[j(_,{uSnappingResolution:r.modelSnappingResolution},null,8,["uSnappingResolution"])]),_:1})),(T(),B(C,null,{default:b(()=>[j(y(i),{resolution:256,blur:1,background:""},{default:b(()=>[j(y(a),{intensity:2,form:"circle","rotation-x":Math.PI/2,position:[2,4,0],scale:[1,5,0]},null,8,["rotation-x"]),j(y(a),{intensity:2,form:"circle","rotation-x":Math.PI/2,position:[-6,4,0],scale:[1,5,0]},null,8,["rotation-x"]),j(y(a),{intensity:1,"rotation-y":-Math.PI/2,position:[-1,0,0],scale:[10,.2,1]},null,8,["rotation-y"]),j(y(a),{intensity:1,"rotation-y":-Math.PI/2,position:[1,0,0],scale:[10,.2,1]},null,8,["rotation-y"])]),_:1})]),_:1}))]),_:1},16))}});export{A as default};
