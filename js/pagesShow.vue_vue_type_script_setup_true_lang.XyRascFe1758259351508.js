import{a3 as e,C as a,aC as o,cP as t,cB as l,cQ as r,n as i,N as n,_ as s,co as u}from"./three.CtgP63ME1758259351508.js";import{C as d,e as p,a as c}from"./@tresjs.CywMBpUh1758259351508.js";import{z as m}from"./three-custom-shader-material.gu_n-VhD1758259351508.js";import{b as f,a as y}from"./buildingsCustomShaderMaterial.DyBo--wu1758259351508.js";import{d as h,b as w,a2 as g,w as v,G as C,o as b,u as B,r as x,aa as S,h as _,e as T,f as j,I as M,j as A,H as L,L as R,a7 as O,a8 as G,F as H,m as W}from"./@vue.pEDXJ_3Z1758259351508.js";const F=async()=>{const e=await d("https://opensource.cdn.icegl.cn/model/digitalCity/shanghai.FBX");let a=null,o=null,t=null;return e.traverse((e=>{"CITY_UNTRIANGULATED"===e.name&&(a=e),"LANDMASS"===e.name&&(o=e),"ROADS"===e.name&&(t=e)})),{model:e,city:a,land:o,roads:t}},k=["object"],D=h({__name:"buildingsModelCustomShader",props:{model:{},bulidingsColor:{default:"#e523ff"},landColor:{default:"#112233"},topColor:{default:"#ffff00"},opacity:{default:.9},gradient:{type:Boolean,default:!0}},setup(o){const t=o,l=w(0),r=t.model.city;r.renderOrder=1001;const i=t.model.land;(()=>{const{geometry:o}=r;o.computeBoundingBox(),o.computeBoundingSphere();const{max:i,min:n}=o.boundingBox;if(r.material.__csm)return;const s=new m({baseMaterial:r.material,vertexShader:y,fragmentShader:f,silent:!0,uniforms:{uMax:{value:i},uMin:{value:n},uBorderWidth:{value:5},uCircleTime:{value:5},uColor:{value:new a(t.bulidingsColor)},uOpacity:{value:t.opacity},uLightColor:{value:new a("#ffffff")},uTopColor:{value:new a(t.topColor)},uTime:l,uGradient:{value:t.gradient}},depthWrite:!0,depthTest:!0,transparent:!0,side:e});r.material.dispose(),r.material=s})();const{onLoop:n}=p();n((({delta:e})=>{l.value+=e})),g((()=>{t.bulidingsColor&&r.material.uniforms.uColor.value.setStyle(t.bulidingsColor),t.landColor&&((a,o)=>{let l;l=Array.isArray(i.material)?i.material:[i.material],l.forEach((a=>{a[o].setStyle(t.landColor),a.side=e}))})(0,"color"),t.opacity&&(r.material.uniforms.uOpacity.value=t.opacity)})),v(t,((e,a)=>{r.material.uniforms.uGradient.value=e.gradient}));const s=t.model.model.clone();return(e,a)=>(b(),C("primitive",{object:B(s)},null,8,k))}}),N=["object"],E=h({__name:"buildingsLines",props:{builds:{},width:{default:1},color:{default:"#FFF"},opacity:{default:1},style:{default:"Wireframe"}},setup(e){const n=e;let s=null,u=null;if("Wireframe"===n.style){const e=new o(n.builds.geometry);let a=(new t).fromEdgesGeometry(e),i=new l({color:n.color,linewidth:n.width,opacity:n.opacity,transparent:!0,depthWrite:!0,depthTest:!0});i.resolution.set(window.innerWidth,window.innerHeight),s=new r(a,i),s.applyMatrix4(n.builds.matrix.clone())}else{u={transparent:!0,uniforms:{uColor:{value:new a(n.color)},uOpacity:{value:n.opacity}},vertexShader:"\n       void main() {\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:" \n        uniform vec3 uColor;\n\t\t\t\tuniform float uOpacity;\n        void main() {\n          gl_FragColor = vec4(uColor, uOpacity);\n        }\n      "};const e=new o(n.builds.geometry),t=new i(u);s=new LineSegments(e,t),s.applyMatrix4(n.builds.matrix.clone()),s.material.linewidth=n.width,s.renderOrder=1e3}return g((()=>{"Shader"===n.style&&(n.color&&(u.uniforms.uColor.value=new a(n.color)),n.opacity&&(u.uniforms.uOpacity.value=n.opacity)),"Wireframe"===n.style&&(n.color&&(s.material.color=new a(n.color)),n.opacity&&(s.material.opacity=n.opacity)),n.width&&(s.material.linewidth=n.width)})),(e,a)=>(b(),C("primitive",{object:B(s)},null,8,N))}}),I={key:1,args:[1e3],position:[0,19,0]},P={key:2,args:[6e3,100],position:[0,19,0]},U=h({__name:"pagesShow",props:{showBuildings:{type:Boolean,default:!0},autoRotate:{type:Boolean,default:!0},showAxesHelper:{type:Boolean,default:!0},showGridHelper:{type:Boolean,default:!0},disableRender:{type:Boolean,default:!1}},async setup(e){let a,o;const t=e,l=x({clearColor:"#000000",shadows:!0,alpha:!1,useLegacyLights:!0,shadowMapType:u,outputColorSpace:s,toneMapping:n,disableRender:t.disableRender}),r=x({autoRotate:t.autoRotate,enableDamping:!0});let i=null;t.showBuildings&&([a,o]=S((()=>F())),a=await a,o(),i=a);const d=w(),p=w();return(e,a)=>{const o=_("TresCanvas");return b(),T(o,W({ref_key:"tcRef",ref:p},l,{"window-size":""}),{default:j((()=>[M("TresPerspectiveCamera",{ref_key:"perspectiveCameraRef",ref:d,position:[600,750,-1221],fov:45,near:1,far:1e5},null,512),A(B(c),O(G(r)),null,16),a[0]||(a[0]=M("TresAmbientLight",{color:"#ffffff"},null,-1)),a[1]||(a[1]=M("TresDirectionalLight",{position:[100,100,0],intensity:.5,color:"#ffffff"},null,-1)),t.showBuildings&&B(i)?(b(),C(H,{key:0},[A(D,{model:B(i)},null,8,["model"]),A(E,{builds:B(i).city,color:"#000"},null,8,["builds"])],64)):L("",!0),R(e.$slots,"ability"),t.showAxesHelper?(b(),C("TresAxesHelper",I)):L("",!0),t.showGridHelper?(b(),C("TresGridHelper",P)):L("",!0)])),_:3},16)}}});export{D as _,E as a,U as b,F as l};
