import{importShared as x}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{MqttClientWrapper as q}from"./mqttTvt.Rmkf1-Ry1767148983502.js";import{_export_sfc as D}from"./index.DTe2qqjO1767148983502.js";import{Button as g}from"./Button.DslW6U6X1767148983502.js";import{NDivider as y,NLog as V}from"./Log.Dg2CPyw71767148983502.js";import{useMessage as Q,NMessageProvider as F}from"./use-message.BBJznJob1767148983502.js";import{NCard as L}from"./Card.CLGorf6I1767148983502.js";import{NForm as O,NFormItem as v}from"./FormItem.BV0Pjtsh1767148983502.js";import{NTag as N}from"./Tag.B40cK7ZV1767148983502.js";import{NInput as f}from"./Input.FhrARThI1767148983502.js";import{NInputNumber as j}from"./InputNumber.q5fRlmi31767148983502.js";import{NSpace as M}from"./Space.ugCFVeji1767148983502.js";const{createTextVNode:i,unref:l,withCtx:a,createVNode:t,renderList:J,Fragment:A,openBlock:k,createElementBlock:$,toDisplayString:E,createBlock:P}=await x("vue"),W={class:"w-full",style:{"background-color":"#ffffff"}},{ref:p,reactive:z,onUnmounted:G}=await x("vue"),H={__name:"MqttTesterUI",setup(B){const s=Q(),u=z({host:"a5183db3.ala.asia-southeast1.emqxsl.com",port:8084,protocol:"wss",clientId:`tvt-test-client-${Math.random().toString(16).slice(2,8)}`,username:"tvt.js",password:"test",topic:"tvtDevices/#"}),w=p("tvtDevices/uiDemo"),_=p('{ "hello": "world" }'),r=p(null),d=p(!1),b=p([]),m=p(!1);function T(){r.value&&(r.value.removeAllListeners(),r.value.disconnect(),r.value=null,d.value=!1)}function S(){T(),m.value=!0,r.value=new q(u),r.value.on("connected",()=>{d.value=!0,m.value=!1,s.success("MQTT 连接成功")}),r.value.on("close",()=>{d.value=!1,m.value=!1,s.warning("MQTT 连接关闭")}),r.value.on("error",n=>{m.value=!1,console.error(n),s.error(`MQTT 错误: ${n.message}`)}),r.value.on("message",(n,e)=>{b.value.push(`[${n}] ${JSON.stringify(e)}`),b.value.length>100&&b.value.shift()}),r.value.connect()}const c=p(new Set);function C(){if(r.value)for(const n of c.value)r.value.unsubscribe(n);c.value.clear(),T(),s.success("已断开连接")}function U(){if(!r.value||!d.value){s.warning("尚未连接 MQTT");return}const n=u.topic?.trim();if(!n){s.warning("请输入订阅主题");return}if(c.value.has(n)){s.info(`已订阅该主题：${n}`);return}r.value.subscribe(n),c.value.add(n),s.success(`订阅成功：${n}`)}function I(){try{const n=JSON.parse(_.value);r.value.publish(w.value,n),s.info("已发送消息")}catch{s.error("JSON 格式错误")}}return G(()=>{C()}),(n,e)=>(k(),$("div",W,[t(l(L),{title:"MQTT 调试面板",class:"max-w-4xl mx-auto"},{default:a(()=>[t(l(O),{model:u,"label-width":"100"},{default:a(()=>[t(l(v),{label:"注意："},{default:a(()=>[t(l(N),{style:{"margin-left":"10px"},type:"warning"},{default:a(()=>[...e[8]||(e[8]=[i("免费服务每月流量/次数有限，若连接失败请自行更换自己的mqtt服务",-1)])]),_:1})]),_:1}),t(l(v),{label:"地址"},{default:a(()=>[t(l(f),{value:u.host,"onUpdate:value":e[0]||(e[0]=o=>u.host=o),placeholder:"例如: broker.hivemq.com"},null,8,["value"])]),_:1}),t(l(v),{label:"端口"},{default:a(()=>[t(l(j),{value:u.port,"onUpdate:value":e[1]||(e[1]=o=>u.port=o),min:1},null,8,["value"]),t(l(N),{style:{"margin-left":"10px"},type:"info"},{default:a(()=>[...e[9]||(e[9]=[i("浏览器端只支持：wws方式 的 mqtt",-1)])]),_:1})]),_:1}),t(l(v),{label:"Client ID"},{default:a(()=>[t(l(f),{value:u.clientId,"onUpdate:value":e[2]||(e[2]=o=>u.clientId=o),placeholder:"随机生成也可"},null,8,["value"])]),_:1}),t(l(v),{label:"用户名"},{default:a(()=>[t(l(f),{value:u.username,"onUpdate:value":e[3]||(e[3]=o=>u.username=o)},null,8,["value"])]),_:1}),t(l(v),{label:"密码"},{default:a(()=>[t(l(f),{value:u.password,"onUpdate:value":e[4]||(e[4]=o=>u.password=o)},null,8,["value"])]),_:1}),t(l(v),{label:"订阅主题"},{default:a(()=>[t(l(f),{value:u.topic,"onUpdate:value":e[5]||(e[5]=o=>u.topic=o),placeholder:"例如: tvt/demo"},null,8,["value"])]),_:1}),t(l(M),null,{default:a(()=>[t(l(g),{type:"primary",disabled:d.value||m.value,loading:m.value,onClick:S},{default:a(()=>[...e[10]||(e[10]=[i("连接",-1)])]),_:1},8,["disabled","loading"]),t(l(g),{type:"warning",disabled:!d.value,onClick:C},{default:a(()=>[...e[11]||(e[11]=[i("断开",-1)])]),_:1},8,["disabled"]),t(l(g),{type:"success",disabled:!d.value,onClick:U},{default:a(()=>[...e[12]||(e[12]=[i("订阅",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"]),t(l(y),null,{default:a(()=>[...e[13]||(e[13]=[i("已订阅主题",-1)])]),_:1}),t(l(M),null,{default:a(()=>[(k(!0),$(A,null,J(Array.from(c.value),o=>(k(),P(l(N),{key:o,type:"info",round:""},{default:a(()=>[i(E(o),1)]),_:2},1024))),128))]),_:1}),t(l(y),null,{default:a(()=>[...e[14]||(e[14]=[i("发送消息 [主题/json消息]",-1)])]),_:1}),t(l(f),{value:w.value,"onUpdate:value":e[6]||(e[6]=o=>w.value=o),placeholder:"主题",class:"mb-2"},null,8,["value"]),t(l(f),{value:_.value,"onUpdate:value":e[7]||(e[7]=o=>_.value=o),type:"textarea",placeholder:'{ "key": "value" }',rows:4},null,8,["value"]),t(l(g),{type:"info",class:"mt-2",disabled:!d.value,onClick:I},{default:a(()=>[...e[15]||(e[15]=[i("发送",-1)])]),_:1},8,["disabled"]),t(l(y),null,{default:a(()=>[...e[16]||(e[16]=[i("收到的消息",-1)])]),_:1}),t(l(V),{log:b.value.join(`
`),rows:12},null,8,["log"])]),_:1})]))}},K=D(H,[["__scopeId","data-v-e8d1d438"]]),{createVNode:R,unref:X,withCtx:Y,openBlock:Z,createBlock:h}=await x("vue"),fe={__name:"index",setup(B){return(s,u)=>(Z(),h(X(F),null,{default:Y(()=>[R(K)]),_:1}))}};export{fe as default};
