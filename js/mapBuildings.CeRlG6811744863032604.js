import{z as e}from"./three-custom-shader-material.Cs7iC7LJ1744863032604.js";import"./HeightCorrection.Bq98L9tL1744863032604.js";import"./three-tile.EUZtrSH-1744863032604.js";import"./@tweenjs.ULy8-5Ku1744863032604.js";/* empty css                                                                                    */import"./utils.CBUCUaDU1744863032604.js";import{l as o,U as t,P as i,M as n,T as r,a,r as s}from"./raycasterEvent.Cug4IBBJ1744863032604.js";import"./index.BGSZsJXM1744863032604.js";import{_ as u,a as l}from"./radraB.vue_vue_type_script_setup_true_lang.RumtcRQ71744863032604.js";import{_ as p}from"./buildingsMarkA.vue_vue_type_script_setup_true_lang.CECrjMU31744863032604.js";import{_ as c}from"./fireA.vue_vue_type_script_setup_true_lang.t1iBK9Ly1744863032604.js";import{_ as m}from"./fireB.vue_vue_type_script_setup_true_lang.C9IIIfZO1744863032604.js";import{_ as f}from"./smokeA.vue_vue_type_script_setup_true_lang.BAeJxfbW1744863032604.js";import{_ as d}from"./precipitation.vue_vue_type_script_setup_true_lang.BwOA-ruO1744863032604.js";import{_ as g}from"./cloudMesh.vue_vue_type_script_setup_true_lang.CJ_0n5PD1744863032604.js";import{_}from"./rippleMesh.vue_vue_type_script_setup_true_lang.nyMzT8Od1744863032604.js";import{e as h,b as v,m as y}from"./@tresjs.DDZ0vesk1744863032604.js";import{ae as w,V as j,cC as x,a4 as b,g as M,S as C,M as P,Q as T,cw as z,cx as B,cy as S,cz as I,ab as L,C as E,b9 as A,cQ as G,ap as O,as as k,c6 as q,q as D}from"./three.B0XaFSnH1744863032604.js";import{l as H}from"./utils.D42y0R0G1744863032604.js";import{d as W,a5 as R,H as Z,o as F,F as J,X as V,J as N,u as U,b as $,a3 as Q,j as X,e as Y,f as K,am as ee,v as oe,r as te,h as ie,m as ne}from"./@vue.DK6ok9LJ1744863032604.js";import{T as re}from"./3d-tiles-renderer.rQVfhEiF1744863032604.js";import"./d3-geo.DBB5ADts1744863032604.js";import"./d3-array.G5ptHY8Z1744863032604.js";import"./axios.DfnQzhWI1744863032604.js";import"./axios.DLTVXJci1744863032604.js";import"./pinia.vfLI9vPt1744863032604.js";import"./@fesjs.1a7Lul6Z1744863032604.js";import"./vue-router.CdrpVSr11744863032604.js";import"./lodash-es.BOsRjQhS1744863032604.js";import"./@qlin.q6OWdsQV1744863032604.js";import"./@babel.BPq7uOAK1744863032604.js";import"./@floating-ui.BFjFSAYt1744863032604.js";import"./@juggle.CcBCnTIR1744863032604.js";import"./color.CUKjc-u01744863032604.js";import"./@amap.CGUF9xH41744863032604.js";import"./color-string.wQKHaeBr1744863032604.js";import"./color-name.BQ5IbGbl1744863032604.js";import"./simple-swizzle.B6m8dJrK1744863032604.js";import"./is-arrayish.CLsR9Wfx1744863032604.js";import"./color-convert.BlkN9amV1744863032604.js";import"./lodash.BrVzOvG11744863032604.js";import"./@mapbox.B8uYRbGC1744863032604.js";import"./three-mesh-bvh.CQMVAHAP1744863032604.js";import"./index.TmMel0Tm1744863032604.js";import"./object-hash.BnegGKfT1744863032604.js";import"./jszip.H-wAjEeh1744863032604.js";import"./SPE.DqZmuCUH1744863032604.js";import"./postprocessing.DMK_Mhe01744863032604.js";import"./@vueuse.aRlY5CPe1744863032604.js";const ae={renderOrder:3e3},se=["args"],ue=["map","side","color"],le=W({__name:"roadLightByLonLat",props:{geoJson:{},color:{default:"#ffff00"},radius:{default:2},speed:{default:1}},async setup(e){let t,i;const n=e,{map:r}=([t,i]=R((()=>v({map:"./plugins/digitalCity/image/line.png"}))),t=await t,i(),t);r.needsUpdate=!0,r.wrapS=r.wrapT=w,r.repeat.set(1,1);const a=([t,i]=R((()=>H(n.geoJson))),t=await t,i(),t);let s=[];for(var u=0;u<a.length;u++){const e=a[u],t=[];e.geometry.coordinates.forEach((e=>{const i=o(e[0],e[1],50);t.push(new j(i[0],0,-i[1]))}));let i=n.color;i="primary"===e.properties.highway?"#7eff10":"tertiary"===e.properties.highway?"#0eeeee":"secondary"===e.properties.highway?"#ffffff":"#ff0ffe",s.push({cr3:new x(t),color:i})}const{onLoop:l}=h();return l((()=>{r.offset.x-=Math.random()/20*n.speed})),(e,o)=>(F(),Z("TresGroup",null,[(F(!0),Z(J,null,V(U(s),(e=>(F(),Z("TresMesh",ae,[N("TresTubeGeometry",{args:[e.cr3,64,n.radius,20,!1]},null,8,se),N("TresMeshBasicMaterial",{map:U(r),side:U(b),transparent:!0,color:e.color},null,8,ue)])))),256))]))}}),pe=e=>{e.onLoadTileSet=o=>{const t=new M,i=new C,n=new P;let r=null,a=0;e.getOrientedBounds(t,n)?(r=(new j).setFromMatrixPosition(n),a=r.length()):e.getBoundingSphere(i)&&(r=i.center.clone(),a=r.length());const s=r?.normalize(),u=((e,o)=>{const t=new T,i=(new j).crossVectors(e,o);return t.x=i.x,t.y=i.y,t.z=i.z,t.w=1+e.clone().dot(o),t.normalize(),t})(s,new j(0,1,0));e.group.quaternion.x=u.x,e.group.quaternion.y=u.y,e.group.quaternion.z=u.z,e.group.quaternion.w=u.w,e.group.position.z=-a}},ce=["object","rotation"],me=W({__name:"tilesBuildings",props:{bulidingsColor:{default:"#e523ff"},topColor:{default:"#ffff00"},opacity:{default:.8},gradient:{type:Boolean,default:!0},camera:{}},setup(o){const t=o,i=$(0),n=new re("https://jdvop.oss-cn-qingdao.aliyuncs.com/mapv-data/titleset/sz_ns/no.json");n.errorTarget=2,n.addEventListener("load-model",(({scene:o})=>{o.traverse((o=>{if(o.isMesh){(o=>{const{geometry:n}=o;n.computeBoundingBox(),n.computeBoundingSphere();const{max:r,min:a}=n.boundingBox,s=new e({baseMaterial:new A,vertexShader:"varying vec4 vPosition;\nvoid main(){\n\tvPosition=modelMatrix*vec4(position,1.);\n\tcsm_Position=position*vec3(1.);\n}",fragmentShader:"uniform mat4 modelMatrix;\nvarying vec4 vPosition;\nuniform vec3 uMax;\nuniform vec3 uMin;\nuniform float uOpacity;\nuniform float uBorderWidth;\nuniform vec3 uLightColor;\nuniform vec3 uColor;\nuniform float uCircleTime;\nuniform float uTime;\nuniform vec3 uTopColor; // 顶部颜色\nuniform bool uGradient;\nvec4 uMax_world;\nvec4 uMin_world;\nvoid main() {\n  // 转世界坐标\n  uMax_world = modelMatrix * vec4(uMax, 1.);\n  uMin_world = modelMatrix * vec4(uMin, 1.);\n  vec3 distColor = uColor;\n  float residue = uTime - floor(uTime / uCircleTime) * uCircleTime;\n  float rate = residue / uCircleTime;\n  float lightOffset = rate * (uMax_world.y - uMin_world.y);\n\n  if (uMin_world.y + lightOffset < vPosition.y &&\n      uMin_world.y + lightOffset + uBorderWidth > vPosition.y) {\n    csm_DiffuseColor = vec4(uLightColor, uOpacity);\n  } else {\n    csm_DiffuseColor = vec4(distColor, uOpacity);\n  }\n\n  // 根据高度计算颜色\n  if (uGradient) {\n    float rateHight =\n        (vPosition.y - uMin_world.y) / (uMax_world.y - uMin_world.y);\n    // vec3 outColor = mix(csm_DiffuseColor.xyz, uTopColor, rateHight * 0.6);\n    float mixNumber = clamp(rateHight * 2.3 - 1.5, 0., 1.);\n    vec3 outColor = mix(csm_DiffuseColor.xyz, uTopColor, mixNumber);\n\n    csm_DiffuseColor = vec4(outColor, uOpacity);\n  }\n}",silent:!0,uniforms:{uMax:{value:r},uMin:{value:a},uBorderWidth:{value:5},uCircleTime:{value:5},uColor:{value:new E(t.bulidingsColor)},uOpacity:{value:t.opacity},uLightColor:{value:new E("#ffffff")},uTopColor:{value:new E(t.topColor)},uTime:i,uGradient:{value:t.gradient}},depthWrite:!0,depthTest:!0,transparent:!0,side:L});o.material.dispose(),o.material=s})(o),o.receiveShadow=!1,o.castShadow=!1;const n=new z(o.geometry.clone());let r=(new B).fromEdgesGeometry(n),a=new S({color:0,linewidth:1,opacity:1,transparent:!0,depthWrite:!0,depthTest:!0});a.resolution.set(window.innerWidth,window.innerHeight);const s=new I(r,a);s.applyMatrix4(o.matrix.clone()),o.parent.add(s)}}));const r=new M,a=new C;n.getBoundingBox(r)?(r.getCenter(n.group.position),n.group.position.multiplyScalar(-1)):n.getBoundingSphere(a)&&(n.group.position.copy(a.center),n.group.position.multiplyScalar(-1))})),pe(n);const{renderer:r,sizes:a}=y();Q((()=>{a.width.value&&(n.setCamera(t.camera),n.setResolutionFromRenderer(t.camera,r.value))}));const{onBeforeLoop:s}=h();return s((({delta:e})=>{i.value+=2*e,t.camera&&a.width.value&&(t.camera.updateMatrixWorld(),n.update())})),(e,o)=>(F(),Z("TresGroup",null,[N("primitive",{object:U(n).group,rotation:[-Math.PI/2,0,0]},null,8,ce)]))}}),fe=["object","rotation"],de=W({__name:"tileMapBuildingsMesh",props:{bbox:{default:[104.955976,20.149765,120.998419,30.528687]},maxZoom:{default:20},mapCenter:{},camera:{}},setup(e,{expose:o}){const s=e,{renderer:u,scene:l}=y(),p=new i;p.coordType=t;const c=new n;c.source="https://webrd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",c.showTileNo=!1,c.useWorker=!0;const m=new r(p,c);m.showBoundingBox=!1,m.wireframe=!1,m.flatShading=!1,m.filter={opposite:!0,genBright:1.3,genContrast:1,genSaturation:1};let f=new E("#4688b5");m.filter.monochrome={r:f.r,g:f.g,b:f.b};const d=new a;d.provider=m,d.bbox=s.bbox,d.maxZoom=s.maxZoom,s.camera.up=new j(0,1,0),s.camera.position.set(s.mapCenter[0],s.mapCenter[2],2e3-s.mapCenter[1]),s.camera.lookAt(new j(s.camera.position.x,0,s.camera.position.z-3e3)),d.camera=s.camera;let g=null;Q((()=>{u.value&&(g=new G(s.camera,u.value.domElement),g.enableDamping=!0,g.dampingFactor=.05,g.minDistance=600,g.position0.set(s.camera.position.x,s.camera.position.y,s.camera.position.z),g.target.set(s.camera.position.x,0,s.camera.position.z-2e3))}));const{onLoop:_}=h();return _((()=>{if(u.value){const e=50*Math.abs(s.camera.position.y);s.camera.far=e+5e3,s.camera.updateProjectionMatrix(),g&&(g.update(),g.target.y=0),d.update(),u.value.render(l.value,s.camera)}})),o({camera:s.camera,map:d}),(e,o)=>(F(),Z("primitive",{object:U(d),rotation:[-Math.PI/2,0,0]},null,8,fe))}});function ge(){var e=["toString","debu","string","517133sHeGRP","init","constructor","105EtIhtP","3410525zSmLhZ","gger","prototype","1800984juMZFr","bind","test","182472kqAviU","log","246204TEhVtF","__proto__","1821796VsGgsb","length",'{}.constructor("return this")( )',"return (function() ","apply","24bJtVkK","console","call","5710zWTCGh","error","table","action","info","while (true) {}","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","chain","27291iPpEgv","exception","6EZYbJj","input"];return(ge=function(){return e})()}!function(){for(var e=we,o=ge();;)try{if(581119===-parseInt(e(344))/1+parseInt(e(351))/2+-parseInt(e(339))/3*(parseInt(e(358))/4)+-parseInt(e(348))/5+parseInt(e(354))/6*(parseInt(e(347))/7)+parseInt(e(363))/8*(-parseInt(e(356))/9)+-parseInt(e(366))/10*(-parseInt(e(337))/11))break;o.push(o.shift())}catch(t){o.push(o.shift())}}();var _e,he=(_e=!0,function(e,o){var t=_e?function(){if(o){var t=o.apply(e,arguments);return o=null,t}}:function(){};return _e=!1,t});!function(){he(this,(function(){var e=we,o=new RegExp("function *\\( *\\)"),t=new RegExp(e(335),"i"),i=je(e(345));o.test(i+e(336))&&t[e(353)](i+e(340))?je():i("0")}))()}();var ve,ye=(ve=!0,function(e,o){var t=ve?function(){if(o){var t=o[we(362)](e,arguments);return o=null,t}}:function(){};return ve=!1,t});function we(e,o){var t=ge();return we=function(e,o){return t[e-=334]},we(e,o)}function je(e){function o(e){var t=we;if(typeof e===t(343))return function(e){}[t(346)](t(334))[t(362)]("counter");1!==(""+e/e)[t(359)]||e%20==0?function(){return!0}[t(346)](t(342)+t(349))[t(365)](t(369)):function(){return!1}[t(346)]("debu"+t(349))[t(362)]("stateObject"),o(++e)}try{if(e)return o;o(0)}catch(t){}}ye(void 0,(function(){var e,o=we;try{e=Function(o(361)+o(360)+");")()}catch(u){e=window}for(var t=e[o(364)]=e[o(364)]||{},i=[o(355),"warn",o(370),o(367),o(338),o(368),"trace"],n=0;n<i[o(359)];n++){var r=ye[o(346)][o(350)].bind(ye),a=i[n],s=t[a]||r;r[o(357)]=ye[o(352)](ye),r[o(341)]=s.toString[o(352)](s),t[a]=r}}))();const xe=W({__name:"mapBuildingsMoreMeshes",props:{cPosition:{}},setup(e){const t=o(113.9456,22.5385,50),i=o(113.9498,22.5364,50);return(e,o)=>(F(),Z(J,null,[X(U(u),{color:"#00c0ff",radius:300,size:300,position:[e.cPosition[0],8,-e.cPosition[1]]},null,8,["position"]),(F(),Y(ee,null,{default:K((()=>[X(U(p),{position:[e.cPosition[0],8,-e.cPosition[1]],scale:.13,img:"./plugins/digitalCity/image/znsba.png",foremost:!1},null,8,["position"])])),_:1})),X(U(l),{position:[e.cPosition[0]+700,10,300-e.cPosition[1]],color:"#ffff00",height:180,maxRadius:400},null,8,["position"]),(F(),Y(ee,null,{default:K((()=>[X(U(p),{position:[e.cPosition[0]+700,10,300-e.cPosition[1]],scale:200,img:"./plugins/digitalCity/image/znsb-err.png",sizeAttenuation:!0,foremost:!0},null,8,["position"])])),_:1})),(F(),Y(ee,null,{default:K((()=>[X(U(c),{fireScale:80,magnitude:1.3,lacunarity:2,gain:1,position:[e.cPosition[0]+280,1,120-e.cPosition[1]]},null,8,["position"])])),_:1})),(F(),Y(ee,null,{default:K((()=>[X(U(m),{position:[e.cPosition[0]+388,6,330-e.cPosition[1]]},null,8,["position"])])),_:1})),(F(),Y(ee,null,{default:K((()=>[X(U(f),{position:[e.cPosition[0]+388,6,330-e.cPosition[1]]},null,8,["position"])])),_:1})),(F(),Y(ee,null,{default:K((()=>[X(U(d),{speed:12,size:20,count:2e4,color:"#fff",type:"snow",position:[e.cPosition[0],300,-e.cPosition[1]],areaX:5e3,areaY:600,areaZ:5e3},null,8,["position"])])),_:1})),(F(),Y(ee,null,{default:K((()=>[X(U(g),{cPosition:[e.cPosition[0],600,-e.cPosition[1]]},null,8,["cPosition"])])),_:1})),X(U(_),{"position-y":6,positionSrc:[{x:U(t)[0],y:-U(t)[1]},{x:U(t)[0],y:-U(i)[1]},{x:U(i)[0],y:-U(i)[1]},{x:U(i)[0],y:-U(t)[1]},{x:U(t)[0],y:-U(t)[1]}],height:220,color:"#00ffdd"},null,8,["positionSrc"]),(F(),Y(ee,null,{default:K((()=>[X(U(le),{position:[500,0,340],radius:5,geoJson:"plugins/digitalCity/geojson/shenzhen2.geojson"})])),_:1}))],64))}}),be=W({__name:"mapBuildings",setup(e){const t=o(113.942639739199,22.53171672540276,50),i=oe(),n=te({clearColor:"#000000",renderMode:"manual",alpha:!1,shadowMapType:q,outputColorSpace:k,toneMapping:O}),r=[t[0],t[1],1700],a=new D(60,window.innerWidth/window.innerHeight,1,1e8);return(e,o)=>{const u=ie("TresCanvas");return F(),Z(J,null,[X(u,ne(n,{"window-size":""}),{default:K((()=>[o[0]||(o[0]=N("TresAmbientLight",{color:"#ffffff"},null,-1)),o[1]||(o[1]=N("TresDirectionalLight",{position:[100,100,0],intensity:.5,color:"#ffffff"},null,-1)),X(U(me),{position:[U(t)[0],1,228-U(t)[1]],camera:U(a)},null,8,["position","camera"]),(F(),Y(ee,null,{default:K((()=>[X(U(de),{ref_key:"tileMapBuildingsMeshRef",ref:i,bbox:[104.955976,20.149765,120.998419,30.528687],mapCenter:r,camera:U(a)},null,8,["camera"])])),_:1})),(F(),Y(ee,null,{default:K((()=>[X(xe,{cPosition:U(t)},null,8,["cPosition"])])),_:1})),o[2]||(o[2]=N("TresGridHelper",{args:[1e4,10]},null,-1)),o[3]||(o[3]=N("TresAxesHelper",{args:[1e5]},null,-1))])),_:1},16),X(s,{tileMapRef:i.value},null,8,["tileMapRef"])],64)}}});export{be as default};
