import{F as e,_ as o}from"./@tresjs.BCHtwiaC1763540743861.js";import{o as a}from"./index.Crdf3MNx1763540743861.js";import{n,l as t,c$ as r,b8 as i,ae as l}from"./three.rXKzP9fQ1763540743861.js";import{d as s,a as u,q as v,a6 as f,H as c,o as m,J as p,ac as y,ao as g}from"./@vue.Co_gxueH1763540743861.js";const d=s({__name:"xRayEffect",props:{model:{},color:{default:"#84ccff"},opacity:{default:1}},setup(s){const d=s,h=u(),T=[];d.model.traverse(e=>{e instanceof n&&(e.geometry.verticesNeedUpdate=!0,T.push(e.geometry))});const x={uniforms:{c:{type:"f",value:1.11},p:{type:"f",value:1},glowColor:{type:"c",value:new t(d.color)},lightningTexture:{type:"t",value:null},offsetY:{type:"f",value:.1},uTime:{type:"f",value:0},uOpacity:{type:"f",value:d.opacity}},vertexShader:"uniform float c;\nuniform float p;\nuniform float uTime;\nvarying float intensity;\nvarying vec2 vUv;\nvoid main(){\n    vUv=uv;\n    vec3 vNormal=normalize(normalMatrix*normal);\n    intensity=pow(c-abs(dot(vNormal,vec3(0,0,1))),p);\n    gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);\n}",fragmentShader:"uniform vec3 glowColor;\nuniform sampler2D lightningTexture;\nvarying float intensity;\nvarying vec2 vUv;\nuniform float offsetY;\nuniform float uTime;\nuniform float uOpacity;\n\nvoid main(){\n  vec2 uv=vUv;\n  uv.y+=offsetY;\n  vec3 glow=glowColor*intensity;\n  vec3 color=vec3(step(.1,uv.y)-step(.2,uv.y))-vec3(texture2D(lightningTexture,uv));\n  float alpha=clamp(cos(uTime*3.),.5,1.);\n  gl_FragColor=vec4(glow+color,alpha*uOpacity);\n}",side:l,blending:i,depthWrite:!1};v(async()=>{const e=await a("./plugins/medical/image/brainXRayLight.png");x.uniforms.lightningTexture.value=e,console.log(e)}),x.uniforms.offsetY.value=Math.sin(5);const{camera:w}=e(),{onBeforeRender:M}=o();return M(({delta:e})=>{w.value?.position&&h.value&&(x.uniforms.uTime.value+=e)}),f(()=>{h.value&&(h.value.geometry.dispose(),h.value.geometry=r(T)),d.color&&(x.uniforms.glowColor.value=new t(d.color)),d.opacity&&(x.uniforms.uOpacity.value=d.opacity)}),(e,o)=>(m(),c("TresMesh",{ref_key:"TresMeshRef",ref:h,"render-order":9},[o[0]||(o[0]=p("TresBufferGeometry",null,null,-1)),p("TresShaderMaterial",y(g(x)),null,16)],512))}});export{d as _};
