import{i as e}from"./3d-tiles-renderer.CbgZh8zU1767066396612.js";import{F as t,_ as n,a as o,K as s}from"./@tresjs.B1f7s3pS1767066396612.js";import{l as r,a as i}from"./utils.BFr1Wy_Z1767066396612.js";import{g as a}from"./generalFont.vue_vue_type_script_setup_true_lang.Z5LxGLZ21767066396612.js";import"./default.vue_vue_type_script_setup_true_lang.VHSeCGYE1767066396612.js";import"./three-mesh-ui.module.dA3oDDhS1767066396612.js";import"./domPanel.vue_vue_type_style_index_0_lang.D11M9pLL1767066396612.js";const c=await e("three");window.THREE=c;const l={scene:null,renderer:null,camera:null,sizes:null},u={get renderer(){return l.renderer?.value},loader:new c.TextureLoader,get scene(){return l.scene?.value},get camera(){return l.camera?.value},get width(){return l.sizes?.width?.value},get height(){return l.sizes?.height?.value},get dom(){return l.renderer?.value.domElement.parentElement},get canvas(){return l.renderer?.value.domElement},events:{},init(e,t,n,o){l.scene=e,l.renderer=t,l.camera=n,l.sizes=o},load(e){const t={"1d0e8871-bd60-47f9-8ab7-232dabd30201":[{name:"SpotLightEvent",source:"this.shadow.mapSize.width = 1024 * 2\nthis.shadow.mapSize.height = 1024 * 2\nthis.shadow.camera.near = 1\nthis.shadow.camera.far = 10\nthis.shadow.bias = -0.0075\nthis.shadow.radius = 24\nthis.target.position.copy(this.position.clone().setY(0))\nfunction update( event ) {}"}],"beea1423-1e37-47ab-9443-f8429259e120":[{name:"dirb",source:"this.shadow.mapSize.width = 1024 * 2\nthis.shadow.mapSize.height = 1024 * 2\nthis.shadow.camera.near = 1\nthis.shadow.camera.far = 50\nthis.shadow.camera.top = 80\nthis.shadow.camera.bottom = -80\nthis.shadow.camera.left = -80\nthis.shadow.camera.right = 80\nthis.shadow.radius = 24\nthis.shadow.bias = -0.0075\nfunction update( event ) {}"}],"31517222-A9A7-4EAF-B5F6-60751C0BABA3":[{name:"senceScirpt",source:"this.environment.mapping = THREE.EquirectangularReflectionMapping;\nthis.environment.colorSpace = THREE.SRGBColorSpace;\nfunction update( event ) {}"}]};this.events={init:[],start:[],stop:[],keydown:[],keyup:[],pointerdown:[],pointerup:[],pointermove:[],update:[]};let n="player,renderer,scene,camera";const o={};for(const r in this.events)n+=`,${r}`,o[r]=r;const s=JSON.stringify(o).replace(/\"/g,"");for(const r in t){let o=r;r===e.uuid&&(o=this.scene.uuid);const i=this.scene.getObjectByProperty("uuid",o,!0);if(void 0===i){console.warn("player: Script without object.",o);continue}const a=t[r];for(let e=0;e<a.length;e++){const t=a[e],o=new Function(n,`${t.source}\nreturn ${s};`).bind(i)(this,this.renderer,this.scene,this.camera);for(const e in o)void 0!==o[e]&&(void 0!==this.events[e]?this.events[e].push(o[e].bind(i)):console.warn("player: Event type not supported (",e,")"))}this.dispatch(this.events.init,arguments)}},dispatch(e,t){for(let n=0,o=e.length;n<o;n++)e[n](t)},setCamera(e){console.warn("暂时不考虑摄像机的设置函数",e)},setScene(e){console.warn("暂时不考虑场景的设置函数",e)},setPixelRatio(e){console.warn("暂时不考虑像素比的设置函数",e)},setSize(e){console.warn("暂时不考虑尺寸的设置函数",e)},dispose(){console.warn("暂时不考虑释放资源的函数")},onKeyDown(e){u.dispatch(u.events.keydown,e)},onKeyUp(e){u.dispatch(u.events.keyup,e)},onPointerDown(e){u.dispatch(u.events.pointerdown,e)},onPointerUp(e){u.dispatch(u.events.pointerup,e)},onPointerMove(e){u.dispatch(u.events.pointermove,e)},play(){document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp),document.addEventListener("pointerdown",this.onPointerDown),document.addEventListener("pointerup",this.onPointerUp),document.addEventListener("pointermove",this.onPointerMove),this.dispatch(this.events.start,null)},stop(){document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("pointerdown",this.onPointerDown),document.removeEventListener("pointerup",this.onPointerUp),document.removeEventListener("pointermove",this.onPointerMove),this.dispatch(this.events.stop,arguments)},render(e,t){this.dispatch(this.events.update,{time:e,delta:t})}},p={points:[{x:-16.017528533935547,y:2.4581613540649414,z:53.098697662353516},{x:-11.40013599395752,y:2.4513251781463623,z:43.62754821777344},{x:-7.9051361083984375,y:2.4462289810180664,z:36.4436149597168},{x:-5.53253173828125,y:2.442873001098633,z:31.546899795532227},{x:-4.282320976257324,y:2.4412572383880615,z:28.937395095825195},{x:-3.9756288528442383,y:2.4410974979400635,z:28.24086570739746},{x:-3.7963345050811768,y:2.4410974979400635,z:27.74983024597168},{x:-3.6438193321228027,y:2.4410974979400635,z:27.253768920898438},{x:-3.5180840492248535,y:2.4410974979400635,z:26.75269317626953},{x:-3.419203519821167,y:2.4411063194274902,z:26.243703842163086},{x:-3.3517673015594482,y:2.4416656494140625,z:25.55027961730957},{x:-3.318483829498291,y:2.4430952072143555,z:24.5682430267334},{x:-3.319352865219116,y:2.445394515991211,z:23.297592163085938},{x:-3.354374647140503,y:2.448564052581787,z:21.73832893371582},{x:-3.4121222496032715,y:2.4521596431732178,z:19.611284255981445},{x:-3.461057662963867,y:2.454956293106079,z:16.145946502685547},{x:-3.49935245513916,y:2.456882953643799,z:11.297648429870605},{x:-3.5270066261291504,y:2.457939386367798,z:5.066390037536621},{x:-3.544764518737793,y:2.4581613540649414,z:-2.423649311065674},{x:-3.565464973449707,y:2.4581613540649414,z:-9.03036880493164},{x:-3.5937604904174805,y:2.4581613540649414,z:-13.977668762207031},{x:-3.629650592803955,y:2.4581613540649414,z:-17.265522003173828},{x:-3.673135280609131,y:2.4581613540649414,z:-18.893949508666992},{x:-3.7082104682922363,y:2.4581613540649414,z:-19.473438262939453},{x:-3.7077581882476807,y:2.4581613540649414,z:-20.038450241088867},{x:-3.6713337898254395,y:2.4581613540649414,z:-20.605941772460938},{x:-3.5989370346069336,y:2.4581613540649414,z:-21.175914764404297},{x:-3.3510568141937256,y:2.4581613540649414,z:-22.262161254882812},{x:-1.7961064577102661,y:2.4581615924835205,z:-28.032060623168945},{x:1.3139424324035645,y:2.4581618309020996,z:-39.39905548095703},{x:5.9790754318237305,y:2.458162546157837,z:-56.36309814453125},{x:12.19931411743164,y:2.458163261413574,z:-78.92425537109375}],closed:!1},d=await e("three");const h=function(e){const t=e.points,n=[];for(const s of t){const e=s.x,t=s.y,o=s.z;n.unshift(new d.Vector3(e,t,o))}const o=new d.CatmullRomCurve3(n);return o.closed=e.closed,o}(p),m=new d.Matrix4;const{defineComponent:v}=await e("vue"),{createElementVNode:g,Fragment:y,openBlock:f,createElementBlock:w}=await e("vue"),b=["object"],j=["object"],z=["object"],x=["object"],E=["object"],_=["object"],P=["object"],D=await e("three"),k=v({__name:"firstLevel-bf61e255d699",props:{object:{}},setup(e){const o=e,{scene:s}=t(),r=function(e){const t=h.points.length/2,n=new d.InstancedMesh(e.geometry,e.material,t);n.userData={progresses:[]};for(let o=0;o<t;o++){const e=o/(t-1),s=h.getPointAt(e);n.userData.progresses[o]=e,m.setPosition(s),n.setMatrixAt(o,m)}return n}(o.object[1]);s.value.add(r);const i=function(e){const t=[];t.push(e[2].clone()),t.push(e[4].clone()),t.push(e[5].clone()),t.push(e[2].clone()),t.push(e[5].clone()),t.push(e[4].clone()),t.push(e[2].clone()),t.push(e[4].clone());for(let n=0;n<t.length;n++){const e=n/t.length*.6;t[n].userData={progress:e};const o=h.getPointAt(e);t[n].position.copy(o),t[n].visible=!0}return t}(o.object),a=new D.Group;a.position.set(0,1,0),a.add(...i),s.value.add(a);const c=function(e){const t=[];for(let n=0;n<6;n++){t.push(e[3].clone());const o=1-n/6*.4-.04;t[n].userData={progress:o};const s=h.getPointAt(o);t[n].position.copy(s),t[n].visible=!0}return t}(o.object),l=new D.Group;l.add(...c),l.position.set(0,1,0),s.value.add(l);const{onBeforeRender:u}=n();return u(({delta:e,elapsed:t})=>{r&&function(e){const t=e.userData.progresses;for(let n=0;n<e.count;n++){const o=h.getPointAt(t[n]);m.setPosition(o),e.setMatrixAt(n,m),t[n]+=5e-4,t[n]>1&&(t[n]=0)}e.instanceMatrix.needsUpdate=!0,e.computeBoundingSphere()}(r),i&&function(e){for(let t=0;t<e.length;t++){e[t].userData.progress+=5e-4,e[t].userData.progress>.6&&(e[t].userData.progress=0);const n=e[t].userData.progress,o=h.getPointAt(n);"flat_item"===e[t].name&&(o.y=1.5),e[t].position.copy(o)}}(i),c&&function(e){for(let t=0;t<e.length;t++){e[t].userData.progress+=5e-4,e[t].userData.progress>1&&(e[t].userData.progress=1-5/6*.4-.04);const n=e[t].userData.progress,o=h.getPointAt(n);e[t].position.copy(o)}}(c)}),(e,t)=>(f(),w(y,null,[g("primitive",{object:e.object[0]},null,8,b),g("primitive",{object:e.object[1],visible:!1},null,8,j),g("primitive",{object:e.object[2]},null,8,z),g("primitive",{object:e.object[4]},null,8,x),g("primitive",{object:e.object[5]},null,8,E),g("primitive",{object:e.object[6]},null,8,_),g("primitive",{object:e.object[3]},null,8,P)],64))}}),{withAsyncContext:M,defineComponent:S}=await e("vue"),{unref:L,createVNode:B,createElementVNode:C,Fragment:A,openBlock:R,createElementBlock:F}=await e("vue"),O=["object"],K=["object"],N=["object"],U=["object"],T=["object"],{onMounted:V,ref:$}=await e("vue"),G=await e("three"),W=S({__name:"scene",async setup(e){let o,s;const{scene:a,renderer:c,camera:l,sizes:p}=t();u.init(a,c,l,p);const d=new G.ObjectLoader,h=([o,s]=M(()=>r("./plugins/tresEditor/svelteMachine/json/scene.json")),o=await o,s(),o);if(h.geometries)for(const t of h.geometries)if(t.data&&t.data.startsWith("url:")){let e=t.data.slice(4);e.startsWith("geometries/")&&(e=`./plugins/tresEditor/svelteMachine/${e}`),t.data=([o,s]=M(()=>r(e)),o=await o,s(),o)}if(h.images)for(const t of h.images)if(t.url&&t.url.startsWith("url:")){let e=t.url.slice(4);e.startsWith("images/")&&(e=`./plugins/tresEditor/svelteMachine/${e}`),t.url=([o,s]=M(()=>i(e)),o=await o,s(),o)}const m=d.parse(h),v=$(null);V(()=>{if(a.value.background=m.background,a.value.environment=m.environment,a.value.fog=m.fog,u.load(m),u.play(),v.value){const e=v.value;e.target.position.set(-3.8,0,-2.3),a.value.add(e.target),e.angle=Math.PI/2.5}});const{onBeforeRender:g}=n();return g(({delta:e,elapsed:t})=>{if(u.renderer&&u.render(1e3*t,1e3*e),v.value){v.value.intensity=100+100*Math.sin(2*t)}}),(e,t)=>(R(),F(A,null,[C("primitive",{object:L(m).children[0]},[B(k,{object:L(m).children[0].children},null,8,["object"])],8,O),C("primitive",{object:L(m).children[1]},null,8,K),C("primitive",{object:L(m).children[2]},null,8,N),C("primitive",{object:L(m).children[3]},null,8,U),C("primitive",{object:L(m).children[4],ref_key:"spotLightRef",ref:v},null,8,T)],64))}}),{defineComponent:H}=await e("vue"),{unref:I,createVNode:J,createElementVNode:q,Suspense:Y,withCtx:Q,openBlock:X,createBlock:Z,normalizeProps:ee,guardReactiveProps:te,Fragment:ne,createElementBlock:oe}=await e("vue"),se=await e("three"),{reactive:re,watch:ie,ref:ae}=await e("vue"),ce=H({__name:"svelteMachine",setup(e){const t=re({clearColor:"#201919",windowSize:!0,antialias:!0,shadows:!0,shadowMapType:2,toneMapping:3,toneMappingExposure:1.75}),n=(new se.ObjectLoader).parse({metadata:{version:4.6,type:"Object",generator:"Object3D.toJSON"},object:{type:"PerspectiveCamera",name:"Camera",layers:1,matrix:[-.6267758441936044,-27755575615628914e-33,.7791996157182023,0,.48061725621232265,.787112942007701,.3866009176850464,0,-.6133181019392243,.6168088978962458,-.49334337870258826,0,-80.48773984917322,89.13969162136891,-91.54490099940386,1],up:[0,1,0],fov:50,zoom:1,near:.01,far:1e3,focus:10,aspect:1.1063238359972203,filmGauge:35,filmOffset:0}}),r=ae(null);return ie(()=>r.value,e=>{e.copy(n)}),(e,n)=>(X(),oe(ne,null,[J(I(a)),J(I(o),ee(te(t)),{default:Q(()=>[J(I(s)),q("TresPerspectiveCamera",{ref_key:"cameraRef",ref:r,uuid:"9ca45c84-3c16-48da-b0a2-9e469abea3d1",name:"Camera"},null,512),(X(),Z(Y,null,{default:Q(()=>[J(W)]),_:1}))]),_:1},16)],64))}});export{ce as default};
