import{I as e}from"./iobuffer.X3Ykb-iF1735031078130.js";const t={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function r(e){switch(Number(e)){case t.BYTE:return"byte";case t.CHAR:return"char";case t.SHORT:return"short";case t.INT:return"int";case t.FLOAT:return"float";case t.DOUBLE:return"double";default:return"undefined"}}function n(e){switch(Number(e)){case t.BYTE:case t.CHAR:return 1;case t.SHORT:return 2;case t.INT:case t.FLOAT:return 4;case t.DOUBLE:return 8;default:return-1}}function a(e){switch(String(e)){case"byte":return t.BYTE;case"char":return t.CHAR;case"short":return t.SHORT;case"int":return t.INT;case"float":return t.FLOAT;case"double":return t.DOUBLE;default:return-1}}function i(e,t){if(1!==e){const r=new Array(e);for(let n=0;n<e;n++)r[n]=t();return r}return t()}function s(e,r,n){switch(r){case t.BYTE:return Array.from(e.readBytes(n));case t.CHAR:return function(e){if(0===e.charCodeAt(e.length-1))return e.substring(0,e.length-1);return e}(e.readChars(n));case t.SHORT:return i(n,e.readInt16.bind(e));case t.INT:return i(n,e.readInt32.bind(e));case t.FLOAT:return i(n,e.readFloat32.bind(e));case t.DOUBLE:return i(n,e.readFloat64.bind(e));default:throw new Error("non valid type ".concat(r))}}function o(e,t){if(e)throw new TypeError("Not a valid NetCDF v3.x file: ".concat(t))}function c(e){e.offset%4!=0&&e.skip(4-e.offset%4)}function u(e){const t=e.readUint32(),r=e.readChars(t);return c(e),r}const d=0,f=10,l=11,h=12,b=0;function g(e,t){const n={version:t},a={length:e.readUint32()},i=function(e){const t={};let r,n;const a=e.readUint32();let i;if(a===d)return o(e.readUint32()!==d,"wrong empty tag for list of dimensions"),[];{o(a!==f,"wrong tag for list of dimensions");const t=e.readUint32();i=new Array(t);for(let a=0;a<t;a++){const t=u(e),s=e.readUint32();s===b&&(r=a,n=t),i[a]={name:t,size:s}}}void 0!==r&&(t.recordId=r);void 0!==n&&(t.recordName=n);return t.dimensions=i,t}(e);Array.isArray(i)||(a.id=i.recordId,a.name=i.recordName,n.dimensions=i.dimensions),n.globalAttributes=m(e);const s=function(e,t,n){const a=e.readUint32();let i,s=0;if(a===d)return o(e.readUint32()!==d,"wrong empty tag for list of variables"),[];{o(a!==l,"wrong tag for list of variables");const c=e.readUint32();i=new Array(c);for(let a=0;a<c;a++){const c=u(e),d=e.readUint32(),f=new Array(d);for(let t=0;t<d;t++)f[t]=e.readUint32();const l=m(e),h=e.readUint32();o(h<1&&h>6,"non valid type ".concat(h));const b=e.readUint32();let g=e.readUint32();2===n&&(o(g>0,"offsets larger than 4GB not supported"),g=e.readUint32());let v=!1;void 0!==t&&f[0]===t&&(s+=b,v=!0),i[a]={name:c,dimensions:f,attributes:l,type:r(h),size:b,offset:g,record:v}}}return{variables:i,recordStep:s}}(e,null==a?void 0:a.id,t);return Array.isArray(s)||(n.variables=s.variables,a.recordStep=s.recordStep),n.recordDimension=a,n}function m(e){const t=e.readUint32();let n;if(t===d)return o(e.readUint32()!==d,"wrong empty tag for list of attributes"),[];{o(t!==h,"wrong tag for list of attributes");const a=e.readUint32();n=new Array(a);for(let t=0;t<a;t++){const a=u(e),i=e.readUint32();o(i<1||i>6,"non valid type ".concat(i));const d=e.readUint32(),f=s(e,i,d);c(e),n[t]={name:a,type:r(i),value:f}}}return n}function v(){const e=[];e.push("DIMENSIONS");for(const r of this.dimensions)e.push("  ".concat(r.name.padEnd(30)," = size: ").concat(r.size));e.push(""),e.push("GLOBAL ATTRIBUTES");for(const r of this.globalAttributes)e.push("  ".concat(r.name.padEnd(30)," = ").concat(r.value));const t=JSON.parse(JSON.stringify(this.variables));e.push(""),e.push("VARIABLES:");for(const r of t){r.value=this.getDataVariable(r);let t=JSON.stringify(r.value);t.length>50&&(t=t.substring(0,50)),isNaN(r.value.length)||(t+=" (length: ".concat(r.value.length,")")),e.push("  ".concat(r.name.padEnd(30)," = ").concat(t))}return e.join("\n")}class A{constructor(t){this.toString=v;const r=new e(t);r.setBigEndian(),o("CDF"!==r.readChars(3),"should start with CDF");const n=r.readByte();o(n>2,"unknown version"),this.header=g(r,n),this.buffer=r}get version(){return 1===this.header.version?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}getAttribute(e){const t=this.globalAttributes.find((t=>t.name===e));return t?t.value:null}getDataVariableAsString(e){const t=this.getDataVariable(e);return t?t.join(""):null}get variables(){return this.header.variables}getDataVariable(e){let t;if(t="string"==typeof e?this.header.variables.find((t=>t.name===e)):e,void 0===t)throw new Error("Not a valid NetCDF v3.x file: variable not found");return this.buffer.seek(t.offset),t.record?function(e,t,r){const i=a(t.type),o=t.size?t.size/n(i):1,c=r.length,u=new Array(c),d=r.recordStep;if(!d)throw new Error("recordDimension.recordStep is undefined");for(let n=0;n<c;n++){const t=e.offset;u[n]=s(e,i,o),e.seek(t+d)}return u}(this.buffer,t,this.header.recordDimension):function(e,t){const r=a(t.type),i=t.size/n(r),o=new Array(i);for(let n=0;n<i;n++)o[n]=s(e,r,1);return o}(this.buffer,t)}dataVariableExists(e){return void 0!==this.header.variables.find((t=>t.name===e))}attributeExists(e){return void 0!==this.globalAttributes.find((t=>t.name===e))}}export{A as N};
