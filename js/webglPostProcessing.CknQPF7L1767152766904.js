import{importShared as e}from"./3d-tiles-renderer.CPyPbRB51767152766904.js";import{initShaders as t,create as n,ortho as o,lookAt as r,translate as i,scale as a}from"./ice-utils.bUSDtp9-1767152766904.js";import{Pane as f}from"./tweakpane.BbuIEN141767152766904.js";var m="attribute vec3 aPosition;\nattribute vec2 aTexCoords;\n\nuniform mat4 uProjection;\nuniform mat4 uView;\nuniform mat4 uModel;\n\nvarying vec2 texCoords;\n\nvoid main()\n{\n    texCoords=aTexCoords;\n    gl_Position=uProjection*uView*uModel*vec4(aPosition,1.);\n}",E="precision mediump float;\n\nvarying vec2 texCoords;\n\nuniform sampler2D textureSampler;\n\nvoid main()\n{\n    gl_FragColor=texture2D(textureSampler,texCoords);\n}";const{defineComponent:l}=await e("vue"),{unref:_,createElementVNode:u,openBlock:d,createElementBlock:c}=await e("vue"),s={id:"canvaswebgl"},T=["src"],{reactive:R}=await e("vue"),x=l({__name:"webglPostProcessing",setup(e){let l,x,A,g,F,b,B,U,v,p,P,y,C;const D=1,h=.71,w=.76,L=new f({title:"参数"}),M=R({hidden:!0,offset_right_top:{x:.5,y:.5},offset_right_bottom:{x:.5,y:.5},offset_left_top:{x:.5,y:.5},offset_left_bottom:{x:.5,y:.5},overlay:{r:1,g:0,b:.33}});L.addBlade({view:"slider",label:"颜色",min:0,max:1,value:.5}).on("change",e=>{X(),x.uniform1f(y,e.value)});let N=new Float32Array([.5,.5,0,1,1,.5,-.5,0,1,0,-.5,-.5,0,0,0,-.5,.5,0,0,1]);L.addBinding(M,"hidden",{label:"是否后处理"}),L.addBinding(M,"offset_right_top",{picker:"inline",x:{min:0,max:1},y:{min:0,max:1}}).on("change",e=>{N[0]=M.offset_right_top.x,N[1]=M.offset_right_top.y,X()}),L.addBinding(M,"offset_right_bottom",{picker:"inline",x:{min:-1,max:1},y:{min:-1,max:1}}).on("change",e=>{N[5]=M.offset_right_bottom.x,N[6]=M.offset_right_bottom.y,X()}),L.addBinding(M,"offset_left_bottom",{picker:"inline",x:{min:-1,max:1},y:{min:-1,max:1}}).on("change",e=>{N[10]=M.offset_left_bottom.x,N[11]=M.offset_left_bottom.y,X()}),L.addBinding(M,"offset_left_top",{picker:"inline",x:{min:-1,max:1},y:{min:-1,max:1}}).on("change",e=>{N[15]=M.offset_left_top.x,N[16]=M.offset_left_top.y,X()});const S=function(){l=document.querySelector("#canvaswebgl"),l.width=window.innerWidth,l.height=window.innerHeight,x=l.getContext("webgl"),x&&(!function(){const e=new Float32Array([.5,.5,0,1,1,.5,-.5,0,1,0,-.5,-.5,0,0,0,-.5,.5,0,0,1]),n=new Uint8Array([0,1,2,0,2,3]);g=O(e,n),A=t(x,m,E),v=x.getUniformLocation(A,"uProjection"),p=x.getUniformLocation(A,"uView"),P=x.getUniformLocation(A,"uModel"),C=G(document.getElementById("logo-texture"))}(),X(),x.enable(x.BLEND),x.blendFunc(x.SRC_ALPHA,x.ONE_MINUS_SRC_ALPHA),I())};function I(){x.bindFramebuffer(x.FRAMEBUFFER,B),x.clearColor(D,h,w,1),x.clear(x.COLOR_BUFFER_BIT),function(){x.useProgram(A),x.bindBuffer(x.ARRAY_BUFFER,g);const e=n();o(e,0,l.width,l.height,0,.1,100),x.uniformMatrix4fv(v,!1,e);const t=n();r(t,[0,0,1],[0,0,0],[0,1,0]),x.uniformMatrix4fv(p,!1,t),Y(C,600,600),Y(C,400,400)}(),x.bindFramebuffer(x.FRAMEBUFFER,null),M.hidden&&(x.clear(x.COLOR_BUFFER_BIT),x.clearColor(0,0,1,1),x.bindBuffer(x.ARRAY_BUFFER,F),x.useProgram(b),x.bindTexture(x.TEXTURE_2D,U)),x.drawElements(x.TRIANGLES,6,x.UNSIGNED_BYTE,0),requestAnimationFrame(I)}function Y(e,t,o){let r=n();i(r,r,[t,o,0]),a(r,r,[250,250,0]),x.uniformMatrix4fv(P,!1,r),x.bindTexture(x.TEXTURE_2D,e),x.drawElements(x.TRIANGLES,6,x.UNSIGNED_BYTE,0)}function X(){const e=new Uint8Array([0,1,2,0,2,3]);F=O(N,e),b=t(x,"attribute vec3 aPosition;\nattribute vec2 aTexCoords;\n\nvarying vec2 texCoords;\n\nvoid main()\n{\n    texCoords=aTexCoords;\n    gl_Position=vec4(aPosition,1.);\n}","precision mediump float;\n\nvarying vec2 texCoords;\n\nuniform sampler2D textureSampler;\nuniform float mixParam;\nvoid main()\n{\n    \n    vec4 color=mix(texture2D(textureSampler,texCoords),vec4(.1098,.6784,.1843,1.),mixParam);\n    gl_FragColor=color;\n}"),y=x.getUniformLocation(b,"mixParam"),x.getUniformLocation(b,"color"),U=G(l),B=x.createFramebuffer(),x.bindFramebuffer(x.FRAMEBUFFER,B),x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_2D,U,0),x.bindFramebuffer(x.FRAMEBUFFER,null)}function G(e){const t=x.createTexture();return x.bindTexture(x.TEXTURE_2D,t),e instanceof HTMLImageElement?x.texImage2D(x.TEXTURE_2D,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,x.RGBA,e.width,e.height,0,x.RGBA,x.UNSIGNED_BYTE,null),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.NEAREST),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.NEAREST),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),t}function O(e,t){const n=x.createBuffer();x.bindBuffer(x.ARRAY_BUFFER,n),x.bufferData(x.ARRAY_BUFFER,e,x.STATIC_DRAW);const o=3*Float32Array.BYTES_PER_ELEMENT+2*Float32Array.BYTES_PER_ELEMENT;x.vertexAttribPointer(0,3,x.FLOAT,!1,o,0),x.enableVertexAttribArray(0),x.vertexAttribPointer(1,2,x.FLOAT,!1,o,3*Float32Array.BYTES_PER_ELEMENT),x.enableVertexAttribArray(1);const r=x.createBuffer();return x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,r),x.bufferData(x.ELEMENT_ARRAY_BUFFER,t,x.STATIC_DRAW),x.bindBuffer(x.ARRAY_BUFFER,null),n}return(e,t)=>(d(),c("canvas",s,[u("img",{id:"logo-texture",src:_("./")+"./logo.png",style:{display:"none"},onLoad:S},null,40,T)]))}});export{x as default};
