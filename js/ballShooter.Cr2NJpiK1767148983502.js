import{importShared as _}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{zr as V,Kk as N}from"./index.DTe2qqjO1767148983502.js";import{_sfc_main as z}from"./XRcom.vue_vue_type_script_setup_true_lang.Cd5sxXGy1767148983502.js";const{BufferGeometry:G,Float32BufferAttribute:S}=await _("three");class X extends G{constructor(i=1,m=1,l=1,u=1,p=1,c=1){super(),u=Math.floor(u),p=Math.floor(p),c=Math.floor(c);const n=i/2,s=m/2,r=l/2,B=i/u,R=m/p,E=l/c,d=[];let f=-n,t=-s,o=-r;for(let e=0;e<=u;e++)d.push(f,-s,-r,f,s,-r),d.push(f,s,-r,f,s,r),d.push(f,s,r,f,-s,r),d.push(f,-s,r,f,-s,-r),f+=B;for(let e=0;e<=p;e++)d.push(-n,t,-r,n,t,-r),d.push(n,t,-r,n,t,r),d.push(n,t,r,-n,t,r),d.push(-n,t,r,-n,t,-r),t+=R;for(let e=0;e<=c;e++)d.push(-n,-s,o,-n,s,o),d.push(-n,s,o,n,s,o),d.push(n,s,o,n,-s,o),d.push(n,-s,o,-n,-s,o),o+=E;this.setAttribute("position",new S(d,3))}}const{Clock:F,Vector3:k,Quaternion:H,Matrix4:j}=await _("three"),q="https://cdn.skypack.dev/@dimforge/rapier3d-compat@0.15.0",U=60,W=new k(1,1,1),P=new k;let x=null;function Z(w){const i=w.parameters;if(w.type==="BoxGeometry"){const m=i.width!==void 0?i.width/2:.5,l=i.height!==void 0?i.height/2:.5,u=i.depth!==void 0?i.depth/2:.5;return x.ColliderDesc.cuboid(m,l,u)}if(w.type==="SphereGeometry"||w.type==="IcosahedronGeometry"){const m=i.radius!==void 0?i.radius:1;return x.ColliderDesc.ball(m)}return null}async function Q(){x===null&&(x=await import(q),await x.init());const w=new k(0,-9.81,0),i=new x.World(w),m=[],l=new WeakMap,u=new k,p=new H,c=new j;function n(t){t.traverse(o=>{if(o.isMesh){const e=o.userData.physics;e&&s(o,e.mass,e.restitution)}})}function s(t,o=0,e=0){const a=Z(t.geometry);if(a===null)return;a.setMass(o),a.setRestitution(e);const h=t.isInstancedMesh?r(t,o,a):B(t.position,t.quaternion,o,a);o>0&&(m.push(t),l.set(t,h))}function r(t,o,e){const a=t.instanceMatrix.array,h=[];for(let y=0;y<t.count;y++){const b=u.fromArray(a,y*16+12);h.push(B(b,null,o,e))}return h}function B(t,o,e,a){const h=e>0?x.RigidBodyDesc.dynamic():x.RigidBodyDesc.fixed();h.setTranslation(...t),o!==null&&h.setRotation(o);const y=i.createRigidBody(h);return i.createCollider(a,y),y}function R(t,o,e=0){let a=l.get(t);t.isInstancedMesh&&(a=a[e]),a.setAngvel(P),a.setLinvel(P),a.setTranslation(o)}function E(t,o,e=0){let a=l.get(t);t.isInstancedMesh&&(a=a[e]),a.setLinvel(o)}const d=new F;function f(){i.timestep=d.getDelta(),i.step();for(let t=0,o=m.length;t<o;t++){const e=m[t];if(e.isInstancedMesh){const a=e.instanceMatrix.array,h=l.get(e);for(let y=0;y<h.length;y++){const b=h[y],I=b.translation();p.copy(b.rotation()),c.compose(I,p,W).toArray(a,y*16)}e.instanceMatrix.needsUpdate=!0,e.computeBoundingSphere()}else{const a=l.get(e);e.position.copy(a.translation()),e.quaternion.copy(a.rotation())}}}return setInterval(f,1e3/U),{addScene:n,addMesh:s,setMeshPosition:R,setMeshVelocity:E}}const{withAsyncContext:K,defineComponent:O}=await _("vue"),{unref:M,createElementVNode:C,Fragment:J,openBlock:Y,createElementBlock:ee}=await _("vue"),te=["geometry","material"],ne=["rotation-z","geometry","material"],oe=["rotation-z","geometry","material"],re=["rotation-x","geometry","material"],se=["rotation-x","geometry","material"],ae=["object"],{onMounted:ie}=await _("vue"),v=await _("three"),ce=O({__name:"physicsBalls",props:{XRcom:{default:null}},async setup(w){let i,m;const l=w,u=new v.BoxGeometry(6,2,6),p=new v.MeshNormalMaterial({visible:!1}),c={physics:{mass:0}},n=new v.IcosahedronGeometry(.08,3),s=new v.MeshLambertMaterial,r=new v.InstancedMesh(n,s,800);r.instanceMatrix.setUsage(v.DynamicDrawUsage),r.userData.physics={mass:1,restitution:1.1};const B=new v.Matrix4,R=new v.Color;for(let e=0;e<r.count;e++){const a=Math.random()*4-2,h=Math.random()*4,y=Math.random()*4-2;B.setPosition(a,h,y),r.setMatrixAt(e,B),r.setColorAt(e,R.setHex(16777215*Math.random()))}const{scene:E}=V(),d=([i,m]=K(()=>Q()),i=await i,m(),i);ie(()=>{d.addScene(E.value)});let f=0;const t=new v.Vector3;function o(e){e.userData.isSelecting&&(d.setMeshPosition(r,e.position,f),t.x=(Math.random()-.5)*2,t.y=(Math.random()-.5)*2,t.z=Math.random()-9,t.applyQuaternion(e.quaternion),d.setMeshVelocity(r,t,f),++f===r.count&&(f=0))}return l.XRcom.onBeforeLoop(()=>{o(l.XRcom.controller0),o(l.XRcom.controller1)}),(e,a)=>(Y(),ee(J,null,[C("TresMesh",{name:"floor",position:[0,-1,0],geometry:M(u),material:M(p),userData:c},null,8,te),C("TresMesh",{name:"wallPX",position:[4,3,0],"rotation-z":Math.PI/2,geometry:M(u),material:M(p),userData:c},null,8,ne),C("TresMesh",{name:"wallNX",position:[-4,3,0],"rotation-z":Math.PI/2,geometry:M(u),material:M(p),userData:c},null,8,oe),C("TresMesh",{name:"wallPZ",position:[0,3,4],"rotation-x":Math.PI/2,geometry:M(u),material:M(p),userData:c},null,8,re),C("TresMesh",{name:"wallNZ",position:[0,3,-4],"rotation-x":Math.PI/2,geometry:M(u),material:M(p),userData:c},null,8,se),C("primitive",{object:M(r)},null,8,ae)],64))}}),{defineComponent:le}=await _("vue"),{unref:ue,createElementVNode:$,createVNode:de,openBlock:D,createBlock:A,createCommentVNode:pe,Suspense:me,withCtx:fe,Fragment:he,createElementBlock:ye}=await _("vue"),_e=["geometry"],{ref:we,watch:Me}=await _("vue"),g=await _("three"),ge=le({__name:"ballShooterSence",setup(w){const i=new X(6,6,6,10,10,10),m=function(){this?.userData&&(this.userData.isSelecting=!0)},l=function(){this?.userData&&(this.userData.isSelecting=!1)},u=function(c){let n,s;switch(c.targetRayMode){case"tracked-pointer":return n=new g.BufferGeometry,n.setAttribute("position",new g.Float32BufferAttribute([0,0,0,0,0,-1],3)),n.setAttribute("color",new g.Float32BufferAttribute([.5,.5,.5,0,0,0],3)),s=new g.LineBasicMaterial({vertexColors:!0,blending:g.AdditiveBlending}),new g.Line(n,s);case"gaze":return n=new g.RingGeometry(.02,.04,32).translate(0,0,-1),s=new g.MeshBasicMaterial({opacity:.5,transparent:!0}),new g.Mesh(n,s)}return new g.Group},p=we(null);return Me(p,c=>{c&&(c.controller0.addEventListener("selectstart",m),c.controller0.addEventListener("selectend",l),c.controller0.addEventListener("connected",function(n){this.add(u(n.data))}),c.controller0.addEventListener("disconnected",function(){this.remove(this.children[0])}),c.controller1.addEventListener("selectstart",m),c.controller1.addEventListener("selectend",l),c.controller1.addEventListener("connected",function(n){this.add(u(n.data))}),c.controller1.addEventListener("disconnected",function(){this.remove(this.children[0])}))}),(c,n)=>(D(),ye(he,null,[$("TresLineSegments",{position:[0,3,0],geometry:ue(i)},[...n[0]||(n[0]=[$("TresLineBasicMaterial",{color:8421504},null,-1)])],8,_e),de(z,{ref_key:"XRcomRef",ref:p,sessionInit:{optionalFeatures:["depth-sensing"],depthSensing:{usagePreference:["gpu-optimized"],dataFormatPreference:[]}}},null,512),(D(),A(me,null,{default:fe(()=>[p.value?(D(),A(ce,{key:0,XRcom:p.value},null,8,["XRcom"])):pe("",!0)]),_:1}))],64))}}),{defineComponent:ve}=await _("vue"),{createElementVNode:L,unref:xe,createVNode:T,resolveComponent:Be,normalizeProps:Ce,guardReactiveProps:Re,withCtx:Ee,openBlock:be,createBlock:ke}=await _("vue"),{reactive:De}=await _("vue"),Ae=ve({__name:"ballShooter",setup(w){const i=De({clearColor:"#444444",antialias:!0,renderMode:"demand",windowSize:!0});return(m,l)=>{const u=Be("TresCanvas");return be(),ke(u,Ce(Re(i)),{default:Ee(()=>[l[0]||(l[0]=L("TresPerspectiveCamera",{position:[0,1.6,3],fov:50,near:.1,far:100},null,-1)),T(xe(N)),l[1]||(l[1]=L("TresHemisphereLight",{args:[12303291,8947848,3]},null,-1)),l[2]||(l[2]=L("TresDirectionalLight",{position:[1,1,1],intensity:3},null,-1)),T(ge)]),_:1},16)}}});export{Ae as default};
