import{i as e}from"./3d-tiles-renderer.CbgZh8zU1767066396612.js";import{P as t}from"./tweakpane.CqZAnw7f1767066396612.js";import{ad as o}from"./three.BD1hRFgo1767066396612.js";import{F as n,_ as a}from"./@tresjs.B1f7s3pS1767066396612.js";import{b as r,P as i,c as s,M as l,T as p,a as m,d as c}from"./TerrainMeshProvider.CKffEsKG1767066396612.js";import{r as u}from"./raycasterEvent.bA1wkzW-1767066396612.js";import{f as d}from"./utils.C8p1eAWw1767066396612.js";const{defineComponent:g}=await e("vue"),{unref:f,openBlock:h,createElementBlock:w}=await e("vue"),b=["object","rotation"],v=await e("three"),{watchEffect:x,watch:C}=await e("vue"),B=g({__name:"tileMapMesh",props:{bbox:{default:[104.955976,20.149765,120.998419,30.528687]},maxZoom:{default:20},opposite:{type:Boolean,default:!1},genBright:{default:1},genContrast:{default:1},genSaturation:{default:1},monochrome:{default:"#fff"},isMonochrome:{type:Boolean,default:!1},mapCenter:{},tweenInstance:{default:null}},setup(e,{expose:t}){const c=e,{renderer:u,scene:d}=n(),g=new i;g.coordType=r;const B=new s;B.source="https://api.maptiler.com/tiles/terrain-rgb-v2/[z]/[x]/[y].webp?key=L55MtSxL94Yb4hQeWewp",B.coordType=r;const M=new l;M.source="https://webrd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",M.showTileNo=!1,M.useWorker=!0;const j=new p(g,M);if(j.showBoundingBox=!1,j.wireframe=!1,j.flatShading=!1,j.useStandardMaterial=!1,j.filter={opposite:c.opposite,monochrome:c.isMonochrome?{r:.299,g:.587,b:.114}:null,genBright:c.genBright,genContrast:c.genContrast,genSaturation:c.genSaturation},c.monochrome){let e=new v.Color(c.monochrome);j.filter&&(j.filter.monochrome={r:e.r,g:e.g,b:e.b})}const y=new m;y.provider=j,y.bbox=c.bbox,y.maxZoom=c.maxZoom;const S=new v.PerspectiveCamera(60,window.innerWidth/window.innerHeight,1,1e8);S.up=new v.Vector3(0,1,0),S.position.set(c.mapCenter[0],c.mapCenter[2],-c.mapCenter[1]),S.lookAt(new v.Vector3(S.position.x,0,S.position.z-2e3)),y.camera=S;let k=null;x(()=>{u&&!k&&(k=new o(S,u.domElement),k.enableDamping=!0,k.dampingFactor=.05,k.minDistance=600,k.position0.set(S.position.x,S.position.y,S.position.z),k.target.set(S.position.x,0,S.position.z-2e3))}),C(()=>[c.opposite,c.isMonochrome,c.monochrome],([e,t,o])=>{if(j.filter){let n=new v.Color(o);j.filter.opposite=e,j.filter.monochrome=t?{r:n.r,g:n.g,b:n.b}:null}}),C(()=>[c.genBright,c.genContrast,c.genSaturation],([e,t,o])=>{j.filter&&(j.filter.genBright=e,j.filter.genContrast=t,j.filter.genSaturation=o)});const{onBeforeRender:z}=a();return z(()=>{if(u){c.tweenInstance?.update(),k&&k.update(),y.update();const e=50*Math.abs(S.position.y);S.far=e+5e3,S.updateProjectionMatrix(),u.render(d.value,S)}}),t({camera:S,map:y,orbitControl:k}),(e,t)=>(h(),w("primitive",{object:f(y),rotation:[-Math.PI/2,0,0]},null,8,b))}}),{defineComponent:M}=await e("vue"),{mergeProps:j,createVNode:y,resolveComponent:S,withCtx:k,Fragment:z,openBlock:T,createElementBlock:_}=await e("vue"),{reactive:P,shallowRef:I}=await e("vue"),R=await e("three"),E=M({__name:"tileMap",setup(e){const o=c(118.779958,32.017136),n=[o[0],o[1],5e3],a=I(),r=P({opposite:!0,genBright:1.3,genContrast:1,genSaturation:1,isMonochrome:!0,monochrome:"#4688b5",mapCenter:n,tweenInstance:null}),i=new t({title:"参数"});i.addBinding(r,"opposite",{label:"反色"}),i.addBinding(r,"genBright",{label:"高亮",min:.1,max:3,step:.1}),i.addBinding(r,"genContrast",{label:"对比度",min:.1,max:3,step:.1}),i.addBinding(r,"genSaturation",{label:"饱和度",min:.1,max:3,step:.1}),i.addBinding(r,"isMonochrome",{label:"单色滤镜"}),i.addBinding(r,"monochrome",{label:"滤镜颜色"});const s={at:c(118.7425,31.9998),xjk:c(118.7842,32.0418),nss:c(118.7503,31.9082)};i.addBlade({view:"list",label:"飞去",options:[{text:"奥体中心",value:"at"},{text:"新街口",value:"xjk"},{text:"牛首山",value:"nss"}],value:"at"}).on("change",e=>{const t=new R.Vector3(s[e.value][0],2e3,-s[e.value][1]);r.tweenInstance=d(a.value.camera,t,a.value.orbitControl,[0,-300],4e3)});const l=P({clearColor:"#201919",antialias:!0,logarithmicDepthBuffer:!0,renderMode:"manual",outputColorSpace:R.SRGBColorSpace,toneMapping:R.NoToneMapping});return setTimeout(()=>{const e=s.at,t=new R.Vector3(e[0],1600,-e[1]);r.tweenInstance=d(a.value.camera,t,a.value.orbitControl,[-2e3,-2e3],2e3)},1e3),(e,t)=>{const o=S("TresCanvas");return T(),_(z,null,[y(o,j(l,{"window-size":""}),{default:k(()=>[y(B,j(r,{ref_key:"tileMapMeshRef",ref:a,bbox:[80,16,128,50]}),null,16)]),_:1},16),y(u,{tileMapRef:a.value},null,8,["tileMapRef"])],64)}}});export{E as default};
