import{V as t,dc as e,a as s,o,C as i,c5 as n,aL as a,_ as r,B as l,c,bb as h,ba as p,l as d,A as u,a9 as m,bz as _,cg as g,cO as f,cD as y,cP as w,$ as b,t as v,p as S,Q as E,O as x,q as M,M as T,e as k,N as L,ce as C}from"./three.QlBabAUP1755574932434.js";import{m as z,Z as P,e as D,a as A}from"./@tresjs.D3Ezko2-1755574932434.js";import{d as O,ad as q,ab as j,w as $,r as R,b as V,v as F,a2 as I,h as B,e as H,o as Q,f as X,I as Y,j as N,u as W,a7 as G,a8 as U,m as J}from"./@vue.BzMISRrV1755574932434.js";import"./postprocessing.DBDjiblp1755574932434.js";import"./@vueuse.BcmlNMCY1755574932434.js";const Z=(t,e)=>{const[s,o]=e.split("-");return Object.assign(t.style,{left:"left"===o?"0":"center"===o?"50%":"",right:"right"===o?"0":"",top:"top"===s?"0":"bottom"===s?"":"50%",bottom:"bottom"===s?"0":"",transform:`${"center"===o?"translateX(-50%)":""} ${"center"===s?"translateY(-50%)":""}`}),e},K=[["x",0,3],["y",1,4],["z",2,5]],tt=new t;function et({isSphere:t},s,o){t&&(tt.set(0,0,1).applyQuaternion(o.quaternion),K.forEach((([t,o,i])=>{const n=tt[t];let a=s[o],r=a.userData.opacity;a.material.opacity=e(n>=0?r:r/2,0,1),a=s[i],r=a.userData.opacity,a.material.opacity=e(n>=0?r/2:r,0,1)})))}const st=new o,ot=new s,it=(t,e,s,o)=>{ot.set((t.clientX-e.left)/e.width*2-1,-(t.clientY-e.top)/e.height*2+1),st.setFromCamera(ot,s);const i=st.intersectObjects(o,!1),n=i.length?i[0]:null;return n&&n.object.visible?n:null},nt=1e-6,at=2*Math.PI,rt=["x","y","z"],lt=[...rt,"nx","ny","nz"],ct=["right","top","front","left","bottom","back"],ht=(t,e=!0)=>{const{material:s,userData:o}=t,{color:i,opacity:n}=e?o.hover:o;s.color.set(i),s.opacity=n},pt=t=>JSON.parse(JSON.stringify(t));function dt(t,...e){if(t instanceof HTMLElement||"object"!=typeof t||null===t)return t;for(const s of e)for(const e in s)"container"!==e&&e in s&&(void 0===t[e]?t[e]=s[e]:"object"!=typeof s[e]||Array.isArray(s[e])||(t[e]=dt(t[e]||{},s[e])));return t}const ut=(t,e=2)=>{const s=new i,o=2*e,{isSphere:l,resolution:c,radius:h,font:p,corners:d,edges:u}=t,m=lt.map((e=>({...t[e],radius:h})));l&&d.enabled&&m.push(d),l&&u.enabled&&m.push(u);const _=document.createElement("canvas"),g=_.getContext("2d");_.width=2*c+2*o,_.height=c*m.length+o*m.length;const[f,y]=function(t,e,s){const o=[...t].sort(((t,e)=>(t.label?.length||0)-(e.label?.length||0))).pop().label,{family:i,weight:n}=s,a=l?Math.sqrt(Math.pow(.7*e,2)/2):e;let r=a,c=0,h=0;do{g.font=`${n} ${r}px ${i}`;const t=g.measureText(o);c=t.width,h=t.fontBoundingBoxDescent,r--}while(c>a&&r>0);const p=a/h,d=Math.min(a/c,p),u=Math.floor(r*d);return[`${n} ${u}px ${i}`,p]}(m,c,p);m.forEach((({radius:t,label:s,color:i,labelColor:n,border:a,hover:{color:r,labelColor:l,border:h}},p)=>{const d=c*p+p*o+e;x(e,d,e,c,t,s,a,i,n),x(c+3*e,d,e,c,t,s,h??a,r??i,l??n)}));const w=m.length,b=e/(2*c),v=e/(6*c),S=1/w,E=new n(_);return E.repeat.set(.5-2*b,S-2*v),E.offset.set(b,1-v),Object.assign(E,{colorSpace:r,wrapS:a,wrapT:a,userData:{offsetX:b,offsetY:v,cellHeight:S}}),E;function x(t,e,o,i,n,a,r,c,h){if(n*=i/2,null!=c&&""!==c&&(p(),g.fillStyle=s.set(c).getStyle(),g.fill()),r&&r.size){const o=r.size*i/2;t+=o,e+=o,i-=r.size*i,n=Math.max(0,n-o),p(),g.strokeStyle=s.set(r.color).getStyle(),g.lineWidth=r.size*i,g.stroke()}function p(){g.beginPath(),g.moveTo(t+n,e),g.lineTo(t+i-n,e),g.arcTo(t+i,e,t+i,e+n,n),g.lineTo(t+i,e+i-n),g.arcTo(t+i,e+i,t+i-n,e+i,n),g.lineTo(t+n,e+i),g.arcTo(t,e+i,t,e+i-n,n),g.lineTo(t,e+n),g.arcTo(t,e,t+n,e,n),g.closePath()}a&&function(t,e,s,o,i){t.font=f,t.textAlign="center",t.textBaseline="middle",t.fillStyle=i,t.fillText(o,e,s+(l?y:0))}(g,t+i/2,e+(i+o)/2,a,s.set(h).getStyle())}},mt=(t,e)=>{const{offset:s,userData:{offsetY:o,cellHeight:i}}=t;s.y=1-(e+1)*i+o};function _t(t,e,s=2,o=2){const i=s/2-t,n=o/2-t,a=t/s,r=(s-t)/s,h=t/o,p=(o-t)/o,d=[i,n,0,-i,n,0,-i,-n,0,i,-n,0],u=[r,p,a,p,a,h,r,h],m=[3*(e+1)+3,3*(e+1)+4,e+4,e+5,2*(e+1)+4,2,1,2*(e+1)+3,3,4*(e+1)+3,4,0],_=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11].map((t=>m[t]));let g,f,y,w,b,v,S,E;for(let l=0;l<4;l++){w=l<1||l>2?i:-i,b=l<2?n:-n,v=l<1||l>2?r:a,S=l<2?p:h;for(let s=0;s<=e;s++)g=Math.PI/2*(l+s/e),f=Math.cos(g),y=Math.sin(g),d.push(w+t*f,b+t*y,0),u.push(v+a*f,S+h*y),s<e&&(E=(e+1)*l+s+4,_.push(l,E,E+1))}return(new l).setIndex(new c(new Uint32Array(_),1)).setAttribute("position",new c(new Float32Array(d),3)).setAttribute("uv",new c(new Float32Array(u),2))}const gt=e=>{const{corners:o,edges:n}=e,a=[],r=ut(e),l=((e,s)=>{const o=new t,{isSphere:i,radius:n,smoothness:a}=e,r=_t(n,a);return lt.map(((t,n)=>{const a=n<3,l=lt[n],c=n?s.clone():s;mt(c,n);const{enabled:m,scale:_,opacity:g,hover:f}=e[l],y={map:c,opacity:g,transparent:!0},w=i?new h(new p(y)):new d(r,new u(y)),b=a?l:l[1];return w.position[b]=(a?1:-1)*(i?1.3:1),i||w.lookAt(o.copy(w.position).multiplyScalar(1.7)),w.scale.setScalar(_),w.renderOrder=1,w.visible=m,w.userData={scale:_,opacity:g,hover:f},w}))})(e,r);a.push(...l),o.enabled&&a.push(...((e,s)=>{const{isSphere:o,corners:i}=e;if(!i.enabled)return[];const{color:n,opacity:a,scale:r,radius:l,smoothness:c,hover:m}=i,_=o?null:_t(l,c),g={transparent:!0,opacity:a},f=[1,1,1,-1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,-1,-1,-1,-1,-1].map((t=>.85*t)),y=new t;return Array(f.length/3).fill(0).map(((t,e)=>{if(o){const t=s.clone();mt(t,6),g.map=t}else g.color=n;const i=o?new h(new p(g)):new d(_,new u(g)),l=3*e;return i.position.set(f[l],f[l+1],f[l+2]),o&&i.position.normalize().multiplyScalar(1.7),i.scale.setScalar(r),i.lookAt(y.copy(i.position).multiplyScalar(2)),i.renderOrder=1,i.userData={color:n,opacity:a,scale:r,hover:m},i}))})(e,r)),n.enabled&&a.push(...((e,s,o)=>{const{isSphere:i,edges:n}=e;if(!n.enabled)return[];const{color:a,opacity:r,scale:l,hover:c,radius:m,smoothness:_}=n,g=i?null:_t(m,_,1.2,.25),f={transparent:!0,opacity:r},y=[0,1,1,0,-1,1,1,0,1,-1,0,1,0,1,-1,0,-1,-1,1,0,-1,-1,0,-1,1,1,0,1,-1,0,-1,1,0,-1,-1,0].map((t=>.925*t)),w=new t;return Array(y.length/3).fill(0).map(((t,e)=>{if(i){const t=s.clone();mt(t,o),f.map=t}else f.color=a;const n=i?new h(new p(f)):new d(g,new u(f)),m=3*e;return n.position.set(y[m],y[m+1],y[m+2]),i&&n.position.normalize().multiplyScalar(1.7),n.scale.setScalar(l),n.lookAt(w.copy(n.position).multiplyScalar(2)),i||n.position.y||(n.rotation.z=Math.PI/2),n.renderOrder=1,n.userData={color:a,opacity:r,scale:l,hover:c},n}))})(e,r,o.enabled?7:6));const c=((t,e)=>{const{isSphere:s,background:{enabled:o,color:i,opacity:n,hover:a}}=e;let r;const l=new u({color:i,side:m,opacity:n,transparent:!0,depthWrite:!1});if(!o)return null;if(s)r=new d(new _(1.8,64,64),l);else{let e;t.forEach((t=>{const s=t.scale.x;t.scale.setScalar(.9),t.updateMatrix();const o=t.geometry.clone();o.applyMatrix4(t.matrix),e=e?g([e,o]):o,t.scale.setScalar(s)})),r=new d(e,l)}return r.userData={color:i,opacity:n,hover:a},r})(l,e),b=(t=>{const e=new i,o=[],n=[],{isSphere:a}=t;if(lt.forEach(((s,i)=>{const{enabled:r,line:l,scale:c,color:h}=t[s];if(!r||!l)return;const p=(a?1.3-c/2:.975)*(i<3?1:-1);o.push(s.includes("x")?p:0,s.includes("y")?p:0,s.includes("z")?p:0,0,0,0);const d=e.set(h).toArray();n.push(...d,...d)})),!o.length)return null;const r=(new f).setPositions(o).setColors(n),l=new y({linewidth:t.lineWidth,vertexColors:!0,resolution:new s(window.innerWidth,window.innerHeight)});return new w(r,l).computeLineDistances()})(e);return[a,c,b]},ft=(t,e=!0)=>{const{material:s,userData:o}=t,{opacity:i,color:n,scale:a}=e?o.hover:o;var r,l;t.scale.setScalar(a),s.opacity=i,s.map?(r=s.map,l=e,r.offset.x=(l?.5:0)+r.userData.offsetX):s.color.set(n)},yt=new T,wt=new k,bt=new t,vt=new s;class St extends b{constructor(e,o,i={}){super(),this.type="ViewportGizmo",this.enabled=!0,this.target=new t,this.animated=!0,this.speed=1,this.animating=!1,this._background=null,this._viewport=new v,this._originalViewport=new v,this._originalScissor=new v,this._dragging=!1,this._distance=0,this._clock=new S,this._targetPosition=new t,this._targetQuaternion=new E,this._quaternionStart=new E,this._quaternionEnd=new E,this._pointerStart=new s,this._focus=null,this.camera=e,this.renderer=o,this.set(i)}get placement(){return this._placement}set placement(t){this._placement=Z(this._domElement,t),this.domUpdate()}set(t={}){this.dispose(),this.options=t,this._options=(t=>{const e=t.type||"sphere",s="sphere"===e,o=t.resolution||s?64:128,{container:i}=t;t.container=void 0,(t=JSON.parse(JSON.stringify(t))).container=i,ct.forEach(((e,s)=>{t[e]&&(t[lt[s]]=t[e])}));const n={enabled:!0,color:16777215,opacity:1,scale:.7,labelColor:2236962,line:!1,border:{size:0,color:14540253},hover:{color:s?16777215:9688043,labelColor:2236962,opacity:1,scale:.7,border:{size:0,color:14540253}}},a={line:!1,scale:s?.45:.7,hover:{scale:s?.5:.7}},r={type:e,container:document.body,size:128,placement:"top-right",resolution:o,lineWidth:20,radius:s?1:.2,smoothness:18,animated:!0,speed:1,background:{enabled:!0,color:s?16777215:14739180,opacity:s?0:1,hover:{color:s?16777215:14739180,opacity:s?.2:1}},font:{family:"sans-serif",weight:900},offset:{top:10,left:10,bottom:10,right:10},corners:{enabled:!s,color:s?15915362:16777215,opacity:1,scale:s?.15:.2,radius:1,smoothness:18,hover:{color:s?16777215:9688043,opacity:1,scale:s?.2:.225}},edges:{enabled:!s,color:s?15915362:16777215,opacity:s?1:0,radius:s?1:.125,smoothness:18,scale:s?.15:1,hover:{color:s?16777215:9688043,opacity:1,scale:s?.2:1}},x:{...pt(n),...s?{label:"X",color:16725587,line:!0}:{label:"Right"}},y:{...pt(n),...s?{label:"Y",color:9100032,line:!0}:{label:"Top"}},z:{...pt(n),...s?{label:"Z",color:2920447,line:!0}:{label:"Front"}},nx:{...pt(a),label:s?"":"Left"},ny:{...pt(a),label:s?"":"Bottom"},nz:{...pt(a),label:s?"":"Back"}};return dt(t,r),rt.forEach((e=>dt(t[`n${e}`],pt(t[e])))),{...t,isSphere:s}})(t),this._camera=this._options.isSphere?new x(-1.8,1.8,1.8,-1.8,5,10):new M(26,1,5,10),this._camera.position.set(0,0,7);const[e,s,o]=gt(this._options);s&&this.add(s),o&&this.add(o),this.add(...e),this._background=s,this._intersections=e;const{container:i,animated:n,speed:a}=this._options;return this.animated=n,this.speed=a,this._container=i?(t=>{const e="string"==typeof t?document.querySelector(t):t;if(!e)throw Error("Invalid DOM element");return e})(i):document.body,this._domElement=(({placement:t,size:e,offset:s,id:o,className:i})=>{const n=document.createElement("div"),{top:a,left:r,right:l,bottom:c}=s;return Object.assign(n.style,{id:o,position:"absolute",zIndex:"1000",height:`${e}px`,width:`${e}px`,margin:`${a}px ${l}px ${c}px ${r}px`,borderRadius:"100%"}),Z(n,t),o&&(n.id=o),i&&(n.className=i),n})(this._options),this._domElement.onpointerdown=t=>this._onPointerDown(t),this._domElement.onpointermove=t=>this._onPointerMove(t),this._domElement.onpointerleave=()=>this._onPointerLeave(),this._container.appendChild(this._domElement),this._controls&&this.attachControls(this._controls),this.update(),this}render(){this.animating&&this._animate();const{renderer:t,_viewport:e}=this,s=t.getScissorTest(),o=t.autoClear;return t.autoClear=!1,t.setViewport(e),s&&t.setScissor(e),t.clear(!1,!0,!1),t.render(this,this._camera),t.setViewport(this._originalViewport),s&&t.setScissor(this._originalScissor),t.autoClear=o,this}domUpdate(){this._domRect=this._domElement.getBoundingClientRect();const t=this.renderer,e=this._domRect,s=t.domElement.getBoundingClientRect();return this._viewport.set(e.left-s.left,t.domElement.clientHeight-(e.top-s.top+e.height),e.width,e.height),t.getViewport(this._originalViewport),t.getScissorTest()&&t.getScissor(this._originalScissor),this}cameraUpdate(){return this._updateOrientation(),this}update(t=!0){return t&&this._controls&&this._controls.update(),this.domUpdate().cameraUpdate()}attachControls(t){return this.detachControls(),this.target=t.target,this._controlsListeners={start:()=>t.enabled=!1,end:()=>t.enabled=!0,change:()=>this.update(!1)},this.addEventListener("start",this._controlsListeners.start),this.addEventListener("end",this._controlsListeners.end),t.addEventListener("change",this._controlsListeners.change),this._controls=t,this}detachControls(){if(this._controlsListeners&&this._controls)return this.target=(new t).copy(this._controls.target),this.removeEventListener("start",this._controlsListeners.start),this.removeEventListener("end",this._controlsListeners.end),this._controls.removeEventListener("change",this._controlsListeners.change),this._controlsListeners=void 0,this._controls=void 0,this}dispose(){this.detachControls(),this.children.forEach((t=>{this.remove(t);const e=t;e.material?.dispose(),e.material?.map?.dispose(),e.geometry?.dispose()})),this._domElement?.remove()}_updateOrientation(t=!0){t&&(this.quaternion.copy(this.camera.quaternion).invert(),this.updateMatrixWorld()),et(this._options,this._intersections,this.camera)}_animate(){const{position:t,quaternion:e}=this.camera;if(t.set(0,0,1),!this.animated)return t.applyQuaternion(this._quaternionEnd).multiplyScalar(this._distance).add(this.target),e.copy(this._targetQuaternion),this._updateOrientation(),this.animating=!1,this.dispatchEvent({type:"change"}),void this.dispatchEvent({type:"end"});const s=this._clock.getDelta()*at*this.speed;this._quaternionStart.rotateTowards(this._quaternionEnd,s),t.applyQuaternion(this._quaternionStart).multiplyScalar(this._distance).add(this.target),e.rotateTowards(this._targetQuaternion,s),this._updateOrientation(),requestAnimationFrame((()=>this.dispatchEvent({type:"change"}))),this._quaternionStart.angleTo(this._quaternionEnd)<nt&&(this.animating=!1,this.dispatchEvent({type:"end"}))}_setOrientation(t){const e=this.camera,s=this.target;this._targetPosition.copy(t).multiplyScalar(this._distance),yt.setPosition(this._targetPosition).lookAt(this._targetPosition,this.position,this.up),this._targetQuaternion.setFromRotationMatrix(yt),this._targetPosition.add(s),yt.lookAt(this._targetPosition,s,this.up),this._quaternionEnd.setFromRotationMatrix(yt),yt.setPosition(e.position).lookAt(e.position,s,this.up),this._quaternionStart.setFromRotationMatrix(yt),this.animating=!0,this._clock.start(),this.dispatchEvent({type:"start"})}_onPointerDown(t){if(!this.enabled)return;const s=t=>{if(!this._dragging){if(((t,e,s=10)=>Math.abs(t.clientX-e.x)<s&&Math.abs(t.clientY-e.y)<s)(t,this._pointerStart))return;this._dragging=!0}const s=vt.set(t.clientX,t.clientY).sub(this._pointerStart).multiplyScalar(1/this._domRect.width*Math.PI),o=wt.setFromVector3(bt.subVectors(this.camera.position,this.target));o.theta=n-s.x,o.phi=e(a-s.y,nt,Math.PI-nt),this.camera.position.setFromSpherical(o).add(this.target),this.camera.lookAt(this.target),this.quaternion.copy(this.camera.quaternion).invert(),this._updateOrientation(!1),this.dispatchEvent({type:"change"})},o=()=>{if(document.removeEventListener("pointermove",s,!1),document.removeEventListener("pointerup",o,!1),!this._dragging)return this._handleClick(t);this._focus&&(ft(this._focus,!1),this._focus=null),this._dragging=!1,this.dispatchEvent({type:"end"})};if(this.animating)return;t.preventDefault(),this._pointerStart.set(t.clientX,t.clientY);const i=(new k).setFromVector3(bt.subVectors(this.camera.position,this.target)),n=i.theta,a=i.phi;this._distance=i.radius,document.addEventListener("pointermove",s,!1),document.addEventListener("pointerup",o,!1),this.dispatchEvent({type:"start"})}_onPointerMove(t){this.enabled&&!this._dragging&&(this._background&&ht(this._background,!0),this._handleHover(t))}_onPointerLeave(){this.enabled&&!this._dragging&&(this._background&&ht(this._background,!1),this._focus&&ft(this._focus,!1),this._domElement.style.cursor="")}_handleClick(t){const e=it(t,this._domRect,this._camera,this._intersections);this._focus&&(ft(this._focus,!1),this._focus=null),e&&(this._setOrientation(e.object.position),this.dispatchEvent({type:"change"}))}_handleHover(t){const e=it(t,this._domRect,this._camera,this._intersections),s=e?.object||null;this._focus!==s&&(this._domElement.style.cursor=s?"pointer":"",this._focus&&ft(this._focus,!1),(this._focus=s)?ft(s,!0):et(this._options,this._intersections,this.camera))}}const Et=O({__name:"viewportGizmo",setup(t){const{camera:e,controls:s,renderer:o,sizes:i}=z(),n=q(),a={...j(n)},r=new St(j(e.value),j(o.value),a);$((()=>s.value),(t=>{t&&(r.attachControls(j(t)),console.log("gizmo attached to controls"))}),{immediate:!0}),$([i.width,i.height],(()=>{r.update()}),{immediate:!0});const{onAfterRender:l}=P();return l((()=>{r.render()})),(t,e)=>null}}),xt=["rotation"],Mt=O({__name:"index",setup(t){const e={color:3355443,labelColor:14540253,hover:{color:4959364,labelColor:16777215}},s={size:300,lineWidth:2,type:"cube",background:{color:4473924,hover:{color:4473924}},x:{label:"  右  ",...e},y:{label:"上",...e},z:{label:"前",...e},nx:{label:"左",...e},ny:{label:"下",...e},nz:{label:"后",...e}},o=R({clearColor:"#201919",shadows:!0,alpha:!1,shadowMapType:C,outputColorSpace:r,toneMapping:L}),i=V(),n=V(),a=F(),{onLoop:l}=D();return l((({elapsed:t})=>{i.value&&(i.value.position.y+=.01*Math.sin(t),n.value.position.y+=.01*Math.sin(t))})),I((()=>{a.value&&(a.value.shadow.mapSize.set(1e3,1e3),a.value.shadow.camera.near=.5,a.value.shadow.camera.far=5e4,a.value.shadow.camera.top=20,a.value.shadow.camera.right=20,a.value.shadow.camera.left=-20,a.value.shadow.camera.bottom=-20)})),(t,e)=>{const r=B("TresCanvas");return Q(),H(r,J(o,{"window-size":""}),{default:X((()=>[e[3]||(e[3]=Y("TresPerspectiveCamera",{position:[15,15,15],fov:45,near:.1,far:1e3,"look-at":[0,0,0]},null,-1)),N(W(A),{makeDefault:""}),e[4]||(e[4]=Y("TresAmbientLight",{intensity:.5},null,-1)),Y("TresMesh",{ref_key:"sphereRef",ref:i,position:[0,4,0],"cast-shadow":""},e[0]||(e[0]=[Y("TresSphereGeometry",{args:[2,32,32]},null,-1),Y("TresMeshToonMaterial",{color:"#006060"},null,-1)]),512),Y("TresMesh",{ref_key:"sphereRef2",ref:n,position:[4,4,0],"cast-shadow":""},e[1]||(e[1]=[Y("TresSphereGeometry",{args:[2,32,32]},null,-1),Y("TresMeshToonMaterial",{color:"#006060"},null,-1)]),512),Y("TresMesh",{rotation:[-Math.PI/2,0,0],"receive-shadow":""},e[2]||(e[2]=[Y("TresPlaneGeometry",{args:[20,20,20,20]},null,-1),Y("TresMeshToonMaterial",null,null,-1)]),8,xt),Y("TresDirectionalLight",{ref_key:"TDirectionalLight",ref:a,position:[10,8,4],intensity:1,"cast-shadow":""},null,512),e[5]||(e[5]=Y("TresDirectionalLight",{position:[10,2,4],intensity:1,"cast-shadow":""},null,-1)),e[6]||(e[6]=Y("TresGridHelper",null,null,-1)),N(W(Et),G(U(s)),null,16)])),_:1},16)}}});export{Mt as default};
