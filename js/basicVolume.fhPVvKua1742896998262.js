import{m as n,e as t,o as e}from"./@tresjs.KzbsBNvc1742896998262.js";import{_ as r}from"./three.0CcRceKb1742896998262.js";import{P as o}from"./tweakpane.ivGeiIdz1742896998262.js";import{d as a,b as i,r as c,w as l,q as u,o as s,H as p,N as v,u as m,e as f,z as _,j as g,g as d,aj as x,ak as h,f as y,al as b,m as S,F as w}from"./@vue.L-brCdZe1742896998262.js";import{_ as z}from"./@fesjs.ATKJ6WD31742896998262.js";import"./postprocessing.JNDZZkh81742896998262.js";import"./@vueuse.AtktgvWs1742896998262.js";import"./vue-router.Nr9hetwf1742896998262.js";import"./lodash-es.pklfUAS51742896998262.js";import"./@qlin.o0hjOMCg1742896998262.js";import"./pinia.c7Udjcar1742896998262.js";import"./@floating-ui.HzHndBae1742896998262.js";import"./@juggle.4EyLec-41742896998262.js";const j=O;!function(n,t){const e=O,r=D();for(;;)try{if(399014===parseInt(e(427))/1*(parseInt(e(406))/2)+parseInt(e(414))/3+-parseInt(e(376))/4+-parseInt(e(398))/5+-parseInt(e(380))/6+parseInt(e(388))/7*(parseInt(e(402))/8)+parseInt(e(403))/9)break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const I=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[O(395)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();!function(){I(this,(function(){const n=O,t=new RegExp(n(418)),e=new RegExp(n(408),"i"),r=F("init");t.test(r+"chain")&&e[n(383)](r+n(371))?F():r("0")}))()}();const k=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[O(395)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();function D(){const n=["function *\\( *\\)","error","log","string","RepeatWrapping","innerHeight","while (true) {}","getElapsedTime","LinearFilter","403267GdLYFN","debu","Vector3","Algorithm Settings","trace","isoValue","then","innerWidth","length","expanded","counter","__proto__","prototype","table","input",'{}.constructor("return this")( )',"rotation-x","toString","bind","2868416cGvXCe","Data3DTexture","u_dt","exception","3965904oIPGUj","needsUpdate","value","test","info","catch","TresSphereGeometry","TresMesh","2018583RLAIXF","u_color","TresShaderMaterial","Cross Section Settings","position","addBinding","Clock","apply","arrayBuffer","Display Settings","1458645UPrpvR","vertexShader","RedFormat","call","16HBMcGW","7913457fYeSSM","gger","minFilter","2pTNiDj","console","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","constructor","addFolder","u_isoValue","stateObject","return (function() ","628659pIeaWj","action","uniforms","wrapT"];return(D=function(){return n})()}k(void 0,(function(){const n=O,t=function(){const n=O;let t;try{t=Function(n(413)+n(372)+");")()}catch(e){t=window}return t}(),e=t.console=t[n(407)]||{},r=[n(420),"warn",n(384),n(419),n(379),n(370),n(431)];for(let o=0;o<r[n(435)];o++){const t=k[n(409)][n(369)][n(375)](k),a=r[o],i=e[a]||t;t[n(368)]=k[n(375)](k),t.toString=i[n(374)][n(375)](i),e[a]=t}}))();const V=[j(373)],M=[j(416),j(399),"fragmentShader"],R=41,P=a({__name:"basicVolumeRendering",setup(e){const a=j,f=window[a(434)],_=window[a(423)],g=i(null),d=i(null),x=new(r[a(394)]);x.start();const h=(new o)[a(410)]({title:a(397)}),y=h[a(410)]({title:a(391)}),b=new(r[a(429)])(.5,.5,.5);y[a(393)](b,"x",{label:"X",min:.02,max:.5,step:.02}),y.addBinding(b,"y",{label:"Y",min:.02,max:.5,step:.02}),y[a(393)](b,"z",{label:"Z",min:.02,max:.5,step:.02}),y[a(366)]=!0;const{camera:S}=n(),w=c({u_camera:{value:S[a(382)]?.[a(392)]},u_resolution:{value:new(r[a(429)])(f,_,1)},u_dt:{value:.004},u_time:{value:0},u_crossSectionSize:{value:b},u_color:{value:1},u_volume:{value:null},u_isoValue:{value:.2},u_alphaVal:{value:.2}}),z=h[a(410)]({title:a(430)});z[a(393)](w[a(378)],a(382),{label:"dt",min:4e-4,max:.016,step:2e-4}),z[a(393)](w[a(389)],"value",{label:"color",min:1,max:3,step:1}),z[a(393)](w.u_alphaVal,"value",{label:"alphaVal",min:.01,max:1,step:.01}),z[a(393)](w[a(411)],a(382),{label:a(432),min:0,max:1,step:.04}),l(d,(n=>{const t=a;if(n){const e=new(r[t(377)])(n,R,R,R);e.format=r[t(400)],e[t(405)]=r[t(426)],e.magFilter=r[t(426)],e[t(417)]=r[t(422)],e[t(381)]=!0,w.u_volume[t(382)]=e}}));const{onLoop:I}=t();return I((()=>{const n=a;w.u_time[n(382)]=x[n(425)]()})),u((()=>{(()=>{const n=a;fetch("/plugins/volumeRendering/image/nucleon_41x41x41_uint8.raw")[n(433)]((t=>t[n(396)]()))[n(433)]((n=>{const t=new Uint8Array(n),e=new Uint8Array(68921);for(let r=0;r<t.length;r++)e[r]=t[r];d.value=e}))[n(385)]((t=>{console[n(419)]("Error fetching volume data:",t)}))})()})),(n,t)=>{const e=a;return s(),p(e(387),{ref_key:"meshRef",ref:g,"rotation-x":Math.PI/-2},[t[0]||(t[0]=v(e(386),{args:[1,16,16]},null,-1)),v(e(390),{uniforms:w,vertexShader:m("precision mediump float;\n\nuniform vec3 u_camera;\nuniform vec3 u_resolution;\nuniform float u_time;\n\nvarying vec3 v_hitPos;\nvarying vec3 v_hitPosWorldSpace;\nvarying vec3 v_cameraObjectSpace;\n\nvoid main() {\n  vec3 pos = position;\n\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\n\n  v_hitPos = position.xyz;\n\n  v_hitPosWorldSpace = (modelMatrix * vec4(position, 1.0)).xyz;\n\n  v_cameraObjectSpace = (inverse(modelMatrix) * vec4(u_camera, 1.0)).xyz;\n}"),fragmentShader:m("precision mediump int;\nprecision mediump float;\n\nuniform vec3 u_camera;\nuniform vec3 u_resolution;\nuniform mediump sampler3D u_volume;\nuniform vec3 u_crossSectionSize;\nuniform float u_dt;\nuniform float u_time;\nuniform float u_color;\nuniform float u_isoValue;\nuniform float u_alphaVal;\n\nvec3 palette(in float t) {\n  vec3 a = vec3(0.5, 0.5, 0.5);\n  vec3 b = vec3(0.5, 0.5, 0.5);\n  vec3 c = vec3(1.0, 1.0, 1.0);\n  vec3 d = vec3(0.00, 0.33, 0.67);\n\n  return a + b * cos(6.28318 * (c * t + d));\n}\n\nvarying vec3 v_hitPos;\nvarying vec3 v_hitPosWorldSpace;\nvarying vec3 v_cameraObjectSpace;\n\nvec2 intersect_box(vec3 orig, vec3 dir) {\n\n  vec3 box_min = vec3(-u_crossSectionSize);\n  vec3 box_max = vec3(u_crossSectionSize);\n  vec3 inv_dir = 1.0 / dir;\n  vec3 tmin_tmp = (box_min - orig) * inv_dir;\n  vec3 tmax_tmp = (box_max - orig) * inv_dir;\n  vec3 tmin = min(tmin_tmp, tmax_tmp);\n  vec3 tmax = max(tmin_tmp, tmax_tmp);\n  float t0 = max(tmin.x, max(tmin.y, tmin.z));\n  float t1 = min(tmax.x, min(tmax.y, tmax.z));\n  return vec2(t0, t1);\n}\n\nvoid main() {\n  vec3 rayOrigin = vec3(0.0, 0.0, -3.0);\n  rayOrigin = v_cameraObjectSpace;\n\n  vec2 uv = 2.0 * gl_FragCoord.xy / u_resolution.xy - 1.0;\n  vec3 rayDir = normalize(vec3(uv, 1.0));\n  rayDir = normalize(v_hitPos - rayOrigin);\n\n  vec2 t_hit = intersect_box(rayOrigin, rayDir);\n  if (t_hit.x > t_hit.y) {\n    discard;\n  }\n\n  t_hit.x = max(t_hit.x, 0.0);\n\n  float dt = u_dt;\n\n  vec4 color = vec4(0.0);\n\n  vec3 p = rayOrigin + t_hit.x * rayDir + 0.5;\n  for (float t = t_hit.x; t < t_hit.y; t += dt) {\n\n    float textureVal = texture(u_volume, p).r;\n\n    vec4 val_color = vec4(0.0);\n    float val_color_alpha = textureVal * 0.1;\n\n    val_color_alpha = smoothstep(0.0, u_alphaVal, val_color_alpha);\n\n    vec3 red = vec3(1.0, 0.0, 0.0);\n    vec3 white = vec3(1.0);\n    if (abs(u_color - 1.0) <= 0.01) {\n      val_color = vec4(white, val_color_alpha);\n    } else if (abs(u_color - 2.0) <= 0.01) {\n      val_color = vec4(mix(red, white, val_color_alpha), val_color_alpha);\n    } else {\n      val_color = vec4(palette(textureVal), val_color_alpha);\n    }\n\n    color.rgb += (1.0 - color.a) * val_color.a * val_color.rgb;\n    color.a += (1.0 - color.a) * val_color.a;\n\n    if (textureVal > u_isoValue) {\n      float gxLess = texture(u_volume, vec3(p.x - rayDir.x * u_dt, p.y, p.z)).r;\n      float gxMore = texture(u_volume, vec3(p.x + rayDir.x * u_dt, p.y, p.z)).r;\n      float dgx = gxMore - gxLess;\n\n      float gyLess = texture(u_volume, vec3(p.x, p.y - rayDir.y * u_dt, p.z)).r;\n      float gyMore = texture(u_volume, vec3(p.x, p.y + rayDir.y * u_dt, p.z)).r;\n      float dgy = gyMore - gyLess;\n\n      float gzLess = texture(u_volume, vec3(p.x, p.y, p.z - rayDir.z * u_dt)).r;\n      float gzMore = texture(u_volume, vec3(p.x, p.y, p.z + rayDir.z * u_dt)).r;\n      float dgz = gzMore - gzLess;\n      vec3 n = normalize(vec3(dgx, dgy, dgz));\n\n      vec3 lightSource = vec3(1.0);\n      vec3 lightDir = normalize(lightSource);\n      float diffuseStrength = max(dot(n, lightDir), 0.0);\n\n      vec3 viewSource = normalize(rayOrigin);\n      vec3 reflectSource = normalize(reflect(-lightSource, n));\n      float specularStrength = max(0.0, dot(viewSource, reflectSource));\n      specularStrength = pow(specularStrength, 64.0);\n\n      color.rgb = diffuseStrength * val_color.rgb + specularStrength * val_color.rgb;\n      color.rgb *= val_color.rgb;\n      color.a = 0.95;\n      break;\n    }\n\n    if (color.a >= 0.95) {\n      break;\n    }\n\n    p += rayDir * dt;\n  }\n\n  gl_FragColor = color;\n}")},null,8,M)],8,V)}}});function O(n,t){const e=D();return O=function(n,t){return e[n-=366]},O(n,t)}function F(n){function t(n){const e=O;if(typeof n===e(421))return function(n){}.constructor(e(424))[e(395)](e(367));1!==(""+n/n).length||n%20==0?function(){return!0}.constructor(e(428)+e(404))[e(401)](e(415)):function(){return!1}.constructor(e(428)+e(404)).apply(e(412)),t(++n)}try{if(n)return t;t(0)}catch(e){}}const L=C;!function(n,t){const e=C,r=W();for(;;)try{if(730151===-parseInt(e(477))/1+-parseInt(e(452))/2+-parseInt(e(465))/3*(parseInt(e(470))/4)+-parseInt(e(446))/5*(-parseInt(e(467))/6)+parseInt(e(448))/7*(parseInt(e(475))/8)+-parseInt(e(450))/9*(-parseInt(e(460))/10)+-parseInt(e(434))/11*(parseInt(e(447))/12))break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const T=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[C(454)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();!function(){T(this,(function(){const n=C,t=new RegExp(n(435)),e=new RegExp(n(444),"i"),r=E("init");t.test(r+"chain")&&e[n(455)](r+n(453))?E():r("0")}))()}();const A=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[C(454)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();function W(){const n=["7199856dWwllS","info","343016OOAvRX","input","apply","test","TresAmbientLight","call","console","table","10tmMEwI","TresCanvas","https://klacansky.com/open-scivis-datasets/skull/skull_256x256x256_uint8.raw","log","constructor","45uzanWn","return (function() ","6fYqMZs","gger","toString","82292SoHLWF","#201919"," https://klacansky.com/open-scivis-datasets/skull/skull_256x256x256_uint8.raw ","basicVolume","action","2579384Iocucq","debu","820342bBQxxR","trace","TresGridHelper","length","538483zgiHVg","function *\\( *\\)","stateObject","_blank","counter","string","__proto__",'{}.constructor("return this")( )',"bind","prototype","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","div","4785710JziYPJ","12zyxctw","7pQTJgl","error"];return(W=function(){return n})()}function C(n,t){const e=W();return C=function(n,t){return e[n-=431]},C(n,t)}A(void 0,(function(){const n=C;let t;try{t=Function(n(466)+n(441)+");")()}catch(o){t=window}const e=t[n(458)]=t[n(458)]||{},r=[n(463),"warn",n(451),n(449),"exception",n(459),n(431)];for(let a=0;a<r[n(433)];a++){const t=A[n(464)][n(443)][n(442)](A),o=r[a],i=e[o]||t;t[n(440)]=A.bind(A),t[n(469)]=i.toString[n(442)](i),e[o]=t}}))();function E(n){function t(n){const e=C;if(typeof n===e(439))return function(n){}[e(464)]("while (true) {}")[e(454)](e(438));1!==(""+n/n)[e(433)]||n%20==0?function(){return!0}.constructor("debu"+e(468))[e(457)](e(474)):function(){return!1}[e(464)](e(476)+e(468)).apply(e(436)),t(++n)}try{if(n)return t;t(0)}catch(e){}}const Z=z(a({__name:L(473),setup(n){const t=c({windowSize:!0,alpha:!0,antialias:!0,autoClear:!1,disableRender:!0}),r=c({enableDamping:!0,enableZoom:!0,enablePan:!0,enableRotate:!0,makeDefault:!0});return(n,o)=>{const a=C,i=f(a(461));return s(),p(w,null,[o[3]||(o[3]=v(a(445),{class:a(451)},[v("a",{href:a(462),target:a(437)},a(472)),v("br"),_(" 请自行下载数据集, 复制到 /plugins/volumeRendering/image/skull_256x256x256_uint8.raw 并更改文件请求指向和 dim 大小 ")],-1)),g(i,S({clearColor:a(471)},t),{default:d((()=>[o[0]||(o[0]=v("TresPerspectiveCamera",{fov:75,near:.001,far:1e3,position:[-1,.4,-1],"look-at":[0,0,0],up:[0,1,0]},null,-1)),o[1]||(o[1]=v(a(456),{intensity:2},null,-1)),g(m(e),x(h(r)),null,16),(s(),y(b,null,{default:d((()=>[g(P,{position:[0,0,0]})])),_:1})),o[2]||(o[2]=v(a(432),{args:[50,50],position:[0,-5,0]},null,-1))])),_:1},16)],64)}}}),[["__scopeId","data-v-925b4c37"]]);export{Z as default};
