import{a5 as S,bC as k,q as d,aH as B,bk as R,bt as x,aD as h,aL as D,aa as j,B as z,o as g,c as E,a1 as o,ac as G,T as p,a6 as P,au as H,r as N,C,J as M,a as v,ag as U,O as V,d0 as L,b3 as O,ak as $,ae as A,af as F}from"./vendor.v0nfbpA-1717750029153.js";import{R as I}from"./Reflector.9wl9qzVb1717750029153.js";import"./OimoPhysicsBuffer.b5DejoFC1717750029153.js";const q=e=>{e.vertexShader=e.vertexShader.replace("void main() {","\n		uniform mat4 textureMatrix;\n		out vec4 vCoord;\n		out vec3 vToEye;\n\n		void main() {\n		"),e.vertexShader=e.vertexShader.replace("#include <project_vertex>","\n		#include <project_vertex>\n\n		vCoord = textureMatrix * vec4(transformed, 1.0);\n		vToEye = cameraPosition - (modelMatrix * vec4(transformed, 1.0)).xyz;\n		")},J=e=>{e.fragmentShader=e.fragmentShader.replace("void main() {","\n		uniform sampler2D reflectMap;\n		uniform float mirror;\n		uniform float mixStrength;\n		in vec4 vCoord;\n		in vec3 vToEye;\n\n		void main() {\n		"),e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>","\n		#include <emissivemap_fragment>\n\n		vec4 normalColor = texture2D(normalMap, vNormalMapUv * normalScale);\n		vec3 reflectNormal = normalize(vec3(normalColor.r * 2.0 - 1.0, normalColor.b, normalColor.g * 2.0 - 1.0));\n		vec3 reflectCoord = vCoord.xyz / vCoord.w;\n		vec2 reflectUv = reflectCoord.xy + reflectCoord.z * reflectNormal.xz * 0.05;\n		vec4 reflectColor = texture2D(reflectMap, reflectUv);\n\n		// Fresnel term\n		vec3 toEye = normalize(vToEye);\n		float theta = max(dot(toEye, normal), 0.0);\n		float reflectance = pow((1.0 - theta), 5.0);\n\n		reflectColor = mix(vec4(0), reflectColor, reflectance);\n\n		diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + reflectColor.rgb * mixStrength);\n		")},W=["rotation-x"],K=["object"],Q=S({__name:"reflectorDiffuse",props:{mirror:{default:1},mixStrength:{default:10},showGridHelper:{type:Boolean,default:!0},color:{default:"#ffffff"}},async setup(e){let t,i;const n=e,u=new k(9.5,10),l=d(),f=d(),s=d(),m=new I,w={mirror:{value:n.mirror},mixStrength:{value:n.mixStrength}},a=([t,i]=B(()=>R(["./plugins/floor/image/polished_concrete_basecolor.jpg","./plugins/floor/image/polished_concrete_normal.jpg","./plugins/floor/image/polished_concrete_orm.jpg"])),t=await t,i(),t);for(var c=0;c<3;c++)a[c].wrapS=x,a[c].wrapT=x,a[c].repeat.set(16,16);const y={color:new h("#444"),metalness:1,roughness:1,map:a[0],metalnessMap:a[2],roughnessMap:a[2],aoMap:a[2],aoMapIntensity:1,normalMap:a[1],normalScale:new D(3,3)},T=r=>{r.uniforms.reflectMap=m.renderTargetUniform,r.uniforms.textureMatrix=m.textureMatrixUniform,r.uniforms=Object.assign(r.uniforms,w),q(r),J(r)};return j(()=>{l.value&&(l.value.attributes.uv1=l.value.attributes.uv),s.value&&(s.value.aoMap.channel=1,s.value.onBeforeCompile=T),f.value&&(f.value.add(m),f.value.onBeforeRender=(r,_,b)=>{m.update(r,_,b)}),n.color&&s.value&&(s.value.color=new h(n.color))}),z(()=>n.showGridHelper,r=>{u.visible=r}),(r,_)=>(g(),E("TresGroup",null,[o("TresMesh",{ref_key:"tmRef",ref:f,"rotation-x":-Math.PI/2,"position-y":-.1},[o("TresPlaneGeometry",{ref_key:"tpgRef",ref:l,args:[10,10]},null,512),o("TresMeshStandardMaterial",G({ref_key:"tmsmRef",ref:s},y),null,16)],8,W),o("primitive",{object:p(u)},null,8,K)]))}}),X=o("TresPerspectiveCamera",{position:[-15,15,-15],fov:45,near:.1,far:1e4,"look-at":[0,0,0]},null,-1),Y=o("TresAmbientLight",{intensity:10},null,-1),Z={position:[0,8,0],intensity:10,color:"#fff"},ee=o("TresMesh",{position:[0,2,4]},[o("TresBoxGeometry",{args:[1,1,1]}),o("TresMeshNormalMaterial")],-1),ae=S({__name:"reflectorDiffuse",setup(e){const t=P({mirror:.9,mixStrength:9,showGridHelper:!0,color:"#69a5c2"}),i=new H({title:"镜面参数",expanded:!0});return i.addBinding(t,"color",{label:"镜面颜色"}),i.addBinding(t,"showGridHelper",{label:"显示网格"}),(n,u)=>{const l=N("TresCanvas");return g(),C(l,{clearColor:"#201919","window-size":""},{default:M(()=>[X,v(p(U),{enableDamping:""}),Y,V(o("TresDirectionalLight",Z,null,512),[[p(L)]]),v(p(O),{args:[1,1,1],color:"orange",position:[3,1,0]}),ee,(g(),C($,null,{default:M(()=>[v(Q,A(F(t)),null,16)]),_:1}))]),_:1})}}});export{ae as default};
