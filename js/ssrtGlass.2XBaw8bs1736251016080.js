import{_ as t}from"./index.HU9m7cHa1736251016080.js";import{_ as e,a9 as n,W as r,p as o,z as i,k as a,s as c,bf as l,C as s}from"./three.RuuDeeIf1736251016080.js";import{m as u,e as f,b as p,a as v,U as d}from"./@tresjs.8C7OKmBm1736251016080.js";import{_ as m}from"./whiteFloorMesh.vue_vue_type_script_setup_true_lang.sQjo7j-21736251016080.js";import{_ as h}from"./skyBoxAmesh.vue_vue_type_script_setup_true_lang.QNejSY5O1736251016080.js";import{P as x}from"./tweakpane.yHWGBmom1736251016080.js";import{d as g,a4 as y,a1 as w,w as b,o as S,D as C,u as _,r as P,e as F,j as I,g as j,J as D,f as z,al as k,aj as N,ak as T,m as B,F as E}from"./@vue.-Mz_IXfk1736251016080.js";import"./index.v8OOvfw11736251016080.js";import"./@fesjs.SlXnoRjV1736251016080.js";import"./vue-router.JOEPJWPi1736251016080.js";import"./lodash-es.guXTxyfJ1736251016080.js";import"./@qlin.yHhFDldE1736251016080.js";import"./pinia.PKDK8ItA1736251016080.js";import"./vue-demi.C4xddsk91736251016080.js";import"./@floating-ui.BPbuo5Gx1736251016080.js";import"./@juggle.7yjBMqoW1736251016080.js";import"./chalk.sAH7iSuz1736251016080.js";/* empty css                                 */import"./iconify-icon.l-H2-fnN1736251016080.js";import"./@iconify.3mYF4lU71736251016080.js";import"./dompurify.rQUea5mq1736251016080.js";import"./@vueuse.HhUha1mw1736251016080.js";import"./utils.5GjgICLz1736251016080.js";import"./default.vue_vue_type_script_setup_true_lang.DJfcA-S11736251016080.js";import"./three-mesh-ui.module.WtIPn7PQ1736251016080.js";var M=R;function R(t,e){var n=V();return(R=function(t,e){return n[t-=240]})(t,e)}!function(t,e){for(var n=R,r=V();;)try{if(708339===parseInt(n(245))/1+-parseInt(n(278))/2*(parseInt(n(283))/3)+parseInt(n(260))/4+-parseInt(n(263))/5+parseInt(n(289))/6*(-parseInt(n(241))/7)+parseInt(n(287))/8+-parseInt(n(243))/9*(parseInt(n(255))/10))break;r.push(r.shift())}catch(o){r.push(r.shift())}}();var W=function(){var t=!0;return function(e,n){var r=t?function(){if(n){var t=n[R(275)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();function V(){var t=['{}.constructor("return this")( )',"42ySVhxe","info","2081403jNgHwk","while (true) {}","1385676pbstLA","blit","warn","trace","return (function() ","Mesh","renderer","input","PlaneGeometry","Scene","10Lqbjqm","toString","add","scene","gger","2905260zjZxze","material","ShaderMaterial","1163215kwGYck","length","prototype","constructor","test","error","mesh","call","table","debu","setRenderTarget","\n                varying vec2 vUv;\n\n                void main() {\n                    vUv = uv;\n                    gl_Position = vec4(position.xy, 0.0, 1.0);    \n                }","apply","gl_FragColor = texture2D(uTexture, vUv);","function *\\( *\\)","2cRUAID","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","camera","  \n                }","console","998187XpATvZ","uniforms","chain","counter","1783832JlBBRF","__proto__","829992DwqHxD","string"];return(V=function(){return t})()}!function(){W(this,(function(){var t=R,e=new RegExp(t(277)),n=new RegExp(t(279),"i"),r=Z("init");e[t(267)](r+t(285))&&n[t(267)](r+t(252))?Z():r("0")}))()}();var A=function(){var t=!0;return function(e,n){var r=t?function(){if(n){var t=n[R(275)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();A(void 0,(function(){var t,e=R;try{t=Function(e(249)+e(240)+");")()}catch(l){t=window}for(var n=t[e(282)]=t[e(282)]||{},r=["log",e(247),e(242),e(268),"exception",e(271),e(248)],o=0;o<r[e(264)];o++){var i=A[e(266)][e(265)].bind(A),a=r[o],c=n[a]||i;i[e(288)]=A.bind(A),i[e(256)]=c.toString.bind(c),n[a]=i}}))();class H{constructor(t,r){var o=R;this[o(261)]=new(e[o(262)])({uniforms:{uTexture:{type:"t",value:null}},vertexShader:o(274),fragmentShader:"\n                uniform sampler2D uTexture;\n\n                varying vec2 vUv;\n\n                void main() {\n                    "+(r||o(276))+o(281),depthTest:!1,depthWrite:!1}),this[o(269)]=new(e[o(250)])(new(e[o(253)])(2,2),this[o(261)]),this[o(280)]=new n(45,window.innerWidth/window.innerHeight,1,1e3),this.renderer=t,this[o(258)]=new(e[o(254)]),this[o(258)][o(257)](this[o(269)])}[M(246)](t,e){var n=M;this.renderer[n(273)](e),this.material[n(284)].uTexture.value=t,this[n(251)].render(this[n(258)],this.camera),this[n(251)][n(273)](null)}}function Z(t){function e(t){var n=R;if(typeof t===n(290))return function(t){}[n(266)](n(244))[n(275)](n(286));1!==(""+t/t)[n(264)]||t%20==0?function(){return!0}[n(266)]("debugger")[n(270)]("action"):function(){return!1}[n(266)](n(272)+n(259)).apply("stateObject"),e(++t)}try{if(t)return e;e(0)}catch(n){}}const U=X;function X(t,e){const n=Y();return(X=function(t,e){return n[t-=310]})(t,e)}!function(t,e){const n=X,r=Y();for(;;)try{if(262997===-parseInt(n(350))/1*(parseInt(n(311))/2)+-parseInt(n(368))/3+-parseInt(n(354))/4*(parseInt(n(330))/5)+-parseInt(n(338))/6+parseInt(n(379))/7*(parseInt(n(324))/8)+-parseInt(n(374))/9+parseInt(n(359))/10)break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const G=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[X(377)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();function Y(){const t=["\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","frontFaceMaterial","\n                uniform sampler2D uPrevDepth;\n                uniform float uCameraFarInverse;\n                uniform float uSample;\n                uniform vec2  uScreenSize;\n\n                varying vec3 vWorldSpaceNormal;\n                varying vec3 vCameraSpacePos;\n\n                void main() {\n\n                    vec2 uv = gl_FragCoord.xy / uScreenSize;\n                    float prevRegisteredDepth = texture2D(uPrevDepth, uv).w;\n                    float currentDepth        = abs(vCameraSpacePos.z) * uCameraFarInverse;\n\n                    if(currentDepth <= prevRegisteredDepth) {\n                        discard;\n                    }\n\n                    gl_FragColor = vec4(vWorldSpaceNormal, currentDepth);    \n                }","266643TcMZVC","setRenderTarget","debu","apply","autoClear","25165ZQvQLN","getFrontFaceTexture","691694MeGvTB","log","length","toString","ShaderMaterial","resultBuffer","blit","FloatType","frontFaceRT","trace","material","ping","DoubleSide","744obxSdX","mesh","counter","\n                uniform float uCameraFarInverse;\n\n                varying vec3 vWorldSpaceNormal;\n                varying vec3 vCameraSpacePos;\n\n                void main() {\n                    float currentDepth = abs(vCameraSpacePos.z) * uCameraFarInverse;\n                    gl_FragColor = vec4(vWorldSpaceNormal, currentDepth);    \n                }","console","clear","978135OoiyVY","gger","\n                varying vec3 vCameraSpacePos;\n                varying vec3 vWorldSpaceNormal;\n\n                void main() {\n                    vCameraSpacePos = (modelViewMatrix * vec4(position, 1.0)).xyz;\n                    vWorldSpaceNormal = normal;\n\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);    \n                }","add","\n                varying vec3 vCameraSpacePos;\n                varying vec3 vWorldSpaceNormal;\n\n                void main() {\n                    vCameraSpacePos = (modelViewMatrix * vec4(position, 1.0)).xyz;\n                    vWorldSpaceNormal = normalize((modelMatrix * vec4(normal, 0.0)).xyz);\n\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);    \n                }","input","call","getBackFaceTexture","812610aPYXmC","pong","test","uSample","texture","constructor",'{}.constructor("return this")( )',"camera","value","blitProgram","__proto__","uniforms","1ZClEzs","prototype","WebGLRenderTarget","string","8TeYqpG","scene","while (true) {}","bind","render","9419260eYWJFQ","return (function() ","Mesh","info","traverse","chain","warn","Scene","function *\\( *\\)","333303Sjjhvu","renderer","uPrevDepth"];return(Y=function(){return t})()}!function(){G(this,(function(){const t=X,e=new RegExp(t(367)),n=new RegExp(t(371),"i"),r=q("init");e[t(340)](r+t(364))&&n.test(r+t(335))?q():r("0")}))()}();const O=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[X(377)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();O(void 0,(function(){const t=X;let e;try{e=Function(t(360)+t(344)+");")()}catch(o){e=window}const n=e.console=e[t(328)]||{},r=[t(312),t(365),t(362),"error","exception","table",t(320)];for(let i=0;i<r[t(313)];i++){const e=O[t(343)][t(351)].bind(O),o=r[i],a=n[o]||e;e[t(348)]=O[t(357)](O),e[t(314)]=a[t(314)][t(357)](a),n[o]=e}}))();class L{constructor(t,n,l){const s=X;this[s(325)]=t.clone(),this[s(345)]=n,this[s(369)]=l,this[s(355)]=new(e[s(366)]),this[s(355)][s(333)](this[s(325)]),this.blitProgram=new H(this[s(369)]),this[s(322)]=new r(innerWidth,innerHeight,{type:o,depthBuffer:!1,stencilBuffer:!1}),this[s(339)]=new(e[s(352)])(innerWidth,innerHeight,{type:o,depthBuffer:!1,stencilBuffer:!1}),this[s(319)]=new r(innerWidth,innerHeight,{type:e[s(318)]}),this[s(372)]=new(e[s(315)])({uniforms:{uCameraFarInverse:{value:1/this[s(345)].far}},vertexShader:s(332),fragmentShader:s(327),depthTest:!0,depthWrite:!0,side:i}),this[s(321)]=new(e[s(315)])({uniforms:{uScreenSize:{value:new a(innerWidth,innerHeight)},uPrevDepth:{type:"t",value:this.ping[s(342)]},uCameraFarInverse:{value:1/this[s(345)].far},uSample:{value:0}},vertexShader:s(334),fragmentShader:s(373),depthTest:!1,depthWrite:!1,side:e[s(323)]}),this[s(325)][s(363)]((t=>{const e=s;t instanceof c&&(t[e(321)]=this[e(321)])}))}compute(t){const n=X;this.renderer[n(375)](this[n(322)]),this[n(369)].clear(),this[n(369)][n(375)](this[n(339)]),this.renderer[n(329)](),this[n(325)].traverse((t=>{const r=n;t instanceof e[r(361)]&&(t[r(321)]=this[r(321)])})),this[n(321)][n(349)].uCameraFarInverse.value=1/this[n(345)].far;for(let e=0;e<t;e++){let t=e%2==0?this.ping:this[n(339)],r=e%2==0?this[n(339)]:this[n(322)];this[n(321)][n(349)][n(370)].value=t[n(342)],this.material.uniforms[n(341)][n(346)]=e,this.renderer[n(378)]=!1,this[n(369)][n(375)](r),this[n(369)][n(358)](this[n(355)],this[n(345)]),this.renderer[n(378)]=!0,this[n(347)][n(317)](r[n(342)],t)}this[n(316)]=t%2==0?this[n(322)]:this[n(339)],this[n(325)].traverse((t=>{t instanceof c&&(t.material=this.frontFaceMaterial)})),this.renderer[n(375)](this[n(319)]),this[n(369)].render(this[n(355)],this[n(345)])}[U(337)](){const t=U;return this[t(316)][t(342)]}[U(310)](){const t=U;return this[t(319)][t(342)]}}function q(t){function e(t){const n=X;if(typeof t===n(353))return function(t){}[n(343)](n(356)).apply(n(326));1!==(""+t/t)[n(313)]||t%20==0?function(){return!0}.constructor(n(376)+n(331))[n(336)]("action"):function(){return!1}[n(343)](n(376)+"gger")[n(377)]("stateObject"),e(++t)}try{if(t)return e;e(0)}catch(n){}}const $=tt;!function(t,e){const n=tt,r=et();for(;;)try{if(787762===parseInt(n(167))/1+parseInt(n(192))/2*(parseInt(n(206))/3)+parseInt(n(145))/4+parseInt(n(135))/5*(-parseInt(n(190))/6)+-parseInt(n(183))/7*(parseInt(n(199))/8)+-parseInt(n(157))/9+parseInt(n(140))/10)break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const J=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n.apply(e,arguments);return n=null,t}}:function(){};return t=!1,r}}();!function(){J(this,(function(){const t=tt,e=new RegExp(t(180)),n=new RegExp(t(147),"i"),r=rt("init");e[t(142)](r+"chain")&&n[t(142)](r+t(128))?rt():r("0")}))()}();const Q=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[tt(172)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();Q(void 0,(function(){const t=tt,e=function(){const t=tt;let e;try{e=Function(t(181)+'{}.constructor("return this")( ));')()}catch(n){e=window}return e}(),n=e[t(156)]=e.console||{},r=[t(196),t(178),t(131),t(124),t(204),t(207),t(164)];for(let o=0;o<r[t(138)];o++){const e=Q[t(186)][t(146)].bind(Q),i=r[o],a=n[i]||e;e[t(134)]=Q[t(144)](Q),e[t(151)]=a[t(151)].bind(a),n[i]=e}}))();const K=["object"];function tt(t,e){const n=et();return(tt=function(t,e){return n[t-=124]})(t,e)}function et(){const t=["uFrontFaceBuffer","length","minFilter","21057620VebaTp","uBackFaceBuffer","test","skyBoxTexture","bind","3618920yIHyfG","prototype","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","modelPath","extintionFactor","stateObject","toString","uExtintionFactor","uniforms","Vector3","ClampToEdgeWrapping","console","12651777VyeACR","uExtintionColor2","magFilter","modelName","counter","traverse","ShaderMaterial","trace","uExposure","call","1433445PnHTlG","Scene","far","exposure","getBackFaceTexture","apply","uCameraPos","extintionColor1","material","reflectionFactor","clone","warn","gger","function *\\( *\\)","return (function() ","wrapT","3581053zCtgNo","convertLinearToSRGB","extintionCol1Random","constructor","uExtinctionFX1","extintionColor2","extintionCol2Random","366RsPYDK","#fff","1394nyNjRt","getFrontFaceTexture","string","Vector2","log","debu","compute","16BYmPWJ","uTime","LinearMipmapLinearFilter","ssrtGlassMesh","sub","exception","innerHeight","105iamvMW","table","action","error","Color","value","setRenderTarget","input","rgb(26, 166, 192)","side","info","position","autoClear","__proto__","102595bFnlHt","Vector4"];return(et=function(){return t})()}const nt=g({__name:$(202),props:{skyBoxTexture:{},modelPath:{},modelName:{},extintionFactor:{default:5},reflectionFactor:{default:1},exposure:{default:0},extintionColor1:{default:"rgb(192,123,25)"},extintionColor2:{default:$(129)},extintionCol1Random:{type:Boolean,default:!1},extintionCol2Random:{type:Boolean,default:!1}},async setup(t){const n=$;let r,o;const a=t,{map:d}=([r,o]=y((()=>p({map:a[n(143)]}))),r=await r,o(),r);d.wrapS=l,d[n(182)]=e[n(155)],d[n(159)]=e[n(201)],d[n(139)]=e[n(201)];const{camera:m,renderer:h,scene:x}=u(),g=new(e[n(163)])({uniforms:{uSkybox:{type:"t",value:d},uBackFaceBuffer:{type:"t",value:null},uFrontFaceBuffer:{type:"t",value:null},uCameraFarInverse:{value:1/m.value[n(169)]},uScreenSizeInv:{value:new(e[n(195)])(1/window.innerWidth,1/window[n(205)])},uCameraPos:{value:new(e[n(154)])(0,0,0)},uTime:{value:0},uExtintionColor1:{value:new(e[n(125)])("#fff")[n(203)](new(e[n(125)])(a.extintionColor1).convertLinearToSRGB())},uExtintionColor2:{value:new s("#fff")[n(203)](new s(a[n(188)]).convertLinearToSRGB())},uExtintionFactor:{value:a[n(149)]},uExposure:{value:a[n(170)]},uReflectionFactor:{value:a.reflectionFactor},uExtinctionFX1:{value:new(e[n(136)])(a[n(185)]?1:0,a[n(189)]?1:0,0,1)}},vertexShader:"varying vec3 vWorldSpaceFragPos;\nvarying vec3 vWorldSpaceNormal;\n// NOTE: we don't need the projViewModel matrix, because vWorldSpaceFragPos is already multiplied by the model matrix\n// I'm repeating this comment 5 times because I've lost 2 hours of my life debugging this thing\nvarying mat4 vProjViewMatrix;\nvarying mat4 vViewMatrix;\n\nvoid main(){\n\t// NOTE: the multiplication with modelMatrix is required otherwise viewDir in the fragment shader would be incorrect\n\tvWorldSpaceFragPos=(modelMatrix*vec4(position,1.)).xyz;\n\tvWorldSpaceNormal=normalize((modelMatrix*vec4(normal,0.)).xyz);\n\t\n\tgl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);\n\tvProjViewMatrix=projectionMatrix*viewMatrix;\n\tvViewMatrix=viewMatrix;\n}",fragmentShader:"uniform sampler2D uSkybox;\nuniform sampler2D uBackFaceBuffer;\nuniform sampler2D uFrontFaceBuffer;\n\nuniform vec3 uExtintionColor1;\nuniform vec3 uExtintionColor2;\nuniform float uExtintionFactor;\nuniform float uExposure;\nuniform float uReflectionFactor;\nuniform vec4 uExtinctionFX1;\n\nuniform float uTime;\n\nuniform vec3 uCameraPos;\nuniform vec2 uScreenSizeInv;\nuniform float uCameraFarInverse;\n\nvarying vec3 vWorldSpaceFragPos;\nvarying vec3 vWorldSpaceNormal;\nvarying mat4 vProjViewMatrix;\nvarying mat4 vViewMatrix;\n\nconst float PI=3.14159265359;\nconst float e=2.7182818284590;\n\nconst float planeSize=3.;\nconst vec3 planeColor=pow(vec3(202./255.,205./255.,185./255.),vec3(3.));\n\nfloat mod289(float x){return x-floor(x*(1./289.))*289.;}\nvec4 mod289(vec4 x){return x-floor(x*(1./289.))*289.;}\nvec4 perm(vec4 x){return mod289(((x*34.)+1.)*x);}\n\nfloat noise(vec3 p){\n\tvec3 a=floor(p);\n\tvec3 d=p-a;\n\td=d*d*(3.-2.*d);\n\t\n\tvec4 b=a.xxyy+vec4(0.,1.,0.,1.);\n\tvec4 k1=perm(b.xyxy);\n\tvec4 k2=perm(k1.xyxy+b.zzww);\n\t\n\tvec4 c=k2+a.zzzz;\n\tvec4 k3=perm(c);\n\tvec4 k4=perm(c+1.);\n\t\n\tvec4 o1=fract(k3*(1./41.));\n\tvec4 o2=fract(k4*(1./41.));\n\t\n\tvec4 o3=o2*d.z+o1*(1.-d.z);\n\tvec2 o4=o3.yw*d.x+o3.xz*(1.-d.x);\n\t\n\treturn o4.y*d.y+o4.x*(1.-d.y);\n}\n\nvec3 acesFilm(const vec3 x){\n\tconst float a=2.51;\n\tconst float b=.03;\n\tconst float c=2.43;\n\tconst float d=.59;\n\tconst float e=.14;\n\treturn clamp((x*(a*x+b))/(x*(c*x+d)+e),0.,1.);\n}\n\n// gets the skybox color from a given view direction\nvec3 getSkyboxColor(vec3 viewDir){\n\t// skybox coordinates\n\tvec2 skyboxUV=vec2(\n\t\t(atan(viewDir.x,viewDir.z)+PI)/(PI*2.),\n\t\t(asin(viewDir.y)+PI*.5)/(PI)\n\t);\n\t\n\tvec3 col=texture2D(uSkybox,skyboxUV).xyz;\n\tcol=pow(col,vec3(2.2));\n\treturn col;\n}\n\nbool refract2(vec3 v,vec3 n,float ni_over_nt,inout vec3 refracted){\n\tvec3 uv=normalize(v);\n\tfloat dt=dot(uv,n);\n\tfloat discriminant=1.-ni_over_nt*ni_over_nt*(1.-dt*dt);\n\tif(discriminant>0.){\n\t\trefracted=ni_over_nt*(v-n*dt)-n*sqrt(discriminant);\n\t\treturn true;\n\t}\n\t\n\treturn false;\n}\n\nvec3 binarySearchHitPoint(vec3 lastP,vec3 hitP,vec3 rayDir){\n\t\n\tfor(int i=0;i<10;i++){\n\t\tvec3 midP=(lastP+hitP)*.5;\n\t\t\n\t\t// project midP in uv space\n\t\tvec4 projCoord=vProjViewMatrix*vec4(midP,1.);\n\t\tprojCoord.xyz/=projCoord.w;\n\t\t\n\t\tvec2 midpNDC=projCoord.xy;\n\t\tvec2 midpUV=midpNDC*.5+.5;\n\t\t\n\t\t// get depth at point\n\t\tvec4 backBuffer=texture2D(uBackFaceBuffer,midpUV);\n\t\tfloat depth=backBuffer.w;\n\t\t\n\t\tfloat midpDepth=abs((vViewMatrix*vec4(midP,1.)).z)*uCameraFarInverse;\n\t\tif(midpDepth>depth){\n\t\t\thitP=midP;\n\t\t}else{\n\t\t\tlastP=midP;\n\t\t}\n\t}\n\t\n\treturn hitP;\n}\n\nvec3 getRefractedColor(vec3 refractionDir,vec3 hitPoint,float refractionIndex){\n\t// move the hitpoint inside the mesh with epsilon\n\thitPoint+=refractionDir*.0001;\n\t\n\t// raymarch!\n\tfloat stepSize=.02;\n\tfloat stepMult=1.5;\n\t\n\tvec3 lastP=hitPoint;\n\tvec3 p=hitPoint;\n\tvec3 hitPNormal;\n\tfloat currStepSize=stepSize;\n\tfloat transmissionDistance=0.;\n\tfor(int i=0;i<20;i++){\n\t\tp+=currStepSize*refractionDir;\n\t\t\n\t\t// project p in uv space\n\t\tvec4 projCoord=vProjViewMatrix*vec4(p,1.);\n\t\tprojCoord.xyz/=projCoord.w;\n\t\t\n\t\tvec2 pNDC=projCoord.xy;\n\t\tvec2 pUV=pNDC*.5+.5;\n\t\t\n\t\t// get depth at point\n\t\tvec4 backBuffer=texture2D(uBackFaceBuffer,pUV);\n\t\tfloat depth=backBuffer.w;\n\t\tvec3 norm=backBuffer.xyz;\n\t\t\n\t\t// get p depth\n\t\tfloat pDepth=abs((vViewMatrix*vec4(p,1.)).z)*uCameraFarInverse;\n\t\t\n\t\tif(pDepth>depth){\n\t\t\t\n\t\t\tvec3 hitp=binarySearchHitPoint(lastP,p,refractionDir);\n\t\t\tp=hitp;\n\t\t\t\n\t\t\t// ************ get the hitpoint normal\n\t\t\tvec4 projCoord=vProjViewMatrix*vec4(p,1.);\n\t\t\tprojCoord.xyz/=projCoord.w;\n\t\t\t\n\t\t\tvec2 pNDC=projCoord.xy;\n\t\t\tvec2 pUV=pNDC*.5+.5;\n\t\t\t\n\t\t\t// get depth at point\n\t\t\thitPNormal=texture2D(uBackFaceBuffer,pUV).xyz;\n\t\t\t// ************ get the hitpoint normal - END\n\t\t\t\n\t\t\tbreak;\n\t\t}\n\t\t\n\t\tlastP=p;\n\t\tcurrStepSize*=stepMult;\n\t}\n\t\n\ttransmissionDistance=length(hitPoint-p);\n\t\n\t// ******************** recalc directions\n\tvec3 outward_normal;\n\tvec3 reflected=reflect(refractionDir,hitPNormal);\n\tfloat ni_over_nt;\n\tvec3 refr;\n\t// vec3 refracted;\n\tfloat reflect_prob;\n\tfloat cosine;\n\t\n\tif(dot(refractionDir,hitPNormal)>0.){\n\t\toutward_normal=-hitPNormal;\n\t\tni_over_nt=refractionIndex;\n\t\tcosine=refractionIndex*dot(refractionDir,hitPNormal);\n\t}else{\n\t\toutward_normal=hitPNormal;\n\t\tni_over_nt=1./refractionIndex;\n\t\tcosine=-dot(refractionDir,hitPNormal);\n\t}\n\t\n\t// if (refract2(refractionDir, outward_normal, ni_over_nt, refracted)) {\n\t\tif(refract2(refractionDir,outward_normal,ni_over_nt,refr)){\n\t\t\tfloat r0=(1.-refractionIndex)/(1.+refractionIndex);\n\t\t\tr0*=r0;\n\t\t\treflect_prob=r0+(1.-r0)*pow((1.-cosine),5.);\n\t\t}else{\n\t\t\treflect_prob=1.;\n\t\t}\n\t\t// ******************** recalc directions - END\n\t\t\n\t\t// ******************** get colors\n\t\tvec3 col;\n\t\tvec3 colrefl;\n\t\tvec3 colrefr;\n\t\t// if(refracted.y < 0.0) {\n\t\t\tif(refr.y<0.){\n\t\t\t\t// float t = p.y / abs(refracted.y);\n\t\t\t\t// vec3 planeHitP = p + refracted * t;\n\t\t\t\tfloat t=p.y/abs(refr.y);\n\t\t\t\tvec3 planeHitP=p+refr*t;\n\t\t\t\tif(abs(planeHitP.x)<planeSize&&abs(planeHitP.z)<planeSize){\n\t\t\t\t\tcolrefr=planeColor;\n\t\t\t\t}else{\n\t\t\t\t\t// colrefr = getSkyboxColor(refracted);\n\t\t\t\t\tcolrefr=getSkyboxColor(refr);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\t// colrefr = getSkyboxColor(refracted);\n\t\t\t\tcolrefr=getSkyboxColor(refr);\n\t\t\t}\n\t\t\t\n\t\t\tif(reflected.y<0.){\n\t\t\t\tfloat t=p.y/abs(reflected.y);\n\t\t\t\tvec3 planeHitP=p+reflected*t;\n\t\t\t\tif(abs(planeHitP.x)<planeSize&&abs(planeHitP.z)<planeSize){\n\t\t\t\t\tcolrefl=planeColor;\n\t\t\t\t}else{\n\t\t\t\t\tcolrefl=getSkyboxColor(reflected);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tcolrefl=getSkyboxColor(reflected);\n\t\t\t}\n\t\t\t\n\t\t\tcol=colrefl*(reflect_prob*uReflectionFactor)+colrefr*(1.-reflect_prob);\n\t\t\t// ******************** get colors\n\t\t\t\n\t\t\tvec3 transm=vec3(1.);\n\t\t\t// const int steps = 8;\n\t\t\tconst int steps=15;\n\t\t\tfloat step=transmissionDistance/float(steps);\n\t\t\tfloat fc=uExtintionFactor*.07;\n\t\t\t\n\t\t\t// raymarching transmission color\n\t\t\t\n\t\t\t// float noiseStrength = 0.8;\n\t\t\tfloat noiseSpeed=.5;\n\t\t\tfloat noiseTimeSpeed=.5;\n\t\t\t\n\t\t\tfor(int i=0;i<steps;i++){\n\t\t\t\tvec3 np=hitPoint+refractionDir*float(i)*step;\n\t\t\t\t\n\t\t\t\tvec3 nnp=np;\n\t\t\t\tvec3 w=normalize(np-vec3(.75,1.5,0.));\n\t\t\t\tvec3 u=vec3(0.,0.,1.);\n\t\t\t\t// vec3 timeOffset = uTime * normalize(np - vec3(0.75, 1.5, 0.0));\n\t\t\t\tvec3 timeOffset=cos(uTime)*w+sin(uTime)*u;\n\t\t\t\tfloat colorNoiseX=noise(np*noiseSpeed+timeOffset*noiseTimeSpeed);\n\t\t\t\tfloat colorNoiseY=noise(np*noiseSpeed+timeOffset*noiseTimeSpeed+vec3(15.3278,125.19879,0.));\n\t\t\t\tfloat colorNoiseZ=noise(np*noiseSpeed+timeOffset*noiseTimeSpeed+vec3(2.6008,78.19879,543.12993));\n\t\t\t\t\n\t\t\t\tfloat targ=length(nnp*.8*uExtinctionFX1.w-vec3(.75,1.5,0.));\n\t\t\t\tfloat targAperture=.25;\n\t\t\t\t\n\t\t\t\t// wave raymarch\n\t\t\t\tif(uExtinctionFX1.z>.5){\n\t\t\t\t\tnnp=np+sin(np.x*2.5+uTime*1.5)*.3;\n\t\t\t\t\ttarg=nnp.y-.85*uExtinctionFX1.w;\n\t\t\t\t}else{\n\t\t\t\t\tnnp=np+vec3(colorNoiseX,colorNoiseY,colorNoiseZ)*1.05;\n\t\t\t\t\tvec3 diff=nnp-vec3(3.3,4.5,0.);\n\t\t\t\t\tfloat angle=(atan(diff.x,diff.y)+PI)/(PI*2.);\n\t\t\t\t\ttarg=length(diff)+sin(angle*32.*PI+uTime*1.5)*.4;\n\t\t\t\t\ttarg*=.475;\n\t\t\t\t\ttargAperture=.5+colorNoiseX*.75;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// what's the color at np?\n\t\t\t\tvec3 col1=uExtintionColor1;\n\t\t\t\tvec3 col2=uExtintionColor2;\n\t\t\t\tif(uExtinctionFX1.x>.5){\n\t\t\t\t\tcol1=vec3(colorNoiseX,colorNoiseY,colorNoiseZ)*.85;\n\t\t\t\t}\n\t\t\t\tif(uExtinctionFX1.y>.5){\n\t\t\t\t\tcol2=vec3(colorNoiseX,colorNoiseY,colorNoiseZ)*.85;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(targ<1.){\n\t\t\t\t\t\n\t\t\t\t\ttransm*=exp(-step*col2*fc);\n\t\t\t\t\t\n\t\t\t\t}else if(targ>1.&&targ<1.+targAperture){\n\t\t\t\t\tfloat t=(targ-1.)/targAperture;\n\t\t\t\t\t\n\t\t\t\t\ttransm*=exp(-step*(col1*t+col2*(1.-t))*fc);\n\t\t\t\t\t\n\t\t\t\t}else if(targ<(1.+targAperture)*1.85){\n\t\t\t\t\ttransm*=exp(-step*col1*fc);\n\t\t\t\t\t\n\t\t\t\t}else{\n\t\t\t\t\t// transm = (col1) * targAperture;\n\t\t\t\t\t// transm *= exp(-step * col1 * uExtintionFactor);\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// return col * uExtintionColor2 * transm;\n\t\t\tcol*=transm;\n\t\t\t\n\t\t\treturn col;\n\t\t}\n\t\t\n\t\tvoid main(){\n\t\t\tvec2 screenUV=gl_FragCoord.xy*uScreenSizeInv;\n\t\t\t\n\t\t\tvec3 viewDir=normalize(vWorldSpaceFragPos-uCameraPos);\n\t\t\tvec3 normal=vWorldSpaceNormal;\n\t\t\tfloat refractionIndex=1.5;\n\t\t\t\n\t\t\tvec3 outward_normal;\n\t\t\tvec3 reflected=reflect(viewDir,normal);\n\t\t\tfloat ni_over_nt;\n\t\t\tvec3 refracted;\n\t\t\tfloat reflect_prob;\n\t\t\tfloat cosine;\n\t\t\t\n\t\t\tif(dot(viewDir,normal)>0.){\n\t\t\t\toutward_normal=-normal;\n\t\t\t\tni_over_nt=refractionIndex;\n\t\t\t\tcosine=refractionIndex*dot(viewDir,normal);\n\t\t\t}else{\n\t\t\t\toutward_normal=normal;\n\t\t\t\tni_over_nt=1./refractionIndex;\n\t\t\t\tcosine=-dot(viewDir,normal);\n\t\t\t}\n\t\t\t\n\t\t\tif(refract2(viewDir,outward_normal,ni_over_nt,refracted)){\n\t\t\t\tfloat r0=(1.-refractionIndex)/(1.+refractionIndex);\n\t\t\t\tr0*=r0;\n\t\t\t\treflect_prob=r0+(1.-r0)*pow((1.-cosine),5.);\n\t\t\t}else{\n\t\t\t\treflect_prob=1.;\n\t\t\t}\n\t\t\t\n\t\t\tvec3 reflectedCol;\n\t\t\tif(reflected.y<0.){\n\t\t\t\tfloat t=vWorldSpaceFragPos.y/abs(reflected.y);\n\t\t\t\tvec3 planeHitP=vWorldSpaceFragPos+reflected*t;\n\t\t\t\tif(abs(planeHitP.x)<planeSize&&abs(planeHitP.z)<planeSize){\n\t\t\t\t\treflectedCol=planeColor;\n\t\t\t\t}else{\n\t\t\t\t\treflectedCol=getSkyboxColor(reflected);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\treflectedCol=getSkyboxColor(reflected);\n\t\t\t}\n\t\t\t\n\t\t\tvec3 col=reflectedCol*reflect_prob*uReflectionFactor+getRefractedColor(refracted,vWorldSpaceFragPos,refractionIndex)*(1.-reflect_prob);\n\t\t\t// getRefractedColor(normalize(refracted + vec3(0.0, 0.0, 0.0)), vWorldSpaceFragPos) * (1.0 - reflect_prob) * 0.333 +\n\t\t\t// getRefractedColor(normalize(refracted + vec3(0.0, 0.15, 0.0)), vWorldSpaceFragPos) * (1.0 - reflect_prob) * 0.333 +\n\t\t\t// getRefractedColor(normalize(refracted + vec3(0.0, 0.35, 0.0)), vWorldSpaceFragPos) * (1.0 - reflect_prob) * 0.333;\n\t\t\t\n\t\t\t// col = getRefractedColor(refracted, vWorldSpaceFragPos) * (1.0 - reflect_prob);\n\t\t\t// vec3 col = getRefractedColor(refracted, vWorldSpaceFragPos);\n\t\t\t// col = getSkyboxColor(reflected) * reflect_prob * 1.0;\n\t\t\t\n\t\t\t// vec3 col = viewDir;\n\t\t\t// gl_FragColor = vec4(col, 1.0);\n\t\t\t// return;\n\t\t\t\n\t\t\tcol*=pow(2.,uExposure);\n\t\t\tcol=acesFilm(col);\n\t\t\tcol=pow(col,vec3(1./2.2));\n\t\t\t\n\t\t\tgl_FragColor=vec4(col,1.);\n\t\t\t// gl_FragColor = vec4(getSkyboxColor(viewDir), 1.0) * 0.5 + vec4(viewDir * 0.5 + 0.5, 1.0);\n\t\t}"}),{nodes:P}=([r,o]=y((()=>v(a[n(148)],{draco:!0,decoderPath:"./draco/"}))),r=await r,o(),r),F=P[n(168)].getObjectByName(a[n(160)]),I=new L(F,m[n(126)],h[n(126)]),j=null==F?void 0:F[n(177)]();null==j||j[n(162)]((t=>{const e=n;t instanceof c&&(t[e(175)]=g,t[e(175)][e(130)]=i)}));const{onAfterLoop:D}=f();return D((({elapsed:t})=>{const e=n;F&&g&&(g[e(153)][e(173)][e(126)]=m[e(126)][e(132)].clone(),g.uniforms[e(200)][e(126)]=t,I[e(198)](6),g[e(153)][e(141)][e(126)]=I[e(171)](),g[e(153)][e(137)].value=I[e(193)](),h.value[e(127)](null),h.value[e(133)]=!1)})),w((()=>{const t=n;a.extintionFactor&&(g.uniforms[t(152)].value=a[t(149)]),a[t(176)]&&(g[t(153)].uReflectionFactor.value=a.reflectionFactor),a[t(170)]&&(g[t(153)][t(165)][t(126)]=a.exposure),a[t(174)]&&(g[t(153)].uExtintionColor1.value=new(e[t(125)])(t(191))[t(203)](new s(a[t(174)])[t(184)]())),a[t(188)]&&(g[t(153)][t(158)][t(126)]=new(e[t(125)])(t(191))[t(203)](new(e[t(125)])(a[t(188)])[t(184)]())),a[t(185)]&&(g[t(153)].uExposure[t(126)]=a.exposure)})),b((()=>a[n(185)]),(t=>{const e=n;g[e(153)][e(187)][e(126)].x=t?1:0}),{immediate:!0}),b((()=>a[n(189)]),(t=>{const e=n;g[e(153)][e(187)][e(126)].y=t?1:0}),{immediate:!0}),(t,e)=>(S(),C("primitive",{object:_(j)},null,8,K))}});function rt(t){function e(t){const n=tt;if(typeof t===n(194))return function(t){}[n(186)]("while (true) {}")[n(172)](n(161));1!==(""+t/t)[n(138)]||t%20==0?function(){return!0}.constructor("debu"+n(179))[n(166)](n(208)):function(){return!1}[n(186)](n(197)+n(179))[n(172)](n(150)),e(++t)}try{if(t)return e;e(0)}catch(n){}}function ot(t,e){const n=st();return(ot=function(t,e){return n[t-=214]})(t,e)}const it=ot;!function(t,e){const n=ot,r=st();for(;;)try{if(724390===-parseInt(n(241))/1+-parseInt(n(243))/2*(parseInt(n(264))/3)+-parseInt(n(246))/4*(-parseInt(n(238))/5)+-parseInt(n(220))/6+-parseInt(n(250))/7*(parseInt(n(242))/8)+-parseInt(n(247))/9+parseInt(n(221))/10)break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const at=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[ot(230)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();!function(){at(this,(function(){const t=ot,e=new RegExp("function *\\( *\\)"),n=new RegExp(t(236),"i"),r=ut("init");e[t(249)](r+t(215))&&n[t(249)](r+"input")?ut():r("0")}))()}();const ct=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[ot(230)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();ct(void 0,(function(){const t=ot;let e;try{e=Function(t(237)+t(251)+");")()}catch(o){e=window}const n=e[t(218)]=e[t(218)]||{},r=[t(254),"warn","info",t(256),t(233),t(239),t(235)];for(let i=0;i<r[t(226)];i++){const e=ct.constructor[t(227)][t(257)](ct),o=r[i],a=n[o]||e;e.__proto__=ct[t(257)](ct),e.toString=a[t(217)][t(257)](a),n[o]=e}}))();const lt=g({__name:it(222),setup(n){const r=it,o={clearColor:r(240),windowSize:!0,toneMapping:e[r(255)],toneMappingExposure:.8},i=P({size:[20,20],color:r(219),shadowColor:"#b8b59e",edge:.35}),a=P({extintionFactor:5,reflectionFactor:1,exposure:0,extintionColor1:r(224),extintionColor2:r(244),extintionCol1Random:!1,extintionCol2Random:!1}),c=new x({title:"参数"});return c.addBinding(a,r(234),{label:"消光系数",min:0,max:10,step:.1}),c[r(253)](a,r(262),{label:r(252),min:0,max:2,step:.1}),c[r(253)](a,"exposure",{label:"曝光系数",min:-1,max:1,step:.1}),c[r(253)](a,"extintionColor1",{label:"消光颜色一"}),c.addBinding(a,"extintionColor2",{label:r(261)}),c[r(253)](a,r(260),{label:"随机色1"}),c[r(253)](a,r(231),{label:r(225)}),(e,n)=>{const c=r,l=F("TresCanvas");return S(),C(E,null,[I(_(t)),I(l,N(T(o)),{default:j((()=>[n[0]||(n[0]=D(c(216),{position:[0,8,-13],fov:45,near:.1,far:1e3,"look-at":[0,0,0]},null,-1)),I(_(d),{enableDamping:""}),n[1]||(n[1]=D(c(263),{intensity:10},null,-1)),(S(),z(k,null,{default:j((()=>[I(m,N(T(i)),null,16)])),_:1})),(S(),z(k,null,{default:j((()=>[I(nt,B({scale:2},a,{modelPath:c(228),modelName:c(248),skyBoxTexture:c(258)}),null,16)])),_:1})),(S(),z(k,null,{default:j((()=>[I(h,{texture:c(258)})])),_:1}))])),_:1},16)],64)}}});function st(){const t=["extintionFactor","trace","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","return (function() ","5391445owTqLJ","table","#201919","45550KdmmSr","120xmDNZr","22114mSmjTY","rgb(26, 166, 192)","debu","4iGOaBC","3339477UvEdVB","statue","test","555877EeumfU",'{}.constructor("return this")( )',"反射系数","addBinding","log","ACESFilmicToneMapping","error","bind","https://opensource-1314935952.cos.ap-nanjing.myqcloud.com/images/skyBox/workshop_blur.jpg","call","extintionCol1Random","消光颜色二","reflectionFactor","TresAmbientLight","3RYynod","stateObject","action","gger","chain","TresPerspectiveCamera","toString","console","#cbcb96","4665588SWGGAI","20425240NfDWiJ","ssrtGlass","string","rgb(192,123,25)","随机色2","length","prototype","https://opensource-1314935952.cos.ap-nanjing.myqcloud.com/model/eCommerce/guanYu.glb","constructor","apply","extintionCol2Random","counter","exception"];return(st=function(){return t})()}function ut(t){function e(t){const n=ot;if(typeof t===n(223))return function(t){}.constructor("while (true) {}")[n(230)](n(232));1!==(""+t/t)[n(226)]||t%20==0?function(){return!0}.constructor(n(245)+n(214))[n(259)](n(266)):function(){return!1}[n(229)](n(245)+n(214)).apply(n(265)),e(++t)}try{if(t)return e;e(0)}catch(n){}}export{lt as default};
