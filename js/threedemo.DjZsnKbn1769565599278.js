import{importShared as e}from"./3d-tiles-renderer.6uaxtGOi1769565599278.js";import{loading$1 as t}from"./generalFont.vue_vue_type_script_setup_true_lang.sjwMvz5V1769565599278.js";import"./default.vue_vue_type_script_setup_true_lang.DmwM9fUy1769565599278.js";import"./three-mesh-ui.module.mVCEkvx01769565599278.js";import"./domPanel.vue_vue_type_style_index_0_lang.BbN2qk_X1769565599278.js";import{loadJweixin as o,loadWebView as r}from"./initScript.DKT7MG_c1769565599278.js";import{useTexture$1 as s,_sfc_main as n,_sfc_main$1 as a}from"./customShaderMaterial.vue_vue_type_script_setup_true_lang.deADwUYZ1769565599278.js";import"./index.vue_vue_type_script_setup_true_lang.Ce0FTFfR1769565599278.js";import{useGLTF as i}from"./index.DydYGDKP1769565599278.js";import{useLoop as l,OrbitControls_default as u}from"./index.CG-C7MIu1769565599278.js";import"./reflectorDiffuse.vue_vue_type_script_setup_true_lang.DhXwFgUC1769565599278.js";import{_sfc_main as p}from"./reflectorDUDV.vue_vue_type_script_setup_true_lang.CQtN5Yfg1769565599278.js";import"./reflectorShaderMesh.vue_vue_type_script_setup_true_lang.sLbeLup01769565599278.js";import"./dynamicRotatingBase.vue_vue_type_script_setup_true_lang.B4WLvGhj1769565599278.js";import"./whiteFloorMesh.vue_vue_type_script_setup_true_lang.DEe-SC6l1769565599278.js";import"./gridPlusCom.vue_vue_type_script_setup_true_lang.fugurZdh1769565599278.js";import"./videoFloor.vue_vue_type_script_setup_true_lang.C6gUBy1H1769565599278.js";import"./digitalGround.vue_vue_type_script_setup_true_lang.BisYWwLN1769565599278.js";import"./imgFloor.vue_vue_type_script_setup_true_lang._w5V7MeE1769565599278.js";import"./reflectorRoundedBox.vue_vue_type_script_setup_true_lang.BYEj0foT1769565599278.js";import"./particleBase.vue_vue_type_script_setup_true_lang.gnHd6A8l1769565599278.js";import"./rippleFloor.vue_vue_type_script_setup_true_lang.C2Pm_CSp1769565599278.js";import{_sfc_main as c}from"./lamboEffect.vue_vue_type_script_setup_true_lang.K9gIkLyE1769565599278.js";import{FMessage as d}from"./index.DDb5RBmU1769565599278.js";const{withAsyncContext:_}=await e("vue"),{unref:m,openBlock:v,createElementBlock:g}=await e("vue"),f=["object","rotation"],{toRaw:h}=await e("vue"),x=await e("three"),y={__name:"dissolveEffectCar",props:{edgeColor:{default:1118481},edgeWidth:{default:.03},dissolveSpeed:{default:.003},funRef:{appear:null,disappear:null}},async setup(e,{expose:t}){let o,r;const n=e,{scene:a,nodes:u,materials:p}=([o,r]=_(()=>i("https://opensource.cdn.icegl.cn/model/industry4/lambo.glb")),o=await o,r(),o);Object.values(u).forEach(e=>{e.isMesh&&(e.name.startsWith("glass")&&e.geometry.computeVertexNormals(),"silver_001_BreakDiscs_0"===e.name&&(e.material=p.BreakDiscs.clone(),e.material.color=new x.Color("#ddd")))}),u.glass_003.scale.setScalar(2.7),p.FrameBlack.color=new x.Color("black"),p.FrameBlack.roughness=0,p.FrameBlack.metalness=.75,p.Chrome.color=new x.Color("#333"),p.Chrome.metalness=1,p.Chrome.roughness=0,p.BreakDiscs.color=new x.Color("#555"),p.BreakDiscs.metalness=.2,p.BreakDiscs.roughness=.2,p.TiresGum.color=new x.Color("#181818"),p.TiresGum.metalness=0,p.TiresGum.roughness=.4,p.GreyElements.color=new x.Color("#292929"),p.GreyElements.metalness=0,u.yellow_WhiteCar_0.material=new x.MeshPhysicalMaterial({roughness:.3,metalness:.05,color:"#111",envMapIntensity:.75,clearcoatRoughness:0,clearcoat:1});const c=([o,r]=_(()=>s(["./plugins/digitalCity/image/smokeparticle.png","./plugins/industry4/image/dissolve.jpg"])),o=await o,r(),o),d=[];let y=!1;const C={dissolveProgress:1,noiseTexture:c[0],edgeColorTexture:c[1]};let w=n.dissolveSpeed;const M=()=>{if(!y){y=!0,w=n.dissolveSpeed;for(const e of d)e.uniforms.dissolveSpeed={value:w},e.uniforms.dissolveProgress={value:0}}},j=()=>{if(!y){y=!0,w=-n.dissolveSpeed;for(const e of d)e.uniforms.dissolveSpeed={value:w},e.uniforms.dissolveProgress={value:1}}};n.funRef.appear=M,n.funRef.disappear=j,t({appear:M,disappear:j}),Object.values(u).forEach(e=>{if(e.isMesh){e.frustumCulled=!1;const t=e.material;t.transparent=!0,t.onBeforeCompile=e=>{d.push(e),e.uniforms.edgeColor={value:new x.Color(n.edgeColor)},e.uniforms.edgeWidth={value:n.edgeWidth},e.uniforms.dissolveSpeed={value:n.dissolveSpeed},e.uniforms.dissolveProgress={value:C.dissolveProgress},e.uniforms.noiseTexture={value:C.noiseTexture},e.uniforms.edgeColorTexture={value:C.edgeColorTexture},e.vertexShader=e.vertexShader.replace("#include <common>",["varying vec2 xUv;","#include <common>"].join("\n")),e.vertexShader=e.vertexShader.replace("#include <uv_vertex>",["xUv = uv;","#include <uv_vertex>"].join("\n")),e.fragmentShader=e.fragmentShader.replace("#include <common>","#include <common>\n\t\t\t\t\t uniform float dissolveProgress;\n\t\t\t\t\t uniform float edgeWidth;\n\t\t\t\t\t uniform vec3 edgeColor;\n\t\t\t\t\t uniform sampler2D noiseTexture;\n\t\t\t\t\t uniform sampler2D edgeColorTexture;\n\t\t\t\t\t varying vec2 xUv;\n\t\t\t\t\t"),e.fragmentShader=e.fragmentShader.replace("#include <dithering_fragment>","#include <dithering_fragment>\n\t\t\t\t\t\t\tfloat noiseValue = texture2D(noiseTexture, xUv).r;\n\t\t\t\t\t\t\tvec4 finalColor = texture2D(edgeColorTexture, xUv);\n\n\t\t\t\t\t\t\tvec3 mixedColor = mix(finalColor.rgb, edgeColor, 0.5);\n\t\t\t\t\t\t\tfinalColor.rgb = mixedColor;\n\n\t\t\t\t\t\t\t// vec4 finalColor = linearToOutputTexel( vec4(edgeColor, gl_FragColor.a) );\n\t\t\t\t\t\t\tfloat alpha = step(noiseValue - edgeWidth, dissolveProgress);\n\t\t\t\t\t\t\tgl_FragColor.a = alpha;\n\t\t\t\t\t\t\tfloat useOrigin = step(noiseValue, dissolveProgress);\n\t\t\t\t\t\t\tgl_FragColor.rgb = mix(finalColor.rgb, gl_FragColor.rgb, useOrigin);")}}});const{onBeforeRender:S}=l();return S(()=>{if(y)for(const e of d){const{dissolveProgress:t,dissolveSpeed:o}=e.uniforms;t.value+=o.value,t.value<0&&(y=!1,n.funRef.aEnd()),t.value>1&&(y=!1,n.funRef.aEnd())}}),(e,t)=>(v(),g("primitive",{object:h(m(a)),scale:.015,rotation:[0,Math.PI/1.5,0]},null,8,f))}},{createElementVNode:C,unref:w,createVNode:M,Suspense:j,withCtx:S,openBlock:P,createBlock:T,Fragment:B,createElementBlock:k}=await e("vue"),E=["rotation"],b=["side"],R=["rotation"],D=["side"],F=await e("three"),I={__name:"otherObject",setup:e=>(e,t)=>(P(),k(B,null,[t[2]||(t[2]=C("TresPerspectiveCamera",{position:[0,10,15],fov:25,near:.1,far:1e4},null,-1)),M(w(u),{autoRotate:""}),t[3]||(t[3]=C("TresHemisphereLight",{intensity:.5},null,-1)),(P(),T(j,null,{default:S(()=>[M(w(p),{position:[0,-1.562,0],reflectivity:2.6,showGridHelper:!1,scale:1.5})]),_:1})),C("TresMesh",{scale:4,position:[3,-1.161,-1.5],rotation:[-Math.PI/2,0,Math.PI/2.5]},[t[0]||(t[0]=C("TresRingGeometry",{args:[.9,1,4,1]},null,-1)),C("TresMeshStandardMaterial",{color:"white",roughness:.75,side:F.DoubleSide},null,8,b)],8,E),C("TresMesh",{scale:4,position:[-3,-1.161,-1],rotation:[-Math.PI/2,0,Math.PI/2.5]},[t[1]||(t[1]=C("TresRingGeometry",{args:[.9,1,3,1]},null,-1)),C("TresMeshStandardMaterial",{color:"white",roughness:.75,side:F.DoubleSide},null,8,D)],8,R),(P(),T(j,null,{default:S(()=>[M(w(n),{resolution:512},{default:S(()=>[M(w(a),{intensity:2,position:[0,1,3],scale:[10,1,1]}),M(w(a),{intensity:2,"rotation-x":Math.PI/2,position:[0,4,-6],scale:[10,1,1]},null,8,["rotation-x"]),M(w(a),{intensity:2,"rotation-x":Math.PI/2,position:[0,4,-3],scale:[10,1,1]},null,8,["rotation-x"]),M(w(a),{intensity:2,"rotation-x":Math.PI/2,position:[0,4,0],scale:[10,1,1]},null,8,["rotation-x"]),M(w(a),{intensity:2,"rotation-x":Math.PI/2,position:[0,4,3],scale:[10,1,1]},null,8,["rotation-x"]),M(w(a),{intensity:2,"rotation-x":Math.PI/2,position:[0,4,6],scale:[10,1,1]},null,8,["rotation-x"]),M(w(a),{intensity:2,"rotation-x":Math.PI/2,position:[0,4,9],scale:[10,1,1]},null,8,["rotation-x"]),M(w(a),{intensity:2,"rotation-y":Math.PI/2,position:[-50,2,0],scale:[100,2,1]},null,8,["rotation-y"]),M(w(a),{intensity:2,"rotation-y":-Math.PI/2,position:[50,2,0],scale:[100,2,1]},null,8,["rotation-y"]),M(w(a),{form:"ring",color:"red",intensity:10,scale:2,position:[10,5,10]})]),_:1})]),_:1})),M(c)],64))},{defineComponent:G}=await e("vue"),{unref:V,createVNode:W,mergeProps:O,Suspense:N,withCtx:U,openBlock:$,createBlock:H,resolveComponent:z,createElementVNode:J,Fragment:A,createElementBlock:L}=await e("vue"),{reactive:Y,onMounted:Z,ref:q}=await e("vue"),K=G({__name:"threedemo",setup(e){const s=q(!1);Z(async()=>{console.log("onMounted"),await o(),await r(),s.value=!0,uni.getEnv?uni.getEnv(e=>{d.success(`当前环境：${JSON.stringify(e)}`)}):d.error("当前web浏览器访问无效，请使用小程序或者app访问该页面")});const n=Y({clearColor:"#15151a",antialias:!1,logarithmicDepthBuffer:!0,renderMode:"manual"}),a=Y({edgeColor:"#111111",edgeWidth:.03,dissolveSpeed:.003,funRef:{appear:null,disappear:null,aEnd:()=>{}}}),i=q(null),l=()=>{s.value&&(console.log("clickMesh"),uni.postMessage?(i.value.funRef.disappear(),uni.postMessage({data:{action:"三维页面发送了消息"}})):d.error("当前web浏览器访问无效，请使用小程序或者app访问该页面"))};return a.funRef.aEnd=()=>{console.log("aEnd"),uni.navigateBack()},(e,o)=>{const r=z("TresCanvas");return $(),L(A,null,[W(V(t)),W(r,O(n,{"window-size":""}),{default:U(()=>[($(),H(N,null,{default:U(()=>[W(y,O(a,{ref_key:"dissolveEffectModelRef",ref:i,onClick:l}),null,16)]),_:1})),W(I)]),_:1},16),o[0]||(o[0]=J("h2",{class:"text-center text-white w-full absolute"},"双击车辆消失后回传信息且跳转",-1))],64)}}});export{K as default};
