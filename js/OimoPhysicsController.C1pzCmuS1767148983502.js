import{importShared as di}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";const{Box2:um,BoxGeometry:xm,BufferGeometry:Az,Float32BufferAttribute:vf,MathUtils:Mm,Vector3:zm}=await di("three");function Pz(){const $a=new Az;return $a.setAttribute("position",new vf([-1,3,0,-1,-1,0,3,-1,0],3)),$a.setAttribute("uv",new vf([0,2,0,0,2,0],2)),$a}const{GLSL3:mm,RawShaderMaterial:pm}=await di("three"),{Color:ym,GLSL3:gm,RawShaderMaterial:Im}=await di("three"),{GLSL3:Vm,RawShaderMaterial:wm}=await di("three"),{GLSL3:km,RawShaderMaterial:Xm}=await di("three"),{GLSL3:Lm,RawShaderMaterial:Ym}=await di("three"),{Color:Zm,GLSL3:dm,RawShaderMaterial:Bm}=await di("three"),{GLSL3:Sm,NoBlending:Am,RawShaderMaterial:Pm}=await di("three"),{GLSL3:Cm,NoBlending:Tm,RawShaderMaterial:Rm}=await di("three"),{GLSL3:Qm,NoBlending:Em,RawShaderMaterial:Dm}=await di("three"),{GLSL3:Nm,NoBlending:Fm,RawShaderMaterial:Gm}=await di("three"),{GLSL3:Jm,NoBlending:$m,RawShaderMaterial:Wm,Vector2:Um}=await di("three"),{GLSL3:Om,NoBlending:Hm,RawShaderMaterial:jm,Vector2:Km}=await di("three"),{GLSL3:qm,NoBlending:ap,RawShaderMaterial:tp,Vector2:rp}=await di("three"),{GLSL3:ip,LinearFilter:op,NearestFilter:np,NoBlending:ep,RawShaderMaterial:sp,TextureLoader:_p,Vector2:vp}=await di("three"),{GLSL3:lp,NoBlending:hp,RawShaderMaterial:cp}=await di("three"),{GLSL3:bp,NoBlending:fp,RawShaderMaterial:up}=await di("three"),{GLSL3:xp,NoBlending:Mp,RawShaderMaterial:zp,Vector2:mp}=await di("three"),Cz=`
vec4 blur13(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.411764705882353) * direction;
  vec2 off2 = vec2(3.2941176470588234) * direction;
  vec2 off3 = vec2(5.176470588235294) * direction;
  color += texture(image, uv) * 0.1964825501511404;
  color += texture(image, uv + (off1 / resolution)) * 0.2969069646728344;
  color += texture(image, uv - (off1 / resolution)) * 0.2969069646728344;
  color += texture(image, uv + (off2 / resolution)) * 0.09447039785044732;
  color += texture(image, uv - (off2 / resolution)) * 0.09447039785044732;
  color += texture(image, uv + (off3 / resolution)) * 0.010381362401148057;
  color += texture(image, uv - (off3 / resolution)) * 0.010381362401148057;
  return color;
}
`,{GLSL3:pp,NoBlending:yp,RawShaderMaterial:gp,Vector2:Ip}=await di("three"),{GLSL3:Vp,NoBlending:wp,RawShaderMaterial:kp}=await di("three"),{GLSL3:Xp,NoBlending:Lp,RawShaderMaterial:Yp,Vector2:Zp}=await di("three"),{GLSL3:dp,NoBlending:Bp,RawShaderMaterial:Sp}=await di("three"),Tz=`
float random(vec2 co) {
    float a = 12.9898;
    float b = 78.233;
    float c = 43758.5453;
    float dt = dot(co.xy, vec2(a, b));
    float sn = mod(dt, 3.14);
    return fract(sin(sn) * c);
}
`,bf=`
${Tz}

vec3 dither(vec3 color) {
    // Calculate grid position
    float grid_position = random(gl_FragCoord.xy);

    // Shift the individual colors differently, thus making it even harder to see the dithering pattern
    vec3 dither_shift_RGB = vec3(0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0);

    // Modify shift acording to grid position
    dither_shift_RGB = mix(2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position);

    // Shift the color by dither_shift
    return color + dither_shift_RGB;
}
`,{GLSL3:Ap,NoBlending:Pp,RawShaderMaterial:Cp}=await di("three"),{GLSL3:Tp,NoBlending:Rp,RawShaderMaterial:Qp}=await di("three"),{GLSL3:Ep,NearestFilter:Dp,NoBlending:Np,RawShaderMaterial:Fp,RepeatWrapping:Gp,TextureLoader:Jp,Vector2:$p}=await di("three"),{GLSL3:Wp,Matrix4:Up,NoBlending:Op,RawShaderMaterial:Hp,Vector3:jp}=await di("three"),{GLSL3:Kp,NoBlending:qp,RawShaderMaterial:ay,Vector2:ty}=await di("three"),{GLSL3:ry,NoBlending:iy,RawShaderMaterial:oy,Vector2:ny}=await di("three"),Rz=`
float smootherstep(float edge0, float edge1, float x) {
    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);
}
`,{GLSL3:ey,NoBlending:sy,RawShaderMaterial:_y,Vector2:vy}=await di("three"),Qz=`
in vec3 position;
in vec2 uv;

out vec2 vUv;

void main() {
    vUv = uv;

    gl_Position = vec4(position, 1.0);
}
`,Ez=`
precision highp float;

uniform sampler2D tMap;
uniform vec2 uDirection;
uniform vec2 uResolution;

in vec2 vUv;

out vec4 FragColor;

${Rz}
${Cz}

void main() {
    FragColor = blur13(tMap, vUv, uResolution, smootherstep(1.0, 0.0, vUv.y) * uDirection);
}
`,{GLSL3:Dz,NoBlending:Nz,RawShaderMaterial:Fz,Vector2:lf}=await di("three");class Gz extends Fz{constructor(){super({glslVersion:Dz,uniforms:{tMap:{value:null},uDirection:{value:new lf(1,0)},uResolution:{value:new lf}},vertexShader:Qz,fragmentShader:Ez,blending:Nz,depthTest:!1,depthWrite:!1})}}const Jz=`
in vec3 position;
in vec3 normal;
in vec2 uv;

uniform mat4 modelMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 cameraPosition;

uniform mat3 uMapTransform;
uniform mat4 uMatrix;

out vec2 vUv;
out vec4 vCoord;
out vec3 vNormal;
out vec3 vToEye;

void main() {
    vUv = (uMapTransform * vec3(uv, 1.0)).xy;
    vCoord = uMatrix * vec4(position, 1.0);
    vNormal = normalMatrix * normal;

    vec4 worldPosition = modelMatrix * vec4(position, 1.0);
    vToEye = cameraPosition - worldPosition.xyz;

    vec4 mvPosition = viewMatrix * worldPosition;
    gl_Position = projectionMatrix * mvPosition;
}
`,$z=`
precision highp float;

uniform sampler2D tReflect;
uniform vec3 uColor;
uniform float uReflectivity;
uniform float uMirror;
uniform float uMixStrength;

#ifdef USE_MAP
    uniform sampler2D tMap;
#endif

#ifdef USE_NORMALMAP
    uniform sampler2D tNormalMap;
    uniform vec2 uNormalScale;
#endif

#ifdef USE_FOG
    uniform vec3 uFogColor;
    uniform float uFogNear;
    uniform float uFogFar;
#endif

in vec2 vUv;
in vec4 vCoord;
in vec3 vNormal;
in vec3 vToEye;

out vec4 FragColor;

${bf}

void main() {
    #ifdef USE_MAP
        vec4 color = texture(tMap, vUv);
    #else
        vec4 color = vec4(uColor, 1.0);
    #endif

    #ifdef USE_NORMALMAP
        vec4 normalColor = texture(tNormalMap, vUv * uNormalScale);
        vec3 normal = normalize(vec3(normalColor.r * 2.0 - 1.0, normalColor.b, normalColor.g * 2.0 - 1.0));
        vec3 coord = vCoord.xyz / vCoord.w;
        vec2 uv = coord.xy + coord.z * normal.xz * 0.05;
        vec4 reflectColor = texture(tReflect, uv);
    #else
        vec3 normal = vNormal;
        vec4 reflectColor = textureProj(tReflect, vCoord);
    #endif

    // Fresnel term
    vec3 toEye = normalize(vToEye);
    float theta = max(dot(toEye, normal), 0.0);
    float reflectance = uReflectivity + (1.0 - uReflectivity) * pow((1.0 - theta), 5.0);

    reflectColor = mix(vec4(0), reflectColor, reflectance);

    FragColor.rgb = color.rgb * ((1.0 - min(1.0, uMirror)) + reflectColor.rgb * uMixStrength);

    #ifdef USE_FOG
        float fogDepth = gl_FragCoord.z / gl_FragCoord.w;
        float fogFactor = smoothstep(uFogNear, uFogFar, fogDepth);

        FragColor.rgb = mix(FragColor.rgb, uFogColor, fogFactor);
    #endif

    #ifdef DITHERING
        FragColor.rgb = dither(FragColor.rgb);
    #endif

    FragColor.a = 1.0;
}
`,{Color:ib,GLSL3:Wz,Matrix3:Uz,Matrix4:Oz,NoBlending:Hz,RawShaderMaterial:jz,Vector2:Kz}=await di("three");class ly extends jz{constructor({color:a=new ib(1052688),map:t=null,normalMap:r=null,normalScale:i=new Kz(1,1),reflectivity:o=0,mirror:s=0,mixStrength:_=10,fog:h=null,dithering:v=!1}={}){const e={glslVersion:Wz,defines:{},uniforms:{tMap:{value:null},tReflect:{value:null},uMapTransform:{value:new Uz},uMatrix:{value:new Oz},uColor:{value:a instanceof ib?a:new ib(a)},uReflectivity:{value:o},uMirror:{value:s},uMixStrength:{value:_}},vertexShader:Jz,fragmentShader:$z,blending:Hz};t&&(t.updateMatrix(),e.defines=Object.assign(e.defines,{USE_MAP:""}),e.uniforms=Object.assign(e.uniforms,{tMap:{value:t},uMapTransform:{value:t.matrix}})),r&&(e.defines=Object.assign(e.defines,{USE_NORMALMAP:""}),e.uniforms=Object.assign(e.uniforms,{tNormalMap:{value:r},uNormalScale:{value:i}}),t||(r.updateMatrix(),e.uniforms=Object.assign(e.uniforms,{uMapTransform:{value:r.matrix}}))),h&&(e.defines=Object.assign(e.defines,{USE_FOG:""}),e.uniforms=Object.assign(e.uniforms,{uFogColor:{value:h.color},uFogNear:{value:h.near},uFogFar:{value:h.far}})),v&&(e.defines=Object.assign(e.defines,{DITHERING:""})),super(e)}}const qz=`
in vec3 position;
in vec3 normal;
in vec2 uv;

uniform mat4 modelMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 cameraPosition;

uniform mat3 uMapTransform;
uniform mat4 uMatrix;

out vec2 vUv;
out vec4 vCoord;
out vec3 vNormal;
out vec3 vToEye;

void main() {
    vUv = (uMapTransform * vec3(uv, 1.0)).xy;
    vCoord = uMatrix * vec4(position, 1.0);
    vNormal = normalMatrix * normal;

    vec4 worldPosition = modelMatrix * vec4(position, 1.0);
    vToEye = cameraPosition - worldPosition.xyz;

    vec4 mvPosition = viewMatrix * worldPosition;
    gl_Position = projectionMatrix * mvPosition;
}
`,am=`
precision highp float;

uniform sampler2D tMap;
uniform sampler2D tReflect;
uniform sampler2D tReflectBlur;
uniform float uReflectivity;

in vec2 vUv;
in vec4 vCoord;
in vec3 vNormal;
in vec3 vToEye;

out vec4 FragColor;

${bf}

void main() {
    vec2 reflectionUv = vCoord.xy / vCoord.w;

    vec4 dudv = texture(tMap, vUv);
    vec4 color = texture(tReflect, reflectionUv);

    vec4 blur;

    blur = texture(tReflectBlur, reflectionUv + dudv.rg / 256.0);
    color = mix(color, blur, smoothstep(1.0, 0.1, dudv.g));

    blur = texture(tReflectBlur, reflectionUv);
    color = mix(color, blur, smoothstep(0.5, 1.0, dudv.r));

    FragColor = color * mix(0.6, 0.75, dudv.g);

    // Fresnel term
    vec3 toEye = normalize(vToEye);
    float theta = max(dot(toEye, vNormal), 0.0);
    float reflectance = uReflectivity + (1.0 - uReflectivity) * pow((1.0 - theta), 5.0);

    FragColor = mix(vec4(0), FragColor, reflectance);

    #ifdef DITHERING
        FragColor.rgb = dither(FragColor.rgb);
    #endif

    FragColor.a = 1.0;
}
`,{GLSL3:tm,Matrix3:rm,Matrix4:im,NoBlending:om,RawShaderMaterial:nm}=await di("three");class hy extends nm{constructor({map:a=null,reflectivity:t=0,dithering:r=!1}={}){const i={glslVersion:tm,defines:{DITHERING:r},uniforms:{tMap:{value:null},tReflect:{value:null},tReflectBlur:{value:null},uMapTransform:{value:new rm},uMatrix:{value:new im},uReflectivity:{value:t}},vertexShader:qz,fragmentShader:am,blending:om};a&&(a.updateMatrix(),i.uniforms=Object.assign(i.uniforms,{tMap:{value:a},uMapTransform:{value:a.matrix}})),super(i)}}const{GLSL3:cy,NoBlending:by,RawShaderMaterial:fy}=await di("three"),{GLSL3:uy,NoBlending:xy,RawShaderMaterial:My}=await di("three"),{GLSL3:zy,NoBlending:my,RawShaderMaterial:py}=await di("three"),{GLSL3:yy,NoBlending:gy,RawShaderMaterial:Iy,Vector2:Vy}=await di("three"),{GLSL3:wy,NoBlending:ky,RawShaderMaterial:Xy,Vector2:Ly}=await di("three"),{AdditiveBlending:Yy,GLSL3:Zy,RawShaderMaterial:dy,Vector2:By}=await di("three"),{GLSL3:Sy,NoBlending:Ay,RawShaderMaterial:Py}=await di("three"),{GLSL3:Cy,NoBlending:Ty,RawShaderMaterial:Ry}=await di("three"),{Color:Qy,GLSL3:Ey,RawShaderMaterial:Dy}=await di("three"),{Vector3:Ny}=await di("three"),{GLSL3:Fy,HalfFloatType:Gy,Mesh:Jy,NoBlending:$y,OrthographicCamera:Wy,RawShaderMaterial:Uy,Vector2:Oy,WebGLRenderTarget:Hy}=await di("three"),{Group:em,Matrix4:hf,Mesh:sm,OrthographicCamera:_m,PerspectiveCamera:vm,Plane:lm,Vector3:xc,Vector4:cf,WebGLRenderTarget:hm}=await di("three");class jy extends em{constructor({width:a=512,height:t=512,clipBias:r=0,blurIterations:i=8}={}){super(),this.clipBias=r,this.blurIterations=i,this.reflectorPlane=new lm,this.normal=new xc,this.reflectorWorldPosition=new xc,this.cameraWorldPosition=new xc,this.rotationMatrix=new hf,this.lookAtPosition=new xc(0,0,-1),this.clipPlane=new cf,this.view=new xc,this.target=new xc,this.q=new cf,this.textureMatrix=new hf,this.virtualCamera=new vm,this.textureMatrixUniform={value:this.textureMatrix},this.renderTarget=new hm(a,t,{depthBuffer:!1}),this.renderTargetRead=this.renderTarget.clone(),this.renderTargetWrite=this.renderTarget.clone(),this.renderTarget.depthBuffer=!0,this.renderTargetUniform={value:this.blurIterations>0?this.renderTargetRead.texture:this.renderTarget.texture},this.blurMaterial=new Gz,this.blurMaterial.uniforms.uResolution.value.set(a,t),this.screenCamera=new _m(-1,1,1,-1,0,1),this.screenTriangle=Pz(),this.screen=new sm(this.screenTriangle,this.blurMaterial),this.screen.frustumCulled=!1}setSize(a,t){this.renderTarget.setSize(a,t),this.renderTargetRead.setSize(a,t),this.renderTargetWrite.setSize(a,t),this.blurMaterial.uniforms.uResolution.value.set(a,t)}update(a,t,r){if(this.reflectorWorldPosition.setFromMatrixPosition(this.matrixWorld),this.cameraWorldPosition.setFromMatrixPosition(r.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal.set(0,0,1),this.normal.applyMatrix4(this.rotationMatrix),this.view.subVectors(this.reflectorWorldPosition,this.cameraWorldPosition),this.view.dot(this.normal)>0)return;this.view.reflect(this.normal).negate(),this.view.add(this.reflectorWorldPosition),this.rotationMatrix.extractRotation(r.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition),this.target.subVectors(this.reflectorWorldPosition,this.lookAtPosition),this.target.reflect(this.normal).negate(),this.target.add(this.reflectorWorldPosition),this.virtualCamera.position.copy(this.view),this.virtualCamera.up.set(0,1,0),this.virtualCamera.up.applyMatrix4(this.rotationMatrix),this.virtualCamera.up.reflect(this.normal),this.virtualCamera.lookAt(this.target),this.virtualCamera.far=r.far,this.virtualCamera.updateMatrixWorld(),this.virtualCamera.projectionMatrix.copy(r.projectionMatrix),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.virtualCamera.projectionMatrix),this.textureMatrix.multiply(this.virtualCamera.matrixWorldInverse),this.textureMatrix.multiply(this.matrixWorld),this.reflectorPlane.setFromNormalAndCoplanarPoint(this.normal,this.reflectorWorldPosition),this.reflectorPlane.applyMatrix4(this.virtualCamera.matrixWorldInverse),this.clipPlane.set(this.reflectorPlane.normal.x,this.reflectorPlane.normal.y,this.reflectorPlane.normal.z,this.reflectorPlane.constant);const i=this.virtualCamera.projectionMatrix;this.q.x=(Math.sign(this.clipPlane.x)+i.elements[8])/i.elements[0],this.q.y=(Math.sign(this.clipPlane.y)+i.elements[9])/i.elements[5],this.q.z=-1,this.q.w=(1+i.elements[10])/i.elements[14],this.clipPlane.multiplyScalar(2/this.clipPlane.dot(this.q)),i.elements[2]=this.clipPlane.x,i.elements[6]=this.clipPlane.y,i.elements[10]=this.clipPlane.z+1-this.clipBias,i.elements[14]=this.clipPlane.w;const o=a.getRenderTarget(),s=a.xr.enabled,_=a.shadowMap.autoUpdate;a.xr.enabled=!1,a.shadowMap.autoUpdate=!1,a.setRenderTarget(this.renderTarget),a.state.buffers.depth.setMask(!0),a.autoClear===!1&&a.clear(),a.render(t,this.virtualCamera);const h=this.blurIterations;for(let v=0;v<h;v++){v===0?this.blurMaterial.uniforms.tMap.value=this.renderTarget.texture:this.blurMaterial.uniforms.tMap.value=this.renderTargetRead.texture;const e=(h-v-1)*.5;this.blurMaterial.uniforms.uDirection.value.set(v%2===0?e:0,v%2===0?0:e),a.setRenderTarget(this.renderTargetWrite),a.autoClear===!1&&a.clear(),a.render(this.screen,this.screenCamera);const l=this.renderTargetRead;this.renderTargetRead=this.renderTargetWrite,this.renderTargetWrite=l,this.renderTargetUniform.value=this.renderTargetRead.texture}a.xr.enabled=s,a.shadowMap.autoUpdate=_,a.setRenderTarget(o)}destroy(){this.renderTargetWrite.dispose(),this.renderTargetRead.dispose(),this.renderTarget.dispose(),this.blurMaterial.dispose(),this.screenTriangle.dispose();for(const a in this)this[a]=null;return null}}const{ShaderChunk:Ky}=await di("three");var x=x||{};x.collision||(x.collision={});x.collision.broadphase||(x.collision.broadphase={});x.collision.broadphase.BroadPhase=class{constructor(a){this._type=a,this._numProxies=0,this._proxyList=null,this._proxyListLast=null,this._proxyPairList=null,this._incremental=!1,this._testCount=0,this._proxyPairPool=null,this._idCount=0,this._convexSweep=new x.collision.broadphase._BroadPhase.ConvexSweepGeometry,this._aabb=new x.collision.broadphase._BroadPhase.AabbGeometry,this.identity=new x.common.Transform,this.zero=new x.common.Vec3,this.rayCastHit=new x.collision.geometry.RayCastHit}createProxy(a,t){return null}destroyProxy(a){}moveProxy(a,t,r){}isOverlapping(a,t){return a._aabbMinX<t._aabbMaxX&&a._aabbMaxX>t._aabbMinX&&a._aabbMinY<t._aabbMaxY&&a._aabbMaxY>t._aabbMinY&&a._aabbMinZ<t._aabbMaxZ?a._aabbMaxZ>t._aabbMinZ:!1}collectPairs(){}getProxyPairList(){return this._proxyPairList}isIncremental(){return this._incremental}getTestCount(){return this._testCount}rayCast(a,t,r){}convexCast(a,t,r,i){}aabbTest(a,t){}};x.collision.geometry||(x.collision.geometry={});x.collision.geometry.Geometry=class{constructor(a){this._type=a,this._volume=0}_updateMass(){}_computeAabb(a,t){}_rayCastLocal(a,t,r,i,o,s,_){return!1}getType(){return this._type}getVolume(){return this._volume}rayCast(a,t,r,i){var o,s,_,h,v,e,l=a;o=l.x,s=l.y,_=l.z;var u=t;h=u.x,v=u.y,e=u.z,o-=r._positionX,s-=r._positionY,_-=r._positionZ,h-=r._positionX,v-=r._positionY,e-=r._positionZ;var b,f,n;b=r._rotation00*o+r._rotation10*s+r._rotation20*_,f=r._rotation01*o+r._rotation11*s+r._rotation21*_,n=r._rotation02*o+r._rotation12*s+r._rotation22*_,o=b,s=f,_=n;var c,M,m;if(c=r._rotation00*h+r._rotation10*v+r._rotation20*e,M=r._rotation01*h+r._rotation11*v+r._rotation21*e,m=r._rotation02*h+r._rotation12*v+r._rotation22*e,h=c,v=M,e=m,this._rayCastLocal(o,s,_,h,v,e,i)){var y,V,z,I,w,X,L=i.position;y=L.x,V=L.y,z=L.z;var p=i.normal;I=p.x,w=p.y,X=p.z;var g,F,S;g=r._rotation00*y+r._rotation01*V+r._rotation02*z,F=r._rotation10*y+r._rotation11*V+r._rotation12*z,S=r._rotation20*y+r._rotation21*V+r._rotation22*z,y=g,V=F,z=S;var N,A,Y;N=r._rotation00*I+r._rotation01*w+r._rotation02*X,A=r._rotation10*I+r._rotation11*w+r._rotation12*X,Y=r._rotation20*I+r._rotation21*w+r._rotation22*X,I=N,w=A,X=Y,y+=r._positionX,V+=r._positionY,z+=r._positionZ;var R=i.position;R.x=y,R.y=V,R.z=z;var C=i.normal;return C.x=I,C.y=w,C.z=X,!0}return!1}};x.collision.geometry.ConvexGeometry=class extends x.collision.geometry.Geometry{constructor(a){super(a),this._gjkMargin=x.common.Setting.defaultGJKMargin,this._useGjkRayCast=!1}getGjkMergin(){return this._gjkMargin}setGjkMergin(a){a<0&&(a=0),this._gjkMargin=a}computeLocalSupportingVertex(a,t){}rayCast(a,t,r,i){return this._useGjkRayCast?x.collision.narrowphase.detector.gjkepa.GjkEpa.instance.rayCast(this,r,a,t,i):super.rayCast(a,t,r,i)}};x.collision.broadphase._BroadPhase||(x.collision.broadphase._BroadPhase={});x.collision.broadphase._BroadPhase.ConvexSweepGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(){super(-1)}init(a,t,r){this.c=a;var i,o,s,_=r;i=_.x,o=_.y,s=_.z;var h,v,e,l,u,b;l=t._rotation00*i+t._rotation10*o+t._rotation20*s,u=t._rotation01*i+t._rotation11*o+t._rotation21*s,b=t._rotation02*i+t._rotation12*o+t._rotation22*s,h=l,v=u,e=b,this.localTranslation=new x.common.Vec3;var f=this.localTranslation;f.x=h,f.y=v,f.z=e,this._gjkMargin=a._gjkMargin}computeLocalSupportingVertex(a,t){this.c.computeLocalSupportingVertex(a,t);var r=this.localTranslation;if(a.x*r.x+a.y*r.y+a.z*r.z>0){var i=this.localTranslation,o=t.x+i.x,s=t.y+i.y,_=t.z+i.z;t.x=o,t.y=s,t.z=_}}};x.collision.broadphase._BroadPhase.AabbGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(){super(-1),this.min=new x.common.Vec3,this.max=new x.common.Vec3}computeLocalSupportingVertex(a,t){t.x=a.x>0?this.max.x:this.min.x,t.y=a.y>0?this.max.y:this.min.y,t.z=a.z>0?this.max.z:this.min.z}};x.collision.broadphase.BroadPhaseProxyCallback=class{constructor(){}process(a){}};x.collision.broadphase.BroadPhaseType=class{};x.collision.broadphase.Proxy=class{constructor(a,t){this.userData=a,this._id=t,this._prev=null,this._next=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}getId(){return this._id}getFatAabb(){var a=new x.collision.geometry.Aabb;return a._minX=this._aabbMinX,a._minY=this._aabbMinY,a._minZ=this._aabbMinZ,a._maxX=this._aabbMaxX,a._maxY=this._aabbMaxY,a._maxZ=this._aabbMaxZ,a}getFatAabbTo(a){a._minX=this._aabbMinX,a._minY=this._aabbMinY,a._minZ=this._aabbMinZ,a._maxX=this._aabbMaxX,a._maxY=this._aabbMaxY,a._maxZ=this._aabbMaxZ}};x.collision.broadphase.ProxyPair=class{constructor(){this._p1=null,this._p2=null}getProxy1(){return this._p1}getProxy2(){return this._p2}getNext(){return this._next}};x.collision.broadphase.bruteforce||(x.collision.broadphase.bruteforce={});x.collision.broadphase.bruteforce.BruteForceBroadPhase=class extends x.collision.broadphase.BroadPhase{constructor(){super(1),this._incremental=!1}createProxy(a,t){var r=new x.collision.broadphase.Proxy(a,this._idCount++);return this._numProxies++,this._proxyList==null?(this._proxyList=r,this._proxyListLast=r):(this._proxyListLast._next=r,r._prev=this._proxyListLast,this._proxyListLast=r),r._aabbMinX=t._minX,r._aabbMinY=t._minY,r._aabbMinZ=t._minZ,r._aabbMaxX=t._maxX,r._aabbMaxY=t._maxY,r._aabbMaxZ=t._maxZ,r}destroyProxy(a){this._numProxies--;var t=a._prev,r=a._next;t!=null&&(t._next=r),r!=null&&(r._prev=t),a==this._proxyList&&(this._proxyList=this._proxyList._next),a==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),a._next=null,a._prev=null,a.userData=null}moveProxy(a,t,r){a._aabbMinX=t._minX,a._aabbMinY=t._minY,a._aabbMinZ=t._minZ,a._aabbMaxX=t._maxX,a._aabbMaxY=t._maxY,a._aabbMaxZ=t._maxZ}collectPairs(){var a=this._proxyPairList;if(a!=null){for(;a._p1=null,a._p2=null,a=a._next,a!=null;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}this._testCount=0;for(var t=this._proxyList;t!=null;){for(var r=t._next,i=t._next;i!=null;){var o=i._next;if(this._testCount++,t._aabbMinX<i._aabbMaxX&&t._aabbMaxX>i._aabbMinX&&t._aabbMinY<i._aabbMaxY&&t._aabbMaxY>i._aabbMinY&&t._aabbMinZ<i._aabbMaxZ&&t._aabbMaxZ>i._aabbMinZ){var s=this._proxyPairPool;s!=null?(this._proxyPairPool=s._next,s._next=null):s=new x.collision.broadphase.ProxyPair;var _=s;this._proxyPairList==null?this._proxyPairList=_:(_._next=this._proxyPairList,this._proxyPairList=_),_._p1=t,_._p2=i}i=o}t=r}}rayCast(a,t,r){var i,o,s,_,h,v,e=a;i=e.x,o=e.y,s=e.z;var l=t;_=l.x,h=l.y,v=l.z;for(var u=this._proxyList;u!=null;){var b=u._next,f=i,n=o,c=s,M=_,m=h,y=v,V=f<M?f:M,z=n<m?n:m,I=c<y?c:y,w=f>M?f:M,X=n>m?n:m,L=c>y?c:y,p=u._aabbMinX,g=u._aabbMinY,F=u._aabbMinZ,S=u._aabbMaxX,N=u._aabbMaxY,A=u._aabbMaxZ,Y;if(p>w||S<V||g>X||N<z||F>L||A<I)Y=!1;else{var R=M-f,C=m-n,d=y-c,Z=R<0?-R:R,j=C<0?-C:C,H=d<0?-d:d,E=(S-p)*.5,G=(N-g)*.5,B=(A-F)*.5,Q=(S+p)*.5,W=(N+g)*.5,J=(A+F)*.5,D=f-Q,O=n-W,K=c-J,ra,sa,$=O*d-K*C;if(($<0?-$:$)-(G*H+B*j)>0)sa=!0;else{var q=K*R-D*d;sa=(q<0?-q:q)-(B*Z+E*H)>0}if(sa)ra=!0;else{var na=D*C-O*R;ra=(na<0?-na:na)-(E*j+G*Z)>0}Y=!ra}Y&&r.process(u),u=b}}convexCast(a,t,r,i){for(var o=this._proxyList;o!=null;){var s=o._next,_=this._aabb.min;_.x=o._aabbMinX,_.y=o._aabbMinY,_.z=o._aabbMinZ;var h=this._aabb.max;h.x=o._aabbMaxX,h.y=o._aabbMaxY,h.z=o._aabbMaxZ,this._convexSweep.init(a,t,r);var v=x.collision.narrowphase.detector.gjkepa.GjkEpa.instance;v.computeClosestPointsImpl(this._convexSweep,this._aabb,t,this.identity,null,!1)==0&&v.distance<=0&&i.process(o),o=s}}aabbTest(a,t){for(var r=this._proxyList;r!=null;){var i=r._next;a._minX<r._aabbMaxX&&a._maxX>r._aabbMinX&&a._minY<r._aabbMaxY&&a._maxY>r._aabbMinY&&a._minZ<r._aabbMaxZ&&a._maxZ>r._aabbMinZ&&t.process(r),r=i}}};x.collision.broadphase.bvh||(x.collision.broadphase.bvh={});x.collision.broadphase.bvh.BvhBroadPhase=class extends x.collision.broadphase.BroadPhase{constructor(){super(2),this._incremental=!0,this._tree=new x.collision.broadphase.bvh.BvhTree;var a=new Array(1024);this.movedProxies=a,this.numMovedProxies=0}collide(a,t){this._testCount++;var r=a._height==0,i=t._height==0;if(a==t){if(r)return;this.collide(a._children[0],t),this.collide(a._children[1],t);return}if(a._aabbMinX<t._aabbMaxX&&a._aabbMaxX>t._aabbMinX&&a._aabbMinY<t._aabbMaxY&&a._aabbMaxY>t._aabbMinY&&a._aabbMinZ<t._aabbMaxZ&&a._aabbMaxZ>t._aabbMinZ){if(r&&i){var o=a._proxy,s=t._proxy,_=this._proxyPairPool;_!=null?(this._proxyPairPool=_._next,_._next=null):_=new x.collision.broadphase.ProxyPair;var h=_;this._proxyPairList==null?this._proxyPairList=h:(h._next=this._proxyPairList,this._proxyPairList=h),h._p1=o,h._p2=s;return}i||a._height>t._height?(this.collide(a._children[0],t),this.collide(a._children[1],t)):(this.collide(t._children[0],a),this.collide(t._children[1],a))}}rayCastRecursive(a,t,r,i,o,s,_,h){var v,e,l,u,b,f;v=t,e=r,l=i,u=o,b=s,f=_;var n=v,c=e,M=l,m=u,y=b,V=f,z=n<m?n:m,I=c<y?c:y,w=M<V?M:V,X=n>m?n:m,L=c>y?c:y,p=M>V?M:V,g=a._aabbMinX,F=a._aabbMinY,S=a._aabbMinZ,N=a._aabbMaxX,A=a._aabbMaxY,Y=a._aabbMaxZ,R;if(g>X||N<z||F>L||A<I||S>p||Y<w)R=!1;else{var C=m-n,d=y-c,Z=V-M,j=C<0?-C:C,H=d<0?-d:d,E=Z<0?-Z:Z,G=(N-g)*.5,B=(A-F)*.5,Q=(Y-S)*.5,W=(N+g)*.5,J=(A+F)*.5,D=(Y+S)*.5,O=n-W,K=c-J,ra=M-D,sa,$,q=K*Z-ra*d;if((q<0?-q:q)-(B*E+Q*H)>0)$=!0;else{var na=ra*C-O*Z;$=(na<0?-na:na)-(Q*j+G*E)>0}if($)sa=!0;else{var oa=O*d-K*C;sa=(oa<0?-oa:oa)-(G*H+B*j)>0}R=!sa}if(R){if(a._height==0){h.process(a._proxy);return}this.rayCastRecursive(a._children[0],v,e,l,u,b,f,h),this.rayCastRecursive(a._children[1],v,e,l,u,b,f,h)}}convexCastRecursive(a,t,r,i,o){var s=this._aabb.min;s.x=a._aabbMinX,s.y=a._aabbMinY,s.z=a._aabbMinZ;var _=this._aabb.max;_.x=a._aabbMaxX,_.y=a._aabbMaxY,_.z=a._aabbMaxZ,this._convexSweep.init(t,r,i);var h=x.collision.narrowphase.detector.gjkepa.GjkEpa.instance;if(h.computeClosestPointsImpl(this._convexSweep,this._aabb,r,this.identity,null,!1)==0&&h.distance<=0){if(a._height==0){o.process(a._proxy);return}this.convexCastRecursive(a._children[0],t,r,i,o),this.convexCastRecursive(a._children[1],t,r,i,o)}}aabbTestRecursive(a,t,r){if(a._aabbMinX<t._maxX&&a._aabbMaxX>t._minX&&a._aabbMinY<t._maxY&&a._aabbMaxY>t._minY&&a._aabbMinZ<t._maxZ&&a._aabbMaxZ>t._minZ){if(a._height==0){r.process(a._proxy);return}this.aabbTestRecursive(a._children[0],t,r),this.aabbTestRecursive(a._children[1],t,r)}}createProxy(a,t){var r=new x.collision.broadphase.bvh.BvhProxy(a,this._idCount++);this._numProxies++,this._proxyList==null?(this._proxyList=r,this._proxyListLast=r):(this._proxyListLast._next=r,r._prev=this._proxyListLast,this._proxyListLast=r),r._aabbMinX=t._minX,r._aabbMinY=t._minY,r._aabbMinZ=t._minZ,r._aabbMaxX=t._maxX,r._aabbMaxY=t._maxY,r._aabbMaxZ=t._maxZ;var i=x.common.Setting.bvhProxyPadding,o,s,_;o=i,s=i,_=i,r._aabbMinX-=o,r._aabbMinY-=s,r._aabbMinZ-=_,r._aabbMaxX+=o,r._aabbMaxY+=s,r._aabbMaxZ+=_;var h=this._tree,v=h._nodePool;v!=null?(h._nodePool=v._next,v._next=null):v=new x.collision.broadphase.bvh.BvhNode;var e=v;if(e._proxy=r,r._leaf=e,e._aabbMinX=r._aabbMinX,e._aabbMinY=r._aabbMinY,e._aabbMinZ=r._aabbMinZ,e._aabbMaxX=r._aabbMaxX,e._aabbMaxY=r._aabbMaxY,e._aabbMaxZ=r._aabbMaxZ,h._numLeaves++,h.leafList==null?(h.leafList=e,h.leafListLast=e):(h.leafListLast._nextLeaf=e,e._prevLeaf=h.leafListLast,h.leafListLast=e),h._root==null)h._root=e;else{for(var l=h._root;l._height>0;){var u=h._strategy._decideInsertion(l,e);if(u==-1)break;l=l._children[u]}var b=l._parent,f=h._nodePool;f!=null?(h._nodePool=f._next,f._next=null):f=new x.collision.broadphase.bvh.BvhNode;var n=f;if(b==null)h._root=n;else{var c=l._childIndex;b._children[c]=n,n._parent=b,n._childIndex=c}var M=l._childIndex;n._children[M]=l,l._parent=n,l._childIndex=M;var m=l._childIndex^1;for(n._children[m]=e,e._parent=n,e._childIndex=m;n!=null;){if(h._strategy._balancingEnabled){var y=n._height;if(y<2)n=n;else{var V=n._parent,z=n._children[0],I=n._children[1],w=z._height,X=I._height,L=w-X,p=n._childIndex;if(L>1){var g=z._children[0],F=z._children[1],S=g._height,N=F._height;if(S>N){z._children[1]=n,n._parent=z,n._childIndex=1,n._children[0]=F,F._parent=n,F._childIndex=0;var A=z._children[0],Y=z._children[1];z._aabbMinX=A._aabbMinX<Y._aabbMinX?A._aabbMinX:Y._aabbMinX,z._aabbMinY=A._aabbMinY<Y._aabbMinY?A._aabbMinY:Y._aabbMinY,z._aabbMinZ=A._aabbMinZ<Y._aabbMinZ?A._aabbMinZ:Y._aabbMinZ,z._aabbMaxX=A._aabbMaxX>Y._aabbMaxX?A._aabbMaxX:Y._aabbMaxX,z._aabbMaxY=A._aabbMaxY>Y._aabbMaxY?A._aabbMaxY:Y._aabbMaxY,z._aabbMaxZ=A._aabbMaxZ>Y._aabbMaxZ?A._aabbMaxZ:Y._aabbMaxZ;var R=z._children[0]._height,C=z._children[1]._height;z._height=(R>C?R:C)+1;var d=n._children[0],Z=n._children[1];n._aabbMinX=d._aabbMinX<Z._aabbMinX?d._aabbMinX:Z._aabbMinX,n._aabbMinY=d._aabbMinY<Z._aabbMinY?d._aabbMinY:Z._aabbMinY,n._aabbMinZ=d._aabbMinZ<Z._aabbMinZ?d._aabbMinZ:Z._aabbMinZ,n._aabbMaxX=d._aabbMaxX>Z._aabbMaxX?d._aabbMaxX:Z._aabbMaxX,n._aabbMaxY=d._aabbMaxY>Z._aabbMaxY?d._aabbMaxY:Z._aabbMaxY,n._aabbMaxZ=d._aabbMaxZ>Z._aabbMaxZ?d._aabbMaxZ:Z._aabbMaxZ;var j=n._children[0]._height,H=n._children[1]._height;n._height=(j>H?j:H)+1}else{z._children[0]=n,n._parent=z,n._childIndex=0,n._children[0]=g,g._parent=n,g._childIndex=0;var E=z._children[0],G=z._children[1];z._aabbMinX=E._aabbMinX<G._aabbMinX?E._aabbMinX:G._aabbMinX,z._aabbMinY=E._aabbMinY<G._aabbMinY?E._aabbMinY:G._aabbMinY,z._aabbMinZ=E._aabbMinZ<G._aabbMinZ?E._aabbMinZ:G._aabbMinZ,z._aabbMaxX=E._aabbMaxX>G._aabbMaxX?E._aabbMaxX:G._aabbMaxX,z._aabbMaxY=E._aabbMaxY>G._aabbMaxY?E._aabbMaxY:G._aabbMaxY,z._aabbMaxZ=E._aabbMaxZ>G._aabbMaxZ?E._aabbMaxZ:G._aabbMaxZ;var B=z._children[0]._height,Q=z._children[1]._height;z._height=(B>Q?B:Q)+1;var W=n._children[0],J=n._children[1];n._aabbMinX=W._aabbMinX<J._aabbMinX?W._aabbMinX:J._aabbMinX,n._aabbMinY=W._aabbMinY<J._aabbMinY?W._aabbMinY:J._aabbMinY,n._aabbMinZ=W._aabbMinZ<J._aabbMinZ?W._aabbMinZ:J._aabbMinZ,n._aabbMaxX=W._aabbMaxX>J._aabbMaxX?W._aabbMaxX:J._aabbMaxX,n._aabbMaxY=W._aabbMaxY>J._aabbMaxY?W._aabbMaxY:J._aabbMaxY,n._aabbMaxZ=W._aabbMaxZ>J._aabbMaxZ?W._aabbMaxZ:J._aabbMaxZ;var D=n._children[0]._height,O=n._children[1]._height;n._height=(D>O?D:O)+1}V!=null?(V._children[p]=z,z._parent=V,z._childIndex=p):(h._root=z,z._parent=null),n=z}else if(L<-1){var K=I._children[0],ra=I._children[1],sa=K._height,$=ra._height;if(sa>$){I._children[1]=n,n._parent=I,n._childIndex=1,n._children[1]=ra,ra._parent=n,ra._childIndex=1;var q=I._children[0],na=I._children[1];I._aabbMinX=q._aabbMinX<na._aabbMinX?q._aabbMinX:na._aabbMinX,I._aabbMinY=q._aabbMinY<na._aabbMinY?q._aabbMinY:na._aabbMinY,I._aabbMinZ=q._aabbMinZ<na._aabbMinZ?q._aabbMinZ:na._aabbMinZ,I._aabbMaxX=q._aabbMaxX>na._aabbMaxX?q._aabbMaxX:na._aabbMaxX,I._aabbMaxY=q._aabbMaxY>na._aabbMaxY?q._aabbMaxY:na._aabbMaxY,I._aabbMaxZ=q._aabbMaxZ>na._aabbMaxZ?q._aabbMaxZ:na._aabbMaxZ;var oa=I._children[0]._height,aa=I._children[1]._height;I._height=(oa>aa?oa:aa)+1;var T=n._children[0],ca=n._children[1];n._aabbMinX=T._aabbMinX<ca._aabbMinX?T._aabbMinX:ca._aabbMinX,n._aabbMinY=T._aabbMinY<ca._aabbMinY?T._aabbMinY:ca._aabbMinY,n._aabbMinZ=T._aabbMinZ<ca._aabbMinZ?T._aabbMinZ:ca._aabbMinZ,n._aabbMaxX=T._aabbMaxX>ca._aabbMaxX?T._aabbMaxX:ca._aabbMaxX,n._aabbMaxY=T._aabbMaxY>ca._aabbMaxY?T._aabbMaxY:ca._aabbMaxY,n._aabbMaxZ=T._aabbMaxZ>ca._aabbMaxZ?T._aabbMaxZ:ca._aabbMaxZ;var _a=n._children[0]._height,k=n._children[1]._height;n._height=(_a>k?_a:k)+1}else{I._children[0]=n,n._parent=I,n._childIndex=0,n._children[1]=K,K._parent=n,K._childIndex=1;var ta=I._children[0],ia=I._children[1];I._aabbMinX=ta._aabbMinX<ia._aabbMinX?ta._aabbMinX:ia._aabbMinX,I._aabbMinY=ta._aabbMinY<ia._aabbMinY?ta._aabbMinY:ia._aabbMinY,I._aabbMinZ=ta._aabbMinZ<ia._aabbMinZ?ta._aabbMinZ:ia._aabbMinZ,I._aabbMaxX=ta._aabbMaxX>ia._aabbMaxX?ta._aabbMaxX:ia._aabbMaxX,I._aabbMaxY=ta._aabbMaxY>ia._aabbMaxY?ta._aabbMaxY:ia._aabbMaxY,I._aabbMaxZ=ta._aabbMaxZ>ia._aabbMaxZ?ta._aabbMaxZ:ia._aabbMaxZ;var la=I._children[0]._height,va=I._children[1]._height;I._height=(la>va?la:va)+1;var xa=n._children[0],Ma=n._children[1];n._aabbMinX=xa._aabbMinX<Ma._aabbMinX?xa._aabbMinX:Ma._aabbMinX,n._aabbMinY=xa._aabbMinY<Ma._aabbMinY?xa._aabbMinY:Ma._aabbMinY,n._aabbMinZ=xa._aabbMinZ<Ma._aabbMinZ?xa._aabbMinZ:Ma._aabbMinZ,n._aabbMaxX=xa._aabbMaxX>Ma._aabbMaxX?xa._aabbMaxX:Ma._aabbMaxX,n._aabbMaxY=xa._aabbMaxY>Ma._aabbMaxY?xa._aabbMaxY:Ma._aabbMaxY,n._aabbMaxZ=xa._aabbMaxZ>Ma._aabbMaxZ?xa._aabbMaxZ:Ma._aabbMaxZ;var za=n._children[0]._height,Xa=n._children[1]._height;n._height=(za>Xa?za:Xa)+1}V!=null?(V._children[p]=I,I._parent=V,I._childIndex=p):(h._root=I,I._parent=null),n=I}else n=n}}var Za=n._children[0]._height,fa=n._children[1]._height;n._height=(Za>fa?Za:fa)+1;var ba=n._children[0],ea=n._children[1];n._aabbMinX=ba._aabbMinX<ea._aabbMinX?ba._aabbMinX:ea._aabbMinX,n._aabbMinY=ba._aabbMinY<ea._aabbMinY?ba._aabbMinY:ea._aabbMinY,n._aabbMinZ=ba._aabbMinZ<ea._aabbMinZ?ba._aabbMinZ:ea._aabbMinZ,n._aabbMaxX=ba._aabbMaxX>ea._aabbMaxX?ba._aabbMaxX:ea._aabbMaxX,n._aabbMaxY=ba._aabbMaxY>ea._aabbMaxY?ba._aabbMaxY:ea._aabbMaxY,n._aabbMaxZ=ba._aabbMaxZ>ea._aabbMaxZ?ba._aabbMaxZ:ea._aabbMaxZ,n=n._parent}}if(!r._moved){if(r._moved=!0,this.movedProxies.length==this.numMovedProxies){for(var ha=this.numMovedProxies<<1,pa=new Array(ha),ya=pa,da=0,ma=this.numMovedProxies;da<ma;){var Ya=da++;ya[Ya]=this.movedProxies[Ya],this.movedProxies[Ya]=null}this.movedProxies=ya}this.movedProxies[this.numMovedProxies++]=r}return r}destroyProxy(a){this._numProxies--;var t=a._prev,r=a._next;t!=null&&(t._next=r),r!=null&&(r._prev=t),a==this._proxyList&&(this._proxyList=this._proxyList._next),a==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),a._next=null,a._prev=null;var i=a,o=this._tree,s=i._leaf;o._numLeaves--;var _=s._prevLeaf,h=s._nextLeaf;if(_!=null&&(_._nextLeaf=h),h!=null&&(h._prevLeaf=_),s==o.leafList&&(o.leafList=o.leafList._nextLeaf),s==o.leafListLast&&(o.leafListLast=o.leafListLast._prevLeaf),s._nextLeaf=null,s._prevLeaf=null,o._root==s)o._root=null;else{var v=s._parent,e=v._children[s._childIndex^1],l=v._parent;if(l==null)e._parent=null,e._childIndex=0,o._root=e,v._next=null,v._childIndex=0,v._children[0]=null,v._children[1]=null,v._childIndex=0,v._parent=null,v._height=0,v._proxy=null,v._next=o._nodePool,o._nodePool=v;else{e._parent=l;var u=v._childIndex;l._children[u]=e,e._parent=l,e._childIndex=u,v._next=null,v._childIndex=0,v._children[0]=null,v._children[1]=null,v._childIndex=0,v._parent=null,v._height=0,v._proxy=null,v._next=o._nodePool,o._nodePool=v;for(var b=l;b!=null;){if(o._strategy._balancingEnabled){var f=b._height;if(f<2)b=b;else{var n=b._parent,c=b._children[0],M=b._children[1],m=c._height,y=M._height,V=m-y,z=b._childIndex;if(V>1){var I=c._children[0],w=c._children[1],X=I._height,L=w._height;if(X>L){c._children[1]=b,b._parent=c,b._childIndex=1,b._children[0]=w,w._parent=b,w._childIndex=0;var p=c._children[0],g=c._children[1];c._aabbMinX=p._aabbMinX<g._aabbMinX?p._aabbMinX:g._aabbMinX,c._aabbMinY=p._aabbMinY<g._aabbMinY?p._aabbMinY:g._aabbMinY,c._aabbMinZ=p._aabbMinZ<g._aabbMinZ?p._aabbMinZ:g._aabbMinZ,c._aabbMaxX=p._aabbMaxX>g._aabbMaxX?p._aabbMaxX:g._aabbMaxX,c._aabbMaxY=p._aabbMaxY>g._aabbMaxY?p._aabbMaxY:g._aabbMaxY,c._aabbMaxZ=p._aabbMaxZ>g._aabbMaxZ?p._aabbMaxZ:g._aabbMaxZ;var F=c._children[0]._height,S=c._children[1]._height;c._height=(F>S?F:S)+1;var N=b._children[0],A=b._children[1];b._aabbMinX=N._aabbMinX<A._aabbMinX?N._aabbMinX:A._aabbMinX,b._aabbMinY=N._aabbMinY<A._aabbMinY?N._aabbMinY:A._aabbMinY,b._aabbMinZ=N._aabbMinZ<A._aabbMinZ?N._aabbMinZ:A._aabbMinZ,b._aabbMaxX=N._aabbMaxX>A._aabbMaxX?N._aabbMaxX:A._aabbMaxX,b._aabbMaxY=N._aabbMaxY>A._aabbMaxY?N._aabbMaxY:A._aabbMaxY,b._aabbMaxZ=N._aabbMaxZ>A._aabbMaxZ?N._aabbMaxZ:A._aabbMaxZ;var Y=b._children[0]._height,R=b._children[1]._height;b._height=(Y>R?Y:R)+1}else{c._children[0]=b,b._parent=c,b._childIndex=0,b._children[0]=I,I._parent=b,I._childIndex=0;var C=c._children[0],d=c._children[1];c._aabbMinX=C._aabbMinX<d._aabbMinX?C._aabbMinX:d._aabbMinX,c._aabbMinY=C._aabbMinY<d._aabbMinY?C._aabbMinY:d._aabbMinY,c._aabbMinZ=C._aabbMinZ<d._aabbMinZ?C._aabbMinZ:d._aabbMinZ,c._aabbMaxX=C._aabbMaxX>d._aabbMaxX?C._aabbMaxX:d._aabbMaxX,c._aabbMaxY=C._aabbMaxY>d._aabbMaxY?C._aabbMaxY:d._aabbMaxY,c._aabbMaxZ=C._aabbMaxZ>d._aabbMaxZ?C._aabbMaxZ:d._aabbMaxZ;var Z=c._children[0]._height,j=c._children[1]._height;c._height=(Z>j?Z:j)+1;var H=b._children[0],E=b._children[1];b._aabbMinX=H._aabbMinX<E._aabbMinX?H._aabbMinX:E._aabbMinX,b._aabbMinY=H._aabbMinY<E._aabbMinY?H._aabbMinY:E._aabbMinY,b._aabbMinZ=H._aabbMinZ<E._aabbMinZ?H._aabbMinZ:E._aabbMinZ,b._aabbMaxX=H._aabbMaxX>E._aabbMaxX?H._aabbMaxX:E._aabbMaxX,b._aabbMaxY=H._aabbMaxY>E._aabbMaxY?H._aabbMaxY:E._aabbMaxY,b._aabbMaxZ=H._aabbMaxZ>E._aabbMaxZ?H._aabbMaxZ:E._aabbMaxZ;var G=b._children[0]._height,B=b._children[1]._height;b._height=(G>B?G:B)+1}n!=null?(n._children[z]=c,c._parent=n,c._childIndex=z):(o._root=c,c._parent=null),b=c}else if(V<-1){var Q=M._children[0],W=M._children[1],J=Q._height,D=W._height;if(J>D){M._children[1]=b,b._parent=M,b._childIndex=1,b._children[1]=W,W._parent=b,W._childIndex=1;var O=M._children[0],K=M._children[1];M._aabbMinX=O._aabbMinX<K._aabbMinX?O._aabbMinX:K._aabbMinX,M._aabbMinY=O._aabbMinY<K._aabbMinY?O._aabbMinY:K._aabbMinY,M._aabbMinZ=O._aabbMinZ<K._aabbMinZ?O._aabbMinZ:K._aabbMinZ,M._aabbMaxX=O._aabbMaxX>K._aabbMaxX?O._aabbMaxX:K._aabbMaxX,M._aabbMaxY=O._aabbMaxY>K._aabbMaxY?O._aabbMaxY:K._aabbMaxY,M._aabbMaxZ=O._aabbMaxZ>K._aabbMaxZ?O._aabbMaxZ:K._aabbMaxZ;var ra=M._children[0]._height,sa=M._children[1]._height;M._height=(ra>sa?ra:sa)+1;var $=b._children[0],q=b._children[1];b._aabbMinX=$._aabbMinX<q._aabbMinX?$._aabbMinX:q._aabbMinX,b._aabbMinY=$._aabbMinY<q._aabbMinY?$._aabbMinY:q._aabbMinY,b._aabbMinZ=$._aabbMinZ<q._aabbMinZ?$._aabbMinZ:q._aabbMinZ,b._aabbMaxX=$._aabbMaxX>q._aabbMaxX?$._aabbMaxX:q._aabbMaxX,b._aabbMaxY=$._aabbMaxY>q._aabbMaxY?$._aabbMaxY:q._aabbMaxY,b._aabbMaxZ=$._aabbMaxZ>q._aabbMaxZ?$._aabbMaxZ:q._aabbMaxZ;var na=b._children[0]._height,oa=b._children[1]._height;b._height=(na>oa?na:oa)+1}else{M._children[0]=b,b._parent=M,b._childIndex=0,b._children[1]=Q,Q._parent=b,Q._childIndex=1;var aa=M._children[0],T=M._children[1];M._aabbMinX=aa._aabbMinX<T._aabbMinX?aa._aabbMinX:T._aabbMinX,M._aabbMinY=aa._aabbMinY<T._aabbMinY?aa._aabbMinY:T._aabbMinY,M._aabbMinZ=aa._aabbMinZ<T._aabbMinZ?aa._aabbMinZ:T._aabbMinZ,M._aabbMaxX=aa._aabbMaxX>T._aabbMaxX?aa._aabbMaxX:T._aabbMaxX,M._aabbMaxY=aa._aabbMaxY>T._aabbMaxY?aa._aabbMaxY:T._aabbMaxY,M._aabbMaxZ=aa._aabbMaxZ>T._aabbMaxZ?aa._aabbMaxZ:T._aabbMaxZ;var ca=M._children[0]._height,_a=M._children[1]._height;M._height=(ca>_a?ca:_a)+1;var k=b._children[0],ta=b._children[1];b._aabbMinX=k._aabbMinX<ta._aabbMinX?k._aabbMinX:ta._aabbMinX,b._aabbMinY=k._aabbMinY<ta._aabbMinY?k._aabbMinY:ta._aabbMinY,b._aabbMinZ=k._aabbMinZ<ta._aabbMinZ?k._aabbMinZ:ta._aabbMinZ,b._aabbMaxX=k._aabbMaxX>ta._aabbMaxX?k._aabbMaxX:ta._aabbMaxX,b._aabbMaxY=k._aabbMaxY>ta._aabbMaxY?k._aabbMaxY:ta._aabbMaxY,b._aabbMaxZ=k._aabbMaxZ>ta._aabbMaxZ?k._aabbMaxZ:ta._aabbMaxZ;var ia=b._children[0]._height,la=b._children[1]._height;b._height=(ia>la?ia:la)+1}n!=null?(n._children[z]=M,M._parent=n,M._childIndex=z):(o._root=M,M._parent=null),b=M}else b=b}}var va=b._children[0]._height,xa=b._children[1]._height;b._height=(va>xa?va:xa)+1;var Ma=b._children[0],za=b._children[1];b._aabbMinX=Ma._aabbMinX<za._aabbMinX?Ma._aabbMinX:za._aabbMinX,b._aabbMinY=Ma._aabbMinY<za._aabbMinY?Ma._aabbMinY:za._aabbMinY,b._aabbMinZ=Ma._aabbMinZ<za._aabbMinZ?Ma._aabbMinZ:za._aabbMinZ,b._aabbMaxX=Ma._aabbMaxX>za._aabbMaxX?Ma._aabbMaxX:za._aabbMaxX,b._aabbMaxY=Ma._aabbMaxY>za._aabbMaxY?Ma._aabbMaxY:za._aabbMaxY,b._aabbMaxZ=Ma._aabbMaxZ>za._aabbMaxZ?Ma._aabbMaxZ:za._aabbMaxZ,b=b._parent}}}i._leaf=null,s._next=null,s._childIndex=0,s._children[0]=null,s._children[1]=null,s._childIndex=0,s._parent=null,s._height=0,s._proxy=null,s._next=o._nodePool,o._nodePool=s,i.userData=null,i._next=null,i._prev=null,i._moved&&(i._moved=!1)}moveProxy(a,t,r){var i=a;if(!(i._aabbMinX<=t._minX&&i._aabbMaxX>=t._maxX&&i._aabbMinY<=t._minY&&i._aabbMaxY>=t._maxY&&i._aabbMinZ<=t._minZ&&i._aabbMaxZ>=t._maxZ)){i._aabbMinX=t._minX,i._aabbMinY=t._minY,i._aabbMinZ=t._minZ,i._aabbMaxX=t._maxX,i._aabbMaxY=t._maxY,i._aabbMaxZ=t._maxZ;var o=x.common.Setting.bvhProxyPadding,s,_,h;if(s=o,_=o,h=o,i._aabbMinX-=s,i._aabbMinY-=_,i._aabbMinZ-=h,i._aabbMaxX+=s,i._aabbMaxY+=_,i._aabbMaxZ+=h,r!=null){var v,e,l,u,b,f,n,c,M,m,y,V;u=0,b=0,f=0;var z=r;v=z.x,e=z.y,l=z.z,n=u<v?u:v,c=b<e?b:e,M=f<l?f:l,m=u>v?u:v,y=b>e?b:e,V=f>l?f:l,i._aabbMinX+=n,i._aabbMinY+=c,i._aabbMinZ+=M,i._aabbMaxX+=m,i._aabbMaxY+=y,i._aabbMaxZ+=V}if(!i._moved){if(i._moved=!0,this.movedProxies.length==this.numMovedProxies){for(var I=this.numMovedProxies<<1,w=new Array(I),X=w,L=0,p=this.numMovedProxies;L<p;){var g=L++;X[g]=this.movedProxies[g],this.movedProxies[g]=null}this.movedProxies=X}this.movedProxies[this.numMovedProxies++]=i}}}collectPairs(){var a=this._proxyPairList;if(a!=null){for(;a._p1=null,a._p2=null,a=a._next,a!=null;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}if(this._testCount=0,!(this._numProxies<2)){for(var t=this.numMovedProxies/this._numProxies<x.common.Setting.bvhIncrementalCollisionThreshold,r=0,i=this.numMovedProxies;r<i;){var o=r++,s=this.movedProxies[o];if(s._moved){var _=this._tree,h=s._leaf;_._numLeaves--;var v=h._prevLeaf,e=h._nextLeaf;if(v!=null&&(v._nextLeaf=e),e!=null&&(e._prevLeaf=v),h==_.leafList&&(_.leafList=_.leafList._nextLeaf),h==_.leafListLast&&(_.leafListLast=_.leafListLast._prevLeaf),h._nextLeaf=null,h._prevLeaf=null,_._root==h)_._root=null;else{var l=h._parent,u=l._children[h._childIndex^1],b=l._parent;if(b==null)u._parent=null,u._childIndex=0,_._root=u,l._next=null,l._childIndex=0,l._children[0]=null,l._children[1]=null,l._childIndex=0,l._parent=null,l._height=0,l._proxy=null,l._next=_._nodePool,_._nodePool=l;else{u._parent=b;var f=l._childIndex;b._children[f]=u,u._parent=b,u._childIndex=f,l._next=null,l._childIndex=0,l._children[0]=null,l._children[1]=null,l._childIndex=0,l._parent=null,l._height=0,l._proxy=null,l._next=_._nodePool,_._nodePool=l;for(var n=b;n!=null;){if(_._strategy._balancingEnabled){var c=n._height;if(c<2)n=n;else{var M=n._parent,m=n._children[0],y=n._children[1],V=m._height,z=y._height,I=V-z,w=n._childIndex;if(I>1){var X=m._children[0],L=m._children[1],p=X._height,g=L._height;if(p>g){m._children[1]=n,n._parent=m,n._childIndex=1,n._children[0]=L,L._parent=n,L._childIndex=0;var F=m._children[0],S=m._children[1];m._aabbMinX=F._aabbMinX<S._aabbMinX?F._aabbMinX:S._aabbMinX,m._aabbMinY=F._aabbMinY<S._aabbMinY?F._aabbMinY:S._aabbMinY,m._aabbMinZ=F._aabbMinZ<S._aabbMinZ?F._aabbMinZ:S._aabbMinZ,m._aabbMaxX=F._aabbMaxX>S._aabbMaxX?F._aabbMaxX:S._aabbMaxX,m._aabbMaxY=F._aabbMaxY>S._aabbMaxY?F._aabbMaxY:S._aabbMaxY,m._aabbMaxZ=F._aabbMaxZ>S._aabbMaxZ?F._aabbMaxZ:S._aabbMaxZ;var N=m._children[0]._height,A=m._children[1]._height;m._height=(N>A?N:A)+1;var Y=n._children[0],R=n._children[1];n._aabbMinX=Y._aabbMinX<R._aabbMinX?Y._aabbMinX:R._aabbMinX,n._aabbMinY=Y._aabbMinY<R._aabbMinY?Y._aabbMinY:R._aabbMinY,n._aabbMinZ=Y._aabbMinZ<R._aabbMinZ?Y._aabbMinZ:R._aabbMinZ,n._aabbMaxX=Y._aabbMaxX>R._aabbMaxX?Y._aabbMaxX:R._aabbMaxX,n._aabbMaxY=Y._aabbMaxY>R._aabbMaxY?Y._aabbMaxY:R._aabbMaxY,n._aabbMaxZ=Y._aabbMaxZ>R._aabbMaxZ?Y._aabbMaxZ:R._aabbMaxZ;var C=n._children[0]._height,d=n._children[1]._height;n._height=(C>d?C:d)+1}else{m._children[0]=n,n._parent=m,n._childIndex=0,n._children[0]=X,X._parent=n,X._childIndex=0;var Z=m._children[0],j=m._children[1];m._aabbMinX=Z._aabbMinX<j._aabbMinX?Z._aabbMinX:j._aabbMinX,m._aabbMinY=Z._aabbMinY<j._aabbMinY?Z._aabbMinY:j._aabbMinY,m._aabbMinZ=Z._aabbMinZ<j._aabbMinZ?Z._aabbMinZ:j._aabbMinZ,m._aabbMaxX=Z._aabbMaxX>j._aabbMaxX?Z._aabbMaxX:j._aabbMaxX,m._aabbMaxY=Z._aabbMaxY>j._aabbMaxY?Z._aabbMaxY:j._aabbMaxY,m._aabbMaxZ=Z._aabbMaxZ>j._aabbMaxZ?Z._aabbMaxZ:j._aabbMaxZ;var H=m._children[0]._height,E=m._children[1]._height;m._height=(H>E?H:E)+1;var G=n._children[0],B=n._children[1];n._aabbMinX=G._aabbMinX<B._aabbMinX?G._aabbMinX:B._aabbMinX,n._aabbMinY=G._aabbMinY<B._aabbMinY?G._aabbMinY:B._aabbMinY,n._aabbMinZ=G._aabbMinZ<B._aabbMinZ?G._aabbMinZ:B._aabbMinZ,n._aabbMaxX=G._aabbMaxX>B._aabbMaxX?G._aabbMaxX:B._aabbMaxX,n._aabbMaxY=G._aabbMaxY>B._aabbMaxY?G._aabbMaxY:B._aabbMaxY,n._aabbMaxZ=G._aabbMaxZ>B._aabbMaxZ?G._aabbMaxZ:B._aabbMaxZ;var Q=n._children[0]._height,W=n._children[1]._height;n._height=(Q>W?Q:W)+1}M!=null?(M._children[w]=m,m._parent=M,m._childIndex=w):(_._root=m,m._parent=null),n=m}else if(I<-1){var J=y._children[0],D=y._children[1],O=J._height,K=D._height;if(O>K){y._children[1]=n,n._parent=y,n._childIndex=1,n._children[1]=D,D._parent=n,D._childIndex=1;var ra=y._children[0],sa=y._children[1];y._aabbMinX=ra._aabbMinX<sa._aabbMinX?ra._aabbMinX:sa._aabbMinX,y._aabbMinY=ra._aabbMinY<sa._aabbMinY?ra._aabbMinY:sa._aabbMinY,y._aabbMinZ=ra._aabbMinZ<sa._aabbMinZ?ra._aabbMinZ:sa._aabbMinZ,y._aabbMaxX=ra._aabbMaxX>sa._aabbMaxX?ra._aabbMaxX:sa._aabbMaxX,y._aabbMaxY=ra._aabbMaxY>sa._aabbMaxY?ra._aabbMaxY:sa._aabbMaxY,y._aabbMaxZ=ra._aabbMaxZ>sa._aabbMaxZ?ra._aabbMaxZ:sa._aabbMaxZ;var $=y._children[0]._height,q=y._children[1]._height;y._height=($>q?$:q)+1;var na=n._children[0],oa=n._children[1];n._aabbMinX=na._aabbMinX<oa._aabbMinX?na._aabbMinX:oa._aabbMinX,n._aabbMinY=na._aabbMinY<oa._aabbMinY?na._aabbMinY:oa._aabbMinY,n._aabbMinZ=na._aabbMinZ<oa._aabbMinZ?na._aabbMinZ:oa._aabbMinZ,n._aabbMaxX=na._aabbMaxX>oa._aabbMaxX?na._aabbMaxX:oa._aabbMaxX,n._aabbMaxY=na._aabbMaxY>oa._aabbMaxY?na._aabbMaxY:oa._aabbMaxY,n._aabbMaxZ=na._aabbMaxZ>oa._aabbMaxZ?na._aabbMaxZ:oa._aabbMaxZ;var aa=n._children[0]._height,T=n._children[1]._height;n._height=(aa>T?aa:T)+1}else{y._children[0]=n,n._parent=y,n._childIndex=0,n._children[1]=J,J._parent=n,J._childIndex=1;var ca=y._children[0],_a=y._children[1];y._aabbMinX=ca._aabbMinX<_a._aabbMinX?ca._aabbMinX:_a._aabbMinX,y._aabbMinY=ca._aabbMinY<_a._aabbMinY?ca._aabbMinY:_a._aabbMinY,y._aabbMinZ=ca._aabbMinZ<_a._aabbMinZ?ca._aabbMinZ:_a._aabbMinZ,y._aabbMaxX=ca._aabbMaxX>_a._aabbMaxX?ca._aabbMaxX:_a._aabbMaxX,y._aabbMaxY=ca._aabbMaxY>_a._aabbMaxY?ca._aabbMaxY:_a._aabbMaxY,y._aabbMaxZ=ca._aabbMaxZ>_a._aabbMaxZ?ca._aabbMaxZ:_a._aabbMaxZ;var k=y._children[0]._height,ta=y._children[1]._height;y._height=(k>ta?k:ta)+1;var ia=n._children[0],la=n._children[1];n._aabbMinX=ia._aabbMinX<la._aabbMinX?ia._aabbMinX:la._aabbMinX,n._aabbMinY=ia._aabbMinY<la._aabbMinY?ia._aabbMinY:la._aabbMinY,n._aabbMinZ=ia._aabbMinZ<la._aabbMinZ?ia._aabbMinZ:la._aabbMinZ,n._aabbMaxX=ia._aabbMaxX>la._aabbMaxX?ia._aabbMaxX:la._aabbMaxX,n._aabbMaxY=ia._aabbMaxY>la._aabbMaxY?ia._aabbMaxY:la._aabbMaxY,n._aabbMaxZ=ia._aabbMaxZ>la._aabbMaxZ?ia._aabbMaxZ:la._aabbMaxZ;var va=n._children[0]._height,xa=n._children[1]._height;n._height=(va>xa?va:xa)+1}M!=null?(M._children[w]=y,y._parent=M,y._childIndex=w):(_._root=y,y._parent=null),n=y}else n=n}}var Ma=n._children[0]._height,za=n._children[1]._height;n._height=(Ma>za?Ma:za)+1;var Xa=n._children[0],Za=n._children[1];n._aabbMinX=Xa._aabbMinX<Za._aabbMinX?Xa._aabbMinX:Za._aabbMinX,n._aabbMinY=Xa._aabbMinY<Za._aabbMinY?Xa._aabbMinY:Za._aabbMinY,n._aabbMinZ=Xa._aabbMinZ<Za._aabbMinZ?Xa._aabbMinZ:Za._aabbMinZ,n._aabbMaxX=Xa._aabbMaxX>Za._aabbMaxX?Xa._aabbMaxX:Za._aabbMaxX,n._aabbMaxY=Xa._aabbMaxY>Za._aabbMaxY?Xa._aabbMaxY:Za._aabbMaxY,n._aabbMaxZ=Xa._aabbMaxZ>Za._aabbMaxZ?Xa._aabbMaxZ:Za._aabbMaxZ,n=n._parent}}}s._leaf=null,h._next=null,h._childIndex=0,h._children[0]=null,h._children[1]=null,h._childIndex=0,h._parent=null,h._height=0,h._proxy=null,h._next=_._nodePool,_._nodePool=h;var fa=this._tree,ba=fa._nodePool;ba!=null?(fa._nodePool=ba._next,ba._next=null):ba=new x.collision.broadphase.bvh.BvhNode;var ea=ba;if(ea._proxy=s,s._leaf=ea,ea._aabbMinX=s._aabbMinX,ea._aabbMinY=s._aabbMinY,ea._aabbMinZ=s._aabbMinZ,ea._aabbMaxX=s._aabbMaxX,ea._aabbMaxY=s._aabbMaxY,ea._aabbMaxZ=s._aabbMaxZ,fa._numLeaves++,fa.leafList==null?(fa.leafList=ea,fa.leafListLast=ea):(fa.leafListLast._nextLeaf=ea,ea._prevLeaf=fa.leafListLast,fa.leafListLast=ea),fa._root==null)fa._root=ea;else{for(var ha=fa._root;ha._height>0;){var pa=fa._strategy._decideInsertion(ha,ea);if(pa==-1)break;ha=ha._children[pa]}var ya=ha._parent,da=fa._nodePool;da!=null?(fa._nodePool=da._next,da._next=null):da=new x.collision.broadphase.bvh.BvhNode;var ma=da;if(ya==null)fa._root=ma;else{var Ya=ha._childIndex;ya._children[Ya]=ma,ma._parent=ya,ma._childIndex=Ya}var Qa=ha._childIndex;ma._children[Qa]=ha,ha._parent=ma,ha._childIndex=Qa;var ga=ha._childIndex^1;for(ma._children[ga]=ea,ea._parent=ma,ea._childIndex=ga;ma!=null;){if(fa._strategy._balancingEnabled){var ua=ma._height;if(ua<2)ma=ma;else{var ka=ma._parent,wa=ma._children[0],Pa=ma._children[1],Mt=wa._height,Oa=Pa._height,Ba=Mt-Oa,nt=ma._childIndex;if(Ba>1){var Ea=wa._children[0],Na=wa._children[1],Sa=Ea._height,ft=Na._height;if(Sa>ft){wa._children[1]=ma,ma._parent=wa,ma._childIndex=1,ma._children[0]=Na,Na._parent=ma,Na._childIndex=0;var Wa=wa._children[0],Ha=wa._children[1];wa._aabbMinX=Wa._aabbMinX<Ha._aabbMinX?Wa._aabbMinX:Ha._aabbMinX,wa._aabbMinY=Wa._aabbMinY<Ha._aabbMinY?Wa._aabbMinY:Ha._aabbMinY,wa._aabbMinZ=Wa._aabbMinZ<Ha._aabbMinZ?Wa._aabbMinZ:Ha._aabbMinZ,wa._aabbMaxX=Wa._aabbMaxX>Ha._aabbMaxX?Wa._aabbMaxX:Ha._aabbMaxX,wa._aabbMaxY=Wa._aabbMaxY>Ha._aabbMaxY?Wa._aabbMaxY:Ha._aabbMaxY,wa._aabbMaxZ=Wa._aabbMaxZ>Ha._aabbMaxZ?Wa._aabbMaxZ:Ha._aabbMaxZ;var bt=wa._children[0]._height,rt=wa._children[1]._height;wa._height=(bt>rt?bt:rt)+1;var ja=ma._children[0],_t=ma._children[1];ma._aabbMinX=ja._aabbMinX<_t._aabbMinX?ja._aabbMinX:_t._aabbMinX,ma._aabbMinY=ja._aabbMinY<_t._aabbMinY?ja._aabbMinY:_t._aabbMinY,ma._aabbMinZ=ja._aabbMinZ<_t._aabbMinZ?ja._aabbMinZ:_t._aabbMinZ,ma._aabbMaxX=ja._aabbMaxX>_t._aabbMaxX?ja._aabbMaxX:_t._aabbMaxX,ma._aabbMaxY=ja._aabbMaxY>_t._aabbMaxY?ja._aabbMaxY:_t._aabbMaxY,ma._aabbMaxZ=ja._aabbMaxZ>_t._aabbMaxZ?ja._aabbMaxZ:_t._aabbMaxZ;var gt=ma._children[0]._height,mt=ma._children[1]._height;ma._height=(gt>mt?gt:mt)+1}else{wa._children[0]=ma,ma._parent=wa,ma._childIndex=0,ma._children[0]=Ea,Ea._parent=ma,Ea._childIndex=0;var Ja=wa._children[0],it=wa._children[1];wa._aabbMinX=Ja._aabbMinX<it._aabbMinX?Ja._aabbMinX:it._aabbMinX,wa._aabbMinY=Ja._aabbMinY<it._aabbMinY?Ja._aabbMinY:it._aabbMinY,wa._aabbMinZ=Ja._aabbMinZ<it._aabbMinZ?Ja._aabbMinZ:it._aabbMinZ,wa._aabbMaxX=Ja._aabbMaxX>it._aabbMaxX?Ja._aabbMaxX:it._aabbMaxX,wa._aabbMaxY=Ja._aabbMaxY>it._aabbMaxY?Ja._aabbMaxY:it._aabbMaxY,wa._aabbMaxZ=Ja._aabbMaxZ>it._aabbMaxZ?Ja._aabbMaxZ:it._aabbMaxZ;var ut=wa._children[0]._height,Da=wa._children[1]._height;wa._height=(ut>Da?ut:Da)+1;var Ta=ma._children[0],Fa=ma._children[1];ma._aabbMinX=Ta._aabbMinX<Fa._aabbMinX?Ta._aabbMinX:Fa._aabbMinX,ma._aabbMinY=Ta._aabbMinY<Fa._aabbMinY?Ta._aabbMinY:Fa._aabbMinY,ma._aabbMinZ=Ta._aabbMinZ<Fa._aabbMinZ?Ta._aabbMinZ:Fa._aabbMinZ,ma._aabbMaxX=Ta._aabbMaxX>Fa._aabbMaxX?Ta._aabbMaxX:Fa._aabbMaxX,ma._aabbMaxY=Ta._aabbMaxY>Fa._aabbMaxY?Ta._aabbMaxY:Fa._aabbMaxY,ma._aabbMaxZ=Ta._aabbMaxZ>Fa._aabbMaxZ?Ta._aabbMaxZ:Fa._aabbMaxZ;var Vt=ma._children[0]._height,Pt=ma._children[1]._height;ma._height=(Vt>Pt?Vt:Pt)+1}ka!=null?(ka._children[nt]=wa,wa._parent=ka,wa._childIndex=nt):(fa._root=wa,wa._parent=null),ma=wa}else if(Ba<-1){var et=Pa._children[0],Xt=Pa._children[1],Yt=et._height,zt=Xt._height;if(Yt>zt){Pa._children[1]=ma,ma._parent=Pa,ma._childIndex=1,ma._children[1]=Xt,Xt._parent=ma,Xt._childIndex=1;var Ia=Pa._children[0],U=Pa._children[1];Pa._aabbMinX=Ia._aabbMinX<U._aabbMinX?Ia._aabbMinX:U._aabbMinX,Pa._aabbMinY=Ia._aabbMinY<U._aabbMinY?Ia._aabbMinY:U._aabbMinY,Pa._aabbMinZ=Ia._aabbMinZ<U._aabbMinZ?Ia._aabbMinZ:U._aabbMinZ,Pa._aabbMaxX=Ia._aabbMaxX>U._aabbMaxX?Ia._aabbMaxX:U._aabbMaxX,Pa._aabbMaxY=Ia._aabbMaxY>U._aabbMaxY?Ia._aabbMaxY:U._aabbMaxY,Pa._aabbMaxZ=Ia._aabbMaxZ>U._aabbMaxZ?Ia._aabbMaxZ:U._aabbMaxZ;var Va=Pa._children[0]._height,lt=Pa._children[1]._height;Pa._height=(Va>lt?Va:lt)+1;var P=ma._children[0],kt=ma._children[1];ma._aabbMinX=P._aabbMinX<kt._aabbMinX?P._aabbMinX:kt._aabbMinX,ma._aabbMinY=P._aabbMinY<kt._aabbMinY?P._aabbMinY:kt._aabbMinY,ma._aabbMinZ=P._aabbMinZ<kt._aabbMinZ?P._aabbMinZ:kt._aabbMinZ,ma._aabbMaxX=P._aabbMaxX>kt._aabbMaxX?P._aabbMaxX:kt._aabbMaxX,ma._aabbMaxY=P._aabbMaxY>kt._aabbMaxY?P._aabbMaxY:kt._aabbMaxY,ma._aabbMaxZ=P._aabbMaxZ>kt._aabbMaxZ?P._aabbMaxZ:kt._aabbMaxZ;var Bt=ma._children[0]._height,St=ma._children[1]._height;ma._height=(Bt>St?Bt:St)+1}else{Pa._children[0]=ma,ma._parent=Pa,ma._childIndex=0,ma._children[1]=et,et._parent=ma,et._childIndex=1;var yt=Pa._children[0],wt=Pa._children[1];Pa._aabbMinX=yt._aabbMinX<wt._aabbMinX?yt._aabbMinX:wt._aabbMinX,Pa._aabbMinY=yt._aabbMinY<wt._aabbMinY?yt._aabbMinY:wt._aabbMinY,Pa._aabbMinZ=yt._aabbMinZ<wt._aabbMinZ?yt._aabbMinZ:wt._aabbMinZ,Pa._aabbMaxX=yt._aabbMaxX>wt._aabbMaxX?yt._aabbMaxX:wt._aabbMaxX,Pa._aabbMaxY=yt._aabbMaxY>wt._aabbMaxY?yt._aabbMaxY:wt._aabbMaxY,Pa._aabbMaxZ=yt._aabbMaxZ>wt._aabbMaxZ?yt._aabbMaxZ:wt._aabbMaxZ;var pt=Pa._children[0]._height,ht=Pa._children[1]._height;Pa._height=(pt>ht?pt:ht)+1;var xt=ma._children[0],Ra=ma._children[1];ma._aabbMinX=xt._aabbMinX<Ra._aabbMinX?xt._aabbMinX:Ra._aabbMinX,ma._aabbMinY=xt._aabbMinY<Ra._aabbMinY?xt._aabbMinY:Ra._aabbMinY,ma._aabbMinZ=xt._aabbMinZ<Ra._aabbMinZ?xt._aabbMinZ:Ra._aabbMinZ,ma._aabbMaxX=xt._aabbMaxX>Ra._aabbMaxX?xt._aabbMaxX:Ra._aabbMaxX,ma._aabbMaxY=xt._aabbMaxY>Ra._aabbMaxY?xt._aabbMaxY:Ra._aabbMaxY,ma._aabbMaxZ=xt._aabbMaxZ>Ra._aabbMaxZ?xt._aabbMaxZ:Ra._aabbMaxZ;var st=ma._children[0]._height,Ca=ma._children[1]._height;ma._height=(st>Ca?st:Ca)+1}ka!=null?(ka._children[nt]=Pa,Pa._parent=ka,Pa._childIndex=nt):(fa._root=Pa,Pa._parent=null),ma=Pa}else ma=ma}}var vt=ma._children[0]._height,qa=ma._children[1]._height;ma._height=(vt>qa?vt:qa)+1;var at=ma._children[0],Ua=ma._children[1];ma._aabbMinX=at._aabbMinX<Ua._aabbMinX?at._aabbMinX:Ua._aabbMinX,ma._aabbMinY=at._aabbMinY<Ua._aabbMinY?at._aabbMinY:Ua._aabbMinY,ma._aabbMinZ=at._aabbMinZ<Ua._aabbMinZ?at._aabbMinZ:Ua._aabbMinZ,ma._aabbMaxX=at._aabbMaxX>Ua._aabbMaxX?at._aabbMaxX:Ua._aabbMaxX,ma._aabbMaxY=at._aabbMaxY>Ua._aabbMaxY?at._aabbMaxY:Ua._aabbMaxY,ma._aabbMaxZ=at._aabbMaxZ>Ua._aabbMaxZ?at._aabbMaxZ:Ua._aabbMaxZ,ma=ma._parent}}t&&this.collide(this._tree._root,s._leaf),s._moved=!1}this.movedProxies[o]=null}t||this.collide(this._tree._root,this._tree._root),this.numMovedProxies=0}}rayCast(a,t,r){if(this._tree._root!=null){var i,o,s,_,h,v,e=a;i=e.x,o=e.y,s=e.z;var l=t;_=l.x,h=l.y,v=l.z,this.rayCastRecursive(this._tree._root,i,o,s,_,h,v,r)}}convexCast(a,t,r,i){this._tree._root!=null&&this.convexCastRecursive(this._tree._root,a,t,r,i)}aabbTest(a,t){this._tree._root!=null&&this.aabbTestRecursive(this._tree._root,a,t)}getTreeBalance(){return this._tree._getBalance()}};x.collision.broadphase.bvh.BvhInsertionStrategy=class{};x.collision.broadphase.bvh.BvhNode=class{constructor(){this._next=null,this._prevLeaf=null,this._nextLeaf=null;var a=new Array(2);this._children=a,this._childIndex=0,this._parent=null,this._height=0,this._proxy=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}};x.collision.broadphase.bvh.BvhProxy=class extends x.collision.broadphase.Proxy{constructor(a,t){super(a,t),this._leaf=null,this._moved=!1}};x.collision.broadphase.bvh.BvhStrategy=class{constructor(){this._insertionStrategy=0,this._balancingEnabled=!1}_decideInsertion(a,t){switch(this._insertionStrategy){case 0:var r,i,o;r=t._aabbMinX+t._aabbMaxX,i=t._aabbMinY+t._aabbMaxY,o=t._aabbMinZ+t._aabbMaxZ;var s=a._children[0],_=a._children[1],h,v,e,l,u,b;h=s._aabbMinX+s._aabbMaxX,v=s._aabbMinY+s._aabbMaxY,e=s._aabbMinZ+s._aabbMaxZ,l=_._aabbMinX+_._aabbMaxX,u=_._aabbMinY+_._aabbMaxY,b=_._aabbMinZ+_._aabbMaxZ,h-=r,v-=i,e-=o,l-=r,u-=i,b-=o;var f=h*h+v*v+e*e,n=l*l+u*u+b*b;return f<n?0:1;case 1:var c=a._children[0],M=a._children[1],m=a._aabbMaxX-a._aabbMinX,y=a._aabbMaxY-a._aabbMinY,V=a._aabbMaxZ-a._aabbMinZ,z=(m*(y+V)+y*V)*2,I,w,X,L,p,g;I=a._aabbMinX<t._aabbMinX?a._aabbMinX:t._aabbMinX,w=a._aabbMinY<t._aabbMinY?a._aabbMinY:t._aabbMinY,X=a._aabbMinZ<t._aabbMinZ?a._aabbMinZ:t._aabbMinZ,L=a._aabbMaxX>t._aabbMaxX?a._aabbMaxX:t._aabbMaxX,p=a._aabbMaxY>t._aabbMaxY?a._aabbMaxY:t._aabbMaxY,g=a._aabbMaxZ>t._aabbMaxZ?a._aabbMaxZ:t._aabbMaxZ;var F=L-I,S=p-w,N=g-X,A=(F*(S+N)+S*N)*2,Y=A*2,R=(A-z)*2,C=R;if(I=c._aabbMinX<t._aabbMinX?c._aabbMinX:t._aabbMinX,w=c._aabbMinY<t._aabbMinY?c._aabbMinY:t._aabbMinY,X=c._aabbMinZ<t._aabbMinZ?c._aabbMinZ:t._aabbMinZ,L=c._aabbMaxX>t._aabbMaxX?c._aabbMaxX:t._aabbMaxX,p=c._aabbMaxY>t._aabbMaxY?c._aabbMaxY:t._aabbMaxY,g=c._aabbMaxZ>t._aabbMaxZ?c._aabbMaxZ:t._aabbMaxZ,c._height==0){var d=L-I,Z=p-w,j=g-X;C+=(d*(Z+j)+Z*j)*2}else{var H=L-I,E=p-w,G=g-X,B=c._aabbMaxX-c._aabbMinX,Q=c._aabbMaxY-c._aabbMinY,W=c._aabbMaxZ-c._aabbMinZ;C+=(H*(E+G)+E*G)*2-(B*(Q+W)+Q*W)*2}var J=R;if(I=M._aabbMinX<t._aabbMinX?M._aabbMinX:t._aabbMinX,w=M._aabbMinY<t._aabbMinY?M._aabbMinY:t._aabbMinY,X=M._aabbMinZ<t._aabbMinZ?M._aabbMinZ:t._aabbMinZ,L=M._aabbMaxX>t._aabbMaxX?M._aabbMaxX:t._aabbMaxX,p=M._aabbMaxY>t._aabbMaxY?M._aabbMaxY:t._aabbMaxY,g=M._aabbMaxZ>t._aabbMaxZ?M._aabbMaxZ:t._aabbMaxZ,M._height==0){var D=L-I,O=p-w,K=g-X;J+=(D*(O+K)+O*K)*2}else{var ra=L-I,sa=p-w,$=g-X,q=M._aabbMaxX-M._aabbMinX,na=M._aabbMaxY-M._aabbMinY,oa=M._aabbMaxZ-M._aabbMinZ;J+=(ra*(sa+$)+sa*$)*2-(q*(na+oa)+na*oa)*2}return Y<C?Y<J?-1:1:C<J?0:1;default:return console.log("src/oimo/collision/broadphase/bvh/BvhStrategy.hx:37:","invalid BVH insertion strategy: "+this._insertionStrategy),-1}}_splitLeaves(a,t,r){var i=1/(r-t),o,s,_;o=0,s=0,_=0;for(var h=t,v=r;h<v;){var e=h++,l=a[e];l._tmpX=l._aabbMaxX+l._aabbMinX,l._tmpY=l._aabbMaxY+l._aabbMinY,l._tmpZ=l._aabbMaxZ+l._aabbMinZ,o+=l._tmpX,s+=l._tmpY,_+=l._tmpZ}o*=i,s*=i,_*=i;var u,b,f;u=0,b=0,f=0;for(var n=t,c=r;n<c;){var M=n++,m=a[M],y,V,z;y=m._tmpX-o,V=m._tmpY-s,z=m._tmpZ-_,y*=y,V*=V,z*=z,u+=y,b+=V,f+=z}var I=u,w=b,X=f,L=t,p=r-1;if(I>w)if(I>X)for(var g=o;;){for(;;){var F=a[L];if(F._tmpX<=g)break;++L}for(;;){var S=a[p];if(S._tmpX>=g)break;--p}if(L>=p)break;var N=a[L];a[L]=a[p],a[p]=N,++L,--p}else for(var A=_;;){for(;;){var Y=a[L];if(Y._tmpZ<=A)break;++L}for(;;){var R=a[p];if(R._tmpZ>=A)break;--p}if(L>=p)break;var C=a[L];a[L]=a[p],a[p]=C,++L,--p}else if(w>X)for(var d=s;;){for(;;){var Z=a[L];if(Z._tmpY<=d)break;++L}for(;;){var j=a[p];if(j._tmpY>=d)break;--p}if(L>=p)break;var H=a[L];a[L]=a[p],a[p]=H,++L,--p}else for(var E=_;;){for(;;){var G=a[L];if(G._tmpZ<=E)break;++L}for(;;){var B=a[p];if(B._tmpZ>=E)break;--p}if(L>=p)break;var Q=a[L];a[L]=a[p],a[p]=Q,++L,--p}return L}};x.collision.broadphase.bvh.BvhTree=class{constructor(){this._root=null,this._numLeaves=0,this._strategy=new x.collision.broadphase.bvh.BvhStrategy,this._nodePool=null,this.leafList=null,this.leafListLast=null;var a=new Array(1024);this.tmp=a}_print(a,t){if(t==null&&(t=""),a!=null)if(a._height==0)console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:39:",t+a._proxy._id);else{this._print(a._children[0],t+"  ");var r,i,o,s;i=a._aabbMaxX-a._aabbMinX,o=a._aabbMaxY-a._aabbMinY,s=a._aabbMaxZ-a._aabbMinZ;var _=i,h=o,v=s;if(_*(h+v)+h*v>0){var e,l,u;e=a._aabbMaxX-a._aabbMinX,l=a._aabbMaxY-a._aabbMinY,u=a._aabbMaxZ-a._aabbMinZ;var b=e,f=l,n=u;r=((b*(f+n)+f*n)*1e3+.5|0)/1e3}else{var c,M,m;c=a._aabbMaxX-a._aabbMinX,M=a._aabbMaxY-a._aabbMinY,m=a._aabbMaxZ-a._aabbMinZ;var y=c,V=M,z=m;r=((y*(V+z)+V*z)*1e3-.5|0)/1e3}console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:42:",t+"#"+a._height+", "+r),this._print(a._children[1],t+"  ")}}_getBalance(){return this.getBalanceRecursive(this._root)}deleteRecursive(a){if(a._height==0){var t=a._prevLeaf,r=a._nextLeaf;t!=null&&(t._nextLeaf=r),r!=null&&(r._prevLeaf=t),a==this.leafList&&(this.leafList=this.leafList._nextLeaf),a==this.leafListLast&&(this.leafListLast=this.leafListLast._prevLeaf),a._nextLeaf=null,a._prevLeaf=null,a._proxy._leaf=null,a._next=null,a._childIndex=0,a._children[0]=null,a._children[1]=null,a._childIndex=0,a._parent=null,a._height=0,a._proxy=null,a._next=this._nodePool,this._nodePool=a;return}this.deleteRecursive(a._children[0]),this.deleteRecursive(a._children[1]),a._next=null,a._childIndex=0,a._children[0]=null,a._children[1]=null,a._childIndex=0,a._parent=null,a._height=0,a._proxy=null,a._next=this._nodePool,this._nodePool=a}decomposeRecursive(a){if(a._height==0){a._childIndex=0,a._parent=null;return}this.decomposeRecursive(a._children[0]),this.decomposeRecursive(a._children[1]),a._next=null,a._childIndex=0,a._children[0]=null,a._children[1]=null,a._childIndex=0,a._parent=null,a._height=0,a._proxy=null,a._next=this._nodePool,this._nodePool=a}buildTopDownRecursive(a,t,r){var i=r-t;if(i==1){var o=a[t],s=o._proxy;return o._aabbMinX=s._aabbMinX,o._aabbMinY=s._aabbMinY,o._aabbMinZ=s._aabbMinZ,o._aabbMaxX=s._aabbMaxX,o._aabbMaxY=s._aabbMaxY,o._aabbMaxZ=s._aabbMaxZ,o}var _=this._strategy._splitLeaves(a,t,r),h=this.buildTopDownRecursive(a,t,_),v=this.buildTopDownRecursive(a,_,r),e=this._nodePool;e!=null?(this._nodePool=e._next,e._next=null):e=new x.collision.broadphase.bvh.BvhNode;var l=e;l._children[0]=h,h._parent=l,h._childIndex=0,l._children[1]=v,v._parent=l,v._childIndex=1;var u=l._children[0],b=l._children[1];l._aabbMinX=u._aabbMinX<b._aabbMinX?u._aabbMinX:b._aabbMinX,l._aabbMinY=u._aabbMinY<b._aabbMinY?u._aabbMinY:b._aabbMinY,l._aabbMinZ=u._aabbMinZ<b._aabbMinZ?u._aabbMinZ:b._aabbMinZ,l._aabbMaxX=u._aabbMaxX>b._aabbMaxX?u._aabbMaxX:b._aabbMaxX,l._aabbMaxY=u._aabbMaxY>b._aabbMaxY?u._aabbMaxY:b._aabbMaxY,l._aabbMaxZ=u._aabbMaxZ>b._aabbMaxZ?u._aabbMaxZ:b._aabbMaxZ;var f=l._children[0]._height,n=l._children[1]._height;return l._height=(f>n?f:n)+1,l}getBalanceRecursive(a){if(a==null||a._height==0)return 0;var t=a._children[0]._height-a._children[1]._height;return t<0&&(t=-t),t+this.getBalanceRecursive(a._children[0])+this.getBalanceRecursive(a._children[1])}};x.collision.geometry.Aabb=class{constructor(){this._minX=0,this._minY=0,this._minZ=0,this._maxX=0,this._maxY=0,this._maxZ=0}init(a,t){var r=a;this._minX=r.x,this._minY=r.y,this._minZ=r.z;var i=t;return this._maxX=i.x,this._maxY=i.y,this._maxZ=i.z,this}getMin(){var a=new x.common.Vec3,t=a;return t.x=this._minX,t.y=this._minY,t.z=this._minZ,a}getMinTo(a){var t=a;t.x=this._minX,t.y=this._minY,t.z=this._minZ}setMin(a){var t=a;return this._minX=t.x,this._minY=t.y,this._minZ=t.z,this}getMax(){var a=new x.common.Vec3,t=a;return t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ,a}getMaxTo(a){var t=a;t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ}setMax(a){var t=a;return this._maxX=t.x,this._maxY=t.y,this._maxZ=t.z,this}getCenter(){var a=new x.common.Vec3,t,r,i;t=this._minX+this._maxX,r=this._minY+this._maxY,i=this._minZ+this._maxZ,t*=.5,r*=.5,i*=.5;var o=a;return o.x=t,o.y=r,o.z=i,a}getCenterTo(a){var t,r,i;t=this._minX+this._maxX,r=this._minY+this._maxY,i=this._minZ+this._maxZ,t*=.5,r*=.5,i*=.5;var o=a;o.x=t,o.y=r,o.z=i}getExtents(){var a=new x.common.Vec3,t,r,i;t=this._maxX-this._minX,r=this._maxY-this._minY,i=this._maxZ-this._minZ,t*=.5,r*=.5,i*=.5;var o=a;return o.x=t,o.y=r,o.z=i,a}getExtentsTo(a){var t,r,i;t=this._maxX-this._minX,r=this._maxY-this._minY,i=this._maxZ-this._minZ,t*=.5,r*=.5,i*=.5;var o=a;o.x=t,o.y=r,o.z=i}combine(a){return this._minX=this._minX<a._minX?this._minX:a._minX,this._minY=this._minY<a._minY?this._minY:a._minY,this._minZ=this._minZ<a._minZ?this._minZ:a._minZ,this._maxX=this._maxX>a._maxX?this._maxX:a._maxX,this._maxY=this._maxY>a._maxY?this._maxY:a._maxY,this._maxZ=this._maxZ>a._maxZ?this._maxZ:a._maxZ,this}combined(a){var t=new x.collision.geometry.Aabb;return t._minX=this._minX<a._minX?this._minX:a._minX,t._minY=this._minY<a._minY?this._minY:a._minY,t._minZ=this._minZ<a._minZ?this._minZ:a._minZ,t._maxX=this._maxX>a._maxX?this._maxX:a._maxX,t._maxY=this._maxY>a._maxY?this._maxY:a._maxY,t._maxZ=this._maxZ>a._maxZ?this._maxZ:a._maxZ,t}overlap(a){return this._minX<a._maxX&&this._maxX>a._minX&&this._minY<a._maxY&&this._maxY>a._minY&&this._minZ<a._maxZ?this._maxZ>a._minZ:!1}getIntersection(a){var t=new x.collision.geometry.Aabb;return t._minX=this._minX>a._minX?this._minX:a._minX,t._minY=this._minY>a._minY?this._minY:a._minY,t._minZ=this._minZ>a._minZ?this._minZ:a._minZ,t._maxX=this._maxX<a._maxX?this._maxX:a._maxX,t._maxY=this._maxY<a._maxY?this._maxY:a._maxY,t._maxZ=this._maxZ<a._maxZ?this._maxZ:a._maxZ,t}getIntersectionTo(a,t){t._minX=this._minX>a._minX?this._minX:a._minX,t._minY=this._minY>a._minY?this._minY:a._minY,t._minZ=this._minZ>a._minZ?this._minZ:a._minZ,t._maxX=this._maxX<a._maxX?this._maxX:a._maxX,t._maxY=this._maxY<a._maxY?this._maxY:a._maxY,t._maxZ=this._maxZ<a._maxZ?this._maxZ:a._maxZ}copyFrom(a){return this._minX=a._minX,this._minY=a._minY,this._minZ=a._minZ,this._maxX=a._maxX,this._maxY=a._maxY,this._maxZ=a._maxZ,this}clone(){var a=new x.collision.geometry.Aabb;return a._minX=this._minX,a._minY=this._minY,a._minZ=this._minZ,a._maxX=this._maxX,a._maxY=this._maxY,a._maxZ=this._maxZ,a}};x.collision.geometry.BoxGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(a){super(1);var t=a;this._halfExtentsX=t.x,this._halfExtentsY=t.y,this._halfExtentsZ=t.z,this._halfAxisXX=a.x,this._halfAxisXY=0,this._halfAxisXZ=0,this._halfAxisYX=0,this._halfAxisYY=a.y,this._halfAxisYZ=0,this._halfAxisZX=0,this._halfAxisZY=0,this._halfAxisZZ=a.z,this._updateMass();var r=a.x<a.y?a.z<a.x?a.z:a.x:a.z<a.y?a.z:a.y;this._gjkMargin>r*.2&&(this._gjkMargin=r*.2)}getHalfExtents(){var a=new x.common.Vec3,t=a;return t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ,a}getHalfExtentsTo(a){var t=a;t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ}_updateMass(){this._volume=8*(this._halfExtentsX*this._halfExtentsY*this._halfExtentsZ);var a,t,r;a=this._halfExtentsX*this._halfExtentsX,t=this._halfExtentsY*this._halfExtentsY,r=this._halfExtentsZ*this._halfExtentsZ,this._inertiaCoeff00=.3333333333333333*(t+r),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(r+a),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(a+t)}_computeAabb(a,t){var r,i,o,s,_,h,v,e,l,u,b,f;u=t._rotation00*this._halfAxisXX+t._rotation01*this._halfAxisXY+t._rotation02*this._halfAxisXZ,b=t._rotation10*this._halfAxisXX+t._rotation11*this._halfAxisXY+t._rotation12*this._halfAxisXZ,f=t._rotation20*this._halfAxisXX+t._rotation21*this._halfAxisXY+t._rotation22*this._halfAxisXZ,r=u,i=b,o=f;var n,c,M;n=t._rotation00*this._halfAxisYX+t._rotation01*this._halfAxisYY+t._rotation02*this._halfAxisYZ,c=t._rotation10*this._halfAxisYX+t._rotation11*this._halfAxisYY+t._rotation12*this._halfAxisYZ,M=t._rotation20*this._halfAxisYX+t._rotation21*this._halfAxisYY+t._rotation22*this._halfAxisYZ,s=n,_=c,h=M;var m,y,V;m=t._rotation00*this._halfAxisZX+t._rotation01*this._halfAxisZY+t._rotation02*this._halfAxisZZ,y=t._rotation10*this._halfAxisZX+t._rotation11*this._halfAxisZY+t._rotation12*this._halfAxisZZ,V=t._rotation20*this._halfAxisZX+t._rotation21*this._halfAxisZY+t._rotation22*this._halfAxisZZ,v=m,e=y,l=V,r=r<0?-r:r,i=i<0?-i:i,o=o<0?-o:o,s=s<0?-s:s,_=_<0?-_:_,h=h<0?-h:h,v=v<0?-v:v,e=e<0?-e:e,l=l<0?-l:l;var z,I,w;z=r+s,I=i+_,w=o+h,z+=v,I+=e,w+=l,a._minX=t._positionX-z,a._minY=t._positionY-I,a._minZ=t._positionZ-w,a._maxX=t._positionX+z,a._maxY=t._positionY+I,a._maxZ=t._positionZ+w}computeLocalSupportingVertex(a,t){var r,i,o,s,_,h;r=this._gjkMargin,i=this._gjkMargin,o=this._gjkMargin,r=r<this._halfExtentsX?r:this._halfExtentsX,i=i<this._halfExtentsY?i:this._halfExtentsY,o=o<this._halfExtentsZ?o:this._halfExtentsZ,s=this._halfExtentsX-r,_=this._halfExtentsY-i,h=this._halfExtentsZ-o,t.x=a.x>0?s:-s,t.y=a.y>0?_:-_,t.z=a.z>0?h:-h}_rayCastLocal(a,t,r,i,o,s,_){var h=a,v=t,e=r,l=i,u=o,b=s,f=this._halfExtentsX,n=this._halfExtentsY,c=this._halfExtentsZ,M=l-h,m=u-v,y=b-e,V=0,z=0,I=0,w=1,X=1,L=1;if(M>-1e-6&&M<1e-6){if(h<=-f||h>=f)return!1}else{var p=1/M,g=(-f-h)*p,F=(f-h)*p;if(g>F){var S=g;g=F,F=S}g>0&&(V=g),F<1&&(w=F)}if(m>-1e-6&&m<1e-6){if(v<=-n||v>=n)return!1}else{var N=1/m,A=(-n-v)*N,Y=(n-v)*N;if(A>Y){var R=A;A=Y,Y=R}A>0&&(z=A),Y<1&&(X=Y)}if(y>-1e-6&&y<1e-6){if(e<=-c||e>=c)return!1}else{var C=1/y,d=(-c-e)*C,Z=(c-e)*C;if(d>Z){var j=d;d=Z,Z=j}d>0&&(I=d),Z<1&&(L=Z)}if(V>=1||z>=1||I>=1||w<=0||X<=0||L<=0)return!1;var H=V,E=w,G=0;if(z>H&&(H=z,G=1),I>H&&(H=I,G=2),X<E&&(E=X),L<E&&(E=L),H>E||H==0)return!1;switch(G){case 0:_.normal.init(M>0?-1:1,0,0);break;case 1:_.normal.init(0,m>0?-1:1,0);break;case 2:_.normal.init(0,0,y>0?-1:1);break}return _.position.init(h+H*M,v+H*m,e+H*y),_.fraction=H,!0}};x.collision.geometry.CapsuleGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(a,t){super(4),this._radius=a,this._halfHeight=t,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){var a=this._radius*this._radius,t=this._halfHeight*this._halfHeight,r=6.28318530717958*a*this._halfHeight,i=3.14159265358979*a*this._radius*4/3;this._volume=r+i;var o=this._volume==0?0:1/this._volume,s=o*(r*a*.5+i*a*.4),_=o*(r*(a*.25+t/3)+i*(a*.4+this._halfHeight*this._radius*.75+t));this._inertiaCoeff00=_,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=s,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=_}_computeAabb(a,t){var r,i,o;r=this._radius,i=this._radius,o=this._radius;var s,_,h;s=t._rotation01,_=t._rotation11,h=t._rotation21,s=s<0?-s:s,_=_<0?-_:_,h=h<0?-h:h,s*=this._halfHeight,_*=this._halfHeight,h*=this._halfHeight,r+=s,i+=_,o+=h,a._minX=t._positionX-r,a._minY=t._positionY-i,a._minZ=t._positionZ-o,a._maxX=t._positionX+r,a._maxY=t._positionY+i,a._maxZ=t._positionZ+o}computeLocalSupportingVertex(a,t){a.y>0?t.init(0,this._halfHeight,0):t.init(0,-this._halfHeight,0)}_rayCastLocal(a,t,r,i,o,s,_){var h=a,v=t,e=r,l=i,u=o,b=s,f=this._halfHeight,n=l-h,c=u-v,M=b-e,m=0,y=1,V=n*n+M*M,z=h*n+e*M,I=h*h+e*e-this._radius*this._radius,w=z*z-V*I;if(w<0)return!1;if(V>0){var X=Math.sqrt(w);if(m=(-z-X)/V,y=(-z+X)/V,m>=1||y<=0)return!1}else{if(I>=0)return!1;m=0,y=1}var L=v+c*m,p;if(L>-f&&L<f){if(m>0){p=m;var g=_.normal.init(h+n*p,0,e+M*p),F=Math.sqrt(g.x*g.x+g.y*g.y+g.z*g.z);F>0&&(F=1/F);var S=g.x*F,N=g.y*F,A=g.z*F;return g.x=S,g.y=N,g.z=A,_.position.init(h+p*n,L,e+p*M),_.fraction=p,!0}return!1}var Y=L<0?-f:f,R,C,d,Z,j,H;R=0,C=Y,d=0,Z=a-R,j=t-C,H=r-d;var E,G,B;if(E=i-a,G=o-t,B=s-r,V=E*E+G*G+B*B,z=Z*E+j*G+H*B,I=Z*Z+j*j+H*H-this._radius*this._radius,w=z*z-V*I,w<0)return!1;var Q=(-z-Math.sqrt(w))/V;if(Q<0||Q>1)return!1;var W,J,D,O,K,ra;W=Z+E*Q,J=j+G*Q,D=H+B*Q;var sa=W*W+J*J+D*D;sa>0&&(sa=1/Math.sqrt(sa)),O=W*sa,K=J*sa,ra=D*sa,W+=R,J+=C,D+=d;var $=_.position;$.x=W,$.y=J,$.z=D;var q=_.normal;return q.x=O,q.y=K,q.z=ra,_.fraction=Q,!0}};x.collision.geometry.ConeGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(a,t){super(3),this._radius=a,this._halfHeight=t,this.sinTheta=a/Math.sqrt(a*a+4*t*t),this.cosTheta=2*t/Math.sqrt(a*a+4*t*t),this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){var a=this._radius*this._radius,t=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*a*this._halfHeight*2/3,this._inertiaCoeff00=.05*(3*a+2*t),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3*a,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.05*(3*a+2*t)}_computeAabb(a,t){var r,i,o,s,_,h,v,e,l,u,b,f;r=t._rotation01,i=t._rotation11,o=t._rotation21,s=r*r,_=i*i,h=o*o;var n=s,c=_,M=h;u=Math.sqrt(1-n),b=Math.sqrt(1-c),f=Math.sqrt(1-M),u*=this._radius,b*=this._radius,f*=this._radius,v=r*this._halfHeight,e=i*this._halfHeight,l=o*this._halfHeight;var m,y,V,z,I,w;m=-v,y=-e,V=-l,m-=u,y-=b,V-=f,z=-v,I=-e,w=-l,z+=u,I+=b,w+=f;var X,L,p,g,F,S;X=m>z?m:z,L=y>I?y:I,p=V>w?V:w,X=X>v?X:v,L=L>e?L:e,p=p>l?p:l,g=m<z?m:z,F=y<I?y:I,S=V<w?V:w,g=g<v?g:v,F=F<e?F:e,S=S<l?S:l,a._minX=t._positionX+g,a._minY=t._positionY+F,a._minZ=t._positionZ+S,a._maxX=t._positionX+X,a._maxY=t._positionY+L,a._maxZ=t._positionZ+p}computeLocalSupportingVertex(a,t){var r=a.x,i=a.y,o=a.z;if(i>0&&i*i>this.sinTheta*this.sinTheta*(r*r+i*i+o*o)){t.init(0,this._halfHeight-this._gjkMargin/this.sinTheta,0),t.y<0&&(t.y=0);return}var s=a.x,_=a.z,h=s*s+_*_,v=2*this._halfHeight,e=(v-this._gjkMargin)/v*this._radius-this._gjkMargin/this.cosTheta;e<0&&(e=0);var l=h>0?e/Math.sqrt(h):0,u=this._halfHeight-this._gjkMargin;u<0&&(u=0),t.x=s*l,t.y=-u,t.z=_*l}_rayCastLocal(a,t,r,i,o,s,_){var h=a,v=t,e=r,l=i,u=o,b=s,f=this._halfHeight,n=l-h,c=u-v,M=b-e,m=0,y=1;if(c>-1e-6&&c<1e-6){if(v<=-f||v>=f)return!1}else{var V=1/c,z=(-f-v)*V,I=(f-v)*V;if(z>I){var w=z;z=I,I=w}z>0&&(m=z),I<1&&(y=I)}if(m>=1||y<=0)return!1;var X=0,L=0;v-=f;var p=this.cosTheta*this.cosTheta,g=p*(n*n+c*c+M*M)-c*c,F=p*(h*n+v*c+e*M)-v*c,S=p*(h*h+v*v+e*e)-v*v,N=F*F-g*S;if(g!=0){if(N<0)return!1;var A=Math.sqrt(N);if(g<0){if(c>0){if(X=0,L=(-F+A)/g,L<=0)return!1}else if(X=(-F-A)/g,L=1,X>=1)return!1}else if(X=(-F-A)/g,L=(-F+A)/g,X>=1||L<=0)return!1}else{var Y=-S/(2*F);if(F>0){if(X=0,L=Y,Y<=0)return!1}else if(X=Y,L=1,Y>=1)return!1}v+=f;var R;if(L<=m||y<=X)return!1;if(X<m){if(R=m,R==0)return!1;_.normal.init(0,c>0?-1:1,0)}else{if(R=X,R==0)return!1;var C=_.normal.init(h+n*R,0,e+M*R),d=Math.sqrt(C.x*C.x+C.y*C.y+C.z*C.z);d>0&&(d=1/d);var Z=C.x*d,j=C.y*d,H=C.z*d;C.x=Z,C.y=j,C.z=H;var E=C,G=this.cosTheta,B=E.x*G,Q=E.y*G,W=E.z*G;E.x=B,E.y=Q,E.z=W,_.normal.y+=this.sinTheta}return _.position.init(h+R*n,v+R*c,e+R*M),_.fraction=R,!0}};x.collision.geometry.ConvexHullGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(a){super(5),this._numVertices=a.length;var t=new Array(this._numVertices);this._vertices=t;var r=new Array(this._numVertices);this._tmpVertices=r;for(var i=0,o=this._numVertices;i<o;){var s=i++;this._vertices[s]=a[s],this._tmpVertices[s]=new x.common.Vec3}this._useGjkRayCast=!0,this._updateMass()}getVertices(){return this._vertices}_updateMass(){this._volume=1,this._inertiaCoeff00=1,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=1,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=1;for(var a=this._vertices[0].x,t=this._vertices[0].y,r=this._vertices[0].z,i=this._vertices[0].x,o=this._vertices[0].y,s=this._vertices[0].z,_=1,h=this._numVertices;_<h;){var v=_++,e=this._vertices[v].x,l=this._vertices[v].y,u=this._vertices[v].z;e<a?a=e:e>i&&(i=e),l<t?t=l:l>o&&(o=l),u<r?r=u:u>s&&(s=u)}var b=i-a,f=o-t,n=s-r;this._volume=b*f*n;var c=((a+i)*(a+i)+(t+o)*(t+o)+(r+s)*(r+s))*.25;b=b*b*.25,f=f*f*.25,n=n*n*.25,this._inertiaCoeff00=.3333333333333333*(f+n)+c,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(n+b)+c,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(b+f)+c}_computeAabb(a,t){var r,i,o,s,_,h,v,e,l;v=this._gjkMargin,e=this._gjkMargin,l=this._gjkMargin;var u,b,f,n=this._vertices[0];u=n.x,b=n.y,f=n.z;var c,M,m,y,V,z;y=t._rotation00*u+t._rotation01*b+t._rotation02*f,V=t._rotation10*u+t._rotation11*b+t._rotation12*f,z=t._rotation20*u+t._rotation21*b+t._rotation22*f,c=y,M=V,m=z,c+=t._positionX,M+=t._positionY,m+=t._positionZ,r=c,i=M,o=m,s=c,_=M,h=m;for(var I=1,w=this._numVertices;I<w;){var X=I++,L=this._vertices[X];u=L.x,b=L.y,f=L.z;var p,g,F;p=t._rotation00*u+t._rotation01*b+t._rotation02*f,g=t._rotation10*u+t._rotation11*b+t._rotation12*f,F=t._rotation20*u+t._rotation21*b+t._rotation22*f,c=p,M=g,m=F,c+=t._positionX,M+=t._positionY,m+=t._positionZ,r=r<c?r:c,i=i<M?i:M,o=o<m?o:m,s=s>c?s:c,_=_>M?_:M,h=h>m?h:m}a._minX=r-v,a._minY=i-e,a._minZ=o-l,a._maxX=s+v,a._maxY=_+e,a._maxZ=h+l}computeLocalSupportingVertex(a,t){for(var r=this._vertices[0],i=r.x*a.x+r.y*a.y+r.z*a.z,o=0,s=1,_=this._numVertices;s<_;){var h=s++,v=this._vertices[h],e=v.x*a.x+v.y*a.y+v.z*a.z;e>i&&(i=e,o=h)}var l=this._vertices[o];t.x=l.x,t.y=l.y,t.z=l.z}};x.collision.geometry.CylinderGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(a,t){super(2),this._radius=a,this._halfHeight=t,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){var a=this._radius*this._radius,t=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*a*this._halfHeight*2,this._inertiaCoeff00=.08333333333333333*(3*a+t),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.5*a,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.08333333333333333*(3*a+t)}_computeAabb(a,t){var r,i,o,s,_,h,v,e,l,u,b,f;r=t._rotation01,i=t._rotation11,o=t._rotation21,r=r<0?-r:r,i=i<0?-i:i,o=o<0?-o:o,s=r*r,_=i*i,h=o*o;var n=s,c=_,M=h;u=Math.sqrt(1-n),b=Math.sqrt(1-c),f=Math.sqrt(1-M),u*=this._radius,b*=this._radius,f*=this._radius,v=r*this._halfHeight,e=i*this._halfHeight,l=o*this._halfHeight;var m,y,V;m=u+v,y=b+e,V=f+l,a._minX=t._positionX-m,a._minY=t._positionY-y,a._minZ=t._positionZ-V,a._maxX=t._positionX+m,a._maxY=t._positionY+y,a._maxZ=t._positionZ+V}computeLocalSupportingVertex(a,t){var r=a.x,i=a.z,o=r*r+i*i,s=this._radius-this._gjkMargin;s<0&&(s=0);var _=o>0?s/Math.sqrt(o):0,h=this._halfHeight-this._gjkMargin;h<0&&(h=0),t.x=r*_,t.y=a.y>0?h:-h,t.z=i*_}_rayCastLocal(a,t,r,i,o,s,_){var h=a,v=t,e=r,l=i,u=o,b=s,f=this._halfHeight,n=l-h,c=u-v,M=b-e,m=0,y=1;if(c>-1e-6&&c<1e-6){if(v<=-f||v>=f)return!1}else{var V=1/c,z=(-f-v)*V,I=(f-v)*V;if(z>I){var w=z;z=I,I=w}z>0&&(m=z),I<1&&(y=I)}if(m>=1||y<=0)return!1;var X=0,L=1,p=n*n+M*M,g=h*n+e*M,F=h*h+e*e-this._radius*this._radius,S=g*g-p*F;if(S<0)return!1;if(p>0){var N=Math.sqrt(S);if(X=(-g-N)/p,L=(-g+N)/p,X>=1||L<=0)return!1}else{if(F>=0)return!1;X=0,L=1}var A;if(L<=m||y<=X)return!1;if(X<m){if(A=m,A==0)return!1;_.normal.init(0,c>0?-1:1,0)}else{if(A=X,A==0)return!1;var Y=_.normal.init(h+n*A,0,e+M*A),R=Math.sqrt(Y.x*Y.x+Y.y*Y.y+Y.z*Y.z);R>0&&(R=1/R);var C=Y.x*R,d=Y.y*R,Z=Y.z*R;Y.x=C,Y.y=d,Y.z=Z}return _.position.init(h+A*n,v+A*c,e+A*M),_.fraction=A,!0}};x.collision.geometry.GeometryType=class{};x.collision.geometry.RayCastHit=class{constructor(){this.position=new x.common.Vec3,this.normal=new x.common.Vec3,this.fraction=0}};x.collision.geometry.SphereGeometry=class extends x.collision.geometry.ConvexGeometry{constructor(a){super(0),this._radius=a,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}_updateMass(){this._volume=4.188790204786386*this._radius*this._radius*this._radius,this._inertiaCoeff00=.4*this._radius*this._radius,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.4*this._radius*this._radius,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.4*this._radius*this._radius}_computeAabb(a,t){var r,i,o;r=this._radius,i=this._radius,o=this._radius,a._minX=t._positionX-r,a._minY=t._positionY-i,a._minZ=t._positionZ-o,a._maxX=t._positionX+r,a._maxY=t._positionY+i,a._maxZ=t._positionZ+o}computeLocalSupportingVertex(a,t){t.zero()}_rayCastLocal(a,t,r,i,o,s,_){var h,v,e;h=i-a,v=o-t,e=s-r;var l=h*h+v*v+e*e,u=a*h+t*v+r*e,b=a*a+t*t+r*r-this._radius*this._radius,f=u*u-l*b;if(f<0)return!1;var n=(-u-Math.sqrt(f))/l;if(n<0||n>1)return!1;var c,M,m,y,V,z;c=a+h*n,M=t+v*n,m=r+e*n;var I=c*c+M*M+m*m;I>0&&(I=1/Math.sqrt(I)),y=c*I,V=M*I,z=m*I;var w=_.position;w.x=c,w.y=M,w.z=m;var X=_.normal;return X.x=y,X.y=V,X.z=z,_.fraction=n,!0}};x.collision.narrowphase||(x.collision.narrowphase={});x.collision.narrowphase.CollisionMatrix=class{constructor(){var a=new Array(8);this.detectors=a;var t=this.detectors,r=new Array(8);t[0]=r;var i=this.detectors,o=new Array(8);i[1]=o;var s=this.detectors,_=new Array(8);s[2]=_;var h=this.detectors,v=new Array(8);h[3]=v;var e=this.detectors,l=new Array(8);e[4]=l;var u=this.detectors,b=new Array(8);u[5]=b;var f=new x.collision.narrowphase.detector.GjkEpaDetector,n=0,c=1,M=2,m=3,y=4,V=5;this.detectors[n][n]=new x.collision.narrowphase.detector.SphereSphereDetector,this.detectors[n][c]=new x.collision.narrowphase.detector.SphereBoxDetector(!1),this.detectors[n][M]=f,this.detectors[n][m]=f,this.detectors[n][y]=new x.collision.narrowphase.detector.SphereCapsuleDetector(!1),this.detectors[n][V]=f,this.detectors[c][n]=new x.collision.narrowphase.detector.SphereBoxDetector(!0),this.detectors[c][c]=new x.collision.narrowphase.detector.BoxBoxDetector,this.detectors[c][M]=f,this.detectors[c][m]=f,this.detectors[c][y]=f,this.detectors[c][V]=f,this.detectors[M][n]=f,this.detectors[M][c]=f,this.detectors[M][M]=f,this.detectors[M][m]=f,this.detectors[M][y]=f,this.detectors[M][V]=f,this.detectors[m][n]=f,this.detectors[m][c]=f,this.detectors[m][M]=f,this.detectors[m][m]=f,this.detectors[m][y]=f,this.detectors[m][V]=f,this.detectors[y][n]=new x.collision.narrowphase.detector.SphereCapsuleDetector(!0),this.detectors[y][c]=f,this.detectors[y][M]=f,this.detectors[y][m]=f,this.detectors[y][y]=new x.collision.narrowphase.detector.CapsuleCapsuleDetector,this.detectors[y][V]=f,this.detectors[V][n]=f,this.detectors[V][c]=f,this.detectors[V][M]=f,this.detectors[V][m]=f,this.detectors[V][y]=f,this.detectors[V][V]=f}getDetector(a,t){return this.detectors[a][t]}};x.collision.narrowphase.DetectorResult=class{constructor(){this.numPoints=0,this.normal=new x.common.Vec3;var a=new Array(x.common.Setting.maxManifoldPoints);this.points=a,this.incremental=!1;for(var t=0,r=x.common.Setting.maxManifoldPoints;t<r;){var i=t++;this.points[i]=new x.collision.narrowphase.DetectorResultPoint}}getMaxDepth(){for(var a=0,t=0,r=this.numPoints;t<r;){var i=t++;this.points[i].depth>a&&(a=this.points[i].depth)}return a}clear(){this.numPoints=0;for(var a=0,t=this.points;a<t.length;){var r=t[a];++a,r.position1.zero(),r.position2.zero(),r.depth=0,r.id=0}this.normal.zero()}};x.collision.narrowphase.DetectorResultPoint=class{constructor(){this.position1=new x.common.Vec3,this.position2=new x.common.Vec3,this.depth=0,this.id=0}};x.collision.narrowphase.detector||(x.collision.narrowphase.detector={});x.collision.narrowphase.detector.Detector=class{constructor(a){this.swapped=a}setNormal(a,t,r,i){var o=a.normal;if(o.x=t,o.y=r,o.z=i,this.swapped){var s=a.normal,_=-s.x,h=-s.y,v=-s.z;s.x=_,s.y=h,s.z=v}}addPoint(a,t,r,i,o,s,_,h,v){var e=a.points[a.numPoints++];if(e.depth=h,e.id=v,this.swapped){var l=e.position1;l.x=o,l.y=s,l.z=_;var u=e.position2;u.x=t,u.y=r,u.z=i}else{var b=e.position1;b.x=t,b.y=r,b.z=i;var f=e.position2;f.x=o,f.y=s,f.z=_}}detectImpl(a,t,r,i,o,s){}detect(a,t,r,i,o,s){a.numPoints=0;for(var _=0,h=a.points;_<h.length;){var v=h[_];++_,v.position1.zero(),v.position2.zero(),v.depth=0,v.id=0}a.normal.zero(),this.swapped?this.detectImpl(a,r,t,o,i,s):this.detectImpl(a,t,r,i,o,s)}};x.collision.narrowphase.detector.BoxBoxDetector=class extends x.collision.narrowphase.detector.Detector{constructor(){super(!1),this.clipper=new x.collision.narrowphase.detector._BoxBoxDetector.FaceClipper}detectImpl(a,t,r,i,o,s){var _=t,h=r;a.incremental=!1;var v,e,l,u,b,f,n,c,M;v=i._positionX,e=i._positionY,l=i._positionZ,u=o._positionX,b=o._positionY,f=o._positionZ,n=u-v,c=b-e,M=f-l;var m,y,V,z,I,w,X,L,p,g,F,S,N,A,Y,R,C,d;m=i._rotation00,y=i._rotation10,V=i._rotation20,z=i._rotation01,I=i._rotation11,w=i._rotation21,X=i._rotation02,L=i._rotation12,p=i._rotation22,g=o._rotation00,F=o._rotation10,S=o._rotation20,N=o._rotation01,A=o._rotation11,Y=o._rotation21,R=o._rotation02,C=o._rotation12,d=o._rotation22;var Z=_._halfExtentsX,j=_._halfExtentsY,H=_._halfExtentsZ,E=h._halfExtentsX,G=h._halfExtentsY,B=h._halfExtentsZ,Q,W,J,D,O,K,ra,sa,$,q,na,oa,aa,T,ca,_a,k,ta;Q=m*Z,W=y*Z,J=V*Z,D=z*j,O=I*j,K=w*j,ra=X*H,sa=L*H,$=p*H,q=g*E,na=F*E,oa=S*E,aa=N*G,T=A*G,ca=Y*G,_a=R*B,k=C*B,ta=d*B;var ia=1/0,la=-1,va=0,xa,Ma,za;xa=0,Ma=0,za=0;var Xa=Z,Za=m*q+y*na+V*oa,fa=m*aa+y*T+V*ca,ba=m*_a+y*k+V*ta;Za<0&&(Za=-Za),fa<0&&(fa=-fa),ba<0&&(ba=-ba);var ea=Za+fa+ba,ha=m*n+y*c+V*M,pa=Xa+ea,ya=ha<0,da=ya?-ha:ha;if(da<pa){var ma=pa-da;ma<ia&&(ia=ma,la=0,xa=m,Ma=y,za=V,va=ya?-1:1)}else return;Xa=j;var Ya=z*q+I*na+w*oa,Qa=z*aa+I*T+w*ca,ga=z*_a+I*k+w*ta;Ya<0&&(Ya=-Ya),Qa<0&&(Qa=-Qa),ga<0&&(ga=-ga),ea=Ya+Qa+ga,ha=z*n+I*c+w*M;var ua=Xa+ea,ka=ha<0,wa=ka?-ha:ha;if(wa<ua){var Pa=ua-wa;Pa<ia&&(ia=Pa,la=1,xa=z,Ma=I,za=w,va=ka?-1:1)}else return;Xa=H;var Mt=X*q+L*na+p*oa,Oa=X*aa+L*T+p*ca,Ba=X*_a+L*k+p*ta;Mt<0&&(Mt=-Mt),Oa<0&&(Oa=-Oa),Ba<0&&(Ba=-Ba),ea=Mt+Oa+Ba,ha=X*n+L*c+p*M;var nt=Xa+ea,Ea=ha<0,Na=Ea?-ha:ha;if(Na<nt){var Sa=nt-Na;Sa<ia&&(ia=Sa,la=2,xa=X,Ma=L,za=p,va=Ea?-1:1)}else return;ia>x.common.Setting.linearSlop?ia-=x.common.Setting.linearSlop:ia=0;var ft=g*Q+F*W+S*J,Wa=g*D+F*O+S*K,Ha=g*ra+F*sa+S*$;ft<0&&(ft=-ft),Wa<0&&(Wa=-Wa),Ha<0&&(Ha=-Ha),Xa=ft+Wa+Ha,ea=E,ha=g*n+F*c+S*M;var bt=Xa+ea,rt=ha<0,ja=rt?-ha:ha;if(ja<bt){var _t=bt-ja;_t<ia&&(ia=_t,la=3,xa=g,Ma=F,za=S,va=rt?-1:1)}else return;var gt=N*Q+A*W+Y*J,mt=N*D+A*O+Y*K,Ja=N*ra+A*sa+Y*$;gt<0&&(gt=-gt),mt<0&&(mt=-mt),Ja<0&&(Ja=-Ja),Xa=gt+mt+Ja,ea=G,ha=N*n+A*c+Y*M;var it=Xa+ea,ut=ha<0,Da=ut?-ha:ha;if(Da<it){var Ta=it-Da;Ta<ia&&(ia=Ta,la=4,xa=N,Ma=A,za=Y,va=ut?-1:1)}else return;var Fa=R*Q+C*W+d*J,Vt=R*D+C*O+d*K,Pt=R*ra+C*sa+d*$;Fa<0&&(Fa=-Fa),Vt<0&&(Vt=-Vt),Pt<0&&(Pt=-Pt),Xa=Fa+Vt+Pt,ea=B,ha=R*n+C*c+d*M;var et=Xa+ea,Xt=ha<0,Yt=Xt?-ha:ha;if(Yt<et){var zt=et-Yt;zt<ia&&(ia=zt,la=5,xa=R,Ma=C,za=d,va=Xt?-1:1)}else return;ia>x.common.Setting.linearSlop?ia-=x.common.Setting.linearSlop:ia=0;var Ia,U,Va;if(Ia=y*S-V*F,U=V*g-m*S,Va=m*F-y*g,!(Ia==0&&U==0&&Va==0)){var lt=Ia*Ia+U*U+Va*Va;lt>0&&(lt=1/Math.sqrt(lt)),Ia*=lt,U*=lt,Va*=lt;var P=Ia*D+U*O+Va*K,kt=Ia*ra+U*sa+Va*$;P<0&&(P=-P),kt<0&&(kt=-kt),Xa=P+kt;var Bt=Ia*aa+U*T+Va*ca,St=Ia*_a+U*k+Va*ta;Bt<0&&(Bt=-Bt),St<0&&(St=-St),ea=Bt+St,ha=Ia*n+U*c+Va*M;var yt=Xa+ea,wt=ha<0,pt=wt?-ha:ha;if(pt<yt){var ht=yt-pt;ht<ia&&(ia=ht,la=6,xa=Ia,Ma=U,za=Va,va=wt?-1:1)}else return}if(Ia=y*Y-V*A,U=V*N-m*Y,Va=m*A-y*N,!(Ia==0&&U==0&&Va==0)){var xt=Ia*Ia+U*U+Va*Va;xt>0&&(xt=1/Math.sqrt(xt)),Ia*=xt,U*=xt,Va*=xt;var Ra=Ia*D+U*O+Va*K,st=Ia*ra+U*sa+Va*$;Ra<0&&(Ra=-Ra),st<0&&(st=-st),Xa=Ra+st;var Ca=Ia*q+U*na+Va*oa,vt=Ia*_a+U*k+Va*ta;Ca<0&&(Ca=-Ca),vt<0&&(vt=-vt),ea=Ca+vt,ha=Ia*n+U*c+Va*M;var qa=Xa+ea,at=ha<0,Ua=at?-ha:ha;if(Ua<qa){var tt=qa-Ua;tt<ia&&(ia=tt,la=7,xa=Ia,Ma=U,za=Va,va=at?-1:1)}else return}if(Ia=y*d-V*C,U=V*R-m*d,Va=m*C-y*R,!(Ia==0&&U==0&&Va==0)){var ct=Ia*Ia+U*U+Va*Va;ct>0&&(ct=1/Math.sqrt(ct)),Ia*=ct,U*=ct,Va*=ct;var Aa=Ia*D+U*O+Va*K,Ga=Ia*ra+U*sa+Va*$;Aa<0&&(Aa=-Aa),Ga<0&&(Ga=-Ga),Xa=Aa+Ga;var Ka=Ia*q+U*na+Va*oa,La=Ia*aa+U*T+Va*ca;Ka<0&&(Ka=-Ka),La<0&&(La=-La),ea=Ka+La,ha=Ia*n+U*c+Va*M;var ot=Xa+ea,It=ha<0,or=It?-ha:ha;if(or<ot){var gr=ot-or;gr<ia&&(ia=gr,la=8,xa=Ia,Ma=U,za=Va,va=It?-1:1)}else return}if(Ia=I*S-w*F,U=w*g-z*S,Va=z*F-I*g,!(Ia==0&&U==0&&Va==0)){var ar=Ia*Ia+U*U+Va*Va;ar>0&&(ar=1/Math.sqrt(ar)),Ia*=ar,U*=ar,Va*=ar;var Ct=Ia*Q+U*W+Va*J,_r=Ia*ra+U*sa+Va*$;Ct<0&&(Ct=-Ct),_r<0&&(_r=-_r),Xa=Ct+_r;var Et=Ia*aa+U*T+Va*ca,At=Ia*_a+U*k+Va*ta;Et<0&&(Et=-Et),At<0&&(At=-At),ea=Et+At,ha=Ia*n+U*c+Va*M;var Gt=Xa+ea,Hr=ha<0,vr=Hr?-ha:ha;if(vr<Gt){var lr=Gt-vr;lr<ia&&(ia=lr,la=9,xa=Ia,Ma=U,za=Va,va=Hr?-1:1)}else return}if(Ia=I*Y-w*A,U=w*N-z*Y,Va=z*A-I*N,!(Ia==0&&U==0&&Va==0)){var tr=Ia*Ia+U*U+Va*Va;tr>0&&(tr=1/Math.sqrt(tr)),Ia*=tr,U*=tr,Va*=tr;var Ur=Ia*Q+U*W+Va*J,Xr=Ia*ra+U*sa+Va*$;Ur<0&&(Ur=-Ur),Xr<0&&(Xr=-Xr),Xa=Ur+Xr;var Mr=Ia*q+U*na+Va*oa,Zt=Ia*_a+U*k+Va*ta;Mr<0&&(Mr=-Mr),Zt<0&&(Zt=-Zt),ea=Mr+Zt,ha=Ia*n+U*c+Va*M;var ir=Xa+ea,$t=ha<0,nr=$t?-ha:ha;if(nr<ir){var jr=ir-nr;jr<ia&&(ia=jr,la=10,xa=Ia,Ma=U,za=Va,va=$t?-1:1)}else return}if(Ia=I*d-w*C,U=w*R-z*d,Va=z*C-I*R,!(Ia==0&&U==0&&Va==0)){var Wt=Ia*Ia+U*U+Va*Va;Wt>0&&(Wt=1/Math.sqrt(Wt)),Ia*=Wt,U*=Wt,Va*=Wt;var Kr=Ia*Q+U*W+Va*J,Ir=Ia*ra+U*sa+Va*$;Kr<0&&(Kr=-Kr),Ir<0&&(Ir=-Ir),Xa=Kr+Ir;var mi=Ia*q+U*na+Va*oa,$r=Ia*aa+U*T+Va*ca;mi<0&&(mi=-mi),$r<0&&($r=-$r),ea=mi+$r,ha=Ia*n+U*c+Va*M;var Lt=Xa+ea,Kt=ha<0,Tt=Kt?-ha:ha;if(Tt<Lt){var br=Lt-Tt;br<ia&&(ia=br,la=11,xa=Ia,Ma=U,za=Va,va=Kt?-1:1)}else return}if(Ia=L*S-p*F,U=p*g-X*S,Va=X*F-L*g,!(Ia==0&&U==0&&Va==0)){var zr=Ia*Ia+U*U+Va*Va;zr>0&&(zr=1/Math.sqrt(zr)),Ia*=zr,U*=zr,Va*=zr;var vi=Ia*Q+U*W+Va*J,qt=Ia*D+U*O+Va*K;vi<0&&(vi=-vi),qt<0&&(qt=-qt),Xa=vi+qt;var fr=Ia*aa+U*T+Va*ca,dt=Ia*_a+U*k+Va*ta;fr<0&&(fr=-fr),dt<0&&(dt=-dt),ea=fr+dt,ha=Ia*n+U*c+Va*M;var ur=Xa+ea,hr=ha<0,ei=hr?-ha:ha;if(ei<ur){var Xi=ur-ei;Xi<ia&&(ia=Xi,la=12,xa=Ia,Ma=U,za=Va,va=hr?-1:1)}else return}if(Ia=L*Y-p*A,U=p*N-X*Y,Va=X*A-L*N,!(Ia==0&&U==0&&Va==0)){var oo=Ia*Ia+U*U+Va*Va;oo>0&&(oo=1/Math.sqrt(oo)),Ia*=oo,U*=oo,Va*=oo;var Jt=Ia*Q+U*W+Va*J,fi=Ia*D+U*O+Va*K;Jt<0&&(Jt=-Jt),fi<0&&(fi=-fi),Xa=Jt+fi;var pi=Ia*q+U*na+Va*oa,Dt=Ia*_a+U*k+Va*ta;pi<0&&(pi=-pi),Dt<0&&(Dt=-Dt),ea=pi+Dt,ha=Ia*n+U*c+Va*M;var Bi=Xa+ea,Ar=ha<0,Ni=Ar?-ha:ha;if(Ni<Bi){var Hn=Bi-Ni;Hn<ia&&(ia=Hn,la=13,xa=Ia,Ma=U,za=Va,va=Ar?-1:1)}else return}if(Ia=L*d-p*C,U=p*R-X*d,Va=X*C-L*R,!(Ia==0&&U==0&&Va==0)){var no=Ia*Ia+U*U+Va*Va;no>0&&(no=1/Math.sqrt(no)),Ia*=no,U*=no,Va*=no;var Si=Ia*Q+U*W+Va*J,eo=Ia*D+U*O+Va*K;Si<0&&(Si=-Si),eo<0&&(eo=-eo),Xa=Si+eo;var gn=Ia*q+U*na+Va*oa,Ao=Ia*aa+U*T+Va*ca;gn<0&&(gn=-gn),Ao<0&&(Ao=-Ao),ea=gn+Ao,ha=Ia*n+U*c+Va*M;var Vo=Xa+ea,xr=ha<0,ao=xr?-ha:ha;if(ao<Vo){var Ai=Vo-ao;Ai<ia&&(ia=Ai,la=14,xa=Ia,Ma=U,za=Va,va=xr?-1:1)}else return}if(la>=6){xa*=va,Ma*=va,za*=va;var yi=(la-6)/3|0,Po=la-6-yi*3,Dr,Pi,gi,Rt,Or,Lr,Tn,ms,qe,ps,Re,as;switch(yi){case 0:Tn=m,ms=y,qe=V;var N_=D*xa+O*Ma+K*za>0,In=ra*xa+sa*Ma+$*za>0;N_?In?(Dr=D+ra,Pi=O+sa,gi=K+$):(Dr=D-ra,Pi=O-sa,gi=K-$):In?(Dr=ra-D,Pi=sa-O,gi=$-K):(Dr=D+ra,Pi=O+sa,gi=K+$,Dr=-Dr,Pi=-Pi,gi=-gi);break;case 1:Tn=z,ms=I,qe=w;var Pr=Q*xa+W*Ma+J*za>0,Go=ra*xa+sa*Ma+$*za>0;Pr?Go?(Dr=Q+ra,Pi=W+sa,gi=J+$):(Dr=Q-ra,Pi=W-sa,gi=J-$):Go?(Dr=ra-Q,Pi=sa-W,gi=$-J):(Dr=Q+ra,Pi=W+sa,gi=J+$,Dr=-Dr,Pi=-Pi,gi=-gi);break;default:Tn=X,ms=L,qe=p;var Wi=Q*xa+W*Ma+J*za>0,ke=D*xa+O*Ma+K*za>0;Wi?ke?(Dr=Q+D,Pi=W+O,gi=J+K):(Dr=Q-D,Pi=W-O,gi=J-K):ke?(Dr=D-Q,Pi=O-W,gi=K-J):(Dr=Q+D,Pi=W+O,gi=J+K,Dr=-Dr,Pi=-Pi,gi=-gi)}switch(Dr=v+Dr,Pi=e+Pi,gi=l+gi,Po){case 0:ps=g,Re=F,as=S;var nn=aa*xa+T*Ma+ca*za>0,Rn=_a*xa+k*Ma+ta*za>0;nn?Rn?(Rt=aa+_a,Or=T+k,Lr=ca+ta):(Rt=aa-_a,Or=T-k,Lr=ca-ta):Rn?(Rt=_a-aa,Or=k-T,Lr=ta-ca):(Rt=aa+_a,Or=T+k,Lr=ca+ta,Rt=-Rt,Or=-Or,Lr=-Lr);break;case 1:ps=N,Re=A,as=Y;var jn=q*xa+na*Ma+oa*za>0,Xe=_a*xa+k*Ma+ta*za>0;jn?Xe?(Rt=q+_a,Or=na+k,Lr=oa+ta):(Rt=q-_a,Or=na-k,Lr=oa-ta):Xe?(Rt=_a-q,Or=k-na,Lr=ta-oa):(Rt=q+_a,Or=na+k,Lr=oa+ta,Rt=-Rt,Or=-Or,Lr=-Lr);break;default:ps=R,Re=C,as=d;var k_=q*xa+na*Ma+oa*za>0,Qe=aa*xa+T*Ma+ca*za>0;k_?Qe?(Rt=q+aa,Or=na+T,Lr=oa+ca):(Rt=q-aa,Or=na-T,Lr=oa-ca):Qe?(Rt=aa-q,Or=T-na,Lr=ca-oa):(Rt=q+aa,Or=na+T,Lr=oa+ca,Rt=-Rt,Or=-Or,Lr=-Lr)}Rt=u-Rt,Or=b-Or,Lr=f-Lr;var Vr,Ii,ui;Vr=Dr-Rt,Ii=Pi-Or,ui=gi-Lr;var so=Tn*ps+ms*Re+qe*as,Qn=Tn*Vr+ms*Ii+qe*ui,ys=ps*Vr+Re*Ii+as*ui,en=1/(1-so*so),En=(so*ys-Qn)*en,cr=(ys-so*Qn)*en,co,Fi,Dn,ts,Ee,De;co=Dr+Tn*En,Fi=Pi+ms*En,Dn=gi+qe*En,ts=Rt+ps*cr,Ee=Or+Re*cr,De=Lr+as*cr;var Ne,ce,rr;Ne=-xa,ce=-Ma,rr=-za,this.setNormal(a,Ne,ce,rr),this.addPoint(a,co,Fi,Dn,ts,Ee,De,ia,4);return}var ri,Qr,Nr,uo;if(la>=3){va=-va,n=-n,c=-c,M=-M;var Co=_;_=h,h=Co;var __=Z;Z=E,E=__;var Fe=j;j=G,G=Fe;var rs=H;H=B,B=rs,ri=v,Qr=e,Nr=l,v=u,e=b,l=f,u=ri,b=Qr,f=Nr,ri=m,Qr=y,Nr=V,m=g,y=F,V=S,g=ri,F=Qr,S=Nr,ri=z,Qr=I,Nr=w,z=N,I=A,w=Y,N=ri,A=Qr,Y=Nr,ri=X,Qr=L,Nr=p,X=R,L=C,p=d,R=ri,C=Qr,d=Nr,ri=Q,Qr=W,Nr=J,Q=q,W=na,J=oa,q=ri,na=Qr,oa=Nr,ri=D,Qr=O,Nr=K,D=aa,O=T,K=ca,aa=ri,T=Qr,ca=Nr,ri=ra,Qr=sa,Nr=$,ra=_a,sa=k,$=ta,_a=ri,k=Qr,ta=Nr,la-=3,uo=!0}else uo=!1;var Nn,bo,Nt,Fr,li,wo,be,Le,Ye,xo,jt,Vi,si,Jo;switch(la){case 0:Nn=Q,bo=W,Nt=J,Fr=m,li=y,wo=V,be=z,Le=I,Ye=w,xo=X,jt=L,Vi=p,si=j,Jo=H;break;case 1:Nn=D,bo=O,Nt=K,Fr=z,li=I,wo=w,be=X,Le=L,Ye=p,xo=m,jt=y,Vi=V,si=H,Jo=Z;break;default:Nn=ra,bo=sa,Nt=$,Fr=X,li=L,wo=p,be=m,Le=y,Ye=V,xo=z,jt=I,Vi=w,si=Z,Jo=j}if(va<0){Nn=-Nn,bo=-bo,Nt=-Nt,Fr=-Fr,li=-li,wo=-wo,ri=be,Qr=Le,Nr=Ye,be=xo,Le=jt,Ye=Vi,xo=ri,jt=Qr,Vi=Nr;var Gs=si;si=Jo,Jo=Gs}Nn+=v,bo+=e,Nt+=l;var To=1,ko=0,Gi=Fr*g+li*F+wo*S;Gi<To&&(To=Gi,ko=0),-Gi<To&&(To=-Gi,ko=1),Gi=Fr*N+li*A+wo*Y,Gi<To&&(To=Gi,ko=2),-Gi<To&&(To=-Gi,ko=3),Gi=Fr*R+li*C+wo*d,Gi<To&&(To=Gi,ko=4),-Gi<To&&(To=-Gi,ko=5);var Ci,Ti,Li,Qt,Gr,Yr,Rr,Mi,qr,Ji,$i,to;switch(ko){case 0:Ci=q+aa,Ti=na+T,Li=oa+ca,Ci+=_a,Ti+=k,Li+=ta,Qt=q-aa,Gr=na-T,Yr=oa-ca,Qt+=_a,Gr+=k,Yr+=ta,Rr=q-aa,Mi=na-T,qr=oa-ca,Rr-=_a,Mi-=k,qr-=ta,Ji=q+aa,$i=na+T,to=oa+ca,Ji-=_a,$i-=k,to-=ta;break;case 1:Ci=aa-q,Ti=T-na,Li=ca-oa,Ci+=_a,Ti+=k,Li+=ta,Qt=aa-q,Gr=T-na,Yr=ca-oa,Qt-=_a,Gr-=k,Yr-=ta,Rr=q+aa,Mi=na+T,qr=oa+ca,Rr=-Rr,Mi=-Mi,qr=-qr,Rr-=_a,Mi-=k,qr-=ta,Ji=q+aa,$i=na+T,to=oa+ca,Ji=-Ji,$i=-$i,to=-to,Ji+=_a,$i+=k,to+=ta;break;case 2:Ci=q+aa,Ti=na+T,Li=oa+ca,Ci+=_a,Ti+=k,Li+=ta,Qt=q+aa,Gr=na+T,Yr=oa+ca,Qt-=_a,Gr-=k,Yr-=ta,Rr=aa-q,Mi=T-na,qr=ca-oa,Rr-=_a,Mi-=k,qr-=ta,Ji=aa-q,$i=T-na,to=ca-oa,Ji+=_a,$i+=k,to+=ta;break;case 3:Ci=q-aa,Ti=na-T,Li=oa-ca,Ci+=_a,Ti+=k,Li+=ta,Qt=q+aa,Gr=na+T,Yr=oa+ca,Qt=-Qt,Gr=-Gr,Yr=-Yr,Qt+=_a,Gr+=k,Yr+=ta,Rr=q+aa,Mi=na+T,qr=oa+ca,Rr=-Rr,Mi=-Mi,qr=-qr,Rr-=_a,Mi-=k,qr-=ta,Ji=q-aa,$i=na-T,to=oa-ca,Ji-=_a,$i-=k,to-=ta;break;case 4:Ci=q+aa,Ti=na+T,Li=oa+ca,Ci+=_a,Ti+=k,Li+=ta,Qt=aa-q,Gr=T-na,Yr=ca-oa,Qt+=_a,Gr+=k,Yr+=ta,Rr=q+aa,Mi=na+T,qr=oa+ca,Rr=-Rr,Mi=-Mi,qr=-qr,Rr+=_a,Mi+=k,qr+=ta,Ji=q-aa,$i=na-T,to=oa-ca,Ji+=_a,$i+=k,to+=ta;break;default:Ci=q+aa,Ti=na+T,Li=oa+ca,Ci-=_a,Ti-=k,Li-=ta,Qt=q-aa,Gr=na-T,Yr=oa-ca,Qt-=_a,Gr-=k,Yr-=ta,Rr=q+aa,Mi=na+T,qr=oa+ca,Rr=-Rr,Mi=-Mi,qr=-qr,Rr-=_a,Mi-=k,qr-=ta,Ji=aa-q,$i=T-na,to=ca-oa,Ji-=_a,$i-=k,to-=ta}Ci+=n,Ti+=c,Li+=M,Qt+=n,Gr+=c,Yr+=M,Rr+=n,Mi+=c,qr+=M,Ji+=n,$i+=c,to+=M;var fe=this.clipper;fe.w=si,fe.h=Jo,fe.numVertices=0,fe.numTmpVertices=0;var wr=this.clipper,sn=wr.vertices[wr.numVertices++];sn.x=Ci*be+Ti*Le+Li*Ye,sn.y=Ci*xo+Ti*jt+Li*Vi,sn.wx=Ci,sn.wy=Ti,sn.wz=Li;var Yi=this.clipper,$o=Yi.vertices[Yi.numVertices++];$o.x=Qt*be+Gr*Le+Yr*Ye,$o.y=Qt*xo+Gr*jt+Yr*Vi,$o.wx=Qt,$o.wy=Gr,$o.wz=Yr;var gs=this.clipper,Vn=gs.vertices[gs.numVertices++];Vn.x=Rr*be+Mi*Le+qr*Ye,Vn.y=Rr*xo+Mi*jt+qr*Vi,Vn.wx=Rr,Vn.wy=Mi,Vn.wz=qr;var Is=this.clipper,wn=Is.vertices[Is.numVertices++];wn.x=Ji*be+$i*Le+to*Ye,wn.y=Ji*xo+$i*jt+to*Vi,wn.wx=Ji,wn.wy=$i,wn.wz=to,this.clipper.clip(),this.clipper.reduce();var Cr,Ro,_o;uo?(Cr=Fr,Ro=li,_o=wo):(Cr=-Fr,Ro=-li,_o=-wo),this.setNormal(a,Cr,Ro,_o);for(var Fn=0,Ge=this.clipper.numVertices;Fn<Ge;){var Gn=Fn++,Wo=this.clipper.vertices[Gn],kn,Ze,Ut;kn=Wo.wx,Ze=Wo.wy,Ut=Wo.wz,kn+=v,Ze+=e,Ut+=l;var Qo,Ui,Xn;Qo=Nn-kn,Ui=bo-Ze,Xn=Nt-Ut;var Jn=Qo*Fr+Ui*li+Xn*wo,ue,Vs,Uo;ue=kn+Fr*Jn,Vs=Ze+li*Jn,Uo=Ut+wo*Jn,Jn>-x.common.Setting.contactPersistenceThreshold&&(uo?this.addPoint(a,kn,Ze,Ut,ue,Vs,Uo,Jn,Gn):this.addPoint(a,ue,Vs,Uo,kn,Ze,Ut,Jn,Gn))}}};x.collision.narrowphase.detector._BoxBoxDetector||(x.collision.narrowphase.detector._BoxBoxDetector={});x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex=class{constructor(){this.x=0,this.y=0,this.wx=0,this.wy=0,this.wz=0}};x.collision.narrowphase.detector._BoxBoxDetector.FaceClipper=class{constructor(){this.w=0,this.h=0,this.numVertices=0,this.numTmpVertices=0;var a=new Array(8);this.vertices=a;var t=new Array(8);this.tmpVertices=t,this.vertices[0]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[0]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[1]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[1]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[2]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[2]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[3]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[3]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[4]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[4]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[5]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[5]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[6]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[6]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[7]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[7]=new x.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex}clip(){for(var a=0,t=this.numVertices;a<t;){var r=a++,i=this.vertices[r],o=this.vertices[(r+1)%this.numVertices],s=this.w+i.x,_=this.w+o.x;if(s>0&&_>0){var h=this.tmpVertices[this.numTmpVertices++];h.x=i.x,h.y=i.y,h.wx=i.wx,h.wy=i.wy,h.wz=i.wz}else if(s>0&&_<=0){var v=this.tmpVertices[this.numTmpVertices++];v.x=i.x,v.y=i.y,v.wx=i.wx,v.wy=i.wy,v.wz=i.wz;var e=s/(s-_),l=this.tmpVertices[this.numTmpVertices++];l.x=i.x+(o.x-i.x)*e,l.y=i.y+(o.y-i.y)*e,l.wx=i.wx+(o.wx-i.wx)*e,l.wy=i.wy+(o.wy-i.wy)*e,l.wz=i.wz+(o.wz-i.wz)*e}else if(s<=0&&_>0){var u=s/(s-_),b=this.tmpVertices[this.numTmpVertices++];b.x=i.x+(o.x-i.x)*u,b.y=i.y+(o.y-i.y)*u,b.wx=i.wx+(o.wx-i.wx)*u,b.wy=i.wy+(o.wy-i.wy)*u,b.wz=i.wz+(o.wz-i.wz)*u}}var f=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=f,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var n=0,c=this.numVertices;n<c;){var M=n++,m=this.vertices[M],y=this.vertices[(M+1)%this.numVertices],V=this.w-m.x,z=this.w-y.x;if(V>0&&z>0){var I=this.tmpVertices[this.numTmpVertices++];I.x=m.x,I.y=m.y,I.wx=m.wx,I.wy=m.wy,I.wz=m.wz}else if(V>0&&z<=0){var w=this.tmpVertices[this.numTmpVertices++];w.x=m.x,w.y=m.y,w.wx=m.wx,w.wy=m.wy,w.wz=m.wz;var X=V/(V-z),L=this.tmpVertices[this.numTmpVertices++];L.x=m.x+(y.x-m.x)*X,L.y=m.y+(y.y-m.y)*X,L.wx=m.wx+(y.wx-m.wx)*X,L.wy=m.wy+(y.wy-m.wy)*X,L.wz=m.wz+(y.wz-m.wz)*X}else if(V<=0&&z>0){var p=V/(V-z),g=this.tmpVertices[this.numTmpVertices++];g.x=m.x+(y.x-m.x)*p,g.y=m.y+(y.y-m.y)*p,g.wx=m.wx+(y.wx-m.wx)*p,g.wy=m.wy+(y.wy-m.wy)*p,g.wz=m.wz+(y.wz-m.wz)*p}}var F=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=F,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var S=0,N=this.numVertices;S<N;){var A=S++,Y=this.vertices[A],R=this.vertices[(A+1)%this.numVertices],C=this.h+Y.y,d=this.h+R.y;if(C>0&&d>0){var Z=this.tmpVertices[this.numTmpVertices++];Z.x=Y.x,Z.y=Y.y,Z.wx=Y.wx,Z.wy=Y.wy,Z.wz=Y.wz}else if(C>0&&d<=0){var j=this.tmpVertices[this.numTmpVertices++];j.x=Y.x,j.y=Y.y,j.wx=Y.wx,j.wy=Y.wy,j.wz=Y.wz;var H=C/(C-d),E=this.tmpVertices[this.numTmpVertices++];E.x=Y.x+(R.x-Y.x)*H,E.y=Y.y+(R.y-Y.y)*H,E.wx=Y.wx+(R.wx-Y.wx)*H,E.wy=Y.wy+(R.wy-Y.wy)*H,E.wz=Y.wz+(R.wz-Y.wz)*H}else if(C<=0&&d>0){var G=C/(C-d),B=this.tmpVertices[this.numTmpVertices++];B.x=Y.x+(R.x-Y.x)*G,B.y=Y.y+(R.y-Y.y)*G,B.wx=Y.wx+(R.wx-Y.wx)*G,B.wy=Y.wy+(R.wy-Y.wy)*G,B.wz=Y.wz+(R.wz-Y.wz)*G}}var Q=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=Q,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var W=0,J=this.numVertices;W<J;){var D=W++,O=this.vertices[D],K=this.vertices[(D+1)%this.numVertices],ra=this.h-O.y,sa=this.h-K.y;if(ra>0&&sa>0){var $=this.tmpVertices[this.numTmpVertices++];$.x=O.x,$.y=O.y,$.wx=O.wx,$.wy=O.wy,$.wz=O.wz}else if(ra>0&&sa<=0){var q=this.tmpVertices[this.numTmpVertices++];q.x=O.x,q.y=O.y,q.wx=O.wx,q.wy=O.wy,q.wz=O.wz;var na=ra/(ra-sa),oa=this.tmpVertices[this.numTmpVertices++];oa.x=O.x+(K.x-O.x)*na,oa.y=O.y+(K.y-O.y)*na,oa.wx=O.wx+(K.wx-O.wx)*na,oa.wy=O.wy+(K.wy-O.wy)*na,oa.wz=O.wz+(K.wz-O.wz)*na}else if(ra<=0&&sa>0){var aa=ra/(ra-sa),T=this.tmpVertices[this.numTmpVertices++];T.x=O.x+(K.x-O.x)*aa,T.y=O.y+(K.y-O.y)*aa,T.wx=O.wx+(K.wx-O.wx)*aa,T.wy=O.wy+(K.wy-O.wy)*aa,T.wz=O.wz+(K.wz-O.wz)*aa}}var ca=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=ca,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}reduce(){if(!(this.numVertices<4)){for(var a=-1/0,t=1/0,r=-1/0,i=1/0,o=null,s=null,_=null,h=null,v=1,e=1,l=-1,u=1,b=0,f=this.numVertices;b<f;){var n=b++,c=this.vertices[n],M=c.x*v+c.y*e,m=c.x*l+c.y*u;M>a&&(a=M,o=c),M<t&&(t=M,s=c),m>r&&(r=m,_=c),m<i&&(i=m,h=c)}var y=this.tmpVertices[this.numTmpVertices++];y.x=o.x,y.y=o.y,y.wx=o.wx,y.wy=o.wy,y.wz=o.wz;var V=this.tmpVertices[this.numTmpVertices++];V.x=_.x,V.y=_.y,V.wx=_.wx,V.wy=_.wy,V.wz=_.wz;var z=this.tmpVertices[this.numTmpVertices++];z.x=s.x,z.y=s.y,z.wx=s.wx,z.wy=s.wy,z.wz=s.wz;var I=this.tmpVertices[this.numTmpVertices++];I.x=h.x,I.y=h.y,I.wx=h.wx,I.wy=h.wy,I.wz=h.wz;var w=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=w,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}}};x.collision.narrowphase.detector.BoxBoxDetectorMacro=class{};x.collision.narrowphase.detector.CachedDetectorData=class{constructor(){}_clear(){this._gjkCache!=null&&this._gjkCache.clear()}};x.collision.narrowphase.detector.CapsuleCapsuleDetector=class extends x.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(a,t,r,i,o,s){var _=t,h=r;a.incremental=!1;var v,e,l,u,b,f;v=i._rotation01,e=i._rotation11,l=i._rotation21,u=o._rotation01,b=o._rotation11,f=o._rotation21;var n=_._halfHeight,c=h._halfHeight,M=_._radius,m=h._radius,y,V,z,I,w,X,L,p,g,F,S,N;y=i._positionX+v*-n,V=i._positionY+e*-n,z=i._positionZ+l*-n,I=i._positionX+v*n,w=i._positionY+e*n,X=i._positionZ+l*n,L=o._positionX+u*-c,p=o._positionY+b*-c,g=o._positionZ+f*-c,F=o._positionX+u*c,S=o._positionY+b*c,N=o._positionZ+f*c;var A,Y,R;A=y-L,Y=V-p,R=z-g;var C,d,Z,j,H,E;C=I-y,d=w-V,Z=X-z,j=F-L,H=S-p,E=N-g;var G=-(A*C+Y*d+R*Z),B=A*j+Y*H+R*E,Q=n*n*4,W=C*j+d*H+Z*E,J=c*c*4,D,O;if(Q==0&&J==0)D=0,O=0;else if(Q==0)D=0,O=B,O<0?O=0:O>J?O=1:O/=J;else if(J==0)O=0,D=G,D<0?D=0:D>Q?D=1:D/=Q;else{var K=Q*J-W*W;K==0?D=0:(D=W*B+J*G,D<0?D=0:D>K?D=1:D/=K),O=D*W+B,O<0?(O=0,D=G,D<0?D=0:D>Q?D=1:D/=Q):O>J?(O=1,D=W+G,D<0?D=0:D>Q?D=1:D/=Q):O/=J}var ra,sa,$,q,na,oa;ra=y+C*D,sa=V+d*D,$=z+Z*D,q=L+j*O,na=p+H*O,oa=g+E*O;var aa,T,ca;aa=ra-q,T=sa-na,ca=$-oa;var _a=aa*aa+T*T+ca*ca;if(!(_a>=(M+m)*(M+m))){var k=Math.sqrt(_a),ta,ia,la;k>0?(ta=aa*(1/k),ia=T*(1/k),la=ca*(1/k)):(ta=1,ia=0,la=0),this.setNormal(a,ta,ia,la);var va,xa,Ma,za,Xa,Za;va=ra+ta*-M,xa=sa+ia*-M,Ma=$+la*-M,za=q+ta*m,Xa=na+ia*m,Za=oa+la*m,this.addPoint(a,va,xa,Ma,za,Xa,Za,M+m-k,0)}}};x.collision.narrowphase.detector.GjkEpaDetector=class extends x.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(a,t,r,i,o,s){var _=x.collision.narrowphase.detector.gjkepa.GjkEpa.instance,h=t,v=r,e=_.computeClosestPointsImpl(h,v,i,o,x.common.Setting.enableGJKCaching?s:null,!0);if(a.incremental=!0,e!=x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED){console.log("src/oimo/collision/narrowphase/detector/GjkEpaDetector.hx:28:","GJK/EPA failed: status="+e);return}var l=h._gjkMargin,u=v._gjkMargin;if(!(_.distance>l+u)){var b,f,n,c,M,m,y=_.closestPoint1;b=y.x,f=y.y,n=y.z;var V=_.closestPoint2;c=V.x,M=V.y,m=V.z;var z,I,w;if(z=b-c,I=f-M,w=n-m,z*z+I*I+w*w!=0){_.distance<0&&(z=-z,I=-I,w=-w);var X=z*z+I*I+w*w;X>0&&(X=1/Math.sqrt(X)),z*=X,I*=X,w*=X,this.setNormal(a,z,I,w),b+=z*-h._gjkMargin,f+=I*-h._gjkMargin,n+=w*-h._gjkMargin,c+=z*v._gjkMargin,M+=I*v._gjkMargin,m+=w*v._gjkMargin,this.addPoint(a,b,f,n,c,M,m,h._gjkMargin+v._gjkMargin-_.distance,0)}}}};x.collision.narrowphase.detector.SphereBoxDetector=class extends x.collision.narrowphase.detector.Detector{constructor(a){super(a)}detectImpl(a,t,r,i,o,s){var _=t,h=r;a.incremental=!1;var v,e,l,u,b,f;v=h._halfExtentsX,e=h._halfExtentsY,l=h._halfExtentsZ,u=-v,b=-e,f=-l;var n=_._radius,c,M,m;c=i._positionX-o._positionX,M=i._positionY-o._positionY,m=i._positionZ-o._positionZ;var y,V,z,I,w,X;I=o._rotation00*c+o._rotation10*M+o._rotation20*m,w=o._rotation01*c+o._rotation11*M+o._rotation21*m,X=o._rotation02*c+o._rotation12*M+o._rotation22*m,y=I,V=w,z=X;var L=u<y&&v>y&&b<V&&e>V&&f<z&&l>z;if(L){var p,g,F;p=y<0?-y:y,g=V<0?-V:V,F=z<0?-z:z,p=v-p,g=e-g,F=l-F;var S,N,A,Y=p,R=g,C=F,d,Z,j,H;Y<R?Y<C?(y>0?(S=1,N=0,A=0):(S=-1,N=0,A=0),Z=0,j=1,H=1,d=Y):(z>0?(S=0,N=0,A=1):(S=0,N=0,A=-1),Z=1,j=1,H=0,d=C):R<C?(V>0?(S=0,N=1,A=0):(S=0,N=-1,A=0),Z=1,j=0,H=1,d=R):(z>0?(S=0,N=0,A=1):(S=0,N=0,A=-1),Z=1,j=1,H=0,d=C);var E,G,B;E=Z*y,G=j*V,B=H*z;var Q,W,J;Q=S*v,W=N*e,J=A*l,Q+=E,W+=G,J+=B;var D,O,K,ra,sa,$,q,na,oa;q=o._rotation00*Q+o._rotation01*W+o._rotation02*J,na=o._rotation10*Q+o._rotation11*W+o._rotation12*J,oa=o._rotation20*Q+o._rotation21*W+o._rotation22*J,D=q,O=na,K=oa;var aa,T,ca;aa=o._rotation00*S+o._rotation01*N+o._rotation02*A,T=o._rotation10*S+o._rotation11*N+o._rotation12*A,ca=o._rotation20*S+o._rotation21*N+o._rotation22*A,ra=aa,sa=T,$=ca,this.setNormal(a,ra,sa,$);var _a,k,ta,ia,la,va;_a=i._positionX+ra*-n,k=i._positionY+sa*-n,ta=i._positionZ+$*-n,ia=o._positionX+D,la=o._positionY+O,va=o._positionZ+K,this.addPoint(a,_a,k,ta,ia,la,va,d,0);return}var xa,Ma,za,Xa=1e-9,Za,fa,ba;Za=Xa,fa=Xa,ba=Xa,v-=Za,e-=fa,l-=ba,u+=Za,b+=fa,f+=ba,xa=y<v?y:v,Ma=V<e?V:e,za=z<l?z:l,xa=xa>u?xa:u,Ma=Ma>b?Ma:b,za=za>f?za:f;var ea,ha,pa;ea=y-xa,ha=V-Ma,pa=z-za;var ya=ea*ea+ha*ha+pa*pa;if(!(ya>=n*n)){ya=Math.sqrt(ya);var da,ma,Ya,Qa,ga,ua,ka,wa,Pa;ka=o._rotation00*xa+o._rotation01*Ma+o._rotation02*za,wa=o._rotation10*xa+o._rotation11*Ma+o._rotation12*za,Pa=o._rotation20*xa+o._rotation21*Ma+o._rotation22*za,da=ka,ma=wa,Ya=Pa;var Mt,Oa,Ba;Mt=o._rotation00*ea+o._rotation01*ha+o._rotation02*pa,Oa=o._rotation10*ea+o._rotation11*ha+o._rotation12*pa,Ba=o._rotation20*ea+o._rotation21*ha+o._rotation22*pa,Qa=Mt,ga=Oa,ua=Ba;var nt,Ea,Na,Sa=Qa*Qa+ga*ga+ua*ua;Sa>0&&(Sa=1/Math.sqrt(Sa)),nt=Qa*Sa,Ea=ga*Sa,Na=ua*Sa,this.setNormal(a,nt,Ea,Na);var ft,Wa,Ha,bt,rt,ja;ft=i._positionX+nt*-n,Wa=i._positionY+Ea*-n,Ha=i._positionZ+Na*-n,bt=o._positionX+da,rt=o._positionY+ma,ja=o._positionZ+Ya,this.addPoint(a,ft,Wa,Ha,bt,rt,ja,n-ya,0)}}};x.collision.narrowphase.detector.SphereCapsuleDetector=class extends x.collision.narrowphase.detector.Detector{constructor(a){super(a)}detectImpl(a,t,r,i,o,s){var _=t,h=r;a.incremental=!1;var v=h._halfHeight,e=_._radius,l=h._radius,u,b,f;u=o._rotation01,b=o._rotation11,f=o._rotation21;var n,c,M;n=i._positionX,c=i._positionY,M=i._positionZ;var m,y,V,z,I,w;m=o._positionX+u*-v,y=o._positionY+b*-v,V=o._positionZ+f*-v,z=o._positionX+u*v,I=o._positionY+b*v,w=o._positionZ+f*v;var X,L,p;X=n-m,L=c-y,p=M-V;var g,F,S;g=z-m,F=I-y,S=w-V;var N=v*v*4,A=X*g+L*F+p*S;A<0?A=0:A>N?A=1:A/=N;var Y,R,C;Y=m+g*A,R=y+F*A,C=V+S*A;var d,Z,j;d=n-Y,Z=c-R,j=M-C;var H=d*d+Z*Z+j*j;if(!(H>=(e+l)*(e+l))){var E=Math.sqrt(H),G,B,Q;E>0?(G=d*(1/E),B=Z*(1/E),Q=j*(1/E)):(G=1,B=0,Q=0),this.setNormal(a,G,B,Q);var W,J,D,O,K,ra;W=n+G*-e,J=c+B*-e,D=M+Q*-e,O=Y+G*l,K=R+B*l,ra=C+Q*l,this.addPoint(a,W,J,D,O,K,ra,e+l-E,0)}}};x.collision.narrowphase.detector.SphereSphereDetector=class extends x.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(a,t,r,i,o,s){var _=t,h=r;a.incremental=!1;var v,e,l;v=i._positionX-o._positionX,e=i._positionY-o._positionY,l=i._positionZ-o._positionZ;var u=_._radius,b=h._radius,f=v*v+e*e+l*l;if(!(f>=(u+b)*(u+b))){var n=Math.sqrt(f),c,M,m;n>0?(c=v*(1/n),M=e*(1/n),m=l*(1/n)):(c=1,M=0,m=0),this.setNormal(a,c,M,m);var y,V,z,I,w,X;y=i._positionX+c*-u,V=i._positionY+M*-u,z=i._positionZ+m*-u,I=o._positionX+c*b,w=o._positionY+M*b,X=o._positionZ+m*b,this.addPoint(a,y,V,z,I,w,X,u+b-n,0)}}};x.collision.narrowphase.detector.gjkepa||(x.collision.narrowphase.detector.gjkepa={});x.collision.narrowphase.detector.gjkepa.EpaPolyhedron=class{constructor(){var a=new Array(x.common.Setting.maxEPAVertices);this._vertices=a,this._center=new x.common.Vec3,this._numVertices=0,this._triangleList=null,this._triangleListLast=null,this._numTriangles=0,this._trianglePool=null,this._vertexPool=null}dumpHoleEdge(a){}validate(){for(var a=this._triangleList;a!=null;){var t=a._next;if(a._vertices[0]._tmpEdgeLoopOuterTriangle=null,a._vertices[0]._tmpEdgeLoopNext=null,a._adjacentPairIndex[0]==-1)return this._status=2,!1;if(a._adjacentTriangles[0]==null)return this._status=3,!1;if(a._vertices[1]._tmpEdgeLoopOuterTriangle=null,a._vertices[1]._tmpEdgeLoopNext=null,a._adjacentPairIndex[1]==-1)return this._status=2,!1;if(a._adjacentTriangles[1]==null)return this._status=3,!1;if(a._vertices[2]._tmpEdgeLoopOuterTriangle=null,a._vertices[2]._tmpEdgeLoopNext=null,a._adjacentPairIndex[2]==-1)return this._status=2,!1;if(a._adjacentTriangles[2]==null)return this._status=3,!1;a=t}return!0}findEdgeLoop(a,t,r){if(t._tmpDfsId!=a){t._tmpDfsId=a;var i=t.tmp;i.x=r.x,i.y=r.y,i.z=r.z;var o=i,s=t._vertices[0].v,_=o.x-s.x,h=o.y-s.y,v=o.z-s.z;o.x=_,o.y=h,o.z=v;var e=t.tmp,l=t._normal;if(t._tmpDfsVisible=e.x*l.x+e.y*l.y+e.z*l.z>0,!t._tmpDfsVisible){this._status=6;return}for(var u=0;u<3;){var b=u++,f=t._adjacentTriangles[b];if(f!=null){var n=f.tmp;n.x=r.x,n.y=r.y,n.z=r.z;var c=n,M=f._vertices[0].v,m=c.x-M.x,y=c.y-M.y,V=c.z-M.z;c.x=m,c.y=y,c.z=V;var z=f.tmp,I=f._normal;if(f._tmpDfsVisible=z.x*I.x+z.y*I.y+z.z*I.z>0,f._tmpDfsVisible)this.findEdgeLoop(a,f,r);else{var w=t._nextIndex[b],X=t._vertices[b],L=t._vertices[w];X._tmpEdgeLoopNext=L,X._tmpEdgeLoopOuterTriangle=f}}}var p=t._adjacentTriangles[0];if(p!=null){var g=t._adjacentPairIndex[0];p._adjacentTriangles[g]=null,p._adjacentPairIndex[g]=-1,t._adjacentTriangles[0]=null,t._adjacentPairIndex[0]=-1}var F=t._adjacentTriangles[1];if(F!=null){var S=t._adjacentPairIndex[1];F._adjacentTriangles[S]=null,F._adjacentPairIndex[S]=-1,t._adjacentTriangles[1]=null,t._adjacentPairIndex[1]=-1}var N=t._adjacentTriangles[2];if(N!=null){var A=t._adjacentPairIndex[2];N._adjacentTriangles[A]=null,N._adjacentPairIndex[A]=-1,t._adjacentTriangles[2]=null,t._adjacentPairIndex[2]=-1}this._numTriangles--;var Y=t._prev,R=t._next;Y!=null&&(Y._next=R),R!=null&&(R._prev=Y),t==this._triangleList&&(this._triangleList=this._triangleList._next),t==this._triangleListLast&&(this._triangleListLast=this._triangleListLast._prev),t._next=null,t._prev=null,t.removeReferences(),t._next=this._trianglePool,this._trianglePool=t}}_init(a,t,r,i){this._status=0,this._numVertices=4,this._vertices[0]=a,this._vertices[1]=t,this._vertices[2]=r,this._vertices[3]=i;var o=this._center,s=a.v;o.x=s.x,o.y=s.y,o.z=s.z;var _=o,h=t.v,v=_.x+h.x,e=_.y+h.y,l=_.z+h.z;_.x=v,_.y=e,_.z=l;var u=_,b=r.v,f=u.x+b.x,n=u.y+b.y,c=u.z+b.z;u.x=f,u.y=n,u.z=c;var M=u,m=i.v,y=M.x+m.x,V=M.y+m.y,z=M.z+m.z;M.x=y,M.y=V,M.z=z;var I=M,w=I.x*.25,X=I.y*.25,L=I.z*.25;I.x=w,I.y=X,I.z=L;var p=this._trianglePool;p!=null?(this._trianglePool=p._next,p._next=null):p=new x.collision.narrowphase.detector.gjkepa.EpaTriangle;var g=p,F=this._trianglePool;F!=null?(this._trianglePool=F._next,F._next=null):F=new x.collision.narrowphase.detector.gjkepa.EpaTriangle;var S=F,N=this._trianglePool;N!=null?(this._trianglePool=N._next,N._next=null):N=new x.collision.narrowphase.detector.gjkepa.EpaTriangle;var A=N,Y=this._trianglePool;Y!=null?(this._trianglePool=Y._next,Y._next=null):Y=new x.collision.narrowphase.detector.gjkepa.EpaTriangle;var R=Y,C=!0;g.init(a,t,r,this._center,C)||(this._status=1);var d=!0;S.init(a,t,i,this._center,d)||(this._status=1);var Z=!0;A.init(a,r,i,this._center,Z)||(this._status=1);var j=!0;return R.init(t,r,i,this._center,j)||(this._status=1),g.setAdjacentTriangle(S)||(this._status=1),g.setAdjacentTriangle(A)||(this._status=1),g.setAdjacentTriangle(R)||(this._status=1),S.setAdjacentTriangle(A)||(this._status=1),S.setAdjacentTriangle(R)||(this._status=1),A.setAdjacentTriangle(R)||(this._status=1),this._numTriangles++,this._triangleList==null?(this._triangleList=g,this._triangleListLast=g):(this._triangleListLast._next=g,g._prev=this._triangleListLast,this._triangleListLast=g),this._numTriangles++,this._triangleList==null?(this._triangleList=S,this._triangleListLast=S):(this._triangleListLast._next=S,S._prev=this._triangleListLast,this._triangleListLast=S),this._numTriangles++,this._triangleList==null?(this._triangleList=A,this._triangleListLast=A):(this._triangleListLast._next=A,A._prev=this._triangleListLast,this._triangleListLast=A),this._numTriangles++,this._triangleList==null?(this._triangleList=R,this._triangleListLast=R):(this._triangleListLast._next=R,R._prev=this._triangleListLast,this._triangleListLast=R),this._status==0}_addVertex(a,t){this._vertices[this._numVertices++]=a;var r=t._vertices[0];if(this.findEdgeLoop(this._numVertices,t,a.v),this._status!=0)return!1;for(var i=r,o=r,s=null,_=null;;){if(i._tmpEdgeLoopNext==null)return this._dumpAsObjModel(),this._status=4,!1;if(i._tmpEdgeLoopOuterTriangle==null)return this._status=5,!1;var h=this._trianglePool;h!=null?(this._trianglePool=h._next,h._next=null):h=new x.collision.narrowphase.detector.gjkepa.EpaTriangle;var v=h;if(_==null&&(_=v),v.init(i,i._tmpEdgeLoopNext,a,this._center,!1)||(this._status=1),this._status!=0)return!1;if(this._numTriangles++,this._triangleList==null?(this._triangleList=v,this._triangleListLast=v):(this._triangleListLast._next=v,v._prev=this._triangleListLast,this._triangleListLast=v),v.setAdjacentTriangle(i._tmpEdgeLoopOuterTriangle)||(this._status=1),s!=null&&(v.setAdjacentTriangle(s)||(this._status=1)),s=v,i=i._tmpEdgeLoopNext,i==o)break}return s.setAdjacentTriangle(_)||(this._status=1),this._status==0?this.validate():!1}_dumpAsObjModel(){}};x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState=class{};x.collision.narrowphase.detector.gjkepa.EpaTriangle=class{constructor(){this.id=++x.collision.narrowphase.detector.gjkepa.EpaTriangle.count,this._next=null,this._prev=null,this._normal=new x.common.Vec3,this._distanceSq=0,this._tmpDfsId=0,this._tmpDfsVisible=!1;var a=new Array(3);this._vertices=a;var t=new Array(3);this._adjacentTriangles=t;var r=new Array(3);this._adjacentPairIndex=r,this.tmp=new x.common.Vec3;var i=new Array(3);this._nextIndex=i,this._nextIndex[0]=1,this._nextIndex[1]=2,this._nextIndex[2]=0}init(a,t,r,i,o){o==null&&(o=!1);var s,_,h,v,e,l,u,b,f,n,c,M,m=a.v;s=m.x,_=m.y,h=m.z;var y=t.v;v=y.x,e=y.y,l=y.z;var V=r.v;u=V.x,b=V.y,f=V.z;var z=i;n=z.x,c=z.y,M=z.z;var I,w,X,L,p,g,F,S,N;I=v-s,w=e-_,X=l-h,L=u-s,p=b-_,g=f-h,F=s-n,S=_-c,N=h-M;var A,Y,R;A=w*g-X*p,Y=X*L-I*g,R=I*p-w*L;var C=!1,d=F*A+S*Y+N*R;if(d<0)if(o){var Z=t;t=r,r=Z,A*=-1,Y*=-1,R*=-1}else C=!0;this._vertices[0]=a,this._vertices[1]=t,this._vertices[2]=r;var j=this._normal;j.x=A,j.y=Y,j.z=R;var H=a.v,E=t.v,G=r.v,B=this.tmp,Q,W,J,D,O,K,ra,sa,$,q,na,oa,aa,T,ca,_a,k,ta,ia=H;Q=ia.x,W=ia.y,J=ia.z;var la=E;D=la.x,O=la.y,K=la.z;var va=G;ra=va.x,sa=va.y,$=va.z,q=D-Q,na=O-W,oa=K-J,aa=ra-D,T=sa-O,ca=$-K,_a=Q-ra,k=W-sa,ta=J-$;var xa,Ma,za;xa=na*ca-oa*T,Ma=oa*aa-q*ca,za=q*T-na*aa;var Xa,Za,fa,ba,ea,ha,pa,ya,da;Xa=na*za-oa*Ma,Za=oa*xa-q*za,fa=q*Ma-na*xa,ba=T*za-ca*Ma,ea=ca*xa-aa*za,ha=aa*Ma-T*xa,pa=k*za-ta*Ma,ya=ta*xa-_a*za,da=_a*Ma-k*xa;var ma=Q*Xa+W*Za+J*fa,Ya=D*ba+O*ea+K*ha,Qa=ra*pa+sa*ya+$*da,ga=-1,ua,ka,wa;if(ua=0,ka=0,wa=0,ma<0){var Pa,Mt,Oa,Ba,nt,Ea,Na=H;Pa=Na.x,Mt=Na.y,Oa=Na.z;var Sa=E;Ba=Sa.x,nt=Sa.y,Ea=Sa.z;var ft,Wa,Ha;ft=Ba-Pa,Wa=nt-Mt,Ha=Ea-Oa;var bt=ft*ft+Wa*Wa+Ha*Ha,rt=ft*Pa+Wa*Mt+Ha*Oa;if(rt=-rt/bt,rt<0){var ja=B;ja.x=Pa,ja.y=Mt,ja.z=Oa}else if(rt>1){var _t=B;_t.x=Ba,_t.y=nt,_t.z=Ea}else{var gt,mt,Ja;gt=Pa+ft*rt,mt=Mt+Wa*rt,Ja=Oa+Ha*rt;var it=B;it.x=gt,it.y=mt,it.z=Ja}var ut=B.x*B.x+B.y*B.y+B.z*B.z;ga=ut;var Da=B;ua=Da.x,ka=Da.y,wa=Da.z}if(Ya<0){var Ta,Fa,Vt,Pt,et,Xt,Yt=E;Ta=Yt.x,Fa=Yt.y,Vt=Yt.z;var zt=G;Pt=zt.x,et=zt.y,Xt=zt.z;var Ia,U,Va;Ia=Pt-Ta,U=et-Fa,Va=Xt-Vt;var lt=Ia*Ia+U*U+Va*Va,P=Ia*Ta+U*Fa+Va*Vt;if(P=-P/lt,P<0){var kt=B;kt.x=Ta,kt.y=Fa,kt.z=Vt}else if(P>1){var Bt=B;Bt.x=Pt,Bt.y=et,Bt.z=Xt}else{var St,yt,wt;St=Ta+Ia*P,yt=Fa+U*P,wt=Vt+Va*P;var pt=B;pt.x=St,pt.y=yt,pt.z=wt}var ht=B.x*B.x+B.y*B.y+B.z*B.z;if(ga<0||ht<ga){ga=ht;var xt=B;ua=xt.x,ka=xt.y,wa=xt.z}}if(Qa<0){var Ra,st,Ca,vt,qa,at,Ua=H;Ra=Ua.x,st=Ua.y,Ca=Ua.z;var tt=G;vt=tt.x,qa=tt.y,at=tt.z;var ct,Aa,Ga;ct=vt-Ra,Aa=qa-st,Ga=at-Ca;var Ka=ct*ct+Aa*Aa+Ga*Ga,La=ct*Ra+Aa*st+Ga*Ca;if(La=-La/Ka,La<0){var ot=B;ot.x=Ra,ot.y=st,ot.z=Ca}else if(La>1){var It=B;It.x=vt,It.y=qa,It.z=at}else{var or,gr,ar;or=Ra+ct*La,gr=st+Aa*La,ar=Ca+Ga*La;var Ct=B;Ct.x=or,Ct.y=gr,Ct.z=ar}var _r=B.x*B.x+B.y*B.y+B.z*B.z;if(ga<0||_r<ga){ga=_r;var Et=B;ua=Et.x,ka=Et.y,wa=Et.z}}if(ga>0){var At=B;At.x=ua,At.y=ka,At.z=wa}else{var Gt=xa*xa+Ma*Ma+za*za;Gt>0&&(Gt=1/Math.sqrt(Gt)),xa*=Gt,Ma*=Gt,za*=Gt;var Hr=Q*xa+W*Ma+J*za,vr=xa*xa+Ma*Ma+za*za;vr=Hr/vr,ua=xa*vr,ka=Ma*vr,wa=za*vr;var lr=B;lr.x=ua,lr.y=ka,lr.z=wa}var tr=this.tmp;return this._distanceSq=tr.x*tr.x+tr.y*tr.y+tr.z*tr.z,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=-1,this._adjacentPairIndex[1]=-1,this._adjacentPairIndex[2]=-1,!C}setAdjacentTriangle(a){var t=0,r=this._nextIndex[0],i=this._nextIndex[0];this._vertices[0]==a._vertices[i]&&this._vertices[r]==a._vertices[0]&&(this._adjacentTriangles[0]=a,this._adjacentPairIndex[0]=0,a._adjacentTriangles[0]=this,a._adjacentPairIndex[0]=0,++t);var o=this._nextIndex[0],s=this._nextIndex[1];this._vertices[0]==a._vertices[s]&&this._vertices[o]==a._vertices[1]&&(this._adjacentTriangles[0]=a,this._adjacentPairIndex[0]=1,a._adjacentTriangles[1]=this,a._adjacentPairIndex[1]=0,++t);var _=this._nextIndex[0],h=this._nextIndex[2];this._vertices[0]==a._vertices[h]&&this._vertices[_]==a._vertices[2]&&(this._adjacentTriangles[0]=a,this._adjacentPairIndex[0]=2,a._adjacentTriangles[2]=this,a._adjacentPairIndex[2]=0,++t);var v=this._nextIndex[1],e=this._nextIndex[0];this._vertices[1]==a._vertices[e]&&this._vertices[v]==a._vertices[0]&&(this._adjacentTriangles[1]=a,this._adjacentPairIndex[1]=0,a._adjacentTriangles[0]=this,a._adjacentPairIndex[0]=1,++t);var l=this._nextIndex[1],u=this._nextIndex[1];this._vertices[1]==a._vertices[u]&&this._vertices[l]==a._vertices[1]&&(this._adjacentTriangles[1]=a,this._adjacentPairIndex[1]=1,a._adjacentTriangles[1]=this,a._adjacentPairIndex[1]=1,++t);var b=this._nextIndex[1],f=this._nextIndex[2];this._vertices[1]==a._vertices[f]&&this._vertices[b]==a._vertices[2]&&(this._adjacentTriangles[1]=a,this._adjacentPairIndex[1]=2,a._adjacentTriangles[2]=this,a._adjacentPairIndex[2]=1,++t);var n=this._nextIndex[2],c=this._nextIndex[0];this._vertices[2]==a._vertices[c]&&this._vertices[n]==a._vertices[0]&&(this._adjacentTriangles[2]=a,this._adjacentPairIndex[2]=0,a._adjacentTriangles[0]=this,a._adjacentPairIndex[0]=2,++t);var M=this._nextIndex[2],m=this._nextIndex[1];this._vertices[2]==a._vertices[m]&&this._vertices[M]==a._vertices[1]&&(this._adjacentTriangles[2]=a,this._adjacentPairIndex[2]=1,a._adjacentTriangles[1]=this,a._adjacentPairIndex[1]=2,++t);var y=this._nextIndex[2],V=this._nextIndex[2];return this._vertices[2]==a._vertices[V]&&this._vertices[y]==a._vertices[2]&&(this._adjacentTriangles[2]=a,this._adjacentPairIndex[2]=2,a._adjacentTriangles[2]=this,a._adjacentPairIndex[2]=2,++t),t==1}removeAdjacentTriangles(){var a=this._adjacentTriangles[0];if(a!=null){var t=this._adjacentPairIndex[0];a._adjacentTriangles[t]=null,a._adjacentPairIndex[t]=-1,this._adjacentTriangles[0]=null,this._adjacentPairIndex[0]=-1}var r=this._adjacentTriangles[1];if(r!=null){var i=this._adjacentPairIndex[1];r._adjacentTriangles[i]=null,r._adjacentPairIndex[i]=-1,this._adjacentTriangles[1]=null,this._adjacentPairIndex[1]=-1}var o=this._adjacentTriangles[2];if(o!=null){var s=this._adjacentPairIndex[2];o._adjacentTriangles[s]=null,o._adjacentPairIndex[s]=-1,this._adjacentTriangles[2]=null,this._adjacentPairIndex[2]=-1}}removeReferences(){this._next=null,this._prev=null,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._distanceSq=0,this._vertices[0]=null,this._vertices[1]=null,this._vertices[2]=null,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=0,this._adjacentPairIndex[1]=0,this._adjacentPairIndex[2]=0}dump(){}};x.collision.narrowphase.detector.gjkepa.EpaVertex=class{constructor(){this.randId=Math.random()*1e5|0,this.v=new x.common.Vec3,this.w1=new x.common.Vec3,this.w2=new x.common.Vec3}init(a,t,r){var i=this.v;i.x=a.x,i.y=a.y,i.z=a.z;var o=this.w1;o.x=t.x,o.y=t.y,o.z=t.z;var s=this.w2;return s.x=r.x,s.y=r.y,s.z=r.z,this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null,this}removeReferences(){this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null}};x.collision.narrowphase.detector.gjkepa.GjkCache=class{constructor(){this.prevClosestDir=new x.common.Vec3}clear(){this.prevClosestDir.zero()}};x.common||(x.common={});x.common.Vec3=class{constructor(a,t,r){r==null&&(r=0),t==null&&(t=0),a==null&&(a=0),this.x=a,this.y=t,this.z=r,x.common.Vec3.numCreations++}init(a,t,r){return this.x=a,this.y=t,this.z=r,this}zero(){var a=0,t=0,r=0;return this.x=a,this.y=t,this.z=r,this}add(a){return new x.common.Vec3(this.x+a.x,this.y+a.y,this.z+a.z)}add3(a,t,r){return new x.common.Vec3(this.x+a,this.y+t,this.z+r)}addScaled(a,t){return new x.common.Vec3(this.x+a.x*t,this.y+a.y*t,this.z+a.z*t)}sub(a){return new x.common.Vec3(this.x-a.x,this.y-a.y,this.z-a.z)}sub3(a,t,r){return new x.common.Vec3(this.x-a,this.y-t,this.z-r)}scale(a){return new x.common.Vec3(this.x*a,this.y*a,this.z*a)}scale3(a,t,r){return new x.common.Vec3(this.x*a,this.y*t,this.z*r)}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z}cross(a){return new x.common.Vec3(this.y*a.z-this.z*a.y,this.z*a.x-this.x*a.z,this.x*a.y-this.y*a.x)}addEq(a){var t=this.x+a.x,r=this.y+a.y,i=this.z+a.z;return this.x=t,this.y=r,this.z=i,this}add3Eq(a,t,r){var i=this.x+a,o=this.y+t,s=this.z+r;return this.x=i,this.y=o,this.z=s,this}addScaledEq(a,t){var r=this.x+a.x*t,i=this.y+a.y*t,o=this.z+a.z*t;return this.x=r,this.y=i,this.z=o,this}subEq(a){var t=this.x-a.x,r=this.y-a.y,i=this.z-a.z;return this.x=t,this.y=r,this.z=i,this}sub3Eq(a,t,r){var i=this.x-a,o=this.y-t,s=this.z-r;return this.x=i,this.y=o,this.z=s,this}scaleEq(a){var t=this.x*a,r=this.y*a,i=this.z*a;return this.x=t,this.y=r,this.z=i,this}scale3Eq(a,t,r){var i=this.x*a,o=this.y*t,s=this.z*r;return this.x=i,this.y=o,this.z=s,this}crossEq(a){var t=this.y*a.z-this.z*a.y,r=this.z*a.x-this.x*a.z,i=this.x*a.y-this.y*a.x;return this.x=t,this.y=r,this.z=i,this}mulMat3(a){return new x.common.Vec3(this.x*a.e00+this.y*a.e01+this.z*a.e02,this.x*a.e10+this.y*a.e11+this.z*a.e12,this.x*a.e20+this.y*a.e21+this.z*a.e22)}mulMat4(a){return new x.common.Vec3(this.x*a.e00+this.y*a.e01+this.z*a.e02+a.e03,this.x*a.e10+this.y*a.e11+this.z*a.e12+a.e13,this.x*a.e20+this.y*a.e21+this.z*a.e22+a.e23)}mulTransform(a){var t,r,i,o=this;t=o.x,r=o.y,i=o.z;var s,_,h;s=a._rotation00*t+a._rotation01*r+a._rotation02*i,_=a._rotation10*t+a._rotation11*r+a._rotation12*i,h=a._rotation20*t+a._rotation21*r+a._rotation22*i,t=s,r=_,i=h,t+=a._positionX,r+=a._positionY,i+=a._positionZ;var v=new x.common.Vec3,e=v;return e.x=t,e.y=r,e.z=i,v}mulMat3Eq(a){var t=this.x*a.e00+this.y*a.e01+this.z*a.e02,r=this.x*a.e10+this.y*a.e11+this.z*a.e12,i=this.x*a.e20+this.y*a.e21+this.z*a.e22;return this.x=t,this.y=r,this.z=i,this}mulMat4Eq(a){var t=this.x*a.e00+this.y*a.e01+this.z*a.e02+a.e03,r=this.x*a.e10+this.y*a.e11+this.z*a.e12+a.e13,i=this.x*a.e20+this.y*a.e21+this.z*a.e22+a.e23;return this.x=t,this.y=r,this.z=i,this}mulTransformEq(a){var t,r,i,o=this;t=o.x,r=o.y,i=o.z;var s,_,h;s=a._rotation00*t+a._rotation01*r+a._rotation02*i,_=a._rotation10*t+a._rotation11*r+a._rotation12*i,h=a._rotation20*t+a._rotation21*r+a._rotation22*i,t=s,r=_,i=h,t+=a._positionX,r+=a._positionY,i+=a._positionZ;var v=this;return v.x=t,v.y=r,v.z=i,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}normalized(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return a>0&&(a=1/a),new x.common.Vec3(this.x*a,this.y*a,this.z*a)}normalize(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);a>0&&(a=1/a);var t=this.x*a,r=this.y*a,i=this.z*a;return this.x=t,this.y=r,this.z=i,this}negate(){return new x.common.Vec3(-this.x,-this.y,-this.z)}negateEq(){var a=-this.x,t=-this.y,r=-this.z;return this.x=a,this.y=t,this.z=r,this}copyFrom(a){return this.x=a.x,this.y=a.y,this.z=a.z,this}clone(){return new x.common.Vec3(this.x,this.y,this.z)}toString(){return"Vec3["+(this.x>0?(this.x*1e7+.5|0)/1e7:(this.x*1e7-.5|0)/1e7)+", "+(this.y>0?(this.y*1e7+.5|0)/1e7:(this.y*1e7-.5|0)/1e7)+", "+(this.z>0?(this.z*1e7+.5|0)/1e7:(this.z*1e7-.5|0)/1e7)+"]"}};x.common.Transform=class{constructor(){this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1}identity(){return this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1,this}getPosition(){var a=new x.common.Vec3,t=a;return t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ,a}getPositionTo(a){var t=a;t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ}setPosition(a){var t=a;return this._positionX=t.x,this._positionY=t.y,this._positionZ=t.z,this}translate(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z,this._positionX+=t,this._positionY+=r,this._positionZ+=i}getRotation(){var a=new x.common.Mat3,t=a;return t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22,a}getRotationTo(a){var t=a;t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22}setRotation(a){var t=a;return this._rotation00=t.e00,this._rotation01=t.e01,this._rotation02=t.e02,this._rotation10=t.e10,this._rotation11=t.e11,this._rotation12=t.e12,this._rotation20=t.e20,this._rotation21=t.e21,this._rotation22=t.e22,this}setRotationXyz(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z;var s=Math.sin(t),_=Math.sin(r),h=Math.sin(i),v=Math.cos(t),e=Math.cos(r),l=Math.cos(i);this._rotation00=e*l,this._rotation01=-e*h,this._rotation02=_,this._rotation10=v*h+l*s*_,this._rotation11=v*l-s*_*h,this._rotation12=-e*s,this._rotation20=s*h-v*l*_,this._rotation21=l*s+v*_*h,this._rotation22=v*e}rotate(a){var t,r,i,o,s,_,h,v,e,l=a;t=l.e00,r=l.e01,i=l.e02,o=l.e10,s=l.e11,_=l.e12,h=l.e20,v=l.e21,e=l.e22;var u,b,f,n,c,M,m,y,V;u=t*this._rotation00+r*this._rotation10+i*this._rotation20,b=t*this._rotation01+r*this._rotation11+i*this._rotation21,f=t*this._rotation02+r*this._rotation12+i*this._rotation22,n=o*this._rotation00+s*this._rotation10+_*this._rotation20,c=o*this._rotation01+s*this._rotation11+_*this._rotation21,M=o*this._rotation02+s*this._rotation12+_*this._rotation22,m=h*this._rotation00+v*this._rotation10+e*this._rotation20,y=h*this._rotation01+v*this._rotation11+e*this._rotation21,V=h*this._rotation02+v*this._rotation12+e*this._rotation22,this._rotation00=u,this._rotation01=b,this._rotation02=f,this._rotation10=n,this._rotation11=c,this._rotation12=M,this._rotation20=m,this._rotation21=y,this._rotation22=V}rotateXyz(a){var t,r,i,o,s,_,h,v,e,l,u,b,f=a;t=f.x,r=f.y,i=f.z;var n=Math.sin(t),c=Math.sin(r),M=Math.sin(i),m=Math.cos(t),y=Math.cos(r),V=Math.cos(i);o=y*V,s=-y*M,_=c,h=m*M+V*n*c,v=m*V-n*c*M,e=-y*n,l=n*M-m*V*c,u=V*n+m*c*M,b=m*y;var z,I,w,X,L,p,g,F,S;z=o*this._rotation00+s*this._rotation10+_*this._rotation20,I=o*this._rotation01+s*this._rotation11+_*this._rotation21,w=o*this._rotation02+s*this._rotation12+_*this._rotation22,X=h*this._rotation00+v*this._rotation10+e*this._rotation20,L=h*this._rotation01+v*this._rotation11+e*this._rotation21,p=h*this._rotation02+v*this._rotation12+e*this._rotation22,g=l*this._rotation00+u*this._rotation10+b*this._rotation20,F=l*this._rotation01+u*this._rotation11+b*this._rotation21,S=l*this._rotation02+u*this._rotation12+b*this._rotation22,this._rotation00=z,this._rotation01=I,this._rotation02=w,this._rotation10=X,this._rotation11=L,this._rotation12=p,this._rotation20=g,this._rotation21=F,this._rotation22=S}getOrientation(){var a=new x.common.Quat,t,r,i,o,s=this._rotation00,_=this._rotation11,h=this._rotation22,v=s+_+h,e;v>0?(e=Math.sqrt(v+1),o=.5*e,e=.5/e,t=(this._rotation21-this._rotation12)*e,r=(this._rotation02-this._rotation20)*e,i=(this._rotation10-this._rotation01)*e):s>_?s>h?(e=Math.sqrt(s-_-h+1),t=.5*e,e=.5/e,r=(this._rotation01+this._rotation10)*e,i=(this._rotation02+this._rotation20)*e,o=(this._rotation21-this._rotation12)*e):(e=Math.sqrt(h-s-_+1),i=.5*e,e=.5/e,t=(this._rotation02+this._rotation20)*e,r=(this._rotation12+this._rotation21)*e,o=(this._rotation10-this._rotation01)*e):_>h?(e=Math.sqrt(_-h-s+1),r=.5*e,e=.5/e,t=(this._rotation01+this._rotation10)*e,i=(this._rotation12+this._rotation21)*e,o=(this._rotation02-this._rotation20)*e):(e=Math.sqrt(h-s-_+1),i=.5*e,e=.5/e,t=(this._rotation02+this._rotation20)*e,r=(this._rotation12+this._rotation21)*e,o=(this._rotation10-this._rotation01)*e);var l=a;return l.x=t,l.y=r,l.z=i,l.w=o,a}getOrientationTo(a){var t,r,i,o,s=this._rotation00,_=this._rotation11,h=this._rotation22,v=s+_+h,e;v>0?(e=Math.sqrt(v+1),o=.5*e,e=.5/e,t=(this._rotation21-this._rotation12)*e,r=(this._rotation02-this._rotation20)*e,i=(this._rotation10-this._rotation01)*e):s>_?s>h?(e=Math.sqrt(s-_-h+1),t=.5*e,e=.5/e,r=(this._rotation01+this._rotation10)*e,i=(this._rotation02+this._rotation20)*e,o=(this._rotation21-this._rotation12)*e):(e=Math.sqrt(h-s-_+1),i=.5*e,e=.5/e,t=(this._rotation02+this._rotation20)*e,r=(this._rotation12+this._rotation21)*e,o=(this._rotation10-this._rotation01)*e):_>h?(e=Math.sqrt(_-h-s+1),r=.5*e,e=.5/e,t=(this._rotation01+this._rotation10)*e,i=(this._rotation12+this._rotation21)*e,o=(this._rotation02-this._rotation20)*e):(e=Math.sqrt(h-s-_+1),i=.5*e,e=.5/e,t=(this._rotation02+this._rotation20)*e,r=(this._rotation12+this._rotation21)*e,o=(this._rotation10-this._rotation01)*e);var l=a;l.x=t,l.y=r,l.z=i,l.w=o}setOrientation(a){var t,r,i,o,s=a;t=s.x,r=s.y,i=s.z,o=s.w;var _=t,h=r,v=i,e=o,l=2*_,u=2*h,b=2*v,f=_*l,n=h*u,c=v*b,M=_*u,m=h*b,y=_*b,V=e*l,z=e*u,I=e*b;return this._rotation00=1-n-c,this._rotation01=M-I,this._rotation02=y+z,this._rotation10=M+I,this._rotation11=1-f-c,this._rotation12=m-V,this._rotation20=y-z,this._rotation21=m+V,this._rotation22=1-f-n,this}clone(){var a=new x.common.Transform;return a._positionX=this._positionX,a._positionY=this._positionY,a._positionZ=this._positionZ,a._rotation00=this._rotation00,a._rotation01=this._rotation01,a._rotation02=this._rotation02,a._rotation10=this._rotation10,a._rotation11=this._rotation11,a._rotation12=this._rotation12,a._rotation20=this._rotation20,a._rotation21=this._rotation21,a._rotation22=this._rotation22,a}copyFrom(a){return this._positionX=a._positionX,this._positionY=a._positionY,this._positionZ=a._positionZ,this._rotation00=a._rotation00,this._rotation01=a._rotation01,this._rotation02=a._rotation02,this._rotation10=a._rotation10,this._rotation11=a._rotation11,this._rotation12=a._rotation12,this._rotation20=a._rotation20,this._rotation21=a._rotation21,this._rotation22=a._rotation22,this}};x.common.Setting=class{};x.collision.narrowphase.detector.gjkepa.GjkEpa=class{constructor(){var a=new Array(4);this.s=a;var t=new Array(4);this.w1=t;var r=new Array(4);this.w2=r;var i=new Array(3);this.baseDirs=i,this.baseDirs[0]=new x.common.Vec3(1,0,0),this.baseDirs[1]=new x.common.Vec3(0,1,0),this.baseDirs[2]=new x.common.Vec3(0,0,1),this.tl1=new x.common.Vec3,this.tl2=new x.common.Vec3,this.rayX=new x.common.Vec3,this.rayR=new x.common.Vec3,this.tempTransform=new x.common.Transform,this.s[0]=new x.common.Vec3,this.w1[0]=new x.common.Vec3,this.w2[0]=new x.common.Vec3,this.s[1]=new x.common.Vec3,this.w1[1]=new x.common.Vec3,this.w2[1]=new x.common.Vec3,this.s[2]=new x.common.Vec3,this.w1[2]=new x.common.Vec3,this.w2[2]=new x.common.Vec3,this.s[3]=new x.common.Vec3,this.w1[3]=new x.common.Vec3,this.w2[3]=new x.common.Vec3,this.dir=new x.common.Vec3,this.closest=new x.common.Vec3,this.closestPoint1=new x.common.Vec3,this.closestPoint2=new x.common.Vec3,this.polyhedron=new x.collision.narrowphase.detector.gjkepa.EpaPolyhedron}computeClosestPointsImpl(a,t,r,i,o,s){this.c1=a,this.c2=t,this.tf1=r,this.tf2=i;var _=this.s,h=this.w1,v=this.w2,e=this.closest,l=this.dir;if(o!=null?(o._gjkCache==null&&(o._gjkCache=new x.collision.narrowphase.detector.gjkepa.GjkCache),this.loadCache(o._gjkCache)):l.zero(),l.x*l.x+l.y*l.y+l.z*l.z==0){var u,b,f;u=i._positionX-r._positionX,b=i._positionY-r._positionY,f=i._positionZ-r._positionZ;var n=l;n.x=u,n.y=b,n.z=f,l.x*l.x+l.y*l.y+l.z*l.z<1e-6&&l.init(1,0,0)}this.simplexSize=0,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var c=this.s[this.simplexSize],M=this.w1[this.simplexSize];c.x=M.x,c.y=M.y,c.z=M.z;var m=c,y=this.w2[this.simplexSize],V=m.x-y.x,z=m.y-y.y,I=m.z-y.z;m.x=V,m.y=z,m.z=I,this.simplexSize=1;for(var w=0,X=40,L=1e-4,p=L*L;w<X;){var g=0;switch(this.simplexSize){case 1:var F=_[0];e.x=F.x,e.y=F.y,e.z=F.z,g=1;break;case 2:var S,N,A,Y,R,C,d=_[0];S=d.x,N=d.y,A=d.z;var Z=_[1];Y=Z.x,R=Z.y,C=Z.z;var j,H,E;j=Y-S,H=R-N,E=C-A;var G=j*j+H*H+E*E,B=j*S+H*N+E*A;if(B=-B/G,B<0){var Q=e;Q.x=S,Q.y=N,Q.z=A,g=1}else if(B>1){var W=e;W.x=Y,W.y=R,W.z=C,g=2}else{var J,D,O;J=S+j*B,D=N+H*B,O=A+E*B;var K=e;K.x=J,K.y=D,K.z=O,g=3}break;case 3:var ra=_[0],sa=_[1],$=_[2],q,na,oa,aa,T,ca,_a,k,ta,ia,la,va,xa,Ma,za,Xa,Za,fa,ba=ra;q=ba.x,na=ba.y,oa=ba.z;var ea=sa;aa=ea.x,T=ea.y,ca=ea.z;var ha=$;_a=ha.x,k=ha.y,ta=ha.z,ia=aa-q,la=T-na,va=ca-oa,xa=_a-aa,Ma=k-T,za=ta-ca,Xa=q-_a,Za=na-k,fa=oa-ta;var pa,ya,da;pa=la*za-va*Ma,ya=va*xa-ia*za,da=ia*Ma-la*xa;var ma,Ya,Qa,ga,ua,ka,wa,Pa,Mt;ma=la*da-va*ya,Ya=va*pa-ia*da,Qa=ia*ya-la*pa,ga=Ma*da-za*ya,ua=za*pa-xa*da,ka=xa*ya-Ma*pa,wa=Za*da-fa*ya,Pa=fa*pa-Xa*da,Mt=Xa*ya-Za*pa;var Oa=q*ma+na*Ya+oa*Qa,Ba=aa*ga+T*ua+ca*ka,nt=_a*wa+k*Pa+ta*Mt,Ea=-1,Na,Sa,ft,Wa=0;if(Na=0,Sa=0,ft=0,Oa<0){var Ha,bt,rt,ja,_t,gt,mt=ra;Ha=mt.x,bt=mt.y,rt=mt.z;var Ja=sa;ja=Ja.x,_t=Ja.y,gt=Ja.z;var it,ut,Da;it=ja-Ha,ut=_t-bt,Da=gt-rt;var Ta=it*it+ut*ut+Da*Da,Fa=it*Ha+ut*bt+Da*rt;Fa=-Fa/Ta;var Vt;if(Fa<0){var Pt=e;Pt.x=Ha,Pt.y=bt,Pt.z=rt,Vt=1}else if(Fa>1){var et=e;et.x=ja,et.y=_t,et.z=gt,Vt=2}else{var Xt,Yt,zt;Xt=Ha+it*Fa,Yt=bt+ut*Fa,zt=rt+Da*Fa;var Ia=e;Ia.x=Xt,Ia.y=Yt,Ia.z=zt,Vt=3}var U=e.x*e.x+e.y*e.y+e.z*e.z;Wa=Vt,Ea=U;var Va=e;Na=Va.x,Sa=Va.y,ft=Va.z}if(Ba<0){var lt,P,kt,Bt,St,yt,wt=sa;lt=wt.x,P=wt.y,kt=wt.z;var pt=$;Bt=pt.x,St=pt.y,yt=pt.z;var ht,xt,Ra;ht=Bt-lt,xt=St-P,Ra=yt-kt;var st=ht*ht+xt*xt+Ra*Ra,Ca=ht*lt+xt*P+Ra*kt;Ca=-Ca/st;var vt;if(Ca<0){var qa=e;qa.x=lt,qa.y=P,qa.z=kt,vt=1}else if(Ca>1){var at=e;at.x=Bt,at.y=St,at.z=yt,vt=2}else{var Ua,tt,ct;Ua=lt+ht*Ca,tt=P+xt*Ca,ct=kt+Ra*Ca;var Aa=e;Aa.x=Ua,Aa.y=tt,Aa.z=ct,vt=3}var Ga=e.x*e.x+e.y*e.y+e.z*e.z;if(Ea<0||Ga<Ea){Wa=vt<<1,Ea=Ga;var Ka=e;Na=Ka.x,Sa=Ka.y,ft=Ka.z}}if(nt<0){var La,ot,It,or,gr,ar,Ct=ra;La=Ct.x,ot=Ct.y,It=Ct.z;var _r=$;or=_r.x,gr=_r.y,ar=_r.z;var Et,At,Gt;Et=or-La,At=gr-ot,Gt=ar-It;var Hr=Et*Et+At*At+Gt*Gt,vr=Et*La+At*ot+Gt*It;vr=-vr/Hr;var lr;if(vr<0){var tr=e;tr.x=La,tr.y=ot,tr.z=It,lr=1}else if(vr>1){var Ur=e;Ur.x=or,Ur.y=gr,Ur.z=ar,lr=2}else{var Xr,Mr,Zt;Xr=La+Et*vr,Mr=ot+At*vr,Zt=It+Gt*vr;var ir=e;ir.x=Xr,ir.y=Mr,ir.z=Zt,lr=3}var $t=e.x*e.x+e.y*e.y+e.z*e.z;if(Ea<0||$t<Ea){Wa=lr&1|(lr&2)<<1,Ea=$t;var nr=e;Na=nr.x,Sa=nr.y,ft=nr.z}}if(Ea>0){var jr=e;jr.x=Na,jr.y=Sa,jr.z=ft,g=Wa}else{var Wt=pa*pa+ya*ya+da*da;Wt>0&&(Wt=1/Math.sqrt(Wt)),pa*=Wt,ya*=Wt,da*=Wt;var Kr=q*pa+na*ya+oa*da,Ir=pa*pa+ya*ya+da*da;Ir=Kr/Ir,Na=pa*Ir,Sa=ya*Ir,ft=da*Ir;var mi=e;mi.x=Na,mi.y=Sa,mi.z=ft,g=7}break;case 4:var $r=_[0],Lt=_[1],Kt=_[2],Tt=_[3],br,zr,vi,qt,fr,dt,ur,hr,ei,Xi,oo,Jt,fi,pi,Dt,Bi,Ar,Ni,Hn,no,Si,eo,gn,Ao,Vo,xr,ao,Ai=$r;br=Ai.x,zr=Ai.y,vi=Ai.z;var yi=Lt;qt=yi.x,fr=yi.y,dt=yi.z;var Po=Kt;ur=Po.x,hr=Po.y,ei=Po.z;var Dr=Tt;Xi=Dr.x,oo=Dr.y,Jt=Dr.z,fi=qt-br,pi=fr-zr,Dt=dt-vi,Bi=ur-br,Ar=hr-zr,Ni=ei-vi,Hn=Xi-br,no=oo-zr,Si=Jt-vi,eo=ur-qt,gn=hr-fr,Ao=ei-dt,Vo=Xi-qt,xr=oo-fr,ao=Jt-dt;var Pi,gi,Rt,Or,Lr,Tn,ms,qe,ps,Re,as,N_;Pi=pi*Ni-Dt*Ar,gi=Dt*Bi-fi*Ni,Rt=fi*Ar-pi*Bi,Or=Ar*Si-Ni*no,Lr=Ni*Hn-Bi*Si,Tn=Bi*no-Ar*Hn,ms=no*Dt-Si*pi,qe=Si*fi-Hn*Dt,ps=Hn*pi-no*fi,Re=xr*Ao-ao*gn,as=ao*eo-Vo*Ao,N_=Vo*gn-xr*eo;var In=fi*Re+pi*as+Dt*N_>0?1:-1,Pr=br*Pi+zr*gi+vi*Rt,Go=br*Or+zr*Lr+vi*Tn,Wi=br*ms+zr*qe+vi*ps,ke=qt*Re+fr*as+dt*N_,nn=-1,Rn,jn,Xe,k_=0;if(Rn=0,jn=0,Xe=0,Pr*In<0){var Qe,Vr,Ii,ui,so,Qn,ys,en,En,cr,co,Fi,Dn,ts,Ee,De,Ne,ce,rr=$r;Qe=rr.x,Vr=rr.y,Ii=rr.z;var ri=Lt;ui=ri.x,so=ri.y,Qn=ri.z;var Qr=Kt;ys=Qr.x,en=Qr.y,En=Qr.z,cr=ui-Qe,co=so-Vr,Fi=Qn-Ii,Dn=ys-ui,ts=en-so,Ee=En-Qn,De=Qe-ys,Ne=Vr-en,ce=Ii-En;var Nr,uo,Co;Nr=co*Ee-Fi*ts,uo=Fi*Dn-cr*Ee,Co=cr*ts-co*Dn;var __,Fe,rs,Nn,bo,Nt,Fr,li,wo;__=co*Co-Fi*uo,Fe=Fi*Nr-cr*Co,rs=cr*uo-co*Nr,Nn=ts*Co-Ee*uo,bo=Ee*Nr-Dn*Co,Nt=Dn*uo-ts*Nr,Fr=Ne*Co-ce*uo,li=ce*Nr-De*Co,wo=De*uo-Ne*Nr;var be=Qe*__+Vr*Fe+Ii*rs,Le=ui*Nn+so*bo+Qn*Nt,Ye=ys*Fr+en*li+En*wo,xo=-1,jt,Vi,si,Jo=0;if(jt=0,Vi=0,si=0,be<0){var Gs,To,ko,Gi,Ci,Ti,Li=$r;Gs=Li.x,To=Li.y,ko=Li.z;var Qt=Lt;Gi=Qt.x,Ci=Qt.y,Ti=Qt.z;var Gr,Yr,Rr;Gr=Gi-Gs,Yr=Ci-To,Rr=Ti-ko;var Mi=Gr*Gr+Yr*Yr+Rr*Rr,qr=Gr*Gs+Yr*To+Rr*ko;qr=-qr/Mi;var Ji;if(qr<0){var $i=e;$i.x=Gs,$i.y=To,$i.z=ko,Ji=1}else if(qr>1){var to=e;to.x=Gi,to.y=Ci,to.z=Ti,Ji=2}else{var fe,wr,sn;fe=Gs+Gr*qr,wr=To+Yr*qr,sn=ko+Rr*qr;var Yi=e;Yi.x=fe,Yi.y=wr,Yi.z=sn,Ji=3}var $o=e.x*e.x+e.y*e.y+e.z*e.z;Jo=Ji,xo=$o;var gs=e;jt=gs.x,Vi=gs.y,si=gs.z}if(Le<0){var Vn,Is,wn,Cr,Ro,_o,Fn=Lt;Vn=Fn.x,Is=Fn.y,wn=Fn.z;var Ge=Kt;Cr=Ge.x,Ro=Ge.y,_o=Ge.z;var Gn,Wo,kn;Gn=Cr-Vn,Wo=Ro-Is,kn=_o-wn;var Ze=Gn*Gn+Wo*Wo+kn*kn,Ut=Gn*Vn+Wo*Is+kn*wn;Ut=-Ut/Ze;var Qo;if(Ut<0){var Ui=e;Ui.x=Vn,Ui.y=Is,Ui.z=wn,Qo=1}else if(Ut>1){var Xn=e;Xn.x=Cr,Xn.y=Ro,Xn.z=_o,Qo=2}else{var Jn,ue,Vs;Jn=Vn+Gn*Ut,ue=Is+Wo*Ut,Vs=wn+kn*Ut;var Uo=e;Uo.x=Jn,Uo.y=ue,Uo.z=Vs,Qo=3}var ws=e.x*e.x+e.y*e.y+e.z*e.z;if(xo<0||ws<xo){Jo=Qo<<1,xo=ws;var X_=e;jt=X_.x,Vi=X_.y,si=X_.z}}if(Ye<0){var Js,L_,Je,F_,G_,Oi,Xo=$r;Js=Xo.x,L_=Xo.y,Je=Xo.z;var Lo=Kt;F_=Lo.x,G_=Lo.y,Oi=Lo.z;var $n,kr,Wn;$n=F_-Js,kr=G_-L_,Wn=Oi-Je;var Eo=$n*$n+kr*kr+Wn*Wn,ro=$n*Js+kr*L_+Wn*Je;ro=-ro/Eo;var J_;if(ro<0){var $_=e;$_.x=Js,$_.y=L_,$_.z=Je,J_=1}else if(ro>1){var Y_=e;Y_.x=F_,Y_.y=G_,Y_.z=Oi,J_=2}else{var is,v_,l_;is=Js+$n*ro,v_=L_+kr*ro,l_=Je+Wn*ro;var os=e;os.x=is,os.y=v_,os.z=l_,J_=3}var mr=e.x*e.x+e.y*e.y+e.z*e.z;if(xo<0||mr<xo){Jo=J_&1|(J_&2)<<1,xo=mr;var Oo=e;jt=Oo.x,Vi=Oo.y,si=Oo.z}}var ai;if(xo>0){var de=e;de.x=jt,de.y=Vi,de.z=si,ai=Jo}else{var $s=Nr*Nr+uo*uo+Co*Co;$s>0&&($s=1/Math.sqrt($s)),Nr*=$s,uo*=$s,Co*=$s;var cv=Qe*Nr+Vr*uo+Ii*Co,xe=Nr*Nr+uo*uo+Co*Co;xe=cv/xe,jt=Nr*xe,Vi=uo*xe,si=Co*xe;var $e=e;$e.x=jt,$e.y=Vi,$e.z=si,ai=7}var Kn=e.x*e.x+e.y*e.y+e.z*e.z;k_=ai,nn=Kn;var Ws=e;Rn=Ws.x,jn=Ws.y,Xe=Ws.z}if(Go*In<0){var Tr,Yo,Ri,_n,ks,Z_,We,qn,Ln,ns,Be,es,Us,h_,Se,Ae,ae,pr,Mo=$r;Tr=Mo.x,Yo=Mo.y,Ri=Mo.z;var Zi=Kt;_n=Zi.x,ks=Zi.y,Z_=Zi.z;var Ho=Tt;We=Ho.x,qn=Ho.y,Ln=Ho.z,ns=_n-Tr,Be=ks-Yo,es=Z_-Ri,Us=We-_n,h_=qn-ks,Se=Ln-Z_,Ae=Tr-We,ae=Yo-qn,pr=Ri-Ln;var Zo,Hi,Do;Zo=Be*Se-es*h_,Hi=es*Us-ns*Se,Do=ns*h_-Be*Us;var Xs,te,Os,W_,re,Ft,ji,No,Ls;Xs=Be*Do-es*Hi,te=es*Zo-ns*Do,Os=ns*Hi-Be*Zo,W_=h_*Do-Se*Hi,re=Se*Zo-Us*Do,Ft=Us*Hi-h_*Zo,ji=ae*Do-pr*Hi,No=pr*Zo-Ae*Do,Ls=Ae*Hi-ae*Zo;var kv=Tr*Xs+Yo*te+Ri*Os,i0=_n*W_+ks*re+Z_*Ft,U_=We*ji+qn*No+Ln*Ls,Ot=-1,Yn,Qi,Zn,d_=0;if(Yn=0,Qi=0,Zn=0,kv<0){var Hs,c_,fo,ss,_s,Me,Zr=$r;Hs=Zr.x,c_=Zr.y,fo=Zr.z;var jo=Kt;ss=jo.x,_s=jo.y,Me=jo.z;var wi,Bo,Ue;wi=ss-Hs,Bo=_s-c_,Ue=Me-fo;var bv=wi*wi+Bo*Bo+Ue*Ue,ze=wi*Hs+Bo*c_+Ue*fo;ze=-ze/bv;var js;if(ze<0){var Xv=e;Xv.x=Hs,Xv.y=c_,Xv.z=fo,js=1}else if(ze>1){var Oe=e;Oe.x=ss,Oe.y=_s,Oe.z=Me,js=2}else{var er,dn,vn;er=Hs+wi*ze,dn=c_+Bo*ze,vn=fo+Ue*ze;var ln=e;ln.x=er,ln.y=dn,ln.z=vn,js=3}var B_=e.x*e.x+e.y*e.y+e.z*e.z;d_=js,Ot=B_;var fv=e;Yn=fv.x,Qi=fv.y,Zn=fv.z}if(i0<0){var ie,Pe,b_,O_,uv,xv,f_=Kt;ie=f_.x,Pe=f_.y,b_=f_.z;var He=Tt;O_=He.x,uv=He.y,xv=He.z;var zo,vs,ls;zo=O_-ie,vs=uv-Pe,ls=xv-b_;var Wr=zo*zo+vs*vs+ls*ls,mo=zo*ie+vs*Pe+ls*b_;mo=-mo/Wr;var vo;if(mo<0){var hs=e;hs.x=ie,hs.y=Pe,hs.z=b_,vo=1}else if(mo>1){var Ys=e;Ys.x=O_,Ys.y=uv,Ys.z=xv,vo=2}else{var Zs,ds,S_;Zs=ie+zo*mo,ds=Pe+vs*mo,S_=b_+ls*mo;var me=e;me.x=Zs,me.y=ds,me.z=S_,vo=3}var cs=e.x*e.x+e.y*e.y+e.z*e.z;if(Ot<0||cs<Ot){d_=vo<<1,Ot=cs;var H_=e;Yn=H_.x,Qi=H_.y,Zn=H_.z}}if(U_<0){var Ks,Un,pe,Lv,A_,Ko,hn=$r;Ks=hn.x,Un=hn.y,pe=hn.z;var po=Tt;Lv=po.x,A_=po.y,Ko=po.z;var Ht,Ki,lo;Ht=Lv-Ks,Ki=A_-Un,lo=Ko-pe;var qs=Ht*Ht+Ki*Ki+lo*lo,Bs=Ht*Ks+Ki*Un+lo*pe;Bs=-Bs/qs;var a_;if(Bs<0){var P_=e;P_.x=Ks,P_.y=Un,P_.z=pe,a_=1}else if(Bs>1){var qo=e;qo.x=Lv,qo.y=A_,qo.z=Ko,a_=2}else{var oe,j_,Mv;oe=Ks+Ht*Bs,j_=Un+Ki*Bs,Mv=pe+lo*Bs;var dr=e;dr.x=oe,dr.y=j_,dr.z=Mv,a_=3}var yo=e.x*e.x+e.y*e.y+e.z*e.z;if(Ot<0||yo<Ot){d_=a_&1|(a_&2)<<1,Ot=yo;var Ei=e;Yn=Ei.x,Qi=Ei.y,Zn=Ei.z}}var io;if(Ot>0){var K_=e;K_.x=Yn,K_.y=Qi,K_.z=Zn,io=d_}else{var q_=Zo*Zo+Hi*Hi+Do*Do;q_>0&&(q_=1/Math.sqrt(q_)),Zo*=q_,Hi*=q_,Do*=q_;var Yv=Tr*Zo+Yo*Hi+Ri*Do,t_=Zo*Zo+Hi*Hi+Do*Do;t_=Yv/t_,Yn=Zo*t_,Qi=Hi*t_,Zn=Do*t_;var Zv=e;Zv.x=Yn,Zv.y=Qi,Zv.z=Zn,io=7}var av=e.x*e.x+e.y*e.y+e.z*e.z;if(nn<0||av<nn){k_=io&1|(io&6)<<1,nn=av;var Br=e;Rn=Br.x,jn=Br.y,Xe=Br.z}}if(Wi*In<0){var tv,Ss,As,bs,fs,Ps,dv,ye,qi,r_,go,i_,Fo,Cs,an,ge,sr,tn,_i=$r;tv=_i.x,Ss=_i.y,As=_i.z;var ne=Lt;bs=ne.x,fs=ne.y,Ps=ne.z;var Ie=Tt;dv=Ie.x,ye=Ie.y,qi=Ie.z,r_=bs-tv,go=fs-Ss,i_=Ps-As,Fo=dv-bs,Cs=ye-fs,an=qi-Ps,ge=tv-dv,sr=Ss-ye,tn=As-qi;var So,Di,Bn;So=go*an-i_*Cs,Di=i_*Fo-r_*an,Bn=r_*Cs-go*Fo;var rv,o_,C_,iv,ee,Sn,Ve,D0,m0;rv=go*Bn-i_*Di,o_=i_*So-r_*Bn,C_=r_*Di-go*So,iv=Cs*Bn-an*Di,ee=an*So-Fo*Bn,Sn=Fo*Di-Cs*So,Ve=sr*Bn-tn*Di,D0=tn*So-ge*Bn,m0=ge*Di-sr*So;var cl=tv*rv+Ss*o_+As*C_,N0=bs*iv+fs*ee+Ps*Sn,hi=dv*Ve+ye*D0+qi*m0,On=-1,Io,us,ov,zv=0;if(Io=0,us=0,ov=0,cl<0){var n_,Bv,Ts,u_,x_,Sr,Rs=$r;n_=Rs.x,Bv=Rs.y,Ts=Rs.z;var ho=Lt;u_=ho.x,x_=ho.y,Sr=ho.z;var Ce,mv,Qs;Ce=u_-n_,mv=x_-Bv,Qs=Sr-Ts;var M_=Ce*Ce+mv*mv+Qs*Qs,nv=Ce*n_+mv*Bv+Qs*Ts;nv=-nv/M_;var o0;if(nv<0){var n0=e;n0.x=n_,n0.y=Bv,n0.z=Ts,o0=1}else if(nv>1){var ev=e;ev.x=u_,ev.y=x_,ev.z=Sr,o0=2}else{var ti,je,An;ti=n_+Ce*nv,je=Bv+mv*nv,An=Ts+Qs*nv;var xs=e;xs.x=ti,xs.y=je,xs.z=An,o0=3}var F0=e.x*e.x+e.y*e.y+e.z*e.z;zv=o0,On=F0;var Nv=e;Io=Nv.x,us=Nv.y,ov=Nv.z}if(N0<0){var T_,p0,Sv,e0,y0,G0,s0=Lt;T_=s0.x,p0=s0.y,Sv=s0.z;var _0=Tt;e0=_0.x,y0=_0.y,G0=_0.z;var g0,Fv,ci;g0=e0-T_,Fv=y0-p0,ci=G0-Sv;var pv=g0*g0+Fv*Fv+ci*ci,cn=g0*T_+Fv*p0+ci*Sv;cn=-cn/pv;var Gv;if(cn<0){var Hl=e;Hl.x=T_,Hl.y=p0,Hl.z=Sv,Gv=1}else if(cn>1){var I0=e;I0.x=e0,I0.y=y0,I0.z=G0,Gv=2}else{var V0,bl,Bl;V0=T_+g0*cn,bl=p0+Fv*cn,Bl=Sv+ci*cn;var Jv=e;Jv.x=V0,Jv.y=bl,Jv.z=Bl,Gv=3}var jl=e.x*e.x+e.y*e.y+e.z*e.z;if(On<0||jl<On){zv=Gv<<1,On=jl;var Kl=e;Io=Kl.x,us=Kl.y,ov=Kl.z}}if(hi<0){var fl,Sl,Al,ql,ul,ah,xl=$r;fl=xl.x,Sl=xl.y,Al=xl.z;var ii=Tt;ql=ii.x,ul=ii.y,ah=ii.z;var Ms,rn,yv;Ms=ql-fl,rn=ul-Sl,yv=ah-Al;var gh=Ms*Ms+rn*rn+yv*yv,$v=Ms*fl+rn*Sl+yv*Al;$v=-$v/gh;var J0;if($v<0){var Ml=e;Ml.x=fl,Ml.y=Sl,Ml.z=Al,J0=1}else if($v>1){var w0=e;w0.x=ql,w0.y=ul,w0.z=ah,J0=2}else{var k0,$0,zi;k0=fl+Ms*$v,$0=Sl+rn*$v,zi=Al+yv*$v;var zs=e;zs.x=k0,zs.y=$0,zs.z=zi,J0=3}var se=e.x*e.x+e.y*e.y+e.z*e.z;if(On<0||se<On){zv=J0&1|(J0&2)<<1,On=se;var v0=e;Io=v0.x,us=v0.y,ov=v0.z}}var Pl;if(On>0){var hh=e;hh.x=Io,hh.y=us,hh.z=ov,Pl=zv}else{var W0=So*So+Di*Di+Bn*Bn;W0>0&&(W0=1/Math.sqrt(W0)),So*=W0,Di*=W0,Bn*=W0;var ch=tv*So+Ss*Di+As*Bn,U0=So*So+Di*Di+Bn*Bn;U0=ch/U0,Io=So*U0,us=Di*U0,ov=Bn*U0;var Cl=e;Cl.x=Io,Cl.y=us,Cl.z=ov,Pl=7}var zl=e.x*e.x+e.y*e.y+e.z*e.z;if(nn<0||zl<nn){k_=Pl&3|(Pl&4)<<1,nn=zl;var Te=e;Rn=Te.x,jn=Te.y,Xe=Te.z}}if(ke*In<0){var X0,z_,Tl,O0,H0,Rl,ml,L0,l0,m_,Wv,Uv,sv,Y0,Av,h0,_e,c0,Z0=Lt;X0=Z0.x,z_=Z0.y,Tl=Z0.z;var Es=Kt;O0=Es.x,H0=Es.y,Rl=Es.z;var j0=Tt;ml=j0.x,L0=j0.y,l0=j0.z,m_=O0-X0,Wv=H0-z_,Uv=Rl-Tl,sv=ml-O0,Y0=L0-H0,Av=l0-Rl,h0=X0-ml,_e=z_-L0,c0=Tl-l0;var yr,bn,ki;yr=Wv*Av-Uv*Y0,bn=Uv*sv-m_*Av,ki=m_*Y0-Wv*sv;var Ov,b0,bh,th,p_,Ke,Ds,rh,fh;Ov=Wv*ki-Uv*bn,b0=Uv*yr-m_*ki,bh=m_*bn-Wv*yr,th=Y0*ki-Av*bn,p_=Av*yr-sv*ki,Ke=sv*bn-Y0*yr,Ds=_e*ki-c0*bn,rh=c0*yr-h0*ki,fh=h0*bn-_e*yr;var Ql=X0*Ov+z_*b0+Tl*bh,bi=O0*th+H0*p_+Rl*Ke,e_=ml*Ds+L0*rh+l0*fh,fn=-1,gv,K0,Iv,pl=0;if(gv=0,K0=0,Iv=0,Ql<0){var yl,gl,R_,Pv,Pn,Vv,Cv=Lt;yl=Cv.x,gl=Cv.y,R_=Cv.z;var Q_=Kt;Pv=Q_.x,Pn=Q_.y,Vv=Q_.z;var ve,E_,Tv;ve=Pv-yl,E_=Pn-gl,Tv=Vv-R_;var Hv=ve*ve+E_*E_+Tv*Tv,oi=ve*yl+E_*gl+Tv*R_;oi=-oi/Hv;var y_;if(oi<0){var le=e;le.x=yl,le.y=gl,le.z=R_,y_=1}else if(oi>1){var Jr=e;Jr.x=Pv,Jr.y=Pn,Jr.z=Vv,y_=2}else{var g_,Cn,q0;g_=yl+ve*oi,Cn=gl+E_*oi,q0=R_+Tv*oi;var f0=e;f0.x=g_,f0.y=Cn,f0.z=q0,y_=3}var uh=e.x*e.x+e.y*e.y+e.z*e.z;pl=y_,fn=uh;var al=e;gv=al.x,K0=al.y,Iv=al.z}if(bi<0){var tl,Il,d0,xh,Vl,Ih,ih=Kt;tl=ih.x,Il=ih.y,d0=ih.z;var wl=Tt;xh=wl.x,Vl=wl.y,Ih=wl.z;var B0,S0,kl;B0=xh-tl,S0=Vl-Il,kl=Ih-d0;var oh=B0*B0+S0*S0+kl*kl,jv=B0*tl+S0*Il+kl*d0;jv=-jv/oh;var El;if(jv<0){var Kv=e;Kv.x=tl,Kv.y=Il,Kv.z=d0,El=1}else if(jv>1){var ni=e;ni.x=xh,ni.y=Vl,ni.z=Ih,El=2}else{var I_,on,Xl;I_=tl+B0*jv,on=Il+S0*jv,Xl=d0+kl*jv;var A0=e;A0.x=I_,A0.y=on,A0.z=Xl,El=3}var nh=e.x*e.x+e.y*e.y+e.z*e.z;if(fn<0||nh<fn){pl=El<<1,fn=nh;var Dl=e;gv=Dl.x,K0=Dl.y,Iv=Dl.z}}if(e_<0){var rl,Nl,P0,eh,sh,Fl,Gl=Lt;rl=Gl.x,Nl=Gl.y,P0=Gl.z;var _v=Tt;eh=_v.x,sh=_v.y,Fl=_v.z;var Rv,qv,Ns;Rv=eh-rl,qv=sh-Nl,Ns=Fl-P0;var Mh=Rv*Rv+qv*qv+Ns*Ns,u0=Rv*rl+qv*Nl+Ns*P0;u0=-u0/Mh;var Ll;if(u0<0){var Qv=e;Qv.x=rl,Qv.y=Nl,Qv.z=P0,Ll=1}else if(u0>1){var a0=e;a0.x=eh,a0.y=sh,a0.z=Fl,Ll=2}else{var Ev,x0,dh;Ev=rl+Rv*u0,x0=Nl+qv*u0,dh=P0+Ns*u0;var C0=e;C0.x=Ev,C0.y=x0,C0.z=dh,Ll=3}var t0=e.x*e.x+e.y*e.y+e.z*e.z;if(fn<0||t0<fn){pl=Ll&1|(Ll&2)<<1,fn=t0;var Jl=e;gv=Jl.x,K0=Jl.y,Iv=Jl.z}}var $l;if(fn>0){var zh=e;zh.x=gv,zh.y=K0,zh.z=Iv,$l=pl}else{var Dv=yr*yr+bn*bn+ki*ki;Dv>0&&(Dv=1/Math.sqrt(Dv)),yr*=Dv,bn*=Dv,ki*=Dv;var xi=X0*yr+z_*bn+Tl*ki,we=yr*yr+bn*bn+ki*ki;we=xi/we,gv=yr*we,K0=bn*we,Iv=ki*we;var he=e;he.x=gv,he.y=K0,he.z=Iv,$l=7}var T0=e.x*e.x+e.y*e.y+e.z*e.z;if(nn<0||T0<nn){k_=$l<<1,nn=T0;var Wl=e;Rn=Wl.x,jn=Wl.y,Xe=Wl.z}}if(nn>0){var Fs=e;Fs.x=Rn,Fs.y=jn,Fs.z=Xe,g=k_}else e.zero(),g=15;break}if(e.x*e.x+e.y*e.y+e.z*e.z<p){if(!s)return this.distance=0,0;switch(this.simplexSize){case 1:this.pointToTetrahedron();break;case 2:this.lineToTetrahedron();break;case 3:this.triangleToTetrahedron();break}if(this.simplexSize==4){var M0=this.computeDepth(a,t,r,i,_,h,v);return M0!=0?(this.distance=0,M0):(this.distance=-this.depth,0)}return this.distance=0,1}this.shrinkSimplex(g),l.x=e.x,l.y=e.y,l.z=e.z;var Yl=l,Ul=-Yl.x,Ol=-Yl.y,Vh=-Yl.z;Yl.x=Ul,Yl.y=Ol,Yl.z=Vh,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var vv=this.s[this.simplexSize],lv=this.w1[this.simplexSize];vv.x=lv.x,vv.y=lv.y,vv.z=lv.z;var R0=vv,V_=this.w2[this.simplexSize],Zl=R0.x-V_.x,wh=R0.y-V_.y,Bh=R0.z-V_.z;if(R0.x=Zl,R0.y=wh,R0.z=Bh,l.x*l.x+l.y*l.y+l.z*l.z<p)throw new Error("!?");var r0=e.x*l.x+e.y*l.y+e.z*l.z,hv=_[this.simplexSize],kh=hv.x*l.x+hv.y*l.y+hv.z*l.z;if(kh-r0<p)return this.interpolateClosestPoints(),this.distance=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),o!=null&&o._gjkCache!=null&&this.saveCache(o._gjkCache),0;this.simplexSize++,++w}return 2}convexCastImpl(a,t,r,i,o,s,_){this.c1=a,this.c2=t,this.tf1=r,this.tf2=i;var h=this.s;this.w1,this.w2;var v=this.closest,e=this.dir,l,u,b;l=i._positionX-r._positionX,u=i._positionY-r._positionY,b=i._positionZ-r._positionZ;var f=e;if(f.x=l,f.y=u,f.z=b,e.x*e.x+e.y*e.y+e.z*e.z<1e-6&&e.init(1,0,0),this.simplexSize=0,this.c1!=null)this.computeWitnessPoint1(!0);else{var n=this.w1[this.simplexSize];n.x=this.tf1._positionX,n.y=this.tf1._positionY,n.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);var c=this.s[this.simplexSize],M=this.w1[this.simplexSize];c.x=M.x,c.y=M.y,c.z=M.z;var m=c,y=this.w2[this.simplexSize],V=m.x-y.x,z=m.y-y.y,I=m.z-y.z;m.x=V,m.y=z,m.z=I,this.simplexSize=1;var w=0,X=40,L=0,p=this.rayX,g=this.rayR;p.zero(),g.x=s.x,g.y=s.y,g.z=s.z;var F=g,S=F.x-o.x,N=F.y-o.y,A=F.z-o.z;F.x=S,F.y=N,F.z=A;for(var Y=1e-4,R=Y*Y;w<X;){var C=0;switch(this.simplexSize){case 1:var d=h[0];v.x=d.x,v.y=d.y,v.z=d.z,C=1;break;case 2:var Z,j,H,E,G,B,Q=h[0];Z=Q.x,j=Q.y,H=Q.z;var W=h[1];E=W.x,G=W.y,B=W.z;var J,D,O;J=E-Z,D=G-j,O=B-H;var K=J*J+D*D+O*O,ra=J*Z+D*j+O*H;if(ra=-ra/K,ra<0){var sa=v;sa.x=Z,sa.y=j,sa.z=H,C=1}else if(ra>1){var $=v;$.x=E,$.y=G,$.z=B,C=2}else{var q,na,oa;q=Z+J*ra,na=j+D*ra,oa=H+O*ra;var aa=v;aa.x=q,aa.y=na,aa.z=oa,C=3}break;case 3:var T=h[0],ca=h[1],_a=h[2],k,ta,ia,la,va,xa,Ma,za,Xa,Za,fa,ba,ea,ha,pa,ya,da,ma,Ya=T;k=Ya.x,ta=Ya.y,ia=Ya.z;var Qa=ca;la=Qa.x,va=Qa.y,xa=Qa.z;var ga=_a;Ma=ga.x,za=ga.y,Xa=ga.z,Za=la-k,fa=va-ta,ba=xa-ia,ea=Ma-la,ha=za-va,pa=Xa-xa,ya=k-Ma,da=ta-za,ma=ia-Xa;var ua,ka,wa;ua=fa*pa-ba*ha,ka=ba*ea-Za*pa,wa=Za*ha-fa*ea;var Pa,Mt,Oa,Ba,nt,Ea,Na,Sa,ft;Pa=fa*wa-ba*ka,Mt=ba*ua-Za*wa,Oa=Za*ka-fa*ua,Ba=ha*wa-pa*ka,nt=pa*ua-ea*wa,Ea=ea*ka-ha*ua,Na=da*wa-ma*ka,Sa=ma*ua-ya*wa,ft=ya*ka-da*ua;var Wa=k*Pa+ta*Mt+ia*Oa,Ha=la*Ba+va*nt+xa*Ea,bt=Ma*Na+za*Sa+Xa*ft,rt=-1,ja,_t,gt,mt=0;if(ja=0,_t=0,gt=0,Wa<0){var Ja,it,ut,Da,Ta,Fa,Vt=T;Ja=Vt.x,it=Vt.y,ut=Vt.z;var Pt=ca;Da=Pt.x,Ta=Pt.y,Fa=Pt.z;var et,Xt,Yt;et=Da-Ja,Xt=Ta-it,Yt=Fa-ut;var zt=et*et+Xt*Xt+Yt*Yt,Ia=et*Ja+Xt*it+Yt*ut;Ia=-Ia/zt;var U;if(Ia<0){var Va=v;Va.x=Ja,Va.y=it,Va.z=ut,U=1}else if(Ia>1){var lt=v;lt.x=Da,lt.y=Ta,lt.z=Fa,U=2}else{var P,kt,Bt;P=Ja+et*Ia,kt=it+Xt*Ia,Bt=ut+Yt*Ia;var St=v;St.x=P,St.y=kt,St.z=Bt,U=3}var yt=v.x*v.x+v.y*v.y+v.z*v.z;mt=U,rt=yt;var wt=v;ja=wt.x,_t=wt.y,gt=wt.z}if(Ha<0){var pt,ht,xt,Ra,st,Ca,vt=ca;pt=vt.x,ht=vt.y,xt=vt.z;var qa=_a;Ra=qa.x,st=qa.y,Ca=qa.z;var at,Ua,tt;at=Ra-pt,Ua=st-ht,tt=Ca-xt;var ct=at*at+Ua*Ua+tt*tt,Aa=at*pt+Ua*ht+tt*xt;Aa=-Aa/ct;var Ga;if(Aa<0){var Ka=v;Ka.x=pt,Ka.y=ht,Ka.z=xt,Ga=1}else if(Aa>1){var La=v;La.x=Ra,La.y=st,La.z=Ca,Ga=2}else{var ot,It,or;ot=pt+at*Aa,It=ht+Ua*Aa,or=xt+tt*Aa;var gr=v;gr.x=ot,gr.y=It,gr.z=or,Ga=3}var ar=v.x*v.x+v.y*v.y+v.z*v.z;if(rt<0||ar<rt){mt=Ga<<1,rt=ar;var Ct=v;ja=Ct.x,_t=Ct.y,gt=Ct.z}}if(bt<0){var _r,Et,At,Gt,Hr,vr,lr=T;_r=lr.x,Et=lr.y,At=lr.z;var tr=_a;Gt=tr.x,Hr=tr.y,vr=tr.z;var Ur,Xr,Mr;Ur=Gt-_r,Xr=Hr-Et,Mr=vr-At;var Zt=Ur*Ur+Xr*Xr+Mr*Mr,ir=Ur*_r+Xr*Et+Mr*At;ir=-ir/Zt;var $t;if(ir<0){var nr=v;nr.x=_r,nr.y=Et,nr.z=At,$t=1}else if(ir>1){var jr=v;jr.x=Gt,jr.y=Hr,jr.z=vr,$t=2}else{var Wt,Kr,Ir;Wt=_r+Ur*ir,Kr=Et+Xr*ir,Ir=At+Mr*ir;var mi=v;mi.x=Wt,mi.y=Kr,mi.z=Ir,$t=3}var $r=v.x*v.x+v.y*v.y+v.z*v.z;if(rt<0||$r<rt){mt=$t&1|($t&2)<<1,rt=$r;var Lt=v;ja=Lt.x,_t=Lt.y,gt=Lt.z}}if(rt>0){var Kt=v;Kt.x=ja,Kt.y=_t,Kt.z=gt,C=mt}else{var Tt=ua*ua+ka*ka+wa*wa;Tt>0&&(Tt=1/Math.sqrt(Tt)),ua*=Tt,ka*=Tt,wa*=Tt;var br=k*ua+ta*ka+ia*wa,zr=ua*ua+ka*ka+wa*wa;zr=br/zr,ja=ua*zr,_t=ka*zr,gt=wa*zr;var vi=v;vi.x=ja,vi.y=_t,vi.z=gt,C=7}break;case 4:var qt=h[0],fr=h[1],dt=h[2],ur=h[3],hr,ei,Xi,oo,Jt,fi,pi,Dt,Bi,Ar,Ni,Hn,no,Si,eo,gn,Ao,Vo,xr,ao,Ai,yi,Po,Dr,Pi,gi,Rt,Or=qt;hr=Or.x,ei=Or.y,Xi=Or.z;var Lr=fr;oo=Lr.x,Jt=Lr.y,fi=Lr.z;var Tn=dt;pi=Tn.x,Dt=Tn.y,Bi=Tn.z;var ms=ur;Ar=ms.x,Ni=ms.y,Hn=ms.z,no=oo-hr,Si=Jt-ei,eo=fi-Xi,gn=pi-hr,Ao=Dt-ei,Vo=Bi-Xi,xr=Ar-hr,ao=Ni-ei,Ai=Hn-Xi,yi=pi-oo,Po=Dt-Jt,Dr=Bi-fi,Pi=Ar-oo,gi=Ni-Jt,Rt=Hn-fi;var qe,ps,Re,as,N_,In,Pr,Go,Wi,ke,nn,Rn;qe=Si*Vo-eo*Ao,ps=eo*gn-no*Vo,Re=no*Ao-Si*gn,as=Ao*Ai-Vo*ao,N_=Vo*xr-gn*Ai,In=gn*ao-Ao*xr,Pr=ao*eo-Ai*Si,Go=Ai*no-xr*eo,Wi=xr*Si-ao*no,ke=gi*Dr-Rt*Po,nn=Rt*yi-Pi*Dr,Rn=Pi*Po-gi*yi;var jn=no*ke+Si*nn+eo*Rn>0?1:-1,Xe=hr*qe+ei*ps+Xi*Re,k_=hr*as+ei*N_+Xi*In,Qe=hr*Pr+ei*Go+Xi*Wi,Vr=oo*ke+Jt*nn+fi*Rn,Ii=-1,ui,so,Qn,ys=0;if(ui=0,so=0,Qn=0,Xe*jn<0){var en,En,cr,co,Fi,Dn,ts,Ee,De,Ne,ce,rr,ri,Qr,Nr,uo,Co,__,Fe=qt;en=Fe.x,En=Fe.y,cr=Fe.z;var rs=fr;co=rs.x,Fi=rs.y,Dn=rs.z;var Nn=dt;ts=Nn.x,Ee=Nn.y,De=Nn.z,Ne=co-en,ce=Fi-En,rr=Dn-cr,ri=ts-co,Qr=Ee-Fi,Nr=De-Dn,uo=en-ts,Co=En-Ee,__=cr-De;var bo,Nt,Fr;bo=ce*Nr-rr*Qr,Nt=rr*ri-Ne*Nr,Fr=Ne*Qr-ce*ri;var li,wo,be,Le,Ye,xo,jt,Vi,si;li=ce*Fr-rr*Nt,wo=rr*bo-Ne*Fr,be=Ne*Nt-ce*bo,Le=Qr*Fr-Nr*Nt,Ye=Nr*bo-ri*Fr,xo=ri*Nt-Qr*bo,jt=Co*Fr-__*Nt,Vi=__*bo-uo*Fr,si=uo*Nt-Co*bo;var Jo=en*li+En*wo+cr*be,Gs=co*Le+Fi*Ye+Dn*xo,To=ts*jt+Ee*Vi+De*si,ko=-1,Gi,Ci,Ti,Li=0;if(Gi=0,Ci=0,Ti=0,Jo<0){var Qt,Gr,Yr,Rr,Mi,qr,Ji=qt;Qt=Ji.x,Gr=Ji.y,Yr=Ji.z;var $i=fr;Rr=$i.x,Mi=$i.y,qr=$i.z;var to,fe,wr;to=Rr-Qt,fe=Mi-Gr,wr=qr-Yr;var sn=to*to+fe*fe+wr*wr,Yi=to*Qt+fe*Gr+wr*Yr;Yi=-Yi/sn;var $o;if(Yi<0){var gs=v;gs.x=Qt,gs.y=Gr,gs.z=Yr,$o=1}else if(Yi>1){var Vn=v;Vn.x=Rr,Vn.y=Mi,Vn.z=qr,$o=2}else{var Is,wn,Cr;Is=Qt+to*Yi,wn=Gr+fe*Yi,Cr=Yr+wr*Yi;var Ro=v;Ro.x=Is,Ro.y=wn,Ro.z=Cr,$o=3}var _o=v.x*v.x+v.y*v.y+v.z*v.z;Li=$o,ko=_o;var Fn=v;Gi=Fn.x,Ci=Fn.y,Ti=Fn.z}if(Gs<0){var Ge,Gn,Wo,kn,Ze,Ut,Qo=fr;Ge=Qo.x,Gn=Qo.y,Wo=Qo.z;var Ui=dt;kn=Ui.x,Ze=Ui.y,Ut=Ui.z;var Xn,Jn,ue;Xn=kn-Ge,Jn=Ze-Gn,ue=Ut-Wo;var Vs=Xn*Xn+Jn*Jn+ue*ue,Uo=Xn*Ge+Jn*Gn+ue*Wo;Uo=-Uo/Vs;var ws;if(Uo<0){var X_=v;X_.x=Ge,X_.y=Gn,X_.z=Wo,ws=1}else if(Uo>1){var Js=v;Js.x=kn,Js.y=Ze,Js.z=Ut,ws=2}else{var L_,Je,F_;L_=Ge+Xn*Uo,Je=Gn+Jn*Uo,F_=Wo+ue*Uo;var G_=v;G_.x=L_,G_.y=Je,G_.z=F_,ws=3}var Oi=v.x*v.x+v.y*v.y+v.z*v.z;if(ko<0||Oi<ko){Li=ws<<1,ko=Oi;var Xo=v;Gi=Xo.x,Ci=Xo.y,Ti=Xo.z}}if(To<0){var Lo,$n,kr,Wn,Eo,ro,J_=qt;Lo=J_.x,$n=J_.y,kr=J_.z;var $_=dt;Wn=$_.x,Eo=$_.y,ro=$_.z;var Y_,is,v_;Y_=Wn-Lo,is=Eo-$n,v_=ro-kr;var l_=Y_*Y_+is*is+v_*v_,os=Y_*Lo+is*$n+v_*kr;os=-os/l_;var mr;if(os<0){var Oo=v;Oo.x=Lo,Oo.y=$n,Oo.z=kr,mr=1}else if(os>1){var ai=v;ai.x=Wn,ai.y=Eo,ai.z=ro,mr=2}else{var de,$s,cv;de=Lo+Y_*os,$s=$n+is*os,cv=kr+v_*os;var xe=v;xe.x=de,xe.y=$s,xe.z=cv,mr=3}var $e=v.x*v.x+v.y*v.y+v.z*v.z;if(ko<0||$e<ko){Li=mr&1|(mr&2)<<1,ko=$e;var Kn=v;Gi=Kn.x,Ci=Kn.y,Ti=Kn.z}}var Ws;if(ko>0){var Tr=v;Tr.x=Gi,Tr.y=Ci,Tr.z=Ti,Ws=Li}else{var Yo=bo*bo+Nt*Nt+Fr*Fr;Yo>0&&(Yo=1/Math.sqrt(Yo)),bo*=Yo,Nt*=Yo,Fr*=Yo;var Ri=en*bo+En*Nt+cr*Fr,_n=bo*bo+Nt*Nt+Fr*Fr;_n=Ri/_n,Gi=bo*_n,Ci=Nt*_n,Ti=Fr*_n;var ks=v;ks.x=Gi,ks.y=Ci,ks.z=Ti,Ws=7}var Z_=v.x*v.x+v.y*v.y+v.z*v.z;ys=Ws,Ii=Z_;var We=v;ui=We.x,so=We.y,Qn=We.z}if(k_*jn<0){var qn,Ln,ns,Be,es,Us,h_,Se,Ae,ae,pr,Mo,Zi,Ho,Zo,Hi,Do,Xs,te=qt;qn=te.x,Ln=te.y,ns=te.z;var Os=dt;Be=Os.x,es=Os.y,Us=Os.z;var W_=ur;h_=W_.x,Se=W_.y,Ae=W_.z,ae=Be-qn,pr=es-Ln,Mo=Us-ns,Zi=h_-Be,Ho=Se-es,Zo=Ae-Us,Hi=qn-h_,Do=Ln-Se,Xs=ns-Ae;var re,Ft,ji;re=pr*Zo-Mo*Ho,Ft=Mo*Zi-ae*Zo,ji=ae*Ho-pr*Zi;var No,Ls,kv,i0,U_,Ot,Yn,Qi,Zn;No=pr*ji-Mo*Ft,Ls=Mo*re-ae*ji,kv=ae*Ft-pr*re,i0=Ho*ji-Zo*Ft,U_=Zo*re-Zi*ji,Ot=Zi*Ft-Ho*re,Yn=Do*ji-Xs*Ft,Qi=Xs*re-Hi*ji,Zn=Hi*Ft-Do*re;var d_=qn*No+Ln*Ls+ns*kv,Hs=Be*i0+es*U_+Us*Ot,c_=h_*Yn+Se*Qi+Ae*Zn,fo=-1,ss,_s,Me,Zr=0;if(ss=0,_s=0,Me=0,d_<0){var jo,wi,Bo,Ue,bv,ze,js=qt;jo=js.x,wi=js.y,Bo=js.z;var Xv=dt;Ue=Xv.x,bv=Xv.y,ze=Xv.z;var Oe,er,dn;Oe=Ue-jo,er=bv-wi,dn=ze-Bo;var vn=Oe*Oe+er*er+dn*dn,ln=Oe*jo+er*wi+dn*Bo;ln=-ln/vn;var B_;if(ln<0){var fv=v;fv.x=jo,fv.y=wi,fv.z=Bo,B_=1}else if(ln>1){var ie=v;ie.x=Ue,ie.y=bv,ie.z=ze,B_=2}else{var Pe,b_,O_;Pe=jo+Oe*ln,b_=wi+er*ln,O_=Bo+dn*ln;var uv=v;uv.x=Pe,uv.y=b_,uv.z=O_,B_=3}var xv=v.x*v.x+v.y*v.y+v.z*v.z;Zr=B_,fo=xv;var f_=v;ss=f_.x,_s=f_.y,Me=f_.z}if(Hs<0){var He,zo,vs,ls,Wr,mo,vo=dt;He=vo.x,zo=vo.y,vs=vo.z;var hs=ur;ls=hs.x,Wr=hs.y,mo=hs.z;var Ys,Zs,ds;Ys=ls-He,Zs=Wr-zo,ds=mo-vs;var S_=Ys*Ys+Zs*Zs+ds*ds,me=Ys*He+Zs*zo+ds*vs;me=-me/S_;var cs;if(me<0){var H_=v;H_.x=He,H_.y=zo,H_.z=vs,cs=1}else if(me>1){var Ks=v;Ks.x=ls,Ks.y=Wr,Ks.z=mo,cs=2}else{var Un,pe,Lv;Un=He+Ys*me,pe=zo+Zs*me,Lv=vs+ds*me;var A_=v;A_.x=Un,A_.y=pe,A_.z=Lv,cs=3}var Ko=v.x*v.x+v.y*v.y+v.z*v.z;if(fo<0||Ko<fo){Zr=cs<<1,fo=Ko;var hn=v;ss=hn.x,_s=hn.y,Me=hn.z}}if(c_<0){var po,Ht,Ki,lo,qs,Bs,a_=qt;po=a_.x,Ht=a_.y,Ki=a_.z;var P_=ur;lo=P_.x,qs=P_.y,Bs=P_.z;var qo,oe,j_;qo=lo-po,oe=qs-Ht,j_=Bs-Ki;var Mv=qo*qo+oe*oe+j_*j_,dr=qo*po+oe*Ht+j_*Ki;dr=-dr/Mv;var yo;if(dr<0){var Ei=v;Ei.x=po,Ei.y=Ht,Ei.z=Ki,yo=1}else if(dr>1){var io=v;io.x=lo,io.y=qs,io.z=Bs,yo=2}else{var K_,q_,Yv;K_=po+qo*dr,q_=Ht+oe*dr,Yv=Ki+j_*dr;var t_=v;t_.x=K_,t_.y=q_,t_.z=Yv,yo=3}var Zv=v.x*v.x+v.y*v.y+v.z*v.z;if(fo<0||Zv<fo){Zr=yo&1|(yo&2)<<1,fo=Zv;var av=v;ss=av.x,_s=av.y,Me=av.z}}var Br;if(fo>0){var tv=v;tv.x=ss,tv.y=_s,tv.z=Me,Br=Zr}else{var Ss=re*re+Ft*Ft+ji*ji;Ss>0&&(Ss=1/Math.sqrt(Ss)),re*=Ss,Ft*=Ss,ji*=Ss;var As=qn*re+Ln*Ft+ns*ji,bs=re*re+Ft*Ft+ji*ji;bs=As/bs,ss=re*bs,_s=Ft*bs,Me=ji*bs;var fs=v;fs.x=ss,fs.y=_s,fs.z=Me,Br=7}var Ps=v.x*v.x+v.y*v.y+v.z*v.z;if(Ii<0||Ps<Ii){ys=Br&1|(Br&6)<<1,Ii=Ps;var dv=v;ui=dv.x,so=dv.y,Qn=dv.z}}if(Qe*jn<0){var ye,qi,r_,go,i_,Fo,Cs,an,ge,sr,tn,_i,ne,Ie,So,Di,Bn,rv,o_=qt;ye=o_.x,qi=o_.y,r_=o_.z;var C_=fr;go=C_.x,i_=C_.y,Fo=C_.z;var iv=ur;Cs=iv.x,an=iv.y,ge=iv.z,sr=go-ye,tn=i_-qi,_i=Fo-r_,ne=Cs-go,Ie=an-i_,So=ge-Fo,Di=ye-Cs,Bn=qi-an,rv=r_-ge;var ee,Sn,Ve;ee=tn*So-_i*Ie,Sn=_i*ne-sr*So,Ve=sr*Ie-tn*ne;var D0,m0,cl,N0,hi,On,Io,us,ov;D0=tn*Ve-_i*Sn,m0=_i*ee-sr*Ve,cl=sr*Sn-tn*ee,N0=Ie*Ve-So*Sn,hi=So*ee-ne*Ve,On=ne*Sn-Ie*ee,Io=Bn*Ve-rv*Sn,us=rv*ee-Di*Ve,ov=Di*Sn-Bn*ee;var zv=ye*D0+qi*m0+r_*cl,n_=go*N0+i_*hi+Fo*On,Bv=Cs*Io+an*us+ge*ov,Ts=-1,u_,x_,Sr,Rs=0;if(u_=0,x_=0,Sr=0,zv<0){var ho,Ce,mv,Qs,M_,nv,o0=qt;ho=o0.x,Ce=o0.y,mv=o0.z;var n0=fr;Qs=n0.x,M_=n0.y,nv=n0.z;var ev,ti,je;ev=Qs-ho,ti=M_-Ce,je=nv-mv;var An=ev*ev+ti*ti+je*je,xs=ev*ho+ti*Ce+je*mv;xs=-xs/An;var F0;if(xs<0){var Nv=v;Nv.x=ho,Nv.y=Ce,Nv.z=mv,F0=1}else if(xs>1){var T_=v;T_.x=Qs,T_.y=M_,T_.z=nv,F0=2}else{var p0,Sv,e0;p0=ho+ev*xs,Sv=Ce+ti*xs,e0=mv+je*xs;var y0=v;y0.x=p0,y0.y=Sv,y0.z=e0,F0=3}var G0=v.x*v.x+v.y*v.y+v.z*v.z;Rs=F0,Ts=G0;var s0=v;u_=s0.x,x_=s0.y,Sr=s0.z}if(n_<0){var _0,g0,Fv,ci,pv,cn,Gv=fr;_0=Gv.x,g0=Gv.y,Fv=Gv.z;var Hl=ur;ci=Hl.x,pv=Hl.y,cn=Hl.z;var I0,V0,bl;I0=ci-_0,V0=pv-g0,bl=cn-Fv;var Bl=I0*I0+V0*V0+bl*bl,Jv=I0*_0+V0*g0+bl*Fv;Jv=-Jv/Bl;var jl;if(Jv<0){var Kl=v;Kl.x=_0,Kl.y=g0,Kl.z=Fv,jl=1}else if(Jv>1){var fl=v;fl.x=ci,fl.y=pv,fl.z=cn,jl=2}else{var Sl,Al,ql;Sl=_0+I0*Jv,Al=g0+V0*Jv,ql=Fv+bl*Jv;var ul=v;ul.x=Sl,ul.y=Al,ul.z=ql,jl=3}var ah=v.x*v.x+v.y*v.y+v.z*v.z;if(Ts<0||ah<Ts){Rs=jl<<1,Ts=ah;var xl=v;u_=xl.x,x_=xl.y,Sr=xl.z}}if(Bv<0){var ii,Ms,rn,yv,gh,$v,J0=qt;ii=J0.x,Ms=J0.y,rn=J0.z;var Ml=ur;yv=Ml.x,gh=Ml.y,$v=Ml.z;var w0,k0,$0;w0=yv-ii,k0=gh-Ms,$0=$v-rn;var zi=w0*w0+k0*k0+$0*$0,zs=w0*ii+k0*Ms+$0*rn;zs=-zs/zi;var se;if(zs<0){var v0=v;v0.x=ii,v0.y=Ms,v0.z=rn,se=1}else if(zs>1){var Pl=v;Pl.x=yv,Pl.y=gh,Pl.z=$v,se=2}else{var hh,W0,ch;hh=ii+w0*zs,W0=Ms+k0*zs,ch=rn+$0*zs;var U0=v;U0.x=hh,U0.y=W0,U0.z=ch,se=3}var Cl=v.x*v.x+v.y*v.y+v.z*v.z;if(Ts<0||Cl<Ts){Rs=se&1|(se&2)<<1,Ts=Cl;var zl=v;u_=zl.x,x_=zl.y,Sr=zl.z}}var Te;if(Ts>0){var X0=v;X0.x=u_,X0.y=x_,X0.z=Sr,Te=Rs}else{var z_=ee*ee+Sn*Sn+Ve*Ve;z_>0&&(z_=1/Math.sqrt(z_)),ee*=z_,Sn*=z_,Ve*=z_;var Tl=ye*ee+qi*Sn+r_*Ve,O0=ee*ee+Sn*Sn+Ve*Ve;O0=Tl/O0,u_=ee*O0,x_=Sn*O0,Sr=Ve*O0;var H0=v;H0.x=u_,H0.y=x_,H0.z=Sr,Te=7}var Rl=v.x*v.x+v.y*v.y+v.z*v.z;if(Ii<0||Rl<Ii){ys=Te&3|(Te&4)<<1,Ii=Rl;var ml=v;ui=ml.x,so=ml.y,Qn=ml.z}}if(Vr*jn<0){var L0,l0,m_,Wv,Uv,sv,Y0,Av,h0,_e,c0,Z0,Es,j0,yr,bn,ki,Ov,b0=fr;L0=b0.x,l0=b0.y,m_=b0.z;var bh=dt;Wv=bh.x,Uv=bh.y,sv=bh.z;var th=ur;Y0=th.x,Av=th.y,h0=th.z,_e=Wv-L0,c0=Uv-l0,Z0=sv-m_,Es=Y0-Wv,j0=Av-Uv,yr=h0-sv,bn=L0-Y0,ki=l0-Av,Ov=m_-h0;var p_,Ke,Ds;p_=c0*yr-Z0*j0,Ke=Z0*Es-_e*yr,Ds=_e*j0-c0*Es;var rh,fh,Ql,bi,e_,fn,gv,K0,Iv;rh=c0*Ds-Z0*Ke,fh=Z0*p_-_e*Ds,Ql=_e*Ke-c0*p_,bi=j0*Ds-yr*Ke,e_=yr*p_-Es*Ds,fn=Es*Ke-j0*p_,gv=ki*Ds-Ov*Ke,K0=Ov*p_-bn*Ds,Iv=bn*Ke-ki*p_;var pl=L0*rh+l0*fh+m_*Ql,yl=Wv*bi+Uv*e_+sv*fn,gl=Y0*gv+Av*K0+h0*Iv,R_=-1,Pv,Pn,Vv,Cv=0;if(Pv=0,Pn=0,Vv=0,pl<0){var Q_,ve,E_,Tv,Hv,oi,y_=fr;Q_=y_.x,ve=y_.y,E_=y_.z;var le=dt;Tv=le.x,Hv=le.y,oi=le.z;var Jr,g_,Cn;Jr=Tv-Q_,g_=Hv-ve,Cn=oi-E_;var q0=Jr*Jr+g_*g_+Cn*Cn,f0=Jr*Q_+g_*ve+Cn*E_;f0=-f0/q0;var uh;if(f0<0){var al=v;al.x=Q_,al.y=ve,al.z=E_,uh=1}else if(f0>1){var tl=v;tl.x=Tv,tl.y=Hv,tl.z=oi,uh=2}else{var Il,d0,xh;Il=Q_+Jr*f0,d0=ve+g_*f0,xh=E_+Cn*f0;var Vl=v;Vl.x=Il,Vl.y=d0,Vl.z=xh,uh=3}var Ih=v.x*v.x+v.y*v.y+v.z*v.z;Cv=uh,R_=Ih;var ih=v;Pv=ih.x,Pn=ih.y,Vv=ih.z}if(yl<0){var wl,B0,S0,kl,oh,jv,El=dt;wl=El.x,B0=El.y,S0=El.z;var Kv=ur;kl=Kv.x,oh=Kv.y,jv=Kv.z;var ni,I_,on;ni=kl-wl,I_=oh-B0,on=jv-S0;var Xl=ni*ni+I_*I_+on*on,A0=ni*wl+I_*B0+on*S0;A0=-A0/Xl;var nh;if(A0<0){var Dl=v;Dl.x=wl,Dl.y=B0,Dl.z=S0,nh=1}else if(A0>1){var rl=v;rl.x=kl,rl.y=oh,rl.z=jv,nh=2}else{var Nl,P0,eh;Nl=wl+ni*A0,P0=B0+I_*A0,eh=S0+on*A0;var sh=v;sh.x=Nl,sh.y=P0,sh.z=eh,nh=3}var Fl=v.x*v.x+v.y*v.y+v.z*v.z;if(R_<0||Fl<R_){Cv=nh<<1,R_=Fl;var Gl=v;Pv=Gl.x,Pn=Gl.y,Vv=Gl.z}}if(gl<0){var _v,Rv,qv,Ns,Mh,u0,Ll=fr;_v=Ll.x,Rv=Ll.y,qv=Ll.z;var Qv=ur;Ns=Qv.x,Mh=Qv.y,u0=Qv.z;var a0,Ev,x0;a0=Ns-_v,Ev=Mh-Rv,x0=u0-qv;var dh=a0*a0+Ev*Ev+x0*x0,C0=a0*_v+Ev*Rv+x0*qv;C0=-C0/dh;var t0;if(C0<0){var Jl=v;Jl.x=_v,Jl.y=Rv,Jl.z=qv,t0=1}else if(C0>1){var $l=v;$l.x=Ns,$l.y=Mh,$l.z=u0,t0=2}else{var zh,Dv,xi;zh=_v+a0*C0,Dv=Rv+Ev*C0,xi=qv+x0*C0;var we=v;we.x=zh,we.y=Dv,we.z=xi,t0=3}var he=v.x*v.x+v.y*v.y+v.z*v.z;if(R_<0||he<R_){Cv=t0&1|(t0&2)<<1,R_=he;var T0=v;Pv=T0.x,Pn=T0.y,Vv=T0.z}}var Wl;if(R_>0){var Fs=v;Fs.x=Pv,Fs.y=Pn,Fs.z=Vv,Wl=Cv}else{var M0=p_*p_+Ke*Ke+Ds*Ds;M0>0&&(M0=1/Math.sqrt(M0)),p_*=M0,Ke*=M0,Ds*=M0;var Yl=L0*p_+l0*Ke+m_*Ds,Ul=p_*p_+Ke*Ke+Ds*Ds;Ul=Yl/Ul,Pv=p_*Ul,Pn=Ke*Ul,Vv=Ds*Ul;var Ol=v;Ol.x=Pv,Ol.y=Pn,Ol.z=Vv,Wl=7}var Vh=v.x*v.x+v.y*v.y+v.z*v.z;if(Ii<0||Vh<Ii){ys=Wl<<1,Ii=Vh;var vv=v;ui=vv.x,so=vv.y,Qn=vv.z}}if(Ii>0){var lv=v;lv.x=ui,lv.y=so,lv.z=Qn,C=ys}else v.zero(),C=15;break}if(this.shrinkSimplex(C),v.x*v.x+v.y*v.y+v.z*v.z<R){if(L==0||this.simplexSize==4)return _.fraction=L,!1;this.interpolateClosestPoints(),_.fraction=L;var R0=_.normal;R0.x=e.x,R0.y=e.y,R0.z=e.z;var V_=R0,Zl=Math.sqrt(V_.x*V_.x+V_.y*V_.y+V_.z*V_.z);Zl>0&&(Zl=1/Zl);var wh=V_.x*Zl,Bh=V_.y*Zl,r0=V_.z*Zl;V_.x=wh,V_.y=Bh,V_.z=r0;var hv=_.position,kh=this.closestPoint1;hv.x=kh.x,hv.y=kh.y,hv.z=kh.z;var dl=hv,Xh=dl.x+o.x*L,jh=dl.y+o.y*L,_h=dl.z+o.z*L;return dl.x=Xh,dl.y=jh,dl.z=_h,!0}e.x=v.x,e.y=v.y,e.z=v.z;var Er=e,s_=-Er.x,w_=-Er.y,vh=-Er.z;if(Er.x=s_,Er.y=w_,Er.z=vh,this.c1!=null)this.computeWitnessPoint1(!0);else{var Sh=this.w1[this.simplexSize];Sh.x=this.tf1._positionX,Sh.y=this.tf1._positionY,Sh.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);var Ah=this.s[this.simplexSize],mh=this.w1[this.simplexSize];Ah.x=mh.x,Ah.y=mh.y,Ah.z=mh.z;var wv=Ah,Qh=this.w2[this.simplexSize],Eh=wv.x-Qh.x,Kh=wv.y-Qh.y,qh=wv.z-Qh.z;wv.x=Eh,wv.y=Kh,wv.z=qh;var ph=h[this.simplexSize],Ph=ph.x-p.x,il=ph.y-p.y,ic=ph.z-p.z;if(ph.x=Ph,ph.y=il,ph.z=ic,e.x*e.x+e.y*e.y+e.z*e.z<R)throw new Error("!?");var Lh=h[this.simplexSize],D_=e,Dh=Lh.x*D_.x+Lh.y*D_.y+Lh.z*D_.z;if(Dh<0){if(g.x*D_.x+g.y*D_.y+g.z*D_.z>=0)return!1;var yh=Dh/(g.x*D_.x+g.y*D_.y+g.z*D_.z);if(L+=yh,L>=1)return!1;var ac=p.x+g.x*yh,Yh=p.y+g.y*yh,tc=p.z+g.z*yh;p.x=ac,p.y=Yh,p.z=tc;for(var Ch=0,Q0=this.simplexSize+1;Ch<Q0;){var oc=Ch++,lh=h[oc],Zh=-yh,Nh=lh.x+g.x*Zh,Th=lh.y+g.y*Zh,E0=lh.z+g.z*Zh;lh.x=Nh,lh.y=Th,lh.z=E0}}for(var z0=!1,ec=0,sc=this.simplexSize;ec<sc;){var Fh=ec++,nc=h[Fh].x-h[this.simplexSize].x,rc=h[Fh].y-h[this.simplexSize].y,ol=h[Fh].z-h[this.simplexSize].z;if(nc*nc+rc*rc+ol*ol<R){z0=!0;break}}z0||this.simplexSize++,++w}return!1}interpolateClosestPoints(){switch(this.simplexSize){case 1:var a=this.closestPoint1,t=this.w1[0];a.x=t.x,a.y=t.y,a.z=t.z;var r=this.closestPoint2,i=this.w2[0];r.x=i.x,r.y=i.y,r.z=i.z;break;case 2:var o,s,_,h=this.closest;o=h.x,s=h.y,_=h.z;var v,e,l,u,b,f,n,c,M,m,y,V,z,I,w,X,L,p,g=this.s[0];v=g.x,e=g.y,l=g.z;var F=this.w1[0];u=F.x,b=F.y,f=F.z;var S=this.w2[0];n=S.x,c=S.y,M=S.z;var N=this.s[1];m=N.x,y=N.y,V=N.z;var A=this.w1[1];z=A.x,I=A.y,w=A.z;var Y=this.w2[1];X=Y.x,L=Y.y,p=Y.z;var R=this.s[2];R.x,R.y,R.z;var C=this.w1[2];C.x,C.y,C.z;var d=this.w2[2];d.x,d.y,d.z;var Z,j,H;Z=m-v,j=y-e,H=V-l;var E=Z*Z+j*j+H*H;E!=0&&(E=1/E);var G,B,Q;G=o-v,B=s-e,Q=_-l;var W=(G*Z+B*j+Q*H)*E,J,D,O,K,ra,sa,$,q,na;J=z-u,D=I-b,O=w-f,K=u+J*W,ra=b+D*W,sa=f+O*W,J=X-n,D=L-c,O=p-M,$=n+J*W,q=c+D*W,na=M+O*W;var oa=this.closestPoint1;oa.x=K,oa.y=ra,oa.z=sa;var aa=this.closestPoint2;aa.x=$,aa.y=q,aa.z=na;break;case 3:var T,ca,_a,k=this.closest;T=k.x,ca=k.y,_a=k.z;var ta,ia,la,va,xa,Ma,za,Xa,Za,fa,ba,ea,ha,pa,ya,da,ma,Ya,Qa,ga,ua,ka,wa,Pa,Mt,Oa,Ba,nt=this.s[0];ta=nt.x,ia=nt.y,la=nt.z;var Ea=this.w1[0];va=Ea.x,xa=Ea.y,Ma=Ea.z;var Na=this.w2[0];za=Na.x,Xa=Na.y,Za=Na.z;var Sa=this.s[1];fa=Sa.x,ba=Sa.y,ea=Sa.z;var ft=this.w1[1];ha=ft.x,pa=ft.y,ya=ft.z;var Wa=this.w2[1];da=Wa.x,ma=Wa.y,Ya=Wa.z;var Ha=this.s[2];Qa=Ha.x,ga=Ha.y,ua=Ha.z;var bt=this.w1[2];ka=bt.x,wa=bt.y,Pa=bt.z;var rt=this.w2[2];Mt=rt.x,Oa=rt.y,Ba=rt.z;var ja,_t,gt,mt,Ja,it,ut,Da,Ta;ja=fa-ta,_t=ba-ia,gt=ea-la,mt=Qa-ta,Ja=ga-ia,it=ua-la,ut=T-ta,Da=ca-ia,Ta=_a-la;var Fa=ja*ja+_t*_t+gt*gt,Vt=ja*mt+_t*Ja+gt*it,Pt=mt*mt+Ja*Ja+it*it,et=ja*ut+_t*Da+gt*Ta,Xt=mt*ut+Ja*Da+it*Ta,Yt=Fa*Pt-Vt*Vt;Yt!=0&&(Yt=1/Yt);var zt=(et*Pt-Xt*Vt)*Yt,Ia=(-et*Vt+Xt*Fa)*Yt,U,Va,lt,P,kt,Bt,St,yt,wt;U=ha-va,Va=pa-xa,lt=ya-Ma,P=va+U*zt,kt=xa+Va*zt,Bt=Ma+lt*zt,U=ka-va,Va=wa-xa,lt=Pa-Ma,P+=U*Ia,kt+=Va*Ia,Bt+=lt*Ia,U=da-za,Va=ma-Xa,lt=Ya-Za,St=za+U*zt,yt=Xa+Va*zt,wt=Za+lt*zt,U=Mt-za,Va=Oa-Xa,lt=Ba-Za,St+=U*Ia,yt+=Va*Ia,wt+=lt*Ia;var pt=this.closestPoint1;pt.x=P,pt.y=kt,pt.z=Bt;var ht=this.closestPoint2;ht.x=St,ht.y=yt,ht.z=wt;break;default:throw new Error("!?")}}loadCache(a){var t=this.dir,r=a.prevClosestDir;t.x=r.x,t.y=r.y,t.z=r.z}saveCache(a){var t=a.prevClosestDir,r=this.closest;t.x=r.x,t.y=r.y,t.z=r.z;var i=t,o=-i.x,s=-i.y,_=-i.z;i.x=o,i.y=s,i.z=_}shrinkSimplex(a){switch(this.simplexSize=a,this.simplexSize=(this.simplexSize&5)+(this.simplexSize>>1&5),this.simplexSize=(this.simplexSize&3)+(this.simplexSize>>2&3),a){case 2:var t=this.s[0],r=this.s[1];t.x=r.x,t.y=r.y,t.z=r.z;var i=this.w1[0],o=this.w1[1];i.x=o.x,i.y=o.y,i.z=o.z;var s=this.w2[0],_=this.w2[1];s.x=_.x,s.y=_.y,s.z=_.z;break;case 4:var h=this.s[0],v=this.s[2];h.x=v.x,h.y=v.y,h.z=v.z;var e=this.w1[0],l=this.w1[2];e.x=l.x,e.y=l.y,e.z=l.z;var u=this.w2[0],b=this.w2[2];u.x=b.x,u.y=b.y,u.z=b.z;break;case 5:var f=this.s[1],n=this.s[2];f.x=n.x,f.y=n.y,f.z=n.z;var c=this.w1[1],M=this.w1[2];c.x=M.x,c.y=M.y,c.z=M.z;var m=this.w2[1],y=this.w2[2];m.x=y.x,m.y=y.y,m.z=y.z;break;case 6:var V=this.s[0],z=this.s[2];V.x=z.x,V.y=z.y,V.z=z.z;var I=this.w1[0],w=this.w1[2];I.x=w.x,I.y=w.y,I.z=w.z;var X=this.w2[0],L=this.w2[2];X.x=L.x,X.y=L.y,X.z=L.z;break;case 8:var p=this.s[0],g=this.s[3];p.x=g.x,p.y=g.y,p.z=g.z;var F=this.w1[0],S=this.w1[3];F.x=S.x,F.y=S.y,F.z=S.z;var N=this.w2[0],A=this.w2[3];N.x=A.x,N.y=A.y,N.z=A.z;break;case 9:var Y=this.s[1],R=this.s[3];Y.x=R.x,Y.y=R.y,Y.z=R.z;var C=this.w1[1],d=this.w1[3];C.x=d.x,C.y=d.y,C.z=d.z;var Z=this.w2[1],j=this.w2[3];Z.x=j.x,Z.y=j.y,Z.z=j.z;break;case 10:var H=this.s[0],E=this.s[3];H.x=E.x,H.y=E.y,H.z=E.z;var G=this.w1[0],B=this.w1[3];G.x=B.x,G.y=B.y,G.z=B.z;var Q=this.w2[0],W=this.w2[3];Q.x=W.x,Q.y=W.y,Q.z=W.z;break;case 11:var J=this.s[2],D=this.s[3];J.x=D.x,J.y=D.y,J.z=D.z;var O=this.w1[2],K=this.w1[3];O.x=K.x,O.y=K.y,O.z=K.z;var ra=this.w2[2],sa=this.w2[3];ra.x=sa.x,ra.y=sa.y,ra.z=sa.z;break;case 12:var $=this.s[0],q=this.s[2];$.x=q.x,$.y=q.y,$.z=q.z;var na=this.w1[0],oa=this.w1[2];na.x=oa.x,na.y=oa.y,na.z=oa.z;var aa=this.w2[0],T=this.w2[2];aa.x=T.x,aa.y=T.y,aa.z=T.z;var ca=this.s[1],_a=this.s[3];ca.x=_a.x,ca.y=_a.y,ca.z=_a.z;var k=this.w1[1],ta=this.w1[3];k.x=ta.x,k.y=ta.y,k.z=ta.z;var ia=this.w2[1],la=this.w2[3];ia.x=la.x,ia.y=la.y,ia.z=la.z;break;case 13:var va=this.s[1],xa=this.s[3];va.x=xa.x,va.y=xa.y,va.z=xa.z;var Ma=this.w1[1],za=this.w1[3];Ma.x=za.x,Ma.y=za.y,Ma.z=za.z;var Xa=this.w2[1],Za=this.w2[3];Xa.x=Za.x,Xa.y=Za.y,Xa.z=Za.z;break;case 14:var fa=this.s[0],ba=this.s[3];fa.x=ba.x,fa.y=ba.y,fa.z=ba.z;var ea=this.w1[0],ha=this.w1[3];ea.x=ha.x,ea.y=ha.y,ea.z=ha.z;var pa=this.w2[0],ya=this.w2[3];pa.x=ya.x,pa.y=ya.y,pa.z=ya.z;break}}computeWitnessPoint1(a){var t,r,i,o,s,_,h=this.dir;o=h.x,s=h.y,_=h.z;var v,e,l,u,b,f;u=this.tf1._rotation00*o+this.tf1._rotation10*s+this.tf1._rotation20*_,b=this.tf1._rotation01*o+this.tf1._rotation11*s+this.tf1._rotation21*_,f=this.tf1._rotation02*o+this.tf1._rotation12*s+this.tf1._rotation22*_,v=u,e=b,l=f;var n,c,M,m=this.dir;if(m.x=v,m.y=e,m.z=l,this.c1.computeLocalSupportingVertex(this.dir,this.w1[this.simplexSize]),a){var y=this.dir,V=Math.sqrt(y.x*y.x+y.y*y.y+y.z*y.z);V>0&&(V=1/V);var z=y.x*V,I=y.y*V,w=y.z*V;y.x=z,y.y=I,y.z=w;var X=this.w1[this.simplexSize],L=this.dir,p=this.c1._gjkMargin,g=X.x+L.x*p,F=X.y+L.y*p,S=X.z+L.z*p;X.x=g,X.y=F,X.z=S}var N=this.w1[this.simplexSize];t=N.x,r=N.y,i=N.z;var A,Y,R;A=this.tf1._rotation00*t+this.tf1._rotation01*r+this.tf1._rotation02*i,Y=this.tf1._rotation10*t+this.tf1._rotation11*r+this.tf1._rotation12*i,R=this.tf1._rotation20*t+this.tf1._rotation21*r+this.tf1._rotation22*i,n=A,c=Y,M=R,n+=this.tf1._positionX,c+=this.tf1._positionY,M+=this.tf1._positionZ;var C=this.w1[this.simplexSize];C.x=n,C.y=c,C.z=M;var d=this.dir;d.x=o,d.y=s,d.z=_}computeWitnessPoint2(a){var t,r,i,o,s,_,h=this.dir;o=h.x,s=h.y,_=h.z;var v,e,l,u,b,f;u=this.tf2._rotation00*o+this.tf2._rotation10*s+this.tf2._rotation20*_,b=this.tf2._rotation01*o+this.tf2._rotation11*s+this.tf2._rotation21*_,f=this.tf2._rotation02*o+this.tf2._rotation12*s+this.tf2._rotation22*_,v=u,e=b,l=f,v=-v,e=-e,l=-l;var n,c,M,m=this.dir;if(m.x=v,m.y=e,m.z=l,this.c2.computeLocalSupportingVertex(this.dir,this.w2[this.simplexSize]),a){var y=this.dir,V=Math.sqrt(y.x*y.x+y.y*y.y+y.z*y.z);V>0&&(V=1/V);var z=y.x*V,I=y.y*V,w=y.z*V;y.x=z,y.y=I,y.z=w;var X=this.w2[this.simplexSize],L=this.dir,p=this.c2._gjkMargin,g=X.x+L.x*p,F=X.y+L.y*p,S=X.z+L.z*p;X.x=g,X.y=F,X.z=S}var N=this.w2[this.simplexSize];t=N.x,r=N.y,i=N.z;var A,Y,R;A=this.tf2._rotation00*t+this.tf2._rotation01*r+this.tf2._rotation02*i,Y=this.tf2._rotation10*t+this.tf2._rotation11*r+this.tf2._rotation12*i,R=this.tf2._rotation20*t+this.tf2._rotation21*r+this.tf2._rotation22*i,n=A,c=Y,M=R,n+=this.tf2._positionX,c+=this.tf2._positionY,M+=this.tf2._positionZ;var C=this.w2[this.simplexSize];C.x=n,C.y=c,C.z=M;var d=this.dir;d.x=o,d.y=s,d.z=_}pointToTetrahedron(){for(var a=0;a<3;){var t=a++,r=this.dir,i=this.baseDirs[t];r.x=i.x,r.y=i.y,r.z=i.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var o=this.s[this.simplexSize],s=this.w1[this.simplexSize];o.x=s.x,o.y=s.y,o.z=s.z;var _=o,h=this.w2[this.simplexSize],v=_.x-h.x,e=_.y-h.y,l=_.z-h.z;if(_.x=v,_.y=e,_.z=l,this.simplexSize++,this.lineToTetrahedron(),this.simplexSize==4)break;this.simplexSize--;var u=this.dir,b=-u.x,f=-u.y,n=-u.z;u.x=b,u.y=f,u.z=n,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var c=this.s[this.simplexSize],M=this.w1[this.simplexSize];c.x=M.x,c.y=M.y,c.z=M.z;var m=c,y=this.w2[this.simplexSize],V=m.x-y.x,z=m.y-y.y,I=m.z-y.z;if(m.x=V,m.y=z,m.z=I,this.simplexSize++,this.lineToTetrahedron(),this.simplexSize==4)break;this.simplexSize--}}lineToTetrahedron(){var a,t,r,i=this.dir;a=i.x,t=i.y,r=i.z;var o,s,_,h,v,e,l,u,b,f=this.s[0];o=f.x,s=f.y,_=f.z;var n=this.s[1];h=n.x,v=n.y,e=n.z,l=o-h,u=s-v,b=_-e;for(var c=0;c<3;){var M=c++,m,y,V,z=this.baseDirs[M];m=z.x,y=z.y,V=z.z;var I,w,X;I=u*V-b*y,w=b*m-l*V,X=l*y-u*m;var L=this.dir;L.x=I,L.y=w,L.z=X,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var p=this.s[this.simplexSize],g=this.w1[this.simplexSize];p.x=g.x,p.y=g.y,p.z=g.z;var F=p,S=this.w2[this.simplexSize],N=F.x-S.x,A=F.y-S.y,Y=F.z-S.z;if(F.x=N,F.y=A,F.z=Y,this.simplexSize++,this.triangleToTetrahedron(),this.simplexSize==4)break;this.simplexSize--;var R=this.dir,C=-R.x,d=-R.y,Z=-R.z;R.x=C,R.y=d,R.z=Z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var j=this.s[this.simplexSize],H=this.w1[this.simplexSize];j.x=H.x,j.y=H.y,j.z=H.z;var E=j,G=this.w2[this.simplexSize],B=E.x-G.x,Q=E.y-G.y,W=E.z-G.z;if(E.x=B,E.y=Q,E.z=W,this.simplexSize++,this.triangleToTetrahedron(),this.simplexSize==4)break;this.simplexSize--}var J=this.dir;J.x=a,J.y=t,J.z=r}triangleToTetrahedron(){var a,t,r,i=this.dir;for(a=i.x,t=i.y,r=i.z;;){var o,s,_,h,v,e,l,u,b,f,n,c,M,m,y,V=this.s[0];o=V.x,s=V.y,_=V.z;var z=this.s[1];h=z.x,v=z.y,e=z.z;var I=this.s[2];l=I.x,u=I.y,b=I.z,f=h-o,n=v-s,c=e-_,M=l-o,m=u-s,y=b-_;var w,X,L;w=n*y-c*m,X=c*M-f*y,L=f*m-n*M;var p=this.dir;p.x=w,p.y=X,p.z=L,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var g=this.s[this.simplexSize],F=this.w1[this.simplexSize];g.x=F.x,g.y=F.y,g.z=F.z;var S=g,N=this.w2[this.simplexSize],A=S.x-N.x,Y=S.y-N.y,R=S.z-N.z;if(S.x=A,S.y=Y,S.z=R,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;var C=this.dir,d=-C.x,Z=-C.y,j=-C.z;C.x=d,C.y=Z,C.z=j,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var H=this.s[this.simplexSize],E=this.w1[this.simplexSize];H.x=E.x,H.y=E.y,H.z=E.z;var G=H,B=this.w2[this.simplexSize],Q=G.x-B.x,W=G.y-B.y,J=G.z-B.z;if(G.x=Q,G.y=W,G.z=J,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;break}var D=this.dir;D.x=a,D.y=t,D.z=r}isValidTetrahedron(){var a=this.s[1].x-this.s[0].x,t=this.s[1].y-this.s[0].y,r=this.s[1].z-this.s[0].z,i=this.s[2].x-this.s[0].x,o=this.s[2].y-this.s[0].y,s=this.s[2].z-this.s[0].z,_=this.s[3].x-this.s[0].x,h=this.s[3].y-this.s[0].y,v=this.s[3].z-this.s[0].z,e=a*(o*v-s*h)-t*(i*v-s*_)+r*(i*h-o*_);return e>1e-12?!0:e<-1e-12}computeDepth(a,t,r,i,o,s,_){for(var h=this.polyhedron;h._numTriangles>0;){var v=h._triangleList;h._numTriangles--;var e=v._prev,l=v._next;e!=null&&(e._next=l),l!=null&&(l._prev=e),v==h._triangleList&&(h._triangleList=h._triangleList._next),v==h._triangleListLast&&(h._triangleListLast=h._triangleListLast._prev),v._next=null,v._prev=null,v.removeReferences(),v._next=h._trianglePool,h._trianglePool=v}for(;h._numVertices>0;){var u=h._vertices[--h._numVertices];u.removeReferences(),u._next=h._vertexPool,h._vertexPool=u}var b=this.polyhedron,f=this.polyhedron,n=f._vertexPool;n!=null?(f._vertexPool=n._next,n._next=null):n=new x.collision.narrowphase.detector.gjkepa.EpaVertex;var c=n.init(o[0],s[0],_[0]),M=this.polyhedron,m=M._vertexPool;m!=null?(M._vertexPool=m._next,m._next=null):m=new x.collision.narrowphase.detector.gjkepa.EpaVertex;var y=m.init(o[1],s[1],_[1]),V=this.polyhedron,z=V._vertexPool;z!=null?(V._vertexPool=z._next,z._next=null):z=new x.collision.narrowphase.detector.gjkepa.EpaVertex;var I=z.init(o[2],s[2],_[2]),w=this.polyhedron,X=w._vertexPool;if(X!=null?(w._vertexPool=X._next,X._next=null):X=new x.collision.narrowphase.detector.gjkepa.EpaVertex,!b._init(c,y,I,X.init(o[3],s[3],_[3])))return x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT;this.simplexSize=0;for(var L=this.s[0],p=this.w1[0],g=this.w2[0],F=0,S=40;F<S;){for(var N=this.polyhedron._triangleList,A=1/0,Y=null;N!=null;){var R=N._next;N._distanceSq<A&&(A=N._distanceSq,Y=N),N=R}var C=Y,d=this.dir,Z=C._normal;d.x=Z.x,d.y=Z.y,d.z=Z.z;var j=d,H=Math.sqrt(j.x*j.x+j.y*j.y+j.z*j.z);H>0&&(H=1/H);var E=j.x*H,G=j.y*H,B=j.z*H;j.x=E,j.y=G,j.z=B,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var Q=this.s[this.simplexSize],W=this.w1[this.simplexSize];Q.x=W.x,Q.y=W.y,Q.z=W.z;var J=Q,D=this.w2[this.simplexSize],O=J.x-D.x,K=J.y-D.y,ra=J.z-D.z;J.x=O,J.y=K,J.z=ra;var sa=C._vertices[0],$=C._vertices[1],q=C._vertices[2],na=sa.v,oa=this.dir,aa=na.x*oa.x+na.y*oa.y+na.z*oa.z,T=this.dir,ca=L.x*T.x+L.y*T.y+L.z*T.z;if(ca-aa<1e-6||F==S-1){var _a=this.closest,k=this.dir;_a.x=k.x,_a.y=k.y,_a.z=k.z;var ta=_a,ia=this.dir,la=sa.v,va=this.dir,xa=(ia.x*la.x+ia.y*la.y+ia.z*la.z)/(va.x*va.x+va.y*va.y+va.z*va.z),Ma=ta.x*xa,za=ta.y*xa,Xa=ta.z*xa;ta.x=Ma,ta.y=za,ta.z=Xa;var Za,fa,ba,ea=this.closest;Za=ea.x,fa=ea.y,ba=ea.z;var ha,pa,ya,da,ma,Ya,Qa,ga,ua,ka,wa,Pa,Mt,Oa,Ba,nt,Ea,Na,Sa,ft,Wa,Ha,bt,rt,ja,_t,gt,mt=sa.v;ha=mt.x,pa=mt.y,ya=mt.z;var Ja=sa.w1;da=Ja.x,ma=Ja.y,Ya=Ja.z;var it=sa.w2;Qa=it.x,ga=it.y,ua=it.z;var ut=$.v;ka=ut.x,wa=ut.y,Pa=ut.z;var Da=$.w1;Mt=Da.x,Oa=Da.y,Ba=Da.z;var Ta=$.w2;nt=Ta.x,Ea=Ta.y,Na=Ta.z;var Fa=q.v;Sa=Fa.x,ft=Fa.y,Wa=Fa.z;var Vt=q.w1;Ha=Vt.x,bt=Vt.y,rt=Vt.z;var Pt=q.w2;ja=Pt.x,_t=Pt.y,gt=Pt.z;var et,Xt,Yt,zt,Ia,U,Va,lt,P;et=ka-ha,Xt=wa-pa,Yt=Pa-ya,zt=Sa-ha,Ia=ft-pa,U=Wa-ya,Va=Za-ha,lt=fa-pa,P=ba-ya;var kt=et*et+Xt*Xt+Yt*Yt,Bt=et*zt+Xt*Ia+Yt*U,St=zt*zt+Ia*Ia+U*U,yt=et*Va+Xt*lt+Yt*P,wt=zt*Va+Ia*lt+U*P,pt=kt*St-Bt*Bt;pt!=0&&(pt=1/pt);var ht=(yt*St-wt*Bt)*pt,xt=(-yt*Bt+wt*kt)*pt,Ra,st,Ca,vt,qa,at,Ua,tt,ct;Ra=Mt-da,st=Oa-ma,Ca=Ba-Ya,vt=da+Ra*ht,qa=ma+st*ht,at=Ya+Ca*ht,Ra=Ha-da,st=bt-ma,Ca=rt-Ya,vt+=Ra*xt,qa+=st*xt,at+=Ca*xt,Ra=nt-Qa,st=Ea-ga,Ca=Na-ua,Ua=Qa+Ra*ht,tt=ga+st*ht,ct=ua+Ca*ht,Ra=ja-Qa,st=_t-ga,Ca=gt-ua,Ua+=Ra*xt,tt+=st*xt,ct+=Ca*xt;var Aa=this.closestPoint1;Aa.x=vt,Aa.y=qa,Aa.z=at;var Ga=this.closestPoint2;Ga.x=Ua,Ga.y=tt,Ga.z=ct;var Ka=this.closest;return this.depth=Math.sqrt(Ka.x*Ka.x+Ka.y*Ka.y+Ka.z*Ka.z),x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED}var La=this.polyhedron,ot=La._vertexPool;ot!=null?(La._vertexPool=ot._next,ot._next=null):ot=new x.collision.narrowphase.detector.gjkepa.EpaVertex;var It=ot.init(L,p,g);if(!this.polyhedron._addVertex(It,C))return x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX;++F}return x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE}computeClosestPoints(a,t,r,i,o){return this.computeClosestPointsImpl(a,t,r,i,o,!0)}computeDistance(a,t,r,i,o){return this.computeClosestPointsImpl(a,t,r,i,o,!1)}convexCast(a,t,r,i,o,s,_){return this.convexCastImpl(a,t,r,i,o,s,_)}rayCast(a,t,r,i,o){var s=this.tempTransform,_=t,h=r;s._positionX=h.x,s._positionY=h.y,s._positionZ=h.z;var v=this.tl1,e=this.tl2;v.x=i.x,v.y=i.y,v.z=i.z;var l=v,u=l.x-r.x,b=l.y-r.y,f=l.z-r.z;return l.x=u,l.y=b,l.z=f,e.zero(),this.convexCastImpl(null,a,s,_,v,e,o)}static getInstance(){return x.collision.narrowphase.detector.gjkepa.GjkEpa.instance}};x.collision.narrowphase.detector.gjkepa.GjkEpaLog=class{};x.collision.narrowphase.detector.gjkepa.GjkEpaResultState=class{};x.collision.narrowphase.detector.gjkepa.SimplexUtil=class{static projectOrigin2(a,t,r){var i,o,s,_,h,v,e=a;i=e.x,o=e.y,s=e.z;var l=t;_=l.x,h=l.y,v=l.z;var u,b,f;u=_-i,b=h-o,f=v-s;var n=u*u+b*b+f*f,c=u*i+b*o+f*s;if(c=-c/n,c<0){var M=r;return M.x=i,M.y=o,M.z=s,1}if(c>1){var m=r;return m.x=_,m.y=h,m.z=v,2}var y,V,z;y=i+u*c,V=o+b*c,z=s+f*c;var I=r;return I.x=y,I.y=V,I.z=z,3}static projectOrigin3(a,t,r,i){var o,s,_,h,v,e,l,u,b,f,n,c,M,m,y,V,z,I,w=a;o=w.x,s=w.y,_=w.z;var X=t;h=X.x,v=X.y,e=X.z;var L=r;l=L.x,u=L.y,b=L.z,f=h-o,n=v-s,c=e-_,M=l-h,m=u-v,y=b-e,V=o-l,z=s-u,I=_-b;var p,g,F;p=n*y-c*m,g=c*M-f*y,F=f*m-n*M;var S,N,A,Y,R,C,d,Z,j;S=n*F-c*g,N=c*p-f*F,A=f*g-n*p,Y=m*F-y*g,R=y*p-M*F,C=M*g-m*p,d=z*F-I*g,Z=I*p-V*F,j=V*g-z*p;var H=o*S+s*N+_*A,E=h*Y+v*R+e*C,G=l*d+u*Z+b*j,B=-1,Q,W,J,D=0;if(Q=0,W=0,J=0,H<0){var O,K,ra,sa,$,q,na=a;O=na.x,K=na.y,ra=na.z;var oa=t;sa=oa.x,$=oa.y,q=oa.z;var aa,T,ca;aa=sa-O,T=$-K,ca=q-ra;var _a=aa*aa+T*T+ca*ca,k=aa*O+T*K+ca*ra;k=-k/_a;var ta;if(k<0){var ia=i;ia.x=O,ia.y=K,ia.z=ra,ta=1}else if(k>1){var la=i;la.x=sa,la.y=$,la.z=q,ta=2}else{var va,xa,Ma;va=O+aa*k,xa=K+T*k,Ma=ra+ca*k;var za=i;za.x=va,za.y=xa,za.z=Ma,ta=3}var Xa=i.x*i.x+i.y*i.y+i.z*i.z;D=ta,B=Xa;var Za=i;Q=Za.x,W=Za.y,J=Za.z}if(E<0){var fa,ba,ea,ha,pa,ya,da=t;fa=da.x,ba=da.y,ea=da.z;var ma=r;ha=ma.x,pa=ma.y,ya=ma.z;var Ya,Qa,ga;Ya=ha-fa,Qa=pa-ba,ga=ya-ea;var ua=Ya*Ya+Qa*Qa+ga*ga,ka=Ya*fa+Qa*ba+ga*ea;ka=-ka/ua;var wa;if(ka<0){var Pa=i;Pa.x=fa,Pa.y=ba,Pa.z=ea,wa=1}else if(ka>1){var Mt=i;Mt.x=ha,Mt.y=pa,Mt.z=ya,wa=2}else{var Oa,Ba,nt;Oa=fa+Ya*ka,Ba=ba+Qa*ka,nt=ea+ga*ka;var Ea=i;Ea.x=Oa,Ea.y=Ba,Ea.z=nt,wa=3}var Na=i.x*i.x+i.y*i.y+i.z*i.z;if(B<0||Na<B){D=wa<<1,B=Na;var Sa=i;Q=Sa.x,W=Sa.y,J=Sa.z}}if(G<0){var ft,Wa,Ha,bt,rt,ja,_t=a;ft=_t.x,Wa=_t.y,Ha=_t.z;var gt=r;bt=gt.x,rt=gt.y,ja=gt.z;var mt,Ja,it;mt=bt-ft,Ja=rt-Wa,it=ja-Ha;var ut=mt*mt+Ja*Ja+it*it,Da=mt*ft+Ja*Wa+it*Ha;Da=-Da/ut;var Ta;if(Da<0){var Fa=i;Fa.x=ft,Fa.y=Wa,Fa.z=Ha,Ta=1}else if(Da>1){var Vt=i;Vt.x=bt,Vt.y=rt,Vt.z=ja,Ta=2}else{var Pt,et,Xt;Pt=ft+mt*Da,et=Wa+Ja*Da,Xt=Ha+it*Da;var Yt=i;Yt.x=Pt,Yt.y=et,Yt.z=Xt,Ta=3}var zt=i.x*i.x+i.y*i.y+i.z*i.z;if(B<0||zt<B){D=Ta&1|(Ta&2)<<1,B=zt;var Ia=i;Q=Ia.x,W=Ia.y,J=Ia.z}}if(B>0){var U=i;return U.x=Q,U.y=W,U.z=J,D}var Va=p*p+g*g+F*F;Va>0&&(Va=1/Math.sqrt(Va)),p*=Va,g*=Va,F*=Va;var lt=o*p+s*g+_*F,P=p*p+g*g+F*F;P=lt/P,Q=p*P,W=g*P,J=F*P;var kt=i;return kt.x=Q,kt.y=W,kt.z=J,7}static projectOrigin4(a,t,r,i,o){var s,_,h,v,e,l,u,b,f,n,c,M,m,y,V,z,I,w,X,L,p,g,F,S,N,A,Y,R=a;s=R.x,_=R.y,h=R.z;var C=t;v=C.x,e=C.y,l=C.z;var d=r;u=d.x,b=d.y,f=d.z;var Z=i;n=Z.x,c=Z.y,M=Z.z,m=v-s,y=e-_,V=l-h,z=u-s,I=b-_,w=f-h,X=n-s,L=c-_,p=M-h,g=u-v,F=b-e,S=f-l,N=n-v,A=c-e,Y=M-l;var j,H,E,G,B,Q,W,J,D,O,K,ra;j=y*w-V*I,H=V*z-m*w,E=m*I-y*z,G=I*p-w*L,B=w*X-z*p,Q=z*L-I*X,W=L*V-p*y,J=p*m-X*V,D=X*y-L*m,O=A*S-Y*F,K=Y*g-N*S,ra=N*F-A*g;var sa=m*O+y*K+V*ra>0?1:-1,$=s*j+_*H+h*E,q=s*G+_*B+h*Q,na=s*W+_*J+h*D,oa=v*O+e*K+l*ra,aa=-1,T,ca,_a,k=0;if(T=0,ca=0,_a=0,$*sa<0){var ta,ia,la,va,xa,Ma,za,Xa,Za,fa,ba,ea,ha,pa,ya,da,ma,Ya,Qa=a;ta=Qa.x,ia=Qa.y,la=Qa.z;var ga=t;va=ga.x,xa=ga.y,Ma=ga.z;var ua=r;za=ua.x,Xa=ua.y,Za=ua.z,fa=va-ta,ba=xa-ia,ea=Ma-la,ha=za-va,pa=Xa-xa,ya=Za-Ma,da=ta-za,ma=ia-Xa,Ya=la-Za;var ka,wa,Pa;ka=ba*ya-ea*pa,wa=ea*ha-fa*ya,Pa=fa*pa-ba*ha;var Mt,Oa,Ba,nt,Ea,Na,Sa,ft,Wa;Mt=ba*Pa-ea*wa,Oa=ea*ka-fa*Pa,Ba=fa*wa-ba*ka,nt=pa*Pa-ya*wa,Ea=ya*ka-ha*Pa,Na=ha*wa-pa*ka,Sa=ma*Pa-Ya*wa,ft=Ya*ka-da*Pa,Wa=da*wa-ma*ka;var Ha=ta*Mt+ia*Oa+la*Ba,bt=va*nt+xa*Ea+Ma*Na,rt=za*Sa+Xa*ft+Za*Wa,ja=-1,_t,gt,mt,Ja=0;if(_t=0,gt=0,mt=0,Ha<0){var it,ut,Da,Ta,Fa,Vt,Pt=a;it=Pt.x,ut=Pt.y,Da=Pt.z;var et=t;Ta=et.x,Fa=et.y,Vt=et.z;var Xt,Yt,zt;Xt=Ta-it,Yt=Fa-ut,zt=Vt-Da;var Ia=Xt*Xt+Yt*Yt+zt*zt,U=Xt*it+Yt*ut+zt*Da;U=-U/Ia;var Va;if(U<0){var lt=o;lt.x=it,lt.y=ut,lt.z=Da,Va=1}else if(U>1){var P=o;P.x=Ta,P.y=Fa,P.z=Vt,Va=2}else{var kt,Bt,St;kt=it+Xt*U,Bt=ut+Yt*U,St=Da+zt*U;var yt=o;yt.x=kt,yt.y=Bt,yt.z=St,Va=3}var wt=o.x*o.x+o.y*o.y+o.z*o.z;Ja=Va,ja=wt;var pt=o;_t=pt.x,gt=pt.y,mt=pt.z}if(bt<0){var ht,xt,Ra,st,Ca,vt,qa=t;ht=qa.x,xt=qa.y,Ra=qa.z;var at=r;st=at.x,Ca=at.y,vt=at.z;var Ua,tt,ct;Ua=st-ht,tt=Ca-xt,ct=vt-Ra;var Aa=Ua*Ua+tt*tt+ct*ct,Ga=Ua*ht+tt*xt+ct*Ra;Ga=-Ga/Aa;var Ka;if(Ga<0){var La=o;La.x=ht,La.y=xt,La.z=Ra,Ka=1}else if(Ga>1){var ot=o;ot.x=st,ot.y=Ca,ot.z=vt,Ka=2}else{var It,or,gr;It=ht+Ua*Ga,or=xt+tt*Ga,gr=Ra+ct*Ga;var ar=o;ar.x=It,ar.y=or,ar.z=gr,Ka=3}var Ct=o.x*o.x+o.y*o.y+o.z*o.z;if(ja<0||Ct<ja){Ja=Ka<<1,ja=Ct;var _r=o;_t=_r.x,gt=_r.y,mt=_r.z}}if(rt<0){var Et,At,Gt,Hr,vr,lr,tr=a;Et=tr.x,At=tr.y,Gt=tr.z;var Ur=r;Hr=Ur.x,vr=Ur.y,lr=Ur.z;var Xr,Mr,Zt;Xr=Hr-Et,Mr=vr-At,Zt=lr-Gt;var ir=Xr*Xr+Mr*Mr+Zt*Zt,$t=Xr*Et+Mr*At+Zt*Gt;$t=-$t/ir;var nr;if($t<0){var jr=o;jr.x=Et,jr.y=At,jr.z=Gt,nr=1}else if($t>1){var Wt=o;Wt.x=Hr,Wt.y=vr,Wt.z=lr,nr=2}else{var Kr,Ir,mi;Kr=Et+Xr*$t,Ir=At+Mr*$t,mi=Gt+Zt*$t;var $r=o;$r.x=Kr,$r.y=Ir,$r.z=mi,nr=3}var Lt=o.x*o.x+o.y*o.y+o.z*o.z;if(ja<0||Lt<ja){Ja=nr&1|(nr&2)<<1,ja=Lt;var Kt=o;_t=Kt.x,gt=Kt.y,mt=Kt.z}}var Tt;if(ja>0){var br=o;br.x=_t,br.y=gt,br.z=mt,Tt=Ja}else{var zr=ka*ka+wa*wa+Pa*Pa;zr>0&&(zr=1/Math.sqrt(zr)),ka*=zr,wa*=zr,Pa*=zr;var vi=ta*ka+ia*wa+la*Pa,qt=ka*ka+wa*wa+Pa*Pa;qt=vi/qt,_t=ka*qt,gt=wa*qt,mt=Pa*qt;var fr=o;fr.x=_t,fr.y=gt,fr.z=mt,Tt=7}var dt=o.x*o.x+o.y*o.y+o.z*o.z;k=Tt,aa=dt;var ur=o;T=ur.x,ca=ur.y,_a=ur.z}if(q*sa<0){var hr,ei,Xi,oo,Jt,fi,pi,Dt,Bi,Ar,Ni,Hn,no,Si,eo,gn,Ao,Vo,xr=a;hr=xr.x,ei=xr.y,Xi=xr.z;var ao=r;oo=ao.x,Jt=ao.y,fi=ao.z;var Ai=i;pi=Ai.x,Dt=Ai.y,Bi=Ai.z,Ar=oo-hr,Ni=Jt-ei,Hn=fi-Xi,no=pi-oo,Si=Dt-Jt,eo=Bi-fi,gn=hr-pi,Ao=ei-Dt,Vo=Xi-Bi;var yi,Po,Dr;yi=Ni*eo-Hn*Si,Po=Hn*no-Ar*eo,Dr=Ar*Si-Ni*no;var Pi,gi,Rt,Or,Lr,Tn,ms,qe,ps;Pi=Ni*Dr-Hn*Po,gi=Hn*yi-Ar*Dr,Rt=Ar*Po-Ni*yi,Or=Si*Dr-eo*Po,Lr=eo*yi-no*Dr,Tn=no*Po-Si*yi,ms=Ao*Dr-Vo*Po,qe=Vo*yi-gn*Dr,ps=gn*Po-Ao*yi;var Re=hr*Pi+ei*gi+Xi*Rt,as=oo*Or+Jt*Lr+fi*Tn,N_=pi*ms+Dt*qe+Bi*ps,In=-1,Pr,Go,Wi,ke=0;if(Pr=0,Go=0,Wi=0,Re<0){var nn,Rn,jn,Xe,k_,Qe,Vr=a;nn=Vr.x,Rn=Vr.y,jn=Vr.z;var Ii=r;Xe=Ii.x,k_=Ii.y,Qe=Ii.z;var ui,so,Qn;ui=Xe-nn,so=k_-Rn,Qn=Qe-jn;var ys=ui*ui+so*so+Qn*Qn,en=ui*nn+so*Rn+Qn*jn;en=-en/ys;var En;if(en<0){var cr=o;cr.x=nn,cr.y=Rn,cr.z=jn,En=1}else if(en>1){var co=o;co.x=Xe,co.y=k_,co.z=Qe,En=2}else{var Fi,Dn,ts;Fi=nn+ui*en,Dn=Rn+so*en,ts=jn+Qn*en;var Ee=o;Ee.x=Fi,Ee.y=Dn,Ee.z=ts,En=3}var De=o.x*o.x+o.y*o.y+o.z*o.z;ke=En,In=De;var Ne=o;Pr=Ne.x,Go=Ne.y,Wi=Ne.z}if(as<0){var ce,rr,ri,Qr,Nr,uo,Co=r;ce=Co.x,rr=Co.y,ri=Co.z;var __=i;Qr=__.x,Nr=__.y,uo=__.z;var Fe,rs,Nn;Fe=Qr-ce,rs=Nr-rr,Nn=uo-ri;var bo=Fe*Fe+rs*rs+Nn*Nn,Nt=Fe*ce+rs*rr+Nn*ri;Nt=-Nt/bo;var Fr;if(Nt<0){var li=o;li.x=ce,li.y=rr,li.z=ri,Fr=1}else if(Nt>1){var wo=o;wo.x=Qr,wo.y=Nr,wo.z=uo,Fr=2}else{var be,Le,Ye;be=ce+Fe*Nt,Le=rr+rs*Nt,Ye=ri+Nn*Nt;var xo=o;xo.x=be,xo.y=Le,xo.z=Ye,Fr=3}var jt=o.x*o.x+o.y*o.y+o.z*o.z;if(In<0||jt<In){ke=Fr<<1,In=jt;var Vi=o;Pr=Vi.x,Go=Vi.y,Wi=Vi.z}}if(N_<0){var si,Jo,Gs,To,ko,Gi,Ci=a;si=Ci.x,Jo=Ci.y,Gs=Ci.z;var Ti=i;To=Ti.x,ko=Ti.y,Gi=Ti.z;var Li,Qt,Gr;Li=To-si,Qt=ko-Jo,Gr=Gi-Gs;var Yr=Li*Li+Qt*Qt+Gr*Gr,Rr=Li*si+Qt*Jo+Gr*Gs;Rr=-Rr/Yr;var Mi;if(Rr<0){var qr=o;qr.x=si,qr.y=Jo,qr.z=Gs,Mi=1}else if(Rr>1){var Ji=o;Ji.x=To,Ji.y=ko,Ji.z=Gi,Mi=2}else{var $i,to,fe;$i=si+Li*Rr,to=Jo+Qt*Rr,fe=Gs+Gr*Rr;var wr=o;wr.x=$i,wr.y=to,wr.z=fe,Mi=3}var sn=o.x*o.x+o.y*o.y+o.z*o.z;if(In<0||sn<In){ke=Mi&1|(Mi&2)<<1,In=sn;var Yi=o;Pr=Yi.x,Go=Yi.y,Wi=Yi.z}}var $o;if(In>0){var gs=o;gs.x=Pr,gs.y=Go,gs.z=Wi,$o=ke}else{var Vn=yi*yi+Po*Po+Dr*Dr;Vn>0&&(Vn=1/Math.sqrt(Vn)),yi*=Vn,Po*=Vn,Dr*=Vn;var Is=hr*yi+ei*Po+Xi*Dr,wn=yi*yi+Po*Po+Dr*Dr;wn=Is/wn,Pr=yi*wn,Go=Po*wn,Wi=Dr*wn;var Cr=o;Cr.x=Pr,Cr.y=Go,Cr.z=Wi,$o=7}var Ro=o.x*o.x+o.y*o.y+o.z*o.z;if(aa<0||Ro<aa){k=$o&1|($o&6)<<1,aa=Ro;var _o=o;T=_o.x,ca=_o.y,_a=_o.z}}if(na*sa<0){var Fn,Ge,Gn,Wo,kn,Ze,Ut,Qo,Ui,Xn,Jn,ue,Vs,Uo,ws,X_,Js,L_,Je=a;Fn=Je.x,Ge=Je.y,Gn=Je.z;var F_=t;Wo=F_.x,kn=F_.y,Ze=F_.z;var G_=i;Ut=G_.x,Qo=G_.y,Ui=G_.z,Xn=Wo-Fn,Jn=kn-Ge,ue=Ze-Gn,Vs=Ut-Wo,Uo=Qo-kn,ws=Ui-Ze,X_=Fn-Ut,Js=Ge-Qo,L_=Gn-Ui;var Oi,Xo,Lo;Oi=Jn*ws-ue*Uo,Xo=ue*Vs-Xn*ws,Lo=Xn*Uo-Jn*Vs;var $n,kr,Wn,Eo,ro,J_,$_,Y_,is;$n=Jn*Lo-ue*Xo,kr=ue*Oi-Xn*Lo,Wn=Xn*Xo-Jn*Oi,Eo=Uo*Lo-ws*Xo,ro=ws*Oi-Vs*Lo,J_=Vs*Xo-Uo*Oi,$_=Js*Lo-L_*Xo,Y_=L_*Oi-X_*Lo,is=X_*Xo-Js*Oi;var v_=Fn*$n+Ge*kr+Gn*Wn,l_=Wo*Eo+kn*ro+Ze*J_,os=Ut*$_+Qo*Y_+Ui*is,mr=-1,Oo,ai,de,$s=0;if(Oo=0,ai=0,de=0,v_<0){var cv,xe,$e,Kn,Ws,Tr,Yo=a;cv=Yo.x,xe=Yo.y,$e=Yo.z;var Ri=t;Kn=Ri.x,Ws=Ri.y,Tr=Ri.z;var _n,ks,Z_;_n=Kn-cv,ks=Ws-xe,Z_=Tr-$e;var We=_n*_n+ks*ks+Z_*Z_,qn=_n*cv+ks*xe+Z_*$e;qn=-qn/We;var Ln;if(qn<0){var ns=o;ns.x=cv,ns.y=xe,ns.z=$e,Ln=1}else if(qn>1){var Be=o;Be.x=Kn,Be.y=Ws,Be.z=Tr,Ln=2}else{var es,Us,h_;es=cv+_n*qn,Us=xe+ks*qn,h_=$e+Z_*qn;var Se=o;Se.x=es,Se.y=Us,Se.z=h_,Ln=3}var Ae=o.x*o.x+o.y*o.y+o.z*o.z;$s=Ln,mr=Ae;var ae=o;Oo=ae.x,ai=ae.y,de=ae.z}if(l_<0){var pr,Mo,Zi,Ho,Zo,Hi,Do=t;pr=Do.x,Mo=Do.y,Zi=Do.z;var Xs=i;Ho=Xs.x,Zo=Xs.y,Hi=Xs.z;var te,Os,W_;te=Ho-pr,Os=Zo-Mo,W_=Hi-Zi;var re=te*te+Os*Os+W_*W_,Ft=te*pr+Os*Mo+W_*Zi;Ft=-Ft/re;var ji;if(Ft<0){var No=o;No.x=pr,No.y=Mo,No.z=Zi,ji=1}else if(Ft>1){var Ls=o;Ls.x=Ho,Ls.y=Zo,Ls.z=Hi,ji=2}else{var kv,i0,U_;kv=pr+te*Ft,i0=Mo+Os*Ft,U_=Zi+W_*Ft;var Ot=o;Ot.x=kv,Ot.y=i0,Ot.z=U_,ji=3}var Yn=o.x*o.x+o.y*o.y+o.z*o.z;if(mr<0||Yn<mr){$s=ji<<1,mr=Yn;var Qi=o;Oo=Qi.x,ai=Qi.y,de=Qi.z}}if(os<0){var Zn,d_,Hs,c_,fo,ss,_s=a;Zn=_s.x,d_=_s.y,Hs=_s.z;var Me=i;c_=Me.x,fo=Me.y,ss=Me.z;var Zr,jo,wi;Zr=c_-Zn,jo=fo-d_,wi=ss-Hs;var Bo=Zr*Zr+jo*jo+wi*wi,Ue=Zr*Zn+jo*d_+wi*Hs;Ue=-Ue/Bo;var bv;if(Ue<0){var ze=o;ze.x=Zn,ze.y=d_,ze.z=Hs,bv=1}else if(Ue>1){var js=o;js.x=c_,js.y=fo,js.z=ss,bv=2}else{var Xv,Oe,er;Xv=Zn+Zr*Ue,Oe=d_+jo*Ue,er=Hs+wi*Ue;var dn=o;dn.x=Xv,dn.y=Oe,dn.z=er,bv=3}var vn=o.x*o.x+o.y*o.y+o.z*o.z;if(mr<0||vn<mr){$s=bv&1|(bv&2)<<1,mr=vn;var ln=o;Oo=ln.x,ai=ln.y,de=ln.z}}var B_;if(mr>0){var fv=o;fv.x=Oo,fv.y=ai,fv.z=de,B_=$s}else{var ie=Oi*Oi+Xo*Xo+Lo*Lo;ie>0&&(ie=1/Math.sqrt(ie)),Oi*=ie,Xo*=ie,Lo*=ie;var Pe=Fn*Oi+Ge*Xo+Gn*Lo,b_=Oi*Oi+Xo*Xo+Lo*Lo;b_=Pe/b_,Oo=Oi*b_,ai=Xo*b_,de=Lo*b_;var O_=o;O_.x=Oo,O_.y=ai,O_.z=de,B_=7}var uv=o.x*o.x+o.y*o.y+o.z*o.z;if(aa<0||uv<aa){k=B_&3|(B_&4)<<1,aa=uv;var xv=o;T=xv.x,ca=xv.y,_a=xv.z}}if(oa*sa<0){var f_,He,zo,vs,ls,Wr,mo,vo,hs,Ys,Zs,ds,S_,me,cs,H_,Ks,Un,pe=t;f_=pe.x,He=pe.y,zo=pe.z;var Lv=r;vs=Lv.x,ls=Lv.y,Wr=Lv.z;var A_=i;mo=A_.x,vo=A_.y,hs=A_.z,Ys=vs-f_,Zs=ls-He,ds=Wr-zo,S_=mo-vs,me=vo-ls,cs=hs-Wr,H_=f_-mo,Ks=He-vo,Un=zo-hs;var Ko,hn,po;Ko=Zs*cs-ds*me,hn=ds*S_-Ys*cs,po=Ys*me-Zs*S_;var Ht,Ki,lo,qs,Bs,a_,P_,qo,oe;Ht=Zs*po-ds*hn,Ki=ds*Ko-Ys*po,lo=Ys*hn-Zs*Ko,qs=me*po-cs*hn,Bs=cs*Ko-S_*po,a_=S_*hn-me*Ko,P_=Ks*po-Un*hn,qo=Un*Ko-H_*po,oe=H_*hn-Ks*Ko;var j_=f_*Ht+He*Ki+zo*lo,Mv=vs*qs+ls*Bs+Wr*a_,dr=mo*P_+vo*qo+hs*oe,yo=-1,Ei,io,K_,q_=0;if(Ei=0,io=0,K_=0,j_<0){var Yv,t_,Zv,av,Br,tv,Ss=t;Yv=Ss.x,t_=Ss.y,Zv=Ss.z;var As=r;av=As.x,Br=As.y,tv=As.z;var bs,fs,Ps;bs=av-Yv,fs=Br-t_,Ps=tv-Zv;var dv=bs*bs+fs*fs+Ps*Ps,ye=bs*Yv+fs*t_+Ps*Zv;ye=-ye/dv;var qi;if(ye<0){var r_=o;r_.x=Yv,r_.y=t_,r_.z=Zv,qi=1}else if(ye>1){var go=o;go.x=av,go.y=Br,go.z=tv,qi=2}else{var i_,Fo,Cs;i_=Yv+bs*ye,Fo=t_+fs*ye,Cs=Zv+Ps*ye;var an=o;an.x=i_,an.y=Fo,an.z=Cs,qi=3}var ge=o.x*o.x+o.y*o.y+o.z*o.z;q_=qi,yo=ge;var sr=o;Ei=sr.x,io=sr.y,K_=sr.z}if(Mv<0){var tn,_i,ne,Ie,So,Di,Bn=r;tn=Bn.x,_i=Bn.y,ne=Bn.z;var rv=i;Ie=rv.x,So=rv.y,Di=rv.z;var o_,C_,iv;o_=Ie-tn,C_=So-_i,iv=Di-ne;var ee=o_*o_+C_*C_+iv*iv,Sn=o_*tn+C_*_i+iv*ne;Sn=-Sn/ee;var Ve;if(Sn<0){var D0=o;D0.x=tn,D0.y=_i,D0.z=ne,Ve=1}else if(Sn>1){var m0=o;m0.x=Ie,m0.y=So,m0.z=Di,Ve=2}else{var cl,N0,hi;cl=tn+o_*Sn,N0=_i+C_*Sn,hi=ne+iv*Sn;var On=o;On.x=cl,On.y=N0,On.z=hi,Ve=3}var Io=o.x*o.x+o.y*o.y+o.z*o.z;if(yo<0||Io<yo){q_=Ve<<1,yo=Io;var us=o;Ei=us.x,io=us.y,K_=us.z}}if(dr<0){var ov,zv,n_,Bv,Ts,u_,x_=t;ov=x_.x,zv=x_.y,n_=x_.z;var Sr=i;Bv=Sr.x,Ts=Sr.y,u_=Sr.z;var Rs,ho,Ce;Rs=Bv-ov,ho=Ts-zv,Ce=u_-n_;var mv=Rs*Rs+ho*ho+Ce*Ce,Qs=Rs*ov+ho*zv+Ce*n_;Qs=-Qs/mv;var M_;if(Qs<0){var nv=o;nv.x=ov,nv.y=zv,nv.z=n_,M_=1}else if(Qs>1){var o0=o;o0.x=Bv,o0.y=Ts,o0.z=u_,M_=2}else{var n0,ev,ti;n0=ov+Rs*Qs,ev=zv+ho*Qs,ti=n_+Ce*Qs;var je=o;je.x=n0,je.y=ev,je.z=ti,M_=3}var An=o.x*o.x+o.y*o.y+o.z*o.z;if(yo<0||An<yo){q_=M_&1|(M_&2)<<1,yo=An;var xs=o;Ei=xs.x,io=xs.y,K_=xs.z}}var F0;if(yo>0){var Nv=o;Nv.x=Ei,Nv.y=io,Nv.z=K_,F0=q_}else{var T_=Ko*Ko+hn*hn+po*po;T_>0&&(T_=1/Math.sqrt(T_)),Ko*=T_,hn*=T_,po*=T_;var p0=f_*Ko+He*hn+zo*po,Sv=Ko*Ko+hn*hn+po*po;Sv=p0/Sv,Ei=Ko*Sv,io=hn*Sv,K_=po*Sv;var e0=o;e0.x=Ei,e0.y=io,e0.z=K_,F0=7}var y0=o.x*o.x+o.y*o.y+o.z*o.z;if(aa<0||y0<aa){k=F0<<1,aa=y0;var G0=o;T=G0.x,ca=G0.y,_a=G0.z}}if(aa>0){var s0=o;return s0.x=T,s0.y=ca,s0.z=_a,k}return o.zero(),15}};x.common.Mat3=class{constructor(a,t,r,i,o,s,_,h,v){v==null&&(v=1),h==null&&(h=0),_==null&&(_=0),s==null&&(s=0),o==null&&(o=1),i==null&&(i=0),r==null&&(r=0),t==null&&(t=0),a==null&&(a=1),this.e00=a,this.e01=t,this.e02=r,this.e10=i,this.e11=o,this.e12=s,this.e20=_,this.e21=h,this.e22=v,x.common.Mat3.numCreations++}init(a,t,r,i,o,s,_,h,v){return this.e00=a,this.e01=t,this.e02=r,this.e10=i,this.e11=o,this.e12=s,this.e20=_,this.e21=h,this.e22=v,this}identity(){var a=1,t=0,r=0,i=0,o=1,s=0,_=0,h=0,v=1;return this.e00=a,this.e01=t,this.e02=r,this.e10=i,this.e11=o,this.e12=s,this.e20=_,this.e21=h,this.e22=v,this}add(a){return new x.common.Mat3(this.e00+a.e00,this.e01+a.e01,this.e02+a.e02,this.e10+a.e10,this.e11+a.e11,this.e12+a.e12,this.e20+a.e20,this.e21+a.e21,this.e22+a.e22)}sub(a){return new x.common.Mat3(this.e00-a.e00,this.e01-a.e01,this.e02-a.e02,this.e10-a.e10,this.e11-a.e11,this.e12-a.e12,this.e20-a.e20,this.e21-a.e21,this.e22-a.e22)}scale(a){return new x.common.Mat3(this.e00*a,this.e01*a,this.e02*a,this.e10*a,this.e11*a,this.e12*a,this.e20*a,this.e21*a,this.e22*a)}mul(a){return new x.common.Mat3(this.e00*a.e00+this.e01*a.e10+this.e02*a.e20,this.e00*a.e01+this.e01*a.e11+this.e02*a.e21,this.e00*a.e02+this.e01*a.e12+this.e02*a.e22,this.e10*a.e00+this.e11*a.e10+this.e12*a.e20,this.e10*a.e01+this.e11*a.e11+this.e12*a.e21,this.e10*a.e02+this.e11*a.e12+this.e12*a.e22,this.e20*a.e00+this.e21*a.e10+this.e22*a.e20,this.e20*a.e01+this.e21*a.e11+this.e22*a.e21,this.e20*a.e02+this.e21*a.e12+this.e22*a.e22)}addEq(a){var t=this.e00+a.e00,r=this.e01+a.e01,i=this.e02+a.e02,o=this.e10+a.e10,s=this.e11+a.e11,_=this.e12+a.e12,h=this.e20+a.e20,v=this.e21+a.e21,e=this.e22+a.e22;return this.e00=t,this.e01=r,this.e02=i,this.e10=o,this.e11=s,this.e12=_,this.e20=h,this.e21=v,this.e22=e,this}subEq(a){var t=this.e00-a.e00,r=this.e01-a.e01,i=this.e02-a.e02,o=this.e10-a.e10,s=this.e11-a.e11,_=this.e12-a.e12,h=this.e20-a.e20,v=this.e21-a.e21,e=this.e22-a.e22;return this.e00=t,this.e01=r,this.e02=i,this.e10=o,this.e11=s,this.e12=_,this.e20=h,this.e21=v,this.e22=e,this}scaleEq(a){var t=this.e00*a,r=this.e01*a,i=this.e02*a,o=this.e10*a,s=this.e11*a,_=this.e12*a,h=this.e20*a,v=this.e21*a,e=this.e22*a;return this.e00=t,this.e01=r,this.e02=i,this.e10=o,this.e11=s,this.e12=_,this.e20=h,this.e21=v,this.e22=e,this}mulEq(a){var t=this.e00*a.e00+this.e01*a.e10+this.e02*a.e20,r=this.e00*a.e01+this.e01*a.e11+this.e02*a.e21,i=this.e00*a.e02+this.e01*a.e12+this.e02*a.e22,o=this.e10*a.e00+this.e11*a.e10+this.e12*a.e20,s=this.e10*a.e01+this.e11*a.e11+this.e12*a.e21,_=this.e10*a.e02+this.e11*a.e12+this.e12*a.e22,h=this.e20*a.e00+this.e21*a.e10+this.e22*a.e20,v=this.e20*a.e01+this.e21*a.e11+this.e22*a.e21,e=this.e20*a.e02+this.e21*a.e12+this.e22*a.e22;return this.e00=t,this.e01=r,this.e02=i,this.e10=o,this.e11=s,this.e12=_,this.e20=h,this.e21=v,this.e22=e,this}prependScale(a,t,r){return new x.common.Mat3(this.e00*a,this.e01*a,this.e02*a,this.e10*t,this.e11*t,this.e12*t,this.e20*r,this.e21*r,this.e22*r)}appendScale(a,t,r){return new x.common.Mat3(this.e00*a,this.e01*t,this.e02*r,this.e10*a,this.e11*t,this.e12*r,this.e20*a,this.e21*t,this.e22*r)}prependRotation(a,t,r,i){var o=Math.sin(a),s=Math.cos(a),_=1-s,h=t*t*_+s,v=t*r*_-i*o,e=t*i*_+r*o,l=r*t*_+i*o,u=r*r*_+s,b=r*i*_-t*o,f=i*t*_-r*o,n=i*r*_+t*o,c=i*i*_+s;return new x.common.Mat3(h*this.e00+v*this.e10+e*this.e20,h*this.e01+v*this.e11+e*this.e21,h*this.e02+v*this.e12+e*this.e22,l*this.e00+u*this.e10+b*this.e20,l*this.e01+u*this.e11+b*this.e21,l*this.e02+u*this.e12+b*this.e22,f*this.e00+n*this.e10+c*this.e20,f*this.e01+n*this.e11+c*this.e21,f*this.e02+n*this.e12+c*this.e22)}appendRotation(a,t,r,i){var o=Math.sin(a),s=Math.cos(a),_=1-s,h=t*t*_+s,v=t*r*_-i*o,e=t*i*_+r*o,l=r*t*_+i*o,u=r*r*_+s,b=r*i*_-t*o,f=i*t*_-r*o,n=i*r*_+t*o,c=i*i*_+s;return new x.common.Mat3(this.e00*h+this.e01*l+this.e02*f,this.e00*v+this.e01*u+this.e02*n,this.e00*e+this.e01*b+this.e02*c,this.e10*h+this.e11*l+this.e12*f,this.e10*v+this.e11*u+this.e12*n,this.e10*e+this.e11*b+this.e12*c,this.e20*h+this.e21*l+this.e22*f,this.e20*v+this.e21*u+this.e22*n,this.e20*e+this.e21*b+this.e22*c)}prependScaleEq(a,t,r){var i=this.e00*a,o=this.e01*a,s=this.e02*a,_=this.e10*t,h=this.e11*t,v=this.e12*t,e=this.e20*r,l=this.e21*r,u=this.e22*r;return this.e00=i,this.e01=o,this.e02=s,this.e10=_,this.e11=h,this.e12=v,this.e20=e,this.e21=l,this.e22=u,this}appendScaleEq(a,t,r){var i=this.e00*a,o=this.e01*t,s=this.e02*r,_=this.e10*a,h=this.e11*t,v=this.e12*r,e=this.e20*a,l=this.e21*t,u=this.e22*r;return this.e00=i,this.e01=o,this.e02=s,this.e10=_,this.e11=h,this.e12=v,this.e20=e,this.e21=l,this.e22=u,this}prependRotationEq(a,t,r,i){var o=Math.sin(a),s=Math.cos(a),_=1-s,h=t*t*_+s,v=t*r*_-i*o,e=t*i*_+r*o,l=r*t*_+i*o,u=r*r*_+s,b=r*i*_-t*o,f=i*t*_-r*o,n=i*r*_+t*o,c=i*i*_+s,M=h*this.e00+v*this.e10+e*this.e20,m=h*this.e01+v*this.e11+e*this.e21,y=h*this.e02+v*this.e12+e*this.e22,V=l*this.e00+u*this.e10+b*this.e20,z=l*this.e01+u*this.e11+b*this.e21,I=l*this.e02+u*this.e12+b*this.e22,w=f*this.e00+n*this.e10+c*this.e20,X=f*this.e01+n*this.e11+c*this.e21,L=f*this.e02+n*this.e12+c*this.e22;return this.e00=M,this.e01=m,this.e02=y,this.e10=V,this.e11=z,this.e12=I,this.e20=w,this.e21=X,this.e22=L,this}appendRotationEq(a,t,r,i){var o=Math.sin(a),s=Math.cos(a),_=1-s,h=t*t*_+s,v=t*r*_-i*o,e=t*i*_+r*o,l=r*t*_+i*o,u=r*r*_+s,b=r*i*_-t*o,f=i*t*_-r*o,n=i*r*_+t*o,c=i*i*_+s,M=this.e00*h+this.e01*l+this.e02*f,m=this.e00*v+this.e01*u+this.e02*n,y=this.e00*e+this.e01*b+this.e02*c,V=this.e10*h+this.e11*l+this.e12*f,z=this.e10*v+this.e11*u+this.e12*n,I=this.e10*e+this.e11*b+this.e12*c,w=this.e20*h+this.e21*l+this.e22*f,X=this.e20*v+this.e21*u+this.e22*n,L=this.e20*e+this.e21*b+this.e22*c;return this.e00=M,this.e01=m,this.e02=y,this.e10=V,this.e11=z,this.e12=I,this.e20=w,this.e21=X,this.e22=L,this}transpose(){return new x.common.Mat3(this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22)}transposeEq(){var a=this.e00,t=this.e10,r=this.e20,i=this.e01,o=this.e11,s=this.e21,_=this.e02,h=this.e12,v=this.e22;return this.e00=a,this.e01=t,this.e02=r,this.e10=i,this.e11=o,this.e12=s,this.e20=_,this.e21=h,this.e22=v,this}determinant(){return this.e00*(this.e11*this.e22-this.e12*this.e21)-this.e01*(this.e10*this.e22-this.e12*this.e20)+this.e02*(this.e10*this.e21-this.e11*this.e20)}trace(){return this.e00+this.e11+this.e22}inverse(){var a=this.e11*this.e22-this.e12*this.e21,t=this.e10*this.e22-this.e12*this.e20,r=this.e10*this.e21-this.e11*this.e20,i=this.e01*this.e22-this.e02*this.e21,o=this.e00*this.e22-this.e02*this.e20,s=this.e00*this.e21-this.e01*this.e20,_=this.e01*this.e12-this.e02*this.e11,h=this.e00*this.e12-this.e02*this.e10,v=this.e00*this.e11-this.e01*this.e10,e=this.e00*a-this.e01*t+this.e02*r;return e!=0&&(e=1/e),new x.common.Mat3(a*e,-i*e,_*e,-t*e,o*e,-h*e,r*e,-s*e,v*e)}inverseEq(){var a=this.e11*this.e22-this.e12*this.e21,t=this.e10*this.e22-this.e12*this.e20,r=this.e10*this.e21-this.e11*this.e20,i=this.e01*this.e22-this.e02*this.e21,o=this.e00*this.e22-this.e02*this.e20,s=this.e00*this.e21-this.e01*this.e20,_=this.e01*this.e12-this.e02*this.e11,h=this.e00*this.e12-this.e02*this.e10,v=this.e00*this.e11-this.e01*this.e10,e=this.e00*a-this.e01*t+this.e02*r;e!=0&&(e=1/e);var l=a*e,u=-i*e,b=_*e,f=-t*e,n=o*e,c=-h*e,M=r*e,m=-s*e,y=v*e;return this.e00=l,this.e01=u,this.e02=b,this.e10=f,this.e11=n,this.e12=c,this.e20=M,this.e21=m,this.e22=y,this}toArray(a){return a==null&&(a=!1),a?[this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22]:[this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22]}copyFrom(a){return this.e00=a.e00,this.e01=a.e01,this.e02=a.e02,this.e10=a.e10,this.e11=a.e11,this.e12=a.e12,this.e20=a.e20,this.e21=a.e21,this.e22=a.e22,this}clone(){return new x.common.Mat3(this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22)}fromQuat(a){var t=a.x,r=a.y,i=a.z,o=a.w,s=2*t,_=2*r,h=2*i,v=t*s,e=r*_,l=i*h,u=t*_,b=r*h,f=t*h,n=o*s,c=o*_,M=o*h;return this.e00=1-e-l,this.e01=u-M,this.e02=f+c,this.e10=u+M,this.e11=1-v-l,this.e12=b-n,this.e20=f-c,this.e21=b+n,this.e22=1-v-e,this}toQuat(){var a=new x.common.Quat,t=this.e00,r=this.e11,i=this.e22,o=t+r+i,s;return o>0?(s=Math.sqrt(o+1),a.w=.5*s,s=.5/s,a.x=(this.e21-this.e12)*s,a.y=(this.e02-this.e20)*s,a.z=(this.e10-this.e01)*s):t>r?t>i?(s=Math.sqrt(t-r-i+1),a.x=.5*s,s=.5/s,a.y=(this.e01+this.e10)*s,a.z=(this.e02+this.e20)*s,a.w=(this.e21-this.e12)*s):(s=Math.sqrt(i-t-r+1),a.z=.5*s,s=.5/s,a.x=(this.e02+this.e20)*s,a.y=(this.e12+this.e21)*s,a.w=(this.e10-this.e01)*s):r>i?(s=Math.sqrt(r-i-t+1),a.y=.5*s,s=.5/s,a.x=(this.e01+this.e10)*s,a.z=(this.e12+this.e21)*s,a.w=(this.e02-this.e20)*s):(s=Math.sqrt(i-t-r+1),a.z=.5*s,s=.5/s,a.x=(this.e02+this.e20)*s,a.y=(this.e12+this.e21)*s,a.w=(this.e10-this.e01)*s),a}fromEulerXyz(a){var t=Math.sin(a.x),r=Math.sin(a.y),i=Math.sin(a.z),o=Math.cos(a.x),s=Math.cos(a.y),_=Math.cos(a.z),h=s*_,v=-s*i,e=r,l=o*i+_*t*r,u=o*_-t*r*i,b=-s*t,f=t*i-o*_*r,n=_*t+o*r*i,c=o*s;return this.e00=h,this.e01=v,this.e02=e,this.e10=l,this.e11=u,this.e12=b,this.e20=f,this.e21=n,this.e22=c,this}toEulerXyz(){var a=this.e02;if(a<=-1){var t=Math.atan2(this.e21,this.e11);return new x.common.Vec3(t*.5,-1.570796326794895,-t*.5)}if(a>=1){var r=Math.atan2(this.e21,this.e11);return new x.common.Vec3(r*.5,1.570796326794895,r*.5)}var i=Math.asin(a),o=Math.atan2(-this.e12,this.e22),s=Math.atan2(-this.e01,this.e00);return new x.common.Vec3(o,i,s)}getRow(a){return a==0?new x.common.Vec3(this.e00,this.e01,this.e02):a==1?new x.common.Vec3(this.e10,this.e11,this.e12):a==2?new x.common.Vec3(this.e20,this.e21,this.e22):null}getCol(a){return a==0?new x.common.Vec3(this.e00,this.e10,this.e20):a==1?new x.common.Vec3(this.e01,this.e11,this.e21):a==2?new x.common.Vec3(this.e02,this.e12,this.e22):null}getRowTo(a,t){a==0?t.init(this.e00,this.e01,this.e02):a==1?t.init(this.e10,this.e11,this.e12):a==2?t.init(this.e20,this.e21,this.e22):t.zero()}getColTo(a,t){a==0?t.init(this.e00,this.e10,this.e20):a==1?t.init(this.e01,this.e11,this.e21):a==2?t.init(this.e02,this.e12,this.e22):t.zero()}fromRows(a,t,r){var i=a.x,o=a.y,s=a.z,_=t.x,h=t.y,v=t.z,e=r.x,l=r.y,u=r.z;return this.e00=i,this.e01=o,this.e02=s,this.e10=_,this.e11=h,this.e12=v,this.e20=e,this.e21=l,this.e22=u,this}fromCols(a,t,r){var i=a.x,o=t.x,s=r.x,_=a.y,h=t.y,v=r.y,e=a.z,l=t.z,u=r.z;return this.e00=i,this.e01=o,this.e02=s,this.e10=_,this.e11=h,this.e12=v,this.e20=e,this.e21=l,this.e22=u,this}toString(){return"Mat3["+(this.e00>0?(this.e00*1e7+.5|0)/1e7:(this.e00*1e7-.5|0)/1e7)+", "+(this.e01>0?(this.e01*1e7+.5|0)/1e7:(this.e01*1e7-.5|0)/1e7)+", "+(this.e02>0?(this.e02*1e7+.5|0)/1e7:(this.e02*1e7-.5|0)/1e7)+`,
     `+(this.e10>0?(this.e10*1e7+.5|0)/1e7:(this.e10*1e7-.5|0)/1e7)+", "+(this.e11>0?(this.e11*1e7+.5|0)/1e7:(this.e11*1e7-.5|0)/1e7)+", "+(this.e12>0?(this.e12*1e7+.5|0)/1e7:(this.e12*1e7-.5|0)/1e7)+`,
     `+(this.e20>0?(this.e20*1e7+.5|0)/1e7:(this.e20*1e7-.5|0)/1e7)+", "+(this.e21>0?(this.e21*1e7+.5|0)/1e7:(this.e21*1e7-.5|0)/1e7)+", "+(this.e22>0?(this.e22*1e7+.5|0)/1e7:(this.e22*1e7-.5|0)/1e7)+"]"}};x.common.Mat4=class{constructor(a,t,r,i,o,s,_,h,v,e,l,u,b,f,n,c){c==null&&(c=1),n==null&&(n=0),f==null&&(f=0),b==null&&(b=0),u==null&&(u=0),l==null&&(l=1),e==null&&(e=0),v==null&&(v=0),h==null&&(h=0),_==null&&(_=0),s==null&&(s=1),o==null&&(o=0),i==null&&(i=0),r==null&&(r=0),t==null&&(t=0),a==null&&(a=1),this.e00=a,this.e01=t,this.e02=r,this.e03=i,this.e10=o,this.e11=s,this.e12=_,this.e13=h,this.e20=v,this.e21=e,this.e22=l,this.e23=u,this.e30=b,this.e31=f,this.e32=n,this.e33=c,x.common.Mat4.numCreations++}init(a,t,r,i,o,s,_,h,v,e,l,u,b,f,n,c){return this.e00=a,this.e01=t,this.e02=r,this.e03=i,this.e10=o,this.e11=s,this.e12=_,this.e13=h,this.e20=v,this.e21=e,this.e22=l,this.e23=u,this.e30=b,this.e31=f,this.e32=n,this.e33=c,this}identity(){var a=1,t=0,r=0,i=0,o=0,s=1,_=0,h=0,v=0,e=0,l=1,u=0,b=0,f=0,n=0,c=1;return this.e00=a,this.e01=t,this.e02=r,this.e03=i,this.e10=o,this.e11=s,this.e12=_,this.e13=h,this.e20=v,this.e21=e,this.e22=l,this.e23=u,this.e30=b,this.e31=f,this.e32=n,this.e33=c,this}add(a){return new x.common.Mat4(this.e00+a.e00,this.e01+a.e01,this.e02+a.e02,this.e03+a.e03,this.e10+a.e10,this.e11+a.e11,this.e12+a.e12,this.e13+a.e13,this.e20+a.e20,this.e21+a.e21,this.e22+a.e22,this.e23+a.e23,this.e30+a.e30,this.e31+a.e31,this.e32+a.e32,this.e33+a.e33)}sub(a){return new x.common.Mat4(this.e00-a.e00,this.e01-a.e01,this.e02-a.e02,this.e03-a.e03,this.e10-a.e10,this.e11-a.e11,this.e12-a.e12,this.e13-a.e13,this.e20-a.e20,this.e21-a.e21,this.e22-a.e22,this.e23-a.e23,this.e30-a.e30,this.e31-a.e31,this.e32-a.e32,this.e33-a.e33)}scale(a){return new x.common.Mat4(this.e00*a,this.e01*a,this.e02*a,this.e03*a,this.e10*a,this.e11*a,this.e12*a,this.e13*a,this.e20*a,this.e21*a,this.e22*a,this.e23*a,this.e30*a,this.e31*a,this.e32*a,this.e33*a)}mul(a){return new x.common.Mat4(this.e00*a.e00+this.e01*a.e10+this.e02*a.e20+this.e03*a.e30,this.e00*a.e01+this.e01*a.e11+this.e02*a.e21+this.e03*a.e31,this.e00*a.e02+this.e01*a.e12+this.e02*a.e22+this.e03*a.e32,this.e00*a.e03+this.e01*a.e13+this.e02*a.e23+this.e03*a.e33,this.e10*a.e00+this.e11*a.e10+this.e12*a.e20+this.e13*a.e30,this.e10*a.e01+this.e11*a.e11+this.e12*a.e21+this.e13*a.e31,this.e10*a.e02+this.e11*a.e12+this.e12*a.e22+this.e13*a.e32,this.e10*a.e03+this.e11*a.e13+this.e12*a.e23+this.e13*a.e33,this.e20*a.e00+this.e21*a.e10+this.e22*a.e20+this.e23*a.e30,this.e20*a.e01+this.e21*a.e11+this.e22*a.e21+this.e23*a.e31,this.e20*a.e02+this.e21*a.e12+this.e22*a.e22+this.e23*a.e32,this.e20*a.e03+this.e21*a.e13+this.e22*a.e23+this.e23*a.e33,this.e30*a.e00+this.e31*a.e10+this.e32*a.e20+this.e33*a.e30,this.e30*a.e01+this.e31*a.e11+this.e32*a.e21+this.e33*a.e31,this.e30*a.e02+this.e31*a.e12+this.e32*a.e22+this.e33*a.e32,this.e30*a.e03+this.e31*a.e13+this.e32*a.e23+this.e33*a.e33)}addEq(a){var t=this.e00+a.e00,r=this.e01+a.e01,i=this.e02+a.e02,o=this.e03+a.e03,s=this.e10+a.e10,_=this.e11+a.e11,h=this.e12+a.e12,v=this.e13+a.e13,e=this.e20+a.e20,l=this.e21+a.e21,u=this.e22+a.e22,b=this.e23+a.e23,f=this.e30+a.e30,n=this.e31+a.e31,c=this.e32+a.e32,M=this.e33+a.e33;return this.e00=t,this.e01=r,this.e02=i,this.e03=o,this.e10=s,this.e11=_,this.e12=h,this.e13=v,this.e20=e,this.e21=l,this.e22=u,this.e23=b,this.e30=f,this.e31=n,this.e32=c,this.e33=M,this}subEq(a){var t=this.e00-a.e00,r=this.e01-a.e01,i=this.e02-a.e02,o=this.e03-a.e03,s=this.e10-a.e10,_=this.e11-a.e11,h=this.e12-a.e12,v=this.e13-a.e13,e=this.e20-a.e20,l=this.e21-a.e21,u=this.e22-a.e22,b=this.e23-a.e23,f=this.e30-a.e30,n=this.e31-a.e31,c=this.e32-a.e32,M=this.e33-a.e33;return this.e00=t,this.e01=r,this.e02=i,this.e03=o,this.e10=s,this.e11=_,this.e12=h,this.e13=v,this.e20=e,this.e21=l,this.e22=u,this.e23=b,this.e30=f,this.e31=n,this.e32=c,this.e33=M,this}scaleEq(a){var t=this.e00*a,r=this.e01*a,i=this.e02*a,o=this.e03*a,s=this.e10*a,_=this.e11*a,h=this.e12*a,v=this.e13*a,e=this.e20*a,l=this.e21*a,u=this.e22*a,b=this.e23*a,f=this.e30*a,n=this.e31*a,c=this.e32*a,M=this.e33*a;return this.e00=t,this.e01=r,this.e02=i,this.e03=o,this.e10=s,this.e11=_,this.e12=h,this.e13=v,this.e20=e,this.e21=l,this.e22=u,this.e23=b,this.e30=f,this.e31=n,this.e32=c,this.e33=M,this}mulEq(a){var t=this.e00*a.e00+this.e01*a.e10+this.e02*a.e20+this.e03*a.e30,r=this.e00*a.e01+this.e01*a.e11+this.e02*a.e21+this.e03*a.e31,i=this.e00*a.e02+this.e01*a.e12+this.e02*a.e22+this.e03*a.e32,o=this.e00*a.e03+this.e01*a.e13+this.e02*a.e23+this.e03*a.e33,s=this.e10*a.e00+this.e11*a.e10+this.e12*a.e20+this.e13*a.e30,_=this.e10*a.e01+this.e11*a.e11+this.e12*a.e21+this.e13*a.e31,h=this.e10*a.e02+this.e11*a.e12+this.e12*a.e22+this.e13*a.e32,v=this.e10*a.e03+this.e11*a.e13+this.e12*a.e23+this.e13*a.e33,e=this.e20*a.e00+this.e21*a.e10+this.e22*a.e20+this.e23*a.e30,l=this.e20*a.e01+this.e21*a.e11+this.e22*a.e21+this.e23*a.e31,u=this.e20*a.e02+this.e21*a.e12+this.e22*a.e22+this.e23*a.e32,b=this.e20*a.e03+this.e21*a.e13+this.e22*a.e23+this.e23*a.e33,f=this.e30*a.e00+this.e31*a.e10+this.e32*a.e20+this.e33*a.e30,n=this.e30*a.e01+this.e31*a.e11+this.e32*a.e21+this.e33*a.e31,c=this.e30*a.e02+this.e31*a.e12+this.e32*a.e22+this.e33*a.e32,M=this.e30*a.e03+this.e31*a.e13+this.e32*a.e23+this.e33*a.e33;return this.e00=t,this.e01=r,this.e02=i,this.e03=o,this.e10=s,this.e11=_,this.e12=h,this.e13=v,this.e20=e,this.e21=l,this.e22=u,this.e23=b,this.e30=f,this.e31=n,this.e32=c,this.e33=M,this}prependScale(a,t,r){return new x.common.Mat4(this.e00*a,this.e01*a,this.e02*a,this.e03*a,this.e10*t,this.e11*t,this.e12*t,this.e13*t,this.e20*r,this.e21*r,this.e22*r,this.e23*r,this.e30,this.e31,this.e32,this.e33)}appendScale(a,t,r){return new x.common.Mat4(this.e00*a,this.e01*t,this.e02*r,this.e03,this.e10*a,this.e11*t,this.e12*r,this.e13,this.e20*a,this.e21*t,this.e22*r,this.e23,this.e30*a,this.e31*t,this.e32*r,this.e33)}prependRotation(a,t,r,i){var o=Math.sin(a),s=Math.cos(a),_=1-s,h=t*t*_+s,v=t*r*_-i*o,e=t*i*_+r*o,l=r*t*_+i*o,u=r*r*_+s,b=r*i*_-t*o,f=i*t*_-r*o,n=i*r*_+t*o,c=i*i*_+s;return new x.common.Mat4(h*this.e00+v*this.e10+e*this.e20,h*this.e01+v*this.e11+e*this.e21,h*this.e02+v*this.e12+e*this.e22,h*this.e03+v*this.e13+e*this.e23,l*this.e00+u*this.e10+b*this.e20,l*this.e01+u*this.e11+b*this.e21,l*this.e02+u*this.e12+b*this.e22,l*this.e03+u*this.e13+b*this.e23,f*this.e00+n*this.e10+c*this.e20,f*this.e01+n*this.e11+c*this.e21,f*this.e02+n*this.e12+c*this.e22,f*this.e03+n*this.e13+c*this.e23,this.e30,this.e31,this.e32,this.e33)}appendRotation(a,t,r,i){var o=Math.sin(a),s=Math.cos(a),_=1-s,h=t*t*_+s,v=t*r*_-i*o,e=t*i*_+r*o,l=r*t*_+i*o,u=r*r*_+s,b=r*i*_-t*o,f=i*t*_-r*o,n=i*r*_+t*o,c=i*i*_+s;return new x.common.Mat4(this.e00*h+this.e01*l+this.e02*f,this.e00*v+this.e01*u+this.e02*n,this.e00*e+this.e01*b+this.e02*c,this.e03,this.e10*h+this.e11*l+this.e12*f,this.e10*v+this.e11*u+this.e12*n,this.e10*e+this.e11*b+this.e12*c,this.e13,this.e20*h+this.e21*l+this.e22*f,this.e20*v+this.e21*u+this.e22*n,this.e20*e+this.e21*b+this.e22*c,this.e23,this.e30*h+this.e31*l+this.e32*f,this.e30*v+this.e31*u+this.e32*n,this.e30*e+this.e31*b+this.e32*c,this.e33)}prependTranslation(a,t,r){return new x.common.Mat4(this.e00+a*this.e30,this.e01+a*this.e31,this.e02+a*this.e32,this.e03+a*this.e33,this.e10+t*this.e30,this.e11+t*this.e31,this.e12+t*this.e32,this.e13+t*this.e33,this.e20+r*this.e30,this.e21+r*this.e31,this.e22+r*this.e32,this.e23+r*this.e33,this.e30,this.e31,this.e32,this.e33)}appendTranslation(a,t,r){return new x.common.Mat4(this.e00,this.e01,this.e02,this.e00*a+this.e01*t+this.e02*r+this.e03,this.e10,this.e11,this.e12,this.e10*a+this.e11*t+this.e12*r+this.e13,this.e20,this.e21,this.e22,this.e20*a+this.e21*t+this.e22*r+this.e23,this.e30,this.e31,this.e32,this.e30*a+this.e31*t+this.e32*r+this.e33)}prependScaleEq(a,t,r){var i=this.e00*a,o=this.e01*a,s=this.e02*a,_=this.e03*a,h=this.e10*t,v=this.e11*t,e=this.e12*t,l=this.e13*t,u=this.e20*r,b=this.e21*r,f=this.e22*r,n=this.e23*r,c=this.e30,M=this.e31,m=this.e32,y=this.e33;return this.e00=i,this.e01=o,this.e02=s,this.e03=_,this.e10=h,this.e11=v,this.e12=e,this.e13=l,this.e20=u,this.e21=b,this.e22=f,this.e23=n,this.e30=c,this.e31=M,this.e32=m,this.e33=y,this}appendScaleEq(a,t,r){var i=this.e00*a,o=this.e01*t,s=this.e02*r,_=this.e03,h=this.e10*a,v=this.e11*t,e=this.e12*r,l=this.e13,u=this.e20*a,b=this.e21*t,f=this.e22*r,n=this.e23,c=this.e30*a,M=this.e31*t,m=this.e32*r,y=this.e33;return this.e00=i,this.e01=o,this.e02=s,this.e03=_,this.e10=h,this.e11=v,this.e12=e,this.e13=l,this.e20=u,this.e21=b,this.e22=f,this.e23=n,this.e30=c,this.e31=M,this.e32=m,this.e33=y,this}prependRotationEq(a,t,r,i){var o=Math.sin(a),s=Math.cos(a),_=1-s,h=t*t*_+s,v=t*r*_-i*o,e=t*i*_+r*o,l=r*t*_+i*o,u=r*r*_+s,b=r*i*_-t*o,f=i*t*_-r*o,n=i*r*_+t*o,c=i*i*_+s,M=h*this.e00+v*this.e10+e*this.e20,m=h*this.e01+v*this.e11+e*this.e21,y=h*this.e02+v*this.e12+e*this.e22,V=h*this.e03+v*this.e13+e*this.e23,z=l*this.e00+u*this.e10+b*this.e20,I=l*this.e01+u*this.e11+b*this.e21,w=l*this.e02+u*this.e12+b*this.e22,X=l*this.e03+u*this.e13+b*this.e23,L=f*this.e00+n*this.e10+c*this.e20,p=f*this.e01+n*this.e11+c*this.e21,g=f*this.e02+n*this.e12+c*this.e22,F=f*this.e03+n*this.e13+c*this.e23,S=this.e30,N=this.e31,A=this.e32,Y=this.e33;return this.e00=M,this.e01=m,this.e02=y,this.e03=V,this.e10=z,this.e11=I,this.e12=w,this.e13=X,this.e20=L,this.e21=p,this.e22=g,this.e23=F,this.e30=S,this.e31=N,this.e32=A,this.e33=Y,this}appendRotationEq(a,t,r,i){var o=Math.sin(a),s=Math.cos(a),_=1-s,h=t*t*_+s,v=t*r*_-i*o,e=t*i*_+r*o,l=r*t*_+i*o,u=r*r*_+s,b=r*i*_-t*o,f=i*t*_-r*o,n=i*r*_+t*o,c=i*i*_+s,M=this.e00*h+this.e01*l+this.e02*f,m=this.e00*v+this.e01*u+this.e02*n,y=this.e00*e+this.e01*b+this.e02*c,V=this.e03,z=this.e10*h+this.e11*l+this.e12*f,I=this.e10*v+this.e11*u+this.e12*n,w=this.e10*e+this.e11*b+this.e12*c,X=this.e13,L=this.e20*h+this.e21*l+this.e22*f,p=this.e20*v+this.e21*u+this.e22*n,g=this.e20*e+this.e21*b+this.e22*c,F=this.e23,S=this.e30*h+this.e31*l+this.e32*f,N=this.e30*v+this.e31*u+this.e32*n,A=this.e30*e+this.e31*b+this.e32*c,Y=this.e33;return this.e00=M,this.e01=m,this.e02=y,this.e03=V,this.e10=z,this.e11=I,this.e12=w,this.e13=X,this.e20=L,this.e21=p,this.e22=g,this.e23=F,this.e30=S,this.e31=N,this.e32=A,this.e33=Y,this}prependTranslationEq(a,t,r){var i=this.e00+a*this.e30,o=this.e01+a*this.e31,s=this.e02+a*this.e32,_=this.e03+a*this.e33,h=this.e10+t*this.e30,v=this.e11+t*this.e31,e=this.e12+t*this.e32,l=this.e13+t*this.e33,u=this.e20+r*this.e30,b=this.e21+r*this.e31,f=this.e22+r*this.e32,n=this.e23+r*this.e33,c=this.e30,M=this.e31,m=this.e32,y=this.e33;return this.e00=i,this.e01=o,this.e02=s,this.e03=_,this.e10=h,this.e11=v,this.e12=e,this.e13=l,this.e20=u,this.e21=b,this.e22=f,this.e23=n,this.e30=c,this.e31=M,this.e32=m,this.e33=y,this}appendTranslationEq(a,t,r){var i=this.e00,o=this.e01,s=this.e02,_=this.e00*a+this.e01*t+this.e02*r+this.e03,h=this.e10,v=this.e11,e=this.e12,l=this.e10*a+this.e11*t+this.e12*r+this.e13,u=this.e20,b=this.e21,f=this.e22,n=this.e20*a+this.e21*t+this.e22*r+this.e23,c=this.e30,M=this.e31,m=this.e32,y=this.e30*a+this.e31*t+this.e32*r+this.e33;return this.e00=i,this.e01=o,this.e02=s,this.e03=_,this.e10=h,this.e11=v,this.e12=e,this.e13=l,this.e20=u,this.e21=b,this.e22=f,this.e23=n,this.e30=c,this.e31=M,this.e32=m,this.e33=y,this}transpose(){return new x.common.Mat4(this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33)}transposeEq(){var a=this.e00,t=this.e10,r=this.e20,i=this.e30,o=this.e01,s=this.e11,_=this.e21,h=this.e31,v=this.e02,e=this.e12,l=this.e22,u=this.e32,b=this.e03,f=this.e13,n=this.e23,c=this.e33;return this.e00=a,this.e01=t,this.e02=r,this.e03=i,this.e10=o,this.e11=s,this.e12=_,this.e13=h,this.e20=v,this.e21=e,this.e22=l,this.e23=u,this.e30=b,this.e31=f,this.e32=n,this.e33=c,this}determinant(){var a=this.e20*this.e31-this.e21*this.e30,t=this.e20*this.e32-this.e22*this.e30,r=this.e20*this.e33-this.e23*this.e30,i=this.e21*this.e32-this.e22*this.e31,o=this.e21*this.e33-this.e23*this.e31,s=this.e22*this.e33-this.e23*this.e32;return this.e00*(this.e11*s-this.e12*o+this.e13*i)-this.e01*(this.e10*s-this.e12*r+this.e13*t)+this.e02*(this.e10*o-this.e11*r+this.e13*a)-this.e03*(this.e10*i-this.e11*t+this.e12*a)}trace(){return this.e00+this.e11+this.e22+this.e33}inverse(){var a=this.e00*this.e11-this.e01*this.e10,t=this.e00*this.e12-this.e02*this.e10,r=this.e00*this.e13-this.e03*this.e10,i=this.e01*this.e12-this.e02*this.e11,o=this.e01*this.e13-this.e03*this.e11,s=this.e02*this.e13-this.e03*this.e12,_=this.e20*this.e31-this.e21*this.e30,h=this.e20*this.e32-this.e22*this.e30,v=this.e20*this.e33-this.e23*this.e30,e=this.e21*this.e32-this.e22*this.e31,l=this.e21*this.e33-this.e23*this.e31,u=this.e22*this.e33-this.e23*this.e32,b=this.e11*u-this.e12*l+this.e13*e,f=this.e10*u-this.e12*v+this.e13*h,n=this.e10*l-this.e11*v+this.e13*_,c=this.e10*e-this.e11*h+this.e12*_,M=this.e01*u-this.e02*l+this.e03*e,m=this.e00*u-this.e02*v+this.e03*h,y=this.e00*l-this.e01*v+this.e03*_,V=this.e00*e-this.e01*h+this.e02*_,z=this.e31*s-this.e32*o+this.e33*i,I=this.e30*s-this.e32*r+this.e33*t,w=this.e30*o-this.e31*r+this.e33*a,X=this.e30*i-this.e31*t+this.e32*a,L=this.e21*s-this.e22*o+this.e23*i,p=this.e20*s-this.e22*r+this.e23*t,g=this.e20*o-this.e21*r+this.e23*a,F=this.e20*i-this.e21*t+this.e22*a,S=this.e00*b-this.e01*f+this.e02*n-this.e03*c;return S!=0&&(S=1/S),new x.common.Mat4(b*S,-M*S,z*S,-L*S,-f*S,m*S,-I*S,p*S,n*S,-y*S,w*S,-g*S,-c*S,V*S,-X*S,F*S)}inverseEq(){var a=this.e00*this.e11-this.e01*this.e10,t=this.e00*this.e12-this.e02*this.e10,r=this.e00*this.e13-this.e03*this.e10,i=this.e01*this.e12-this.e02*this.e11,o=this.e01*this.e13-this.e03*this.e11,s=this.e02*this.e13-this.e03*this.e12,_=this.e20*this.e31-this.e21*this.e30,h=this.e20*this.e32-this.e22*this.e30,v=this.e20*this.e33-this.e23*this.e30,e=this.e21*this.e32-this.e22*this.e31,l=this.e21*this.e33-this.e23*this.e31,u=this.e22*this.e33-this.e23*this.e32,b=this.e11*u-this.e12*l+this.e13*e,f=this.e10*u-this.e12*v+this.e13*h,n=this.e10*l-this.e11*v+this.e13*_,c=this.e10*e-this.e11*h+this.e12*_,M=this.e01*u-this.e02*l+this.e03*e,m=this.e00*u-this.e02*v+this.e03*h,y=this.e00*l-this.e01*v+this.e03*_,V=this.e00*e-this.e01*h+this.e02*_,z=this.e31*s-this.e32*o+this.e33*i,I=this.e30*s-this.e32*r+this.e33*t,w=this.e30*o-this.e31*r+this.e33*a,X=this.e30*i-this.e31*t+this.e32*a,L=this.e21*s-this.e22*o+this.e23*i,p=this.e20*s-this.e22*r+this.e23*t,g=this.e20*o-this.e21*r+this.e23*a,F=this.e20*i-this.e21*t+this.e22*a,S=this.e00*b-this.e01*f+this.e02*n-this.e03*c;S!=0&&(S=1/S);var N=b*S,A=-M*S,Y=z*S,R=-L*S,C=-f*S,d=m*S,Z=-I*S,j=p*S,H=n*S,E=-y*S,G=w*S,B=-g*S,Q=-c*S,W=V*S,J=-X*S,D=F*S;return this.e00=N,this.e01=A,this.e02=Y,this.e03=R,this.e10=C,this.e11=d,this.e12=Z,this.e13=j,this.e20=H,this.e21=E,this.e22=G,this.e23=B,this.e30=Q,this.e31=W,this.e32=J,this.e33=D,this}lookAt(a,t,r,i,o,s,_,h,v){var e=a-i,l=t-o,u=r-s,b=1/Math.sqrt(e*e+l*l+u*u);e*=b,l*=b,u*=b;var f=h*u-v*l,n=v*e-_*u,c=_*l-h*e;b=1/Math.sqrt(f*f+n*n+c*c),f*=b,n*=b,c*=b;var M=l*c-u*n,m=u*f-e*c,y=e*n-l*f;return this.e00=f,this.e01=n,this.e02=c,this.e03=-(f*a+n*t+c*r),this.e10=M,this.e11=m,this.e12=y,this.e13=-(M*a+m*t+y*r),this.e20=e,this.e21=l,this.e22=u,this.e23=-(e*a+l*t+u*r),this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}perspective(a,t,r,i){var o=1/Math.tan(a*.5),s=i/(r-i);return this.e00=o/t,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=o,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=s,this.e23=r*s,this.e30=0,this.e31=0,this.e32=-1,this.e33=0,this}ortho(a,t,r,i){var o=1/(r-i);return this.e00=2/a,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=2/t,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=o,this.e23=r*o,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}toArray(a){return a==null&&(a=!1),a?[this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33]:[this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33]}copyFrom(a){return this.e00=a.e00,this.e01=a.e01,this.e02=a.e02,this.e03=a.e03,this.e10=a.e10,this.e11=a.e11,this.e12=a.e12,this.e13=a.e13,this.e20=a.e20,this.e21=a.e21,this.e22=a.e22,this.e23=a.e23,this.e30=a.e30,this.e31=a.e31,this.e32=a.e32,this.e33=a.e33,this}fromMat3(a){var t=a.e00,r=a.e01,i=a.e02,o=0,s=a.e10,_=a.e11,h=a.e12,v=0,e=a.e20,l=a.e21,u=a.e22,b=0,f=0,n=0,c=0,M=1;return this.e00=t,this.e01=r,this.e02=i,this.e03=o,this.e10=s,this.e11=_,this.e12=h,this.e13=v,this.e20=e,this.e21=l,this.e22=u,this.e23=b,this.e30=f,this.e31=n,this.e32=c,this.e33=M,this}fromTransform(a){var t=this;return t.e00=a._rotation00,t.e01=a._rotation01,t.e02=a._rotation02,t.e10=a._rotation10,t.e11=a._rotation11,t.e12=a._rotation12,t.e20=a._rotation20,t.e21=a._rotation21,t.e22=a._rotation22,t.e03=a._positionX,t.e13=a._positionY,t.e23=a._positionZ,t.e30=0,t.e31=0,t.e32=0,t.e33=1,this}clone(){return new x.common.Mat4(this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33)}toString(){return"Mat4["+(this.e00>0?(this.e00*1e7+.5|0)/1e7:(this.e00*1e7-.5|0)/1e7)+", "+(this.e01>0?(this.e01*1e7+.5|0)/1e7:(this.e01*1e7-.5|0)/1e7)+", "+(this.e02>0?(this.e02*1e7+.5|0)/1e7:(this.e02*1e7-.5|0)/1e7)+", "+(this.e03>0?(this.e03*1e7+.5|0)/1e7:(this.e03*1e7-.5|0)/1e7)+`,
    `+(this.e10>0?(this.e10*1e7+.5|0)/1e7:(this.e10*1e7-.5|0)/1e7)+", "+(this.e11>0?(this.e11*1e7+.5|0)/1e7:(this.e11*1e7-.5|0)/1e7)+", "+(this.e12>0?(this.e12*1e7+.5|0)/1e7:(this.e12*1e7-.5|0)/1e7)+", "+(this.e13>0?(this.e13*1e7+.5|0)/1e7:(this.e13*1e7-.5|0)/1e7)+`,
    `+(this.e20>0?(this.e20*1e7+.5|0)/1e7:(this.e20*1e7-.5|0)/1e7)+", "+(this.e21>0?(this.e21*1e7+.5|0)/1e7:(this.e21*1e7-.5|0)/1e7)+", "+(this.e22>0?(this.e22*1e7+.5|0)/1e7:(this.e22*1e7-.5|0)/1e7)+", "+(this.e23>0?(this.e23*1e7+.5|0)/1e7:(this.e23*1e7-.5|0)/1e7)+`,
    `+(this.e30>0?(this.e30*1e7+.5|0)/1e7:(this.e30*1e7-.5|0)/1e7)+", "+(this.e31>0?(this.e31*1e7+.5|0)/1e7:(this.e31*1e7-.5|0)/1e7)+", "+(this.e32>0?(this.e32*1e7+.5|0)/1e7:(this.e32*1e7-.5|0)/1e7)+", "+(this.e33>0?(this.e33*1e7+.5|0)/1e7:(this.e33*1e7-.5|0)/1e7)+"]"}};x.common.MathUtil=class{static abs(a){return a>0?a:-a}static sin(a){return Math.sin(a)}static cos(a){return Math.cos(a)}static tan(a){return Math.tan(a)}static asin(a){return Math.asin(a)}static acos(a){return Math.acos(a)}static atan(a){return Math.atan(a)}static safeAsin(a){return a<=-1?-1.570796326794895:a>=1?1.570796326794895:Math.asin(a)}static safeAcos(a){return a<=-1?3.14159265358979:a>=1?0:Math.acos(a)}static atan2(a,t){return Math.atan2(a,t)}static sqrt(a){return Math.sqrt(a)}static clamp(a,t,r){return a<t?t:a>r?r:a}static rand(){return Math.random()}static randIn(a,t){return a+Math.random()*(t-a)}static randVec3In(a,t){return new x.common.Vec3(a+Math.random()*(t-a),a+Math.random()*(t-a),a+Math.random()*(t-a))}static randVec3(){return new x.common.Vec3(-1+Math.random()*2,-1+Math.random()*2,-1+Math.random()*2)}};x.common.Pool=class{constructor(){var a=new Array(256);this.stackVec3=a,this.sizeVec3=0;var t=new Array(256);this.stackMat3=t,this.sizeMat3=0;var r=new Array(256);this.stackMat4=r,this.sizeMat4=0;var i=new Array(256);this.stackQuat=i,this.sizeQuat=0}vec3(){return this.sizeVec3==0?new x.common.Vec3:this.stackVec3[--this.sizeVec3]}mat3(){return this.sizeMat3==0?new x.common.Mat3:this.stackMat3[--this.sizeMat3]}mat4(){return this.sizeMat4==0?new x.common.Mat4:this.stackMat4[--this.sizeMat4]}quat(){return this.sizeQuat==0?new x.common.Quat:this.stackQuat[--this.sizeQuat]}dispose(a,t,r,i){if(a!=null){if(a.zero(),this.sizeVec3==this.stackVec3.length){for(var o=this.sizeVec3<<1,s=new Array(o),_=s,h=0,v=this.sizeVec3;h<v;){var e=h++;_[e]=this.stackVec3[e],this.stackVec3[e]=null}this.stackVec3=_}this.stackVec3[this.sizeVec3++]=a}if(t!=null){var l=1,u=0,b=0,f=0,n=1,c=0,M=0,m=0,y=1;if(t.e00=l,t.e01=u,t.e02=b,t.e10=f,t.e11=n,t.e12=c,t.e20=M,t.e21=m,t.e22=y,this.sizeMat3==this.stackMat3.length){for(var V=this.sizeMat3<<1,z=new Array(V),I=z,w=0,X=this.sizeMat3;w<X;){var L=w++;I[L]=this.stackMat3[L],this.stackMat3[L]=null}this.stackMat3=I}this.stackMat3[this.sizeMat3++]=t}if(r!=null){var p=1,g=0,F=0,S=0,N=0,A=1,Y=0,R=0,C=0,d=0,Z=1,j=0,H=0,E=0,G=0,B=1;if(r.e00=p,r.e01=g,r.e02=F,r.e03=S,r.e10=N,r.e11=A,r.e12=Y,r.e13=R,r.e20=C,r.e21=d,r.e22=Z,r.e23=j,r.e30=H,r.e31=E,r.e32=G,r.e33=B,this.sizeMat4==this.stackMat4.length){for(var Q=this.sizeMat4<<1,W=new Array(Q),J=W,D=0,O=this.sizeMat4;D<O;){var K=D++;J[K]=this.stackMat4[K],this.stackMat4[K]=null}this.stackMat4=J}this.stackMat4[this.sizeMat4++]=r}if(i!=null){var ra=0,sa=0,$=0,q=1;if(i.x=ra,i.y=sa,i.z=$,i.w=q,this.sizeQuat==this.stackQuat.length){for(var na=this.sizeQuat<<1,oa=new Array(na),aa=oa,T=0,ca=this.sizeQuat;T<ca;){var _a=T++;aa[_a]=this.stackQuat[_a],this.stackQuat[_a]=null}this.stackQuat=aa}this.stackQuat[this.sizeQuat++]=i}}disposeVec3(a){if(a.zero(),this.sizeVec3==this.stackVec3.length){for(var t=this.sizeVec3<<1,r=new Array(t),i=r,o=0,s=this.sizeVec3;o<s;){var _=o++;i[_]=this.stackVec3[_],this.stackVec3[_]=null}this.stackVec3=i}this.stackVec3[this.sizeVec3++]=a}disposeMat3(a){var t=1,r=0,i=0,o=0,s=1,_=0,h=0,v=0,e=1;if(a.e00=t,a.e01=r,a.e02=i,a.e10=o,a.e11=s,a.e12=_,a.e20=h,a.e21=v,a.e22=e,this.sizeMat3==this.stackMat3.length){for(var l=this.sizeMat3<<1,u=new Array(l),b=u,f=0,n=this.sizeMat3;f<n;){var c=f++;b[c]=this.stackMat3[c],this.stackMat3[c]=null}this.stackMat3=b}this.stackMat3[this.sizeMat3++]=a}disposeMat4(a){var t=1,r=0,i=0,o=0,s=0,_=1,h=0,v=0,e=0,l=0,u=1,b=0,f=0,n=0,c=0,M=1;if(a.e00=t,a.e01=r,a.e02=i,a.e03=o,a.e10=s,a.e11=_,a.e12=h,a.e13=v,a.e20=e,a.e21=l,a.e22=u,a.e23=b,a.e30=f,a.e31=n,a.e32=c,a.e33=M,this.sizeMat4==this.stackMat4.length){for(var m=this.sizeMat4<<1,y=new Array(m),V=y,z=0,I=this.sizeMat4;z<I;){var w=z++;V[w]=this.stackMat4[w],this.stackMat4[w]=null}this.stackMat4=V}this.stackMat4[this.sizeMat4++]=a}disposeQuat(a){var t=0,r=0,i=0,o=1;if(a.x=t,a.y=r,a.z=i,a.w=o,this.sizeQuat==this.stackQuat.length){for(var s=this.sizeQuat<<1,_=new Array(s),h=_,v=0,e=this.sizeQuat;v<e;){var l=v++;h[l]=this.stackQuat[l],this.stackQuat[l]=null}this.stackQuat=h}this.stackQuat[this.sizeQuat++]=a}};x.common.Quat=class{constructor(a,t,r,i){i==null&&(i=1),r==null&&(r=0),t==null&&(t=0),a==null&&(a=0),this.x=a,this.y=t,this.z=r,this.w=i,x.common.Quat.numCreations++}identity(){var a=0,t=0,r=0,i=1;return this.x=a,this.y=t,this.z=r,this.w=i,this}init(a,t,r,i){return this.x=a,this.y=t,this.z=r,this.w=i,this}add(a){return new x.common.Quat(this.x+a.x,this.y+a.y,this.z+a.z,this.w+a.w)}sub(a){return new x.common.Quat(this.x-a.x,this.y-a.y,this.z-a.z,this.w-a.w)}scale(a){return new x.common.Quat(this.x*a,this.y*a,this.z*a,this.w*a)}addEq(a){var t=this.x+a.x,r=this.y+a.y,i=this.z+a.z,o=this.w+a.w;return this.x=t,this.y=r,this.z=i,this.w=o,this}subEq(a){var t=this.x-a.x,r=this.y-a.y,i=this.z-a.z,o=this.w-a.w;return this.x=t,this.y=r,this.z=i,this.w=o,this}scaleEq(a){var t=this.x*a,r=this.y*a,i=this.z*a,o=this.w*a;return this.x=t,this.y=r,this.z=i,this.w=o,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w}normalized(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return a>0&&(a=1/a),new x.common.Quat(this.x*a,this.y*a,this.z*a,this.w*a)}normalize(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);a>0&&(a=1/a);var t=this.x*a,r=this.y*a,i=this.z*a,o=this.w*a;return this.x=t,this.y=r,this.z=i,this.w=o,this}setArc(a,t){var r=a.x,i=a.y,o=a.z,s=t.x,_=t.y,h=t.z,v=r*s+i*_+o*h;if(this.w=Math.sqrt((1+v)*.5),this.w==0)return s=r*r,_=i*i,h=o*o,s<_?s<h?(v=1/Math.sqrt(_+h),this.x=0,this.y=o*v,this.z=-i*v):(v=1/Math.sqrt(s+_),this.z=0,this.x=i*v,this.y=-r*v):_<h?(v=1/Math.sqrt(h+s),this.y=0,this.z=r*v,this.x=-o*v):(v=1/Math.sqrt(s+_),this.z=0,this.x=i*v,this.y=-r*v),this;v=.5/this.w;var e=i*h-o*_,l=o*s-r*h,u=r*_-i*s;return this.x=e*v,this.y=l*v,this.z=u*v,this}slerp(a,t){var r,i,o,s,_=this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w;if(_<0?(_=-_,r=-a.x,i=-a.y,o=-a.z,s=-a.w):(r=a.x,i=a.y,o=a.z,s=a.w),_>.999999){var h=new x.common.Quat(this.x+(r-this.x)*t,this.y+(i-this.y)*t,this.z+(o-this.z)*t,this.w+(s-this.w)*t),v=Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z+h.w*h.w);v>0&&(v=1/v);var e=h.x*v,l=h.y*v,u=h.z*v,b=h.w*v;return h.x=e,h.y=l,h.z=u,h.w=b,h}var f=t*Math.acos(_);r-=this.x*_,i-=this.y*_,o-=this.z*_,s-=this.w*_;var n=1/Math.sqrt(r*r+i*i+o*o+s*s);r*=n,i*=n,o*=n,s*=n;var c=Math.sin(f),M=Math.cos(f);return new x.common.Quat(this.x*M+r*c,this.y*M+i*c,this.z*M+o*c,this.w*M+s*c)}copyFrom(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w,this}clone(){return new x.common.Quat(this.x,this.y,this.z,this.w)}fromMat3(a){var t=a.e00,r=a.e11,i=a.e22,o=t+r+i,s;return o>0?(s=Math.sqrt(o+1),this.w=.5*s,s=.5/s,this.x=(a.e21-a.e12)*s,this.y=(a.e02-a.e20)*s,this.z=(a.e10-a.e01)*s):t>r?t>i?(s=Math.sqrt(t-r-i+1),this.x=.5*s,s=.5/s,this.y=(a.e01+a.e10)*s,this.z=(a.e02+a.e20)*s,this.w=(a.e21-a.e12)*s):(s=Math.sqrt(i-t-r+1),this.z=.5*s,s=.5/s,this.x=(a.e02+a.e20)*s,this.y=(a.e12+a.e21)*s,this.w=(a.e10-a.e01)*s):r>i?(s=Math.sqrt(r-i-t+1),this.y=.5*s,s=.5/s,this.x=(a.e01+a.e10)*s,this.z=(a.e12+a.e21)*s,this.w=(a.e02-a.e20)*s):(s=Math.sqrt(i-t-r+1),this.z=.5*s,s=.5/s,this.x=(a.e02+a.e20)*s,this.y=(a.e12+a.e21)*s,this.w=(a.e10-a.e01)*s),this}toMat3(){var a=new x.common.Mat3,t=this.x,r=this.y,i=this.z,o=this.w,s=2*t,_=2*r,h=2*i,v=t*s,e=r*_,l=i*h,u=t*_,b=r*h,f=t*h,n=o*s,c=o*_,M=o*h;return a.e00=1-e-l,a.e01=u-M,a.e02=f+c,a.e10=u+M,a.e11=1-v-l,a.e12=b-n,a.e20=f-c,a.e21=b+n,a.e22=1-v-e,a}toString(){return"Quat["+(this.x>0?(this.x*1e7+.5|0)/1e7:(this.x*1e7-.5|0)/1e7)+` i,
    `+(this.y>0?(this.y*1e7+.5|0)/1e7:(this.y*1e7-.5|0)/1e7)+` j,
    `+(this.z>0?(this.z*1e7+.5|0)/1e7:(this.z*1e7-.5|0)/1e7)+` k,
    `+(this.w>0?(this.w*1e7+.5|0)/1e7:(this.w*1e7-.5|0)/1e7)+"]"}};x.dynamics||(x.dynamics={});x.dynamics.Contact=class{constructor(){this._next=null,this._prev=null,this._link1=new x.dynamics.ContactLink,this._link2=new x.dynamics.ContactLink,this._s1=null,this._s2=null,this._b1=null,this._b2=null,this._detector=null,this._cachedDetectorData=new x.collision.narrowphase.detector.CachedDetectorData,this._detectorResult=new x.collision.narrowphase.DetectorResult,this._latest=!1,this._shouldBeSkipped=!1,this._manifold=new x.dynamics.constraint.contact.Manifold,this._updater=new x.dynamics.constraint.contact.ManifoldUpdater(this._manifold),this._contactConstraint=new x.dynamics.constraint.contact.ContactConstraint(this._manifold),this._touching=!1}_updateManifold(){if(this._detector!=null){var a=this._touching,t=this._detectorResult;this._detector.detect(t,this._s1._geom,this._s2._geom,this._s1._transform,this._s2._transform,this._cachedDetectorData);var r=t.numPoints;if(this._touching=r>0,this._touching?(this._manifold._buildBasis(t.normal),t.getMaxDepth()>x.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold?this._contactConstraint._positionCorrectionAlgorithm=x.common.Setting.alternativeContactPositionCorrectionAlgorithm:this._contactConstraint._positionCorrectionAlgorithm=x.common.Setting.defaultContactPositionCorrectionAlgorithm,t.incremental?this._updater.incrementalUpdate(t,this._b1._transform,this._b2._transform):this._updater.totalUpdate(t,this._b1._transform,this._b2._transform)):this._manifold._clear(),this._touching&&!a){var i=this._s1._contactCallback,o=this._s2._contactCallback;i==o&&(o=null),i?.beginContact(this),o?.beginContact(this)}if(!this._touching&&a){var s=this._s1._contactCallback,_=this._s2._contactCallback;s==_&&(_=null),s?.endContact(this),_?.endContact(this)}if(this._touching){var h=this._s1._contactCallback,v=this._s2._contactCallback;h==v&&(v=null),h?.preSolve(this),v?.preSolve(this)}}}_postSolve(){var a=this._s1._contactCallback,t=this._s2._contactCallback;a==t&&(t=null),a?.postSolve(this),t?.postSolve(this)}getShape1(){return this._s1}getShape2(){return this._s2}isTouching(){return this._touching}getManifold(){return this._manifold}getContactConstraint(){return this._contactConstraint}getPrev(){return this._prev}getNext(){return this._next}};x.dynamics.ContactLink=class{constructor(){this._prev=null,this._next=null,this._contact=null,this._other=null}getContact(){return this._contact}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}};x.dynamics.ContactManager=class{constructor(a){this._broadPhase=a,this._collisionMatrix=new x.collision.narrowphase.CollisionMatrix,this._numContacts=0}createContacts(){for(var a=this._broadPhase._proxyPairList;a!=null;){for(var t=a._next;;){var r,i;if(a._p1._id<a._p2._id?(r=a._p1.userData,i=a._p2.userData):(r=a._p2.userData,i=a._p1.userData),!this.shouldCollide(r,i))break;var o=r._rigidBody,s=i._rigidBody,_=o._numContactLinks,h=s._numContactLinks,v;_<h?v=o._contactLinkList:v=s._contactLinkList;for(var e=r._id,l=i._id,u=!1;v!=null;){var b=v._next,f=v._contact;if(f._s1._id==e&&f._s2._id==l){f._latest=!0,u=!0;break}v=b}if(!u){var n=this._contactPool;n!=null?(this._contactPool=n._next,n._next=null):n=new x.dynamics.Contact;var c=n;this._contactList==null?(this._contactList=c,this._contactListLast=c):(this._contactListLast._next=c,c._prev=this._contactListLast,this._contactListLast=c),c._latest=!0;var M=this._collisionMatrix.detectors[r._geom._type][i._geom._type];c._s1=r,c._s2=i,c._b1=r._rigidBody,c._b2=i._rigidBody,c._touching=!1,c._b1._contactLinkList==null?(c._b1._contactLinkList=c._link1,c._b1._contactLinkListLast=c._link1):(c._b1._contactLinkListLast._next=c._link1,c._link1._prev=c._b1._contactLinkListLast,c._b1._contactLinkListLast=c._link1),c._b2._contactLinkList==null?(c._b2._contactLinkList=c._link2,c._b2._contactLinkListLast=c._link2):(c._b2._contactLinkListLast._next=c._link2,c._link2._prev=c._b2._contactLinkListLast,c._b2._contactLinkListLast=c._link2),c._b1._numContactLinks++,c._b2._numContactLinks++,c._link1._other=c._b2,c._link2._other=c._b1,c._link1._contact=c,c._link2._contact=c,c._detector=M;var m=c._contactConstraint;m._s1=r,m._s2=i,m._b1=m._s1._rigidBody,m._b2=m._s2._rigidBody,m._tf1=m._b1._transform,m._tf2=m._b2._transform,this._numContacts++}break}a=t}}destroyOutdatedContacts(){for(var a=this._broadPhase._incremental,t=this._contactList;t!=null;){for(var r=t._next;;){if(t._latest){t._latest=!1,t._shouldBeSkipped=!1;break}if(!a){var i=t._prev,o=t._next;if(i!=null&&(i._next=o),o!=null&&(o._prev=i),t==this._contactList&&(this._contactList=this._contactList._next),t==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),t._next=null,t._prev=null,t._touching){var s=t._s1._contactCallback,_=t._s2._contactCallback;s==_&&(_=null),s?.endContact(t),_?.endContact(t)}var h=t._link1._prev,v=t._link1._next;h!=null&&(h._next=v),v!=null&&(v._prev=h),t._link1==t._b1._contactLinkList&&(t._b1._contactLinkList=t._b1._contactLinkList._next),t._link1==t._b1._contactLinkListLast&&(t._b1._contactLinkListLast=t._b1._contactLinkListLast._prev),t._link1._next=null,t._link1._prev=null;var e=t._link2._prev,l=t._link2._next;e!=null&&(e._next=l),l!=null&&(l._prev=e),t._link2==t._b2._contactLinkList&&(t._b2._contactLinkList=t._b2._contactLinkList._next),t._link2==t._b2._contactLinkListLast&&(t._b2._contactLinkListLast=t._b2._contactLinkListLast._prev),t._link2._next=null,t._link2._prev=null,t._b1._numContactLinks--,t._b2._numContactLinks--,t._link1._other=null,t._link2._other=null,t._link1._contact=null,t._link2._contact=null,t._s1=null,t._s2=null,t._b1=null,t._b2=null,t._touching=!1,t._cachedDetectorData._clear(),t._manifold._clear(),t._detector=null;var u=t._contactConstraint;u._s1=null,u._s2=null,u._b1=null,u._b2=null,u._tf1=null,u._tf2=null,t._next=this._contactPool,this._contactPool=t,this._numContacts--;break}var b=t._s1,f=t._s2,n=b._rigidBody,c=f._rigidBody,M=!n._sleeping&&n._type!=1,m=!c._sleeping&&c._type!=1;if(!M&&!m){t._shouldBeSkipped=!0;break}var y=b._aabb,V=f._aabb,z=b._proxy,I=f._proxy;if(!(z._aabbMinX<I._aabbMaxX&&z._aabbMaxX>I._aabbMinX&&z._aabbMinY<I._aabbMaxY&&z._aabbMaxY>I._aabbMinY&&z._aabbMinZ<I._aabbMaxZ&&z._aabbMaxZ>I._aabbMinZ)||!this.shouldCollide(b,f)){var w=t._prev,X=t._next;if(w!=null&&(w._next=X),X!=null&&(X._prev=w),t==this._contactList&&(this._contactList=this._contactList._next),t==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),t._next=null,t._prev=null,t._touching){var L=t._s1._contactCallback,p=t._s2._contactCallback;L==p&&(p=null),L?.endContact(t),p?.endContact(t)}var g=t._link1._prev,F=t._link1._next;g!=null&&(g._next=F),F!=null&&(F._prev=g),t._link1==t._b1._contactLinkList&&(t._b1._contactLinkList=t._b1._contactLinkList._next),t._link1==t._b1._contactLinkListLast&&(t._b1._contactLinkListLast=t._b1._contactLinkListLast._prev),t._link1._next=null,t._link1._prev=null;var S=t._link2._prev,N=t._link2._next;S!=null&&(S._next=N),N!=null&&(N._prev=S),t._link2==t._b2._contactLinkList&&(t._b2._contactLinkList=t._b2._contactLinkList._next),t._link2==t._b2._contactLinkListLast&&(t._b2._contactLinkListLast=t._b2._contactLinkListLast._prev),t._link2._next=null,t._link2._prev=null,t._b1._numContactLinks--,t._b2._numContactLinks--,t._link1._other=null,t._link2._other=null,t._link1._contact=null,t._link2._contact=null,t._s1=null,t._s2=null,t._b1=null,t._b2=null,t._touching=!1,t._cachedDetectorData._clear(),t._manifold._clear(),t._detector=null;var A=t._contactConstraint;A._s1=null,A._s2=null,A._b1=null,A._b2=null,A._tf1=null,A._tf2=null,t._next=this._contactPool,this._contactPool=t,this._numContacts--;break}var Y=y._minX<V._maxX&&y._maxX>V._minX&&y._minY<V._maxY&&y._maxY>V._minY&&y._minZ<V._maxZ&&y._maxZ>V._minZ;t._shouldBeSkipped=!Y;break}t=r}}shouldCollide(a,t){var r=a._rigidBody,i=t._rigidBody;if(r==i||r._type!=0&&i._type!=0||!(a._collisionGroup&t._collisionMask)||!(t._collisionGroup&a._collisionMask))return!1;var o,s;for(r._numJointLinks<i._numJointLinks?(o=r._jointLinkList,s=i):(o=i._jointLinkList,s=r);o!=null;){var _=o._next;if(o._other==s&&!o._joint._allowCollision)return!1;o=_}return!0}_updateContacts(){this._broadPhase.collectPairs(),this.createContacts(),this.destroyOutdatedContacts()}_postSolve(){for(var a=this._contactList;a!=null;){var t=a._next;a._touching&&a._postSolve(),a=t}}getNumContacts(){return this._numContacts}getContactList(){return this._contactList}};x.dynamics.Island=class{constructor(){var a=new Array(x.common.Setting.islandInitialRigidBodyArraySize);this.rigidBodies=a;var t=new Array(x.common.Setting.islandInitialConstraintArraySize);this.solvers=t;var r=new Array(x.common.Setting.islandInitialConstraintArraySize);this.solversSi=r;var i=new Array(x.common.Setting.islandInitialConstraintArraySize);this.solversNgs=i,this.numRigidBodies=0,this.numSolvers=0,this.numSolversSi=0,this.numSolversNgs=0}_clear(){for(;this.numRigidBodies>0;)this.rigidBodies[--this.numRigidBodies]=null;for(;this.numSolvers>0;)this.solvers[--this.numSolvers]=null;for(;this.numSolversSi>0;)this.solversSi[--this.numSolversSi]=null;for(;this.numSolversNgs>0;)this.solversNgs[--this.numSolversNgs]=null}_addRigidBody(a){if(this.numRigidBodies==this.rigidBodies.length){for(var t=this.numRigidBodies<<1,r=new Array(t),i=r,o=0,s=this.numRigidBodies;o<s;){var _=o++;i[_]=this.rigidBodies[_],this.rigidBodies[_]=null}this.rigidBodies=i}a._addedToIsland=!0,this.rigidBodies[this.numRigidBodies++]=a}_addConstraintSolver(a,t){if(this.numSolvers==this.solvers.length){for(var r=this.numSolvers<<1,i=new Array(r),o=i,s=0,_=this.numSolvers;s<_;){var h=s++;o[h]=this.solvers[h],this.solvers[h]=null}this.solvers=o}if(a._addedToIsland=!0,this.solvers[this.numSolvers++]=a,t==x.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE){if(this.numSolversSi==this.solversSi.length){for(var v=this.numSolversSi<<1,e=new Array(v),l=e,u=0,b=this.numSolversSi;u<b;){var f=u++;l[f]=this.solversSi[f],this.solversSi[f]=null}this.solversSi=l}this.solversSi[this.numSolversSi++]=a}if(t==x.dynamics.constraint.PositionCorrectionAlgorithm.NGS){if(this.numSolversNgs==this.solversNgs.length){for(var n=this.numSolversNgs<<1,c=new Array(n),M=c,m=0,y=this.numSolversNgs;m<y;){var V=m++;M[V]=this.solversNgs[V],this.solversNgs[V]=null}this.solversNgs=M}this.solversNgs[this.numSolversNgs++]=a}}_stepSingleRigidBody(a,t){var r=a.dt,i=t._ptransform,o=t._transform;if(i._positionX=o._positionX,i._positionY=o._positionY,i._positionZ=o._positionZ,i._rotation00=o._rotation00,i._rotation01=o._rotation01,i._rotation02=o._rotation02,i._rotation10=o._rotation10,i._rotation11=o._rotation11,i._rotation12=o._rotation12,i._rotation20=o._rotation20,i._rotation21=o._rotation21,i._rotation22=o._rotation22,t._linearContactImpulseX=0,t._linearContactImpulseY=0,t._linearContactImpulseZ=0,t._angularContactImpulseX=0,t._angularContactImpulseY=0,t._angularContactImpulseZ=0,t._autoSleep&&t._velX*t._velX+t._velY*t._velY+t._velZ*t._velZ<x.common.Setting.sleepingVelocityThreshold*x.common.Setting.sleepingVelocityThreshold&&t._angVelX*t._angVelX+t._angVelY*t._angVelY+t._angVelZ*t._angVelZ<x.common.Setting.sleepingAngularVelocityThreshold*x.common.Setting.sleepingAngularVelocityThreshold?(t._sleepTime+=r,t._sleepTime>x.common.Setting.sleepingTimeThreshold&&(t._sleeping=!0,t._sleepTime=0)):t._sleepTime=0,!t._sleeping){if(t._type==0){var s=r*t._linearDamping,_=s*s,h=1/(1+s+_*(.5+s*.16666666666666666+_*.041666666666666664)),v=r*t._angularDamping,e=v*v,l=1/(1+v+e*(.5+v*.16666666666666666+e*.041666666666666664)),u,b,f,n,c,M;u=this.gravityX*t._gravityScale,b=this.gravityY*t._gravityScale,f=this.gravityZ*t._gravityScale,u+=t._forceX*t._invMass,b+=t._forceY*t._invMass,f+=t._forceZ*t._invMass;var m,y,V;m=t._invInertia00*t._torqueX+t._invInertia01*t._torqueY+t._invInertia02*t._torqueZ,y=t._invInertia10*t._torqueX+t._invInertia11*t._torqueY+t._invInertia12*t._torqueZ,V=t._invInertia20*t._torqueX+t._invInertia21*t._torqueY+t._invInertia22*t._torqueZ,n=m,c=y,M=V,t._velX+=u*r,t._velY+=b*r,t._velZ+=f*r,t._velX*=h,t._velY*=h,t._velZ*=h,t._angVelX+=n*r,t._angVelY+=c*r,t._angVelZ+=M*r,t._angVelX*=l,t._angVelY*=l,t._angVelZ*=l}t._integrate(r);for(var z=t._shapeList;z!=null;){var I=z._next,w=z._ptransform,X=z._localTransform,L=t._ptransform,p,g,F,S,N,A,Y,R,C;p=L._rotation00*X._rotation00+L._rotation01*X._rotation10+L._rotation02*X._rotation20,g=L._rotation00*X._rotation01+L._rotation01*X._rotation11+L._rotation02*X._rotation21,F=L._rotation00*X._rotation02+L._rotation01*X._rotation12+L._rotation02*X._rotation22,S=L._rotation10*X._rotation00+L._rotation11*X._rotation10+L._rotation12*X._rotation20,N=L._rotation10*X._rotation01+L._rotation11*X._rotation11+L._rotation12*X._rotation21,A=L._rotation10*X._rotation02+L._rotation11*X._rotation12+L._rotation12*X._rotation22,Y=L._rotation20*X._rotation00+L._rotation21*X._rotation10+L._rotation22*X._rotation20,R=L._rotation20*X._rotation01+L._rotation21*X._rotation11+L._rotation22*X._rotation21,C=L._rotation20*X._rotation02+L._rotation21*X._rotation12+L._rotation22*X._rotation22,w._rotation00=p,w._rotation01=g,w._rotation02=F,w._rotation10=S,w._rotation11=N,w._rotation12=A,w._rotation20=Y,w._rotation21=R,w._rotation22=C;var d,Z,j;d=L._rotation00*X._positionX+L._rotation01*X._positionY+L._rotation02*X._positionZ,Z=L._rotation10*X._positionX+L._rotation11*X._positionY+L._rotation12*X._positionZ,j=L._rotation20*X._positionX+L._rotation21*X._positionY+L._rotation22*X._positionZ,w._positionX=d,w._positionY=Z,w._positionZ=j,w._positionX+=L._positionX,w._positionY+=L._positionY,w._positionZ+=L._positionZ;var H=z._transform,E=z._localTransform,G=t._transform,B,Q,W,J,D,O,K,ra,sa;B=G._rotation00*E._rotation00+G._rotation01*E._rotation10+G._rotation02*E._rotation20,Q=G._rotation00*E._rotation01+G._rotation01*E._rotation11+G._rotation02*E._rotation21,W=G._rotation00*E._rotation02+G._rotation01*E._rotation12+G._rotation02*E._rotation22,J=G._rotation10*E._rotation00+G._rotation11*E._rotation10+G._rotation12*E._rotation20,D=G._rotation10*E._rotation01+G._rotation11*E._rotation11+G._rotation12*E._rotation21,O=G._rotation10*E._rotation02+G._rotation11*E._rotation12+G._rotation12*E._rotation22,K=G._rotation20*E._rotation00+G._rotation21*E._rotation10+G._rotation22*E._rotation20,ra=G._rotation20*E._rotation01+G._rotation21*E._rotation11+G._rotation22*E._rotation21,sa=G._rotation20*E._rotation02+G._rotation21*E._rotation12+G._rotation22*E._rotation22,H._rotation00=B,H._rotation01=Q,H._rotation02=W,H._rotation10=J,H._rotation11=D,H._rotation12=O,H._rotation20=K,H._rotation21=ra,H._rotation22=sa;var $,q,na;$=G._rotation00*E._positionX+G._rotation01*E._positionY+G._rotation02*E._positionZ,q=G._rotation10*E._positionX+G._rotation11*E._positionY+G._rotation12*E._positionZ,na=G._rotation20*E._positionX+G._rotation21*E._positionY+G._rotation22*E._positionZ,H._positionX=$,H._positionY=q,H._positionZ=na,H._positionX+=G._positionX,H._positionY+=G._positionY,H._positionZ+=G._positionZ;var oa,aa,T,ca,_a,k;if(z._geom._computeAabb(z._aabb,z._ptransform),oa=z._aabb._minX,aa=z._aabb._minY,T=z._aabb._minZ,ca=z._aabb._maxX,_a=z._aabb._maxY,k=z._aabb._maxZ,z._geom._computeAabb(z._aabb,z._transform),z._aabb._minX=oa<z._aabb._minX?oa:z._aabb._minX,z._aabb._minY=aa<z._aabb._minY?aa:z._aabb._minY,z._aabb._minZ=T<z._aabb._minZ?T:z._aabb._minZ,z._aabb._maxX=ca>z._aabb._maxX?ca:z._aabb._maxX,z._aabb._maxY=_a>z._aabb._maxY?_a:z._aabb._maxY,z._aabb._maxZ=k>z._aabb._maxZ?k:z._aabb._maxZ,z._proxy!=null){var ta,ia,la;ta=z._transform._positionX-z._ptransform._positionX,ia=z._transform._positionY-z._ptransform._positionY,la=z._transform._positionZ-z._ptransform._positionZ;var va=z.displacement;va.x=ta,va.y=ia,va.z=la,z._rigidBody._world._broadPhase.moveProxy(z._proxy,z._aabb,z.displacement)}z=I}}}_step(a,t,r){for(var i=a.dt,o=!0,s=0,_=this.numRigidBodies;s<_;){var h=s++,v=this.rigidBodies[h],e=v._ptransform,l=v._transform;if(e._positionX=l._positionX,e._positionY=l._positionY,e._positionZ=l._positionZ,e._rotation00=l._rotation00,e._rotation01=l._rotation01,e._rotation02=l._rotation02,e._rotation10=l._rotation10,e._rotation11=l._rotation11,e._rotation12=l._rotation12,e._rotation20=l._rotation20,e._rotation21=l._rotation21,e._rotation22=l._rotation22,v._linearContactImpulseX=0,v._linearContactImpulseY=0,v._linearContactImpulseZ=0,v._angularContactImpulseX=0,v._angularContactImpulseY=0,v._angularContactImpulseZ=0,v._sleeping=!1,v._autoSleep&&v._velX*v._velX+v._velY*v._velY+v._velZ*v._velZ<x.common.Setting.sleepingVelocityThreshold*x.common.Setting.sleepingVelocityThreshold&&v._angVelX*v._angVelX+v._angVelY*v._angVelY+v._angVelZ*v._angVelZ<x.common.Setting.sleepingAngularVelocityThreshold*x.common.Setting.sleepingAngularVelocityThreshold?v._sleepTime+=i:v._sleepTime=0,v._sleepTime<x.common.Setting.sleepingTimeThreshold&&(o=!1),v._type==0){var u=i*v._linearDamping,b=u*u,f=1/(1+u+b*(.5+u*.16666666666666666+b*.041666666666666664)),n=i*v._angularDamping,c=n*n,M=1/(1+n+c*(.5+n*.16666666666666666+c*.041666666666666664)),m,y,V,z,I,w;m=this.gravityX*v._gravityScale,y=this.gravityY*v._gravityScale,V=this.gravityZ*v._gravityScale,m+=v._forceX*v._invMass,y+=v._forceY*v._invMass,V+=v._forceZ*v._invMass;var X,L,p;X=v._invInertia00*v._torqueX+v._invInertia01*v._torqueY+v._invInertia02*v._torqueZ,L=v._invInertia10*v._torqueX+v._invInertia11*v._torqueY+v._invInertia12*v._torqueZ,p=v._invInertia20*v._torqueX+v._invInertia21*v._torqueY+v._invInertia22*v._torqueZ,z=X,I=L,w=p,v._velX+=m*i,v._velY+=y*i,v._velZ+=V*i,v._velX*=f,v._velY*=f,v._velZ*=f,v._angVelX+=z*i,v._angVelY+=I*i,v._angVelZ+=w*i,v._angVelX*=M,v._angVelY*=M,v._angVelZ*=M}}if(o){for(var g=0,F=this.numRigidBodies;g<F;){var S=g++,N=this.rigidBodies[S];N._sleeping=!0,N._sleepTime=0}return}for(var A=0,Y=this.numSolvers;A<Y;){var R=A++,C=this.solvers[R];C.preSolveVelocity(a)}for(var d=0,Z=this.numSolvers;d<Z;){var j=d++,H=this.solvers[j];H.warmStart(a)}for(var E=0,G=t;E<G;){E++;for(var B=0,Q=this.numSolvers;B<Q;){var W=B++,J=this.solvers[W];J.solveVelocity()}}for(var D=0,O=this.numSolvers;D<O;){var K=D++,ra=this.solvers[K];ra.postSolveVelocity(a)}for(var sa=0,$=this.numRigidBodies;sa<$;){var q=sa++,na=this.rigidBodies[q];na._integrate(i)}for(var oa=0,aa=this.numSolversSi;oa<aa;){var T=oa++,ca=this.solversSi[T];ca.preSolvePosition(a)}for(var _a=0,k=r;_a<k;){_a++;for(var ta=0,ia=this.numSolversSi;ta<ia;){var la=ta++,va=this.solversSi[la];va.solvePositionSplitImpulse()}}for(var xa=0,Ma=this.numRigidBodies;xa<Ma;){var za=xa++,Xa=this.rigidBodies[za];Xa._integratePseudoVelocity()}for(var Za=0,fa=this.numSolversNgs;Za<fa;){var ba=Za++,ea=this.solversNgs[ba];ea.preSolvePosition(a)}for(var ha=0,pa=r;ha<pa;){ha++;for(var ya=0,da=this.numSolversNgs;ya<da;){var ma=ya++,Ya=this.solversNgs[ma];Ya.solvePositionNgs(a)}}for(var Qa=0,ga=this.numSolvers;Qa<ga;){var ua=Qa++,ka=this.solvers[ua];ka.postSolve()}for(var wa=0,Pa=this.numRigidBodies;wa<Pa;)for(var Mt=wa++,Oa=this.rigidBodies[Mt],Ba=Oa._shapeList;Ba!=null;){var nt=Ba._next,Ea=Ba._ptransform,Na=Ba._localTransform,Sa=Oa._ptransform,ft,Wa,Ha,bt,rt,ja,_t,gt,mt;ft=Sa._rotation00*Na._rotation00+Sa._rotation01*Na._rotation10+Sa._rotation02*Na._rotation20,Wa=Sa._rotation00*Na._rotation01+Sa._rotation01*Na._rotation11+Sa._rotation02*Na._rotation21,Ha=Sa._rotation00*Na._rotation02+Sa._rotation01*Na._rotation12+Sa._rotation02*Na._rotation22,bt=Sa._rotation10*Na._rotation00+Sa._rotation11*Na._rotation10+Sa._rotation12*Na._rotation20,rt=Sa._rotation10*Na._rotation01+Sa._rotation11*Na._rotation11+Sa._rotation12*Na._rotation21,ja=Sa._rotation10*Na._rotation02+Sa._rotation11*Na._rotation12+Sa._rotation12*Na._rotation22,_t=Sa._rotation20*Na._rotation00+Sa._rotation21*Na._rotation10+Sa._rotation22*Na._rotation20,gt=Sa._rotation20*Na._rotation01+Sa._rotation21*Na._rotation11+Sa._rotation22*Na._rotation21,mt=Sa._rotation20*Na._rotation02+Sa._rotation21*Na._rotation12+Sa._rotation22*Na._rotation22,Ea._rotation00=ft,Ea._rotation01=Wa,Ea._rotation02=Ha,Ea._rotation10=bt,Ea._rotation11=rt,Ea._rotation12=ja,Ea._rotation20=_t,Ea._rotation21=gt,Ea._rotation22=mt;var Ja,it,ut;Ja=Sa._rotation00*Na._positionX+Sa._rotation01*Na._positionY+Sa._rotation02*Na._positionZ,it=Sa._rotation10*Na._positionX+Sa._rotation11*Na._positionY+Sa._rotation12*Na._positionZ,ut=Sa._rotation20*Na._positionX+Sa._rotation21*Na._positionY+Sa._rotation22*Na._positionZ,Ea._positionX=Ja,Ea._positionY=it,Ea._positionZ=ut,Ea._positionX+=Sa._positionX,Ea._positionY+=Sa._positionY,Ea._positionZ+=Sa._positionZ;var Da=Ba._transform,Ta=Ba._localTransform,Fa=Oa._transform,Vt,Pt,et,Xt,Yt,zt,Ia,U,Va;Vt=Fa._rotation00*Ta._rotation00+Fa._rotation01*Ta._rotation10+Fa._rotation02*Ta._rotation20,Pt=Fa._rotation00*Ta._rotation01+Fa._rotation01*Ta._rotation11+Fa._rotation02*Ta._rotation21,et=Fa._rotation00*Ta._rotation02+Fa._rotation01*Ta._rotation12+Fa._rotation02*Ta._rotation22,Xt=Fa._rotation10*Ta._rotation00+Fa._rotation11*Ta._rotation10+Fa._rotation12*Ta._rotation20,Yt=Fa._rotation10*Ta._rotation01+Fa._rotation11*Ta._rotation11+Fa._rotation12*Ta._rotation21,zt=Fa._rotation10*Ta._rotation02+Fa._rotation11*Ta._rotation12+Fa._rotation12*Ta._rotation22,Ia=Fa._rotation20*Ta._rotation00+Fa._rotation21*Ta._rotation10+Fa._rotation22*Ta._rotation20,U=Fa._rotation20*Ta._rotation01+Fa._rotation21*Ta._rotation11+Fa._rotation22*Ta._rotation21,Va=Fa._rotation20*Ta._rotation02+Fa._rotation21*Ta._rotation12+Fa._rotation22*Ta._rotation22,Da._rotation00=Vt,Da._rotation01=Pt,Da._rotation02=et,Da._rotation10=Xt,Da._rotation11=Yt,Da._rotation12=zt,Da._rotation20=Ia,Da._rotation21=U,Da._rotation22=Va;var lt,P,kt;lt=Fa._rotation00*Ta._positionX+Fa._rotation01*Ta._positionY+Fa._rotation02*Ta._positionZ,P=Fa._rotation10*Ta._positionX+Fa._rotation11*Ta._positionY+Fa._rotation12*Ta._positionZ,kt=Fa._rotation20*Ta._positionX+Fa._rotation21*Ta._positionY+Fa._rotation22*Ta._positionZ,Da._positionX=lt,Da._positionY=P,Da._positionZ=kt,Da._positionX+=Fa._positionX,Da._positionY+=Fa._positionY,Da._positionZ+=Fa._positionZ;var Bt,St,yt,wt,pt,ht;if(Ba._geom._computeAabb(Ba._aabb,Ba._ptransform),Bt=Ba._aabb._minX,St=Ba._aabb._minY,yt=Ba._aabb._minZ,wt=Ba._aabb._maxX,pt=Ba._aabb._maxY,ht=Ba._aabb._maxZ,Ba._geom._computeAabb(Ba._aabb,Ba._transform),Ba._aabb._minX=Bt<Ba._aabb._minX?Bt:Ba._aabb._minX,Ba._aabb._minY=St<Ba._aabb._minY?St:Ba._aabb._minY,Ba._aabb._minZ=yt<Ba._aabb._minZ?yt:Ba._aabb._minZ,Ba._aabb._maxX=wt>Ba._aabb._maxX?wt:Ba._aabb._maxX,Ba._aabb._maxY=pt>Ba._aabb._maxY?pt:Ba._aabb._maxY,Ba._aabb._maxZ=ht>Ba._aabb._maxZ?ht:Ba._aabb._maxZ,Ba._proxy!=null){var xt,Ra,st;xt=Ba._transform._positionX-Ba._ptransform._positionX,Ra=Ba._transform._positionY-Ba._ptransform._positionY,st=Ba._transform._positionZ-Ba._ptransform._positionZ;var Ca=Ba.displacement;Ca.x=xt,Ca.y=Ra,Ca.z=st,Ba._rigidBody._world._broadPhase.moveProxy(Ba._proxy,Ba._aabb,Ba.displacement)}Ba=nt}}};x.dynamics.TimeStep=class{constructor(){this.dt=0,this.invDt=0,this.dtRatio=1}};x.dynamics.World=class{constructor(a,t){switch(a==null&&(a=2),a){case 1:this._broadPhase=new x.collision.broadphase.bruteforce.BruteForceBroadPhase;break;case 2:this._broadPhase=new x.collision.broadphase.bvh.BvhBroadPhase;break}this._contactManager=new x.dynamics.ContactManager(this._broadPhase),t==null&&(t=new x.common.Vec3(0,-9.80665,0)),this._gravity=new x.common.Vec3(t.x,t.y,t.z),this._rigidBodyList=null,this._rigidBodyListLast=null,this._jointList=null,this._jointListLast=null,this._numRigidBodies=0,this._numShapes=0,this._numJoints=0,this._numIslands=0,this._numVelocityIterations=10,this._numPositionIterations=5,this._rayCastWrapper=new x.dynamics._World.RayCastWrapper,this._convexCastWrapper=new x.dynamics._World.ConvexCastWrapper,this._aabbTestWrapper=new x.dynamics._World.AabbTestWrapper,this._island=new x.dynamics.Island;var r=new Array(x.common.Setting.islandInitialConstraintArraySize);this._solversInIslands=r;var i=new Array(x.common.Setting.islandInitialRigidBodyArraySize);this._rigidBodyStack=i,this._timeStep=new x.dynamics.TimeStep,this._pool=new x.common.Pool,this._shapeIdCount=0}_updateContacts(){var a=Date.now()/1e3;this._contactManager._updateContacts();var t=Date.now()/1e3;x.dynamics.common.Performance.broadPhaseCollisionTime=(t-a)*1e3;for(var r=Date.now()/1e3,i=this._contactManager._contactList;i!=null;){var o=i._next;i._shouldBeSkipped||i._updateManifold(),i=o}var s=Date.now()/1e3;x.dynamics.common.Performance.narrowPhaseCollisionTime=(s-r)*1e3}_solveIslands(){var a=Date.now()/1e3;if(x.common.Setting.disableSleeping)for(var t=this._rigidBodyList;t!=null;){var r=t._next;t._sleeping=!1,t._sleepTime=0,t=r}if(this._rigidBodyStack.length<this._numRigidBodies){for(var i=this._rigidBodyStack.length<<1;i<this._numRigidBodies;)i<<=1;var o=new Array(i);this._rigidBodyStack=o}this._numIslands=0;var s=this._island,_=this._gravity;s.gravityX=_.x,s.gravityY=_.y,s.gravityZ=_.z;var h=this._rigidBodyList;for(this._numSolversInIslands=0;h!=null;){for(var v=h._next;!(h._addedToIsland||h._sleeping||h._type==1);){if(h._numContactLinks==0&&h._numJointLinks==0){this._island._stepSingleRigidBody(this._timeStep,h),this._numIslands++;break}this.buildIsland(h),this._island._step(this._timeStep,this._numVelocityIterations,this._numPositionIterations),this._island._clear(),this._numIslands++;break}h=v}for(this._contactManager._postSolve(),h=this._rigidBodyList;h!=null;){var e=h._next;h._addedToIsland=!1,h=e}for(h=this._rigidBodyList;h!=null;){var l=h._next;h._forceX=0,h._forceY=0,h._forceZ=0,h._torqueX=0,h._torqueY=0,h._torqueZ=0,h=l}for(;this._numSolversInIslands>0;)this._solversInIslands[--this._numSolversInIslands]._addedToIsland=!1,this._solversInIslands[this._numSolversInIslands]=null;var u=Date.now()/1e3;x.dynamics.common.Performance.dynamicsTime=(u-a)*1e3}buildIsland(a){var t=1;for(this._island._addRigidBody(a),this._rigidBodyStack[0]=a;t>0;){var r=this._rigidBodyStack[--t];if(this._rigidBodyStack[t]=null,r._type!=1){for(var i=r._contactLinkList;i!=null;){var o=i._next,s=i._contact._contactConstraint,_=i._contact._contactConstraint._solver;if(s.isTouching()&&!_._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){for(var h=this._numSolversInIslands<<1,v=new Array(h),e=v,l=0,u=this._numSolversInIslands;l<u;){var b=l++;e[b]=this._solversInIslands[b],this._solversInIslands[b]=null}this._solversInIslands=e}this._solversInIslands[this._numSolversInIslands++]=_,this._island._addConstraintSolver(_,s._positionCorrectionAlgorithm);var f=i._other;f._addedToIsland||(this._island._addRigidBody(f),this._rigidBodyStack[t++]=f)}i=o}for(var n=r._jointLinkList;n!=null;){var c=n._next,M=n._joint,m=M._solver;if(!m._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){for(var y=this._numSolversInIslands<<1,V=new Array(y),z=V,I=0,w=this._numSolversInIslands;I<w;){var X=I++;z[X]=this._solversInIslands[X],this._solversInIslands[X]=null}this._solversInIslands=z}this._solversInIslands[this._numSolversInIslands++]=m,this._island._addConstraintSolver(m,M._positionCorrectionAlgorithm);var L=n._other;L._addedToIsland||(this._island._addRigidBody(L),this._rigidBodyStack[t++]=L)}n=c}}}}_drawBvh(a,t){a.drawBvh&&this._drawBvhNode(a,t._root,0,a.style.bvhNodeColor)}_drawBvhNode(a,t,r,i){if(t!=null){if(r>=a.drawBvhMinLevel&&r<=a.drawBvhMaxLevel){var o=this._pool,s=o.sizeVec3==0?new x.common.Vec3:o.stackVec3[--o.sizeVec3],_=this._pool,h=_.sizeVec3==0?new x.common.Vec3:_.stackVec3[--_.sizeVec3],v=s;v.x=t._aabbMinX,v.y=t._aabbMinY,v.z=t._aabbMinZ;var e=h;e.x=t._aabbMaxX,e.y=t._aabbMaxY,e.z=t._aabbMaxZ,a.aabb(s,h,i);var l=this._pool,u=null,b=null,f=null;if(s!=null){if(s.zero(),l.sizeVec3==l.stackVec3.length){for(var n=l.sizeVec3<<1,c=new Array(n),M=c,m=0,y=l.sizeVec3;m<y;){var V=m++;M[V]=l.stackVec3[V],l.stackVec3[V]=null}l.stackVec3=M}l.stackVec3[l.sizeVec3++]=s}if(u!=null){var z=1,I=0,w=0,X=0,L=1,p=0,g=0,F=0,S=1;if(u.e00=z,u.e01=I,u.e02=w,u.e10=X,u.e11=L,u.e12=p,u.e20=g,u.e21=F,u.e22=S,l.sizeMat3==l.stackMat3.length){for(var N=l.sizeMat3<<1,A=new Array(N),Y=A,R=0,C=l.sizeMat3;R<C;){var d=R++;Y[d]=l.stackMat3[d],l.stackMat3[d]=null}l.stackMat3=Y}l.stackMat3[l.sizeMat3++]=u}if(b!=null){var Z=1,j=0,H=0,E=0,G=0,B=1,Q=0,W=0,J=0,D=0,O=1,K=0,ra=0,sa=0,$=0,q=1;if(b.e00=Z,b.e01=j,b.e02=H,b.e03=E,b.e10=G,b.e11=B,b.e12=Q,b.e13=W,b.e20=J,b.e21=D,b.e22=O,b.e23=K,b.e30=ra,b.e31=sa,b.e32=$,b.e33=q,l.sizeMat4==l.stackMat4.length){for(var na=l.sizeMat4<<1,oa=new Array(na),aa=oa,T=0,ca=l.sizeMat4;T<ca;){var _a=T++;aa[_a]=l.stackMat4[_a],l.stackMat4[_a]=null}l.stackMat4=aa}l.stackMat4[l.sizeMat4++]=b}if(f!=null){var k=0,ta=0,ia=0,la=1;if(f.x=k,f.y=ta,f.z=ia,f.w=la,l.sizeQuat==l.stackQuat.length){for(var va=l.sizeQuat<<1,xa=new Array(va),Ma=xa,za=0,Xa=l.sizeQuat;za<Xa;){var Za=za++;Ma[Za]=l.stackQuat[Za],l.stackQuat[Za]=null}l.stackQuat=Ma}l.stackQuat[l.sizeQuat++]=f}var fa=this._pool,ba=null,ea=null,ha=null;if(h!=null){if(h.zero(),fa.sizeVec3==fa.stackVec3.length){for(var pa=fa.sizeVec3<<1,ya=new Array(pa),da=ya,ma=0,Ya=fa.sizeVec3;ma<Ya;){var Qa=ma++;da[Qa]=fa.stackVec3[Qa],fa.stackVec3[Qa]=null}fa.stackVec3=da}fa.stackVec3[fa.sizeVec3++]=h}if(ba!=null){var ga=1,ua=0,ka=0,wa=0,Pa=1,Mt=0,Oa=0,Ba=0,nt=1;if(ba.e00=ga,ba.e01=ua,ba.e02=ka,ba.e10=wa,ba.e11=Pa,ba.e12=Mt,ba.e20=Oa,ba.e21=Ba,ba.e22=nt,fa.sizeMat3==fa.stackMat3.length){for(var Ea=fa.sizeMat3<<1,Na=new Array(Ea),Sa=Na,ft=0,Wa=fa.sizeMat3;ft<Wa;){var Ha=ft++;Sa[Ha]=fa.stackMat3[Ha],fa.stackMat3[Ha]=null}fa.stackMat3=Sa}fa.stackMat3[fa.sizeMat3++]=ba}if(ea!=null){var bt=1,rt=0,ja=0,_t=0,gt=0,mt=1,Ja=0,it=0,ut=0,Da=0,Ta=1,Fa=0,Vt=0,Pt=0,et=0,Xt=1;if(ea.e00=bt,ea.e01=rt,ea.e02=ja,ea.e03=_t,ea.e10=gt,ea.e11=mt,ea.e12=Ja,ea.e13=it,ea.e20=ut,ea.e21=Da,ea.e22=Ta,ea.e23=Fa,ea.e30=Vt,ea.e31=Pt,ea.e32=et,ea.e33=Xt,fa.sizeMat4==fa.stackMat4.length){for(var Yt=fa.sizeMat4<<1,zt=new Array(Yt),Ia=zt,U=0,Va=fa.sizeMat4;U<Va;){var lt=U++;Ia[lt]=fa.stackMat4[lt],fa.stackMat4[lt]=null}fa.stackMat4=Ia}fa.stackMat4[fa.sizeMat4++]=ea}if(ha!=null){var P=0,kt=0,Bt=0,St=1;if(ha.x=P,ha.y=kt,ha.z=Bt,ha.w=St,fa.sizeQuat==fa.stackQuat.length){for(var yt=fa.sizeQuat<<1,wt=new Array(yt),pt=wt,ht=0,xt=fa.sizeQuat;ht<xt;){var Ra=ht++;pt[Ra]=fa.stackQuat[Ra],fa.stackQuat[Ra]=null}fa.stackQuat=pt}fa.stackQuat[fa.sizeQuat++]=ha}}this._drawBvhNode(a,t._children[0],r+1,i),this._drawBvhNode(a,t._children[1],r+1,i)}}_drawRigidBodies(a){for(var t=a.style,r=this._rigidBodyList;r!=null;){var i=r._next;if(a.drawBases){var o=a.style;a.basis(r._transform,o.basisLength,o.basisColorX,o.basisColorY,o.basisColorZ)}var s=null,_=r._type==0;_||(s=r._type==2?t.kinematicShapeColor:t.staticShapeColor);for(var h=r._shapeList;h!=null;){var v=h._next;if(_&&(h._id&1?s=r._sleeping?t.sleepingShapeColor2:r._sleepTime>x.common.Setting.sleepingTimeThreshold?t.sleepyShapeColor2:t.shapeColor2:s=r._sleeping?t.sleepingShapeColor1:r._sleepTime>x.common.Setting.sleepingTimeThreshold?t.sleepyShapeColor1:t.shapeColor1),a.drawShapes){var e=h._geom,l=h._transform;switch(e._type){case 0:a.sphere(l,e._radius,s);break;case 1:var u=e,b=this._pool,f=b.sizeVec3==0?new x.common.Vec3:b.stackVec3[--b.sizeVec3],n=f;n.x=u._halfExtentsX,n.y=u._halfExtentsY,n.z=u._halfExtentsZ,a.box(l,f,s);var c=this._pool,M=null,m=null,y=null;if(f!=null){if(f.zero(),c.sizeVec3==c.stackVec3.length){for(var V=c.sizeVec3<<1,z=new Array(V),I=z,w=0,X=c.sizeVec3;w<X;){var L=w++;I[L]=c.stackVec3[L],c.stackVec3[L]=null}c.stackVec3=I}c.stackVec3[c.sizeVec3++]=f}if(M!=null){var p=1,g=0,F=0,S=0,N=1,A=0,Y=0,R=0,C=1;if(M.e00=p,M.e01=g,M.e02=F,M.e10=S,M.e11=N,M.e12=A,M.e20=Y,M.e21=R,M.e22=C,c.sizeMat3==c.stackMat3.length){for(var d=c.sizeMat3<<1,Z=new Array(d),j=Z,H=0,E=c.sizeMat3;H<E;){var G=H++;j[G]=c.stackMat3[G],c.stackMat3[G]=null}c.stackMat3=j}c.stackMat3[c.sizeMat3++]=M}if(m!=null){var B=1,Q=0,W=0,J=0,D=0,O=1,K=0,ra=0,sa=0,$=0,q=1,na=0,oa=0,aa=0,T=0,ca=1;if(m.e00=B,m.e01=Q,m.e02=W,m.e03=J,m.e10=D,m.e11=O,m.e12=K,m.e13=ra,m.e20=sa,m.e21=$,m.e22=q,m.e23=na,m.e30=oa,m.e31=aa,m.e32=T,m.e33=ca,c.sizeMat4==c.stackMat4.length){for(var _a=c.sizeMat4<<1,k=new Array(_a),ta=k,ia=0,la=c.sizeMat4;ia<la;){var va=ia++;ta[va]=c.stackMat4[va],c.stackMat4[va]=null}c.stackMat4=ta}c.stackMat4[c.sizeMat4++]=m}if(y!=null){var xa=0,Ma=0,za=0,Xa=1;if(y.x=xa,y.y=Ma,y.z=za,y.w=Xa,c.sizeQuat==c.stackQuat.length){for(var Za=c.sizeQuat<<1,fa=new Array(Za),ba=fa,ea=0,ha=c.sizeQuat;ea<ha;){var pa=ea++;ba[pa]=c.stackQuat[pa],c.stackQuat[pa]=null}c.stackQuat=ba}c.stackQuat[c.sizeQuat++]=y}break;case 2:var ya=e;a.cylinder(l,ya._radius,ya._halfHeight,s);break;case 3:var da=e;a.cone(l,da._radius,da._halfHeight,s);break;case 4:var ma=e;a.capsule(l,ma._radius,ma._halfHeight,s);break;case 5:var Ya=e,Qa=Ya._numVertices,ga=this._pool,ua=ga.sizeVec3==0?new x.common.Vec3:ga.stackVec3[--ga.sizeVec3],ka=this._pool,wa=ka.sizeVec3==0?new x.common.Vec3:ka.stackVec3[--ka.sizeVec3],Pa=this._pool,Mt=Pa.sizeVec3==0?new x.common.Vec3:Pa.stackVec3[--Pa.sizeVec3],Oa=this._pool,Ba=Oa.sizeVec3==0?new x.common.Vec3:Oa.stackVec3[--Oa.sizeVec3],nt=this._pool,Ea=nt.sizeVec3==0?new x.common.Vec3:nt.stackVec3[--nt.sizeVec3],Na=this._pool,Sa=Na.sizeVec3==0?new x.common.Vec3:Na.stackVec3[--Na.sizeVec3],ft=this._pool,Wa=ft.sizeMat3==0?new x.common.Mat3:ft.stackMat3[--ft.sizeMat3],Ha=this._pool,bt=Ha.sizeVec3==0?new x.common.Vec3:Ha.stackVec3[--Ha.sizeVec3],rt=Wa;rt.e00=l._rotation00,rt.e01=l._rotation01,rt.e02=l._rotation02,rt.e10=l._rotation10,rt.e11=l._rotation11,rt.e12=l._rotation12,rt.e20=l._rotation20,rt.e21=l._rotation21,rt.e22=l._rotation22;var ja=bt;ja.x=l._positionX,ja.y=l._positionY,ja.z=l._positionZ;for(var _t=0,gt=Qa;_t<gt;){var mt=_t++,Ja=Ya._tmpVertices[mt],it=Ya._vertices[mt];Ja.x=it.x,Ja.y=it.y,Ja.z=it.z;var ut=Ja,Da=ut.x*Wa.e00+ut.y*Wa.e01+ut.z*Wa.e02,Ta=ut.x*Wa.e10+ut.y*Wa.e11+ut.z*Wa.e12,Fa=ut.x*Wa.e20+ut.y*Wa.e21+ut.z*Wa.e22;ut.x=Da,ut.y=Ta,ut.z=Fa;var Vt=ut,Pt=Vt.x+bt.x,et=Vt.y+bt.y,Xt=Vt.z+bt.z;Vt.x=Pt,Vt.y=et,Vt.z=Xt}if(Qa>30)for(var Yt=0,zt=Qa;Yt<zt;){var Ia=Yt++,U=Ya._tmpVertices[Ia];ua.x=U.x,ua.y=U.y,ua.z=U.z;var Va=Ya._tmpVertices[(Ia+1)%Qa];wa.x=Va.x,wa.y=Va.y,wa.z=Va.z,a.line(ua,wa,s)}else if(this._debugDraw.wireframe||Qa>10)for(var lt=0,P=Qa;lt<P;){var kt=lt++,Bt=Ya._tmpVertices[kt];ua.x=Bt.x,ua.y=Bt.y,ua.z=Bt.z;for(var St=0,yt=kt;St<yt;){var wt=St++,pt=Ya._tmpVertices[wt];wa.x=pt.x,wa.y=pt.y,wa.z=pt.z,a.line(ua,wa,s)}}else for(var ht=0,xt=Qa;ht<xt;){var Ra=ht++,st=Ya._tmpVertices[Ra];ua.x=st.x,ua.y=st.y,ua.z=st.z;for(var Ca=0,vt=Ra;Ca<vt;){var qa=Ca++,at=Ya._tmpVertices[qa];wa.x=at.x,wa.y=at.y,wa.z=at.z;for(var Ua=0,tt=qa;Ua<tt;){var ct=Ua++,Aa=Ya._tmpVertices[ct];Mt.x=Aa.x,Mt.y=Aa.y,Mt.z=Aa.z,Ba.x=wa.x,Ba.y=wa.y,Ba.z=wa.z;var Ga=Ba,Ka=Ga.x-ua.x,La=Ga.y-ua.y,ot=Ga.z-ua.z;Ga.x=Ka,Ga.y=La,Ga.z=ot,Ea.x=Mt.x,Ea.y=Mt.y,Ea.z=Mt.z;var It=Ea,or=It.x-ua.x,gr=It.y-ua.y,ar=It.z-ua.z;It.x=or,It.y=gr,It.z=ar,Sa.x=Ba.x,Sa.y=Ba.y,Sa.z=Ba.z;var Ct=Sa,_r=Ct.y*Ea.z-Ct.z*Ea.y,Et=Ct.z*Ea.x-Ct.x*Ea.z,At=Ct.x*Ea.y-Ct.y*Ea.x;Ct.x=_r,Ct.y=Et,Ct.z=At;var Gt=Ct,Hr=Math.sqrt(Gt.x*Gt.x+Gt.y*Gt.y+Gt.z*Gt.z);Hr>0&&(Hr=1/Hr);var vr=Gt.x*Hr,lr=Gt.y*Hr,tr=Gt.z*Hr;Gt.x=vr,Gt.y=lr,Gt.z=tr,a.triangle(ua,wa,Mt,Sa,Sa,Sa,s);var Ur=-Sa.x,Xr=-Sa.y,Mr=-Sa.z;Sa.x=Ur,Sa.y=Xr,Sa.z=Mr,a.triangle(ua,Mt,wa,Sa,Sa,Sa,s)}}}var Zt=this._pool,ir=null,$t=null,nr=null;if(ua!=null){if(ua.zero(),Zt.sizeVec3==Zt.stackVec3.length){for(var jr=Zt.sizeVec3<<1,Wt=new Array(jr),Kr=Wt,Ir=0,mi=Zt.sizeVec3;Ir<mi;){var $r=Ir++;Kr[$r]=Zt.stackVec3[$r],Zt.stackVec3[$r]=null}Zt.stackVec3=Kr}Zt.stackVec3[Zt.sizeVec3++]=ua}if(ir!=null){var Lt=1,Kt=0,Tt=0,br=0,zr=1,vi=0,qt=0,fr=0,dt=1;if(ir.e00=Lt,ir.e01=Kt,ir.e02=Tt,ir.e10=br,ir.e11=zr,ir.e12=vi,ir.e20=qt,ir.e21=fr,ir.e22=dt,Zt.sizeMat3==Zt.stackMat3.length){for(var ur=Zt.sizeMat3<<1,hr=new Array(ur),ei=hr,Xi=0,oo=Zt.sizeMat3;Xi<oo;){var Jt=Xi++;ei[Jt]=Zt.stackMat3[Jt],Zt.stackMat3[Jt]=null}Zt.stackMat3=ei}Zt.stackMat3[Zt.sizeMat3++]=ir}if($t!=null){var fi=1,pi=0,Dt=0,Bi=0,Ar=0,Ni=1,Hn=0,no=0,Si=0,eo=0,gn=1,Ao=0,Vo=0,xr=0,ao=0,Ai=1;if($t.e00=fi,$t.e01=pi,$t.e02=Dt,$t.e03=Bi,$t.e10=Ar,$t.e11=Ni,$t.e12=Hn,$t.e13=no,$t.e20=Si,$t.e21=eo,$t.e22=gn,$t.e23=Ao,$t.e30=Vo,$t.e31=xr,$t.e32=ao,$t.e33=Ai,Zt.sizeMat4==Zt.stackMat4.length){for(var yi=Zt.sizeMat4<<1,Po=new Array(yi),Dr=Po,Pi=0,gi=Zt.sizeMat4;Pi<gi;){var Rt=Pi++;Dr[Rt]=Zt.stackMat4[Rt],Zt.stackMat4[Rt]=null}Zt.stackMat4=Dr}Zt.stackMat4[Zt.sizeMat4++]=$t}if(nr!=null){var Or=0,Lr=0,Tn=0,ms=1;if(nr.x=Or,nr.y=Lr,nr.z=Tn,nr.w=ms,Zt.sizeQuat==Zt.stackQuat.length){for(var qe=Zt.sizeQuat<<1,ps=new Array(qe),Re=ps,as=0,N_=Zt.sizeQuat;as<N_;){var In=as++;Re[In]=Zt.stackQuat[In],Zt.stackQuat[In]=null}Zt.stackQuat=Re}Zt.stackQuat[Zt.sizeQuat++]=nr}var Pr=this._pool,Go=null,Wi=null,ke=null;if(wa!=null){if(wa.zero(),Pr.sizeVec3==Pr.stackVec3.length){for(var nn=Pr.sizeVec3<<1,Rn=new Array(nn),jn=Rn,Xe=0,k_=Pr.sizeVec3;Xe<k_;){var Qe=Xe++;jn[Qe]=Pr.stackVec3[Qe],Pr.stackVec3[Qe]=null}Pr.stackVec3=jn}Pr.stackVec3[Pr.sizeVec3++]=wa}if(Go!=null){var Vr=1,Ii=0,ui=0,so=0,Qn=1,ys=0,en=0,En=0,cr=1;if(Go.e00=Vr,Go.e01=Ii,Go.e02=ui,Go.e10=so,Go.e11=Qn,Go.e12=ys,Go.e20=en,Go.e21=En,Go.e22=cr,Pr.sizeMat3==Pr.stackMat3.length){for(var co=Pr.sizeMat3<<1,Fi=new Array(co),Dn=Fi,ts=0,Ee=Pr.sizeMat3;ts<Ee;){var De=ts++;Dn[De]=Pr.stackMat3[De],Pr.stackMat3[De]=null}Pr.stackMat3=Dn}Pr.stackMat3[Pr.sizeMat3++]=Go}if(Wi!=null){var Ne=1,ce=0,rr=0,ri=0,Qr=0,Nr=1,uo=0,Co=0,__=0,Fe=0,rs=1,Nn=0,bo=0,Nt=0,Fr=0,li=1;if(Wi.e00=Ne,Wi.e01=ce,Wi.e02=rr,Wi.e03=ri,Wi.e10=Qr,Wi.e11=Nr,Wi.e12=uo,Wi.e13=Co,Wi.e20=__,Wi.e21=Fe,Wi.e22=rs,Wi.e23=Nn,Wi.e30=bo,Wi.e31=Nt,Wi.e32=Fr,Wi.e33=li,Pr.sizeMat4==Pr.stackMat4.length){for(var wo=Pr.sizeMat4<<1,be=new Array(wo),Le=be,Ye=0,xo=Pr.sizeMat4;Ye<xo;){var jt=Ye++;Le[jt]=Pr.stackMat4[jt],Pr.stackMat4[jt]=null}Pr.stackMat4=Le}Pr.stackMat4[Pr.sizeMat4++]=Wi}if(ke!=null){var Vi=0,si=0,Jo=0,Gs=1;if(ke.x=Vi,ke.y=si,ke.z=Jo,ke.w=Gs,Pr.sizeQuat==Pr.stackQuat.length){for(var To=Pr.sizeQuat<<1,ko=new Array(To),Gi=ko,Ci=0,Ti=Pr.sizeQuat;Ci<Ti;){var Li=Ci++;Gi[Li]=Pr.stackQuat[Li],Pr.stackQuat[Li]=null}Pr.stackQuat=Gi}Pr.stackQuat[Pr.sizeQuat++]=ke}var Qt=this._pool,Gr=null,Yr=null,Rr=null;if(Mt!=null){if(Mt.zero(),Qt.sizeVec3==Qt.stackVec3.length){for(var Mi=Qt.sizeVec3<<1,qr=new Array(Mi),Ji=qr,$i=0,to=Qt.sizeVec3;$i<to;){var fe=$i++;Ji[fe]=Qt.stackVec3[fe],Qt.stackVec3[fe]=null}Qt.stackVec3=Ji}Qt.stackVec3[Qt.sizeVec3++]=Mt}if(Gr!=null){var wr=1,sn=0,Yi=0,$o=0,gs=1,Vn=0,Is=0,wn=0,Cr=1;if(Gr.e00=wr,Gr.e01=sn,Gr.e02=Yi,Gr.e10=$o,Gr.e11=gs,Gr.e12=Vn,Gr.e20=Is,Gr.e21=wn,Gr.e22=Cr,Qt.sizeMat3==Qt.stackMat3.length){for(var Ro=Qt.sizeMat3<<1,_o=new Array(Ro),Fn=_o,Ge=0,Gn=Qt.sizeMat3;Ge<Gn;){var Wo=Ge++;Fn[Wo]=Qt.stackMat3[Wo],Qt.stackMat3[Wo]=null}Qt.stackMat3=Fn}Qt.stackMat3[Qt.sizeMat3++]=Gr}if(Yr!=null){var kn=1,Ze=0,Ut=0,Qo=0,Ui=0,Xn=1,Jn=0,ue=0,Vs=0,Uo=0,ws=1,X_=0,Js=0,L_=0,Je=0,F_=1;if(Yr.e00=kn,Yr.e01=Ze,Yr.e02=Ut,Yr.e03=Qo,Yr.e10=Ui,Yr.e11=Xn,Yr.e12=Jn,Yr.e13=ue,Yr.e20=Vs,Yr.e21=Uo,Yr.e22=ws,Yr.e23=X_,Yr.e30=Js,Yr.e31=L_,Yr.e32=Je,Yr.e33=F_,Qt.sizeMat4==Qt.stackMat4.length){for(var G_=Qt.sizeMat4<<1,Oi=new Array(G_),Xo=Oi,Lo=0,$n=Qt.sizeMat4;Lo<$n;){var kr=Lo++;Xo[kr]=Qt.stackMat4[kr],Qt.stackMat4[kr]=null}Qt.stackMat4=Xo}Qt.stackMat4[Qt.sizeMat4++]=Yr}if(Rr!=null){var Wn=0,Eo=0,ro=0,J_=1;if(Rr.x=Wn,Rr.y=Eo,Rr.z=ro,Rr.w=J_,Qt.sizeQuat==Qt.stackQuat.length){for(var $_=Qt.sizeQuat<<1,Y_=new Array($_),is=Y_,v_=0,l_=Qt.sizeQuat;v_<l_;){var os=v_++;is[os]=Qt.stackQuat[os],Qt.stackQuat[os]=null}Qt.stackQuat=is}Qt.stackQuat[Qt.sizeQuat++]=Rr}var mr=this._pool,Oo=null,ai=null,de=null;if(Ba!=null){if(Ba.zero(),mr.sizeVec3==mr.stackVec3.length){for(var $s=mr.sizeVec3<<1,cv=new Array($s),xe=cv,$e=0,Kn=mr.sizeVec3;$e<Kn;){var Ws=$e++;xe[Ws]=mr.stackVec3[Ws],mr.stackVec3[Ws]=null}mr.stackVec3=xe}mr.stackVec3[mr.sizeVec3++]=Ba}if(Oo!=null){var Tr=1,Yo=0,Ri=0,_n=0,ks=1,Z_=0,We=0,qn=0,Ln=1;if(Oo.e00=Tr,Oo.e01=Yo,Oo.e02=Ri,Oo.e10=_n,Oo.e11=ks,Oo.e12=Z_,Oo.e20=We,Oo.e21=qn,Oo.e22=Ln,mr.sizeMat3==mr.stackMat3.length){for(var ns=mr.sizeMat3<<1,Be=new Array(ns),es=Be,Us=0,h_=mr.sizeMat3;Us<h_;){var Se=Us++;es[Se]=mr.stackMat3[Se],mr.stackMat3[Se]=null}mr.stackMat3=es}mr.stackMat3[mr.sizeMat3++]=Oo}if(ai!=null){var Ae=1,ae=0,pr=0,Mo=0,Zi=0,Ho=1,Zo=0,Hi=0,Do=0,Xs=0,te=1,Os=0,W_=0,re=0,Ft=0,ji=1;if(ai.e00=Ae,ai.e01=ae,ai.e02=pr,ai.e03=Mo,ai.e10=Zi,ai.e11=Ho,ai.e12=Zo,ai.e13=Hi,ai.e20=Do,ai.e21=Xs,ai.e22=te,ai.e23=Os,ai.e30=W_,ai.e31=re,ai.e32=Ft,ai.e33=ji,mr.sizeMat4==mr.stackMat4.length){for(var No=mr.sizeMat4<<1,Ls=new Array(No),kv=Ls,i0=0,U_=mr.sizeMat4;i0<U_;){var Ot=i0++;kv[Ot]=mr.stackMat4[Ot],mr.stackMat4[Ot]=null}mr.stackMat4=kv}mr.stackMat4[mr.sizeMat4++]=ai}if(de!=null){var Yn=0,Qi=0,Zn=0,d_=1;if(de.x=Yn,de.y=Qi,de.z=Zn,de.w=d_,mr.sizeQuat==mr.stackQuat.length){for(var Hs=mr.sizeQuat<<1,c_=new Array(Hs),fo=c_,ss=0,_s=mr.sizeQuat;ss<_s;){var Me=ss++;fo[Me]=mr.stackQuat[Me],mr.stackQuat[Me]=null}mr.stackQuat=fo}mr.stackQuat[mr.sizeQuat++]=de}var Zr=this._pool,jo=null,wi=null,Bo=null;if(Ea!=null){if(Ea.zero(),Zr.sizeVec3==Zr.stackVec3.length){for(var Ue=Zr.sizeVec3<<1,bv=new Array(Ue),ze=bv,js=0,Xv=Zr.sizeVec3;js<Xv;){var Oe=js++;ze[Oe]=Zr.stackVec3[Oe],Zr.stackVec3[Oe]=null}Zr.stackVec3=ze}Zr.stackVec3[Zr.sizeVec3++]=Ea}if(jo!=null){var er=1,dn=0,vn=0,ln=0,B_=1,fv=0,ie=0,Pe=0,b_=1;if(jo.e00=er,jo.e01=dn,jo.e02=vn,jo.e10=ln,jo.e11=B_,jo.e12=fv,jo.e20=ie,jo.e21=Pe,jo.e22=b_,Zr.sizeMat3==Zr.stackMat3.length){for(var O_=Zr.sizeMat3<<1,uv=new Array(O_),xv=uv,f_=0,He=Zr.sizeMat3;f_<He;){var zo=f_++;xv[zo]=Zr.stackMat3[zo],Zr.stackMat3[zo]=null}Zr.stackMat3=xv}Zr.stackMat3[Zr.sizeMat3++]=jo}if(wi!=null){var vs=1,ls=0,Wr=0,mo=0,vo=0,hs=1,Ys=0,Zs=0,ds=0,S_=0,me=1,cs=0,H_=0,Ks=0,Un=0,pe=1;if(wi.e00=vs,wi.e01=ls,wi.e02=Wr,wi.e03=mo,wi.e10=vo,wi.e11=hs,wi.e12=Ys,wi.e13=Zs,wi.e20=ds,wi.e21=S_,wi.e22=me,wi.e23=cs,wi.e30=H_,wi.e31=Ks,wi.e32=Un,wi.e33=pe,Zr.sizeMat4==Zr.stackMat4.length){for(var Lv=Zr.sizeMat4<<1,A_=new Array(Lv),Ko=A_,hn=0,po=Zr.sizeMat4;hn<po;){var Ht=hn++;Ko[Ht]=Zr.stackMat4[Ht],Zr.stackMat4[Ht]=null}Zr.stackMat4=Ko}Zr.stackMat4[Zr.sizeMat4++]=wi}if(Bo!=null){var Ki=0,lo=0,qs=0,Bs=1;if(Bo.x=Ki,Bo.y=lo,Bo.z=qs,Bo.w=Bs,Zr.sizeQuat==Zr.stackQuat.length){for(var a_=Zr.sizeQuat<<1,P_=new Array(a_),qo=P_,oe=0,j_=Zr.sizeQuat;oe<j_;){var Mv=oe++;qo[Mv]=Zr.stackQuat[Mv],Zr.stackQuat[Mv]=null}Zr.stackQuat=qo}Zr.stackQuat[Zr.sizeQuat++]=Bo}var dr=this._pool,yo=null,Ei=null,io=null;if(Sa!=null){if(Sa.zero(),dr.sizeVec3==dr.stackVec3.length){for(var K_=dr.sizeVec3<<1,q_=new Array(K_),Yv=q_,t_=0,Zv=dr.sizeVec3;t_<Zv;){var av=t_++;Yv[av]=dr.stackVec3[av],dr.stackVec3[av]=null}dr.stackVec3=Yv}dr.stackVec3[dr.sizeVec3++]=Sa}if(yo!=null){var Br=1,tv=0,Ss=0,As=0,bs=1,fs=0,Ps=0,dv=0,ye=1;if(yo.e00=Br,yo.e01=tv,yo.e02=Ss,yo.e10=As,yo.e11=bs,yo.e12=fs,yo.e20=Ps,yo.e21=dv,yo.e22=ye,dr.sizeMat3==dr.stackMat3.length){for(var qi=dr.sizeMat3<<1,r_=new Array(qi),go=r_,i_=0,Fo=dr.sizeMat3;i_<Fo;){var Cs=i_++;go[Cs]=dr.stackMat3[Cs],dr.stackMat3[Cs]=null}dr.stackMat3=go}dr.stackMat3[dr.sizeMat3++]=yo}if(Ei!=null){var an=1,ge=0,sr=0,tn=0,_i=0,ne=1,Ie=0,So=0,Di=0,Bn=0,rv=1,o_=0,C_=0,iv=0,ee=0,Sn=1;if(Ei.e00=an,Ei.e01=ge,Ei.e02=sr,Ei.e03=tn,Ei.e10=_i,Ei.e11=ne,Ei.e12=Ie,Ei.e13=So,Ei.e20=Di,Ei.e21=Bn,Ei.e22=rv,Ei.e23=o_,Ei.e30=C_,Ei.e31=iv,Ei.e32=ee,Ei.e33=Sn,dr.sizeMat4==dr.stackMat4.length){for(var Ve=dr.sizeMat4<<1,D0=new Array(Ve),m0=D0,cl=0,N0=dr.sizeMat4;cl<N0;){var hi=cl++;m0[hi]=dr.stackMat4[hi],dr.stackMat4[hi]=null}dr.stackMat4=m0}dr.stackMat4[dr.sizeMat4++]=Ei}if(io!=null){var On=0,Io=0,us=0,ov=1;if(io.x=On,io.y=Io,io.z=us,io.w=ov,dr.sizeQuat==dr.stackQuat.length){for(var zv=dr.sizeQuat<<1,n_=new Array(zv),Bv=n_,Ts=0,u_=dr.sizeQuat;Ts<u_;){var x_=Ts++;Bv[x_]=dr.stackQuat[x_],dr.stackQuat[x_]=null}dr.stackQuat=Bv}dr.stackQuat[dr.sizeQuat++]=io}var Sr=this._pool,Rs=null,ho=null,Ce=null;if(Rs!=null){if(Rs.zero(),Sr.sizeVec3==Sr.stackVec3.length){for(var mv=Sr.sizeVec3<<1,Qs=new Array(mv),M_=Qs,nv=0,o0=Sr.sizeVec3;nv<o0;){var n0=nv++;M_[n0]=Sr.stackVec3[n0],Sr.stackVec3[n0]=null}Sr.stackVec3=M_}Sr.stackVec3[Sr.sizeVec3++]=Rs}if(Wa!=null){var ev=1,ti=0,je=0,An=0,xs=1,F0=0,Nv=0,T_=0,p0=1;if(Wa.e00=ev,Wa.e01=ti,Wa.e02=je,Wa.e10=An,Wa.e11=xs,Wa.e12=F0,Wa.e20=Nv,Wa.e21=T_,Wa.e22=p0,Sr.sizeMat3==Sr.stackMat3.length){for(var Sv=Sr.sizeMat3<<1,e0=new Array(Sv),y0=e0,G0=0,s0=Sr.sizeMat3;G0<s0;){var _0=G0++;y0[_0]=Sr.stackMat3[_0],Sr.stackMat3[_0]=null}Sr.stackMat3=y0}Sr.stackMat3[Sr.sizeMat3++]=Wa}if(ho!=null){var g0=1,Fv=0,ci=0,pv=0,cn=0,Gv=1,Hl=0,I0=0,V0=0,bl=0,Bl=1,Jv=0,jl=0,Kl=0,fl=0,Sl=1;if(ho.e00=g0,ho.e01=Fv,ho.e02=ci,ho.e03=pv,ho.e10=cn,ho.e11=Gv,ho.e12=Hl,ho.e13=I0,ho.e20=V0,ho.e21=bl,ho.e22=Bl,ho.e23=Jv,ho.e30=jl,ho.e31=Kl,ho.e32=fl,ho.e33=Sl,Sr.sizeMat4==Sr.stackMat4.length){for(var Al=Sr.sizeMat4<<1,ql=new Array(Al),ul=ql,ah=0,xl=Sr.sizeMat4;ah<xl;){var ii=ah++;ul[ii]=Sr.stackMat4[ii],Sr.stackMat4[ii]=null}Sr.stackMat4=ul}Sr.stackMat4[Sr.sizeMat4++]=ho}if(Ce!=null){var Ms=0,rn=0,yv=0,gh=1;if(Ce.x=Ms,Ce.y=rn,Ce.z=yv,Ce.w=gh,Sr.sizeQuat==Sr.stackQuat.length){for(var $v=Sr.sizeQuat<<1,J0=new Array($v),Ml=J0,w0=0,k0=Sr.sizeQuat;w0<k0;){var $0=w0++;Ml[$0]=Sr.stackQuat[$0],Sr.stackQuat[$0]=null}Sr.stackQuat=Ml}Sr.stackQuat[Sr.sizeQuat++]=Ce}var zi=this._pool,zs=null,se=null,v0=null;if(bt!=null){if(bt.zero(),zi.sizeVec3==zi.stackVec3.length){for(var Pl=zi.sizeVec3<<1,hh=new Array(Pl),W0=hh,ch=0,U0=zi.sizeVec3;ch<U0;){var Cl=ch++;W0[Cl]=zi.stackVec3[Cl],zi.stackVec3[Cl]=null}zi.stackVec3=W0}zi.stackVec3[zi.sizeVec3++]=bt}if(zs!=null){var zl=1,Te=0,X0=0,z_=0,Tl=1,O0=0,H0=0,Rl=0,ml=1;if(zs.e00=zl,zs.e01=Te,zs.e02=X0,zs.e10=z_,zs.e11=Tl,zs.e12=O0,zs.e20=H0,zs.e21=Rl,zs.e22=ml,zi.sizeMat3==zi.stackMat3.length){for(var L0=zi.sizeMat3<<1,l0=new Array(L0),m_=l0,Wv=0,Uv=zi.sizeMat3;Wv<Uv;){var sv=Wv++;m_[sv]=zi.stackMat3[sv],zi.stackMat3[sv]=null}zi.stackMat3=m_}zi.stackMat3[zi.sizeMat3++]=zs}if(se!=null){var Y0=1,Av=0,h0=0,_e=0,c0=0,Z0=1,Es=0,j0=0,yr=0,bn=0,ki=1,Ov=0,b0=0,bh=0,th=0,p_=1;if(se.e00=Y0,se.e01=Av,se.e02=h0,se.e03=_e,se.e10=c0,se.e11=Z0,se.e12=Es,se.e13=j0,se.e20=yr,se.e21=bn,se.e22=ki,se.e23=Ov,se.e30=b0,se.e31=bh,se.e32=th,se.e33=p_,zi.sizeMat4==zi.stackMat4.length){for(var Ke=zi.sizeMat4<<1,Ds=new Array(Ke),rh=Ds,fh=0,Ql=zi.sizeMat4;fh<Ql;){var bi=fh++;rh[bi]=zi.stackMat4[bi],zi.stackMat4[bi]=null}zi.stackMat4=rh}zi.stackMat4[zi.sizeMat4++]=se}if(v0!=null){var e_=0,fn=0,gv=0,K0=1;if(v0.x=e_,v0.y=fn,v0.z=gv,v0.w=K0,zi.sizeQuat==zi.stackQuat.length){for(var Iv=zi.sizeQuat<<1,pl=new Array(Iv),yl=pl,gl=0,R_=zi.sizeQuat;gl<R_;){var Pv=gl++;yl[Pv]=zi.stackQuat[Pv],zi.stackQuat[Pv]=null}zi.stackQuat=yl}zi.stackQuat[zi.sizeQuat++]=v0}break}}if(a.drawAabbs){var Pn=h._aabb,Vv=t.aabbColor,Cv=this._pool,Q_=Cv.sizeVec3==0?new x.common.Vec3:Cv.stackVec3[--Cv.sizeVec3],ve=this._pool,E_=ve.sizeVec3==0?new x.common.Vec3:ve.stackVec3[--ve.sizeVec3],Tv=Q_;Tv.x=Pn._minX,Tv.y=Pn._minY,Tv.z=Pn._minZ;var Hv=E_;Hv.x=Pn._maxX,Hv.y=Pn._maxY,Hv.z=Pn._maxZ,a.aabb(Q_,E_,Vv);var oi=this._pool,y_=null,le=null,Jr=null;if(Q_!=null){if(Q_.zero(),oi.sizeVec3==oi.stackVec3.length){for(var g_=oi.sizeVec3<<1,Cn=new Array(g_),q0=Cn,f0=0,uh=oi.sizeVec3;f0<uh;){var al=f0++;q0[al]=oi.stackVec3[al],oi.stackVec3[al]=null}oi.stackVec3=q0}oi.stackVec3[oi.sizeVec3++]=Q_}if(y_!=null){var tl=1,Il=0,d0=0,xh=0,Vl=1,Ih=0,ih=0,wl=0,B0=1;if(y_.e00=tl,y_.e01=Il,y_.e02=d0,y_.e10=xh,y_.e11=Vl,y_.e12=Ih,y_.e20=ih,y_.e21=wl,y_.e22=B0,oi.sizeMat3==oi.stackMat3.length){for(var S0=oi.sizeMat3<<1,kl=new Array(S0),oh=kl,jv=0,El=oi.sizeMat3;jv<El;){var Kv=jv++;oh[Kv]=oi.stackMat3[Kv],oi.stackMat3[Kv]=null}oi.stackMat3=oh}oi.stackMat3[oi.sizeMat3++]=y_}if(le!=null){var ni=1,I_=0,on=0,Xl=0,A0=0,nh=1,Dl=0,rl=0,Nl=0,P0=0,eh=1,sh=0,Fl=0,Gl=0,_v=0,Rv=1;if(le.e00=ni,le.e01=I_,le.e02=on,le.e03=Xl,le.e10=A0,le.e11=nh,le.e12=Dl,le.e13=rl,le.e20=Nl,le.e21=P0,le.e22=eh,le.e23=sh,le.e30=Fl,le.e31=Gl,le.e32=_v,le.e33=Rv,oi.sizeMat4==oi.stackMat4.length){for(var qv=oi.sizeMat4<<1,Ns=new Array(qv),Mh=Ns,u0=0,Ll=oi.sizeMat4;u0<Ll;){var Qv=u0++;Mh[Qv]=oi.stackMat4[Qv],oi.stackMat4[Qv]=null}oi.stackMat4=Mh}oi.stackMat4[oi.sizeMat4++]=le}if(Jr!=null){var a0=0,Ev=0,x0=0,dh=1;if(Jr.x=a0,Jr.y=Ev,Jr.z=x0,Jr.w=dh,oi.sizeQuat==oi.stackQuat.length){for(var C0=oi.sizeQuat<<1,t0=new Array(C0),Jl=t0,$l=0,zh=oi.sizeQuat;$l<zh;){var Dv=$l++;Jl[Dv]=oi.stackQuat[Dv],oi.stackQuat[Dv]=null}oi.stackQuat=Jl}oi.stackQuat[oi.sizeQuat++]=Jr}var xi=this._pool,we=null,he=null,T0=null;if(E_!=null){if(E_.zero(),xi.sizeVec3==xi.stackVec3.length){for(var Wl=xi.sizeVec3<<1,Fs=new Array(Wl),M0=Fs,Yl=0,Ul=xi.sizeVec3;Yl<Ul;){var Ol=Yl++;M0[Ol]=xi.stackVec3[Ol],xi.stackVec3[Ol]=null}xi.stackVec3=M0}xi.stackVec3[xi.sizeVec3++]=E_}if(we!=null){var Vh=1,vv=0,lv=0,R0=0,V_=1,Zl=0,wh=0,Bh=0,r0=1;if(we.e00=Vh,we.e01=vv,we.e02=lv,we.e10=R0,we.e11=V_,we.e12=Zl,we.e20=wh,we.e21=Bh,we.e22=r0,xi.sizeMat3==xi.stackMat3.length){for(var hv=xi.sizeMat3<<1,kh=new Array(hv),dl=kh,Xh=0,jh=xi.sizeMat3;Xh<jh;){var _h=Xh++;dl[_h]=xi.stackMat3[_h],xi.stackMat3[_h]=null}xi.stackMat3=dl}xi.stackMat3[xi.sizeMat3++]=we}if(he!=null){var Er=1,s_=0,w_=0,vh=0,Sh=0,Ah=1,mh=0,wv=0,Qh=0,Eh=0,Kh=1,qh=0,ph=0,Ph=0,il=0,ic=1;if(he.e00=Er,he.e01=s_,he.e02=w_,he.e03=vh,he.e10=Sh,he.e11=Ah,he.e12=mh,he.e13=wv,he.e20=Qh,he.e21=Eh,he.e22=Kh,he.e23=qh,he.e30=ph,he.e31=Ph,he.e32=il,he.e33=ic,xi.sizeMat4==xi.stackMat4.length){for(var Lh=xi.sizeMat4<<1,D_=new Array(Lh),Dh=D_,yh=0,ac=xi.sizeMat4;yh<ac;){var Yh=yh++;Dh[Yh]=xi.stackMat4[Yh],xi.stackMat4[Yh]=null}xi.stackMat4=Dh}xi.stackMat4[xi.sizeMat4++]=he}if(T0!=null){var tc=0,Ch=0,Q0=0,oc=1;if(T0.x=tc,T0.y=Ch,T0.z=Q0,T0.w=oc,xi.sizeQuat==xi.stackQuat.length){for(var lh=xi.sizeQuat<<1,Zh=new Array(lh),Nh=Zh,Th=0,E0=xi.sizeQuat;Th<E0;){var z0=Th++;Nh[z0]=xi.stackQuat[z0],xi.stackQuat[z0]=null}xi.stackQuat=Nh}xi.stackQuat[xi.sizeQuat++]=T0}}h=v}r=i}}_drawConstraints(a){var t=a.style;if(a.drawPairs||a.drawContacts)for(var r=this._contactManager._contactList;r!=null;){var i=r._next;if(a.drawPairs){var o=t.pairColor,s=this._pool,_=s.sizeVec3==0?new x.common.Vec3:s.stackVec3[--s.sizeVec3],h=this._pool,v=h.sizeVec3==0?new x.common.Vec3:h.stackVec3[--h.sizeVec3],e=_;e.x=r._s1._transform._positionX,e.y=r._s1._transform._positionY,e.z=r._s1._transform._positionZ;var l=v;l.x=r._s2._transform._positionX,l.y=r._s2._transform._positionY,l.z=r._s2._transform._positionZ,a.line(_,v,o);var u=this._pool,b=null,f=null,n=null;if(_!=null){if(_.zero(),u.sizeVec3==u.stackVec3.length){for(var c=u.sizeVec3<<1,M=new Array(c),m=M,y=0,V=u.sizeVec3;y<V;){var z=y++;m[z]=u.stackVec3[z],u.stackVec3[z]=null}u.stackVec3=m}u.stackVec3[u.sizeVec3++]=_}if(b!=null){var I=1,w=0,X=0,L=0,p=1,g=0,F=0,S=0,N=1;if(b.e00=I,b.e01=w,b.e02=X,b.e10=L,b.e11=p,b.e12=g,b.e20=F,b.e21=S,b.e22=N,u.sizeMat3==u.stackMat3.length){for(var A=u.sizeMat3<<1,Y=new Array(A),R=Y,C=0,d=u.sizeMat3;C<d;){var Z=C++;R[Z]=u.stackMat3[Z],u.stackMat3[Z]=null}u.stackMat3=R}u.stackMat3[u.sizeMat3++]=b}if(f!=null){var j=1,H=0,E=0,G=0,B=0,Q=1,W=0,J=0,D=0,O=0,K=1,ra=0,sa=0,$=0,q=0,na=1;if(f.e00=j,f.e01=H,f.e02=E,f.e03=G,f.e10=B,f.e11=Q,f.e12=W,f.e13=J,f.e20=D,f.e21=O,f.e22=K,f.e23=ra,f.e30=sa,f.e31=$,f.e32=q,f.e33=na,u.sizeMat4==u.stackMat4.length){for(var oa=u.sizeMat4<<1,aa=new Array(oa),T=aa,ca=0,_a=u.sizeMat4;ca<_a;){var k=ca++;T[k]=u.stackMat4[k],u.stackMat4[k]=null}u.stackMat4=T}u.stackMat4[u.sizeMat4++]=f}if(n!=null){var ta=0,ia=0,la=0,va=1;if(n.x=ta,n.y=ia,n.z=la,n.w=va,u.sizeQuat==u.stackQuat.length){for(var xa=u.sizeQuat<<1,Ma=new Array(xa),za=Ma,Xa=0,Za=u.sizeQuat;Xa<Za;){var fa=Xa++;za[fa]=u.stackQuat[fa],u.stackQuat[fa]=null}u.stackQuat=za}u.stackQuat[u.sizeQuat++]=n}var ba=this._pool,ea=null,ha=null,pa=null;if(v!=null){if(v.zero(),ba.sizeVec3==ba.stackVec3.length){for(var ya=ba.sizeVec3<<1,da=new Array(ya),ma=da,Ya=0,Qa=ba.sizeVec3;Ya<Qa;){var ga=Ya++;ma[ga]=ba.stackVec3[ga],ba.stackVec3[ga]=null}ba.stackVec3=ma}ba.stackVec3[ba.sizeVec3++]=v}if(ea!=null){var ua=1,ka=0,wa=0,Pa=0,Mt=1,Oa=0,Ba=0,nt=0,Ea=1;if(ea.e00=ua,ea.e01=ka,ea.e02=wa,ea.e10=Pa,ea.e11=Mt,ea.e12=Oa,ea.e20=Ba,ea.e21=nt,ea.e22=Ea,ba.sizeMat3==ba.stackMat3.length){for(var Na=ba.sizeMat3<<1,Sa=new Array(Na),ft=Sa,Wa=0,Ha=ba.sizeMat3;Wa<Ha;){var bt=Wa++;ft[bt]=ba.stackMat3[bt],ba.stackMat3[bt]=null}ba.stackMat3=ft}ba.stackMat3[ba.sizeMat3++]=ea}if(ha!=null){var rt=1,ja=0,_t=0,gt=0,mt=0,Ja=1,it=0,ut=0,Da=0,Ta=0,Fa=1,Vt=0,Pt=0,et=0,Xt=0,Yt=1;if(ha.e00=rt,ha.e01=ja,ha.e02=_t,ha.e03=gt,ha.e10=mt,ha.e11=Ja,ha.e12=it,ha.e13=ut,ha.e20=Da,ha.e21=Ta,ha.e22=Fa,ha.e23=Vt,ha.e30=Pt,ha.e31=et,ha.e32=Xt,ha.e33=Yt,ba.sizeMat4==ba.stackMat4.length){for(var zt=ba.sizeMat4<<1,Ia=new Array(zt),U=Ia,Va=0,lt=ba.sizeMat4;Va<lt;){var P=Va++;U[P]=ba.stackMat4[P],ba.stackMat4[P]=null}ba.stackMat4=U}ba.stackMat4[ba.sizeMat4++]=ha}if(pa!=null){var kt=0,Bt=0,St=0,yt=1;if(pa.x=kt,pa.y=Bt,pa.z=St,pa.w=yt,ba.sizeQuat==ba.stackQuat.length){for(var wt=ba.sizeQuat<<1,pt=new Array(wt),ht=pt,xt=0,Ra=ba.sizeQuat;xt<Ra;){var st=xt++;ht[st]=ba.stackQuat[st],ba.stackQuat[st]=null}ba.stackQuat=ht}ba.stackQuat[ba.sizeQuat++]=pa}}if(a.drawContacts)for(var Ca=r._contactConstraint,vt=r._contactConstraint._manifold._points,qa=0,at=r._contactConstraint._manifold._numPoints;qa<at;){var Ua=qa++,tt=vt[Ua],ct=a.style;Ca._s1._transform,Ca._s2._transform;var Aa=this._pool,Ga=Aa.sizeVec3==0?new x.common.Vec3:Aa.stackVec3[--Aa.sizeVec3],Ka=this._pool,La=Ka.sizeVec3==0?new x.common.Vec3:Ka.stackVec3[--Ka.sizeVec3],ot=this._pool,It=ot.sizeVec3==0?new x.common.Vec3:ot.stackVec3[--ot.sizeVec3],or=this._pool,gr=or.sizeVec3==0?new x.common.Vec3:or.stackVec3[--or.sizeVec3],ar=this._pool,Ct=ar.sizeVec3==0?new x.common.Vec3:ar.stackVec3[--ar.sizeVec3],_r=Ga;_r.x=tt._pos1X,_r.y=tt._pos1Y,_r.z=tt._pos1Z;var Et=La;Et.x=tt._pos2X,Et.y=tt._pos2Y,Et.z=tt._pos2Z;var At=It;At.x=Ca._manifold._normalX,At.y=Ca._manifold._normalY,At.z=Ca._manifold._normalZ;var Gt=gr;Gt.x=Ca._manifold._tangentX,Gt.y=Ca._manifold._tangentY,Gt.z=Ca._manifold._tangentZ;var Hr=Ct;if(Hr.x=Ca._manifold._binormalX,Hr.y=Ca._manifold._binormalY,Hr.z=Ca._manifold._binormalZ,tt._disabled)a.point(Ga,ct.disabledContactColor),a.point(La,ct.disabledContactColor),a.line(Ga,La,ct.disabledContactColor);else if(tt._warmStarted){var vr;switch(tt._id&3){case 0:vr=ct.contactColor;break;case 1:vr=ct.contactColor2;break;case 2:vr=ct.contactColor3;break;default:vr=ct.contactColor4}a.point(Ga,vr),a.point(La,vr),a.line(Ga,La,ct.contactColor)}else a.point(Ga,ct.newContactColor),a.point(La,ct.newContactColor),a.line(Ga,La,ct.newContactColor);La.x=Ga.x,La.y=Ga.y,La.z=Ga.z;var lr=La,tr=ct.contactNormalLength,Ur=lr.x+It.x*tr,Xr=lr.y+It.y*tr,Mr=lr.z+It.z*tr;if(lr.x=Ur,lr.y=Xr,lr.z=Mr,a.line(Ga,La,ct.contactNormalColor),a.drawContactBases){La.x=Ga.x,La.y=Ga.y,La.z=Ga.z;var Zt=La,ir=ct.contactTangentLength,$t=Zt.x+gr.x*ir,nr=Zt.y+gr.y*ir,jr=Zt.z+gr.z*ir;Zt.x=$t,Zt.y=nr,Zt.z=jr,a.line(Ga,La,ct.contactTangentColor),La.x=Ga.x,La.y=Ga.y,La.z=Ga.z;var Wt=La,Kr=ct.contactBinormalLength,Ir=Wt.x+Ct.x*Kr,mi=Wt.y+Ct.y*Kr,$r=Wt.z+Ct.z*Kr;Wt.x=Ir,Wt.y=mi,Wt.z=$r,a.line(Ga,La,ct.contactBinormalColor)}var Lt=this._pool,Kt=null,Tt=null,br=null;if(Ga!=null){if(Ga.zero(),Lt.sizeVec3==Lt.stackVec3.length){for(var zr=Lt.sizeVec3<<1,vi=new Array(zr),qt=vi,fr=0,dt=Lt.sizeVec3;fr<dt;){var ur=fr++;qt[ur]=Lt.stackVec3[ur],Lt.stackVec3[ur]=null}Lt.stackVec3=qt}Lt.stackVec3[Lt.sizeVec3++]=Ga}if(Kt!=null){var hr=1,ei=0,Xi=0,oo=0,Jt=1,fi=0,pi=0,Dt=0,Bi=1;if(Kt.e00=hr,Kt.e01=ei,Kt.e02=Xi,Kt.e10=oo,Kt.e11=Jt,Kt.e12=fi,Kt.e20=pi,Kt.e21=Dt,Kt.e22=Bi,Lt.sizeMat3==Lt.stackMat3.length){for(var Ar=Lt.sizeMat3<<1,Ni=new Array(Ar),Hn=Ni,no=0,Si=Lt.sizeMat3;no<Si;){var eo=no++;Hn[eo]=Lt.stackMat3[eo],Lt.stackMat3[eo]=null}Lt.stackMat3=Hn}Lt.stackMat3[Lt.sizeMat3++]=Kt}if(Tt!=null){var gn=1,Ao=0,Vo=0,xr=0,ao=0,Ai=1,yi=0,Po=0,Dr=0,Pi=0,gi=1,Rt=0,Or=0,Lr=0,Tn=0,ms=1;if(Tt.e00=gn,Tt.e01=Ao,Tt.e02=Vo,Tt.e03=xr,Tt.e10=ao,Tt.e11=Ai,Tt.e12=yi,Tt.e13=Po,Tt.e20=Dr,Tt.e21=Pi,Tt.e22=gi,Tt.e23=Rt,Tt.e30=Or,Tt.e31=Lr,Tt.e32=Tn,Tt.e33=ms,Lt.sizeMat4==Lt.stackMat4.length){for(var qe=Lt.sizeMat4<<1,ps=new Array(qe),Re=ps,as=0,N_=Lt.sizeMat4;as<N_;){var In=as++;Re[In]=Lt.stackMat4[In],Lt.stackMat4[In]=null}Lt.stackMat4=Re}Lt.stackMat4[Lt.sizeMat4++]=Tt}if(br!=null){var Pr=0,Go=0,Wi=0,ke=1;if(br.x=Pr,br.y=Go,br.z=Wi,br.w=ke,Lt.sizeQuat==Lt.stackQuat.length){for(var nn=Lt.sizeQuat<<1,Rn=new Array(nn),jn=Rn,Xe=0,k_=Lt.sizeQuat;Xe<k_;){var Qe=Xe++;jn[Qe]=Lt.stackQuat[Qe],Lt.stackQuat[Qe]=null}Lt.stackQuat=jn}Lt.stackQuat[Lt.sizeQuat++]=br}var Vr=this._pool,Ii=null,ui=null,so=null;if(La!=null){if(La.zero(),Vr.sizeVec3==Vr.stackVec3.length){for(var Qn=Vr.sizeVec3<<1,ys=new Array(Qn),en=ys,En=0,cr=Vr.sizeVec3;En<cr;){var co=En++;en[co]=Vr.stackVec3[co],Vr.stackVec3[co]=null}Vr.stackVec3=en}Vr.stackVec3[Vr.sizeVec3++]=La}if(Ii!=null){var Fi=1,Dn=0,ts=0,Ee=0,De=1,Ne=0,ce=0,rr=0,ri=1;if(Ii.e00=Fi,Ii.e01=Dn,Ii.e02=ts,Ii.e10=Ee,Ii.e11=De,Ii.e12=Ne,Ii.e20=ce,Ii.e21=rr,Ii.e22=ri,Vr.sizeMat3==Vr.stackMat3.length){for(var Qr=Vr.sizeMat3<<1,Nr=new Array(Qr),uo=Nr,Co=0,__=Vr.sizeMat3;Co<__;){var Fe=Co++;uo[Fe]=Vr.stackMat3[Fe],Vr.stackMat3[Fe]=null}Vr.stackMat3=uo}Vr.stackMat3[Vr.sizeMat3++]=Ii}if(ui!=null){var rs=1,Nn=0,bo=0,Nt=0,Fr=0,li=1,wo=0,be=0,Le=0,Ye=0,xo=1,jt=0,Vi=0,si=0,Jo=0,Gs=1;if(ui.e00=rs,ui.e01=Nn,ui.e02=bo,ui.e03=Nt,ui.e10=Fr,ui.e11=li,ui.e12=wo,ui.e13=be,ui.e20=Le,ui.e21=Ye,ui.e22=xo,ui.e23=jt,ui.e30=Vi,ui.e31=si,ui.e32=Jo,ui.e33=Gs,Vr.sizeMat4==Vr.stackMat4.length){for(var To=Vr.sizeMat4<<1,ko=new Array(To),Gi=ko,Ci=0,Ti=Vr.sizeMat4;Ci<Ti;){var Li=Ci++;Gi[Li]=Vr.stackMat4[Li],Vr.stackMat4[Li]=null}Vr.stackMat4=Gi}Vr.stackMat4[Vr.sizeMat4++]=ui}if(so!=null){var Qt=0,Gr=0,Yr=0,Rr=1;if(so.x=Qt,so.y=Gr,so.z=Yr,so.w=Rr,Vr.sizeQuat==Vr.stackQuat.length){for(var Mi=Vr.sizeQuat<<1,qr=new Array(Mi),Ji=qr,$i=0,to=Vr.sizeQuat;$i<to;){var fe=$i++;Ji[fe]=Vr.stackQuat[fe],Vr.stackQuat[fe]=null}Vr.stackQuat=Ji}Vr.stackQuat[Vr.sizeQuat++]=so}var wr=this._pool,sn=null,Yi=null,$o=null;if(It!=null){if(It.zero(),wr.sizeVec3==wr.stackVec3.length){for(var gs=wr.sizeVec3<<1,Vn=new Array(gs),Is=Vn,wn=0,Cr=wr.sizeVec3;wn<Cr;){var Ro=wn++;Is[Ro]=wr.stackVec3[Ro],wr.stackVec3[Ro]=null}wr.stackVec3=Is}wr.stackVec3[wr.sizeVec3++]=It}if(sn!=null){var _o=1,Fn=0,Ge=0,Gn=0,Wo=1,kn=0,Ze=0,Ut=0,Qo=1;if(sn.e00=_o,sn.e01=Fn,sn.e02=Ge,sn.e10=Gn,sn.e11=Wo,sn.e12=kn,sn.e20=Ze,sn.e21=Ut,sn.e22=Qo,wr.sizeMat3==wr.stackMat3.length){for(var Ui=wr.sizeMat3<<1,Xn=new Array(Ui),Jn=Xn,ue=0,Vs=wr.sizeMat3;ue<Vs;){var Uo=ue++;Jn[Uo]=wr.stackMat3[Uo],wr.stackMat3[Uo]=null}wr.stackMat3=Jn}wr.stackMat3[wr.sizeMat3++]=sn}if(Yi!=null){var ws=1,X_=0,Js=0,L_=0,Je=0,F_=1,G_=0,Oi=0,Xo=0,Lo=0,$n=1,kr=0,Wn=0,Eo=0,ro=0,J_=1;if(Yi.e00=ws,Yi.e01=X_,Yi.e02=Js,Yi.e03=L_,Yi.e10=Je,Yi.e11=F_,Yi.e12=G_,Yi.e13=Oi,Yi.e20=Xo,Yi.e21=Lo,Yi.e22=$n,Yi.e23=kr,Yi.e30=Wn,Yi.e31=Eo,Yi.e32=ro,Yi.e33=J_,wr.sizeMat4==wr.stackMat4.length){for(var $_=wr.sizeMat4<<1,Y_=new Array($_),is=Y_,v_=0,l_=wr.sizeMat4;v_<l_;){var os=v_++;is[os]=wr.stackMat4[os],wr.stackMat4[os]=null}wr.stackMat4=is}wr.stackMat4[wr.sizeMat4++]=Yi}if($o!=null){var mr=0,Oo=0,ai=0,de=1;if($o.x=mr,$o.y=Oo,$o.z=ai,$o.w=de,wr.sizeQuat==wr.stackQuat.length){for(var $s=wr.sizeQuat<<1,cv=new Array($s),xe=cv,$e=0,Kn=wr.sizeQuat;$e<Kn;){var Ws=$e++;xe[Ws]=wr.stackQuat[Ws],wr.stackQuat[Ws]=null}wr.stackQuat=xe}wr.stackQuat[wr.sizeQuat++]=$o}var Tr=this._pool,Yo=null,Ri=null,_n=null;if(gr!=null){if(gr.zero(),Tr.sizeVec3==Tr.stackVec3.length){for(var ks=Tr.sizeVec3<<1,Z_=new Array(ks),We=Z_,qn=0,Ln=Tr.sizeVec3;qn<Ln;){var ns=qn++;We[ns]=Tr.stackVec3[ns],Tr.stackVec3[ns]=null}Tr.stackVec3=We}Tr.stackVec3[Tr.sizeVec3++]=gr}if(Yo!=null){var Be=1,es=0,Us=0,h_=0,Se=1,Ae=0,ae=0,pr=0,Mo=1;if(Yo.e00=Be,Yo.e01=es,Yo.e02=Us,Yo.e10=h_,Yo.e11=Se,Yo.e12=Ae,Yo.e20=ae,Yo.e21=pr,Yo.e22=Mo,Tr.sizeMat3==Tr.stackMat3.length){for(var Zi=Tr.sizeMat3<<1,Ho=new Array(Zi),Zo=Ho,Hi=0,Do=Tr.sizeMat3;Hi<Do;){var Xs=Hi++;Zo[Xs]=Tr.stackMat3[Xs],Tr.stackMat3[Xs]=null}Tr.stackMat3=Zo}Tr.stackMat3[Tr.sizeMat3++]=Yo}if(Ri!=null){var te=1,Os=0,W_=0,re=0,Ft=0,ji=1,No=0,Ls=0,kv=0,i0=0,U_=1,Ot=0,Yn=0,Qi=0,Zn=0,d_=1;if(Ri.e00=te,Ri.e01=Os,Ri.e02=W_,Ri.e03=re,Ri.e10=Ft,Ri.e11=ji,Ri.e12=No,Ri.e13=Ls,Ri.e20=kv,Ri.e21=i0,Ri.e22=U_,Ri.e23=Ot,Ri.e30=Yn,Ri.e31=Qi,Ri.e32=Zn,Ri.e33=d_,Tr.sizeMat4==Tr.stackMat4.length){for(var Hs=Tr.sizeMat4<<1,c_=new Array(Hs),fo=c_,ss=0,_s=Tr.sizeMat4;ss<_s;){var Me=ss++;fo[Me]=Tr.stackMat4[Me],Tr.stackMat4[Me]=null}Tr.stackMat4=fo}Tr.stackMat4[Tr.sizeMat4++]=Ri}if(_n!=null){var Zr=0,jo=0,wi=0,Bo=1;if(_n.x=Zr,_n.y=jo,_n.z=wi,_n.w=Bo,Tr.sizeQuat==Tr.stackQuat.length){for(var Ue=Tr.sizeQuat<<1,bv=new Array(Ue),ze=bv,js=0,Xv=Tr.sizeQuat;js<Xv;){var Oe=js++;ze[Oe]=Tr.stackQuat[Oe],Tr.stackQuat[Oe]=null}Tr.stackQuat=ze}Tr.stackQuat[Tr.sizeQuat++]=_n}var er=this._pool,dn=null,vn=null,ln=null;if(Ct!=null){if(Ct.zero(),er.sizeVec3==er.stackVec3.length){for(var B_=er.sizeVec3<<1,fv=new Array(B_),ie=fv,Pe=0,b_=er.sizeVec3;Pe<b_;){var O_=Pe++;ie[O_]=er.stackVec3[O_],er.stackVec3[O_]=null}er.stackVec3=ie}er.stackVec3[er.sizeVec3++]=Ct}if(dn!=null){var uv=1,xv=0,f_=0,He=0,zo=1,vs=0,ls=0,Wr=0,mo=1;if(dn.e00=uv,dn.e01=xv,dn.e02=f_,dn.e10=He,dn.e11=zo,dn.e12=vs,dn.e20=ls,dn.e21=Wr,dn.e22=mo,er.sizeMat3==er.stackMat3.length){for(var vo=er.sizeMat3<<1,hs=new Array(vo),Ys=hs,Zs=0,ds=er.sizeMat3;Zs<ds;){var S_=Zs++;Ys[S_]=er.stackMat3[S_],er.stackMat3[S_]=null}er.stackMat3=Ys}er.stackMat3[er.sizeMat3++]=dn}if(vn!=null){var me=1,cs=0,H_=0,Ks=0,Un=0,pe=1,Lv=0,A_=0,Ko=0,hn=0,po=1,Ht=0,Ki=0,lo=0,qs=0,Bs=1;if(vn.e00=me,vn.e01=cs,vn.e02=H_,vn.e03=Ks,vn.e10=Un,vn.e11=pe,vn.e12=Lv,vn.e13=A_,vn.e20=Ko,vn.e21=hn,vn.e22=po,vn.e23=Ht,vn.e30=Ki,vn.e31=lo,vn.e32=qs,vn.e33=Bs,er.sizeMat4==er.stackMat4.length){for(var a_=er.sizeMat4<<1,P_=new Array(a_),qo=P_,oe=0,j_=er.sizeMat4;oe<j_;){var Mv=oe++;qo[Mv]=er.stackMat4[Mv],er.stackMat4[Mv]=null}er.stackMat4=qo}er.stackMat4[er.sizeMat4++]=vn}if(ln!=null){var dr=0,yo=0,Ei=0,io=1;if(ln.x=dr,ln.y=yo,ln.z=Ei,ln.w=io,er.sizeQuat==er.stackQuat.length){for(var K_=er.sizeQuat<<1,q_=new Array(K_),Yv=q_,t_=0,Zv=er.sizeQuat;t_<Zv;){var av=t_++;Yv[av]=er.stackQuat[av],er.stackQuat[av]=null}er.stackQuat=Yv}er.stackQuat[er.sizeQuat++]=ln}}r=i}if(a.drawJoints)for(var Br=this._jointList;Br!=null;){var tv=Br._next,Ss=this._pool,As=Ss.sizeVec3==0?new x.common.Vec3:Ss.stackVec3[--Ss.sizeVec3],bs=this._pool,fs=bs.sizeVec3==0?new x.common.Vec3:bs.stackVec3[--bs.sizeVec3],Ps=As;Ps.x=Br._b1._transform._positionX,Ps.y=Br._b1._transform._positionY,Ps.z=Br._b1._transform._positionZ;var dv=fs;dv.x=Br._b2._transform._positionX,dv.y=Br._b2._transform._positionY,dv.z=Br._b2._transform._positionZ;var ye=this._pool,qi=ye.sizeVec3==0?new x.common.Vec3:ye.stackVec3[--ye.sizeVec3],r_=this._pool,go=r_.sizeVec3==0?new x.common.Vec3:r_.stackVec3[--r_.sizeVec3],i_=this._pool,Fo=i_.sizeVec3==0?new x.common.Vec3:i_.stackVec3[--i_.sizeVec3],Cs=this._pool,an=Cs.sizeVec3==0?new x.common.Vec3:Cs.stackVec3[--Cs.sizeVec3],ge=this._pool,sr=ge.sizeVec3==0?new x.common.Vec3:ge.stackVec3[--ge.sizeVec3],tn=this._pool,_i=tn.sizeVec3==0?new x.common.Vec3:tn.stackVec3[--tn.sizeVec3],ne=this._pool,Ie=ne.sizeVec3==0?new x.common.Vec3:ne.stackVec3[--ne.sizeVec3],So=this._pool,Di=So.sizeVec3==0?new x.common.Vec3:So.stackVec3[--So.sizeVec3],Bn=qi;Bn.x=Br._anchor1X,Bn.y=Br._anchor1Y,Bn.z=Br._anchor1Z;var rv=go;rv.x=Br._anchor2X,rv.y=Br._anchor2Y,rv.z=Br._anchor2Z;var o_=Fo;o_.x=Br._basisX1X,o_.y=Br._basisX1Y,o_.z=Br._basisX1Z;var C_=an;C_.x=Br._basisY1X,C_.y=Br._basisY1Y,C_.z=Br._basisY1Z;var iv=sr;iv.x=Br._basisZ1X,iv.y=Br._basisZ1Y,iv.z=Br._basisZ1Z;var ee=_i;ee.x=Br._basisX2X,ee.y=Br._basisX2Y,ee.z=Br._basisX2Z;var Sn=Ie;Sn.x=Br._basisY2X,Sn.y=Br._basisY2Y,Sn.z=Br._basisY2Z;var Ve=Di;if(Ve.x=Br._basisZ2X,Ve.y=Br._basisZ2Y,Ve.z=Br._basisZ2Z,a.line(As,qi,a.style.jointLineColor),a.line(fs,go,a.style.jointLineColor),a.drawJointLimits)switch(Br._type){case 0:break;case 1:var D0=a.style.jointRotationalConstraintRadius,m0=a.style.jointLineColor,cl=Br._lm;this._drawRotationalLimit(a,qi,an,sr,Ie,D0,cl.lowerLimit,cl.upperLimit,m0);break;case 2:var N0=Br,hi=a.style.jointRotationalConstraintRadius,On=a.style.jointLineColor,Io=N0._rotLm,us=N0._translLm;this._drawRotationalLimit(a,go,an,sr,Ie,hi,Io.lowerLimit,Io.upperLimit,On),this._drawTranslationalLimit(a,qi,Fo,us.lowerLimit,us.upperLimit,On);break;case 3:a.style.jointRotationalConstraintRadius;var ov=a.style.jointLineColor,zv=Br._lm;this._drawTranslationalLimit(a,qi,Fo,zv.lowerLimit,zv.upperLimit,ov);break;case 4:var n_=Br,Bv=a.style.jointRotationalConstraintRadius,Ts=a.style.jointLineColor,u_=n_._lm1,x_=n_._lm2;this._drawRotationalLimit(a,qi,an,sr,an,Bv,n_._angleX-u_.upperLimit,n_._angleX-u_.lowerLimit,Ts),this._drawRotationalLimit(a,go,_i,Ie,_i,Bv,x_.lowerLimit-n_._angleZ,x_.upperLimit-n_._angleZ,Ts);break;case 5:var Sr=Br,Rs=a.style.jointRotationalConstraintRadius,ho=a.style.jointLineColor,Ce=Sr._twistLm;this._drawRotationalLimit(a,go,Ie,Di,Ie,Rs,Ce.lowerLimit-Sr._twistAngle,Ce.upperLimit-Sr._twistAngle,ho),this._drawEllipseOnSphere(a,qi,Fo,an,sr,Sr._maxSwingAngle1,Sr._maxSwingAngle2,Rs,ho);var mv=this._pool,Qs=mv.sizeVec3==0?new x.common.Vec3:mv.stackVec3[--mv.sizeVec3];Qs.x=go.x,Qs.y=go.y,Qs.z=go.z;var M_=Qs,nv=M_.x+_i.x*Rs,o0=M_.y+_i.y*Rs,n0=M_.z+_i.z*Rs;M_.x=nv,M_.y=o0,M_.z=n0;var ev=M_;a.line(go,ev,ho);var ti=this._pool,je=null,An=null,xs=null;if(ev!=null){if(ev.zero(),ti.sizeVec3==ti.stackVec3.length){for(var F0=ti.sizeVec3<<1,Nv=new Array(F0),T_=Nv,p0=0,Sv=ti.sizeVec3;p0<Sv;){var e0=p0++;T_[e0]=ti.stackVec3[e0],ti.stackVec3[e0]=null}ti.stackVec3=T_}ti.stackVec3[ti.sizeVec3++]=ev}if(je!=null){var y0=1,G0=0,s0=0,_0=0,g0=1,Fv=0,ci=0,pv=0,cn=1;if(je.e00=y0,je.e01=G0,je.e02=s0,je.e10=_0,je.e11=g0,je.e12=Fv,je.e20=ci,je.e21=pv,je.e22=cn,ti.sizeMat3==ti.stackMat3.length){for(var Gv=ti.sizeMat3<<1,Hl=new Array(Gv),I0=Hl,V0=0,bl=ti.sizeMat3;V0<bl;){var Bl=V0++;I0[Bl]=ti.stackMat3[Bl],ti.stackMat3[Bl]=null}ti.stackMat3=I0}ti.stackMat3[ti.sizeMat3++]=je}if(An!=null){var Jv=1,jl=0,Kl=0,fl=0,Sl=0,Al=1,ql=0,ul=0,ah=0,xl=0,ii=1,Ms=0,rn=0,yv=0,gh=0,$v=1;if(An.e00=Jv,An.e01=jl,An.e02=Kl,An.e03=fl,An.e10=Sl,An.e11=Al,An.e12=ql,An.e13=ul,An.e20=ah,An.e21=xl,An.e22=ii,An.e23=Ms,An.e30=rn,An.e31=yv,An.e32=gh,An.e33=$v,ti.sizeMat4==ti.stackMat4.length){for(var J0=ti.sizeMat4<<1,Ml=new Array(J0),w0=Ml,k0=0,$0=ti.sizeMat4;k0<$0;){var zi=k0++;w0[zi]=ti.stackMat4[zi],ti.stackMat4[zi]=null}ti.stackMat4=w0}ti.stackMat4[ti.sizeMat4++]=An}if(xs!=null){var zs=0,se=0,v0=0,Pl=1;if(xs.x=zs,xs.y=se,xs.z=v0,xs.w=Pl,ti.sizeQuat==ti.stackQuat.length){for(var hh=ti.sizeQuat<<1,W0=new Array(hh),ch=W0,U0=0,Cl=ti.sizeQuat;U0<Cl;){var zl=U0++;ch[zl]=ti.stackQuat[zl],ti.stackQuat[zl]=null}ti.stackQuat=ch}ti.stackQuat[ti.sizeQuat++]=xs}break;case 6:var Te=Br,X0=a.style.jointRotationalConstraintRadius,z_=a.style.jointLineColor,Tl=Te._translLms[0],O0=Te._translLms[1],H0=Te._translLms[2],Rl=Te._rotLms[0],ml=Te._rotLms[1],L0=Te._rotLms[2];this._drawTranslationalLimit3D(a,qi,Fo,an,sr,Tl,O0,H0,z_);var l0=this._pool,m_=l0.sizeVec3==0?new x.common.Vec3:l0.stackVec3[--l0.sizeVec3],Wv=m_;Wv.x=Te._axisYX,Wv.y=Te._axisYY,Wv.z=Te._axisYZ;var Uv=this._pool,sv=Uv.sizeVec3==0?new x.common.Vec3:Uv.stackVec3[--Uv.sizeVec3];sv.x=Fo.x,sv.y=Fo.y,sv.z=Fo.z;var Y0=sv,Av=this._pool,h0=Av.sizeVec3==0?new x.common.Vec3:Av.stackVec3[--Av.sizeVec3];h0.x=Fo.x,h0.y=Fo.y,h0.z=Fo.z;var _e=h0,c0=_e.y*m_.z-_e.z*m_.y,Z0=_e.z*m_.x-_e.x*m_.z,Es=_e.x*m_.y-_e.y*m_.x;_e.x=c0,_e.y=Z0,_e.z=Es;var j0=_e;this._drawRotationalLimit(a,go,an,sr,an,X0,Te._angleX-Rl.upperLimit,Te._angleX-Rl.lowerLimit,z_),this._drawRotationalLimit(a,go,Y0,j0,Y0,X0,ml.lowerLimit-Te._angleY,ml.upperLimit-Te._angleY,z_),this._drawRotationalLimit(a,go,_i,Ie,_i,X0,L0.lowerLimit-Te._angleZ,L0.upperLimit-Te._angleZ,z_);break}a.line(qi,go,a.style.jointErrorColor);var yr=this._pool,bn=null,ki=null,Ov=null;if(As!=null){if(As.zero(),yr.sizeVec3==yr.stackVec3.length){for(var b0=yr.sizeVec3<<1,bh=new Array(b0),th=bh,p_=0,Ke=yr.sizeVec3;p_<Ke;){var Ds=p_++;th[Ds]=yr.stackVec3[Ds],yr.stackVec3[Ds]=null}yr.stackVec3=th}yr.stackVec3[yr.sizeVec3++]=As}if(bn!=null){var rh=1,fh=0,Ql=0,bi=0,e_=1,fn=0,gv=0,K0=0,Iv=1;if(bn.e00=rh,bn.e01=fh,bn.e02=Ql,bn.e10=bi,bn.e11=e_,bn.e12=fn,bn.e20=gv,bn.e21=K0,bn.e22=Iv,yr.sizeMat3==yr.stackMat3.length){for(var pl=yr.sizeMat3<<1,yl=new Array(pl),gl=yl,R_=0,Pv=yr.sizeMat3;R_<Pv;){var Pn=R_++;gl[Pn]=yr.stackMat3[Pn],yr.stackMat3[Pn]=null}yr.stackMat3=gl}yr.stackMat3[yr.sizeMat3++]=bn}if(ki!=null){var Vv=1,Cv=0,Q_=0,ve=0,E_=0,Tv=1,Hv=0,oi=0,y_=0,le=0,Jr=1,g_=0,Cn=0,q0=0,f0=0,uh=1;if(ki.e00=Vv,ki.e01=Cv,ki.e02=Q_,ki.e03=ve,ki.e10=E_,ki.e11=Tv,ki.e12=Hv,ki.e13=oi,ki.e20=y_,ki.e21=le,ki.e22=Jr,ki.e23=g_,ki.e30=Cn,ki.e31=q0,ki.e32=f0,ki.e33=uh,yr.sizeMat4==yr.stackMat4.length){for(var al=yr.sizeMat4<<1,tl=new Array(al),Il=tl,d0=0,xh=yr.sizeMat4;d0<xh;){var Vl=d0++;Il[Vl]=yr.stackMat4[Vl],yr.stackMat4[Vl]=null}yr.stackMat4=Il}yr.stackMat4[yr.sizeMat4++]=ki}if(Ov!=null){var Ih=0,ih=0,wl=0,B0=1;if(Ov.x=Ih,Ov.y=ih,Ov.z=wl,Ov.w=B0,yr.sizeQuat==yr.stackQuat.length){for(var S0=yr.sizeQuat<<1,kl=new Array(S0),oh=kl,jv=0,El=yr.sizeQuat;jv<El;){var Kv=jv++;oh[Kv]=yr.stackQuat[Kv],yr.stackQuat[Kv]=null}yr.stackQuat=oh}yr.stackQuat[yr.sizeQuat++]=Ov}var ni=this._pool,I_=null,on=null,Xl=null;if(fs!=null){if(fs.zero(),ni.sizeVec3==ni.stackVec3.length){for(var A0=ni.sizeVec3<<1,nh=new Array(A0),Dl=nh,rl=0,Nl=ni.sizeVec3;rl<Nl;){var P0=rl++;Dl[P0]=ni.stackVec3[P0],ni.stackVec3[P0]=null}ni.stackVec3=Dl}ni.stackVec3[ni.sizeVec3++]=fs}if(I_!=null){var eh=1,sh=0,Fl=0,Gl=0,_v=1,Rv=0,qv=0,Ns=0,Mh=1;if(I_.e00=eh,I_.e01=sh,I_.e02=Fl,I_.e10=Gl,I_.e11=_v,I_.e12=Rv,I_.e20=qv,I_.e21=Ns,I_.e22=Mh,ni.sizeMat3==ni.stackMat3.length){for(var u0=ni.sizeMat3<<1,Ll=new Array(u0),Qv=Ll,a0=0,Ev=ni.sizeMat3;a0<Ev;){var x0=a0++;Qv[x0]=ni.stackMat3[x0],ni.stackMat3[x0]=null}ni.stackMat3=Qv}ni.stackMat3[ni.sizeMat3++]=I_}if(on!=null){var dh=1,C0=0,t0=0,Jl=0,$l=0,zh=1,Dv=0,xi=0,we=0,he=0,T0=1,Wl=0,Fs=0,M0=0,Yl=0,Ul=1;if(on.e00=dh,on.e01=C0,on.e02=t0,on.e03=Jl,on.e10=$l,on.e11=zh,on.e12=Dv,on.e13=xi,on.e20=we,on.e21=he,on.e22=T0,on.e23=Wl,on.e30=Fs,on.e31=M0,on.e32=Yl,on.e33=Ul,ni.sizeMat4==ni.stackMat4.length){for(var Ol=ni.sizeMat4<<1,Vh=new Array(Ol),vv=Vh,lv=0,R0=ni.sizeMat4;lv<R0;){var V_=lv++;vv[V_]=ni.stackMat4[V_],ni.stackMat4[V_]=null}ni.stackMat4=vv}ni.stackMat4[ni.sizeMat4++]=on}if(Xl!=null){var Zl=0,wh=0,Bh=0,r0=1;if(Xl.x=Zl,Xl.y=wh,Xl.z=Bh,Xl.w=r0,ni.sizeQuat==ni.stackQuat.length){for(var hv=ni.sizeQuat<<1,kh=new Array(hv),dl=kh,Xh=0,jh=ni.sizeQuat;Xh<jh;){var _h=Xh++;dl[_h]=ni.stackQuat[_h],ni.stackQuat[_h]=null}ni.stackQuat=dl}ni.stackQuat[ni.sizeQuat++]=Xl}var Er=this._pool,s_=null,w_=null,vh=null;if(qi!=null){if(qi.zero(),Er.sizeVec3==Er.stackVec3.length){for(var Sh=Er.sizeVec3<<1,Ah=new Array(Sh),mh=Ah,wv=0,Qh=Er.sizeVec3;wv<Qh;){var Eh=wv++;mh[Eh]=Er.stackVec3[Eh],Er.stackVec3[Eh]=null}Er.stackVec3=mh}Er.stackVec3[Er.sizeVec3++]=qi}if(s_!=null){var Kh=1,qh=0,ph=0,Ph=0,il=1,ic=0,Lh=0,D_=0,Dh=1;if(s_.e00=Kh,s_.e01=qh,s_.e02=ph,s_.e10=Ph,s_.e11=il,s_.e12=ic,s_.e20=Lh,s_.e21=D_,s_.e22=Dh,Er.sizeMat3==Er.stackMat3.length){for(var yh=Er.sizeMat3<<1,ac=new Array(yh),Yh=ac,tc=0,Ch=Er.sizeMat3;tc<Ch;){var Q0=tc++;Yh[Q0]=Er.stackMat3[Q0],Er.stackMat3[Q0]=null}Er.stackMat3=Yh}Er.stackMat3[Er.sizeMat3++]=s_}if(w_!=null){var oc=1,lh=0,Zh=0,Nh=0,Th=0,E0=1,z0=0,ec=0,sc=0,Fh=0,nc=1,rc=0,ol=0,Ic=0,Vc=0,mc=1;if(w_.e00=oc,w_.e01=lh,w_.e02=Zh,w_.e03=Nh,w_.e10=Th,w_.e11=E0,w_.e12=z0,w_.e13=ec,w_.e20=sc,w_.e21=Fh,w_.e22=nc,w_.e23=rc,w_.e30=ol,w_.e31=Ic,w_.e32=Vc,w_.e33=mc,Er.sizeMat4==Er.stackMat4.length){for(var pc=Er.sizeMat4<<1,wc=new Array(pc),_c=wc,Rh=0,kc=Er.sizeMat4;Rh<kc;){var Mc=Rh++;_c[Mc]=Er.stackMat4[Mc],Er.stackMat4[Mc]=null}Er.stackMat4=_c}Er.stackMat4[Er.sizeMat4++]=w_}if(vh!=null){var yc=0,gc=0,Xc=0,zc=1;if(vh.x=yc,vh.y=gc,vh.z=Xc,vh.w=zc,Er.sizeQuat==Er.stackQuat.length){for(var ff=Er.sizeQuat<<1,uf=new Array(ff),ob=uf,nb=0,xf=Er.sizeQuat;nb<xf;){var Lc=nb++;ob[Lc]=Er.stackQuat[Lc],Er.stackQuat[Lc]=null}Er.stackQuat=ob}Er.stackQuat[Er.sizeQuat++]=vh}var un=this._pool,Gh=null,nl=null,vc=null;if(go!=null){if(go.zero(),un.sizeVec3==un.stackVec3.length){for(var Mf=un.sizeVec3<<1,zf=new Array(Mf),eb=zf,sb=0,mf=un.sizeVec3;sb<mf;){var Yc=sb++;eb[Yc]=un.stackVec3[Yc],un.stackVec3[Yc]=null}un.stackVec3=eb}un.stackVec3[un.sizeVec3++]=go}if(Gh!=null){var pf=1,yf=0,gf=0,If=0,Vf=1,wf=0,kf=0,Xf=0,Lf=1;if(Gh.e00=pf,Gh.e01=yf,Gh.e02=gf,Gh.e10=If,Gh.e11=Vf,Gh.e12=wf,Gh.e20=kf,Gh.e21=Xf,Gh.e22=Lf,un.sizeMat3==un.stackMat3.length){for(var Yf=un.sizeMat3<<1,Zf=new Array(Yf),_b=Zf,vb=0,df=un.sizeMat3;vb<df;){var Zc=vb++;_b[Zc]=un.stackMat3[Zc],un.stackMat3[Zc]=null}un.stackMat3=_b}un.stackMat3[un.sizeMat3++]=Gh}if(nl!=null){var Bf=1,Sf=0,Af=0,Pf=0,Cf=0,Tf=1,Rf=0,Qf=0,Ef=0,Df=0,Nf=1,Ff=0,Gf=0,Jf=0,$f=0,Wf=1;if(nl.e00=Bf,nl.e01=Sf,nl.e02=Af,nl.e03=Pf,nl.e10=Cf,nl.e11=Tf,nl.e12=Rf,nl.e13=Qf,nl.e20=Ef,nl.e21=Df,nl.e22=Nf,nl.e23=Ff,nl.e30=Gf,nl.e31=Jf,nl.e32=$f,nl.e33=Wf,un.sizeMat4==un.stackMat4.length){for(var Uf=un.sizeMat4<<1,Of=new Array(Uf),lb=Of,hb=0,Hf=un.sizeMat4;hb<Hf;){var dc=hb++;lb[dc]=un.stackMat4[dc],un.stackMat4[dc]=null}un.stackMat4=lb}un.stackMat4[un.sizeMat4++]=nl}if(vc!=null){var jf=0,Kf=0,qf=0,au=1;if(vc.x=jf,vc.y=Kf,vc.z=qf,vc.w=au,un.sizeQuat==un.stackQuat.length){for(var tu=un.sizeQuat<<1,ru=new Array(tu),cb=ru,bb=0,iu=un.sizeQuat;bb<iu;){var Bc=bb++;cb[Bc]=un.stackQuat[Bc],un.stackQuat[Bc]=null}un.stackQuat=cb}un.stackQuat[un.sizeQuat++]=vc}var xn=this._pool,Jh=null,el=null,lc=null;if(Fo!=null){if(Fo.zero(),xn.sizeVec3==xn.stackVec3.length){for(var ou=xn.sizeVec3<<1,nu=new Array(ou),fb=nu,ub=0,eu=xn.sizeVec3;ub<eu;){var Sc=ub++;fb[Sc]=xn.stackVec3[Sc],xn.stackVec3[Sc]=null}xn.stackVec3=fb}xn.stackVec3[xn.sizeVec3++]=Fo}if(Jh!=null){var su=1,_u=0,vu=0,lu=0,hu=1,cu=0,bu=0,fu=0,uu=1;if(Jh.e00=su,Jh.e01=_u,Jh.e02=vu,Jh.e10=lu,Jh.e11=hu,Jh.e12=cu,Jh.e20=bu,Jh.e21=fu,Jh.e22=uu,xn.sizeMat3==xn.stackMat3.length){for(var xu=xn.sizeMat3<<1,Mu=new Array(xu),xb=Mu,Mb=0,zu=xn.sizeMat3;Mb<zu;){var Ac=Mb++;xb[Ac]=xn.stackMat3[Ac],xn.stackMat3[Ac]=null}xn.stackMat3=xb}xn.stackMat3[xn.sizeMat3++]=Jh}if(el!=null){var mu=1,pu=0,yu=0,gu=0,Iu=0,Vu=1,wu=0,ku=0,Xu=0,Lu=0,Yu=1,Zu=0,du=0,Bu=0,Su=0,Au=1;if(el.e00=mu,el.e01=pu,el.e02=yu,el.e03=gu,el.e10=Iu,el.e11=Vu,el.e12=wu,el.e13=ku,el.e20=Xu,el.e21=Lu,el.e22=Yu,el.e23=Zu,el.e30=du,el.e31=Bu,el.e32=Su,el.e33=Au,xn.sizeMat4==xn.stackMat4.length){for(var Pu=xn.sizeMat4<<1,Cu=new Array(Pu),zb=Cu,mb=0,Tu=xn.sizeMat4;mb<Tu;){var Pc=mb++;zb[Pc]=xn.stackMat4[Pc],xn.stackMat4[Pc]=null}xn.stackMat4=zb}xn.stackMat4[xn.sizeMat4++]=el}if(lc!=null){var Ru=0,Qu=0,Eu=0,Du=1;if(lc.x=Ru,lc.y=Qu,lc.z=Eu,lc.w=Du,xn.sizeQuat==xn.stackQuat.length){for(var Nu=xn.sizeQuat<<1,Fu=new Array(Nu),pb=Fu,yb=0,Gu=xn.sizeQuat;yb<Gu;){var Cc=yb++;pb[Cc]=xn.stackQuat[Cc],xn.stackQuat[Cc]=null}xn.stackQuat=pb}xn.stackQuat[xn.sizeQuat++]=lc}var Mn=this._pool,$h=null,sl=null,hc=null;if(an!=null){if(an.zero(),Mn.sizeVec3==Mn.stackVec3.length){for(var Ju=Mn.sizeVec3<<1,$u=new Array(Ju),gb=$u,Ib=0,Wu=Mn.sizeVec3;Ib<Wu;){var Tc=Ib++;gb[Tc]=Mn.stackVec3[Tc],Mn.stackVec3[Tc]=null}Mn.stackVec3=gb}Mn.stackVec3[Mn.sizeVec3++]=an}if($h!=null){var Uu=1,Ou=0,Hu=0,ju=0,Ku=1,qu=0,ax=0,tx=0,rx=1;if($h.e00=Uu,$h.e01=Ou,$h.e02=Hu,$h.e10=ju,$h.e11=Ku,$h.e12=qu,$h.e20=ax,$h.e21=tx,$h.e22=rx,Mn.sizeMat3==Mn.stackMat3.length){for(var ix=Mn.sizeMat3<<1,ox=new Array(ix),Vb=ox,wb=0,nx=Mn.sizeMat3;wb<nx;){var Rc=wb++;Vb[Rc]=Mn.stackMat3[Rc],Mn.stackMat3[Rc]=null}Mn.stackMat3=Vb}Mn.stackMat3[Mn.sizeMat3++]=$h}if(sl!=null){var ex=1,sx=0,_x=0,vx=0,lx=0,hx=1,cx=0,bx=0,fx=0,ux=0,xx=1,Mx=0,zx=0,mx=0,px=0,yx=1;if(sl.e00=ex,sl.e01=sx,sl.e02=_x,sl.e03=vx,sl.e10=lx,sl.e11=hx,sl.e12=cx,sl.e13=bx,sl.e20=fx,sl.e21=ux,sl.e22=xx,sl.e23=Mx,sl.e30=zx,sl.e31=mx,sl.e32=px,sl.e33=yx,Mn.sizeMat4==Mn.stackMat4.length){for(var gx=Mn.sizeMat4<<1,Ix=new Array(gx),kb=Ix,Xb=0,Vx=Mn.sizeMat4;Xb<Vx;){var Qc=Xb++;kb[Qc]=Mn.stackMat4[Qc],Mn.stackMat4[Qc]=null}Mn.stackMat4=kb}Mn.stackMat4[Mn.sizeMat4++]=sl}if(hc!=null){var wx=0,kx=0,Xx=0,Lx=1;if(hc.x=wx,hc.y=kx,hc.z=Xx,hc.w=Lx,Mn.sizeQuat==Mn.stackQuat.length){for(var Yx=Mn.sizeQuat<<1,Zx=new Array(Yx),Lb=Zx,Yb=0,dx=Mn.sizeQuat;Yb<dx;){var Ec=Yb++;Lb[Ec]=Mn.stackQuat[Ec],Mn.stackQuat[Ec]=null}Mn.stackQuat=Lb}Mn.stackQuat[Mn.sizeQuat++]=hc}var zn=this._pool,Wh=null,_l=null,cc=null;if(sr!=null){if(sr.zero(),zn.sizeVec3==zn.stackVec3.length){for(var Bx=zn.sizeVec3<<1,Sx=new Array(Bx),Zb=Sx,db=0,Ax=zn.sizeVec3;db<Ax;){var Dc=db++;Zb[Dc]=zn.stackVec3[Dc],zn.stackVec3[Dc]=null}zn.stackVec3=Zb}zn.stackVec3[zn.sizeVec3++]=sr}if(Wh!=null){var Px=1,Cx=0,Tx=0,Rx=0,Qx=1,Ex=0,Dx=0,Nx=0,Fx=1;if(Wh.e00=Px,Wh.e01=Cx,Wh.e02=Tx,Wh.e10=Rx,Wh.e11=Qx,Wh.e12=Ex,Wh.e20=Dx,Wh.e21=Nx,Wh.e22=Fx,zn.sizeMat3==zn.stackMat3.length){for(var Gx=zn.sizeMat3<<1,Jx=new Array(Gx),Bb=Jx,Sb=0,$x=zn.sizeMat3;Sb<$x;){var Nc=Sb++;Bb[Nc]=zn.stackMat3[Nc],zn.stackMat3[Nc]=null}zn.stackMat3=Bb}zn.stackMat3[zn.sizeMat3++]=Wh}if(_l!=null){var Wx=1,Ux=0,Ox=0,Hx=0,jx=0,Kx=1,qx=0,a2=0,t2=0,r2=0,i2=1,o2=0,n2=0,e2=0,s2=0,_2=1;if(_l.e00=Wx,_l.e01=Ux,_l.e02=Ox,_l.e03=Hx,_l.e10=jx,_l.e11=Kx,_l.e12=qx,_l.e13=a2,_l.e20=t2,_l.e21=r2,_l.e22=i2,_l.e23=o2,_l.e30=n2,_l.e31=e2,_l.e32=s2,_l.e33=_2,zn.sizeMat4==zn.stackMat4.length){for(var v2=zn.sizeMat4<<1,l2=new Array(v2),Ab=l2,Pb=0,h2=zn.sizeMat4;Pb<h2;){var Fc=Pb++;Ab[Fc]=zn.stackMat4[Fc],zn.stackMat4[Fc]=null}zn.stackMat4=Ab}zn.stackMat4[zn.sizeMat4++]=_l}if(cc!=null){var c2=0,b2=0,f2=0,u2=1;if(cc.x=c2,cc.y=b2,cc.z=f2,cc.w=u2,zn.sizeQuat==zn.stackQuat.length){for(var x2=zn.sizeQuat<<1,M2=new Array(x2),Cb=M2,Tb=0,z2=zn.sizeQuat;Tb<z2;){var Gc=Tb++;Cb[Gc]=zn.stackQuat[Gc],zn.stackQuat[Gc]=null}zn.stackQuat=Cb}zn.stackQuat[zn.sizeQuat++]=cc}var mn=this._pool,Uh=null,vl=null,bc=null;if(_i!=null){if(_i.zero(),mn.sizeVec3==mn.stackVec3.length){for(var m2=mn.sizeVec3<<1,p2=new Array(m2),Rb=p2,Qb=0,y2=mn.sizeVec3;Qb<y2;){var Jc=Qb++;Rb[Jc]=mn.stackVec3[Jc],mn.stackVec3[Jc]=null}mn.stackVec3=Rb}mn.stackVec3[mn.sizeVec3++]=_i}if(Uh!=null){var g2=1,I2=0,V2=0,w2=0,k2=1,X2=0,L2=0,Y2=0,Z2=1;if(Uh.e00=g2,Uh.e01=I2,Uh.e02=V2,Uh.e10=w2,Uh.e11=k2,Uh.e12=X2,Uh.e20=L2,Uh.e21=Y2,Uh.e22=Z2,mn.sizeMat3==mn.stackMat3.length){for(var d2=mn.sizeMat3<<1,B2=new Array(d2),Eb=B2,Db=0,S2=mn.sizeMat3;Db<S2;){var $c=Db++;Eb[$c]=mn.stackMat3[$c],mn.stackMat3[$c]=null}mn.stackMat3=Eb}mn.stackMat3[mn.sizeMat3++]=Uh}if(vl!=null){var A2=1,P2=0,C2=0,T2=0,R2=0,Q2=1,E2=0,D2=0,N2=0,F2=0,G2=1,J2=0,$2=0,W2=0,U2=0,O2=1;if(vl.e00=A2,vl.e01=P2,vl.e02=C2,vl.e03=T2,vl.e10=R2,vl.e11=Q2,vl.e12=E2,vl.e13=D2,vl.e20=N2,vl.e21=F2,vl.e22=G2,vl.e23=J2,vl.e30=$2,vl.e31=W2,vl.e32=U2,vl.e33=O2,mn.sizeMat4==mn.stackMat4.length){for(var H2=mn.sizeMat4<<1,j2=new Array(H2),Nb=j2,Fb=0,K2=mn.sizeMat4;Fb<K2;){var Wc=Fb++;Nb[Wc]=mn.stackMat4[Wc],mn.stackMat4[Wc]=null}mn.stackMat4=Nb}mn.stackMat4[mn.sizeMat4++]=vl}if(bc!=null){var q2=0,aM=0,tM=0,rM=1;if(bc.x=q2,bc.y=aM,bc.z=tM,bc.w=rM,mn.sizeQuat==mn.stackQuat.length){for(var iM=mn.sizeQuat<<1,oM=new Array(iM),Gb=oM,Jb=0,nM=mn.sizeQuat;Jb<nM;){var Uc=Jb++;Gb[Uc]=mn.stackQuat[Uc],mn.stackQuat[Uc]=null}mn.stackQuat=Gb}mn.stackQuat[mn.sizeQuat++]=bc}var pn=this._pool,Oh=null,ll=null,fc=null;if(Ie!=null){if(Ie.zero(),pn.sizeVec3==pn.stackVec3.length){for(var eM=pn.sizeVec3<<1,sM=new Array(eM),$b=sM,Wb=0,_M=pn.sizeVec3;Wb<_M;){var Oc=Wb++;$b[Oc]=pn.stackVec3[Oc],pn.stackVec3[Oc]=null}pn.stackVec3=$b}pn.stackVec3[pn.sizeVec3++]=Ie}if(Oh!=null){var vM=1,lM=0,hM=0,cM=0,bM=1,fM=0,uM=0,xM=0,MM=1;if(Oh.e00=vM,Oh.e01=lM,Oh.e02=hM,Oh.e10=cM,Oh.e11=bM,Oh.e12=fM,Oh.e20=uM,Oh.e21=xM,Oh.e22=MM,pn.sizeMat3==pn.stackMat3.length){for(var zM=pn.sizeMat3<<1,mM=new Array(zM),Ub=mM,Ob=0,pM=pn.sizeMat3;Ob<pM;){var Hc=Ob++;Ub[Hc]=pn.stackMat3[Hc],pn.stackMat3[Hc]=null}pn.stackMat3=Ub}pn.stackMat3[pn.sizeMat3++]=Oh}if(ll!=null){var yM=1,gM=0,IM=0,VM=0,wM=0,kM=1,XM=0,LM=0,YM=0,ZM=0,dM=1,BM=0,SM=0,AM=0,PM=0,CM=1;if(ll.e00=yM,ll.e01=gM,ll.e02=IM,ll.e03=VM,ll.e10=wM,ll.e11=kM,ll.e12=XM,ll.e13=LM,ll.e20=YM,ll.e21=ZM,ll.e22=dM,ll.e23=BM,ll.e30=SM,ll.e31=AM,ll.e32=PM,ll.e33=CM,pn.sizeMat4==pn.stackMat4.length){for(var TM=pn.sizeMat4<<1,RM=new Array(TM),Hb=RM,jb=0,QM=pn.sizeMat4;jb<QM;){var jc=jb++;Hb[jc]=pn.stackMat4[jc],pn.stackMat4[jc]=null}pn.stackMat4=Hb}pn.stackMat4[pn.sizeMat4++]=ll}if(fc!=null){var EM=0,DM=0,NM=0,FM=1;if(fc.x=EM,fc.y=DM,fc.z=NM,fc.w=FM,pn.sizeQuat==pn.stackQuat.length){for(var GM=pn.sizeQuat<<1,JM=new Array(GM),Kb=JM,qb=0,$M=pn.sizeQuat;qb<$M;){var Kc=qb++;Kb[Kc]=pn.stackQuat[Kc],pn.stackQuat[Kc]=null}pn.stackQuat=Kb}pn.stackQuat[pn.sizeQuat++]=fc}var yn=this._pool,Hh=null,hl=null,uc=null;if(Di!=null){if(Di.zero(),yn.sizeVec3==yn.stackVec3.length){for(var WM=yn.sizeVec3<<1,UM=new Array(WM),af=UM,tf=0,OM=yn.sizeVec3;tf<OM;){var qc=tf++;af[qc]=yn.stackVec3[qc],yn.stackVec3[qc]=null}yn.stackVec3=af}yn.stackVec3[yn.sizeVec3++]=Di}if(Hh!=null){var HM=1,jM=0,KM=0,qM=0,az=1,tz=0,rz=0,iz=0,oz=1;if(Hh.e00=HM,Hh.e01=jM,Hh.e02=KM,Hh.e10=qM,Hh.e11=az,Hh.e12=tz,Hh.e20=rz,Hh.e21=iz,Hh.e22=oz,yn.sizeMat3==yn.stackMat3.length){for(var nz=yn.sizeMat3<<1,ez=new Array(nz),rf=ez,of=0,sz=yn.sizeMat3;of<sz;){var ab=of++;rf[ab]=yn.stackMat3[ab],yn.stackMat3[ab]=null}yn.stackMat3=rf}yn.stackMat3[yn.sizeMat3++]=Hh}if(hl!=null){var _z=1,vz=0,lz=0,hz=0,cz=0,bz=1,fz=0,uz=0,xz=0,Mz=0,zz=1,mz=0,pz=0,yz=0,gz=0,Iz=1;if(hl.e00=_z,hl.e01=vz,hl.e02=lz,hl.e03=hz,hl.e10=cz,hl.e11=bz,hl.e12=fz,hl.e13=uz,hl.e20=xz,hl.e21=Mz,hl.e22=zz,hl.e23=mz,hl.e30=pz,hl.e31=yz,hl.e32=gz,hl.e33=Iz,yn.sizeMat4==yn.stackMat4.length){for(var Vz=yn.sizeMat4<<1,wz=new Array(Vz),nf=wz,ef=0,kz=yn.sizeMat4;ef<kz;){var tb=ef++;nf[tb]=yn.stackMat4[tb],yn.stackMat4[tb]=null}yn.stackMat4=nf}yn.stackMat4[yn.sizeMat4++]=hl}if(uc!=null){var Xz=0,Lz=0,Yz=0,Zz=1;if(uc.x=Xz,uc.y=Lz,uc.z=Yz,uc.w=Zz,yn.sizeQuat==yn.stackQuat.length){for(var dz=yn.sizeQuat<<1,Bz=new Array(dz),sf=Bz,_f=0,Sz=yn.sizeQuat;_f<Sz;){var rb=_f++;sf[rb]=yn.stackQuat[rb],yn.stackQuat[rb]=null}yn.stackQuat=sf}yn.stackQuat[yn.sizeQuat++]=uc}Br=tv}}_drawRotationalLimit(a,t,r,i,o,s,_,h,v){if(_!=h){var e=this._pool,l=e.sizeVec3==0?new x.common.Vec3:e.stackVec3[--e.sizeVec3];l.x=t.x,l.y=t.y,l.z=t.z;var u=l,b=u.x+o.x*s,f=u.y+o.y*s,n=u.z+o.z*s;u.x=b,u.y=f,u.z=n;var c=u;a.line(t,c,v);var M=this._pool,m=null,y=null,V=null;if(c!=null){if(c.zero(),M.sizeVec3==M.stackVec3.length){for(var z=M.sizeVec3<<1,I=new Array(z),w=I,X=0,L=M.sizeVec3;X<L;){var p=X++;w[p]=M.stackVec3[p],M.stackVec3[p]=null}M.stackVec3=w}M.stackVec3[M.sizeVec3++]=c}if(m!=null){var g=1,F=0,S=0,N=0,A=1,Y=0,R=0,C=0,d=1;if(m.e00=g,m.e01=F,m.e02=S,m.e10=N,m.e11=A,m.e12=Y,m.e20=R,m.e21=C,m.e22=d,M.sizeMat3==M.stackMat3.length){for(var Z=M.sizeMat3<<1,j=new Array(Z),H=j,E=0,G=M.sizeMat3;E<G;){var B=E++;H[B]=M.stackMat3[B],M.stackMat3[B]=null}M.stackMat3=H}M.stackMat3[M.sizeMat3++]=m}if(y!=null){var Q=1,W=0,J=0,D=0,O=0,K=1,ra=0,sa=0,$=0,q=0,na=1,oa=0,aa=0,T=0,ca=0,_a=1;if(y.e00=Q,y.e01=W,y.e02=J,y.e03=D,y.e10=O,y.e11=K,y.e12=ra,y.e13=sa,y.e20=$,y.e21=q,y.e22=na,y.e23=oa,y.e30=aa,y.e31=T,y.e32=ca,y.e33=_a,M.sizeMat4==M.stackMat4.length){for(var k=M.sizeMat4<<1,ta=new Array(k),ia=ta,la=0,va=M.sizeMat4;la<va;){var xa=la++;ia[xa]=M.stackMat4[xa],M.stackMat4[xa]=null}M.stackMat4=ia}M.stackMat4[M.sizeMat4++]=y}if(V!=null){var Ma=0,za=0,Xa=0,Za=1;if(V.x=Ma,V.y=za,V.z=Xa,V.w=Za,M.sizeQuat==M.stackQuat.length){for(var fa=M.sizeQuat<<1,ba=new Array(fa),ea=ba,ha=0,pa=M.sizeQuat;ha<pa;){var ya=ha++;ea[ya]=M.stackQuat[ya],M.stackQuat[ya]=null}M.stackQuat=ea}M.stackQuat[M.sizeQuat++]=V}_>h?a.ellipse(t,r,i,s,s,v):a.arc(t,r,i,s,s,_,h,!0,v)}}_drawTranslationalLimit(a,t,r,i,o,s){if(i<o){var _=this._pool,h=_.sizeVec3==0?new x.common.Vec3:_.stackVec3[--_.sizeVec3];h.x=t.x,h.y=t.y,h.z=t.z;var v=h,e=v.x+r.x*i,l=v.y+r.y*i,u=v.z+r.z*i;v.x=e,v.y=l,v.z=u;var b=v,f=this._pool,n=f.sizeVec3==0?new x.common.Vec3:f.stackVec3[--f.sizeVec3];n.x=t.x,n.y=t.y,n.z=t.z;var c=n,M=c.x+r.x*o,m=c.y+r.y*o,y=c.z+r.z*o;c.x=M,c.y=m,c.z=y;var V=c;a.line(b,V,s);var z=this._pool,I=null,w=null,X=null;if(b!=null){if(b.zero(),z.sizeVec3==z.stackVec3.length){for(var L=z.sizeVec3<<1,p=new Array(L),g=p,F=0,S=z.sizeVec3;F<S;){var N=F++;g[N]=z.stackVec3[N],z.stackVec3[N]=null}z.stackVec3=g}z.stackVec3[z.sizeVec3++]=b}if(I!=null){var A=1,Y=0,R=0,C=0,d=1,Z=0,j=0,H=0,E=1;if(I.e00=A,I.e01=Y,I.e02=R,I.e10=C,I.e11=d,I.e12=Z,I.e20=j,I.e21=H,I.e22=E,z.sizeMat3==z.stackMat3.length){for(var G=z.sizeMat3<<1,B=new Array(G),Q=B,W=0,J=z.sizeMat3;W<J;){var D=W++;Q[D]=z.stackMat3[D],z.stackMat3[D]=null}z.stackMat3=Q}z.stackMat3[z.sizeMat3++]=I}if(w!=null){var O=1,K=0,ra=0,sa=0,$=0,q=1,na=0,oa=0,aa=0,T=0,ca=1,_a=0,k=0,ta=0,ia=0,la=1;if(w.e00=O,w.e01=K,w.e02=ra,w.e03=sa,w.e10=$,w.e11=q,w.e12=na,w.e13=oa,w.e20=aa,w.e21=T,w.e22=ca,w.e23=_a,w.e30=k,w.e31=ta,w.e32=ia,w.e33=la,z.sizeMat4==z.stackMat4.length){for(var va=z.sizeMat4<<1,xa=new Array(va),Ma=xa,za=0,Xa=z.sizeMat4;za<Xa;){var Za=za++;Ma[Za]=z.stackMat4[Za],z.stackMat4[Za]=null}z.stackMat4=Ma}z.stackMat4[z.sizeMat4++]=w}if(X!=null){var fa=0,ba=0,ea=0,ha=1;if(X.x=fa,X.y=ba,X.z=ea,X.w=ha,z.sizeQuat==z.stackQuat.length){for(var pa=z.sizeQuat<<1,ya=new Array(pa),da=ya,ma=0,Ya=z.sizeQuat;ma<Ya;){var Qa=ma++;da[Qa]=z.stackQuat[Qa],z.stackQuat[Qa]=null}z.stackQuat=da}z.stackQuat[z.sizeQuat++]=X}var ga=this._pool,ua=null,ka=null,wa=null;if(V!=null){if(V.zero(),ga.sizeVec3==ga.stackVec3.length){for(var Pa=ga.sizeVec3<<1,Mt=new Array(Pa),Oa=Mt,Ba=0,nt=ga.sizeVec3;Ba<nt;){var Ea=Ba++;Oa[Ea]=ga.stackVec3[Ea],ga.stackVec3[Ea]=null}ga.stackVec3=Oa}ga.stackVec3[ga.sizeVec3++]=V}if(ua!=null){var Na=1,Sa=0,ft=0,Wa=0,Ha=1,bt=0,rt=0,ja=0,_t=1;if(ua.e00=Na,ua.e01=Sa,ua.e02=ft,ua.e10=Wa,ua.e11=Ha,ua.e12=bt,ua.e20=rt,ua.e21=ja,ua.e22=_t,ga.sizeMat3==ga.stackMat3.length){for(var gt=ga.sizeMat3<<1,mt=new Array(gt),Ja=mt,it=0,ut=ga.sizeMat3;it<ut;){var Da=it++;Ja[Da]=ga.stackMat3[Da],ga.stackMat3[Da]=null}ga.stackMat3=Ja}ga.stackMat3[ga.sizeMat3++]=ua}if(ka!=null){var Ta=1,Fa=0,Vt=0,Pt=0,et=0,Xt=1,Yt=0,zt=0,Ia=0,U=0,Va=1,lt=0,P=0,kt=0,Bt=0,St=1;if(ka.e00=Ta,ka.e01=Fa,ka.e02=Vt,ka.e03=Pt,ka.e10=et,ka.e11=Xt,ka.e12=Yt,ka.e13=zt,ka.e20=Ia,ka.e21=U,ka.e22=Va,ka.e23=lt,ka.e30=P,ka.e31=kt,ka.e32=Bt,ka.e33=St,ga.sizeMat4==ga.stackMat4.length){for(var yt=ga.sizeMat4<<1,wt=new Array(yt),pt=wt,ht=0,xt=ga.sizeMat4;ht<xt;){var Ra=ht++;pt[Ra]=ga.stackMat4[Ra],ga.stackMat4[Ra]=null}ga.stackMat4=pt}ga.stackMat4[ga.sizeMat4++]=ka}if(wa!=null){var st=0,Ca=0,vt=0,qa=1;if(wa.x=st,wa.y=Ca,wa.z=vt,wa.w=qa,ga.sizeQuat==ga.stackQuat.length){for(var at=ga.sizeQuat<<1,Ua=new Array(at),tt=Ua,ct=0,Aa=ga.sizeQuat;ct<Aa;){var Ga=ct++;tt[Ga]=ga.stackQuat[Ga],ga.stackQuat[Ga]=null}ga.stackQuat=tt}ga.stackQuat[ga.sizeQuat++]=wa}}}_drawTranslationalLimit3D(a,t,r,i,o,s,_,h,v){var e=s.lowerLimit,l=s.upperLimit,u=_.lowerLimit,b=_.upperLimit,f=h.lowerLimit,n=h.upperLimit,c=this._pool;c.sizeVec3==0?new x.common.Vec3:c.stackVec3[--c.sizeVec3];var M=this._pool;M.sizeVec3==0?new x.common.Vec3:M.stackVec3[--M.sizeVec3];var m=this._pool,y=m.sizeVec3==0?new x.common.Vec3:m.stackVec3[--m.sizeVec3];y.x=t.x,y.y=t.y,y.z=t.z;var V=y,z=V.x+r.x*e,I=V.y+r.y*e,w=V.z+r.z*e;V.x=z,V.y=I,V.z=w;var X=V,L=X.x+i.x*u,p=X.y+i.y*u,g=X.z+i.z*u;X.x=L,X.y=p,X.z=g;var F=X,S=F.x+o.x*f,N=F.y+o.y*f,A=F.z+o.z*f;F.x=S,F.y=N,F.z=A;var Y=F,R=this._pool,C=R.sizeVec3==0?new x.common.Vec3:R.stackVec3[--R.sizeVec3];C.x=t.x,C.y=t.y,C.z=t.z;var d=C,Z=d.x+r.x*e,j=d.y+r.y*e,H=d.z+r.z*e;d.x=Z,d.y=j,d.z=H;var E=d,G=E.x+i.x*u,B=E.y+i.y*u,Q=E.z+i.z*u;E.x=G,E.y=B,E.z=Q;var W=E,J=W.x+o.x*n,D=W.y+o.y*n,O=W.z+o.z*n;W.x=J,W.y=D,W.z=O;var K=W,ra=this._pool,sa=ra.sizeVec3==0?new x.common.Vec3:ra.stackVec3[--ra.sizeVec3];sa.x=t.x,sa.y=t.y,sa.z=t.z;var $=sa,q=$.x+r.x*e,na=$.y+r.y*e,oa=$.z+r.z*e;$.x=q,$.y=na,$.z=oa;var aa=$,T=aa.x+i.x*b,ca=aa.y+i.y*b,_a=aa.z+i.z*b;aa.x=T,aa.y=ca,aa.z=_a;var k=aa,ta=k.x+o.x*f,ia=k.y+o.y*f,la=k.z+o.z*f;k.x=ta,k.y=ia,k.z=la;var va=k,xa=this._pool,Ma=xa.sizeVec3==0?new x.common.Vec3:xa.stackVec3[--xa.sizeVec3];Ma.x=t.x,Ma.y=t.y,Ma.z=t.z;var za=Ma,Xa=za.x+r.x*e,Za=za.y+r.y*e,fa=za.z+r.z*e;za.x=Xa,za.y=Za,za.z=fa;var ba=za,ea=ba.x+i.x*b,ha=ba.y+i.y*b,pa=ba.z+i.z*b;ba.x=ea,ba.y=ha,ba.z=pa;var ya=ba,da=ya.x+o.x*n,ma=ya.y+o.y*n,Ya=ya.z+o.z*n;ya.x=da,ya.y=ma,ya.z=Ya;var Qa=ya,ga=this._pool,ua=ga.sizeVec3==0?new x.common.Vec3:ga.stackVec3[--ga.sizeVec3];ua.x=t.x,ua.y=t.y,ua.z=t.z;var ka=ua,wa=ka.x+r.x*l,Pa=ka.y+r.y*l,Mt=ka.z+r.z*l;ka.x=wa,ka.y=Pa,ka.z=Mt;var Oa=ka,Ba=Oa.x+i.x*u,nt=Oa.y+i.y*u,Ea=Oa.z+i.z*u;Oa.x=Ba,Oa.y=nt,Oa.z=Ea;var Na=Oa,Sa=Na.x+o.x*f,ft=Na.y+o.y*f,Wa=Na.z+o.z*f;Na.x=Sa,Na.y=ft,Na.z=Wa;var Ha=Na,bt=this._pool,rt=bt.sizeVec3==0?new x.common.Vec3:bt.stackVec3[--bt.sizeVec3];rt.x=t.x,rt.y=t.y,rt.z=t.z;var ja=rt,_t=ja.x+r.x*l,gt=ja.y+r.y*l,mt=ja.z+r.z*l;ja.x=_t,ja.y=gt,ja.z=mt;var Ja=ja,it=Ja.x+i.x*u,ut=Ja.y+i.y*u,Da=Ja.z+i.z*u;Ja.x=it,Ja.y=ut,Ja.z=Da;var Ta=Ja,Fa=Ta.x+o.x*n,Vt=Ta.y+o.y*n,Pt=Ta.z+o.z*n;Ta.x=Fa,Ta.y=Vt,Ta.z=Pt;var et=Ta,Xt=this._pool,Yt=Xt.sizeVec3==0?new x.common.Vec3:Xt.stackVec3[--Xt.sizeVec3];Yt.x=t.x,Yt.y=t.y,Yt.z=t.z;var zt=Yt,Ia=zt.x+r.x*l,U=zt.y+r.y*l,Va=zt.z+r.z*l;zt.x=Ia,zt.y=U,zt.z=Va;var lt=zt,P=lt.x+i.x*b,kt=lt.y+i.y*b,Bt=lt.z+i.z*b;lt.x=P,lt.y=kt,lt.z=Bt;var St=lt,yt=St.x+o.x*f,wt=St.y+o.y*f,pt=St.z+o.z*f;St.x=yt,St.y=wt,St.z=pt;var ht=St,xt=this._pool,Ra=xt.sizeVec3==0?new x.common.Vec3:xt.stackVec3[--xt.sizeVec3];Ra.x=t.x,Ra.y=t.y,Ra.z=t.z;var st=Ra,Ca=st.x+r.x*l,vt=st.y+r.y*l,qa=st.z+r.z*l;st.x=Ca,st.y=vt,st.z=qa;var at=st,Ua=at.x+i.x*b,tt=at.y+i.y*b,ct=at.z+i.z*b;at.x=Ua,at.y=tt,at.z=ct;var Aa=at,Ga=Aa.x+o.x*n,Ka=Aa.y+o.y*n,La=Aa.z+o.z*n;Aa.x=Ga,Aa.y=Ka,Aa.z=La;var ot=Aa;a.line(Y,Ha,v),a.line(va,ht,v),a.line(K,et,v),a.line(Qa,ot,v),a.line(Y,va,v),a.line(Ha,ht,v),a.line(K,Qa,v),a.line(et,ot,v),a.line(Y,K,v),a.line(Ha,et,v),a.line(va,Qa,v),a.line(ht,ot,v);var It=this._pool;if(Y!=null){if(Y.zero(),It.sizeVec3==It.stackVec3.length){for(var or=It.sizeVec3<<1,gr=new Array(or),ar=gr,Ct=0,_r=It.sizeVec3;Ct<_r;){var Et=Ct++;ar[Et]=It.stackVec3[Et],It.stackVec3[Et]=null}It.stackVec3=ar}It.stackVec3[It.sizeVec3++]=Y}var At=this._pool;if(K!=null){if(K.zero(),At.sizeVec3==At.stackVec3.length){for(var Gt=At.sizeVec3<<1,Hr=new Array(Gt),vr=Hr,lr=0,tr=At.sizeVec3;lr<tr;){var Ur=lr++;vr[Ur]=At.stackVec3[Ur],At.stackVec3[Ur]=null}At.stackVec3=vr}At.stackVec3[At.sizeVec3++]=K}var Xr=this._pool;if(va!=null){if(va.zero(),Xr.sizeVec3==Xr.stackVec3.length){for(var Mr=Xr.sizeVec3<<1,Zt=new Array(Mr),ir=Zt,$t=0,nr=Xr.sizeVec3;$t<nr;){var jr=$t++;ir[jr]=Xr.stackVec3[jr],Xr.stackVec3[jr]=null}Xr.stackVec3=ir}Xr.stackVec3[Xr.sizeVec3++]=va}var Wt=this._pool;if(Qa!=null){if(Qa.zero(),Wt.sizeVec3==Wt.stackVec3.length){for(var Kr=Wt.sizeVec3<<1,Ir=new Array(Kr),mi=Ir,$r=0,Lt=Wt.sizeVec3;$r<Lt;){var Kt=$r++;mi[Kt]=Wt.stackVec3[Kt],Wt.stackVec3[Kt]=null}Wt.stackVec3=mi}Wt.stackVec3[Wt.sizeVec3++]=Qa}var Tt=this._pool;if(Ha!=null){if(Ha.zero(),Tt.sizeVec3==Tt.stackVec3.length){for(var br=Tt.sizeVec3<<1,zr=new Array(br),vi=zr,qt=0,fr=Tt.sizeVec3;qt<fr;){var dt=qt++;vi[dt]=Tt.stackVec3[dt],Tt.stackVec3[dt]=null}Tt.stackVec3=vi}Tt.stackVec3[Tt.sizeVec3++]=Ha}var ur=this._pool;if(et!=null){if(et.zero(),ur.sizeVec3==ur.stackVec3.length){for(var hr=ur.sizeVec3<<1,ei=new Array(hr),Xi=ei,oo=0,Jt=ur.sizeVec3;oo<Jt;){var fi=oo++;Xi[fi]=ur.stackVec3[fi],ur.stackVec3[fi]=null}ur.stackVec3=Xi}ur.stackVec3[ur.sizeVec3++]=et}var pi=this._pool;if(ht!=null){if(ht.zero(),pi.sizeVec3==pi.stackVec3.length){for(var Dt=pi.sizeVec3<<1,Bi=new Array(Dt),Ar=Bi,Ni=0,Hn=pi.sizeVec3;Ni<Hn;){var no=Ni++;Ar[no]=pi.stackVec3[no],pi.stackVec3[no]=null}pi.stackVec3=Ar}pi.stackVec3[pi.sizeVec3++]=ht}var Si=this._pool;if(ot!=null){if(ot.zero(),Si.sizeVec3==Si.stackVec3.length){for(var eo=Si.sizeVec3<<1,gn=new Array(eo),Ao=gn,Vo=0,xr=Si.sizeVec3;Vo<xr;){var ao=Vo++;Ao[ao]=Si.stackVec3[ao],Si.stackVec3[ao]=null}Si.stackVec3=Ao}Si.stackVec3[Si.sizeVec3++]=ot}}_drawEllipseOnSphere(a,t,r,i,o,s,_,h,v){for(var e=16,l=0,u=6.28318530717958/e,b=this._pool,f=b.sizeVec3==0?new x.common.Vec3:b.stackVec3[--b.sizeVec3],n=this._pool,c=n.sizeQuat==0?new x.common.Quat:n.stackQuat[--n.sizeQuat],M=this._pool,m=M.sizeMat3==0?new x.common.Mat3:M.stackMat3[--M.sizeMat3],y=this._pool,V=y.sizeVec3==0?new x.common.Vec3:y.stackVec3[--y.sizeVec3],z=0,I=e+1;z<I;){var w=z++,X=Math.cos(l)*s,L=Math.sin(l)*_,p=Math.sqrt(X*X+L*L),g=Math.sin(p*.5),F=Math.cos(p*.5),S=f.zero(),N=S.x+i.x*X,A=S.y+i.y*X,Y=S.z+i.z*X;S.x=N,S.y=A,S.z=Y;var R=S,C=R.x+o.x*L,d=R.y+o.y*L,Z=R.z+o.z*L;R.x=C,R.y=d,R.z=Z;var j=1/p*g,H=f.x*j,E=f.y*j,G=f.z*j;f.x=H,f.y=E,f.z=G,c.x=f.x,c.y=f.y,c.z=f.z,c.w=F;var B=c.x,Q=c.y,W=c.z,J=c.w,D=2*B,O=2*Q,K=2*W,ra=B*D,sa=Q*O,$=W*K,q=B*O,na=Q*K,oa=B*K,aa=J*D,T=J*O,ca=J*K;m.e00=1-sa-$,m.e01=q-ca,m.e02=oa+T,m.e10=q+ca,m.e11=1-ra-$,m.e12=na-aa,m.e20=oa-T,m.e21=na+aa,m.e22=1-ra-sa;var _a=this._pool,k=_a.sizeVec3==0?new x.common.Vec3:_a.stackVec3[--_a.sizeVec3],ta=k.x+r.x*h,ia=k.y+r.y*h,la=k.z+r.z*h;k.x=ta,k.y=ia,k.z=la;var va=k,xa=va.x*m.e00+va.y*m.e01+va.z*m.e02,Ma=va.x*m.e10+va.y*m.e11+va.z*m.e12,za=va.x*m.e20+va.y*m.e21+va.z*m.e22;va.x=xa,va.y=Ma,va.z=za;var Xa=va,Za=Xa.x+t.x,fa=Xa.y+t.y,ba=Xa.z+t.z;Xa.x=Za,Xa.y=fa,Xa.z=ba,w>=1&&a.line(V,va,v);var ea=this._pool,ha=null,pa=null,ya=null;if(V!=null){if(V.zero(),ea.sizeVec3==ea.stackVec3.length){for(var da=ea.sizeVec3<<1,ma=new Array(da),Ya=ma,Qa=0,ga=ea.sizeVec3;Qa<ga;){var ua=Qa++;Ya[ua]=ea.stackVec3[ua],ea.stackVec3[ua]=null}ea.stackVec3=Ya}ea.stackVec3[ea.sizeVec3++]=V}if(ha!=null){var ka=1,wa=0,Pa=0,Mt=0,Oa=1,Ba=0,nt=0,Ea=0,Na=1;if(ha.e00=ka,ha.e01=wa,ha.e02=Pa,ha.e10=Mt,ha.e11=Oa,ha.e12=Ba,ha.e20=nt,ha.e21=Ea,ha.e22=Na,ea.sizeMat3==ea.stackMat3.length){for(var Sa=ea.sizeMat3<<1,ft=new Array(Sa),Wa=ft,Ha=0,bt=ea.sizeMat3;Ha<bt;){var rt=Ha++;Wa[rt]=ea.stackMat3[rt],ea.stackMat3[rt]=null}ea.stackMat3=Wa}ea.stackMat3[ea.sizeMat3++]=ha}if(pa!=null){var ja=1,_t=0,gt=0,mt=0,Ja=0,it=1,ut=0,Da=0,Ta=0,Fa=0,Vt=1,Pt=0,et=0,Xt=0,Yt=0,zt=1;if(pa.e00=ja,pa.e01=_t,pa.e02=gt,pa.e03=mt,pa.e10=Ja,pa.e11=it,pa.e12=ut,pa.e13=Da,pa.e20=Ta,pa.e21=Fa,pa.e22=Vt,pa.e23=Pt,pa.e30=et,pa.e31=Xt,pa.e32=Yt,pa.e33=zt,ea.sizeMat4==ea.stackMat4.length){for(var Ia=ea.sizeMat4<<1,U=new Array(Ia),Va=U,lt=0,P=ea.sizeMat4;lt<P;){var kt=lt++;Va[kt]=ea.stackMat4[kt],ea.stackMat4[kt]=null}ea.stackMat4=Va}ea.stackMat4[ea.sizeMat4++]=pa}if(ya!=null){var Bt=0,St=0,yt=0,wt=1;if(ya.x=Bt,ya.y=St,ya.z=yt,ya.w=wt,ea.sizeQuat==ea.stackQuat.length){for(var pt=ea.sizeQuat<<1,ht=new Array(pt),xt=ht,Ra=0,st=ea.sizeQuat;Ra<st;){var Ca=Ra++;xt[Ca]=ea.stackQuat[Ca],ea.stackQuat[Ca]=null}ea.stackQuat=xt}ea.stackQuat[ea.sizeQuat++]=ya}V=va,l+=u}var vt=this._pool;if(f!=null){if(f.zero(),vt.sizeVec3==vt.stackVec3.length){for(var qa=vt.sizeVec3<<1,at=new Array(qa),Ua=at,tt=0,ct=vt.sizeVec3;tt<ct;){var Aa=tt++;Ua[Aa]=vt.stackVec3[Aa],vt.stackVec3[Aa]=null}vt.stackVec3=Ua}vt.stackVec3[vt.sizeVec3++]=f}var Ga=this._pool;if(c!=null){var Ka=0,La=0,ot=0,It=1;if(c.x=Ka,c.y=La,c.z=ot,c.w=It,Ga.sizeQuat==Ga.stackQuat.length){for(var or=Ga.sizeQuat<<1,gr=new Array(or),ar=gr,Ct=0,_r=Ga.sizeQuat;Ct<_r;){var Et=Ct++;ar[Et]=Ga.stackQuat[Et],Ga.stackQuat[Et]=null}Ga.stackQuat=ar}Ga.stackQuat[Ga.sizeQuat++]=c}var At=this._pool;if(m!=null){var Gt=1,Hr=0,vr=0,lr=0,tr=1,Ur=0,Xr=0,Mr=0,Zt=1;if(m.e00=Gt,m.e01=Hr,m.e02=vr,m.e10=lr,m.e11=tr,m.e12=Ur,m.e20=Xr,m.e21=Mr,m.e22=Zt,At.sizeMat3==At.stackMat3.length){for(var ir=At.sizeMat3<<1,$t=new Array(ir),nr=$t,jr=0,Wt=At.sizeMat3;jr<Wt;){var Kr=jr++;nr[Kr]=At.stackMat3[Kr],At.stackMat3[Kr]=null}At.stackMat3=nr}At.stackMat3[At.sizeMat3++]=m}var Ir=this._pool;if(V!=null){if(V.zero(),Ir.sizeVec3==Ir.stackVec3.length){for(var mi=Ir.sizeVec3<<1,$r=new Array(mi),Lt=$r,Kt=0,Tt=Ir.sizeVec3;Kt<Tt;){var br=Kt++;Lt[br]=Ir.stackVec3[br],Ir.stackVec3[br]=null}Ir.stackVec3=Lt}Ir.stackVec3[Ir.sizeVec3++]=V}}step(a){this._timeStep.dt>0&&(this._timeStep.dtRatio=a/this._timeStep.dt),this._timeStep.dt=a,this._timeStep.invDt=1/a;var t=Date.now()/1e3;this._updateContacts(),this._solveIslands();var r=Date.now()/1e3;x.dynamics.common.Performance.totalTime=(r-t)*1e3}addRigidBody(a){if(a._world!=null)throw new Error("A rigid body cannot belong to multiple worlds.");this._rigidBodyList==null?(this._rigidBodyList=a,this._rigidBodyListLast=a):(this._rigidBodyListLast._next=a,a._prev=this._rigidBodyListLast,this._rigidBodyListLast=a),a._world=this;for(var t=a._shapeList;t!=null;){var r=t._next;t._proxy=this._broadPhase.createProxy(t,t._aabb),t._id=this._shapeIdCount++,this._numShapes++,t=r}this._numRigidBodies++}removeRigidBody(a){if(a._world!=this)throw new Error("The rigid body doesn't belong to the world.");var t=a._prev,r=a._next;t!=null&&(t._next=r),r!=null&&(r._prev=t),a==this._rigidBodyList&&(this._rigidBodyList=this._rigidBodyList._next),a==this._rigidBodyListLast&&(this._rigidBodyListLast=this._rigidBodyListLast._prev),a._next=null,a._prev=null,a._world=null;for(var i=a._shapeList;i!=null;){var o=i._next;this._broadPhase.destroyProxy(i._proxy),i._proxy=null,i._id=-1;for(var s=i._rigidBody._contactLinkList;s!=null;){var _=s._next,h=s._contact;if(h._s1==i||h._s2==i){var v=s._other;v._sleeping=!1,v._sleepTime=0;var e=this._contactManager,l=h._prev,u=h._next;if(l!=null&&(l._next=u),u!=null&&(u._prev=l),h==e._contactList&&(e._contactList=e._contactList._next),h==e._contactListLast&&(e._contactListLast=e._contactListLast._prev),h._next=null,h._prev=null,h._touching){var b=h._s1._contactCallback,f=h._s2._contactCallback;b==f&&(f=null),b?.endContact(h),f?.endContact(h)}var n=h._link1._prev,c=h._link1._next;n!=null&&(n._next=c),c!=null&&(c._prev=n),h._link1==h._b1._contactLinkList&&(h._b1._contactLinkList=h._b1._contactLinkList._next),h._link1==h._b1._contactLinkListLast&&(h._b1._contactLinkListLast=h._b1._contactLinkListLast._prev),h._link1._next=null,h._link1._prev=null;var M=h._link2._prev,m=h._link2._next;M!=null&&(M._next=m),m!=null&&(m._prev=M),h._link2==h._b2._contactLinkList&&(h._b2._contactLinkList=h._b2._contactLinkList._next),h._link2==h._b2._contactLinkListLast&&(h._b2._contactLinkListLast=h._b2._contactLinkListLast._prev),h._link2._next=null,h._link2._prev=null,h._b1._numContactLinks--,h._b2._numContactLinks--,h._link1._other=null,h._link2._other=null,h._link1._contact=null,h._link2._contact=null,h._s1=null,h._s2=null,h._b1=null,h._b2=null,h._touching=!1,h._cachedDetectorData._clear(),h._manifold._clear(),h._detector=null;var y=h._contactConstraint;y._s1=null,y._s2=null,y._b1=null,y._b2=null,y._tf1=null,y._tf2=null,h._next=e._contactPool,e._contactPool=h,e._numContacts--}s=_}this._numShapes--,i=o}this._numRigidBodies--}addJoint(a){if(a._world!=null)throw new Error("A joint cannot belong to multiple worlds.");this._jointList==null?(this._jointList=a,this._jointListLast=a):(this._jointListLast._next=a,a._prev=this._jointListLast,this._jointListLast=a),a._world=this,a._link1._other=a._b2,a._link2._other=a._b1,a._b1._jointLinkList==null?(a._b1._jointLinkList=a._link1,a._b1._jointLinkListLast=a._link1):(a._b1._jointLinkListLast._next=a._link1,a._link1._prev=a._b1._jointLinkListLast,a._b1._jointLinkListLast=a._link1),a._b2._jointLinkList==null?(a._b2._jointLinkList=a._link2,a._b2._jointLinkListLast=a._link2):(a._b2._jointLinkListLast._next=a._link2,a._link2._prev=a._b2._jointLinkListLast,a._b2._jointLinkListLast=a._link2),a._b1._numJointLinks++,a._b2._numJointLinks++;var t=a._b1;t._sleeping=!1,t._sleepTime=0;var r=a._b2;r._sleeping=!1,r._sleepTime=0,a._syncAnchors(),this._numJoints++}removeJoint(a){if(a._world!=this)throw new Error("The joint doesn't belong to the world.");var t=a._prev,r=a._next;t!=null&&(t._next=r),r!=null&&(r._prev=t),a==this._jointList&&(this._jointList=this._jointList._next),a==this._jointListLast&&(this._jointListLast=this._jointListLast._prev),a._next=null,a._prev=null,a._world=null;var i=a._link1._prev,o=a._link1._next;i!=null&&(i._next=o),o!=null&&(o._prev=i),a._link1==a._b1._jointLinkList&&(a._b1._jointLinkList=a._b1._jointLinkList._next),a._link1==a._b1._jointLinkListLast&&(a._b1._jointLinkListLast=a._b1._jointLinkListLast._prev),a._link1._next=null,a._link1._prev=null;var s=a._link2._prev,_=a._link2._next;s!=null&&(s._next=_),_!=null&&(_._prev=s),a._link2==a._b2._jointLinkList&&(a._b2._jointLinkList=a._b2._jointLinkList._next),a._link2==a._b2._jointLinkListLast&&(a._b2._jointLinkListLast=a._b2._jointLinkListLast._prev),a._link2._next=null,a._link2._prev=null,a._link1._other=null,a._link2._other=null,a._b1._numJointLinks--,a._b2._numJointLinks--;var h=a._b1;h._sleeping=!1,h._sleepTime=0;var v=a._b2;v._sleeping=!1,v._sleepTime=0,this._numJoints--}setDebugDraw(a){this._debugDraw=a}getDebugDraw(){return this._debugDraw}debugDraw(){if(this._debugDraw!=null){if(this._broadPhase._type==2){var a=this._broadPhase;this._drawBvh(this._debugDraw,a._tree)}this._drawRigidBodies(this._debugDraw),this._drawConstraints(this._debugDraw)}}rayCast(a,t,r){var i=this._rayCastWrapper.begin;i.x=a.x,i.y=a.y,i.z=a.z;var o=this._rayCastWrapper.end;o.x=t.x,o.y=t.y,o.z=t.z,this._rayCastWrapper.callback=r,this._broadPhase.rayCast(a,t,this._rayCastWrapper)}convexCast(a,t,r,i){this._convexCastWrapper.convex=a;var o=this._convexCastWrapper.begin;o._positionX=t._positionX,o._positionY=t._positionY,o._positionZ=t._positionZ,o._rotation00=t._rotation00,o._rotation01=t._rotation01,o._rotation02=t._rotation02,o._rotation10=t._rotation10,o._rotation11=t._rotation11,o._rotation12=t._rotation12,o._rotation20=t._rotation20,o._rotation21=t._rotation21,o._rotation22=t._rotation22;var s=this._convexCastWrapper.translation;s.x=r.x,s.y=r.y,s.z=r.z,this._convexCastWrapper.callback=i,this._broadPhase.convexCast(a,t,r,this._convexCastWrapper)}aabbTest(a,t){this._aabbTestWrapper._aabb.copyFrom(a),this._aabbTestWrapper._callback=t,this._broadPhase.aabbTest(a,this._aabbTestWrapper)}getRigidBodyList(){return this._rigidBodyList}getJointList(){return this._jointList}getBroadPhase(){return this._broadPhase}getContactManager(){return this._contactManager}getNumRigidBodies(){return this._numRigidBodies}getNumJoints(){return this._numJoints}getNumShapes(){return this._numShapes}getNumIslands(){return this._numIslands}getNumVelocityIterations(){return this._numVelocityIterations}setNumVelocityIterations(a){this._numVelocityIterations=a}getNumPositionIterations(){return this._numPositionIterations}setNumPositionIterations(a){this._numPositionIterations=a}getGravity(){return this._gravity}setGravity(a){var t=this._gravity;t.x=a.x,t.y=a.y,t.z=a.z}};x.dynamics._World||(x.dynamics._World={});x.dynamics._World.RayCastWrapper=class extends x.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new x.collision.geometry.RayCastHit,this.begin=new x.common.Vec3,this.end=new x.common.Vec3,this.callback=null}process(a){var t=a.userData;t._geom.rayCast(this.begin,this.end,t._transform,this.rayCastHit)&&this.callback.process(t,this.rayCastHit)}};x.dynamics._World.ConvexCastWrapper=class extends x.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new x.collision.geometry.RayCastHit,this.begin=new x.common.Transform,this.translation=new x.common.Vec3,this.zero=new x.common.Vec3,this.callback=null,this.convex=null}process(a){var t=a.userData,r=t._geom._type;if(!(r<0||r>5)){var i=t._geom;x.collision.narrowphase.detector.gjkepa.GjkEpa.instance.convexCast(this.convex,i,this.begin,t._transform,this.translation,this.zero,this.rayCastHit)&&this.callback.process(t,this.rayCastHit)}}};x.dynamics._World.AabbTestWrapper=class extends x.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this._aabb=new x.collision.geometry.Aabb,this._callback=null}process(a){var t=a.userData,r=t._aabb;r._minX<this._aabb._maxX&&r._maxX>this._aabb._minX&&r._minY<this._aabb._maxY&&r._maxY>this._aabb._minY&&r._minZ<this._aabb._maxZ&&r._maxZ>this._aabb._minZ&&this._callback.process(t)}};x.dynamics.callback||(x.dynamics.callback={});x.dynamics.callback.AabbTestCallback=class{constructor(){}process(a){}};x.dynamics.callback.ContactCallback=class{constructor(){}beginContact(a){}preSolve(a){}postSolve(a){}endContact(a){}};x.dynamics.callback.RayCastCallback=class{constructor(){}process(a,t){}};x.dynamics.callback.RayCastClosest=class extends x.dynamics.callback.RayCastCallback{constructor(){super(),this.position=new x.common.Vec3,this.normal=new x.common.Vec3,this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}clear(){this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}process(a,t){if(t.fraction<this.fraction){this.shape=a,this.hit=!0,this.fraction=t.fraction;var r=this.position,i=t.position;r.x=i.x,r.y=i.y,r.z=i.z;var o=this.normal,s=t.normal;o.x=s.x,o.y=s.y,o.z=s.z}}};x.dynamics.common||(x.dynamics.common={});x.dynamics.common.DebugDraw=class{constructor(){this.p=new x.common.Pool,this.wireframe=!1,this.drawShapes=!0,this.drawBvh=!1,this.drawBvhMinLevel=0,this.drawBvhMaxLevel=65536,this.drawAabbs=!1,this.drawBases=!1,this.drawPairs=!1,this.drawContacts=!1,this.drawJoints=!0,this.drawJointLimits=!1;var a=4,t=3.14159265358979/a,r=8,i=6.28318530717958/r,o=new Array(a+1);this.sphereCoords=o;var s=new Array(a+1);this.tmpSphereVerts=s;var _=new Array(a+1);this.tmpSphereNorms=_;for(var h=0,v=a+1;h<v;){var e=h++,l=e==0||e==a?1:r,u=this.sphereCoords,b=new Array(l);u[e]=b;var f=this.tmpSphereVerts,n=new Array(l);f[e]=n;var c=this.tmpSphereNorms,M=new Array(l);c[e]=M;for(var m=0,y=r;m<y;){var V=m++,z=e*t,I=V*i;this.sphereCoords[e][V]=new x.common.Vec3(Math.sin(z)*Math.cos(I),Math.cos(z),-Math.sin(z)*Math.sin(I)),this.tmpSphereVerts[e][V]=new x.common.Vec3,this.tmpSphereNorms[e][V]=new x.common.Vec3}}var w=new Array(8);this.circleCoords=w;var X=new Array(8);this.circleCoordsShift=X;var L=new Array(8);this.tmpCircleVerts1=L;var p=new Array(8);this.tmpCircleVerts2=p;var g=new Array(8);this.tmpCircleNorms=g;for(var F=.7853981633974475,S=0;S<8;){var N=S++;this.circleCoords[N]=new x.common.Vec3(Math.cos(N*F),0,-Math.sin(N*F)),this.circleCoordsShift[N]=new x.common.Vec3(Math.cos((N+.5)*F),0,-Math.sin((N+.5)*F)),this.tmpCircleVerts1[N]=new x.common.Vec3,this.tmpCircleVerts2[N]=new x.common.Vec3,this.tmpCircleNorms[N]=new x.common.Vec3}this.style=new x.dynamics.common.DebugDrawStyle}aabb(a,t,r){var i=this.p,o=(i.sizeVec3==0?new x.common.Vec3:i.stackVec3[--i.sizeVec3]).init(a.x,a.y,a.z),s=this.p,_=(s.sizeVec3==0?new x.common.Vec3:s.stackVec3[--s.sizeVec3]).init(a.x,a.y,t.z),h=this.p,v=(h.sizeVec3==0?new x.common.Vec3:h.stackVec3[--h.sizeVec3]).init(a.x,t.y,a.z),e=this.p,l=(e.sizeVec3==0?new x.common.Vec3:e.stackVec3[--e.sizeVec3]).init(a.x,t.y,t.z),u=this.p,b=(u.sizeVec3==0?new x.common.Vec3:u.stackVec3[--u.sizeVec3]).init(t.x,a.y,a.z),f=this.p,n=(f.sizeVec3==0?new x.common.Vec3:f.stackVec3[--f.sizeVec3]).init(t.x,a.y,t.z),c=this.p,M=(c.sizeVec3==0?new x.common.Vec3:c.stackVec3[--c.sizeVec3]).init(t.x,t.y,a.z),m=this.p,y=(m.sizeVec3==0?new x.common.Vec3:m.stackVec3[--m.sizeVec3]).init(t.x,t.y,t.z);this.line(o,_,r),this.line(v,l,r),this.line(b,n,r),this.line(M,y,r),this.line(o,v,r),this.line(_,l,r),this.line(b,M,r),this.line(n,y,r),this.line(o,b,r),this.line(_,n,r),this.line(v,M,r),this.line(l,y,r);var V=this.p;if(o!=null){if(o.zero(),V.sizeVec3==V.stackVec3.length){for(var z=V.sizeVec3<<1,I=new Array(z),w=I,X=0,L=V.sizeVec3;X<L;){var p=X++;w[p]=V.stackVec3[p],V.stackVec3[p]=null}V.stackVec3=w}V.stackVec3[V.sizeVec3++]=o}var g=this.p;if(_!=null){if(_.zero(),g.sizeVec3==g.stackVec3.length){for(var F=g.sizeVec3<<1,S=new Array(F),N=S,A=0,Y=g.sizeVec3;A<Y;){var R=A++;N[R]=g.stackVec3[R],g.stackVec3[R]=null}g.stackVec3=N}g.stackVec3[g.sizeVec3++]=_}var C=this.p;if(v!=null){if(v.zero(),C.sizeVec3==C.stackVec3.length){for(var d=C.sizeVec3<<1,Z=new Array(d),j=Z,H=0,E=C.sizeVec3;H<E;){var G=H++;j[G]=C.stackVec3[G],C.stackVec3[G]=null}C.stackVec3=j}C.stackVec3[C.sizeVec3++]=v}var B=this.p;if(l!=null){if(l.zero(),B.sizeVec3==B.stackVec3.length){for(var Q=B.sizeVec3<<1,W=new Array(Q),J=W,D=0,O=B.sizeVec3;D<O;){var K=D++;J[K]=B.stackVec3[K],B.stackVec3[K]=null}B.stackVec3=J}B.stackVec3[B.sizeVec3++]=l}var ra=this.p;if(b!=null){if(b.zero(),ra.sizeVec3==ra.stackVec3.length){for(var sa=ra.sizeVec3<<1,$=new Array(sa),q=$,na=0,oa=ra.sizeVec3;na<oa;){var aa=na++;q[aa]=ra.stackVec3[aa],ra.stackVec3[aa]=null}ra.stackVec3=q}ra.stackVec3[ra.sizeVec3++]=b}var T=this.p;if(n!=null){if(n.zero(),T.sizeVec3==T.stackVec3.length){for(var ca=T.sizeVec3<<1,_a=new Array(ca),k=_a,ta=0,ia=T.sizeVec3;ta<ia;){var la=ta++;k[la]=T.stackVec3[la],T.stackVec3[la]=null}T.stackVec3=k}T.stackVec3[T.sizeVec3++]=n}var va=this.p;if(M!=null){if(M.zero(),va.sizeVec3==va.stackVec3.length){for(var xa=va.sizeVec3<<1,Ma=new Array(xa),za=Ma,Xa=0,Za=va.sizeVec3;Xa<Za;){var fa=Xa++;za[fa]=va.stackVec3[fa],va.stackVec3[fa]=null}va.stackVec3=za}va.stackVec3[va.sizeVec3++]=M}var ba=this.p;if(y!=null){if(y.zero(),ba.sizeVec3==ba.stackVec3.length){for(var ea=ba.sizeVec3<<1,ha=new Array(ea),pa=ha,ya=0,da=ba.sizeVec3;ya<da;){var ma=ya++;pa[ma]=ba.stackVec3[ma],ba.stackVec3[ma]=null}ba.stackVec3=pa}ba.stackVec3[ba.sizeVec3++]=y}}basis(a,t,r,i,o){var s=this.p,_=s.sizeVec3==0?new x.common.Vec3:s.stackVec3[--s.sizeVec3],h=this.p,v=h.sizeMat3==0?new x.common.Mat3:h.stackMat3[--h.sizeMat3],e=this.p,l=e.sizeVec3==0?new x.common.Vec3:e.stackVec3[--e.sizeVec3],u=this.p,b=u.sizeVec3==0?new x.common.Vec3:u.stackVec3[--u.sizeVec3],f=this.p,n=f.sizeVec3==0?new x.common.Vec3:f.stackVec3[--f.sizeVec3],c=_;c.x=a._positionX,c.y=a._positionY,c.z=a._positionZ;var M=v;M.e00=a._rotation00,M.e01=a._rotation01,M.e02=a._rotation02,M.e10=a._rotation10,M.e11=a._rotation11,M.e12=a._rotation12,M.e20=a._rotation20,M.e21=a._rotation21,M.e22=a._rotation22,l.init(v.e00,v.e10,v.e20),b.init(v.e01,v.e11,v.e21),n.init(v.e02,v.e12,v.e22);var m=l.x*t,y=l.y*t,V=l.z*t;l.x=m,l.y=y,l.z=V;var z=l,I=z.x+_.x,w=z.y+_.y,X=z.z+_.z;z.x=I,z.y=w,z.z=X;var L=b.x*t,p=b.y*t,g=b.z*t;b.x=L,b.y=p,b.z=g;var F=b,S=F.x+_.x,N=F.y+_.y,A=F.z+_.z;F.x=S,F.y=N,F.z=A;var Y=n.x*t,R=n.y*t,C=n.z*t;n.x=Y,n.y=R,n.z=C;var d=n,Z=d.x+_.x,j=d.y+_.y,H=d.z+_.z;d.x=Z,d.y=j,d.z=H,this.line(_,l,r),this.line(_,b,i),this.line(_,n,o);var E=this.p;if(_!=null){if(_.zero(),E.sizeVec3==E.stackVec3.length){for(var G=E.sizeVec3<<1,B=new Array(G),Q=B,W=0,J=E.sizeVec3;W<J;){var D=W++;Q[D]=E.stackVec3[D],E.stackVec3[D]=null}E.stackVec3=Q}E.stackVec3[E.sizeVec3++]=_}var O=this.p;if(v!=null){var K=1,ra=0,sa=0,$=0,q=1,na=0,oa=0,aa=0,T=1;if(v.e00=K,v.e01=ra,v.e02=sa,v.e10=$,v.e11=q,v.e12=na,v.e20=oa,v.e21=aa,v.e22=T,O.sizeMat3==O.stackMat3.length){for(var ca=O.sizeMat3<<1,_a=new Array(ca),k=_a,ta=0,ia=O.sizeMat3;ta<ia;){var la=ta++;k[la]=O.stackMat3[la],O.stackMat3[la]=null}O.stackMat3=k}O.stackMat3[O.sizeMat3++]=v}var va=this.p;if(l!=null){if(l.zero(),va.sizeVec3==va.stackVec3.length){for(var xa=va.sizeVec3<<1,Ma=new Array(xa),za=Ma,Xa=0,Za=va.sizeVec3;Xa<Za;){var fa=Xa++;za[fa]=va.stackVec3[fa],va.stackVec3[fa]=null}va.stackVec3=za}va.stackVec3[va.sizeVec3++]=l}var ba=this.p;if(b!=null){if(b.zero(),ba.sizeVec3==ba.stackVec3.length){for(var ea=ba.sizeVec3<<1,ha=new Array(ea),pa=ha,ya=0,da=ba.sizeVec3;ya<da;){var ma=ya++;pa[ma]=ba.stackVec3[ma],ba.stackVec3[ma]=null}ba.stackVec3=pa}ba.stackVec3[ba.sizeVec3++]=b}var Ya=this.p;if(n!=null){if(n.zero(),Ya.sizeVec3==Ya.stackVec3.length){for(var Qa=Ya.sizeVec3<<1,ga=new Array(Qa),ua=ga,ka=0,wa=Ya.sizeVec3;ka<wa;){var Pa=ka++;ua[Pa]=Ya.stackVec3[Pa],Ya.stackVec3[Pa]=null}Ya.stackVec3=ua}Ya.stackVec3[Ya.sizeVec3++]=n}}ellipse(a,t,r,i,o,s){this.arc(a,t,r,i,o,0,6.28318530717958,!1,s)}arc(a,t,r,i,o,s,_,h,v){var e=this.p,l=e.sizeVec3==0?new x.common.Vec3:e.stackVec3[--e.sizeVec3];l.x=t.x,l.y=t.y,l.z=t.z;var u=l,b=u.x*i,f=u.y*i,n=u.z*i;u.x=b,u.y=f,u.z=n,t=u;var c=this.p,M=c.sizeVec3==0?new x.common.Vec3:c.stackVec3[--c.sizeVec3];M.x=r.x,M.y=r.y,M.z=r.z;var m=M,y=m.x*o,V=m.y*o,z=m.z*o;m.x=y,m.y=V,m.z=z,r=m;var I=.5235987755982984,w=_-s;w<0&&(w=-w);var X=w/I+.5|0;X==0&&(X=1);var L=s,p=(_-s)/X,g=this.p,F=g.sizeVec3==0?new x.common.Vec3:g.stackVec3[--g.sizeVec3];F.x=a.x,F.y=a.y,F.z=a.z;var S=F,N=Math.cos(L),A=S.x+t.x*N,Y=S.y+t.y*N,R=S.z+t.z*N;S.x=A,S.y=Y,S.z=R;var C=S,d=Math.sin(L),Z=C.x+r.x*d,j=C.y+r.y*d,H=C.z+r.z*d;C.x=Z,C.y=j,C.z=H;var E=C,G=E;h&&this.line(a,G,v);for(var B=0,Q=X;B<Q;){B++,L+=p;var W=this.p,J=W.sizeVec3==0?new x.common.Vec3:W.stackVec3[--W.sizeVec3];J.x=a.x,J.y=a.y,J.z=a.z;var D=J,O=Math.cos(L),K=D.x+t.x*O,ra=D.y+t.y*O,sa=D.z+t.z*O;D.x=K,D.y=ra,D.z=sa;var $=D,q=Math.sin(L),na=$.x+r.x*q,oa=$.y+r.y*q,aa=$.z+r.z*q;$.x=na,$.y=oa,$.z=aa;var T=$,ca=T;this.line(G,ca,v);var _a=this.p,k=null,ta=null,ia=null;if(G!=null){if(G.zero(),_a.sizeVec3==_a.stackVec3.length){for(var la=_a.sizeVec3<<1,va=new Array(la),xa=va,Ma=0,za=_a.sizeVec3;Ma<za;){var Xa=Ma++;xa[Xa]=_a.stackVec3[Xa],_a.stackVec3[Xa]=null}_a.stackVec3=xa}_a.stackVec3[_a.sizeVec3++]=G}if(k!=null){var Za=1,fa=0,ba=0,ea=0,ha=1,pa=0,ya=0,da=0,ma=1;if(k.e00=Za,k.e01=fa,k.e02=ba,k.e10=ea,k.e11=ha,k.e12=pa,k.e20=ya,k.e21=da,k.e22=ma,_a.sizeMat3==_a.stackMat3.length){for(var Ya=_a.sizeMat3<<1,Qa=new Array(Ya),ga=Qa,ua=0,ka=_a.sizeMat3;ua<ka;){var wa=ua++;ga[wa]=_a.stackMat3[wa],_a.stackMat3[wa]=null}_a.stackMat3=ga}_a.stackMat3[_a.sizeMat3++]=k}if(ta!=null){var Pa=1,Mt=0,Oa=0,Ba=0,nt=0,Ea=1,Na=0,Sa=0,ft=0,Wa=0,Ha=1,bt=0,rt=0,ja=0,_t=0,gt=1;if(ta.e00=Pa,ta.e01=Mt,ta.e02=Oa,ta.e03=Ba,ta.e10=nt,ta.e11=Ea,ta.e12=Na,ta.e13=Sa,ta.e20=ft,ta.e21=Wa,ta.e22=Ha,ta.e23=bt,ta.e30=rt,ta.e31=ja,ta.e32=_t,ta.e33=gt,_a.sizeMat4==_a.stackMat4.length){for(var mt=_a.sizeMat4<<1,Ja=new Array(mt),it=Ja,ut=0,Da=_a.sizeMat4;ut<Da;){var Ta=ut++;it[Ta]=_a.stackMat4[Ta],_a.stackMat4[Ta]=null}_a.stackMat4=it}_a.stackMat4[_a.sizeMat4++]=ta}if(ia!=null){var Fa=0,Vt=0,Pt=0,et=1;if(ia.x=Fa,ia.y=Vt,ia.z=Pt,ia.w=et,_a.sizeQuat==_a.stackQuat.length){for(var Xt=_a.sizeQuat<<1,Yt=new Array(Xt),zt=Yt,Ia=0,U=_a.sizeQuat;Ia<U;){var Va=Ia++;zt[Va]=_a.stackQuat[Va],_a.stackQuat[Va]=null}_a.stackQuat=zt}_a.stackQuat[_a.sizeQuat++]=ia}G=ca}h&&this.line(a,G,v);var lt=this.p;if(G!=null){if(G.zero(),lt.sizeVec3==lt.stackVec3.length){for(var P=lt.sizeVec3<<1,kt=new Array(P),Bt=kt,St=0,yt=lt.sizeVec3;St<yt;){var wt=St++;Bt[wt]=lt.stackVec3[wt],lt.stackVec3[wt]=null}lt.stackVec3=Bt}lt.stackVec3[lt.sizeVec3++]=G}var pt=this.p;if(t!=null){if(t.zero(),pt.sizeVec3==pt.stackVec3.length){for(var ht=pt.sizeVec3<<1,xt=new Array(ht),Ra=xt,st=0,Ca=pt.sizeVec3;st<Ca;){var vt=st++;Ra[vt]=pt.stackVec3[vt],pt.stackVec3[vt]=null}pt.stackVec3=Ra}pt.stackVec3[pt.sizeVec3++]=t}var qa=this.p;if(r!=null){if(r.zero(),qa.sizeVec3==qa.stackVec3.length){for(var at=qa.sizeVec3<<1,Ua=new Array(at),tt=Ua,ct=0,Aa=qa.sizeVec3;ct<Aa;){var Ga=ct++;tt[Ga]=qa.stackVec3[Ga],qa.stackVec3[Ga]=null}qa.stackVec3=tt}qa.stackVec3[qa.sizeVec3++]=r}}cone(a,t,r,i){var o=this.p,s=o.sizeVec3==0?new x.common.Vec3:o.stackVec3[--o.sizeVec3],_=this.p,h=_.sizeVec3==0?new x.common.Vec3:_.stackVec3[--_.sizeVec3],v=this.p,e=v.sizeVec3==0?new x.common.Vec3:v.stackVec3[--v.sizeVec3],l=this.p,u=l.sizeVec3==0?new x.common.Vec3:l.stackVec3[--l.sizeVec3],b=this.p,f=b.sizeMat3==0?new x.common.Mat3:b.stackMat3[--b.sizeMat3],n=u;n.x=a._positionX,n.y=a._positionY,n.z=a._positionZ;var c=f;c.e00=a._rotation00,c.e01=a._rotation01,c.e02=a._rotation02,c.e10=a._rotation10,c.e11=a._rotation11,c.e12=a._rotation12,c.e20=a._rotation20,c.e21=a._rotation21,c.e22=a._rotation22,s.init(f.e00,f.e10,f.e20),h.init(f.e01,f.e11,f.e21),e.init(f.e02,f.e12,f.e22);var M=this.p,m=M.sizeVec3==0?new x.common.Vec3:M.stackVec3[--M.sizeVec3];m.x=u.x,m.y=u.y,m.z=u.z;var y=m,V=y.x+h.x*r,z=y.y+h.y*r,I=y.z+h.z*r;y.x=V,y.y=z,y.z=I;var w=y,X=this.p,L=X.sizeVec3==0?new x.common.Vec3:X.stackVec3[--X.sizeVec3];L.x=u.x,L.y=u.y,L.z=u.z;var p=L,g=-r,F=p.x+h.x*g,S=p.y+h.y*g,N=p.z+h.z*g;p.x=F,p.y=S,p.z=N;var A=p;if(this.wireframe){var Y=this.p,R=Y.sizeVec3==0?new x.common.Vec3:Y.stackVec3[--Y.sizeVec3];R.x=A.x,R.y=A.y,R.z=A.z;var C=R,d=-t,Z=C.x+s.x*d,j=C.y+s.y*d,H=C.z+s.z*d;C.x=Z,C.y=j,C.z=H;var E=C,G=E.x+e.x*0,B=E.y+e.y*0,Q=E.z+e.z*0;E.x=G,E.y=B,E.z=Q;var W=E,J=this.p,D=J.sizeVec3==0?new x.common.Vec3:J.stackVec3[--J.sizeVec3];D.x=A.x,D.y=A.y,D.z=A.z;var O=D,K=O.x+s.x*t,ra=O.y+s.y*t,sa=O.z+s.z*t;O.x=K,O.y=ra,O.z=sa;var $=O,q=$.x+e.x*0,na=$.y+e.y*0,oa=$.z+e.z*0;$.x=q,$.y=na,$.z=oa;var aa=$,T=this.p,ca=T.sizeVec3==0?new x.common.Vec3:T.stackVec3[--T.sizeVec3];ca.x=A.x,ca.y=A.y,ca.z=A.z;var _a=ca,k=_a.x+s.x*0,ta=_a.y+s.y*0,ia=_a.z+s.z*0;_a.x=k,_a.y=ta,_a.z=ia;var la=_a,va=-t,xa=la.x+e.x*va,Ma=la.y+e.y*va,za=la.z+e.z*va;la.x=xa,la.y=Ma,la.z=za;var Xa=la,Za=this.p,fa=Za.sizeVec3==0?new x.common.Vec3:Za.stackVec3[--Za.sizeVec3];fa.x=A.x,fa.y=A.y,fa.z=A.z;var ba=fa,ea=ba.x+s.x*0,ha=ba.y+s.y*0,pa=ba.z+s.z*0;ba.x=ea,ba.y=ha,ba.z=pa;var ya=ba,da=ya.x+e.x*t,ma=ya.y+e.y*t,Ya=ya.z+e.z*t;ya.x=da,ya.y=ma,ya.z=Ya;var Qa=ya;this.ellipse(A,s,e,t,t,i),this.line(w,W,i),this.line(w,aa,i),this.line(w,Xa,i),this.line(w,Qa,i);var ga=this.p,ua=null,ka=null,wa=null;if(W!=null){if(W.zero(),ga.sizeVec3==ga.stackVec3.length){for(var Pa=ga.sizeVec3<<1,Mt=new Array(Pa),Oa=Mt,Ba=0,nt=ga.sizeVec3;Ba<nt;){var Ea=Ba++;Oa[Ea]=ga.stackVec3[Ea],ga.stackVec3[Ea]=null}ga.stackVec3=Oa}ga.stackVec3[ga.sizeVec3++]=W}if(ua!=null){var Na=1,Sa=0,ft=0,Wa=0,Ha=1,bt=0,rt=0,ja=0,_t=1;if(ua.e00=Na,ua.e01=Sa,ua.e02=ft,ua.e10=Wa,ua.e11=Ha,ua.e12=bt,ua.e20=rt,ua.e21=ja,ua.e22=_t,ga.sizeMat3==ga.stackMat3.length){for(var gt=ga.sizeMat3<<1,mt=new Array(gt),Ja=mt,it=0,ut=ga.sizeMat3;it<ut;){var Da=it++;Ja[Da]=ga.stackMat3[Da],ga.stackMat3[Da]=null}ga.stackMat3=Ja}ga.stackMat3[ga.sizeMat3++]=ua}if(ka!=null){var Ta=1,Fa=0,Vt=0,Pt=0,et=0,Xt=1,Yt=0,zt=0,Ia=0,U=0,Va=1,lt=0,P=0,kt=0,Bt=0,St=1;if(ka.e00=Ta,ka.e01=Fa,ka.e02=Vt,ka.e03=Pt,ka.e10=et,ka.e11=Xt,ka.e12=Yt,ka.e13=zt,ka.e20=Ia,ka.e21=U,ka.e22=Va,ka.e23=lt,ka.e30=P,ka.e31=kt,ka.e32=Bt,ka.e33=St,ga.sizeMat4==ga.stackMat4.length){for(var yt=ga.sizeMat4<<1,wt=new Array(yt),pt=wt,ht=0,xt=ga.sizeMat4;ht<xt;){var Ra=ht++;pt[Ra]=ga.stackMat4[Ra],ga.stackMat4[Ra]=null}ga.stackMat4=pt}ga.stackMat4[ga.sizeMat4++]=ka}if(wa!=null){var st=0,Ca=0,vt=0,qa=1;if(wa.x=st,wa.y=Ca,wa.z=vt,wa.w=qa,ga.sizeQuat==ga.stackQuat.length){for(var at=ga.sizeQuat<<1,Ua=new Array(at),tt=Ua,ct=0,Aa=ga.sizeQuat;ct<Aa;){var Ga=ct++;tt[Ga]=ga.stackQuat[Ga],ga.stackQuat[Ga]=null}ga.stackQuat=tt}ga.stackQuat[ga.sizeQuat++]=wa}var Ka=this.p,La=null,ot=null,It=null;if(aa!=null){if(aa.zero(),Ka.sizeVec3==Ka.stackVec3.length){for(var or=Ka.sizeVec3<<1,gr=new Array(or),ar=gr,Ct=0,_r=Ka.sizeVec3;Ct<_r;){var Et=Ct++;ar[Et]=Ka.stackVec3[Et],Ka.stackVec3[Et]=null}Ka.stackVec3=ar}Ka.stackVec3[Ka.sizeVec3++]=aa}if(La!=null){var At=1,Gt=0,Hr=0,vr=0,lr=1,tr=0,Ur=0,Xr=0,Mr=1;if(La.e00=At,La.e01=Gt,La.e02=Hr,La.e10=vr,La.e11=lr,La.e12=tr,La.e20=Ur,La.e21=Xr,La.e22=Mr,Ka.sizeMat3==Ka.stackMat3.length){for(var Zt=Ka.sizeMat3<<1,ir=new Array(Zt),$t=ir,nr=0,jr=Ka.sizeMat3;nr<jr;){var Wt=nr++;$t[Wt]=Ka.stackMat3[Wt],Ka.stackMat3[Wt]=null}Ka.stackMat3=$t}Ka.stackMat3[Ka.sizeMat3++]=La}if(ot!=null){var Kr=1,Ir=0,mi=0,$r=0,Lt=0,Kt=1,Tt=0,br=0,zr=0,vi=0,qt=1,fr=0,dt=0,ur=0,hr=0,ei=1;if(ot.e00=Kr,ot.e01=Ir,ot.e02=mi,ot.e03=$r,ot.e10=Lt,ot.e11=Kt,ot.e12=Tt,ot.e13=br,ot.e20=zr,ot.e21=vi,ot.e22=qt,ot.e23=fr,ot.e30=dt,ot.e31=ur,ot.e32=hr,ot.e33=ei,Ka.sizeMat4==Ka.stackMat4.length){for(var Xi=Ka.sizeMat4<<1,oo=new Array(Xi),Jt=oo,fi=0,pi=Ka.sizeMat4;fi<pi;){var Dt=fi++;Jt[Dt]=Ka.stackMat4[Dt],Ka.stackMat4[Dt]=null}Ka.stackMat4=Jt}Ka.stackMat4[Ka.sizeMat4++]=ot}if(It!=null){var Bi=0,Ar=0,Ni=0,Hn=1;if(It.x=Bi,It.y=Ar,It.z=Ni,It.w=Hn,Ka.sizeQuat==Ka.stackQuat.length){for(var no=Ka.sizeQuat<<1,Si=new Array(no),eo=Si,gn=0,Ao=Ka.sizeQuat;gn<Ao;){var Vo=gn++;eo[Vo]=Ka.stackQuat[Vo],Ka.stackQuat[Vo]=null}Ka.stackQuat=eo}Ka.stackQuat[Ka.sizeQuat++]=It}var xr=this.p,ao=null,Ai=null,yi=null;if(Xa!=null){if(Xa.zero(),xr.sizeVec3==xr.stackVec3.length){for(var Po=xr.sizeVec3<<1,Dr=new Array(Po),Pi=Dr,gi=0,Rt=xr.sizeVec3;gi<Rt;){var Or=gi++;Pi[Or]=xr.stackVec3[Or],xr.stackVec3[Or]=null}xr.stackVec3=Pi}xr.stackVec3[xr.sizeVec3++]=Xa}if(ao!=null){var Lr=1,Tn=0,ms=0,qe=0,ps=1,Re=0,as=0,N_=0,In=1;if(ao.e00=Lr,ao.e01=Tn,ao.e02=ms,ao.e10=qe,ao.e11=ps,ao.e12=Re,ao.e20=as,ao.e21=N_,ao.e22=In,xr.sizeMat3==xr.stackMat3.length){for(var Pr=xr.sizeMat3<<1,Go=new Array(Pr),Wi=Go,ke=0,nn=xr.sizeMat3;ke<nn;){var Rn=ke++;Wi[Rn]=xr.stackMat3[Rn],xr.stackMat3[Rn]=null}xr.stackMat3=Wi}xr.stackMat3[xr.sizeMat3++]=ao}if(Ai!=null){var jn=1,Xe=0,k_=0,Qe=0,Vr=0,Ii=1,ui=0,so=0,Qn=0,ys=0,en=1,En=0,cr=0,co=0,Fi=0,Dn=1;if(Ai.e00=jn,Ai.e01=Xe,Ai.e02=k_,Ai.e03=Qe,Ai.e10=Vr,Ai.e11=Ii,Ai.e12=ui,Ai.e13=so,Ai.e20=Qn,Ai.e21=ys,Ai.e22=en,Ai.e23=En,Ai.e30=cr,Ai.e31=co,Ai.e32=Fi,Ai.e33=Dn,xr.sizeMat4==xr.stackMat4.length){for(var ts=xr.sizeMat4<<1,Ee=new Array(ts),De=Ee,Ne=0,ce=xr.sizeMat4;Ne<ce;){var rr=Ne++;De[rr]=xr.stackMat4[rr],xr.stackMat4[rr]=null}xr.stackMat4=De}xr.stackMat4[xr.sizeMat4++]=Ai}if(yi!=null){var ri=0,Qr=0,Nr=0,uo=1;if(yi.x=ri,yi.y=Qr,yi.z=Nr,yi.w=uo,xr.sizeQuat==xr.stackQuat.length){for(var Co=xr.sizeQuat<<1,__=new Array(Co),Fe=__,rs=0,Nn=xr.sizeQuat;rs<Nn;){var bo=rs++;Fe[bo]=xr.stackQuat[bo],xr.stackQuat[bo]=null}xr.stackQuat=Fe}xr.stackQuat[xr.sizeQuat++]=yi}var Nt=this.p,Fr=null,li=null,wo=null;if(Qa!=null){if(Qa.zero(),Nt.sizeVec3==Nt.stackVec3.length){for(var be=Nt.sizeVec3<<1,Le=new Array(be),Ye=Le,xo=0,jt=Nt.sizeVec3;xo<jt;){var Vi=xo++;Ye[Vi]=Nt.stackVec3[Vi],Nt.stackVec3[Vi]=null}Nt.stackVec3=Ye}Nt.stackVec3[Nt.sizeVec3++]=Qa}if(Fr!=null){var si=1,Jo=0,Gs=0,To=0,ko=1,Gi=0,Ci=0,Ti=0,Li=1;if(Fr.e00=si,Fr.e01=Jo,Fr.e02=Gs,Fr.e10=To,Fr.e11=ko,Fr.e12=Gi,Fr.e20=Ci,Fr.e21=Ti,Fr.e22=Li,Nt.sizeMat3==Nt.stackMat3.length){for(var Qt=Nt.sizeMat3<<1,Gr=new Array(Qt),Yr=Gr,Rr=0,Mi=Nt.sizeMat3;Rr<Mi;){var qr=Rr++;Yr[qr]=Nt.stackMat3[qr],Nt.stackMat3[qr]=null}Nt.stackMat3=Yr}Nt.stackMat3[Nt.sizeMat3++]=Fr}if(li!=null){var Ji=1,$i=0,to=0,fe=0,wr=0,sn=1,Yi=0,$o=0,gs=0,Vn=0,Is=1,wn=0,Cr=0,Ro=0,_o=0,Fn=1;if(li.e00=Ji,li.e01=$i,li.e02=to,li.e03=fe,li.e10=wr,li.e11=sn,li.e12=Yi,li.e13=$o,li.e20=gs,li.e21=Vn,li.e22=Is,li.e23=wn,li.e30=Cr,li.e31=Ro,li.e32=_o,li.e33=Fn,Nt.sizeMat4==Nt.stackMat4.length){for(var Ge=Nt.sizeMat4<<1,Gn=new Array(Ge),Wo=Gn,kn=0,Ze=Nt.sizeMat4;kn<Ze;){var Ut=kn++;Wo[Ut]=Nt.stackMat4[Ut],Nt.stackMat4[Ut]=null}Nt.stackMat4=Wo}Nt.stackMat4[Nt.sizeMat4++]=li}if(wo!=null){var Qo=0,Ui=0,Xn=0,Jn=1;if(wo.x=Qo,wo.y=Ui,wo.z=Xn,wo.w=Jn,Nt.sizeQuat==Nt.stackQuat.length){for(var ue=Nt.sizeQuat<<1,Vs=new Array(ue),Uo=Vs,ws=0,X_=Nt.sizeQuat;ws<X_;){var Js=ws++;Uo[Js]=Nt.stackQuat[Js],Nt.stackQuat[Js]=null}Nt.stackQuat=Uo}Nt.stackQuat[Nt.sizeQuat++]=wo}}else{for(var L_=1/Math.sqrt(t*t+4*r*r),Je=2*r*L_,F_=t*L_,G_=0;G_<8;){var Oi=G_++,Xo=this.tmpCircleNorms[Oi],Lo=this.circleCoords[Oi];Xo.x=Lo.x,Xo.y=Lo.y,Xo.z=Lo.z;var $n=Xo,kr=$n.x*Je,Wn=$n.y*Je,Eo=$n.z*Je;$n.x=kr,$n.y=Wn,$n.z=Eo,$n.y+=F_;var ro=this.tmpCircleNorms[Oi],J_=ro.x*f.e00+ro.y*f.e01+ro.z*f.e02,$_=ro.x*f.e10+ro.y*f.e11+ro.z*f.e12,Y_=ro.x*f.e20+ro.y*f.e21+ro.z*f.e22;ro.x=J_,ro.y=$_,ro.z=Y_;var is=this.tmpCircleVerts1[Oi],v_=this.circleCoordsShift[Oi];is.x=v_.x,is.y=v_.y,is.z=v_.z;var l_=is,os=l_.x*Je,mr=l_.y*Je,Oo=l_.z*Je;l_.x=os,l_.y=mr,l_.z=Oo,l_.y+=F_;var ai=this.tmpCircleVerts1[Oi],de=ai.x*f.e00+ai.y*f.e01+ai.z*f.e02,$s=ai.x*f.e10+ai.y*f.e11+ai.z*f.e12,cv=ai.x*f.e20+ai.y*f.e21+ai.z*f.e22;ai.x=de,ai.y=$s,ai.z=cv;var xe=this.tmpCircleVerts2[Oi],$e=this.circleCoords[Oi];xe.x=$e.x,xe.y=$e.y,xe.z=$e.z;var Kn=xe,Ws=Kn.x*f.e00+Kn.y*f.e01+Kn.z*f.e02,Tr=Kn.x*f.e10+Kn.y*f.e11+Kn.z*f.e12,Yo=Kn.x*f.e20+Kn.y*f.e21+Kn.z*f.e22;Kn.x=Ws,Kn.y=Tr,Kn.z=Yo;var Ri=Kn,_n=Ri.x*t,ks=Ri.y*t,Z_=Ri.z*t;Ri.x=_n,Ri.y=ks,Ri.z=Z_;var We=Ri,qn=We.x+u.x,Ln=We.y+u.y,ns=We.z+u.z;We.x=qn,We.y=Ln,We.z=ns;var Be=this.tmpCircleVerts2[Oi],es=-r,Us=Be.x+h.x*es,h_=Be.y+h.y*es,Se=Be.z+h.z*es;Be.x=Us,Be.y=h_,Be.z=Se}for(var Ae=0;Ae<8;){var ae=Ae++,pr=w,Mo=this.tmpCircleVerts2[ae],Zi=this.tmpCircleVerts2[(ae+1)%8],Ho=this.tmpCircleVerts1[ae],Zo=this.tmpCircleNorms[ae],Hi=this.tmpCircleNorms[(ae+1)%8];this.triangle(pr,Mo,Zi,Ho,Zo,Hi,i),pr=A,Mo=this.tmpCircleVerts2[(ae+1)%8],Zi=this.tmpCircleVerts2[ae];var Do=this.p,Xs=Do.sizeVec3==0?new x.common.Vec3:Do.stackVec3[--Do.sizeVec3];Xs.x=h.x,Xs.y=h.y,Xs.z=h.z;var te=Xs,Os=-te.x,W_=-te.y,re=-te.z;te.x=Os,te.y=W_,te.z=re,Ho=te,this.triangle(pr,Mo,Zi,Ho,Ho,Ho,i);var Ft=this.p,ji=null,No=null,Ls=null;if(Ho!=null){if(Ho.zero(),Ft.sizeVec3==Ft.stackVec3.length){for(var kv=Ft.sizeVec3<<1,i0=new Array(kv),U_=i0,Ot=0,Yn=Ft.sizeVec3;Ot<Yn;){var Qi=Ot++;U_[Qi]=Ft.stackVec3[Qi],Ft.stackVec3[Qi]=null}Ft.stackVec3=U_}Ft.stackVec3[Ft.sizeVec3++]=Ho}if(ji!=null){var Zn=1,d_=0,Hs=0,c_=0,fo=1,ss=0,_s=0,Me=0,Zr=1;if(ji.e00=Zn,ji.e01=d_,ji.e02=Hs,ji.e10=c_,ji.e11=fo,ji.e12=ss,ji.e20=_s,ji.e21=Me,ji.e22=Zr,Ft.sizeMat3==Ft.stackMat3.length){for(var jo=Ft.sizeMat3<<1,wi=new Array(jo),Bo=wi,Ue=0,bv=Ft.sizeMat3;Ue<bv;){var ze=Ue++;Bo[ze]=Ft.stackMat3[ze],Ft.stackMat3[ze]=null}Ft.stackMat3=Bo}Ft.stackMat3[Ft.sizeMat3++]=ji}if(No!=null){var js=1,Xv=0,Oe=0,er=0,dn=0,vn=1,ln=0,B_=0,fv=0,ie=0,Pe=1,b_=0,O_=0,uv=0,xv=0,f_=1;if(No.e00=js,No.e01=Xv,No.e02=Oe,No.e03=er,No.e10=dn,No.e11=vn,No.e12=ln,No.e13=B_,No.e20=fv,No.e21=ie,No.e22=Pe,No.e23=b_,No.e30=O_,No.e31=uv,No.e32=xv,No.e33=f_,Ft.sizeMat4==Ft.stackMat4.length){for(var He=Ft.sizeMat4<<1,zo=new Array(He),vs=zo,ls=0,Wr=Ft.sizeMat4;ls<Wr;){var mo=ls++;vs[mo]=Ft.stackMat4[mo],Ft.stackMat4[mo]=null}Ft.stackMat4=vs}Ft.stackMat4[Ft.sizeMat4++]=No}if(Ls!=null){var vo=0,hs=0,Ys=0,Zs=1;if(Ls.x=vo,Ls.y=hs,Ls.z=Ys,Ls.w=Zs,Ft.sizeQuat==Ft.stackQuat.length){for(var ds=Ft.sizeQuat<<1,S_=new Array(ds),me=S_,cs=0,H_=Ft.sizeQuat;cs<H_;){var Ks=cs++;me[Ks]=Ft.stackQuat[Ks],Ft.stackQuat[Ks]=null}Ft.stackQuat=me}Ft.stackQuat[Ft.sizeQuat++]=Ls}}}var Un=this.p;if(w!=null){if(w.zero(),Un.sizeVec3==Un.stackVec3.length){for(var pe=Un.sizeVec3<<1,Lv=new Array(pe),A_=Lv,Ko=0,hn=Un.sizeVec3;Ko<hn;){var po=Ko++;A_[po]=Un.stackVec3[po],Un.stackVec3[po]=null}Un.stackVec3=A_}Un.stackVec3[Un.sizeVec3++]=w}var Ht=this.p;if(A!=null){if(A.zero(),Ht.sizeVec3==Ht.stackVec3.length){for(var Ki=Ht.sizeVec3<<1,lo=new Array(Ki),qs=lo,Bs=0,a_=Ht.sizeVec3;Bs<a_;){var P_=Bs++;qs[P_]=Ht.stackVec3[P_],Ht.stackVec3[P_]=null}Ht.stackVec3=qs}Ht.stackVec3[Ht.sizeVec3++]=A}var qo=this.p;if(u!=null){if(u.zero(),qo.sizeVec3==qo.stackVec3.length){for(var oe=qo.sizeVec3<<1,j_=new Array(oe),Mv=j_,dr=0,yo=qo.sizeVec3;dr<yo;){var Ei=dr++;Mv[Ei]=qo.stackVec3[Ei],qo.stackVec3[Ei]=null}qo.stackVec3=Mv}qo.stackVec3[qo.sizeVec3++]=u}var io=this.p;if(f!=null){var K_=1,q_=0,Yv=0,t_=0,Zv=1,av=0,Br=0,tv=0,Ss=1;if(f.e00=K_,f.e01=q_,f.e02=Yv,f.e10=t_,f.e11=Zv,f.e12=av,f.e20=Br,f.e21=tv,f.e22=Ss,io.sizeMat3==io.stackMat3.length){for(var As=io.sizeMat3<<1,bs=new Array(As),fs=bs,Ps=0,dv=io.sizeMat3;Ps<dv;){var ye=Ps++;fs[ye]=io.stackMat3[ye],io.stackMat3[ye]=null}io.stackMat3=fs}io.stackMat3[io.sizeMat3++]=f}var qi=this.p;if(s!=null){if(s.zero(),qi.sizeVec3==qi.stackVec3.length){for(var r_=qi.sizeVec3<<1,go=new Array(r_),i_=go,Fo=0,Cs=qi.sizeVec3;Fo<Cs;){var an=Fo++;i_[an]=qi.stackVec3[an],qi.stackVec3[an]=null}qi.stackVec3=i_}qi.stackVec3[qi.sizeVec3++]=s}var ge=this.p;if(h!=null){if(h.zero(),ge.sizeVec3==ge.stackVec3.length){for(var sr=ge.sizeVec3<<1,tn=new Array(sr),_i=tn,ne=0,Ie=ge.sizeVec3;ne<Ie;){var So=ne++;_i[So]=ge.stackVec3[So],ge.stackVec3[So]=null}ge.stackVec3=_i}ge.stackVec3[ge.sizeVec3++]=h}var Di=this.p;if(e!=null){if(e.zero(),Di.sizeVec3==Di.stackVec3.length){for(var Bn=Di.sizeVec3<<1,rv=new Array(Bn),o_=rv,C_=0,iv=Di.sizeVec3;C_<iv;){var ee=C_++;o_[ee]=Di.stackVec3[ee],Di.stackVec3[ee]=null}Di.stackVec3=o_}Di.stackVec3[Di.sizeVec3++]=e}}cylinder(a,t,r,i){var o=this.p,s=o.sizeVec3==0?new x.common.Vec3:o.stackVec3[--o.sizeVec3],_=this.p,h=_.sizeVec3==0?new x.common.Vec3:_.stackVec3[--_.sizeVec3],v=this.p,e=v.sizeVec3==0?new x.common.Vec3:v.stackVec3[--v.sizeVec3],l=this.p,u=l.sizeVec3==0?new x.common.Vec3:l.stackVec3[--l.sizeVec3],b=this.p,f=b.sizeMat3==0?new x.common.Mat3:b.stackMat3[--b.sizeMat3],n=u;n.x=a._positionX,n.y=a._positionY,n.z=a._positionZ;var c=f;c.e00=a._rotation00,c.e01=a._rotation01,c.e02=a._rotation02,c.e10=a._rotation10,c.e11=a._rotation11,c.e12=a._rotation12,c.e20=a._rotation20,c.e21=a._rotation21,c.e22=a._rotation22,s.init(f.e00,f.e10,f.e20),h.init(f.e01,f.e11,f.e21),e.init(f.e02,f.e12,f.e22);var M=this.p,m=M.sizeVec3==0?new x.common.Vec3:M.stackVec3[--M.sizeVec3];m.x=u.x,m.y=u.y,m.z=u.z;var y=m,V=y.x+h.x*r,z=y.y+h.y*r,I=y.z+h.z*r;y.x=V,y.y=z,y.z=I;var w=y,X=this.p,L=X.sizeVec3==0?new x.common.Vec3:X.stackVec3[--X.sizeVec3];L.x=u.x,L.y=u.y,L.z=u.z;var p=L,g=-r,F=p.x+h.x*g,S=p.y+h.y*g,N=p.z+h.z*g;p.x=F,p.y=S,p.z=N;var A=p;if(this.wireframe){var Y=this.p,R=Y.sizeVec3==0?new x.common.Vec3:Y.stackVec3[--Y.sizeVec3];R.x=w.x,R.y=w.y,R.z=w.z;var C=R,d=-t,Z=C.x+s.x*d,j=C.y+s.y*d,H=C.z+s.z*d;C.x=Z,C.y=j,C.z=H;var E=C,G=E.x+e.x*0,B=E.y+e.y*0,Q=E.z+e.z*0;E.x=G,E.y=B,E.z=Q;var W=E,J=this.p,D=J.sizeVec3==0?new x.common.Vec3:J.stackVec3[--J.sizeVec3];D.x=w.x,D.y=w.y,D.z=w.z;var O=D,K=O.x+s.x*t,ra=O.y+s.y*t,sa=O.z+s.z*t;O.x=K,O.y=ra,O.z=sa;var $=O,q=$.x+e.x*0,na=$.y+e.y*0,oa=$.z+e.z*0;$.x=q,$.y=na,$.z=oa;var aa=$,T=this.p,ca=T.sizeVec3==0?new x.common.Vec3:T.stackVec3[--T.sizeVec3];ca.x=w.x,ca.y=w.y,ca.z=w.z;var _a=ca,k=_a.x+s.x*0,ta=_a.y+s.y*0,ia=_a.z+s.z*0;_a.x=k,_a.y=ta,_a.z=ia;var la=_a,va=-t,xa=la.x+e.x*va,Ma=la.y+e.y*va,za=la.z+e.z*va;la.x=xa,la.y=Ma,la.z=za;var Xa=la,Za=this.p,fa=Za.sizeVec3==0?new x.common.Vec3:Za.stackVec3[--Za.sizeVec3];fa.x=w.x,fa.y=w.y,fa.z=w.z;var ba=fa,ea=ba.x+s.x*0,ha=ba.y+s.y*0,pa=ba.z+s.z*0;ba.x=ea,ba.y=ha,ba.z=pa;var ya=ba,da=ya.x+e.x*t,ma=ya.y+e.y*t,Ya=ya.z+e.z*t;ya.x=da,ya.y=ma,ya.z=Ya;var Qa=ya,ga=this.p,ua=ga.sizeVec3==0?new x.common.Vec3:ga.stackVec3[--ga.sizeVec3];ua.x=A.x,ua.y=A.y,ua.z=A.z;var ka=ua,wa=-t,Pa=ka.x+s.x*wa,Mt=ka.y+s.y*wa,Oa=ka.z+s.z*wa;ka.x=Pa,ka.y=Mt,ka.z=Oa;var Ba=ka,nt=Ba.x+e.x*0,Ea=Ba.y+e.y*0,Na=Ba.z+e.z*0;Ba.x=nt,Ba.y=Ea,Ba.z=Na;var Sa=Ba,ft=this.p,Wa=ft.sizeVec3==0?new x.common.Vec3:ft.stackVec3[--ft.sizeVec3];Wa.x=A.x,Wa.y=A.y,Wa.z=A.z;var Ha=Wa,bt=Ha.x+s.x*t,rt=Ha.y+s.y*t,ja=Ha.z+s.z*t;Ha.x=bt,Ha.y=rt,Ha.z=ja;var _t=Ha,gt=_t.x+e.x*0,mt=_t.y+e.y*0,Ja=_t.z+e.z*0;_t.x=gt,_t.y=mt,_t.z=Ja;var it=_t,ut=this.p,Da=ut.sizeVec3==0?new x.common.Vec3:ut.stackVec3[--ut.sizeVec3];Da.x=A.x,Da.y=A.y,Da.z=A.z;var Ta=Da,Fa=Ta.x+s.x*0,Vt=Ta.y+s.y*0,Pt=Ta.z+s.z*0;Ta.x=Fa,Ta.y=Vt,Ta.z=Pt;var et=Ta,Xt=-t,Yt=et.x+e.x*Xt,zt=et.y+e.y*Xt,Ia=et.z+e.z*Xt;et.x=Yt,et.y=zt,et.z=Ia;var U=et,Va=this.p,lt=Va.sizeVec3==0?new x.common.Vec3:Va.stackVec3[--Va.sizeVec3];lt.x=A.x,lt.y=A.y,lt.z=A.z;var P=lt,kt=P.x+s.x*0,Bt=P.y+s.y*0,St=P.z+s.z*0;P.x=kt,P.y=Bt,P.z=St;var yt=P,wt=yt.x+e.x*t,pt=yt.y+e.y*t,ht=yt.z+e.z*t;yt.x=wt,yt.y=pt,yt.z=ht;var xt=yt;this.ellipse(w,s,e,t,t,i),this.ellipse(A,s,e,t,t,i),this.line(W,Sa,i),this.line(aa,it,i),this.line(Xa,U,i),this.line(Qa,xt,i);var Ra=this.p,st=null,Ca=null,vt=null;if(W!=null){if(W.zero(),Ra.sizeVec3==Ra.stackVec3.length){for(var qa=Ra.sizeVec3<<1,at=new Array(qa),Ua=at,tt=0,ct=Ra.sizeVec3;tt<ct;){var Aa=tt++;Ua[Aa]=Ra.stackVec3[Aa],Ra.stackVec3[Aa]=null}Ra.stackVec3=Ua}Ra.stackVec3[Ra.sizeVec3++]=W}if(st!=null){var Ga=1,Ka=0,La=0,ot=0,It=1,or=0,gr=0,ar=0,Ct=1;if(st.e00=Ga,st.e01=Ka,st.e02=La,st.e10=ot,st.e11=It,st.e12=or,st.e20=gr,st.e21=ar,st.e22=Ct,Ra.sizeMat3==Ra.stackMat3.length){for(var _r=Ra.sizeMat3<<1,Et=new Array(_r),At=Et,Gt=0,Hr=Ra.sizeMat3;Gt<Hr;){var vr=Gt++;At[vr]=Ra.stackMat3[vr],Ra.stackMat3[vr]=null}Ra.stackMat3=At}Ra.stackMat3[Ra.sizeMat3++]=st}if(Ca!=null){var lr=1,tr=0,Ur=0,Xr=0,Mr=0,Zt=1,ir=0,$t=0,nr=0,jr=0,Wt=1,Kr=0,Ir=0,mi=0,$r=0,Lt=1;if(Ca.e00=lr,Ca.e01=tr,Ca.e02=Ur,Ca.e03=Xr,Ca.e10=Mr,Ca.e11=Zt,Ca.e12=ir,Ca.e13=$t,Ca.e20=nr,Ca.e21=jr,Ca.e22=Wt,Ca.e23=Kr,Ca.e30=Ir,Ca.e31=mi,Ca.e32=$r,Ca.e33=Lt,Ra.sizeMat4==Ra.stackMat4.length){for(var Kt=Ra.sizeMat4<<1,Tt=new Array(Kt),br=Tt,zr=0,vi=Ra.sizeMat4;zr<vi;){var qt=zr++;br[qt]=Ra.stackMat4[qt],Ra.stackMat4[qt]=null}Ra.stackMat4=br}Ra.stackMat4[Ra.sizeMat4++]=Ca}if(vt!=null){var fr=0,dt=0,ur=0,hr=1;if(vt.x=fr,vt.y=dt,vt.z=ur,vt.w=hr,Ra.sizeQuat==Ra.stackQuat.length){for(var ei=Ra.sizeQuat<<1,Xi=new Array(ei),oo=Xi,Jt=0,fi=Ra.sizeQuat;Jt<fi;){var pi=Jt++;oo[pi]=Ra.stackQuat[pi],Ra.stackQuat[pi]=null}Ra.stackQuat=oo}Ra.stackQuat[Ra.sizeQuat++]=vt}var Dt=this.p,Bi=null,Ar=null,Ni=null;if(aa!=null){if(aa.zero(),Dt.sizeVec3==Dt.stackVec3.length){for(var Hn=Dt.sizeVec3<<1,no=new Array(Hn),Si=no,eo=0,gn=Dt.sizeVec3;eo<gn;){var Ao=eo++;Si[Ao]=Dt.stackVec3[Ao],Dt.stackVec3[Ao]=null}Dt.stackVec3=Si}Dt.stackVec3[Dt.sizeVec3++]=aa}if(Bi!=null){var Vo=1,xr=0,ao=0,Ai=0,yi=1,Po=0,Dr=0,Pi=0,gi=1;if(Bi.e00=Vo,Bi.e01=xr,Bi.e02=ao,Bi.e10=Ai,Bi.e11=yi,Bi.e12=Po,Bi.e20=Dr,Bi.e21=Pi,Bi.e22=gi,Dt.sizeMat3==Dt.stackMat3.length){for(var Rt=Dt.sizeMat3<<1,Or=new Array(Rt),Lr=Or,Tn=0,ms=Dt.sizeMat3;Tn<ms;){var qe=Tn++;Lr[qe]=Dt.stackMat3[qe],Dt.stackMat3[qe]=null}Dt.stackMat3=Lr}Dt.stackMat3[Dt.sizeMat3++]=Bi}if(Ar!=null){var ps=1,Re=0,as=0,N_=0,In=0,Pr=1,Go=0,Wi=0,ke=0,nn=0,Rn=1,jn=0,Xe=0,k_=0,Qe=0,Vr=1;if(Ar.e00=ps,Ar.e01=Re,Ar.e02=as,Ar.e03=N_,Ar.e10=In,Ar.e11=Pr,Ar.e12=Go,Ar.e13=Wi,Ar.e20=ke,Ar.e21=nn,Ar.e22=Rn,Ar.e23=jn,Ar.e30=Xe,Ar.e31=k_,Ar.e32=Qe,Ar.e33=Vr,Dt.sizeMat4==Dt.stackMat4.length){for(var Ii=Dt.sizeMat4<<1,ui=new Array(Ii),so=ui,Qn=0,ys=Dt.sizeMat4;Qn<ys;){var en=Qn++;so[en]=Dt.stackMat4[en],Dt.stackMat4[en]=null}Dt.stackMat4=so}Dt.stackMat4[Dt.sizeMat4++]=Ar}if(Ni!=null){var En=0,cr=0,co=0,Fi=1;if(Ni.x=En,Ni.y=cr,Ni.z=co,Ni.w=Fi,Dt.sizeQuat==Dt.stackQuat.length){for(var Dn=Dt.sizeQuat<<1,ts=new Array(Dn),Ee=ts,De=0,Ne=Dt.sizeQuat;De<Ne;){var ce=De++;Ee[ce]=Dt.stackQuat[ce],Dt.stackQuat[ce]=null}Dt.stackQuat=Ee}Dt.stackQuat[Dt.sizeQuat++]=Ni}var rr=this.p,ri=null,Qr=null,Nr=null;if(Xa!=null){if(Xa.zero(),rr.sizeVec3==rr.stackVec3.length){for(var uo=rr.sizeVec3<<1,Co=new Array(uo),__=Co,Fe=0,rs=rr.sizeVec3;Fe<rs;){var Nn=Fe++;__[Nn]=rr.stackVec3[Nn],rr.stackVec3[Nn]=null}rr.stackVec3=__}rr.stackVec3[rr.sizeVec3++]=Xa}if(ri!=null){var bo=1,Nt=0,Fr=0,li=0,wo=1,be=0,Le=0,Ye=0,xo=1;if(ri.e00=bo,ri.e01=Nt,ri.e02=Fr,ri.e10=li,ri.e11=wo,ri.e12=be,ri.e20=Le,ri.e21=Ye,ri.e22=xo,rr.sizeMat3==rr.stackMat3.length){for(var jt=rr.sizeMat3<<1,Vi=new Array(jt),si=Vi,Jo=0,Gs=rr.sizeMat3;Jo<Gs;){var To=Jo++;si[To]=rr.stackMat3[To],rr.stackMat3[To]=null}rr.stackMat3=si}rr.stackMat3[rr.sizeMat3++]=ri}if(Qr!=null){var ko=1,Gi=0,Ci=0,Ti=0,Li=0,Qt=1,Gr=0,Yr=0,Rr=0,Mi=0,qr=1,Ji=0,$i=0,to=0,fe=0,wr=1;if(Qr.e00=ko,Qr.e01=Gi,Qr.e02=Ci,Qr.e03=Ti,Qr.e10=Li,Qr.e11=Qt,Qr.e12=Gr,Qr.e13=Yr,Qr.e20=Rr,Qr.e21=Mi,Qr.e22=qr,Qr.e23=Ji,Qr.e30=$i,Qr.e31=to,Qr.e32=fe,Qr.e33=wr,rr.sizeMat4==rr.stackMat4.length){for(var sn=rr.sizeMat4<<1,Yi=new Array(sn),$o=Yi,gs=0,Vn=rr.sizeMat4;gs<Vn;){var Is=gs++;$o[Is]=rr.stackMat4[Is],rr.stackMat4[Is]=null}rr.stackMat4=$o}rr.stackMat4[rr.sizeMat4++]=Qr}if(Nr!=null){var wn=0,Cr=0,Ro=0,_o=1;if(Nr.x=wn,Nr.y=Cr,Nr.z=Ro,Nr.w=_o,rr.sizeQuat==rr.stackQuat.length){for(var Fn=rr.sizeQuat<<1,Ge=new Array(Fn),Gn=Ge,Wo=0,kn=rr.sizeQuat;Wo<kn;){var Ze=Wo++;Gn[Ze]=rr.stackQuat[Ze],rr.stackQuat[Ze]=null}rr.stackQuat=Gn}rr.stackQuat[rr.sizeQuat++]=Nr}var Ut=this.p,Qo=null,Ui=null,Xn=null;if(Qa!=null){if(Qa.zero(),Ut.sizeVec3==Ut.stackVec3.length){for(var Jn=Ut.sizeVec3<<1,ue=new Array(Jn),Vs=ue,Uo=0,ws=Ut.sizeVec3;Uo<ws;){var X_=Uo++;Vs[X_]=Ut.stackVec3[X_],Ut.stackVec3[X_]=null}Ut.stackVec3=Vs}Ut.stackVec3[Ut.sizeVec3++]=Qa}if(Qo!=null){var Js=1,L_=0,Je=0,F_=0,G_=1,Oi=0,Xo=0,Lo=0,$n=1;if(Qo.e00=Js,Qo.e01=L_,Qo.e02=Je,Qo.e10=F_,Qo.e11=G_,Qo.e12=Oi,Qo.e20=Xo,Qo.e21=Lo,Qo.e22=$n,Ut.sizeMat3==Ut.stackMat3.length){for(var kr=Ut.sizeMat3<<1,Wn=new Array(kr),Eo=Wn,ro=0,J_=Ut.sizeMat3;ro<J_;){var $_=ro++;Eo[$_]=Ut.stackMat3[$_],Ut.stackMat3[$_]=null}Ut.stackMat3=Eo}Ut.stackMat3[Ut.sizeMat3++]=Qo}if(Ui!=null){var Y_=1,is=0,v_=0,l_=0,os=0,mr=1,Oo=0,ai=0,de=0,$s=0,cv=1,xe=0,$e=0,Kn=0,Ws=0,Tr=1;if(Ui.e00=Y_,Ui.e01=is,Ui.e02=v_,Ui.e03=l_,Ui.e10=os,Ui.e11=mr,Ui.e12=Oo,Ui.e13=ai,Ui.e20=de,Ui.e21=$s,Ui.e22=cv,Ui.e23=xe,Ui.e30=$e,Ui.e31=Kn,Ui.e32=Ws,Ui.e33=Tr,Ut.sizeMat4==Ut.stackMat4.length){for(var Yo=Ut.sizeMat4<<1,Ri=new Array(Yo),_n=Ri,ks=0,Z_=Ut.sizeMat4;ks<Z_;){var We=ks++;_n[We]=Ut.stackMat4[We],Ut.stackMat4[We]=null}Ut.stackMat4=_n}Ut.stackMat4[Ut.sizeMat4++]=Ui}if(Xn!=null){var qn=0,Ln=0,ns=0,Be=1;if(Xn.x=qn,Xn.y=Ln,Xn.z=ns,Xn.w=Be,Ut.sizeQuat==Ut.stackQuat.length){for(var es=Ut.sizeQuat<<1,Us=new Array(es),h_=Us,Se=0,Ae=Ut.sizeQuat;Se<Ae;){var ae=Se++;h_[ae]=Ut.stackQuat[ae],Ut.stackQuat[ae]=null}Ut.stackQuat=h_}Ut.stackQuat[Ut.sizeQuat++]=Xn}var pr=this.p,Mo=null,Zi=null,Ho=null;if(Sa!=null){if(Sa.zero(),pr.sizeVec3==pr.stackVec3.length){for(var Zo=pr.sizeVec3<<1,Hi=new Array(Zo),Do=Hi,Xs=0,te=pr.sizeVec3;Xs<te;){var Os=Xs++;Do[Os]=pr.stackVec3[Os],pr.stackVec3[Os]=null}pr.stackVec3=Do}pr.stackVec3[pr.sizeVec3++]=Sa}if(Mo!=null){var W_=1,re=0,Ft=0,ji=0,No=1,Ls=0,kv=0,i0=0,U_=1;if(Mo.e00=W_,Mo.e01=re,Mo.e02=Ft,Mo.e10=ji,Mo.e11=No,Mo.e12=Ls,Mo.e20=kv,Mo.e21=i0,Mo.e22=U_,pr.sizeMat3==pr.stackMat3.length){for(var Ot=pr.sizeMat3<<1,Yn=new Array(Ot),Qi=Yn,Zn=0,d_=pr.sizeMat3;Zn<d_;){var Hs=Zn++;Qi[Hs]=pr.stackMat3[Hs],pr.stackMat3[Hs]=null}pr.stackMat3=Qi}pr.stackMat3[pr.sizeMat3++]=Mo}if(Zi!=null){var c_=1,fo=0,ss=0,_s=0,Me=0,Zr=1,jo=0,wi=0,Bo=0,Ue=0,bv=1,ze=0,js=0,Xv=0,Oe=0,er=1;if(Zi.e00=c_,Zi.e01=fo,Zi.e02=ss,Zi.e03=_s,Zi.e10=Me,Zi.e11=Zr,Zi.e12=jo,Zi.e13=wi,Zi.e20=Bo,Zi.e21=Ue,Zi.e22=bv,Zi.e23=ze,Zi.e30=js,Zi.e31=Xv,Zi.e32=Oe,Zi.e33=er,pr.sizeMat4==pr.stackMat4.length){for(var dn=pr.sizeMat4<<1,vn=new Array(dn),ln=vn,B_=0,fv=pr.sizeMat4;B_<fv;){var ie=B_++;ln[ie]=pr.stackMat4[ie],pr.stackMat4[ie]=null}pr.stackMat4=ln}pr.stackMat4[pr.sizeMat4++]=Zi}if(Ho!=null){var Pe=0,b_=0,O_=0,uv=1;if(Ho.x=Pe,Ho.y=b_,Ho.z=O_,Ho.w=uv,pr.sizeQuat==pr.stackQuat.length){for(var xv=pr.sizeQuat<<1,f_=new Array(xv),He=f_,zo=0,vs=pr.sizeQuat;zo<vs;){var ls=zo++;He[ls]=pr.stackQuat[ls],pr.stackQuat[ls]=null}pr.stackQuat=He}pr.stackQuat[pr.sizeQuat++]=Ho}var Wr=this.p,mo=null,vo=null,hs=null;if(it!=null){if(it.zero(),Wr.sizeVec3==Wr.stackVec3.length){for(var Ys=Wr.sizeVec3<<1,Zs=new Array(Ys),ds=Zs,S_=0,me=Wr.sizeVec3;S_<me;){var cs=S_++;ds[cs]=Wr.stackVec3[cs],Wr.stackVec3[cs]=null}Wr.stackVec3=ds}Wr.stackVec3[Wr.sizeVec3++]=it}if(mo!=null){var H_=1,Ks=0,Un=0,pe=0,Lv=1,A_=0,Ko=0,hn=0,po=1;if(mo.e00=H_,mo.e01=Ks,mo.e02=Un,mo.e10=pe,mo.e11=Lv,mo.e12=A_,mo.e20=Ko,mo.e21=hn,mo.e22=po,Wr.sizeMat3==Wr.stackMat3.length){for(var Ht=Wr.sizeMat3<<1,Ki=new Array(Ht),lo=Ki,qs=0,Bs=Wr.sizeMat3;qs<Bs;){var a_=qs++;lo[a_]=Wr.stackMat3[a_],Wr.stackMat3[a_]=null}Wr.stackMat3=lo}Wr.stackMat3[Wr.sizeMat3++]=mo}if(vo!=null){var P_=1,qo=0,oe=0,j_=0,Mv=0,dr=1,yo=0,Ei=0,io=0,K_=0,q_=1,Yv=0,t_=0,Zv=0,av=0,Br=1;if(vo.e00=P_,vo.e01=qo,vo.e02=oe,vo.e03=j_,vo.e10=Mv,vo.e11=dr,vo.e12=yo,vo.e13=Ei,vo.e20=io,vo.e21=K_,vo.e22=q_,vo.e23=Yv,vo.e30=t_,vo.e31=Zv,vo.e32=av,vo.e33=Br,Wr.sizeMat4==Wr.stackMat4.length){for(var tv=Wr.sizeMat4<<1,Ss=new Array(tv),As=Ss,bs=0,fs=Wr.sizeMat4;bs<fs;){var Ps=bs++;As[Ps]=Wr.stackMat4[Ps],Wr.stackMat4[Ps]=null}Wr.stackMat4=As}Wr.stackMat4[Wr.sizeMat4++]=vo}if(hs!=null){var dv=0,ye=0,qi=0,r_=1;if(hs.x=dv,hs.y=ye,hs.z=qi,hs.w=r_,Wr.sizeQuat==Wr.stackQuat.length){for(var go=Wr.sizeQuat<<1,i_=new Array(go),Fo=i_,Cs=0,an=Wr.sizeQuat;Cs<an;){var ge=Cs++;Fo[ge]=Wr.stackQuat[ge],Wr.stackQuat[ge]=null}Wr.stackQuat=Fo}Wr.stackQuat[Wr.sizeQuat++]=hs}var sr=this.p,tn=null,_i=null,ne=null;if(U!=null){if(U.zero(),sr.sizeVec3==sr.stackVec3.length){for(var Ie=sr.sizeVec3<<1,So=new Array(Ie),Di=So,Bn=0,rv=sr.sizeVec3;Bn<rv;){var o_=Bn++;Di[o_]=sr.stackVec3[o_],sr.stackVec3[o_]=null}sr.stackVec3=Di}sr.stackVec3[sr.sizeVec3++]=U}if(tn!=null){var C_=1,iv=0,ee=0,Sn=0,Ve=1,D0=0,m0=0,cl=0,N0=1;if(tn.e00=C_,tn.e01=iv,tn.e02=ee,tn.e10=Sn,tn.e11=Ve,tn.e12=D0,tn.e20=m0,tn.e21=cl,tn.e22=N0,sr.sizeMat3==sr.stackMat3.length){for(var hi=sr.sizeMat3<<1,On=new Array(hi),Io=On,us=0,ov=sr.sizeMat3;us<ov;){var zv=us++;Io[zv]=sr.stackMat3[zv],sr.stackMat3[zv]=null}sr.stackMat3=Io}sr.stackMat3[sr.sizeMat3++]=tn}if(_i!=null){var n_=1,Bv=0,Ts=0,u_=0,x_=0,Sr=1,Rs=0,ho=0,Ce=0,mv=0,Qs=1,M_=0,nv=0,o0=0,n0=0,ev=1;if(_i.e00=n_,_i.e01=Bv,_i.e02=Ts,_i.e03=u_,_i.e10=x_,_i.e11=Sr,_i.e12=Rs,_i.e13=ho,_i.e20=Ce,_i.e21=mv,_i.e22=Qs,_i.e23=M_,_i.e30=nv,_i.e31=o0,_i.e32=n0,_i.e33=ev,sr.sizeMat4==sr.stackMat4.length){for(var ti=sr.sizeMat4<<1,je=new Array(ti),An=je,xs=0,F0=sr.sizeMat4;xs<F0;){var Nv=xs++;An[Nv]=sr.stackMat4[Nv],sr.stackMat4[Nv]=null}sr.stackMat4=An}sr.stackMat4[sr.sizeMat4++]=_i}if(ne!=null){var T_=0,p0=0,Sv=0,e0=1;if(ne.x=T_,ne.y=p0,ne.z=Sv,ne.w=e0,sr.sizeQuat==sr.stackQuat.length){for(var y0=sr.sizeQuat<<1,G0=new Array(y0),s0=G0,_0=0,g0=sr.sizeQuat;_0<g0;){var Fv=_0++;s0[Fv]=sr.stackQuat[Fv],sr.stackQuat[Fv]=null}sr.stackQuat=s0}sr.stackQuat[sr.sizeQuat++]=ne}var ci=this.p,pv=null,cn=null,Gv=null;if(xt!=null){if(xt.zero(),ci.sizeVec3==ci.stackVec3.length){for(var Hl=ci.sizeVec3<<1,I0=new Array(Hl),V0=I0,bl=0,Bl=ci.sizeVec3;bl<Bl;){var Jv=bl++;V0[Jv]=ci.stackVec3[Jv],ci.stackVec3[Jv]=null}ci.stackVec3=V0}ci.stackVec3[ci.sizeVec3++]=xt}if(pv!=null){var jl=1,Kl=0,fl=0,Sl=0,Al=1,ql=0,ul=0,ah=0,xl=1;if(pv.e00=jl,pv.e01=Kl,pv.e02=fl,pv.e10=Sl,pv.e11=Al,pv.e12=ql,pv.e20=ul,pv.e21=ah,pv.e22=xl,ci.sizeMat3==ci.stackMat3.length){for(var ii=ci.sizeMat3<<1,Ms=new Array(ii),rn=Ms,yv=0,gh=ci.sizeMat3;yv<gh;){var $v=yv++;rn[$v]=ci.stackMat3[$v],ci.stackMat3[$v]=null}ci.stackMat3=rn}ci.stackMat3[ci.sizeMat3++]=pv}if(cn!=null){var J0=1,Ml=0,w0=0,k0=0,$0=0,zi=1,zs=0,se=0,v0=0,Pl=0,hh=1,W0=0,ch=0,U0=0,Cl=0,zl=1;if(cn.e00=J0,cn.e01=Ml,cn.e02=w0,cn.e03=k0,cn.e10=$0,cn.e11=zi,cn.e12=zs,cn.e13=se,cn.e20=v0,cn.e21=Pl,cn.e22=hh,cn.e23=W0,cn.e30=ch,cn.e31=U0,cn.e32=Cl,cn.e33=zl,ci.sizeMat4==ci.stackMat4.length){for(var Te=ci.sizeMat4<<1,X0=new Array(Te),z_=X0,Tl=0,O0=ci.sizeMat4;Tl<O0;){var H0=Tl++;z_[H0]=ci.stackMat4[H0],ci.stackMat4[H0]=null}ci.stackMat4=z_}ci.stackMat4[ci.sizeMat4++]=cn}if(Gv!=null){var Rl=0,ml=0,L0=0,l0=1;if(Gv.x=Rl,Gv.y=ml,Gv.z=L0,Gv.w=l0,ci.sizeQuat==ci.stackQuat.length){for(var m_=ci.sizeQuat<<1,Wv=new Array(m_),Uv=Wv,sv=0,Y0=ci.sizeQuat;sv<Y0;){var Av=sv++;Uv[Av]=ci.stackQuat[Av],ci.stackQuat[Av]=null}ci.stackQuat=Uv}ci.stackQuat[ci.sizeQuat++]=Gv}}else{for(var h0=0;h0<8;){var _e=h0++,c0=this.tmpCircleNorms[_e],Z0=this.circleCoords[_e];c0.x=Z0.x,c0.y=Z0.y,c0.z=Z0.z;var Es=c0,j0=Es.x*f.e00+Es.y*f.e01+Es.z*f.e02,yr=Es.x*f.e10+Es.y*f.e11+Es.z*f.e12,bn=Es.x*f.e20+Es.y*f.e21+Es.z*f.e22;Es.x=j0,Es.y=yr,Es.z=bn;var ki=this.tmpCircleVerts1[_e],Ov=this.tmpCircleNorms[_e];ki.x=Ov.x,ki.y=Ov.y,ki.z=Ov.z;var b0=ki,bh=b0.x*t,th=b0.y*t,p_=b0.z*t;b0.x=bh,b0.y=th,b0.z=p_;var Ke=b0,Ds=Ke.x+u.x,rh=Ke.y+u.y,fh=Ke.z+u.z;Ke.x=Ds,Ke.y=rh,Ke.z=fh;var Ql=this.tmpCircleVerts2[_e],bi=this.tmpCircleVerts1[_e];Ql.x=bi.x,Ql.y=bi.y,Ql.z=bi.z;var e_=this.tmpCircleVerts1[_e],fn=e_.x+h.x*r,gv=e_.y+h.y*r,K0=e_.z+h.z*r;e_.x=fn,e_.y=gv,e_.z=K0;var Iv=this.tmpCircleVerts2[_e],pl=-r,yl=Iv.x+h.x*pl,gl=Iv.y+h.y*pl,R_=Iv.z+h.z*pl;Iv.x=yl,Iv.y=gl,Iv.z=R_}for(var Pv=0;Pv<8;){var Pn=Pv++,Vv=w,Cv=this.tmpCircleVerts1[Pn],Q_=this.tmpCircleVerts1[(Pn+1)%8],ve=h;this.triangle(Vv,Cv,Q_,ve,ve,ve,i),Vv=A,Cv=this.tmpCircleVerts2[(Pn+1)%8],Q_=this.tmpCircleVerts2[Pn];var E_=this.p,Tv=E_.sizeVec3==0?new x.common.Vec3:E_.stackVec3[--E_.sizeVec3];Tv.x=h.x,Tv.y=h.y,Tv.z=h.z;var Hv=Tv,oi=-Hv.x,y_=-Hv.y,le=-Hv.z;Hv.x=oi,Hv.y=y_,Hv.z=le,ve=Hv,this.triangle(Vv,Cv,Q_,ve,ve,ve,i);var Jr=this.p,g_=null,Cn=null,q0=null;if(ve!=null){if(ve.zero(),Jr.sizeVec3==Jr.stackVec3.length){for(var f0=Jr.sizeVec3<<1,uh=new Array(f0),al=uh,tl=0,Il=Jr.sizeVec3;tl<Il;){var d0=tl++;al[d0]=Jr.stackVec3[d0],Jr.stackVec3[d0]=null}Jr.stackVec3=al}Jr.stackVec3[Jr.sizeVec3++]=ve}if(g_!=null){var xh=1,Vl=0,Ih=0,ih=0,wl=1,B0=0,S0=0,kl=0,oh=1;if(g_.e00=xh,g_.e01=Vl,g_.e02=Ih,g_.e10=ih,g_.e11=wl,g_.e12=B0,g_.e20=S0,g_.e21=kl,g_.e22=oh,Jr.sizeMat3==Jr.stackMat3.length){for(var jv=Jr.sizeMat3<<1,El=new Array(jv),Kv=El,ni=0,I_=Jr.sizeMat3;ni<I_;){var on=ni++;Kv[on]=Jr.stackMat3[on],Jr.stackMat3[on]=null}Jr.stackMat3=Kv}Jr.stackMat3[Jr.sizeMat3++]=g_}if(Cn!=null){var Xl=1,A0=0,nh=0,Dl=0,rl=0,Nl=1,P0=0,eh=0,sh=0,Fl=0,Gl=1,_v=0,Rv=0,qv=0,Ns=0,Mh=1;if(Cn.e00=Xl,Cn.e01=A0,Cn.e02=nh,Cn.e03=Dl,Cn.e10=rl,Cn.e11=Nl,Cn.e12=P0,Cn.e13=eh,Cn.e20=sh,Cn.e21=Fl,Cn.e22=Gl,Cn.e23=_v,Cn.e30=Rv,Cn.e31=qv,Cn.e32=Ns,Cn.e33=Mh,Jr.sizeMat4==Jr.stackMat4.length){for(var u0=Jr.sizeMat4<<1,Ll=new Array(u0),Qv=Ll,a0=0,Ev=Jr.sizeMat4;a0<Ev;){var x0=a0++;Qv[x0]=Jr.stackMat4[x0],Jr.stackMat4[x0]=null}Jr.stackMat4=Qv}Jr.stackMat4[Jr.sizeMat4++]=Cn}if(q0!=null){var dh=0,C0=0,t0=0,Jl=1;if(q0.x=dh,q0.y=C0,q0.z=t0,q0.w=Jl,Jr.sizeQuat==Jr.stackQuat.length){for(var $l=Jr.sizeQuat<<1,zh=new Array($l),Dv=zh,xi=0,we=Jr.sizeQuat;xi<we;){var he=xi++;Dv[he]=Jr.stackQuat[he],Jr.stackQuat[he]=null}Jr.stackQuat=Dv}Jr.stackQuat[Jr.sizeQuat++]=q0}Vv=this.tmpCircleVerts1[Pn],Cv=this.tmpCircleVerts2[Pn],Q_=this.tmpCircleVerts2[(Pn+1)%8];var T0=this.tmpCircleVerts1[(Pn+1)%8];ve=this.tmpCircleNorms[Pn];var Wl=this.tmpCircleNorms[(Pn+1)%8];this.rect(Vv,Cv,Q_,T0,ve,ve,Wl,Wl,i)}}var Fs=this.p;if(w!=null){if(w.zero(),Fs.sizeVec3==Fs.stackVec3.length){for(var M0=Fs.sizeVec3<<1,Yl=new Array(M0),Ul=Yl,Ol=0,Vh=Fs.sizeVec3;Ol<Vh;){var vv=Ol++;Ul[vv]=Fs.stackVec3[vv],Fs.stackVec3[vv]=null}Fs.stackVec3=Ul}Fs.stackVec3[Fs.sizeVec3++]=w}var lv=this.p;if(A!=null){if(A.zero(),lv.sizeVec3==lv.stackVec3.length){for(var R0=lv.sizeVec3<<1,V_=new Array(R0),Zl=V_,wh=0,Bh=lv.sizeVec3;wh<Bh;){var r0=wh++;Zl[r0]=lv.stackVec3[r0],lv.stackVec3[r0]=null}lv.stackVec3=Zl}lv.stackVec3[lv.sizeVec3++]=A}var hv=this.p;if(u!=null){if(u.zero(),hv.sizeVec3==hv.stackVec3.length){for(var kh=hv.sizeVec3<<1,dl=new Array(kh),Xh=dl,jh=0,_h=hv.sizeVec3;jh<_h;){var Er=jh++;Xh[Er]=hv.stackVec3[Er],hv.stackVec3[Er]=null}hv.stackVec3=Xh}hv.stackVec3[hv.sizeVec3++]=u}var s_=this.p;if(f!=null){var w_=1,vh=0,Sh=0,Ah=0,mh=1,wv=0,Qh=0,Eh=0,Kh=1;if(f.e00=w_,f.e01=vh,f.e02=Sh,f.e10=Ah,f.e11=mh,f.e12=wv,f.e20=Qh,f.e21=Eh,f.e22=Kh,s_.sizeMat3==s_.stackMat3.length){for(var qh=s_.sizeMat3<<1,ph=new Array(qh),Ph=ph,il=0,ic=s_.sizeMat3;il<ic;){var Lh=il++;Ph[Lh]=s_.stackMat3[Lh],s_.stackMat3[Lh]=null}s_.stackMat3=Ph}s_.stackMat3[s_.sizeMat3++]=f}var D_=this.p;if(s!=null){if(s.zero(),D_.sizeVec3==D_.stackVec3.length){for(var Dh=D_.sizeVec3<<1,yh=new Array(Dh),ac=yh,Yh=0,tc=D_.sizeVec3;Yh<tc;){var Ch=Yh++;ac[Ch]=D_.stackVec3[Ch],D_.stackVec3[Ch]=null}D_.stackVec3=ac}D_.stackVec3[D_.sizeVec3++]=s}var Q0=this.p;if(h!=null){if(h.zero(),Q0.sizeVec3==Q0.stackVec3.length){for(var oc=Q0.sizeVec3<<1,lh=new Array(oc),Zh=lh,Nh=0,Th=Q0.sizeVec3;Nh<Th;){var E0=Nh++;Zh[E0]=Q0.stackVec3[E0],Q0.stackVec3[E0]=null}Q0.stackVec3=Zh}Q0.stackVec3[Q0.sizeVec3++]=h}var z0=this.p;if(e!=null){if(e.zero(),z0.sizeVec3==z0.stackVec3.length){for(var ec=z0.sizeVec3<<1,sc=new Array(ec),Fh=sc,nc=0,rc=z0.sizeVec3;nc<rc;){var ol=nc++;Fh[ol]=z0.stackVec3[ol],z0.stackVec3[ol]=null}z0.stackVec3=Fh}z0.stackVec3[z0.sizeVec3++]=e}}capsule(a,t,r,i){var o=this.p,s=o.sizeVec3==0?new x.common.Vec3:o.stackVec3[--o.sizeVec3],_=this.p,h=_.sizeVec3==0?new x.common.Vec3:_.stackVec3[--_.sizeVec3],v=this.p,e=v.sizeVec3==0?new x.common.Vec3:v.stackVec3[--v.sizeVec3],l=this.p,u=l.sizeVec3==0?new x.common.Vec3:l.stackVec3[--l.sizeVec3],b=this.p,f=b.sizeMat3==0?new x.common.Mat3:b.stackMat3[--b.sizeMat3],n=u;n.x=a._positionX,n.y=a._positionY,n.z=a._positionZ;var c=f;c.e00=a._rotation00,c.e01=a._rotation01,c.e02=a._rotation02,c.e10=a._rotation10,c.e11=a._rotation11,c.e12=a._rotation12,c.e20=a._rotation20,c.e21=a._rotation21,c.e22=a._rotation22,s.init(f.e00,f.e10,f.e20),h.init(f.e01,f.e11,f.e21),e.init(f.e02,f.e12,f.e22);for(var M=4,m=8,y=this.tmpSphereVerts,V=this.tmpSphereNorms,z=0,I=M+1;z<I;)for(var w=z++,X=this.tmpSphereVerts[w].length,L=0,p=X;L<p;){var g=L++,F=V[w][g],S=this.sphereCoords[w][g];F.x=S.x,F.y=S.y,F.z=S.z;var N=F,A=N.x*f.e00+N.y*f.e01+N.z*f.e02,Y=N.x*f.e10+N.y*f.e11+N.z*f.e12,R=N.x*f.e20+N.y*f.e21+N.z*f.e22;N.x=A,N.y=Y,N.z=R}for(var C=0,d=M;C<d;){var Z=C++;if(Z==0)for(var j=M>>1,H=0,E=j+1;H<E;)for(var G=H++,B=this.tmpSphereVerts[G].length,Q=0,W=B;Q<W;){var J=Q++,D=y[G][J],O=V[G][J];D.x=O.x,D.y=O.y,D.z=O.z;var K=D,ra=K.x*t,sa=K.y*t,$=K.z*t;K.x=ra,K.y=sa,K.z=$;var q=K,na=q.x+u.x,oa=q.y+u.y,aa=q.z+u.z;q.x=na,q.y=oa,q.z=aa;var T=q,ca=T.x+h.x*r,_a=T.y+h.y*r,k=T.z+h.z*r;T.x=ca,T.y=_a,T.z=k}if(Z==M>>1)for(var ta=M>>1,ia=ta,la=M+1;ia<la;)for(var va=ia++,xa=this.tmpSphereVerts[va].length,Ma=0,za=xa;Ma<za;){var Xa=Ma++,Za=y[va][Xa],fa=V[va][Xa];Za.x=fa.x,Za.y=fa.y,Za.z=fa.z;var ba=Za,ea=ba.x*t,ha=ba.y*t,pa=ba.z*t;ba.x=ea,ba.y=ha,ba.z=pa;var ya=ba,da=ya.x+u.x,ma=ya.y+u.y,Ya=ya.z+u.z;ya.x=da,ya.y=ma,ya.z=Ya;var Qa=ya,ga=-r,ua=Qa.x+h.x*ga,ka=Qa.y+h.y*ga,wa=Qa.z+h.z*ga;Qa.x=ua,Qa.y=ka,Qa.z=wa}for(var Pa=0,Mt=m;Pa<Mt;){var Oa=Pa++,Ba,nt,Ea,Na,Sa,ft,Wa,Ha;Z==0?this.wireframe?(Ba=y[0][0],nt=y[1][Oa],this.line(Ba,nt,i)):(Ba=y[0][0],nt=y[1][Oa],Ea=y[1][(Oa+1)%m],Sa=V[0][0],ft=V[1][Oa],Wa=V[1][(Oa+1)%m],this.triangle(Ba,nt,Ea,Sa,ft,Wa,i)):Z==M-1?this.wireframe?(Ba=y[M][0],nt=y[Z][(Oa+1)%m],Ea=y[Z][Oa],this.line(Ba,nt,i),this.line(nt,Ea,i)):(Ba=y[M][0],nt=y[Z][(Oa+1)%m],Ea=y[Z][Oa],Sa=V[M][0],ft=V[Z][(Oa+1)%m],Wa=V[Z][Oa],this.triangle(Ba,nt,Ea,Sa,ft,Wa,i)):this.wireframe?(Ba=y[Z][Oa],nt=y[Z][(Oa+1)%m],Ea=y[Z+1][Oa],this.line(Ba,nt,i),this.line(Ba,Ea,i)):(Ba=y[Z][Oa],nt=y[Z][(Oa+1)%m],Ea=y[Z+1][Oa],Na=y[Z+1][(Oa+1)%m],Sa=V[Z][Oa],ft=V[Z][(Oa+1)%m],Wa=V[Z+1][Oa],Ha=V[Z+1][(Oa+1)%m],this.rect(Ba,Ea,Na,nt,Sa,Wa,Ha,ft,i))}}var bt=this.p,rt=bt.sizeVec3==0?new x.common.Vec3:bt.stackVec3[--bt.sizeVec3];rt.x=u.x,rt.y=u.y,rt.z=u.z;var ja=rt,_t=ja.x+h.x*r,gt=ja.y+h.y*r,mt=ja.z+h.z*r;ja.x=_t,ja.y=gt,ja.z=mt;var Ja=ja,it=this.p,ut=it.sizeVec3==0?new x.common.Vec3:it.stackVec3[--it.sizeVec3];ut.x=u.x,ut.y=u.y,ut.z=u.z;var Da=ut,Ta=-r,Fa=Da.x+h.x*Ta,Vt=Da.y+h.y*Ta,Pt=Da.z+h.z*Ta;Da.x=Fa,Da.y=Vt,Da.z=Pt;var et=Da;if(this.wireframe){var Xt=this.p,Yt=Xt.sizeVec3==0?new x.common.Vec3:Xt.stackVec3[--Xt.sizeVec3];Yt.x=Ja.x,Yt.y=Ja.y,Yt.z=Ja.z;var zt=Yt,Ia=-t,U=zt.x+s.x*Ia,Va=zt.y+s.y*Ia,lt=zt.z+s.z*Ia;zt.x=U,zt.y=Va,zt.z=lt;var P=zt,kt=P.x+e.x*0,Bt=P.y+e.y*0,St=P.z+e.z*0;P.x=kt,P.y=Bt,P.z=St;var yt=P,wt=this.p,pt=wt.sizeVec3==0?new x.common.Vec3:wt.stackVec3[--wt.sizeVec3];pt.x=Ja.x,pt.y=Ja.y,pt.z=Ja.z;var ht=pt,xt=ht.x+s.x*t,Ra=ht.y+s.y*t,st=ht.z+s.z*t;ht.x=xt,ht.y=Ra,ht.z=st;var Ca=ht,vt=Ca.x+e.x*0,qa=Ca.y+e.y*0,at=Ca.z+e.z*0;Ca.x=vt,Ca.y=qa,Ca.z=at;var Ua=Ca,tt=this.p,ct=tt.sizeVec3==0?new x.common.Vec3:tt.stackVec3[--tt.sizeVec3];ct.x=Ja.x,ct.y=Ja.y,ct.z=Ja.z;var Aa=ct,Ga=Aa.x+s.x*0,Ka=Aa.y+s.y*0,La=Aa.z+s.z*0;Aa.x=Ga,Aa.y=Ka,Aa.z=La;var ot=Aa,It=-t,or=ot.x+e.x*It,gr=ot.y+e.y*It,ar=ot.z+e.z*It;ot.x=or,ot.y=gr,ot.z=ar;var Ct=ot,_r=this.p,Et=_r.sizeVec3==0?new x.common.Vec3:_r.stackVec3[--_r.sizeVec3];Et.x=Ja.x,Et.y=Ja.y,Et.z=Ja.z;var At=Et,Gt=At.x+s.x*0,Hr=At.y+s.y*0,vr=At.z+s.z*0;At.x=Gt,At.y=Hr,At.z=vr;var lr=At,tr=lr.x+e.x*t,Ur=lr.y+e.y*t,Xr=lr.z+e.z*t;lr.x=tr,lr.y=Ur,lr.z=Xr;var Mr=lr,Zt=this.p,ir=Zt.sizeVec3==0?new x.common.Vec3:Zt.stackVec3[--Zt.sizeVec3];ir.x=et.x,ir.y=et.y,ir.z=et.z;var $t=ir,nr=-t,jr=$t.x+s.x*nr,Wt=$t.y+s.y*nr,Kr=$t.z+s.z*nr;$t.x=jr,$t.y=Wt,$t.z=Kr;var Ir=$t,mi=Ir.x+e.x*0,$r=Ir.y+e.y*0,Lt=Ir.z+e.z*0;Ir.x=mi,Ir.y=$r,Ir.z=Lt;var Kt=Ir,Tt=this.p,br=Tt.sizeVec3==0?new x.common.Vec3:Tt.stackVec3[--Tt.sizeVec3];br.x=et.x,br.y=et.y,br.z=et.z;var zr=br,vi=zr.x+s.x*t,qt=zr.y+s.y*t,fr=zr.z+s.z*t;zr.x=vi,zr.y=qt,zr.z=fr;var dt=zr,ur=dt.x+e.x*0,hr=dt.y+e.y*0,ei=dt.z+e.z*0;dt.x=ur,dt.y=hr,dt.z=ei;var Xi=dt,oo=this.p,Jt=oo.sizeVec3==0?new x.common.Vec3:oo.stackVec3[--oo.sizeVec3];Jt.x=et.x,Jt.y=et.y,Jt.z=et.z;var fi=Jt,pi=fi.x+s.x*0,Dt=fi.y+s.y*0,Bi=fi.z+s.z*0;fi.x=pi,fi.y=Dt,fi.z=Bi;var Ar=fi,Ni=-t,Hn=Ar.x+e.x*Ni,no=Ar.y+e.y*Ni,Si=Ar.z+e.z*Ni;Ar.x=Hn,Ar.y=no,Ar.z=Si;var eo=Ar,gn=this.p,Ao=gn.sizeVec3==0?new x.common.Vec3:gn.stackVec3[--gn.sizeVec3];Ao.x=et.x,Ao.y=et.y,Ao.z=et.z;var Vo=Ao,xr=Vo.x+s.x*0,ao=Vo.y+s.y*0,Ai=Vo.z+s.z*0;Vo.x=xr,Vo.y=ao,Vo.z=Ai;var yi=Vo,Po=yi.x+e.x*t,Dr=yi.y+e.y*t,Pi=yi.z+e.z*t;yi.x=Po,yi.y=Dr,yi.z=Pi;var gi=yi;this.ellipse(Ja,s,e,t,t,i),this.ellipse(et,s,e,t,t,i),this.line(yt,Kt,i),this.line(Ua,Xi,i),this.line(Ct,eo,i),this.line(Mr,gi,i);var Rt=this.p,Or=null,Lr=null,Tn=null;if(yt!=null){if(yt.zero(),Rt.sizeVec3==Rt.stackVec3.length){for(var ms=Rt.sizeVec3<<1,qe=new Array(ms),ps=qe,Re=0,as=Rt.sizeVec3;Re<as;){var N_=Re++;ps[N_]=Rt.stackVec3[N_],Rt.stackVec3[N_]=null}Rt.stackVec3=ps}Rt.stackVec3[Rt.sizeVec3++]=yt}if(Or!=null){var In=1,Pr=0,Go=0,Wi=0,ke=1,nn=0,Rn=0,jn=0,Xe=1;if(Or.e00=In,Or.e01=Pr,Or.e02=Go,Or.e10=Wi,Or.e11=ke,Or.e12=nn,Or.e20=Rn,Or.e21=jn,Or.e22=Xe,Rt.sizeMat3==Rt.stackMat3.length){for(var k_=Rt.sizeMat3<<1,Qe=new Array(k_),Vr=Qe,Ii=0,ui=Rt.sizeMat3;Ii<ui;){var so=Ii++;Vr[so]=Rt.stackMat3[so],Rt.stackMat3[so]=null}Rt.stackMat3=Vr}Rt.stackMat3[Rt.sizeMat3++]=Or}if(Lr!=null){var Qn=1,ys=0,en=0,En=0,cr=0,co=1,Fi=0,Dn=0,ts=0,Ee=0,De=1,Ne=0,ce=0,rr=0,ri=0,Qr=1;if(Lr.e00=Qn,Lr.e01=ys,Lr.e02=en,Lr.e03=En,Lr.e10=cr,Lr.e11=co,Lr.e12=Fi,Lr.e13=Dn,Lr.e20=ts,Lr.e21=Ee,Lr.e22=De,Lr.e23=Ne,Lr.e30=ce,Lr.e31=rr,Lr.e32=ri,Lr.e33=Qr,Rt.sizeMat4==Rt.stackMat4.length){for(var Nr=Rt.sizeMat4<<1,uo=new Array(Nr),Co=uo,__=0,Fe=Rt.sizeMat4;__<Fe;){var rs=__++;Co[rs]=Rt.stackMat4[rs],Rt.stackMat4[rs]=null}Rt.stackMat4=Co}Rt.stackMat4[Rt.sizeMat4++]=Lr}if(Tn!=null){var Nn=0,bo=0,Nt=0,Fr=1;if(Tn.x=Nn,Tn.y=bo,Tn.z=Nt,Tn.w=Fr,Rt.sizeQuat==Rt.stackQuat.length){for(var li=Rt.sizeQuat<<1,wo=new Array(li),be=wo,Le=0,Ye=Rt.sizeQuat;Le<Ye;){var xo=Le++;be[xo]=Rt.stackQuat[xo],Rt.stackQuat[xo]=null}Rt.stackQuat=be}Rt.stackQuat[Rt.sizeQuat++]=Tn}var jt=this.p,Vi=null,si=null,Jo=null;if(Ua!=null){if(Ua.zero(),jt.sizeVec3==jt.stackVec3.length){for(var Gs=jt.sizeVec3<<1,To=new Array(Gs),ko=To,Gi=0,Ci=jt.sizeVec3;Gi<Ci;){var Ti=Gi++;ko[Ti]=jt.stackVec3[Ti],jt.stackVec3[Ti]=null}jt.stackVec3=ko}jt.stackVec3[jt.sizeVec3++]=Ua}if(Vi!=null){var Li=1,Qt=0,Gr=0,Yr=0,Rr=1,Mi=0,qr=0,Ji=0,$i=1;if(Vi.e00=Li,Vi.e01=Qt,Vi.e02=Gr,Vi.e10=Yr,Vi.e11=Rr,Vi.e12=Mi,Vi.e20=qr,Vi.e21=Ji,Vi.e22=$i,jt.sizeMat3==jt.stackMat3.length){for(var to=jt.sizeMat3<<1,fe=new Array(to),wr=fe,sn=0,Yi=jt.sizeMat3;sn<Yi;){var $o=sn++;wr[$o]=jt.stackMat3[$o],jt.stackMat3[$o]=null}jt.stackMat3=wr}jt.stackMat3[jt.sizeMat3++]=Vi}if(si!=null){var gs=1,Vn=0,Is=0,wn=0,Cr=0,Ro=1,_o=0,Fn=0,Ge=0,Gn=0,Wo=1,kn=0,Ze=0,Ut=0,Qo=0,Ui=1;if(si.e00=gs,si.e01=Vn,si.e02=Is,si.e03=wn,si.e10=Cr,si.e11=Ro,si.e12=_o,si.e13=Fn,si.e20=Ge,si.e21=Gn,si.e22=Wo,si.e23=kn,si.e30=Ze,si.e31=Ut,si.e32=Qo,si.e33=Ui,jt.sizeMat4==jt.stackMat4.length){for(var Xn=jt.sizeMat4<<1,Jn=new Array(Xn),ue=Jn,Vs=0,Uo=jt.sizeMat4;Vs<Uo;){var ws=Vs++;ue[ws]=jt.stackMat4[ws],jt.stackMat4[ws]=null}jt.stackMat4=ue}jt.stackMat4[jt.sizeMat4++]=si}if(Jo!=null){var X_=0,Js=0,L_=0,Je=1;if(Jo.x=X_,Jo.y=Js,Jo.z=L_,Jo.w=Je,jt.sizeQuat==jt.stackQuat.length){for(var F_=jt.sizeQuat<<1,G_=new Array(F_),Oi=G_,Xo=0,Lo=jt.sizeQuat;Xo<Lo;){var $n=Xo++;Oi[$n]=jt.stackQuat[$n],jt.stackQuat[$n]=null}jt.stackQuat=Oi}jt.stackQuat[jt.sizeQuat++]=Jo}var kr=this.p,Wn=null,Eo=null,ro=null;if(Ct!=null){if(Ct.zero(),kr.sizeVec3==kr.stackVec3.length){for(var J_=kr.sizeVec3<<1,$_=new Array(J_),Y_=$_,is=0,v_=kr.sizeVec3;is<v_;){var l_=is++;Y_[l_]=kr.stackVec3[l_],kr.stackVec3[l_]=null}kr.stackVec3=Y_}kr.stackVec3[kr.sizeVec3++]=Ct}if(Wn!=null){var os=1,mr=0,Oo=0,ai=0,de=1,$s=0,cv=0,xe=0,$e=1;if(Wn.e00=os,Wn.e01=mr,Wn.e02=Oo,Wn.e10=ai,Wn.e11=de,Wn.e12=$s,Wn.e20=cv,Wn.e21=xe,Wn.e22=$e,kr.sizeMat3==kr.stackMat3.length){for(var Kn=kr.sizeMat3<<1,Ws=new Array(Kn),Tr=Ws,Yo=0,Ri=kr.sizeMat3;Yo<Ri;){var _n=Yo++;Tr[_n]=kr.stackMat3[_n],kr.stackMat3[_n]=null}kr.stackMat3=Tr}kr.stackMat3[kr.sizeMat3++]=Wn}if(Eo!=null){var ks=1,Z_=0,We=0,qn=0,Ln=0,ns=1,Be=0,es=0,Us=0,h_=0,Se=1,Ae=0,ae=0,pr=0,Mo=0,Zi=1;if(Eo.e00=ks,Eo.e01=Z_,Eo.e02=We,Eo.e03=qn,Eo.e10=Ln,Eo.e11=ns,Eo.e12=Be,Eo.e13=es,Eo.e20=Us,Eo.e21=h_,Eo.e22=Se,Eo.e23=Ae,Eo.e30=ae,Eo.e31=pr,Eo.e32=Mo,Eo.e33=Zi,kr.sizeMat4==kr.stackMat4.length){for(var Ho=kr.sizeMat4<<1,Zo=new Array(Ho),Hi=Zo,Do=0,Xs=kr.sizeMat4;Do<Xs;){var te=Do++;Hi[te]=kr.stackMat4[te],kr.stackMat4[te]=null}kr.stackMat4=Hi}kr.stackMat4[kr.sizeMat4++]=Eo}if(ro!=null){var Os=0,W_=0,re=0,Ft=1;if(ro.x=Os,ro.y=W_,ro.z=re,ro.w=Ft,kr.sizeQuat==kr.stackQuat.length){for(var ji=kr.sizeQuat<<1,No=new Array(ji),Ls=No,kv=0,i0=kr.sizeQuat;kv<i0;){var U_=kv++;Ls[U_]=kr.stackQuat[U_],kr.stackQuat[U_]=null}kr.stackQuat=Ls}kr.stackQuat[kr.sizeQuat++]=ro}var Ot=this.p,Yn=null,Qi=null,Zn=null;if(Mr!=null){if(Mr.zero(),Ot.sizeVec3==Ot.stackVec3.length){for(var d_=Ot.sizeVec3<<1,Hs=new Array(d_),c_=Hs,fo=0,ss=Ot.sizeVec3;fo<ss;){var _s=fo++;c_[_s]=Ot.stackVec3[_s],Ot.stackVec3[_s]=null}Ot.stackVec3=c_}Ot.stackVec3[Ot.sizeVec3++]=Mr}if(Yn!=null){var Me=1,Zr=0,jo=0,wi=0,Bo=1,Ue=0,bv=0,ze=0,js=1;if(Yn.e00=Me,Yn.e01=Zr,Yn.e02=jo,Yn.e10=wi,Yn.e11=Bo,Yn.e12=Ue,Yn.e20=bv,Yn.e21=ze,Yn.e22=js,Ot.sizeMat3==Ot.stackMat3.length){for(var Xv=Ot.sizeMat3<<1,Oe=new Array(Xv),er=Oe,dn=0,vn=Ot.sizeMat3;dn<vn;){var ln=dn++;er[ln]=Ot.stackMat3[ln],Ot.stackMat3[ln]=null}Ot.stackMat3=er}Ot.stackMat3[Ot.sizeMat3++]=Yn}if(Qi!=null){var B_=1,fv=0,ie=0,Pe=0,b_=0,O_=1,uv=0,xv=0,f_=0,He=0,zo=1,vs=0,ls=0,Wr=0,mo=0,vo=1;if(Qi.e00=B_,Qi.e01=fv,Qi.e02=ie,Qi.e03=Pe,Qi.e10=b_,Qi.e11=O_,Qi.e12=uv,Qi.e13=xv,Qi.e20=f_,Qi.e21=He,Qi.e22=zo,Qi.e23=vs,Qi.e30=ls,Qi.e31=Wr,Qi.e32=mo,Qi.e33=vo,Ot.sizeMat4==Ot.stackMat4.length){for(var hs=Ot.sizeMat4<<1,Ys=new Array(hs),Zs=Ys,ds=0,S_=Ot.sizeMat4;ds<S_;){var me=ds++;Zs[me]=Ot.stackMat4[me],Ot.stackMat4[me]=null}Ot.stackMat4=Zs}Ot.stackMat4[Ot.sizeMat4++]=Qi}if(Zn!=null){var cs=0,H_=0,Ks=0,Un=1;if(Zn.x=cs,Zn.y=H_,Zn.z=Ks,Zn.w=Un,Ot.sizeQuat==Ot.stackQuat.length){for(var pe=Ot.sizeQuat<<1,Lv=new Array(pe),A_=Lv,Ko=0,hn=Ot.sizeQuat;Ko<hn;){var po=Ko++;A_[po]=Ot.stackQuat[po],Ot.stackQuat[po]=null}Ot.stackQuat=A_}Ot.stackQuat[Ot.sizeQuat++]=Zn}var Ht=this.p,Ki=null,lo=null,qs=null;if(Kt!=null){if(Kt.zero(),Ht.sizeVec3==Ht.stackVec3.length){for(var Bs=Ht.sizeVec3<<1,a_=new Array(Bs),P_=a_,qo=0,oe=Ht.sizeVec3;qo<oe;){var j_=qo++;P_[j_]=Ht.stackVec3[j_],Ht.stackVec3[j_]=null}Ht.stackVec3=P_}Ht.stackVec3[Ht.sizeVec3++]=Kt}if(Ki!=null){var Mv=1,dr=0,yo=0,Ei=0,io=1,K_=0,q_=0,Yv=0,t_=1;if(Ki.e00=Mv,Ki.e01=dr,Ki.e02=yo,Ki.e10=Ei,Ki.e11=io,Ki.e12=K_,Ki.e20=q_,Ki.e21=Yv,Ki.e22=t_,Ht.sizeMat3==Ht.stackMat3.length){for(var Zv=Ht.sizeMat3<<1,av=new Array(Zv),Br=av,tv=0,Ss=Ht.sizeMat3;tv<Ss;){var As=tv++;Br[As]=Ht.stackMat3[As],Ht.stackMat3[As]=null}Ht.stackMat3=Br}Ht.stackMat3[Ht.sizeMat3++]=Ki}if(lo!=null){var bs=1,fs=0,Ps=0,dv=0,ye=0,qi=1,r_=0,go=0,i_=0,Fo=0,Cs=1,an=0,ge=0,sr=0,tn=0,_i=1;if(lo.e00=bs,lo.e01=fs,lo.e02=Ps,lo.e03=dv,lo.e10=ye,lo.e11=qi,lo.e12=r_,lo.e13=go,lo.e20=i_,lo.e21=Fo,lo.e22=Cs,lo.e23=an,lo.e30=ge,lo.e31=sr,lo.e32=tn,lo.e33=_i,Ht.sizeMat4==Ht.stackMat4.length){for(var ne=Ht.sizeMat4<<1,Ie=new Array(ne),So=Ie,Di=0,Bn=Ht.sizeMat4;Di<Bn;){var rv=Di++;So[rv]=Ht.stackMat4[rv],Ht.stackMat4[rv]=null}Ht.stackMat4=So}Ht.stackMat4[Ht.sizeMat4++]=lo}if(qs!=null){var o_=0,C_=0,iv=0,ee=1;if(qs.x=o_,qs.y=C_,qs.z=iv,qs.w=ee,Ht.sizeQuat==Ht.stackQuat.length){for(var Sn=Ht.sizeQuat<<1,Ve=new Array(Sn),D0=Ve,m0=0,cl=Ht.sizeQuat;m0<cl;){var N0=m0++;D0[N0]=Ht.stackQuat[N0],Ht.stackQuat[N0]=null}Ht.stackQuat=D0}Ht.stackQuat[Ht.sizeQuat++]=qs}var hi=this.p,On=null,Io=null,us=null;if(Xi!=null){if(Xi.zero(),hi.sizeVec3==hi.stackVec3.length){for(var ov=hi.sizeVec3<<1,zv=new Array(ov),n_=zv,Bv=0,Ts=hi.sizeVec3;Bv<Ts;){var u_=Bv++;n_[u_]=hi.stackVec3[u_],hi.stackVec3[u_]=null}hi.stackVec3=n_}hi.stackVec3[hi.sizeVec3++]=Xi}if(On!=null){var x_=1,Sr=0,Rs=0,ho=0,Ce=1,mv=0,Qs=0,M_=0,nv=1;if(On.e00=x_,On.e01=Sr,On.e02=Rs,On.e10=ho,On.e11=Ce,On.e12=mv,On.e20=Qs,On.e21=M_,On.e22=nv,hi.sizeMat3==hi.stackMat3.length){for(var o0=hi.sizeMat3<<1,n0=new Array(o0),ev=n0,ti=0,je=hi.sizeMat3;ti<je;){var An=ti++;ev[An]=hi.stackMat3[An],hi.stackMat3[An]=null}hi.stackMat3=ev}hi.stackMat3[hi.sizeMat3++]=On}if(Io!=null){var xs=1,F0=0,Nv=0,T_=0,p0=0,Sv=1,e0=0,y0=0,G0=0,s0=0,_0=1,g0=0,Fv=0,ci=0,pv=0,cn=1;if(Io.e00=xs,Io.e01=F0,Io.e02=Nv,Io.e03=T_,Io.e10=p0,Io.e11=Sv,Io.e12=e0,Io.e13=y0,Io.e20=G0,Io.e21=s0,Io.e22=_0,Io.e23=g0,Io.e30=Fv,Io.e31=ci,Io.e32=pv,Io.e33=cn,hi.sizeMat4==hi.stackMat4.length){for(var Gv=hi.sizeMat4<<1,Hl=new Array(Gv),I0=Hl,V0=0,bl=hi.sizeMat4;V0<bl;){var Bl=V0++;I0[Bl]=hi.stackMat4[Bl],hi.stackMat4[Bl]=null}hi.stackMat4=I0}hi.stackMat4[hi.sizeMat4++]=Io}if(us!=null){var Jv=0,jl=0,Kl=0,fl=1;if(us.x=Jv,us.y=jl,us.z=Kl,us.w=fl,hi.sizeQuat==hi.stackQuat.length){for(var Sl=hi.sizeQuat<<1,Al=new Array(Sl),ql=Al,ul=0,ah=hi.sizeQuat;ul<ah;){var xl=ul++;ql[xl]=hi.stackQuat[xl],hi.stackQuat[xl]=null}hi.stackQuat=ql}hi.stackQuat[hi.sizeQuat++]=us}var ii=this.p,Ms=null,rn=null,yv=null;if(eo!=null){if(eo.zero(),ii.sizeVec3==ii.stackVec3.length){for(var gh=ii.sizeVec3<<1,$v=new Array(gh),J0=$v,Ml=0,w0=ii.sizeVec3;Ml<w0;){var k0=Ml++;J0[k0]=ii.stackVec3[k0],ii.stackVec3[k0]=null}ii.stackVec3=J0}ii.stackVec3[ii.sizeVec3++]=eo}if(Ms!=null){var $0=1,zi=0,zs=0,se=0,v0=1,Pl=0,hh=0,W0=0,ch=1;if(Ms.e00=$0,Ms.e01=zi,Ms.e02=zs,Ms.e10=se,Ms.e11=v0,Ms.e12=Pl,Ms.e20=hh,Ms.e21=W0,Ms.e22=ch,ii.sizeMat3==ii.stackMat3.length){for(var U0=ii.sizeMat3<<1,Cl=new Array(U0),zl=Cl,Te=0,X0=ii.sizeMat3;Te<X0;){var z_=Te++;zl[z_]=ii.stackMat3[z_],ii.stackMat3[z_]=null}ii.stackMat3=zl}ii.stackMat3[ii.sizeMat3++]=Ms}if(rn!=null){var Tl=1,O0=0,H0=0,Rl=0,ml=0,L0=1,l0=0,m_=0,Wv=0,Uv=0,sv=1,Y0=0,Av=0,h0=0,_e=0,c0=1;if(rn.e00=Tl,rn.e01=O0,rn.e02=H0,rn.e03=Rl,rn.e10=ml,rn.e11=L0,rn.e12=l0,rn.e13=m_,rn.e20=Wv,rn.e21=Uv,rn.e22=sv,rn.e23=Y0,rn.e30=Av,rn.e31=h0,rn.e32=_e,rn.e33=c0,ii.sizeMat4==ii.stackMat4.length){for(var Z0=ii.sizeMat4<<1,Es=new Array(Z0),j0=Es,yr=0,bn=ii.sizeMat4;yr<bn;){var ki=yr++;j0[ki]=ii.stackMat4[ki],ii.stackMat4[ki]=null}ii.stackMat4=j0}ii.stackMat4[ii.sizeMat4++]=rn}if(yv!=null){var Ov=0,b0=0,bh=0,th=1;if(yv.x=Ov,yv.y=b0,yv.z=bh,yv.w=th,ii.sizeQuat==ii.stackQuat.length){for(var p_=ii.sizeQuat<<1,Ke=new Array(p_),Ds=Ke,rh=0,fh=ii.sizeQuat;rh<fh;){var Ql=rh++;Ds[Ql]=ii.stackQuat[Ql],ii.stackQuat[Ql]=null}ii.stackQuat=Ds}ii.stackQuat[ii.sizeQuat++]=yv}var bi=this.p,e_=null,fn=null,gv=null;if(gi!=null){if(gi.zero(),bi.sizeVec3==bi.stackVec3.length){for(var K0=bi.sizeVec3<<1,Iv=new Array(K0),pl=Iv,yl=0,gl=bi.sizeVec3;yl<gl;){var R_=yl++;pl[R_]=bi.stackVec3[R_],bi.stackVec3[R_]=null}bi.stackVec3=pl}bi.stackVec3[bi.sizeVec3++]=gi}if(e_!=null){var Pv=1,Pn=0,Vv=0,Cv=0,Q_=1,ve=0,E_=0,Tv=0,Hv=1;if(e_.e00=Pv,e_.e01=Pn,e_.e02=Vv,e_.e10=Cv,e_.e11=Q_,e_.e12=ve,e_.e20=E_,e_.e21=Tv,e_.e22=Hv,bi.sizeMat3==bi.stackMat3.length){for(var oi=bi.sizeMat3<<1,y_=new Array(oi),le=y_,Jr=0,g_=bi.sizeMat3;Jr<g_;){var Cn=Jr++;le[Cn]=bi.stackMat3[Cn],bi.stackMat3[Cn]=null}bi.stackMat3=le}bi.stackMat3[bi.sizeMat3++]=e_}if(fn!=null){var q0=1,f0=0,uh=0,al=0,tl=0,Il=1,d0=0,xh=0,Vl=0,Ih=0,ih=1,wl=0,B0=0,S0=0,kl=0,oh=1;if(fn.e00=q0,fn.e01=f0,fn.e02=uh,fn.e03=al,fn.e10=tl,fn.e11=Il,fn.e12=d0,fn.e13=xh,fn.e20=Vl,fn.e21=Ih,fn.e22=ih,fn.e23=wl,fn.e30=B0,fn.e31=S0,fn.e32=kl,fn.e33=oh,bi.sizeMat4==bi.stackMat4.length){for(var jv=bi.sizeMat4<<1,El=new Array(jv),Kv=El,ni=0,I_=bi.sizeMat4;ni<I_;){var on=ni++;Kv[on]=bi.stackMat4[on],bi.stackMat4[on]=null}bi.stackMat4=Kv}bi.stackMat4[bi.sizeMat4++]=fn}if(gv!=null){var Xl=0,A0=0,nh=0,Dl=1;if(gv.x=Xl,gv.y=A0,gv.z=nh,gv.w=Dl,bi.sizeQuat==bi.stackQuat.length){for(var rl=bi.sizeQuat<<1,Nl=new Array(rl),P0=Nl,eh=0,sh=bi.sizeQuat;eh<sh;){var Fl=eh++;P0[Fl]=bi.stackQuat[Fl],bi.stackQuat[Fl]=null}bi.stackQuat=P0}bi.stackQuat[bi.sizeQuat++]=gv}}else{for(var Gl=0;Gl<8;){var _v=Gl++,Rv=this.tmpCircleNorms[_v],qv=this.circleCoords[_v];Rv.x=qv.x,Rv.y=qv.y,Rv.z=qv.z;var Ns=Rv,Mh=Ns.x*f.e00+Ns.y*f.e01+Ns.z*f.e02,u0=Ns.x*f.e10+Ns.y*f.e11+Ns.z*f.e12,Ll=Ns.x*f.e20+Ns.y*f.e21+Ns.z*f.e22;Ns.x=Mh,Ns.y=u0,Ns.z=Ll;var Qv=this.tmpCircleVerts1[_v],a0=this.tmpCircleNorms[_v];Qv.x=a0.x,Qv.y=a0.y,Qv.z=a0.z;var Ev=Qv,x0=Ev.x*t,dh=Ev.y*t,C0=Ev.z*t;Ev.x=x0,Ev.y=dh,Ev.z=C0;var t0=Ev,Jl=t0.x+u.x,$l=t0.y+u.y,zh=t0.z+u.z;t0.x=Jl,t0.y=$l,t0.z=zh;var Dv=this.tmpCircleVerts2[_v],xi=this.tmpCircleVerts1[_v];Dv.x=xi.x,Dv.y=xi.y,Dv.z=xi.z;var we=this.tmpCircleVerts1[_v],he=we.x+h.x*r,T0=we.y+h.y*r,Wl=we.z+h.z*r;we.x=he,we.y=T0,we.z=Wl;var Fs=this.tmpCircleVerts2[_v],M0=-r,Yl=Fs.x+h.x*M0,Ul=Fs.y+h.y*M0,Ol=Fs.z+h.z*M0;Fs.x=Yl,Fs.y=Ul,Fs.z=Ol}for(var Vh=0;Vh<8;){var vv=Vh++,lv=this.tmpCircleVerts1[vv],R0=this.tmpCircleVerts2[vv],V_=this.tmpCircleVerts2[(vv+1)%8],Zl=this.tmpCircleVerts1[(vv+1)%8],wh=this.tmpCircleNorms[vv],Bh=this.tmpCircleNorms[(vv+1)%8];this.rect(lv,R0,V_,Zl,wh,wh,Bh,Bh,i)}}var r0=this.p;if(Ja!=null){if(Ja.zero(),r0.sizeVec3==r0.stackVec3.length){for(var hv=r0.sizeVec3<<1,kh=new Array(hv),dl=kh,Xh=0,jh=r0.sizeVec3;Xh<jh;){var _h=Xh++;dl[_h]=r0.stackVec3[_h],r0.stackVec3[_h]=null}r0.stackVec3=dl}r0.stackVec3[r0.sizeVec3++]=Ja}var Er=this.p;if(et!=null){if(et.zero(),Er.sizeVec3==Er.stackVec3.length){for(var s_=Er.sizeVec3<<1,w_=new Array(s_),vh=w_,Sh=0,Ah=Er.sizeVec3;Sh<Ah;){var mh=Sh++;vh[mh]=Er.stackVec3[mh],Er.stackVec3[mh]=null}Er.stackVec3=vh}Er.stackVec3[Er.sizeVec3++]=et}var wv=this.p;if(u!=null){if(u.zero(),wv.sizeVec3==wv.stackVec3.length){for(var Qh=wv.sizeVec3<<1,Eh=new Array(Qh),Kh=Eh,qh=0,ph=wv.sizeVec3;qh<ph;){var Ph=qh++;Kh[Ph]=wv.stackVec3[Ph],wv.stackVec3[Ph]=null}wv.stackVec3=Kh}wv.stackVec3[wv.sizeVec3++]=u}var il=this.p;if(f!=null){var ic=1,Lh=0,D_=0,Dh=0,yh=1,ac=0,Yh=0,tc=0,Ch=1;if(f.e00=ic,f.e01=Lh,f.e02=D_,f.e10=Dh,f.e11=yh,f.e12=ac,f.e20=Yh,f.e21=tc,f.e22=Ch,il.sizeMat3==il.stackMat3.length){for(var Q0=il.sizeMat3<<1,oc=new Array(Q0),lh=oc,Zh=0,Nh=il.sizeMat3;Zh<Nh;){var Th=Zh++;lh[Th]=il.stackMat3[Th],il.stackMat3[Th]=null}il.stackMat3=lh}il.stackMat3[il.sizeMat3++]=f}var E0=this.p;if(s!=null){if(s.zero(),E0.sizeVec3==E0.stackVec3.length){for(var z0=E0.sizeVec3<<1,ec=new Array(z0),sc=ec,Fh=0,nc=E0.sizeVec3;Fh<nc;){var rc=Fh++;sc[rc]=E0.stackVec3[rc],E0.stackVec3[rc]=null}E0.stackVec3=sc}E0.stackVec3[E0.sizeVec3++]=s}var ol=this.p;if(h!=null){if(h.zero(),ol.sizeVec3==ol.stackVec3.length){for(var Ic=ol.sizeVec3<<1,Vc=new Array(Ic),mc=Vc,pc=0,wc=ol.sizeVec3;pc<wc;){var _c=pc++;mc[_c]=ol.stackVec3[_c],ol.stackVec3[_c]=null}ol.stackVec3=mc}ol.stackVec3[ol.sizeVec3++]=h}var Rh=this.p;if(e!=null){if(e.zero(),Rh.sizeVec3==Rh.stackVec3.length){for(var kc=Rh.sizeVec3<<1,Mc=new Array(kc),yc=Mc,gc=0,Xc=Rh.sizeVec3;gc<Xc;){var zc=gc++;yc[zc]=Rh.stackVec3[zc],Rh.stackVec3[zc]=null}Rh.stackVec3=yc}Rh.stackVec3[Rh.sizeVec3++]=e}}sphere(a,t,r){var i=this.p,o=i.sizeVec3==0?new x.common.Vec3:i.stackVec3[--i.sizeVec3],s=this.p,_=s.sizeMat3==0?new x.common.Mat3:s.stackMat3[--s.sizeMat3],h=o;h.x=a._positionX,h.y=a._positionY,h.z=a._positionZ;var v=_;v.e00=a._rotation00,v.e01=a._rotation01,v.e02=a._rotation02,v.e10=a._rotation10,v.e11=a._rotation11,v.e12=a._rotation12,v.e20=a._rotation20,v.e21=a._rotation21,v.e22=a._rotation22;for(var e=4,l=8,u=this.tmpSphereVerts,b=this.tmpSphereNorms,f=0,n=e+1;f<n;)for(var c=f++,M=this.tmpSphereVerts[c].length,m=0,y=M;m<y;){var V=m++,z=b[c][V],I=this.sphereCoords[c][V];z.x=I.x,z.y=I.y,z.z=I.z;var w=z,X=w.x*_.e00+w.y*_.e01+w.z*_.e02,L=w.x*_.e10+w.y*_.e11+w.z*_.e12,p=w.x*_.e20+w.y*_.e21+w.z*_.e22;w.x=X,w.y=L,w.z=p;var g=u[c][V],F=b[c][V];g.x=F.x,g.y=F.y,g.z=F.z;var S=g,N=S.x*t,A=S.y*t,Y=S.z*t;S.x=N,S.y=A,S.z=Y;var R=S,C=R.x+o.x,d=R.y+o.y,Z=R.z+o.z;R.x=C,R.y=d,R.z=Z}for(var j=0,H=e;j<H;)for(var E=j++,G=0,B=l;G<B;){var Q=G++,W,J,D,O,K,ra,sa,$;E==0?this.wireframe?(W=u[0][0],J=u[1][Q],this.line(W,J,r)):(W=u[0][0],J=u[1][Q],D=u[1][(Q+1)%l],K=b[0][0],ra=b[1][Q],sa=b[1][(Q+1)%l],this.triangle(W,J,D,K,ra,sa,r)):E==e-1?this.wireframe?(W=u[e][0],J=u[E][(Q+1)%l],D=u[E][Q],this.line(W,J,r),this.line(J,D,r)):(W=u[e][0],J=u[E][(Q+1)%l],D=u[E][Q],K=b[e][0],ra=b[E][(Q+1)%l],sa=b[E][Q],this.triangle(W,J,D,K,ra,sa,r)):this.wireframe?(W=u[E][Q],J=u[E][(Q+1)%l],D=u[E+1][Q],this.line(W,J,r),this.line(W,D,r)):(W=u[E][Q],J=u[E][(Q+1)%l],D=u[E+1][Q],O=u[E+1][(Q+1)%l],K=b[E][Q],ra=b[E][(Q+1)%l],sa=b[E+1][Q],$=b[E+1][(Q+1)%l],this.rect(W,D,O,J,K,sa,$,ra,r))}var q=this.p;if(o!=null){if(o.zero(),q.sizeVec3==q.stackVec3.length){for(var na=q.sizeVec3<<1,oa=new Array(na),aa=oa,T=0,ca=q.sizeVec3;T<ca;){var _a=T++;aa[_a]=q.stackVec3[_a],q.stackVec3[_a]=null}q.stackVec3=aa}q.stackVec3[q.sizeVec3++]=o}var k=this.p;if(_!=null){var ta=1,ia=0,la=0,va=0,xa=1,Ma=0,za=0,Xa=0,Za=1;if(_.e00=ta,_.e01=ia,_.e02=la,_.e10=va,_.e11=xa,_.e12=Ma,_.e20=za,_.e21=Xa,_.e22=Za,k.sizeMat3==k.stackMat3.length){for(var fa=k.sizeMat3<<1,ba=new Array(fa),ea=ba,ha=0,pa=k.sizeMat3;ha<pa;){var ya=ha++;ea[ya]=k.stackMat3[ya],k.stackMat3[ya]=null}k.stackMat3=ea}k.stackMat3[k.sizeMat3++]=_}}box(a,t,r){var i=this.p,o=i.sizeVec3==0?new x.common.Vec3:i.stackVec3[--i.sizeVec3],s=this.p,_=s.sizeVec3==0?new x.common.Vec3:s.stackVec3[--s.sizeVec3],h=this.p,v=h.sizeVec3==0?new x.common.Vec3:h.stackVec3[--h.sizeVec3],e=this.p,l=e.sizeVec3==0?new x.common.Vec3:e.stackVec3[--e.sizeVec3],u=this.p,b=u.sizeMat3==0?new x.common.Mat3:u.stackMat3[--u.sizeMat3],f=l;f.x=a._positionX,f.y=a._positionY,f.z=a._positionZ;var n=b;n.e00=a._rotation00,n.e01=a._rotation01,n.e02=a._rotation02,n.e10=a._rotation10,n.e11=a._rotation11,n.e12=a._rotation12,n.e20=a._rotation20,n.e21=a._rotation21,n.e22=a._rotation22,o.init(b.e00,b.e10,b.e20),_.init(b.e01,b.e11,b.e21),v.init(b.e02,b.e12,b.e22);var c=t.x,M=t.y,m=t.z,y=this.p,V=y.sizeVec3==0?new x.common.Vec3:y.stackVec3[--y.sizeVec3];V.x=l.x,V.y=l.y,V.z=l.z;var z=V,I=-c,w=z.x+o.x*I,X=z.y+o.y*I,L=z.z+o.z*I;z.x=w,z.y=X,z.z=L;var p=z,g=-M,F=p.x+_.x*g,S=p.y+_.y*g,N=p.z+_.z*g;p.x=F,p.y=S,p.z=N;var A=p,Y=-m,R=A.x+v.x*Y,C=A.y+v.y*Y,d=A.z+v.z*Y;A.x=R,A.y=C,A.z=d;var Z=A,j=this.p,H=j.sizeVec3==0?new x.common.Vec3:j.stackVec3[--j.sizeVec3];H.x=l.x,H.y=l.y,H.z=l.z;var E=H,G=-c,B=E.x+o.x*G,Q=E.y+o.y*G,W=E.z+o.z*G;E.x=B,E.y=Q,E.z=W;var J=E,D=-M,O=J.x+_.x*D,K=J.y+_.y*D,ra=J.z+_.z*D;J.x=O,J.y=K,J.z=ra;var sa=J,$=sa.x+v.x*m,q=sa.y+v.y*m,na=sa.z+v.z*m;sa.x=$,sa.y=q,sa.z=na;var oa=sa,aa=this.p,T=aa.sizeVec3==0?new x.common.Vec3:aa.stackVec3[--aa.sizeVec3];T.x=l.x,T.y=l.y,T.z=l.z;var ca=T,_a=-c,k=ca.x+o.x*_a,ta=ca.y+o.y*_a,ia=ca.z+o.z*_a;ca.x=k,ca.y=ta,ca.z=ia;var la=ca,va=la.x+_.x*M,xa=la.y+_.y*M,Ma=la.z+_.z*M;la.x=va,la.y=xa,la.z=Ma;var za=la,Xa=-m,Za=za.x+v.x*Xa,fa=za.y+v.y*Xa,ba=za.z+v.z*Xa;za.x=Za,za.y=fa,za.z=ba;var ea=za,ha=this.p,pa=ha.sizeVec3==0?new x.common.Vec3:ha.stackVec3[--ha.sizeVec3];pa.x=l.x,pa.y=l.y,pa.z=l.z;var ya=pa,da=-c,ma=ya.x+o.x*da,Ya=ya.y+o.y*da,Qa=ya.z+o.z*da;ya.x=ma,ya.y=Ya,ya.z=Qa;var ga=ya,ua=ga.x+_.x*M,ka=ga.y+_.y*M,wa=ga.z+_.z*M;ga.x=ua,ga.y=ka,ga.z=wa;var Pa=ga,Mt=Pa.x+v.x*m,Oa=Pa.y+v.y*m,Ba=Pa.z+v.z*m;Pa.x=Mt,Pa.y=Oa,Pa.z=Ba;var nt=Pa,Ea=this.p,Na=Ea.sizeVec3==0?new x.common.Vec3:Ea.stackVec3[--Ea.sizeVec3];Na.x=l.x,Na.y=l.y,Na.z=l.z;var Sa=Na,ft=Sa.x+o.x*c,Wa=Sa.y+o.y*c,Ha=Sa.z+o.z*c;Sa.x=ft,Sa.y=Wa,Sa.z=Ha;var bt=Sa,rt=-M,ja=bt.x+_.x*rt,_t=bt.y+_.y*rt,gt=bt.z+_.z*rt;bt.x=ja,bt.y=_t,bt.z=gt;var mt=bt,Ja=-m,it=mt.x+v.x*Ja,ut=mt.y+v.y*Ja,Da=mt.z+v.z*Ja;mt.x=it,mt.y=ut,mt.z=Da;var Ta=mt,Fa=this.p,Vt=Fa.sizeVec3==0?new x.common.Vec3:Fa.stackVec3[--Fa.sizeVec3];Vt.x=l.x,Vt.y=l.y,Vt.z=l.z;var Pt=Vt,et=Pt.x+o.x*c,Xt=Pt.y+o.y*c,Yt=Pt.z+o.z*c;Pt.x=et,Pt.y=Xt,Pt.z=Yt;var zt=Pt,Ia=-M,U=zt.x+_.x*Ia,Va=zt.y+_.y*Ia,lt=zt.z+_.z*Ia;zt.x=U,zt.y=Va,zt.z=lt;var P=zt,kt=P.x+v.x*m,Bt=P.y+v.y*m,St=P.z+v.z*m;P.x=kt,P.y=Bt,P.z=St;var yt=P,wt=this.p,pt=wt.sizeVec3==0?new x.common.Vec3:wt.stackVec3[--wt.sizeVec3];pt.x=l.x,pt.y=l.y,pt.z=l.z;var ht=pt,xt=ht.x+o.x*c,Ra=ht.y+o.y*c,st=ht.z+o.z*c;ht.x=xt,ht.y=Ra,ht.z=st;var Ca=ht,vt=Ca.x+_.x*M,qa=Ca.y+_.y*M,at=Ca.z+_.z*M;Ca.x=vt,Ca.y=qa,Ca.z=at;var Ua=Ca,tt=-m,ct=Ua.x+v.x*tt,Aa=Ua.y+v.y*tt,Ga=Ua.z+v.z*tt;Ua.x=ct,Ua.y=Aa,Ua.z=Ga;var Ka=Ua,La=this.p,ot=La.sizeVec3==0?new x.common.Vec3:La.stackVec3[--La.sizeVec3];ot.x=l.x,ot.y=l.y,ot.z=l.z;var It=ot,or=It.x+o.x*c,gr=It.y+o.y*c,ar=It.z+o.z*c;It.x=or,It.y=gr,It.z=ar;var Ct=It,_r=Ct.x+_.x*M,Et=Ct.y+_.y*M,At=Ct.z+_.z*M;Ct.x=_r,Ct.y=Et,Ct.z=At;var Gt=Ct,Hr=Gt.x+v.x*m,vr=Gt.y+v.y*m,lr=Gt.z+v.z*m;Gt.x=Hr,Gt.y=vr,Gt.z=lr;var tr=Gt;if(this.wireframe)this.line(Z,oa,r),this.line(ea,nt,r),this.line(Ta,yt,r),this.line(Ka,tr,r),this.line(Z,ea,r),this.line(oa,nt,r),this.line(Ta,Ka,r),this.line(yt,tr,r),this.line(Z,Ta,r),this.line(oa,yt,r),this.line(ea,Ka,r),this.line(nt,tr,r);else{var Ur=this.p,Xr=Ur.sizeVec3==0?new x.common.Vec3:Ur.stackVec3[--Ur.sizeVec3];Xr.x=o.x,Xr.y=o.y,Xr.z=o.z;var Mr=Xr,Zt=-Mr.x,ir=-Mr.y,$t=-Mr.z;Mr.x=Zt,Mr.y=ir,Mr.z=$t;var nr=Mr,jr=this.p,Wt=jr.sizeVec3==0?new x.common.Vec3:jr.stackVec3[--jr.sizeVec3];Wt.x=_.x,Wt.y=_.y,Wt.z=_.z;var Kr=Wt,Ir=-Kr.x,mi=-Kr.y,$r=-Kr.z;Kr.x=Ir,Kr.y=mi,Kr.z=$r;var Lt=Kr,Kt=this.p,Tt=Kt.sizeVec3==0?new x.common.Vec3:Kt.stackVec3[--Kt.sizeVec3];Tt.x=v.x,Tt.y=v.y,Tt.z=v.z;var br=Tt,zr=-br.x,vi=-br.y,qt=-br.z;br.x=zr,br.y=vi,br.z=qt;var fr=br;this.rect(Z,oa,nt,ea,nr,nr,nr,nr,r),this.rect(Ta,Ka,tr,yt,o,o,o,o,r),this.rect(Z,Ta,yt,oa,Lt,Lt,Lt,Lt,r),this.rect(ea,nt,tr,Ka,_,_,_,_,r),this.rect(Z,ea,Ka,Ta,fr,fr,fr,fr,r),this.rect(oa,yt,tr,nt,v,v,v,v,r);var dt=this.p,ur=null,hr=null,ei=null;if(nr!=null){if(nr.zero(),dt.sizeVec3==dt.stackVec3.length){for(var Xi=dt.sizeVec3<<1,oo=new Array(Xi),Jt=oo,fi=0,pi=dt.sizeVec3;fi<pi;){var Dt=fi++;Jt[Dt]=dt.stackVec3[Dt],dt.stackVec3[Dt]=null}dt.stackVec3=Jt}dt.stackVec3[dt.sizeVec3++]=nr}if(ur!=null){var Bi=1,Ar=0,Ni=0,Hn=0,no=1,Si=0,eo=0,gn=0,Ao=1;if(ur.e00=Bi,ur.e01=Ar,ur.e02=Ni,ur.e10=Hn,ur.e11=no,ur.e12=Si,ur.e20=eo,ur.e21=gn,ur.e22=Ao,dt.sizeMat3==dt.stackMat3.length){for(var Vo=dt.sizeMat3<<1,xr=new Array(Vo),ao=xr,Ai=0,yi=dt.sizeMat3;Ai<yi;){var Po=Ai++;ao[Po]=dt.stackMat3[Po],dt.stackMat3[Po]=null}dt.stackMat3=ao}dt.stackMat3[dt.sizeMat3++]=ur}if(hr!=null){var Dr=1,Pi=0,gi=0,Rt=0,Or=0,Lr=1,Tn=0,ms=0,qe=0,ps=0,Re=1,as=0,N_=0,In=0,Pr=0,Go=1;if(hr.e00=Dr,hr.e01=Pi,hr.e02=gi,hr.e03=Rt,hr.e10=Or,hr.e11=Lr,hr.e12=Tn,hr.e13=ms,hr.e20=qe,hr.e21=ps,hr.e22=Re,hr.e23=as,hr.e30=N_,hr.e31=In,hr.e32=Pr,hr.e33=Go,dt.sizeMat4==dt.stackMat4.length){for(var Wi=dt.sizeMat4<<1,ke=new Array(Wi),nn=ke,Rn=0,jn=dt.sizeMat4;Rn<jn;){var Xe=Rn++;nn[Xe]=dt.stackMat4[Xe],dt.stackMat4[Xe]=null}dt.stackMat4=nn}dt.stackMat4[dt.sizeMat4++]=hr}if(ei!=null){var k_=0,Qe=0,Vr=0,Ii=1;if(ei.x=k_,ei.y=Qe,ei.z=Vr,ei.w=Ii,dt.sizeQuat==dt.stackQuat.length){for(var ui=dt.sizeQuat<<1,so=new Array(ui),Qn=so,ys=0,en=dt.sizeQuat;ys<en;){var En=ys++;Qn[En]=dt.stackQuat[En],dt.stackQuat[En]=null}dt.stackQuat=Qn}dt.stackQuat[dt.sizeQuat++]=ei}var cr=this.p,co=null,Fi=null,Dn=null;if(Lt!=null){if(Lt.zero(),cr.sizeVec3==cr.stackVec3.length){for(var ts=cr.sizeVec3<<1,Ee=new Array(ts),De=Ee,Ne=0,ce=cr.sizeVec3;Ne<ce;){var rr=Ne++;De[rr]=cr.stackVec3[rr],cr.stackVec3[rr]=null}cr.stackVec3=De}cr.stackVec3[cr.sizeVec3++]=Lt}if(co!=null){var ri=1,Qr=0,Nr=0,uo=0,Co=1,__=0,Fe=0,rs=0,Nn=1;if(co.e00=ri,co.e01=Qr,co.e02=Nr,co.e10=uo,co.e11=Co,co.e12=__,co.e20=Fe,co.e21=rs,co.e22=Nn,cr.sizeMat3==cr.stackMat3.length){for(var bo=cr.sizeMat3<<1,Nt=new Array(bo),Fr=Nt,li=0,wo=cr.sizeMat3;li<wo;){var be=li++;Fr[be]=cr.stackMat3[be],cr.stackMat3[be]=null}cr.stackMat3=Fr}cr.stackMat3[cr.sizeMat3++]=co}if(Fi!=null){var Le=1,Ye=0,xo=0,jt=0,Vi=0,si=1,Jo=0,Gs=0,To=0,ko=0,Gi=1,Ci=0,Ti=0,Li=0,Qt=0,Gr=1;if(Fi.e00=Le,Fi.e01=Ye,Fi.e02=xo,Fi.e03=jt,Fi.e10=Vi,Fi.e11=si,Fi.e12=Jo,Fi.e13=Gs,Fi.e20=To,Fi.e21=ko,Fi.e22=Gi,Fi.e23=Ci,Fi.e30=Ti,Fi.e31=Li,Fi.e32=Qt,Fi.e33=Gr,cr.sizeMat4==cr.stackMat4.length){for(var Yr=cr.sizeMat4<<1,Rr=new Array(Yr),Mi=Rr,qr=0,Ji=cr.sizeMat4;qr<Ji;){var $i=qr++;Mi[$i]=cr.stackMat4[$i],cr.stackMat4[$i]=null}cr.stackMat4=Mi}cr.stackMat4[cr.sizeMat4++]=Fi}if(Dn!=null){var to=0,fe=0,wr=0,sn=1;if(Dn.x=to,Dn.y=fe,Dn.z=wr,Dn.w=sn,cr.sizeQuat==cr.stackQuat.length){for(var Yi=cr.sizeQuat<<1,$o=new Array(Yi),gs=$o,Vn=0,Is=cr.sizeQuat;Vn<Is;){var wn=Vn++;gs[wn]=cr.stackQuat[wn],cr.stackQuat[wn]=null}cr.stackQuat=gs}cr.stackQuat[cr.sizeQuat++]=Dn}var Cr=this.p,Ro=null,_o=null,Fn=null;if(fr!=null){if(fr.zero(),Cr.sizeVec3==Cr.stackVec3.length){for(var Ge=Cr.sizeVec3<<1,Gn=new Array(Ge),Wo=Gn,kn=0,Ze=Cr.sizeVec3;kn<Ze;){var Ut=kn++;Wo[Ut]=Cr.stackVec3[Ut],Cr.stackVec3[Ut]=null}Cr.stackVec3=Wo}Cr.stackVec3[Cr.sizeVec3++]=fr}if(Ro!=null){var Qo=1,Ui=0,Xn=0,Jn=0,ue=1,Vs=0,Uo=0,ws=0,X_=1;if(Ro.e00=Qo,Ro.e01=Ui,Ro.e02=Xn,Ro.e10=Jn,Ro.e11=ue,Ro.e12=Vs,Ro.e20=Uo,Ro.e21=ws,Ro.e22=X_,Cr.sizeMat3==Cr.stackMat3.length){for(var Js=Cr.sizeMat3<<1,L_=new Array(Js),Je=L_,F_=0,G_=Cr.sizeMat3;F_<G_;){var Oi=F_++;Je[Oi]=Cr.stackMat3[Oi],Cr.stackMat3[Oi]=null}Cr.stackMat3=Je}Cr.stackMat3[Cr.sizeMat3++]=Ro}if(_o!=null){var Xo=1,Lo=0,$n=0,kr=0,Wn=0,Eo=1,ro=0,J_=0,$_=0,Y_=0,is=1,v_=0,l_=0,os=0,mr=0,Oo=1;if(_o.e00=Xo,_o.e01=Lo,_o.e02=$n,_o.e03=kr,_o.e10=Wn,_o.e11=Eo,_o.e12=ro,_o.e13=J_,_o.e20=$_,_o.e21=Y_,_o.e22=is,_o.e23=v_,_o.e30=l_,_o.e31=os,_o.e32=mr,_o.e33=Oo,Cr.sizeMat4==Cr.stackMat4.length){for(var ai=Cr.sizeMat4<<1,de=new Array(ai),$s=de,cv=0,xe=Cr.sizeMat4;cv<xe;){var $e=cv++;$s[$e]=Cr.stackMat4[$e],Cr.stackMat4[$e]=null}Cr.stackMat4=$s}Cr.stackMat4[Cr.sizeMat4++]=_o}if(Fn!=null){var Kn=0,Ws=0,Tr=0,Yo=1;if(Fn.x=Kn,Fn.y=Ws,Fn.z=Tr,Fn.w=Yo,Cr.sizeQuat==Cr.stackQuat.length){for(var Ri=Cr.sizeQuat<<1,_n=new Array(Ri),ks=_n,Z_=0,We=Cr.sizeQuat;Z_<We;){var qn=Z_++;ks[qn]=Cr.stackQuat[qn],Cr.stackQuat[qn]=null}Cr.stackQuat=ks}Cr.stackQuat[Cr.sizeQuat++]=Fn}}var Ln=this.p;if(Z!=null){if(Z.zero(),Ln.sizeVec3==Ln.stackVec3.length){for(var ns=Ln.sizeVec3<<1,Be=new Array(ns),es=Be,Us=0,h_=Ln.sizeVec3;Us<h_;){var Se=Us++;es[Se]=Ln.stackVec3[Se],Ln.stackVec3[Se]=null}Ln.stackVec3=es}Ln.stackVec3[Ln.sizeVec3++]=Z}var Ae=this.p;if(oa!=null){if(oa.zero(),Ae.sizeVec3==Ae.stackVec3.length){for(var ae=Ae.sizeVec3<<1,pr=new Array(ae),Mo=pr,Zi=0,Ho=Ae.sizeVec3;Zi<Ho;){var Zo=Zi++;Mo[Zo]=Ae.stackVec3[Zo],Ae.stackVec3[Zo]=null}Ae.stackVec3=Mo}Ae.stackVec3[Ae.sizeVec3++]=oa}var Hi=this.p;if(ea!=null){if(ea.zero(),Hi.sizeVec3==Hi.stackVec3.length){for(var Do=Hi.sizeVec3<<1,Xs=new Array(Do),te=Xs,Os=0,W_=Hi.sizeVec3;Os<W_;){var re=Os++;te[re]=Hi.stackVec3[re],Hi.stackVec3[re]=null}Hi.stackVec3=te}Hi.stackVec3[Hi.sizeVec3++]=ea}var Ft=this.p;if(nt!=null){if(nt.zero(),Ft.sizeVec3==Ft.stackVec3.length){for(var ji=Ft.sizeVec3<<1,No=new Array(ji),Ls=No,kv=0,i0=Ft.sizeVec3;kv<i0;){var U_=kv++;Ls[U_]=Ft.stackVec3[U_],Ft.stackVec3[U_]=null}Ft.stackVec3=Ls}Ft.stackVec3[Ft.sizeVec3++]=nt}var Ot=this.p;if(Ta!=null){if(Ta.zero(),Ot.sizeVec3==Ot.stackVec3.length){for(var Yn=Ot.sizeVec3<<1,Qi=new Array(Yn),Zn=Qi,d_=0,Hs=Ot.sizeVec3;d_<Hs;){var c_=d_++;Zn[c_]=Ot.stackVec3[c_],Ot.stackVec3[c_]=null}Ot.stackVec3=Zn}Ot.stackVec3[Ot.sizeVec3++]=Ta}var fo=this.p;if(yt!=null){if(yt.zero(),fo.sizeVec3==fo.stackVec3.length){for(var ss=fo.sizeVec3<<1,_s=new Array(ss),Me=_s,Zr=0,jo=fo.sizeVec3;Zr<jo;){var wi=Zr++;Me[wi]=fo.stackVec3[wi],fo.stackVec3[wi]=null}fo.stackVec3=Me}fo.stackVec3[fo.sizeVec3++]=yt}var Bo=this.p;if(Ka!=null){if(Ka.zero(),Bo.sizeVec3==Bo.stackVec3.length){for(var Ue=Bo.sizeVec3<<1,bv=new Array(Ue),ze=bv,js=0,Xv=Bo.sizeVec3;js<Xv;){var Oe=js++;ze[Oe]=Bo.stackVec3[Oe],Bo.stackVec3[Oe]=null}Bo.stackVec3=ze}Bo.stackVec3[Bo.sizeVec3++]=Ka}var er=this.p;if(tr!=null){if(tr.zero(),er.sizeVec3==er.stackVec3.length){for(var dn=er.sizeVec3<<1,vn=new Array(dn),ln=vn,B_=0,fv=er.sizeVec3;B_<fv;){var ie=B_++;ln[ie]=er.stackVec3[ie],er.stackVec3[ie]=null}er.stackVec3=ln}er.stackVec3[er.sizeVec3++]=tr}var Pe=this.p;if(l!=null){if(l.zero(),Pe.sizeVec3==Pe.stackVec3.length){for(var b_=Pe.sizeVec3<<1,O_=new Array(b_),uv=O_,xv=0,f_=Pe.sizeVec3;xv<f_;){var He=xv++;uv[He]=Pe.stackVec3[He],Pe.stackVec3[He]=null}Pe.stackVec3=uv}Pe.stackVec3[Pe.sizeVec3++]=l}var zo=this.p;if(b!=null){var vs=1,ls=0,Wr=0,mo=0,vo=1,hs=0,Ys=0,Zs=0,ds=1;if(b.e00=vs,b.e01=ls,b.e02=Wr,b.e10=mo,b.e11=vo,b.e12=hs,b.e20=Ys,b.e21=Zs,b.e22=ds,zo.sizeMat3==zo.stackMat3.length){for(var S_=zo.sizeMat3<<1,me=new Array(S_),cs=me,H_=0,Ks=zo.sizeMat3;H_<Ks;){var Un=H_++;cs[Un]=zo.stackMat3[Un],zo.stackMat3[Un]=null}zo.stackMat3=cs}zo.stackMat3[zo.sizeMat3++]=b}var pe=this.p;if(o!=null){if(o.zero(),pe.sizeVec3==pe.stackVec3.length){for(var Lv=pe.sizeVec3<<1,A_=new Array(Lv),Ko=A_,hn=0,po=pe.sizeVec3;hn<po;){var Ht=hn++;Ko[Ht]=pe.stackVec3[Ht],pe.stackVec3[Ht]=null}pe.stackVec3=Ko}pe.stackVec3[pe.sizeVec3++]=o}var Ki=this.p;if(_!=null){if(_.zero(),Ki.sizeVec3==Ki.stackVec3.length){for(var lo=Ki.sizeVec3<<1,qs=new Array(lo),Bs=qs,a_=0,P_=Ki.sizeVec3;a_<P_;){var qo=a_++;Bs[qo]=Ki.stackVec3[qo],Ki.stackVec3[qo]=null}Ki.stackVec3=Bs}Ki.stackVec3[Ki.sizeVec3++]=_}var oe=this.p;if(v!=null){if(v.zero(),oe.sizeVec3==oe.stackVec3.length){for(var j_=oe.sizeVec3<<1,Mv=new Array(j_),dr=Mv,yo=0,Ei=oe.sizeVec3;yo<Ei;){var io=yo++;dr[io]=oe.stackVec3[io],oe.stackVec3[io]=null}oe.stackVec3=dr}oe.stackVec3[oe.sizeVec3++]=v}}rect(a,t,r,i,o,s,_,h,v){this.triangle(a,t,r,o,s,_,v),this.triangle(a,r,i,o,_,h,v)}point(a,t){}triangle(a,t,r,i,o,s,_){}line(a,t,r){}};x.dynamics.common.DebugDrawStyle=class{constructor(){this.basisColorZ=new x.common.Vec3(0,0,1),this.basisColorY=new x.common.Vec3(0,1,0),this.basisColorX=new x.common.Vec3(1,0,0),this.basisLength=.5,this.jointRotationalConstraintRadius=.3,this.jointErrorColor=new x.common.Vec3(1,.1,.1),this.jointLineColor=new x.common.Vec3(.8,.8,.8),this.contactBinormalLength=.5,this.contactTangentLength=.5,this.contactNormalLength=.5,this.contactBinormalColor=new x.common.Vec3(.2,.2,1),this.contactTangentColor=new x.common.Vec3(.1,.8,.1),this.contactNormalColor=new x.common.Vec3(1,.1,.1),this.disabledContactColor=new x.common.Vec3(.5,.1,.1),this.newContactColor=new x.common.Vec3(1,1,.1),this.contactColor4=new x.common.Vec3(.8,.1,1),this.contactColor3=new x.common.Vec3(.1,.8,.6),this.contactColor2=new x.common.Vec3(1,.6,.1),this.contactColor=new x.common.Vec3(1,.1,.1),this.pairColor=new x.common.Vec3(1,1,.1),this.bvhNodeColor=new x.common.Vec3(.4,.4,.4),this.aabbColor=new x.common.Vec3(1,.1,.1),this.kinematicShapeColor=new x.common.Vec3(1,.5,.1),this.staticShapeColor=new x.common.Vec3(.7,.7,.7),this.sleepingShapeColor2=new x.common.Vec3(.2,.8,.5),this.sleepingShapeColor1=new x.common.Vec3(.3,.3,.8),this.sleepyShapeColor2=new x.common.Vec3(.6,.8,.3),this.sleepyShapeColor1=new x.common.Vec3(.5,.25,.6),this.shapeColor2=new x.common.Vec3(1,.8,.1),this.shapeColor1=new x.common.Vec3(.7,.2,.4)}};x.dynamics.common.Performance=class{};x.dynamics.constraint||(x.dynamics.constraint={});x.dynamics.constraint.ConstraintSolver=class{constructor(){this._b1=null,this._b2=null,this._addedToIsland=!1}preSolveVelocity(a){}warmStart(a){}solveVelocity(){}postSolveVelocity(a){}preSolvePosition(a){}solvePositionSplitImpulse(){}solvePositionNgs(a){}postSolve(){}};x.dynamics.constraint.PositionCorrectionAlgorithm=class{};x.dynamics.constraint.contact||(x.dynamics.constraint.contact={});x.dynamics.constraint.contact.ContactConstraint=class{constructor(a){this._solver=new x.dynamics.constraint.solver.pgs.PgsContactConstraintSolver(this),this._manifold=a}_getVelocitySolverInfo(a,t){t.b1=this._b1,t.b2=this._b2;var r,i,o,s,_,h,v,e,l;r=this._manifold._normalX,i=this._manifold._normalY,o=this._manifold._normalZ,s=this._manifold._tangentX,_=this._manifold._tangentY,h=this._manifold._tangentZ,v=this._manifold._binormalX,e=this._manifold._binormalY,l=this._manifold._binormalZ;var u=Math.sqrt(this._s1._friction*this._s2._friction),b=Math.sqrt(this._s1._restitution*this._s2._restitution),f=this._manifold._numPoints;t.numRows=0,this._tf1._positionX-this._tf2._positionX,this._tf1._positionY-this._tf2._positionY,this._tf1._positionZ-this._tf2._positionZ;for(var n=0,c=f;n<c;){var M=n++,m=this._manifold._points[M];if(m._depth<0){m._disabled=!0;var y=m._impulse;y.impulseN=0,y.impulseT=0,y.impulseB=0,y.impulseP=0,y.impulseLX=0,y.impulseLY=0,y.impulseLZ=0;continue}else m._disabled=!1;var V=t.rows[t.numRows++];V.friction=u,V.cfm=0;var z=V.jacobianN;z.lin1X=r,z.lin1Y=i,z.lin1Z=o,z.lin2X=r,z.lin2Y=i,z.lin2Z=o,z.ang1X=m._relPos1Y*o-m._relPos1Z*i,z.ang1Y=m._relPos1Z*r-m._relPos1X*o,z.ang1Z=m._relPos1X*i-m._relPos1Y*r,z.ang2X=m._relPos2Y*o-m._relPos2Z*i,z.ang2Y=m._relPos2Z*r-m._relPos2X*o,z.ang2Z=m._relPos2X*i-m._relPos2Y*r,z=V.jacobianT,z.lin1X=s,z.lin1Y=_,z.lin1Z=h,z.lin2X=s,z.lin2Y=_,z.lin2Z=h,z.ang1X=m._relPos1Y*h-m._relPos1Z*_,z.ang1Y=m._relPos1Z*s-m._relPos1X*h,z.ang1Z=m._relPos1X*_-m._relPos1Y*s,z.ang2X=m._relPos2Y*h-m._relPos2Z*_,z.ang2Y=m._relPos2Z*s-m._relPos2X*h,z.ang2Z=m._relPos2X*_-m._relPos2Y*s,z=V.jacobianB,z.lin1X=v,z.lin1Y=e,z.lin1Z=l,z.lin2X=v,z.lin2Y=e,z.lin2Z=l,z.ang1X=m._relPos1Y*l-m._relPos1Z*e,z.ang1Y=m._relPos1Z*v-m._relPos1X*l,z.ang1Z=m._relPos1X*e-m._relPos1Y*v,z.ang2X=m._relPos2Y*l-m._relPos2Z*e,z.ang2Y=m._relPos2Z*v-m._relPos2X*l,z.ang2Z=m._relPos2X*e-m._relPos2Y*v,z=V.jacobianN;var I=z.lin1X*this._b1._velX+z.lin1Y*this._b1._velY+z.lin1Z*this._b1._velZ+(z.ang1X*this._b1._angVelX+z.ang1Y*this._b1._angVelY+z.ang1Z*this._b1._angVelZ)-(z.lin2X*this._b2._velX+z.lin2Y*this._b2._velY+z.lin2Z*this._b2._velZ+(z.ang2X*this._b2._angVelX+z.ang2Y*this._b2._angVelY+z.ang2Z*this._b2._angVelZ));if(I<-x.common.Setting.contactEnableBounceThreshold&&!m._warmStarted?V.rhs=-I*b:V.rhs=0,this._positionCorrectionAlgorithm==x.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE&&m._depth>x.common.Setting.linearSlop){var w=(m._depth-x.common.Setting.linearSlop)*x.common.Setting.velocityBaumgarte*a.invDt;V.rhs<w&&(V.rhs=w)}if(!m._warmStarted){var X=m._impulse;X.impulseN=0,X.impulseT=0,X.impulseB=0,X.impulseP=0,X.impulseLX=0,X.impulseLY=0,X.impulseLZ=0}V.impulse=m._impulse}}_getPositionSolverInfo(a){a.b1=this._b1,a.b2=this._b2;var t,r,i;t=this._manifold._normalX,r=this._manifold._normalY,i=this._manifold._normalZ;var o=this._manifold._numPoints;a.numRows=0;for(var s=0,_=o;s<_;){var h=s++,v=this._manifold._points[h];if(!v._disabled){var e=a.rows[a.numRows++],l=e.jacobianN;l.lin1X=t,l.lin1Y=r,l.lin1Z=i,l.lin2X=t,l.lin2Y=r,l.lin2Z=i,l.ang1X=v._relPos1Y*i-v._relPos1Z*r,l.ang1Y=v._relPos1Z*t-v._relPos1X*i,l.ang1Z=v._relPos1X*r-v._relPos1Y*t,l.ang2X=v._relPos2Y*i-v._relPos2Z*r,l.ang2Y=v._relPos2Z*t-v._relPos2X*i,l.ang2Z=v._relPos2X*r-v._relPos2Y*t,e.rhs=v._depth-x.common.Setting.linearSlop,e.rhs<0&&(e.rhs=0),e.impulse=v._impulse}}}_syncManifold(){this._manifold._updateDepthsAndPositions(this._tf1,this._tf2)}getShape1(){return this._s1}getShape2(){return this._s2}getManifold(){return this._manifold}isTouching(){for(var a=0,t=this._manifold._numPoints;a<t;){var r=a++;if(this._manifold._points[r]._depth>=0)return!0}return!1}};x.dynamics.constraint.contact.ContactImpulse=class{constructor(){this.impulseN=0,this.impulseT=0,this.impulseB=0,this.impulseP=0,this.impulseLX=0,this.impulseLY=0,this.impulseLZ=0}copyFrom(a){this.impulseN=a.impulseN,this.impulseT=a.impulseT,this.impulseB=a.impulseB,this.impulseLX=a.impulseLX,this.impulseLY=a.impulseLY,this.impulseLZ=a.impulseLZ}};x.dynamics.constraint.contact.Manifold=class{constructor(){this._normalX=0,this._normalY=0,this._normalZ=0,this._tangentX=0,this._tangentY=0,this._tangentZ=0,this._binormalX=0,this._binormalY=0,this._binormalZ=0,this._numPoints=0;var a=new Array(x.common.Setting.maxManifoldPoints);this._points=a;for(var t=0,r=x.common.Setting.maxManifoldPoints;t<r;){var i=t++;this._points[i]=new x.dynamics.constraint.contact.ManifoldPoint}}_clear(){for(var a=0,t=this._numPoints;a<t;){var r=a++,i=this._points[r];i._localPos1X=0,i._localPos1Y=0,i._localPos1Z=0,i._localPos2X=0,i._localPos2Y=0,i._localPos2Z=0,i._relPos1X=0,i._relPos1Y=0,i._relPos1Z=0,i._relPos2X=0,i._relPos2Y=0,i._relPos2Z=0,i._pos1X=0,i._pos1Y=0,i._pos1Z=0,i._pos2X=0,i._pos2Y=0,i._pos2Z=0,i._depth=0;var o=i._impulse;o.impulseN=0,o.impulseT=0,o.impulseB=0,o.impulseP=0,o.impulseLX=0,o.impulseLY=0,o.impulseLZ=0,i._warmStarted=!1,i._disabled=!1,i._id=-1}this._numPoints=0}_buildBasis(a){var t=a;this._normalX=t.x,this._normalY=t.y,this._normalZ=t.z;var r=a.x,i=a.y,o=a.z,s=r*r,_=i*i,h=o*o,v,e,l,u,b,f;if(s<_)if(s<h){var n=1/Math.sqrt(_+h);v=0,e=-o*n,l=i*n,u=i*l-o*e,b=-r*l,f=r*e}else{var c=1/Math.sqrt(s+_);v=-i*c,e=r*c,l=0,u=-o*e,b=o*v,f=r*e-i*v}else if(_<h){var M=1/Math.sqrt(s+h);v=o*M,e=0,l=-r*M,u=i*l,b=o*v-r*l,f=-i*v}else{var m=1/Math.sqrt(s+_);v=-i*m,e=r*m,l=0,u=-o*e,b=o*v,f=r*e-i*v}this._tangentX=v,this._tangentY=e,this._tangentZ=l,this._binormalX=u,this._binormalY=b,this._binormalZ=f}_updateDepthsAndPositions(a,t){for(var r=0,i=this._numPoints;r<i;){var o=r++,s=this._points[o],_,h,v;_=a._rotation00*s._localPos1X+a._rotation01*s._localPos1Y+a._rotation02*s._localPos1Z,h=a._rotation10*s._localPos1X+a._rotation11*s._localPos1Y+a._rotation12*s._localPos1Z,v=a._rotation20*s._localPos1X+a._rotation21*s._localPos1Y+a._rotation22*s._localPos1Z,s._relPos1X=_,s._relPos1Y=h,s._relPos1Z=v;var e,l,u;e=t._rotation00*s._localPos2X+t._rotation01*s._localPos2Y+t._rotation02*s._localPos2Z,l=t._rotation10*s._localPos2X+t._rotation11*s._localPos2Y+t._rotation12*s._localPos2Z,u=t._rotation20*s._localPos2X+t._rotation21*s._localPos2Y+t._rotation22*s._localPos2Z,s._relPos2X=e,s._relPos2Y=l,s._relPos2Z=u,s._pos1X=s._relPos1X+a._positionX,s._pos1Y=s._relPos1Y+a._positionY,s._pos1Z=s._relPos1Z+a._positionZ,s._pos2X=s._relPos2X+t._positionX,s._pos2Y=s._relPos2Y+t._positionY,s._pos2Z=s._relPos2Z+t._positionZ;var b,f,n;b=s._pos1X-s._pos2X,f=s._pos1Y-s._pos2Y,n=s._pos1Z-s._pos2Z;var c=b*this._normalX+f*this._normalY+n*this._normalZ;s._depth=-c}}getNormal(){var a=new x.common.Vec3,t=a;return t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ,a}getNormalTo(a){var t=a;t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ}getTangent(){var a=new x.common.Vec3,t=a;return t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ,a}getTangentTo(a){var t=a;t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ}getBinormal(){var a=new x.common.Vec3,t=a;return t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ,a}getBinormalTo(a){var t=a;t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ}getPoints(){return this._points}getNumPoints(){return this._numPoints}};x.dynamics.constraint.contact.ManifoldPoint=class{constructor(){this._localPos1X=0,this._localPos1Y=0,this._localPos1Z=0,this._localPos2X=0,this._localPos2Y=0,this._localPos2Z=0,this._relPos1X=0,this._relPos1Y=0,this._relPos1Z=0,this._relPos2X=0,this._relPos2Y=0,this._relPos2Z=0,this._pos1X=0,this._pos1Y=0,this._pos1Z=0,this._pos2X=0,this._pos2Y=0,this._pos2Z=0,this._depth=0,this._impulse=new x.dynamics.constraint.contact.ContactImpulse,this._warmStarted=!1,this._disabled=!1,this._id=-1}getPosition1(){var a=new x.common.Vec3,t=a;return t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z,a}getPosition1To(a){var t=a;t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z}getPosition2(){var a=new x.common.Vec3,t=a;return t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z,a}getPosition2To(a){var t=a;t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z}getDepth(){return this._depth}isWarmStarted(){return this._warmStarted}getNormalImpulse(){return this._impulse.impulseN}getTangentImpulse(){return this._impulse.impulseT}getBinormalImpulse(){return this._impulse.impulseB}isEnabled(){return!this._disabled}};x.dynamics.constraint.contact.ManifoldUpdater=class{constructor(a){this._manifold=a,this.numOldPoints=0;var t=new Array(x.common.Setting.maxManifoldPoints);this.oldPoints=t;for(var r=0,i=x.common.Setting.maxManifoldPoints;r<i;){var o=r++;this.oldPoints[o]=new x.dynamics.constraint.contact.ManifoldPoint}}removeOutdatedPoints(){for(var a=this._manifold._numPoints,t=a;--t>=0;){var r=this._manifold._points[t],i,o,s;i=r._pos1X-r._pos2X,o=r._pos1Y-r._pos2Y,s=r._pos1Z-r._pos2Z;var _=this._manifold._normalX*i+this._manifold._normalY*o+this._manifold._normalZ*s;if(_>x.common.Setting.contactPersistenceThreshold){this.removeManifoldPoint(t);continue}if(i+=this._manifold._normalX*-_,o+=this._manifold._normalY*-_,s+=this._manifold._normalZ*-_,i*i+o*o+s*s>x.common.Setting.contactPersistenceThreshold*x.common.Setting.contactPersistenceThreshold){this.removeManifoldPoint(t);continue}}}removeManifoldPoint(a){var t=--this._manifold._numPoints;if(a!=t){var r=this._manifold._points[a];this._manifold._points[a]=this._manifold._points[t],this._manifold._points[t]=r}var i=this._manifold._points[t];i._localPos1X=0,i._localPos1Y=0,i._localPos1Z=0,i._localPos2X=0,i._localPos2Y=0,i._localPos2Z=0,i._relPos1X=0,i._relPos1Y=0,i._relPos1Z=0,i._relPos2X=0,i._relPos2Y=0,i._relPos2Z=0,i._pos1X=0,i._pos1Y=0,i._pos1Z=0,i._pos2X=0,i._pos2Y=0,i._pos2Z=0,i._depth=0;var o=i._impulse;o.impulseN=0,o.impulseT=0,o.impulseB=0,o.impulseP=0,o.impulseLX=0,o.impulseLY=0,o.impulseLZ=0,i._warmStarted=!1,i._disabled=!1,i._id=-1}addManifoldPoint(a,t,r){var i=this._manifold._numPoints;if(i==x.common.Setting.maxManifoldPoints){var o=this.computeTargetIndex(a,t,r),s=this._manifold._points[o],_=a.position1;s._pos1X=_.x,s._pos1Y=_.y,s._pos1Z=_.z;var h=a.position2;s._pos2X=h.x,s._pos2Y=h.y,s._pos2Z=h.z,s._relPos1X=s._pos1X-t._positionX,s._relPos1Y=s._pos1Y-t._positionY,s._relPos1Z=s._pos1Z-t._positionZ,s._relPos2X=s._pos2X-r._positionX,s._relPos2Y=s._pos2Y-r._positionY,s._relPos2Z=s._pos2Z-r._positionZ;var v,e,l;v=t._rotation00*s._relPos1X+t._rotation10*s._relPos1Y+t._rotation20*s._relPos1Z,e=t._rotation01*s._relPos1X+t._rotation11*s._relPos1Y+t._rotation21*s._relPos1Z,l=t._rotation02*s._relPos1X+t._rotation12*s._relPos1Y+t._rotation22*s._relPos1Z,s._localPos1X=v,s._localPos1Y=e,s._localPos1Z=l;var u,b,f;u=r._rotation00*s._relPos2X+r._rotation10*s._relPos2Y+r._rotation20*s._relPos2Z,b=r._rotation01*s._relPos2X+r._rotation11*s._relPos2Y+r._rotation21*s._relPos2Z,f=r._rotation02*s._relPos2X+r._rotation12*s._relPos2Y+r._rotation22*s._relPos2Z,s._localPos2X=u,s._localPos2Y=b,s._localPos2Z=f,s._depth=a.depth;var n=s._impulse;n.impulseN=0,n.impulseT=0,n.impulseB=0,n.impulseP=0,n.impulseLX=0,n.impulseLY=0,n.impulseLZ=0,s._id=a.id,s._warmStarted=!1,s._disabled=!1;return}var c=this._manifold._points[i],M=a.position1;c._pos1X=M.x,c._pos1Y=M.y,c._pos1Z=M.z;var m=a.position2;c._pos2X=m.x,c._pos2Y=m.y,c._pos2Z=m.z,c._relPos1X=c._pos1X-t._positionX,c._relPos1Y=c._pos1Y-t._positionY,c._relPos1Z=c._pos1Z-t._positionZ,c._relPos2X=c._pos2X-r._positionX,c._relPos2Y=c._pos2Y-r._positionY,c._relPos2Z=c._pos2Z-r._positionZ;var y,V,z;y=t._rotation00*c._relPos1X+t._rotation10*c._relPos1Y+t._rotation20*c._relPos1Z,V=t._rotation01*c._relPos1X+t._rotation11*c._relPos1Y+t._rotation21*c._relPos1Z,z=t._rotation02*c._relPos1X+t._rotation12*c._relPos1Y+t._rotation22*c._relPos1Z,c._localPos1X=y,c._localPos1Y=V,c._localPos1Z=z;var I,w,X;I=r._rotation00*c._relPos2X+r._rotation10*c._relPos2Y+r._rotation20*c._relPos2Z,w=r._rotation01*c._relPos2X+r._rotation11*c._relPos2Y+r._rotation21*c._relPos2Z,X=r._rotation02*c._relPos2X+r._rotation12*c._relPos2Y+r._rotation22*c._relPos2Z,c._localPos2X=I,c._localPos2Y=w,c._localPos2Z=X,c._depth=a.depth;var L=c._impulse;L.impulseN=0,L.impulseT=0,L.impulseB=0,L.impulseP=0,L.impulseLX=0,L.impulseLY=0,L.impulseLZ=0,c._id=a.id,c._warmStarted=!1,c._disabled=!1,this._manifold._numPoints++}computeTargetIndex(a,t,r){var i=this._manifold._points[0],o=this._manifold._points[1],s=this._manifold._points[2],_=this._manifold._points[3],h=i._depth,v=0;o._depth>h&&(h=o._depth,v=1),s._depth>h&&(h=s._depth,v=2),_._depth>h&&(h=_._depth,v=3);var e,l,u,b=a.position1;e=b.x,l=b.y,u=b.z,e-=t._positionX,l-=t._positionY,u-=t._positionZ;var f=o._relPos1X,n=o._relPos1Y,c=o._relPos1Z,M=s._relPos1X,m=s._relPos1Y,y=s._relPos1Z,V=_._relPos1X,z=_._relPos1Y,I=_._relPos1Z,w,X,L,p,g,F,S,N,A,Y,R,C,d,Z,j,H,E,G;w=M-f,X=m-n,L=y-c,p=e-V,g=l-z,F=u-I,S=V-f,N=z-n,A=I-c,Y=e-M,R=l-m,C=u-y,d=e-f,Z=l-n,j=u-c,H=V-M,E=z-m,G=I-y;var B,Q,W,J,D,O,K,ra,sa;B=X*F-L*g,Q=L*p-w*F,W=w*g-X*p,J=N*C-A*R,D=A*Y-S*C,O=S*R-N*Y,K=Z*G-j*E,ra=j*H-d*G,sa=d*E-Z*H;var $=B*B+Q*Q+W*W,q=J*J+D*D+O*O,na=K*K+ra*ra+sa*sa,oa=$>q?$>na?$:na:q>na?q:na,aa=i._relPos1X,T=i._relPos1Y,ca=i._relPos1Z,_a=s._relPos1X,k=s._relPos1Y,ta=s._relPos1Z,ia=_._relPos1X,la=_._relPos1Y,va=_._relPos1Z,xa,Ma,za,Xa,Za,fa,ba,ea,ha,pa,ya,da,ma,Ya,Qa,ga,ua,ka;xa=_a-aa,Ma=k-T,za=ta-ca,Xa=e-ia,Za=l-la,fa=u-va,ba=ia-aa,ea=la-T,ha=va-ca,pa=e-_a,ya=l-k,da=u-ta,ma=e-aa,Ya=l-T,Qa=u-ca,ga=ia-_a,ua=la-k,ka=va-ta;var wa,Pa,Mt,Oa,Ba,nt,Ea,Na,Sa;wa=Ma*fa-za*Za,Pa=za*Xa-xa*fa,Mt=xa*Za-Ma*Xa,Oa=ea*da-ha*ya,Ba=ha*pa-ba*da,nt=ba*ya-ea*pa,Ea=Ya*ka-Qa*ua,Na=Qa*ga-ma*ka,Sa=ma*ua-Ya*ga;var ft=wa*wa+Pa*Pa+Mt*Mt,Wa=Oa*Oa+Ba*Ba+nt*nt,Ha=Ea*Ea+Na*Na+Sa*Sa,bt=ft>Wa?ft>Ha?ft:Ha:Wa>Ha?Wa:Ha,rt=i._relPos1X,ja=i._relPos1Y,_t=i._relPos1Z,gt=o._relPos1X,mt=o._relPos1Y,Ja=o._relPos1Z,it=_._relPos1X,ut=_._relPos1Y,Da=_._relPos1Z,Ta,Fa,Vt,Pt,et,Xt,Yt,zt,Ia,U,Va,lt,P,kt,Bt,St,yt,wt;Ta=gt-rt,Fa=mt-ja,Vt=Ja-_t,Pt=e-it,et=l-ut,Xt=u-Da,Yt=it-rt,zt=ut-ja,Ia=Da-_t,U=e-gt,Va=l-mt,lt=u-Ja,P=e-rt,kt=l-ja,Bt=u-_t,St=it-gt,yt=ut-mt,wt=Da-Ja;var pt,ht,xt,Ra,st,Ca,vt,qa,at;pt=Fa*Xt-Vt*et,ht=Vt*Pt-Ta*Xt,xt=Ta*et-Fa*Pt,Ra=zt*lt-Ia*Va,st=Ia*U-Yt*lt,Ca=Yt*Va-zt*U,vt=kt*wt-Bt*yt,qa=Bt*St-P*wt,at=P*yt-kt*St;var Ua=pt*pt+ht*ht+xt*xt,tt=Ra*Ra+st*st+Ca*Ca,ct=vt*vt+qa*qa+at*at,Aa=Ua>tt?Ua>ct?Ua:ct:tt>ct?tt:ct,Ga=i._relPos1X,Ka=i._relPos1Y,La=i._relPos1Z,ot=o._relPos1X,It=o._relPos1Y,or=o._relPos1Z,gr=s._relPos1X,ar=s._relPos1Y,Ct=s._relPos1Z,_r,Et,At,Gt,Hr,vr,lr,tr,Ur,Xr,Mr,Zt,ir,$t,nr,jr,Wt,Kr;_r=ot-Ga,Et=It-Ka,At=or-La,Gt=e-gr,Hr=l-ar,vr=u-Ct,lr=gr-Ga,tr=ar-Ka,Ur=Ct-La,Xr=e-ot,Mr=l-It,Zt=u-or,ir=e-Ga,$t=l-Ka,nr=u-La,jr=gr-ot,Wt=ar-It,Kr=Ct-or;var Ir,mi,$r,Lt,Kt,Tt,br,zr,vi;Ir=Et*vr-At*Hr,mi=At*Gt-_r*vr,$r=_r*Hr-Et*Gt,Lt=tr*Zt-Ur*Mr,Kt=Ur*Xr-lr*Zt,Tt=lr*Mr-tr*Xr,br=$t*Kr-nr*Wt,zr=nr*jr-ir*Kr,vi=ir*Wt-$t*jr;var qt=Ir*Ir+mi*mi+$r*$r,fr=Lt*Lt+Kt*Kt+Tt*Tt,dt=br*br+zr*zr+vi*vi,ur=qt>fr?qt>dt?qt:dt:fr>dt?fr:dt,hr=oa,ei=0;return(bt>hr&&v!=1||v==0)&&(hr=bt,ei=1),Aa>hr&&v!=2&&(hr=Aa,ei=2),ur>hr&&v!=3&&(hr=ur,ei=3),ei}computeRelativePositions(a,t){for(var r=this._manifold._numPoints,i=0,o=r;i<o;){var s=i++,_=this._manifold._points[s],h,v,e;h=a._rotation00*_._localPos1X+a._rotation01*_._localPos1Y+a._rotation02*_._localPos1Z,v=a._rotation10*_._localPos1X+a._rotation11*_._localPos1Y+a._rotation12*_._localPos1Z,e=a._rotation20*_._localPos1X+a._rotation21*_._localPos1Y+a._rotation22*_._localPos1Z,_._relPos1X=h,_._relPos1Y=v,_._relPos1Z=e;var l,u,b;l=t._rotation00*_._localPos2X+t._rotation01*_._localPos2Y+t._rotation02*_._localPos2Z,u=t._rotation10*_._localPos2X+t._rotation11*_._localPos2Y+t._rotation12*_._localPos2Z,b=t._rotation20*_._localPos2X+t._rotation21*_._localPos2Y+t._rotation22*_._localPos2Z,_._relPos2X=l,_._relPos2Y=u,_._relPos2Z=b,_._warmStarted=!0}}findNearestContactPointIndex(a,t,r){for(var i=x.common.Setting.contactPersistenceThreshold*x.common.Setting.contactPersistenceThreshold,o=-1,s=0,_=this._manifold._numPoints;s<_;){var h=s++,v=this._manifold._points[h],e,l,u,b,f,n,c=a.position1;e=c.x,l=c.y,u=c.z;var M=a.position2;b=M.x,f=M.y,n=M.z,e-=t._positionX,l-=t._positionY,u-=t._positionZ,b-=r._positionX,f-=r._positionY,n-=r._positionZ;var m,y,V,z,I,w;m=v._relPos1X-e,y=v._relPos1Y-l,V=v._relPos1Z-u,z=v._relPos2X-b,I=v._relPos2Y-f,w=v._relPos2Z-n;var X=m*m+y*y+V*V,L=z*z+I*I+w*w,p=X<L?X:L;p<i&&(i=p,o=h)}return o}totalUpdate(a,t,r){this.numOldPoints=this._manifold._numPoints;for(var i=0,o=this.numOldPoints;i<o;){var s=i++,_=this.oldPoints[s],h=this._manifold._points[s];_._localPos1X=h._localPos1X,_._localPos1Y=h._localPos1Y,_._localPos1Z=h._localPos1Z,_._localPos2X=h._localPos2X,_._localPos2Y=h._localPos2Y,_._localPos2Z=h._localPos2Z,_._relPos1X=h._relPos1X,_._relPos1Y=h._relPos1Y,_._relPos1Z=h._relPos1Z,_._relPos2X=h._relPos2X,_._relPos2Y=h._relPos2Y,_._relPos2Z=h._relPos2Z,_._pos1X=h._pos1X,_._pos1Y=h._pos1Y,_._pos1Z=h._pos1Z,_._pos2X=h._pos2X,_._pos2Y=h._pos2Y,_._pos2Z=h._pos2Z,_._depth=h._depth,_._impulse.copyFrom(h._impulse),_._id=h._id,_._warmStarted=h._warmStarted,_._disabled=!1}var v=a.numPoints;this._manifold._numPoints=v;for(var e=0,l=v;e<l;){var u=e++,b=this._manifold._points[u],f=a.points[u],n=f.position1;b._pos1X=n.x,b._pos1Y=n.y,b._pos1Z=n.z;var c=f.position2;b._pos2X=c.x,b._pos2Y=c.y,b._pos2Z=c.z,b._relPos1X=b._pos1X-t._positionX,b._relPos1Y=b._pos1Y-t._positionY,b._relPos1Z=b._pos1Z-t._positionZ,b._relPos2X=b._pos2X-r._positionX,b._relPos2Y=b._pos2Y-r._positionY,b._relPos2Z=b._pos2Z-r._positionZ;var M,m,y;M=t._rotation00*b._relPos1X+t._rotation10*b._relPos1Y+t._rotation20*b._relPos1Z,m=t._rotation01*b._relPos1X+t._rotation11*b._relPos1Y+t._rotation21*b._relPos1Z,y=t._rotation02*b._relPos1X+t._rotation12*b._relPos1Y+t._rotation22*b._relPos1Z,b._localPos1X=M,b._localPos1Y=m,b._localPos1Z=y;var V,z,I;V=r._rotation00*b._relPos2X+r._rotation10*b._relPos2Y+r._rotation20*b._relPos2Z,z=r._rotation01*b._relPos2X+r._rotation11*b._relPos2Y+r._rotation21*b._relPos2Z,I=r._rotation02*b._relPos2X+r._rotation12*b._relPos2Y+r._rotation22*b._relPos2Z,b._localPos2X=V,b._localPos2Y=z,b._localPos2Z=I,b._depth=f.depth;var w=b._impulse;w.impulseN=0,w.impulseT=0,w.impulseB=0,w.impulseP=0,w.impulseLX=0,w.impulseLY=0,w.impulseLZ=0,b._id=f.id,b._warmStarted=!1,b._disabled=!1;for(var X=0,L=this.numOldPoints;X<L;){var p=X++,g=this.oldPoints[p];if(b._id==g._id){b._impulse.copyFrom(g._impulse),b._warmStarted=!0;break}}}}incrementalUpdate(a,t,r){this._manifold._updateDepthsAndPositions(t,r);for(var i=0,o=this._manifold._numPoints;i<o;){var s=i++;this._manifold._points[s]._warmStarted=!0}var _=a.points[0],h=this.findNearestContactPointIndex(_,t,r);if(h==-1)this.addManifoldPoint(_,t,r);else{var v=this._manifold._points[h],e=_.position1;v._pos1X=e.x,v._pos1Y=e.y,v._pos1Z=e.z;var l=_.position2;v._pos2X=l.x,v._pos2Y=l.y,v._pos2Z=l.z,v._relPos1X=v._pos1X-t._positionX,v._relPos1Y=v._pos1Y-t._positionY,v._relPos1Z=v._pos1Z-t._positionZ,v._relPos2X=v._pos2X-r._positionX,v._relPos2Y=v._pos2Y-r._positionY,v._relPos2Z=v._pos2Z-r._positionZ;var u,b,f;u=t._rotation00*v._relPos1X+t._rotation10*v._relPos1Y+t._rotation20*v._relPos1Z,b=t._rotation01*v._relPos1X+t._rotation11*v._relPos1Y+t._rotation21*v._relPos1Z,f=t._rotation02*v._relPos1X+t._rotation12*v._relPos1Y+t._rotation22*v._relPos1Z,v._localPos1X=u,v._localPos1Y=b,v._localPos1Z=f;var n,c,M;n=r._rotation00*v._relPos2X+r._rotation10*v._relPos2Y+r._rotation20*v._relPos2Z,c=r._rotation01*v._relPos2X+r._rotation11*v._relPos2Y+r._rotation21*v._relPos2Z,M=r._rotation02*v._relPos2X+r._rotation12*v._relPos2Y+r._rotation22*v._relPos2Z,v._localPos2X=n,v._localPos2Y=c,v._localPos2Z=M,v._depth=_.depth}this.removeOutdatedPoints()}};x.dynamics.constraint.info||(x.dynamics.constraint.info={});x.dynamics.constraint.info.JacobianRow=class{constructor(){this.lin1X=0,this.lin1Y=0,this.lin1Z=0,this.lin2X=0,this.lin2Y=0,this.lin2Z=0,this.ang1X=0,this.ang1Y=0,this.ang1Z=0,this.ang2X=0,this.ang2Y=0,this.ang2Z=0,this.flag=0}updateSparsity(){this.flag=0,(!(this.lin1X==0&&this.lin1Y==0&&this.lin1Z==0)||!(this.lin2X==0&&this.lin2Y==0&&this.lin2Z==0))&&(this.flag|=1),(!(this.ang1X==0&&this.ang1Y==0&&this.ang1Z==0)||!(this.ang2X==0&&this.ang2Y==0&&this.ang2Z==0))&&(this.flag|=2)}};x.dynamics.constraint.info.contact||(x.dynamics.constraint.info.contact={});x.dynamics.constraint.info.contact.ContactSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0;var a=new Array(x.common.Setting.maxManifoldPoints);this.rows=a;for(var t=0,r=this.rows.length;t<r;){var i=t++;this.rows[i]=new x.dynamics.constraint.info.contact.ContactSolverInfoRow}}};x.dynamics.constraint.info.contact.ContactSolverInfoRow=class{constructor(){this.jacobianN=new x.dynamics.constraint.info.JacobianRow,this.jacobianT=new x.dynamics.constraint.info.JacobianRow,this.jacobianB=new x.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.friction=0,this.impulse=null}};x.dynamics.constraint.info.joint||(x.dynamics.constraint.info.joint={});x.dynamics.constraint.info.joint.JointSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0;var a=new Array(x.common.Setting.maxJacobianRows);this.rows=a;for(var t=0,r=this.rows.length;t<r;){var i=t++;this.rows[i]=new x.dynamics.constraint.info.joint.JointSolverInfoRow}}};x.dynamics.constraint.info.joint.JointSolverInfoRow=class{constructor(){this.jacobian=new x.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.minImpulse=0,this.maxImpulse=0,this.motorSpeed=0,this.motorMaxImpulse=0,this.impulse=null}};x.dynamics.constraint.joint||(x.dynamics.constraint.joint={});x.dynamics.constraint.joint.BasisTracker=class{constructor(a){this.joint=a,this.xX=0,this.xY=0,this.xZ=0,this.yX=0,this.yY=0,this.yZ=0,this.zX=0,this.zY=0,this.zZ=0}};x.dynamics.constraint.joint.Joint=class{constructor(a,t){switch(this._link1=new x.dynamics.constraint.joint.JointLink(this),this._link2=new x.dynamics.constraint.joint.JointLink(this),this._positionCorrectionAlgorithm=x.common.Setting.defaultJointPositionCorrectionAlgorithm,this._type=t,this._world=null,this._b1=a.rigidBody1,this._b2=a.rigidBody2,this._allowCollision=a.allowCollision,this._breakForce=a.breakForce,this._breakTorque=a.breakTorque,a.solverType){case 0:this._solver=new x.dynamics.constraint.solver.pgs.PgsJointConstraintSolver(this);break;case 1:this._solver=new x.dynamics.constraint.solver.direct.DirectJointConstraintSolver(this);break}var r=a.localAnchor1;this._localAnchor1X=r.x,this._localAnchor1Y=r.y,this._localAnchor1Z=r.z;var i=a.localAnchor2;this._localAnchor2X=i.x,this._localAnchor2Y=i.y,this._localAnchor2Z=i.z,this._relativeAnchor1X=0,this._relativeAnchor1Y=0,this._relativeAnchor1Z=0,this._relativeAnchor2X=0,this._relativeAnchor2Y=0,this._relativeAnchor2Z=0,this._anchor1X=0,this._anchor1Y=0,this._anchor1Z=0,this._anchor2X=0,this._anchor2Y=0,this._anchor2Z=0,this._localBasisX1X=0,this._localBasisX1Y=0,this._localBasisX1Z=0,this._localBasisY1X=0,this._localBasisY1Y=0,this._localBasisY1Z=0,this._localBasisZ1X=0,this._localBasisZ1Y=0,this._localBasisZ1Z=0,this._localBasisX2X=0,this._localBasisX2Y=0,this._localBasisX2Z=0,this._localBasisY2X=0,this._localBasisY2Y=0,this._localBasisY2Z=0,this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=0;var o=new Array(x.common.Setting.maxJacobianRows);this._impulses=o;for(var s=0,_=x.common.Setting.maxJacobianRows;s<_;){var h=s++;this._impulses[h]=new x.dynamics.constraint.joint.JointImpulse}}buildLocalBasesFromX(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var a=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;a>0&&(a=1/Math.sqrt(a)),this._localBasisX1X*=a,this._localBasisX1Y*=a,this._localBasisX1Z*=a}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{var t=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX2X*=t,this._localBasisX2Y*=t,this._localBasisX2Z*=t}var r,i,o,s,_,h,v,e,l,u,b,f,n,c=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(c<-.999999999){var M,m,y,V=this._localBasisX1X,z=this._localBasisX1Y,I=this._localBasisX1Z,w=V*V,X=z*z,L=I*I,p;w<X?w<L?(p=1/Math.sqrt(X+L),M=0,m=I*p,y=-z*p):(p=1/Math.sqrt(w+X),M=z*p,m=-V*p,y=0):X<L?(p=1/Math.sqrt(L+w),M=-I*p,m=0,y=V*p):(p=1/Math.sqrt(w+X),M=z*p,m=-V*p,y=0),r=M,i=m,o=y,s=0}else{var g,F,S;g=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,F=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,S=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var N=Math.sqrt((1+c)*.5);c=.5/N,g*=c,F*=c,S*=c,r=g,i=F,o=S,s=N}var A=r,Y=i,R=o,C=s,d=2*A,Z=2*Y,j=2*R,H=A*d,E=Y*Z,G=R*j,B=A*Z,Q=Y*j,W=A*j,J=C*d,D=C*Z,O=C*j;_=1-E-G,h=B-O,v=W+D,e=B+O,l=1-H-G,u=Q-J,b=W-D,f=Q+J,n=1-H-E;var K=this._localBasisX1X,ra=this._localBasisX1Y,sa=this._localBasisX1Z,$=K*K,q=ra*ra,na=sa*sa,oa;$<q?$<na?(oa=1/Math.sqrt(q+na),this._localBasisY1X=0,this._localBasisY1Y=sa*oa,this._localBasisY1Z=-ra*oa):(oa=1/Math.sqrt($+q),this._localBasisY1X=ra*oa,this._localBasisY1Y=-K*oa,this._localBasisY1Z=0):q<na?(oa=1/Math.sqrt(na+$),this._localBasisY1X=-sa*oa,this._localBasisY1Y=0,this._localBasisY1Z=K*oa):(oa=1/Math.sqrt($+q),this._localBasisY1X=ra*oa,this._localBasisY1Y=-K*oa,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X;var aa,T,ca;aa=_*this._localBasisX1X+h*this._localBasisX1Y+v*this._localBasisX1Z,T=e*this._localBasisX1X+l*this._localBasisX1Y+u*this._localBasisX1Z,ca=b*this._localBasisX1X+f*this._localBasisX1Y+n*this._localBasisX1Z,this._localBasisX2X=aa,this._localBasisX2Y=T,this._localBasisX2Z=ca;var _a,k,ta;_a=_*this._localBasisY1X+h*this._localBasisY1Y+v*this._localBasisY1Z,k=e*this._localBasisY1X+l*this._localBasisY1Y+u*this._localBasisY1Z,ta=b*this._localBasisY1X+f*this._localBasisY1Y+n*this._localBasisY1Z,this._localBasisY2X=_a,this._localBasisY2Y=k,this._localBasisY2Z=ta;var ia,la,va;ia=_*this._localBasisZ1X+h*this._localBasisZ1Y+v*this._localBasisZ1Z,la=e*this._localBasisZ1X+l*this._localBasisZ1Y+u*this._localBasisZ1Z,va=b*this._localBasisZ1X+f*this._localBasisZ1Y+n*this._localBasisZ1Z,this._localBasisZ2X=ia,this._localBasisZ2Y=la,this._localBasisZ2Z=va}buildLocalBasesFromXY(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var a=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;a>0&&(a=1/Math.sqrt(a)),this._localBasisX1X*=a,this._localBasisX1Y*=a,this._localBasisX1Z*=a}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{var t=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX2X*=t,this._localBasisX2Y*=t,this._localBasisX2Z*=t}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){var r=this._localBasisX1X,i=this._localBasisX1Y,o=this._localBasisX1Z,s=r*r,_=i*i,h=o*o,v;s<_?s<h?(v=1/Math.sqrt(_+h),this._localBasisY1X=0,this._localBasisY1Y=o*v,this._localBasisY1Z=-i*v):(v=1/Math.sqrt(s+_),this._localBasisY1X=i*v,this._localBasisY1Y=-r*v,this._localBasisY1Z=0):_<h?(v=1/Math.sqrt(h+s),this._localBasisY1X=-o*v,this._localBasisY1Y=0,this._localBasisY1Z=r*v):(v=1/Math.sqrt(s+_),this._localBasisY1X=i*v,this._localBasisY1Y=-r*v,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{var e=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;e>0&&(e=1/Math.sqrt(e)),this._localBasisZ1X*=e,this._localBasisZ1Y*=e,this._localBasisZ1Z*=e,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0){var l=this._localBasisX2X,u=this._localBasisX2Y,b=this._localBasisX2Z,f=l*l,n=u*u,c=b*b,M;f<n?f<c?(M=1/Math.sqrt(n+c),this._localBasisY2X=0,this._localBasisY2Y=b*M,this._localBasisY2Z=-u*M):(M=1/Math.sqrt(f+n),this._localBasisY2X=u*M,this._localBasisY2Y=-l*M,this._localBasisY2Z=0):n<c?(M=1/Math.sqrt(c+f),this._localBasisY2X=-b*M,this._localBasisY2Y=0,this._localBasisY2Z=l*M):(M=1/Math.sqrt(f+n),this._localBasisY2X=u*M,this._localBasisY2Y=-l*M,this._localBasisY2Z=0),this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X}else{var m=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;m>0&&(m=1/Math.sqrt(m)),this._localBasisZ2X*=m,this._localBasisZ2Y*=m,this._localBasisZ2Z*=m,this._localBasisY2X=this._localBasisZ2Y*this._localBasisX2Z-this._localBasisZ2Z*this._localBasisX2Y,this._localBasisY2Y=this._localBasisZ2Z*this._localBasisX2X-this._localBasisZ2X*this._localBasisX2Z,this._localBasisY2Z=this._localBasisZ2X*this._localBasisX2Y-this._localBasisZ2Y*this._localBasisX2X}}buildLocalBasesFromX1Z2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var a=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;a>0&&(a=1/Math.sqrt(a)),this._localBasisX1X*=a,this._localBasisX1Y*=a,this._localBasisX1Z*=a}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0)this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=1;else{var t=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ2X*=t,this._localBasisZ2Y*=t,this._localBasisZ2Z*=t}var r=this._b1._transform,i=this._b2._transform,o,s,_,h,v,e,l,u,b,f,n,c,M,m,y,V,z,I;V=r._rotation00*this._localBasisX1X+r._rotation01*this._localBasisX1Y+r._rotation02*this._localBasisX1Z,z=r._rotation10*this._localBasisX1X+r._rotation11*this._localBasisX1Y+r._rotation12*this._localBasisX1Z,I=r._rotation20*this._localBasisX1X+r._rotation21*this._localBasisX1Y+r._rotation22*this._localBasisX1Z,o=V,s=z,_=I;var w,X,L;if(w=i._rotation00*this._localBasisZ2X+i._rotation01*this._localBasisZ2Y+i._rotation02*this._localBasisZ2Z,X=i._rotation10*this._localBasisZ2X+i._rotation11*this._localBasisZ2Y+i._rotation12*this._localBasisZ2Z,L=i._rotation20*this._localBasisZ2X+i._rotation21*this._localBasisZ2Y+i._rotation22*this._localBasisZ2Z,M=w,m=X,y=L,l=m*_-y*s,u=y*o-M*_,b=M*s-m*o,l*l+u*u+b*b==0){var p=o,g=s,F=_,S=p*p,N=g*g,A=F*F,Y;S<N?S<A?(Y=1/Math.sqrt(N+A),l=0,u=F*Y,b=-g*Y):(Y=1/Math.sqrt(S+N),l=g*Y,u=-p*Y,b=0):N<A?(Y=1/Math.sqrt(A+S),l=-F*Y,u=0,b=p*Y):(Y=1/Math.sqrt(S+N),l=g*Y,u=-p*Y,b=0)}h=s*b-_*u,v=_*l-o*b,e=o*u-s*l,f=u*y-b*m,n=b*M-l*y,c=l*m-u*M;var R,C,d;R=r._rotation00*o+r._rotation10*s+r._rotation20*_,C=r._rotation01*o+r._rotation11*s+r._rotation21*_,d=r._rotation02*o+r._rotation12*s+r._rotation22*_,this._localBasisX1X=R,this._localBasisX1Y=C,this._localBasisX1Z=d;var Z,j,H;Z=r._rotation00*l+r._rotation10*u+r._rotation20*b,j=r._rotation01*l+r._rotation11*u+r._rotation21*b,H=r._rotation02*l+r._rotation12*u+r._rotation22*b,this._localBasisY1X=Z,this._localBasisY1Y=j,this._localBasisY1Z=H;var E,G,B;E=r._rotation00*h+r._rotation10*v+r._rotation20*e,G=r._rotation01*h+r._rotation11*v+r._rotation21*e,B=r._rotation02*h+r._rotation12*v+r._rotation22*e,this._localBasisZ1X=E,this._localBasisZ1Y=G,this._localBasisZ1Z=B;var Q,W,J;Q=i._rotation00*f+i._rotation10*n+i._rotation20*c,W=i._rotation01*f+i._rotation11*n+i._rotation21*c,J=i._rotation02*f+i._rotation12*n+i._rotation22*c,this._localBasisX2X=Q,this._localBasisX2Y=W,this._localBasisX2Z=J;var D,O,K;D=i._rotation00*l+i._rotation10*u+i._rotation20*b,O=i._rotation01*l+i._rotation11*u+i._rotation21*b,K=i._rotation02*l+i._rotation12*u+i._rotation22*b,this._localBasisY2X=D,this._localBasisY2Y=O,this._localBasisY2Z=K;var ra,sa,$;ra=i._rotation00*M+i._rotation10*m+i._rotation20*y,sa=i._rotation01*M+i._rotation11*m+i._rotation21*y,$=i._rotation02*M+i._rotation12*m+i._rotation22*y,this._localBasisZ2X=ra,this._localBasisZ2Y=sa,this._localBasisZ2Z=$}buildLocalBasesFromXY1X2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var a=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;a>0&&(a=1/Math.sqrt(a)),this._localBasisX1X*=a,this._localBasisX1Y*=a,this._localBasisX1Z*=a}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){var t=this._localBasisX1X,r=this._localBasisX1Y,i=this._localBasisX1Z,o=t*t,s=r*r,_=i*i,h;o<s?o<_?(h=1/Math.sqrt(s+_),this._localBasisY1X=0,this._localBasisY1Y=i*h,this._localBasisY1Z=-r*h):(h=1/Math.sqrt(o+s),this._localBasisY1X=r*h,this._localBasisY1Y=-t*h,this._localBasisY1Z=0):s<_?(h=1/Math.sqrt(_+o),this._localBasisY1X=-i*h,this._localBasisY1Y=0,this._localBasisY1Z=t*h):(h=1/Math.sqrt(o+s),this._localBasisY1X=r*h,this._localBasisY1Y=-t*h,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{var v=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;v>0&&(v=1/Math.sqrt(v)),this._localBasisZ1X*=v,this._localBasisZ1Y*=v,this._localBasisZ1Z*=v,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}var e,l,u,b,f,n,c,M,m,y,V,z,I,w=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(w<-.999999999){var X,L,p,g=this._localBasisX1X,F=this._localBasisX1Y,S=this._localBasisX1Z,N=g*g,A=F*F,Y=S*S,R;N<A?N<Y?(R=1/Math.sqrt(A+Y),X=0,L=S*R,p=-F*R):(R=1/Math.sqrt(N+A),X=F*R,L=-g*R,p=0):A<Y?(R=1/Math.sqrt(Y+N),X=-S*R,L=0,p=g*R):(R=1/Math.sqrt(N+A),X=F*R,L=-g*R,p=0),e=X,l=L,u=p,b=0}else{var C,d,Z;C=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,d=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,Z=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var j=Math.sqrt((1+w)*.5);w=.5/j,C*=w,d*=w,Z*=w,e=C,l=d,u=Z,b=j}var H=e,E=l,G=u,B=b,Q=2*H,W=2*E,J=2*G,D=H*Q,O=E*W,K=G*J,ra=H*W,sa=E*J,$=H*J,q=B*Q,na=B*W,oa=B*J;f=1-O-K,n=ra-oa,c=$+na,M=ra+oa,m=1-D-K,y=sa-q,V=$-na,z=sa+q,I=1-D-O;var aa,T,ca;aa=f*this._localBasisX1X+n*this._localBasisX1Y+c*this._localBasisX1Z,T=M*this._localBasisX1X+m*this._localBasisX1Y+y*this._localBasisX1Z,ca=V*this._localBasisX1X+z*this._localBasisX1Y+I*this._localBasisX1Z,this._localBasisX2X=aa,this._localBasisX2Y=T,this._localBasisX2Z=ca;var _a,k,ta;_a=f*this._localBasisY1X+n*this._localBasisY1Y+c*this._localBasisY1Z,k=M*this._localBasisY1X+m*this._localBasisY1Y+y*this._localBasisY1Z,ta=V*this._localBasisY1X+z*this._localBasisY1Y+I*this._localBasisY1Z,this._localBasisY2X=_a,this._localBasisY2Y=k,this._localBasisY2Z=ta;var ia,la,va;ia=f*this._localBasisZ1X+n*this._localBasisZ1Y+c*this._localBasisZ1Z,la=M*this._localBasisZ1X+m*this._localBasisZ1Y+y*this._localBasisZ1Z,va=V*this._localBasisZ1X+z*this._localBasisZ1Y+I*this._localBasisZ1Z,this._localBasisZ2X=ia,this._localBasisZ2Y=la,this._localBasisZ2Z=va}setSolverInfoRowLinear(a,t,r,i,o,s,_){var h,v,e=x.common.Setting.linearSlop;if(_)h=0,v=1;else{if(o.frequency>0){e=0;var l=6.28318530717958*o.frequency,u=o.dampingRatio;u<x.common.Setting.minSpringDamperDampingRatio&&(u=x.common.Setting.minSpringDamperDampingRatio);var b=s.dt,f=2*u*l,n=l*l;o.useSymplecticEuler?(h=1/(b*f),v=n/f):(h=1/(b*(b*n+f)),v=n/(b*n+f))}else h=0,v=this.getErp(s,!1);r.motorForce>0?(a.motorSpeed=r.motorSpeed,a.motorMaxImpulse=r.motorForce*s.dt):(a.motorSpeed=0,a.motorMaxImpulse=0)}var c=r.lowerLimit,M=r.upperLimit,m,y,V;c>M?(m=0,y=0,V=0):c==M?(m=-1/0,y=1/0,V=t-c):t<c?(m=-1/0,y=0,V=t-c+e,V>0&&(V=0)):t>M?(m=0,y=1/0,V=t-M-e,V<0&&(V=0)):(m=0,y=0,V=0);var z=i==0?0:1/i;a.minImpulse=m,a.maxImpulse=y,a.cfm=h*z,a.rhs=V*v}setSolverInfoRowAngular(a,t,r,i,o,s,_){var h,v,e=x.common.Setting.angularSlop;if(_)h=0,v=1;else{if(o.frequency>0){e=0;var l=6.28318530717958*o.frequency,u=o.dampingRatio;u<x.common.Setting.minSpringDamperDampingRatio&&(u=x.common.Setting.minSpringDamperDampingRatio);var b=s.dt,f=2*u*l,n=l*l;o.useSymplecticEuler?(h=1/(b*f),v=n/f):(h=1/(b*(b*n+f)),v=n/(b*n+f))}else h=0,v=this.getErp(s,!1);r.motorTorque>0?(a.motorSpeed=r.motorSpeed,a.motorMaxImpulse=r.motorTorque*s.dt):(a.motorSpeed=0,a.motorMaxImpulse=0)}var c=r.lowerLimit,M=r.upperLimit,m=(c+M)*.5;t-=m,t=((t+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,t+=m;var y,V,z;c>M?(y=0,V=0,z=0):c==M?(y=-1/0,V=1/0,z=t-c):t<c?(y=-1/0,V=0,z=t-c+e,z>0&&(z=0)):t>M?(y=0,V=1/0,z=t-M-e,z<0&&(z=0)):(y=0,V=0,z=0);var I=i==0?0:1/i;a.minImpulse=y,a.maxImpulse=V,a.cfm=h*I,a.rhs=z*v}getErp(a,t){return t?1:this._positionCorrectionAlgorithm==x.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?a.invDt*x.common.Setting.velocityBaumgarte:0}computeEffectiveInertiaMoment(a,t,r){var i,o,s,_,h,v,e,l,u;e=this._b1._invInertia00*a+this._b1._invInertia01*t+this._b1._invInertia02*r,l=this._b1._invInertia10*a+this._b1._invInertia11*t+this._b1._invInertia12*r,u=this._b1._invInertia20*a+this._b1._invInertia21*t+this._b1._invInertia22*r,i=e,o=l,s=u;var b,f,n;b=this._b2._invInertia00*a+this._b2._invInertia01*t+this._b2._invInertia02*r,f=this._b2._invInertia10*a+this._b2._invInertia11*t+this._b2._invInertia12*r,n=this._b2._invInertia20*a+this._b2._invInertia21*t+this._b2._invInertia22*r,_=b,h=f,v=n;var c=i*a+o*t+s*r,M=_*a+h*t+v*r;if(c>0){var m=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,y=a*this._relativeAnchor1X+t*this._relativeAnchor1Y+r*this._relativeAnchor1Z,V=m-y*y;V>0&&(this._b1._invMass>0?c=1/(1/c+this._b1._mass*V):c=0)}if(M>0){var z=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,I=a*this._relativeAnchor2X+t*this._relativeAnchor2Y+r*this._relativeAnchor2Z,w=z-I*I;w>0&&(this._b2._invMass>0?M=1/(1/M+this._b2._mass*w):M=0)}return c+M==0?0:1/(c+M)}computeEffectiveInertiaMoment2(a,t,r,i,o,s){var _,h,v,e,l,u,b,f,n;b=this._b1._invInertia00*a+this._b1._invInertia01*t+this._b1._invInertia02*r,f=this._b1._invInertia10*a+this._b1._invInertia11*t+this._b1._invInertia12*r,n=this._b1._invInertia20*a+this._b1._invInertia21*t+this._b1._invInertia22*r,_=b,h=f,v=n;var c,M,m;c=this._b2._invInertia00*i+this._b2._invInertia01*o+this._b2._invInertia02*s,M=this._b2._invInertia10*i+this._b2._invInertia11*o+this._b2._invInertia12*s,m=this._b2._invInertia20*i+this._b2._invInertia21*o+this._b2._invInertia22*s,e=c,l=M,u=m;var y=_*a+h*t+v*r,V=e*i+l*o+u*s;if(y>0){var z=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,I=a*this._relativeAnchor1X+t*this._relativeAnchor1Y+r*this._relativeAnchor1Z,w=z*z-I*I;w>0&&(this._b1._invMass>0?y=1/(1/y+this._b1._mass*w):y=0)}if(V>0){var X=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,L=i*this._relativeAnchor2X+o*this._relativeAnchor2Y+s*this._relativeAnchor2Z,p=X*X-L*L;p>0&&(this._b2._invMass>0?V=1/(1/V+this._b2._mass*p):V=0)}return y+V==0?0:1/(y+V)}_syncAnchors(){var a=this._b1._transform,t=this._b2._transform,r,i,o;r=a._rotation00*this._localAnchor1X+a._rotation01*this._localAnchor1Y+a._rotation02*this._localAnchor1Z,i=a._rotation10*this._localAnchor1X+a._rotation11*this._localAnchor1Y+a._rotation12*this._localAnchor1Z,o=a._rotation20*this._localAnchor1X+a._rotation21*this._localAnchor1Y+a._rotation22*this._localAnchor1Z,this._relativeAnchor1X=r,this._relativeAnchor1Y=i,this._relativeAnchor1Z=o;var s,_,h;s=t._rotation00*this._localAnchor2X+t._rotation01*this._localAnchor2Y+t._rotation02*this._localAnchor2Z,_=t._rotation10*this._localAnchor2X+t._rotation11*this._localAnchor2Y+t._rotation12*this._localAnchor2Z,h=t._rotation20*this._localAnchor2X+t._rotation21*this._localAnchor2Y+t._rotation22*this._localAnchor2Z,this._relativeAnchor2X=s,this._relativeAnchor2Y=_,this._relativeAnchor2Z=h,this._anchor1X=this._relativeAnchor1X+a._positionX,this._anchor1Y=this._relativeAnchor1Y+a._positionY,this._anchor1Z=this._relativeAnchor1Z+a._positionZ,this._anchor2X=this._relativeAnchor2X+t._positionX,this._anchor2Y=this._relativeAnchor2Y+t._positionY,this._anchor2Z=this._relativeAnchor2Z+t._positionZ;var v,e,l;v=a._rotation00*this._localBasisX1X+a._rotation01*this._localBasisX1Y+a._rotation02*this._localBasisX1Z,e=a._rotation10*this._localBasisX1X+a._rotation11*this._localBasisX1Y+a._rotation12*this._localBasisX1Z,l=a._rotation20*this._localBasisX1X+a._rotation21*this._localBasisX1Y+a._rotation22*this._localBasisX1Z,this._basisX1X=v,this._basisX1Y=e,this._basisX1Z=l;var u,b,f;u=a._rotation00*this._localBasisY1X+a._rotation01*this._localBasisY1Y+a._rotation02*this._localBasisY1Z,b=a._rotation10*this._localBasisY1X+a._rotation11*this._localBasisY1Y+a._rotation12*this._localBasisY1Z,f=a._rotation20*this._localBasisY1X+a._rotation21*this._localBasisY1Y+a._rotation22*this._localBasisY1Z,this._basisY1X=u,this._basisY1Y=b,this._basisY1Z=f;var n,c,M;n=a._rotation00*this._localBasisZ1X+a._rotation01*this._localBasisZ1Y+a._rotation02*this._localBasisZ1Z,c=a._rotation10*this._localBasisZ1X+a._rotation11*this._localBasisZ1Y+a._rotation12*this._localBasisZ1Z,M=a._rotation20*this._localBasisZ1X+a._rotation21*this._localBasisZ1Y+a._rotation22*this._localBasisZ1Z,this._basisZ1X=n,this._basisZ1Y=c,this._basisZ1Z=M;var m,y,V;m=t._rotation00*this._localBasisX2X+t._rotation01*this._localBasisX2Y+t._rotation02*this._localBasisX2Z,y=t._rotation10*this._localBasisX2X+t._rotation11*this._localBasisX2Y+t._rotation12*this._localBasisX2Z,V=t._rotation20*this._localBasisX2X+t._rotation21*this._localBasisX2Y+t._rotation22*this._localBasisX2Z,this._basisX2X=m,this._basisX2Y=y,this._basisX2Z=V;var z,I,w;z=t._rotation00*this._localBasisY2X+t._rotation01*this._localBasisY2Y+t._rotation02*this._localBasisY2Z,I=t._rotation10*this._localBasisY2X+t._rotation11*this._localBasisY2Y+t._rotation12*this._localBasisY2Z,w=t._rotation20*this._localBasisY2X+t._rotation21*this._localBasisY2Y+t._rotation22*this._localBasisY2Z,this._basisY2X=z,this._basisY2Y=I,this._basisY2Z=w;var X,L,p;X=t._rotation00*this._localBasisZ2X+t._rotation01*this._localBasisZ2Y+t._rotation02*this._localBasisZ2Z,L=t._rotation10*this._localBasisZ2X+t._rotation11*this._localBasisZ2Y+t._rotation12*this._localBasisZ2Z,p=t._rotation20*this._localBasisZ2X+t._rotation21*this._localBasisZ2Y+t._rotation22*this._localBasisZ2Z,this._basisZ2X=X,this._basisZ2Y=L,this._basisZ2Z=p}_getVelocitySolverInfo(a,t){t.b1=this._b1,t.b2=this._b2,t.numRows=0}_getPositionSolverInfo(a){a.b1=this._b1,a.b2=this._b2,a.numRows=0}_checkDestruction(){var a=this._appliedForceX*this._appliedForceX+this._appliedForceY*this._appliedForceY+this._appliedForceZ*this._appliedForceZ,t=this._appliedTorqueX*this._appliedTorqueX+this._appliedTorqueY*this._appliedTorqueY+this._appliedTorqueZ*this._appliedTorqueZ;if(this._breakForce>0&&a>this._breakForce*this._breakForce){this._world.removeJoint(this);return}if(this._breakTorque>0&&t>this._breakTorque*this._breakTorque){this._world.removeJoint(this);return}}getRigidBody1(){return this._b1}getRigidBody2(){return this._b2}getType(){return this._type}getAnchor1(){var a=new x.common.Vec3,t=a;return t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z,a}getAnchor2(){var a=new x.common.Vec3,t=a;return t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z,a}getAnchor1To(a){var t=a;t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z}getAnchor2To(a){var t=a;t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z}getLocalAnchor1(){var a=new x.common.Vec3,t=a;return t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z,a}getLocalAnchor2(){var a=new x.common.Vec3,t=a;return t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z,a}getLocalAnchor1To(a){var t=a;t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z}getLocalAnchor2To(a){var t=a;t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z}getBasis1(){var a=new x.common.Mat3,t,r,i,o,s,_,h,v,e;t=this._basisX1X,r=this._basisY1X,i=this._basisZ1X,o=this._basisX1Y,s=this._basisY1Y,_=this._basisZ1Y,h=this._basisX1Z,v=this._basisY1Z,e=this._basisZ1Z;var l=a;return l.e00=t,l.e01=r,l.e02=i,l.e10=o,l.e11=s,l.e12=_,l.e20=h,l.e21=v,l.e22=e,a}getBasis2(){var a=new x.common.Mat3,t,r,i,o,s,_,h,v,e;t=this._basisX2X,r=this._basisY2X,i=this._basisZ2X,o=this._basisX2Y,s=this._basisY2Y,_=this._basisZ2Y,h=this._basisX2Z,v=this._basisY2Z,e=this._basisZ2Z;var l=a;return l.e00=t,l.e01=r,l.e02=i,l.e10=o,l.e11=s,l.e12=_,l.e20=h,l.e21=v,l.e22=e,a}getBasis1To(a){var t,r,i,o,s,_,h,v,e;t=this._basisX1X,r=this._basisY1X,i=this._basisZ1X,o=this._basisX1Y,s=this._basisY1Y,_=this._basisZ1Y,h=this._basisX1Z,v=this._basisY1Z,e=this._basisZ1Z;var l=a;l.e00=t,l.e01=r,l.e02=i,l.e10=o,l.e11=s,l.e12=_,l.e20=h,l.e21=v,l.e22=e}getBasis2To(a){var t,r,i,o,s,_,h,v,e;t=this._basisX2X,r=this._basisY2X,i=this._basisZ2X,o=this._basisX2Y,s=this._basisY2Y,_=this._basisZ2Y,h=this._basisX2Z,v=this._basisY2Z,e=this._basisZ2Z;var l=a;l.e00=t,l.e01=r,l.e02=i,l.e10=o,l.e11=s,l.e12=_,l.e20=h,l.e21=v,l.e22=e}getAllowCollision(){return this._allowCollision}setAllowCollision(a){this._allowCollision=a}getBreakForce(){return this._breakForce}setBreakForce(a){this._breakForce=a}getBreakTorque(){return this._breakTorque}setBreakTorque(a){this._breakTorque=a}getPositionCorrectionAlgorithm(){return this._positionCorrectionAlgorithm}setPositionCorrectionAlgorithm(a){switch(a){case 0:case 1:case 2:break;default:throw new Error("invalid position correction algorithm id: "+a)}this._positionCorrectionAlgorithm=a}getAppliedForce(){var a=new x.common.Vec3,t=a;return t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ,a}getAppliedForceTo(a){var t=a;t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ}getAppliedTorque(){var a=new x.common.Vec3,t=a;return t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ,a}getAppliedTorqueTo(a){var t=a;t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ}getPrev(){return this._prev}getNext(){return this._next}};x.dynamics.constraint.joint.CylindricalJoint=class extends x.dynamics.constraint.joint.Joint{constructor(a){super(a,2);var t=a.localAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var r=a.localAxis2;this._localBasisX2X=r.x,this._localBasisX2Y=r.y,this._localBasisX2Z=r.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this._basis=new x.dynamics.constraint.joint.BasisTracker(this),this._translSd=a.translationalSpringDamper.clone(),this._translLm=a.translationalLimitMotor.clone(),this._rotSd=a.rotationalSpringDamper.clone(),this._rotLm=a.rotationalLimitMotor.clone()}getInfo(a,t,r){var i=this.getErp(t,r),o=this.linearErrorY*i,s=this.linearErrorZ*i,_=this.angularErrorY*i,h=this.angularErrorZ*i,v,e,l=1/(this._b1._invMass+this._b2._invMass),u=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ);if(this._translSd.frequency<=0||!r){var b=this._impulses[0],f=a.rows[a.numRows++],n=f.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,f.rhs=0,f.cfm=0,f.minImpulse=0,f.maxImpulse=0,f.motorSpeed=0,f.motorMaxImpulse=0,f.impulse=null,f.impulse=b,v=f,this.setSolverInfoRowLinear(v,this.translation,this._translLm,l,this._translSd,t,r),e=v.jacobian,e.lin1X=this._basis.xX,e.lin1Y=this._basis.xY,e.lin1Z=this._basis.xZ,e.lin2X=this._basis.xX,e.lin2Y=this._basis.xY,e.lin2Z=this._basis.xZ,e.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,e.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,e.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,e.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,e.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,e.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}var c=this._impulses[1],M=a.rows[a.numRows++],m=M.jacobian;m.lin1X=0,m.lin1Y=0,m.lin1Z=0,m.lin2X=0,m.lin2Y=0,m.lin2Z=0,m.ang1X=0,m.ang1Y=0,m.ang1Z=0,m.ang2X=0,m.ang2Y=0,m.ang2Z=0,M.rhs=0,M.cfm=0,M.minImpulse=0,M.maxImpulse=0,M.motorSpeed=0,M.motorMaxImpulse=0,M.impulse=null,M.impulse=c,v=M,v.rhs=o,v.cfm=0,v.minImpulse=-1/0,v.maxImpulse=1/0,e=v.jacobian,e.lin1X=this._basis.yX,e.lin1Y=this._basis.yY,e.lin1Z=this._basis.yZ,e.lin2X=this._basis.yX,e.lin2Y=this._basis.yY,e.lin2Z=this._basis.yZ,e.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,e.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,e.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,e.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,e.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,e.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;var y=this._impulses[2],V=a.rows[a.numRows++],z=V.jacobian;if(z.lin1X=0,z.lin1Y=0,z.lin1Z=0,z.lin2X=0,z.lin2Y=0,z.lin2Z=0,z.ang1X=0,z.ang1Y=0,z.ang1Z=0,z.ang2X=0,z.ang2Y=0,z.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=y,v=V,v.rhs=s,v.cfm=0,v.minImpulse=-1/0,v.maxImpulse=1/0,e=v.jacobian,e.lin1X=this._basis.zX,e.lin1Y=this._basis.zY,e.lin1Z=this._basis.zZ,e.lin2X=this._basis.zX,e.lin2Y=this._basis.zY,e.lin2Z=this._basis.zZ,e.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,e.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,e.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,e.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,e.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,e.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX,this._rotSd.frequency<=0||!r){var I=this._impulses[3],w=a.rows[a.numRows++],X=w.jacobian;X.lin1X=0,X.lin1Y=0,X.lin1Z=0,X.lin2X=0,X.lin2Y=0,X.lin2Z=0,X.ang1X=0,X.ang1Y=0,X.ang1Z=0,X.ang2X=0,X.ang2Y=0,X.ang2Z=0,w.rhs=0,w.cfm=0,w.minImpulse=0,w.maxImpulse=0,w.motorSpeed=0,w.motorMaxImpulse=0,w.impulse=null,w.impulse=I,v=w,this.setSolverInfoRowAngular(v,this.angle,this._rotLm,u,this._rotSd,t,r),e=v.jacobian,e.ang1X=this._basis.xX,e.ang1Y=this._basis.xY,e.ang1Z=this._basis.xZ,e.ang2X=this._basis.xX,e.ang2Y=this._basis.xY,e.ang2Z=this._basis.xZ}var L=this._impulses[4],p=a.rows[a.numRows++],g=p.jacobian;g.lin1X=0,g.lin1Y=0,g.lin1Z=0,g.lin2X=0,g.lin2Y=0,g.lin2Z=0,g.ang1X=0,g.ang1Y=0,g.ang1Z=0,g.ang2X=0,g.ang2Y=0,g.ang2Z=0,p.rhs=0,p.cfm=0,p.minImpulse=0,p.maxImpulse=0,p.motorSpeed=0,p.motorMaxImpulse=0,p.impulse=null,p.impulse=L,v=p,v.rhs=_,v.cfm=0,v.minImpulse=-1/0,v.maxImpulse=1/0,e=v.jacobian,e.ang1X=this._basis.yX,e.ang1Y=this._basis.yY,e.ang1Z=this._basis.yZ,e.ang2X=this._basis.yX,e.ang2Y=this._basis.yY,e.ang2Z=this._basis.yZ;var F=this._impulses[5],S=a.rows[a.numRows++],N=S.jacobian;N.lin1X=0,N.lin1Y=0,N.lin1Z=0,N.lin2X=0,N.lin2Y=0,N.lin2Z=0,N.ang1X=0,N.ang1Y=0,N.ang1Z=0,N.ang2X=0,N.ang2Y=0,N.ang2Z=0,S.rhs=0,S.cfm=0,S.minImpulse=0,S.maxImpulse=0,S.motorSpeed=0,S.motorMaxImpulse=0,S.impulse=null,S.impulse=F,v=S,v.rhs=h,v.cfm=0,v.minImpulse=-1/0,v.maxImpulse=1/0,e=v.jacobian,e.ang1X=this._basis.zX,e.ang1Y=this._basis.zY,e.ang1Z=this._basis.zZ,e.ang2X=this._basis.zX,e.ang2Y=this._basis.zY,e.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();var a=this._basis,t=a.joint._b1._invMass,r=a.joint._b2._invMass,i,o,s,_,h,v,e,l,u,b,f,n,c,M,m,y,V,z,I,w,X,L,p,g,F,S,N,A,Y,R,C,d,Z,j,H,E,G=a.joint._basisX1X*a.joint._basisX2X+a.joint._basisX1Y*a.joint._basisX2Y+a.joint._basisX1Z*a.joint._basisX2Z;if(G<-.999999999){var B,Q,W,J=a.joint._basisX1X,D=a.joint._basisX1Y,O=a.joint._basisX1Z,K=J*J,ra=D*D,sa=O*O,$;K<ra?K<sa?($=1/Math.sqrt(ra+sa),B=0,Q=O*$,W=-D*$):($=1/Math.sqrt(K+ra),B=D*$,Q=-J*$,W=0):ra<sa?($=1/Math.sqrt(sa+K),B=-O*$,Q=0,W=J*$):($=1/Math.sqrt(K+ra),B=D*$,Q=-J*$,W=0),i=B,o=Q,s=W,_=0}else{var q,na,oa;q=a.joint._basisX1Y*a.joint._basisX2Z-a.joint._basisX1Z*a.joint._basisX2Y,na=a.joint._basisX1Z*a.joint._basisX2X-a.joint._basisX1X*a.joint._basisX2Z,oa=a.joint._basisX1X*a.joint._basisX2Y-a.joint._basisX1Y*a.joint._basisX2X;var aa=Math.sqrt((1+G)*.5);G=.5/aa,q*=G,na*=G,oa*=G,i=q,o=na,s=oa,_=aa}h=0,v=0,e=0,l=1;var T,ca,_a,k,ta,ia,la,va;T=h,ca=v,_a=e,k=l,ta=i,ia=o,la=s,va=_;var xa=T*ta+ca*ia+_a*la+k*va;if(xa<0&&(xa=-xa,ta=-ta,ia=-ia,la=-la,va=-va),xa>.999999){var Ma,za,Xa,Za;Ma=ta-T,za=ia-ca,Xa=la-_a,Za=va-k,ta=T+Ma*(t/(t+r)),ia=ca+za*(t/(t+r)),la=_a+Xa*(t/(t+r)),va=k+Za*(t/(t+r));var fa=ta*ta+ia*ia+la*la+va*va;fa>1e-32&&(fa=1/Math.sqrt(fa)),u=ta*fa,b=ia*fa,f=la*fa,n=va*fa}else{var ba=t/(t+r)*Math.acos(xa);ta+=T*-xa,ia+=ca*-xa,la+=_a*-xa,va+=k*-xa;var ea=ta*ta+ia*ia+la*la+va*va;ea>1e-32&&(ea=1/Math.sqrt(ea)),ta*=ea,ia*=ea,la*=ea,va*=ea;var ha=Math.sin(ba),pa=Math.cos(ba);T*=pa,ca*=pa,_a*=pa,k*=pa,u=T+ta*ha,b=ca+ia*ha,f=_a+la*ha,n=k+va*ha}var ya=u,da=b,ma=f,Ya=n,Qa=2*ya,ga=2*da,ua=2*ma,ka=ya*Qa,wa=da*ga,Pa=ma*ua,Mt=ya*ga,Oa=da*ua,Ba=ya*ua,nt=Ya*Qa,Ea=Ya*ga,Na=Ya*ua;c=1-wa-Pa,M=Mt-Na,m=Ba+Ea,y=Mt+Na,V=1-ka-Pa,z=Oa-nt,I=Ba-Ea,w=Oa+nt,X=1-ka-wa;var Sa,ft,Wa;Sa=c*a.joint._basisX1X+M*a.joint._basisX1Y+m*a.joint._basisX1Z,ft=y*a.joint._basisX1X+V*a.joint._basisX1Y+z*a.joint._basisX1Z,Wa=I*a.joint._basisX1X+w*a.joint._basisX1Y+X*a.joint._basisX1Z,L=Sa,p=ft,g=Wa,C=a.xX,d=a.xY,Z=a.xZ,j=a.yX,H=a.yY,E=a.yZ;var Ha=C*L+d*p+Z*g;if(Ha<-.999999999){var bt,rt,ja,_t=C,gt=d,mt=Z,Ja=_t*_t,it=gt*gt,ut=mt*mt,Da;Ja<it?Ja<ut?(Da=1/Math.sqrt(it+ut),bt=0,rt=mt*Da,ja=-gt*Da):(Da=1/Math.sqrt(Ja+it),bt=gt*Da,rt=-_t*Da,ja=0):it<ut?(Da=1/Math.sqrt(ut+Ja),bt=-mt*Da,rt=0,ja=_t*Da):(Da=1/Math.sqrt(Ja+it),bt=gt*Da,rt=-_t*Da,ja=0),u=bt,b=rt,f=ja,n=0}else{var Ta,Fa,Vt;Ta=d*g-Z*p,Fa=Z*L-C*g,Vt=C*p-d*L;var Pt=Math.sqrt((1+Ha)*.5);Ha=.5/Pt,Ta*=Ha,Fa*=Ha,Vt*=Ha,u=Ta,b=Fa,f=Vt,n=Pt}var et=u,Xt=b,Yt=f,zt=n,Ia=2*et,U=2*Xt,Va=2*Yt,lt=et*Ia,P=Xt*U,kt=Yt*Va,Bt=et*U,St=Xt*Va,yt=et*Va,wt=zt*Ia,pt=zt*U,ht=zt*Va;c=1-P-kt,M=Bt-ht,m=yt+pt,y=Bt+ht,V=1-lt-kt,z=St-wt,I=yt-pt,w=St+wt,X=1-lt-P;var xt,Ra,st;if(xt=c*j+M*H+m*E,Ra=y*j+V*H+z*E,st=I*j+w*H+X*E,F=xt,S=Ra,N=st,A=p*N-g*S,Y=g*F-L*N,R=L*S-p*F,A*A+Y*Y+R*R>1e-6){var Ca=A*A+Y*Y+R*R;Ca>0&&(Ca=1/Math.sqrt(Ca)),A*=Ca,Y*=Ca,R*=Ca}else{var vt=L,qa=p,at=g,Ua=vt*vt,tt=qa*qa,ct=at*at,Aa;Ua<tt?Ua<ct?(Aa=1/Math.sqrt(tt+ct),A=0,Y=at*Aa,R=-qa*Aa):(Aa=1/Math.sqrt(Ua+tt),A=qa*Aa,Y=-vt*Aa,R=0):tt<ct?(Aa=1/Math.sqrt(ct+Ua),A=-at*Aa,Y=0,R=vt*Aa):(Aa=1/Math.sqrt(Ua+tt),A=qa*Aa,Y=-vt*Aa,R=0)}F=Y*g-R*p,S=R*L-A*g,N=A*p-Y*L,a.xX=L,a.xY=p,a.xZ=g,a.yX=F,a.yY=S,a.yZ=N,a.zX=A,a.zY=Y,a.zZ=R;var Ga,Ka,La;Ga=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,Ka=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,La=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;var ot=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,It=ot<=-1?3.14159265358979:ot>=1?0:Math.acos(ot),or=Ga*Ga+Ka*Ka+La*La;or>0&&(or=1/Math.sqrt(or)),Ga*=or,Ka*=or,La*=or,Ga*=It,Ka*=It,La*=It,this.angularErrorY=Ga*this._basis.yX+Ka*this._basis.yY+La*this._basis.yZ,this.angularErrorZ=Ga*this._basis.zX+Ka*this._basis.zY+La*this._basis.zZ;var gr,ar,Ct;gr=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,ar=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,Ct=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,ot=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=ot<=-1?3.14159265358979:ot>=1?0:Math.acos(ot),gr*this._basis.xX+ar*this._basis.xY+Ct*this._basis.xZ<0&&(this.angle=-this.angle);var _r,Et,At;_r=this._anchor2X-this._anchor1X,Et=this._anchor2Y-this._anchor1Y,At=this._anchor2Z-this._anchor1Z,this.translation=_r*this._basis.xX+Et*this._basis.xY+At*this._basis.xZ,this.linearErrorY=_r*this._basis.yX+Et*this._basis.yY+At*this._basis.yZ,this.linearErrorZ=_r*this._basis.zX+Et*this._basis.zY+At*this._basis.zZ}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,a}getAxis1To(a){var t=a;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(a){var t=a;t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,a}getLocalAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,a}getLocalAxis1To(a){var t=a;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(a){var t=a;t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTranslationalSpringDamper(){return this._translSd}getRotationalSpringDamper(){return this._rotSd}getTranslationalLimitMotor(){return this._translLm}getRotationalLimitMotor(){return this._rotLm}getAngle(){return this.angle}getTranslation(){return this.translation}};x.dynamics.constraint.joint.JointConfig=class{constructor(){this.rigidBody1=null,this.rigidBody2=null,this.localAnchor1=new x.common.Vec3,this.localAnchor2=new x.common.Vec3,this.allowCollision=!1,this.solverType=x.common.Setting.defaultJointConstraintSolverType,this.positionCorrectionAlgorithm=x.common.Setting.defaultJointPositionCorrectionAlgorithm,this.breakForce=0,this.breakTorque=0}_init(a,t,r){this.rigidBody1=a,this.rigidBody2=t;var i=this.rigidBody1,o,s,_,h=r;o=h.x,s=h.y,_=h.z,o-=i._transform._positionX,s-=i._transform._positionY,_-=i._transform._positionZ;var v,e,l;v=i._transform._rotation00*o+i._transform._rotation10*s+i._transform._rotation20*_,e=i._transform._rotation01*o+i._transform._rotation11*s+i._transform._rotation21*_,l=i._transform._rotation02*o+i._transform._rotation12*s+i._transform._rotation22*_,o=v,s=e,_=l;var u=this.localAnchor1;u.x=o,u.y=s,u.z=_;var b=this.rigidBody2,f,n,c,M=r;f=M.x,n=M.y,c=M.z,f-=b._transform._positionX,n-=b._transform._positionY,c-=b._transform._positionZ;var m,y,V;m=b._transform._rotation00*f+b._transform._rotation10*n+b._transform._rotation20*c,y=b._transform._rotation01*f+b._transform._rotation11*n+b._transform._rotation21*c,V=b._transform._rotation02*f+b._transform._rotation12*n+b._transform._rotation22*c,f=m,n=y,c=V;var z=this.localAnchor2;z.x=f,z.y=n,z.z=c}};x.dynamics.constraint.joint.CylindricalJointConfig=class extends x.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new x.common.Vec3(1,0,0),this.localAxis2=new x.common.Vec3(1,0,0),this.translationalLimitMotor=new x.dynamics.constraint.joint.TranslationalLimitMotor,this.translationalSpringDamper=new x.dynamics.constraint.joint.SpringDamper,this.rotationalLimitMotor=new x.dynamics.constraint.joint.RotationalLimitMotor,this.rotationalSpringDamper=new x.dynamics.constraint.joint.SpringDamper}init(a,t,r,i){this._init(a,t,r);var o,s,_,h=i;o=h.x,s=h.y,_=h.z;var v,e,l;v=a._transform._rotation00*o+a._transform._rotation10*s+a._transform._rotation20*_,e=a._transform._rotation01*o+a._transform._rotation11*s+a._transform._rotation21*_,l=a._transform._rotation02*o+a._transform._rotation12*s+a._transform._rotation22*_,o=v,s=e,_=l;var u=this.localAxis1;u.x=o,u.y=s,u.z=_;var b,f,n,c=i;b=c.x,f=c.y,n=c.z;var M,m,y;M=t._transform._rotation00*b+t._transform._rotation10*f+t._transform._rotation20*n,m=t._transform._rotation01*b+t._transform._rotation11*f+t._transform._rotation21*n,y=t._transform._rotation02*b+t._transform._rotation12*f+t._transform._rotation22*n,b=M,f=m,n=y;var V=this.localAxis2;return V.x=b,V.y=f,V.z=n,this}};x.dynamics.constraint.joint.GenericJoint=class extends x.dynamics.constraint.joint.Joint{constructor(a){super(a,x.dynamics.constraint.joint.JointType.GENERIC);var t,r=a.localBasis1;if(r.e00*(r.e11*r.e22-r.e12*r.e21)-r.e01*(r.e10*r.e22-r.e12*r.e20)+r.e02*(r.e10*r.e21-r.e11*r.e20)<0)t=!0;else{var i=a.localBasis2;t=i.e00*(i.e11*i.e22-i.e12*i.e21)-i.e01*(i.e10*i.e22-i.e12*i.e20)+i.e02*(i.e10*i.e21-i.e11*i.e20)<0}t&&console.log("src/oimo/dynamics/constraint/joint/GenericJoint.hx:50:","[warning] joint basis must be right handed");var o,s,_,h,v,e,l,u,b,f,n,c,M,m,y,V,z,I,w=a.localBasis1;o=w.e00,s=w.e01,_=w.e02,h=w.e10,v=w.e11,e=w.e12,l=w.e20,u=w.e21,b=w.e22;var X=a.localBasis2;f=X.e00,n=X.e01,c=X.e02,M=X.e10,m=X.e11,y=X.e12,V=X.e20,z=X.e21,I=X.e22,this._localBasisX1X=o,this._localBasisX1Y=h,this._localBasisX1Z=l,this._localBasisY1X=s,this._localBasisY1Y=v,this._localBasisY1Z=u,this._localBasisZ1X=_,this._localBasisZ1Y=e,this._localBasisZ1Z=b,this._localBasisX2X=f,this._localBasisX2Y=M,this._localBasisX2Z=V,this._localBasisY2X=n,this._localBasisY2Y=m,this._localBasisY2Z=z,this._localBasisZ2X=c,this._localBasisZ2Y=y,this._localBasisZ2Z=I,this._angleX=0,this._angleY=0,this._angleZ=0,this.translationX=0,this.translationY=0,this.translationZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1;var L=new Array(3);this._translLms=L;var p=new Array(3);this._translSds=p;var g=new Array(3);this._rotLms=g;var F=new Array(3);this._rotSds=F,this._translLms[0]=a.translationalLimitMotors[0].clone(),this._translLms[1]=a.translationalLimitMotors[1].clone(),this._translLms[2]=a.translationalLimitMotors[2].clone(),this._translSds[0]=a.translationalSpringDampers[0].clone(),this._translSds[1]=a.translationalSpringDampers[1].clone(),this._translSds[2]=a.translationalSpringDampers[2].clone(),this._rotLms[0]=a.rotationalLimitMotors[0].clone(),this._rotLms[1]=a.rotationalLimitMotors[1].clone(),this._rotLms[2]=a.rotationalLimitMotors[2].clone(),this._rotSds[0]=a.rotationalSpringDampers[0].clone(),this._rotSds[1]=a.rotationalSpringDampers[1].clone(),this._rotSds[2]=a.rotationalSpringDampers[2].clone()}getInfo(a,t,r){var i,o,s=1/(this._b1._invMass+this._b2._invMass),_=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),h=this.computeEffectiveInertiaMoment(this._axisYX,this._axisYY,this._axisYZ),v=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ);if(this._translSds[0].frequency<=0||!r){var e=this._impulses[0],l=a.rows[a.numRows++],u=l.jacobian;u.lin1X=0,u.lin1Y=0,u.lin1Z=0,u.lin2X=0,u.lin2Y=0,u.lin2Z=0,u.ang1X=0,u.ang1Y=0,u.ang1Z=0,u.ang2X=0,u.ang2Y=0,u.ang2Z=0,l.rhs=0,l.cfm=0,l.minImpulse=0,l.maxImpulse=0,l.motorSpeed=0,l.motorMaxImpulse=0,l.impulse=null,l.impulse=e,i=l,this.setSolverInfoRowLinear(i,this.translationX,this._translLms[0],s,this._translSds[0],t,r),o=i.jacobian,o.lin1X=this._basisX1X,o.lin1Y=this._basisX1Y,o.lin1Z=this._basisX1Z,o.lin2X=this._basisX1X,o.lin2Y=this._basisX1Y,o.lin2Z=this._basisX1Z,o.ang1X=this._relativeAnchor1Y*this._basisX1Z-this._relativeAnchor1Z*this._basisX1Y,o.ang1Y=this._relativeAnchor1Z*this._basisX1X-this._relativeAnchor1X*this._basisX1Z,o.ang1Z=this._relativeAnchor1X*this._basisX1Y-this._relativeAnchor1Y*this._basisX1X,o.ang2X=this._relativeAnchor2Y*this._basisX1Z-this._relativeAnchor2Z*this._basisX1Y,o.ang2Y=this._relativeAnchor2Z*this._basisX1X-this._relativeAnchor2X*this._basisX1Z,o.ang2Z=this._relativeAnchor2X*this._basisX1Y-this._relativeAnchor2Y*this._basisX1X}if(this._translSds[1].frequency<=0||!r){var b=this._impulses[1],f=a.rows[a.numRows++],n=f.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,f.rhs=0,f.cfm=0,f.minImpulse=0,f.maxImpulse=0,f.motorSpeed=0,f.motorMaxImpulse=0,f.impulse=null,f.impulse=b,i=f,this.setSolverInfoRowLinear(i,this.translationY,this._translLms[1],s,this._translSds[1],t,r),o=i.jacobian,o.lin1X=this._basisY1X,o.lin1Y=this._basisY1Y,o.lin1Z=this._basisY1Z,o.lin2X=this._basisY1X,o.lin2Y=this._basisY1Y,o.lin2Z=this._basisY1Z,o.ang1X=this._relativeAnchor1Y*this._basisY1Z-this._relativeAnchor1Z*this._basisY1Y,o.ang1Y=this._relativeAnchor1Z*this._basisY1X-this._relativeAnchor1X*this._basisY1Z,o.ang1Z=this._relativeAnchor1X*this._basisY1Y-this._relativeAnchor1Y*this._basisY1X,o.ang2X=this._relativeAnchor2Y*this._basisY1Z-this._relativeAnchor2Z*this._basisY1Y,o.ang2Y=this._relativeAnchor2Z*this._basisY1X-this._relativeAnchor2X*this._basisY1Z,o.ang2Z=this._relativeAnchor2X*this._basisY1Y-this._relativeAnchor2Y*this._basisY1X}if(this._translSds[2].frequency<=0||!r){var c=this._impulses[2],M=a.rows[a.numRows++],m=M.jacobian;m.lin1X=0,m.lin1Y=0,m.lin1Z=0,m.lin2X=0,m.lin2Y=0,m.lin2Z=0,m.ang1X=0,m.ang1Y=0,m.ang1Z=0,m.ang2X=0,m.ang2Y=0,m.ang2Z=0,M.rhs=0,M.cfm=0,M.minImpulse=0,M.maxImpulse=0,M.motorSpeed=0,M.motorMaxImpulse=0,M.impulse=null,M.impulse=c,i=M,this.setSolverInfoRowLinear(i,this.translationZ,this._translLms[2],s,this._translSds[2],t,r),o=i.jacobian,o.lin1X=this._basisZ1X,o.lin1Y=this._basisZ1Y,o.lin1Z=this._basisZ1Z,o.lin2X=this._basisZ1X,o.lin2Y=this._basisZ1Y,o.lin2Z=this._basisZ1Z,o.ang1X=this._relativeAnchor1Y*this._basisZ1Z-this._relativeAnchor1Z*this._basisZ1Y,o.ang1Y=this._relativeAnchor1Z*this._basisZ1X-this._relativeAnchor1X*this._basisZ1Z,o.ang1Z=this._relativeAnchor1X*this._basisZ1Y-this._relativeAnchor1Y*this._basisZ1X,o.ang2X=this._relativeAnchor2Y*this._basisZ1Z-this._relativeAnchor2Z*this._basisZ1Y,o.ang2Y=this._relativeAnchor2Z*this._basisZ1X-this._relativeAnchor2X*this._basisZ1Z,o.ang2Z=this._relativeAnchor2X*this._basisZ1Y-this._relativeAnchor2Y*this._basisZ1X}if(!this.xSingular&&(this._rotSds[0].frequency<=0||!r)){var y=this._impulses[3],V=a.rows[a.numRows++],z=V.jacobian;z.lin1X=0,z.lin1Y=0,z.lin1Z=0,z.lin2X=0,z.lin2Y=0,z.lin2Z=0,z.ang1X=0,z.ang1Y=0,z.ang1Z=0,z.ang2X=0,z.ang2Y=0,z.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=y,i=V,this.setSolverInfoRowAngular(i,this._angleX,this._rotLms[0],_,this._rotSds[0],t,r),o=i.jacobian,o.ang1X=this._axisXX,o.ang1Y=this._axisXY,o.ang1Z=this._axisXZ,o.ang2X=this._axisXX,o.ang2Y=this._axisXY,o.ang2Z=this._axisXZ}if(!this.ySingular&&(this._rotSds[1].frequency<=0||!r)){var I=this._impulses[4],w=a.rows[a.numRows++],X=w.jacobian;X.lin1X=0,X.lin1Y=0,X.lin1Z=0,X.lin2X=0,X.lin2Y=0,X.lin2Z=0,X.ang1X=0,X.ang1Y=0,X.ang1Z=0,X.ang2X=0,X.ang2Y=0,X.ang2Z=0,w.rhs=0,w.cfm=0,w.minImpulse=0,w.maxImpulse=0,w.motorSpeed=0,w.motorMaxImpulse=0,w.impulse=null,w.impulse=I,i=w,this.setSolverInfoRowAngular(i,this._angleY,this._rotLms[1],h,this._rotSds[1],t,r),o=i.jacobian,o.ang1X=this._axisYX,o.ang1Y=this._axisYY,o.ang1Z=this._axisYZ,o.ang2X=this._axisYX,o.ang2Y=this._axisYY,o.ang2Z=this._axisYZ}if(!this.zSingular&&(this._rotSds[2].frequency<=0||!r)){var L=this._impulses[5],p=a.rows[a.numRows++],g=p.jacobian;g.lin1X=0,g.lin1Y=0,g.lin1Z=0,g.lin2X=0,g.lin2Y=0,g.lin2Z=0,g.ang1X=0,g.ang1Y=0,g.ang1Z=0,g.ang2X=0,g.ang2Y=0,g.ang2Z=0,p.rhs=0,p.cfm=0,p.minImpulse=0,p.maxImpulse=0,p.motorSpeed=0,p.motorMaxImpulse=0,p.impulse=null,p.impulse=L,i=p,this.setSolverInfoRowAngular(i,this._angleZ,this._rotLms[2],v,this._rotSds[2],t,r),o=i.jacobian,o.ang1X=this._axisZX,o.ang1Y=this._axisZY,o.ang1Z=this._axisZZ,o.ang2X=this._axisZX,o.ang2Y=this._axisZY,o.ang2Z=this._axisZZ}}_syncAnchors(){super._syncAnchors(),this._basisX1X,this._basisY1X,this._basisZ1X,this._basisX1Y,this._basisY1Y,this._basisZ1Y,this._basisX1Z,this._basisY1Z,this._basisZ1Z,this._basisX2X,this._basisY2X,this._basisZ2X,this._basisX2Y,this._basisY2Y,this._basisZ2Y,this._basisX2Z,this._basisY2Z,this._basisZ2Z;var a,t,r,i,o,s,_,h,v;a=this._basisX1X,t=this._basisX1Y,r=this._basisX1Z,_=this._basisZ2X,h=this._basisZ2Y,v=this._basisZ2Z,i=h*r-v*t,o=v*a-_*r,s=_*t-h*a,this._axisXX=o*v-s*h,this._axisXY=s*_-i*v,this._axisXZ=i*h-o*_,this._axisYX=i,this._axisYY=o,this._axisYZ=s,this._axisZX=t*s-r*o,this._axisZY=r*i-a*s,this._axisZZ=a*o-t*i;var e=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;e>0&&(e=1/Math.sqrt(e)),this._axisXX*=e,this._axisXY*=e,this._axisXZ*=e;var l=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;l>0&&(l=1/Math.sqrt(l)),this._axisYX*=l,this._axisYY*=l,this._axisYZ*=l;var u=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;u>0&&(u=1/Math.sqrt(u)),this._axisZX*=u,this._axisZY*=u,this._axisZZ*=u,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0;var b,f,n,c,M,m,y,V,z,I,w,X,L,p,g,F,S,N;b=this._basisX1X,f=this._basisY1X,n=this._basisZ1X,c=this._basisX1Y,M=this._basisY1Y,m=this._basisZ1Y,y=this._basisX1Z,V=this._basisY1Z,z=this._basisZ1Z,I=this._basisX2X,w=this._basisY2X,X=this._basisZ2X,L=this._basisX2Y,p=this._basisY2Y,g=this._basisZ2Y,F=this._basisX2Z,S=this._basisY2Z,N=this._basisZ2Z;var A,Y,R,C,d,Z,j,H,E,G,B,Q,W,J;H=b*I+c*L+y*F,E=b*w+c*p+y*S,G=b*X+c*g+y*N,B=f*w+M*p+V*S,Q=f*X+M*g+V*N,W=n*w+m*p+z*S,J=n*X+m*g+z*N,A=H,Y=E,R=G,C=B,d=Q,Z=W,j=J;var D,O,K,ra=R;if(ra<=-1){var sa=Math.atan2(Z,C);D=sa*.5,O=-1.570796326794895,K=-sa*.5}else if(ra>=1){var $=Math.atan2(Z,C);D=$*.5,O=1.570796326794895,K=$*.5}else{var q=Math.asin(ra),na=Math.atan2(-d,j),oa=Math.atan2(-Y,A);D=na,O=q,K=oa}this._angleX=D,this._angleY=O,this._angleZ=K;var aa,T,ca;aa=this._anchor2X-this._anchor1X,T=this._anchor2Y-this._anchor1Y,ca=this._anchor2Z-this._anchor1Z,this.translationX=aa*this._basisX1X+T*this._basisX1Y+ca*this._basisX1Z,this.translationY=aa*this._basisY1X+T*this._basisY1Y+ca*this._basisY1Z,this.translationZ=aa*this._basisZ1X+T*this._basisZ1Y+ca*this._basisZ1Z}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxisX(){var a=new x.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxisY(){var a=new x.common.Vec3,t=a;return t.x=this._axisYX,t.y=this._axisYY,t.z=this._axisYZ,a}getAxisZ(){var a=new x.common.Vec3,t=a;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,a}getTranslationalSpringDampers(){return this._translSds.slice(0)}getRotationalSpringDampers(){return this._translSds.slice(0)}getTranslationalLimitMotors(){return this._translLms.slice(0)}getRotationalLimitMotors(){return this._rotLms.slice(0)}getAngles(){return new x.common.Vec3(this._angleX,this._angleY,this._angleZ)}getTranslations(){return new x.common.Vec3(this.translationX,this.translationY,this.translationZ)}};x.dynamics.constraint.joint.GenericJointConfig=class extends x.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localBasis1=new x.common.Mat3,this.localBasis2=new x.common.Mat3;var a=[];a.push(new x.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),a.push(new x.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),a.push(new x.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),this.translationalLimitMotors=a;var t=[];t.push(new x.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),t.push(new x.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),t.push(new x.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),this.rotationalLimitMotors=t,this.translationalSpringDampers=[new x.dynamics.constraint.joint.SpringDamper,new x.dynamics.constraint.joint.SpringDamper,new x.dynamics.constraint.joint.SpringDamper],this.rotationalSpringDampers=[new x.dynamics.constraint.joint.SpringDamper,new x.dynamics.constraint.joint.SpringDamper,new x.dynamics.constraint.joint.SpringDamper]}init(a,t,r,i,o){this._init(a,t,r);var s=a._transform,_=t._transform,h,v,e,l,u,b,f,n,c,M,m,y,V,z,I,w,X,L,p,g,F,S,N,A,Y,R,C,d,Z,j,H,E,G,B,Q,W,J=i;h=J.e00,v=J.e01,e=J.e02,l=J.e10,u=J.e11,b=J.e12,f=J.e20,n=J.e21,c=J.e22;var D=o;M=D.e00,m=D.e01,y=D.e02,V=D.e10,z=D.e11,I=D.e12,w=D.e20,X=D.e21,L=D.e22;var O,K,ra,sa,$,q,na,oa,aa;O=s._rotation00*h+s._rotation10*l+s._rotation20*f,K=s._rotation00*v+s._rotation10*u+s._rotation20*n,ra=s._rotation00*e+s._rotation10*b+s._rotation20*c,sa=s._rotation01*h+s._rotation11*l+s._rotation21*f,$=s._rotation01*v+s._rotation11*u+s._rotation21*n,q=s._rotation01*e+s._rotation11*b+s._rotation21*c,na=s._rotation02*h+s._rotation12*l+s._rotation22*f,oa=s._rotation02*v+s._rotation12*u+s._rotation22*n,aa=s._rotation02*e+s._rotation12*b+s._rotation22*c,p=O,g=K,F=ra,S=sa,N=$,A=q,Y=na,R=oa,C=aa;var T,ca,_a,k,ta,ia,la,va,xa;T=_._rotation00*M+_._rotation10*V+_._rotation20*w,ca=_._rotation00*m+_._rotation10*z+_._rotation20*X,_a=_._rotation00*y+_._rotation10*I+_._rotation20*L,k=_._rotation01*M+_._rotation11*V+_._rotation21*w,ta=_._rotation01*m+_._rotation11*z+_._rotation21*X,ia=_._rotation01*y+_._rotation11*I+_._rotation21*L,la=_._rotation02*M+_._rotation12*V+_._rotation22*w,va=_._rotation02*m+_._rotation12*z+_._rotation22*X,xa=_._rotation02*y+_._rotation12*I+_._rotation22*L,d=T,Z=ca,j=_a,H=k,E=ta,G=ia,B=la,Q=va,W=xa;var Ma=this.localBasis1;Ma.e00=p,Ma.e01=g,Ma.e02=F,Ma.e10=S,Ma.e11=N,Ma.e12=A,Ma.e20=Y,Ma.e21=R,Ma.e22=C;var za=this.localBasis2;return za.e00=d,za.e01=Z,za.e02=j,za.e10=H,za.e11=E,za.e12=G,za.e20=B,za.e21=Q,za.e22=W,this}};x.dynamics.constraint.joint.JointImpulse=class{constructor(){this.impulse=0,this.impulseM=0,this.impulseP=0}};x.dynamics.constraint.joint.JointLink=class{constructor(a){this._joint=a}getContact(){return this._joint}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}};x.dynamics.constraint.joint.JointMacro=class{};x.dynamics.constraint.joint.JointType=class{};x.dynamics.constraint.joint.PrismaticJoint=class extends x.dynamics.constraint.joint.Joint{constructor(a){super(a,x.dynamics.constraint.joint.JointType.PRISMATIC);var t=a.localAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var r=a.localAxis2;this._localBasisX2X=r.x,this._localBasisX2Y=r.y,this._localBasisX2Z=r.z,this.buildLocalBasesFromX(),this._basis=new x.dynamics.constraint.joint.BasisTracker(this),this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this.angularErrorX=0,this.angularErrorY=0,this.angularErrorZ=0,this._sd=a.springDamper.clone(),this._lm=a.limitMotor.clone()}getInfo(a,t,r){var i=this.getErp(t,r),o=this.linearErrorY*i,s=this.linearErrorZ*i,_=this.angularErrorX*i,h=this.angularErrorY*i,v=this.angularErrorZ*i,e,l,u=1/(this._b1._invMass+this._b2._invMass);if(this._sd.frequency<=0||!r){var b=this._impulses[0],f=a.rows[a.numRows++],n=f.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,f.rhs=0,f.cfm=0,f.minImpulse=0,f.maxImpulse=0,f.motorSpeed=0,f.motorMaxImpulse=0,f.impulse=null,f.impulse=b,e=f,this.setSolverInfoRowLinear(e,this.translation,this._lm,u,this._sd,t,r),l=e.jacobian,l.lin1X=this._basis.xX,l.lin1Y=this._basis.xY,l.lin1Z=this._basis.xZ,l.lin2X=this._basis.xX,l.lin2Y=this._basis.xY,l.lin2Z=this._basis.xZ,l.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,l.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,l.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,l.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,l.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,l.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}var c=this._impulses[1],M=a.rows[a.numRows++],m=M.jacobian;m.lin1X=0,m.lin1Y=0,m.lin1Z=0,m.lin2X=0,m.lin2Y=0,m.lin2Z=0,m.ang1X=0,m.ang1Y=0,m.ang1Z=0,m.ang2X=0,m.ang2Y=0,m.ang2Z=0,M.rhs=0,M.cfm=0,M.minImpulse=0,M.maxImpulse=0,M.motorSpeed=0,M.motorMaxImpulse=0,M.impulse=null,M.impulse=c,e=M,e.rhs=o,e.cfm=0,e.minImpulse=-1/0,e.maxImpulse=1/0,l=e.jacobian,l.lin1X=this._basis.yX,l.lin1Y=this._basis.yY,l.lin1Z=this._basis.yZ,l.lin2X=this._basis.yX,l.lin2Y=this._basis.yY,l.lin2Z=this._basis.yZ,l.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,l.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,l.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,l.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,l.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,l.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;var y=this._impulses[2],V=a.rows[a.numRows++],z=V.jacobian;z.lin1X=0,z.lin1Y=0,z.lin1Z=0,z.lin2X=0,z.lin2Y=0,z.lin2Z=0,z.ang1X=0,z.ang1Y=0,z.ang1Z=0,z.ang2X=0,z.ang2Y=0,z.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=y,e=V,e.rhs=s,e.cfm=0,e.minImpulse=-1/0,e.maxImpulse=1/0,l=e.jacobian,l.lin1X=this._basis.zX,l.lin1Y=this._basis.zY,l.lin1Z=this._basis.zZ,l.lin2X=this._basis.zX,l.lin2Y=this._basis.zY,l.lin2Z=this._basis.zZ,l.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,l.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,l.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,l.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,l.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,l.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX;var I=this._impulses[3],w=a.rows[a.numRows++],X=w.jacobian;X.lin1X=0,X.lin1Y=0,X.lin1Z=0,X.lin2X=0,X.lin2Y=0,X.lin2Z=0,X.ang1X=0,X.ang1Y=0,X.ang1Z=0,X.ang2X=0,X.ang2Y=0,X.ang2Z=0,w.rhs=0,w.cfm=0,w.minImpulse=0,w.maxImpulse=0,w.motorSpeed=0,w.motorMaxImpulse=0,w.impulse=null,w.impulse=I,e=w,e.rhs=_,e.cfm=0,e.minImpulse=-1/0,e.maxImpulse=1/0,l=e.jacobian,l.ang1X=1,l.ang1Y=0,l.ang1Z=0,l.ang2X=1,l.ang2Y=0,l.ang2Z=0;var L=this._impulses[4],p=a.rows[a.numRows++],g=p.jacobian;g.lin1X=0,g.lin1Y=0,g.lin1Z=0,g.lin2X=0,g.lin2Y=0,g.lin2Z=0,g.ang1X=0,g.ang1Y=0,g.ang1Z=0,g.ang2X=0,g.ang2Y=0,g.ang2Z=0,p.rhs=0,p.cfm=0,p.minImpulse=0,p.maxImpulse=0,p.motorSpeed=0,p.motorMaxImpulse=0,p.impulse=null,p.impulse=L,e=p,e.rhs=h,e.cfm=0,e.minImpulse=-1/0,e.maxImpulse=1/0,l=e.jacobian,l.ang1X=0,l.ang1Y=1,l.ang1Z=0,l.ang2X=0,l.ang2Y=1,l.ang2Z=0;var F=this._impulses[5],S=a.rows[a.numRows++],N=S.jacobian;N.lin1X=0,N.lin1Y=0,N.lin1Z=0,N.lin2X=0,N.lin2Y=0,N.lin2Z=0,N.ang1X=0,N.ang1Y=0,N.ang1Z=0,N.ang2X=0,N.ang2Y=0,N.ang2Z=0,S.rhs=0,S.cfm=0,S.minImpulse=0,S.maxImpulse=0,S.motorSpeed=0,S.motorMaxImpulse=0,S.impulse=null,S.impulse=F,e=S,e.rhs=v,e.cfm=0,e.minImpulse=-1/0,e.maxImpulse=1/0,l=e.jacobian,l.ang1X=0,l.ang1Y=0,l.ang1Z=1,l.ang2X=0,l.ang2Y=0,l.ang2Z=1}_syncAnchors(){super._syncAnchors();var a=this._basis,t=a.joint._b1._invMass,r=a.joint._b2._invMass,i,o,s,_,h,v,e,l,u,b,f,n,c,M,m,y,V,z,I,w,X,L,p,g,F,S,N,A,Y,R,C,d,Z,j,H,E,G=a.joint._basisX1X*a.joint._basisX2X+a.joint._basisX1Y*a.joint._basisX2Y+a.joint._basisX1Z*a.joint._basisX2Z;if(G<-.999999999){var B,Q,W,J=a.joint._basisX1X,D=a.joint._basisX1Y,O=a.joint._basisX1Z,K=J*J,ra=D*D,sa=O*O,$;K<ra?K<sa?($=1/Math.sqrt(ra+sa),B=0,Q=O*$,W=-D*$):($=1/Math.sqrt(K+ra),B=D*$,Q=-J*$,W=0):ra<sa?($=1/Math.sqrt(sa+K),B=-O*$,Q=0,W=J*$):($=1/Math.sqrt(K+ra),B=D*$,Q=-J*$,W=0),i=B,o=Q,s=W,_=0}else{var q,na,oa;q=a.joint._basisX1Y*a.joint._basisX2Z-a.joint._basisX1Z*a.joint._basisX2Y,na=a.joint._basisX1Z*a.joint._basisX2X-a.joint._basisX1X*a.joint._basisX2Z,oa=a.joint._basisX1X*a.joint._basisX2Y-a.joint._basisX1Y*a.joint._basisX2X;var aa=Math.sqrt((1+G)*.5);G=.5/aa,q*=G,na*=G,oa*=G,i=q,o=na,s=oa,_=aa}h=0,v=0,e=0,l=1;var T,ca,_a,k,ta,ia,la,va;T=h,ca=v,_a=e,k=l,ta=i,ia=o,la=s,va=_;var xa=T*ta+ca*ia+_a*la+k*va;if(xa<0&&(xa=-xa,ta=-ta,ia=-ia,la=-la,va=-va),xa>.999999){var Ma,za,Xa,Za;Ma=ta-T,za=ia-ca,Xa=la-_a,Za=va-k,ta=T+Ma*(t/(t+r)),ia=ca+za*(t/(t+r)),la=_a+Xa*(t/(t+r)),va=k+Za*(t/(t+r));var fa=ta*ta+ia*ia+la*la+va*va;fa>1e-32&&(fa=1/Math.sqrt(fa)),u=ta*fa,b=ia*fa,f=la*fa,n=va*fa}else{var ba=t/(t+r)*Math.acos(xa);ta+=T*-xa,ia+=ca*-xa,la+=_a*-xa,va+=k*-xa;var ea=ta*ta+ia*ia+la*la+va*va;ea>1e-32&&(ea=1/Math.sqrt(ea)),ta*=ea,ia*=ea,la*=ea,va*=ea;var ha=Math.sin(ba),pa=Math.cos(ba);T*=pa,ca*=pa,_a*=pa,k*=pa,u=T+ta*ha,b=ca+ia*ha,f=_a+la*ha,n=k+va*ha}var ya=u,da=b,ma=f,Ya=n,Qa=2*ya,ga=2*da,ua=2*ma,ka=ya*Qa,wa=da*ga,Pa=ma*ua,Mt=ya*ga,Oa=da*ua,Ba=ya*ua,nt=Ya*Qa,Ea=Ya*ga,Na=Ya*ua;c=1-wa-Pa,M=Mt-Na,m=Ba+Ea,y=Mt+Na,V=1-ka-Pa,z=Oa-nt,I=Ba-Ea,w=Oa+nt,X=1-ka-wa;var Sa,ft,Wa;Sa=c*a.joint._basisX1X+M*a.joint._basisX1Y+m*a.joint._basisX1Z,ft=y*a.joint._basisX1X+V*a.joint._basisX1Y+z*a.joint._basisX1Z,Wa=I*a.joint._basisX1X+w*a.joint._basisX1Y+X*a.joint._basisX1Z,L=Sa,p=ft,g=Wa,C=a.xX,d=a.xY,Z=a.xZ,j=a.yX,H=a.yY,E=a.yZ;var Ha=C*L+d*p+Z*g;if(Ha<-.999999999){var bt,rt,ja,_t=C,gt=d,mt=Z,Ja=_t*_t,it=gt*gt,ut=mt*mt,Da;Ja<it?Ja<ut?(Da=1/Math.sqrt(it+ut),bt=0,rt=mt*Da,ja=-gt*Da):(Da=1/Math.sqrt(Ja+it),bt=gt*Da,rt=-_t*Da,ja=0):it<ut?(Da=1/Math.sqrt(ut+Ja),bt=-mt*Da,rt=0,ja=_t*Da):(Da=1/Math.sqrt(Ja+it),bt=gt*Da,rt=-_t*Da,ja=0),u=bt,b=rt,f=ja,n=0}else{var Ta,Fa,Vt;Ta=d*g-Z*p,Fa=Z*L-C*g,Vt=C*p-d*L;var Pt=Math.sqrt((1+Ha)*.5);Ha=.5/Pt,Ta*=Ha,Fa*=Ha,Vt*=Ha,u=Ta,b=Fa,f=Vt,n=Pt}var et=u,Xt=b,Yt=f,zt=n,Ia=2*et,U=2*Xt,Va=2*Yt,lt=et*Ia,P=Xt*U,kt=Yt*Va,Bt=et*U,St=Xt*Va,yt=et*Va,wt=zt*Ia,pt=zt*U,ht=zt*Va;c=1-P-kt,M=Bt-ht,m=yt+pt,y=Bt+ht,V=1-lt-kt,z=St-wt,I=yt-pt,w=St+wt,X=1-lt-P;var xt,Ra,st;if(xt=c*j+M*H+m*E,Ra=y*j+V*H+z*E,st=I*j+w*H+X*E,F=xt,S=Ra,N=st,A=p*N-g*S,Y=g*F-L*N,R=L*S-p*F,A*A+Y*Y+R*R>1e-6){var Ca=A*A+Y*Y+R*R;Ca>0&&(Ca=1/Math.sqrt(Ca)),A*=Ca,Y*=Ca,R*=Ca}else{var vt=L,qa=p,at=g,Ua=vt*vt,tt=qa*qa,ct=at*at,Aa;Ua<tt?Ua<ct?(Aa=1/Math.sqrt(tt+ct),A=0,Y=at*Aa,R=-qa*Aa):(Aa=1/Math.sqrt(Ua+tt),A=qa*Aa,Y=-vt*Aa,R=0):tt<ct?(Aa=1/Math.sqrt(ct+Ua),A=-at*Aa,Y=0,R=vt*Aa):(Aa=1/Math.sqrt(Ua+tt),A=qa*Aa,Y=-vt*Aa,R=0)}F=Y*g-R*p,S=R*L-A*g,N=A*p-Y*L,a.xX=L,a.xY=p,a.xZ=g,a.yX=F,a.yY=S,a.yZ=N,a.zX=A,a.zY=Y,a.zZ=R;var Ga,Ka,La,ot,It,or,gr,ar,Ct,_r,Et,At,Gt,Hr,vr,lr,tr,Ur;Ga=this._basisX1X,Ka=this._basisY1X,La=this._basisZ1X,ot=this._basisX1Y,It=this._basisY1Y,or=this._basisZ1Y,gr=this._basisX1Z,ar=this._basisY1Z,Ct=this._basisZ1Z,_r=this._basisX2X,Et=this._basisY2X,At=this._basisZ2X,Gt=this._basisX2Y,Hr=this._basisY2Y,vr=this._basisZ2Y,lr=this._basisX2Z,tr=this._basisY2Z,Ur=this._basisZ2Z;var Xr,Mr,Zt,ir,$t,nr,jr,Wt,Kr,Ir,mi,$r,Lt,Kt,Tt,br,zr,vi;Ir=_r*Ga+Et*Ka+At*La,mi=_r*ot+Et*It+At*or,$r=_r*gr+Et*ar+At*Ct,Lt=Gt*Ga+Hr*Ka+vr*La,Kt=Gt*ot+Hr*It+vr*or,Tt=Gt*gr+Hr*ar+vr*Ct,br=lr*Ga+tr*Ka+Ur*La,zr=lr*ot+tr*It+Ur*or,vi=lr*gr+tr*ar+Ur*Ct,Xr=Ir,Mr=mi,Zt=$r,ir=Lt,$t=Kt,nr=Tt,jr=br,Wt=zr,Kr=vi;var qt,fr,dt,ur,hr=Xr,ei=$t,Xi=Kr,oo=hr+ei+Xi,Jt;oo>0?(Jt=Math.sqrt(oo+1),ur=.5*Jt,Jt=.5/Jt,qt=(Wt-nr)*Jt,fr=(Zt-jr)*Jt,dt=(ir-Mr)*Jt):hr>ei?hr>Xi?(Jt=Math.sqrt(hr-ei-Xi+1),qt=.5*Jt,Jt=.5/Jt,fr=(Mr+ir)*Jt,dt=(Zt+jr)*Jt,ur=(Wt-nr)*Jt):(Jt=Math.sqrt(Xi-hr-ei+1),dt=.5*Jt,Jt=.5/Jt,qt=(Zt+jr)*Jt,fr=(nr+Wt)*Jt,ur=(ir-Mr)*Jt):ei>Xi?(Jt=Math.sqrt(ei-Xi-hr+1),fr=.5*Jt,Jt=.5/Jt,qt=(Mr+ir)*Jt,dt=(nr+Wt)*Jt,ur=(Zt-jr)*Jt):(Jt=Math.sqrt(Xi-hr-ei+1),dt=.5*Jt,Jt=.5/Jt,qt=(Zt+jr)*Jt,fr=(nr+Wt)*Jt,ur=(ir-Mr)*Jt);var fi=ur,pi=(fi<=-1?3.14159265358979:fi>=1?0:Math.acos(fi))*2;this.angularErrorX=qt,this.angularErrorY=fr,this.angularErrorZ=dt;var Dt=this.angularErrorX*this.angularErrorX+this.angularErrorY*this.angularErrorY+this.angularErrorZ*this.angularErrorZ;Dt>0&&(Dt=1/Math.sqrt(Dt)),this.angularErrorX*=Dt,this.angularErrorY*=Dt,this.angularErrorZ*=Dt,this.angularErrorX*=pi,this.angularErrorY*=pi,this.angularErrorZ*=pi;var Bi,Ar,Ni;Bi=this._anchor2X-this._anchor1X,Ar=this._anchor2Y-this._anchor1Y,Ni=this._anchor2Z-this._anchor1Z,this.translation=Bi*this._basis.xX+Ar*this._basis.xY+Ni*this._basis.xZ,this.linearErrorY=Bi*this._basis.yX+Ar*this._basis.yY+Ni*this._basis.yZ,this.linearErrorZ=Bi*this._basis.zX+Ar*this._basis.zY+Ni*this._basis.zZ}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,a}getAxis1To(a){var t=a;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(a){var t=a;t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,a}getLocalAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,a}getLocalAxis1To(a){var t=a;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(a){var t=a;t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getTranslation(){return this.translation}};x.dynamics.constraint.joint.PrismaticJointConfig=class extends x.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new x.common.Vec3(1,0,0),this.localAxis2=new x.common.Vec3(1,0,0),this.limitMotor=new x.dynamics.constraint.joint.TranslationalLimitMotor,this.springDamper=new x.dynamics.constraint.joint.SpringDamper}init(a,t,r,i){this._init(a,t,r);var o,s,_,h=i;o=h.x,s=h.y,_=h.z;var v,e,l;v=a._transform._rotation00*o+a._transform._rotation10*s+a._transform._rotation20*_,e=a._transform._rotation01*o+a._transform._rotation11*s+a._transform._rotation21*_,l=a._transform._rotation02*o+a._transform._rotation12*s+a._transform._rotation22*_,o=v,s=e,_=l;var u=this.localAxis1;u.x=o,u.y=s,u.z=_;var b,f,n,c=i;b=c.x,f=c.y,n=c.z;var M,m,y;M=t._transform._rotation00*b+t._transform._rotation10*f+t._transform._rotation20*n,m=t._transform._rotation01*b+t._transform._rotation11*f+t._transform._rotation21*n,y=t._transform._rotation02*b+t._transform._rotation12*f+t._transform._rotation22*n,b=M,f=m,n=y;var V=this.localAxis2;return V.x=b,V.y=f,V.z=n,this}};x.dynamics.constraint.joint.RagdollJoint=class extends x.dynamics.constraint.joint.Joint{constructor(a){super(a,x.dynamics.constraint.joint.JointType.RAGDOLL);var t=a.localTwistAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var r=a.localSwingAxis1;this._localBasisY1X=r.x,this._localBasisY1Y=r.y,this._localBasisY1Z=r.z;var i=a.localTwistAxis2;this._localBasisX2X=i.x,this._localBasisX2Y=i.y,this._localBasisX2Z=i.z,this.buildLocalBasesFromXY1X2(),this._twistSd=a.twistSpringDamper.clone(),this._twistLm=a.twistLimitMotor.clone(),this._swingSd=a.swingSpringDamper.clone(),this._maxSwingAngle1=a.maxSwingAngle1,this._maxSwingAngle2=a.maxSwingAngle2,this._maxSwingAngle1<x.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle1=x.common.Setting.minRagdollMaxSwingAngle),this._maxSwingAngle2<x.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle2=x.common.Setting.minRagdollMaxSwingAngle),this.dummySwingLm=new x.dynamics.constraint.joint.RotationalLimitMotor,this.dummySwingLm.lowerLimit=-1,this.dummySwingLm.upperLimit=0,this._swingAngle=0,this._twistAngle=0,this.swingError=0,this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.twistAxisX=0,this.twistAxisY=0,this.twistAxisZ=0}getInfo(a,t,r){var i=this.getErp(t,r),o,s,_;o=this.linearErrorX*i,s=this.linearErrorY*i,_=this.linearErrorZ*i;var h=o,v=s,e=_,l,u,b,f,n,c,M,m,y,V,z,I,w,X,L,p,g,F;l=0,u=-this._relativeAnchor1Z,b=this._relativeAnchor1Y,f=this._relativeAnchor1Z,n=0,c=-this._relativeAnchor1X,M=-this._relativeAnchor1Y,m=this._relativeAnchor1X,y=0,V=0,z=-this._relativeAnchor2Z,I=this._relativeAnchor2Y,w=this._relativeAnchor2Z,X=0,L=-this._relativeAnchor2X,p=-this._relativeAnchor2Y,g=this._relativeAnchor2X,F=0,l=-l,u=-u,b=-b,f=-f,n=-n,c=-c,M=-M,m=-m,y=-y,V=-V,z=-z,I=-I,w=-w,X=-X,L=-L,p=-p,g=-g,F=-F;var S=this.computeEffectiveInertiaMoment(this.swingAxisX,this.swingAxisY,this.swingAxisZ),N=this.computeEffectiveInertiaMoment(this._basisX2X,this._basisX2Y,this._basisX2Z),A=this._impulses[0],Y=a.rows[a.numRows++],R=Y.jacobian;R.lin1X=0,R.lin1Y=0,R.lin1Z=0,R.lin2X=0,R.lin2Y=0,R.lin2Z=0,R.ang1X=0,R.ang1Y=0,R.ang1Z=0,R.ang2X=0,R.ang2Y=0,R.ang2Z=0,Y.rhs=0,Y.cfm=0,Y.minImpulse=0,Y.maxImpulse=0,Y.motorSpeed=0,Y.motorMaxImpulse=0,Y.impulse=null,Y.impulse=A;var C=Y;C.rhs=h,C.cfm=0,C.minImpulse=-1/0,C.maxImpulse=1/0;var d=C.jacobian;d.lin1X=1,d.lin1Y=0,d.lin1Z=0,d.lin2X=1,d.lin2Y=0,d.lin2Z=0,d.ang1X=l,d.ang1Y=u,d.ang1Z=b,d.ang2X=V,d.ang2Y=z,d.ang2Z=I;var Z=this._impulses[1],j=a.rows[a.numRows++],H=j.jacobian;H.lin1X=0,H.lin1Y=0,H.lin1Z=0,H.lin2X=0,H.lin2Y=0,H.lin2Z=0,H.ang1X=0,H.ang1Y=0,H.ang1Z=0,H.ang2X=0,H.ang2Y=0,H.ang2Z=0,j.rhs=0,j.cfm=0,j.minImpulse=0,j.maxImpulse=0,j.motorSpeed=0,j.motorMaxImpulse=0,j.impulse=null,j.impulse=Z,C=j,C.rhs=v,C.cfm=0,C.minImpulse=-1/0,C.maxImpulse=1/0,d=C.jacobian,d.lin1X=0,d.lin1Y=1,d.lin1Z=0,d.lin2X=0,d.lin2Y=1,d.lin2Z=0,d.ang1X=f,d.ang1Y=n,d.ang1Z=c,d.ang2X=w,d.ang2Y=X,d.ang2Z=L;var E=this._impulses[2],G=a.rows[a.numRows++],B=G.jacobian;if(B.lin1X=0,B.lin1Y=0,B.lin1Z=0,B.lin2X=0,B.lin2Y=0,B.lin2Z=0,B.ang1X=0,B.ang1Y=0,B.ang1Z=0,B.ang2X=0,B.ang2Y=0,B.ang2Z=0,G.rhs=0,G.cfm=0,G.minImpulse=0,G.maxImpulse=0,G.motorSpeed=0,G.motorMaxImpulse=0,G.impulse=null,G.impulse=E,C=G,C.rhs=e,C.cfm=0,C.minImpulse=-1/0,C.maxImpulse=1/0,d=C.jacobian,d.lin1X=0,d.lin1Y=0,d.lin1Z=1,d.lin2X=0,d.lin2Y=0,d.lin2Z=1,d.ang1X=M,d.ang1Y=m,d.ang1Z=y,d.ang2X=p,d.ang2Y=g,d.ang2Z=F,this.swingError>0&&(this._swingSd.frequency<=0||!r)){var Q=this._impulses[3],W=a.rows[a.numRows++],J=W.jacobian;J.lin1X=0,J.lin1Y=0,J.lin1Z=0,J.lin2X=0,J.lin2Y=0,J.lin2Z=0,J.ang1X=0,J.ang1Y=0,J.ang1Z=0,J.ang2X=0,J.ang2Y=0,J.ang2Z=0,W.rhs=0,W.cfm=0,W.minImpulse=0,W.maxImpulse=0,W.motorSpeed=0,W.motorMaxImpulse=0,W.impulse=null,W.impulse=Q,C=W,this.setSolverInfoRowAngular(C,this.swingError,this.dummySwingLm,S,this._swingSd,t,r),d=C.jacobian,d.ang1X=this.swingAxisX,d.ang1Y=this.swingAxisY,d.ang1Z=this.swingAxisZ,d.ang2X=this.swingAxisX,d.ang2Y=this.swingAxisY,d.ang2Z=this.swingAxisZ}if(this._twistSd.frequency<=0||!r){var D=this._impulses[4],O=a.rows[a.numRows++],K=O.jacobian;K.lin1X=0,K.lin1Y=0,K.lin1Z=0,K.lin2X=0,K.lin2Y=0,K.lin2Z=0,K.ang1X=0,K.ang1Y=0,K.ang1Z=0,K.ang2X=0,K.ang2Y=0,K.ang2Z=0,O.rhs=0,O.cfm=0,O.minImpulse=0,O.maxImpulse=0,O.motorSpeed=0,O.motorMaxImpulse=0,O.impulse=null,O.impulse=D,C=O,this.setSolverInfoRowAngular(C,this._twistAngle,this._twistLm,N,this._twistSd,t,r),d=C.jacobian,d.ang1X=this.twistAxisX,d.ang1Y=this.twistAxisY,d.ang1Z=this.twistAxisZ,d.ang2X=this.twistAxisX,d.ang2Y=this.twistAxisY,d.ang2Z=this.twistAxisZ}}_syncAnchors(){super._syncAnchors(),this._b1._transform,this._b2._transform;var a,t,r,i,o,s;a=this._basisX1X,t=this._basisX1Y,r=this._basisX1Z,i=this._basisX2X,o=this._basisX2Y,s=this._basisX2Z;var _,h,v,e,l,u,b,f,n;_=this._basisX1X,h=this._basisY1X,v=this._basisZ1X,e=this._basisX1Y,l=this._basisY1Y,u=this._basisZ1Y,b=this._basisX1Z,f=this._basisY1Z,n=this._basisZ1Z,this._basisX2X,this._basisY2X,this._basisZ2X,this._basisX2Y,this._basisY2Y,this._basisZ2Y,this._basisX2Z,this._basisY2Z,this._basisZ2Z;var c,M,m,y,V,z,I,w,X,L,p,g,F,S,N,A,Y=a*i+t*o+r*s;if(Y<-.999999999){var R,C,d,Z=a,j=t,H=r,E=Z*Z,G=j*j,B=H*H,Q;E<G?E<B?(Q=1/Math.sqrt(G+B),R=0,C=H*Q,d=-j*Q):(Q=1/Math.sqrt(E+G),R=j*Q,C=-Z*Q,d=0):G<B?(Q=1/Math.sqrt(B+E),R=-H*Q,C=0,d=Z*Q):(Q=1/Math.sqrt(E+G),R=j*Q,C=-Z*Q,d=0),c=R,M=C,m=d,y=0}else{var W,J,D;W=t*s-r*o,J=r*i-a*s,D=a*o-t*i;var O=Math.sqrt((1+Y)*.5);Y=.5/O,W*=Y,J*=Y,D*=Y,c=W,M=J,m=D,y=O}var K=c,ra=M,sa=m,$=y,q=2*K,na=2*ra,oa=2*sa,aa=K*q,T=ra*na,ca=sa*oa,_a=K*na,k=ra*oa,ta=K*oa,ia=$*q,la=$*na,va=$*oa;V=1-T-ca,z=_a-va,I=ta+la,w=_a+va,X=1-aa-ca,L=k-ia,p=ta-la,g=k+ia,F=1-aa-T,this._swingAngle=(y<=-1?3.14159265358979:y>=1?0:Math.acos(y))*2,S=c,N=M,A=m;var xa,Ma,za,Xa,Za,fa;Xa=V*this._basisY2X+w*this._basisY2Y+p*this._basisY2Z,Za=z*this._basisY2X+X*this._basisY2Y+g*this._basisY2Z,fa=I*this._basisY2X+L*this._basisY2Y+F*this._basisY2Z,xa=Xa,Ma=Za,za=fa;var ba=this._basisY1X*xa+this._basisY1Y*Ma+this._basisY1Z*za,ea=this._basisZ1X*xa+this._basisZ1Y*Ma+this._basisZ1Z*za;this._twistAngle=Math.atan2(ea,ba),this.twistAxisX=this._basisX1X+this._basisX2X,this.twistAxisY=this._basisX1Y+this._basisX2Y,this.twistAxisZ=this._basisX1Z+this._basisX2Z;var ha=this.twistAxisX*this.twistAxisX+this.twistAxisY*this.twistAxisY+this.twistAxisZ*this.twistAxisZ;ha>0&&(ha=1/Math.sqrt(ha)),this.twistAxisX*=ha,this.twistAxisY*=ha,this.twistAxisZ*=ha;var pa=Math.sqrt(S*S+N*N+A*A);pa>0&&(pa=1/pa),S*=pa*this._swingAngle,N*=pa*this._swingAngle,A*=pa*this._swingAngle;var ya,da,ma;ya=_*S+e*N+b*A,da=h*S+l*N+f*A,ma=v*S+u*N+n*A,S=ya,N=da,A=ma;var Ya=N,Qa=A,ga=this._maxSwingAngle1,ua=this._maxSwingAngle2,ka=1/(ga*ga),wa=1/(ua*ua),Pa=Ya*Ya*ka+Qa*Qa*wa;if(Pa==0)this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.swingError=0;else{var Mt=Math.sqrt(1/Pa),Oa=Ya*Mt,Ba=Qa*Mt,nt=Oa*ka,Ea=Ba*wa;pa=1/Math.sqrt(nt*nt+Ea*Ea),nt*=pa,Ea*=pa;var Na=(Ya-Oa)*nt+(Qa-Ba)*Ea;if(Na>0){this.swingError=Na,this.swingAxisX=0,this.swingAxisY=nt,this.swingAxisZ=Ea;var Sa,ft,Wa;Sa=_*this.swingAxisX+h*this.swingAxisY+v*this.swingAxisZ,ft=e*this.swingAxisX+l*this.swingAxisY+u*this.swingAxisZ,Wa=b*this.swingAxisX+f*this.swingAxisY+n*this.swingAxisZ,this.swingAxisX=Sa,this.swingAxisY=ft,this.swingAxisZ=Wa;var Ha,bt,rt;Ha=V*this.swingAxisX+z*this.swingAxisY+I*this.swingAxisZ,bt=w*this.swingAxisX+X*this.swingAxisY+L*this.swingAxisZ,rt=p*this.swingAxisX+g*this.swingAxisY+F*this.swingAxisZ,this.swingAxisX=Ha,this.swingAxisY=bt,this.swingAxisZ=rt}else this.swingError=0}this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,a}getAxis1To(a){var t=a;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(a){var t=a;t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,a}getLocalAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,a}getLocalAxis1To(a){var t=a;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(a){var t=a;t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTwistSpringDamper(){return this._twistSd}getTwistLimitMotor(){return this._twistLm}getSwingSpringDamper(){return this._swingSd}getSwingAxis(){var a=new x.common.Vec3,t=a;return t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ,a}getSwingAxisTo(a){var t=a;t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ}getSwingAngle(){return this._swingAngle}getTwistAngle(){return this._twistAngle}};x.dynamics.constraint.joint.RagdollJointConfig=class extends x.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localTwistAxis1=new x.common.Vec3(1,0,0),this.localTwistAxis2=new x.common.Vec3(1,0,0),this.localSwingAxis1=new x.common.Vec3(0,1,0),this.twistSpringDamper=new x.dynamics.constraint.joint.SpringDamper,this.swingSpringDamper=new x.dynamics.constraint.joint.SpringDamper,this.twistLimitMotor=new x.dynamics.constraint.joint.RotationalLimitMotor,this.maxSwingAngle1=3.14159265358979,this.maxSwingAngle2=3.14159265358979}init(a,t,r,i,o){this._init(a,t,r);var s,_,h,v=i;s=v.x,_=v.y,h=v.z;var e,l,u;e=a._transform._rotation00*s+a._transform._rotation10*_+a._transform._rotation20*h,l=a._transform._rotation01*s+a._transform._rotation11*_+a._transform._rotation21*h,u=a._transform._rotation02*s+a._transform._rotation12*_+a._transform._rotation22*h,s=e,_=l,h=u;var b=this.localTwistAxis1;b.x=s,b.y=_,b.z=h;var f,n,c,M=i;f=M.x,n=M.y,c=M.z;var m,y,V;m=t._transform._rotation00*f+t._transform._rotation10*n+t._transform._rotation20*c,y=t._transform._rotation01*f+t._transform._rotation11*n+t._transform._rotation21*c,V=t._transform._rotation02*f+t._transform._rotation12*n+t._transform._rotation22*c,f=m,n=y,c=V;var z=this.localTwistAxis2;z.x=f,z.y=n,z.z=c;var I,w,X,L=o;I=L.x,w=L.y,X=L.z;var p,g,F;p=a._transform._rotation00*I+a._transform._rotation10*w+a._transform._rotation20*X,g=a._transform._rotation01*I+a._transform._rotation11*w+a._transform._rotation21*X,F=a._transform._rotation02*I+a._transform._rotation12*w+a._transform._rotation22*X,I=p,w=g,X=F;var S=this.localSwingAxis1;return S.x=I,S.y=w,S.z=X,this}};x.dynamics.constraint.joint.RevoluteJoint=class extends x.dynamics.constraint.joint.Joint{constructor(a){super(a,1);var t=a.localAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var r=a.localAxis2;this._localBasisX2X=r.x,this._localBasisX2Y=r.y,this._localBasisX2Z=r.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this._basis=new x.dynamics.constraint.joint.BasisTracker(this),this._sd=a.springDamper.clone(),this._lm=a.limitMotor.clone()}getInfo(a,t,r){var i=this.getErp(t,r),o,s,_;o=this.linearErrorX*i,s=this.linearErrorY*i,_=this.linearErrorZ*i;var h=o,v=s,e=_,l=this.angularErrorY*i,u=this.angularErrorZ*i,b,f,n,c,M,m,y,V,z,I,w,X,L,p,g,F,S,N;b=0,f=-this._relativeAnchor1Z,n=this._relativeAnchor1Y,c=this._relativeAnchor1Z,M=0,m=-this._relativeAnchor1X,y=-this._relativeAnchor1Y,V=this._relativeAnchor1X,z=0,I=0,w=-this._relativeAnchor2Z,X=this._relativeAnchor2Y,L=this._relativeAnchor2Z,p=0,g=-this._relativeAnchor2X,F=-this._relativeAnchor2Y,S=this._relativeAnchor2X,N=0,b=-b,f=-f,n=-n,c=-c,M=-M,m=-m,y=-y,V=-V,z=-z,I=-I,w=-w,X=-X,L=-L,p=-p,g=-g,F=-F,S=-S,N=-N;var A=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ),Y=this._impulses[0],R=a.rows[a.numRows++],C=R.jacobian;C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,R.rhs=0,R.cfm=0,R.minImpulse=0,R.maxImpulse=0,R.motorSpeed=0,R.motorMaxImpulse=0,R.impulse=null,R.impulse=Y;var d=R;d.rhs=h,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0;var Z=d.jacobian;Z.lin1X=1,Z.lin1Y=0,Z.lin1Z=0,Z.lin2X=1,Z.lin2Y=0,Z.lin2Z=0,Z.ang1X=b,Z.ang1Y=f,Z.ang1Z=n,Z.ang2X=I,Z.ang2Y=w,Z.ang2Z=X;var j=this._impulses[1],H=a.rows[a.numRows++],E=H.jacobian;E.lin1X=0,E.lin1Y=0,E.lin1Z=0,E.lin2X=0,E.lin2Y=0,E.lin2Z=0,E.ang1X=0,E.ang1Y=0,E.ang1Z=0,E.ang2X=0,E.ang2Y=0,E.ang2Z=0,H.rhs=0,H.cfm=0,H.minImpulse=0,H.maxImpulse=0,H.motorSpeed=0,H.motorMaxImpulse=0,H.impulse=null,H.impulse=j,d=H,d.rhs=v,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,Z=d.jacobian,Z.lin1X=0,Z.lin1Y=1,Z.lin1Z=0,Z.lin2X=0,Z.lin2Y=1,Z.lin2Z=0,Z.ang1X=c,Z.ang1Y=M,Z.ang1Z=m,Z.ang2X=L,Z.ang2Y=p,Z.ang2Z=g;var G=this._impulses[2],B=a.rows[a.numRows++],Q=B.jacobian;if(Q.lin1X=0,Q.lin1Y=0,Q.lin1Z=0,Q.lin2X=0,Q.lin2Y=0,Q.lin2Z=0,Q.ang1X=0,Q.ang1Y=0,Q.ang1Z=0,Q.ang2X=0,Q.ang2Y=0,Q.ang2Z=0,B.rhs=0,B.cfm=0,B.minImpulse=0,B.maxImpulse=0,B.motorSpeed=0,B.motorMaxImpulse=0,B.impulse=null,B.impulse=G,d=B,d.rhs=e,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,Z=d.jacobian,Z.lin1X=0,Z.lin1Y=0,Z.lin1Z=1,Z.lin2X=0,Z.lin2Y=0,Z.lin2Z=1,Z.ang1X=y,Z.ang1Y=V,Z.ang1Z=z,Z.ang2X=F,Z.ang2Y=S,Z.ang2Z=N,this._sd.frequency<=0||!r){var W=this._impulses[3],J=a.rows[a.numRows++],D=J.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,J.rhs=0,J.cfm=0,J.minImpulse=0,J.maxImpulse=0,J.motorSpeed=0,J.motorMaxImpulse=0,J.impulse=null,J.impulse=W,d=J,this.setSolverInfoRowAngular(d,this.angle,this._lm,A,this._sd,t,r),Z=d.jacobian,Z.ang1X=this._basis.xX,Z.ang1Y=this._basis.xY,Z.ang1Z=this._basis.xZ,Z.ang2X=this._basis.xX,Z.ang2Y=this._basis.xY,Z.ang2Z=this._basis.xZ}var O=this._impulses[4],K=a.rows[a.numRows++],ra=K.jacobian;ra.lin1X=0,ra.lin1Y=0,ra.lin1Z=0,ra.lin2X=0,ra.lin2Y=0,ra.lin2Z=0,ra.ang1X=0,ra.ang1Y=0,ra.ang1Z=0,ra.ang2X=0,ra.ang2Y=0,ra.ang2Z=0,K.rhs=0,K.cfm=0,K.minImpulse=0,K.maxImpulse=0,K.motorSpeed=0,K.motorMaxImpulse=0,K.impulse=null,K.impulse=O,d=K,d.rhs=l,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,Z=d.jacobian,Z.ang1X=this._basis.yX,Z.ang1Y=this._basis.yY,Z.ang1Z=this._basis.yZ,Z.ang2X=this._basis.yX,Z.ang2Y=this._basis.yY,Z.ang2Z=this._basis.yZ;var sa=this._impulses[5],$=a.rows[a.numRows++],q=$.jacobian;q.lin1X=0,q.lin1Y=0,q.lin1Z=0,q.lin2X=0,q.lin2Y=0,q.lin2Z=0,q.ang1X=0,q.ang1Y=0,q.ang1Z=0,q.ang2X=0,q.ang2Y=0,q.ang2Z=0,$.rhs=0,$.cfm=0,$.minImpulse=0,$.maxImpulse=0,$.motorSpeed=0,$.motorMaxImpulse=0,$.impulse=null,$.impulse=sa,d=$,d.rhs=u,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,Z=d.jacobian,Z.ang1X=this._basis.zX,Z.ang1Y=this._basis.zY,Z.ang1Z=this._basis.zZ,Z.ang2X=this._basis.zX,Z.ang2Y=this._basis.zY,Z.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();var a=this._basis,t=a.joint._b1._invMass,r=a.joint._b2._invMass,i,o,s,_,h,v,e,l,u,b,f,n,c,M,m,y,V,z,I,w,X,L,p,g,F,S,N,A,Y,R,C,d,Z,j,H,E,G=a.joint._basisX1X*a.joint._basisX2X+a.joint._basisX1Y*a.joint._basisX2Y+a.joint._basisX1Z*a.joint._basisX2Z;if(G<-.999999999){var B,Q,W,J=a.joint._basisX1X,D=a.joint._basisX1Y,O=a.joint._basisX1Z,K=J*J,ra=D*D,sa=O*O,$;K<ra?K<sa?($=1/Math.sqrt(ra+sa),B=0,Q=O*$,W=-D*$):($=1/Math.sqrt(K+ra),B=D*$,Q=-J*$,W=0):ra<sa?($=1/Math.sqrt(sa+K),B=-O*$,Q=0,W=J*$):($=1/Math.sqrt(K+ra),B=D*$,Q=-J*$,W=0),i=B,o=Q,s=W,_=0}else{var q,na,oa;q=a.joint._basisX1Y*a.joint._basisX2Z-a.joint._basisX1Z*a.joint._basisX2Y,na=a.joint._basisX1Z*a.joint._basisX2X-a.joint._basisX1X*a.joint._basisX2Z,oa=a.joint._basisX1X*a.joint._basisX2Y-a.joint._basisX1Y*a.joint._basisX2X;var aa=Math.sqrt((1+G)*.5);G=.5/aa,q*=G,na*=G,oa*=G,i=q,o=na,s=oa,_=aa}h=0,v=0,e=0,l=1;var T,ca,_a,k,ta,ia,la,va;T=h,ca=v,_a=e,k=l,ta=i,ia=o,la=s,va=_;var xa=T*ta+ca*ia+_a*la+k*va;if(xa<0&&(xa=-xa,ta=-ta,ia=-ia,la=-la,va=-va),xa>.999999){var Ma,za,Xa,Za;Ma=ta-T,za=ia-ca,Xa=la-_a,Za=va-k,ta=T+Ma*(t/(t+r)),ia=ca+za*(t/(t+r)),la=_a+Xa*(t/(t+r)),va=k+Za*(t/(t+r));var fa=ta*ta+ia*ia+la*la+va*va;fa>1e-32&&(fa=1/Math.sqrt(fa)),u=ta*fa,b=ia*fa,f=la*fa,n=va*fa}else{var ba=t/(t+r)*Math.acos(xa);ta+=T*-xa,ia+=ca*-xa,la+=_a*-xa,va+=k*-xa;var ea=ta*ta+ia*ia+la*la+va*va;ea>1e-32&&(ea=1/Math.sqrt(ea)),ta*=ea,ia*=ea,la*=ea,va*=ea;var ha=Math.sin(ba),pa=Math.cos(ba);T*=pa,ca*=pa,_a*=pa,k*=pa,u=T+ta*ha,b=ca+ia*ha,f=_a+la*ha,n=k+va*ha}var ya=u,da=b,ma=f,Ya=n,Qa=2*ya,ga=2*da,ua=2*ma,ka=ya*Qa,wa=da*ga,Pa=ma*ua,Mt=ya*ga,Oa=da*ua,Ba=ya*ua,nt=Ya*Qa,Ea=Ya*ga,Na=Ya*ua;c=1-wa-Pa,M=Mt-Na,m=Ba+Ea,y=Mt+Na,V=1-ka-Pa,z=Oa-nt,I=Ba-Ea,w=Oa+nt,X=1-ka-wa;var Sa,ft,Wa;Sa=c*a.joint._basisX1X+M*a.joint._basisX1Y+m*a.joint._basisX1Z,ft=y*a.joint._basisX1X+V*a.joint._basisX1Y+z*a.joint._basisX1Z,Wa=I*a.joint._basisX1X+w*a.joint._basisX1Y+X*a.joint._basisX1Z,L=Sa,p=ft,g=Wa,C=a.xX,d=a.xY,Z=a.xZ,j=a.yX,H=a.yY,E=a.yZ;var Ha=C*L+d*p+Z*g;if(Ha<-.999999999){var bt,rt,ja,_t=C,gt=d,mt=Z,Ja=_t*_t,it=gt*gt,ut=mt*mt,Da;Ja<it?Ja<ut?(Da=1/Math.sqrt(it+ut),bt=0,rt=mt*Da,ja=-gt*Da):(Da=1/Math.sqrt(Ja+it),bt=gt*Da,rt=-_t*Da,ja=0):it<ut?(Da=1/Math.sqrt(ut+Ja),bt=-mt*Da,rt=0,ja=_t*Da):(Da=1/Math.sqrt(Ja+it),bt=gt*Da,rt=-_t*Da,ja=0),u=bt,b=rt,f=ja,n=0}else{var Ta,Fa,Vt;Ta=d*g-Z*p,Fa=Z*L-C*g,Vt=C*p-d*L;var Pt=Math.sqrt((1+Ha)*.5);Ha=.5/Pt,Ta*=Ha,Fa*=Ha,Vt*=Ha,u=Ta,b=Fa,f=Vt,n=Pt}var et=u,Xt=b,Yt=f,zt=n,Ia=2*et,U=2*Xt,Va=2*Yt,lt=et*Ia,P=Xt*U,kt=Yt*Va,Bt=et*U,St=Xt*Va,yt=et*Va,wt=zt*Ia,pt=zt*U,ht=zt*Va;c=1-P-kt,M=Bt-ht,m=yt+pt,y=Bt+ht,V=1-lt-kt,z=St-wt,I=yt-pt,w=St+wt,X=1-lt-P;var xt,Ra,st;if(xt=c*j+M*H+m*E,Ra=y*j+V*H+z*E,st=I*j+w*H+X*E,F=xt,S=Ra,N=st,A=p*N-g*S,Y=g*F-L*N,R=L*S-p*F,A*A+Y*Y+R*R>1e-6){var Ca=A*A+Y*Y+R*R;Ca>0&&(Ca=1/Math.sqrt(Ca)),A*=Ca,Y*=Ca,R*=Ca}else{var vt=L,qa=p,at=g,Ua=vt*vt,tt=qa*qa,ct=at*at,Aa;Ua<tt?Ua<ct?(Aa=1/Math.sqrt(tt+ct),A=0,Y=at*Aa,R=-qa*Aa):(Aa=1/Math.sqrt(Ua+tt),A=qa*Aa,Y=-vt*Aa,R=0):tt<ct?(Aa=1/Math.sqrt(ct+Ua),A=-at*Aa,Y=0,R=vt*Aa):(Aa=1/Math.sqrt(Ua+tt),A=qa*Aa,Y=-vt*Aa,R=0)}F=Y*g-R*p,S=R*L-A*g,N=A*p-Y*L,a.xX=L,a.xY=p,a.xZ=g,a.yX=F,a.yY=S,a.yZ=N,a.zX=A,a.zY=Y,a.zZ=R;var Ga,Ka,La;Ga=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,Ka=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,La=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;var ot=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,It=ot<=-1?3.14159265358979:ot>=1?0:Math.acos(ot),or=Ga*Ga+Ka*Ka+La*La;or>0&&(or=1/Math.sqrt(or)),Ga*=or,Ka*=or,La*=or,Ga*=It,Ka*=It,La*=It,this.angularErrorY=Ga*this._basis.yX+Ka*this._basis.yY+La*this._basis.yZ,this.angularErrorZ=Ga*this._basis.zX+Ka*this._basis.zY+La*this._basis.zZ;var gr,ar,Ct;gr=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,ar=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,Ct=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,ot=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=ot<=-1?3.14159265358979:ot>=1?0:Math.acos(ot),gr*this._basis.xX+ar*this._basis.xY+Ct*this._basis.xZ<0&&(this.angle=-this.angle),this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,a}getAxis1To(a){var t=a;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(a){var t=a;t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,a}getLocalAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,a}getLocalAxis1To(a){var t=a;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(a){var t=a;t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getAngle(){return this.angle}};x.dynamics.constraint.joint.RevoluteJointConfig=class extends x.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new x.common.Vec3(1,0,0),this.localAxis2=new x.common.Vec3(1,0,0),this.springDamper=new x.dynamics.constraint.joint.SpringDamper,this.limitMotor=new x.dynamics.constraint.joint.RotationalLimitMotor}init(a,t,r,i){this._init(a,t,r);var o,s,_,h=i;o=h.x,s=h.y,_=h.z;var v,e,l;v=a._transform._rotation00*o+a._transform._rotation10*s+a._transform._rotation20*_,e=a._transform._rotation01*o+a._transform._rotation11*s+a._transform._rotation21*_,l=a._transform._rotation02*o+a._transform._rotation12*s+a._transform._rotation22*_,o=v,s=e,_=l;var u=this.localAxis1;u.x=o,u.y=s,u.z=_;var b,f,n,c=i;b=c.x,f=c.y,n=c.z;var M,m,y;M=t._transform._rotation00*b+t._transform._rotation10*f+t._transform._rotation20*n,m=t._transform._rotation01*b+t._transform._rotation11*f+t._transform._rotation21*n,y=t._transform._rotation02*b+t._transform._rotation12*f+t._transform._rotation22*n,b=M,f=m,n=y;var V=this.localAxis2;return V.x=b,V.y=f,V.z=n,this}};x.dynamics.constraint.joint.RotationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorTorque=0}setLimits(a,t){return this.lowerLimit=a,this.upperLimit=t,this}setMotor(a,t){return this.motorSpeed=a,this.motorTorque=t,this}clone(){var a=new x.dynamics.constraint.joint.RotationalLimitMotor;return a.lowerLimit=this.lowerLimit,a.upperLimit=this.upperLimit,a.motorSpeed=this.motorSpeed,a.motorTorque=this.motorTorque,a}};x.dynamics.constraint.joint.SphericalJoint=class extends x.dynamics.constraint.joint.Joint{constructor(a){super(a,0),this._sd=a.springDamper.clone()}getInfo(a,t,r){if(!(this._sd.frequency>0&&r)){var i,o,s;i=this._anchor2X-this._anchor1X,o=this._anchor2Y-this._anchor1Y,s=this._anchor2Z-this._anchor1Z;var _,h;if(this._sd.frequency>0){var v=6.28318530717958*this._sd.frequency,e=this._sd.dampingRatio;e<x.common.Setting.minSpringDamperDampingRatio&&(e=x.common.Setting.minSpringDamperDampingRatio);var l=t.dt,u=2*e*v,b=v*v;this._sd.useSymplecticEuler?(_=1/(l*u),h=b/u):(_=1/(l*(l*b+u)),h=b/(l*b+u)),_*=this._b1._invMass+this._b2._invMass}else _=0,h=this.getErp(t,r);var f,n,c;f=i*h,n=o*h,c=s*h;var M=f,m=n,y=c,V,z,I,w,X,L,p,g,F,S,N,A,Y,R,C,d,Z,j;V=0,z=-this._relativeAnchor1Z,I=this._relativeAnchor1Y,w=this._relativeAnchor1Z,X=0,L=-this._relativeAnchor1X,p=-this._relativeAnchor1Y,g=this._relativeAnchor1X,F=0,S=0,N=-this._relativeAnchor2Z,A=this._relativeAnchor2Y,Y=this._relativeAnchor2Z,R=0,C=-this._relativeAnchor2X,d=-this._relativeAnchor2Y,Z=this._relativeAnchor2X,j=0,V=-V,z=-z,I=-I,w=-w,X=-X,L=-L,p=-p,g=-g,F=-F,S=-S,N=-N,A=-A,Y=-Y,R=-R,C=-C,d=-d,Z=-Z,j=-j;var H=this._impulses[0],E=a.rows[a.numRows++],G=E.jacobian;G.lin1X=0,G.lin1Y=0,G.lin1Z=0,G.lin2X=0,G.lin2Y=0,G.lin2Z=0,G.ang1X=0,G.ang1Y=0,G.ang1Z=0,G.ang2X=0,G.ang2Y=0,G.ang2Z=0,E.rhs=0,E.cfm=0,E.minImpulse=0,E.maxImpulse=0,E.motorSpeed=0,E.motorMaxImpulse=0,E.impulse=null,E.impulse=H;var B=E;B.rhs=M,B.cfm=_,B.minImpulse=-1/0,B.maxImpulse=1/0;var Q=B.jacobian;Q.lin1X=1,Q.lin1Y=0,Q.lin1Z=0,Q.lin2X=1,Q.lin2Y=0,Q.lin2Z=0,Q.ang1X=V,Q.ang1Y=z,Q.ang1Z=I,Q.ang2X=S,Q.ang2Y=N,Q.ang2Z=A;var W=this._impulses[1],J=a.rows[a.numRows++],D=J.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,J.rhs=0,J.cfm=0,J.minImpulse=0,J.maxImpulse=0,J.motorSpeed=0,J.motorMaxImpulse=0,J.impulse=null,J.impulse=W,B=J,B.rhs=m,B.cfm=_,B.minImpulse=-1/0,B.maxImpulse=1/0,Q=B.jacobian,Q.lin1X=0,Q.lin1Y=1,Q.lin1Z=0,Q.lin2X=0,Q.lin2Y=1,Q.lin2Z=0,Q.ang1X=w,Q.ang1Y=X,Q.ang1Z=L,Q.ang2X=Y,Q.ang2Y=R,Q.ang2Z=C;var O=this._impulses[2],K=a.rows[a.numRows++],ra=K.jacobian;ra.lin1X=0,ra.lin1Y=0,ra.lin1Z=0,ra.lin2X=0,ra.lin2Y=0,ra.lin2Z=0,ra.ang1X=0,ra.ang1Y=0,ra.ang1Z=0,ra.ang2X=0,ra.ang2Y=0,ra.ang2Z=0,K.rhs=0,K.cfm=0,K.minImpulse=0,K.maxImpulse=0,K.motorSpeed=0,K.motorMaxImpulse=0,K.impulse=null,K.impulse=O,B=K,B.rhs=y,B.cfm=_,B.minImpulse=-1/0,B.maxImpulse=1/0,Q=B.jacobian,Q.lin1X=0,Q.lin1Y=0,Q.lin1Z=1,Q.lin2X=0,Q.lin2Y=0,Q.lin2Z=1,Q.ang1X=p,Q.ang1Y=g,Q.ang1Z=F,Q.ang2X=d,Q.ang2Y=Z,Q.ang2Z=j}}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getSpringDamper(){return this._sd}};x.dynamics.constraint.joint.SphericalJointConfig=class extends x.dynamics.constraint.joint.JointConfig{constructor(){super(),this.springDamper=new x.dynamics.constraint.joint.SpringDamper}init(a,t,r){return this._init(a,t,r),this}};x.dynamics.constraint.joint.SpringDamper=class{constructor(){this.frequency=0,this.dampingRatio=0,this.useSymplecticEuler=!1}setSpring(a,t){return this.frequency=a,this.dampingRatio=t,this}setSymplecticEuler(a){return this.useSymplecticEuler=a,this}clone(){var a=new x.dynamics.constraint.joint.SpringDamper;return a.frequency=this.frequency,a.dampingRatio=this.dampingRatio,a.useSymplecticEuler=this.useSymplecticEuler,a}};x.dynamics.constraint.joint.TranslationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorForce=0}setLimits(a,t){return this.lowerLimit=a,this.upperLimit=t,this}setMotor(a,t){return this.motorSpeed=a,this.motorForce=t,this}clone(){var a=new x.dynamics.constraint.joint.TranslationalLimitMotor;return a.lowerLimit=this.lowerLimit,a.upperLimit=this.upperLimit,a.motorSpeed=this.motorSpeed,a.motorForce=this.motorForce,a}};x.dynamics.constraint.joint.UniversalJoint=class extends x.dynamics.constraint.joint.Joint{constructor(a){super(a,x.dynamics.constraint.joint.JointType.UNIVERSAL);var t=a.localAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var r=a.localAxis2;this._localBasisZ2X=r.x,this._localBasisZ2Y=r.y,this._localBasisZ2Z=r.z,this.buildLocalBasesFromX1Z2(),this._angleX=0,this._angleY=0,this._angleZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._sd1=a.springDamper1.clone(),this._sd2=a.springDamper2.clone(),this._lm1=a.limitMotor1.clone(),this._lm2=a.limitMotor2.clone()}getInfo(a,t,r){var i=this.getErp(t,r),o,s,_;o=this.linearErrorX*i,s=this.linearErrorY*i,_=this.linearErrorZ*i;var h=o,v=s,e=_,l=this._angleY*i,u,b,f,n,c,M,m,y,V,z,I,w,X,L,p,g,F,S;u=0,b=-this._relativeAnchor1Z,f=this._relativeAnchor1Y,n=this._relativeAnchor1Z,c=0,M=-this._relativeAnchor1X,m=-this._relativeAnchor1Y,y=this._relativeAnchor1X,V=0,z=0,I=-this._relativeAnchor2Z,w=this._relativeAnchor2Y,X=this._relativeAnchor2Z,L=0,p=-this._relativeAnchor2X,g=-this._relativeAnchor2Y,F=this._relativeAnchor2X,S=0,u=-u,b=-b,f=-f,n=-n,c=-c,M=-M,m=-m,y=-y,V=-V,z=-z,I=-I,w=-w,X=-X,L=-L,p=-p,g=-g,F=-F,S=-S;var N=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),A=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ),Y=this._impulses[0],R=a.rows[a.numRows++],C=R.jacobian;C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,R.rhs=0,R.cfm=0,R.minImpulse=0,R.maxImpulse=0,R.motorSpeed=0,R.motorMaxImpulse=0,R.impulse=null,R.impulse=Y;var d=R;d.rhs=h,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0;var Z=d.jacobian;Z.lin1X=1,Z.lin1Y=0,Z.lin1Z=0,Z.lin2X=1,Z.lin2Y=0,Z.lin2Z=0,Z.ang1X=u,Z.ang1Y=b,Z.ang1Z=f,Z.ang2X=z,Z.ang2Y=I,Z.ang2Z=w;var j=this._impulses[1],H=a.rows[a.numRows++],E=H.jacobian;E.lin1X=0,E.lin1Y=0,E.lin1Z=0,E.lin2X=0,E.lin2Y=0,E.lin2Z=0,E.ang1X=0,E.ang1Y=0,E.ang1Z=0,E.ang2X=0,E.ang2Y=0,E.ang2Z=0,H.rhs=0,H.cfm=0,H.minImpulse=0,H.maxImpulse=0,H.motorSpeed=0,H.motorMaxImpulse=0,H.impulse=null,H.impulse=j,d=H,d.rhs=v,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,Z=d.jacobian,Z.lin1X=0,Z.lin1Y=1,Z.lin1Z=0,Z.lin2X=0,Z.lin2Y=1,Z.lin2Z=0,Z.ang1X=n,Z.ang1Y=c,Z.ang1Z=M,Z.ang2X=X,Z.ang2Y=L,Z.ang2Z=p;var G=this._impulses[2],B=a.rows[a.numRows++],Q=B.jacobian;if(Q.lin1X=0,Q.lin1Y=0,Q.lin1Z=0,Q.lin2X=0,Q.lin2Y=0,Q.lin2Z=0,Q.ang1X=0,Q.ang1Y=0,Q.ang1Z=0,Q.ang2X=0,Q.ang2Y=0,Q.ang2Z=0,B.rhs=0,B.cfm=0,B.minImpulse=0,B.maxImpulse=0,B.motorSpeed=0,B.motorMaxImpulse=0,B.impulse=null,B.impulse=G,d=B,d.rhs=e,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,Z=d.jacobian,Z.lin1X=0,Z.lin1Y=0,Z.lin1Z=1,Z.lin2X=0,Z.lin2Y=0,Z.lin2Z=1,Z.ang1X=m,Z.ang1Y=y,Z.ang1Z=V,Z.ang2X=g,Z.ang2Y=F,Z.ang2Z=S,!this.xSingular&&(this._sd1.frequency<=0||!r)){var W=this._impulses[3],J=a.rows[a.numRows++],D=J.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,J.rhs=0,J.cfm=0,J.minImpulse=0,J.maxImpulse=0,J.motorSpeed=0,J.motorMaxImpulse=0,J.impulse=null,J.impulse=W,d=J,this.setSolverInfoRowAngular(d,this._angleX,this._lm1,N,this._sd1,t,r),Z=d.jacobian,Z.ang1X=this._axisXX,Z.ang1Y=this._axisXY,Z.ang1Z=this._axisXZ,Z.ang2X=this._axisXX,Z.ang2Y=this._axisXY,Z.ang2Z=this._axisXZ}if(!this.ySingular){var O=this._impulses[4],K=a.rows[a.numRows++],ra=K.jacobian;ra.lin1X=0,ra.lin1Y=0,ra.lin1Z=0,ra.lin2X=0,ra.lin2Y=0,ra.lin2Z=0,ra.ang1X=0,ra.ang1Y=0,ra.ang1Z=0,ra.ang2X=0,ra.ang2Y=0,ra.ang2Z=0,K.rhs=0,K.cfm=0,K.minImpulse=0,K.maxImpulse=0,K.motorSpeed=0,K.motorMaxImpulse=0,K.impulse=null,K.impulse=O,d=K,d.rhs=l,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,Z=d.jacobian,Z.ang1X=this._axisYX,Z.ang1Y=this._axisYY,Z.ang1Z=this._axisYZ,Z.ang2X=this._axisYX,Z.ang2Y=this._axisYY,Z.ang2Z=this._axisYZ}if(!this.zSingular&&(this._sd2.frequency<=0||!r)){var sa=this._impulses[5],$=a.rows[a.numRows++],q=$.jacobian;q.lin1X=0,q.lin1Y=0,q.lin1Z=0,q.lin2X=0,q.lin2Y=0,q.lin2Z=0,q.ang1X=0,q.ang1Y=0,q.ang1Z=0,q.ang2X=0,q.ang2Y=0,q.ang2Z=0,$.rhs=0,$.cfm=0,$.minImpulse=0,$.maxImpulse=0,$.motorSpeed=0,$.motorMaxImpulse=0,$.impulse=null,$.impulse=sa,d=$,this.setSolverInfoRowAngular(d,this._angleZ,this._lm2,A,this._sd2,t,r),Z=d.jacobian,Z.ang1X=this._axisZX,Z.ang1Y=this._axisZY,Z.ang1Z=this._axisZZ,Z.ang2X=this._axisZX,Z.ang2Y=this._axisZY,Z.ang2Z=this._axisZZ}}_syncAnchors(){super._syncAnchors(),this._basisX1X,this._basisY1X,this._basisZ1X,this._basisX1Y,this._basisY1Y,this._basisZ1Y,this._basisX1Z,this._basisY1Z,this._basisZ1Z,this._basisX2X,this._basisY2X,this._basisZ2X,this._basisX2Y,this._basisY2Y,this._basisZ2Y,this._basisX2Z,this._basisY2Z,this._basisZ2Z;var a,t,r,i,o,s,_,h,v;a=this._basisX1X,t=this._basisX1Y,r=this._basisX1Z,_=this._basisZ2X,h=this._basisZ2Y,v=this._basisZ2Z,i=h*r-v*t,o=v*a-_*r,s=_*t-h*a,this._axisXX=o*v-s*h,this._axisXY=s*_-i*v,this._axisXZ=i*h-o*_,this._axisYX=i,this._axisYY=o,this._axisYZ=s,this._axisZX=t*s-r*o,this._axisZY=r*i-a*s,this._axisZZ=a*o-t*i;var e=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;e>0&&(e=1/Math.sqrt(e)),this._axisXX*=e,this._axisXY*=e,this._axisXZ*=e;var l=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;l>0&&(l=1/Math.sqrt(l)),this._axisYX*=l,this._axisYY*=l,this._axisYZ*=l;var u=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;u>0&&(u=1/Math.sqrt(u)),this._axisZX*=u,this._axisZY*=u,this._axisZZ*=u,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0;var b,f,n,c,M,m,y,V,z,I,w,X,L,p,g,F,S,N;b=this._basisX1X,f=this._basisY1X,n=this._basisZ1X,c=this._basisX1Y,M=this._basisY1Y,m=this._basisZ1Y,y=this._basisX1Z,V=this._basisY1Z,z=this._basisZ1Z,I=this._basisX2X,w=this._basisY2X,X=this._basisZ2X,L=this._basisX2Y,p=this._basisY2Y,g=this._basisZ2Y,F=this._basisX2Z,S=this._basisY2Z,N=this._basisZ2Z;var A,Y,R,C,d,Z,j,H,E,G,B,Q,W,J;H=b*I+c*L+y*F,E=b*w+c*p+y*S,G=b*X+c*g+y*N,B=f*w+M*p+V*S,Q=f*X+M*g+V*N,W=n*w+m*p+z*S,J=n*X+m*g+z*N,A=H,Y=E,R=G,C=B,d=Q,Z=W,j=J;var D,O,K,ra=R;if(ra<=-1){var sa=Math.atan2(Z,C);D=sa*.5,O=-1.570796326794895,K=-sa*.5}else if(ra>=1){var $=Math.atan2(Z,C);D=$*.5,O=1.570796326794895,K=$*.5}else{var q=Math.asin(ra),na=Math.atan2(-d,j),oa=Math.atan2(-Y,A);D=na,O=q,K=oa}this._angleX=D,this._angleY=O,this._angleZ=K,this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,a}getAxis1To(a){var t=a;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(a){var t=a;t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z}getLocalAxis1(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,a}getLocalAxis2(){var a=new x.common.Vec3,t=a;return t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z,a}getLocalAxis1To(a){var t=a;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(a){var t=a;t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z}getSpringDamper1(){return this._sd1}getSpringDamper2(){return this._sd2}getLimitMotor1(){return this._lm1}getLimitMotor2(){return this._lm2}getAngle1(){return this._angleX}getAngle2(){return this._angleZ}};x.dynamics.constraint.joint.UniversalJointConfig=class extends x.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new x.common.Vec3(1,0,0),this.localAxis2=new x.common.Vec3(1,0,0),this.springDamper1=new x.dynamics.constraint.joint.SpringDamper,this.springDamper2=new x.dynamics.constraint.joint.SpringDamper,this.limitMotor1=new x.dynamics.constraint.joint.RotationalLimitMotor,this.limitMotor2=new x.dynamics.constraint.joint.RotationalLimitMotor}init(a,t,r,i,o){this._init(a,t,r);var s,_,h,v=i;s=v.x,_=v.y,h=v.z;var e,l,u;e=a._transform._rotation00*s+a._transform._rotation10*_+a._transform._rotation20*h,l=a._transform._rotation01*s+a._transform._rotation11*_+a._transform._rotation21*h,u=a._transform._rotation02*s+a._transform._rotation12*_+a._transform._rotation22*h,s=e,_=l,h=u;var b=this.localAxis1;b.x=s,b.y=_,b.z=h;var f,n,c,M=o;f=M.x,n=M.y,c=M.z;var m,y,V;m=t._transform._rotation00*f+t._transform._rotation10*n+t._transform._rotation20*c,y=t._transform._rotation01*f+t._transform._rotation11*n+t._transform._rotation21*c,V=t._transform._rotation02*f+t._transform._rotation12*n+t._transform._rotation22*c,f=m,n=y,c=V;var z=this.localAxis2;return z.x=f,z.y=n,z.z=c,this}};x.dynamics.constraint.solver||(x.dynamics.constraint.solver={});x.dynamics.constraint.solver.ConstraintSolverType=class{};x.dynamics.constraint.solver.common||(x.dynamics.constraint.solver.common={});x.dynamics.constraint.solver.common.ContactSolverMassDataRow=class{constructor(){this.invMLinN1X=0,this.invMLinN1Y=0,this.invMLinN1Z=0,this.invMLinN2X=0,this.invMLinN2Y=0,this.invMLinN2Z=0,this.invMAngN1X=0,this.invMAngN1Y=0,this.invMAngN1Z=0,this.invMAngN2X=0,this.invMAngN2Y=0,this.invMAngN2Z=0,this.invMLinT1X=0,this.invMLinT1Y=0,this.invMLinT1Z=0,this.invMLinT2X=0,this.invMLinT2Y=0,this.invMLinT2Z=0,this.invMAngT1X=0,this.invMAngT1Y=0,this.invMAngT1Z=0,this.invMAngT2X=0,this.invMAngT2Y=0,this.invMAngT2Z=0,this.invMLinB1X=0,this.invMLinB1Y=0,this.invMLinB1Z=0,this.invMLinB2X=0,this.invMLinB2Y=0,this.invMLinB2Z=0,this.invMAngB1X=0,this.invMAngB1Y=0,this.invMAngB1Z=0,this.invMAngB2X=0,this.invMAngB2Y=0,this.invMAngB2Z=0,this.massN=0,this.massTB00=0,this.massTB01=0,this.massTB10=0,this.massTB11=0}};x.dynamics.constraint.solver.common.JointSolverMassDataRow=class{constructor(){this.invMLin1X=0,this.invMLin1Y=0,this.invMLin1Z=0,this.invMLin2X=0,this.invMLin2Y=0,this.invMLin2Z=0,this.invMAng1X=0,this.invMAng1Y=0,this.invMAng1Z=0,this.invMAng2X=0,this.invMAng2Y=0,this.invMAng2Z=0,this.mass=0,this.massWithoutCfm=0}};x.dynamics.constraint.solver.direct||(x.dynamics.constraint.solver.direct={});x.dynamics.constraint.solver.direct.Boundary=class{constructor(a){var t=new Array(a);this.iBounded=t;var r=new Array(a);this.iUnbounded=r;var i=new Array(a);this.signs=i;var o=new Array(a);this.b=o,this.numBounded=0,this.numUnbounded=0,this.matrixId=0}init(a){this.numBounded=a.numBounded;for(var t=0,r=this.numBounded;t<r;){var i=t++;this.iBounded[i]=a.iBounded[i],this.signs[i]=a.signs[i]}this.numUnbounded=a.numUnbounded,this.matrixId=0;for(var o=0,s=this.numUnbounded;o<s;){var _=o++,h=a.iUnbounded[_];this.iUnbounded[_]=h,this.matrixId|=1<<h}}computeImpulses(a,t,r,i,o,s,_){for(var h=0,v=this.numUnbounded;h<v;){var e=h++,l=this.iUnbounded[e],u=a.rows[l],b=r[l];this.b[l]=u.rhs*s-b-u.cfm*i[l]}for(var f=t._invMassWithoutCfm,n=0,c=this.numBounded;n<c;){var M=n++,m=this.iBounded[M],y=this.signs[M],V=a.rows[m],z=i[m],I=y<0?V.minImpulse:y>0?V.maxImpulse:0,w=I-z;if(o[m]=w,w!=0)for(var X=0,L=this.numUnbounded;X<L;){var p=X++,g=this.iUnbounded[p],F=f[m][g]*w,S=g,N=this.b;N[S]=N[S]-F}}for(var A=this.iUnbounded,Y=this.numUnbounded,R=0,C=0,d=Y;C<d;){var Z=C++;R|=1<<A[Z]}var j;t._cacheComputed[R]||(t.computeSubmatrix(R,A,Y),t._cacheComputed[R]=!0),j=t._cachedSubmatrices[R];for(var H=!0,E=0,G=this.numUnbounded;E<G;){for(var B=E++,Q=this.iUnbounded[B],W=a.rows[Q],J=i[Q],D=J,O=0,K=this.numUnbounded;O<K;){var ra=O++,sa=this.iUnbounded[ra];D+=this.b[sa]*j[B][ra]}if(D<W.minImpulse-x.common.Setting.directMlcpSolverEps||D>W.maxImpulse+x.common.Setting.directMlcpSolverEps){H=!1;break}o[Q]=D-J}if(_)return!0;if(!H)return!1;for(var $=0,q=this.numBounded;$<q;){for(var na=$++,oa=this.iBounded[na],aa=a.rows[oa],T=this.signs[na],ca=0,_a=i[oa]+o[oa],k=r[oa],ta=0,ia=a.numRows;ta<ia;){var la=ta++;k+=f[oa][la]*o[la]}if(ca=aa.rhs*s-k-aa.cfm*_a,T<0&&ca>x.common.Setting.directMlcpSolverEps||T>0&&ca<-x.common.Setting.directMlcpSolverEps){H=!1;break}}return H}};x.dynamics.constraint.solver.direct.BoundaryBuildInfo=class{constructor(a){this.size=a,this.numBounded=0;var t=new Array(a);this.iBounded=t;var r=new Array(a);this.signs=r,this.numUnbounded=0;var i=new Array(a);this.iUnbounded=i}};x.dynamics.constraint.solver.direct.BoundaryBuilder=class{constructor(a){this.maxRows=a,this.numBoundaries=0;var t=new Array(1<<a);this.boundaries=t,this.bbInfo=new x.dynamics.constraint.solver.direct.BoundaryBuildInfo(a)}buildBoundariesRecursive(a,t){if(t==a.numRows){this.boundaries[this.numBoundaries]==null&&(this.boundaries[this.numBoundaries]=new x.dynamics.constraint.solver.direct.Boundary(this.maxRows)),this.boundaries[this.numBoundaries++].init(this.bbInfo);return}var r=a.rows[t],i=r.minImpulse>-1/0,o=r.maxImpulse<1/0,s=r.minImpulse==0&&r.maxImpulse==0;if(s){var _=this.bbInfo;_.iBounded[_.numBounded]=t,_.signs[_.numBounded]=0,_.numBounded++,this.buildBoundariesRecursive(a,t+1),this.bbInfo.numBounded--;return}var h=this.bbInfo;if(h.iUnbounded[h.numUnbounded]=t,h.numUnbounded++,this.buildBoundariesRecursive(a,t+1),this.bbInfo.numUnbounded--,i){var v=this.bbInfo;v.iBounded[v.numBounded]=t,v.signs[v.numBounded]=-1,v.numBounded++,this.buildBoundariesRecursive(a,t+1),this.bbInfo.numBounded--}if(o){var e=this.bbInfo;e.iBounded[e.numBounded]=t,e.signs[e.numBounded]=1,e.numBounded++,this.buildBoundariesRecursive(a,t+1),this.bbInfo.numBounded--}}buildBoundaries(a){this.numBoundaries=0;var t=this.bbInfo;t.numBounded=0,t.numUnbounded=0,this.buildBoundariesRecursive(a,0)}};x.dynamics.constraint.solver.direct.BoundarySelector=class{constructor(a){this.n=a;var t=new Array(a);this.indices=t;var r=new Array(a);this.tmpIndices=r;for(var i=0,o=a;i<o;){var s=i++;this.indices[s]=s}}getIndex(a){return this.indices[a]}select(a){for(var t=0;this.indices[t]!=a;)++t;for(;t>0;){var r=this.indices[t];this.indices[t]=this.indices[t-1],this.indices[t-1]=r,--t}}setSize(a){for(var t=0,r=0,i=0,o=this.n;i<o;){var s=i++,_=this.indices[s];_<a?(this.tmpIndices[t]=_,++t):(this.tmpIndices[a+r]=_,++r)}var h=this.indices;this.indices=this.tmpIndices,this.tmpIndices=h}};x.dynamics.constraint.solver.direct.DirectJointConstraintSolver=class extends x.dynamics.constraint.ConstraintSolver{constructor(a){super(),this.joint=a,this.info=new x.dynamics.constraint.info.joint.JointSolverInfo;var t=x.common.Setting.maxJacobianRows;this.massMatrix=new x.dynamics.constraint.solver.direct.MassMatrix(t),this.boundaryBuilder=new x.dynamics.constraint.solver.direct.BoundaryBuilder(t);var r=new Array(t);this.massData=r;for(var i=0,o=this.massData.length;i<o;){var s=i++;this.massData[s]=new x.dynamics.constraint.solver.common.JointSolverMassDataRow}var _=this.boundaryBuilder.boundaries.length;this.velBoundarySelector=new x.dynamics.constraint.solver.direct.BoundarySelector(_),this.posBoundarySelector=new x.dynamics.constraint.solver.direct.BoundarySelector(_);var h=new Array(t);this.relVels=h;var v=new Array(t);this.impulses=v;var e=new Array(t);this.dImpulses=e;var l=new Array(t);this.dTotalImpulses=l;for(var u=0,b=t;u<b;){var f=u++;this.relVels[f]=0,this.impulses[f]=0,this.dImpulses[f]=0,this.dTotalImpulses[f]=0}}preSolveVelocity(a){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(a,this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var t=this.boundaryBuilder;t.numBoundaries=0;var r=t.bbInfo;r.numBounded=0,r.numUnbounded=0,t.buildBoundariesRecursive(this.info,0);for(var i=this.velBoundarySelector,o=this.boundaryBuilder.numBoundaries,s=0,_=0,h=0,v=i.n;h<v;){var e=h++,l=i.indices[e];l<o?(i.tmpIndices[s]=l,++s):(i.tmpIndices[o+_]=l,++_)}var u=i.indices;i.indices=i.tmpIndices,i.tmpIndices=u}warmStart(a){var t=this.joint._positionCorrectionAlgorithm==x.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?x.common.Setting.jointWarmStartingFactorForBaungarte:x.common.Setting.jointWarmStartingFactor;if(t*=a.dtRatio,t<=0){for(var r=0,i=this.info.numRows;r<i;){var o=r++,s=this.info.rows[o],_=s.impulse;_.impulse=0,_.impulseM=0,_.impulseP=0}return}for(var h=0,v=this.info.numRows;h<v;){var e=h++,l=this.info.rows[e],u=l.impulse,b=u.impulse*t;if(b<l.minImpulse?b=l.minImpulse:b>l.maxImpulse&&(b=l.maxImpulse),u.impulse=b,l.motorMaxImpulse>0){var f=u.impulseM*t,n=l.motorMaxImpulse;f<-n?f=-n:f>n&&(f=n),u.impulseM=f}else u.impulseM=0;this.dImpulses[e]=u.impulse+u.impulseM}var c=this.dImpulses,M=!1,m=!1,y,V,z,I,w,X,L,p,g,F,S,N;y=this._b1._velX,V=this._b1._velY,z=this._b1._velZ,I=this._b2._velX,w=this._b2._velY,X=this._b2._velZ,L=this._b1._angVelX,p=this._b1._angVelY,g=this._b1._angVelZ,F=this._b2._angVelX,S=this._b2._angVelY,N=this._b2._angVelZ;for(var A=0,Y=this.info.numRows;A<Y;){var R=A++,C=this.info.rows[R],d=C.jacobian,Z=this.massData[R],j=c[R];d.flag&1&&(y+=Z.invMLin1X*j,V+=Z.invMLin1Y*j,z+=Z.invMLin1Z*j,I+=Z.invMLin2X*-j,w+=Z.invMLin2Y*-j,X+=Z.invMLin2Z*-j,M=!0),d.flag&2&&(L+=Z.invMAng1X*j,p+=Z.invMAng1Y*j,g+=Z.invMAng1Z*j,F+=Z.invMAng2X*-j,S+=Z.invMAng2Y*-j,N+=Z.invMAng2Z*-j,m=!0)}M&&(this._b1._velX=y,this._b1._velY=V,this._b1._velZ=z,this._b2._velX=I,this._b2._velY=w,this._b2._velZ=X),m&&(this._b1._angVelX=L,this._b1._angVelY=p,this._b1._angVelZ=g,this._b2._angVelX=F,this._b2._angVelY=S,this._b2._angVelZ=N)}solveVelocity(){var a=this.info.numRows,t,r,i,o,s,_,h,v,e,l,u,b;t=this._b1._velX,r=this._b1._velY,i=this._b1._velZ,o=this._b2._velX,s=this._b2._velY,_=this._b2._velZ,h=this._b1._angVelX,v=this._b1._angVelY,e=this._b1._angVelZ,l=this._b2._angVelX,u=this._b2._angVelY,b=this._b2._angVelZ;for(var f=0,n=a;f<n;){var c=f++,M=this.info.rows[c],m=M.impulse,y=M.jacobian,V=0;V+=t*y.lin1X+r*y.lin1Y+i*y.lin1Z,V-=o*y.lin2X+s*y.lin2Y+_*y.lin2Z,V+=h*y.ang1X+v*y.ang1Y+e*y.ang1Z,V-=l*y.ang2X+u*y.ang2Y+b*y.ang2Z,this.relVels[c]=V,this.impulses[c]=m.impulse,this.dTotalImpulses[c]=0}for(var z=this.massMatrix._invMassWithoutCfm,I=0,w=a;I<w;){var X=I++,L=this.info.rows[X],p=L.impulse,g=this.massData[X];if(L.motorMaxImpulse>0){var F=p.impulseM,S=F+g.massWithoutCfm*(-L.motorSpeed-this.relVels[X]),N=L.motorMaxImpulse;S<-N?S=-N:S>N&&(S=N),p.impulseM=S;var A=S-F;this.dTotalImpulses[X]=A;for(var Y=0,R=a;Y<R;){var C=Y++,d=C,Z=this.relVels;Z[d]=Z[d]+A*z[X][C]}}}for(var j=!1,H=0,E=this.boundaryBuilder.numBoundaries;H<E;){var G=H++,B=this.velBoundarySelector.indices[G],Q=this.boundaryBuilder.boundaries[B];if(Q.computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,1,!1)){for(var W=0,J=a;W<J;){var D=W++,O=this.info.rows[D],K=O.impulse,ra=this.dImpulses[D];K.impulse+=ra;var sa=D,$=this.dTotalImpulses;$[sa]=$[sa]+ra}var q=this.dTotalImpulses,na=!1,oa=!1,aa,T,ca,_a,k,ta,ia,la,va,xa,Ma,za;aa=this._b1._velX,T=this._b1._velY,ca=this._b1._velZ,_a=this._b2._velX,k=this._b2._velY,ta=this._b2._velZ,ia=this._b1._angVelX,la=this._b1._angVelY,va=this._b1._angVelZ,xa=this._b2._angVelX,Ma=this._b2._angVelY,za=this._b2._angVelZ;for(var Xa=0,Za=this.info.numRows;Xa<Za;){var fa=Xa++,ba=this.info.rows[fa],ea=ba.jacobian,ha=this.massData[fa],pa=q[fa];ea.flag&1&&(aa+=ha.invMLin1X*pa,T+=ha.invMLin1Y*pa,ca+=ha.invMLin1Z*pa,_a+=ha.invMLin2X*-pa,k+=ha.invMLin2Y*-pa,ta+=ha.invMLin2Z*-pa,na=!0),ea.flag&2&&(ia+=ha.invMAng1X*pa,la+=ha.invMAng1Y*pa,va+=ha.invMAng1Z*pa,xa+=ha.invMAng2X*-pa,Ma+=ha.invMAng2Y*-pa,za+=ha.invMAng2Z*-pa,oa=!0)}na&&(this._b1._velX=aa,this._b1._velY=T,this._b1._velZ=ca,this._b2._velX=_a,this._b2._velY=k,this._b2._velZ=ta),oa&&(this._b1._angVelX=ia,this._b1._angVelY=la,this._b1._angVelZ=va,this._b2._angVelX=xa,this._b2._angVelY=Ma,this._b2._angVelZ=za);for(var ya=this.velBoundarySelector,da=0;ya.indices[da]!=B;)++da;for(;da>0;){var ma=ya.indices[da];ya.indices[da]=ya.indices[da-1],ya.indices[da-1]=ma,--da}j=!0;break}}if(!j){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:335:","could not find solution. (velocity)");return}}postSolveVelocity(a){var t,r,i,o,s,_;t=0,r=0,i=0,o=0,s=0,_=0;for(var h=0,v=this.info.numRows;h<v;){var e=h++,l=this.info.rows[e],u=l.impulse,b=l.jacobian;b.flag&1?(t+=b.lin1X*u.impulse,r+=b.lin1Y*u.impulse,i+=b.lin1Z*u.impulse):b.flag&2&&(o+=b.ang1X*u.impulse,s+=b.ang1Y*u.impulse,_+=b.ang1Z*u.impulse)}this.joint._appliedForceX=t*a.invDt,this.joint._appliedForceY=r*a.invDt,this.joint._appliedForceZ=i*a.invDt,this.joint._appliedTorqueX=o*a.invDt,this.joint._appliedTorqueY=s*a.invDt,this.joint._appliedTorqueZ=_*a.invDt}preSolvePosition(a){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var t=this.boundaryBuilder;t.numBoundaries=0;var r=t.bbInfo;r.numBounded=0,r.numUnbounded=0,t.buildBoundariesRecursive(this.info,0);for(var i=this.posBoundarySelector,o=this.boundaryBuilder.numBoundaries,s=0,_=0,h=0,v=i.n;h<v;){var e=h++,l=i.indices[e];l<o?(i.tmpIndices[s]=l,++s):(i.tmpIndices[o+_]=l,++_)}var u=i.indices;i.indices=i.tmpIndices,i.tmpIndices=u;for(var b=0,f=this.info.numRows;b<f;){var n=b++;this.info.rows[n].impulse.impulseP=0}}solvePositionSplitImpulse(){var a=this.info.numRows,t,r,i,o,s,_,h,v,e,l,u,b;t=this._b1._pseudoVelX,r=this._b1._pseudoVelY,i=this._b1._pseudoVelZ,o=this._b2._pseudoVelX,s=this._b2._pseudoVelY,_=this._b2._pseudoVelZ,h=this._b1._angPseudoVelX,v=this._b1._angPseudoVelY,e=this._b1._angPseudoVelZ,l=this._b2._angPseudoVelX,u=this._b2._angPseudoVelY,b=this._b2._angPseudoVelZ;for(var f=0,n=a;f<n;){var c=f++,M=this.info.rows[c],m=M.impulse,y=M.jacobian,V=0;V+=t*y.lin1X+r*y.lin1Y+i*y.lin1Z,V-=o*y.lin2X+s*y.lin2Y+_*y.lin2Z,V+=h*y.ang1X+v*y.ang1Y+e*y.ang1Z,V-=l*y.ang2X+u*y.ang2Y+b*y.ang2Z,this.relVels[c]=V,this.impulses[c]=m.impulseP}for(var z=!1,I=0,w=this.boundaryBuilder.numBoundaries;I<w;){var X=I++,L=this.posBoundarySelector.indices[X],p=this.boundaryBuilder.boundaries[L];if(p.computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,x.common.Setting.positionSplitImpulseBaumgarte,!1)){for(var g=0,F=a;g<F;){var S=g++,N=this.info.rows[S],A=N.impulse,Y=this.dImpulses[S];A.impulseP+=Y}var R=this.dImpulses,C=!1,d=!1,Z,j,H,E,G,B,Q,W,J,D,O,K;Z=this._b1._pseudoVelX,j=this._b1._pseudoVelY,H=this._b1._pseudoVelZ,E=this._b2._pseudoVelX,G=this._b2._pseudoVelY,B=this._b2._pseudoVelZ,Q=this._b1._angPseudoVelX,W=this._b1._angPseudoVelY,J=this._b1._angPseudoVelZ,D=this._b2._angPseudoVelX,O=this._b2._angPseudoVelY,K=this._b2._angPseudoVelZ;for(var ra=0,sa=this.info.numRows;ra<sa;){var $=ra++,q=this.info.rows[$],na=q.jacobian,oa=this.massData[$],aa=R[$];na.flag&1&&(Z+=oa.invMLin1X*aa,j+=oa.invMLin1Y*aa,H+=oa.invMLin1Z*aa,E+=oa.invMLin2X*-aa,G+=oa.invMLin2Y*-aa,B+=oa.invMLin2Z*-aa,C=!0),na.flag&2&&(Q+=oa.invMAng1X*aa,W+=oa.invMAng1Y*aa,J+=oa.invMAng1Z*aa,D+=oa.invMAng2X*-aa,O+=oa.invMAng2Y*-aa,K+=oa.invMAng2Z*-aa,d=!0)}C&&(this._b1._pseudoVelX=Z,this._b1._pseudoVelY=j,this._b1._pseudoVelZ=H,this._b2._pseudoVelX=E,this._b2._pseudoVelY=G,this._b2._pseudoVelZ=B),d&&(this._b1._angPseudoVelX=Q,this._b1._angPseudoVelY=W,this._b1._angPseudoVelZ=J,this._b2._angPseudoVelX=D,this._b2._angPseudoVelY=O,this._b2._angPseudoVelZ=K);for(var T=this.posBoundarySelector,ca=0;T.indices[ca]!=L;)++ca;for(;ca>0;){var _a=T.indices[ca];T.indices[ca]=T.indices[ca-1],T.indices[ca-1]=_a,--ca}z=!0;break}}if(!z){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:450:","could not find solution. (split impulse)");return}}solvePositionNgs(a){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var t=this.boundaryBuilder;t.numBoundaries=0;var r=t.bbInfo;r.numBounded=0,r.numUnbounded=0,t.buildBoundariesRecursive(this.info,0);for(var i=this.posBoundarySelector,o=this.boundaryBuilder.numBoundaries,s=0,_=0,h=0,v=i.n;h<v;){var e=h++,l=i.indices[e];l<o?(i.tmpIndices[s]=l,++s):(i.tmpIndices[o+_]=l,++_)}var u=i.indices;i.indices=i.tmpIndices,i.tmpIndices=u;for(var b=this.info.numRows,f=0,n=b;f<n;){var c=f++,M=this.info.rows[c],m=M.impulse;M.jacobian,this.relVels[c]=0,this.impulses[c]=m.impulseP}for(var y=!1,V=0,z=this.boundaryBuilder.numBoundaries;V<z;){var I=V++,w=this.posBoundarySelector.indices[I],X=this.boundaryBuilder.boundaries[w];if(X.computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,x.common.Setting.positionNgsBaumgarte,!1)){for(var L=0,p=b;L<p;){var g=L++,F=this.info.rows[g],S=F.impulse,N=this.dImpulses[g];S.impulseP+=N}var A=this.dImpulses,Y=!1,R=!1,C,d,Z,j,H,E,G,B,Q,W,J,D;C=0,d=0,Z=0,j=0,H=0,E=0,G=0,B=0,Q=0,W=0,J=0,D=0;for(var O=0,K=this.info.numRows;O<K;){var ra=O++,sa=this.info.rows[ra],$=sa.jacobian,q=this.massData[ra],na=A[ra];$.flag&1&&(C+=q.invMLin1X*na,d+=q.invMLin1Y*na,Z+=q.invMLin1Z*na,j+=q.invMLin2X*-na,H+=q.invMLin2Y*-na,E+=q.invMLin2Z*-na,Y=!0),$.flag&2&&(G+=q.invMAng1X*na,B+=q.invMAng1Y*na,Q+=q.invMAng1Z*na,W+=q.invMAng2X*-na,J+=q.invMAng2Y*-na,D+=q.invMAng2Z*-na,R=!0)}if(Y){var oa=this._b1;oa._transform._positionX+=C,oa._transform._positionY+=d,oa._transform._positionZ+=Z;var aa=this._b2;aa._transform._positionX+=j,aa._transform._positionY+=H,aa._transform._positionZ+=E}if(R){var T=this._b1,ca=Math.sqrt(G*G+B*B+Q*Q),_a=ca*.5,k,ta;if(_a<.5){var ia=_a*_a;k=.5*(1-ia*.16666666666666666+ia*ia*.008333333333333333),ta=1-ia*.5+ia*ia*.041666666666666664}else k=Math.sin(_a)/ca,ta=Math.cos(_a);var la,va,xa;la=G*k,va=B*k,xa=Q*k;var Ma,za,Xa,Za;Ma=la,za=va,Xa=xa,Za=ta;var fa,ba,ea,ha,pa=T._transform._rotation00,ya=T._transform._rotation11,da=T._transform._rotation22,ma=pa+ya+da,Ya;ma>0?(Ya=Math.sqrt(ma+1),ha=.5*Ya,Ya=.5/Ya,fa=(T._transform._rotation21-T._transform._rotation12)*Ya,ba=(T._transform._rotation02-T._transform._rotation20)*Ya,ea=(T._transform._rotation10-T._transform._rotation01)*Ya):pa>ya?pa>da?(Ya=Math.sqrt(pa-ya-da+1),fa=.5*Ya,Ya=.5/Ya,ba=(T._transform._rotation01+T._transform._rotation10)*Ya,ea=(T._transform._rotation02+T._transform._rotation20)*Ya,ha=(T._transform._rotation21-T._transform._rotation12)*Ya):(Ya=Math.sqrt(da-pa-ya+1),ea=.5*Ya,Ya=.5/Ya,fa=(T._transform._rotation02+T._transform._rotation20)*Ya,ba=(T._transform._rotation12+T._transform._rotation21)*Ya,ha=(T._transform._rotation10-T._transform._rotation01)*Ya):ya>da?(Ya=Math.sqrt(ya-da-pa+1),ba=.5*Ya,Ya=.5/Ya,fa=(T._transform._rotation01+T._transform._rotation10)*Ya,ea=(T._transform._rotation12+T._transform._rotation21)*Ya,ha=(T._transform._rotation02-T._transform._rotation20)*Ya):(Ya=Math.sqrt(da-pa-ya+1),ea=.5*Ya,Ya=.5/Ya,fa=(T._transform._rotation02+T._transform._rotation20)*Ya,ba=(T._transform._rotation12+T._transform._rotation21)*Ya,ha=(T._transform._rotation10-T._transform._rotation01)*Ya),fa=Za*fa+Ma*ha+za*ea-Xa*ba,ba=Za*ba-Ma*ea+za*ha+Xa*fa,ea=Za*ea+Ma*ba-za*fa+Xa*ha,ha=Za*ha-Ma*fa-za*ba-Xa*ea;var Qa=fa*fa+ba*ba+ea*ea+ha*ha;Qa>1e-32&&(Qa=1/Math.sqrt(Qa)),fa*=Qa,ba*=Qa,ea*=Qa,ha*=Qa;var ga=fa,ua=ba,ka=ea,wa=ha,Pa=2*ga,Mt=2*ua,Oa=2*ka,Ba=ga*Pa,nt=ua*Mt,Ea=ka*Oa,Na=ga*Mt,Sa=ua*Oa,ft=ga*Oa,Wa=wa*Pa,Ha=wa*Mt,bt=wa*Oa;T._transform._rotation00=1-nt-Ea,T._transform._rotation01=Na-bt,T._transform._rotation02=ft+Ha,T._transform._rotation10=Na+bt,T._transform._rotation11=1-Ba-Ea,T._transform._rotation12=Sa-Wa,T._transform._rotation20=ft-Ha,T._transform._rotation21=Sa+Wa,T._transform._rotation22=1-Ba-nt;var rt,ja,_t,gt,mt,Ja,it,ut,Da;rt=T._transform._rotation00*T._invLocalInertia00+T._transform._rotation01*T._invLocalInertia10+T._transform._rotation02*T._invLocalInertia20,ja=T._transform._rotation00*T._invLocalInertia01+T._transform._rotation01*T._invLocalInertia11+T._transform._rotation02*T._invLocalInertia21,_t=T._transform._rotation00*T._invLocalInertia02+T._transform._rotation01*T._invLocalInertia12+T._transform._rotation02*T._invLocalInertia22,gt=T._transform._rotation10*T._invLocalInertia00+T._transform._rotation11*T._invLocalInertia10+T._transform._rotation12*T._invLocalInertia20,mt=T._transform._rotation10*T._invLocalInertia01+T._transform._rotation11*T._invLocalInertia11+T._transform._rotation12*T._invLocalInertia21,Ja=T._transform._rotation10*T._invLocalInertia02+T._transform._rotation11*T._invLocalInertia12+T._transform._rotation12*T._invLocalInertia22,it=T._transform._rotation20*T._invLocalInertia00+T._transform._rotation21*T._invLocalInertia10+T._transform._rotation22*T._invLocalInertia20,ut=T._transform._rotation20*T._invLocalInertia01+T._transform._rotation21*T._invLocalInertia11+T._transform._rotation22*T._invLocalInertia21,Da=T._transform._rotation20*T._invLocalInertia02+T._transform._rotation21*T._invLocalInertia12+T._transform._rotation22*T._invLocalInertia22,T._invInertia00=rt,T._invInertia01=ja,T._invInertia02=_t,T._invInertia10=gt,T._invInertia11=mt,T._invInertia12=Ja,T._invInertia20=it,T._invInertia21=ut,T._invInertia22=Da;var Ta,Fa,Vt,Pt,et,Xt,Yt,zt,Ia;Ta=T._invInertia00*T._transform._rotation00+T._invInertia01*T._transform._rotation01+T._invInertia02*T._transform._rotation02,Fa=T._invInertia00*T._transform._rotation10+T._invInertia01*T._transform._rotation11+T._invInertia02*T._transform._rotation12,Vt=T._invInertia00*T._transform._rotation20+T._invInertia01*T._transform._rotation21+T._invInertia02*T._transform._rotation22,Pt=T._invInertia10*T._transform._rotation00+T._invInertia11*T._transform._rotation01+T._invInertia12*T._transform._rotation02,et=T._invInertia10*T._transform._rotation10+T._invInertia11*T._transform._rotation11+T._invInertia12*T._transform._rotation12,Xt=T._invInertia10*T._transform._rotation20+T._invInertia11*T._transform._rotation21+T._invInertia12*T._transform._rotation22,Yt=T._invInertia20*T._transform._rotation00+T._invInertia21*T._transform._rotation01+T._invInertia22*T._transform._rotation02,zt=T._invInertia20*T._transform._rotation10+T._invInertia21*T._transform._rotation11+T._invInertia22*T._transform._rotation12,Ia=T._invInertia20*T._transform._rotation20+T._invInertia21*T._transform._rotation21+T._invInertia22*T._transform._rotation22,T._invInertia00=Ta,T._invInertia01=Fa,T._invInertia02=Vt,T._invInertia10=Pt,T._invInertia11=et,T._invInertia12=Xt,T._invInertia20=Yt,T._invInertia21=zt,T._invInertia22=Ia,T._invInertia00*=T._rotFactor.x,T._invInertia01*=T._rotFactor.x,T._invInertia02*=T._rotFactor.x,T._invInertia10*=T._rotFactor.y,T._invInertia11*=T._rotFactor.y,T._invInertia12*=T._rotFactor.y,T._invInertia20*=T._rotFactor.z,T._invInertia21*=T._rotFactor.z,T._invInertia22*=T._rotFactor.z;var U=this._b2,Va=Math.sqrt(W*W+J*J+D*D),lt=Va*.5,P,kt;if(lt<.5){var Bt=lt*lt;P=.5*(1-Bt*.16666666666666666+Bt*Bt*.008333333333333333),kt=1-Bt*.5+Bt*Bt*.041666666666666664}else P=Math.sin(lt)/Va,kt=Math.cos(lt);var St,yt,wt;St=W*P,yt=J*P,wt=D*P;var pt,ht,xt,Ra;pt=St,ht=yt,xt=wt,Ra=kt;var st,Ca,vt,qa,at=U._transform._rotation00,Ua=U._transform._rotation11,tt=U._transform._rotation22,ct=at+Ua+tt,Aa;ct>0?(Aa=Math.sqrt(ct+1),qa=.5*Aa,Aa=.5/Aa,st=(U._transform._rotation21-U._transform._rotation12)*Aa,Ca=(U._transform._rotation02-U._transform._rotation20)*Aa,vt=(U._transform._rotation10-U._transform._rotation01)*Aa):at>Ua?at>tt?(Aa=Math.sqrt(at-Ua-tt+1),st=.5*Aa,Aa=.5/Aa,Ca=(U._transform._rotation01+U._transform._rotation10)*Aa,vt=(U._transform._rotation02+U._transform._rotation20)*Aa,qa=(U._transform._rotation21-U._transform._rotation12)*Aa):(Aa=Math.sqrt(tt-at-Ua+1),vt=.5*Aa,Aa=.5/Aa,st=(U._transform._rotation02+U._transform._rotation20)*Aa,Ca=(U._transform._rotation12+U._transform._rotation21)*Aa,qa=(U._transform._rotation10-U._transform._rotation01)*Aa):Ua>tt?(Aa=Math.sqrt(Ua-tt-at+1),Ca=.5*Aa,Aa=.5/Aa,st=(U._transform._rotation01+U._transform._rotation10)*Aa,vt=(U._transform._rotation12+U._transform._rotation21)*Aa,qa=(U._transform._rotation02-U._transform._rotation20)*Aa):(Aa=Math.sqrt(tt-at-Ua+1),vt=.5*Aa,Aa=.5/Aa,st=(U._transform._rotation02+U._transform._rotation20)*Aa,Ca=(U._transform._rotation12+U._transform._rotation21)*Aa,qa=(U._transform._rotation10-U._transform._rotation01)*Aa),st=Ra*st+pt*qa+ht*vt-xt*Ca,Ca=Ra*Ca-pt*vt+ht*qa+xt*st,vt=Ra*vt+pt*Ca-ht*st+xt*qa,qa=Ra*qa-pt*st-ht*Ca-xt*vt;var Ga=st*st+Ca*Ca+vt*vt+qa*qa;Ga>1e-32&&(Ga=1/Math.sqrt(Ga)),st*=Ga,Ca*=Ga,vt*=Ga,qa*=Ga;var Ka=st,La=Ca,ot=vt,It=qa,or=2*Ka,gr=2*La,ar=2*ot,Ct=Ka*or,_r=La*gr,Et=ot*ar,At=Ka*gr,Gt=La*ar,Hr=Ka*ar,vr=It*or,lr=It*gr,tr=It*ar;U._transform._rotation00=1-_r-Et,U._transform._rotation01=At-tr,U._transform._rotation02=Hr+lr,U._transform._rotation10=At+tr,U._transform._rotation11=1-Ct-Et,U._transform._rotation12=Gt-vr,U._transform._rotation20=Hr-lr,U._transform._rotation21=Gt+vr,U._transform._rotation22=1-Ct-_r;var Ur,Xr,Mr,Zt,ir,$t,nr,jr,Wt;Ur=U._transform._rotation00*U._invLocalInertia00+U._transform._rotation01*U._invLocalInertia10+U._transform._rotation02*U._invLocalInertia20,Xr=U._transform._rotation00*U._invLocalInertia01+U._transform._rotation01*U._invLocalInertia11+U._transform._rotation02*U._invLocalInertia21,Mr=U._transform._rotation00*U._invLocalInertia02+U._transform._rotation01*U._invLocalInertia12+U._transform._rotation02*U._invLocalInertia22,Zt=U._transform._rotation10*U._invLocalInertia00+U._transform._rotation11*U._invLocalInertia10+U._transform._rotation12*U._invLocalInertia20,ir=U._transform._rotation10*U._invLocalInertia01+U._transform._rotation11*U._invLocalInertia11+U._transform._rotation12*U._invLocalInertia21,$t=U._transform._rotation10*U._invLocalInertia02+U._transform._rotation11*U._invLocalInertia12+U._transform._rotation12*U._invLocalInertia22,nr=U._transform._rotation20*U._invLocalInertia00+U._transform._rotation21*U._invLocalInertia10+U._transform._rotation22*U._invLocalInertia20,jr=U._transform._rotation20*U._invLocalInertia01+U._transform._rotation21*U._invLocalInertia11+U._transform._rotation22*U._invLocalInertia21,Wt=U._transform._rotation20*U._invLocalInertia02+U._transform._rotation21*U._invLocalInertia12+U._transform._rotation22*U._invLocalInertia22,U._invInertia00=Ur,U._invInertia01=Xr,U._invInertia02=Mr,U._invInertia10=Zt,U._invInertia11=ir,U._invInertia12=$t,U._invInertia20=nr,U._invInertia21=jr,U._invInertia22=Wt;var Kr,Ir,mi,$r,Lt,Kt,Tt,br,zr;Kr=U._invInertia00*U._transform._rotation00+U._invInertia01*U._transform._rotation01+U._invInertia02*U._transform._rotation02,Ir=U._invInertia00*U._transform._rotation10+U._invInertia01*U._transform._rotation11+U._invInertia02*U._transform._rotation12,mi=U._invInertia00*U._transform._rotation20+U._invInertia01*U._transform._rotation21+U._invInertia02*U._transform._rotation22,$r=U._invInertia10*U._transform._rotation00+U._invInertia11*U._transform._rotation01+U._invInertia12*U._transform._rotation02,Lt=U._invInertia10*U._transform._rotation10+U._invInertia11*U._transform._rotation11+U._invInertia12*U._transform._rotation12,Kt=U._invInertia10*U._transform._rotation20+U._invInertia11*U._transform._rotation21+U._invInertia12*U._transform._rotation22,Tt=U._invInertia20*U._transform._rotation00+U._invInertia21*U._transform._rotation01+U._invInertia22*U._transform._rotation02,br=U._invInertia20*U._transform._rotation10+U._invInertia21*U._transform._rotation11+U._invInertia22*U._transform._rotation12,zr=U._invInertia20*U._transform._rotation20+U._invInertia21*U._transform._rotation21+U._invInertia22*U._transform._rotation22,U._invInertia00=Kr,U._invInertia01=Ir,U._invInertia02=mi,U._invInertia10=$r,U._invInertia11=Lt,U._invInertia12=Kt,U._invInertia20=Tt,U._invInertia21=br,U._invInertia22=zr,U._invInertia00*=U._rotFactor.x,U._invInertia01*=U._rotFactor.x,U._invInertia02*=U._rotFactor.x,U._invInertia10*=U._rotFactor.y,U._invInertia11*=U._rotFactor.y,U._invInertia12*=U._rotFactor.y,U._invInertia20*=U._rotFactor.z,U._invInertia21*=U._rotFactor.z,U._invInertia22*=U._rotFactor.z}for(var vi=this.posBoundarySelector,qt=0;vi.indices[qt]!=w;)++qt;for(;qt>0;){var fr=vi.indices[qt];vi.indices[qt]=vi.indices[qt-1],vi.indices[qt-1]=fr,--qt}y=!0;break}}if(!y){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:502:","could not find solution. (NGS)");return}}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}};x.dynamics.constraint.solver.direct.MassMatrix=class{constructor(a){this._size=a;var t=new Array(this._size);this.tmpMatrix=t;var r=new Array(this._size);this._invMass=r;var i=new Array(this._size);this._invMassWithoutCfm=i;for(var o=0,s=this._size;o<s;){var _=o++,h=this.tmpMatrix,v=new Array(this._size);h[_]=v;var e=this._invMass,l=new Array(this._size);e[_]=l;var u=this._invMassWithoutCfm,b=new Array(this._size);u[_]=b;for(var f=0,n=this._size;f<n;){var c=f++;this.tmpMatrix[_][c]=0,this._invMass[_][c]=0,this._invMassWithoutCfm[_][c]=0}}this._maxSubmatrixId=1<<this._size;var M=new Array(this._maxSubmatrixId);this._cacheComputed=M;var m=new Array(this._maxSubmatrixId);this._cachedSubmatrices=m;for(var y=0,V=this._maxSubmatrixId;y<V;){var z=y++,I=z;I=(I&85)+(I>>1&85),I=(I&51)+(I>>2&51),I=(I&15)+(I>>4&15);for(var w=I,X=new Array(w),L=X,p=0,g=w;p<g;){var F=p++,S=new Array(w);L[F]=S;for(var N=0,A=w;N<A;){var Y=N++;L[F][Y]=0}}this._cacheComputed[z]=!1,this._cachedSubmatrices[z]=L}}computeSubmatrix(a,t,r){for(var i=0,o=r;i<o;)for(var s=i++,_=t[s],h=0,v=r;h<v;){var e=h++;this.tmpMatrix[s][e]=this._invMass[_][t[e]]}var l=this.tmpMatrix,u=this._cachedSubmatrices[a],b,f,n,c,M;switch(r){case 4:b=l[0],f=u[0],M=1/b[0],f[0]=M,b[1]=b[1]*M,b[2]=b[2]*M,b[3]=b[3]*M,n=l[1],c=u[1],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n=l[2],c=u[2],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n=l[3],c=u[3],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],b=l[1],f=u[1],M=1/b[1],f[1]=M,f[0]=f[0]*M,b[2]=b[2]*M,b[3]=b[3]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[1],c[1]=-M*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[1],c[1]=-M*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],b=l[2],f=u[2],M=1/b[2],f[2]=M,f[0]=f[0]*M,f[1]=f[1]*M,b[3]=b[3]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[2],n[3]=n[3]-b[3]*n[2],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],n[3]=n[3]-b[3]*n[2],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-M*n[2],n[3]=n[3]-b[3]*n[2],b=l[3],f=u[3],M=1/b[3],f[3]=M,f[0]=f[0]*M,f[1]=f[1]*M,f[2]=f[2]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[3],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],f=u[1],u[0][1]=f[0],f=u[2],u[0][2]=f[0],u[1][2]=f[1],f=u[3],u[0][3]=f[0],u[1][3]=f[1],u[2][3]=f[2];break;case 5:b=l[0],f=u[0],M=1/b[0],f[0]=M,b[1]=b[1]*M,b[2]=b[2]*M,b[3]=b[3]*M,b[4]=b[4]*M,n=l[1],c=u[1],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n=l[2],c=u[2],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n=l[3],c=u[3],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n=l[4],c=u[4],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],b=l[1],f=u[1],M=1/b[1],f[1]=M,f[0]=f[0]*M,b[2]=b[2]*M,b[3]=b[3]*M,b[4]=b[4]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[1],c[1]=-M*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[1],c[1]=-M*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n=l[4],c=u[4],c[0]=c[0]-f[0]*n[1],c[1]=-M*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],b=l[2],f=u[2],M=1/b[2],f[2]=M,f[0]=f[0]*M,f[1]=f[1]*M,b[3]=b[3]*M,b[4]=b[4]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-M*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n=l[4],c=u[4],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-M*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],b=l[3],f=u[3],M=1/b[3],f[3]=M,f[0]=f[0]*M,f[1]=f[1]*M,f[2]=f[2]*M,b[4]=b[4]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[3],n[4]=n[4]-b[4]*n[3],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],n[4]=n[4]-b[4]*n[3],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],n[4]=n[4]-b[4]*n[3],n=l[4],c=u[4],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],c[3]=-M*n[3],n[4]=n[4]-b[4]*n[3],b=l[4],f=u[4],M=1/b[4],f[4]=M,f[0]=f[0]*M,f[1]=f[1]*M,f[2]=f[2]*M,f[3]=f[3]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[4],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],c[2]=c[2]-f[2]*n[4],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],c[2]=c[2]-f[2]*n[4],c[3]=c[3]-f[3]*n[4],f=u[1],u[0][1]=f[0],f=u[2],u[0][2]=f[0],u[1][2]=f[1],f=u[3],u[0][3]=f[0],u[1][3]=f[1],u[2][3]=f[2],f=u[4],u[0][4]=f[0],u[1][4]=f[1],u[2][4]=f[2],u[3][4]=f[3];break;case 6:b=l[0],f=u[0],M=1/b[0],f[0]=M,b[1]=b[1]*M,b[2]=b[2]*M,b[3]=b[3]*M,b[4]=b[4]*M,b[5]=b[5]*M,n=l[1],c=u[1],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n[5]=n[5]-b[5]*n[0],n=l[2],c=u[2],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n[5]=n[5]-b[5]*n[0],n=l[3],c=u[3],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n[5]=n[5]-b[5]*n[0],n=l[4],c=u[4],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n[5]=n[5]-b[5]*n[0],n=l[5],c=u[5],c[0]=-M*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n[5]=n[5]-b[5]*n[0],b=l[1],f=u[1],M=1/b[1],f[1]=M,f[0]=f[0]*M,b[2]=b[2]*M,b[3]=b[3]*M,b[4]=b[4]*M,b[5]=b[5]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n[5]=n[5]-b[5]*n[1],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[1],c[1]=-M*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n[5]=n[5]-b[5]*n[1],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[1],c[1]=-M*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n[5]=n[5]-b[5]*n[1],n=l[4],c=u[4],c[0]=c[0]-f[0]*n[1],c[1]=-M*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n[5]=n[5]-b[5]*n[1],n=l[5],c=u[5],c[0]=c[0]-f[0]*n[1],c[1]=-M*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n[5]=n[5]-b[5]*n[1],b=l[2],f=u[2],M=1/b[2],f[2]=M,f[0]=f[0]*M,f[1]=f[1]*M,b[3]=b[3]*M,b[4]=b[4]*M,b[5]=b[5]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n[5]=n[5]-b[5]*n[2],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n[5]=n[5]-b[5]*n[2],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-M*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n[5]=n[5]-b[5]*n[2],n=l[4],c=u[4],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-M*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n[5]=n[5]-b[5]*n[2],n=l[5],c=u[5],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-M*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n[5]=n[5]-b[5]*n[2],b=l[3],f=u[3],M=1/b[3],f[3]=M,f[0]=f[0]*M,f[1]=f[1]*M,f[2]=f[2]*M,b[4]=b[4]*M,b[5]=b[5]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[3],n[4]=n[4]-b[4]*n[3],n[5]=n[5]-b[5]*n[3],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],n[4]=n[4]-b[4]*n[3],n[5]=n[5]-b[5]*n[3],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],n[4]=n[4]-b[4]*n[3],n[5]=n[5]-b[5]*n[3],n=l[4],c=u[4],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],c[3]=-M*n[3],n[4]=n[4]-b[4]*n[3],n[5]=n[5]-b[5]*n[3],n=l[5],c=u[5],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],c[3]=-M*n[3],n[4]=n[4]-b[4]*n[3],n[5]=n[5]-b[5]*n[3],b=l[4],f=u[4],M=1/b[4],f[4]=M,f[0]=f[0]*M,f[1]=f[1]*M,f[2]=f[2]*M,f[3]=f[3]*M,b[5]=b[5]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[4],n[5]=n[5]-b[5]*n[4],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],n[5]=n[5]-b[5]*n[4],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],c[2]=c[2]-f[2]*n[4],n[5]=n[5]-b[5]*n[4],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],c[2]=c[2]-f[2]*n[4],c[3]=c[3]-f[3]*n[4],n[5]=n[5]-b[5]*n[4],n=l[5],c=u[5],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],c[2]=c[2]-f[2]*n[4],c[3]=c[3]-f[3]*n[4],c[4]=-M*n[4],n[5]=n[5]-b[5]*n[4],b=l[5],f=u[5],M=1/b[5],f[5]=M,f[0]=f[0]*M,f[1]=f[1]*M,f[2]=f[2]*M,f[3]=f[3]*M,f[4]=f[4]*M,n=l[0],c=u[0],c[0]=c[0]-f[0]*n[5],n=l[1],c=u[1],c[0]=c[0]-f[0]*n[5],c[1]=c[1]-f[1]*n[5],n=l[2],c=u[2],c[0]=c[0]-f[0]*n[5],c[1]=c[1]-f[1]*n[5],c[2]=c[2]-f[2]*n[5],n=l[3],c=u[3],c[0]=c[0]-f[0]*n[5],c[1]=c[1]-f[1]*n[5],c[2]=c[2]-f[2]*n[5],c[3]=c[3]-f[3]*n[5],n=l[4],c=u[4],c[0]=c[0]-f[0]*n[5],c[1]=c[1]-f[1]*n[5],c[2]=c[2]-f[2]*n[5],c[3]=c[3]-f[3]*n[5],c[4]=c[4]-f[4]*n[5],f=u[1],u[0][1]=f[0],f=u[2],u[0][2]=f[0],u[1][2]=f[1],f=u[3],u[0][3]=f[0],u[1][3]=f[1],u[2][3]=f[2],f=u[4],u[0][4]=f[0],u[1][4]=f[1],u[2][4]=f[2],u[3][4]=f[3],f=u[5],u[0][5]=f[0],u[1][5]=f[1],u[2][5]=f[2],u[3][5]=f[3],u[4][5]=f[4];break;default:for(var m=0,y=r;m<y;){var V=m++;b=l[V],f=u[V];var z=1/b[V];f[V]=z;for(var I=0,w=V;I<w;){var X=I++;f[X]=f[X]*z}for(var L=V+1,p=r;L<p;){var g=L++;b[g]=b[g]*z}for(var F=0,S=V;F<S;){var N=F++;n=l[N],c=u[N];for(var A=0,Y=N+1;A<Y;){var R=A++;c[R]=c[R]-f[R]*n[V]}for(var C=V+1,d=r;C<d;){var Z=C++;n[Z]=n[Z]-b[Z]*n[V]}}for(var j=V+1,H=r;j<H;){var E=j++;n=l[E],c=u[E];for(var G=0,B=V;G<B;){var Q=G++;c[Q]=c[Q]-f[Q]*n[V]}c[V]=-z*n[V];for(var W=V+1,J=r;W<J;){var D=W++;n[D]=n[D]-b[D]*n[V]}}}for(var O=1,K=r;O<K;){var ra=O++;f=u[ra];for(var sa=0,$=ra;sa<$;){var q=sa++;u[q][ra]=f[q]}}}}computeInvMass(a,t){var r=this._invMass,i=this._invMassWithoutCfm,o=a.numRows,s=a.b1,_=a.b2,h=s._invMass,v=_._invMass,e,l,u,b,f,n,c,M,m,y,V,z,I,w,X,L,p,g;e=s._invInertia00,l=s._invInertia01,u=s._invInertia02,b=s._invInertia10,f=s._invInertia11,n=s._invInertia12,c=s._invInertia20,M=s._invInertia21,m=s._invInertia22,y=_._invInertia00,V=_._invInertia01,z=_._invInertia02,I=_._invInertia10,w=_._invInertia11,X=_._invInertia12,L=_._invInertia20,p=_._invInertia21,g=_._invInertia22;for(var F=0,S=o;F<S;){var N=F++,A=a.rows[N].jacobian,Y=t[N];if(A.updateSparsity(),A.flag&1?(Y.invMLin1X=A.lin1X*h,Y.invMLin1Y=A.lin1Y*h,Y.invMLin1Z=A.lin1Z*h,Y.invMLin2X=A.lin2X*v,Y.invMLin2Y=A.lin2Y*v,Y.invMLin2Z=A.lin2Z*v):(Y.invMLin1X=0,Y.invMLin1Y=0,Y.invMLin1Z=0,Y.invMLin2X=0,Y.invMLin2Y=0,Y.invMLin2Z=0),A.flag&2){var R,C,d;R=e*A.ang1X+l*A.ang1Y+u*A.ang1Z,C=b*A.ang1X+f*A.ang1Y+n*A.ang1Z,d=c*A.ang1X+M*A.ang1Y+m*A.ang1Z,Y.invMAng1X=R,Y.invMAng1Y=C,Y.invMAng1Z=d;var Z,j,H;Z=y*A.ang2X+V*A.ang2Y+z*A.ang2Z,j=I*A.ang2X+w*A.ang2Y+X*A.ang2Z,H=L*A.ang2X+p*A.ang2Y+g*A.ang2Z,Y.invMAng2X=Z,Y.invMAng2Y=j,Y.invMAng2Z=H}else Y.invMAng1X=0,Y.invMAng1Y=0,Y.invMAng1Z=0,Y.invMAng2X=0,Y.invMAng2Y=0,Y.invMAng2Z=0}for(var E=0,G=o;E<G;)for(var B=E++,Q=a.rows[B].jacobian,W=B,J=o;W<J;){var D=W++;a.rows[D].jacobian;var O=t[D],K=Q.lin1X*O.invMLin1X+Q.lin1Y*O.invMLin1Y+Q.lin1Z*O.invMLin1Z+(Q.ang1X*O.invMAng1X+Q.ang1Y*O.invMAng1Y+Q.ang1Z*O.invMAng1Z)+(Q.lin2X*O.invMLin2X+Q.lin2Y*O.invMLin2Y+Q.lin2Z*O.invMLin2Z)+(Q.ang2X*O.invMAng2X+Q.ang2Y*O.invMAng2Y+Q.ang2Z*O.invMAng2Z);B==D?(r[B][D]=K+a.rows[B].cfm,i[B][D]=K,O.mass=K+a.rows[B].cfm,O.massWithoutCfm=K,O.mass!=0&&(O.mass=1/O.mass),O.massWithoutCfm!=0&&(O.massWithoutCfm=1/O.massWithoutCfm)):(r[B][D]=K,r[D][B]=K,i[B][D]=K,i[D][B]=K)}for(var ra=0,sa=this._maxSubmatrixId;ra<sa;){var $=ra++;this._cacheComputed[$]=!1}}};x.dynamics.constraint.solver.pgs||(x.dynamics.constraint.solver.pgs={});x.dynamics.constraint.solver.pgs.PgsContactConstraintSolver=class extends x.dynamics.constraint.ConstraintSolver{constructor(a){super(),this.constraint=a,this.info=new x.dynamics.constraint.info.contact.ContactSolverInfo;var t=new Array(x.common.Setting.maxManifoldPoints);this.massData=t;for(var r=0,i=this.massData.length;r<i;){var o=r++;this.massData[o]=new x.dynamics.constraint.solver.common.ContactSolverMassDataRow}}preSolveVelocity(a){this.constraint._getVelocitySolverInfo(a,this.info),this._b1=this.info.b1,this._b2=this.info.b2;var t=this._b1._invMass,r=this._b2._invMass,i,o,s,_,h,v,e,l,u,b,f,n,c,M,m,y,V,z;i=this._b1._invInertia00,o=this._b1._invInertia01,s=this._b1._invInertia02,_=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,e=this._b1._invInertia20,l=this._b1._invInertia21,u=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,M=this._b2._invInertia11,m=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,z=this._b2._invInertia22;for(var I=0,w=this.info.numRows;I<w;){var X=I++,L=this.info.rows[X],p=this.massData[X],g=L.jacobianN;p.invMLinN1X=g.lin1X*t,p.invMLinN1Y=g.lin1Y*t,p.invMLinN1Z=g.lin1Z*t,p.invMLinN2X=g.lin2X*r,p.invMLinN2Y=g.lin2Y*r,p.invMLinN2Z=g.lin2Z*r;var F,S,N;F=i*g.ang1X+o*g.ang1Y+s*g.ang1Z,S=_*g.ang1X+h*g.ang1Y+v*g.ang1Z,N=e*g.ang1X+l*g.ang1Y+u*g.ang1Z,p.invMAngN1X=F,p.invMAngN1Y=S,p.invMAngN1Z=N;var A,Y,R;A=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+M*g.ang2Y+m*g.ang2Z,R=y*g.ang2X+V*g.ang2Y+z*g.ang2Z,p.invMAngN2X=A,p.invMAngN2Y=Y,p.invMAngN2Z=R,p.massN=t+r+(p.invMAngN1X*g.ang1X+p.invMAngN1Y*g.ang1Y+p.invMAngN1Z*g.ang1Z)+(p.invMAngN2X*g.ang2X+p.invMAngN2Y*g.ang2Y+p.invMAngN2Z*g.ang2Z),p.massN!=0&&(p.massN=1/p.massN);var C=L.jacobianT,d=L.jacobianB;p.invMLinT1X=C.lin1X*t,p.invMLinT1Y=C.lin1Y*t,p.invMLinT1Z=C.lin1Z*t,p.invMLinT2X=C.lin2X*r,p.invMLinT2Y=C.lin2Y*r,p.invMLinT2Z=C.lin2Z*r,p.invMLinB1X=d.lin1X*t,p.invMLinB1Y=d.lin1Y*t,p.invMLinB1Z=d.lin1Z*t,p.invMLinB2X=d.lin2X*r,p.invMLinB2Y=d.lin2Y*r,p.invMLinB2Z=d.lin2Z*r;var Z,j,H;Z=i*C.ang1X+o*C.ang1Y+s*C.ang1Z,j=_*C.ang1X+h*C.ang1Y+v*C.ang1Z,H=e*C.ang1X+l*C.ang1Y+u*C.ang1Z,p.invMAngT1X=Z,p.invMAngT1Y=j,p.invMAngT1Z=H;var E,G,B;E=b*C.ang2X+f*C.ang2Y+n*C.ang2Z,G=c*C.ang2X+M*C.ang2Y+m*C.ang2Z,B=y*C.ang2X+V*C.ang2Y+z*C.ang2Z,p.invMAngT2X=E,p.invMAngT2Y=G,p.invMAngT2Z=B;var Q,W,J;Q=i*d.ang1X+o*d.ang1Y+s*d.ang1Z,W=_*d.ang1X+h*d.ang1Y+v*d.ang1Z,J=e*d.ang1X+l*d.ang1Y+u*d.ang1Z,p.invMAngB1X=Q,p.invMAngB1Y=W,p.invMAngB1Z=J;var D,O,K;D=b*d.ang2X+f*d.ang2Y+n*d.ang2Z,O=c*d.ang2X+M*d.ang2Y+m*d.ang2Z,K=y*d.ang2X+V*d.ang2Y+z*d.ang2Z,p.invMAngB2X=D,p.invMAngB2Y=O,p.invMAngB2Z=K;var ra=t+r+(p.invMAngT1X*C.ang1X+p.invMAngT1Y*C.ang1Y+p.invMAngT1Z*C.ang1Z)+(p.invMAngT2X*C.ang2X+p.invMAngT2Y*C.ang2Y+p.invMAngT2Z*C.ang2Z),sa=p.invMAngT1X*d.ang1X+p.invMAngT1Y*d.ang1Y+p.invMAngT1Z*d.ang1Z+(p.invMAngT2X*d.ang2X+p.invMAngT2Y*d.ang2Y+p.invMAngT2Z*d.ang2Z),$=sa,q=t+r+(p.invMAngB1X*d.ang1X+p.invMAngB1Y*d.ang1Y+p.invMAngB1Z*d.ang1Z)+(p.invMAngB2X*d.ang2X+p.invMAngB2Y*d.ang2Y+p.invMAngB2Z*d.ang2Z),na=ra*q-sa*$;na!=0&&(na=1/na),p.massTB00=q*na,p.massTB01=-sa*na,p.massTB10=-$*na,p.massTB11=ra*na}}warmStart(a){var t,r,i,o,s,_,h,v,e,l,u,b;t=this._b1._velX,r=this._b1._velY,i=this._b1._velZ,o=this._b2._velX,s=this._b2._velY,_=this._b2._velZ,h=this._b1._angVelX,v=this._b1._angVelY,e=this._b1._angVelZ,l=this._b2._angVelX,u=this._b2._angVelY,b=this._b2._angVelZ;for(var f=0,n=this.info.numRows;f<n;){var c=f++,M=this.info.rows[c],m=M.impulse,y=this.massData[c],V=M.jacobianT,z=M.jacobianB,I=m.impulseN,w=m.impulseLX*V.lin1X+m.impulseLY*V.lin1Y+m.impulseLZ*V.lin1Z,X=m.impulseLX*z.lin1X+m.impulseLY*z.lin1Y+m.impulseLZ*z.lin1Z;m.impulseT=w,m.impulseB=X,m.impulseN*=a.dtRatio,m.impulseT*=a.dtRatio,m.impulseB*=a.dtRatio,t+=y.invMLinN1X*I,r+=y.invMLinN1Y*I,i+=y.invMLinN1Z*I,t+=y.invMLinT1X*w,r+=y.invMLinT1Y*w,i+=y.invMLinT1Z*w,t+=y.invMLinB1X*X,r+=y.invMLinB1Y*X,i+=y.invMLinB1Z*X,o+=y.invMLinN2X*-I,s+=y.invMLinN2Y*-I,_+=y.invMLinN2Z*-I,o+=y.invMLinT2X*-w,s+=y.invMLinT2Y*-w,_+=y.invMLinT2Z*-w,o+=y.invMLinB2X*-X,s+=y.invMLinB2Y*-X,_+=y.invMLinB2Z*-X,h+=y.invMAngN1X*I,v+=y.invMAngN1Y*I,e+=y.invMAngN1Z*I,h+=y.invMAngT1X*w,v+=y.invMAngT1Y*w,e+=y.invMAngT1Z*w,h+=y.invMAngB1X*X,v+=y.invMAngB1Y*X,e+=y.invMAngB1Z*X,l+=y.invMAngN2X*-I,u+=y.invMAngN2Y*-I,b+=y.invMAngN2Z*-I,l+=y.invMAngT2X*-w,u+=y.invMAngT2Y*-w,b+=y.invMAngT2Z*-w,l+=y.invMAngB2X*-X,u+=y.invMAngB2Y*-X,b+=y.invMAngB2Z*-X}this._b1._velX=t,this._b1._velY=r,this._b1._velZ=i,this._b2._velX=o,this._b2._velY=s,this._b2._velZ=_,this._b1._angVelX=h,this._b1._angVelY=v,this._b1._angVelZ=e,this._b2._angVelX=l,this._b2._angVelY=u,this._b2._angVelZ=b}solveVelocity(){var a,t,r,i,o,s,_,h,v,e,l,u;a=this._b1._velX,t=this._b1._velY,r=this._b1._velZ,i=this._b2._velX,o=this._b2._velY,s=this._b2._velZ,_=this._b1._angVelX,h=this._b1._angVelY,v=this._b1._angVelZ,e=this._b2._angVelX,l=this._b2._angVelY,u=this._b2._angVelZ;for(var b=0,f=this.info.numRows;b<f;){var n=b++,c=this.info.rows[n],M=this.massData[n],m=c.impulse,y=0,V=c.jacobianT;y+=a*V.lin1X+t*V.lin1Y+r*V.lin1Z,y-=i*V.lin2X+o*V.lin2Y+s*V.lin2Z,y+=_*V.ang1X+h*V.ang1Y+v*V.ang1Z,y-=e*V.ang2X+l*V.ang2Y+u*V.ang2Z;var z=0;V=c.jacobianB,z+=a*V.lin1X+t*V.lin1Y+r*V.lin1Z,z-=i*V.lin2X+o*V.lin2Y+s*V.lin2Z,z+=_*V.ang1X+h*V.ang1Y+v*V.ang1Z,z-=e*V.ang2X+l*V.ang2Y+u*V.ang2Z;var I=-(y*M.massTB00+z*M.massTB01),w=-(y*M.massTB10+z*M.massTB11),X=m.impulseT,L=m.impulseB;m.impulseT+=I,m.impulseB+=w;var p=c.friction*m.impulseN;if(p==0)m.impulseT=0,m.impulseB=0;else{var g=m.impulseT*m.impulseT+m.impulseB*m.impulseB;if(g>p*p){var F=p/Math.sqrt(g);m.impulseT*=F,m.impulseB*=F}}I=m.impulseT-X,w=m.impulseB-L,a+=M.invMLinT1X*I,t+=M.invMLinT1Y*I,r+=M.invMLinT1Z*I,a+=M.invMLinB1X*w,t+=M.invMLinB1Y*w,r+=M.invMLinB1Z*w,i+=M.invMLinT2X*-I,o+=M.invMLinT2Y*-I,s+=M.invMLinT2Z*-I,i+=M.invMLinB2X*-w,o+=M.invMLinB2Y*-w,s+=M.invMLinB2Z*-w,_+=M.invMAngT1X*I,h+=M.invMAngT1Y*I,v+=M.invMAngT1Z*I,_+=M.invMAngB1X*w,h+=M.invMAngB1Y*w,v+=M.invMAngB1Z*w,e+=M.invMAngT2X*-I,l+=M.invMAngT2Y*-I,u+=M.invMAngT2Z*-I,e+=M.invMAngB2X*-w,l+=M.invMAngB2Y*-w,u+=M.invMAngB2Z*-w}for(var S=0,N=this.info.numRows;S<N;){var A=S++,Y=this.info.rows[A],R=this.massData[A],C=Y.impulse,d=0,Z=Y.jacobianN;d+=a*Z.lin1X+t*Z.lin1Y+r*Z.lin1Z,d-=i*Z.lin2X+o*Z.lin2Y+s*Z.lin2Z,d+=_*Z.ang1X+h*Z.ang1Y+v*Z.ang1Z,d-=e*Z.ang2X+l*Z.ang2Y+u*Z.ang2Z;var j=(Y.rhs-d)*R.massN,H=C.impulseN;C.impulseN+=j,C.impulseN<0&&(C.impulseN=0),j=C.impulseN-H,a+=R.invMLinN1X*j,t+=R.invMLinN1Y*j,r+=R.invMLinN1Z*j,i+=R.invMLinN2X*-j,o+=R.invMLinN2Y*-j,s+=R.invMLinN2Z*-j,_+=R.invMAngN1X*j,h+=R.invMAngN1Y*j,v+=R.invMAngN1Z*j,e+=R.invMAngN2X*-j,l+=R.invMAngN2Y*-j,u+=R.invMAngN2Z*-j}this._b1._velX=a,this._b1._velY=t,this._b1._velZ=r,this._b2._velX=i,this._b2._velY=o,this._b2._velZ=s,this._b1._angVelX=_,this._b1._angVelY=h,this._b1._angVelZ=v,this._b2._angVelX=e,this._b2._angVelY=l,this._b2._angVelZ=u}preSolvePosition(a){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);var t=this._b1._invMass,r=this._b2._invMass,i,o,s,_,h,v,e,l,u,b,f,n,c,M,m,y,V,z;i=this._b1._invInertia00,o=this._b1._invInertia01,s=this._b1._invInertia02,_=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,e=this._b1._invInertia20,l=this._b1._invInertia21,u=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,M=this._b2._invInertia11,m=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,z=this._b2._invInertia22;for(var I=0,w=this.info.numRows;I<w;){var X=I++,L=this.info.rows[X],p=this.massData[X],g=L.jacobianN;p.invMLinN1X=g.lin1X*t,p.invMLinN1Y=g.lin1Y*t,p.invMLinN1Z=g.lin1Z*t,p.invMLinN2X=g.lin2X*r,p.invMLinN2Y=g.lin2Y*r,p.invMLinN2Z=g.lin2Z*r;var F,S,N;F=i*g.ang1X+o*g.ang1Y+s*g.ang1Z,S=_*g.ang1X+h*g.ang1Y+v*g.ang1Z,N=e*g.ang1X+l*g.ang1Y+u*g.ang1Z,p.invMAngN1X=F,p.invMAngN1Y=S,p.invMAngN1Z=N;var A,Y,R;A=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+M*g.ang2Y+m*g.ang2Z,R=y*g.ang2X+V*g.ang2Y+z*g.ang2Z,p.invMAngN2X=A,p.invMAngN2Y=Y,p.invMAngN2Z=R,p.massN=t+r+(p.invMAngN1X*g.ang1X+p.invMAngN1Y*g.ang1Y+p.invMAngN1Z*g.ang1Z)+(p.invMAngN2X*g.ang2X+p.invMAngN2Y*g.ang2Y+p.invMAngN2Z*g.ang2Z),p.massN!=0&&(p.massN=1/p.massN)}for(var C=0,d=this.info.numRows;C<d;){var Z=C++;this.info.rows[Z].impulse.impulseP=0}}solvePositionSplitImpulse(){var a,t,r,i,o,s,_,h,v,e,l,u;a=this._b1._pseudoVelX,t=this._b1._pseudoVelY,r=this._b1._pseudoVelZ,i=this._b2._pseudoVelX,o=this._b2._pseudoVelY,s=this._b2._pseudoVelZ,_=this._b1._angPseudoVelX,h=this._b1._angPseudoVelY,v=this._b1._angPseudoVelZ,e=this._b2._angPseudoVelX,l=this._b2._angPseudoVelY,u=this._b2._angPseudoVelZ;for(var b=0,f=this.info.numRows;b<f;){var n=b++,c=this.info.rows[n],M=this.massData[n],m=c.impulse,y=c.jacobianN,V=0;V+=a*y.lin1X+t*y.lin1Y+r*y.lin1Z,V-=i*y.lin2X+o*y.lin2Y+s*y.lin2Z,V+=_*y.ang1X+h*y.ang1Y+v*y.ang1Z,V-=e*y.ang2X+l*y.ang2Y+u*y.ang2Z;var z=(c.rhs-V)*M.massN*x.common.Setting.positionSplitImpulseBaumgarte,I=m.impulseP;m.impulseP+=z,m.impulseP<0&&(m.impulseP=0),z=m.impulseP-I,a+=M.invMLinN1X*z,t+=M.invMLinN1Y*z,r+=M.invMLinN1Z*z,i+=M.invMLinN2X*-z,o+=M.invMLinN2Y*-z,s+=M.invMLinN2Z*-z,_+=M.invMAngN1X*z,h+=M.invMAngN1Y*z,v+=M.invMAngN1Z*z,e+=M.invMAngN2X*-z,l+=M.invMAngN2Y*-z,u+=M.invMAngN2Z*-z}this._b1._pseudoVelX=a,this._b1._pseudoVelY=t,this._b1._pseudoVelZ=r,this._b2._pseudoVelX=i,this._b2._pseudoVelY=o,this._b2._pseudoVelZ=s,this._b1._angPseudoVelX=_,this._b1._angPseudoVelY=h,this._b1._angPseudoVelZ=v,this._b2._angPseudoVelX=e,this._b2._angPseudoVelY=l,this._b2._angPseudoVelZ=u}solvePositionNgs(a){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);var t=this._b1._invMass,r=this._b2._invMass,i,o,s,_,h,v,e,l,u,b,f,n,c,M,m,y,V,z;i=this._b1._invInertia00,o=this._b1._invInertia01,s=this._b1._invInertia02,_=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,e=this._b1._invInertia20,l=this._b1._invInertia21,u=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,M=this._b2._invInertia11,m=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,z=this._b2._invInertia22;for(var I=0,w=this.info.numRows;I<w;){var X=I++,L=this.info.rows[X],p=this.massData[X],g=L.jacobianN;p.invMLinN1X=g.lin1X*t,p.invMLinN1Y=g.lin1Y*t,p.invMLinN1Z=g.lin1Z*t,p.invMLinN2X=g.lin2X*r,p.invMLinN2Y=g.lin2Y*r,p.invMLinN2Z=g.lin2Z*r;var F,S,N;F=i*g.ang1X+o*g.ang1Y+s*g.ang1Z,S=_*g.ang1X+h*g.ang1Y+v*g.ang1Z,N=e*g.ang1X+l*g.ang1Y+u*g.ang1Z,p.invMAngN1X=F,p.invMAngN1Y=S,p.invMAngN1Z=N;var A,Y,R;A=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+M*g.ang2Y+m*g.ang2Z,R=y*g.ang2X+V*g.ang2Y+z*g.ang2Z,p.invMAngN2X=A,p.invMAngN2Y=Y,p.invMAngN2Z=R,p.massN=t+r+(p.invMAngN1X*g.ang1X+p.invMAngN1Y*g.ang1Y+p.invMAngN1Z*g.ang1Z)+(p.invMAngN2X*g.ang2X+p.invMAngN2Y*g.ang2Y+p.invMAngN2Z*g.ang2Z),p.massN!=0&&(p.massN=1/p.massN)}var C,d,Z,j,H,E,G,B,Q,W,J,D;C=0,d=0,Z=0,j=0,H=0,E=0,G=0,B=0,Q=0,W=0,J=0,D=0;for(var O=0,K=this.info.numRows;O<K;){var ra=O++,sa=this.info.rows[ra],$=this.massData[ra],q=sa.impulse,na=sa.jacobianN,oa=0;oa+=C*na.lin1X+d*na.lin1Y+Z*na.lin1Z,oa-=j*na.lin2X+H*na.lin2Y+E*na.lin2Z,oa+=G*na.ang1X+B*na.ang1Y+Q*na.ang1Z,oa-=W*na.ang2X+J*na.ang2Y+D*na.ang2Z;var aa=(sa.rhs-oa)*$.massN*x.common.Setting.positionNgsBaumgarte,T=q.impulseP;q.impulseP+=aa,q.impulseP<0&&(q.impulseP=0),aa=q.impulseP-T,C+=$.invMLinN1X*aa,d+=$.invMLinN1Y*aa,Z+=$.invMLinN1Z*aa,j+=$.invMLinN2X*-aa,H+=$.invMLinN2Y*-aa,E+=$.invMLinN2Z*-aa,G+=$.invMAngN1X*aa,B+=$.invMAngN1Y*aa,Q+=$.invMAngN1Z*aa,W+=$.invMAngN2X*-aa,J+=$.invMAngN2Y*-aa,D+=$.invMAngN2Z*-aa}var ca=this._b1;ca._transform._positionX+=C,ca._transform._positionY+=d,ca._transform._positionZ+=Z;var _a=this._b2;_a._transform._positionX+=j,_a._transform._positionY+=H,_a._transform._positionZ+=E;var k=this._b1,ta=Math.sqrt(G*G+B*B+Q*Q),ia=ta*.5,la,va;if(ia<.5){var xa=ia*ia;la=.5*(1-xa*.16666666666666666+xa*xa*.008333333333333333),va=1-xa*.5+xa*xa*.041666666666666664}else la=Math.sin(ia)/ta,va=Math.cos(ia);var Ma,za,Xa;Ma=G*la,za=B*la,Xa=Q*la;var Za,fa,ba,ea;Za=Ma,fa=za,ba=Xa,ea=va;var ha,pa,ya,da,ma=k._transform._rotation00,Ya=k._transform._rotation11,Qa=k._transform._rotation22,ga=ma+Ya+Qa,ua;ga>0?(ua=Math.sqrt(ga+1),da=.5*ua,ua=.5/ua,ha=(k._transform._rotation21-k._transform._rotation12)*ua,pa=(k._transform._rotation02-k._transform._rotation20)*ua,ya=(k._transform._rotation10-k._transform._rotation01)*ua):ma>Ya?ma>Qa?(ua=Math.sqrt(ma-Ya-Qa+1),ha=.5*ua,ua=.5/ua,pa=(k._transform._rotation01+k._transform._rotation10)*ua,ya=(k._transform._rotation02+k._transform._rotation20)*ua,da=(k._transform._rotation21-k._transform._rotation12)*ua):(ua=Math.sqrt(Qa-ma-Ya+1),ya=.5*ua,ua=.5/ua,ha=(k._transform._rotation02+k._transform._rotation20)*ua,pa=(k._transform._rotation12+k._transform._rotation21)*ua,da=(k._transform._rotation10-k._transform._rotation01)*ua):Ya>Qa?(ua=Math.sqrt(Ya-Qa-ma+1),pa=.5*ua,ua=.5/ua,ha=(k._transform._rotation01+k._transform._rotation10)*ua,ya=(k._transform._rotation12+k._transform._rotation21)*ua,da=(k._transform._rotation02-k._transform._rotation20)*ua):(ua=Math.sqrt(Qa-ma-Ya+1),ya=.5*ua,ua=.5/ua,ha=(k._transform._rotation02+k._transform._rotation20)*ua,pa=(k._transform._rotation12+k._transform._rotation21)*ua,da=(k._transform._rotation10-k._transform._rotation01)*ua),ha=ea*ha+Za*da+fa*ya-ba*pa,pa=ea*pa-Za*ya+fa*da+ba*ha,ya=ea*ya+Za*pa-fa*ha+ba*da,da=ea*da-Za*ha-fa*pa-ba*ya;var ka=ha*ha+pa*pa+ya*ya+da*da;ka>1e-32&&(ka=1/Math.sqrt(ka)),ha*=ka,pa*=ka,ya*=ka,da*=ka;var wa=ha,Pa=pa,Mt=ya,Oa=da,Ba=2*wa,nt=2*Pa,Ea=2*Mt,Na=wa*Ba,Sa=Pa*nt,ft=Mt*Ea,Wa=wa*nt,Ha=Pa*Ea,bt=wa*Ea,rt=Oa*Ba,ja=Oa*nt,_t=Oa*Ea;k._transform._rotation00=1-Sa-ft,k._transform._rotation01=Wa-_t,k._transform._rotation02=bt+ja,k._transform._rotation10=Wa+_t,k._transform._rotation11=1-Na-ft,k._transform._rotation12=Ha-rt,k._transform._rotation20=bt-ja,k._transform._rotation21=Ha+rt,k._transform._rotation22=1-Na-Sa;var gt,mt,Ja,it,ut,Da,Ta,Fa,Vt;gt=k._transform._rotation00*k._invLocalInertia00+k._transform._rotation01*k._invLocalInertia10+k._transform._rotation02*k._invLocalInertia20,mt=k._transform._rotation00*k._invLocalInertia01+k._transform._rotation01*k._invLocalInertia11+k._transform._rotation02*k._invLocalInertia21,Ja=k._transform._rotation00*k._invLocalInertia02+k._transform._rotation01*k._invLocalInertia12+k._transform._rotation02*k._invLocalInertia22,it=k._transform._rotation10*k._invLocalInertia00+k._transform._rotation11*k._invLocalInertia10+k._transform._rotation12*k._invLocalInertia20,ut=k._transform._rotation10*k._invLocalInertia01+k._transform._rotation11*k._invLocalInertia11+k._transform._rotation12*k._invLocalInertia21,Da=k._transform._rotation10*k._invLocalInertia02+k._transform._rotation11*k._invLocalInertia12+k._transform._rotation12*k._invLocalInertia22,Ta=k._transform._rotation20*k._invLocalInertia00+k._transform._rotation21*k._invLocalInertia10+k._transform._rotation22*k._invLocalInertia20,Fa=k._transform._rotation20*k._invLocalInertia01+k._transform._rotation21*k._invLocalInertia11+k._transform._rotation22*k._invLocalInertia21,Vt=k._transform._rotation20*k._invLocalInertia02+k._transform._rotation21*k._invLocalInertia12+k._transform._rotation22*k._invLocalInertia22,k._invInertia00=gt,k._invInertia01=mt,k._invInertia02=Ja,k._invInertia10=it,k._invInertia11=ut,k._invInertia12=Da,k._invInertia20=Ta,k._invInertia21=Fa,k._invInertia22=Vt;var Pt,et,Xt,Yt,zt,Ia,U,Va,lt;Pt=k._invInertia00*k._transform._rotation00+k._invInertia01*k._transform._rotation01+k._invInertia02*k._transform._rotation02,et=k._invInertia00*k._transform._rotation10+k._invInertia01*k._transform._rotation11+k._invInertia02*k._transform._rotation12,Xt=k._invInertia00*k._transform._rotation20+k._invInertia01*k._transform._rotation21+k._invInertia02*k._transform._rotation22,Yt=k._invInertia10*k._transform._rotation00+k._invInertia11*k._transform._rotation01+k._invInertia12*k._transform._rotation02,zt=k._invInertia10*k._transform._rotation10+k._invInertia11*k._transform._rotation11+k._invInertia12*k._transform._rotation12,Ia=k._invInertia10*k._transform._rotation20+k._invInertia11*k._transform._rotation21+k._invInertia12*k._transform._rotation22,U=k._invInertia20*k._transform._rotation00+k._invInertia21*k._transform._rotation01+k._invInertia22*k._transform._rotation02,Va=k._invInertia20*k._transform._rotation10+k._invInertia21*k._transform._rotation11+k._invInertia22*k._transform._rotation12,lt=k._invInertia20*k._transform._rotation20+k._invInertia21*k._transform._rotation21+k._invInertia22*k._transform._rotation22,k._invInertia00=Pt,k._invInertia01=et,k._invInertia02=Xt,k._invInertia10=Yt,k._invInertia11=zt,k._invInertia12=Ia,k._invInertia20=U,k._invInertia21=Va,k._invInertia22=lt,k._invInertia00*=k._rotFactor.x,k._invInertia01*=k._rotFactor.x,k._invInertia02*=k._rotFactor.x,k._invInertia10*=k._rotFactor.y,k._invInertia11*=k._rotFactor.y,k._invInertia12*=k._rotFactor.y,k._invInertia20*=k._rotFactor.z,k._invInertia21*=k._rotFactor.z,k._invInertia22*=k._rotFactor.z;var P=this._b2,kt=Math.sqrt(W*W+J*J+D*D),Bt=kt*.5,St,yt;if(Bt<.5){var wt=Bt*Bt;St=.5*(1-wt*.16666666666666666+wt*wt*.008333333333333333),yt=1-wt*.5+wt*wt*.041666666666666664}else St=Math.sin(Bt)/kt,yt=Math.cos(Bt);var pt,ht,xt;pt=W*St,ht=J*St,xt=D*St;var Ra,st,Ca,vt;Ra=pt,st=ht,Ca=xt,vt=yt;var qa,at,Ua,tt,ct=P._transform._rotation00,Aa=P._transform._rotation11,Ga=P._transform._rotation22,Ka=ct+Aa+Ga,La;Ka>0?(La=Math.sqrt(Ka+1),tt=.5*La,La=.5/La,qa=(P._transform._rotation21-P._transform._rotation12)*La,at=(P._transform._rotation02-P._transform._rotation20)*La,Ua=(P._transform._rotation10-P._transform._rotation01)*La):ct>Aa?ct>Ga?(La=Math.sqrt(ct-Aa-Ga+1),qa=.5*La,La=.5/La,at=(P._transform._rotation01+P._transform._rotation10)*La,Ua=(P._transform._rotation02+P._transform._rotation20)*La,tt=(P._transform._rotation21-P._transform._rotation12)*La):(La=Math.sqrt(Ga-ct-Aa+1),Ua=.5*La,La=.5/La,qa=(P._transform._rotation02+P._transform._rotation20)*La,at=(P._transform._rotation12+P._transform._rotation21)*La,tt=(P._transform._rotation10-P._transform._rotation01)*La):Aa>Ga?(La=Math.sqrt(Aa-Ga-ct+1),at=.5*La,La=.5/La,qa=(P._transform._rotation01+P._transform._rotation10)*La,Ua=(P._transform._rotation12+P._transform._rotation21)*La,tt=(P._transform._rotation02-P._transform._rotation20)*La):(La=Math.sqrt(Ga-ct-Aa+1),Ua=.5*La,La=.5/La,qa=(P._transform._rotation02+P._transform._rotation20)*La,at=(P._transform._rotation12+P._transform._rotation21)*La,tt=(P._transform._rotation10-P._transform._rotation01)*La),qa=vt*qa+Ra*tt+st*Ua-Ca*at,at=vt*at-Ra*Ua+st*tt+Ca*qa,Ua=vt*Ua+Ra*at-st*qa+Ca*tt,tt=vt*tt-Ra*qa-st*at-Ca*Ua;var ot=qa*qa+at*at+Ua*Ua+tt*tt;ot>1e-32&&(ot=1/Math.sqrt(ot)),qa*=ot,at*=ot,Ua*=ot,tt*=ot;var It=qa,or=at,gr=Ua,ar=tt,Ct=2*It,_r=2*or,Et=2*gr,At=It*Ct,Gt=or*_r,Hr=gr*Et,vr=It*_r,lr=or*Et,tr=It*Et,Ur=ar*Ct,Xr=ar*_r,Mr=ar*Et;P._transform._rotation00=1-Gt-Hr,P._transform._rotation01=vr-Mr,P._transform._rotation02=tr+Xr,P._transform._rotation10=vr+Mr,P._transform._rotation11=1-At-Hr,P._transform._rotation12=lr-Ur,P._transform._rotation20=tr-Xr,P._transform._rotation21=lr+Ur,P._transform._rotation22=1-At-Gt;var Zt,ir,$t,nr,jr,Wt,Kr,Ir,mi;Zt=P._transform._rotation00*P._invLocalInertia00+P._transform._rotation01*P._invLocalInertia10+P._transform._rotation02*P._invLocalInertia20,ir=P._transform._rotation00*P._invLocalInertia01+P._transform._rotation01*P._invLocalInertia11+P._transform._rotation02*P._invLocalInertia21,$t=P._transform._rotation00*P._invLocalInertia02+P._transform._rotation01*P._invLocalInertia12+P._transform._rotation02*P._invLocalInertia22,nr=P._transform._rotation10*P._invLocalInertia00+P._transform._rotation11*P._invLocalInertia10+P._transform._rotation12*P._invLocalInertia20,jr=P._transform._rotation10*P._invLocalInertia01+P._transform._rotation11*P._invLocalInertia11+P._transform._rotation12*P._invLocalInertia21,Wt=P._transform._rotation10*P._invLocalInertia02+P._transform._rotation11*P._invLocalInertia12+P._transform._rotation12*P._invLocalInertia22,Kr=P._transform._rotation20*P._invLocalInertia00+P._transform._rotation21*P._invLocalInertia10+P._transform._rotation22*P._invLocalInertia20,Ir=P._transform._rotation20*P._invLocalInertia01+P._transform._rotation21*P._invLocalInertia11+P._transform._rotation22*P._invLocalInertia21,mi=P._transform._rotation20*P._invLocalInertia02+P._transform._rotation21*P._invLocalInertia12+P._transform._rotation22*P._invLocalInertia22,P._invInertia00=Zt,P._invInertia01=ir,P._invInertia02=$t,P._invInertia10=nr,P._invInertia11=jr,P._invInertia12=Wt,P._invInertia20=Kr,P._invInertia21=Ir,P._invInertia22=mi;var $r,Lt,Kt,Tt,br,zr,vi,qt,fr;$r=P._invInertia00*P._transform._rotation00+P._invInertia01*P._transform._rotation01+P._invInertia02*P._transform._rotation02,Lt=P._invInertia00*P._transform._rotation10+P._invInertia01*P._transform._rotation11+P._invInertia02*P._transform._rotation12,Kt=P._invInertia00*P._transform._rotation20+P._invInertia01*P._transform._rotation21+P._invInertia02*P._transform._rotation22,Tt=P._invInertia10*P._transform._rotation00+P._invInertia11*P._transform._rotation01+P._invInertia12*P._transform._rotation02,br=P._invInertia10*P._transform._rotation10+P._invInertia11*P._transform._rotation11+P._invInertia12*P._transform._rotation12,zr=P._invInertia10*P._transform._rotation20+P._invInertia11*P._transform._rotation21+P._invInertia12*P._transform._rotation22,vi=P._invInertia20*P._transform._rotation00+P._invInertia21*P._transform._rotation01+P._invInertia22*P._transform._rotation02,qt=P._invInertia20*P._transform._rotation10+P._invInertia21*P._transform._rotation11+P._invInertia22*P._transform._rotation12,fr=P._invInertia20*P._transform._rotation20+P._invInertia21*P._transform._rotation21+P._invInertia22*P._transform._rotation22,P._invInertia00=$r,P._invInertia01=Lt,P._invInertia02=Kt,P._invInertia10=Tt,P._invInertia11=br,P._invInertia12=zr,P._invInertia20=vi,P._invInertia21=qt,P._invInertia22=fr,P._invInertia00*=P._rotFactor.x,P._invInertia01*=P._rotFactor.x,P._invInertia02*=P._rotFactor.x,P._invInertia10*=P._rotFactor.y,P._invInertia11*=P._rotFactor.y,P._invInertia12*=P._rotFactor.y,P._invInertia20*=P._rotFactor.z,P._invInertia21*=P._rotFactor.z,P._invInertia22*=P._rotFactor.z}postSolve(){var a,t,r,i,o,s,_,h,v;a=0,t=0,r=0,i=0,o=0,s=0,_=0,h=0,v=0;for(var e=0,l=this.info.numRows;e<l;){var u=e++,b=this.info.rows[u],f=b.impulse,n=b.jacobianN,c=b.jacobianT,M=b.jacobianB,m=f.impulseN,y=f.impulseT,V=f.impulseB,z,I,w;z=0,I=0,w=0,z+=c.lin1X*y,I+=c.lin1Y*y,w+=c.lin1Z*y,z+=M.lin1X*V,I+=M.lin1Y*V,w+=M.lin1Z*V,f.impulseLX=z,f.impulseLY=I,f.impulseLZ=w,a+=n.lin1X*m,t+=n.lin1Y*m,r+=n.lin1Z*m,i+=n.ang1X*m,o+=n.ang1Y*m,s+=n.ang1Z*m,_+=n.ang2X*m,h+=n.ang2Y*m,v+=n.ang2Z*m,a+=c.lin1X*y,t+=c.lin1Y*y,r+=c.lin1Z*y,i+=c.ang1X*y,o+=c.ang1Y*y,s+=c.ang1Z*y,_+=c.ang2X*y,h+=c.ang2Y*y,v+=c.ang2Z*y,a+=M.lin1X*V,t+=M.lin1Y*V,r+=M.lin1Z*V,i+=M.ang1X*V,o+=M.ang1Y*V,s+=M.ang1Z*V,_+=M.ang2X*V,h+=M.ang2Y*V,v+=M.ang2Z*V}this._b1._linearContactImpulseX+=a,this._b1._linearContactImpulseY+=t,this._b1._linearContactImpulseZ+=r,this._b1._angularContactImpulseX+=i,this._b1._angularContactImpulseY+=o,this._b1._angularContactImpulseZ+=s,this._b2._linearContactImpulseX-=a,this._b2._linearContactImpulseY-=t,this._b2._linearContactImpulseZ-=r,this._b2._angularContactImpulseX-=_,this._b2._angularContactImpulseY-=h,this._b2._angularContactImpulseZ-=v,this.constraint._syncManifold()}};x.dynamics.constraint.solver.pgs.PgsJointConstraintSolver=class extends x.dynamics.constraint.ConstraintSolver{constructor(a){super(),this.joint=a,this.info=new x.dynamics.constraint.info.joint.JointSolverInfo;var t=new Array(x.common.Setting.maxJacobianRows);this.massData=t;for(var r=0,i=this.massData.length;r<i;){var o=r++;this.massData[o]=new x.dynamics.constraint.solver.common.JointSolverMassDataRow}}preSolveVelocity(a){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(a,this.info),this._b1=this.info.b1,this._b2=this.info.b2;var t=this._b1._invMass,r=this._b2._invMass,i,o,s,_,h,v,e,l,u,b,f,n,c,M,m,y,V,z;i=this._b1._invInertia00,o=this._b1._invInertia01,s=this._b1._invInertia02,_=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,e=this._b1._invInertia20,l=this._b1._invInertia21,u=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,M=this._b2._invInertia11,m=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,z=this._b2._invInertia22;for(var I=0,w=this.info.numRows;I<w;){var X=I++,L=this.info.rows[X],p=this.massData[X],g=L.jacobian;if(g.updateSparsity(),g.flag&1?(p.invMLin1X=g.lin1X*t,p.invMLin1Y=g.lin1Y*t,p.invMLin1Z=g.lin1Z*t,p.invMLin2X=g.lin2X*r,p.invMLin2Y=g.lin2Y*r,p.invMLin2Z=g.lin2Z*r):(p.invMLin1X=0,p.invMLin1Y=0,p.invMLin1Z=0,p.invMLin2X=0,p.invMLin2Y=0,p.invMLin2Z=0),g.flag&2){var F,S,N;F=i*g.ang1X+o*g.ang1Y+s*g.ang1Z,S=_*g.ang1X+h*g.ang1Y+v*g.ang1Z,N=e*g.ang1X+l*g.ang1Y+u*g.ang1Z,p.invMAng1X=F,p.invMAng1Y=S,p.invMAng1Z=N;var A,Y,R;A=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+M*g.ang2Y+m*g.ang2Z,R=y*g.ang2X+V*g.ang2Y+z*g.ang2Z,p.invMAng2X=A,p.invMAng2Y=Y,p.invMAng2Z=R}else p.invMAng1X=0,p.invMAng1Y=0,p.invMAng1Z=0,p.invMAng2X=0,p.invMAng2Y=0,p.invMAng2Z=0;p.massWithoutCfm=p.invMLin1X*g.lin1X+p.invMLin1Y*g.lin1Y+p.invMLin1Z*g.lin1Z+(p.invMLin2X*g.lin2X+p.invMLin2Y*g.lin2Y+p.invMLin2Z*g.lin2Z)+(p.invMAng1X*g.ang1X+p.invMAng1Y*g.ang1Y+p.invMAng1Z*g.ang1Z)+(p.invMAng2X*g.ang2X+p.invMAng2Y*g.ang2Y+p.invMAng2Z*g.ang2Z),p.mass=p.massWithoutCfm+L.cfm,p.massWithoutCfm!=0&&(p.massWithoutCfm=1/p.massWithoutCfm),p.mass!=0&&(p.mass=1/p.mass)}}warmStart(a){var t=this.joint._positionCorrectionAlgorithm==x.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?x.common.Setting.jointWarmStartingFactorForBaungarte:x.common.Setting.jointWarmStartingFactor;if(t*=a.dtRatio,t<=0){for(var r=0,i=this.info.numRows;r<i;){var o=r++,s=this.info.rows[o],_=s.impulse;_.impulse=0,_.impulseM=0,_.impulseP=0}return}var h,v,e,l,u,b,f,n,c,M,m,y;h=this._b1._velX,v=this._b1._velY,e=this._b1._velZ,l=this._b2._velX,u=this._b2._velY,b=this._b2._velZ,f=this._b1._angVelX,n=this._b1._angVelY,c=this._b1._angVelZ,M=this._b2._angVelX,m=this._b2._angVelY,y=this._b2._angVelZ;for(var V=0,z=this.info.numRows;V<z;){var I=V++,w=this.info.rows[I],X=this.massData[I],L=w.impulse;w.jacobian,L.impulse*=t,L.impulseM*=t;var p=L.impulse+L.impulseM;h+=X.invMLin1X*p,v+=X.invMLin1Y*p,e+=X.invMLin1Z*p,l+=X.invMLin2X*-p,u+=X.invMLin2Y*-p,b+=X.invMLin2Z*-p,f+=X.invMAng1X*p,n+=X.invMAng1Y*p,c+=X.invMAng1Z*p,M+=X.invMAng2X*-p,m+=X.invMAng2Y*-p,y+=X.invMAng2Z*-p}this._b1._velX=h,this._b1._velY=v,this._b1._velZ=e,this._b2._velX=l,this._b2._velY=u,this._b2._velZ=b,this._b1._angVelX=f,this._b1._angVelY=n,this._b1._angVelZ=c,this._b2._angVelX=M,this._b2._angVelY=m,this._b2._angVelZ=y}solveVelocity(){var a,t,r,i,o,s,_,h,v,e,l,u;a=this._b1._velX,t=this._b1._velY,r=this._b1._velZ,i=this._b2._velX,o=this._b2._velY,s=this._b2._velZ,_=this._b1._angVelX,h=this._b1._angVelY,v=this._b1._angVelZ,e=this._b2._angVelX,l=this._b2._angVelY,u=this._b2._angVelZ;for(var b=0,f=this.info.numRows;b<f;){var n=b++,c=this.info.rows[n],M=this.massData[n],m=c.impulse,y=c.jacobian;if(c.motorMaxImpulse!=0){var V=0;V+=a*y.lin1X+t*y.lin1Y+r*y.lin1Z,V-=i*y.lin2X+o*y.lin2Y+s*y.lin2Z,V+=_*y.ang1X+h*y.ang1Y+v*y.ang1Z,V-=e*y.ang2X+l*y.ang2Y+u*y.ang2Z;var z=(-c.motorSpeed-V)*M.massWithoutCfm,I=m.impulseM;m.impulseM+=z,m.impulseM<-c.motorMaxImpulse?m.impulseM=-c.motorMaxImpulse:m.impulseM>c.motorMaxImpulse&&(m.impulseM=c.motorMaxImpulse),z=m.impulseM-I,y.flag&1&&(a+=M.invMLin1X*z,t+=M.invMLin1Y*z,r+=M.invMLin1Z*z,i+=M.invMLin2X*-z,o+=M.invMLin2Y*-z,s+=M.invMLin2Z*-z),y.flag&2&&(_+=M.invMAng1X*z,h+=M.invMAng1Y*z,v+=M.invMAng1Z*z,e+=M.invMAng2X*-z,l+=M.invMAng2Y*-z,u+=M.invMAng2Z*-z)}}for(var w=0,X=this.info.numRows;w<X;){var L=w++,p=this.info.rows[L],g=this.massData[L],F=p.impulse,S=p.jacobian,N=0;N+=a*S.lin1X+t*S.lin1Y+r*S.lin1Z,N-=i*S.lin2X+o*S.lin2Y+s*S.lin2Z,N+=_*S.ang1X+h*S.ang1Y+v*S.ang1Z,N-=e*S.ang2X+l*S.ang2Y+u*S.ang2Z;var A=(p.rhs-N-F.impulse*p.cfm)*g.mass,Y=F.impulse;F.impulse+=A,F.impulse<p.minImpulse?F.impulse=p.minImpulse:F.impulse>p.maxImpulse&&(F.impulse=p.maxImpulse),A=F.impulse-Y,S.flag&1&&(a+=g.invMLin1X*A,t+=g.invMLin1Y*A,r+=g.invMLin1Z*A,i+=g.invMLin2X*-A,o+=g.invMLin2Y*-A,s+=g.invMLin2Z*-A),S.flag&2&&(_+=g.invMAng1X*A,h+=g.invMAng1Y*A,v+=g.invMAng1Z*A,e+=g.invMAng2X*-A,l+=g.invMAng2Y*-A,u+=g.invMAng2Z*-A)}this._b1._velX=a,this._b1._velY=t,this._b1._velZ=r,this._b2._velX=i,this._b2._velY=o,this._b2._velZ=s,this._b1._angVelX=_,this._b1._angVelY=h,this._b1._angVelZ=v,this._b2._angVelX=e,this._b2._angVelY=l,this._b2._angVelZ=u}postSolveVelocity(a){var t,r,i,o,s,_;t=0,r=0,i=0,o=0,s=0,_=0;for(var h=0,v=this.info.numRows;h<v;){var e=h++,l=this.info.rows[e],u=l.impulse,b=l.jacobian;b.flag&1?(t+=b.lin1X*u.impulse,r+=b.lin1Y*u.impulse,i+=b.lin1Z*u.impulse):b.flag&2&&(o+=b.ang1X*u.impulse,s+=b.ang1Y*u.impulse,_+=b.ang1Z*u.impulse)}this.joint._appliedForceX=t*a.invDt,this.joint._appliedForceY=r*a.invDt,this.joint._appliedForceZ=i*a.invDt,this.joint._appliedTorqueX=o*a.invDt,this.joint._appliedTorqueY=s*a.invDt,this.joint._appliedTorqueZ=_*a.invDt}preSolvePosition(a){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;var t=this._b1._invMass,r=this._b2._invMass,i,o,s,_,h,v,e,l,u,b,f,n,c,M,m,y,V,z;i=this._b1._invInertia00,o=this._b1._invInertia01,s=this._b1._invInertia02,_=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,e=this._b1._invInertia20,l=this._b1._invInertia21,u=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,M=this._b2._invInertia11,m=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,z=this._b2._invInertia22;for(var I=0,w=this.info.numRows;I<w;){var X=I++,L=this.info.rows[X],p=this.massData[X];L.impulse;var g=L.jacobian;p.invMLin1X=g.lin1X*t,p.invMLin1Y=g.lin1Y*t,p.invMLin1Z=g.lin1Z*t,p.invMLin2X=g.lin2X*r,p.invMLin2Y=g.lin2Y*r,p.invMLin2Z=g.lin2Z*r;var F,S,N;F=i*g.ang1X+o*g.ang1Y+s*g.ang1Z,S=_*g.ang1X+h*g.ang1Y+v*g.ang1Z,N=e*g.ang1X+l*g.ang1Y+u*g.ang1Z,p.invMAng1X=F,p.invMAng1Y=S,p.invMAng1Z=N;var A,Y,R;A=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+M*g.ang2Y+m*g.ang2Z,R=y*g.ang2X+V*g.ang2Y+z*g.ang2Z,p.invMAng2X=A,p.invMAng2Y=Y,p.invMAng2Z=R,p.mass=p.invMLin1X*g.lin1X+p.invMLin1Y*g.lin1Y+p.invMLin1Z*g.lin1Z+(p.invMLin2X*g.lin2X+p.invMLin2Y*g.lin2Y+p.invMLin2Z*g.lin2Z)+(p.invMAng1X*g.ang1X+p.invMAng1Y*g.ang1Y+p.invMAng1Z*g.ang1Z)+(p.invMAng2X*g.ang2X+p.invMAng2Y*g.ang2Y+p.invMAng2Z*g.ang2Z),p.mass!=0&&(p.mass=1/p.mass)}for(var C=0,d=this.info.numRows;C<d;){var Z=C++;this.info.rows[Z].impulse.impulseP=0}}solvePositionSplitImpulse(){var a,t,r,i,o,s,_,h,v,e,l,u;a=this._b1._pseudoVelX,t=this._b1._pseudoVelY,r=this._b1._pseudoVelZ,i=this._b2._pseudoVelX,o=this._b2._pseudoVelY,s=this._b2._pseudoVelZ,_=this._b1._angPseudoVelX,h=this._b1._angPseudoVelY,v=this._b1._angPseudoVelZ,e=this._b2._angPseudoVelX,l=this._b2._angPseudoVelY,u=this._b2._angPseudoVelZ;for(var b=0,f=this.info.numRows;b<f;){var n=b++,c=this.info.rows[n],M=this.massData[n],m=c.impulse,y=c.jacobian,V=0;V+=a*y.lin1X+t*y.lin1Y+r*y.lin1Z,V-=i*y.lin2X+o*y.lin2Y+s*y.lin2Z,V+=_*y.ang1X+h*y.ang1Y+v*y.ang1Z,V-=e*y.ang2X+l*y.ang2Y+u*y.ang2Z;var z=(c.rhs*x.common.Setting.positionSplitImpulseBaumgarte-V)*M.mass,I=m.impulseP;m.impulseP+=z,m.impulseP<c.minImpulse?m.impulseP=c.minImpulse:m.impulseP>c.maxImpulse&&(m.impulseP=c.maxImpulse),z=m.impulseP-I,a+=M.invMLin1X*z,t+=M.invMLin1Y*z,r+=M.invMLin1Z*z,i+=M.invMLin2X*-z,o+=M.invMLin2Y*-z,s+=M.invMLin2Z*-z,_+=M.invMAng1X*z,h+=M.invMAng1Y*z,v+=M.invMAng1Z*z,e+=M.invMAng2X*-z,l+=M.invMAng2Y*-z,u+=M.invMAng2Z*-z}this._b1._pseudoVelX=a,this._b1._pseudoVelY=t,this._b1._pseudoVelZ=r,this._b2._pseudoVelX=i,this._b2._pseudoVelY=o,this._b2._pseudoVelZ=s,this._b1._angPseudoVelX=_,this._b1._angPseudoVelY=h,this._b1._angPseudoVelZ=v,this._b2._angPseudoVelX=e,this._b2._angPseudoVelY=l,this._b2._angPseudoVelZ=u}solvePositionNgs(a){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;var t=this._b1._invMass,r=this._b2._invMass,i,o,s,_,h,v,e,l,u,b,f,n,c,M,m,y,V,z;i=this._b1._invInertia00,o=this._b1._invInertia01,s=this._b1._invInertia02,_=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,e=this._b1._invInertia20,l=this._b1._invInertia21,u=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,M=this._b2._invInertia11,m=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,z=this._b2._invInertia22;for(var I=0,w=this.info.numRows;I<w;){var X=I++,L=this.info.rows[X],p=this.massData[X];L.impulse;var g=L.jacobian;p.invMLin1X=g.lin1X*t,p.invMLin1Y=g.lin1Y*t,p.invMLin1Z=g.lin1Z*t,p.invMLin2X=g.lin2X*r,p.invMLin2Y=g.lin2Y*r,p.invMLin2Z=g.lin2Z*r;var F,S,N;F=i*g.ang1X+o*g.ang1Y+s*g.ang1Z,S=_*g.ang1X+h*g.ang1Y+v*g.ang1Z,N=e*g.ang1X+l*g.ang1Y+u*g.ang1Z,p.invMAng1X=F,p.invMAng1Y=S,p.invMAng1Z=N;var A,Y,R;A=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+M*g.ang2Y+m*g.ang2Z,R=y*g.ang2X+V*g.ang2Y+z*g.ang2Z,p.invMAng2X=A,p.invMAng2Y=Y,p.invMAng2Z=R,p.mass=p.invMLin1X*g.lin1X+p.invMLin1Y*g.lin1Y+p.invMLin1Z*g.lin1Z+(p.invMLin2X*g.lin2X+p.invMLin2Y*g.lin2Y+p.invMLin2Z*g.lin2Z)+(p.invMAng1X*g.ang1X+p.invMAng1Y*g.ang1Y+p.invMAng1Z*g.ang1Z)+(p.invMAng2X*g.ang2X+p.invMAng2Y*g.ang2Y+p.invMAng2Z*g.ang2Z),p.mass!=0&&(p.mass=1/p.mass)}var C,d,Z,j,H,E,G,B,Q,W,J,D;C=0,d=0,Z=0,j=0,H=0,E=0,G=0,B=0,Q=0,W=0,J=0,D=0;for(var O=0,K=this.info.numRows;O<K;){var ra=O++,sa=this.info.rows[ra],$=this.massData[ra],q=sa.impulse,na=sa.jacobian,oa=0;oa+=C*na.lin1X+d*na.lin1Y+Z*na.lin1Z,oa-=j*na.lin2X+H*na.lin2Y+E*na.lin2Z,oa+=G*na.ang1X+B*na.ang1Y+Q*na.ang1Z,oa-=W*na.ang2X+J*na.ang2Y+D*na.ang2Z;var aa=(sa.rhs*x.common.Setting.positionNgsBaumgarte-oa)*$.mass,T=q.impulseP;q.impulseP+=aa,q.impulseP<sa.minImpulse?q.impulseP=sa.minImpulse:q.impulseP>sa.maxImpulse&&(q.impulseP=sa.maxImpulse),aa=q.impulseP-T,C+=$.invMLin1X*aa,d+=$.invMLin1Y*aa,Z+=$.invMLin1Z*aa,j+=$.invMLin2X*-aa,H+=$.invMLin2Y*-aa,E+=$.invMLin2Z*-aa,G+=$.invMAng1X*aa,B+=$.invMAng1Y*aa,Q+=$.invMAng1Z*aa,W+=$.invMAng2X*-aa,J+=$.invMAng2Y*-aa,D+=$.invMAng2Z*-aa}var ca=this._b1;ca._transform._positionX+=C,ca._transform._positionY+=d,ca._transform._positionZ+=Z;var _a=this._b2;_a._transform._positionX+=j,_a._transform._positionY+=H,_a._transform._positionZ+=E;var k=this._b1,ta=Math.sqrt(G*G+B*B+Q*Q),ia=ta*.5,la,va;if(ia<.5){var xa=ia*ia;la=.5*(1-xa*.16666666666666666+xa*xa*.008333333333333333),va=1-xa*.5+xa*xa*.041666666666666664}else la=Math.sin(ia)/ta,va=Math.cos(ia);var Ma,za,Xa;Ma=G*la,za=B*la,Xa=Q*la;var Za,fa,ba,ea;Za=Ma,fa=za,ba=Xa,ea=va;var ha,pa,ya,da,ma=k._transform._rotation00,Ya=k._transform._rotation11,Qa=k._transform._rotation22,ga=ma+Ya+Qa,ua;ga>0?(ua=Math.sqrt(ga+1),da=.5*ua,ua=.5/ua,ha=(k._transform._rotation21-k._transform._rotation12)*ua,pa=(k._transform._rotation02-k._transform._rotation20)*ua,ya=(k._transform._rotation10-k._transform._rotation01)*ua):ma>Ya?ma>Qa?(ua=Math.sqrt(ma-Ya-Qa+1),ha=.5*ua,ua=.5/ua,pa=(k._transform._rotation01+k._transform._rotation10)*ua,ya=(k._transform._rotation02+k._transform._rotation20)*ua,da=(k._transform._rotation21-k._transform._rotation12)*ua):(ua=Math.sqrt(Qa-ma-Ya+1),ya=.5*ua,ua=.5/ua,ha=(k._transform._rotation02+k._transform._rotation20)*ua,pa=(k._transform._rotation12+k._transform._rotation21)*ua,da=(k._transform._rotation10-k._transform._rotation01)*ua):Ya>Qa?(ua=Math.sqrt(Ya-Qa-ma+1),pa=.5*ua,ua=.5/ua,ha=(k._transform._rotation01+k._transform._rotation10)*ua,ya=(k._transform._rotation12+k._transform._rotation21)*ua,da=(k._transform._rotation02-k._transform._rotation20)*ua):(ua=Math.sqrt(Qa-ma-Ya+1),ya=.5*ua,ua=.5/ua,ha=(k._transform._rotation02+k._transform._rotation20)*ua,pa=(k._transform._rotation12+k._transform._rotation21)*ua,da=(k._transform._rotation10-k._transform._rotation01)*ua),ha=ea*ha+Za*da+fa*ya-ba*pa,pa=ea*pa-Za*ya+fa*da+ba*ha,ya=ea*ya+Za*pa-fa*ha+ba*da,da=ea*da-Za*ha-fa*pa-ba*ya;var ka=ha*ha+pa*pa+ya*ya+da*da;ka>1e-32&&(ka=1/Math.sqrt(ka)),ha*=ka,pa*=ka,ya*=ka,da*=ka;var wa=ha,Pa=pa,Mt=ya,Oa=da,Ba=2*wa,nt=2*Pa,Ea=2*Mt,Na=wa*Ba,Sa=Pa*nt,ft=Mt*Ea,Wa=wa*nt,Ha=Pa*Ea,bt=wa*Ea,rt=Oa*Ba,ja=Oa*nt,_t=Oa*Ea;k._transform._rotation00=1-Sa-ft,k._transform._rotation01=Wa-_t,k._transform._rotation02=bt+ja,k._transform._rotation10=Wa+_t,k._transform._rotation11=1-Na-ft,k._transform._rotation12=Ha-rt,k._transform._rotation20=bt-ja,k._transform._rotation21=Ha+rt,k._transform._rotation22=1-Na-Sa;var gt,mt,Ja,it,ut,Da,Ta,Fa,Vt;gt=k._transform._rotation00*k._invLocalInertia00+k._transform._rotation01*k._invLocalInertia10+k._transform._rotation02*k._invLocalInertia20,mt=k._transform._rotation00*k._invLocalInertia01+k._transform._rotation01*k._invLocalInertia11+k._transform._rotation02*k._invLocalInertia21,Ja=k._transform._rotation00*k._invLocalInertia02+k._transform._rotation01*k._invLocalInertia12+k._transform._rotation02*k._invLocalInertia22,it=k._transform._rotation10*k._invLocalInertia00+k._transform._rotation11*k._invLocalInertia10+k._transform._rotation12*k._invLocalInertia20,ut=k._transform._rotation10*k._invLocalInertia01+k._transform._rotation11*k._invLocalInertia11+k._transform._rotation12*k._invLocalInertia21,Da=k._transform._rotation10*k._invLocalInertia02+k._transform._rotation11*k._invLocalInertia12+k._transform._rotation12*k._invLocalInertia22,Ta=k._transform._rotation20*k._invLocalInertia00+k._transform._rotation21*k._invLocalInertia10+k._transform._rotation22*k._invLocalInertia20,Fa=k._transform._rotation20*k._invLocalInertia01+k._transform._rotation21*k._invLocalInertia11+k._transform._rotation22*k._invLocalInertia21,Vt=k._transform._rotation20*k._invLocalInertia02+k._transform._rotation21*k._invLocalInertia12+k._transform._rotation22*k._invLocalInertia22,k._invInertia00=gt,k._invInertia01=mt,k._invInertia02=Ja,k._invInertia10=it,k._invInertia11=ut,k._invInertia12=Da,k._invInertia20=Ta,k._invInertia21=Fa,k._invInertia22=Vt;var Pt,et,Xt,Yt,zt,Ia,U,Va,lt;Pt=k._invInertia00*k._transform._rotation00+k._invInertia01*k._transform._rotation01+k._invInertia02*k._transform._rotation02,et=k._invInertia00*k._transform._rotation10+k._invInertia01*k._transform._rotation11+k._invInertia02*k._transform._rotation12,Xt=k._invInertia00*k._transform._rotation20+k._invInertia01*k._transform._rotation21+k._invInertia02*k._transform._rotation22,Yt=k._invInertia10*k._transform._rotation00+k._invInertia11*k._transform._rotation01+k._invInertia12*k._transform._rotation02,zt=k._invInertia10*k._transform._rotation10+k._invInertia11*k._transform._rotation11+k._invInertia12*k._transform._rotation12,Ia=k._invInertia10*k._transform._rotation20+k._invInertia11*k._transform._rotation21+k._invInertia12*k._transform._rotation22,U=k._invInertia20*k._transform._rotation00+k._invInertia21*k._transform._rotation01+k._invInertia22*k._transform._rotation02,Va=k._invInertia20*k._transform._rotation10+k._invInertia21*k._transform._rotation11+k._invInertia22*k._transform._rotation12,lt=k._invInertia20*k._transform._rotation20+k._invInertia21*k._transform._rotation21+k._invInertia22*k._transform._rotation22,k._invInertia00=Pt,k._invInertia01=et,k._invInertia02=Xt,k._invInertia10=Yt,k._invInertia11=zt,k._invInertia12=Ia,k._invInertia20=U,k._invInertia21=Va,k._invInertia22=lt,k._invInertia00*=k._rotFactor.x,k._invInertia01*=k._rotFactor.x,k._invInertia02*=k._rotFactor.x,k._invInertia10*=k._rotFactor.y,k._invInertia11*=k._rotFactor.y,k._invInertia12*=k._rotFactor.y,k._invInertia20*=k._rotFactor.z,k._invInertia21*=k._rotFactor.z,k._invInertia22*=k._rotFactor.z;var P=this._b2,kt=Math.sqrt(W*W+J*J+D*D),Bt=kt*.5,St,yt;if(Bt<.5){var wt=Bt*Bt;St=.5*(1-wt*.16666666666666666+wt*wt*.008333333333333333),yt=1-wt*.5+wt*wt*.041666666666666664}else St=Math.sin(Bt)/kt,yt=Math.cos(Bt);var pt,ht,xt;pt=W*St,ht=J*St,xt=D*St;var Ra,st,Ca,vt;Ra=pt,st=ht,Ca=xt,vt=yt;var qa,at,Ua,tt,ct=P._transform._rotation00,Aa=P._transform._rotation11,Ga=P._transform._rotation22,Ka=ct+Aa+Ga,La;Ka>0?(La=Math.sqrt(Ka+1),tt=.5*La,La=.5/La,qa=(P._transform._rotation21-P._transform._rotation12)*La,at=(P._transform._rotation02-P._transform._rotation20)*La,Ua=(P._transform._rotation10-P._transform._rotation01)*La):ct>Aa?ct>Ga?(La=Math.sqrt(ct-Aa-Ga+1),qa=.5*La,La=.5/La,at=(P._transform._rotation01+P._transform._rotation10)*La,Ua=(P._transform._rotation02+P._transform._rotation20)*La,tt=(P._transform._rotation21-P._transform._rotation12)*La):(La=Math.sqrt(Ga-ct-Aa+1),Ua=.5*La,La=.5/La,qa=(P._transform._rotation02+P._transform._rotation20)*La,at=(P._transform._rotation12+P._transform._rotation21)*La,tt=(P._transform._rotation10-P._transform._rotation01)*La):Aa>Ga?(La=Math.sqrt(Aa-Ga-ct+1),at=.5*La,La=.5/La,qa=(P._transform._rotation01+P._transform._rotation10)*La,Ua=(P._transform._rotation12+P._transform._rotation21)*La,tt=(P._transform._rotation02-P._transform._rotation20)*La):(La=Math.sqrt(Ga-ct-Aa+1),Ua=.5*La,La=.5/La,qa=(P._transform._rotation02+P._transform._rotation20)*La,at=(P._transform._rotation12+P._transform._rotation21)*La,tt=(P._transform._rotation10-P._transform._rotation01)*La),qa=vt*qa+Ra*tt+st*Ua-Ca*at,at=vt*at-Ra*Ua+st*tt+Ca*qa,Ua=vt*Ua+Ra*at-st*qa+Ca*tt,tt=vt*tt-Ra*qa-st*at-Ca*Ua;var ot=qa*qa+at*at+Ua*Ua+tt*tt;ot>1e-32&&(ot=1/Math.sqrt(ot)),qa*=ot,at*=ot,Ua*=ot,tt*=ot;var It=qa,or=at,gr=Ua,ar=tt,Ct=2*It,_r=2*or,Et=2*gr,At=It*Ct,Gt=or*_r,Hr=gr*Et,vr=It*_r,lr=or*Et,tr=It*Et,Ur=ar*Ct,Xr=ar*_r,Mr=ar*Et;P._transform._rotation00=1-Gt-Hr,P._transform._rotation01=vr-Mr,P._transform._rotation02=tr+Xr,P._transform._rotation10=vr+Mr,P._transform._rotation11=1-At-Hr,P._transform._rotation12=lr-Ur,P._transform._rotation20=tr-Xr,P._transform._rotation21=lr+Ur,P._transform._rotation22=1-At-Gt;var Zt,ir,$t,nr,jr,Wt,Kr,Ir,mi;Zt=P._transform._rotation00*P._invLocalInertia00+P._transform._rotation01*P._invLocalInertia10+P._transform._rotation02*P._invLocalInertia20,ir=P._transform._rotation00*P._invLocalInertia01+P._transform._rotation01*P._invLocalInertia11+P._transform._rotation02*P._invLocalInertia21,$t=P._transform._rotation00*P._invLocalInertia02+P._transform._rotation01*P._invLocalInertia12+P._transform._rotation02*P._invLocalInertia22,nr=P._transform._rotation10*P._invLocalInertia00+P._transform._rotation11*P._invLocalInertia10+P._transform._rotation12*P._invLocalInertia20,jr=P._transform._rotation10*P._invLocalInertia01+P._transform._rotation11*P._invLocalInertia11+P._transform._rotation12*P._invLocalInertia21,Wt=P._transform._rotation10*P._invLocalInertia02+P._transform._rotation11*P._invLocalInertia12+P._transform._rotation12*P._invLocalInertia22,Kr=P._transform._rotation20*P._invLocalInertia00+P._transform._rotation21*P._invLocalInertia10+P._transform._rotation22*P._invLocalInertia20,Ir=P._transform._rotation20*P._invLocalInertia01+P._transform._rotation21*P._invLocalInertia11+P._transform._rotation22*P._invLocalInertia21,mi=P._transform._rotation20*P._invLocalInertia02+P._transform._rotation21*P._invLocalInertia12+P._transform._rotation22*P._invLocalInertia22,P._invInertia00=Zt,P._invInertia01=ir,P._invInertia02=$t,P._invInertia10=nr,P._invInertia11=jr,P._invInertia12=Wt,P._invInertia20=Kr,P._invInertia21=Ir,P._invInertia22=mi;var $r,Lt,Kt,Tt,br,zr,vi,qt,fr;$r=P._invInertia00*P._transform._rotation00+P._invInertia01*P._transform._rotation01+P._invInertia02*P._transform._rotation02,Lt=P._invInertia00*P._transform._rotation10+P._invInertia01*P._transform._rotation11+P._invInertia02*P._transform._rotation12,Kt=P._invInertia00*P._transform._rotation20+P._invInertia01*P._transform._rotation21+P._invInertia02*P._transform._rotation22,Tt=P._invInertia10*P._transform._rotation00+P._invInertia11*P._transform._rotation01+P._invInertia12*P._transform._rotation02,br=P._invInertia10*P._transform._rotation10+P._invInertia11*P._transform._rotation11+P._invInertia12*P._transform._rotation12,zr=P._invInertia10*P._transform._rotation20+P._invInertia11*P._transform._rotation21+P._invInertia12*P._transform._rotation22,vi=P._invInertia20*P._transform._rotation00+P._invInertia21*P._transform._rotation01+P._invInertia22*P._transform._rotation02,qt=P._invInertia20*P._transform._rotation10+P._invInertia21*P._transform._rotation11+P._invInertia22*P._transform._rotation12,fr=P._invInertia20*P._transform._rotation20+P._invInertia21*P._transform._rotation21+P._invInertia22*P._transform._rotation22,P._invInertia00=$r,P._invInertia01=Lt,P._invInertia02=Kt,P._invInertia10=Tt,P._invInertia11=br,P._invInertia12=zr,P._invInertia20=vi,P._invInertia21=qt,P._invInertia22=fr,P._invInertia00*=P._rotFactor.x,P._invInertia01*=P._rotFactor.x,P._invInertia02*=P._rotFactor.x,P._invInertia10*=P._rotFactor.y,P._invInertia11*=P._rotFactor.y,P._invInertia12*=P._rotFactor.y,P._invInertia20*=P._rotFactor.z,P._invInertia21*=P._rotFactor.z,P._invInertia22*=P._rotFactor.z}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}};x.dynamics.rigidbody||(x.dynamics.rigidbody={});x.dynamics.rigidbody.MassData=class{constructor(){this.mass=0,this.localInertia=new x.common.Mat3}};x.dynamics.rigidbody.RigidBody=class{constructor(a){this._next=null,this._prev=null,this._shapeList=null,this._shapeListLast=null,this._numShapes=0,this._contactLinkList=null,this._contactLinkListLast=null,this._numContactLinks=0,this._jointLinkList=null,this._jointLinkListLast=null,this._numJointLinks=0;var t=a.linearVelocity;this._velX=t.x,this._velY=t.y,this._velZ=t.z;var r=a.angularVelocity;this._angVelX=r.x,this._angVelY=r.y,this._angVelZ=r.z,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._ptransform=new x.common.Transform,this._transform=new x.common.Transform;var i=a.position;this._ptransform._positionX=i.x,this._ptransform._positionY=i.y,this._ptransform._positionZ=i.z;var o=a.rotation;this._ptransform._rotation00=o.e00,this._ptransform._rotation01=o.e01,this._ptransform._rotation02=o.e02,this._ptransform._rotation10=o.e10,this._ptransform._rotation11=o.e11,this._ptransform._rotation12=o.e12,this._ptransform._rotation20=o.e20,this._ptransform._rotation21=o.e21,this._ptransform._rotation22=o.e22;var s=this._transform,_=this._ptransform;s._positionX=_._positionX,s._positionY=_._positionY,s._positionZ=_._positionZ,s._rotation00=_._rotation00,s._rotation01=_._rotation01,s._rotation02=_._rotation02,s._rotation10=_._rotation10,s._rotation11=_._rotation11,s._rotation12=_._rotation12,s._rotation20=_._rotation20,s._rotation21=_._rotation21,s._rotation22=_._rotation22,this._type=a.type,this._sleepTime=0,this._sleeping=!1,this._autoSleep=a.autoSleep,this._mass=0,this._invMass=0,this._localInertia00=0,this._localInertia01=0,this._localInertia02=0,this._localInertia10=0,this._localInertia11=0,this._localInertia12=0,this._localInertia20=0,this._localInertia21=0,this._localInertia22=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._invInertia00=0,this._invInertia01=0,this._invInertia02=0,this._invInertia10=0,this._invInertia11=0,this._invInertia12=0,this._invInertia20=0,this._invInertia21=0,this._invInertia22=0,this._linearDamping=a.linearDamping,this._angularDamping=a.angularDamping,this._forceX=0,this._forceY=0,this._forceZ=0,this._torqueX=0,this._torqueY=0,this._torqueZ=0,this._linearContactImpulseX=0,this._linearContactImpulseY=0,this._linearContactImpulseZ=0,this._angularContactImpulseX=0,this._angularContactImpulseY=0,this._angularContactImpulseZ=0,this._rotFactor=new x.common.Vec3(1,1,1),this._addedToIsland=!1,this._gravityScale=1,this._world=null}_integrate(a){switch(this._type){case 1:this._velX=0,this._velY=0,this._velZ=0,this._angVelX=0,this._angVelY=0,this._angVelZ=0,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:var t,r,i,o,s,_;t=this._velX*a,r=this._velY*a,i=this._velZ*a,o=this._angVelX*a,s=this._angVelY*a,_=this._angVelZ*a;var h=t*t+r*r+i*i,v=o*o+s*s+_*_;if(h==0&&v==0)return;if(h>x.common.Setting.maxTranslationPerStep*x.common.Setting.maxTranslationPerStep){var e=x.common.Setting.maxTranslationPerStep/Math.sqrt(h);this._velX*=e,this._velY*=e,this._velZ*=e,t*=e,r*=e,i*=e}if(v>x.common.Setting.maxRotationPerStep*x.common.Setting.maxRotationPerStep){var l=x.common.Setting.maxRotationPerStep/Math.sqrt(v);this._angVelX*=l,this._angVelY*=l,this._angVelZ*=l,o*=l,s*=l,_*=l}this._transform._positionX+=t,this._transform._positionY+=r,this._transform._positionZ+=i;var u=Math.sqrt(o*o+s*s+_*_),b=u*.5,f,n;if(b<.5){var c=b*b;f=.5*(1-c*.16666666666666666+c*c*.008333333333333333),n=1-c*.5+c*c*.041666666666666664}else f=Math.sin(b)/u,n=Math.cos(b);var M,m,y;M=o*f,m=s*f,y=_*f;var V,z,I,w;V=M,z=m,I=y,w=n;var X,L,p,g,F=this._transform._rotation00,S=this._transform._rotation11,N=this._transform._rotation22,A=F+S+N,Y;A>0?(Y=Math.sqrt(A+1),g=.5*Y,Y=.5/Y,X=(this._transform._rotation21-this._transform._rotation12)*Y,L=(this._transform._rotation02-this._transform._rotation20)*Y,p=(this._transform._rotation10-this._transform._rotation01)*Y):F>S?F>N?(Y=Math.sqrt(F-S-N+1),X=.5*Y,Y=.5/Y,L=(this._transform._rotation01+this._transform._rotation10)*Y,p=(this._transform._rotation02+this._transform._rotation20)*Y,g=(this._transform._rotation21-this._transform._rotation12)*Y):(Y=Math.sqrt(N-F-S+1),p=.5*Y,Y=.5/Y,X=(this._transform._rotation02+this._transform._rotation20)*Y,L=(this._transform._rotation12+this._transform._rotation21)*Y,g=(this._transform._rotation10-this._transform._rotation01)*Y):S>N?(Y=Math.sqrt(S-N-F+1),L=.5*Y,Y=.5/Y,X=(this._transform._rotation01+this._transform._rotation10)*Y,p=(this._transform._rotation12+this._transform._rotation21)*Y,g=(this._transform._rotation02-this._transform._rotation20)*Y):(Y=Math.sqrt(N-F-S+1),p=.5*Y,Y=.5/Y,X=(this._transform._rotation02+this._transform._rotation20)*Y,L=(this._transform._rotation12+this._transform._rotation21)*Y,g=(this._transform._rotation10-this._transform._rotation01)*Y),X=w*X+V*g+z*p-I*L,L=w*L-V*p+z*g+I*X,p=w*p+V*L-z*X+I*g,g=w*g-V*X-z*L-I*p;var R=X*X+L*L+p*p+g*g;R>1e-32&&(R=1/Math.sqrt(R)),X*=R,L*=R,p*=R,g*=R;var C=X,d=L,Z=p,j=g,H=2*C,E=2*d,G=2*Z,B=C*H,Q=d*E,W=Z*G,J=C*E,D=d*G,O=C*G,K=j*H,ra=j*E,sa=j*G;this._transform._rotation00=1-Q-W,this._transform._rotation01=J-sa,this._transform._rotation02=O+ra,this._transform._rotation10=J+sa,this._transform._rotation11=1-B-W,this._transform._rotation12=D-K,this._transform._rotation20=O-ra,this._transform._rotation21=D+K,this._transform._rotation22=1-B-Q;var $,q,na,oa,aa,T,ca,_a,k;$=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,q=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,na=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,oa=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,aa=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,T=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,ca=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_a=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,k=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=$,this._invInertia01=q,this._invInertia02=na,this._invInertia10=oa,this._invInertia11=aa,this._invInertia12=T,this._invInertia20=ca,this._invInertia21=_a,this._invInertia22=k;var ta,ia,la,va,xa,Ma,za,Xa,Za;ta=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,ia=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,la=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,va=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,xa=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,Ma=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,za=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,Xa=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Za=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=ta,this._invInertia01=ia,this._invInertia02=la,this._invInertia10=va,this._invInertia11=xa,this._invInertia12=Ma,this._invInertia20=za,this._invInertia21=Xa,this._invInertia22=Za,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;break}}_integratePseudoVelocity(){var a=this._pseudoVelX*this._pseudoVelX+this._pseudoVelY*this._pseudoVelY+this._pseudoVelZ*this._pseudoVelZ,t=this._angPseudoVelX*this._angPseudoVelX+this._angPseudoVelY*this._angPseudoVelY+this._angPseudoVelZ*this._angPseudoVelZ;if(!(a==0&&t==0))switch(this._type){case 1:this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:var r,i,o,s,_,h;r=this._pseudoVelX,i=this._pseudoVelY,o=this._pseudoVelZ,s=this._angPseudoVelX,_=this._angPseudoVelY,h=this._angPseudoVelZ,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._transform._positionX+=r,this._transform._positionY+=i,this._transform._positionZ+=o;var v=Math.sqrt(s*s+_*_+h*h),e=v*.5,l,u;if(e<.5){var b=e*e;l=.5*(1-b*.16666666666666666+b*b*.008333333333333333),u=1-b*.5+b*b*.041666666666666664}else l=Math.sin(e)/v,u=Math.cos(e);var f,n,c;f=s*l,n=_*l,c=h*l;var M,m,y,V;M=f,m=n,y=c,V=u;var z,I,w,X,L=this._transform._rotation00,p=this._transform._rotation11,g=this._transform._rotation22,F=L+p+g,S;F>0?(S=Math.sqrt(F+1),X=.5*S,S=.5/S,z=(this._transform._rotation21-this._transform._rotation12)*S,I=(this._transform._rotation02-this._transform._rotation20)*S,w=(this._transform._rotation10-this._transform._rotation01)*S):L>p?L>g?(S=Math.sqrt(L-p-g+1),z=.5*S,S=.5/S,I=(this._transform._rotation01+this._transform._rotation10)*S,w=(this._transform._rotation02+this._transform._rotation20)*S,X=(this._transform._rotation21-this._transform._rotation12)*S):(S=Math.sqrt(g-L-p+1),w=.5*S,S=.5/S,z=(this._transform._rotation02+this._transform._rotation20)*S,I=(this._transform._rotation12+this._transform._rotation21)*S,X=(this._transform._rotation10-this._transform._rotation01)*S):p>g?(S=Math.sqrt(p-g-L+1),I=.5*S,S=.5/S,z=(this._transform._rotation01+this._transform._rotation10)*S,w=(this._transform._rotation12+this._transform._rotation21)*S,X=(this._transform._rotation02-this._transform._rotation20)*S):(S=Math.sqrt(g-L-p+1),w=.5*S,S=.5/S,z=(this._transform._rotation02+this._transform._rotation20)*S,I=(this._transform._rotation12+this._transform._rotation21)*S,X=(this._transform._rotation10-this._transform._rotation01)*S),z=V*z+M*X+m*w-y*I,I=V*I-M*w+m*X+y*z,w=V*w+M*I-m*z+y*X,X=V*X-M*z-m*I-y*w;var N=z*z+I*I+w*w+X*X;N>1e-32&&(N=1/Math.sqrt(N)),z*=N,I*=N,w*=N,X*=N;var A=z,Y=I,R=w,C=X,d=2*A,Z=2*Y,j=2*R,H=A*d,E=Y*Z,G=R*j,B=A*Z,Q=Y*j,W=A*j,J=C*d,D=C*Z,O=C*j;this._transform._rotation00=1-E-G,this._transform._rotation01=B-O,this._transform._rotation02=W+D,this._transform._rotation10=B+O,this._transform._rotation11=1-H-G,this._transform._rotation12=Q-J,this._transform._rotation20=W-D,this._transform._rotation21=Q+J,this._transform._rotation22=1-H-E;var K,ra,sa,$,q,na,oa,aa,T;K=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,ra=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,sa=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,$=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,q=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,na=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,oa=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,aa=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,T=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=K,this._invInertia01=ra,this._invInertia02=sa,this._invInertia10=$,this._invInertia11=q,this._invInertia12=na,this._invInertia20=oa,this._invInertia21=aa,this._invInertia22=T;var ca,_a,k,ta,ia,la,va,xa,Ma;ca=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,_a=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,k=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,ta=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,ia=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,la=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,va=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,xa=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Ma=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=ca,this._invInertia01=_a,this._invInertia02=k,this._invInertia10=ta,this._invInertia11=ia,this._invInertia12=la,this._invInertia20=va,this._invInertia21=xa,this._invInertia22=Ma,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;break}}updateMass(){var a,t,r,i,o,s,_,h,v;a=0,t=0,r=0,i=0,o=0,s=0,_=0,h=0,v=0;for(var e=0,l=this._shapeList;l!=null;){var u=l._next,b=l._geom;b._updateMass();var f=l._density*b._volume,n,c,M,m,y,V,z,I,w,X,L,p,g,F,S,N,A,Y;X=l._localTransform._rotation00*b._inertiaCoeff00+l._localTransform._rotation01*b._inertiaCoeff10+l._localTransform._rotation02*b._inertiaCoeff20,L=l._localTransform._rotation00*b._inertiaCoeff01+l._localTransform._rotation01*b._inertiaCoeff11+l._localTransform._rotation02*b._inertiaCoeff21,p=l._localTransform._rotation00*b._inertiaCoeff02+l._localTransform._rotation01*b._inertiaCoeff12+l._localTransform._rotation02*b._inertiaCoeff22,g=l._localTransform._rotation10*b._inertiaCoeff00+l._localTransform._rotation11*b._inertiaCoeff10+l._localTransform._rotation12*b._inertiaCoeff20,F=l._localTransform._rotation10*b._inertiaCoeff01+l._localTransform._rotation11*b._inertiaCoeff11+l._localTransform._rotation12*b._inertiaCoeff21,S=l._localTransform._rotation10*b._inertiaCoeff02+l._localTransform._rotation11*b._inertiaCoeff12+l._localTransform._rotation12*b._inertiaCoeff22,N=l._localTransform._rotation20*b._inertiaCoeff00+l._localTransform._rotation21*b._inertiaCoeff10+l._localTransform._rotation22*b._inertiaCoeff20,A=l._localTransform._rotation20*b._inertiaCoeff01+l._localTransform._rotation21*b._inertiaCoeff11+l._localTransform._rotation22*b._inertiaCoeff21,Y=l._localTransform._rotation20*b._inertiaCoeff02+l._localTransform._rotation21*b._inertiaCoeff12+l._localTransform._rotation22*b._inertiaCoeff22,n=X,c=L,M=p,m=g,y=F,V=S,z=N,I=A,w=Y;var R,C,d,Z,j,H,E,G,B;R=n*l._localTransform._rotation00+c*l._localTransform._rotation01+M*l._localTransform._rotation02,C=n*l._localTransform._rotation10+c*l._localTransform._rotation11+M*l._localTransform._rotation12,d=n*l._localTransform._rotation20+c*l._localTransform._rotation21+M*l._localTransform._rotation22,Z=m*l._localTransform._rotation00+y*l._localTransform._rotation01+V*l._localTransform._rotation02,j=m*l._localTransform._rotation10+y*l._localTransform._rotation11+V*l._localTransform._rotation12,H=m*l._localTransform._rotation20+y*l._localTransform._rotation21+V*l._localTransform._rotation22,E=z*l._localTransform._rotation00+I*l._localTransform._rotation01+w*l._localTransform._rotation02,G=z*l._localTransform._rotation10+I*l._localTransform._rotation11+w*l._localTransform._rotation12,B=z*l._localTransform._rotation20+I*l._localTransform._rotation21+w*l._localTransform._rotation22,n=R,c=C,M=d,m=Z,y=j,V=H,z=E,I=G,w=B,n*=f,c*=f,M*=f,m*=f,y*=f,V*=f,z*=f,I*=f,w*=f;var Q,W,J,D,O,K,ra,sa,$,q=l._localTransform._positionX*l._localTransform._positionX,na=l._localTransform._positionY*l._localTransform._positionY,oa=l._localTransform._positionZ*l._localTransform._positionZ,aa=-l._localTransform._positionX*l._localTransform._positionY,T=-l._localTransform._positionY*l._localTransform._positionZ,ca=-l._localTransform._positionZ*l._localTransform._positionX;Q=na+oa,W=aa,J=ca,D=aa,O=q+oa,K=T,ra=ca,sa=T,$=q+na,n+=Q*f,c+=W*f,M+=J*f,m+=D*f,y+=O*f,V+=K*f,z+=ra*f,I+=sa*f,w+=$*f,e+=f,a+=n,t+=c,r+=M,i+=m,o+=y,s+=V,_+=z,h+=I,v+=w,l=u}this._mass=e,this._localInertia00=a,this._localInertia01=t,this._localInertia02=r,this._localInertia10=i,this._localInertia11=o,this._localInertia12=s,this._localInertia20=_,this._localInertia21=h,this._localInertia22=v;var _a=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,k=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,ta=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,ia=this._localInertia00*_a-this._localInertia01*k+this._localInertia02*ta;if(this._mass>0&&ia>0&&this._type==0){this._invMass=1/this._mass;var la=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,va=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,xa=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,Ma=this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21,za=this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20,Xa=this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20,Za=this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11,fa=this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10,ba=this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10,ea=this._localInertia00*la-this._localInertia01*va+this._localInertia02*xa;(ea<-1e-32||ea>1e-32)&&(ea=1/ea),this._invLocalInertia00=la*ea,this._invLocalInertia01=-Ma*ea,this._invLocalInertia02=Za*ea,this._invLocalInertia10=-va*ea,this._invLocalInertia11=za*ea,this._invLocalInertia12=-fa*ea,this._invLocalInertia20=xa*ea,this._invLocalInertia21=-Xa*ea,this._invLocalInertia22=ba*ea,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._type==0&&(this._type=1);var ha,pa,ya,da,ma,Ya,Qa,ga,ua;ha=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,pa=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,ya=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,da=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,ma=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,Ya=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,Qa=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,ga=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,ua=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=ha,this._invInertia01=pa,this._invInertia02=ya,this._invInertia10=da,this._invInertia11=ma,this._invInertia12=Ya,this._invInertia20=Qa,this._invInertia21=ga,this._invInertia22=ua;var ka,wa,Pa,Mt,Oa,Ba,nt,Ea,Na;ka=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,wa=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,Pa=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,Mt=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,Oa=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,Ba=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,nt=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,Ea=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Na=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=ka,this._invInertia01=wa,this._invInertia02=Pa,this._invInertia10=Mt,this._invInertia11=Oa,this._invInertia12=Ba,this._invInertia20=nt,this._invInertia21=Ea,this._invInertia22=Na,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getPosition(){var a=new x.common.Vec3,t=a;return t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ,a}getPositionTo(a){var t=a;t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ}setPosition(a){var t=a;this._transform._positionX=t.x,this._transform._positionY=t.y,this._transform._positionZ=t.z;var r=this._ptransform,i=this._transform;r._positionX=i._positionX,r._positionY=i._positionY,r._positionZ=i._positionZ,r._rotation00=i._rotation00,r._rotation01=i._rotation01,r._rotation02=i._rotation02,r._rotation10=i._rotation10,r._rotation11=i._rotation11,r._rotation12=i._rotation12,r._rotation20=i._rotation20,r._rotation21=i._rotation21,r._rotation22=i._rotation22;for(var o=this._shapeList;o!=null;){var s=o._next,_=o._ptransform,h=o._localTransform,v=this._ptransform,e,l,u,b,f,n,c,M,m;e=v._rotation00*h._rotation00+v._rotation01*h._rotation10+v._rotation02*h._rotation20,l=v._rotation00*h._rotation01+v._rotation01*h._rotation11+v._rotation02*h._rotation21,u=v._rotation00*h._rotation02+v._rotation01*h._rotation12+v._rotation02*h._rotation22,b=v._rotation10*h._rotation00+v._rotation11*h._rotation10+v._rotation12*h._rotation20,f=v._rotation10*h._rotation01+v._rotation11*h._rotation11+v._rotation12*h._rotation21,n=v._rotation10*h._rotation02+v._rotation11*h._rotation12+v._rotation12*h._rotation22,c=v._rotation20*h._rotation00+v._rotation21*h._rotation10+v._rotation22*h._rotation20,M=v._rotation20*h._rotation01+v._rotation21*h._rotation11+v._rotation22*h._rotation21,m=v._rotation20*h._rotation02+v._rotation21*h._rotation12+v._rotation22*h._rotation22,_._rotation00=e,_._rotation01=l,_._rotation02=u,_._rotation10=b,_._rotation11=f,_._rotation12=n,_._rotation20=c,_._rotation21=M,_._rotation22=m;var y,V,z;y=v._rotation00*h._positionX+v._rotation01*h._positionY+v._rotation02*h._positionZ,V=v._rotation10*h._positionX+v._rotation11*h._positionY+v._rotation12*h._positionZ,z=v._rotation20*h._positionX+v._rotation21*h._positionY+v._rotation22*h._positionZ,_._positionX=y,_._positionY=V,_._positionZ=z,_._positionX+=v._positionX,_._positionY+=v._positionY,_._positionZ+=v._positionZ;var I=o._transform,w=o._localTransform,X=this._transform,L,p,g,F,S,N,A,Y,R;L=X._rotation00*w._rotation00+X._rotation01*w._rotation10+X._rotation02*w._rotation20,p=X._rotation00*w._rotation01+X._rotation01*w._rotation11+X._rotation02*w._rotation21,g=X._rotation00*w._rotation02+X._rotation01*w._rotation12+X._rotation02*w._rotation22,F=X._rotation10*w._rotation00+X._rotation11*w._rotation10+X._rotation12*w._rotation20,S=X._rotation10*w._rotation01+X._rotation11*w._rotation11+X._rotation12*w._rotation21,N=X._rotation10*w._rotation02+X._rotation11*w._rotation12+X._rotation12*w._rotation22,A=X._rotation20*w._rotation00+X._rotation21*w._rotation10+X._rotation22*w._rotation20,Y=X._rotation20*w._rotation01+X._rotation21*w._rotation11+X._rotation22*w._rotation21,R=X._rotation20*w._rotation02+X._rotation21*w._rotation12+X._rotation22*w._rotation22,I._rotation00=L,I._rotation01=p,I._rotation02=g,I._rotation10=F,I._rotation11=S,I._rotation12=N,I._rotation20=A,I._rotation21=Y,I._rotation22=R;var C,d,Z;C=X._rotation00*w._positionX+X._rotation01*w._positionY+X._rotation02*w._positionZ,d=X._rotation10*w._positionX+X._rotation11*w._positionY+X._rotation12*w._positionZ,Z=X._rotation20*w._positionX+X._rotation21*w._positionY+X._rotation22*w._positionZ,I._positionX=C,I._positionY=d,I._positionZ=Z,I._positionX+=X._positionX,I._positionY+=X._positionY,I._positionZ+=X._positionZ;var j,H,E,G,B,Q;if(o._geom._computeAabb(o._aabb,o._ptransform),j=o._aabb._minX,H=o._aabb._minY,E=o._aabb._minZ,G=o._aabb._maxX,B=o._aabb._maxY,Q=o._aabb._maxZ,o._geom._computeAabb(o._aabb,o._transform),o._aabb._minX=j<o._aabb._minX?j:o._aabb._minX,o._aabb._minY=H<o._aabb._minY?H:o._aabb._minY,o._aabb._minZ=E<o._aabb._minZ?E:o._aabb._minZ,o._aabb._maxX=G>o._aabb._maxX?G:o._aabb._maxX,o._aabb._maxY=B>o._aabb._maxY?B:o._aabb._maxY,o._aabb._maxZ=Q>o._aabb._maxZ?Q:o._aabb._maxZ,o._proxy!=null){var W,J,D;W=o._transform._positionX-o._ptransform._positionX,J=o._transform._positionY-o._ptransform._positionY,D=o._transform._positionZ-o._ptransform._positionZ;var O=o.displacement;O.x=W,O.y=J,O.z=D,o._rigidBody._world._broadPhase.moveProxy(o._proxy,o._aabb,o.displacement)}o=s}this._sleeping=!1,this._sleepTime=0}translate(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z,this._transform._positionX+=t,this._transform._positionY+=r,this._transform._positionZ+=i;var s=this._ptransform,_=this._transform;s._positionX=_._positionX,s._positionY=_._positionY,s._positionZ=_._positionZ,s._rotation00=_._rotation00,s._rotation01=_._rotation01,s._rotation02=_._rotation02,s._rotation10=_._rotation10,s._rotation11=_._rotation11,s._rotation12=_._rotation12,s._rotation20=_._rotation20,s._rotation21=_._rotation21,s._rotation22=_._rotation22;for(var h=this._shapeList;h!=null;){var v=h._next,e=h._ptransform,l=h._localTransform,u=this._ptransform,b,f,n,c,M,m,y,V,z;b=u._rotation00*l._rotation00+u._rotation01*l._rotation10+u._rotation02*l._rotation20,f=u._rotation00*l._rotation01+u._rotation01*l._rotation11+u._rotation02*l._rotation21,n=u._rotation00*l._rotation02+u._rotation01*l._rotation12+u._rotation02*l._rotation22,c=u._rotation10*l._rotation00+u._rotation11*l._rotation10+u._rotation12*l._rotation20,M=u._rotation10*l._rotation01+u._rotation11*l._rotation11+u._rotation12*l._rotation21,m=u._rotation10*l._rotation02+u._rotation11*l._rotation12+u._rotation12*l._rotation22,y=u._rotation20*l._rotation00+u._rotation21*l._rotation10+u._rotation22*l._rotation20,V=u._rotation20*l._rotation01+u._rotation21*l._rotation11+u._rotation22*l._rotation21,z=u._rotation20*l._rotation02+u._rotation21*l._rotation12+u._rotation22*l._rotation22,e._rotation00=b,e._rotation01=f,e._rotation02=n,e._rotation10=c,e._rotation11=M,e._rotation12=m,e._rotation20=y,e._rotation21=V,e._rotation22=z;var I,w,X;I=u._rotation00*l._positionX+u._rotation01*l._positionY+u._rotation02*l._positionZ,w=u._rotation10*l._positionX+u._rotation11*l._positionY+u._rotation12*l._positionZ,X=u._rotation20*l._positionX+u._rotation21*l._positionY+u._rotation22*l._positionZ,e._positionX=I,e._positionY=w,e._positionZ=X,e._positionX+=u._positionX,e._positionY+=u._positionY,e._positionZ+=u._positionZ;var L=h._transform,p=h._localTransform,g=this._transform,F,S,N,A,Y,R,C,d,Z;F=g._rotation00*p._rotation00+g._rotation01*p._rotation10+g._rotation02*p._rotation20,S=g._rotation00*p._rotation01+g._rotation01*p._rotation11+g._rotation02*p._rotation21,N=g._rotation00*p._rotation02+g._rotation01*p._rotation12+g._rotation02*p._rotation22,A=g._rotation10*p._rotation00+g._rotation11*p._rotation10+g._rotation12*p._rotation20,Y=g._rotation10*p._rotation01+g._rotation11*p._rotation11+g._rotation12*p._rotation21,R=g._rotation10*p._rotation02+g._rotation11*p._rotation12+g._rotation12*p._rotation22,C=g._rotation20*p._rotation00+g._rotation21*p._rotation10+g._rotation22*p._rotation20,d=g._rotation20*p._rotation01+g._rotation21*p._rotation11+g._rotation22*p._rotation21,Z=g._rotation20*p._rotation02+g._rotation21*p._rotation12+g._rotation22*p._rotation22,L._rotation00=F,L._rotation01=S,L._rotation02=N,L._rotation10=A,L._rotation11=Y,L._rotation12=R,L._rotation20=C,L._rotation21=d,L._rotation22=Z;var j,H,E;j=g._rotation00*p._positionX+g._rotation01*p._positionY+g._rotation02*p._positionZ,H=g._rotation10*p._positionX+g._rotation11*p._positionY+g._rotation12*p._positionZ,E=g._rotation20*p._positionX+g._rotation21*p._positionY+g._rotation22*p._positionZ,L._positionX=j,L._positionY=H,L._positionZ=E,L._positionX+=g._positionX,L._positionY+=g._positionY,L._positionZ+=g._positionZ;var G,B,Q,W,J,D;if(h._geom._computeAabb(h._aabb,h._ptransform),G=h._aabb._minX,B=h._aabb._minY,Q=h._aabb._minZ,W=h._aabb._maxX,J=h._aabb._maxY,D=h._aabb._maxZ,h._geom._computeAabb(h._aabb,h._transform),h._aabb._minX=G<h._aabb._minX?G:h._aabb._minX,h._aabb._minY=B<h._aabb._minY?B:h._aabb._minY,h._aabb._minZ=Q<h._aabb._minZ?Q:h._aabb._minZ,h._aabb._maxX=W>h._aabb._maxX?W:h._aabb._maxX,h._aabb._maxY=J>h._aabb._maxY?J:h._aabb._maxY,h._aabb._maxZ=D>h._aabb._maxZ?D:h._aabb._maxZ,h._proxy!=null){var O,K,ra;O=h._transform._positionX-h._ptransform._positionX,K=h._transform._positionY-h._ptransform._positionY,ra=h._transform._positionZ-h._ptransform._positionZ;var sa=h.displacement;sa.x=O,sa.y=K,sa.z=ra,h._rigidBody._world._broadPhase.moveProxy(h._proxy,h._aabb,h.displacement)}h=v}this._sleeping=!1,this._sleepTime=0}getRotation(){var a=new x.common.Mat3,t=a;return t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22,a}getRotationTo(a){var t=a;t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22}setRotation(a){var t=a;this._transform._rotation00=t.e00,this._transform._rotation01=t.e01,this._transform._rotation02=t.e02,this._transform._rotation10=t.e10,this._transform._rotation11=t.e11,this._transform._rotation12=t.e12,this._transform._rotation20=t.e20,this._transform._rotation21=t.e21,this._transform._rotation22=t.e22;var r,i,o,s,_,h,v,e,l;r=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,i=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,o=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,s=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,_=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,h=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,v=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,e=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=r,this._invInertia01=i,this._invInertia02=o,this._invInertia10=s,this._invInertia11=_,this._invInertia12=h,this._invInertia20=v,this._invInertia21=e,this._invInertia22=l;var u,b,f,n,c,M,m,y,V;u=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,b=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,f=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,n=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,c=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,M=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,m=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,y=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,V=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=u,this._invInertia01=b,this._invInertia02=f,this._invInertia10=n,this._invInertia11=c,this._invInertia12=M,this._invInertia20=m,this._invInertia21=y,this._invInertia22=V,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var z=this._ptransform,I=this._transform;z._positionX=I._positionX,z._positionY=I._positionY,z._positionZ=I._positionZ,z._rotation00=I._rotation00,z._rotation01=I._rotation01,z._rotation02=I._rotation02,z._rotation10=I._rotation10,z._rotation11=I._rotation11,z._rotation12=I._rotation12,z._rotation20=I._rotation20,z._rotation21=I._rotation21,z._rotation22=I._rotation22;for(var w=this._shapeList;w!=null;){var X=w._next,L=w._ptransform,p=w._localTransform,g=this._ptransform,F,S,N,A,Y,R,C,d,Z;F=g._rotation00*p._rotation00+g._rotation01*p._rotation10+g._rotation02*p._rotation20,S=g._rotation00*p._rotation01+g._rotation01*p._rotation11+g._rotation02*p._rotation21,N=g._rotation00*p._rotation02+g._rotation01*p._rotation12+g._rotation02*p._rotation22,A=g._rotation10*p._rotation00+g._rotation11*p._rotation10+g._rotation12*p._rotation20,Y=g._rotation10*p._rotation01+g._rotation11*p._rotation11+g._rotation12*p._rotation21,R=g._rotation10*p._rotation02+g._rotation11*p._rotation12+g._rotation12*p._rotation22,C=g._rotation20*p._rotation00+g._rotation21*p._rotation10+g._rotation22*p._rotation20,d=g._rotation20*p._rotation01+g._rotation21*p._rotation11+g._rotation22*p._rotation21,Z=g._rotation20*p._rotation02+g._rotation21*p._rotation12+g._rotation22*p._rotation22,L._rotation00=F,L._rotation01=S,L._rotation02=N,L._rotation10=A,L._rotation11=Y,L._rotation12=R,L._rotation20=C,L._rotation21=d,L._rotation22=Z;var j,H,E;j=g._rotation00*p._positionX+g._rotation01*p._positionY+g._rotation02*p._positionZ,H=g._rotation10*p._positionX+g._rotation11*p._positionY+g._rotation12*p._positionZ,E=g._rotation20*p._positionX+g._rotation21*p._positionY+g._rotation22*p._positionZ,L._positionX=j,L._positionY=H,L._positionZ=E,L._positionX+=g._positionX,L._positionY+=g._positionY,L._positionZ+=g._positionZ;var G=w._transform,B=w._localTransform,Q=this._transform,W,J,D,O,K,ra,sa,$,q;W=Q._rotation00*B._rotation00+Q._rotation01*B._rotation10+Q._rotation02*B._rotation20,J=Q._rotation00*B._rotation01+Q._rotation01*B._rotation11+Q._rotation02*B._rotation21,D=Q._rotation00*B._rotation02+Q._rotation01*B._rotation12+Q._rotation02*B._rotation22,O=Q._rotation10*B._rotation00+Q._rotation11*B._rotation10+Q._rotation12*B._rotation20,K=Q._rotation10*B._rotation01+Q._rotation11*B._rotation11+Q._rotation12*B._rotation21,ra=Q._rotation10*B._rotation02+Q._rotation11*B._rotation12+Q._rotation12*B._rotation22,sa=Q._rotation20*B._rotation00+Q._rotation21*B._rotation10+Q._rotation22*B._rotation20,$=Q._rotation20*B._rotation01+Q._rotation21*B._rotation11+Q._rotation22*B._rotation21,q=Q._rotation20*B._rotation02+Q._rotation21*B._rotation12+Q._rotation22*B._rotation22,G._rotation00=W,G._rotation01=J,G._rotation02=D,G._rotation10=O,G._rotation11=K,G._rotation12=ra,G._rotation20=sa,G._rotation21=$,G._rotation22=q;var na,oa,aa;na=Q._rotation00*B._positionX+Q._rotation01*B._positionY+Q._rotation02*B._positionZ,oa=Q._rotation10*B._positionX+Q._rotation11*B._positionY+Q._rotation12*B._positionZ,aa=Q._rotation20*B._positionX+Q._rotation21*B._positionY+Q._rotation22*B._positionZ,G._positionX=na,G._positionY=oa,G._positionZ=aa,G._positionX+=Q._positionX,G._positionY+=Q._positionY,G._positionZ+=Q._positionZ;var T,ca,_a,k,ta,ia;if(w._geom._computeAabb(w._aabb,w._ptransform),T=w._aabb._minX,ca=w._aabb._minY,_a=w._aabb._minZ,k=w._aabb._maxX,ta=w._aabb._maxY,ia=w._aabb._maxZ,w._geom._computeAabb(w._aabb,w._transform),w._aabb._minX=T<w._aabb._minX?T:w._aabb._minX,w._aabb._minY=ca<w._aabb._minY?ca:w._aabb._minY,w._aabb._minZ=_a<w._aabb._minZ?_a:w._aabb._minZ,w._aabb._maxX=k>w._aabb._maxX?k:w._aabb._maxX,w._aabb._maxY=ta>w._aabb._maxY?ta:w._aabb._maxY,w._aabb._maxZ=ia>w._aabb._maxZ?ia:w._aabb._maxZ,w._proxy!=null){var la,va,xa;la=w._transform._positionX-w._ptransform._positionX,va=w._transform._positionY-w._ptransform._positionY,xa=w._transform._positionZ-w._ptransform._positionZ;var Ma=w.displacement;Ma.x=la,Ma.y=va,Ma.z=xa,w._rigidBody._world._broadPhase.moveProxy(w._proxy,w._aabb,w.displacement)}w=X}this._sleeping=!1,this._sleepTime=0}setRotationXyz(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z;var s=Math.sin(t),_=Math.sin(r),h=Math.sin(i),v=Math.cos(t),e=Math.cos(r),l=Math.cos(i);this._transform._rotation00=e*l,this._transform._rotation01=-e*h,this._transform._rotation02=_,this._transform._rotation10=v*h+l*s*_,this._transform._rotation11=v*l-s*_*h,this._transform._rotation12=-e*s,this._transform._rotation20=s*h-v*l*_,this._transform._rotation21=l*s+v*_*h,this._transform._rotation22=v*e;var u,b,f,n,c,M,m,y,V;u=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,b=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,f=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,n=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,c=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,M=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,m=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,y=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,V=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=u,this._invInertia01=b,this._invInertia02=f,this._invInertia10=n,this._invInertia11=c,this._invInertia12=M,this._invInertia20=m,this._invInertia21=y,this._invInertia22=V;var z,I,w,X,L,p,g,F,S;z=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,I=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,w=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,X=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,L=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,p=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,g=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,F=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,S=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=z,this._invInertia01=I,this._invInertia02=w,this._invInertia10=X,this._invInertia11=L,this._invInertia12=p,this._invInertia20=g,this._invInertia21=F,this._invInertia22=S,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var N=this._ptransform,A=this._transform;N._positionX=A._positionX,N._positionY=A._positionY,N._positionZ=A._positionZ,N._rotation00=A._rotation00,N._rotation01=A._rotation01,N._rotation02=A._rotation02,N._rotation10=A._rotation10,N._rotation11=A._rotation11,N._rotation12=A._rotation12,N._rotation20=A._rotation20,N._rotation21=A._rotation21,N._rotation22=A._rotation22;for(var Y=this._shapeList;Y!=null;){var R=Y._next,C=Y._ptransform,d=Y._localTransform,Z=this._ptransform,j,H,E,G,B,Q,W,J,D;j=Z._rotation00*d._rotation00+Z._rotation01*d._rotation10+Z._rotation02*d._rotation20,H=Z._rotation00*d._rotation01+Z._rotation01*d._rotation11+Z._rotation02*d._rotation21,E=Z._rotation00*d._rotation02+Z._rotation01*d._rotation12+Z._rotation02*d._rotation22,G=Z._rotation10*d._rotation00+Z._rotation11*d._rotation10+Z._rotation12*d._rotation20,B=Z._rotation10*d._rotation01+Z._rotation11*d._rotation11+Z._rotation12*d._rotation21,Q=Z._rotation10*d._rotation02+Z._rotation11*d._rotation12+Z._rotation12*d._rotation22,W=Z._rotation20*d._rotation00+Z._rotation21*d._rotation10+Z._rotation22*d._rotation20,J=Z._rotation20*d._rotation01+Z._rotation21*d._rotation11+Z._rotation22*d._rotation21,D=Z._rotation20*d._rotation02+Z._rotation21*d._rotation12+Z._rotation22*d._rotation22,C._rotation00=j,C._rotation01=H,C._rotation02=E,C._rotation10=G,C._rotation11=B,C._rotation12=Q,C._rotation20=W,C._rotation21=J,C._rotation22=D;var O,K,ra;O=Z._rotation00*d._positionX+Z._rotation01*d._positionY+Z._rotation02*d._positionZ,K=Z._rotation10*d._positionX+Z._rotation11*d._positionY+Z._rotation12*d._positionZ,ra=Z._rotation20*d._positionX+Z._rotation21*d._positionY+Z._rotation22*d._positionZ,C._positionX=O,C._positionY=K,C._positionZ=ra,C._positionX+=Z._positionX,C._positionY+=Z._positionY,C._positionZ+=Z._positionZ;var sa=Y._transform,$=Y._localTransform,q=this._transform,na,oa,aa,T,ca,_a,k,ta,ia;na=q._rotation00*$._rotation00+q._rotation01*$._rotation10+q._rotation02*$._rotation20,oa=q._rotation00*$._rotation01+q._rotation01*$._rotation11+q._rotation02*$._rotation21,aa=q._rotation00*$._rotation02+q._rotation01*$._rotation12+q._rotation02*$._rotation22,T=q._rotation10*$._rotation00+q._rotation11*$._rotation10+q._rotation12*$._rotation20,ca=q._rotation10*$._rotation01+q._rotation11*$._rotation11+q._rotation12*$._rotation21,_a=q._rotation10*$._rotation02+q._rotation11*$._rotation12+q._rotation12*$._rotation22,k=q._rotation20*$._rotation00+q._rotation21*$._rotation10+q._rotation22*$._rotation20,ta=q._rotation20*$._rotation01+q._rotation21*$._rotation11+q._rotation22*$._rotation21,ia=q._rotation20*$._rotation02+q._rotation21*$._rotation12+q._rotation22*$._rotation22,sa._rotation00=na,sa._rotation01=oa,sa._rotation02=aa,sa._rotation10=T,sa._rotation11=ca,sa._rotation12=_a,sa._rotation20=k,sa._rotation21=ta,sa._rotation22=ia;var la,va,xa;la=q._rotation00*$._positionX+q._rotation01*$._positionY+q._rotation02*$._positionZ,va=q._rotation10*$._positionX+q._rotation11*$._positionY+q._rotation12*$._positionZ,xa=q._rotation20*$._positionX+q._rotation21*$._positionY+q._rotation22*$._positionZ,sa._positionX=la,sa._positionY=va,sa._positionZ=xa,sa._positionX+=q._positionX,sa._positionY+=q._positionY,sa._positionZ+=q._positionZ;var Ma,za,Xa,Za,fa,ba;if(Y._geom._computeAabb(Y._aabb,Y._ptransform),Ma=Y._aabb._minX,za=Y._aabb._minY,Xa=Y._aabb._minZ,Za=Y._aabb._maxX,fa=Y._aabb._maxY,ba=Y._aabb._maxZ,Y._geom._computeAabb(Y._aabb,Y._transform),Y._aabb._minX=Ma<Y._aabb._minX?Ma:Y._aabb._minX,Y._aabb._minY=za<Y._aabb._minY?za:Y._aabb._minY,Y._aabb._minZ=Xa<Y._aabb._minZ?Xa:Y._aabb._minZ,Y._aabb._maxX=Za>Y._aabb._maxX?Za:Y._aabb._maxX,Y._aabb._maxY=fa>Y._aabb._maxY?fa:Y._aabb._maxY,Y._aabb._maxZ=ba>Y._aabb._maxZ?ba:Y._aabb._maxZ,Y._proxy!=null){var ea,ha,pa;ea=Y._transform._positionX-Y._ptransform._positionX,ha=Y._transform._positionY-Y._ptransform._positionY,pa=Y._transform._positionZ-Y._ptransform._positionZ;var ya=Y.displacement;ya.x=ea,ya.y=ha,ya.z=pa,Y._rigidBody._world._broadPhase.moveProxy(Y._proxy,Y._aabb,Y.displacement)}Y=R}this._sleeping=!1,this._sleepTime=0}rotate(a){var t,r,i,o,s,_,h,v,e,l=a;t=l.e00,r=l.e01,i=l.e02,o=l.e10,s=l.e11,_=l.e12,h=l.e20,v=l.e21,e=l.e22;var u,b,f,n,c,M,m,y,V;u=t*this._transform._rotation00+r*this._transform._rotation10+i*this._transform._rotation20,b=t*this._transform._rotation01+r*this._transform._rotation11+i*this._transform._rotation21,f=t*this._transform._rotation02+r*this._transform._rotation12+i*this._transform._rotation22,n=o*this._transform._rotation00+s*this._transform._rotation10+_*this._transform._rotation20,c=o*this._transform._rotation01+s*this._transform._rotation11+_*this._transform._rotation21,M=o*this._transform._rotation02+s*this._transform._rotation12+_*this._transform._rotation22,m=h*this._transform._rotation00+v*this._transform._rotation10+e*this._transform._rotation20,y=h*this._transform._rotation01+v*this._transform._rotation11+e*this._transform._rotation21,V=h*this._transform._rotation02+v*this._transform._rotation12+e*this._transform._rotation22,this._transform._rotation00=u,this._transform._rotation01=b,this._transform._rotation02=f,this._transform._rotation10=n,this._transform._rotation11=c,this._transform._rotation12=M,this._transform._rotation20=m,this._transform._rotation21=y,this._transform._rotation22=V;var z,I,w,X,L,p,g,F,S;z=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,I=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,w=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,X=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,L=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,p=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,g=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,F=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,S=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=z,this._invInertia01=I,this._invInertia02=w,this._invInertia10=X,this._invInertia11=L,this._invInertia12=p,this._invInertia20=g,this._invInertia21=F,this._invInertia22=S;var N,A,Y,R,C,d,Z,j,H;N=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,A=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,Y=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,R=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,C=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,d=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,Z=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,j=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,H=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=N,this._invInertia01=A,this._invInertia02=Y,this._invInertia10=R,this._invInertia11=C,this._invInertia12=d,this._invInertia20=Z,this._invInertia21=j,this._invInertia22=H,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var E=this._ptransform,G=this._transform;E._positionX=G._positionX,E._positionY=G._positionY,E._positionZ=G._positionZ,E._rotation00=G._rotation00,E._rotation01=G._rotation01,E._rotation02=G._rotation02,E._rotation10=G._rotation10,E._rotation11=G._rotation11,E._rotation12=G._rotation12,E._rotation20=G._rotation20,E._rotation21=G._rotation21,E._rotation22=G._rotation22;for(var B=this._shapeList;B!=null;){var Q=B._next,W=B._ptransform,J=B._localTransform,D=this._ptransform,O,K,ra,sa,$,q,na,oa,aa;O=D._rotation00*J._rotation00+D._rotation01*J._rotation10+D._rotation02*J._rotation20,K=D._rotation00*J._rotation01+D._rotation01*J._rotation11+D._rotation02*J._rotation21,ra=D._rotation00*J._rotation02+D._rotation01*J._rotation12+D._rotation02*J._rotation22,sa=D._rotation10*J._rotation00+D._rotation11*J._rotation10+D._rotation12*J._rotation20,$=D._rotation10*J._rotation01+D._rotation11*J._rotation11+D._rotation12*J._rotation21,q=D._rotation10*J._rotation02+D._rotation11*J._rotation12+D._rotation12*J._rotation22,na=D._rotation20*J._rotation00+D._rotation21*J._rotation10+D._rotation22*J._rotation20,oa=D._rotation20*J._rotation01+D._rotation21*J._rotation11+D._rotation22*J._rotation21,aa=D._rotation20*J._rotation02+D._rotation21*J._rotation12+D._rotation22*J._rotation22,W._rotation00=O,W._rotation01=K,W._rotation02=ra,W._rotation10=sa,W._rotation11=$,W._rotation12=q,W._rotation20=na,W._rotation21=oa,W._rotation22=aa;var T,ca,_a;T=D._rotation00*J._positionX+D._rotation01*J._positionY+D._rotation02*J._positionZ,ca=D._rotation10*J._positionX+D._rotation11*J._positionY+D._rotation12*J._positionZ,_a=D._rotation20*J._positionX+D._rotation21*J._positionY+D._rotation22*J._positionZ,W._positionX=T,W._positionY=ca,W._positionZ=_a,W._positionX+=D._positionX,W._positionY+=D._positionY,W._positionZ+=D._positionZ;var k=B._transform,ta=B._localTransform,ia=this._transform,la,va,xa,Ma,za,Xa,Za,fa,ba;la=ia._rotation00*ta._rotation00+ia._rotation01*ta._rotation10+ia._rotation02*ta._rotation20,va=ia._rotation00*ta._rotation01+ia._rotation01*ta._rotation11+ia._rotation02*ta._rotation21,xa=ia._rotation00*ta._rotation02+ia._rotation01*ta._rotation12+ia._rotation02*ta._rotation22,Ma=ia._rotation10*ta._rotation00+ia._rotation11*ta._rotation10+ia._rotation12*ta._rotation20,za=ia._rotation10*ta._rotation01+ia._rotation11*ta._rotation11+ia._rotation12*ta._rotation21,Xa=ia._rotation10*ta._rotation02+ia._rotation11*ta._rotation12+ia._rotation12*ta._rotation22,Za=ia._rotation20*ta._rotation00+ia._rotation21*ta._rotation10+ia._rotation22*ta._rotation20,fa=ia._rotation20*ta._rotation01+ia._rotation21*ta._rotation11+ia._rotation22*ta._rotation21,ba=ia._rotation20*ta._rotation02+ia._rotation21*ta._rotation12+ia._rotation22*ta._rotation22,k._rotation00=la,k._rotation01=va,k._rotation02=xa,k._rotation10=Ma,k._rotation11=za,k._rotation12=Xa,k._rotation20=Za,k._rotation21=fa,k._rotation22=ba;var ea,ha,pa;ea=ia._rotation00*ta._positionX+ia._rotation01*ta._positionY+ia._rotation02*ta._positionZ,ha=ia._rotation10*ta._positionX+ia._rotation11*ta._positionY+ia._rotation12*ta._positionZ,pa=ia._rotation20*ta._positionX+ia._rotation21*ta._positionY+ia._rotation22*ta._positionZ,k._positionX=ea,k._positionY=ha,k._positionZ=pa,k._positionX+=ia._positionX,k._positionY+=ia._positionY,k._positionZ+=ia._positionZ;var ya,da,ma,Ya,Qa,ga;if(B._geom._computeAabb(B._aabb,B._ptransform),ya=B._aabb._minX,da=B._aabb._minY,ma=B._aabb._minZ,Ya=B._aabb._maxX,Qa=B._aabb._maxY,ga=B._aabb._maxZ,B._geom._computeAabb(B._aabb,B._transform),B._aabb._minX=ya<B._aabb._minX?ya:B._aabb._minX,B._aabb._minY=da<B._aabb._minY?da:B._aabb._minY,B._aabb._minZ=ma<B._aabb._minZ?ma:B._aabb._minZ,B._aabb._maxX=Ya>B._aabb._maxX?Ya:B._aabb._maxX,B._aabb._maxY=Qa>B._aabb._maxY?Qa:B._aabb._maxY,B._aabb._maxZ=ga>B._aabb._maxZ?ga:B._aabb._maxZ,B._proxy!=null){var ua,ka,wa;ua=B._transform._positionX-B._ptransform._positionX,ka=B._transform._positionY-B._ptransform._positionY,wa=B._transform._positionZ-B._ptransform._positionZ;var Pa=B.displacement;Pa.x=ua,Pa.y=ka,Pa.z=wa,B._rigidBody._world._broadPhase.moveProxy(B._proxy,B._aabb,B.displacement)}B=Q}this._sleeping=!1,this._sleepTime=0}rotateXyz(a){var t,r,i,o,s,_,h,v,e,l,u,b,f=a;t=f.x,r=f.y,i=f.z;var n=Math.sin(t),c=Math.sin(r),M=Math.sin(i),m=Math.cos(t),y=Math.cos(r),V=Math.cos(i);o=y*V,s=-y*M,_=c,h=m*M+V*n*c,v=m*V-n*c*M,e=-y*n,l=n*M-m*V*c,u=V*n+m*c*M,b=m*y;var z,I,w,X,L,p,g,F,S;z=o*this._transform._rotation00+s*this._transform._rotation10+_*this._transform._rotation20,I=o*this._transform._rotation01+s*this._transform._rotation11+_*this._transform._rotation21,w=o*this._transform._rotation02+s*this._transform._rotation12+_*this._transform._rotation22,X=h*this._transform._rotation00+v*this._transform._rotation10+e*this._transform._rotation20,L=h*this._transform._rotation01+v*this._transform._rotation11+e*this._transform._rotation21,p=h*this._transform._rotation02+v*this._transform._rotation12+e*this._transform._rotation22,g=l*this._transform._rotation00+u*this._transform._rotation10+b*this._transform._rotation20,F=l*this._transform._rotation01+u*this._transform._rotation11+b*this._transform._rotation21,S=l*this._transform._rotation02+u*this._transform._rotation12+b*this._transform._rotation22,this._transform._rotation00=z,this._transform._rotation01=I,this._transform._rotation02=w,this._transform._rotation10=X,this._transform._rotation11=L,this._transform._rotation12=p,this._transform._rotation20=g,this._transform._rotation21=F,this._transform._rotation22=S;var N,A,Y,R,C,d,Z,j,H;N=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,A=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,Y=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,R=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,C=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,d=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,Z=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,j=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,H=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=N,this._invInertia01=A,this._invInertia02=Y,this._invInertia10=R,this._invInertia11=C,this._invInertia12=d,this._invInertia20=Z,this._invInertia21=j,this._invInertia22=H;var E,G,B,Q,W,J,D,O,K;E=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,G=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,B=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,Q=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,W=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,J=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,D=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,O=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,K=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=E,this._invInertia01=G,this._invInertia02=B,this._invInertia10=Q,this._invInertia11=W,this._invInertia12=J,this._invInertia20=D,this._invInertia21=O,this._invInertia22=K,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var ra=this._ptransform,sa=this._transform;ra._positionX=sa._positionX,ra._positionY=sa._positionY,ra._positionZ=sa._positionZ,ra._rotation00=sa._rotation00,ra._rotation01=sa._rotation01,ra._rotation02=sa._rotation02,ra._rotation10=sa._rotation10,ra._rotation11=sa._rotation11,ra._rotation12=sa._rotation12,ra._rotation20=sa._rotation20,ra._rotation21=sa._rotation21,ra._rotation22=sa._rotation22;for(var $=this._shapeList;$!=null;){var q=$._next,na=$._ptransform,oa=$._localTransform,aa=this._ptransform,T,ca,_a,k,ta,ia,la,va,xa;T=aa._rotation00*oa._rotation00+aa._rotation01*oa._rotation10+aa._rotation02*oa._rotation20,ca=aa._rotation00*oa._rotation01+aa._rotation01*oa._rotation11+aa._rotation02*oa._rotation21,_a=aa._rotation00*oa._rotation02+aa._rotation01*oa._rotation12+aa._rotation02*oa._rotation22,k=aa._rotation10*oa._rotation00+aa._rotation11*oa._rotation10+aa._rotation12*oa._rotation20,ta=aa._rotation10*oa._rotation01+aa._rotation11*oa._rotation11+aa._rotation12*oa._rotation21,ia=aa._rotation10*oa._rotation02+aa._rotation11*oa._rotation12+aa._rotation12*oa._rotation22,la=aa._rotation20*oa._rotation00+aa._rotation21*oa._rotation10+aa._rotation22*oa._rotation20,va=aa._rotation20*oa._rotation01+aa._rotation21*oa._rotation11+aa._rotation22*oa._rotation21,xa=aa._rotation20*oa._rotation02+aa._rotation21*oa._rotation12+aa._rotation22*oa._rotation22,na._rotation00=T,na._rotation01=ca,na._rotation02=_a,na._rotation10=k,na._rotation11=ta,na._rotation12=ia,na._rotation20=la,na._rotation21=va,na._rotation22=xa;var Ma,za,Xa;Ma=aa._rotation00*oa._positionX+aa._rotation01*oa._positionY+aa._rotation02*oa._positionZ,za=aa._rotation10*oa._positionX+aa._rotation11*oa._positionY+aa._rotation12*oa._positionZ,Xa=aa._rotation20*oa._positionX+aa._rotation21*oa._positionY+aa._rotation22*oa._positionZ,na._positionX=Ma,na._positionY=za,na._positionZ=Xa,na._positionX+=aa._positionX,na._positionY+=aa._positionY,na._positionZ+=aa._positionZ;var Za=$._transform,fa=$._localTransform,ba=this._transform,ea,ha,pa,ya,da,ma,Ya,Qa,ga;ea=ba._rotation00*fa._rotation00+ba._rotation01*fa._rotation10+ba._rotation02*fa._rotation20,ha=ba._rotation00*fa._rotation01+ba._rotation01*fa._rotation11+ba._rotation02*fa._rotation21,pa=ba._rotation00*fa._rotation02+ba._rotation01*fa._rotation12+ba._rotation02*fa._rotation22,ya=ba._rotation10*fa._rotation00+ba._rotation11*fa._rotation10+ba._rotation12*fa._rotation20,da=ba._rotation10*fa._rotation01+ba._rotation11*fa._rotation11+ba._rotation12*fa._rotation21,ma=ba._rotation10*fa._rotation02+ba._rotation11*fa._rotation12+ba._rotation12*fa._rotation22,Ya=ba._rotation20*fa._rotation00+ba._rotation21*fa._rotation10+ba._rotation22*fa._rotation20,Qa=ba._rotation20*fa._rotation01+ba._rotation21*fa._rotation11+ba._rotation22*fa._rotation21,ga=ba._rotation20*fa._rotation02+ba._rotation21*fa._rotation12+ba._rotation22*fa._rotation22,Za._rotation00=ea,Za._rotation01=ha,Za._rotation02=pa,Za._rotation10=ya,Za._rotation11=da,Za._rotation12=ma,Za._rotation20=Ya,Za._rotation21=Qa,Za._rotation22=ga;var ua,ka,wa;ua=ba._rotation00*fa._positionX+ba._rotation01*fa._positionY+ba._rotation02*fa._positionZ,ka=ba._rotation10*fa._positionX+ba._rotation11*fa._positionY+ba._rotation12*fa._positionZ,wa=ba._rotation20*fa._positionX+ba._rotation21*fa._positionY+ba._rotation22*fa._positionZ,Za._positionX=ua,Za._positionY=ka,Za._positionZ=wa,Za._positionX+=ba._positionX,Za._positionY+=ba._positionY,Za._positionZ+=ba._positionZ;var Pa,Mt,Oa,Ba,nt,Ea;if($._geom._computeAabb($._aabb,$._ptransform),Pa=$._aabb._minX,Mt=$._aabb._minY,Oa=$._aabb._minZ,Ba=$._aabb._maxX,nt=$._aabb._maxY,Ea=$._aabb._maxZ,$._geom._computeAabb($._aabb,$._transform),$._aabb._minX=Pa<$._aabb._minX?Pa:$._aabb._minX,$._aabb._minY=Mt<$._aabb._minY?Mt:$._aabb._minY,$._aabb._minZ=Oa<$._aabb._minZ?Oa:$._aabb._minZ,$._aabb._maxX=Ba>$._aabb._maxX?Ba:$._aabb._maxX,$._aabb._maxY=nt>$._aabb._maxY?nt:$._aabb._maxY,$._aabb._maxZ=Ea>$._aabb._maxZ?Ea:$._aabb._maxZ,$._proxy!=null){var Na,Sa,ft;Na=$._transform._positionX-$._ptransform._positionX,Sa=$._transform._positionY-$._ptransform._positionY,ft=$._transform._positionZ-$._ptransform._positionZ;var Wa=$.displacement;Wa.x=Na,Wa.y=Sa,Wa.z=ft,$._rigidBody._world._broadPhase.moveProxy($._proxy,$._aabb,$.displacement)}$=q}this._sleeping=!1,this._sleepTime=0}getOrientation(){var a=new x.common.Quat,t,r,i,o,s=this._transform._rotation00,_=this._transform._rotation11,h=this._transform._rotation22,v=s+_+h,e;v>0?(e=Math.sqrt(v+1),o=.5*e,e=.5/e,t=(this._transform._rotation21-this._transform._rotation12)*e,r=(this._transform._rotation02-this._transform._rotation20)*e,i=(this._transform._rotation10-this._transform._rotation01)*e):s>_?s>h?(e=Math.sqrt(s-_-h+1),t=.5*e,e=.5/e,r=(this._transform._rotation01+this._transform._rotation10)*e,i=(this._transform._rotation02+this._transform._rotation20)*e,o=(this._transform._rotation21-this._transform._rotation12)*e):(e=Math.sqrt(h-s-_+1),i=.5*e,e=.5/e,t=(this._transform._rotation02+this._transform._rotation20)*e,r=(this._transform._rotation12+this._transform._rotation21)*e,o=(this._transform._rotation10-this._transform._rotation01)*e):_>h?(e=Math.sqrt(_-h-s+1),r=.5*e,e=.5/e,t=(this._transform._rotation01+this._transform._rotation10)*e,i=(this._transform._rotation12+this._transform._rotation21)*e,o=(this._transform._rotation02-this._transform._rotation20)*e):(e=Math.sqrt(h-s-_+1),i=.5*e,e=.5/e,t=(this._transform._rotation02+this._transform._rotation20)*e,r=(this._transform._rotation12+this._transform._rotation21)*e,o=(this._transform._rotation10-this._transform._rotation01)*e);var l=a;return l.x=t,l.y=r,l.z=i,l.w=o,a}getOrientationTo(a){var t,r,i,o,s=this._transform._rotation00,_=this._transform._rotation11,h=this._transform._rotation22,v=s+_+h,e;v>0?(e=Math.sqrt(v+1),o=.5*e,e=.5/e,t=(this._transform._rotation21-this._transform._rotation12)*e,r=(this._transform._rotation02-this._transform._rotation20)*e,i=(this._transform._rotation10-this._transform._rotation01)*e):s>_?s>h?(e=Math.sqrt(s-_-h+1),t=.5*e,e=.5/e,r=(this._transform._rotation01+this._transform._rotation10)*e,i=(this._transform._rotation02+this._transform._rotation20)*e,o=(this._transform._rotation21-this._transform._rotation12)*e):(e=Math.sqrt(h-s-_+1),i=.5*e,e=.5/e,t=(this._transform._rotation02+this._transform._rotation20)*e,r=(this._transform._rotation12+this._transform._rotation21)*e,o=(this._transform._rotation10-this._transform._rotation01)*e):_>h?(e=Math.sqrt(_-h-s+1),r=.5*e,e=.5/e,t=(this._transform._rotation01+this._transform._rotation10)*e,i=(this._transform._rotation12+this._transform._rotation21)*e,o=(this._transform._rotation02-this._transform._rotation20)*e):(e=Math.sqrt(h-s-_+1),i=.5*e,e=.5/e,t=(this._transform._rotation02+this._transform._rotation20)*e,r=(this._transform._rotation12+this._transform._rotation21)*e,o=(this._transform._rotation10-this._transform._rotation01)*e);var l=a;l.x=t,l.y=r,l.z=i,l.w=o}setOrientation(a){var t,r,i,o,s=a;t=s.x,r=s.y,i=s.z,o=s.w;var _=t,h=r,v=i,e=o,l=2*_,u=2*h,b=2*v,f=_*l,n=h*u,c=v*b,M=_*u,m=h*b,y=_*b,V=e*l,z=e*u,I=e*b;this._transform._rotation00=1-n-c,this._transform._rotation01=M-I,this._transform._rotation02=y+z,this._transform._rotation10=M+I,this._transform._rotation11=1-f-c,this._transform._rotation12=m-V,this._transform._rotation20=y-z,this._transform._rotation21=m+V,this._transform._rotation22=1-f-n;var w,X,L,p,g,F,S,N,A;w=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,X=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,L=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,p=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,g=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,F=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,S=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,N=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,A=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=w,this._invInertia01=X,this._invInertia02=L,this._invInertia10=p,this._invInertia11=g,this._invInertia12=F,this._invInertia20=S,this._invInertia21=N,this._invInertia22=A;var Y,R,C,d,Z,j,H,E,G;Y=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,R=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,C=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,d=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,Z=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,j=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,H=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,E=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,G=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=Y,this._invInertia01=R,this._invInertia02=C,this._invInertia10=d,this._invInertia11=Z,this._invInertia12=j,this._invInertia20=H,this._invInertia21=E,this._invInertia22=G,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var B=this._ptransform,Q=this._transform;B._positionX=Q._positionX,B._positionY=Q._positionY,B._positionZ=Q._positionZ,B._rotation00=Q._rotation00,B._rotation01=Q._rotation01,B._rotation02=Q._rotation02,B._rotation10=Q._rotation10,B._rotation11=Q._rotation11,B._rotation12=Q._rotation12,B._rotation20=Q._rotation20,B._rotation21=Q._rotation21,B._rotation22=Q._rotation22;for(var W=this._shapeList;W!=null;){var J=W._next,D=W._ptransform,O=W._localTransform,K=this._ptransform,ra,sa,$,q,na,oa,aa,T,ca;ra=K._rotation00*O._rotation00+K._rotation01*O._rotation10+K._rotation02*O._rotation20,sa=K._rotation00*O._rotation01+K._rotation01*O._rotation11+K._rotation02*O._rotation21,$=K._rotation00*O._rotation02+K._rotation01*O._rotation12+K._rotation02*O._rotation22,q=K._rotation10*O._rotation00+K._rotation11*O._rotation10+K._rotation12*O._rotation20,na=K._rotation10*O._rotation01+K._rotation11*O._rotation11+K._rotation12*O._rotation21,oa=K._rotation10*O._rotation02+K._rotation11*O._rotation12+K._rotation12*O._rotation22,aa=K._rotation20*O._rotation00+K._rotation21*O._rotation10+K._rotation22*O._rotation20,T=K._rotation20*O._rotation01+K._rotation21*O._rotation11+K._rotation22*O._rotation21,ca=K._rotation20*O._rotation02+K._rotation21*O._rotation12+K._rotation22*O._rotation22,D._rotation00=ra,D._rotation01=sa,D._rotation02=$,D._rotation10=q,D._rotation11=na,D._rotation12=oa,D._rotation20=aa,D._rotation21=T,D._rotation22=ca;var _a,k,ta;_a=K._rotation00*O._positionX+K._rotation01*O._positionY+K._rotation02*O._positionZ,k=K._rotation10*O._positionX+K._rotation11*O._positionY+K._rotation12*O._positionZ,ta=K._rotation20*O._positionX+K._rotation21*O._positionY+K._rotation22*O._positionZ,D._positionX=_a,D._positionY=k,D._positionZ=ta,D._positionX+=K._positionX,D._positionY+=K._positionY,D._positionZ+=K._positionZ;var ia=W._transform,la=W._localTransform,va=this._transform,xa,Ma,za,Xa,Za,fa,ba,ea,ha;xa=va._rotation00*la._rotation00+va._rotation01*la._rotation10+va._rotation02*la._rotation20,Ma=va._rotation00*la._rotation01+va._rotation01*la._rotation11+va._rotation02*la._rotation21,za=va._rotation00*la._rotation02+va._rotation01*la._rotation12+va._rotation02*la._rotation22,Xa=va._rotation10*la._rotation00+va._rotation11*la._rotation10+va._rotation12*la._rotation20,Za=va._rotation10*la._rotation01+va._rotation11*la._rotation11+va._rotation12*la._rotation21,fa=va._rotation10*la._rotation02+va._rotation11*la._rotation12+va._rotation12*la._rotation22,ba=va._rotation20*la._rotation00+va._rotation21*la._rotation10+va._rotation22*la._rotation20,ea=va._rotation20*la._rotation01+va._rotation21*la._rotation11+va._rotation22*la._rotation21,ha=va._rotation20*la._rotation02+va._rotation21*la._rotation12+va._rotation22*la._rotation22,ia._rotation00=xa,ia._rotation01=Ma,ia._rotation02=za,ia._rotation10=Xa,ia._rotation11=Za,ia._rotation12=fa,ia._rotation20=ba,ia._rotation21=ea,ia._rotation22=ha;var pa,ya,da;pa=va._rotation00*la._positionX+va._rotation01*la._positionY+va._rotation02*la._positionZ,ya=va._rotation10*la._positionX+va._rotation11*la._positionY+va._rotation12*la._positionZ,da=va._rotation20*la._positionX+va._rotation21*la._positionY+va._rotation22*la._positionZ,ia._positionX=pa,ia._positionY=ya,ia._positionZ=da,ia._positionX+=va._positionX,ia._positionY+=va._positionY,ia._positionZ+=va._positionZ;var ma,Ya,Qa,ga,ua,ka;if(W._geom._computeAabb(W._aabb,W._ptransform),ma=W._aabb._minX,Ya=W._aabb._minY,Qa=W._aabb._minZ,ga=W._aabb._maxX,ua=W._aabb._maxY,ka=W._aabb._maxZ,W._geom._computeAabb(W._aabb,W._transform),W._aabb._minX=ma<W._aabb._minX?ma:W._aabb._minX,W._aabb._minY=Ya<W._aabb._minY?Ya:W._aabb._minY,W._aabb._minZ=Qa<W._aabb._minZ?Qa:W._aabb._minZ,W._aabb._maxX=ga>W._aabb._maxX?ga:W._aabb._maxX,W._aabb._maxY=ua>W._aabb._maxY?ua:W._aabb._maxY,W._aabb._maxZ=ka>W._aabb._maxZ?ka:W._aabb._maxZ,W._proxy!=null){var wa,Pa,Mt;wa=W._transform._positionX-W._ptransform._positionX,Pa=W._transform._positionY-W._ptransform._positionY,Mt=W._transform._positionZ-W._ptransform._positionZ;var Oa=W.displacement;Oa.x=wa,Oa.y=Pa,Oa.z=Mt,W._rigidBody._world._broadPhase.moveProxy(W._proxy,W._aabb,W.displacement)}W=J}this._sleeping=!1,this._sleepTime=0}getTransform(){var a=this._transform,t=new x.common.Transform;return t._positionX=a._positionX,t._positionY=a._positionY,t._positionZ=a._positionZ,t._rotation00=a._rotation00,t._rotation01=a._rotation01,t._rotation02=a._rotation02,t._rotation10=a._rotation10,t._rotation11=a._rotation11,t._rotation12=a._rotation12,t._rotation20=a._rotation20,t._rotation21=a._rotation21,t._rotation22=a._rotation22,t}getTransformTo(a){var t=this._transform;a._positionX=t._positionX,a._positionY=t._positionY,a._positionZ=t._positionZ,a._rotation00=t._rotation00,a._rotation01=t._rotation01,a._rotation02=t._rotation02,a._rotation10=t._rotation10,a._rotation11=t._rotation11,a._rotation12=t._rotation12,a._rotation20=t._rotation20,a._rotation21=t._rotation21,a._rotation22=t._rotation22}setTransform(a){this._transform._positionX=a._positionX,this._transform._positionY=a._positionY,this._transform._positionZ=a._positionZ,this._transform._rotation00=a._rotation00,this._transform._rotation01=a._rotation01,this._transform._rotation02=a._rotation02,this._transform._rotation10=a._rotation10,this._transform._rotation11=a._rotation11,this._transform._rotation12=a._rotation12,this._transform._rotation20=a._rotation20,this._transform._rotation21=a._rotation21,this._transform._rotation22=a._rotation22;var t,r,i,o,s,_,h,v,e;t=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,r=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,i=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,s=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,_=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,h=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,v=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,e=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=t,this._invInertia01=r,this._invInertia02=i,this._invInertia10=o,this._invInertia11=s,this._invInertia12=_,this._invInertia20=h,this._invInertia21=v,this._invInertia22=e;var l,u,b,f,n,c,M,m,y;l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,u=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,b=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,f=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,n=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,c=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,M=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,m=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,y=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=u,this._invInertia02=b,this._invInertia10=f,this._invInertia11=n,this._invInertia12=c,this._invInertia20=M,this._invInertia21=m,this._invInertia22=y,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var V=this._ptransform,z=this._transform;V._positionX=z._positionX,V._positionY=z._positionY,V._positionZ=z._positionZ,V._rotation00=z._rotation00,V._rotation01=z._rotation01,V._rotation02=z._rotation02,V._rotation10=z._rotation10,V._rotation11=z._rotation11,V._rotation12=z._rotation12,V._rotation20=z._rotation20,V._rotation21=z._rotation21,V._rotation22=z._rotation22;for(var I=this._shapeList;I!=null;){var w=I._next,X=I._ptransform,L=I._localTransform,p=this._ptransform,g,F,S,N,A,Y,R,C,d;g=p._rotation00*L._rotation00+p._rotation01*L._rotation10+p._rotation02*L._rotation20,F=p._rotation00*L._rotation01+p._rotation01*L._rotation11+p._rotation02*L._rotation21,S=p._rotation00*L._rotation02+p._rotation01*L._rotation12+p._rotation02*L._rotation22,N=p._rotation10*L._rotation00+p._rotation11*L._rotation10+p._rotation12*L._rotation20,A=p._rotation10*L._rotation01+p._rotation11*L._rotation11+p._rotation12*L._rotation21,Y=p._rotation10*L._rotation02+p._rotation11*L._rotation12+p._rotation12*L._rotation22,R=p._rotation20*L._rotation00+p._rotation21*L._rotation10+p._rotation22*L._rotation20,C=p._rotation20*L._rotation01+p._rotation21*L._rotation11+p._rotation22*L._rotation21,d=p._rotation20*L._rotation02+p._rotation21*L._rotation12+p._rotation22*L._rotation22,X._rotation00=g,X._rotation01=F,X._rotation02=S,X._rotation10=N,X._rotation11=A,X._rotation12=Y,X._rotation20=R,X._rotation21=C,X._rotation22=d;var Z,j,H;Z=p._rotation00*L._positionX+p._rotation01*L._positionY+p._rotation02*L._positionZ,j=p._rotation10*L._positionX+p._rotation11*L._positionY+p._rotation12*L._positionZ,H=p._rotation20*L._positionX+p._rotation21*L._positionY+p._rotation22*L._positionZ,X._positionX=Z,X._positionY=j,X._positionZ=H,X._positionX+=p._positionX,X._positionY+=p._positionY,X._positionZ+=p._positionZ;var E=I._transform,G=I._localTransform,B=this._transform,Q,W,J,D,O,K,ra,sa,$;Q=B._rotation00*G._rotation00+B._rotation01*G._rotation10+B._rotation02*G._rotation20,W=B._rotation00*G._rotation01+B._rotation01*G._rotation11+B._rotation02*G._rotation21,J=B._rotation00*G._rotation02+B._rotation01*G._rotation12+B._rotation02*G._rotation22,D=B._rotation10*G._rotation00+B._rotation11*G._rotation10+B._rotation12*G._rotation20,O=B._rotation10*G._rotation01+B._rotation11*G._rotation11+B._rotation12*G._rotation21,K=B._rotation10*G._rotation02+B._rotation11*G._rotation12+B._rotation12*G._rotation22,ra=B._rotation20*G._rotation00+B._rotation21*G._rotation10+B._rotation22*G._rotation20,sa=B._rotation20*G._rotation01+B._rotation21*G._rotation11+B._rotation22*G._rotation21,$=B._rotation20*G._rotation02+B._rotation21*G._rotation12+B._rotation22*G._rotation22,E._rotation00=Q,E._rotation01=W,E._rotation02=J,E._rotation10=D,E._rotation11=O,E._rotation12=K,E._rotation20=ra,E._rotation21=sa,E._rotation22=$;var q,na,oa;q=B._rotation00*G._positionX+B._rotation01*G._positionY+B._rotation02*G._positionZ,na=B._rotation10*G._positionX+B._rotation11*G._positionY+B._rotation12*G._positionZ,oa=B._rotation20*G._positionX+B._rotation21*G._positionY+B._rotation22*G._positionZ,E._positionX=q,E._positionY=na,E._positionZ=oa,E._positionX+=B._positionX,E._positionY+=B._positionY,E._positionZ+=B._positionZ;var aa,T,ca,_a,k,ta;if(I._geom._computeAabb(I._aabb,I._ptransform),aa=I._aabb._minX,T=I._aabb._minY,ca=I._aabb._minZ,_a=I._aabb._maxX,k=I._aabb._maxY,ta=I._aabb._maxZ,I._geom._computeAabb(I._aabb,I._transform),I._aabb._minX=aa<I._aabb._minX?aa:I._aabb._minX,I._aabb._minY=T<I._aabb._minY?T:I._aabb._minY,I._aabb._minZ=ca<I._aabb._minZ?ca:I._aabb._minZ,I._aabb._maxX=_a>I._aabb._maxX?_a:I._aabb._maxX,I._aabb._maxY=k>I._aabb._maxY?k:I._aabb._maxY,I._aabb._maxZ=ta>I._aabb._maxZ?ta:I._aabb._maxZ,I._proxy!=null){var ia,la,va;ia=I._transform._positionX-I._ptransform._positionX,la=I._transform._positionY-I._ptransform._positionY,va=I._transform._positionZ-I._ptransform._positionZ;var xa=I.displacement;xa.x=ia,xa.y=la,xa.z=va,I._rigidBody._world._broadPhase.moveProxy(I._proxy,I._aabb,I.displacement)}I=w}this._sleeping=!1,this._sleepTime=0}getMass(){return this._mass}getLocalInertia(){var a=new x.common.Mat3,t=a;return t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22,a}getLocalInertiaTo(a){var t=a;t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22}getMassData(){var a=new x.dynamics.rigidbody.MassData;a.mass=this._mass;var t=a.localInertia;return t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22,a}getMassDataTo(a){a.mass=this._mass;var t=a.localInertia;t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22}setMassData(a){this._mass=a.mass;var t=a.localInertia;this._localInertia00=t.e00,this._localInertia01=t.e01,this._localInertia02=t.e02,this._localInertia10=t.e10,this._localInertia11=t.e11,this._localInertia12=t.e12,this._localInertia20=t.e20,this._localInertia21=t.e21,this._localInertia22=t.e22;var r=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,i=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,o=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,s=this._localInertia00*r-this._localInertia01*i+this._localInertia02*o;if(this._mass>0&&s>0&&this._type==0){this._invMass=1/this._mass;var _=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,h=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,v=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,e=this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21,l=this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20,u=this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20,b=this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11,f=this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10,n=this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10,c=this._localInertia00*_-this._localInertia01*h+this._localInertia02*v;(c<-1e-32||c>1e-32)&&(c=1/c),this._invLocalInertia00=_*c,this._invLocalInertia01=-e*c,this._invLocalInertia02=b*c,this._invLocalInertia10=-h*c,this._invLocalInertia11=l*c,this._invLocalInertia12=-f*c,this._invLocalInertia20=v*c,this._invLocalInertia21=-u*c,this._invLocalInertia22=n*c,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._type==0&&(this._type=1);var M,m,y,V,z,I,w,X,L;M=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,m=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,y=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,V=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,z=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,I=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,w=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,X=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,L=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=M,this._invInertia01=m,this._invInertia02=y,this._invInertia10=V,this._invInertia11=z,this._invInertia12=I,this._invInertia20=w,this._invInertia21=X,this._invInertia22=L;var p,g,F,S,N,A,Y,R,C;p=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,g=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,F=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,S=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,N=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,A=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,Y=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,R=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,C=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=p,this._invInertia01=g,this._invInertia02=F,this._invInertia10=S,this._invInertia11=N,this._invInertia12=A,this._invInertia20=Y,this._invInertia21=R,this._invInertia22=C,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getRotationFactor(){var a=this._rotFactor;return new x.common.Vec3(a.x,a.y,a.z)}setRotationFactor(a){var t=this._rotFactor;t.x=a.x,t.y=a.y,t.z=a.z;var r,i,o,s,_,h,v,e,l;r=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,i=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,o=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,s=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,_=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,h=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,v=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,e=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=r,this._invInertia01=i,this._invInertia02=o,this._invInertia10=s,this._invInertia11=_,this._invInertia12=h,this._invInertia20=v,this._invInertia21=e,this._invInertia22=l;var u,b,f,n,c,M,m,y,V;u=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,b=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,f=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,n=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,c=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,M=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,m=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,y=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,V=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=u,this._invInertia01=b,this._invInertia02=f,this._invInertia10=n,this._invInertia11=c,this._invInertia12=M,this._invInertia20=m,this._invInertia21=y,this._invInertia22=V,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getLinearVelocity(){var a=new x.common.Vec3,t=a;return t.x=this._velX,t.y=this._velY,t.z=this._velZ,a}getLinearVelocityTo(a){var t=a;t.x=this._velX,t.y=this._velY,t.z=this._velZ}setLinearVelocity(a){if(this._type==1)this._velX=0,this._velY=0,this._velZ=0;else{var t=a;this._velX=t.x,this._velY=t.y,this._velZ=t.z}this._sleeping=!1,this._sleepTime=0}getAngularVelocity(){var a=new x.common.Vec3,t=a;return t.x=this._angVelX,t.y=this._angVelY,t.z=this._angVelZ,a}getAngularVelocityTo(a){var t=a;t.x=this._velX,t.y=this._velY,t.z=this._velZ}setAngularVelocity(a){if(this._type==1)this._angVelX=0,this._angVelY=0,this._angVelZ=0;else{var t=a;this._angVelX=t.x,this._angVelY=t.y,this._angVelZ=t.z}this._sleeping=!1,this._sleepTime=0}addLinearVelocity(a){if(this._type!=1){var t,r,i,o=a;t=o.x,r=o.y,i=o.z,this._velX+=t,this._velY+=r,this._velZ+=i}this._sleeping=!1,this._sleepTime=0}addAngularVelocity(a){if(this._type!=1){var t,r,i,o=a;t=o.x,r=o.y,i=o.z,this._angVelX+=t,this._angVelY+=r,this._angVelZ+=i}this._sleeping=!1,this._sleepTime=0}applyImpulse(a,t){var r,i,o,s=a;r=s.x,i=s.y,o=s.z,this._velX+=r*this._invMass,this._velY+=i*this._invMass,this._velZ+=o*this._invMass;var _,h,v,e,l,u,b=t;e=b.x,l=b.y,u=b.z,e-=this._transform._positionX,l-=this._transform._positionY,u-=this._transform._positionZ,_=l*o-u*i,h=u*r-e*o,v=e*i-l*r;var f,n,c;f=this._invInertia00*_+this._invInertia01*h+this._invInertia02*v,n=this._invInertia10*_+this._invInertia11*h+this._invInertia12*v,c=this._invInertia20*_+this._invInertia21*h+this._invInertia22*v,_=f,h=n,v=c,this._angVelX+=_,this._angVelY+=h,this._angVelZ+=v,this._sleeping=!1,this._sleepTime=0}applyLinearImpulse(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z,this._velX+=t*this._invMass,this._velY+=r*this._invMass,this._velZ+=i*this._invMass,this._sleeping=!1,this._sleepTime=0}applyAngularImpulse(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z;var s,_,h;s=this._invInertia00*t+this._invInertia01*r+this._invInertia02*i,_=this._invInertia10*t+this._invInertia11*r+this._invInertia12*i,h=this._invInertia20*t+this._invInertia21*r+this._invInertia22*i,t=s,r=_,i=h,this._angVelX+=t,this._angVelY+=r,this._angVelZ+=i,this._sleeping=!1,this._sleepTime=0}applyForce(a,t){var r,i,o,s=a;r=s.x,i=s.y,o=s.z,this._forceX+=r,this._forceY+=i,this._forceZ+=o;var _,h,v,e,l,u,b=t;e=b.x,l=b.y,u=b.z,e-=this._transform._positionX,l-=this._transform._positionY,u-=this._transform._positionZ,_=l*o-u*i,h=u*r-e*o,v=e*i-l*r,this._torqueX+=_,this._torqueY+=h,this._torqueZ+=v,this._sleeping=!1,this._sleepTime=0}applyForceToCenter(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z,this._forceX+=t,this._forceY+=r,this._forceZ+=i,this._sleeping=!1,this._sleepTime=0}applyTorque(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z,this._torqueX+=t,this._torqueY+=r,this._torqueZ+=i,this._sleeping=!1,this._sleepTime=0}getLinearContactImpulse(){var a=new x.common.Vec3,t=a;return t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ,a}getLinearContactImpulseTo(a){var t=a;t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ}getAngularContactImpulse(){var a=new x.common.Vec3,t=a;return t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ,a}getAngularContactImpulseTo(a){var t=a;t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ}getGravityScale(){return this._gravityScale}setGravityScale(a){this._gravityScale=a,this._sleeping=!1,this._sleepTime=0}getLocalPoint(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z,t-=this._transform._positionX,r-=this._transform._positionY,i-=this._transform._positionZ;var s,_,h;s=this._transform._rotation00*t+this._transform._rotation10*r+this._transform._rotation20*i,_=this._transform._rotation01*t+this._transform._rotation11*r+this._transform._rotation21*i,h=this._transform._rotation02*t+this._transform._rotation12*r+this._transform._rotation22*i,t=s,r=_,i=h;var v=new x.common.Vec3,e=v;return e.x=t,e.y=r,e.z=i,v}getLocalPointTo(a,t){var r,i,o,s=a;r=s.x,i=s.y,o=s.z,r-=this._transform._positionX,i-=this._transform._positionY,o-=this._transform._positionZ;var _,h,v;_=this._transform._rotation00*r+this._transform._rotation10*i+this._transform._rotation20*o,h=this._transform._rotation01*r+this._transform._rotation11*i+this._transform._rotation21*o,v=this._transform._rotation02*r+this._transform._rotation12*i+this._transform._rotation22*o,r=_,i=h,o=v;var e=t;e.x=r,e.y=i,e.z=o}getLocalVector(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z;var s,_,h;s=this._transform._rotation00*t+this._transform._rotation10*r+this._transform._rotation20*i,_=this._transform._rotation01*t+this._transform._rotation11*r+this._transform._rotation21*i,h=this._transform._rotation02*t+this._transform._rotation12*r+this._transform._rotation22*i,t=s,r=_,i=h;var v=new x.common.Vec3,e=v;return e.x=t,e.y=r,e.z=i,v}getLocalVectorTo(a,t){var r,i,o,s=a;r=s.x,i=s.y,o=s.z;var _,h,v;_=this._transform._rotation00*r+this._transform._rotation10*i+this._transform._rotation20*o,h=this._transform._rotation01*r+this._transform._rotation11*i+this._transform._rotation21*o,v=this._transform._rotation02*r+this._transform._rotation12*i+this._transform._rotation22*o,r=_,i=h,o=v;var e=t;e.x=r,e.y=i,e.z=o}getWorldPoint(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z;var s,_,h;s=this._transform._rotation00*t+this._transform._rotation01*r+this._transform._rotation02*i,_=this._transform._rotation10*t+this._transform._rotation11*r+this._transform._rotation12*i,h=this._transform._rotation20*t+this._transform._rotation21*r+this._transform._rotation22*i,t=s,r=_,i=h,t+=this._transform._positionX,r+=this._transform._positionY,i+=this._transform._positionZ;var v=new x.common.Vec3,e=v;return e.x=t,e.y=r,e.z=i,v}getWorldPointTo(a,t){var r,i,o,s=a;r=s.x,i=s.y,o=s.z;var _,h,v;_=this._transform._rotation00*r+this._transform._rotation01*i+this._transform._rotation02*o,h=this._transform._rotation10*r+this._transform._rotation11*i+this._transform._rotation12*o,v=this._transform._rotation20*r+this._transform._rotation21*i+this._transform._rotation22*o,r=_,i=h,o=v,r+=this._transform._positionX,i+=this._transform._positionY,o+=this._transform._positionZ;var e=t;e.x=r,e.y=i,e.z=o}getWorldVector(a){var t,r,i,o=a;t=o.x,r=o.y,i=o.z;var s,_,h;s=this._transform._rotation00*t+this._transform._rotation01*r+this._transform._rotation02*i,_=this._transform._rotation10*t+this._transform._rotation11*r+this._transform._rotation12*i,h=this._transform._rotation20*t+this._transform._rotation21*r+this._transform._rotation22*i,t=s,r=_,i=h;var v=new x.common.Vec3,e=v;return e.x=t,e.y=r,e.z=i,v}getWorldVectorTo(a,t){var r,i,o,s=a;r=s.x,i=s.y,o=s.z;var _,h,v;_=this._transform._rotation00*r+this._transform._rotation01*i+this._transform._rotation02*o,h=this._transform._rotation10*r+this._transform._rotation11*i+this._transform._rotation12*o,v=this._transform._rotation20*r+this._transform._rotation21*i+this._transform._rotation22*o,r=_,i=h,o=v;var e=t;e.x=r,e.y=i,e.z=o}getNumShapes(){return this._numShapes}getShapeList(){return this._shapeList}getNumContectLinks(){return this._numContactLinks}getContactLinkList(){return this._contactLinkList}getNumJointLinks(){return this._numJointLinks}getJointLinkList(){return this._jointLinkList}addShape(a){if(this._shapeList==null?(this._shapeList=a,this._shapeListLast=a):(this._shapeListLast._next=a,a._prev=this._shapeListLast,this._shapeListLast=a),this._numShapes++,a._rigidBody=this,this._world!=null){var t=this._world;a._proxy=t._broadPhase.createProxy(a,a._aabb),a._id=t._shapeIdCount++,t._numShapes++}this.updateMass();for(var r=this._shapeList;r!=null;){var i=r._next,o=r._ptransform,s=r._localTransform,_=this._ptransform,h,v,e,l,u,b,f,n,c;h=_._rotation00*s._rotation00+_._rotation01*s._rotation10+_._rotation02*s._rotation20,v=_._rotation00*s._rotation01+_._rotation01*s._rotation11+_._rotation02*s._rotation21,e=_._rotation00*s._rotation02+_._rotation01*s._rotation12+_._rotation02*s._rotation22,l=_._rotation10*s._rotation00+_._rotation11*s._rotation10+_._rotation12*s._rotation20,u=_._rotation10*s._rotation01+_._rotation11*s._rotation11+_._rotation12*s._rotation21,b=_._rotation10*s._rotation02+_._rotation11*s._rotation12+_._rotation12*s._rotation22,f=_._rotation20*s._rotation00+_._rotation21*s._rotation10+_._rotation22*s._rotation20,n=_._rotation20*s._rotation01+_._rotation21*s._rotation11+_._rotation22*s._rotation21,c=_._rotation20*s._rotation02+_._rotation21*s._rotation12+_._rotation22*s._rotation22,o._rotation00=h,o._rotation01=v,o._rotation02=e,o._rotation10=l,o._rotation11=u,o._rotation12=b,o._rotation20=f,o._rotation21=n,o._rotation22=c;var M,m,y;M=_._rotation00*s._positionX+_._rotation01*s._positionY+_._rotation02*s._positionZ,m=_._rotation10*s._positionX+_._rotation11*s._positionY+_._rotation12*s._positionZ,y=_._rotation20*s._positionX+_._rotation21*s._positionY+_._rotation22*s._positionZ,o._positionX=M,o._positionY=m,o._positionZ=y,o._positionX+=_._positionX,o._positionY+=_._positionY,o._positionZ+=_._positionZ;var V=r._transform,z=r._localTransform,I=this._transform,w,X,L,p,g,F,S,N,A;w=I._rotation00*z._rotation00+I._rotation01*z._rotation10+I._rotation02*z._rotation20,X=I._rotation00*z._rotation01+I._rotation01*z._rotation11+I._rotation02*z._rotation21,L=I._rotation00*z._rotation02+I._rotation01*z._rotation12+I._rotation02*z._rotation22,p=I._rotation10*z._rotation00+I._rotation11*z._rotation10+I._rotation12*z._rotation20,g=I._rotation10*z._rotation01+I._rotation11*z._rotation11+I._rotation12*z._rotation21,F=I._rotation10*z._rotation02+I._rotation11*z._rotation12+I._rotation12*z._rotation22,S=I._rotation20*z._rotation00+I._rotation21*z._rotation10+I._rotation22*z._rotation20,N=I._rotation20*z._rotation01+I._rotation21*z._rotation11+I._rotation22*z._rotation21,A=I._rotation20*z._rotation02+I._rotation21*z._rotation12+I._rotation22*z._rotation22,V._rotation00=w,V._rotation01=X,V._rotation02=L,V._rotation10=p,V._rotation11=g,V._rotation12=F,V._rotation20=S,V._rotation21=N,V._rotation22=A;var Y,R,C;Y=I._rotation00*z._positionX+I._rotation01*z._positionY+I._rotation02*z._positionZ,R=I._rotation10*z._positionX+I._rotation11*z._positionY+I._rotation12*z._positionZ,C=I._rotation20*z._positionX+I._rotation21*z._positionY+I._rotation22*z._positionZ,V._positionX=Y,V._positionY=R,V._positionZ=C,V._positionX+=I._positionX,V._positionY+=I._positionY,V._positionZ+=I._positionZ;var d,Z,j,H,E,G;if(r._geom._computeAabb(r._aabb,r._ptransform),d=r._aabb._minX,Z=r._aabb._minY,j=r._aabb._minZ,H=r._aabb._maxX,E=r._aabb._maxY,G=r._aabb._maxZ,r._geom._computeAabb(r._aabb,r._transform),r._aabb._minX=d<r._aabb._minX?d:r._aabb._minX,r._aabb._minY=Z<r._aabb._minY?Z:r._aabb._minY,r._aabb._minZ=j<r._aabb._minZ?j:r._aabb._minZ,r._aabb._maxX=H>r._aabb._maxX?H:r._aabb._maxX,r._aabb._maxY=E>r._aabb._maxY?E:r._aabb._maxY,r._aabb._maxZ=G>r._aabb._maxZ?G:r._aabb._maxZ,r._proxy!=null){var B,Q,W;B=r._transform._positionX-r._ptransform._positionX,Q=r._transform._positionY-r._ptransform._positionY,W=r._transform._positionZ-r._ptransform._positionZ;var J=r.displacement;J.x=B,J.y=Q,J.z=W,r._rigidBody._world._broadPhase.moveProxy(r._proxy,r._aabb,r.displacement)}r=i}}removeShape(a){var t=a._prev,r=a._next;if(t!=null&&(t._next=r),r!=null&&(r._prev=t),a==this._shapeList&&(this._shapeList=this._shapeList._next),a==this._shapeListLast&&(this._shapeListLast=this._shapeListLast._prev),a._next=null,a._prev=null,this._numShapes--,a._rigidBody=null,this._world!=null){var i=this._world;i._broadPhase.destroyProxy(a._proxy),a._proxy=null,a._id=-1;for(var o=a._rigidBody._contactLinkList;o!=null;){var s=o._next,_=o._contact;if(_._s1==a||_._s2==a){var h=o._other;h._sleeping=!1,h._sleepTime=0;var v=i._contactManager,e=_._prev,l=_._next;if(e!=null&&(e._next=l),l!=null&&(l._prev=e),_==v._contactList&&(v._contactList=v._contactList._next),_==v._contactListLast&&(v._contactListLast=v._contactListLast._prev),_._next=null,_._prev=null,_._touching){var u=_._s1._contactCallback,b=_._s2._contactCallback;u==b&&(b=null),u?.endContact(_),b?.endContact(_)}var f=_._link1._prev,n=_._link1._next;f!=null&&(f._next=n),n!=null&&(n._prev=f),_._link1==_._b1._contactLinkList&&(_._b1._contactLinkList=_._b1._contactLinkList._next),_._link1==_._b1._contactLinkListLast&&(_._b1._contactLinkListLast=_._b1._contactLinkListLast._prev),_._link1._next=null,_._link1._prev=null;var c=_._link2._prev,M=_._link2._next;c!=null&&(c._next=M),M!=null&&(M._prev=c),_._link2==_._b2._contactLinkList&&(_._b2._contactLinkList=_._b2._contactLinkList._next),_._link2==_._b2._contactLinkListLast&&(_._b2._contactLinkListLast=_._b2._contactLinkListLast._prev),_._link2._next=null,_._link2._prev=null,_._b1._numContactLinks--,_._b2._numContactLinks--,_._link1._other=null,_._link2._other=null,_._link1._contact=null,_._link2._contact=null,_._s1=null,_._s2=null,_._b1=null,_._b2=null,_._touching=!1,_._cachedDetectorData._clear(),_._manifold._clear(),_._detector=null;var m=_._contactConstraint;m._s1=null,m._s2=null,m._b1=null,m._b2=null,m._tf1=null,m._tf2=null,_._next=v._contactPool,v._contactPool=_,v._numContacts--}o=s}i._numShapes--}this.updateMass();for(var y=this._shapeList;y!=null;){var V=y._next,z=y._ptransform,I=y._localTransform,w=this._ptransform,X,L,p,g,F,S,N,A,Y;X=w._rotation00*I._rotation00+w._rotation01*I._rotation10+w._rotation02*I._rotation20,L=w._rotation00*I._rotation01+w._rotation01*I._rotation11+w._rotation02*I._rotation21,p=w._rotation00*I._rotation02+w._rotation01*I._rotation12+w._rotation02*I._rotation22,g=w._rotation10*I._rotation00+w._rotation11*I._rotation10+w._rotation12*I._rotation20,F=w._rotation10*I._rotation01+w._rotation11*I._rotation11+w._rotation12*I._rotation21,S=w._rotation10*I._rotation02+w._rotation11*I._rotation12+w._rotation12*I._rotation22,N=w._rotation20*I._rotation00+w._rotation21*I._rotation10+w._rotation22*I._rotation20,A=w._rotation20*I._rotation01+w._rotation21*I._rotation11+w._rotation22*I._rotation21,Y=w._rotation20*I._rotation02+w._rotation21*I._rotation12+w._rotation22*I._rotation22,z._rotation00=X,z._rotation01=L,z._rotation02=p,z._rotation10=g,z._rotation11=F,z._rotation12=S,z._rotation20=N,z._rotation21=A,z._rotation22=Y;var R,C,d;R=w._rotation00*I._positionX+w._rotation01*I._positionY+w._rotation02*I._positionZ,C=w._rotation10*I._positionX+w._rotation11*I._positionY+w._rotation12*I._positionZ,d=w._rotation20*I._positionX+w._rotation21*I._positionY+w._rotation22*I._positionZ,z._positionX=R,z._positionY=C,z._positionZ=d,z._positionX+=w._positionX,z._positionY+=w._positionY,z._positionZ+=w._positionZ;var Z=y._transform,j=y._localTransform,H=this._transform,E,G,B,Q,W,J,D,O,K;E=H._rotation00*j._rotation00+H._rotation01*j._rotation10+H._rotation02*j._rotation20,G=H._rotation00*j._rotation01+H._rotation01*j._rotation11+H._rotation02*j._rotation21,B=H._rotation00*j._rotation02+H._rotation01*j._rotation12+H._rotation02*j._rotation22,Q=H._rotation10*j._rotation00+H._rotation11*j._rotation10+H._rotation12*j._rotation20,W=H._rotation10*j._rotation01+H._rotation11*j._rotation11+H._rotation12*j._rotation21,J=H._rotation10*j._rotation02+H._rotation11*j._rotation12+H._rotation12*j._rotation22,D=H._rotation20*j._rotation00+H._rotation21*j._rotation10+H._rotation22*j._rotation20,O=H._rotation20*j._rotation01+H._rotation21*j._rotation11+H._rotation22*j._rotation21,K=H._rotation20*j._rotation02+H._rotation21*j._rotation12+H._rotation22*j._rotation22,Z._rotation00=E,Z._rotation01=G,Z._rotation02=B,Z._rotation10=Q,Z._rotation11=W,Z._rotation12=J,Z._rotation20=D,Z._rotation21=O,Z._rotation22=K;var ra,sa,$;ra=H._rotation00*j._positionX+H._rotation01*j._positionY+H._rotation02*j._positionZ,sa=H._rotation10*j._positionX+H._rotation11*j._positionY+H._rotation12*j._positionZ,$=H._rotation20*j._positionX+H._rotation21*j._positionY+H._rotation22*j._positionZ,Z._positionX=ra,Z._positionY=sa,Z._positionZ=$,Z._positionX+=H._positionX,Z._positionY+=H._positionY,Z._positionZ+=H._positionZ;var q,na,oa,aa,T,ca;if(y._geom._computeAabb(y._aabb,y._ptransform),q=y._aabb._minX,na=y._aabb._minY,oa=y._aabb._minZ,aa=y._aabb._maxX,T=y._aabb._maxY,ca=y._aabb._maxZ,y._geom._computeAabb(y._aabb,y._transform),y._aabb._minX=q<y._aabb._minX?q:y._aabb._minX,y._aabb._minY=na<y._aabb._minY?na:y._aabb._minY,y._aabb._minZ=oa<y._aabb._minZ?oa:y._aabb._minZ,y._aabb._maxX=aa>y._aabb._maxX?aa:y._aabb._maxX,y._aabb._maxY=T>y._aabb._maxY?T:y._aabb._maxY,y._aabb._maxZ=ca>y._aabb._maxZ?ca:y._aabb._maxZ,y._proxy!=null){var _a,k,ta;_a=y._transform._positionX-y._ptransform._positionX,k=y._transform._positionY-y._ptransform._positionY,ta=y._transform._positionZ-y._ptransform._positionZ;var ia=y.displacement;ia.x=_a,ia.y=k,ia.z=ta,y._rigidBody._world._broadPhase.moveProxy(y._proxy,y._aabb,y.displacement)}y=V}}getType(){return this._type}setType(a){this._type=a,this.updateMass()}wakeUp(){this._sleeping=!1,this._sleepTime=0}sleep(){this._sleeping=!0,this._sleepTime=0}isSleeping(){return this._sleeping}getSleepTime(){return this._sleepTime}setAutoSleep(a){this._autoSleep=a,this._sleeping=!1,this._sleepTime=0}getLinearDamping(){return this._linearDamping}setLinearDamping(a){this._linearDamping=a}getAngularDamping(){return this._angularDamping}setAngularDamping(a){this._angularDamping=a}getPrev(){return this._prev}getNext(){return this._next}};x.dynamics.rigidbody.RigidBodyConfig=class{constructor(){this.position=new x.common.Vec3,this.rotation=new x.common.Mat3,this.linearVelocity=new x.common.Vec3,this.angularVelocity=new x.common.Vec3,this.type=0,this.autoSleep=!0,this.linearDamping=0,this.angularDamping=0}};x.dynamics.rigidbody.RigidBodyType=class{};x.dynamics.rigidbody.Shape=class{constructor(a){this._id=-1,this._localTransform=new x.common.Transform,this._ptransform=new x.common.Transform,this._transform=new x.common.Transform;var t=a.position;this._localTransform._positionX=t.x,this._localTransform._positionY=t.y,this._localTransform._positionZ=t.z;var r=a.rotation;this._localTransform._rotation00=r.e00,this._localTransform._rotation01=r.e01,this._localTransform._rotation02=r.e02,this._localTransform._rotation10=r.e10,this._localTransform._rotation11=r.e11,this._localTransform._rotation12=r.e12,this._localTransform._rotation20=r.e20,this._localTransform._rotation21=r.e21,this._localTransform._rotation22=r.e22;var i=this._ptransform,o=this._localTransform;i._positionX=o._positionX,i._positionY=o._positionY,i._positionZ=o._positionZ,i._rotation00=o._rotation00,i._rotation01=o._rotation01,i._rotation02=o._rotation02,i._rotation10=o._rotation10,i._rotation11=o._rotation11,i._rotation12=o._rotation12,i._rotation20=o._rotation20,i._rotation21=o._rotation21,i._rotation22=o._rotation22;var s=this._transform,_=this._localTransform;s._positionX=_._positionX,s._positionY=_._positionY,s._positionZ=_._positionZ,s._rotation00=_._rotation00,s._rotation01=_._rotation01,s._rotation02=_._rotation02,s._rotation10=_._rotation10,s._rotation11=_._rotation11,s._rotation12=_._rotation12,s._rotation20=_._rotation20,s._rotation21=_._rotation21,s._rotation22=_._rotation22,this._restitution=a.restitution,this._friction=a.friction,this._density=a.density,this._geom=a.geometry,this._collisionGroup=a.collisionGroup,this._collisionMask=a.collisionMask,this._contactCallback=a.contactCallback,this._aabb=new x.collision.geometry.Aabb,this._proxy=null,this.displacement=new x.common.Vec3}getFriction(){return this._friction}setFriction(a){this._friction=a}getRestitution(){return this._restitution}setRestitution(a){this._restitution=a}getLocalTransform(){var a=this._localTransform,t=new x.common.Transform;return t._positionX=a._positionX,t._positionY=a._positionY,t._positionZ=a._positionZ,t._rotation00=a._rotation00,t._rotation01=a._rotation01,t._rotation02=a._rotation02,t._rotation10=a._rotation10,t._rotation11=a._rotation11,t._rotation12=a._rotation12,t._rotation20=a._rotation20,t._rotation21=a._rotation21,t._rotation22=a._rotation22,t}getLocalTransformTo(a){var t=this._localTransform;a._positionX=t._positionX,a._positionY=t._positionY,a._positionZ=t._positionZ,a._rotation00=t._rotation00,a._rotation01=t._rotation01,a._rotation02=t._rotation02,a._rotation10=t._rotation10,a._rotation11=t._rotation11,a._rotation12=t._rotation12,a._rotation20=t._rotation20,a._rotation21=t._rotation21,a._rotation22=t._rotation22}getTransform(){var a=this._transform,t=new x.common.Transform;return t._positionX=a._positionX,t._positionY=a._positionY,t._positionZ=a._positionZ,t._rotation00=a._rotation00,t._rotation01=a._rotation01,t._rotation02=a._rotation02,t._rotation10=a._rotation10,t._rotation11=a._rotation11,t._rotation12=a._rotation12,t._rotation20=a._rotation20,t._rotation21=a._rotation21,t._rotation22=a._rotation22,t}getTransformTo(a){var t=this._transform;a._positionX=t._positionX,a._positionY=t._positionY,a._positionZ=t._positionZ,a._rotation00=t._rotation00,a._rotation01=t._rotation01,a._rotation02=t._rotation02,a._rotation10=t._rotation10,a._rotation11=t._rotation11,a._rotation12=t._rotation12,a._rotation20=t._rotation20,a._rotation21=t._rotation21,a._rotation22=t._rotation22}setLocalTransform(a){var t=this._localTransform;if(t._positionX=a._positionX,t._positionY=a._positionY,t._positionZ=a._positionZ,t._rotation00=a._rotation00,t._rotation01=a._rotation01,t._rotation02=a._rotation02,t._rotation10=a._rotation10,t._rotation11=a._rotation11,t._rotation12=a._rotation12,t._rotation20=a._rotation20,t._rotation21=a._rotation21,t._rotation22=a._rotation22,this._rigidBody!=null){var r=this._rigidBody;r.updateMass();for(var i=r._shapeList;i!=null;){var o=i._next,s=i._ptransform,_=i._localTransform,h=r._ptransform,v,e,l,u,b,f,n,c,M;v=h._rotation00*_._rotation00+h._rotation01*_._rotation10+h._rotation02*_._rotation20,e=h._rotation00*_._rotation01+h._rotation01*_._rotation11+h._rotation02*_._rotation21,l=h._rotation00*_._rotation02+h._rotation01*_._rotation12+h._rotation02*_._rotation22,u=h._rotation10*_._rotation00+h._rotation11*_._rotation10+h._rotation12*_._rotation20,b=h._rotation10*_._rotation01+h._rotation11*_._rotation11+h._rotation12*_._rotation21,f=h._rotation10*_._rotation02+h._rotation11*_._rotation12+h._rotation12*_._rotation22,n=h._rotation20*_._rotation00+h._rotation21*_._rotation10+h._rotation22*_._rotation20,c=h._rotation20*_._rotation01+h._rotation21*_._rotation11+h._rotation22*_._rotation21,M=h._rotation20*_._rotation02+h._rotation21*_._rotation12+h._rotation22*_._rotation22,s._rotation00=v,s._rotation01=e,s._rotation02=l,s._rotation10=u,s._rotation11=b,s._rotation12=f,s._rotation20=n,s._rotation21=c,s._rotation22=M;var m,y,V;m=h._rotation00*_._positionX+h._rotation01*_._positionY+h._rotation02*_._positionZ,y=h._rotation10*_._positionX+h._rotation11*_._positionY+h._rotation12*_._positionZ,V=h._rotation20*_._positionX+h._rotation21*_._positionY+h._rotation22*_._positionZ,s._positionX=m,s._positionY=y,s._positionZ=V,s._positionX+=h._positionX,s._positionY+=h._positionY,s._positionZ+=h._positionZ;var z=i._transform,I=i._localTransform,w=r._transform,X,L,p,g,F,S,N,A,Y;X=w._rotation00*I._rotation00+w._rotation01*I._rotation10+w._rotation02*I._rotation20,L=w._rotation00*I._rotation01+w._rotation01*I._rotation11+w._rotation02*I._rotation21,p=w._rotation00*I._rotation02+w._rotation01*I._rotation12+w._rotation02*I._rotation22,g=w._rotation10*I._rotation00+w._rotation11*I._rotation10+w._rotation12*I._rotation20,F=w._rotation10*I._rotation01+w._rotation11*I._rotation11+w._rotation12*I._rotation21,S=w._rotation10*I._rotation02+w._rotation11*I._rotation12+w._rotation12*I._rotation22,N=w._rotation20*I._rotation00+w._rotation21*I._rotation10+w._rotation22*I._rotation20,A=w._rotation20*I._rotation01+w._rotation21*I._rotation11+w._rotation22*I._rotation21,Y=w._rotation20*I._rotation02+w._rotation21*I._rotation12+w._rotation22*I._rotation22,z._rotation00=X,z._rotation01=L,z._rotation02=p,z._rotation10=g,z._rotation11=F,z._rotation12=S,z._rotation20=N,z._rotation21=A,z._rotation22=Y;var R,C,d;R=w._rotation00*I._positionX+w._rotation01*I._positionY+w._rotation02*I._positionZ,C=w._rotation10*I._positionX+w._rotation11*I._positionY+w._rotation12*I._positionZ,d=w._rotation20*I._positionX+w._rotation21*I._positionY+w._rotation22*I._positionZ,z._positionX=R,z._positionY=C,z._positionZ=d,z._positionX+=w._positionX,z._positionY+=w._positionY,z._positionZ+=w._positionZ;var Z,j,H,E,G,B;if(i._geom._computeAabb(i._aabb,i._ptransform),Z=i._aabb._minX,j=i._aabb._minY,H=i._aabb._minZ,E=i._aabb._maxX,G=i._aabb._maxY,B=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=Z<i._aabb._minX?Z:i._aabb._minX,i._aabb._minY=j<i._aabb._minY?j:i._aabb._minY,i._aabb._minZ=H<i._aabb._minZ?H:i._aabb._minZ,i._aabb._maxX=E>i._aabb._maxX?E:i._aabb._maxX,i._aabb._maxY=G>i._aabb._maxY?G:i._aabb._maxY,i._aabb._maxZ=B>i._aabb._maxZ?B:i._aabb._maxZ,i._proxy!=null){var Q,W,J;Q=i._transform._positionX-i._ptransform._positionX,W=i._transform._positionY-i._ptransform._positionY,J=i._transform._positionZ-i._ptransform._positionZ;var D=i.displacement;D.x=Q,D.y=W,D.z=J,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=o}}}getDensity(){return this._density}setDensity(a){if(this._density=a,this._rigidBody!=null){var t=this._rigidBody;t.updateMass();for(var r=t._shapeList;r!=null;){var i=r._next,o=r._ptransform,s=r._localTransform,_=t._ptransform,h,v,e,l,u,b,f,n,c;h=_._rotation00*s._rotation00+_._rotation01*s._rotation10+_._rotation02*s._rotation20,v=_._rotation00*s._rotation01+_._rotation01*s._rotation11+_._rotation02*s._rotation21,e=_._rotation00*s._rotation02+_._rotation01*s._rotation12+_._rotation02*s._rotation22,l=_._rotation10*s._rotation00+_._rotation11*s._rotation10+_._rotation12*s._rotation20,u=_._rotation10*s._rotation01+_._rotation11*s._rotation11+_._rotation12*s._rotation21,b=_._rotation10*s._rotation02+_._rotation11*s._rotation12+_._rotation12*s._rotation22,f=_._rotation20*s._rotation00+_._rotation21*s._rotation10+_._rotation22*s._rotation20,n=_._rotation20*s._rotation01+_._rotation21*s._rotation11+_._rotation22*s._rotation21,c=_._rotation20*s._rotation02+_._rotation21*s._rotation12+_._rotation22*s._rotation22,o._rotation00=h,o._rotation01=v,o._rotation02=e,o._rotation10=l,o._rotation11=u,o._rotation12=b,o._rotation20=f,o._rotation21=n,o._rotation22=c;var M,m,y;M=_._rotation00*s._positionX+_._rotation01*s._positionY+_._rotation02*s._positionZ,m=_._rotation10*s._positionX+_._rotation11*s._positionY+_._rotation12*s._positionZ,y=_._rotation20*s._positionX+_._rotation21*s._positionY+_._rotation22*s._positionZ,o._positionX=M,o._positionY=m,o._positionZ=y,o._positionX+=_._positionX,o._positionY+=_._positionY,o._positionZ+=_._positionZ;var V=r._transform,z=r._localTransform,I=t._transform,w,X,L,p,g,F,S,N,A;w=I._rotation00*z._rotation00+I._rotation01*z._rotation10+I._rotation02*z._rotation20,X=I._rotation00*z._rotation01+I._rotation01*z._rotation11+I._rotation02*z._rotation21,L=I._rotation00*z._rotation02+I._rotation01*z._rotation12+I._rotation02*z._rotation22,p=I._rotation10*z._rotation00+I._rotation11*z._rotation10+I._rotation12*z._rotation20,g=I._rotation10*z._rotation01+I._rotation11*z._rotation11+I._rotation12*z._rotation21,F=I._rotation10*z._rotation02+I._rotation11*z._rotation12+I._rotation12*z._rotation22,S=I._rotation20*z._rotation00+I._rotation21*z._rotation10+I._rotation22*z._rotation20,N=I._rotation20*z._rotation01+I._rotation21*z._rotation11+I._rotation22*z._rotation21,A=I._rotation20*z._rotation02+I._rotation21*z._rotation12+I._rotation22*z._rotation22,V._rotation00=w,V._rotation01=X,V._rotation02=L,V._rotation10=p,V._rotation11=g,V._rotation12=F,V._rotation20=S,V._rotation21=N,V._rotation22=A;var Y,R,C;Y=I._rotation00*z._positionX+I._rotation01*z._positionY+I._rotation02*z._positionZ,R=I._rotation10*z._positionX+I._rotation11*z._positionY+I._rotation12*z._positionZ,C=I._rotation20*z._positionX+I._rotation21*z._positionY+I._rotation22*z._positionZ,V._positionX=Y,V._positionY=R,V._positionZ=C,V._positionX+=I._positionX,V._positionY+=I._positionY,V._positionZ+=I._positionZ;var d,Z,j,H,E,G;if(r._geom._computeAabb(r._aabb,r._ptransform),d=r._aabb._minX,Z=r._aabb._minY,j=r._aabb._minZ,H=r._aabb._maxX,E=r._aabb._maxY,G=r._aabb._maxZ,r._geom._computeAabb(r._aabb,r._transform),r._aabb._minX=d<r._aabb._minX?d:r._aabb._minX,r._aabb._minY=Z<r._aabb._minY?Z:r._aabb._minY,r._aabb._minZ=j<r._aabb._minZ?j:r._aabb._minZ,r._aabb._maxX=H>r._aabb._maxX?H:r._aabb._maxX,r._aabb._maxY=E>r._aabb._maxY?E:r._aabb._maxY,r._aabb._maxZ=G>r._aabb._maxZ?G:r._aabb._maxZ,r._proxy!=null){var B,Q,W;B=r._transform._positionX-r._ptransform._positionX,Q=r._transform._positionY-r._ptransform._positionY,W=r._transform._positionZ-r._ptransform._positionZ;var J=r.displacement;J.x=B,J.y=Q,J.z=W,r._rigidBody._world._broadPhase.moveProxy(r._proxy,r._aabb,r.displacement)}r=i}}}getAabb(){return this._aabb.clone()}getAabbTo(a){a.copyFrom(this._aabb)}getGeometry(){return this._geom}getRigidBody(){return this._rigidBody}getCollisionGroup(){return this._collisionGroup}setCollisionGroup(a){this._collisionGroup=a}getCollisionMask(){return this._collisionMask}setCollisionMask(a){this._collisionMask=a}getContactCallback(){return this._contactCallback}setContactCallback(a){this._contactCallback=a}getPrev(){return this._prev}getNext(){return this._next}};x.dynamics.rigidbody.ShapeConfig=class{constructor(){this.position=new x.common.Vec3,this.rotation=new x.common.Mat3,this.friction=x.common.Setting.defaultFriction,this.restitution=x.common.Setting.defaultRestitution,this.density=x.common.Setting.defaultDensity,this.collisionGroup=x.common.Setting.defaultCollisionGroup,this.collisionMask=x.common.Setting.defaultCollisionMask,this.geometry=null,this.contactCallback=null}};x.m||(x.m={});x.m.M=class{};x.collision.broadphase.BroadPhaseType._BRUTE_FORCE=1;x.collision.broadphase.BroadPhaseType._BVH=2;x.collision.broadphase.BroadPhaseType.BRUTE_FORCE=1;x.collision.broadphase.BroadPhaseType.BVH=2;x.collision.broadphase.bvh.BvhInsertionStrategy.SIMPLE=0;x.collision.broadphase.bvh.BvhInsertionStrategy.MINIMIZE_SURFACE_AREA=1;x.collision.geometry.GeometryType._SPHERE=0;x.collision.geometry.GeometryType._BOX=1;x.collision.geometry.GeometryType._CYLINDER=2;x.collision.geometry.GeometryType._CONE=3;x.collision.geometry.GeometryType._CAPSULE=4;x.collision.geometry.GeometryType._CONVEX_HULL=5;x.collision.geometry.GeometryType._CONVEX_MIN=0;x.collision.geometry.GeometryType._CONVEX_MAX=5;x.collision.geometry.GeometryType.SPHERE=0;x.collision.geometry.GeometryType.BOX=1;x.collision.geometry.GeometryType.CYLINDER=2;x.collision.geometry.GeometryType.CONE=3;x.collision.geometry.GeometryType.CAPSULE=4;x.collision.geometry.GeometryType.CONVEX_HULL=5;x.collision.narrowphase.detector.BoxBoxDetector.EDGE_BIAS_MULT=1;x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.OK=0;x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.INVALID_TRIANGLE=1;x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_PAIR_INDEX=2;x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_TRIANGLE=3;x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.EDGE_LOOP_BROKEN=4;x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_OUTER_TRIANGLE=5;x.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.TRIANGLE_INVISIBLE=6;x.collision.narrowphase.detector.gjkepa.EpaTriangle.count=0;x.common.Vec3.numCreations=0;x.common.Setting.defaultFriction=.2;x.common.Setting.defaultRestitution=.2;x.common.Setting.defaultDensity=1;x.common.Setting.defaultCollisionGroup=1;x.common.Setting.defaultCollisionMask=1;x.common.Setting.maxTranslationPerStep=20;x.common.Setting.maxRotationPerStep=3.14159265358979;x.common.Setting.bvhProxyPadding=.1;x.common.Setting.bvhIncrementalCollisionThreshold=.45;x.common.Setting.defaultGJKMargin=.05;x.common.Setting.enableGJKCaching=!0;x.common.Setting.maxEPAVertices=128;x.common.Setting.maxEPAPolyhedronFaces=128;x.common.Setting.contactEnableBounceThreshold=.5;x.common.Setting.velocityBaumgarte=.2;x.common.Setting.positionSplitImpulseBaumgarte=.4;x.common.Setting.positionNgsBaumgarte=1;x.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold=.05;x.common.Setting.defaultContactPositionCorrectionAlgorithm=0;x.common.Setting.alternativeContactPositionCorrectionAlgorithm=1;x.common.Setting.contactPersistenceThreshold=.05;x.common.Setting.maxManifoldPoints=4;x.common.Setting.defaultJointConstraintSolverType=0;x.common.Setting.defaultJointPositionCorrectionAlgorithm=0;x.common.Setting.jointWarmStartingFactorForBaungarte=.8;x.common.Setting.jointWarmStartingFactor=.95;x.common.Setting.minSpringDamperDampingRatio=1e-6;x.common.Setting.minRagdollMaxSwingAngle=1e-6;x.common.Setting.maxJacobianRows=6;x.common.Setting.directMlcpSolverEps=1e-9;x.common.Setting.islandInitialRigidBodyArraySize=128;x.common.Setting.islandInitialConstraintArraySize=128;x.common.Setting.sleepingVelocityThreshold=.2;x.common.Setting.sleepingAngularVelocityThreshold=.5;x.common.Setting.sleepingTimeThreshold=1;x.common.Setting.disableSleeping=!1;x.common.Setting.linearSlop=.005;x.common.Setting.angularSlop=.017453292519943278;x.collision.narrowphase.detector.gjkepa.GjkEpa.instance=new x.collision.narrowphase.detector.gjkepa.GjkEpa;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState._SUCCEEDED=0;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_FAILED_TO_MAKE_TETRAHEDRON=1;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_DID_NOT_CONVERGE=2;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_INIT=257;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_ADD_VERTEX=258;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_DID_NOT_CONVERGE=259;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED=0;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_FAILED_TO_MAKE_TETRAHEDRON=1;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_DID_NOT_CONVERGE=2;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT=257;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX=258;x.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE=259;x.common.Mat3.numCreations=0;x.common.Mat4.numCreations=0;x.common.MathUtil.POSITIVE_INFINITY=1/0;x.common.MathUtil.NEGATIVE_INFINITY=-1/0;x.common.MathUtil.PI=3.14159265358979;x.common.MathUtil.TWO_PI=6.28318530717958;x.common.MathUtil.HALF_PI=1.570796326794895;x.common.MathUtil.TO_RADIANS=.017453292519943278;x.common.MathUtil.TO_DEGREES=57.29577951308238;x.common.Quat.numCreations=0;x.dynamics.common.DebugDraw.SPHERE_PHI_DIVISION=8;x.dynamics.common.DebugDraw.SPHERE_THETA_DIVISION=4;x.dynamics.common.DebugDraw.CIRCLE_THETA_DIVISION=8;x.dynamics.common.Performance.broadPhaseCollisionTime=0;x.dynamics.common.Performance.narrowPhaseCollisionTime=0;x.dynamics.common.Performance.dynamicsTime=0;x.dynamics.common.Performance.totalTime=0;x.dynamics.constraint.PositionCorrectionAlgorithm._BAUMGARTE=0;x.dynamics.constraint.PositionCorrectionAlgorithm._SPLIT_IMPULSE=1;x.dynamics.constraint.PositionCorrectionAlgorithm._NGS=2;x.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE=0;x.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE=1;x.dynamics.constraint.PositionCorrectionAlgorithm.NGS=2;x.dynamics.constraint.info.JacobianRow.BIT_LINEAR_SET=1;x.dynamics.constraint.info.JacobianRow.BIT_ANGULAR_SET=2;x.dynamics.constraint.joint.JointType._SPHERICAL=0;x.dynamics.constraint.joint.JointType._REVOLUTE=1;x.dynamics.constraint.joint.JointType._CYLINDRICAL=2;x.dynamics.constraint.joint.JointType._PRISMATIC=3;x.dynamics.constraint.joint.JointType._UNIVERSAL=4;x.dynamics.constraint.joint.JointType._RAGDOLL=5;x.dynamics.constraint.joint.JointType._GENERIC=6;x.dynamics.constraint.joint.JointType.SPHERICAL=0;x.dynamics.constraint.joint.JointType.REVOLUTE=1;x.dynamics.constraint.joint.JointType.CYLINDRICAL=2;x.dynamics.constraint.joint.JointType.PRISMATIC=3;x.dynamics.constraint.joint.JointType.UNIVERSAL=4;x.dynamics.constraint.joint.JointType.RAGDOLL=5;x.dynamics.constraint.joint.JointType.GENERIC=6;x.dynamics.constraint.solver.ConstraintSolverType._ITERATIVE=0;x.dynamics.constraint.solver.ConstraintSolverType._DIRECT=1;x.dynamics.constraint.solver.ConstraintSolverType.ITERATIVE=0;x.dynamics.constraint.solver.ConstraintSolverType.DIRECT=1;x.dynamics.rigidbody.RigidBodyType._DYNAMIC=0;x.dynamics.rigidbody.RigidBodyType._STATIC=1;x.dynamics.rigidbody.RigidBodyType._KINEMATIC=2;x.dynamics.rigidbody.RigidBodyType.DYNAMIC=0;x.dynamics.rigidbody.RigidBodyType.STATIC=1;x.dynamics.rigidbody.RigidBodyType.KINEMATIC=2;const{Group:MI,Matrix4:zI,Vector3:mI}=await di("three");x.dynamics.World;x.dynamics.rigidbody.RigidBodyType;x.dynamics.rigidbody.RigidBodyConfig;x.dynamics.rigidbody.RigidBody;x.dynamics.rigidbody.ShapeConfig;x.dynamics.rigidbody.Shape;x.dynamics.constraint.joint.SphericalJointConfig;x.dynamics.constraint.joint.SphericalJoint;x.dynamics.constraint.joint.RevoluteJointConfig;x.dynamics.constraint.joint.RevoluteJoint;x.dynamics.constraint.joint.CylindricalJointConfig;x.dynamics.constraint.joint.CylindricalJoint;x.dynamics.constraint.joint.PrismaticJointConfig;x.dynamics.constraint.joint.PrismaticJoint;x.dynamics.constraint.joint.UniversalJointConfig;x.dynamics.constraint.joint.UniversalJoint;x.dynamics.constraint.joint.RagdollJointConfig;x.dynamics.constraint.joint.RagdollJoint;x.dynamics.constraint.joint.GenericJointConfig;x.dynamics.constraint.joint.GenericJoint;x.dynamics.constraint.joint.JointConfig;x.dynamics.constraint.joint.Joint;x.dynamics.constraint.joint.SpringDamper;x.dynamics.constraint.joint.TranslationalLimitMotor;x.dynamics.constraint.joint.RotationalLimitMotor;x.common.Vec3;x.common.Quat;x.common.Mat3;x.common.MathUtil;x.common.Transform;const cm=x.common.Setting;x.collision.geometry.BoxGeometry;x.collision.geometry.SphereGeometry;x.collision.geometry.ConeGeometry;x.collision.geometry.CylinderGeometry;x.collision.geometry.CapsuleGeometry;x.collision.geometry.ConvexHullGeometry;x.collision.geometry.Geometry;x.dynamics.callback.RayCastClosest;x.dynamics.callback.ContactCallback;cm.defaultGJKMargin=1e-4;x.dynamics.World;x.dynamics.rigidbody.RigidBodyType;x.dynamics.rigidbody.RigidBodyConfig;x.dynamics.rigidbody.RigidBody;x.dynamics.rigidbody.ShapeConfig;x.dynamics.rigidbody.Shape;x.dynamics.constraint.joint.SphericalJointConfig;x.dynamics.constraint.joint.SphericalJoint;x.dynamics.constraint.joint.RevoluteJointConfig;x.dynamics.constraint.joint.RevoluteJoint;x.dynamics.constraint.joint.CylindricalJointConfig;x.dynamics.constraint.joint.CylindricalJoint;x.dynamics.constraint.joint.PrismaticJointConfig;x.dynamics.constraint.joint.PrismaticJoint;x.dynamics.constraint.joint.UniversalJointConfig;x.dynamics.constraint.joint.UniversalJoint;x.dynamics.constraint.joint.RagdollJointConfig;x.dynamics.constraint.joint.RagdollJoint;x.dynamics.constraint.joint.GenericJointConfig;x.dynamics.constraint.joint.GenericJoint;x.dynamics.constraint.joint.Joint;x.common.Vec3;x.common.Quat;const bm=x.common.Setting;x.collision.geometry.BoxGeometry;x.collision.geometry.SphereGeometry;x.collision.geometry.ConeGeometry;x.collision.geometry.CylinderGeometry;x.collision.geometry.CapsuleGeometry;x.collision.geometry.ConvexHullGeometry;x.dynamics.callback.ContactCallback;bm.defaultGJKMargin=1e-4;const{Group:pI,MathUtils:yI,Matrix4:gI}=await di("three");export{jy as Reflector,hy as ReflectorDudvMaterial,ly as ReflectorMaterial};
