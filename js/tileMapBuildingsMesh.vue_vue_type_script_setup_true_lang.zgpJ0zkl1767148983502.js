import{importShared as m,Ai as b}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{Fs as v,_l as _}from"./index.DTe2qqjO1767148983502.js";import{B as C}from"./three-custom-shader-material.es.DIiohWIA1767148983502.js";import{buildingsShaderMaterial_default as M,buildingsShaderMaterial_default$1 as E}from"./tilesCom.vue_vue_type_script_setup_true_lang.CaSzr89Z1767148983502.js";import{LineSegmentsGeometry as S,LineMaterial as T,LineSegments2 as z}from"./LineSegments2.BWdpcsAi1767148983502.js";import{OrbitControls as P}from"./OrbitControls.CSbAbrSE1767148983502.js";import{UTM as $,PlaneProvider as k,MapProvider as V,TerrainMeshProvider as j,Map as D}from"./TerrainMeshProvider.DkO8ghB01767148983502.js";const f=await m("three"),L=(r,n)=>{const e=new f.Quaternion,s=new f.Vector3().crossVectors(r,n);return e.x=s.x,e.y=s.y,e.z=s.z,e.w=1+r.clone().dot(n),e.normalize(),e},R=r=>{r.onLoadTileSet=n=>{const e=new f.Box3,s=new f.Sphere,o=new f.Matrix4;let p=null,c=0;r.getOrientedBounds(e,o)?(p=new f.Vector3().setFromMatrixPosition(o),c=p.length()):r.getBoundingSphere(s)&&(p=s.center.clone(),c=p.length());const u=p?.normalize(),a=new f.Vector3(0,1,0),t=L(u,a);r.group.quaternion.x=t.x,r.group.quaternion.y=t.y,r.group.quaternion.z=t.z,r.group.quaternion.w=t.w,r.group.position.z=-c}},{defineComponent:W}=await m("vue"),{unref:q,createElementVNode:F,openBlock:G,createElementBlock:H}=await m("vue"),N=["object","rotation"],{watchEffect:O,ref:Z}=await m("vue"),d=await m("three"),ae=W({__name:"tilesBuildings",props:{bulidingsColor:{default:"#e523ff"},topColor:{default:"#ffff00"},opacity:{default:.8},gradient:{type:Boolean,default:!0},camera:{}},setup(r){const n=r,e=Z(0),s=a=>{const{geometry:t}=a;t.computeBoundingBox(),t.computeBoundingSphere();const{max:i,min:l}=t.boundingBox,g=new C({baseMaterial:new d.MeshPhongMaterial,vertexShader:E,fragmentShader:M,silent:!0,uniforms:{uMax:{value:i},uMin:{value:l},uBorderWidth:{value:5},uCircleTime:{value:5},uColor:{value:new d.Color(n.bulidingsColor)},uOpacity:{value:n.opacity},uLightColor:{value:new d.Color("#ffffff")},uTopColor:{value:new d.Color(n.topColor)},uTime:e,uGradient:{value:n.gradient}},depthWrite:!0,depthTest:!0,transparent:!0,side:d.DoubleSide});a.material.dispose(),a.material=g},o=new b("https://jdvop.oss-cn-qingdao.aliyuncs.com/mapv-data/titleset/sz_ns/no.json");o.errorTarget=2,o.addEventListener("load-model",({scene:a})=>{a.traverse(l=>{if(l.isMesh){s(l),l.receiveShadow=!1,l.castShadow=!1;const g=new d.EdgesGeometry(l.geometry.clone());let y=new S().fromEdgesGeometry(g),h=new T({color:0,linewidth:1,opacity:1,transparent:!0,depthWrite:!0,depthTest:!0});h.resolution.set(window.innerWidth,window.innerHeight);const x=new z(y,h);x.applyMatrix4(l.matrix.clone()),l.parent.add(x)}});const t=new d.Box3,i=new d.Sphere;o.getBoundingBox(t)?(t.getCenter(o.group.position),o.group.position.multiplyScalar(-1)):o.getBoundingSphere(i)&&(o.group.position.copy(i.center),o.group.position.multiplyScalar(-1))}),R(o);const{renderer:p,sizes:c}=v();O(()=>{c.width.value&&(o.setCamera(n.camera),o.setResolutionFromRenderer(n.camera,p))});const{onBeforeRender:u}=_();return u(({delta:a})=>{e.value+=a*2,n.camera&&c.width.value&&(n.camera.updateMatrixWorld(),o.update())}),(a,t)=>(G(),H("TresGroup",null,[F("primitive",{object:q(o).group,rotation:[-Math.PI/2,0,0]},null,8,N)]))}}),{defineComponent:A}=await m("vue"),{unref:I,openBlock:Q,createElementBlock:U}=await m("vue"),J=["object","rotation"],w=await m("three"),{watchEffect:K}=await m("vue"),ie=A({__name:"tileMapBuildingsMesh",props:{bbox:{default:[104.955976,20.149765,120.998419,30.528687]},maxZoom:{default:20},mapCenter:{},camera:{}},setup(r,{expose:n}){const e=r,{renderer:s,scene:o}=v(),p=new k;p.coordType=$;const c=new V;c.source="https://webrd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",c.showTileNo=!1,c.useWorker=!0;const u=new j(p,c);u.showBoundingBox=!1,u.wireframe=!1,u.flatShading=!1,u.filter={opposite:!0,genBright:1.3,genContrast:1,genSaturation:1};let a=new w.Color("#4688b5");u.filter.monochrome={r:a.r,g:a.g,b:a.b};const t=new D;t.provider=u,t.bbox=e.bbox,t.maxZoom=e.maxZoom,e.camera.up=new w.Vector3(0,1,0),e.camera.position.set(e.mapCenter[0],e.mapCenter[2],-e.mapCenter[1]+2e3),e.camera.lookAt(new w.Vector3(e.camera.position.x,0,e.camera.position.z-3e3)),t.camera=e.camera;let i=null;K(()=>{s&&(i=new P(e.camera,s.domElement),i.enableDamping=!0,i.dampingFactor=.05,i.minDistance=600,i.position0.set(e.camera.position.x,e.camera.position.y,e.camera.position.z),i.target.set(e.camera.position.x,0,e.camera.position.z-2e3))});const{onBeforeRender:l}=_();return l(()=>{if(s){const g=Math.abs(e.camera.position.y)*50;e.camera.far=g+5e3,e.camera.updateProjectionMatrix(),i&&(i.update(),i.target.y=0),t.update(),s.render(o.value,e.camera)}}),n({camera:e.camera,map:t}),(g,B)=>(Q(),U("primitive",{object:I(t),rotation:[-Math.PI/2,0,0]},null,8,J))}});export{ae as _sfc_main,ie as _sfc_main$1};
