import{_ as t}from"./index.peLcCKiz1739442316051.js";import{_ as n,o as e,a0 as r,r as o,V as i,b as a,C as c}from"./three.OosFxi571739442316051.js";import{m as s,e as l,a as u,D as f,o as p}from"./@tresjs.4XV_x0mI1739442316051.js";import{_ as v}from"./whiteFloorMesh.vue_vue_type_script_setup_true_lang.HGLG62Bn1739442316051.js";import{_ as d}from"./skyBoxAmesh.vue_vue_type_script_setup_true_lang.3JnXiutx1739442316051.js";import{P as m}from"./tweakpane.yDiyAAkA1739442316051.js";import{d as h,a3 as x,a2 as g,w as y,o as w,H as b,u as C,r as S,e as _,j as P,g as F,N as I,f as z,al as D,aj as j,ak as k,m as N,F as E}from"./@vue.NRI7TcgI1739442316051.js";import"./index.0OIxWh-r1739442316051.js";import"./@fesjs.DgjXCZoG1739442316051.js";import"./vue-router.bqZmV3c61739442316051.js";import"./lodash-es.pklfUAS51739442316051.js";import"./@qlin.yHhFDldE1739442316051.js";import"./pinia.ptJyy4pp1739442316051.js";import"./@floating-ui.BPbuo5Gx1739442316051.js";import"./@juggle.7yjBMqoW1739442316051.js";import"./chalk.9FGrMJNn1739442316051.js";/* empty css                                 */import"./iconify-icon.BVOVpC8G1739442316051.js";import"./@iconify.dt4P0LGS1739442316051.js";import"./dompurify.rQUea5mq1739442316051.js";import"./@vueuse.u4XqlOuT1739442316051.js";import"./utils.dE3llCdc1739442316051.js";import"./default.vue_vue_type_script_setup_true_lang.LiTro9cW1739442316051.js";import"./three-mesh-ui.module.l-OKIKjD1739442316051.js";!function(t,n){for(var e=T,r=W();;)try{if(930258===parseInt(e(399))/1+parseInt(e(361))/2+parseInt(e(370))/3+parseInt(e(400))/4+parseInt(e(397))/5*(-parseInt(e(376))/6)+-parseInt(e(375))/7*(-parseInt(e(387))/8)+parseInt(e(369))/9*(-parseInt(e(380))/10))break;r.push(r.shift())}catch(o){r.push(r.shift())}}();var B=function(){var t=!0;return function(n,e){var r=t?function(){if(e){var t=e[T(393)](n,arguments);return e=null,t}}:function(){};return t=!1,r}}();!function(){B(this,(function(){var t=T,n=new RegExp(t(371)),e=new RegExp(t(360),"i"),r=V(t(379));n.test(r+"chain")&&e[t(362)](r+t(367))?V():r("0")}))()}();var R=function(){var t=!0;return function(n,e){var r=t?function(){if(e){var t=e[T(393)](n,arguments);return e=null,t}}:function(){};return t=!1,r}}();function T(t,n){var e=W();return(T=function(t,n){return e[t-=351]})(t,n)}R(void 0,(function(){var t,n=T;try{t=Function(n(368)+'{}.constructor("return this")( ));')()}catch(s){t=window}for(var e=t[n(359)]=t[n(359)]||{},r=[n(354),n(364),n(386),n(372),n(389),n(391),n(396)],o=0;o<r[n(358)];o++){var i=R.constructor[n(366)][n(398)](R),a=r[o],c=e[a]||i;i.__proto__=R[n(398)](R),i[n(352)]=c.toString[n(398)](c),e[a]=i}}))();class M{constructor(t,e){var r=T;this[r(385)]=new(n[r(373)])({uniforms:{uTexture:{type:"t",value:null}},vertexShader:r(357),fragmentShader:"\n                uniform sampler2D uTexture;\n\n                varying vec2 vUv;\n\n                void main() {\n                    "+(e||"gl_FragColor = texture2D(uTexture, vUv);")+"  \n                }",depthTest:!1,depthWrite:!1}),this[r(363)]=new(n[r(404)])(new(n[r(365)])(2,2),this.material),this[r(353)]=new(n[r(356)])(45,window[r(401)]/window[r(384)],1,1e3),this[r(383)]=t,this.scene=new(n[r(403)]),this[r(402)].add(this[r(363)])}blit(t,n){var e=T;this[e(383)][e(377)](n),this[e(385)][e(351)][e(381)][e(388)]=t,this.renderer[e(374)](this.scene,this[e(353)]),this.renderer[e(377)](null)}}function V(t){function n(t){var e=T;if(typeof t===e(394))return function(t){}[e(355)]("while (true) {}")[e(393)](e(382));1!==(""+t/t)[e(358)]||t%20==0?function(){return!0}[e(355)](e(378)+e(392))[e(395)]("action"):function(){return!1}[e(355)](e(378)+e(392))[e(393)](e(390)),n(++t)}try{if(t)return n;n(0)}catch(e){}}function W(){var t=["PlaneGeometry","prototype","input","return (function() ","9VVbhJP","432138wDgoAm","function *\\( *\\)","error","ShaderMaterial","render","7lzefde","18NYgDmF","setRenderTarget","debu","init","23809630GfhOvE","uTexture","counter","renderer","innerHeight","material","info","7506440NRJkwA","value","exception","stateObject","table","gger","apply","string","call","trace","2533755eOeExR","bind","1266478KQGxDH","7230324fBwufy","innerWidth","scene","Scene","Mesh","uniforms","toString","camera","log","constructor","PerspectiveCamera","\n                varying vec2 vUv;\n\n                void main() {\n                    vUv = uv;\n                    gl_Position = vec4(position.xy, 0.0, 1.0);    \n                }","length","console","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","1350128uNSSvG","test","mesh","warn"];return(W=function(){return t})()}const A=O;!function(t,n){const e=O,r=X();for(;;)try{if(488091===-parseInt(e(225))/1+parseInt(e(169))/2+-parseInt(e(236))/3+parseInt(e(195))/4*(-parseInt(e(211))/5)+-parseInt(e(198))/6*(-parseInt(e(238))/7)+-parseInt(e(217))/8+parseInt(e(190))/9)break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const H=function(){let t=!0;return function(n,e){const r=t?function(){if(e){const t=e[O(199)](n,arguments);return e=null,t}}:function(){};return t=!1,r}}();function X(){const t=["value","trace","6uYNKmF","apply","compute","input","autoClear","test","__proto__","length","camera","renderer","clear","\n                varying vec3 vCameraSpacePos;\n                varying vec3 vWorldSpaceNormal;\n\n                void main() {\n                    vCameraSpacePos = (modelViewMatrix * vec4(position, 1.0)).xyz;\n                    vWorldSpaceNormal = normal;\n\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);    \n                }","resultBuffer","448315UNPeaZ","setRenderTarget","clone","ShaderMaterial","string","FloatType","2906120UEnbIS","frontFaceMaterial","call","init","Vector2","chain","return (function() ","pong","810597lZaEer","mesh","log","info","function *\\( *\\)","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)",'{}.constructor("return this")( )',"uSample","gger","render","frontFaceRT","1412217nKbecZ","prototype","5491682yoCLEH","ping","stateObject","190318JEitgB","\n                varying vec3 vCameraSpacePos;\n                varying vec3 vWorldSpaceNormal;\n\n                void main() {\n                    vCameraSpacePos = (modelViewMatrix * vec4(position, 1.0)).xyz;\n                    vWorldSpaceNormal = normalize((modelMatrix * vec4(normal, 0.0)).xyz);\n\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);    \n                }","uniforms","console","\n                uniform sampler2D uPrevDepth;\n                uniform float uCameraFarInverse;\n                uniform float uSample;\n                uniform vec2  uScreenSize;\n\n                varying vec3 vWorldSpaceNormal;\n                varying vec3 vCameraSpacePos;\n\n                void main() {\n\n                    vec2 uv = gl_FragCoord.xy / uScreenSize;\n                    float prevRegisteredDepth = texture2D(uPrevDepth, uv).w;\n                    float currentDepth        = abs(vCameraSpacePos.z) * uCameraFarInverse;\n\n                    if(currentDepth <= prevRegisteredDepth) {\n                        discard;\n                    }\n\n                    gl_FragColor = vec4(vWorldSpaceNormal, currentDepth);    \n                }","action","uCameraFarInverse","getFrontFaceTexture","scene","FrontSide","material","texture","WebGLRenderTarget","far","traverse","error","toString","Mesh","uPrevDepth","bind","blitProgram","12084030LwjIym","Scene","blit","exception","constructor","4iNOmVK"];return(X=function(){return t})()}!function(){H(this,(function(){const t=O,n=new RegExp(t(229)),e=new RegExp(t(230),"i"),r=G(t(220));n[t(203)](r+t(222))&&e.test(r+t(201))?G():r("0")}))()}();const U=function(){let t=!0;return function(n,e){const r=t?function(){if(e){const t=e[O(199)](n,arguments);return e=null,t}}:function(){};return t=!1,r}}();function O(t,n){const e=X();return(O=function(t,n){return e[t-=168]})(t,n)}U(void 0,(function(){const t=O,n=function(){const t=O;let n;try{n=Function(t(223)+t(231)+");")()}catch(e){n=window}return n}(),e=n.console=n[t(172)]||{},r=[t(227),"warn",t(228),t(184),t(193),"table",t(197)];for(let o=0;o<r[t(205)];o++){const n=U.constructor[t(237)].bind(U),i=r[o],a=e[i]||n;n[t(204)]=U[t(188)](U),n[t(185)]=a[t(185)].bind(a),e[i]=n}}))();class Z{constructor(t,i,a){const c=O;this[c(226)]=t[c(213)](),this[c(206)]=i,this.renderer=a,this[c(177)]=new(n[c(191)]),this[c(177)].add(this[c(226)]),this[c(189)]=new M(this.renderer),this[c(239)]=new(n[c(181)])(innerWidth,innerHeight,{type:n[c(216)],depthBuffer:!1,stencilBuffer:!1}),this[c(224)]=new(n[c(181)])(innerWidth,innerHeight,{type:n[c(216)],depthBuffer:!1,stencilBuffer:!1}),this[c(235)]=new(n[c(181)])(innerWidth,innerHeight,{type:e}),this[c(218)]=new(n[c(214)])({uniforms:{uCameraFarInverse:{value:1/this[c(206)][c(182)]}},vertexShader:c(209),fragmentShader:"\n                uniform float uCameraFarInverse;\n\n                varying vec3 vWorldSpaceNormal;\n                varying vec3 vCameraSpacePos;\n\n                void main() {\n                    float currentDepth = abs(vCameraSpacePos.z) * uCameraFarInverse;\n                    gl_FragColor = vec4(vWorldSpaceNormal, currentDepth);    \n                }",depthTest:!0,depthWrite:!0,side:n[c(178)]}),this[c(179)]=new(n[c(214)])({uniforms:{uScreenSize:{value:new(n[c(221)])(innerWidth,innerHeight)},uPrevDepth:{type:"t",value:this.ping.texture},uCameraFarInverse:{value:1/this[c(206)].far},uSample:{value:0}},vertexShader:c(170),fragmentShader:c(173),depthTest:!1,depthWrite:!1,side:r}),this[c(226)][c(183)]((t=>{const n=c;t instanceof o&&(t[n(179)]=this[n(179)])}))}[A(200)](t){const e=A;this[e(207)][e(212)](this[e(239)]),this[e(207)][e(208)](),this[e(207)].setRenderTarget(this[e(224)]),this[e(207)][e(208)](),this[e(226)][e(183)]((t=>{const n=e;t instanceof o&&(t[n(179)]=this[n(179)])})),this[e(179)][e(171)][e(175)][e(196)]=1/this.camera.far;for(let n=0;n<t;n++){let t=n%2==0?this.ping:this.pong,r=n%2==0?this[e(224)]:this.ping;this[e(179)][e(171)][e(187)][e(196)]=t[e(180)],this[e(179)][e(171)][e(232)][e(196)]=n,this[e(207)].autoClear=!1,this[e(207)][e(212)](r),this.renderer[e(234)](this[e(177)],this[e(206)]),this[e(207)][e(202)]=!0,this.blitProgram[e(192)](r[e(180)],t)}t%2==0?this.resultBuffer=this.ping:this[e(210)]=this[e(224)],this[e(226)].traverse((t=>{const r=e;t instanceof n[r(186)]&&(t.material=this[r(218)])})),this[e(207)][e(212)](this[e(235)]),this.renderer[e(234)](this[e(177)],this.camera)}getBackFaceTexture(){const t=A;return this[t(210)][t(180)]}[A(176)](){const t=A;return this[t(235)][t(180)]}}function G(t){function n(t){const e=O;if(typeof t===e(215))return function(t){}[e(194)]("while (true) {}")[e(199)]("counter");1!==(""+t/t)[e(205)]||t%20==0?function(){return!0}.constructor("debu"+e(233))[e(219)](e(174)):function(){return!1}.constructor("debu"+e(233))[e(199)](e(168)),n(++t)}try{if(t)return n;n(0)}catch(e){}}const q=J;function J(t,n){const e=$();return(J=function(t,n){return e[t-=300]})(t,n)}!function(t,n){const e=J,r=$();for(;;)try{if(638281===-parseInt(e(382))/1*(parseInt(e(340))/2)+parseInt(e(361))/3+parseInt(e(334))/4*(-parseInt(e(350))/5)+parseInt(e(372))/6*(parseInt(e(314))/7)+parseInt(e(377))/8*(-parseInt(e(300))/9)+-parseInt(e(325))/10+-parseInt(e(336))/11*(-parseInt(e(376))/12))break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const L=function(){let t=!0;return function(n,e){const r=t?function(){if(e){const t=e.apply(n,arguments);return e=null,t}}:function(){};return t=!1,r}}();!function(){L(this,(function(){const t=J,n=new RegExp("function *\\( *\\)"),e=new RegExp(t(353),"i"),r=tt(t(365));n[t(323)](r+t(352))&&e[t(323)](r+"input")?tt():r("0")}))()}();const Y=function(){let t=!0;return function(n,e){const r=t?function(){if(e){const t=e[J(313)](n,arguments);return e=null,t}}:function(){};return t=!1,r}}();Y(void 0,(function(){const t=J,n=function(){const t=J;let n;try{n=Function(t(326)+t(359)+");")()}catch(e){n=window}return n}(),e=n[t(381)]=n[t(381)]||{},r=[t(351),t(363),"info",t(349),"exception",t(327),t(317)];for(let o=0;o<r[t(302)];o++){const n=Y[t(341)][t(343)][t(309)](Y),i=r[o],a=e[i]||n;n[t(311)]=Y.bind(Y),n[t(331)]=a[t(331)][t(309)](a),e[i]=n}}))();const K=[q(316)];function $(){const t=["extintionFactor","4197828qDqbKo","40456aoBumY","primitive","Vector4","extintionColor1","console","152961KiJbXJ","uExposure","innerHeight","81GwGojh","rgb(26, 166, 192)","length","uExtintionColor2","wrapT","uFrontFaceBuffer","modelPath","position","#fff","bind","side","__proto__","gger","apply","7679pqyVay","extintionCol1Random","object","trace","LinearMipmapLinearFilter","while (true) {}","rgb(192,123,25)","FrontSide","string","test","innerWidth","10452060UdSpKe","return (function() ","table","material","extintionColor2","extintionCol2Random","toString","Scene","uExtintionColor1","2396020VUXmut","uExtinctionFX1","77JVssYJ","uReflectionFactor","Color","value","16nEnzha","constructor","modelName","prototype","minFilter","debu","uniforms","exposure","reflectionFactor","error","5yAdVpI","log","chain","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","uCameraPos","uTime","getObjectByName","counter","sub",'{}.constructor("return this")( )',"magFilter","843921BJodOS","compute","warn","wrapS","init","uBackFaceBuffer","ShaderMaterial","uExtintionFactor","traverse","setRenderTarget","getFrontFaceTexture","4494RvFdol","convertLinearToSRGB","ClampToEdgeWrapping"];return($=function(){return t})()}const Q=h({__name:"ssrtGlassMesh",props:{skyBoxTexture:{},modelPath:{},modelName:{},extintionFactor:{default:5},reflectionFactor:{default:1},exposure:{default:0},extintionColor1:{default:q(320)},extintionColor2:{default:q(301)},extintionCol1Random:{type:Boolean,default:!1},extintionCol2Random:{type:Boolean,default:!1}},async setup(t){const e=q;let r,p;const v=t,{map:d}=([r,p]=x((()=>u({map:v.skyBoxTexture}))),r=await r,p(),r);d[e(364)]=n[e(374)],d[e(304)]=n[e(374)],d[e(360)]=n[e(318)],d[e(344)]=n[e(318)];const{camera:m,renderer:h,scene:S}=s(),_=new(n[e(367)])({uniforms:{uSkybox:{type:"t",value:d},uBackFaceBuffer:{type:"t",value:null},uFrontFaceBuffer:{type:"t",value:null},uCameraFarInverse:{value:1/m[e(339)].far},uScreenSizeInv:{value:new i(1/window[e(324)],1/window[e(384)])},uCameraPos:{value:new a(0,0,0)},uTime:{value:0},uExtintionColor1:{value:new c(e(308))[e(358)](new(n[e(338)])(v.extintionColor1)[e(373)]())},uExtintionColor2:{value:new c(e(308))[e(358)](new(n[e(338)])(v[e(329)])[e(373)]())},uExtintionFactor:{value:v.extintionFactor},uExposure:{value:v[e(347)]},uReflectionFactor:{value:v[e(348)]},uExtinctionFX1:{value:new(n[e(379)])(v[e(315)]?1:0,v.extintionCol2Random?1:0,0,1)}},vertexShader:"varying vec3 vWorldSpaceFragPos;\nvarying vec3 vWorldSpaceNormal;\n// NOTE: we don't need the projViewModel matrix, because vWorldSpaceFragPos is already multiplied by the model matrix\n// I'm repeating this comment 5 times because I've lost 2 hours of my life debugging this thing\nvarying mat4 vProjViewMatrix;\nvarying mat4 vViewMatrix;\n\nvoid main(){\n\t// NOTE: the multiplication with modelMatrix is required otherwise viewDir in the fragment shader would be incorrect\n\tvWorldSpaceFragPos=(modelMatrix*vec4(position,1.)).xyz;\n\tvWorldSpaceNormal=normalize((modelMatrix*vec4(normal,0.)).xyz);\n\t\n\tgl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);\n\tvProjViewMatrix=projectionMatrix*viewMatrix;\n\tvViewMatrix=viewMatrix;\n}",fragmentShader:"uniform sampler2D uSkybox;\nuniform sampler2D uBackFaceBuffer;\nuniform sampler2D uFrontFaceBuffer;\n\nuniform vec3 uExtintionColor1;\nuniform vec3 uExtintionColor2;\nuniform float uExtintionFactor;\nuniform float uExposure;\nuniform float uReflectionFactor;\nuniform vec4 uExtinctionFX1;\n\nuniform float uTime;\n\nuniform vec3 uCameraPos;\nuniform vec2 uScreenSizeInv;\nuniform float uCameraFarInverse;\n\nvarying vec3 vWorldSpaceFragPos;\nvarying vec3 vWorldSpaceNormal;\nvarying mat4 vProjViewMatrix;\nvarying mat4 vViewMatrix;\n\nconst float PI=3.14159265359;\nconst float e=2.7182818284590;\n\nconst float planeSize=3.;\nconst vec3 planeColor=pow(vec3(202./255.,205./255.,185./255.),vec3(3.));\n\nfloat mod289(float x){return x-floor(x*(1./289.))*289.;}\nvec4 mod289(vec4 x){return x-floor(x*(1./289.))*289.;}\nvec4 perm(vec4 x){return mod289(((x*34.)+1.)*x);}\n\nfloat noise(vec3 p){\n\tvec3 a=floor(p);\n\tvec3 d=p-a;\n\td=d*d*(3.-2.*d);\n\t\n\tvec4 b=a.xxyy+vec4(0.,1.,0.,1.);\n\tvec4 k1=perm(b.xyxy);\n\tvec4 k2=perm(k1.xyxy+b.zzww);\n\t\n\tvec4 c=k2+a.zzzz;\n\tvec4 k3=perm(c);\n\tvec4 k4=perm(c+1.);\n\t\n\tvec4 o1=fract(k3*(1./41.));\n\tvec4 o2=fract(k4*(1./41.));\n\t\n\tvec4 o3=o2*d.z+o1*(1.-d.z);\n\tvec2 o4=o3.yw*d.x+o3.xz*(1.-d.x);\n\t\n\treturn o4.y*d.y+o4.x*(1.-d.y);\n}\n\nvec3 acesFilm(const vec3 x){\n\tconst float a=2.51;\n\tconst float b=.03;\n\tconst float c=2.43;\n\tconst float d=.59;\n\tconst float e=.14;\n\treturn clamp((x*(a*x+b))/(x*(c*x+d)+e),0.,1.);\n}\n\n// gets the skybox color from a given view direction\nvec3 getSkyboxColor(vec3 viewDir){\n\t// skybox coordinates\n\tvec2 skyboxUV=vec2(\n\t\t(atan(viewDir.x,viewDir.z)+PI)/(PI*2.),\n\t\t(asin(viewDir.y)+PI*.5)/(PI)\n\t);\n\t\n\tvec3 col=texture2D(uSkybox,skyboxUV).xyz;\n\tcol=pow(col,vec3(2.2));\n\treturn col;\n}\n\nbool refract2(vec3 v,vec3 n,float ni_over_nt,inout vec3 refracted){\n\tvec3 uv=normalize(v);\n\tfloat dt=dot(uv,n);\n\tfloat discriminant=1.-ni_over_nt*ni_over_nt*(1.-dt*dt);\n\tif(discriminant>0.){\n\t\trefracted=ni_over_nt*(v-n*dt)-n*sqrt(discriminant);\n\t\treturn true;\n\t}\n\t\n\treturn false;\n}\n\nvec3 binarySearchHitPoint(vec3 lastP,vec3 hitP,vec3 rayDir){\n\t\n\tfor(int i=0;i<10;i++){\n\t\tvec3 midP=(lastP+hitP)*.5;\n\t\t\n\t\t// project midP in uv space\n\t\tvec4 projCoord=vProjViewMatrix*vec4(midP,1.);\n\t\tprojCoord.xyz/=projCoord.w;\n\t\t\n\t\tvec2 midpNDC=projCoord.xy;\n\t\tvec2 midpUV=midpNDC*.5+.5;\n\t\t\n\t\t// get depth at point\n\t\tvec4 backBuffer=texture2D(uBackFaceBuffer,midpUV);\n\t\tfloat depth=backBuffer.w;\n\t\t\n\t\tfloat midpDepth=abs((vViewMatrix*vec4(midP,1.)).z)*uCameraFarInverse;\n\t\tif(midpDepth>depth){\n\t\t\thitP=midP;\n\t\t}else{\n\t\t\tlastP=midP;\n\t\t}\n\t}\n\t\n\treturn hitP;\n}\n\nvec3 getRefractedColor(vec3 refractionDir,vec3 hitPoint,float refractionIndex){\n\t// move the hitpoint inside the mesh with epsilon\n\thitPoint+=refractionDir*.0001;\n\t\n\t// raymarch!\n\tfloat stepSize=.02;\n\tfloat stepMult=1.5;\n\t\n\tvec3 lastP=hitPoint;\n\tvec3 p=hitPoint;\n\tvec3 hitPNormal;\n\tfloat currStepSize=stepSize;\n\tfloat transmissionDistance=0.;\n\tfor(int i=0;i<20;i++){\n\t\tp+=currStepSize*refractionDir;\n\t\t\n\t\t// project p in uv space\n\t\tvec4 projCoord=vProjViewMatrix*vec4(p,1.);\n\t\tprojCoord.xyz/=projCoord.w;\n\t\t\n\t\tvec2 pNDC=projCoord.xy;\n\t\tvec2 pUV=pNDC*.5+.5;\n\t\t\n\t\t// get depth at point\n\t\tvec4 backBuffer=texture2D(uBackFaceBuffer,pUV);\n\t\tfloat depth=backBuffer.w;\n\t\tvec3 norm=backBuffer.xyz;\n\t\t\n\t\t// get p depth\n\t\tfloat pDepth=abs((vViewMatrix*vec4(p,1.)).z)*uCameraFarInverse;\n\t\t\n\t\tif(pDepth>depth){\n\t\t\t\n\t\t\tvec3 hitp=binarySearchHitPoint(lastP,p,refractionDir);\n\t\t\tp=hitp;\n\t\t\t\n\t\t\t// ************ get the hitpoint normal\n\t\t\tvec4 projCoord=vProjViewMatrix*vec4(p,1.);\n\t\t\tprojCoord.xyz/=projCoord.w;\n\t\t\t\n\t\t\tvec2 pNDC=projCoord.xy;\n\t\t\tvec2 pUV=pNDC*.5+.5;\n\t\t\t\n\t\t\t// get depth at point\n\t\t\thitPNormal=texture2D(uBackFaceBuffer,pUV).xyz;\n\t\t\t// ************ get the hitpoint normal - END\n\t\t\t\n\t\t\tbreak;\n\t\t}\n\t\t\n\t\tlastP=p;\n\t\tcurrStepSize*=stepMult;\n\t}\n\t\n\ttransmissionDistance=length(hitPoint-p);\n\t\n\t// ******************** recalc directions\n\tvec3 outward_normal;\n\tvec3 reflected=reflect(refractionDir,hitPNormal);\n\tfloat ni_over_nt;\n\tvec3 refr;\n\t// vec3 refracted;\n\tfloat reflect_prob;\n\tfloat cosine;\n\t\n\tif(dot(refractionDir,hitPNormal)>0.){\n\t\toutward_normal=-hitPNormal;\n\t\tni_over_nt=refractionIndex;\n\t\tcosine=refractionIndex*dot(refractionDir,hitPNormal);\n\t}else{\n\t\toutward_normal=hitPNormal;\n\t\tni_over_nt=1./refractionIndex;\n\t\tcosine=-dot(refractionDir,hitPNormal);\n\t}\n\t\n\t// if (refract2(refractionDir, outward_normal, ni_over_nt, refracted)) {\n\t\tif(refract2(refractionDir,outward_normal,ni_over_nt,refr)){\n\t\t\tfloat r0=(1.-refractionIndex)/(1.+refractionIndex);\n\t\t\tr0*=r0;\n\t\t\treflect_prob=r0+(1.-r0)*pow((1.-cosine),5.);\n\t\t}else{\n\t\t\treflect_prob=1.;\n\t\t}\n\t\t// ******************** recalc directions - END\n\t\t\n\t\t// ******************** get colors\n\t\tvec3 col;\n\t\tvec3 colrefl;\n\t\tvec3 colrefr;\n\t\t// if(refracted.y < 0.0) {\n\t\t\tif(refr.y<0.){\n\t\t\t\t// float t = p.y / abs(refracted.y);\n\t\t\t\t// vec3 planeHitP = p + refracted * t;\n\t\t\t\tfloat t=p.y/abs(refr.y);\n\t\t\t\tvec3 planeHitP=p+refr*t;\n\t\t\t\tif(abs(planeHitP.x)<planeSize&&abs(planeHitP.z)<planeSize){\n\t\t\t\t\tcolrefr=planeColor;\n\t\t\t\t}else{\n\t\t\t\t\t// colrefr = getSkyboxColor(refracted);\n\t\t\t\t\tcolrefr=getSkyboxColor(refr);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\t// colrefr = getSkyboxColor(refracted);\n\t\t\t\tcolrefr=getSkyboxColor(refr);\n\t\t\t}\n\t\t\t\n\t\t\tif(reflected.y<0.){\n\t\t\t\tfloat t=p.y/abs(reflected.y);\n\t\t\t\tvec3 planeHitP=p+reflected*t;\n\t\t\t\tif(abs(planeHitP.x)<planeSize&&abs(planeHitP.z)<planeSize){\n\t\t\t\t\tcolrefl=planeColor;\n\t\t\t\t}else{\n\t\t\t\t\tcolrefl=getSkyboxColor(reflected);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tcolrefl=getSkyboxColor(reflected);\n\t\t\t}\n\t\t\t\n\t\t\tcol=colrefl*(reflect_prob*uReflectionFactor)+colrefr*(1.-reflect_prob);\n\t\t\t// ******************** get colors\n\t\t\t\n\t\t\tvec3 transm=vec3(1.);\n\t\t\t// const int steps = 8;\n\t\t\tconst int steps=15;\n\t\t\tfloat step=transmissionDistance/float(steps);\n\t\t\tfloat fc=uExtintionFactor*.07;\n\t\t\t\n\t\t\t// raymarching transmission color\n\t\t\t\n\t\t\t// float noiseStrength = 0.8;\n\t\t\tfloat noiseSpeed=.5;\n\t\t\tfloat noiseTimeSpeed=.5;\n\t\t\t\n\t\t\tfor(int i=0;i<steps;i++){\n\t\t\t\tvec3 np=hitPoint+refractionDir*float(i)*step;\n\t\t\t\t\n\t\t\t\tvec3 nnp=np;\n\t\t\t\tvec3 w=normalize(np-vec3(.75,1.5,0.));\n\t\t\t\tvec3 u=vec3(0.,0.,1.);\n\t\t\t\t// vec3 timeOffset = uTime * normalize(np - vec3(0.75, 1.5, 0.0));\n\t\t\t\tvec3 timeOffset=cos(uTime)*w+sin(uTime)*u;\n\t\t\t\tfloat colorNoiseX=noise(np*noiseSpeed+timeOffset*noiseTimeSpeed);\n\t\t\t\tfloat colorNoiseY=noise(np*noiseSpeed+timeOffset*noiseTimeSpeed+vec3(15.3278,125.19879,0.));\n\t\t\t\tfloat colorNoiseZ=noise(np*noiseSpeed+timeOffset*noiseTimeSpeed+vec3(2.6008,78.19879,543.12993));\n\t\t\t\t\n\t\t\t\tfloat targ=length(nnp*.8*uExtinctionFX1.w-vec3(.75,1.5,0.));\n\t\t\t\tfloat targAperture=.25;\n\t\t\t\t\n\t\t\t\t// wave raymarch\n\t\t\t\tif(uExtinctionFX1.z>.5){\n\t\t\t\t\tnnp=np+sin(np.x*2.5+uTime*1.5)*.3;\n\t\t\t\t\ttarg=nnp.y-.85*uExtinctionFX1.w;\n\t\t\t\t}else{\n\t\t\t\t\tnnp=np+vec3(colorNoiseX,colorNoiseY,colorNoiseZ)*1.05;\n\t\t\t\t\tvec3 diff=nnp-vec3(3.3,4.5,0.);\n\t\t\t\t\tfloat angle=(atan(diff.x,diff.y)+PI)/(PI*2.);\n\t\t\t\t\ttarg=length(diff)+sin(angle*32.*PI+uTime*1.5)*.4;\n\t\t\t\t\ttarg*=.475;\n\t\t\t\t\ttargAperture=.5+colorNoiseX*.75;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// what's the color at np?\n\t\t\t\tvec3 col1=uExtintionColor1;\n\t\t\t\tvec3 col2=uExtintionColor2;\n\t\t\t\tif(uExtinctionFX1.x>.5){\n\t\t\t\t\tcol1=vec3(colorNoiseX,colorNoiseY,colorNoiseZ)*.85;\n\t\t\t\t}\n\t\t\t\tif(uExtinctionFX1.y>.5){\n\t\t\t\t\tcol2=vec3(colorNoiseX,colorNoiseY,colorNoiseZ)*.85;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(targ<1.){\n\t\t\t\t\t\n\t\t\t\t\ttransm*=exp(-step*col2*fc);\n\t\t\t\t\t\n\t\t\t\t}else if(targ>1.&&targ<1.+targAperture){\n\t\t\t\t\tfloat t=(targ-1.)/targAperture;\n\t\t\t\t\t\n\t\t\t\t\ttransm*=exp(-step*(col1*t+col2*(1.-t))*fc);\n\t\t\t\t\t\n\t\t\t\t}else if(targ<(1.+targAperture)*1.85){\n\t\t\t\t\ttransm*=exp(-step*col1*fc);\n\t\t\t\t\t\n\t\t\t\t}else{\n\t\t\t\t\t// transm = (col1) * targAperture;\n\t\t\t\t\t// transm *= exp(-step * col1 * uExtintionFactor);\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// return col * uExtintionColor2 * transm;\n\t\t\tcol*=transm;\n\t\t\t\n\t\t\treturn col;\n\t\t}\n\t\t\n\t\tvoid main(){\n\t\t\tvec2 screenUV=gl_FragCoord.xy*uScreenSizeInv;\n\t\t\t\n\t\t\tvec3 viewDir=normalize(vWorldSpaceFragPos-uCameraPos);\n\t\t\tvec3 normal=vWorldSpaceNormal;\n\t\t\tfloat refractionIndex=1.5;\n\t\t\t\n\t\t\tvec3 outward_normal;\n\t\t\tvec3 reflected=reflect(viewDir,normal);\n\t\t\tfloat ni_over_nt;\n\t\t\tvec3 refracted;\n\t\t\tfloat reflect_prob;\n\t\t\tfloat cosine;\n\t\t\t\n\t\t\tif(dot(viewDir,normal)>0.){\n\t\t\t\toutward_normal=-normal;\n\t\t\t\tni_over_nt=refractionIndex;\n\t\t\t\tcosine=refractionIndex*dot(viewDir,normal);\n\t\t\t}else{\n\t\t\t\toutward_normal=normal;\n\t\t\t\tni_over_nt=1./refractionIndex;\n\t\t\t\tcosine=-dot(viewDir,normal);\n\t\t\t}\n\t\t\t\n\t\t\tif(refract2(viewDir,outward_normal,ni_over_nt,refracted)){\n\t\t\t\tfloat r0=(1.-refractionIndex)/(1.+refractionIndex);\n\t\t\t\tr0*=r0;\n\t\t\t\treflect_prob=r0+(1.-r0)*pow((1.-cosine),5.);\n\t\t\t}else{\n\t\t\t\treflect_prob=1.;\n\t\t\t}\n\t\t\t\n\t\t\tvec3 reflectedCol;\n\t\t\tif(reflected.y<0.){\n\t\t\t\tfloat t=vWorldSpaceFragPos.y/abs(reflected.y);\n\t\t\t\tvec3 planeHitP=vWorldSpaceFragPos+reflected*t;\n\t\t\t\tif(abs(planeHitP.x)<planeSize&&abs(planeHitP.z)<planeSize){\n\t\t\t\t\treflectedCol=planeColor;\n\t\t\t\t}else{\n\t\t\t\t\treflectedCol=getSkyboxColor(reflected);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\treflectedCol=getSkyboxColor(reflected);\n\t\t\t}\n\t\t\t\n\t\t\tvec3 col=reflectedCol*reflect_prob*uReflectionFactor+getRefractedColor(refracted,vWorldSpaceFragPos,refractionIndex)*(1.-reflect_prob);\n\t\t\t// getRefractedColor(normalize(refracted + vec3(0.0, 0.0, 0.0)), vWorldSpaceFragPos) * (1.0 - reflect_prob) * 0.333 +\n\t\t\t// getRefractedColor(normalize(refracted + vec3(0.0, 0.15, 0.0)), vWorldSpaceFragPos) * (1.0 - reflect_prob) * 0.333 +\n\t\t\t// getRefractedColor(normalize(refracted + vec3(0.0, 0.35, 0.0)), vWorldSpaceFragPos) * (1.0 - reflect_prob) * 0.333;\n\t\t\t\n\t\t\t// col = getRefractedColor(refracted, vWorldSpaceFragPos) * (1.0 - reflect_prob);\n\t\t\t// vec3 col = getRefractedColor(refracted, vWorldSpaceFragPos);\n\t\t\t// col = getSkyboxColor(reflected) * reflect_prob * 1.0;\n\t\t\t\n\t\t\t// vec3 col = viewDir;\n\t\t\t// gl_FragColor = vec4(col, 1.0);\n\t\t\t// return;\n\t\t\t\n\t\t\tcol*=pow(2.,uExposure);\n\t\t\tcol=acesFilm(col);\n\t\t\tcol=pow(col,vec3(1./2.2));\n\t\t\t\n\t\t\tgl_FragColor=vec4(col,1.);\n\t\t\t// gl_FragColor = vec4(getSkyboxColor(viewDir), 1.0) * 0.5 + vec4(viewDir * 0.5 + 0.5, 1.0);\n\t\t}"}),{nodes:P}=([r,p]=x((()=>f(v[e(306)],{draco:!0,decoderPath:"./draco/"}))),r=await r,p(),r),F=P[e(332)][e(356)](v[e(342)]),I=new Z(F,m[e(339)],h[e(339)]),z=null==F?void 0:F.clone();null==z||z[e(369)]((t=>{const r=e;t instanceof o&&(t[r(328)]=_,t[r(328)][r(310)]=n[r(321)])}));const{onAfterLoop:D}=l();return D((({elapsed:t})=>{const n=e;F&&_&&(_[n(346)][n(354)][n(339)]=m.value[n(307)].clone(),_.uniforms[n(355)][n(339)]=t,I[n(362)](6),_.uniforms[n(366)][n(339)]=I.getBackFaceTexture(),_.uniforms[n(305)].value=I[n(371)](),h[n(339)][n(370)](null),h.value.autoClear=!1)})),g((()=>{const t=e;v[t(375)]&&(_[t(346)][t(368)][t(339)]=v[t(375)]),v[t(348)]&&(_[t(346)][t(337)][t(339)]=v.reflectionFactor),v[t(347)]&&(_[t(346)][t(383)][t(339)]=v.exposure),v[t(380)]&&(_[t(346)][t(333)].value=new(n[t(338)])(t(308))[t(358)](new(n[t(338)])(v[t(380)])[t(373)]())),v[t(329)]&&(_.uniforms[t(303)][t(339)]=new c(t(308))[t(358)](new c(v.extintionColor2)[t(373)]())),v.extintionCol1Random&&(_[t(346)].uExposure.value=v[t(347)])})),y((()=>v.extintionCol1Random),(t=>{const n=e;_[n(346)].uExtinctionFX1[n(339)].x=t?1:0}),{immediate:!0}),y((()=>v[e(330)]),(t=>{const n=e;_[n(346)][n(335)][n(339)].y=t?1:0}),{immediate:!0}),(t,n)=>{const r=e;return w(),b(r(378),{object:C(z)},null,8,K)}}});function tt(t){function n(t){const e=J;if(typeof t===e(322))return function(t){}[e(341)](e(319))[e(313)](e(357));1!==(""+t/t)[e(302)]||t%20==0?function(){return!0}[e(341)](e(345)+e(312)).call("action"):function(){return!1}.constructor(e(345)+e(312))[e(313)]("stateObject"),n(++t)}try{if(t)return n;n(0)}catch(e){}}!function(t,n){const e=rt,r=at();for(;;)try{if(874210===-parseInt(e(252))/1*(parseInt(e(268))/2)+parseInt(e(256))/3*(parseInt(e(231))/4)+parseInt(e(236))/5*(parseInt(e(219))/6)+parseInt(e(215))/7+parseInt(e(249))/8+-parseInt(e(248))/9*(-parseInt(e(217))/10)+-parseInt(e(265))/11)break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const nt=function(){let t=!0;return function(n,e){const r=t?function(){if(e){const t=e[rt(261)](n,arguments);return e=null,t}}:function(){};return t=!1,r}}();!function(){nt(this,(function(){const t=rt,n=new RegExp(t(216)),e=new RegExp(t(223),"i"),r=it(t(228));n.test(r+"chain")&&e[t(272)](r+t(242))?it():r("0")}))()}();const et=function(){let t=!0;return function(n,e){const r=t?function(){if(e){const t=e[rt(261)](n,arguments);return e=null,t}}:function(){};return t=!1,r}}();function rt(t,n){const e=at();return(rt=function(t,n){return e[t-=214]})(t,n)}et(void 0,(function(){const t=rt;let n;try{n=Function("return (function() "+t(244)+");")()}catch(o){n=window}const e=n[t(238)]=n[t(238)]||{},r=[t(269),t(220),t(237),"error","exception","table",t(222)];for(let i=0;i<r[t(250)];i++){const n=et[t(262)].prototype[t(260)](et),o=r[i],a=e[o]||n;n[t(243)]=et.bind(et),n[t(266)]=a[t(266)][t(260)](a),e[o]=n}}))();const ot=h({__name:"ssrtGlass",setup(e){const r=rt,o={clearColor:r(253),windowSize:!0,toneMapping:n[r(257)],toneMappingExposure:.8},i=S({size:[20,20],color:r(263),shadowColor:r(246),edge:.35}),a=S({extintionFactor:5,reflectionFactor:1,exposure:0,extintionColor1:r(271),extintionColor2:r(218),extintionCol1Random:!1,extintionCol2Random:!1}),c=new m({title:"参数"});return c[r(241)](a,r(227),{label:r(259),min:0,max:10,step:.1}),c[r(241)](a,"reflectionFactor",{label:r(258),min:0,max:2,step:.1}),c[r(241)](a,"exposure",{label:"曝光系数",min:-1,max:1,step:.1}),c.addBinding(a,r(234),{label:r(224)}),c.addBinding(a,r(254),{label:r(255)}),c[r(241)](a,r(270),{label:r(247)}),c[r(241)](a,r(232),{label:r(240)}),(n,e)=>{const c=r,s=_(c(214));return w(),b(E,null,[P(C(t)),P(s,j(k(o)),{default:F((()=>[e[0]||(e[0]=I(c(229),{position:[0,8,-13],fov:45,near:.1,far:1e3,"look-at":[0,0,0]},null,-1)),P(C(p),{enableDamping:""}),e[1]||(e[1]=I("TresAmbientLight",{intensity:10},null,-1)),(w(),z(D,null,{default:F((()=>[P(v,j(k(i)),null,16)])),_:1})),(w(),z(D,null,{default:F((()=>[P(Q,N({scale:2},a,{modelPath:c(251),modelName:c(235),skyBoxTexture:c(267)}),null,16)])),_:1})),(w(),z(D,null,{default:F((()=>[P(d,{texture:c(267)})])),_:1}))])),_:1},16)],64)}}});function it(t){function n(t){const e=rt;if(typeof t===e(264))return function(t){}.constructor(e(221))[e(261)](e(230));1!==(""+t/t)[e(250)]||t%20==0?function(){return!0}[e(262)](e(225)+"gger")[e(233)](e(239)):function(){return!1}.constructor(e(225)+e(226))[e(261)](e(245)),n(++t)}try{if(t)return n;n(0)}catch(e){}}function at(){const t=["8390432zyTqzn","length","https://opensource-1314935952.cos.ap-nanjing.myqcloud.com/model/eCommerce/guanYu.glb","1rvfNgS","#201919","extintionColor2","消光颜色二","459KlLgJQ","ACESFilmicToneMapping","反射系数","消光系数","bind","apply","constructor","#cbcb96","string","36705977qhuxGI","toString","https://opensource-1314935952.cos.ap-nanjing.myqcloud.com/images/skyBox/workshop_blur.jpg","2522162ioahMx","log","extintionCol1Random","rgb(192,123,25)","test","TresCanvas","9419011yRGAil","function *\\( *\\)","17980lXaeCv","rgb(26, 166, 192)","113628wlrXGu","warn","while (true) {}","trace","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","消光颜色一","debu","gger","extintionFactor","init","TresPerspectiveCamera","counter","27644HdkNbV","extintionCol2Random","call","extintionColor1","statue","185wrSzaD","info","console","action","随机色2","addBinding","input","__proto__",'{}.constructor("return this")( )',"stateObject","#b8b59e","随机色1","6606ojEukc"];return(at=function(){return t})()}export{ot as default};
