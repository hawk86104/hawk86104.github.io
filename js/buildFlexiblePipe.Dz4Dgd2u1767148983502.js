import{importShared as U}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";const o=await U("three");class j extends o.Curve{constructor(s,d,i,t,e,l){super(),this.center=s.clone(),this.xAxis=d.clone().normalize(),this.yAxis=i.clone().normalize(),this.radius=t,this.startAngle=e,this.deltaAngle=l}getPoint(s,d){const i=this.startAngle+this.deltaAngle*s,t=Math.cos(i),e=Math.sin(i);return(d||new o.Vector3).copy(this.xAxis).multiplyScalar(t*this.radius).addScaledVector(this.yAxis,e*this.radius).add(this.center)}}function G(c,s,d=16){const t=new o.CurvePath;if(c.length<2)return t;let e=c[0].clone();const l=(a,f)=>a.distanceToSquared(f)<1e-8;for(let a=1;a<c.length-1;a++){const f=c[a-1].clone(),n=c[a].clone(),N=c[a+1].clone(),g=f.clone().sub(n),v=N.clone().sub(n),C=g.length(),y=v.length();if(C<1e-6||y<1e-6){l(e,n)||t.add(new o.LineCurve3(e.clone(),n.clone())),e=n.clone();continue}const A=g.clone().normalize(),x=v.clone().normalize(),R=o.MathUtils.clamp(A.dot(x),-1,1),h=Math.acos(R);if(h<1e-4){l(e,n)||t.add(new o.LineCurve3(e.clone(),n.clone())),e=n.clone();continue}const T=s/Math.tan(h/2),D=Math.min(C,y)-1e-6,u=Math.min(T,Math.max(0,D));if(u<=1e-6){l(e,n)||t.add(new o.LineCurve3(e.clone(),n.clone())),e=n.clone();continue}const z=u*Math.tan(h/2),b=A.clone().add(x);if(b.length()<1e-6){l(e,n)||t.add(new o.LineCurve3(e.clone(),n.clone())),e=n.clone();continue}const V=b.clone().normalize(),B=z/Math.sin(h/2),P=n.clone().add(V.multiplyScalar(B)),p=n.clone().add(A.clone().multiplyScalar(u)),E=n.clone().add(x.clone().multiplyScalar(u)),w=p.clone().sub(P);let m=w.clone().normalize();const L=g.clone().cross(v);if(L.length()<1e-7){l(e,n)||t.add(new o.LineCurve3(e.clone(),n.clone())),e=n.clone();continue}const S=L.clone().normalize().cross(m).normalize(),q=Math.atan2(w.dot(S),w.dot(m)),I=E.clone().sub(P);let r=Math.atan2(I.dot(S),I.dot(m))-q;for(;r<=-Math.PI;)r+=Math.PI*2;for(;r>Math.PI;)r-=Math.PI*2;l(e,p)||t.add(new o.LineCurve3(e.clone(),p.clone()));const H=new j(P,m,S,z,q,r);t.add(H),e=E.clone()}const M=c[c.length-1].clone();return!e.equals(M)&&e.distanceToSquared(M)>1e-8&&t.add(new o.LineCurve3(e.clone(),M.clone())),t}export{G as buildRoundedPath};
