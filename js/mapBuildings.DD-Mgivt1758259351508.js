import{e,b as o,m as t}from"./@tresjs.CywMBpUh1758259351508.js";import{aP as i,V as n,cD as a,a9 as r,g as s,S as l,M as u,Q as p,aC as c,cP as m,cB as f,cQ as d,a3 as g,C as _,bN as h,d3 as v,N as y,_ as w,co as j,q as x}from"./three.CtgP63ME1758259351508.js";import{z as C}from"./three-custom-shader-material.gu_n-VhD1758259351508.js";import{T as b}from"./3d-tiles-renderer.Dblw-3aG1758259351508.js";import{d as M,aa as P,G as z,o as T,F as B,W as S,I as L,u as D,b as O,a2 as W,j as G,e as q,f as A,a5 as E,v as H,r as R,h as k,m as F}from"./@vue.pEDXJ_3Z1758259351508.js";import{l as N,U as Z,P as I,M as J,T as Q,a as U,r as V}from"./raycasterEvent.8SpJNp-I1758259351508.js";import"./HeightCorrection.Bq98L9tL1758259351508.js";import"./@tweenjs.Dhzs71lh1758259351508.js";import"./@fesjs.uDzWZsaX1758259351508.js";import"./three-tile.CCm53Qdv1758259351508.js";/* empty css                                                                                    */import{_ as X,a as Y}from"./radraB.vue_vue_type_script_setup_true_lang.C9bVP8X11758259351508.js";import"./vanilla.esm.5.5.0.BLQsTmw31758259351508.js";import{_ as K}from"./precipitation.vue_vue_type_script_setup_true_lang.CLv22nX81758259351508.js";import{_ as $}from"./cloudMesh.vue_vue_type_script_setup_true_lang.Cbfy5VuS1758259351508.js";import{_ as ee}from"./buildingsMarkA.vue_vue_type_script_setup_true_lang.CJW1Qy6F1758259351508.js";import{_ as oe}from"./fireA.vue_vue_type_script_setup_true_lang.C3rOnCUK1758259351508.js";import{_ as te}from"./fireB.vue_vue_type_script_setup_true_lang.Bg4eZnqp1758259351508.js";import{_ as ie}from"./smokeA.vue_vue_type_script_setup_true_lang.Cg7zmX1t1758259351508.js";import{_ as ne}from"./rippleMesh.vue_vue_type_script_setup_true_lang.BaQ-hYt31758259351508.js";import{l as ae}from"./utils.Dl9Mu6yL1758259351508.js";import"./postprocessing.DJgHFhS91758259351508.js";import"./@vueuse.C5HLo59K1758259351508.js";import"./@mapbox.B8uYRbGC1758259351508.js";import"./three-mesh-bvh.Bx1dVRfz1758259351508.js";import"./vue-router.BT0ZZbwZ1758259351508.js";import"./lodash-es.C7pWAXPe1758259351508.js";import"./pinia.C_K98KJs1758259351508.js";import"./@qlin.q6OWdsQV1758259351508.js";import"./@babel.BPq7uOAK1758259351508.js";import"./@floating-ui.BFjFSAYt1758259351508.js";import"./@juggle.CcBCnTIR1758259351508.js";import"./object-hash.XWOgmMan1758259351508.js";import"./@amap.CGUF9xH41758259351508.js";import"./jszip.uB4RcRU81758259351508.js";import"./SPE.Dmybfvgh1758259351508.js";const re={renderOrder:3e3},se=["args"],le=["map","side","color"],ue=M({__name:"roadLightByLonLat",props:{geoJson:{},color:{default:"#ffff00"},radius:{default:2},speed:{default:1}},async setup(t){let s,l;const u=t,{map:p}=([s,l]=P((()=>o({map:"./plugins/digitalCity/image/line.png"}))),s=await s,l(),s);p.needsUpdate=!0,p.wrapS=p.wrapT=i,p.repeat.set(1,1);const c=([s,l]=P((()=>ae(u.geoJson))),s=await s,l(),s);let m=[];for(var f=0;f<c.length;f++){const e=c[f],o=[];e.geometry.coordinates.forEach((e=>{const t=N(e[0],e[1],50);o.push(new n(t[0],0,-t[1]))}));let t=u.color;t="primary"===e.properties.highway?"#7eff10":"tertiary"===e.properties.highway?"#0eeeee":"secondary"===e.properties.highway?"#ffffff":"#ff0ffe",m.push({cr3:new a(o),color:t})}const{onLoop:d}=e();return d((()=>{p.offset.x-=Math.random()/20*u.speed})),(e,o)=>(T(),z("TresGroup",null,[(T(!0),z(B,null,S(D(m),(e=>(T(),z("TresMesh",re,[L("TresTubeGeometry",{args:[e.cr3,64,u.radius,20,!1]},null,8,se),L("TresMeshBasicMaterial",{map:D(p),side:D(r),transparent:!0,color:e.color},null,8,le)])))),256))]))}}),pe=e=>{e.onLoadTileSet=o=>{const t=new s,i=new l,a=new u;let r=null,c=0;e.getOrientedBounds(t,a)?(r=(new n).setFromMatrixPosition(a),c=r.length()):e.getBoundingSphere(i)&&(r=i.center.clone(),c=r.length());const m=r?.normalize(),f=((e,o)=>{const t=new p,i=(new n).crossVectors(e,o);return t.x=i.x,t.y=i.y,t.z=i.z,t.w=1+e.clone().dot(o),t.normalize(),t})(m,new n(0,1,0));e.group.quaternion.x=f.x,e.group.quaternion.y=f.y,e.group.quaternion.z=f.z,e.group.quaternion.w=f.w,e.group.position.z=-c}},ce=["object","rotation"],me=M({__name:"tilesBuildings",props:{bulidingsColor:{default:"#e523ff"},topColor:{default:"#ffff00"},opacity:{default:.8},gradient:{type:Boolean,default:!0},camera:{}},setup(o){const i=o,n=O(0),a=new b("https://jdvop.oss-cn-qingdao.aliyuncs.com/mapv-data/titleset/sz_ns/no.json");a.errorTarget=2,a.addEventListener("load-model",(({scene:e})=>{e.traverse((e=>{if(e.isMesh){(e=>{const{geometry:o}=e;o.computeBoundingBox(),o.computeBoundingSphere();const{max:t,min:a}=o.boundingBox,r=new C({baseMaterial:new h,vertexShader:"varying vec3 vPosition;\nvoid main(){\n\t// vPosition=modelMatrix*vec4(position,1.);\n\tvPosition = position;\n\tcsm_Position=position*vec3(1.);\n}",fragmentShader:"varying vec3 vPosition; // 模型空间坐标\nuniform vec3 uMax;      // 模型包围盒最大值\nuniform vec3 uMin;      // 模型包围盒最小值\nuniform float uOpacity;\nuniform float uBorderWidth;\nuniform vec3 uLightColor;\nuniform vec3 uColor;\nuniform float uCircleTime;\nuniform float uTime;\nuniform vec3 uTopColor; // 顶部颜色\nuniform bool uGradient;\n\nvoid main() {\n  vec3 distColor = uColor;\n\n  // 光带流动计算\n  float residue = mod(uTime, uCircleTime);\n  float rate = residue / uCircleTime;\n  float lightOffset = rate * (uMax.z - uMin.z);\n\n  if (uMin.z + lightOffset < vPosition.z &&\n      uMin.z + lightOffset + uBorderWidth > vPosition.z) {\n    csm_DiffuseColor = vec4(uLightColor, uOpacity);\n  } else {\n    csm_DiffuseColor = vec4(distColor, uOpacity);\n  }\n\n  // 渐变计算\n  if (uGradient) {\n    float rateHeight = (vPosition.z - uMin.z) / (uMax.z - uMin.z);\n    float mixNumber = clamp(rateHeight * 2.3 - 1.5, 0.1, 1.);\n    vec3 outColor = mix(csm_DiffuseColor.xyz, uTopColor, mixNumber);\n    csm_DiffuseColor = vec4(outColor, uOpacity);\n  }\n}\n",silent:!0,uniforms:{uMax:{value:t},uMin:{value:a},uBorderWidth:{value:5},uCircleTime:{value:5},uColor:{value:new _(i.bulidingsColor)},uOpacity:{value:i.opacity},uLightColor:{value:new _("#ffffff")},uTopColor:{value:new _(i.topColor)},uTime:n,uGradient:{value:i.gradient}},depthWrite:!0,depthTest:!0,transparent:!0,side:g});e.material.dispose(),e.material=r})(e),e.receiveShadow=!1,e.castShadow=!1;const o=new c(e.geometry.clone());let t=(new m).fromEdgesGeometry(o),a=new f({color:0,linewidth:1,opacity:1,transparent:!0,depthWrite:!0,depthTest:!0});a.resolution.set(window.innerWidth,window.innerHeight);const r=new d(t,a);r.applyMatrix4(e.matrix.clone()),e.parent.add(r)}}));const o=new s,t=new l;a.getBoundingBox(o)?(o.getCenter(a.group.position),a.group.position.multiplyScalar(-1)):a.getBoundingSphere(t)&&(a.group.position.copy(t.center),a.group.position.multiplyScalar(-1))})),pe(a);const{renderer:r,sizes:u}=t();W((()=>{u.width.value&&(a.setCamera(i.camera),a.setResolutionFromRenderer(i.camera,r.value))}));const{onBeforeLoop:p}=e();return p((({delta:e})=>{n.value+=2*e,i.camera&&u.width.value&&(i.camera.updateMatrixWorld(),a.update())})),(e,o)=>(T(),z("TresGroup",null,[L("primitive",{object:D(a).group,rotation:[-Math.PI/2,0,0]},null,8,ce)]))}}),fe=["object","rotation"],de=M({__name:"tileMapBuildingsMesh",props:{bbox:{default:[104.955976,20.149765,120.998419,30.528687]},maxZoom:{default:20},mapCenter:{},camera:{}},setup(o,{expose:i}){const a=o,{renderer:r,scene:s}=t(),l=new I;l.coordType=Z;const u=new J;u.source="https://webrd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",u.showTileNo=!1,u.useWorker=!0;const p=new Q(l,u);p.showBoundingBox=!1,p.wireframe=!1,p.flatShading=!1,p.filter={opposite:!0,genBright:1.3,genContrast:1,genSaturation:1};let c=new _("#4688b5");p.filter.monochrome={r:c.r,g:c.g,b:c.b};const m=new U;m.provider=p,m.bbox=a.bbox,m.maxZoom=a.maxZoom,a.camera.up=new n(0,1,0),a.camera.position.set(a.mapCenter[0],a.mapCenter[2],2e3-a.mapCenter[1]),a.camera.lookAt(new n(a.camera.position.x,0,a.camera.position.z-3e3)),m.camera=a.camera;let f=null;W((()=>{r.value&&(f=new v(a.camera,r.value.domElement),f.enableDamping=!0,f.dampingFactor=.05,f.minDistance=600,f.position0.set(a.camera.position.x,a.camera.position.y,a.camera.position.z),f.target.set(a.camera.position.x,0,a.camera.position.z-2e3))}));const{onLoop:d}=e();return d((()=>{if(r.value){const e=50*Math.abs(a.camera.position.y);a.camera.far=e+5e3,a.camera.updateProjectionMatrix(),f&&(f.update(),f.target.y=0),m.update(),r.value.render(s.value,a.camera)}})),i({camera:a.camera,map:m}),(e,o)=>(T(),z("primitive",{object:D(m),rotation:[-Math.PI/2,0,0]},null,8,fe))}}),ge=M({__name:"mapBuildingsMoreMeshes",props:{cPosition:{}},setup(e){const o=N(113.9456,22.5385,50),t=N(113.9498,22.5364,50);return(e,i)=>(T(),z(B,null,[G(D(X),{color:"#00c0ff",radius:300,size:300,position:[e.cPosition[0],8,-e.cPosition[1]]},null,8,["position"]),(T(),q(E,null,{default:A((()=>[G(D(ee),{position:[e.cPosition[0],8,-e.cPosition[1]],scale:.13,img:"./plugins/digitalCity/image/znsba.png",foremost:!1},null,8,["position"])])),_:1})),G(D(Y),{position:[e.cPosition[0]+700,10,300-e.cPosition[1]],color:"#ffff00",height:180,maxRadius:400},null,8,["position"]),(T(),q(E,null,{default:A((()=>[G(D(ee),{position:[e.cPosition[0]+700,10,300-e.cPosition[1]],scale:200,img:"./plugins/digitalCity/image/znsb-err.png",sizeAttenuation:!0,foremost:!0},null,8,["position"])])),_:1})),(T(),q(E,null,{default:A((()=>[G(D(oe),{fireScale:80,magnitude:1.3,lacunarity:2,gain:1,position:[e.cPosition[0]+280,1,120-e.cPosition[1]]},null,8,["position"])])),_:1})),(T(),q(E,null,{default:A((()=>[G(D(te),{position:[e.cPosition[0]+388,6,330-e.cPosition[1]]},null,8,["position"])])),_:1})),(T(),q(E,null,{default:A((()=>[G(D(ie),{position:[e.cPosition[0]+388,6,330-e.cPosition[1]]},null,8,["position"])])),_:1})),(T(),q(E,null,{default:A((()=>[G(D(K),{speed:12,size:20,count:2e4,color:"#fff",type:"snow",position:[e.cPosition[0],300,-e.cPosition[1]],areaX:5e3,areaY:600,areaZ:5e3},null,8,["position"])])),_:1})),(T(),q(E,null,{default:A((()=>[G(D($),{cPosition:[e.cPosition[0],600,-e.cPosition[1]]},null,8,["cPosition"])])),_:1})),G(D(ne),{"position-y":6,positionSrc:[{x:D(o)[0],y:-D(o)[1]},{x:D(o)[0],y:-D(t)[1]},{x:D(t)[0],y:-D(t)[1]},{x:D(t)[0],y:-D(o)[1]},{x:D(o)[0],y:-D(o)[1]}],height:220,color:"#00ffdd"},null,8,["positionSrc"]),(T(),q(E,null,{default:A((()=>[G(D(ue),{position:[500,0,340],radius:5,geoJson:"plugins/digitalCity/geojson/shenzhen2.geojson"})])),_:1}))],64))}}),_e=M({__name:"mapBuildings",setup(e){const o=N(113.942639739199,22.53171672540276,50),t=H(),i=R({clearColor:"#000000",renderMode:"manual",alpha:!1,shadowMapType:j,outputColorSpace:w,toneMapping:y}),n=[o[0],o[1],1700],a=new x(60,window.innerWidth/window.innerHeight,1,1e8);return(e,r)=>{const s=k("TresCanvas");return T(),z(B,null,[G(s,F(i,{"window-size":""}),{default:A((()=>[r[0]||(r[0]=L("TresAmbientLight",{color:"#ffffff"},null,-1)),r[1]||(r[1]=L("TresDirectionalLight",{position:[100,100,0],intensity:.5,color:"#ffffff"},null,-1)),G(D(me),{position:[D(o)[0],1,228-D(o)[1]],camera:D(a)},null,8,["position","camera"]),(T(),q(E,null,{default:A((()=>[G(D(de),{ref_key:"tileMapBuildingsMeshRef",ref:t,bbox:[104.955976,20.149765,120.998419,30.528687],mapCenter:n,camera:D(a)},null,8,["camera"])])),_:1})),(T(),q(E,null,{default:A((()=>[G(ge,{cPosition:D(o)},null,8,["cPosition"])])),_:1})),r[2]||(r[2]=L("TresGridHelper",{args:[1e4,10]},null,-1)),r[3]||(r[3]=L("TresAxesHelper",{args:[1e5]},null,-1))])),_:1},16),G(V,{tileMapRef:t.value},null,8,["tileMapRef"])],64)}}});export{_e as default};
