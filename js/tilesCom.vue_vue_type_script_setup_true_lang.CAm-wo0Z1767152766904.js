import{importShared as e,Ai as o}from"./3d-tiles-renderer.CPyPbRB51767152766904.js";import{useTres as t,useLoop as i}from"./index.BGo9PN8R1767152766904.js";import{applyTransform as r,alignmentCenter as n}from"./utils.B7bnzMW-1767152766904.js";import{B as a}from"./three-custom-shader-material.es.BQ3BFm2M1767152766904.js";import{LineMaterial as l,LineSegmentsGeometry as u,LineSegments2 as s}from"./LineSegments2.D7q7jdy-1767152766904.js";var d="varying vec3 vPosition;\nvoid main(){\n\t\n\tvPosition = position;\n\tcsm_Position=position*vec3(1.);\n}",m="varying vec3 vPosition; \nuniform vec3 uMax;      \nuniform vec3 uMin;      \nuniform float uOpacity;\nuniform float uBorderWidth;\nuniform vec3 uLightColor;\nuniform vec3 uColor;\nuniform float uCircleTime;\nuniform float uTime;\nuniform vec3 uTopColor; \nuniform bool uGradient;\n\nvoid main() {\n  vec3 distColor = uColor;\n\n  \n  float residue = mod(uTime, uCircleTime);\n  float rate = residue / uCircleTime;\n  float lightOffset = rate * (uMax.z - uMin.z);\n\n  if (uMin.z + lightOffset < vPosition.z &&\n      uMin.z + lightOffset + uBorderWidth > vPosition.z) {\n    csm_DiffuseColor = vec4(uLightColor, uOpacity);\n  } else {\n    csm_DiffuseColor = vec4(distColor, uOpacity);\n  }\n\n  \n  if (uGradient) {\n    float rateHeight = (vPosition.z - uMin.z) / (uMax.z - uMin.z);\n    float mixNumber = clamp(rateHeight * 2.3 - 1.5, 0.1, 1.);\n    vec3 outColor = mix(csm_DiffuseColor.xyz, uTopColor, mixNumber);\n    csm_DiffuseColor = vec4(outColor, uOpacity);\n  }\n}";const{defineComponent:f}=await e("vue"),{unref:p,createElementVNode:c,openBlock:v,createElementBlock:h}=await e("vue"),C=["rotation-x"],g=["object"],{watch:y}=await e("vue"),w=await e("three"),x=f({__name:"tilesCom",props:{tilesUrl:{default:"./plugins/geokit/tiles/tileset.json"},isRotation:{type:Boolean,default:!0},isRranslation:{type:Boolean,default:!0},bulidingsColor:{default:"#e523ff"},topColor:{default:"#ffff00"},lightColor:{default:"#ffffff"},borderWidth:{default:5},opacity:{default:.8},gradient:{type:Boolean,default:!0},speed:{default:1},lineOpacity:{default:1},linewidth:{default:1},lineColor:{default:"#000000"}},setup(e){const f=e,x={value:0},M=new l({color:f.lineColor,linewidth:f.linewidth,opacity:f.lineOpacity,transparent:!0,depthWrite:!1,depthTest:!0});M.resolution.set(window.innerWidth,window.innerHeight);const b=({scene:e})=>{e.traverse(e=>{e.isMesh&&e.material&&((e=>{e.userData.builds=!0;const{geometry:o}=e;o.computeBoundingBox(),o.computeBoundingSphere();const{max:t,min:i}=o.boundingBox,r=new a({baseMaterial:new w.MeshPhongMaterial,vertexShader:d,fragmentShader:m,silent:!0,uniforms:{uMax:{value:t},uMin:{value:i},uBorderWidth:{value:f.borderWidth},uCircleTime:{value:5},uColor:{value:new w.Color(f.bulidingsColor)},uOpacity:{value:f.opacity},uLightColor:{value:new w.Color(f.lightColor)},uTopColor:{value:new w.Color(f.topColor)},uTime:x,uGradient:{value:f.gradient}},depthWrite:!0,depthTest:!0,transparent:!0,side:w.DoubleSide});e.material.dispose(),e.material=r})(e),(e=>{const o=new w.EdgesGeometry(e.geometry.clone());let t=(new u).fromEdgesGeometry(o);const i=new s(t,M);i.userData.lines=!0,i.applyMatrix4(e.matrix.clone()),e.parent.add(i)})(e))})},{camera:T,renderer:B,sizes:O}=t(),R=(e,o,t)=>{e.setCamera(o),e.setResolutionFromRenderer(o,t)},z=()=>{let e=new o(f.tilesUrl);return e.fetchOptions.mode="cors",e.errorTarget=12,e.addEventListener("load-model",b),e.addEventListener("load-tile-set",()=>{n(e,f.isRotation,f.isRranslation)}),e.addEventListener("dispose-model",({scene:e})=>{e.traverse(e=>{e.material&&e.material.dispose(),e.userData&&e.userData.lines&&(e.geometry.dispose(),e.material.dispose())})}),R(e,T.value,B),e};let D=z();y(T,()=>{T.value&&R(D,T.value,B)},{immediate:!0});const{onBeforeRender:W}=i();return W(({delta:e})=>{T.value&&O.width.value&&D.update&&(T.value.updateMatrixWorld(),D.update(),x.value+=e*f.speed)}),y(()=>[f.bulidingsColor,f.topColor,f.lightColor,f.borderWidth,f.opacity,f.gradient],([e,o,t,i,r])=>{D.group.traverse(n=>{n.isMesh&&n.userData&&n.userData.builds&&(n.material.uniforms.uColor.value.set(e),n.material.uniforms.uTopColor.value.set(o),n.material.uniforms.uLightColor.value.set(t),n.material.uniforms.uBorderWidth.value=i,n.material.uniforms.uOpacity.value=r,n.material.uniforms.uGradient.value=f.gradient,n.material.needsUpdate=!0)})}),y(()=>[f.lineColor,f.linewidth,f.lineOpacity],([e,o,t])=>{M.color.set(e),M.linewidth=o,M.opacity=t,M.needsUpdate=!0}),y(()=>f.tilesUrl,e=>{e!==D.rootURL&&(D.dispose(),D=z())}),y(()=>[f.isRotation,f.isRranslation],()=>{D.group&&r(D.group,f.isRotation,f.isRranslation)}),(e,o)=>(v(),h("TresGroup",{"rotation-x":e.isRotation?-Math.PI/2:0},[c("primitive",{object:p(D).group},null,8,g)],8,C))}});export{x as _sfc_main,m as buildingsShaderMaterial_default,d as buildingsShaderMaterial_default$1};
