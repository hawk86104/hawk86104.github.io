import{importShared as e}from"./3d-tiles-renderer.CPyPbRB51767152766904.js";import{OrbitControls_default as t}from"./index.BGo9PN8R1767152766904.js";import{Pane as a}from"./tweakpane.BbuIEN141767152766904.js";import"./customShaderMaterial.vue_vue_type_script_setup_true_lang.Dh0yXqlp1767152766904.js";import"./index.vue_vue_type_script_setup_true_lang.C2TY6ijJ1767152766904.js";import{useGLTF as n}from"./index.vUNGB6xt1767152766904.js";import{h337 as o}from"./heatmap.BFLU3W391767152766904.js";const{withAsyncContext:r,defineComponent:i}=await e("vue"),{unref:s,openBlock:l,createElementBlock:u}=await e("vue"),p=["object"],d=await e("three"),{watchEffect:c,toRaw:m}=await e("vue"),v=i({__name:"heatmapClickCom",props:{show2dCanvas:{type:Boolean,default:!0},radius:{default:20}},async setup(e){let t,a;const i=e,{nodes:v}=([t,a]=r(()=>n("https://opensource.cdn.icegl.cn/model/heatmap/test.glb")),t=await t,a(),t);v.mesh_0.position.set(-5088.96,-3.08,39374.7),v.mesh_0.scale.setScalar(.01);let h=null,f=null,w=null;f=new d.Texture((w=document.createElement("heatmap-canvas"),w.style.position="absolute",w.style.top="40px",w.style.left="0",document.body.appendChild(w),h=o.create({container:w,width:256,height:256,blur:"0.8",radius:i.radius}),h._renderer.canvas.style.border="1px solid #5384ff",h._renderer.canvas.onclick=function(e){h.addData({x:e.layerX,y:e.layerY,value:1,radius:i.radius}),h.setDataMax(1),f&&(f.needsUpdate=!0)},h)._renderer.canvas);const g={vertexShader:"\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t\tvUv = uv;\n\t}\n\t",fragmentShader:"\n\tuniform sampler2D heightMap;\n\tuniform float uOpacity;\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tgl_FragColor = vec4(texture2D(heightMap, vUv.xy).rgb, uOpacity);\n\t}\n\t",uniforms:{uOpacity:{value:1},heightMap:{type:"t",value:f}},depthWrite:!0,depthTest:!0,transparent:!0,side:d.DoubleSide},_=new d.ShaderMaterial(g);v.mesh_0.material=_;return(e=>{e.computeBoundingBox();const{max:t,min:a}=e.boundingBox;e.deleteAttribute("uv");const n=t.x-a.x,o=t.z-a.z,r=[];for(let s=0;s<e.attributes.position.count;s++)r.push((e.attributes.position.getX(s)-a.x)/n),r.push((e.attributes.position.getZ(s)-a.z)/o);const i=new Float32Array(r);e.setAttribute("uv",new d.BufferAttribute(i,2))})(v.mesh_0.geometry),c(()=>{w.style.display=""+(i.show2dCanvas?"block":"none")}),(e,t)=>(l(),u("primitive",{object:m(s(v).mesh_0)},null,8,p))}}),{defineComponent:h}=await e("vue"),{createElementVNode:f,unref:w,createVNode:g,normalizeProps:_,guardReactiveProps:y,Suspense:x,withCtx:C,openBlock:b,createBlock:B,resolveComponent:S,mergeProps:j}=await e("vue"),{PCFSoftShadowMap:M,SRGBColorSpace:k}=await e("three"),{reactive:T}=await e("vue"),D=h({__name:"heatmapClick",setup(e){const n={clearColor:"#030311",shadows:!0,alpha:!0,outputColorSpace:k,shadowMapType:M,useLegacyLights:!0,antialias:!0},o=T({show2dCanvas:!0,radius:20}),r=new a({title:"参数",expanded:!0});return r.addBinding(o,"show2dCanvas",{label:"显示二维图"}),r.addBinding(o,"radius",{label:"圆圈的大小",min:.1,max:30,step:.1}),r.addButton({title:"点击左侧蓝色画框"}),(e,a)=>{const r=S("TresCanvas");return b(),B(r,j(n,{"window-size":""}),{default:C(()=>[a[0]||(a[0]=f("TresPerspectiveCamera",{position:[21,34,55],fov:60,near:1,far:1e5},null,-1)),g(w(t),{autoRotate:!1,autoRotateSpeed:2}),a[1]||(a[1]=f("TresDirectionalLight",{position:[5,10,7.5],color:"#ffffff",intensity:5},null,-1)),a[2]||(a[2]=f("TresGridHelper",{args:[50,25]},null,-1)),(b(),B(x,null,{default:C(()=>[g(v,_(y(o)),null,16)]),_:1}))]),_:1},16)}}});export{D as default};
