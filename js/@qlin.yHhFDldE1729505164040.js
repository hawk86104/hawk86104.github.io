var t=Object.defineProperty,e=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,a=(e,r,n)=>r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n,i=(t,e)=>{for(var r in e||(e={}))o.call(e,r)&&a(t,r,e[r]);if(n)for(var r of n(e))c.call(e,r)&&a(t,r,e[r]);return t};class u{constructor(){this.middlewares=[]}use(t){return this.middlewares.push(t),this}compose(){return(t,e)=>{let r=-1;const n=o=>{if(o<=r)return Promise.reject(new Error("next() called multiple times"));r=o;let c=this.middlewares[o];if(r===this.middlewares.length&&(c=e),!c)return Promise.resolve();try{return Promise.resolve(c(t,n.bind(null,o+1)))}catch(a){return Promise.reject(a)}};return n(0)}}}const s=async(t,e)=>{t.config.method?t.config.method=t.config.method.toUpperCase():t.config.method="POST",await e()};const f="object"==typeof global&&global&&global.Object===Object&&global;var l="object"==typeof self&&self&&self.Object===Object&&self;const p=f||l||Function("return this")();const y=p.Symbol;var h=Object.prototype,b=h.hasOwnProperty,d=h.toString,v=y?y.toStringTag:void 0;var g=Object.prototype.toString;var j="[object Null]",m="[object Undefined]",w=y?y.toStringTag:void 0;function _(t){return null==t?void 0===t?m:j:w&&w in Object(t)?function(t){var e=b.call(t,v),r=t[v];try{t[v]=void 0;var n=!0}catch(c){}var o=d.call(t);return n&&(e?t[v]=r:delete t[v]),o}(t):function(t){return g.call(t)}(t)}function O(t){return null!=t&&"object"==typeof t}var A="[object Symbol]";function S(t){return"symbol"==typeof t||O(t)&&_(t)==A}function T(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}const P=Array.isArray;var x=1/0,k=y?y.prototype:void 0,E=k?k.toString:void 0;function I(t){if("string"==typeof t)return t;if(P(t))return T(t,I)+"";if(S(t))return E?E.call(t):"";var e=t+"";return"0"==e&&1/t==-x?"-0":e}function q(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var z="[object AsyncFunction]",U="[object Function]",D="[object GeneratorFunction]",M="[object Proxy]";function C(t){if(!q(t))return!1;var e=_(t);return e==U||e==D||e==z||e==M}const F=p["__core-js_shared__"];var R,B=(R=/[^.]+$/.exec(F&&F.keys&&F.keys.IE_PROTO||""))?"Symbol(src)_1."+R:"";var H=Function.prototype.toString;function $(t){if(null!=t){try{return H.call(t)}catch(e){}try{return t+""}catch(e){}}return""}var L=/^\[object .+?Constructor\]$/,N=Function.prototype,V=Object.prototype,W=N.toString,J=V.hasOwnProperty,G=RegExp("^"+W.call(J).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Q(t){return!(!q(t)||function(t){return!!B&&B in t}(t))&&(C(t)?G:L).test($(t))}function K(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return Q(r)?r:void 0}const X=K(p,"WeakMap");var Y=Object.create,Z=function(){function t(){}return function(e){if(!q(e))return{};if(Y)return Y(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();const tt=Z;var et=Date.now;function rt(t){return function(){return t}}var nt=function(){try{var t=K(Object,"defineProperty");return t({},"",{}),t}catch(e){}}();const ot=nt;var ct=ot?function(t,e){return ot(t,"toString",{configurable:!0,enumerable:!1,value:rt(e),writable:!0})}:function(t){return t};var at=function(t){var e=0,r=0;return function(){var n=et(),o=16-(n-r);if(r=n,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(ct);const it=at;var ut=9007199254740991,st=/^(?:0|[1-9]\d*)$/;function ft(t,e){var r=typeof t;return!!(e=null!=e?e:ut)&&("number"==r||"symbol"!=r&&st.test(t))&&t>-1&&t%1==0&&t<e}function lt(t,e,r){"__proto__"==e&&ot?ot(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}function pt(t,e){return t===e||t!=t&&e!=e}var yt=Object.prototype.hasOwnProperty;function ht(t,e,r){var n=t[e];(!yt.call(t,e)||!pt(n,r)||void 0===r&&!(e in t))&&lt(t,e,r)}function bt(t,e,r,n){var o=!r;r||(r={});for(var c=-1,a=e.length;++c<a;){var i=e[c],u=n?n(r[i],t[i],i,r,t):void 0;void 0===u&&(u=t[i]),o?lt(r,i,u):ht(r,i,u)}return r}var dt=Math.max;var vt=9007199254740991;function gt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=vt}function jt(t){return null!=t&&gt(t.length)&&!C(t)}var mt=Object.prototype;function wt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||mt)}function _t(t){return O(t)&&"[object Arguments]"==_(t)}var Ot=Object.prototype,At=Ot.hasOwnProperty,St=Ot.propertyIsEnumerable,Tt=_t(function(){return arguments}())?_t:function(t){return O(t)&&At.call(t,"callee")&&!St.call(t,"callee")};const Pt=Tt;var xt="object"==typeof exports&&exports&&!exports.nodeType&&exports,kt=xt&&"object"==typeof module&&module&&!module.nodeType&&module,Et=kt&&kt.exports===xt?p.Buffer:void 0;const It=(Et?Et.isBuffer:void 0)||function(){return!1};var qt={};function zt(t){return function(e){return t(e)}}qt["[object Float32Array]"]=qt["[object Float64Array]"]=qt["[object Int8Array]"]=qt["[object Int16Array]"]=qt["[object Int32Array]"]=qt["[object Uint8Array]"]=qt["[object Uint8ClampedArray]"]=qt["[object Uint16Array]"]=qt["[object Uint32Array]"]=!0,qt["[object Arguments]"]=qt["[object Array]"]=qt["[object ArrayBuffer]"]=qt["[object Boolean]"]=qt["[object DataView]"]=qt["[object Date]"]=qt["[object Error]"]=qt["[object Function]"]=qt["[object Map]"]=qt["[object Number]"]=qt["[object Object]"]=qt["[object RegExp]"]=qt["[object Set]"]=qt["[object String]"]=qt["[object WeakMap]"]=!1;var Ut="object"==typeof exports&&exports&&!exports.nodeType&&exports,Dt=Ut&&"object"==typeof module&&module&&!module.nodeType&&module,Mt=Dt&&Dt.exports===Ut&&f.process;const Ct=function(){try{return Dt&&Dt.require&&Dt.require("util").types||Mt&&Mt.binding&&Mt.binding("util")}catch(t){}}();var Ft=Ct&&Ct.isTypedArray,Rt=Ft?zt(Ft):function(t){return O(t)&&gt(t.length)&&!!qt[_(t)]};const Bt=Rt;var Ht=Object.prototype.hasOwnProperty;function $t(t,e){var r=P(t),n=!r&&Pt(t),o=!r&&!n&&It(t),c=!r&&!n&&!o&&Bt(t),a=r||n||o||c,i=a?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],u=i.length;for(var s in t)(e||Ht.call(t,s))&&(!a||!("length"==s||o&&("offset"==s||"parent"==s)||c&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||ft(s,u)))&&i.push(s);return i}function Lt(t,e){return function(r){return t(e(r))}}const Nt=Lt(Object.keys,Object);var Vt=Object.prototype.hasOwnProperty;function Wt(t){return jt(t)?$t(t):function(t){if(!wt(t))return Nt(t);var e=[];for(var r in Object(t))Vt.call(t,r)&&"constructor"!=r&&e.push(r);return e}(t)}var Jt=Object.prototype.hasOwnProperty;function Gt(t){if(!q(t))return function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}(t);var e=wt(t),r=[];for(var n in t)"constructor"==n&&(e||!Jt.call(t,n))||r.push(n);return r}function Qt(t){return jt(t)?$t(t,!0):Gt(t)}var Kt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Xt=/^\w*$/;const Yt=K(Object,"create");var Zt=Object.prototype.hasOwnProperty;var te=Object.prototype.hasOwnProperty;function ee(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function re(t,e){for(var r=t.length;r--;)if(pt(t[r][0],e))return r;return-1}ee.prototype.clear=function(){this.__data__=Yt?Yt(null):{},this.size=0},ee.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},ee.prototype.get=function(t){var e=this.__data__;if(Yt){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return Zt.call(e,t)?e[t]:void 0},ee.prototype.has=function(t){var e=this.__data__;return Yt?void 0!==e[t]:te.call(e,t)},ee.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Yt&&void 0===e?"__lodash_hash_undefined__":e,this};var ne=Array.prototype.splice;function oe(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}oe.prototype.clear=function(){this.__data__=[],this.size=0},oe.prototype.delete=function(t){var e=this.__data__,r=re(e,t);return!(r<0)&&(r==e.length-1?e.pop():ne.call(e,r,1),--this.size,!0)},oe.prototype.get=function(t){var e=this.__data__,r=re(e,t);return r<0?void 0:e[r][1]},oe.prototype.has=function(t){return re(this.__data__,t)>-1},oe.prototype.set=function(t,e){var r=this.__data__,n=re(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};const ce=K(p,"Map");function ae(t,e){var r=t.__data__;return function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}(e)?r["string"==typeof e?"string":"hash"]:r.map}function ie(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ie.prototype.clear=function(){this.size=0,this.__data__={hash:new ee,map:new(ce||oe),string:new ee}},ie.prototype.delete=function(t){var e=ae(this,t).delete(t);return this.size-=e?1:0,e},ie.prototype.get=function(t){return ae(this,t).get(t)},ie.prototype.has=function(t){return ae(this,t).has(t)},ie.prototype.set=function(t,e){var r=ae(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};var ue="Expected a function";function se(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(ue);var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],c=r.cache;if(c.has(o))return c.get(o);var a=t.apply(this,n);return r.cache=c.set(o,a)||c,a};return r.cache=new(se.Cache||ie),r}se.Cache=ie;var fe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,le=/\\(\\)?/g,pe=function(t){var e=se(t,(function(t){return 500===r.size&&r.clear(),t})),r=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(fe,(function(t,r,n,o){e.push(n?o.replace(le,"$1"):r||t)})),e}));const ye=pe;function he(t,e){return P(t)?t:function(t,e){if(P(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!S(t))||Xt.test(t)||!Kt.test(t)||null!=e&&t in Object(e)}(t,e)?[t]:ye(function(t){return null==t?"":I(t)}(t))}var be=1/0;function de(t){if("string"==typeof t||S(t))return t;var e=t+"";return"0"==e&&1/t==-be?"-0":e}function ve(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}var ge=y?y.isConcatSpreadable:void 0;function je(t){return P(t)||Pt(t)||!!(ge&&t&&t[ge])}function me(t,e,r,n,o){var c=-1,a=t.length;for(r||(r=je),o||(o=[]);++c<a;){var i=t[c];e>0&&r(i)?e>1?me(i,e-1,r,n,o):ve(o,i):n||(o[o.length]=i)}return o}function we(t){return(null==t?0:t.length)?me(t,1):[]}const _e=Lt(Object.getPrototypeOf,Object);var Oe="[object Object]",Ae=Function.prototype,Se=Object.prototype,Te=Ae.toString,Pe=Se.hasOwnProperty,xe=Te.call(Object);function ke(t){if(!O(t)||_(t)!=Oe)return!1;var e=_e(t);if(null===e)return!0;var r=Pe.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&Te.call(r)==xe}function Ee(t){var e=this.__data__=new oe(t);this.size=e.size}Ee.prototype.clear=function(){this.__data__=new oe,this.size=0},Ee.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},Ee.prototype.get=function(t){return this.__data__.get(t)},Ee.prototype.has=function(t){return this.__data__.has(t)},Ee.prototype.set=function(t,e){var r=this.__data__;if(r instanceof oe){var n=r.__data__;if(!ce||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new ie(n)}return r.set(t,e),this.size=r.size,this};var Ie="object"==typeof exports&&exports&&!exports.nodeType&&exports,qe=Ie&&"object"==typeof module&&module&&!module.nodeType&&module,ze=qe&&qe.exports===Ie?p.Buffer:void 0,Ue=ze?ze.allocUnsafe:void 0;function De(){return[]}var Me=Object.prototype.propertyIsEnumerable,Ce=Object.getOwnPropertySymbols,Fe=Ce?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,c=[];++r<n;){var a=t[r];e(a,r,t)&&(c[o++]=a)}return c}(Ce(t),(function(e){return Me.call(t,e)})))}:De;const Re=Fe;var Be=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)ve(e,Re(t)),t=_e(t);return e}:De;const He=Be;function $e(t,e,r){var n=e(t);return P(t)?n:ve(n,r(t))}function Le(t){return $e(t,Wt,Re)}function Ne(t){return $e(t,Qt,He)}const Ve=K(p,"DataView");const We=K(p,"Promise");const Je=K(p,"Set");var Ge="[object Map]",Qe="[object Promise]",Ke="[object Set]",Xe="[object WeakMap]",Ye="[object DataView]",Ze=$(Ve),tr=$(ce),er=$(We),rr=$(Je),nr=$(X),or=_;(Ve&&or(new Ve(new ArrayBuffer(1)))!=Ye||ce&&or(new ce)!=Ge||We&&or(We.resolve())!=Qe||Je&&or(new Je)!=Ke||X&&or(new X)!=Xe)&&(or=function(t){var e=_(t),r="[object Object]"==e?t.constructor:void 0,n=r?$(r):"";if(n)switch(n){case Ze:return Ye;case tr:return Ge;case er:return Qe;case rr:return Ke;case nr:return Xe}return e});const cr=or;var ar=Object.prototype.hasOwnProperty;const ir=p.Uint8Array;function ur(t){var e=new t.constructor(t.byteLength);return new ir(e).set(new ir(t)),e}var sr=/\w*$/;var fr=y?y.prototype:void 0,lr=fr?fr.valueOf:void 0;var pr="[object Boolean]",yr="[object Date]",hr="[object Map]",br="[object Number]",dr="[object RegExp]",vr="[object Set]",gr="[object String]",jr="[object Symbol]",mr="[object ArrayBuffer]",wr="[object DataView]",_r="[object Float32Array]",Or="[object Float64Array]",Ar="[object Int8Array]",Sr="[object Int16Array]",Tr="[object Int32Array]",Pr="[object Uint8Array]",xr="[object Uint8ClampedArray]",kr="[object Uint16Array]",Er="[object Uint32Array]";function Ir(t,e,r){var n=t.constructor;switch(e){case mr:return ur(t);case pr:case yr:return new n(+t);case wr:return function(t,e){var r=e?ur(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}(t,r);case _r:case Or:case Ar:case Sr:case Tr:case Pr:case xr:case kr:case Er:return function(t,e){var r=e?ur(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}(t,r);case hr:return new n;case br:case gr:return new n(t);case dr:return function(t){var e=new t.constructor(t.source,sr.exec(t));return e.lastIndex=t.lastIndex,e}(t);case vr:return new n;case jr:return function(t){return lr?Object(lr.call(t)):{}}(t)}}var qr=Ct&&Ct.isMap,zr=qr?zt(qr):function(t){return O(t)&&"[object Map]"==cr(t)};const Ur=zr;var Dr=Ct&&Ct.isSet,Mr=Dr?zt(Dr):function(t){return O(t)&&"[object Set]"==cr(t)};const Cr=Mr;var Fr="[object Arguments]",Rr="[object Function]",Br="[object Object]",Hr={};function $r(t,e,r,n,o,c){var a,i=1&e,u=2&e,s=4&e;if(r&&(a=o?r(t,n,o,c):r(t)),void 0!==a)return a;if(!q(t))return t;var f=P(t);if(f){if(a=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&ar.call(t,"index")&&(r.index=t.index,r.input=t.input),r}(t),!i)return function(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}(t,a)}else{var l=cr(t),p=l==Rr||"[object GeneratorFunction]"==l;if(It(t))return function(t,e){if(e)return t.slice();var r=t.length,n=Ue?Ue(r):new t.constructor(r);return t.copy(n),n}(t,i);if(l==Br||l==Fr||p&&!o){if(a=u||p?{}:function(t){return"function"!=typeof t.constructor||wt(t)?{}:tt(_e(t))}(t),!i)return u?function(t,e){return bt(t,He(t),e)}(t,function(t,e){return t&&bt(e,Qt(e),t)}(a,t)):function(t,e){return bt(t,Re(t),e)}(t,function(t,e){return t&&bt(e,Wt(e),t)}(a,t))}else{if(!Hr[l])return o?t:{};a=Ir(t,l,i)}}c||(c=new Ee);var y=c.get(t);if(y)return y;c.set(t,a),Cr(t)?t.forEach((function(n){a.add($r(n,e,r,n,t,c))})):Ur(t)&&t.forEach((function(n,o){a.set(o,$r(n,e,r,o,t,c))}));var h=f?void 0:(s?u?Ne:Le:u?Qt:Wt)(t);return function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););}(h||t,(function(n,o){h&&(n=t[o=n]),ht(a,o,$r(n,e,r,o,t,c))})),a}Hr[Fr]=Hr["[object Array]"]=Hr["[object ArrayBuffer]"]=Hr["[object DataView]"]=Hr["[object Boolean]"]=Hr["[object Date]"]=Hr["[object Float32Array]"]=Hr["[object Float64Array]"]=Hr["[object Int8Array]"]=Hr["[object Int16Array]"]=Hr["[object Int32Array]"]=Hr["[object Map]"]=Hr["[object Number]"]=Hr[Br]=Hr["[object RegExp]"]=Hr["[object Set]"]=Hr["[object String]"]=Hr["[object Symbol]"]=Hr["[object Uint8Array]"]=Hr["[object Uint8ClampedArray]"]=Hr["[object Uint16Array]"]=Hr["[object Uint32Array]"]=!0,Hr["[object Error]"]=Hr[Rr]=Hr["[object WeakMap]"]=!1;var Lr="[object String]";function Nr(t,e){return e.length<2?t:function(t,e){for(var r=0,n=(e=he(e,t)).length;null!=t&&r<n;)t=t[de(e[r++])];return r&&r==n?t:void 0}(t,function(t,e,r){var n=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(r=r>o?o:r)<0&&(r+=o),o=e>r?0:r-e>>>0,e>>>=0;for(var c=Array(o);++n<o;)c[n]=t[n+e];return c}(e,0,-1))}function Vr(t,e){return null==(t=Nr(t,e=he(e,t)))||delete t[de(function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0}(e))]}function Wr(t){return ke(t)?void 0:t}var Jr=function(t){return it(function(t,e,r){return e=dt(void 0===e?t.length-1:e,0),function(){for(var n=arguments,o=-1,c=dt(n.length-e,0),a=Array(c);++o<c;)a[o]=n[e+o];o=-1;for(var i=Array(e+1);++o<e;)i[o]=n[o];return i[e]=r(a),function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}(t,this,i)}}(t,void 0,we),t+"")}((function(t,e){var r={};if(null==t)return r;var n=!1;e=T(e,(function(e){return e=he(e,t),n||(n=e.length>1),e})),bt(t,Ne(t),r),n&&(r=$r(r,7,Wr));for(var o=e.length;o--;)Vr(r,e[o]);return r}));const Gr=Jr;function Qr(t){return"[object URLSearchParams]"===Object.prototype.toString.call(t)}function Kr(t){return{GET:{request_body:!1},POST:{request_body:!0},PUT:{request_body:!0},DELETE:{request_body:!0},HEAD:{request_body:!1},OPTIONS:{request_body:!1},PATCH:{request_body:!0}}[t=t.toUpperCase()].request_body}function Xr(t){ke(t)&&Object.entries(t).forEach((([e,r])=>{"string"==typeof r?t[e]=r.trim():ke(r)&&Xr(r)}))}const Yr=async(t,e)=>{Kr(t.config.method)&&Xr(t.config.params),await e()};const Zr=async(t,e)=>{t.reqHeaders=new Headers(t.config.headers),t.reqHeaders.has("Content-Type")||(t.config.params instanceof FormData?function(t){for(const[e,r]of t.entries())if(r instanceof Blob)return!0;return!1}(t.config.params)||t.reqHeaders.set("Content-Type","application/x-www-form-urlencoded"):ke(t.config.params)&&t.reqHeaders.set("Content-Type","application/json")),await e()};const tn=async(t,e)=>{t.config.baseURL&&!function(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}(t.config.url)&&(t.config.url=function(t,e){return e?"".concat(t.replace(/\/+$/,""),"/").concat(e.replace(/^\/+/,"")):t}(t.config.baseURL,t.config.url)),await e()},en=t=>Qr(t)?t.toString():"string"==typeof t?t:ke(t)?JSON.stringify(t):"";async function rn(t,e){if(t.config.params){const e=en(t.config.params);e&&(t.key="".concat(t.config.url).concat(e).concat(t.config.method))}else t.key="".concat(t.config.url).concat(t.config.method);await e()}const nn=()=>{const t=new Map,e=new Map,r=new Map;return async(n,o)=>{if(n.key)if(n.config.mergeRequest){const t=await function(t){if(e.get(t.key))return new Promise((e=>{const n=r.get(t.key)||[];r.set(t.key,n.concat(e))}));e.set(t.key,!0)}(n);if(t)return void Object.keys(t).forEach((e=>{n[e]=t[e]}))}else{if(t.get(n.key)&&!n.config.mergeRequest)return void(n.error={type:"REPEAT",msg:"重复请求"});t.set(n.key,!0)}await o(),n.key&&(n.config.mergeRequest?function(t){const n=r.get(t.key);n&&n.length>0&&n.forEach((e=>{t.error?e({error:t.error}):e({response:t.response})})),r.delete(t.key),e.delete(t.key)}(n):t.delete(n.key))}},on="__REQUEST_CACHE:",cn={ram:"ram",session:"sessionStorage",local:"localStorage"},an=18e4;function un(t,e="ram"){return e!==cn.ram?"".concat(on).concat(t):t}function sn(t){return ke(t)||function(t){return"string"==typeof t||!P(t)&&O(t)&&_(t)==Lr}(t)||Array.isArray(t)||Qr(t)}function fn({expire:t,cacheTime:e}){return!(!e||t>=Date.now())}class ln{constructor(){this.data=new Map}get(t){const e=this.data.get(t);return e&&fn(e)?(this.data.delete(t),null):e?e.data:null}set(t,e){this.data.forEach(((t,e,r)=>{fn(t)&&r.delete(e)})),this.data.size>1e3?console.warn("Request: raw cache is exceed 1000 item, please check cache size"):this.data.set(t,e)}delete(t){this.data.delete(t)}}const pn=()=>{const t=new ln;const e=new Map,r=new Map;return async(n,o)=>{if(function(t){return!(!t.config.cacheData||!t.key&&(console.warn("request: ".concat(t.config.url," 请求参数无法序列化，无法缓存，请移除相关配置")),1))}(n)){const c=function(t){return"object"==typeof t.config.cacheData?t.config.cacheData:{cacheType:"ram",cacheTime:an}}(n),a=function({key:e,cacheType:r="ram"}){const n=un(e,r);if(r===cn.ram)return t.get(n);{const t=window[cn[r]],e=t.getItem(n)||null;try{const r=JSON.parse(e);return r&&!fn(r)?r.data:(t.removeItem(n),null)}catch(o){return t.removeItem(n),null}}}({key:n.key,cacheType:c.cacheType});if(a)return void(n.response=a);const u=await function(t,n){const o=un(t.key,n.cacheType);if(e.get(o))return new Promise((t=>{const e=r.get(o)||[];r.set(o,e.concat(t))}));e.set(o,!0)}(n,c);if(u)return void Object.keys(u).forEach((t=>{n[t]=u[t]}));await o(),sn(n.response)||console.warn("request: ".concat(n.config.url," 响应数据无法序列化，无法缓存，请移除相关配置")),!n.error&&n.response&&sn(n.response)?(function(t,n){const o=un(t.key,n.cacheType),c=r.get(o);c&&c.length>0&&c.forEach((e=>{e({response:t.response})})),r.delete(o),e.delete(o)}(n,c),function({key:e,cacheType:r="ram",data:n,cacheTime:o=an}){const c=un(e,r),a={cacheType:r,data:n,cacheTime:o,expire:Date.now()+o};if(r!==cn.ram){const t=window[cn[r]];try{t.setItem(c,JSON.stringify(a))}catch(i){for(const e in t)e.startsWith(on)&&Object.prototype.hasOwnProperty.call(t,e)&&t.removeItem(e)}}else t.set(c,a)}(i({key:n.key,data:n.response},c))):function(t,n){const o=un(t.key,n.cacheType),c=r.get(o);c&&c.length>0?(c.shift()(),r.set(o,c)):(r.delete(o),e.delete(o))}(n,c)}else await o()}},yn=t=>new Promise(((e,r)=>{setTimeout((()=>{r({type:"TIMEOUT",msg:"请求超时"})}),t)})),hn=t=>{if(Kr(t.config.method)){const e=t.config.params;if(ke(e)){if(["application/x-www-form-urlencoded","multipart/form-data"].includes(t.reqHeaders.get("Content-Type"))){const t=new FormData;return Object.keys(e).forEach((r=>{t.append(r,e[r])})),t}return JSON.stringify(e)}return e}},bn=t=>{const e={};return t.forEach(((t,r)=>{e[r]=t})),e},dn=t=>{return fetch((t=>{if(!Kr(t.config.method)){let e;return Qr(t.config.params)&&(e=t.config.params.toString()),ke(t.config.params)&&(e=new URLSearchParams(t.config.params).toString()),e?"".concat(t.config.url,"?").concat(e):t.config.url}return t.config.url})(t),(n=i({},Gr(t.config,["baseURL","timeout","requestInterceptor","responseInterceptor","transformData","errorHandler","responseType"])),o={headers:bn(t.reqHeaders),body:hn(t)},e(n,r(o)))).then((async e=>{if("opaqueredirect"===e.type&&(location.href=e.url),e.ok){const r=e.headers.get("content-type");let n;n=/application\/json/i.test(r)||"json"===t.config.responseType?await e.json():/text|xml/.test(r)||"text"===t.config.responseType?await e.text():"arrayBuffer"===t.config.responseType?await e.arrayBuffer():"formData"===t.config.responseType?await e.formData():(t.config.responseType,await e.blob());let o={status:e.status,data:n,headers:bn(e.headers)};return"function"==typeof t.config.responseInterceptor&&(o=await t.config.responseInterceptor(o)),C(t.config.transformData)&&(o.data=await t.config.transformData(n,o)),o}return Promise.reject({response:{status:e.status,headers:bn(e.headers)}})}));var n,o};async function vn(t,e){await Promise.race([yn(t.config.timeout),dn(t)]).then((e=>{t.response=e})).catch((e=>{t.error=e})),await e()}function gn(t){let e=[];return"function"==typeof t?e=[t]:Array.isArray(t)&&(e=t),e}function jn(t){const e=gn(t);return async(t,r)=>{let n=t;for(const o of e)n=await o(n,r);return n}}function mn(t){const e=gn(t);return async(t,r)=>{let n=t;for(const o of e)n=await o(n,r);return n}}function wn(t){const e=i({timeout:1e4,credentials:"include"},t),r=(new u).use(s).use(tn).use(Zr).use(Yr).use(rn).use(pn()).use(nn()).use(vn).compose(),n=jn(e.requestInterceptor),o=mn(e.responseInterceptor);return async(t,c,a)=>{const u={config:i(i({url:t,params:c},e),a)};return null!=a&&a.requestInterceptor?u.config=await jn(a.requestInterceptor)(u.config,n):e.requestInterceptor&&(u.config=await n(u.config)),null!=a&&a.responseInterceptor&&(u.config.responseInterceptor=t=>mn(a.responseInterceptor)(t,o)),r(u).then((async()=>{var t,e;return u.response?u.response:(u.error.config||(u.error.config=u.config),null==(e=(t=u.config).errorHandler)||e.call(t,u.error),Promise.reject(u.error))}))}}export{wn as C};
