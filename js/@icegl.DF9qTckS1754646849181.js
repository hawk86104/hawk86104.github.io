import{d as e,i as t,a0 as n,b as r,v as i,G as s,s as o,w as a,V as l,o as c,N as u,u as h,J as d,a1 as p,R as f,a2 as m,a as g,p as v,q as y,E as _,F as x,D as b,r as w,L as T,t as M,A,a3 as S,a4 as E,e as P,H as C,I as R,f as L,j as I,a5 as D,a6 as k,a7 as O,a8 as F,m as U,a9 as B}from"./@vue.BzMISRrV1754646849181.js";import{p as z,K as N,q as j,o as H,W as G,N as V,X as W,Y as X,_ as K,C as q,b as Y,$ as Z,c as $,a0 as Q,a1 as J,a2 as ee,a as te,V as ne,T as re,A as ie,a3 as se,l as oe,U as ae,a4 as le,a5 as ce,a6 as ue,a7 as he,u as de,r as pe,a8 as fe,a9 as me,n as ge,aa as ve,ab as ye,ac as _e,ad as xe,ae as be,af as we,ag as Te,ah as Me,B as Ae,k as Se,ai as Ee,aj as Pe,t as Ce,ak as Re,O as Le,al as Ie,am as De,an as ke,f as Oe,ao as Fe,ap as Ue,aq as Be,E as ze,M as Ne,P as je,d as He,Q as Ge,R as Ve,ar as We,as as Xe,L as Ke,S as qe,at as Ye,au as Ze,h as $e,e as Qe,F as Je,av as et,aw as tt,z as nt,D as rt,I as it,ax as st,ay as ot,az as at,m as lt,H as ct,i as ut,g as ht,aA as dt,aB as pt,aC as ft,aD as mt,aE as gt,aF as vt,aG as yt,aH as _t,aI as xt,aJ as bt,aK as wt,aL as Tt,aM as Mt,aN as At,aO as St,aP as Et,aQ as Pt,aR as Ct,aS as Rt,aT as Lt,aU as It,aV as Dt,aW as kt,aX as Ot,J as Ft,aY as Ut,aZ as Bt,a_ as zt,a$ as Nt,b0 as jt,b1 as Ht,b2 as Gt,b3 as Vt,b4 as Wt,b5 as Xt,b6 as Kt,b7 as qt,b8 as Yt,b9 as Zt,ba as $t,bb as Qt,y as Jt,bc as en}from"./three.BWo_6did1754646849181.js";import{u as tn,c as nn,a as rn,b as sn,t as on,d as an,e as ln,r as cn,f as un,g as hn,h as dn,i as pn,j as fn}from"./@vueuse.uWD-2GR_1754646849181.js";var mn=Object.defineProperty,gn=(e,t,n)=>((e,t,n)=>t in e?mn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);const vn={name:"@tresjs/core",type:"module",version:"4.3.6",packageManager:"pnpm@10.6.3",description:"Declarative ThreeJS using Vue Components",author:"Alvaro Saburido <hola@alvarosaburido.dev> (https://github.com/alvarosabu/)",license:"MIT",repository:{type:"git",url:"git+https://github.com/Tresjs/tres.git"},keywords:["vue","3d","threejs","three","threejs-vue"],sideEffects:!1,exports:{".":{types:"./dist/index.d.ts",import:"./dist/tres.js",require:"./dist/tres.umd.cjs"},"./components":{types:"./dist/src/components/index.d.ts"},"./composables":{types:"./dist/src/composables/index.d.ts"},"./types":{types:"./dist/src/types/index.d.ts"},"./utils":{types:"./dist/src/utils/index.d.ts"},"./*":"./*"},main:"./dist/tres.js",module:"./dist/tres.js",types:"./dist/index.d.ts",files:["*.d.ts","dist"],publishConfig:{access:"public"},scripts:{dev:"pnpm --filter='./playground/vue' dev","dev:nuxt":"pnpm --filter='./playground/nuxt' dev",build:"vite build",test:"vitest","test:ci":"vitest run","test:ui":"vitest --ui --coverage.enabled=true",release:"release-it",coverage:"vitest run --coverage",lint:"eslint .","lint:fix":"eslint . --fix","docs:dev":"vitepress dev docs","docs:build":"vitepress build docs","docs:serve":"vitepress serve docs","docs:preview":"vitepress preview docs","docs:contributors":"esno scripts/update-contributors.ts"},peerDependencies:{three:">=0.133",vue:">=3.4"},dependencies:{"@alvarosabu/utils":"^3.2.0","@vue/devtools-api":"^6.6.3","@vueuse/core":"^12.5.0"},devDependencies:{"@release-it/conventional-changelog":"^10.0.0","@stackblitz/sdk":"^1.11.0","@tresjs/cientos":"4.1.0","@tresjs/eslint-config":"^1.4.0","@types/three":"^0.173.0","@typescript-eslint/eslint-plugin":"^8.23.0","@typescript-eslint/parser":"^8.23.0","@vitejs/plugin-vue":"^5.2.1","@vitest/coverage-c8":"^0.33.0","@vitest/coverage-v8":"^3.0.5","@vitest/ui":"^3.0.5","@vue/test-utils":"^2.4.6",eslint:"^9.19.0","eslint-plugin-vue":"^9.32.0",esno:"^4.8.0",gsap:"^3.12.7",jsdom:"^26.0.0",kolorist:"^1.8.0",ohmyfetch:"^0.4.21",pathe:"^2.0.2","release-it":"^18.1.2","rollup-plugin-analyzer":"^4.0.0","rollup-plugin-copy":"^3.5.0","rollup-plugin-visualizer":"^5.14.0",sponsorkit:"^16.3.0",three:"^0.173.0",unocss:"^65.4.3",unplugin:"^2.1.2","unplugin-vue-components":"^28.0.0",vite:"^6.1.0","vite-plugin-banner":"^0.8.0","vite-plugin-dts":"4.5.0","vite-plugin-inspect":"^10.1.0","vite-plugin-require-transform":"^1.0.21","vite-svg-loader":"^5.1.0",vitepress:"1.6.3",vitest:"3.0.5",vue:"3.5.13","vue-demi":"^0.14.10"}};let yn=class extends oe{constructor(...e){super(...e),gn(this,"type","HightlightMesh"),gn(this,"createTime"),this.createTime=Date.now()}onBeforeRender(){const e=(Date.now()-this.createTime)/1e3,t=1+.07*Math.sin(2.5*e);this.scale.set(t,t,t)}};function _n(e){return typeof e>"u"}function xn(e){return Array.isArray(e)}function bn(e){return"string"==typeof e}function wn(e){return"function"==typeof e}function Tn(e){return e===Object(e)&&!xn(e)&&!wn(e)}function Mn(e){return Tn(e)&&!!e.isObject3D}function An(e){return Tn(e)&&!!e.isColor}function Sn(e){return null!==e&&"object"==typeof e&&"set"in e&&"function"==typeof e.set}function En(e){return e instanceof ee}function Pn(e){return Tn(e)&&!!e.isCamera}function Cn(e){return Mn(e)||function(e){return Tn(e)&&!!e.isBufferGeometry}(e)||function(e){return Tn(e)&&!!e.isMaterial}(e)||function(e){return Tn(e)&&!!e.isFog}(e)}const Rn=(e,t)=>{for(const n of Object.keys(t))t[n]instanceof Object&&Object.assign(t[n],Rn(e[n],t[n]));return Object.assign(e||{},t),e},Ln=Fn("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,hgroup,h1,h2,h3,h4,h5,h6,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,summary,template,blockquote,iframe,tfoot");function In(e){return e&&1===e.nodeType}function Dn(e){return e.replace(/-([a-z])/g,((e,t)=>t.toUpperCase()))}const kn=/\B([A-Z])/g;function On(e){return e.replace(kn,"-$1").toLowerCase()}function Fn(e,t){const n=Object.create(null),r=e.split(",");for(let i=0;i<r.length;i++)n[r[i]]=!0;return t?e=>!!n[e.toLowerCase()]:e=>!!n[e]}const Un=(e,t)=>{if(!t)return;const n=Array.isArray(t)?t:t.match(/([^[.\]])+/g);return null==n?void 0:n.reduce(((e,t)=>e&&e[t]),e)};function Bn(e,t){if(In(e)&&In(t)){const n=e.attributes,r=t.attributes;return n.length===r.length&&Array.from(n).every((({name:e,value:n})=>t.getAttribute(e)===n))}if(e===t)return!0;if(null===e||"object"!=typeof e||null===t||"object"!=typeof t)return!1;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const i of n)if(!r.includes(i)||!Bn(e[i],t[i]))return!1;return!0}function zn(e){(function(e){return"map"in e})(e)&&e.map&&e.map.dispose(),e.dispose()}function Nn(e){var t,n;if(e.parent&&(null==(t=e.removeFromParent)||t.call(e)),delete e.__tres,[...e.children].forEach((e=>Nn(e))),!(e instanceof N)){const t=e;e&&(null==(n=e.dispose)||n.call(e)),t.geometry&&t.geometry.dispose(),Array.isArray(t.material)?t.material.forEach((e=>zn(e))):t.material&&zn(t.material)}}function jn(e,t){let n=e;if(t.includes("-")){const e=t.split("-");let r=e.shift();for(;n&&e.length;)r in n?(n=n[r],r=e.shift()):r=Hn(r,e.shift());return{target:n,key:Hn(r,...e)}}return{target:n,key:t}}function Hn(...e){return e.map(((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1))).join("")}const Gn=/-\d+$/;function Vn(e,t,n){const r=e;return r.__tres={type:"unknown",eventCount:0,root:n,handlers:{},memoizedProps:{},objects:[],parent:null,previousAttach:null,...t},r.__tres.attach||(r.isMaterial?r.__tres.attach="material":r.isBufferGeometry?r.__tres.attach="geometry":r.isFog&&(r.__tres.attach="fog")),r}function Wn(e){var t;const n=null==(t=null==e?void 0:e.__tres)?void 0:t.root;n&&n.render&&n.render.canBeInvalidated.value&&n.invalidate()}function Xn(e){return function(e){return Tn(e)&&!!e.isPrimitive}(e)?(e.object.__tres=e.__tres,e.object):e}function Kn(e,t){var n,r,i,s;const o=(null==(n=e.__tres)?void 0:n.parent)||t.scene.value;e.__tres&&(e.__tres.parent=null),o&&o.__tres&&"objects"in o.__tres&&function(e,t){let n=0;for(let r=0;r<e.length;r++)t(e[r],r)&&(e[n]=e[r],n++);e.length=n}(o.__tres.objects,(t=>t!==e)),null!=(r=e.__tres)&&r.attach?function(e,t,n){var r,i,s;if(bn(n)){const{target:r,key:i}=jn(e,n),s=t.__tres.previousAttach;void 0===s?delete r[i]:r[i]=s,"__tresDetach"in r&&r.__tresDetach()}else null==(i=null==(r=t.__tres)?void 0:r.previousAttach)||i.call(r,e,t);null==(s=t.__tres)||delete s.previousAttach}(o,e,e.__tres.attach):(null==(s=null==(i=e.parent)?void 0:i.remove)||s.call(i,Xn(e)),e.parent=null)}function qn(e,t){var n;null==(n=e.traverse)||n.call(e,(e=>{var n;t.deregisterCamera(e),null==(n=t.eventManager)||n.deregisterPointerMissedObject(e)})),t.deregisterCamera(e),Wn(e)}const Yn="[TresJS ▲ ■ ●] ";function Zn(...e){"string"==typeof e[0]?e[0]=Yn+e[0]:e.unshift(Yn),console.error(...e)}function $n(...e){"string"==typeof e[0]?e[0]=Yn+e[0]:e.unshift(Yn),console.warn(...e)}function Qn(e,t){}function Jn(){return{logError:Zn,logWarning:$n,logMessage:Qn}}const er=r({}),tr=e=>Object.assign(er.value,e);function nr(){const e=new Map,t=new Set;let n=0,r=!1;const i=n=>{e.delete(n),t.delete(n)};return{on:(t,s=0)=>{e.set(t,{priority:s,addI:n++});const o=()=>i(t);return fn(o),r=!0,{off:o}},off:i,trigger:(...n)=>{r&&((()=>{const n=Array.from(e.entries()).sort(((e,t)=>{const n=e[1].priority-t[1].priority;return 0===n?e[1].addI-t[1].addI:n}));t.clear(),n.forEach((e=>t.add(e[0])))})(),r=!1),t.forEach((e=>e(...n)))},dispose:()=>{e.clear(),t.clear()},get count(){return e.size}}}function rr(){let e=!0,t=!0,n=!1;const i=new z(!1),s=r(i.running),o=r(!1);let a;const l=Y.generateUUID();let c=null;const u=nr(),d=nr(),p=nr();g();let f={};function m(){if(!e)return void(a=requestAnimationFrame(m));const t=i.getDelta(),n=i.getElapsedTime(),r={camera:h(f.camera),scene:h(f.scene),renderer:h(f.renderer),raycaster:h(f.raycaster),controls:h(f.controls),invalidate:f.invalidate,advance:f.advance},l={delta:t,elapsed:n,clock:i,...r};s.value&&u.trigger(l),o.value||(d.count?d.trigger(l):c&&c(l)),s.value&&p.trigger(l),a=requestAnimationFrame(m)}function g(){const e=!t&&!n;i.running!==e&&(i.running?i.stop():i.start()),s.value=i.running}return{loopId:l,register:(e,t,n)=>function(e,t,n=0){switch(t){case"before":return u.on(e,n);case"render":return c||(c=e),d.dispose(),d.on(e);case"after":return p.on(e,n)}}(e,t,n),start:function(){t&&(t=!1,g(),m())},stop:function(){t=!0,g(),cancelAnimationFrame(a)},pause:function(){n=!0,g()},resume:function(){n=!1,g()},pauseRender:function(){o.value=!0},resumeRender:function(){o.value=!1},isRenderPaused:o,isActive:s,setContext:function(e){f=e},setReady:t=>e=t}}function ir(e){let t=0;return e.traverse((e=>{if(e.isMesh&&e.geometry&&"HightlightMesh"!==e.type){const n=e.geometry,r=3*n.attributes.position.count*Float32Array.BYTES_PER_ELEMENT,i=n.index?n.index.count*Uint32Array.BYTES_PER_ELEMENT:0,s=n.attributes.normal?3*n.attributes.normal.count*Float32Array.BYTES_PER_ELEMENT:0,o=n.attributes.uv?2*n.attributes.uv.count*Float32Array.BYTES_PER_ELEMENT:0;t+=r+i+s+o}})),t}function sr(e){return(e/1024).toFixed(2)}const or=Number.parseInt(J.replace("dev",""));const ar={realistic:{shadows:!0,physicallyCorrectLights:!0,outputColorSpace:K,toneMapping:X,toneMappingExposure:3,shadowMap:{enabled:!0,type:W}},flat:{toneMapping:V,toneMappingExposure:1}};function lr({canvas:e,options:t,contextParts:{sizes:n,render:r,invalidate:s,advance:o}}){const c=g((()=>({alpha:on(t.alpha)??!0,depth:on(t.depth),canvas:un(e),context:on(t.context),stencil:on(t.stencil),antialias:on(t.antialias)??!0,precision:on(t.precision),powerPreference:on(t.powerPreference),premultipliedAlpha:on(t.premultipliedAlpha),preserveDrawingBuffer:on(t.preserveDrawingBuffer),logarithmicDepthBuffer:on(t.logarithmicDepthBuffer),failIfMajorPerformanceCaveat:on(t.failIfMajorPerformanceCaveat)}))),u=i(new G(c.value));function h(){"on-demand"===t.renderMode&&s()}a(c,(()=>{u.value.dispose(),u.value=new G(c.value),h()})),a([n.width,n.height],(()=>{u.value.setSize(n.width.value,n.height.value),h()}),{immediate:!0}),a((()=>t.clearColor),h);const{pixelRatio:d}=hn(),{logError:p}=Jn(),f=(()=>{const e=new G,t={shadowMap:{enabled:e.shadowMap.enabled,type:e.shadowMap.type},toneMapping:e.toneMapping,toneMappingExposure:e.toneMappingExposure,outputColorSpace:e.outputColorSpace};return e.dispose(),t})(),v=on(t.renderMode);return"on-demand"===v&&s(),"manual"===v&&setTimeout((()=>{o()}),100),m((()=>{const e=on(t.preset);e&&(e in ar||p(`Renderer Preset must be one of these: ${Object.keys(ar).join(", ")}`),Rn(u.value,ar[e])),function(e,t,n){var r;if(!wn(e.setPixelRatio))return;let i=0;if(n&&xn(n)&&n.length>=2){const[e,r]=n;i=Y.clamp(t,e,r)}else i=function(e){return"number"==typeof e}(n)?n:t;i!==(null==(r=e.getPixelRatio)?void 0:r.call(e))&&e.setPixelRatio(i)}(u.value,d.value,on(t.dpr)),"always"===v&&(r.frames.value=Math.max(1,r.frames.value));const n=(t,n)=>{const r=on(t);if(void 0!==r)return r;const i=(()=>{if(e)return Un(ar[e],n)})();return void 0!==i?i:Un(f,n)},i=(e,t)=>((e,t,n)=>{const r=Array.isArray(t)?t:t.match(/([^[.\]])+/g);r&&r.reduce(((e,t,i)=>(void 0===e[t]&&(e[t]={}),i===r.length-1&&(e[t]=n),e[t])),e)})(u.value,t,n(e,t));i(t.shadows,"shadowMap.enabled"),i(t.toneMapping??X,"toneMapping"),i(t.shadowMapType,"shadowMap.type"),or<150&&i(!t.useLegacyLights,"physicallyCorrectLights"),i(t.outputColorSpace,"outputColorSpace"),i(t.toneMappingExposure,"toneMappingExposure");const s=n(t.clearColor,"clearColor");s&&u.value.setClearColor(s?function(e){return e instanceof q?e:Array.isArray(e)?new q(...e):new q(e)}(s):new q(0))})),l((()=>{u.value.dispose(),u.value.forceContextLoss()})),{renderer:u}}const cr=(e,t)=>{const n=g((()=>t.renderer.value.domElement)),r=i([]),{x:s,y:o}=dn({target:n});let a=0;const{width:c,height:u,top:h,left:d}=pn(n),p=i=>{const a=(({x:e,y:t})=>{if(n.value)return{x:(e-d.value)/c.value*2-1,y:-(t-h.value)/u.value*2+1}})({x:(null==i?void 0:i.clientX)??s.value,y:(null==i?void 0:i.clientY)??o.value});return a&&(({x:n,y:i})=>{if(t.camera.value)return t.raycaster.value.setFromCamera(new te(n,i),t.camera.value),r.value=t.raycaster.value.intersectObjects(e.value,!0),r.value})(a)||[]},f=nn(),m=nn(),v=nn(),y=nn(),_=nn(),x=nn(),b=nn(),w=nn();const T=(e,n)=>{var i,s,o;const l=function(e){const t={};for(const n in e)"function"!=typeof n&&(t[n]=e[n]);return t}(n),c=new ne(null==n?void 0:n.clientX,null==n?void 0:n.clientY,0).unproject(null==(i=t.camera)?void 0:i.value);e.trigger({...l,intersections:r.value,unprojectedPoint:c,ray:null==(s=t.raycaster)?void 0:s.value.ray,camera:null==(o=t.camera)?void 0:o.value,sourceEvent:n,delta:a,stopPropagating:!1})};let M;const A=e=>{p(e),T(v,e),M=e};let S,E,P;const C=e=>{var t;S=null==(t=r.value[0])?void 0:t.object,a=0,E=new te((null==e?void 0:e.clientX)??s.value,(null==e?void 0:e.clientY)??o.value),T(_,e)};let R,L=!1;const I=e=>{var t,n,i;e instanceof PointerEvent&&(0===r.value.length&&T(x,e),S===(null==(t=r.value[0])?void 0:t.object)&&(P=new te((null==e?void 0:e.clientX)??s.value,(null==e?void 0:e.clientY)??o.value),a=null==E?void 0:E.distanceTo(P),0===e.button?(T(f,e),R===(null==(n=r.value[0])?void 0:n.object)?L=!0:(R=null==(i=r.value[0])?void 0:i.object,L=!1)):2===e.button&&T(b,e)),T(y,e))},D=e=>{L&&(T(m,e),R=void 0,L=!1)},k=e=>T(v,e),O=e=>T(w,e);return n.value.addEventListener("pointerup",I),n.value.addEventListener("pointerdown",C),n.value.addEventListener("pointermove",A),n.value.addEventListener("pointerleave",k),n.value.addEventListener("dblclick",D),n.value.addEventListener("wheel",O),l((()=>{null!=n&&n.value&&(n.value.removeEventListener("pointerup",I),n.value.removeEventListener("pointerdown",C),n.value.removeEventListener("pointermove",A),n.value.removeEventListener("pointerleave",k),n.value.removeEventListener("dblclick",D),n.value.removeEventListener("wheel",O))})),{intersects:r,onClick:e=>f.on(e).off,onDblClick:e=>m.on(e).off,onContextMenu:e=>b.on(e).off,onPointerMove:e=>v.on(e).off,onPointerUp:e=>y.on(e).off,onPointerDown:e=>_.on(e).off,onPointerMissed:e=>x.on(e).off,onWheel:e=>w.on(e).off,forceUpdate:()=>{M&&A(M)}}};function ur(e,t){if(Array.isArray(e))for(const n of e)n(t);"function"==typeof e&&e(t)}const hr=new WeakMap;function dr(e){if(e=e||fr(),hr.has(e))return hr.get(e);const t=Date.now(),n=function(e,t,n=100){n=n<=0?100:n;const r=nn(),i=new Set;let s=!1,o=!1,a=null;return function l(){a&&clearTimeout(a),o||s||!e()?!o&&!s&&(a=setTimeout(l,n)):(r.trigger(t),i.forEach((e=>e())),i.clear(),s=!0)}(),{on:e=>{if(s)return((e,...t)=>{e(...t)})(e,t),{off:()=>{}};{const t=r.on(e);return i.add(t.off),r.on(e)}},off:r.off,trigger:r.trigger,clear:r.clear,cancel:function(){o=!0,a&&clearTimeout(a)}}}((()=>{if(Date.now()-t>=100)return!0;{const t=e.renderer.value,n=(null==t?void 0:t.domElement)||{width:0,height:0};return!!(t&&n.width>0&&n.height>0)}}),e);return hr.set(e,n),n}function pr({scene:e,canvas:t,windowSize:n,rendererOptions:s,emit:o}){const a=i(e),c=function(e,t,n=10){const r=on(e)?an():ln(g((()=>on(t).parentElement))),i=v(cn(r.width,n)),s=v(cn(r.height,n)),o=g((()=>i.value/s.value));return{height:s,width:i,aspectRatio:o}}(n,t),{camera:u,cameras:h,registerCamera:d,deregisterCamera:p,setCameraActive:f}=(({sizes:e})=>{const t=r([]),n=g((()=>t.value[0])),i=e=>{const n=e instanceof Q?e:t.value.find((t=>t.uuid===e));if(!n)return;const r=t.value.filter((({uuid:e})=>e!==n.uuid));t.value=[n,...r]};return m((()=>{e.aspectRatio.value&&t.value.forEach((t=>{!t.manual&&(t instanceof j||function(e){return e.hasOwnProperty("isOrthographicCamera")&&e.isOrthographicCamera}(t))&&(t instanceof j?t.aspect=e.aspectRatio.value:(t.left=-.5*e.width.value,t.right=.5*e.width.value,t.top=.5*e.height.value,t.bottom=-.5*e.height.value),t.updateProjectionMatrix())}))})),l((()=>{t.value=[]})),{camera:n,cameras:t,registerCamera:(e,n=!1)=>{if(Pn(e)){const r=e;if(t.value.some((({uuid:e})=>e===r.uuid)))return;n?i(r):t.value.push(r)}},deregisterCamera:e=>{if(Pn(e)){const n=e;t.value=t.value.filter((({uuid:e})=>e!==n.uuid))}},setCameraActive:i}})({sizes:c}),y={mode:r(s.renderMode||"always"),priority:r(0),frames:r(0),maxFrames:60,canBeInvalidated:g((()=>"on-demand"===y.mode.value&&0===y.frames.value))};function x(e=1){"on-demand"===s.renderMode&&(y.frames.value=Math.min(y.maxFrames,y.frames.value+e))}function b(){"manual"===s.renderMode&&(y.frames.value=1)}const{renderer:w}=lr({canvas:t,options:s,contextParts:{sizes:c,render:y,invalidate:x,advance:b}}),T={sizes:c,scene:a,camera:u,cameras:v(h),renderer:w,raycaster:i(new H),controls:r(null),perf:{maxFrames:160,fps:{value:0,accumulator:[]},memory:{currentMem:0,allocatedMem:0,accumulator:[]}},render:y,advance:b,extend:tr,invalidate:x,registerCamera:d,setCameraActive:f,deregisterCamera:p,loop:rr()};_("useTres",T),T.scene.value.__tres={root:T},T.loop.register((()=>{u.value&&y.frames.value>0&&(w.value.render(e,u.value),o("render",T.renderer.value)),y.priority.value=0,"always"===y.mode.value?y.frames.value=1:y.frames.value=Math.max(0,y.frames.value-1)}),"render");const{on:M,cancel:A}=dr(T);T.loop.setReady(!1),T.loop.start(),M((()=>{o("ready",T),T.loop.setReady(!0),function(e,t,n){var r;const s=i(),o=i();e&&(s.value=e),t&&(o.value=t);const a=e=>{var t;return(null==(t=e.children)?void 0:t.some((e=>a(e))))||(e=>{var t;return(null==(t=e.__tres)?void 0:t.eventCount)>0})(e)},l=i((null==(r=s.value)?void 0:r.children).filter(a)||[]);function c(e,t){const r=[];t.stopPropagation=()=>t.stopPropagating=!0;for(const i of null==t?void 0:t.intersections){if(t.stopPropagating)return;t={...t,...i};const{object:s}=i;t.eventObject=s,ur(s[e],t),r.push(s);let o=s.parent;for(;null!==o&&!t.stopPropagating&&!r.includes(o);)t.eventObject=o,ur(o[e],t),r.push(o),o=o.parent;const a=On(e.slice(2));n(a,{intersection:i,event:t})}}const{onClick:u,onDblClick:h,onContextMenu:d,onPointerMove:p,onPointerDown:f,onPointerUp:m,onPointerMissed:g,onWheel:v,forceUpdate:y}=cr(l,t);m((e=>c("onPointerUp",e))),f((e=>c("onPointerDown",e))),u((e=>c("onClick",e))),h((e=>c("onDoubleClick",e))),d((e=>c("onContextMenu",e))),v((e=>c("onWheel",e)));let _=[];p((e=>{const t=e.intersections.map((({object:e})=>e)),n=e.intersections;_.forEach((({object:n})=>{t.includes(n)||(e.intersections=_,c("onPointerLeave",e),c("onPointerOut",e))})),e.intersections=n,e.intersections.forEach((({object:t})=>{_.includes(t)||(c("onPointerEnter",e),c("onPointerOver",e))})),c("onPointerMove",e),_=e.intersections}));const x=[];function b(e){Cn(e)&&Mn(e)&&l.value.push(e)}function w(e){if(Cn(e)&&Mn(e)){const t=l.value.indexOf(e);t>-1&&l.value.splice(t,1)}}function T(e){Cn(e)&&Mn(e)&&e.onPointerMissed&&x.push(e)}function M(e){if(Cn(e)&&Mn(e)){const t=x.indexOf(e);t>-1&&x.splice(t,1)}}g((e=>{e.stopPropagation=()=>e.stopPropagating=!0,x.forEach((t=>{e.stopPropagating||(e.eventObject=t,ur(t.onPointerMissed,e))})),n("pointer-missed",{event:e})})),t.eventManager={forceUpdate:y,registerObject:b,deregisterObject:w,registerPointerMissedObject:T,deregisterPointerMissedObject:M}}(e,T,o)})),l((()=>{A(),T.loop.stop()}));const S=rn({every:100}),{isSupported:E,memory:P}=sn({interval:100});let C=performance.now();let R=0;const{pause:L}=tn((({delta:e})=>{window.__TRES__DEVTOOLS__&&((({timestamp:e})=>{T.scene.value&&(T.perf.memory.allocatedMem=ir(T.scene.value)),e-C>=100&&(C=e,T.perf.fps.accumulator.push(S.value),T.perf.fps.accumulator.length>160&&T.perf.fps.accumulator.shift(),T.perf.fps.value=S.value,E.value&&P.value&&(T.perf.memory.accumulator.push(P.value.usedJSHeapSize/1024/1024),T.perf.memory.accumulator.length>160&&T.perf.memory.accumulator.shift(),T.perf.memory.currentMem=T.perf.memory.accumulator.reduce(((e,t)=>e+t),0)/T.perf.memory.accumulator.length))})({timestamp:performance.now()}),R+=e,R>=1&&(window.__TRES__DEVTOOLS__.cb(T),R=0))}),{immediate:!0});return l((()=>{L()})),T}function fr(){const e=t("useTres");if(!e)throw new Error("useTresContext must be used together with useTresContextProvider");return e}function mr(){const{camera:e,scene:t,renderer:n,loop:r,raycaster:i,controls:s,invalidate:o,advance:a}=fr();return r.setContext({camera:e,scene:t,renderer:n,raycaster:i,controls:s,invalidate:o,advance:a}),{pause:r.pause,resume:r.resume,pauseRender:r.pauseRender,resumeRender:r.resumeRender,isActive:r.isActive,onBeforeRender:function(e,t=0){return r.register(e,"before",t)},render:function(e){return r.register(e,"render")},onAfterRender:function(e,t=0){return r.register(e,"after",t)}}}const gr=nn(),vr=nn(),yr=nn(),_r=new z;let xr=0,br=0;const{pause:wr,resume:Tr,isActive:Mr}=tn((()=>{gr.trigger({delta:xr,elapsed:br,clock:_r}),vr.trigger({delta:xr,elapsed:br,clock:_r}),yr.trigger({delta:xr,elapsed:br,clock:_r})}),{immediate:!1});yr.on((()=>{xr=_r.getDelta(),br=_r.getElapsedTime()}));let Ar=!1;const Sr=()=>(Ar||(Ar=!0,Tr()),{onBeforeLoop:gr.on,onLoop:vr.on,onAfterLoop:yr.on,pause:wr,resume:Tr,isActive:Mr});const{logError:Er}=Jn(),Pr=["onClick","onContextMenu","onPointerMove","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut","onDoubleClick","onPointerDown","onPointerUp","onPointerCancel","onPointerMissed","onLostPointerCapture","onWheel"],Cr=e=>{const t=e.scene.value;function n(n,r){var i,s,o;if(!n)return;r=r||t;const a=n.__tres?n:Vn(n,{},e),l=r.__tres?r:Vn(r,{},e);n=Xn(a),r=Xn(l),n.__tres&&(null==(i=n.__tres)?void 0:i.eventCount)>0&&(null==(s=e.eventManager)||s.registerObject(n)),e.registerCamera(n),null==(o=e.eventManager)||o.registerPointerMissedObject(n),a.__tres.attach?function(e,t,n){if(bn(n)){if(Gn.test(n)){const t=n.replace(Gn,""),{target:r,key:i}=jn(e,t);if(!Array.isArray(r[i])){const e=r[i],t=[];t.__tresDetach=()=>{t.every((e=>_n(e)))&&(r[i]=e)},r[i]=t}}const{target:r,key:i}=jn(e,n);t.__tres.previousAttach=r[i],r[i]=Xn(t)}else t.__tres.previousAttach=n(e,t)}(l,a,a.__tres.attach):Mn(n)&&Mn(l)&&(l.add(n),n.dispatchEvent({type:"added"})),a.__tres.parent=l,l.__tres.objects&&!l.__tres.objects.includes(a)&&l.__tres.objects.push(a)}function r(t,n){var i,s,o,a;if(!t)return;null!=t&&t.__tres&&(null==(i=t.__tres)?void 0:i.eventCount)>0&&(null==(s=e.eventManager)||s.deregisterObject(t)),n=_n(n)?"default":n;const l=null==(o=t.__tres)?void 0:o.dispose;_n(l)||(n=null!==l&&l);const c=null==(a=t.__tres)?void 0:a.primitive,u="default"===n?!c:!!n;if(t.__tres&&"objects"in t.__tres&&[...t.__tres.objects].forEach((e=>r(e,n))),u&&t.children&&[...t.children].forEach((e=>r(e,n))),Kn(t,e),qn(t,e),u&&!function(e){return Tn(e)&&!!e.isScene}(t))if(wn(n))n(t);else if(wn(t.dispose))try{t.dispose()}catch{}"__tres"in t&&delete t.__tres}function i(t,i,s,o){var a,l;if(!t)return;let c=t,u=i;if(t.__tres&&(t.__tres.memoizedProps[i]=o),"attach"===i){const i=(null==(a=t.__tres)?void 0:a.parent)||t.parent;return r(t),Vn(t,{attach:o},e),void(i&&n(t,i))}if("dispose"===i)return t.__tres||(t=Vn(t,{},e)),void(t.__tres.dispose=o);if(Mn(t)&&"blocks-pointer-events"===u)return void(o||""===o?t[u]=o:delete t[u]);Pr.includes(i)&&t.__tres&&(t.__tres.eventCount+=1);let h=Dn(u),d=null==c?void 0:c[h];if("args"===u){const e=t,n=s??[],r=o??[],i=(null==(l=t.__tres)?void 0:l.type)||t.type;return void(i&&n.length&&!function(e,t){if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Bn(e[n],t[n]))return!1;return!0}(n,r)&&(c=Object.assign(e,new er.value[i](...o))))}if("BufferGeometry"===c.type){if("args"===u)return;return void c.setAttribute(Dn(u),new $(...o))}if(u.includes("-")&&void 0===d){d=c;for(const e of u.split("-"))h=u=Dn(e),c=d,d=null==d?void 0:d[u]}let p=o;if(""===p&&(p=!0),wn(d))return Pr.includes(i)||(xn(p)?t[h](...p):t[h](p)),void(h.startsWith("on")&&wn(p)&&(c[h]=p));En(d)&&En(p)?d.mask=p.mask:An(d)&&function(e){return null!=e&&("string"==typeof e||"number"==typeof e||An(e))}(p)?d.set(p):function(e){return Sn(e)&&"copy"in e&&"function"==typeof e.copy}(d)&&function(e){return!(null==e||!e.constructor)}(p)&&d.constructor===p.constructor?d.copy(p):Sn(d)&&Array.isArray(p)?"fromArray"in d&&"function"==typeof d.fromArray?d.fromArray(p):d.set(...p):Sn(d)&&"number"==typeof p?"setScalar"in d&&"function"==typeof d.setScalar?d.setScalar(p):d.set(p):c[h]=p,Wn(t)}function s(e){var t;return(null==(t=null==e?void 0:e.__tres)?void 0:t.parent)||null}return{insert:n,remove:r,createElement:function(t,s,o,a){if(a||(a={}),a.args||(a.args=[]),"template"===t||Ln(t))return null;let l,c=t.replace("Tres","");if("primitive"===t){(!Tn(a.object)||b(a.object))&&Er("Tres primitives need an 'object' prop, whose value is an object or shallowRef<object>"),c=a.object.type;const t={};l=function(e,t={},n={}){let r=e;const i=e=>{r=e};let s=new Proxy({},{});return s=new Proxy({},{has:(e,n)=>n in t||n in r,get:(e,n,i)=>n in t?t[n](r):r[n],set:(e,t,o)=>(n[t]?n[t](o,r,s,i):r[t]=o,!0)}),s}(a.object,{object:e=>e,isPrimitive:()=>!0,__tres:()=>t},{object:(t,s,o,a)=>{!function(e,t,n,r,i){const s=[...t.__tres.objects],o=Xn(t);if(o===(e=Xn(e)))return!0;const a=Vn(e,t.__tres??{},i),l=t.parent??t.__tres.parent??null,c={...t.__tres.memoizedProps};delete c.object;for(const u of s)Kn(u,i),qn(u,i);o.__tres.objects=[],r.remove(t);for(const[u,h]of Object.entries(c))r.patchProp(a,u,a[u],h);n(e),r.insert(t,l);for(const u of s)r.insert(u,t)}(t,o,a,{patchProp:i,remove:r,insert:n},e)},__tres:e=>{Object.assign(t,e)}})}else{const e=er.value[c];e||Er(`${c} is not defined on the THREE namespace. Use extend to add it to the catalog.`),l=new e(...a.args)}return l?(l.isCamera&&(null!=a&&a.position||l.position.set(3,3,3),null!=a&&a.lookAt||l.lookAt(0,0,0)),l=Vn(l,{...l.__tres,type:c,memoizedProps:a,eventCount:0,primitive:"primitive"===t,attach:a.attach},e),l):null},patchProp:i,parentNode:s,createText:()=>{},createComment:function(t){const n=Vn(new Z,{type:"Comment"},e);return n.name=t,n},setText:()=>{},setElementText:()=>{},nextSibling:function(e){var t;const n=s(e),r=(null==(t=null==n?void 0:n.__tres)?void 0:t.objects)||[],i=r.indexOf(e);return i<0||i>=r.length-1?null:r[i+1]},querySelector:()=>{},setScopeId:()=>{},cloneNode:()=>{},insertStaticContent:()=>{}}};function Rr(){return typeof navigator<"u"&&typeof window<"u"?window:typeof globalThis<"u"?globalThis:{}}const Lr="function"==typeof Proxy;let Ir,Dr;function kr(){return void 0!==Ir||(typeof window<"u"&&window.performance?(Ir=!0,Dr=window.performance):typeof globalThis<"u"&&null!==(e=globalThis.perf_hooks)&&void 0!==e&&e.performance?(Ir=!0,Dr=globalThis.perf_hooks.performance):Ir=!1),Ir?Dr.now():Date.now();var e}let Or=class{constructor(e,t){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=e,this.hook=t;const n={};if(e.settings)for(const s in e.settings){const t=e.settings[s];n[s]=t.defaultValue}const r=`__vue-devtools-plugin-settings__${e.id}`;let i=Object.assign({},n);try{const e=localStorage.getItem(r),t=JSON.parse(e);Object.assign(i,t)}catch{}this.fallbacks={getSettings:()=>i,setSettings(e){try{localStorage.setItem(r,JSON.stringify(e))}catch{}i=e},now:()=>kr()},t&&t.on("plugin:settings:set",((e,t)=>{e===this.plugin.id&&this.fallbacks.setSettings(t)})),this.proxiedOn=new Proxy({},{get:(e,t)=>this.target?this.target.on[t]:(...e)=>{this.onQueue.push({method:t,args:e})}}),this.proxiedTarget=new Proxy({},{get:(e,t)=>this.target?this.target[t]:"on"===t?this.proxiedOn:Object.keys(this.fallbacks).includes(t)?(...e)=>(this.targetQueue.push({method:t,args:e,resolve:()=>{}}),this.fallbacks[t](...e)):(...e)=>new Promise((n=>{this.targetQueue.push({method:t,args:e,resolve:n})}))})}async setRealTarget(e){this.target=e;for(const t of this.onQueue)this.target.on[t.method](...t.args);for(const t of this.targetQueue)t.resolve(await this.target[t.method](...t.args))}};function Fr(e,t){const n=e,r=Rr(),i=Rr().__VUE_DEVTOOLS_GLOBAL_HOOK__,s=Lr&&n.enableEarlyProxy;if(!i||!r.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__&&s){const e=s?new Or(n,i):null;(r.__VUE_DEVTOOLS_PLUGINS__=r.__VUE_DEVTOOLS_PLUGINS__||[]).push({pluginDescriptor:n,setupFn:t,proxy:e}),e&&t(e.proxiedTarget)}else i.emit("devtools-plugin:setup",e,t)}function Ur(e,t){throw new Error(e+t)}const Br=e=>{const t={id:e.uuid,label:e.type,children:[],tags:[]};""!==e.name&&t.tags.push({label:e.name,textColor:5750629,backgroundColor:15793395});const n=ir(e);return n>0&&t.tags.push({label:`${sr(n)} KB`,textColor:15707189,backgroundColor:16775644,tooltip:"Memory usage"}),e.type.includes("Light")&&(function(e){return Tn(e)&&!!e.isLight}(e)&&t.tags.push({label:`${e.intensity}`,textColor:9738662,backgroundColor:16316922,tooltip:"Intensity"}),t.tags.push({label:`#${new q(e.color).getHexString()}`,textColor:9738662,backgroundColor:16316922,tooltip:"Color"})),e.type.includes("Camera")&&(t.tags.push({label:`${e.fov}°`,textColor:9738662,backgroundColor:16316922,tooltip:"Field of view"}),t.tags.push({label:`x: ${Math.round(e.position.x)} y: ${Math.round(e.position.y)} z: ${Math.round(e.position.z)}`,textColor:9738662,backgroundColor:16316922,tooltip:"Position"})),t};function zr(e,t,n=""){e.children.forEach((e=>{if("HightlightMesh"===e.type||n&&!e.type.includes(n)&&!e.name.includes(n))return;const r=Br(e);t.children.push(r),zr(e,r,n)}))}const Nr=[],jr="tres:inspector",Hr=w({sceneGraph:null});function Gr(e,t){Fr({id:"dev.esm.tres",label:"TresJS 🪐",logo:"https://raw.githubusercontent.com/Tresjs/tres/main/public/favicon.svg",packageName:"tresjs",homepage:"https://tresjs.org",componentStateTypes:Nr,app:e},(e=>{"function"!=typeof e.now&&function(e,t){const n=`▲ ■ ●${e}`;Ur(n,t)}("You seem to be using an outdated version of Vue Devtools. Are you still using the Beta release instead of the stable one? You can find the links at https://devtools.vuejs.org/guide/installation.html."),e.addInspector({id:jr,label:"TresJS 🪐",icon:"account_tree",treeFilterPlaceholder:"Search instances"}),setInterval((()=>{e.sendInspectorTree(jr)}),1e3),setInterval((()=>{e.notifyComponentUpdate()}),5e3),e.on.getInspectorTree((e=>{if(e.inspectorId===jr){const n=Br(t.scene.value);zr(t.scene.value,n,e.filter),Hr.sceneGraph=n,e.rootNodes=[n]}}));let n=null,r=null;e.on.getInspectorState((e=>{var i;if(e.inspectorId===jr){const[s]=t.scene.value.getObjectsByProperty("uuid",e.nodeId);if(!s)return;if(r&&n&&n.parent&&r.remove(n),s.isMesh){const e=function(e){const t=new ie({color:11003607,transparent:!0,opacity:.2,depthTest:!1,side:se});return new yn(e.geometry.clone(),t)}(s);s.add(e),n=e,r=s}e.state={object:Object.entries(s).map((([e,t])=>"children"===e?{key:e,value:t.filter((e=>"HightlightMesh"!==e.type))}:{key:e,value:t,editable:!0})).filter((({key:e})=>"parent"!==e))},s.isScene&&(e.state={...e.state,state:[{key:"Scene Info",value:{objects:s.children.length,memory:ir(s),calls:t.renderer.value.info.render.calls,triangles:t.renderer.value.info.render.triangles,points:t.renderer.value.info.render.points,lines:t.renderer.value.info.render.lines}},{key:"Programs",value:(null==(i=t.renderer.value.info.programs)?void 0:i.map((e=>({...e,programName:e.name}))))||[]}]})}})),e.on.editInspectorState((e=>{e.inspectorId===jr&&function(e,t,n,r){const i=e=>{if(e.uuid===t)return e;for(const t of e.children){const e=i(t);if(e)return e}},s=i(e);if(!s)return void console.warn("Object with UUID not found in the scene.");let o=s;for(let l=0;l<n.length-1;l++){if(void 0===o[n[l]])return void console.warn(`Property path is not valid: ${n.join(".")}`);o=o[n[l]]}const a=n[n.length-1];void 0!==o[a]?o[a]=r:console.warn(`Property path is not valid: ${n.join(".")}`)}(t.scene.value,e.nodeId,e.path,e.state.value)}))}))}const Vr=["data-scene","data-tres"],Wr=e({__name:"TresCanvas",props:{shadows:{type:Boolean,default:void 0},clearColor:{},toneMapping:{},shadowMapType:{},useLegacyLights:{type:Boolean,default:void 0},outputColorSpace:{},toneMappingExposure:{},renderMode:{default:"always"},dpr:{},camera:{},preset:{},windowSize:{type:Boolean,default:void 0},enableProvideBridge:{type:Boolean,default:!0},context:{},alpha:{type:Boolean,default:void 0},premultipliedAlpha:{type:Boolean},antialias:{type:Boolean,default:void 0},stencil:{type:Boolean,default:void 0},preserveDrawingBuffer:{type:Boolean,default:void 0},powerPreference:{},depth:{type:Boolean,default:void 0},failIfMajorPerformanceCaveat:{type:Boolean,default:void 0},precision:{},logarithmicDepthBuffer:{type:Boolean,default:void 0},reverseDepthBuffer:{type:Boolean}},emits:["render","click","double-click","context-menu","pointer-move","pointer-up","pointer-down","pointer-enter","pointer-leave","pointer-over","pointer-out","pointer-missed","wheel","ready"],setup(t,{expose:g,emit:v}){const b=t,w=v,T=n(),M=r(),A=i(new N),S=y();tr(re);const E=(t,n=!1)=>{const r=((t,n=!1)=>e({setup(){var e;const r=null==(e=y())?void 0:e.appContext;r&&(r.app=null==S?void 0:S.appContext.app);const i={};return null!=S&&S.parent&&b.enableProvideBridge&&(function e(t){t&&(t.parent&&e(t.parent),t.provides&&Object.assign(i,t.provides))}(S.parent),Reflect.ownKeys(i).forEach((e=>{_(e,i[e])}))),_("useTres",t),_("extend",tr),typeof window<"u"&&Gr(null==r?void 0:r.app,t),()=>f(x,null,n?[]:T.default())}}))(t,n),{render:i}=p(Cr(t));i(f(r),A.value)},P=(e,t=!1)=>{Nn(e.scene.value),t&&(e.renderer.value.dispose(),e.renderer.value.renderLists.dispose(),e.renderer.value.forceContextLoss()),A.value.__tres={root:e}},C=i(null);g({context:C,dispose:()=>P(C.value,!0)});return o((()=>{const e=M;C.value=pr({scene:A.value,canvas:e,windowSize:b.windowSize??!1,rendererOptions:b,emit:w});const{registerCamera:t,camera:n,cameras:r,deregisterCamera:i}=C.value;E(C.value);a((()=>b.camera),((e,n)=>{e&&t(e),n&&(n.removeFromParent(),i(n))}),{immediate:!0}),n.value||(()=>{const e=new j(45,window.innerWidth/window.innerHeight,.1,1e3);e.position.set(3,3,3),e.lookAt(0,0,0),t(e);const n=m((()=>{r.value.length>=2&&(e.removeFromParent(),i(e),null==n||n())}))})()})),l((()=>{P(C.value),E(C.value,!0)})),(e,t)=>(c(),s("canvas",{ref_key:"canvas",ref:M,"data-scene":A.value.uuid,class:d(e.$attrs.class),"data-tres":`tresjs ${h(vn).version}`,style:u({display:"block",width:"100%",height:"100%",position:e.windowSize?"fixed":"relative",top:0,left:0,pointerEvents:"auto",touchAction:"none",...e.$attrs.style})},null,14,Vr))}});
/**
 * postprocessing v6.37.6 build Fri Jul 04 2025
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2025 Raoul van Rüschen
 * @license Zlib
 */var Xr=.001,Kr=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(e){"undefined"!=typeof document&&void 0!==document.hidden&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=e)}get delta(){return this._delta*Xr}get fixedDelta(){return this._fixedDelta*Xr}set fixedDelta(e){this._fixedDelta=1e3*e}get elapsed(){return this._elapsed*Xr}update(e){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(void 0!==e?e:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(e){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},qr=(()=>{const e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]),n=new Ae;return n.setAttribute("position",new $(e,3)),n.setAttribute("uv",new $(t,2)),n})(),Yr=class e{static get fullscreenGeometry(){return qr}constructor(e="Pass",t=new N,n=new Q){this.name=e,this.renderer=null,this.scene=t,this.camera=n,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;null!==t&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return null!==this.screen?this.screen.material:null}set fullscreenMaterial(t){let n=this.screen;null!==n?n.material=t:(n=new oe(e.fullscreenGeometry,t),n.frustumCulled=!1,null===this.scene&&(this.scene=new N),this.scene.add(n),this.screen=n)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=fe){}render(e,t,n,r,i){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,n){}dispose(){for(const t of Object.keys(this)){const n=this[t];(n instanceof de||n instanceof Te||n instanceof Me||n instanceof e)&&this[t].dispose()}null!==this.fullscreenMaterial&&this.fullscreenMaterial.dispose()}},Zr=class extends Yr{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,n,r,i){const s=e.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},$r=class extends ge{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new be(null),opacity:new be(1)},blending:we,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#include <dithering_pars_fragment>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;\n#include <colorspace_fragment>\n#include <dithering_fragment>\n}",vertexShader:"varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}"})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},Qr=class extends Yr{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new $r,this.needsSwap=!1,this.renderTarget=e,void 0===e&&(this.renderTarget=new de(1,1,{minFilter:pe,magFilter:pe,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,n,r,i){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,n){void 0!==n&&(this.renderTarget.texture.type=n,n!==ae?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":null!==e&&e.outputColorSpace===K&&(this.renderTarget.texture.colorSpace=K))}},Jr=new q,ei=class extends Yr{constructor(e=!0,t=!0,n=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=n,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,n){this.color=e,this.depth=t,this.stencil=n}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,n,r,i){const s=this.overrideClearColor,o=this.overrideClearAlpha,a=e.getClearAlpha(),l=null!==s,c=o>=0;l?(e.getClearColor(Jr),e.setClearColor(s,c?o:a)):c&&e.setClearAlpha(o),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(Jr,a):c&&e.setClearAlpha(a)}},ti=class extends Yr{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new ei(!1,!1,!0),this.inverse=!1}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,n,r,i){const s=e.getContext(),o=e.state.buffers,a=this.scene,l=this.camera,c=this.clearPass,u=this.inverted?0:1,h=1-u;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),o.stencil.setFunc(s.ALWAYS,u,4294967295),o.stencil.setClear(h),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(e,null):(c.render(e,t),c.render(e,n))),this.renderToScreen?(e.setRenderTarget(null),e.render(a,l)):(e.setRenderTarget(t),e.render(a,l),e.setRenderTarget(n),e.render(a,l)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(s.EQUAL,1,4294967295),o.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),o.stencil.setLocked(!0)}},ni=class{constructor(e=null,{depthBuffer:t=!0,stencilBuffer:n=!1,multisampling:r=0,frameBufferType:i}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,n,i,r),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new Qr,this.depthTexture=null,this.passes=[],this.timer=new Kr,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){const t=this.inputBuffer,n=this.multisampling;n>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):n!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,null!==e){const t=e.getSize(new te),n=e.getContext().getContextAttributes().alpha,r=this.inputBuffer.texture.type;r===ae&&e.outputColorSpace===K&&(this.inputBuffer.texture.colorSpace=K,this.outputBuffer.texture.colorSpace=K,this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(t.width,t.height);for(const i of this.passes)i.initialize(e,n,r)}}replaceRenderer(e,t=!0){const n=this.renderer,r=n.domElement.parentNode;return this.setRenderer(e),t&&null!==r&&(r.removeChild(n.domElement),r.appendChild(e.domElement)),n}createDepthTexture(){const e=this.depthTexture=new le;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=ce,e.type=ue):e.type=he,e}deleteDepthTexture(){if(null!==this.depthTexture){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,n,r){const i=this.renderer,s=null===i?new te:i.getDrawingBufferSize(new te),o={minFilter:pe,magFilter:pe,stencilBuffer:t,depthBuffer:e,type:n},a=new de(s.width,s.height,o);return r>0&&(a.ignoreDepthForMultisampleCopy=!1,a.samples=r),n===ae&&null!==i&&i.outputColorSpace===K&&(a.texture.colorSpace=K),a.texture.name="EffectComposer.Buffer",a.texture.generateMipmaps=!1,a}setMainScene(e){for(const t of this.passes)t.mainScene=e}setMainCamera(e){for(const t of this.passes)t.mainCamera=e}addPass(e,t){const n=this.passes,r=this.renderer,i=r.getDrawingBufferSize(new te),s=r.getContext().getContextAttributes().alpha,o=this.inputBuffer.texture.type;if(e.setRenderer(r),e.setSize(i.width,i.height),e.initialize(r,s,o),this.autoRenderToScreen&&(n.length>0&&(n[n.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),void 0!==t?n.splice(t,0,e):n.push(e),this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!0),e.needsDepthTexture||null!==this.depthTexture)if(null===this.depthTexture){const t=this.createDepthTexture();for(e of n)e.setDepthTexture(t)}else e.setDepthTexture(this.depthTexture)}removePass(e){const t=this.passes,n=t.indexOf(e);if(-1!==n&&t.splice(n,1).length>0){if(null!==this.depthTexture){const n=(e,t)=>e||t.needsDepthTexture;t.reduce(n,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&n===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){const e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){const t=this.renderer,n=this.copyPass;let r,i,s,o=this.inputBuffer,a=this.outputBuffer,l=!1;void 0===e&&(this.timer.update(),e=this.timer.getDelta());for(const c of this.passes)c.enabled&&(c.render(t,o,a,e,l),c.needsSwap&&(l&&(n.renderToScreen=c.renderToScreen,r=t.getContext(),i=t.state.buffers.stencil,i.setFunc(r.NOTEQUAL,1,4294967295),n.render(t,o,a,e,l),i.setFunc(r.EQUAL,1,4294967295)),s=o,o=a,a=s),c instanceof ti?l=!0:c instanceof Zr&&(l=!1))}setSize(e,t,n){const r=this.renderer,i=r.getSize(new te);void 0!==e&&void 0!==t||(e=i.width,t=i.height),i.width===e&&i.height===t||r.setSize(e,t,n);const s=r.getDrawingBufferSize(new te);this.inputBuffer.setSize(s.width,s.height),this.outputBuffer.setSize(s.width,s.height);for(const o of this.passes)o.setSize(s.width,s.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const e of this.passes)e.dispose();this.passes=[],null!==this.inputBuffer&&this.inputBuffer.dispose(),null!==this.outputBuffer&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),Yr.fullscreenGeometry.dispose()}},ri=0,ii=1,si=2,oi={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},ai=class{constructor(){this.shaderParts=new Map([[oi.FRAGMENT_HEAD,null],[oi.FRAGMENT_MAIN_UV,null],[oi.FRAGMENT_MAIN_IMAGE,null],[oi.VERTEX_HEAD,null],[oi.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=ri,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Ee}},li=!1,ci=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case se:t=this.materialsFlatShadedDoubleSide;break;case me:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded}else switch(e.material.side){case se:t=this.materialsDoubleSide;break;case me:t=this.materialsBackSide;break;default:t=this.materials}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(e){if(!(e instanceof ge))return e.clone();const t=e.uniforms,n=new Map;for(const i in t){const e=t[i].value;e.isRenderTargetTexture&&(t[i].value=null,n.set(i,e))}const r=e.clone();for(const i of n)t[i[0]].value=i[1],r.uniforms[i[0]].value=i[1];return r}setMaterial(e){if(this.disposeMaterials(),this.material=e,null!==e){const t=this.materials=[this.cloneMaterial(e),this.cloneMaterial(e),this.cloneMaterial(e)];for(const n of t)n.uniforms=Object.assign({},e.uniforms),n.side=ve;t[2].skinning=!0,this.materialsBackSide=t.map((t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},e.uniforms),n.side=me,n})),this.materialsDoubleSide=t.map((t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},e.uniforms),n.side=se,n})),this.materialsFlatShaded=t.map((t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n})),this.materialsFlatShadedBackSide=t.map((t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n.side=me,n})),this.materialsFlatShadedDoubleSide=t.map((t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n.side=se,n}))}}render(e,t,n){const r=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,li){const r=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,n);for(const e of r)e[0].material=e[1];this.meshCount!==r.size&&r.clear()}else{const r=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,n),t.overrideMaterial=r}e.shadowMap.enabled=r}disposeMaterials(){if(null!==this.material){const e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return li}static set workaroundEnabled(e){li=e}},ui=-1,hi=class extends Se{constructor(e,t=-1,n=-1,r=1){super(),this.resizable=e,this.baseSize=new te(1,1),this.preferredSize=new te(t,n),this.target=this.preferredSize,this.s=r,this.effectiveSize=new te,this.addEventListener("change",(()=>this.updateEffectiveSize())),this.updateEffectiveSize()}updateEffectiveSize(){const e=this.baseSize,t=this.preferredSize,n=this.effectiveSize,r=this.scale;t.width!==ui?n.width=t.width:t.height!==ui?n.width=Math.round(t.height*(e.width/Math.max(e.height,1))):n.width=Math.round(e.width*r),t.height!==ui?n.height=t.height:t.width!==ui?n.height=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):n.height=Math.round(e.height*r)}get width(){return this.effectiveSize.width}set width(e){this.preferredWidth=e}get height(){return this.effectiveSize.height}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferredSize.setScalar(ui),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.baseSize.width}set baseWidth(e){this.baseSize.width!==e&&(this.baseSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(e){this.baseWidth=e}get baseHeight(){return this.baseSize.height}set baseHeight(e){this.baseSize.height!==e&&(this.baseSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){this.baseSize.width===e&&this.baseSize.height===t||(this.baseSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(e){this.preferredSize.width!==e&&(this.preferredSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferredSize.height}set preferredHeight(e){this.preferredSize.height!==e&&(this.preferredSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){this.preferredSize.width===e&&this.preferredSize.height===t||(this.preferredSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(e){this.s=e.scale,this.baseSize.set(e.baseWidth,e.baseHeight),this.preferredSize.set(e.preferredWidth,e.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return ui}},di=9,pi=23,fi=new Map([[0,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb,y.a),opacity);}"],[1,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,y.a*opacity);}"],[2,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb)*0.5,y.a),opacity);}"],[3,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.xy,xHSL.z));return mix(x,vec4(z,y.a),opacity);}"],[4,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=mix(step(0.0,b)*(1.0-min(vec3(1.0),(1.0-a)/b)),vec3(1.0),step(1.0,a));return mix(x,vec4(z,y.a),opacity);}"],[5,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=step(0.0,a)*mix(min(vec3(1.0),a/max(1.0-b,1e-9)),vec3(1.0),step(1.0,b));return mix(x,vec4(z,y.a),opacity);}"],[6,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb,y.rgb),y.a),opacity);}"],[7,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(abs(x.rgb-y.rgb),y.a),opacity);}"],[8,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb/max(y.rgb,1e-12),y.a),opacity);}"],[di,null],[10,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb-2.0*x.rgb*y.rgb),y.a),opacity);}"],[11,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=min(x.rgb,1.0);vec3 b=min(y.rgb,1.0);vec3 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,b));return mix(x,vec4(z,y.a),opacity);}"],[12,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(step(1.0,x.rgb+y.rgb),y.a),opacity);}"],[13,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.x,xHSL.yz));return mix(x,vec4(z,y.a),opacity);}"],[14,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-y.rgb,y.a),opacity);}"],[15,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(y.rgb*(1.0-x.rgb),y.a),opacity);}"],[16,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb,y.rgb),y.a),opacity);}"],[17,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(y.rgb+x.rgb-1.0,0.0,1.0),y.a),opacity);}"],[18,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb+y.rgb,1.0),y.a),opacity);}"],[19,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(2.0*y.rgb+x.rgb-1.0,0.0,1.0),y.a),opacity);}"],[20,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.xy,yHSL.z));return mix(x,vec4(z,y.a),opacity);}"],[21,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb*y.rgb,y.a),opacity);}"],[22,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-abs(1.0-x.rgb-y.rgb),y.a),opacity);}"],[pi,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}"],[24,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(2.0*y.rgb*x.rgb,1.0-2.0*(1.0-y.rgb)*(1.0-x.rgb),step(0.5,x.rgb));return mix(x,vec4(z,y.a),opacity);}"],[25,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 y2=2.0*y.rgb;vec3 z=mix(mix(y2,x.rgb,step(0.5*x.rgb,y.rgb)),max(y2-1.0,vec3(0.0)),step(x.rgb,y2-1.0));return mix(x,vec4(z,y.a),opacity);}"],[26,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(min(x.rgb*x.rgb/max(1.0-y.rgb,1e-12),1.0),y.rgb,step(1.0,y.rgb));return mix(x,vec4(z,y.a),opacity);}"],[27,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.x,yHSL.y,xHSL.z));return mix(x,vec4(z,y.a),opacity);}"],[28,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb-min(x.rgb*y.rgb,1.0),y.a),opacity);}"],[29,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb;vec3 b=y.rgb;vec3 y2=2.0*b;vec3 w=step(0.5,b);vec3 c=a-(1.0-y2)*a*(1.0-a);vec3 d=mix(a+(y2-1.0)*(sqrt(a)-a),a+(y2-1.0)*a*((16.0*a-12.0)*a+3.0),w*(1.0-step(0.25,a)));vec3 z=mix(c,d,w);return mix(x,vec4(z,y.a),opacity);}"],[30,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}"],[31,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb+y.rgb-1.0,0.0),y.a),opacity);}"],[32,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(max(1.0-min((1.0-x.rgb)/(2.0*y.rgb),1.0),0.0),min(x.rgb/(2.0*(1.0-y.rgb)),1.0),step(0.5,y.rgb));return mix(x,vec4(z,y.a),opacity);}"]]),mi=class extends Se{constructor(e,t=1){super(),this._blendFunction=e,this.opacity=new be(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this._blendFunction}set blendFunction(e){this._blendFunction=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return fi.get(this.blendFunction)}},gi=class extends Se{constructor(e,t,{attributes:n=ri,blendFunction:r=pi,defines:i=new Map,uniforms:s=new Map,extensions:o=null,vertexShader:a=null}={}){super(),this.name=e,this.renderer=null,this.attributes=n,this.fragmentShader=t,this.vertexShader=a,this.defines=i,this.uniforms=s,this.extensions=o,this.blendMode=new mi(r),this.blendMode.addEventListener("change",(e=>this.setChanged())),this._inputColorSpace=Ee,this._outputColorSpace=Pe}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(e){this._inputColorSpace=e,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e,this.setChanged()}set mainScene(e){}set mainCamera(e){}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=fe){}update(e,t,n){}setSize(e,t){}initialize(e,t,n){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof de||t instanceof Te||t instanceof Me||t instanceof Yr)&&this[e].dispose()}}},vi=2,yi=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],_i=class extends ge{constructor(e=new Ce){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new be(null),texelSize:new be(new Ce),scale:new be(1),kernel:new be(0)},blending:we,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nvarying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;\n#include <colorspace_fragment>\n}",vertexShader:"uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}"}),this.setTexelSize(e.x,e.y),this.kernelSize=vi}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get kernelSequence(){return yi[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t,.5*e,.5*t)}setSize(e,t){const n=1/e,r=1/t;this.uniforms.texelSize.value.set(n,r,.5*n,.5*r)}},xi=class extends Yr{constructor({kernelSize:e=vi,resolutionScale:t=.5,width:n=hi.AUTO_SIZE,height:r=hi.AUTO_SIZE,resolutionX:i=n,resolutionY:s=r}={}){super("KawaseBlurPass"),this.renderTargetA=new de(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const o=this.resolution=new hi(this,i,s,t);o.addEventListener("change",(e=>this.setSize(o.baseWidth,o.baseHeight))),this._blurMaterial=new _i,this._blurMaterial.kernelSize=e,this.copyMaterial=new $r}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(e){this._blurMaterial=e}get dithering(){return this.copyMaterial.dithering}set dithering(e){this.copyMaterial.dithering=e}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(e){this.blurMaterial.kernelSize=e}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,n,r,i){const s=this.scene,o=this.camera,a=this.renderTargetA,l=this.renderTargetB,c=this.blurMaterial,u=c.kernelSequence;let h=t;this.fullscreenMaterial=c;for(let d=0,p=u.length;d<p;++d){const t=1&d?l:a;c.kernel=u[d],c.inputBuffer=h.texture,e.setRenderTarget(t),e.render(s,o),h=t}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=h.texture,e.setRenderTarget(this.renderToScreen?null:n),e.render(s,o)}setSize(e,t){const n=this.resolution;n.setBaseSize(e,t);const r=n.width,i=n.height;this.renderTargetA.setSize(r,i),this.renderTargetB.setSize(r,i),this.blurMaterial.setSize(e,t)}initialize(e,t,n){void 0!==n&&(this.renderTargetA.texture.type=n,this.renderTargetB.texture.type=n,n!==ae?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):null!==e&&e.outputColorSpace===K&&(this.renderTargetA.texture.colorSpace=K,this.renderTargetB.texture.colorSpace=K))}static get AUTO_SIZE(){return hi.AUTO_SIZE}},bi=class extends Yr{constructor(e,t,n=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new ei,this.overrideMaterialManager=null===n?null:new ci(n),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){const e=this.overrideMaterialManager;return null!==e?e.material:null}set overrideMaterial(e){const t=this.overrideMaterialManager;null!==e?null!==t?t.setMaterial(e):this.overrideMaterialManager=new ci(e):null!==t&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,n,r,i){const s=this.scene,o=this.camera,a=this.selection,l=o.layers.mask,c=s.background,u=e.shadowMap.autoUpdate,h=this.renderToScreen?null:t;null!==a&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||null!==this.clearPass.overrideClearColor)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(h),null!==this.overrideMaterialManager?this.overrideMaterialManager.render(e,s,o):e.render(s,o),o.layers.mask=l,s.background=c,e.shadowMap.autoUpdate=u}},wi=class extends ge{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new be(null),normalBuffer:new be(null),texelSize:new be(new te)},blending:we,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#include <packing>\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\n#ifdef DOWNSAMPLE_NORMALS\nuniform lowp sampler2D normalBuffer;\n#endif\nvarying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);\n#ifdef DOWNSAMPLE_NORMALS\nvec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;\n#else\nvec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);\n#endif\ngl_FragColor=vec4(n[index],d[index]);}",vertexShader:"uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}"})}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=fe){this.depthBuffer=e,this.depthPacking=t}set normalBuffer(e){this.uniforms.normalBuffer.value=e,null!==e?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(e){this.normalBuffer=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},Ti=class extends Yr{constructor({normalBuffer:e=null,resolutionScale:t=.5,width:n=hi.AUTO_SIZE,height:r=hi.AUTO_SIZE,resolutionX:i=n,resolutionY:s=r}={}){super("DepthDownsamplingPass");const o=new wi;o.normalBuffer=e,this.fullscreenMaterial=o,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new de(1,1,{minFilter:_e,magFilter:_e,depthBuffer:!1,type:xe}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const a=this.resolution=new hi(this,i,s,t);a.addEventListener("change",(e=>this.setSize(a.baseWidth,a.baseHeight)))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(e,t=fe){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t}render(e,t,n,r,i){e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){const n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height),this.fullscreenMaterial.setSize(e,t)}initialize(e,t,n){const r=e.getContext();if(!(r.getExtension("EXT_color_buffer_float")||r.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},Mi=class extends _i{constructor({kernelSize:e=vi,offset:t=0,rotation:n=0,focusArea:r=.4,feather:i=.3}={}){super(),this.fragmentShader="#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform vec4 maskParams;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;float linearGradientMask(const in float x){return smoothstep(maskParams.x,maskParams.y,x)-smoothstep(maskParams.w,maskParams.z,x);}void main(){vec2 dUv=vOffset*(1.0-linearGradientMask(vUv2.y));vec4 sum=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y-dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y-dUv.y));gl_FragColor=sum*0.25;\n#include <colorspace_fragment>\n}",this.vertexShader="uniform vec4 texelSize;uniform float kernel;uniform float scale;uniform float aspect;uniform vec2 rotation;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;void main(){vec2 uv=position.xy*0.5+0.5;vUv=uv;vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));vOffset=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;gl_Position=vec4(position.xy,1.0,1.0);}",this.kernelSize=e,this.uniforms.aspect=new be(1),this.uniforms.rotation=new be(new te),this.uniforms.maskParams=new be(new Ce),this._offset=t,this._focusArea=r,this._feather=i,this.rotation=n,this.updateParams()}updateParams(){const e=this.uniforms.maskParams.value,t=Math.max(this.focusArea,0),n=Math.max(t-this.feather,0);e.set(this.offset-t,this.offset-n,this.offset+t,this.offset+n)}get rotation(){return Math.acos(this.uniforms.rotation.value.x)}set rotation(e){this.uniforms.rotation.value.set(Math.cos(e),Math.sin(e))}get offset(){return this._offset}set offset(e){this._offset=e,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(e){this._focusArea=e,this.updateParams()}get feather(){return this._feather}set feather(e){this._feather=e,this.updateParams()}setSize(e,t){super.setSize(e,t),this.uniforms.aspect.value=e/t}},Ai=class extends xi{constructor({offset:e=0,rotation:t=0,focusArea:n=.4,feather:r=.3,kernelSize:i=vi,resolutionScale:s=.5,resolutionX:o=hi.AUTO_SIZE,resolutionY:a=hi.AUTO_SIZE}={}){super({kernelSize:i,resolutionScale:s,resolutionX:o,resolutionY:a}),this.blurMaterial=new Mi({kernelSize:i,offset:e,rotation:t,focusArea:n,feather:r})}},Si=class extends gi{constructor({blendFunction:e,offset:t=0,rotation:n=0,focusArea:r=.4,feather:i=.3,kernelSize:s=vi,resolutionScale:o=.5,resolutionX:a=hi.AUTO_SIZE,resolutionY:l=hi.AUTO_SIZE}={}){super("TiltShiftEffect","#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D map;\n#else\nuniform lowp sampler2D map;\n#endif\nuniform vec2 maskParams;varying vec2 vUv2;float linearGradientMask(const in float x){return step(maskParams.x,x)-step(maskParams.y,x);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){float mask=linearGradientMask(vUv2.y);vec4 texel=texture2D(map,uv);outputColor=mix(texel,inputColor,mask);}",{vertexShader:"uniform vec2 rotation;varying vec2 vUv2;void mainSupport(const in vec2 uv){vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));}",blendFunction:e,uniforms:new Map([["rotation",new be(new te)],["maskParams",new be(new te)],["map",new be(null)]])}),this._offset=t,this._focusArea=r,this._feather=i,this.renderTarget=new de(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="TiltShift.Target",this.uniforms.get("map").value=this.renderTarget.texture,this.blurPass=new Ai({kernelSize:s,resolutionScale:o,resolutionX:a,resolutionY:l,offset:t,rotation:n,focusArea:r,feather:i});const c=this.resolution=new hi(this,a,l,o);c.addEventListener("change",(e=>this.setSize(c.baseWidth,c.baseHeight))),this.rotation=n,this.updateParams()}updateParams(){const e=this.uniforms.get("maskParams").value,t=Math.max(this.focusArea-this.feather,0);e.set(this.offset-t,this.offset+t)}get rotation(){return Math.acos(this.uniforms.get("rotation").value.x)}set rotation(e){this.uniforms.get("rotation").value.set(Math.cos(e),Math.sin(e)),this.blurPass.blurMaterial.rotation=e}get offset(){return this._offset}set offset(e){this._offset=e,this.blurPass.blurMaterial.offset=e,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(e){this._focusArea=e,this.blurPass.blurMaterial.focusArea=e,this.updateParams()}get feather(){return this._feather}set feather(e){this._feather=e,this.blurPass.blurMaterial.feather=e,this.updateParams()}get bias(){return 0}set bias(e){}update(e,t,n){this.blurPass.render(e,t,this.renderTarget)}setSize(e,t){const n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height),this.blurPass.resolution.copy(n)}initialize(e,t,n){this.blurPass.initialize(e,t,n),void 0!==n&&(this.renderTarget.texture.type=n,null!==e&&e.outputColorSpace===K&&(this.renderTarget.texture.colorSpace=K))}},Ei="#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#define packFloatToRGBA(v) packDepthToRGBA(v)\n#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#if DEPTH_PACKING == 3201\nuniform lowp sampler2D depthBuffer;\n#elif defined(GL_FRAGMENT_PRECISION_HIGH)\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}float getViewZ(const in float depth){\n#ifdef PERSPECTIVE_CAMERA\nreturn perspectiveDepthToViewZ(depth,cameraNear,cameraFar);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNear,cameraFar);\n#endif\n}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;\n#ifdef ENCODE_OUTPUT\n#include <colorspace_fragment>\n#endif\n#include <dithering_fragment>\n}",Pi="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",Ci=class extends ge{constructor(e,t,n,r,i=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:J.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new be(null),depthBuffer:new be(null),resolution:new be(new te),texelSize:new be(new te),cameraNear:new be(.3),cameraFar:new be(1e3),aspect:new be(1),time:new be(0)},blending:we,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:i}),e&&this.setShaderParts(e),t&&this.setDefines(t),n&&this.setUniforms(n),this.copyCameraSettings(r)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=fe){this.depthBuffer=e,this.depthPacking=t}setShaderData(e){this.setShaderParts(e.shaderParts),this.setDefines(e.defines),this.setUniforms(e.uniforms),this.setExtensions(e.extensions)}setShaderParts(e){return this.fragmentShader=Ei.replace(oi.FRAGMENT_HEAD,e.get(oi.FRAGMENT_HEAD)||"").replace(oi.FRAGMENT_MAIN_UV,e.get(oi.FRAGMENT_MAIN_UV)||"").replace(oi.FRAGMENT_MAIN_IMAGE,e.get(oi.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=Pi.replace(oi.VERTEX_HEAD,e.get(oi.VERTEX_HEAD)||"").replace(oi.VERTEX_MAIN_SUPPORT,e.get(oi.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(e){for(const t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(const t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(const t of e)this.extensions[t]=!0;return this}get encodeOutput(){return void 0!==this.defines.ENCODE_OUTPUT}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){this.copyCameraSettings(e)}copyCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof j?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){const n=this.uniforms;n.resolution.value.set(e,t),n.texelSize.value.set(1/e,1/t),n.aspect.value=e/t}static get Section(){return oi}};function Ri(e,t,n){for(const r of t){const t="$1"+e+r.charAt(0).toUpperCase()+r.slice(1),i=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(const e of n.entries())null!==e[1]&&n.set(e[0],e[1].replace(i,t))}}function Li(e,t,n){let r=t.getFragmentShader(),i=t.getVertexShader();const s=void 0!==r&&/mainImage/.test(r),o=void 0!==r&&/mainUv/.test(r);if(n.attributes|=t.getAttributes(),void 0===r)throw new Error(`Missing fragment shader (${t.name})`);if(o&&n.attributes&si)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${t.name})`);if(!s&&!o)throw new Error(`Could not find mainImage or mainUv function (${t.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,l=n.shaderParts;let c=l.get(oi.FRAGMENT_HEAD)||"",u=l.get(oi.FRAGMENT_MAIN_UV)||"",h=l.get(oi.FRAGMENT_MAIN_IMAGE)||"",d=l.get(oi.VERTEX_HEAD)||"",p=l.get(oi.VERTEX_MAIN_SUPPORT)||"";const f=new Set,m=new Set;if(o&&(u+=`\t${e}MainUv(UV);\n`,n.uvTransformation=!0),null!==i&&/mainSupport/.test(i)){const t=/mainSupport *\([\w\s]*?uv\s*?\)/.test(i);p+=`\t${e}MainSupport(`,p+=t?"vUv);\n":");\n";for(const e of i.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const t of e[1].split(/\s*,\s*/))n.varyings.add(t),f.add(t),m.add(t);for(const e of i.matchAll(a))m.add(e[1])}for(const e of r.matchAll(a))m.add(e[1]);for(const e of t.defines.keys())m.add(e.replace(/\([\w\s,]*\)/g,""));for(const e of t.uniforms.keys())m.add(e);m.delete("while"),m.delete("for"),m.delete("if"),t.uniforms.forEach(((t,r)=>n.uniforms.set(e+r.charAt(0).toUpperCase()+r.slice(1),t))),t.defines.forEach(((t,r)=>n.defines.set(e+r.charAt(0).toUpperCase()+r.slice(1),t)));const g=new Map([["fragment",r],["vertex",i]]);Ri(e,m,n.defines),Ri(e,m,g),r=g.get("fragment"),i=g.get("vertex");const v=t.blendMode;if(n.blendModes.set(v.blendFunction,v),s){null!==t.inputColorSpace&&t.inputColorSpace!==n.colorSpace&&(h+=t.inputColorSpace===K?"color0 = sRGBTransferOETF(color0);\n\t":"color0 = sRGBToLinear(color0);\n\t"),t.outputColorSpace!==Pe?n.colorSpace=t.outputColorSpace:null!==t.inputColorSpace&&(n.colorSpace=t.inputColorSpace);const i=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;h+=`${e}MainImage(color0, UV, `,n.attributes&ii&&i.test(r)&&(h+="depth, ",n.readDepth=!0),h+="color1);\n\t";const s=e+"BlendOpacity";n.uniforms.set(s,v.opacity),h+=`color0 = blend${v.blendFunction}(color0, color1, ${s});\n\n\t`,c+=`uniform float ${s};\n\n`}if(c+=r+"\n",null!==i&&(d+=i+"\n"),l.set(oi.FRAGMENT_HEAD,c),l.set(oi.FRAGMENT_MAIN_UV,u),l.set(oi.FRAGMENT_MAIN_IMAGE,h),l.set(oi.VERTEX_HEAD,d),l.set(oi.VERTEX_MAIN_SUPPORT,p),null!==t.extensions)for(const e of t.extensions)n.extensions.add(e)}}var Ii=class extends Yr{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new Ci(null,null,null,e),this.listener=e=>this.handleEvent(e),this.effects=[],this.setEffects(t),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(e){for(const t of this.effects)t.mainScene=e}set mainCamera(e){this.fullscreenMaterial.copyCameraSettings(e);for(const t of this.effects)t.mainCamera=e}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){const t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}setEffects(e){for(const t of this.effects)t.removeEventListener("change",this.listener);this.effects=e.sort(((e,t)=>t.attributes-e.attributes));for(const t of this.effects)t.addEventListener("change",this.listener)}updateMaterial(){const e=new ai;let t=0;for(const o of this.effects)if(o.blendMode.blendFunction===di)e.attributes|=o.getAttributes()&ii;else{if(e.attributes&o.getAttributes()&si)throw new Error(`Convolution effects cannot be merged (${o.name})`);Li("e"+t++,o,e)}let n=e.shaderParts.get(oi.FRAGMENT_HEAD),r=e.shaderParts.get(oi.FRAGMENT_MAIN_IMAGE),i=e.shaderParts.get(oi.FRAGMENT_MAIN_UV);const s=/\bblend\b/g;for(const o of e.blendModes.values())n+=o.getShaderCode().replace(s,`blend${o.blendFunction}`)+"\n";e.attributes&ii?(e.readDepth&&(r="float depth = readDepth(UV);\n\n\t"+r),this.needsDepthTexture=null===this.getDepthTexture()):this.needsDepthTexture=!1,e.colorSpace===K&&(r+="color0 = sRGBToLinear(color0);\n\t"),e.uvTransformation?(i="vec2 transformedUv = vUv;\n"+i,e.defines.set("UV","transformedUv")):e.defines.set("UV","vUv"),e.shaderParts.set(oi.FRAGMENT_HEAD,n),e.shaderParts.set(oi.FRAGMENT_MAIN_IMAGE,r),e.shaderParts.set(oi.FRAGMENT_MAIN_UV,i);for(const[o,a]of e.shaderParts)null!==a&&e.shaderParts.set(o,a.trim().replace(/^#/,"\n#"));this.skipRendering=0===t,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(e)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=fe){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(const n of this.effects)n.setDepthTexture(e,t)}render(e,t,n,r,i){for(const s of this.effects)s.update(e,t,r);if(!this.skipRendering||this.renderToScreen){const i=this.fullscreenMaterial;i.inputBuffer=t.texture,i.time+=r*this.timeScale,e.setRenderTarget(this.renderToScreen?null:n),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(const n of this.effects)n.setSize(e,t)}initialize(e,t,n){this.renderer=e;for(const r of this.effects)r.initialize(e,t,n);this.updateMaterial(),void 0!==n&&n!==ae&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const e of this.effects)e.removeEventListener("change",this.listener),e.dispose()}handleEvent(e){if("change"===e.type)this.recompile()}},Di=class extends Yr{constructor(e,t,{renderTarget:n,resolutionScale:r=1,width:i=hi.AUTO_SIZE,height:s=hi.AUTO_SIZE,resolutionX:o=i,resolutionY:a=s}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new bi(e,t,new ye);const l=this.renderPass;l.ignoreBackground=!0,l.skipShadowMapUpdate=!0;const c=l.getClearPass();c.overrideClearColor=new q(7829503),c.overrideClearAlpha=1,this.renderTarget=n,void 0===this.renderTarget&&(this.renderTarget=new de(1,1,{minFilter:_e,magFilter:_e}),this.renderTarget.texture.name="NormalPass.Target");const u=this.resolution=new hi(this,o,a,r);u.addEventListener("change",(e=>this.setSize(u.baseWidth,u.baseHeight)))}set mainScene(e){this.renderPass.mainScene=e}set mainCamera(e){this.renderPass.mainCamera=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,n,r,i){const s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,s,s)}setSize(e,t){const n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height)}};let ki=class{static isWebGL2Available(){try{const e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch{return!1}}static isColorSpaceAvailable(e){try{const t=document.createElement("canvas"),n=window.WebGL2RenderingContext&&t.getContext("webgl2");return n.drawingBufferColorSpace=e,n.drawingBufferColorSpace===e}catch{return!1}}static getWebGL2ErrorMessage(){return this.getErrorMessage(2)}static getErrorMessage(e){const t={1:window.WebGLRenderingContext,2:window.WebGL2RenderingContext};let n='Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>';const r=document.createElement("div");return r.id="webglmessage",r.style.fontFamily="monospace",r.style.fontSize="13px",r.style.fontWeight="normal",r.style.textAlign="center",r.style.background="#fff",r.style.color="#000",r.style.padding="1.5em",r.style.width="400px",r.style.margin="5em auto 0",n=t[e]?n.replace("$0","graphics card"):n.replace("$0","browser"),n=n.replace("$1",{1:"WebGL",2:"WebGL 2"}[e]),r.innerHTML=n,r}static isWebGLAvailable(){console.warn("isWebGLAvailable() has been deprecated and will be removed in r178. Use isWebGL2Available() instead.");try{const e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch{return!1}}static getWebGLErrorMessage(){return console.warn("getWebGLErrorMessage() has been deprecated and will be removed in r178. Use getWebGL2ErrorMessage() instead."),this.getErrorMessage(1)}};const Oi=Symbol("effectComposerPmndrs"),Fi=e({__name:"EffectComposerPmndrs",props:{enabled:{type:Boolean,default:!0},depthBuffer:{type:Boolean,default:void 0},disableNormalPass:{type:Boolean,default:!1},stencilBuffer:{type:Boolean,default:void 0},resolutionScale:{},autoClear:{type:Boolean,default:!0},multisampling:{default:0},frameBufferType:{default:Re}},emits:["render"],setup(e,{expose:t,emit:n}){const r=e,s=n,{scene:o,camera:c,renderer:u,sizes:h,render:d}=fr(),p=i(null);let f=null,m=null;_(Oi,p),t({composer:p});const v=g((()=>{const e=new ni,t={depthBuffer:void 0!==r.depthBuffer?r.depthBuffer:e.inputBuffer.depthBuffer,stencilBuffer:void 0!==r.stencilBuffer?r.stencilBuffer:e.inputBuffer.stencilBuffer,multisampling:ki.isWebGL2Available()?void 0!==r.multisampling?r.multisampling:e.multisampling:0,frameBufferType:void 0!==r.frameBufferType?r.frameBufferType:Re};return e.dispose(),t})),y=()=>{var e;!u.value&&!o.value&&!c.value||(null==(e=p.value)||e.dispose(),p.value=new ni(u.value,v.value),p.value.addPass(new bi(o.value,c.value)),r.disableNormalPass||p.value&&(m=new Di(o.value,c.value),m.enabled=!1,p.value.addPass(m),void 0!==r.resolutionScale&&ki.isWebGL2Available()&&(f=new Ti({normalBuffer:m.texture,resolutionScale:r.resolutionScale}),f.enabled=!1,p.value.addPass(f))))};a([u,o,c,()=>r.disableNormalPass],(()=>{!h.width.value||!h.height.value||y()})),a((()=>[h.width.value,h.height.value]),(([e,t])=>{!e&&!t||(p.value?p.value.setSize(e,t):y())}),{immediate:!0});const{render:x}=mr();return x((()=>{if(r.enabled&&u.value&&p.value&&h.width.value&&h.height.value&&d.frames.value>0){const e=u.value.autoClear;u.value.autoClear=r.autoClear,r.stencilBuffer&&!r.autoClear&&u.value.clearStencil(),p.value.render(),s("render",p.value),u.value.autoClear=e}d.frames.value="always"===d.mode.value?1:Math.max(0,d.frames.value-1)})),l((()=>{var e;null==(e=p.value)||e.dispose()})),(e,t)=>T(e.$slots,"default")}}),Ui=(e,n,r)=>{const s=t(Oi),o=i(null),c=i(null),{scene:u,camera:h,invalidate:d}=fr();a(n,(()=>d()));m((()=>{!h.value||null==c||!c.value||(c.value.mainCamera=h.value)}));const p=m((()=>{var t;!h.value||null==s||!s.value||!u.value||(M((()=>p())),!c.value&&(!h.value||null==s||!s.value||!u.value||(c.value=e(),o.value=new Ii(h.value,c.value),s.value.addPass(o.value,t))))}));return l((()=>{var e,t,n;o.value&&(null==(e=null==s?void 0:s.value)||e.removePass(o.value)),null==(t=c.value)||t.dispose(),null==(n=o.value)||n.dispose()})),{pass:o,effect:c}},Bi=/([^[.\]])+/g,zi=(e,t,n)=>{const r=Array.isArray(t)?t:t.match(Bi);r&&r.reduce(((e,t,i)=>(void 0===e[t]&&(e[t]={}),i===r.length-1&&(e[t]=n),e[t])),e)},Ni=(e,t,n,r,i={})=>a(e,(i=>{var s;if(t.value)if(void 0===i){const e=r();zi(t.value,n,((e,t)=>{if(!t)return;const n=Array.isArray(t)?t:t.match(Bi);return null==n?void 0:n.reduce(((e,t)=>e&&e[t]),e)})(e,n)),null==(s=e.dispose)||s.call(e)}else zi(t.value,n,e())}),i),ji=e({__name:"TiltShiftPmndrs",props:{blendFunction:{},offset:{},rotation:{},focusArea:{},feather:{},kernelSize:{},resolutionScale:{},resolutionX:{},resolutionY:{}},setup(e,{expose:t}){const n=e,{pass:r,effect:i}=Ui((()=>new Si(n)),n);return t({pass:r,effect:i}),((e,t,n)=>{e.map((([e,r])=>Ni(e,t,r,n)))})([[()=>n.blendFunction,"blendMode.blendFunction"],[()=>n.offset,"offset"],[()=>n.rotation,"rotation"],[()=>n.focusArea,"focusArea"],[()=>n.feather,"feather"],[()=>n.kernelSize,"kernelSize"],[()=>n.resolutionScale,"resolution.scale"],[()=>n.resolutionX,"resolution.width"],[()=>n.resolutionY,"resolution.height"]],i,(()=>new Si)),()=>{}}});new Le(-1,1,1,-1,0,1);new class extends Ae{constructor(){super(),this.setAttribute("position",new Ie([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Ie([0,2,0,0,2,0],2))}},new te(1/1024,1/512),new te(1/1024,1/512),new te(1/1024,1/512),new q(0),new te(1,0),new te(0,1);class Hi extends Z{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new te(.5,.5),this.addEventListener("removed",(function(){this.traverse((function(e){e.element instanceof e.element.ownerDocument.defaultView.Element&&null!==e.element.parentNode&&e.element.remove()}))}))}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const Gi=new ne,Vi=new Ne,Wi=new Ne,Xi=new ne,Ki=new ne;class qi{constructor(e={}){const t=this;let n,r,i,s;const o={objects:new WeakMap},a=void 0!==e.element?e.element:document.createElement("div");function l(e){e.isCSS2DObject&&(e.element.style.display="none");for(let t=0,n=e.children.length;t<n;t++)l(e.children[t])}function c(e,n,r){if(!1!==e.visible){if(e.isCSS2DObject){Gi.setFromMatrixPosition(e.matrixWorld),Gi.applyMatrix4(Wi);const l=Gi.z>=-1&&Gi.z<=1&&!0===e.layers.test(r.layers),c=e.element;c.style.display=!0===l?"":"none",!0===l&&(e.onBeforeRender(t,n,r),c.style.transform="translate("+-100*e.center.x+"%,"+-100*e.center.y+"%)translate("+(Gi.x*i+i)+"px,"+(-Gi.y*s+s)+"px)",c.parentNode!==a&&a.appendChild(c),e.onAfterRender(t,n,r));const h={distanceToCameraSquared:u(r,e)};o.objects.set(e,h)}for(let t=0,i=e.children.length;t<i;t++)c(e.children[t],n,r)}else l(e)}function u(e,t){return Xi.setFromMatrixPosition(e.matrixWorld),Ki.setFromMatrixPosition(t.matrixWorld),Xi.distanceToSquared(Ki)}a.style.overflow="hidden",this.domElement=a,this.getSize=function(){return{width:n,height:r}},this.render=function(e,t){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),Vi.copy(t.matrixWorldInverse),Wi.multiplyMatrices(t.projectionMatrix,Vi),c(e,e,t),function(e){const t=function(e){const t=[];return e.traverseVisible((function(e){e.isCSS2DObject&&t.push(e)})),t}(e).sort((function(e,t){if(e.renderOrder!==t.renderOrder)return t.renderOrder-e.renderOrder;return o.objects.get(e).distanceToCameraSquared-o.objects.get(t).distanceToCameraSquared})),n=t.length;for(let r=0,i=t.length;r<i;r++)t[r].element.style.zIndex=n-r}(e)},this.setSize=function(e,t){n=e,r=t,i=n/2,s=r/2,a.style.width=e+"px",a.style.height=t+"px"}}}function Yi(e,t){if(!e)throw new Error("Invariant failed")}const Zi=new ne;function $i(e,t,n=new ne,r){const{x:i,y:s,z:o}=e,a=t.x,l=t.y,c=t.z,u=i*i*a,h=s*s*l,d=o*o*c,p=u+h+d,f=Math.sqrt(1/p);if(!Number.isFinite(f))return;const m=Zi.copy(e).multiplyScalar(f);if(p<(r?.centerTolerance??.1))return n.copy(m);const g=m.multiply(t).multiplyScalar(2);let v,y,_,x,b=(1-f)*e.length()/(g.length()/2),w=0;do{b-=w,v=1/(1+b*a),y=1/(1+b*l),_=1/(1+b*c);const e=v*v,t=y*y,n=_*_;x=u*e+h*t+d*n-1,w=x/(-2*(u*(e*v)*a+h*(t*y)*l+d*(n*_)*c))}while(Math.abs(x)>1e-12);return n.set(i*v,s*y,o*_)}const Qi=new ne,Ji=new ne,es=new ne;let ts=class e{static WGS84=new e(6378137,6378137,6356752.314245179);radii;constructor(e,t,n){this.radii=new ne(e,t,n)}get minimumRadius(){return Math.min(this.radii.x,this.radii.y,this.radii.z)}get maximumRadius(){return Math.max(this.radii.x,this.radii.y,this.radii.z)}reciprocalRadii(e=new ne){const{x:t,y:n,z:r}=this.radii;return e.set(1/t,1/n,1/r)}reciprocalRadiiSquared(e=new ne){const{x:t,y:n,z:r}=this.radii;return e.set(1/t**2,1/n**2,1/r**2)}projectOnSurface(e,t=new ne,n){return $i(e,this.reciprocalRadiiSquared(),t,n)}getSurfaceNormal(e,t=new ne){return t.multiplyVectors(this.reciprocalRadiiSquared(Qi),e).normalize()}getEastNorthUpVectors(e,t=new ne,n=new ne,r=new ne){this.getSurfaceNormal(e,r),t.set(-e.y,e.x,0).normalize(),n.crossVectors(r,t).normalize()}getEastNorthUpFrame(e,t=new Ne){const n=Qi,r=Ji,i=es;return this.getEastNorthUpVectors(e,n,r,i),t.makeBasis(n,r,i).setPosition(e)}getIntersection(e,t=new ne){const n=this.reciprocalRadii(Qi),r=Ji.copy(n).multiply(e.origin),i=es.copy(n).multiply(e.direction),s=r.lengthSq(),o=i.lengthSq(),a=r.dot(i),l=a**2-o*(s-1);if(1===s)return t.copy(e.origin);if(s>1){if(a>=0||l<0)return;const n=Math.sqrt(l),r=(-a-n)/o,i=(-a+n)/o;return e.at(Math.min(r,i),t)}if(s<1){const n=a**2-o*(s-1),r=(-a+Math.sqrt(n))/o;return e.at(r,t)}return a<0?e.at(-a/o,t):void 0}getOsculatingSphereCenter(e,t,n=new ne){Yi(this.radii.x===this.radii.y);const r=this.radii.x**2,i=this.radii.z**2,s=Qi.set(e.x/r,e.y/r,e.z/i).normalize();return n.copy(s.multiplyScalar(-t).add(e))}getNormalAtHorizon(e,t,n=new ne){Yi(this.radii.x===this.radii.y);const r=this.radii.x**2,i=this.radii.z**2,s=e,o=t;let a=(s.x*o.x+s.y*o.y)/r+s.z*o.z/i;a/=(s.x**2+s.y**2)/r+s.z**2/i;const l=Qi.copy(o).multiplyScalar(-a).add(e);return n.set(l.x/r,l.y/r,l.z/i).normalize()}};const ns=new ne,rs=new ne;class is{constructor(e=0,t=0,n=0){this.longitude=e,this.latitude=t,this.height=n}static MIN_LONGITUDE=-Math.PI;static MAX_LONGITUDE=Math.PI;static MIN_LATITUDE=-Math.PI/2;static MAX_LATITUDE=Math.PI/2;set(e,t,n){return this.longitude=e,this.latitude=t,null!=n&&(this.height=n),this}clone(){return new is(this.longitude,this.latitude,this.height)}copy(e){return this.longitude=e.longitude,this.latitude=e.latitude,this.height=e.height,this}equals(e){return e.longitude===this.longitude&&e.latitude===this.latitude&&e.height===this.height}setLongitude(e){return this.longitude=e,this}setLatitude(e){return this.latitude=e,this}setHeight(e){return this.height=e,this}normalize(){return this.longitude<is.MIN_LONGITUDE&&(this.longitude+=2*Math.PI),this}setFromECEF(e,t){const n=(t?.ellipsoid??ts.WGS84).reciprocalRadiiSquared(ns),r=$i(e,n,rs,t);if(null==r)throw new Error(`Could not project position to ellipsoid surface: ${e.toArray()}`);const i=ns.multiplyVectors(r,n).normalize();this.longitude=Math.atan2(i.y,i.x),this.latitude=Math.asin(i.z);const s=ns.subVectors(e,r);return this.height=Math.sign(s.dot(e))*s.length(),this}toECEF(e=new ne,t){const n=t?.ellipsoid??ts.WGS84,r=ns.multiplyVectors(n.radii,n.radii),i=Math.cos(this.latitude),s=rs.set(i*Math.cos(this.longitude),i*Math.sin(this.longitude),Math.sin(this.latitude)).normalize();return e.multiplyVectors(r,s),e.divideScalar(Math.sqrt(s.dot(e))).add(s.multiplyScalar(this.height))}fromArray(e,t=0){return this.longitude=e[t],this.latitude=e[t+1],this.height=e[t+2],this}toArray(e=[],t=0){return e[t]=this.longitude,e[t+1]=this.latitude,e[t+2]=this.height,e}*[Symbol.iterator](){yield this.longitude,yield this.latitude,yield this.height}}const ss=1e-6,os=new ne,as=new ne,ls=new ne,cs=new ne,us=new ne,hs=new ne,ds=new Ne,ps=new Ge,fs=new Ve;class ms{_distance;heading;_pitch;roll;constructor(e=0,t=0,n=0,r=0){this.distance=e,this.heading=t,this.pitch=n,this.roll=r}get distance(){return this._distance}set distance(e){this._distance=Math.max(e,ss)}get pitch(){return this._pitch}set pitch(e){this._pitch=Y.clamp(e,-Math.PI/2+ss,Math.PI/2-ss)}set(e,t,n,r){return this.distance=e,this.heading=t,this.pitch=n,null!=r&&(this.roll=r),this}clone(){return new ms(this.distance,this.heading,this.pitch,this.roll)}copy(e){return this.distance=e.distance,this.heading=e.heading,this.pitch=e.pitch,this.roll=e.roll,this}equals(e){return e.distance===this.distance&&e.heading===this.heading&&e.pitch===this.pitch&&e.roll===this.roll}decompose(e,t,n,r,i=ts.WGS84){i.getEastNorthUpVectors(e,os,as,ls),r?.copy(ls);const s=cs.copy(os).multiplyScalar(Math.cos(this.heading)).add(us.copy(as).multiplyScalar(Math.sin(this.heading))).multiplyScalar(Math.cos(this.pitch)).add(us.copy(ls).multiplyScalar(Math.sin(this.pitch))).normalize().multiplyScalar(this.distance);if(t.copy(e).sub(s),0!==this.roll){const n=cs.copy(e).sub(t).normalize();ls.applyQuaternion(ps.setFromAxisAngle(n,this.roll))}n.setFromRotationMatrix(ds.lookAt(t,e,ls))}setFromCamera(e,t=ts.WGS84){const n=cs.setFromMatrixPosition(e.matrixWorld),r=us.set(0,0,.5).unproject(e).sub(n).normalize(),i=t.getIntersection(fs.set(n,r));if(null==i)return;this.distance=n.distanceTo(i),t.getEastNorthUpVectors(i,os,as,ls),this.heading=Math.atan2(as.dot(r),os.dot(r)),this.pitch=Math.asin(ls.dot(r));const s=cs.copy(e.up).applyQuaternion(e.quaternion),o=hs.copy(r).multiplyScalar(-s.dot(r)).add(s).normalize(),a=cs.copy(r).multiplyScalar(-ls.dot(r)).add(ls).normalize(),l=a.dot(o),c=r.dot(a.cross(o));return this.roll=Math.atan2(c,l),this}}const gs=Y.degToRad,vs=Y.radToDeg,ys=(e,t,n)=>new is(gs(e),gs(t),n).toECEF(),_s=new ms,xs=new is,bs=new ne,ws=new ne,Ts=new Ve,Ms=ts.WGS84;function As(e,t,n){const r=n=>r=>{const i=[{...r,index:0},t,0];e(n,...i)};return{click:r("click"),"double-click":r("double-click"),"context-menu":r("context-menu"),"pointer-enter":r("pointer-enter"),"pointer-leave":r("pointer-leave"),"pointer-over":r("pointer-over"),"pointer-down":r("pointer-down"),"pointer-up":r("pointer-up"),wheel:r("wheel")}}function Ss(e,t){e.removeEventListener("click",t.click),e.removeEventListener("dblclick",t["double-click"]),e.removeEventListener("contextmenu",t["context-menu"]),e.removeEventListener("pointerenter",t["pointer-enter"]),e.removeEventListener("pointerleave",t["pointer-leave"]),e.removeEventListener("pointerover",t["pointer-over"]),e.removeEventListener("pointerdown",t["pointer-down"]),e.removeEventListener("pointerup",t["pointer-up"]),e.removeEventListener("wheel",t.wheel)}const Es=["object"],Ps=e({__name:"GeoCSS2D",props:{point:{},renderOrder:{default:1},id:{}},emits:["click","double-click","context-menu","pointer-enter","pointer-leave","pointer-over","pointer-down","pointer-up","wheel"],setup(e,{expose:t,emit:r}){const i=document.createElement("div"),u=e,d=n(),p=r,f=()=>{k(d.default()[0],i)},m=new Hi(i),g=new Oe;g.layers.enableAll(),g.add(m),m.layers.set(1),m.renderOrder=u.renderOrder;const v=()=>{const e=ys(u.point.lon,u.point.lat,u.point.height);m.position.copy(e)},y=As(p,u);return a([()=>u.point.lon,()=>u.point.lat,()=>u.point.height],(()=>{v()})),o((()=>{v(),f(),i.addEventListener("click",y.click),i.addEventListener("dblclick",y["double-click"]),i.addEventListener("contextmenu",y["context-menu"]),i.addEventListener("pointerenter",y["pointer-enter"]),i.addEventListener("pointerleave",y["pointer-leave"]),i.addEventListener("pointerover",y["pointer-over"]),i.addEventListener("pointerdown",y["pointer-down"]),i.addEventListener("pointerup",y["pointer-up"]),i.addEventListener("wheel",y.wheel)})),l((()=>{Ss(i,y),g.clear()})),t({update:f}),(e,t)=>(c(),s("primitive",{object:h(g)},null,8,Es))}}),Cs=["object"],Rs=e({__name:"GeoText",props:{point:{},fontSize:{default:16},color:{default:"#333"},text:{},renderOrder:{default:1},align:{default:"left"},id:{}},emits:["click","double-click","context-menu","pointer-enter","pointer-leave","pointer-over","pointer-down","pointer-up","wheel"],setup(e,{emit:t}){const n=document.createElement("div"),r=e,i=t,s=()=>{switch(n.innerText=r.text,n.style.fontSize=r.fontSize+"px",n.style.color=r.color,n.style.pointerEvents="auto",n.style.userSelect="none",r.align){case"center":n.style.transform="translateX(-50%)",n.style.textAlign="center";break;case"right":n.style.transform="translateX(-100%)",n.style.textAlign="right";break;default:n.style.transform="translateX(0)",n.style.textAlign="left"}},a=new Hi(n);a.renderOrder=r.renderOrder;const u=As(i,r);return o((()=>{s(),n.addEventListener("click",u.click),n.addEventListener("dblclick",u["double-click"]),n.addEventListener("contextmenu",u["context-menu"]),n.addEventListener("pointerenter",u["pointer-enter"]),n.addEventListener("pointerleave",u["pointer-leave"]),n.addEventListener("pointerover",u["pointer-over"]),n.addEventListener("pointerdown",u["pointer-down"]),n.addEventListener("pointerup",u["pointer-up"]),n.addEventListener("wheel",u.wheel)})),m((()=>{s()})),l((()=>{Ss(n,u),n.remove()})),(e,t)=>(c(),P(h(Ko),{point:r.point},{default:L((()=>[R("primitive",{object:h(a)},null,8,Cs)])),_:1},8,["point"]))}}),Ls=["object"],Is=e({__name:"GeoIcon",props:{point:{},size:{},icon:{},renderOrder:{default:1},id:{}},emits:["click","double-click","context-menu","pointer-enter","pointer-leave","pointer-over","pointer-down","pointer-up","wheel"],setup(e,{emit:t}){const n=document.createElement("img"),r=e,i=t,s=()=>{n.src=r.icon,n.style.width=r.size+"px",n.style.height=r.size+"px",n.style.left="0",n.style.top="0"},a=new Hi(n);a.renderOrder=r.renderOrder;const u=As(i,r);return o((()=>{s(),n.addEventListener("click",u.click),n.addEventListener("dblclick",u["double-click"]),n.addEventListener("contextmenu",u["context-menu"]),n.addEventListener("pointerenter",u["pointer-enter"]),n.addEventListener("pointerleave",u["pointer-leave"]),n.addEventListener("pointerover",u["pointer-over"]),n.addEventListener("pointerdown",u["pointer-down"]),n.addEventListener("pointerup",u["pointer-up"]),n.addEventListener("wheel",u.wheel)})),m((()=>{s()})),l((()=>{Ss(n,u),n.remove()})),(e,t)=>(c(),P(h(Ko),{point:r.point},{default:L((()=>[R("primitive",{object:h(a)},null,8,Ls)])),_:1},8,["point"]))}}),Ds=["object"],ks=e({__name:"GeoParticle",props:{points:{},size:{},icon:{},color:{},renderOrder:{default:1},raycastActive:{type:Boolean},raycastMultiplier:{default:1},sizeAttenuation:{type:Boolean,default:!0}},emits:["click","double-click","context-menu","pointer-enter","pointer-leave","pointer-over","pointer-down","pointer-up","wheel"],setup(e,{emit:t}){const n=e,u=t,d=i(),p=r([]),f=r(new ne),m=e=>{const t=e.raycast;e.raycast=function(e,r){const i=e.params.Points?.threshold||1;e.params.Points?e.params.Points.threshold=i*n.raycastMultiplier:e.params.Points={threshold:i*n.raycastMultiplier};const s=t.call(this,e,r);return e.params.Points.threshold=i,s}},g=()=>{if(d.value){const e=d.value.geometry,t=e.getAttribute("position"),r=e.getAttribute("color");p.value=n.points.map((e=>ys(e.lon,e.lat,e.height||0))),f.value=(e=>{if(0===e.length)return new ne;const t=new ne;return e.forEach((e=>t.add(e))),t.divideScalar(e.length),t})(p.value),((e,t)=>e.map((e=>e.clone().sub(t))))(p.value,f.value).forEach(((e,i)=>{t.setXYZ(i,e.x,e.y,e.z);const s=n.points[i].color||n.color||"#ffffff",o=new q(s);r.setXYZ(i,o.r,o.g,o.b)})),t.needsUpdate=!0,r.needsUpdate=!0,d.value.position.copy(f.value)}};a((()=>n.points),(()=>{g()}),{immediate:!0}),a((()=>n.size),(()=>{d.value&&(d.value.material.size=n.size||32,d.value.material.needsUpdate=!0)})),a((()=>n.raycastMultiplier),(e=>{d.value&&m(d.value)}));const v=e=>t=>{if(d.value&&n.raycastActive&&void 0!==t.index&&t.index<n.points.length){const r=n.points[t.index];u(e,t,r,t.index)}},y=v("click"),_=v("double-click"),x=v("context-menu"),b=v("pointer-enter"),w=v("pointer-leave"),T=v("pointer-over"),M=v("pointer-down"),A=v("pointer-up"),S=v("wheel");return o((()=>{(()=>{const e=new je({size:n.size||32,transparent:!0,sizeAttenuation:n.sizeAttenuation,vertexColors:!0});if(n.icon){const t=(new De).load(n.icon);e.map=t,e.needsUpdate=!0}const t=new Ae,r=new Float32Array(3*n.points.length),i=new Float32Array(3*n.points.length);t.setAttribute("position",new Ie(r,3)),t.setAttribute("color",new Ie(i,3)),d.value=new He(t,e),d.value.renderOrder=n.renderOrder,m(d.value)})(),g()})),l((()=>{if(d.value){d.value.geometry.dispose();const e=d.value.material;e.map?.dispose(),e.dispose()}})),(e,t)=>d.value?(c(),s("primitive",{key:0,object:d.value,onClick:t[0]||(t[0]=(...e)=>h(y)&&h(y)(...e)),onDoubleClick:t[1]||(t[1]=(...e)=>h(_)&&h(_)(...e)),onContextMenu:t[2]||(t[2]=(...e)=>h(x)&&h(x)(...e)),onPointerEnter:t[3]||(t[3]=(...e)=>h(b)&&h(b)(...e)),onPointerLeave:t[4]||(t[4]=(...e)=>h(w)&&h(w)(...e)),onPointerOver:t[5]||(t[5]=(...e)=>h(T)&&h(T)(...e)),onPointerDown:t[6]||(t[6]=(...e)=>h(M)&&h(M)(...e)),onPointerUp:t[7]||(t[7]=(...e)=>h(A)&&h(A)(...e)),onWheel:t[8]||(t[8]=(...e)=>h(S)&&h(S)(...e))},null,40,Ds)):C("",!0)}}),Os=["object"],Fs=e({__name:"GeoPoint",props:{point:{},color:{},size:{},icon:{},renderOrder:{default:1},raycastActive:{type:Boolean},raycastMultiplier:{default:1},sizeAttenuation:{type:Boolean,default:!0},id:{}},emits:["click","double-click","context-menu","pointer-enter","pointer-leave","pointer-over","pointer-down","pointer-up","wheel"],setup(e,{emit:t}){const n=e,r=t,u=i(),d=e=>{const t=e.raycast;e.raycast=function(e,r){const i=e.params.Points?.threshold||1;e.params.Points?e.params.Points.threshold=i*n.raycastMultiplier:e.params.Points={threshold:i*n.raycastMultiplier};const s=t.call(this,e,r);return e.params.Points.threshold=i,s}};a((()=>n.size),(e=>{u.value&&(u.value.material.size=e||32,u.value.material.needsUpdate=!0)}));const p=e=>t=>{!u.value||!n.raycastActive||void 0!==t.index&&r(e,t,n,0)},f=p("click"),m=p("double-click"),g=p("context-menu"),v=p("pointer-enter"),y=p("pointer-leave"),_=p("pointer-over"),x=p("pointer-down"),b=p("pointer-up"),w=p("wheel");return o((()=>{const e=new Ae;e.setAttribute("position",new Ie([0,0,0],3));const t=new je({size:n.size||32,transparent:!0,sizeAttenuation:n.sizeAttenuation,color:n.color||"#ffffff"});if(n.icon){const e=new De;t.map=e.load(n.icon),t.needsUpdate=!0}u.value=new He(e,t),u.value.renderOrder=n.renderOrder,d(u.value)})),l((()=>{if(u.value){u.value.geometry.dispose();const e=u.value.material;e.map?.dispose(),e.dispose()}})),(e,t)=>(c(),P(h(Ko),{point:n.point},{default:L((()=>[u.value?(c(),s("primitive",{key:0,object:u.value,onClick:t[0]||(t[0]=(...e)=>h(f)&&h(f)(...e)),onDoubleClick:t[1]||(t[1]=(...e)=>h(m)&&h(m)(...e)),onContextMenu:t[2]||(t[2]=(...e)=>h(g)&&h(g)(...e)),onPointerEnter:t[3]||(t[3]=(...e)=>h(v)&&h(v)(...e)),onPointerLeave:t[4]||(t[4]=(...e)=>h(y)&&h(y)(...e)),onPointerOver:t[5]||(t[5]=(...e)=>h(_)&&h(_)(...e)),onPointerDown:t[6]||(t[6]=(...e)=>h(x)&&h(x)(...e)),onPointerUp:t[7]||(t[7]=(...e)=>h(b)&&h(b)(...e)),onWheel:t[8]||(t[8]=(...e)=>h(w)&&h(w)(...e))},null,40,Os)):C("",!0)])),_:1},8,["point"]))}}),Us=e=>{if(0===e.length)return new ne;const t=new ne;return e.forEach((e=>t.add(e))),t.divideScalar(e.length),t},Bs=(e,t)=>e.map((e=>e.clone().sub(t))),zs=e=>e.map((e=>ys(e.lon,e.lat,e.height||0))),Ns=async e=>{const t=new De;return new Promise(((n,r)=>{t.load(e,n,void 0,r)}))},js=e=>{e.startTime=0,e.isAnimating=!0},Hs=e=>{e.isAnimating=!1},Gs=(e,t,n=!0,r)=>{const i=r=>i=>{if(!n)return;const s=void 0!==i.index?i.index:0;e(r,i,t,s)};return{handleClick:i("click"),handleDoubleClick:i("double-click"),handleContextMenu:i("context-menu"),handlePointerEnter:i("pointer-enter"),handlePointerLeave:i("pointer-leave"),handlePointerOver:i("pointer-over"),handlePointerDown:i("pointer-down"),handlePointerUp:i("pointer-up"),handleWheel:i("wheel")}},Vs=(e,t=1)=>{if(!e||!e.raycast)return;const n=e.raycast;e.raycast=function(r,i){const s=r.params.Points?.threshold||1;r.params.Points?r.params.Points.threshold=s*t:"Points"===e.type&&(r.params.Points={threshold:s*t});const o=n.call(this,r,i);return r.params.Points&&(r.params.Points.threshold=s),o}},Ws=["object"],Xs=e({__name:"GeoTubeline",props:{points:{},color:{},width:{},tubularSegments:{},texture:{},duration:{},renderOrder:{default:1},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","double-click","context-menu","pointer-enter","pointer-leave","pointer-over","pointer-down","pointer-up","wheel"],setup(e,{emit:t}){const n=e,u=t,d=i(),p=i(),f=r([]),m=r(new ne),g=i(),v=r({startTime:0,isAnimating:!1}),y=Gs(u,n,n.raycastActive),{onLoop:_}=Sr(),x=()=>.3*(n.width||2);_((({elapsed:e})=>{!v.value.isAnimating||!g.value||!n.duration||((e,t,n,r)=>{0===r.startTime&&(r.startTime=t);const i=(t-r.startTime)%n/n;e.offset.x=-i,e.needsUpdate=!0})(g.value,e,n.duration,v.value)}));const b=async()=>{if(p.value){p.value.geometry.dispose(),f.value=zs(n.points),m.value=Us(f.value);const e=Bs(f.value,m.value),t=new Fe;for(let n=0;n<e.length-1;n++){const r=new Ue(e[n],e[n+1]);t.add(r)}const r=new Be(t,n.tubularSegments||64,x(),8,!1);p.value.geometry=r,d.value.position.copy(m.value)}};return a((()=>n.points),(()=>{b()}),{immediate:!0}),a((()=>n.color),(e=>{p.value&&(p.value.material.color.set(e||"#ffffff"),p.value.material.needsUpdate=!0)})),a((()=>[n.width,n.tubularSegments]),(()=>{b()})),a((()=>n.texture),(async e=>{if(p.value)if(e)try{g.value&&g.value.dispose(),g.value=await Ns(e),g.value.wrapS=g.value.wrapT=1e3,p.value.material.map=g.value,p.value.material.needsUpdate=!0,n.duration&&js(v.value)}catch(t){console.warn("Failed to load texture:",t)}else g.value&&(g.value.dispose(),g.value=void 0),p.value.material.map=null,p.value.material.needsUpdate=!0,Hs(v.value)})),a((()=>n.duration),(e=>{e&&g.value?js(v.value):Hs(v.value)})),o((()=>{(async()=>{d.value=new Oe,f.value=zs(n.points),m.value=Us(f.value);const e=Bs(f.value,m.value),t=new Fe;for(let n=0;n<e.length-1;n++){const r=new Ue(e[n],e[n+1]);t.add(r)}const r=new Be(t,n.tubularSegments||64,x(),8,!1),i={color:n.color||"#ffffff",transparent:!0,side:se};if(n.texture)try{g.value=await Ns(n.texture),g.value.wrapS=g.value.wrapT=1e3,i.map=g.value}catch(o){console.warn("Failed to load texture:",o)}const s=new ie(i);p.value=new oe(r,s),p.value.renderOrder=n.renderOrder,n.raycastActive&&Vs(p.value,n.raycastMultiplier),d.value.add(p.value),d.value.position.copy(m.value),g.value&&n.duration&&js(v.value)})()})),l((()=>{Hs(v.value),g.value&&g.value.dispose(),p.value&&(p.value.geometry.dispose(),p.value.material.dispose()),d.value&&d.value.clear()})),(e,t)=>d.value?(c(),s("primitive",{key:0,object:d.value,onClick:t[0]||(t[0]=(...e)=>h(y).handleClick&&h(y).handleClick(...e)),onDoubleClick:t[1]||(t[1]=(...e)=>h(y).handleDoubleClick&&h(y).handleDoubleClick(...e)),onContextMenu:t[2]||(t[2]=(...e)=>h(y).handleContextMenu&&h(y).handleContextMenu(...e)),onPointerEnter:t[3]||(t[3]=(...e)=>h(y).handlePointerEnter&&h(y).handlePointerEnter(...e)),onPointerLeave:t[4]||(t[4]=(...e)=>h(y).handlePointerLeave&&h(y).handlePointerLeave(...e)),onPointerOver:t[5]||(t[5]=(...e)=>h(y).handlePointerOver&&h(y).handlePointerOver(...e)),onPointerDown:t[6]||(t[6]=(...e)=>h(y).handlePointerDown&&h(y).handlePointerDown(...e)),onPointerUp:t[7]||(t[7]=(...e)=>h(y).handlePointerUp&&h(y).handlePointerUp(...e)),onWheel:t[8]||(t[8]=(...e)=>h(y).handleWheel&&h(y).handleWheel(...e))},null,40,Ws)):C("",!0)}});class Ks extends Ae{constructor(){super(),this.isMeshLine=!0,this.type="MeshLine",this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this._points=[],this._geom=null,this.widthCallback=null,this.matrixWorld=new Ne,Object.defineProperties(this,{geometry:{enumerable:!0,get:function(){return this}},geom:{enumerable:!0,get:function(){return this._geom},set:function(e){this.setGeometry(e,this.widthCallback)}},points:{enumerable:!0,get:function(){return this._points},set:function(e){this.setPoints(e,this.widthCallback)}}})}}function qs(e,t,n,r,i){var s;if(e=e.subarray||e.slice?e:e.buffer,n=n.subarray||n.slice?n:n.buffer,e=t?e.subarray?e.subarray(t,i&&t+i):e.slice(t,i&&t+i):e,n.set)n.set(e,r);else for(s=0;s<e.length;s++)n[s+r]=e[s];return n}Ks.prototype.setMatrixWorld=function(e){this.matrixWorld=e},Ks.prototype.setGeometry=function(e,t){this._geometry=e,this.setPoints(e.getAttribute("position").array,t)},Ks.prototype.setPoints=function(e,t){if(e instanceof Float32Array||e instanceof Array){if(this._points=e,this.widthCallback=t,this.positions=[],this.counters=[],e.length&&e[0]instanceof ne)for(var n=0;n<e.length;n++){var r=e[n],i=n/e.length;this.positions.push(r.x,r.y,r.z),this.positions.push(r.x,r.y,r.z),this.counters.push(i),this.counters.push(i)}else for(n=0;n<e.length;n+=3){i=n/e.length;this.positions.push(e[n],e[n+1],e[n+2]),this.positions.push(e[n],e[n+1],e[n+2]),this.counters.push(i),this.counters.push(i)}this.process()}else console.error("ERROR: The BufferArray of points is not instancied correctly.")},Ks.prototype.raycast=function(e,t){var n=new Ne,r=new Ve,i=new qe,s=new ne,o=this.geometry;if(o.boundingSphere||o.computeBoundingSphere(),i.copy(o.boundingSphere),i.applyMatrix4(this.matrixWorld),!1!==e.ray.intersectSphere(i,s)){n.copy(this.matrixWorld).invert(),r.copy(e.ray).applyMatrix4(n);var a=new ne,l=new ne,c=new ne,u=this instanceof st?2:1,h=o.index,d=o.attributes;if(null!==h)for(var p=h.array,f=d.position.array,m=d.width.array,g=0,v=p.length-1;g<v;g+=u){var y=p[g],_=p[g+1];a.fromArray(f,3*y),l.fromArray(f,3*_);var x=void 0!==m[Math.floor(g/3)]?m[Math.floor(g/3)]:1,b=e.params.Line.threshold+this.material.lineWidth*x/2,w=b*b;if(!(r.distanceSqToSegment(a,l,s,c)>w)){s.applyMatrix4(this.matrixWorld);var T=e.ray.origin.distanceTo(s);T<e.near||T>e.far||(t.push({distance:T,point:c.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}),g=v)}}}},Ks.prototype.compareV3=function(e,t){var n=6*e,r=6*t;return this.positions[n]===this.positions[r]&&this.positions[n+1]===this.positions[r+1]&&this.positions[n+2]===this.positions[r+2]},Ks.prototype.copyV3=function(e){var t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]},Ks.prototype.process=function(){var e,t,n=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],t=this.compareV3(0,n-1)?this.copyV3(n-2):this.copyV3(0),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);for(var r=0;r<n;r++){if(this.side.push(1),this.side.push(-1),e=this.widthCallback?this.widthCallback(r/(n-1)):1,this.width.push(e),this.width.push(e),this.uvs.push(r/(n-1),0),this.uvs.push(r/(n-1),1),r<n-1){t=this.copyV3(r),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);var i=2*r;this.indices_array.push(i,i+1,i+2),this.indices_array.push(i+2,i+1,i+3)}r>0&&(t=this.copyV3(r),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]))}t=this.compareV3(n-1,0)?this.copyV3(1):this.copyV3(n-1),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]),this._attributes&&this._attributes.position.count===this.positions.length?(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0):this._attributes={position:new $(new Float32Array(this.positions),3),previous:new $(new Float32Array(this.previous),3),next:new $(new Float32Array(this.next),3),side:new $(new Float32Array(this.side),1),width:new $(new Float32Array(this.width),1),uv:new $(new Float32Array(this.uvs),2),index:new $(new Uint16Array(this.indices_array),1),counters:new $(new Float32Array(this.counters),1)},this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox(),this._geometry.attributes=this.attributes,this._geometry.index=this.index,this._geometry.computeBoundingSphere(),this._geometry.computeBoundingBox()},Ks.prototype.advance=function(e){var t=this._attributes.position.array,n=this._attributes.previous.array,r=this._attributes.next.array,i=t.length;qs(t,0,n,0,i),qs(t,6,t,0,i-6),t[i-6]=e.x,t[i-5]=e.y,t[i-4]=e.z,t[i-3]=e.x,t[i-2]=e.y,t[i-1]=e.z,qs(t,6,r,0,i-6),r[i-6]=e.x,r[i-5]=e.y,r[i-4]=e.z,r[i-3]=e.x,r[i-2]=e.y,r[i-1]=e.z,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0},We.meshline_vert=["",We.logdepthbuf_pars_vertex,We.fog_pars_vertex,"","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute float counters;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float near;","uniform float far;","uniform float sizeAttenuation;","uniform vec2 offset;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","\t vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","    float pixelWidthRatio = 1. / (resolution.x * projectionMatrix[0][0]);","","    vColor = vec4( color, opacity );","    vUV = uv + offset;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float pixelWidth = finalPosition.w * pixelWidthRatio;","    float w = 1.8 * pixelWidth * lineWidth * width;","","    if( sizeAttenuation == 1. ) {","        w = 1.8 * lineWidth * width;","    }","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec2 normal = vec2( -dir.y, dir.x );","    normal.x /= aspect;","    normal *= .5 * w;","","    vec4 offset = vec4( normal * side, 0.0, 1.0 );","    finalPosition.xy += offset.xy;","","    gl_Position = finalPosition;","",We.logdepthbuf_vertex,We.fog_vertex&&"    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",We.fog_vertex,"}"].join("\r\n"),We.meshline_frag=["",We.fog_pars_fragment,We.logdepthbuf_pars_fragment,"","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform float dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","void main() {","",We.logdepthbuf_fragment,"","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","    if( c.a < alphaTest ) discard;","    if( useDash == 1. ){","        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));","    }","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","",We.fog_fragment,"}"].join("\r\n");class Ys extends ge{constructor(e){super({uniforms:Object.assign({},Xe.fog,{lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new q(16777215)},opacity:{value:1},resolution:{value:new te(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new te(1,1)},offset:{value:new te(1,1)}}),vertexShader:We.meshline_vert,fragmentShader:We.meshline_frag}),this.isMeshLineMaterial=!0,this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(e){this.uniforms.lineWidth.value=e}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(e){this.uniforms.map.value=e}},useMap:{enumerable:!0,get:function(){return this.uniforms.useMap.value},set:function(e){this.uniforms.useMap.value=e}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(e){this.uniforms.alphaMap.value=e}},useAlphaMap:{enumerable:!0,get:function(){return this.uniforms.useAlphaMap.value},set:function(e){this.uniforms.useAlphaMap.value=e}},color:{enumerable:!0,get:function(){return this.uniforms.color.value},set:function(e){this.uniforms.color.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(e){this.uniforms.sizeAttenuation.value=e}},dashArray:{enumerable:!0,get:function(){return this.uniforms.dashArray.value},set:function(e){this.uniforms.dashArray.value=e,this.useDash=0!==e?1:0}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},dashRatio:{enumerable:!0,get:function(){return this.uniforms.dashRatio.value},set:function(e){this.uniforms.dashRatio.value=e}},useDash:{enumerable:!0,get:function(){return this.uniforms.useDash.value},set:function(e){this.uniforms.useDash.value=e}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(e){this.uniforms.visibility.value=e}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(e){this.uniforms.alphaTest.value=e}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(e){this.uniforms.repeat.value.copy(e)}},offset:{enumerable:!0,get:function(){return this.uniforms.offset.value},set:function(e){this.uniforms.offset.value.copy(e)}}}),this.setValues(e)}}Ys.prototype.copy=function(e){return ge.prototype.copy.call(this,e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.dashArray.copy(e.dashArray),this.dashOffset.copy(e.dashOffset),this.dashRatio.copy(e.dashRatio),this.useDash=e.useDash,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this};const Zs=["object"],$s=e({__name:"GeoMeshline",props:{points:{},color:{},width:{},dashArray:{},dashRatio:{},dashOffset:{},texture:{},duration:{},renderOrder:{default:1},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","double-click","context-menu","pointer-enter","pointer-leave","pointer-over","pointer-down","pointer-up","wheel"],setup(e,{emit:t}){const n=e,u=t,d=i(),p=i(),f=i(),m=r([]),g=r(new ne),v=i(),y=r({startTime:0,isAnimating:!1}),_=Gs(u,n,n.raycastActive),{onLoop:x}=Sr(),b=e=>{const t=new Ae,n=new Float32Array(3*e.length);return e.forEach(((e,t)=>{n[3*t]=e.x,n[3*t+1]=e.y,n[3*t+2]=e.z})),t.setAttribute("position",new $(n,3)),t};x((({elapsed:e})=>{if(!y.value.isAnimating||!f.value||!n.duration)return;((e,t,n,r)=>{0===r.startTime&&(r.startTime=t);const i=(t-r.startTime)%n/n;e.uniforms&&e.uniforms.offset&&(e.uniforms.offset.value.x=-i)})(f.value.material,e,n.duration,y.value)}));return a((()=>n.points),(()=>{n.points.length>=2&&(()=>{if(!p.value||!f.value||n.points.length<2)return;m.value=zs(n.points),g.value=Us(m.value);const e=Bs(m.value,g.value),t=b(e);p.value.setGeometry(t),d.value.position.copy(g.value)})()}),{deep:!0}),a((()=>[n.color,n.width]),(()=>{if(f.value){const e=f.value.material;e.uniforms&&(e.uniforms.color&&e.uniforms.color.value.set(n.color||"#ffffff"),e.uniforms.lineWidth&&(e.uniforms.lineWidth.value=n.width||1),e.uniforms.useDash&&(e.uniforms.useDash.value=0),e.uniforms.dashArray&&(e.uniforms.dashArray.value=0))}})),a((()=>n.texture),(async e=>{if(f.value){const r=f.value.material;if(e)try{v.value&&v.value.dispose(),v.value=await Ns(e),v.value.wrapS=1e3,v.value.wrapT=1e3,r.uniforms&&(r.uniforms.map.value=v.value,r.uniforms.useMap.value=1),n.duration&&js(y.value)}catch(t){console.warn("Failed to load texture:",t)}else v.value&&(v.value.dispose(),v.value=void 0),r.uniforms&&(r.uniforms.map.value=null,r.uniforms.useMap.value=0),Hs(y.value)}})),a((()=>n.duration),(e=>{e&&v.value?js(y.value):Hs(y.value)})),o((()=>{(async()=>{if(n.points.length<2)return;d.value=new Oe,m.value=zs(n.points),g.value=Us(m.value);const e=Bs(m.value,g.value),t=b(e);p.value=new Ks,p.value.setGeometry(t);const r={color:n.color||"#ffffff",lineWidth:n.width||1,dashArray:0,dashRatio:0,dashOffset:0,useDash:0,transparent:!0,depthTest:!0,depthWrite:!1};if(n.texture)try{v.value=await Ns(n.texture),v.value.wrapS=1e3,v.value.wrapT=1e3,r.map=v.value,r.useMap=1}catch(s){console.warn("Failed to load texture:",s)}const i=new Ys(r);f.value=new oe(p.value.geometry,i),f.value.renderOrder=n.renderOrder,n.raycastActive&&Vs(f.value,n.raycastMultiplier),d.value.add(f.value),d.value.position.copy(g.value),v.value&&n.duration&&js(y.value)})()})),l((()=>{if(Hs(y.value),v.value&&v.value.dispose(),f.value&&(f.value.geometry&&f.value.geometry.dispose(),f.value.material)){const e=f.value.material;e.dispose&&e.dispose()}d.value&&d.value.clear()})),(e,t)=>d.value?(c(),s("primitive",{key:0,object:d.value,onClick:t[0]||(t[0]=(...e)=>h(_).handleClick&&h(_).handleClick(...e)),onDoubleClick:t[1]||(t[1]=(...e)=>h(_).handleDoubleClick&&h(_).handleDoubleClick(...e)),onContextMenu:t[2]||(t[2]=(...e)=>h(_).handleContextMenu&&h(_).handleContextMenu(...e)),onPointerEnter:t[3]||(t[3]=(...e)=>h(_).handlePointerEnter&&h(_).handlePointerEnter(...e)),onPointerLeave:t[4]||(t[4]=(...e)=>h(_).handlePointerLeave&&h(_).handlePointerLeave(...e)),onPointerOver:t[5]||(t[5]=(...e)=>h(_).handlePointerOver&&h(_).handlePointerOver(...e)),onPointerDown:t[6]||(t[6]=(...e)=>h(_).handlePointerDown&&h(_).handlePointerDown(...e)),onPointerUp:t[7]||(t[7]=(...e)=>h(_).handlePointerUp&&h(_).handlePointerUp(...e)),onWheel:t[8]||(t[8]=(...e)=>h(_).handleWheel&&h(_).handleWheel(...e))},null,40,Zs)):C("",!0)}}),Qs=e({__name:"GeoFlyline",props:{start:{},end:{},type:{default:"mesh"},color:{default:"#ffffff"},width:{default:1},texture:{},duration:{default:2},arcHeight:{default:0},segments:{default:20},tubularSegments:{},renderOrder:{default:1},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","double-click","context-menu","pointer-enter","pointer-leave","pointer-over","pointer-down","pointer-up","wheel"],setup(e,{emit:t}){const n=e,i=t,s=r([]),l=()=>{const{start:e,end:t,arcHeight:r,segments:i}=n,o=[],a=((e,t)=>{const n=t.lon-e.lon,r=t.lat-e.lat;return Math.sqrt(n*n+r*r)})(e,t),l=r||.2*a,c=e.height||0,u=t.height||0;for(let n=0;n<=i;n++){const r=n/i,s=e.lon+(t.lon-e.lon)*r,a=e.lat+(t.lat-e.lat)*r,h=c+(u-c)*r,d=4*l*r*(1-r);o.push({lon:s,lat:a,height:h+d})}s.value=o};return a((()=>[n.start,n.end,n.arcHeight,n.segments]),(()=>{l()}),{deep:!0,immediate:!0}),o((()=>{l()})),(e,t)=>"tube"===n.type?(c(),P(Xs,{key:0,points:s.value,color:n.color,width:n.width,texture:n.texture,duration:n.duration,tubularSegments:n.tubularSegments,renderOrder:n.renderOrder,id:n.id,raycastActive:n.raycastActive,raycastMultiplier:n.raycastMultiplier,onClick:t[0]||(t[0]=(...e)=>i("click",...e)),onDoubleClick:t[1]||(t[1]=(...e)=>i("double-click",...e)),onContextMenu:t[2]||(t[2]=(...e)=>i("context-menu",...e)),onPointerEnter:t[3]||(t[3]=(...e)=>i("pointer-enter",...e)),onPointerLeave:t[4]||(t[4]=(...e)=>i("pointer-leave",...e)),onPointerOver:t[5]||(t[5]=(...e)=>i("pointer-over",...e)),onPointerDown:t[6]||(t[6]=(...e)=>i("pointer-down",...e)),onPointerUp:t[7]||(t[7]=(...e)=>i("pointer-up",...e)),onWheel:t[8]||(t[8]=(...e)=>i("wheel",...e))},null,8,["points","color","width","texture","duration","tubularSegments","renderOrder","id","raycastActive","raycastMultiplier"])):(c(),P($s,{key:1,points:s.value,color:n.color,width:n.width,texture:n.texture,duration:n.duration,renderOrder:n.renderOrder,id:n.id,raycastActive:n.raycastActive,raycastMultiplier:n.raycastMultiplier,onClick:t[9]||(t[9]=(...e)=>i("click",...e)),onDoubleClick:t[10]||(t[10]=(...e)=>i("double-click",...e)),onContextMenu:t[11]||(t[11]=(...e)=>i("context-menu",...e)),onPointerEnter:t[12]||(t[12]=(...e)=>i("pointer-enter",...e)),onPointerLeave:t[13]||(t[13]=(...e)=>i("pointer-leave",...e)),onPointerOver:t[14]||(t[14]=(...e)=>i("pointer-over",...e)),onPointerDown:t[15]||(t[15]=(...e)=>i("pointer-down",...e)),onPointerUp:t[16]||(t[16]=(...e)=>i("pointer-up",...e)),onWheel:t[17]||(t[17]=(...e)=>i("wheel",...e))},null,8,["points","color","width","texture","duration","renderOrder","id","raycastActive","raycastMultiplier"]))}}),Js=11102230246251565e-32,eo=134217729,to=(3+8*Js)*Js;function no(e,t,n,r,i){let s,o,a,l,c=t[0],u=r[0],h=0,d=0;u>c==u>-c?(s=c,c=t[++h]):(s=u,u=r[++d]);let p=0;if(h<e&&d<n)for(u>c==u>-c?(o=c+s,a=s-(o-c),c=t[++h]):(o=u+s,a=s-(o-u),u=r[++d]),s=o,0!==a&&(i[p++]=a);h<e&&d<n;)u>c==u>-c?(o=s+c,l=o-s,a=s-(o-l)+(c-l),c=t[++h]):(o=s+u,l=o-s,a=s-(o-l)+(u-l),u=r[++d]),s=o,0!==a&&(i[p++]=a);for(;h<e;)o=s+c,l=o-s,a=s-(o-l)+(c-l),c=t[++h],s=o,0!==a&&(i[p++]=a);for(;d<n;)o=s+u,l=o-s,a=s-(o-l)+(u-l),u=r[++d],s=o,0!==a&&(i[p++]=a);return(0!==s||0===p)&&(i[p++]=s),p}function ro(e){return new Float64Array(e)}const io=(3+16*Js)*Js,so=(2+12*Js)*Js,oo=(9+64*Js)*Js*Js,ao=ro(4),lo=ro(8),co=ro(12),uo=ro(16),ho=ro(4);function po(e,t,n,r,i,s){const o=(t-s)*(n-i),a=(e-i)*(r-s),l=o-a,c=Math.abs(o+a);return Math.abs(l)>=io*c?l:-function(e,t,n,r,i,s,o){let a,l,c,u,h,d,p,f,m,g,v,y,_,x,b,w,T,M;const A=e-i,S=n-i,E=t-s,P=r-s;x=A*P,d=eo*A,p=d-(d-A),f=A-p,d=eo*P,m=d-(d-P),g=P-m,b=f*g-(x-p*m-f*m-p*g),w=E*S,d=eo*E,p=d-(d-E),f=E-p,d=eo*S,m=d-(d-S),g=S-m,T=f*g-(w-p*m-f*m-p*g),v=b-T,h=b-v,ao[0]=b-(v+h)+(h-T),y=x+v,h=y-x,_=x-(y-h)+(v-h),v=_-w,h=_-v,ao[1]=_-(v+h)+(h-w),M=y+v,h=M-y,ao[2]=y-(M-h)+(v-h),ao[3]=M;let C=function(e,t){let n=t[0];for(let r=1;r<e;r++)n+=t[r];return n}(4,ao),R=so*o;if(C>=R||-C>=R||(h=e-A,a=e-(A+h)+(h-i),h=n-S,c=n-(S+h)+(h-i),h=t-E,l=t-(E+h)+(h-s),h=r-P,u=r-(P+h)+(h-s),0===a&&0===l&&0===c&&0===u)||(R=oo*o+to*Math.abs(C),C+=A*u+P*a-(E*c+S*l),C>=R||-C>=R))return C;x=a*P,d=eo*a,p=d-(d-a),f=a-p,d=eo*P,m=d-(d-P),g=P-m,b=f*g-(x-p*m-f*m-p*g),w=l*S,d=eo*l,p=d-(d-l),f=l-p,d=eo*S,m=d-(d-S),g=S-m,T=f*g-(w-p*m-f*m-p*g),v=b-T,h=b-v,ho[0]=b-(v+h)+(h-T),y=x+v,h=y-x,_=x-(y-h)+(v-h),v=_-w,h=_-v,ho[1]=_-(v+h)+(h-w),M=y+v,h=M-y,ho[2]=y-(M-h)+(v-h),ho[3]=M;const L=no(4,ao,4,ho,lo);x=A*u,d=eo*A,p=d-(d-A),f=A-p,d=eo*u,m=d-(d-u),g=u-m,b=f*g-(x-p*m-f*m-p*g),w=E*c,d=eo*E,p=d-(d-E),f=E-p,d=eo*c,m=d-(d-c),g=c-m,T=f*g-(w-p*m-f*m-p*g),v=b-T,h=b-v,ho[0]=b-(v+h)+(h-T),y=x+v,h=y-x,_=x-(y-h)+(v-h),v=_-w,h=_-v,ho[1]=_-(v+h)+(h-w),M=y+v,h=M-y,ho[2]=y-(M-h)+(v-h),ho[3]=M;const I=no(L,lo,4,ho,co);x=a*u,d=eo*a,p=d-(d-a),f=a-p,d=eo*u,m=d-(d-u),g=u-m,b=f*g-(x-p*m-f*m-p*g),w=l*c,d=eo*l,p=d-(d-l),f=l-p,d=eo*c,m=d-(d-c),g=c-m,T=f*g-(w-p*m-f*m-p*g),v=b-T,h=b-v,ho[0]=b-(v+h)+(h-T),y=x+v,h=y-x,_=x-(y-h)+(v-h),v=_-w,h=_-v,ho[1]=_-(v+h)+(h-w),M=y+v,h=M-y,ho[2]=y-(M-h)+(v-h),ho[3]=M;const D=no(I,co,4,ho,uo);return uo[D-1]}(e,t,n,r,i,s,c)}const fo=Math.pow(2,-52),mo=new Uint32Array(512);class go{static from(e,t=wo,n=To){const r=e.length,i=new Float64Array(2*r);for(let s=0;s<r;s++){const r=e[s];i[2*s]=t(r),i[2*s+1]=n(r)}return new go(i)}constructor(e){const t=e.length>>1;if(t>0&&"number"!=typeof e[0])throw new Error("Expected coords to contain numbers.");this.coords=e;const n=Math.max(2*t-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:n,_hullTri:r,_hullHash:i}=this,s=e.length>>1;let o=1/0,a=1/0,l=-1/0,c=-1/0;for(let M=0;M<s;M++){const t=e[2*M],n=e[2*M+1];t<o&&(o=t),n<a&&(a=n),t>l&&(l=t),n>c&&(c=n),this._ids[M]=M}const u=(o+l)/2,h=(a+c)/2;let d,p,f;for(let M=0,A=1/0;M<s;M++){const t=vo(u,h,e[2*M],e[2*M+1]);t<A&&(d=M,A=t)}const m=e[2*d],g=e[2*d+1];for(let M=0,A=1/0;M<s;M++){if(M===d)continue;const t=vo(m,g,e[2*M],e[2*M+1]);t<A&&t>0&&(p=M,A=t)}let v=e[2*p],y=e[2*p+1],_=1/0;for(let M=0;M<s;M++){if(M===d||M===p)continue;const t=_o(m,g,v,y,e[2*M],e[2*M+1]);t<_&&(f=M,_=t)}let x=e[2*f],b=e[2*f+1];if(_===1/0){for(let r=0;r<s;r++)this._dists[r]=e[2*r]-e[0]||e[2*r+1]-e[1];xo(this._ids,this._dists,0,s-1);const t=new Uint32Array(s);let n=0;for(let e=0,r=-1/0;e<s;e++){const i=this._ids[e],s=this._dists[i];s>r&&(t[n++]=i,r=s)}return this.hull=t.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(po(m,g,v,y,x,b)<0){const e=p,t=v,n=y;p=f,v=x,y=b,f=e,x=t,b=n}const w=function(e,t,n,r,i,s){const o=n-e,a=r-t,l=i-e,c=s-t,u=o*o+a*a,h=l*l+c*c,d=.5/(o*c-a*l),p=e+(c*u-a*h)*d,f=t+(o*h-l*u)*d;return{x:p,y:f}}(m,g,v,y,x,b);this._cx=w.x,this._cy=w.y;for(let M=0;M<s;M++)this._dists[M]=vo(e[2*M],e[2*M+1],w.x,w.y);xo(this._ids,this._dists,0,s-1),this._hullStart=d;let T=3;n[d]=t[f]=p,n[p]=t[d]=f,n[f]=t[p]=d,r[d]=0,r[p]=1,r[f]=2,i.fill(-1),i[this._hashKey(m,g)]=d,i[this._hashKey(v,y)]=p,i[this._hashKey(x,b)]=f,this.trianglesLen=0,this._addTriangle(d,p,f,-1,-1,-1);for(let M,A,S=0;S<this._ids.length;S++){const s=this._ids[S],o=e[2*s],a=e[2*s+1];if(S>0&&Math.abs(o-M)<=fo&&Math.abs(a-A)<=fo||(M=o,A=a,s===d||s===p||s===f))continue;let l=0;for(let e=0,t=this._hashKey(o,a);e<this._hashSize&&(l=i[(t+e)%this._hashSize],-1===l||l===n[l]);e++);l=t[l];let c,u=l;for(;c=n[u],po(o,a,e[2*u],e[2*u+1],e[2*c],e[2*c+1])>=0;)if(u=c,u===l){u=-1;break}if(-1===u)continue;let h=this._addTriangle(u,s,n[u],-1,-1,r[u]);r[s]=this._legalize(h+2),r[u]=h,T++;let m=n[u];for(;c=n[m],po(o,a,e[2*m],e[2*m+1],e[2*c],e[2*c+1])<0;)h=this._addTriangle(m,s,c,r[s],-1,r[m]),r[s]=this._legalize(h+2),n[m]=m,T--,m=c;if(u===l)for(;c=t[u],po(o,a,e[2*c],e[2*c+1],e[2*u],e[2*u+1])<0;)h=this._addTriangle(c,s,u,-1,r[u],r[c]),this._legalize(h+2),r[c]=h,n[u]=u,T--,u=c;this._hullStart=t[s]=u,n[u]=t[m]=s,n[s]=m,i[this._hashKey(o,a)]=s,i[this._hashKey(e[2*u],e[2*u+1])]=u}this.hull=new Uint32Array(T);for(let M=0,A=this._hullStart;M<T;M++)this.hull[M]=A,A=n[A];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(function(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:n,coords:r}=this;let i=0,s=0;for(;;){const o=n[e],a=e-e%3;if(s=a+(e+2)%3,-1===o){if(0===i)break;e=mo[--i];continue}const l=o-o%3,c=a+(e+1)%3,u=l+(o+2)%3,h=t[s],d=t[e],p=t[c],f=t[u];if(yo(r[2*h],r[2*h+1],r[2*d],r[2*d+1],r[2*p],r[2*p+1],r[2*f],r[2*f+1])){t[e]=f,t[o]=h;const r=n[u];if(-1===r){let t=this._hullStart;do{if(this._hullTri[t]===u){this._hullTri[t]=e;break}t=this._hullPrev[t]}while(t!==this._hullStart)}this._link(e,r),this._link(o,n[s]),this._link(s,u);const a=l+(o+1)%3;i<mo.length&&(mo[i++]=a)}else{if(0===i)break;e=mo[--i]}}return s}_link(e,t){this._halfedges[e]=t,-1!==t&&(this._halfedges[t]=e)}_addTriangle(e,t,n,r,i,s){const o=this.trianglesLen;return this._triangles[o]=e,this._triangles[o+1]=t,this._triangles[o+2]=n,this._link(o,r),this._link(o+1,i),this._link(o+2,s),this.trianglesLen+=3,o}}function vo(e,t,n,r){const i=e-n,s=t-r;return i*i+s*s}function yo(e,t,n,r,i,s,o,a){const l=e-o,c=t-a,u=n-o,h=r-a,d=i-o,p=s-a,f=u*u+h*h,m=d*d+p*p;return l*(h*m-f*p)-c*(u*m-f*d)+(l*l+c*c)*(u*p-h*d)<0}function _o(e,t,n,r,i,s){const o=n-e,a=r-t,l=i-e,c=s-t,u=o*o+a*a,h=l*l+c*c,d=.5/(o*c-a*l),p=(c*u-a*h)*d,f=(o*h-l*u)*d;return p*p+f*f}function xo(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const r=e[i],s=t[r];let o=i-1;for(;o>=n&&t[e[o]]>s;)e[o+1]=e[o--];e[o+1]=r}else{let i=n+1,s=r;bo(e,n+r>>1,i),t[e[n]]>t[e[r]]&&bo(e,n,r),t[e[i]]>t[e[r]]&&bo(e,i,r),t[e[n]]>t[e[i]]&&bo(e,n,i);const o=e[i],a=t[o];for(;;){do{i++}while(t[e[i]]<a);do{s--}while(t[e[s]]>a);if(s<i)break;bo(e,i,s)}e[n+1]=e[s],e[s]=o,r-i+1>=s-n?(xo(e,t,i,r),xo(e,t,n,s-1)):(xo(e,t,n,s-1),xo(e,t,i,r))}}function bo(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function wo(e){return e[0]}function To(e){return e[1]}const Mo=(e,t)=>{let n=!1;const r=e[0],i=e[1];let s=t.length-1;for(let o=0;o<t.length;o++){const e=t[o][0],a=t[o][1],l=t[s][0],c=t[s][1];a>i!=c>i&&r<(l-e)*(i-a)/(c-a)+e&&(n=!n),s=o}return n},Ao=(e,t)=>{for(const n of t)if(Mo(e,n))return!0;return!1},So=e=>{let t=0;for(let n=0,r=e.length;n<r;n++){const i=(n+1)%r;t+=e[n][0]*e[i][1],t-=e[i][0]*e[n][1]}return t<0},Eo=e=>{let t=e[0];for(let n=1;n<=e.length;n++){const r=n%e.length,i=e[r],s=i[0]-t[0],o=i[1]-t[1],a=s*s+o*o,l=Math.max(Math.abs(i[0]),Math.abs(i[1]),Math.abs(t[0]),Math.abs(t[1]));a<=1.0000000000000001e-20*l*l?(e.splice(r,1),n--):t=i}},Po=(e,t)=>{if(t<=1)return[...e];const n=[];let r=0;for(let s=0;s<e.length;s++){const t=e[s],n=e[(s+1)%e.length],i=n[0]-t[0],o=n[1]-t[1];r+=Math.sqrt(i*i+o*o)}const i=r/(50*t);for(let s=0;s<e.length;s++){const t=e[s],r=e[(s+1)%e.length];n.push(t);const o=r[0]-t[0],a=r[1]-t[1],l=Math.sqrt(o*o+a*a),c=Math.max(1,Math.ceil(l/i));for(let e=1;e<c;e++){const r=e/c,i=[t[0]+r*o,t[1]+r*a];n.push(i)}}return n},Co=(e,t,n=1e-10)=>{const[r,i]=e;for(let s=0;s<t.length;s++){const e=(s+1)%t.length,[o,a]=t[s],[l,c]=t[e],u=(i-a)*(l-o)-(r-o)*(c-a);if(Math.abs(u)<n){const e=(r-o)*(l-o)+(i-a)*(c-a);if(e>=0&&e<=(l-o)*(l-o)+(c-a)*(c-a))return!0}}return!1},Ro=(e,t,n,r)=>{const i=e[0],s=e[1],o=t[0],a=t[1],l=n[0],c=n[1],u=r[0],h=r[1],d=(i-o)*(c-h)-(s-a)*(l-u);if(Math.abs(d)<1e-10)return!1;const p=((i-l)*(c-h)-(s-c)*(l-u))/d,f=-((i-o)*(s-c)-(s-a)*(i-l))/d;return p>=0&&p<=1&&f>=0&&f<=1},Lo=(e,t,n)=>{for(let r=0;r<n.length;r++){const i=(r+1)%n.length,s=n[r],o=n[i],a=Math.abs(e[0]-s[0])<1e-10&&Math.abs(e[1]-s[1])<1e-10,l=Math.abs(e[0]-o[0])<1e-10&&Math.abs(e[1]-o[1])<1e-10,c=Math.abs(t[0]-s[0])<1e-10&&Math.abs(t[1]-s[1])<1e-10,u=Math.abs(t[0]-o[0])<1e-10&&Math.abs(t[1]-o[1])<1e-10;if(!(a||l||c||u)&&Ro(e,t,s,o))return!0}return!1},Io=(e,t,n,r,i)=>{const s=[(e[0]+t[0]+n[0])/3,(e[1]+t[1]+n[1])/3];if(!Mo(s,r)||Ao(s,i))return!1;const o=[[e,t],[t,n],[n,e]];for(const l of i)for(const e of o)if(Lo(e[0],e[1],l))return!1;const a=[e,t,n];for(const l of a)if(!Mo(l,r)||Ao(l,i)){let e=!1;for(const t of i)if(Co(l,t)){e=!0;break}if(!e&&!Co(l,r))return!1}return!i.some((e=>a.every((t=>Mo(t,e)))))},Do=(e,t,n)=>{const r=[...e];for(const o of t)r.push(...o);r.push(...n);const i=go.from(r).triangles,s=[];for(let o=0;o<i.length;o+=3){const n=r[i[o]],a=r[i[o+1]],l=r[i[o+2]];Io(n,a,l,e,t)&&s.push(n,a,l)}return s},ko=(e,t,n)=>{const r=[];if(n<=1)return r;const i=e.map((e=>e[0])),s=e.map((e=>e[1])),o=Math.min.apply(null,i),a=Math.max.apply(null,i),l=Math.min.apply(null,s),c=Math.max.apply(null,s),u=(a-o)/(10*n),h=(c-l)/(10*n);for(let d=o+u;d<a;d+=u)for(let n=l+h;n<c;n+=h){const i=[d,n];Mo(i,e)&&!Ao(i,t)&&r.push(i)}return r},Oo=["position"],Fo=["object"],Uo=e({__name:"GeoPolygon",props:{geometry:{},subdivisions:{default:2},height:{default:30},renderOrder:{default:1},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","double-click","context-menu","pointer-enter","pointer-leave","pointer-over","pointer-down","pointer-up","wheel"],setup(e,{emit:t}){const n=e,u=t,d=i(),p=r(new ne),f=Gs(u,n,n.raycastActive),m=e=>e.map((([e,t,r=n.height])=>({lon:e,lat:t,height:r}))),g=e=>{let t;if("Polygon"===e.type)t=[e.coordinates];else{if("MultiPolygon"!==e.type)throw new Error("不支持的几何类型，仅支持Polygon和MultiPolygon");t=e.coordinates}const n=[],r=[];return t.forEach((e=>{if(0===e.length)return;const t=m(e[0]);n.push(t);const i=[];for(let n=1;n<e.length;n++){const t=m(e[n]);i.push(t)}r.push(i)})),{contours:n,holes:r}},v=e=>{const{contours:t,holes:r}=g(n.geometry);if(0===t.length)throw new Error("没有有效的多边形轮廓");const i=[],s=[];t.forEach(((t,o)=>{if(t.length<3)return void console.warn(`多边形${o}的顶点数少于3，跳过`);const a=r[o]||[];let l=t.map((e=>[e.lon,e.lat])),c=a.map((e=>e.map((e=>[e.lon,e.lat]))));!So(l)&&l.reverse();for(let e=0;e<c.length;e++){const t=c[e];So(t)&&(c[e]=t.reverse())}Eo(l),c.forEach((e=>Eo(e)));const u=Math.max(1,n.subdivisions);l=Po(l,u),c=c.map((e=>Po(e,u)));const h=ko(l,c,u),d=Do(l,c,h),p=n.height??0,f=d.map((e=>e[0])),m=d.map((e=>e[1])),g=Math.min.apply(null,f),v=Math.max.apply(null,f),y=Math.min.apply(null,m),_=Math.max.apply(null,m),x=v-g,b=_-y;d.forEach((([t,n])=>{const r=ys(t,n,p);i.push(r.x-e.x,r.y-e.y,r.z-e.z);const o=x>0?(t-g)/x:0,a=b>0?1-(n-y)/b:0;s.push(o,a)}))}));const o=new Ae;return o.setAttribute("position",new Ie(i,3)),o.setAttribute("uv",new Ie(s,2)),o.computeVertexNormals(),o},y=()=>{if(d.value)try{const{contours:e}=g(n.geometry);if(0===e.length||e[0].length<3)return;const t=d.value.geometry,r=_(n.geometry);p.value=r;const i=v(r);d.value.geometry=i,t.dispose()}catch(e){console.error("更新几何体失败:",e)}};a((()=>n.geometry),(()=>{y()}),{deep:!0}),a((()=>n.subdivisions),(()=>{y()})),a((()=>n.height),(()=>{y()}));const _=e=>{const{contours:t}=g(e);if(0===t.length)return new ne;let r=0,i=0,s=0;if(t.forEach((e=>{e.forEach((e=>{r+=e.lon,i+=e.lat,s++}))})),0===s)return new ne;const o=r/s,a=i/s,l=n.height??0;return new ne(...ys(o,a,l))};return o((()=>{(()=>{try{const{contours:e}=g(n.geometry);if(0===e.length||e[0].length<3)return void console.warn("多边形至少需要3个点");const t=_(n.geometry);p.value=t;const r=v(t);d.value=new oe(r),d.value.renderOrder=n.renderOrder,n.raycastActive&&Vs(d.value,n.raycastMultiplier)}catch(e){console.error("创建多边形失败:",e)}})()})),l((()=>{d.value&&d.value.geometry?.dispose?.()})),(e,t)=>d.value?(c(),s("TresGroup",{key:0,position:p.value},[R("primitive",{object:d.value,onClick:t[0]||(t[0]=(...e)=>h(f).handleClick&&h(f).handleClick(...e)),onDoubleClick:t[1]||(t[1]=(...e)=>h(f).handleDoubleClick&&h(f).handleDoubleClick(...e)),onContextMenu:t[2]||(t[2]=(...e)=>h(f).handleContextMenu&&h(f).handleContextMenu(...e)),onPointerEnter:t[3]||(t[3]=(...e)=>h(f).handlePointerEnter&&h(f).handlePointerEnter(...e)),onPointerLeave:t[4]||(t[4]=(...e)=>h(f).handlePointerLeave&&h(f).handlePointerLeave(...e)),onPointerOver:t[5]||(t[5]=(...e)=>h(f).handlePointerOver&&h(f).handlePointerOver(...e)),onPointerDown:t[6]||(t[6]=(...e)=>h(f).handlePointerDown&&h(f).handlePointerDown(...e)),onPointerUp:t[7]||(t[7]=(...e)=>h(f).handlePointerUp&&h(f).handlePointerUp(...e)),onWheel:t[8]||(t[8]=(...e)=>h(f).handleWheel&&h(f).handleWheel(...e))},[T(e.$slots,"default")],40,Fo)],8,Oo)):C("",!0)}}),Bo=["position"],zo=["object"],No=e({__name:"GeoWall",props:{geometry:{},height:{default:100},baseHeight:{default:0},renderOrder:{default:1},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","double-click","context-menu","pointer-enter","pointer-leave","pointer-over","pointer-down","pointer-up","wheel"],setup(e,{emit:t}){const n=e,u=t,d=i(),p=r(new ne),f=Gs(u,n,n.raycastActive),m=e=>e.map((([e,t,n=0])=>({lon:e,lat:t,height:n}))),g=e=>{const t=[];switch(e.type){case"LineString":t.push(m(e.coordinates));break;case"MultiLineString":case"Polygon":e.coordinates.forEach((e=>{t.push(m(e))}));break;case"MultiPolygon":e.coordinates.forEach((e=>{e.forEach((e=>{t.push(m(e))}))}));break;default:throw new Error(`不支持的几何类型: ${e.type}`)}return t},v=(e,t)=>{if(0===e.length)throw new Error("没有有效的线段数据");const r=[],i=[],s=[];let o=0;e.forEach((e=>{if(e.length<2)return void console.warn("线段至少需要2个点，跳过");const a=[...e],l=[],c=[];a.forEach((e=>{const r=ys(e.lon,e.lat,n.baseHeight);l.push(new ne(r.x-t.x,r.y-t.y,r.z-t.z));const i=ys(e.lon,e.lat,n.baseHeight+n.height);c.push(new ne(i.x-t.x,i.y-t.y,i.z-t.z))}));const u=[0];let h=0;for(let t=1;t<l.length;t++){const e=l[t-1].distanceTo(l[t]);h+=e,u.push(h)}l.forEach(((e,t)=>{r.push(e.x,e.y,e.z);const n=h>0?u[t]/h:0;s.push(n,0)})),c.forEach(((e,t)=>{r.push(e.x,e.y,e.z);const n=h>0?u[t]/h:0;s.push(n,1)}));const d=l.length;for(let t=0;t<d-1;t++){const e=o+t,n=o+t+1,r=o+t+d,s=o+t+1+d;i.push(e,n,r),i.push(n,s,r)}o+=2*d}));const a=new Ae;return a.setAttribute("position",new Ie(r,3)),a.setAttribute("uv",new Ie(s,2)),a.setIndex(i),a.computeVertexNormals(),a},y=()=>{if(d.value)try{const e=g(n.geometry);if(0===e.length)return void console.warn("没有有效的线段数据");const t=d.value.geometry,r=_(n.geometry);p.value=r;const i=v(e,r);d.value.geometry=i,t.dispose()}catch(e){console.error("更新几何体失败:",e)}};a((()=>n.geometry),(()=>{y()}),{deep:!0}),a((()=>n.height),(()=>{y()})),a((()=>n.baseHeight),(()=>{y()}));const _=e=>{const t=g(e);if(0===t.length)return new ne;let r=0,i=0,s=0;if(t.forEach((e=>{e.forEach((e=>{r+=e.lon,i+=e.lat,s++}))})),0===s)return new ne;const o=r/s,a=i/s,l=n.baseHeight+n.height/2;return new ne(...ys(o,a,l))};return o((()=>{(()=>{try{const e=g(n.geometry);if(0===e.length)return void console.warn("没有有效的线段数据");const t=_(n.geometry);p.value=t;const r=v(e,t);d.value=new oe(r),d.value.renderOrder=n.renderOrder,n.raycastActive&&Vs(d.value,n.raycastMultiplier)}catch(e){console.error("创建墙体失败:",e)}})()})),l((()=>{d.value&&d.value.geometry.dispose()})),(e,t)=>d.value?(c(),s("TresGroup",{key:0,position:p.value},[R("primitive",{object:d.value,onClick:t[0]||(t[0]=(...e)=>h(f).handleClick&&h(f).handleClick(...e)),onDoubleClick:t[1]||(t[1]=(...e)=>h(f).handleDoubleClick&&h(f).handleDoubleClick(...e)),onContextMenu:t[2]||(t[2]=(...e)=>h(f).handleContextMenu&&h(f).handleContextMenu(...e)),onPointerEnter:t[3]||(t[3]=(...e)=>h(f).handlePointerEnter&&h(f).handlePointerEnter(...e)),onPointerLeave:t[4]||(t[4]=(...e)=>h(f).handlePointerLeave&&h(f).handlePointerLeave(...e)),onPointerOver:t[5]||(t[5]=(...e)=>h(f).handlePointerOver&&h(f).handlePointerOver(...e)),onPointerDown:t[6]||(t[6]=(...e)=>h(f).handlePointerDown&&h(f).handlePointerDown(...e)),onPointerUp:t[7]||(t[7]=(...e)=>h(f).handlePointerUp&&h(f).handlePointerUp(...e)),onWheel:t[8]||(t[8]=(...e)=>h(f).handleWheel&&h(f).handleWheel(...e))},[T(e.$slots,"default")],40,zo)],8,Bo)):C("",!0)}}),jo=["position"],Ho=["object"],Go=["object"],Vo=["object"],Wo=e({__name:"GeoBuilding",props:{geometry:{},subdivisions:{default:2},height:{default:100},baseHeight:{default:0},showTop:{type:Boolean,default:!0},showBottom:{type:Boolean,default:!1},showWalls:{type:Boolean,default:!0},renderOrder:{default:1},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","double-click","context-menu","pointer-enter","pointer-leave","pointer-over","pointer-down","pointer-up","wheel"],setup(e,{emit:t}){const n=e,u=t,d=i(),p=i(),f=i(),m=r(new ne),g=Gs(u,n,n.raycastActive),v=e=>e.map((([e,t,r=n.baseHeight])=>({lon:e,lat:t,height:r}))),y=e=>{let t;if("Polygon"===e.type)t=[e.coordinates];else{if("MultiPolygon"!==e.type)throw new Error("GeoBuilding 只支持 Polygon 和 MultiPolygon 类型");t=e.coordinates}const n=[],r=[];return t.forEach((e=>{if(0===e.length)return;const t=v(e[0]);n.push(t);const i=[];for(let n=1;n<e.length;n++){const t=v(e[n]);i.push(t)}r.push(i)})),{contours:n,holes:r}},_=(e,t)=>{const{contours:r,holes:i}=y(n.geometry);if(0===r.length)throw new Error("没有有效的多边形轮廓");const s=[],o=[];r.forEach(((r,a)=>{if(r.length<3)return void console.warn(`多边形${a}的顶点数少于3，跳过`);const l=i[a]||[];let c=r.map((e=>[e.lon,e.lat])),u=l.map((e=>e.map((e=>[e.lon,e.lat]))));!So(c)&&c.reverse();for(let e=0;e<u.length;e++){const t=u[e];So(t)&&(u[e]=t.reverse())}Eo(c),u.forEach((e=>Eo(e)));const h=Math.min(Math.max(1,n.subdivisions),5);c=Po(c,h),u=u.map((e=>Po(e,h)));const d=ko(c,u,h),p=Do(c,u,d);p.length>1e4&&console.warn(`多边形${a}顶点数过多(${p.length})，建议减少subdivisions`);const f=p.map((e=>e[0])),m=p.map((e=>e[1])),g=Math.min.apply(null,f),v=Math.max.apply(null,f),y=Math.min.apply(null,m),_=Math.max.apply(null,m),x=v-g,b=_-y;p.forEach((([r,i])=>{const a=ys(r,i,n.baseHeight+e);s.push(a.x-t.x,a.y-t.y,a.z-t.z);const l=x>0?(r-g)/x:0,c=b>0?1-(i-y)/b:0;o.push(l,c)}))}));const a=new Ae;return a.setAttribute("position",new Ie(s,3)),a.setAttribute("uv",new Ie(o,2)),a.computeVertexNormals(),a},x=()=>{try{const{contours:e}=y(n.geometry);if(0===e.length||e[0].length<3)return void console.warn("多边形至少需要3个点");const t=w(n.geometry);if(m.value=t,n.showBottom){const e=_(0,t);p.value=new oe(e),p.value.renderOrder=n.renderOrder,n.raycastActive&&Vs(p.value,n.raycastMultiplier)}if(n.showTop){const e=_(n.height,t);d.value=new oe(e),d.value.renderOrder=n.renderOrder,n.raycastActive&&Vs(d.value,n.raycastMultiplier)}if(n.showWalls){const e=(e=>{const{contours:t,holes:r}=y(n.geometry);if(0===t.length)throw new Error("没有有效的多边形轮廓");const i=[],s=[],o=[];let a=0;t.forEach(((t,l)=>{const c=r[l]||[],u=t=>{if(t.length<3)return;const r=[],l=[];t.forEach((t=>{const i=ys(t.lon,t.lat,n.baseHeight);r.push(new ne(i.x-e.x,i.y-e.y,i.z-e.z));const s=ys(t.lon,t.lat,n.baseHeight+n.height);l.push(new ne(s.x-e.x,s.y-e.y,s.z-e.z))}));const c=[0];let u=0;for(let e=1;e<r.length;e++){const t=r[e-1].distanceTo(r[e]);u+=t,c.push(u)}r.forEach(((e,t)=>{i.push(e.x,e.y,e.z);const n=u>0?c[t]/u:0;o.push(n,0)})),l.forEach(((e,t)=>{i.push(e.x,e.y,e.z);const n=u>0?c[t]/u:0;o.push(n,1)}));const h=r.length;for(let e=0;e<h-1;e++){const t=a+e,n=a+e+1,r=a+e+h,i=a+e+1+h;s.push(t,n,r),s.push(n,i,r)}a+=2*h};u(t),c.forEach((e=>{u(e)}))}));const l=new Ae;return l.setAttribute("position",new Ie(i,3)),l.setAttribute("uv",new Ie(o,2)),l.setIndex(s),l.computeVertexNormals(),l})(t);f.value=new oe(e),f.value.renderOrder=n.renderOrder,n.raycastActive&&Vs(f.value,n.raycastMultiplier)}}catch(e){console.error("创建建筑失败:",e)}},b=()=>{d.value&&d.value.geometry.dispose(),p.value&&p.value.geometry.dispose(),f.value&&f.value.geometry.dispose(),x()};a((()=>n.geometry),(()=>{b()}),{deep:!0}),a((()=>[n.subdivisions,n.height,n.baseHeight,n.showTop,n.showBottom,n.showWalls]),(()=>{b()}));const w=e=>{const{contours:t}=y(e);if(0===t.length)return new ne;let r=0,i=0,s=0;if(t.forEach((e=>{e.forEach((e=>{r+=e.lon,i+=e.lat,s++}))})),0===s)return new ne;const o=r/s,a=i/s,l=n.baseHeight+n.height/2;return new ne(...ys(o,a,l))};return o((()=>{x()})),l((()=>{d.value&&d.value.geometry.dispose(),p.value&&p.value.geometry.dispose(),f.value&&f.value.geometry.dispose()})),(e,t)=>p.value||d.value||f.value?(c(),s("TresGroup",{key:0,position:m.value,onClick:t[0]||(t[0]=(...e)=>h(g).handleClick&&h(g).handleClick(...e)),onDoubleClick:t[1]||(t[1]=(...e)=>h(g).handleDoubleClick&&h(g).handleDoubleClick(...e)),onContextMenu:t[2]||(t[2]=(...e)=>h(g).handleContextMenu&&h(g).handleContextMenu(...e)),onPointerEnter:t[3]||(t[3]=(...e)=>h(g).handlePointerEnter&&h(g).handlePointerEnter(...e)),onPointerLeave:t[4]||(t[4]=(...e)=>h(g).handlePointerLeave&&h(g).handlePointerLeave(...e)),onPointerOver:t[5]||(t[5]=(...e)=>h(g).handlePointerOver&&h(g).handlePointerOver(...e)),onPointerDown:t[6]||(t[6]=(...e)=>h(g).handlePointerDown&&h(g).handlePointerDown(...e)),onPointerUp:t[7]||(t[7]=(...e)=>h(g).handlePointerUp&&h(g).handlePointerUp(...e)),onWheel:t[8]||(t[8]=(...e)=>h(g).handleWheel&&h(g).handleWheel(...e))},[e.showBottom?(c(),s("primitive",{key:0,object:p.value},[T(e.$slots,"bottom")],8,Ho)):C("",!0),e.showTop?(c(),s("primitive",{key:1,object:d.value},[T(e.$slots,"top")],8,Go)):C("",!0),e.showWalls?(c(),s("primitive",{key:2,object:f.value},[T(e.$slots,"walls")],8,Vo)):C("",!0)],40,jo)):C("",!0)}}),Xo=["position","rotation"],Ko=e({__name:"GeoPosition",props:{point:{}},setup(e){const t=e,n=i(new ne),r=i(new ze),l=()=>{const e=ys(t.point.lon,t.point.lat,t.point.height||0);n.value=e;const i=e.clone().normalize(),s=new ne(0,0,1),o=s.clone().sub(i.clone().multiplyScalar(s.dot(i))).normalize(),a=o.clone().cross(i).normalize();o.copy(i.clone().cross(a)).normalize();const l=new Ne;l.makeBasis(a,i.clone().negate(),o);const c=new Z;c.matrix.copy(l),c.matrix.decompose(c.position,c.quaternion,c.scale),r.value.setFromQuaternion(c.quaternion),r.value=r.value.clone()};return a([()=>t.point.lon,()=>t.point.lat,()=>t.point.height],(()=>{l()})),o((()=>{l()})),(e,t)=>(c(),s("TresGroup",{position:n.value,rotation:r.value},[T(e.$slots,"default")],8,Xo))}}),qo=e({__name:"GeoTextureProps",props:{texture:{},center:{},rotation:{},scale:{},repeat:{},offset:{},wrapS:{},wrapT:{},magFilter:{},minFilter:{},flipY:{type:Boolean},format:{},type:{},colorSpace:{},generateMipmaps:{type:Boolean},premultiplyAlpha:{type:Boolean},unpackAlignment:{},anisotropy:{},encoding:{},matrixAutoUpdate:{type:Boolean},userData:{},name:{}},setup(e){const t=e;function n(e,t,n){void 0!==t&&e!==t&&n(t)}function r(e,t){t&&!function(e,t){return e.x===t[0]&&e.y===t[1]}(e,t)&&(e.x=t[0],e.y=t[1])}return a((()=>t.texture),(e=>{e&&t.texture&&(t.center&&(t.texture.center.x=t.center[0],t.texture.center.y=t.center[1]),void 0!==t.rotation&&(t.texture.rotation=t.rotation),t.scale&&(t.texture.repeat.x=t.scale[0],t.texture.repeat.y=t.scale[1]),t.repeat&&(t.texture.repeat.x=t.repeat[0],t.texture.repeat.y=t.repeat[1]),t.offset&&(t.texture.offset.x=t.offset[0],t.texture.offset.y=t.offset[1]),void 0!==t.wrapS&&(t.texture.wrapS=t.wrapS),void 0!==t.wrapT&&(t.texture.wrapT=t.wrapT),void 0!==t.magFilter&&(t.texture.magFilter=t.magFilter),void 0!==t.minFilter&&(t.texture.minFilter=t.minFilter),void 0!==t.flipY&&(t.texture.flipY=t.flipY),void 0!==t.format&&(t.texture.format=t.format),void 0!==t.type&&(t.texture.type=t.type),void 0!==t.colorSpace&&(t.texture.colorSpace=t.colorSpace),void 0!==t.generateMipmaps&&(t.texture.generateMipmaps=t.generateMipmaps),void 0!==t.premultiplyAlpha&&(t.texture.premultiplyAlpha=t.premultiplyAlpha),void 0!==t.unpackAlignment&&(t.texture.unpackAlignment=t.unpackAlignment),void 0!==t.anisotropy&&(t.texture.anisotropy=t.anisotropy),void 0!==t.encoding&&(t.texture.encoding=t.encoding),void 0!==t.userData&&(t.texture.userData=t.userData),void 0!==t.name&&(t.texture.name=t.name))}),{immediate:!0}),a((()=>t.center),(e=>{t.texture&&e&&r(t.texture.center,e)}),{deep:!0}),a((()=>t.rotation),(e=>{t.texture&&n(t.texture.rotation,e,(e=>{t.texture.rotation=e}))})),a((()=>t.scale),(e=>{t.texture&&e&&r(t.texture.repeat,e)}),{deep:!0}),a((()=>t.repeat),(e=>{t.texture&&e&&r(t.texture.repeat,e)}),{deep:!0}),a((()=>t.offset),(e=>{t.texture&&e&&r(t.texture.offset,e)}),{deep:!0}),a((()=>t.wrapS),(e=>{t.texture&&n(t.texture.wrapS,e,(e=>{t.texture.wrapS=e}))})),a((()=>t.wrapT),(e=>{t.texture&&n(t.texture.wrapT,e,(e=>{t.texture.wrapT=e}))})),a((()=>t.magFilter),(e=>{t.texture&&n(t.texture.magFilter,e,(e=>{t.texture.magFilter=e}))})),a((()=>t.minFilter),(e=>{t.texture&&n(t.texture.minFilter,e,(e=>{t.texture.minFilter=e}))})),a((()=>t.flipY),(e=>{t.texture&&n(t.texture.flipY,e,(e=>{t.texture.flipY=e}))})),a((()=>t.format),(e=>{t.texture&&n(t.texture.format,e,(e=>{t.texture.format=e}))})),a((()=>t.type),(e=>{t.texture&&n(t.texture.type,e,(e=>{t.texture.type=e}))})),a((()=>t.colorSpace),(e=>{t.texture&&n(t.texture.colorSpace,e,(e=>{t.texture.colorSpace=e}))})),a((()=>t.generateMipmaps),(e=>{t.texture&&n(t.texture.generateMipmaps,e,(e=>{t.texture.generateMipmaps=e}))})),a((()=>t.premultiplyAlpha),(e=>{t.texture&&n(t.texture.premultiplyAlpha,e,(e=>{t.texture.premultiplyAlpha=e}))})),a((()=>t.unpackAlignment),(e=>{t.texture&&n(t.texture.unpackAlignment,e,(e=>{t.texture.unpackAlignment=e}))})),a((()=>t.anisotropy),(e=>{t.texture&&n(t.texture.anisotropy,e,(e=>{t.texture.anisotropy=e}))})),a((()=>t.encoding),(e=>{t.texture&&n(t.texture.encoding,e,(e=>{t.texture.encoding=e}))})),a((()=>t.matrixAutoUpdate),(e=>{t.texture&&n(t.texture.matrixAutoUpdate,e,(e=>{t.texture.matrixAutoUpdate=e}))})),a((()=>t.userData),(e=>{t.texture&&n(t.texture.userData,e,(e=>{t.texture.userData=e}))}),{deep:!0}),a((()=>t.name),(e=>{t.texture&&n(t.texture.name,e,(e=>{t.texture.name=e}))})),(e,t)=>null}});function Yo(e){if(!e)return null;const t=e.replace(/[a-z]+:\/\/[^/]+/i,"").replace(/\?.*$/i,"").replace(/.*\//g,""),n=t.lastIndexOf(".");return-1===n?null:t.substring(n+1)||null}const Zo=2**30;class $o{get unloadPriorityCallback(){return this._unloadPriorityCallback}set unloadPriorityCallback(e){1===e.length?(console.warn('LRUCache: "unloadPriorityCallback" function has been changed to take two arguments.'),this._unloadPriorityCallback=(t,n)=>{const r=e(t),i=e(n);return r<i?-1:r>i?1:0}):this._unloadPriorityCallback=e}constructor(){this.minSize=6e3,this.maxSize=8e3,this.minBytesSize=.3*Zo,this.maxBytesSize=.4*Zo,this.unloadPercent=.05,this.autoMarkUnused=!0,this.itemSet=new Map,this.itemList=[],this.usedSet=new Set,this.callbacks=new Map,this.unloadingHandle=-1,this.cachedBytes=0,this.bytesMap=new Map,this.loadedSet=new Set,this._unloadPriorityCallback=null,this.computeMemoryUsageCallback=()=>null;const e=this.itemSet;this.defaultPriorityCallback=t=>e.get(t)}isFull(){return this.itemSet.size>=this.maxSize||this.cachedBytes>=this.maxBytesSize}getMemoryUsage(e){return this.bytesMap.get(e)??null}add(e,t){const n=this.itemSet;if(n.has(e)||this.isFull())return!1;const r=this.usedSet,i=this.itemList,s=this.callbacks,o=this.bytesMap;i.push(e),r.add(e),n.set(e,Date.now()),s.set(e,t);const a=this.computeMemoryUsageCallback(e);return this.cachedBytes+=a||0,o.set(e,a),!0}has(e){return this.itemSet.has(e)}remove(e){const t=this.usedSet,n=this.itemSet,r=this.itemList,i=this.bytesMap,s=this.callbacks,o=this.loadedSet;if(n.has(e)){this.cachedBytes-=i.get(e)||0,i.delete(e),s.get(e)(e);const a=r.indexOf(e);return r.splice(a,1),t.delete(e),n.delete(e),s.delete(e),o.delete(e),!0}return!1}setLoaded(e,t){const{itemSet:n,loadedSet:r}=this;n.has(e)&&(!0===t?r.add(e):r.delete(e))}updateMemoryUsage(e){const t=this.itemSet,n=this.bytesMap;if(!t.has(e))return;this.cachedBytes-=n.get(e)||0;const r=this.computeMemoryUsageCallback(e);n.set(e,r),this.cachedBytes+=r}markUsed(e){const t=this.itemSet,n=this.usedSet;t.has(e)&&!n.has(e)&&(t.set(e,Date.now()),n.add(e))}markUnused(e){this.usedSet.delete(e)}markAllUnused(){this.usedSet.clear()}unloadUnusedContent(){const{unloadPercent:e,minSize:t,maxSize:n,itemList:r,itemSet:i,usedSet:s,loadedSet:o,callbacks:a,bytesMap:l,minBytesSize:c,maxBytesSize:u}=this,h=r.length-s.size,d=r.length-o.size,p=Math.max(Math.min(r.length-t,h),0),f=this.cachedBytes-c,m=this.unloadPriorityCallback||this.defaultPriorityCallback;let g=!1;const v=p>0&&h>0||d&&r.length>n;if(h&&this.cachedBytes>c||d&&this.cachedBytes>u||v){r.sort(((e,t)=>{const n=s.has(e);if(n===s.has(t)){const n=o.has(e);return n===o.has(t)?-m(e,t):n?1:-1}return n?1:-1}));const d=Math.max(t*e,p*e),v=Math.ceil(Math.min(d,h,p)),y=Math.max(e*f,e*c),_=Math.min(y,f);let x=0,b=0;for(;this.cachedBytes-b>u||r.length-x>n;){const e=r[x],t=l.get(e)||0;if(s.has(e)&&o.has(e)||this.cachedBytes-b-t<u&&r.length-x<=n)break;b+=t,x++}for(;b<_||x<v;){const e=r[x],t=l.get(e)||0;if(s.has(e)||this.cachedBytes-b-t<c&&x>=v)break;b+=t,x++}r.splice(0,x).forEach((e=>{this.cachedBytes-=l.get(e)||0,a.get(e)(e),l.delete(e),i.delete(e),a.delete(e),o.delete(e),s.delete(e)})),g=x<p||b<f&&x<h,g=g&&x>0}g&&(this.unloadingHandle=requestAnimationFrame((()=>this.scheduleUnload())))}scheduleUnload(){cancelAnimationFrame(this.unloadingHandle),this.scheduled||(this.scheduled=!0,queueMicrotask((()=>{this.scheduled=!1,this.unloadUnusedContent()})))}}class Qo{get running(){return 0!==this.items.length||0!==this.currJobs}constructor(){this.maxJobs=6,this.items=[],this.callbacks=new Map,this.currJobs=0,this.scheduled=!1,this.autoUpdate=!0,this.priorityCallback=()=>{throw new Error("PriorityQueue: PriorityCallback function not defined.")},this.schedulingCallback=e=>{requestAnimationFrame(e)},this._runjobs=()=>{this.scheduled=!1,this.tryRunJobs()}}sort(){const e=this.priorityCallback;this.items.sort(e)}has(e){return this.callbacks.has(e)}add(e,t){const n={callback:t,reject:null,resolve:null,promise:null};return n.promise=new Promise(((t,r)=>{const i=this.items,s=this.callbacks;n.resolve=t,n.reject=r,i.push(e),s.set(e,n),this.autoUpdate&&this.scheduleJobRun()})),n.promise}remove(e){const t=this.items,n=this.callbacks,r=t.indexOf(e);if(-1!==r){const i=n.get(e);i.promise.catch((()=>{})),i.reject(new Error("PriorityQueue: Item removed.")),t.splice(r,1),n.delete(e)}}removeByFilter(e){const{items:t}=this;for(let n=0;n<t.length;n++){const r=t[n];e(r)&&this.remove(r)}}tryRunJobs(){this.sort();const e=this.items,t=this.callbacks,n=this.maxJobs;let r=0;const i=()=>{this.currJobs--,this.autoUpdate&&this.scheduleJobRun()};for(;n>this.currJobs&&e.length>0&&r<n;){this.currJobs++,r++;const n=e.pop(),{callback:s,resolve:o,reject:a}=t.get(n);let l;t.delete(n);try{l=s(n)}catch(Ui){a(Ui),i()}l instanceof Promise?l.then(o).catch(a).finally(i):(o(l),i())}}scheduleJobRun(){this.scheduled||(this.schedulingCallback(this._runjobs),this.scheduled=!0)}}const Jo=-1,ea=6378137,ta={inView:!1,error:1/0,distanceFromCamera:1/0};function na(e){return 3===e||e===Jo}function ra(e,t){return e.__lastFrameVisited===t&&e.__used}function ia(e){return e.__childrenProcessed===e.children.length}function sa(e,t){e.__lastFrameVisited!==t.frameCount&&(e.__lastFrameVisited=t.frameCount,e.__used=!1,e.__inFrustum=!1,e.__isLeaf=!1,e.__visible=!1,e.__active=!1,e.__error=1/0,e.__distanceFromCamera=1/0,e.__childrenWereVisible=!1,e.__allChildrenLoaded=!1,t.calculateTileViewError(e,ta),e.__inFrustum=ta.inView,e.__error=ta.error,e.__distanceFromCamera=ta.distanceFromCamera)}function oa(e,t){if(t.ensureChildrenArePreprocessed(e),sa(e,t),la(e,t),!e.__hasRenderableContent&&ia(e)){const n=e.children;for(let e=0,r=n.length;e<r;e++)oa(n[e],t)}}function aa(e,t){if(t.ensureChildrenArePreprocessed(e),ra(e,t.frameCount)&&(e.__hasContent&&0===e.__loadingState&&!t.lruCache.isFull()&&t.queueTileForDownload(e),ia(e))){const n=e.children;for(let e=0,r=n.length;e<r;e++)aa(n[e],t)}}function la(e,t){e.__used||(e.__used=!0,t.markTileUsed(e),t.stats.used++,!0===e.__inFrustum&&t.stats.inFrustum++)}function ca(e,t=null,n=null){const r=[];for(r.push(e),r.push(null),r.push(0);r.length>0;){const e=r.pop(),i=r.pop(),s=r.pop();if(t&&t(s,i,e))return void(n&&n(s,i,e));const o=s.children;if(o)for(let t=o.length-1;t>=0;t--)r.push(o[t]),r.push(s),r.push(e+1);n&&n(s,i,e)}}function ua(e,t){if(t.ensureChildrenArePreprocessed(e),sa(e,t),!e.__inFrustum)return;if(!function(e,t){return!(e.__error<=t.errorTarget||t.maxDepth>0&&e.__depth+1>=t.maxDepth||!ia(e))}(e,t))return void la(e,t);let n=!1,r=!1;const i=e.children;for(let s=0,o=i.length;s<o;s++){const e=i[s];ua(e,t),n=n||ra(e,t.frameCount),r=r||e.__inFrustum}if(la(e,t),n&&"REPLACE"===e.refine)for(let s=0,o=i.length;s<o;s++){oa(i[s],t)}}function ha(e,t){const n=t.frameCount;if(!ra(e,n))return;const r=e.children;let i=!1;for(let s=0,o=r.length;s<o;s++){const e=r[s];i=i||ra(e,n)}if(i){let i=!1,s=!0;for(let e=0,o=r.length;e<o;e++){const o=r[e];if(ha(o,t),i=i||o.__wasSetVisible||o.__childrenWereVisible,ra(o,n)){const e=o.__allChildrenLoaded||o.__hasRenderableContent&&na(o.__loadingState)||!o.__hasContent&&0===o.children.length||o.__hasUnrenderableContent&&o.__loadingState===Jo;s=s&&e}}e.__childrenWereVisible=i,e.__allChildrenLoaded=s}else e.__isLeaf=!0}function da(e,t){const n=t.stats;if(!ra(e,t.frameCount))return;const r=t.lruCache;if(e.__isLeaf)return void(3===e.__loadingState?(e.__inFrustum&&(e.__visible=!0,n.visible++),e.__active=!0,n.active++):!r.isFull()&&e.__hasContent&&t.queueTileForDownload(e));const i=e.children,s=e.__hasContent,o=na(e.__loadingState)&&s,a=(t.errorTarget+1)*t.errorThreshold,l=e.__error<=a,c=e.__childrenWereVisible,u=e.__allChildrenLoaded;if((l||"ADD"===e.refine)&&!o&&!r.isFull()&&s&&t.queueTileForDownload(e),(l&&!u&&!c&&o||"ADD"===e.refine&&o)&&(e.__inFrustum&&(e.__visible=!0,n.visible++),e.__active=!0,n.active++),"REPLACE"===e.refine&&l&&!u)for(let h=0,d=i.length;h<d;h++){const e=i[h];ra(e,t.frameCount)&&aa(e,t)}else for(let h=0,d=i.length;h<d;h++)da(i[h],t)}function pa(e,t){const n=ra(e,t.frameCount);if(n||e.__usedLastFrame){let r=!1,i=!1;n?(r=e.__active,i=t.displayActiveTiles&&e.__active||e.__visible):sa(e,t),e.__hasRenderableContent&&3===e.__loadingState&&(e.__wasSetActive!==r&&t.invokeOnePlugin((t=>t.setTileActive&&t.setTileActive(e,r))),e.__wasSetVisible!==i&&t.invokeOnePlugin((t=>t.setTileVisible&&t.setTileVisible(e,i)))),e.__wasSetActive=r,e.__wasSetVisible=i,e.__usedLastFrame=n;const s=e.children;for(let e=0,n=s.length;e<n;e++){pa(s[e],t)}}}const fa=Symbol("PLUGIN_REGISTERED"),ma=(e,t)=>e.__depthFromRenderedParent!==t.__depthFromRenderedParent?e.__depthFromRenderedParent>t.__depthFromRenderedParent?-1:1:e.__inFrustum!==t.__inFrustum?e.__inFrustum?1:-1:e.__used!==t.__used?e.__used?1:-1:e.__error!==t.__error?e.__error>t.__error?1:-1:e.__distanceFromCamera!==t.__distanceFromCamera?e.__distanceFromCamera>t.__distanceFromCamera?-1:1:0,ga=(e,t)=>e.__depthFromRenderedParent!==t.__depthFromRenderedParent?e.__depthFromRenderedParent>t.__depthFromRenderedParent?1:-1:e.__loadingState!==t.__loadingState?e.__loadingState>t.__loadingState?-1:1:e.__lastFrameVisited!==t.__lastFrameVisited?e.__lastFrameVisited>t.__lastFrameVisited?-1:1:e.__hasUnrenderableContent!==t.__hasUnrenderableContent?e.__hasUnrenderableContent?-1:1:e.__error!==t.__error?e.__error>t.__error?-1:1:0;class va{get root(){const e=this.rootTileSet;return e?e.root:null}get loadProgress(){const{stats:e,isLoading:t}=this,n=e.downloading+e.parsing,r=e.inCacheSinceLoad+(t?1:0);return 0===r?1:1-n/r}get errorThreshold(){return this._errorThreshold}set errorThreshold(e){console.warn('TilesRenderer: The "errorThreshold" option has been deprecated.'),this._errorThreshold=e}constructor(e=null){this.rootLoadingState=0,this.rootTileSet=null,this.rootURL=e,this.fetchOptions={},this.plugins=[],this.queuedTiles=[],this.cachedSinceLoadComplete=new Set,this.isLoading=!1;const t=new $o;t.unloadPriorityCallback=ga;const n=new Qo;n.maxJobs=10,n.priorityCallback=ma;const r=new Qo;r.maxJobs=1,r.priorityCallback=ma;const i=new Qo;i.maxJobs=25,i.priorityCallback=ma,i.log=!0,this.visibleTiles=new Set,this.activeTiles=new Set,this.usedSet=new Set,this.lruCache=t,this.downloadQueue=n,this.parseQueue=r,this.processNodeQueue=i,this.stats={inCacheSinceLoad:0,inCache:0,parsing:0,downloading:0,failed:0,inFrustum:0,used:0,active:0,visible:0},this.frameCount=0,this._dispatchNeedsUpdateEvent=function(e){let t=null;return()=>{null===t&&(t=requestAnimationFrame((()=>{t=null,e()})))}}((()=>{this.dispatchEvent({type:"needs-update"})})),this.errorTarget=16,this._errorThreshold=1/0,this.displayActiveTiles=!1,this.maxDepth=1/0}registerPlugin(e){if(!0===e[fa])throw new Error("TilesRendererBase: A plugin can only be registered to a single tile set");const t=this.plugins,n=e.priority||0;let r=t.length;for(let i=0;i<t.length;i++)if((t[i].priority||0)>n){r=i;break}t.splice(r,0,e),e[fa]=!0,e.init&&e.init(this)}unregisterPlugin(e){const t=this.plugins;if("string"==typeof e&&(e=this.getPluginByName(name)),t.includes(e)){const n=t.indexOf(e);return t.splice(n,1),e.dispose&&e.dispose(),!0}return!1}getPluginByName(e){return this.plugins.find((t=>t.name===e))||null}traverse(e,t,n=!0){this.root&&ca(this.root,((t,...r)=>(n&&this.ensureChildrenArePreprocessed(t,!0),!!e&&e(t,...r))),t)}queueTileForDownload(e){0===e.__loadingState&&this.queuedTiles.push(e)}markTileUsed(e){this.usedSet.add(e),this.lruCache.markUsed(e)}update(){const{lruCache:e,usedSet:t,stats:n,root:r,downloadQueue:i,parseQueue:s,processNodeQueue:o}=this;if(0===this.rootLoadingState&&(this.rootLoadingState=1,this.invokeOnePlugin((e=>e.loadRootTileSet&&e.loadRootTileSet())).then((e=>{let t=this.rootURL;null!==t&&this.invokeAllPlugins((e=>t=e.preprocessURL?e.preprocessURL(t,null):t)),this.rootLoadingState=3,this.rootTileSet=e,this.dispatchEvent({type:"needs-update"}),this.dispatchEvent({type:"load-content"}),this.dispatchEvent({type:"load-tile-set",tileSet:e,url:t})})).catch((e=>{this.rootLoadingState=Jo,console.error(e),this.rootTileSet=null,this.dispatchEvent({type:"load-error",tile:null,error:e,url:this.rootURL})}))),!r)return;n.inFrustum=0,n.used=0,n.active=0,n.visible=0,this.frameCount++,t.forEach((t=>e.markUnused(t))),t.clear(),ua(r,this),ha(r,this),da(r,this),pa(r,this);const a=this.queuedTiles;a.sort(e.unloadPriorityCallback);for(let l=0,c=a.length;l<c&&!e.isFull();l++)this.requestTileContents(a[l]);a.length=0,e.scheduleUnload(),!1===(i.running||s.running||o.running)&&!0===this.isLoading&&(this.cachedSinceLoadComplete.clear(),n.inCacheSinceLoad=0,this.dispatchEvent({type:"tiles-load-end"}),this.isLoading=!1)}resetFailedTiles(){this.rootLoadingState===Jo&&(this.rootLoadingState=0);const e=this.stats;0!==e.failed&&(this.traverse((e=>{e.__loadingState===Jo&&(e.__loadingState=0)}),null,!1),e.failed=0)}dispose(){[...this.plugins].forEach((e=>{this.unregisterPlugin(e)}));const e=this.lruCache,t=[];this.traverse((e=>(t.push(e),!1)),null,!1);for(let n=0,r=t.length;n<r;n++)e.remove(t[n]);this.stats={parsing:0,downloading:0,failed:0,inFrustum:0,used:0,active:0,visible:0},this.frameCount=0}dispatchEvent(e){}fetchData(e,t){return fetch(e,t)}parseTile(e,t,n){return null}disposeTile(e){e.__visible&&(this.invokeOnePlugin((t=>t.setTileVisible&&t.setTileVisible(e,!1))),e.__visible=!1),e.__active&&(this.invokeOnePlugin((t=>t.setTileActive&&t.setTileActive(e,!1))),e.__active=!1)}preprocessNode(e,t,n=null){if(e.content&&(!("uri"in e.content)&&"url"in e.content&&(e.content.uri=e.content.url,delete e.content.url),e.content.boundingVolume&&!("box"in e.content.boundingVolume||"sphere"in e.content.boundingVolume||"region"in e.content.boundingVolume)&&delete e.content.boundingVolume),e.parent=n,e.children=e.children||[],e.content?.uri){const t=Yo(e.content.uri);e.__hasContent=!0,e.__hasUnrenderableContent=!(!t||!/json$/.test(t)),e.__hasRenderableContent=!e.__hasUnrenderableContent}else e.__hasContent=!1,e.__hasUnrenderableContent=!1,e.__hasRenderableContent=!1;e.__childrenProcessed=0,n&&n.__childrenProcessed++,e.__distanceFromCamera=1/0,e.__error=1/0,e.__inFrustum=!1,e.__isLeaf=!1,e.__usedLastFrame=!1,e.__used=!1,e.__wasSetVisible=!1,e.__visible=!1,e.__childrenWereVisible=!1,e.__allChildrenLoaded=!1,e.__wasSetActive=!1,e.__active=!1,e.__loadingState=0,null===n?(e.__depth=0,e.__depthFromRenderedParent=e.__hasRenderableContent?1:0,e.refine=e.refine||"REPLACE"):(e.__depth=n.__depth+1,e.__depthFromRenderedParent=n.__depthFromRenderedParent+(e.__hasRenderableContent?1:0),e.refine=e.refine||n.refine),e.__basePath=t,e.__lastFrameVisited=-1,this.invokeAllPlugins((r=>{r!==this&&r.preprocessNode&&r.preprocessNode(e,t,n)}))}setTileActive(e,t){t?this.activeTiles.add(e):this.activeTiles.delete(e)}setTileVisible(e,t){t?this.visibleTiles.add(e):this.visibleTiles.delete(e)}calculateTileViewError(e,t){}ensureChildrenArePreprocessed(e,t=!1){const n=e.children;for(let r=0,i=n.length;r<i;r++){const i=n[r];if("__depth"in i)break;t?(this.processNodeQueue.remove(i),this.preprocessNode(i,e.__basePath,e)):this.processNodeQueue.has(i)||this.processNodeQueue.add(i,(t=>{this.preprocessNode(t,e.__basePath,e),this._dispatchNeedsUpdateEvent()}))}}preprocessTileSet(e,t,n=null){const r=e.asset.version,[i,s]=r.split(".").map((e=>parseInt(e)));console.assert(i<=1,"TilesRenderer: asset.version is expected to be a 1.x or a compatible version."),1===i&&s>0&&console.warn("TilesRenderer: tiles versions at 1.1 or higher have limited support. Some new extensions and features may not be supported.");let o=t.replace(/\/[^/]*$/,"");o=new URL(o,window.location.href).toString(),this.preprocessNode(e.root,o,n)}loadRootTileSet(){let e=this.rootURL;return this.invokeAllPlugins((t=>e=t.preprocessURL?t.preprocessURL(e,null):e)),this.invokeOnePlugin((t=>t.fetchData&&t.fetchData(e,this.fetchOptions))).then((t=>{if(t instanceof Response){if(t.ok)return t.json();throw new Error(`TilesRenderer: Failed to load tileset "${e}" with status ${t.status} : ${t.statusText}`)}return t})).then((t=>(this.preprocessTileSet(t,e),t)))}requestTileContents(e){if(0!==e.__loadingState)return;let t=!1,n=null,r=new URL(e.content.uri,e.__basePath+"/").toString();this.invokeAllPlugins((t=>r=t.preprocessURL?t.preprocessURL(r,e):r));const i=this.stats,s=this.lruCache,o=this.downloadQueue,a=this.parseQueue,l=Yo(r),c=new AbortController,u=c.signal;return s.add(e,(n=>{c.abort(),t?(n.children.length=0,n.__childrenProcessed=0):this.invokeAllPlugins((e=>{e.disposeTile&&e.disposeTile(n)})),i.inCache--,this.cachedSinceLoadComplete.has(e)&&(this.cachedSinceLoadComplete.delete(e),i.inCacheSinceLoad--),1===n.__loadingState?i.downloading--:2===n.__loadingState&&i.parsing--,n.__loadingState=0,a.remove(n),o.remove(n)}))?(this.isLoading||(this.isLoading=!0,this.dispatchEvent({type:"tiles-load-start"})),this.cachedSinceLoadComplete.add(e),i.inCacheSinceLoad++,i.inCache++,i.downloading++,e.__loadingState=1,o.add(e,(t=>{if(u.aborted)return Promise.resolve();const n=this.invokeOnePlugin((e=>e.fetchData&&e.fetchData(r,{...this.fetchOptions,signal:u})));return this.dispatchEvent({type:"tile-download-start",tile:e}),n})).then((e=>{if(!u.aborted){if(e instanceof Response){if(e.ok)return"json"===l?e.json():e.arrayBuffer();throw new Error(`Failed to load model with error code ${e.status}`)}return e}})).then((s=>{if(!u.aborted)return i.downloading--,i.parsing++,e.__loadingState=2,a.add(e,(i=>u.aborted?Promise.resolve():"json"===l&&s.root?(this.preprocessTileSet(s,r,e),e.children.push(s.root),n=s,t=!0,Promise.resolve()):this.invokeOnePlugin((e=>e.parseTile&&e.parseTile(s,i,l,r,u)))))})).then((()=>{u.aborted||(i.parsing--,e.__loadingState=3,s.setLoaded(e,!0),null===s.getMemoryUsage(e)&&(s.isFull()&&s.computeMemoryUsageCallback(e)>0?s.remove(e):s.updateMemoryUsage(e)),this.dispatchEvent({type:"needs-update"}),this.dispatchEvent({type:"load-content"}),t&&this.dispatchEvent({type:"load-tile-set",tileSet:n,url:r}),e.cached.scene&&this.dispatchEvent({type:"load-model",scene:e.cached.scene,tile:e}))})).catch((t=>{u.aborted||("AbortError"!==t.name?(a.remove(e),o.remove(e),2===e.__loadingState?i.parsing--:1===e.__loadingState&&i.downloading--,i.failed++,console.error(`TilesRenderer : Failed to load tile at url "${e.content.uri}".`),console.error(t),e.__loadingState=Jo,s.setLoaded(e,!0),this.dispatchEvent({type:"load-error",tile:e,error:t,url:r})):s.remove(e))}))):void 0}getAttributions(e=[]){return this.invokeAllPlugins((t=>t!==this&&t.getAttributions&&t.getAttributions(e))),e}invokeOnePlugin(e){const t=[...this.plugins,this];for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}invokeAllPlugins(e){const t=[...this.plugins,this],n=[];for(let r=0;r<t.length;r++){const i=e(t[r]);i&&n.push(i)}return 0===n.length?null:Promise.all(n)}}const ya=new TextDecoder;function _a(e){return ya.decode(e)}function xa(e,t,n,r,i,s){let o,a;switch(r){case"SCALAR":o=1;break;case"VEC2":o=2;break;case"VEC3":o=3;break;case"VEC4":o=4;break;default:throw new Error(`FeatureTable : Feature type not provided for "${s}".`)}const l=n*o;switch(i){case"BYTE":a=new Int8Array(e,t,l);break;case"UNSIGNED_BYTE":a=new Uint8Array(e,t,l);break;case"SHORT":a=new Int16Array(e,t,l);break;case"UNSIGNED_SHORT":a=new Uint16Array(e,t,l);break;case"INT":a=new Int32Array(e,t,l);break;case"UNSIGNED_INT":a=new Uint32Array(e,t,l);break;case"FLOAT":a=new Float32Array(e,t,l);break;case"DOUBLE":a=new Float64Array(e,t,l);break;default:throw new Error(`FeatureTable : Feature component type not provided for "${s}".`)}return a}class ba{constructor(e,t,n,r){this.buffer=e,this.binOffset=t+n,this.binLength=r;let i=null;if(0!==n){const r=new Uint8Array(e,t,n);i=JSON.parse(_a(r))}else i={};this.header=i}getKeys(){return Object.keys(this.header)}getData(e,t,n=null,r=null){const i=this.header;if(!(e in i))return null;const s=i[e];if(s instanceof Object){if(Array.isArray(s))return s;{const{buffer:i,binOffset:o,binLength:a}=this,l=s.byteOffset||0,c=s.type||r,u=s.componentType||n;if("type"in s&&r&&s.type!==r)throw new Error("FeatureTable: Specified type does not match expected type.");const h=o+l,d=xa(i,h,t,c,u,e);if(h+d.byteLength>o+a)throw new Error("FeatureTable: Feature data read outside binary body length.");return d}}return s}getBuffer(e,t){const{buffer:n,binOffset:r}=this;return n.slice(r+e,r+e+t)}}class wa{constructor(e){this.batchTable=e;const t=e.header.extensions["3DTILES_batch_table_hierarchy"];this.classes=t.classes;for(const r of this.classes){const e=r.instances;for(const t in e)r.instances[t]=this._parseProperty(e[t],r.length,t)}if(this.instancesLength=t.instancesLength,this.classIds=this._parseProperty(t.classIds,this.instancesLength,"classIds"),t.parentCounts?this.parentCounts=this._parseProperty(t.parentCounts,this.instancesLength,"parentCounts"):this.parentCounts=new Array(this.instancesLength).fill(1),t.parentIds){const e=this.parentCounts.reduce(((e,t)=>e+t),0);this.parentIds=this._parseProperty(t.parentIds,e,"parentIds")}else this.parentIds=null;this.instancesIds=[];const n={};for(const r of this.classIds)n[r]=n[r]??0,this.instancesIds.push(n[r]),n[r]++}_parseProperty(e,t,n){if(Array.isArray(e))return e;{const{buffer:r,binOffset:i}=this.batchTable;return xa(r,i+e.byteOffset,t,"SCALAR",e.componentType||"UNSIGNED_SHORT",n)}}getDataFromId(e,t={}){const n=this.parentCounts[e];if(this.parentIds&&n>0){let r=0;for(let t=0;t<e;t++)r+=this.parentCounts[t];for(let i=0;i<n;i++){const n=this.parentIds[r+i];n!==e&&this.getDataFromId(n,t)}}const r=this.classIds[e],i=this.classes[r].instances,s=this.classes[r].name,o=this.instancesIds[e];for(const a in i)t[s]=t[s]||{},t[s][a]=i[a][o];return t}}class Ta extends ba{get batchSize(){return console.warn("BatchTable.batchSize has been deprecated and replaced with BatchTable.count."),this.count}constructor(e,t,n,r,i){super(e,n,r,i),this.count=t,this.extensions={};const s=this.header.extensions;s&&s["3DTILES_batch_table_hierarchy"]&&(this.extensions["3DTILES_batch_table_hierarchy"]=new wa(this))}getData(e,t=null,n=null){return console.warn("BatchTable: BatchTable.getData is deprecated. Use BatchTable.getDataFromId to get allproperties for an id or BatchTable.getPropertyArray for getting an array of value for a property."),super.getData(e,this.count,t,n)}getDataFromId(e,t={}){if(e<0||e>=this.count)throw new Error(`BatchTable: id value "${e}" out of bounds for "${this.count}" features number.`);for(const n of this.getKeys())"extensions"!==n&&(t[n]=super.getData(n,this.count)[e]);for(const n in this.extensions){const r=this.extensions[n];r.getDataFromId instanceof Function&&(t[n]=t[n]||{},r.getDataFromId(e,t[n]))}return t}getPropertyArray(e){return super.getData(e,this.count)}}class Ma{constructor(){this.fetchOptions={},this.workingPath=""}load(...e){return console.warn('Loader: "load" function has been deprecated in favor of "loadAsync".'),this.loadAsync(...e)}loadAsync(e){return fetch(e,this.fetchOptions).then((t=>{if(!t.ok)throw new Error(`Failed to load file "${e}" with status ${t.status} : ${t.statusText}`);return t.arrayBuffer()})).then((t=>(""===this.workingPath&&(this.workingPath=this.workingPathForURL(e)),this.parse(t))))}resolveExternalURL(e){return/^[^\\/]/.test(e)&&!/^http/.test(e)?this.workingPath+"/"+e:e}workingPathForURL(e){const t=e.split(/[\\/]/g);return t.pop(),t.join("/")+"/"}parse(e){throw new Error("LoaderBase: Parse not implemented.")}}function Aa(e){if(null===e||e.byteLength<4)return"";let t;if(t=e instanceof DataView?e:new DataView(e),"{"===String.fromCharCode(t.getUint8(0)))return null;let n="";for(let r=0;r<4;r++)n+=String.fromCharCode(t.getUint8(r));return n}class Sa extends Ma{parse(e){const t=new DataView(e),n=Aa(t);console.assert("b3dm"===n);const r=t.getUint32(4,!0);console.assert(1===r);const i=t.getUint32(8,!0);console.assert(i===e.byteLength);const s=t.getUint32(12,!0),o=t.getUint32(16,!0),a=t.getUint32(20,!0),l=t.getUint32(24,!0),c=e.slice(28,28+s+o),u=new ba(c,0,s,o),h=28+s+o,d=e.slice(h,h+a+l),p=new Ta(d,u.getData("BATCH_LENGTH"),0,a,l),f=h+a+l;return{version:r,featureTable:u,batchTable:p,glbBytes:new Uint8Array(e,f,i-f)}}}function Ea(e,t){if(t===Ht)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===Gt||t===Vt){let n=e.getIndex();if(null===n){const t=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<r.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const r=n.count-2,i=[];if(t===Gt)for(let e=1;e<=r;e++)i.push(n.getX(0)),i.push(n.getX(e)),i.push(n.getX(e+1));else for(let e=0;e<r;e++)e%2==0?(i.push(n.getX(e)),i.push(n.getX(e+1)),i.push(n.getX(e+2))):(i.push(n.getX(e+2)),i.push(n.getX(e+1)),i.push(n.getX(e)));i.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=e.clone();return s.setIndex(i),s.clearGroups(),s}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}class Pa extends et{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new ka(e)})),this.register((function(e){return new Oa(e)})),this.register((function(e){return new Va(e)})),this.register((function(e){return new Wa(e)})),this.register((function(e){return new Xa(e)})),this.register((function(e){return new Ua(e)})),this.register((function(e){return new Ba(e)})),this.register((function(e){return new za(e)})),this.register((function(e){return new Na(e)})),this.register((function(e){return new Da(e)})),this.register((function(e){return new ja(e)})),this.register((function(e){return new Fa(e)})),this.register((function(e){return new Ga(e)})),this.register((function(e){return new Ha(e)})),this.register((function(e){return new La(e)})),this.register((function(e){return new Ka(e)})),this.register((function(e){return new qa(e)}))}load(e,t,n,r){const i=this;let s;if(""!==this.resourcePath)s=this.resourcePath;else if(""!==this.path){const t=tt.extractUrlBase(e);s=tt.resolveURL(t,this.path)}else s=tt.extractUrlBase(e);this.manager.itemStart(e);const o=function(t){r?r(t):console.error(t),i.manager.itemError(e),i.manager.itemEnd(e)},a=new nt(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{i.parse(n,s,(function(n){t(n),i.manager.itemEnd(e)}),o)}catch(r){o(r)}}),n,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let i;const s={},o={},a=new TextDecoder;if("string"==typeof e)i=JSON.parse(e);else if(e instanceof ArrayBuffer)if(a.decode(new Uint8Array(e,0,4))===Ya){try{s[Ra.KHR_BINARY_GLTF]=new Qa(e)}catch(Ui){return void(r&&r(Ui))}i=JSON.parse(s[Ra.KHR_BINARY_GLTF].content)}else i=JSON.parse(a.decode(e));else i=e;if(void 0===i.asset||i.asset.version[0]<2)return void(r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new Tl(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const e=this.pluginCallbacks[c](l);e.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[e.name]=e,s[e.name]=!0}if(i.extensionsUsed)for(let c=0;c<i.extensionsUsed.length;++c){const e=i.extensionsUsed[c],t=i.extensionsRequired||[];switch(e){case Ra.KHR_MATERIALS_UNLIT:s[e]=new Ia;break;case Ra.KHR_DRACO_MESH_COMPRESSION:s[e]=new Ja(i,this.dracoLoader);break;case Ra.KHR_TEXTURE_TRANSFORM:s[e]=new el;break;case Ra.KHR_MESH_QUANTIZATION:s[e]=new tl;break;default:t.indexOf(e)>=0&&void 0===o[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}l.setExtensions(s),l.setPlugins(o),l.parse(n,r)}parseAsync(e,t){const n=this;return new Promise((function(r,i){n.parse(e,t,r,i)}))}}function Ca(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const Ra={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class La{constructor(e){this.parser=e,this.name=Ra.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;const i=t.json,s=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let o;const a=new q(16777215);void 0!==s.color&&a.setRGB(s.color[0],s.color[1],s.color[2],Ee);const l=void 0!==s.range?s.range:0;switch(s.type){case"directional":o=new mt(a),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new ft(a),o.distance=l;break;case"spot":o=new pt(a),o.distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,o.angle=s.spot.outerConeAngle,o.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return o.position.set(0,0,0),vl(o,s),void 0!==s.intensity&&(o.intensity=s.intensity),o.name=t.createUniqueName(s.name||"light_"+e),r=Promise.resolve(o),t.cache.add(n,r),r}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],i=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(e){return n._getNodeRef(t.cache,i,e)}))}}class Ia{constructor(){this.name=Ra.KHR_MATERIALS_UNLIT}getMaterialType(){return ie}extendParams(e,t,n){const r=[];e.color=new q(1,1,1),e.opacity=1;const i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const t=i.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],Ee),e.opacity=t[3]}void 0!==i.baseColorTexture&&r.push(n.assignTexture(e,"map",i.baseColorTexture,K))}return Promise.all(r)}}class Da{constructor(e){this.parser=e,this.name=Ra.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name].emissiveStrength;return void 0!==r&&(t.emissiveIntensity=r),Promise.resolve()}}class ka{constructor(e){this.parser=e,this.name=Ra.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dt:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];if(void 0!==s.clearcoatFactor&&(t.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&i.push(n.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&i.push(n.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(i.push(n.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){const e=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new te(e,e)}return Promise.all(i)}}class Oa{constructor(e){this.parser=e,this.name=Ra.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dt:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.dispersion=void 0!==r.dispersion?r.dispersion:0,Promise.resolve()}}class Fa{constructor(e){this.parser=e,this.name=Ra.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dt:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return void 0!==s.iridescenceFactor&&(t.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&i.push(n.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(t.iridescenceIOR=s.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&i.push(n.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(i)}}class Ua{constructor(e){this.parser=e,this.name=Ra.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dt:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[];t.sheenColor=new q(0,0,0),t.sheenRoughness=0,t.sheen=1;const s=r.extensions[this.name];if(void 0!==s.sheenColorFactor){const e=s.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],Ee)}return void 0!==s.sheenRoughnessFactor&&(t.sheenRoughness=s.sheenRoughnessFactor),void 0!==s.sheenColorTexture&&i.push(n.assignTexture(t,"sheenColorMap",s.sheenColorTexture,K)),void 0!==s.sheenRoughnessTexture&&i.push(n.assignTexture(t,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(i)}}class Ba{constructor(e){this.parser=e,this.name=Ra.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dt:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&i.push(n.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(i)}}class za{constructor(e){this.parser=e,this.name=Ra.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dt:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];t.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&i.push(n.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||1/0;const o=s.attenuationColor||[1,1,1];return t.attenuationColor=(new q).setRGB(o[0],o[1],o[2],Ee),Promise.all(i)}}class Na{constructor(e){this.parser=e,this.name=Ra.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dt:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.ior=void 0!==r.ior?r.ior:1.5,Promise.resolve()}}class ja{constructor(e){this.parser=e,this.name=Ra.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dt:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];t.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&i.push(n.assignTexture(t,"specularIntensityMap",s.specularTexture));const o=s.specularColorFactor||[1,1,1];return t.specularColor=(new q).setRGB(o[0],o[1],o[2],Ee),void 0!==s.specularColorTexture&&i.push(n.assignTexture(t,"specularColorMap",s.specularColorTexture,K)),Promise.all(i)}}class Ha{constructor(e){this.parser=e,this.name=Ra.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dt:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return t.bumpScale=void 0!==s.bumpFactor?s.bumpFactor:1,void 0!==s.bumpTexture&&i.push(n.assignTexture(t,"bumpMap",s.bumpTexture)),Promise.all(i)}}class Ga{constructor(e){this.parser=e,this.name=Ra.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dt:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return void 0!==s.anisotropyStrength&&(t.anisotropy=s.anisotropyStrength),void 0!==s.anisotropyRotation&&(t.anisotropyRotation=s.anisotropyRotation),void 0!==s.anisotropyTexture&&i.push(n.assignTexture(t,"anisotropyMap",s.anisotropyTexture)),Promise.all(i)}}class Va{constructor(e){this.parser=e,this.name=Ra.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const i=r.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,s)}}class Wa{constructor(e){this.parser=e,this.name=Ra.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;const s=i.extensions[t],o=r.images[s.source];let a=n.textureLoader;if(o.uri){const e=n.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(e,s.source,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class Xa{constructor(e){this.parser=e,this.name=Ra.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;const s=i.extensions[t],o=r.images[s.source];let a=n.textureLoader;if(o.uri){const e=n.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(e,s.source,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class Ka{constructor(e){this.name=Ra.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],r=this.parser.getDependency("buffer",e.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then((function(t){const n=e.byteOffset||0,r=e.byteLength||0,s=e.count,o=e.byteStride,a=new Uint8Array(t,n,r);return i.decodeGltfBufferAsync?i.decodeGltfBufferAsync(s,o,a,e.mode,e.filter).then((function(e){return e.buffer})):i.ready.then((function(){const t=new ArrayBuffer(s*o);return i.decodeGltfBuffer(new Uint8Array(t),s,o,a,e.mode,e.filter),t}))}))}return null}}class qa{constructor(e){this.name=Ra.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;const r=t.meshes[n.mesh];for(const a of r.primitives)if(a.mode!==sl.TRIANGLES&&a.mode!==sl.TRIANGLE_STRIP&&a.mode!==sl.TRIANGLE_FAN&&void 0!==a.mode)return null;const i=n.extensions[this.name].attributes,s=[],o={};for(const a in i)s.push(this.parser.getDependency("accessor",i[a]).then((e=>(o[a]=e,o[a]))));return s.length<1?null:(s.push(this.parser.createNodeMesh(e)),Promise.all(s).then((e=>{const t=e.pop(),n=t.isGroup?t.children:[t],r=e[0].count,i=[];for(const s of n){const e=new Ne,t=new ne,n=new Ge,a=new ne(1,1,1),l=new it(s.geometry,s.material,r);for(let i=0;i<r;i++)o.TRANSLATION&&t.fromBufferAttribute(o.TRANSLATION,i),o.ROTATION&&n.fromBufferAttribute(o.ROTATION,i),o.SCALE&&a.fromBufferAttribute(o.SCALE,i),l.setMatrixAt(i,e.compose(t,n,a));for(const r in o)if("_COLOR_0"===r){const e=o[r];l.instanceColor=new gt(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==r&&"ROTATION"!==r&&"SCALE"!==r&&s.geometry.setAttribute(r,o[r]);Z.prototype.copy.call(l,s),this.parser.assignFinalMaterial(l),i.push(l)}return t.isGroup?(t.clear(),t.add(...i),t):i[0]})))}}const Ya="glTF",Za=1313821514,$a=5130562;class Qa{constructor(e){this.name=Ra.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Ya)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-12,i=new DataView(e,12);let s=0;for(;s<r;){const t=i.getUint32(s,!0);s+=4;const r=i.getUint32(s,!0);if(s+=4,r===Za){const r=new Uint8Array(e,12+s,t);this.content=n.decode(r)}else if(r===$a){const n=12+s;this.body=e.slice(n,n+t)}s+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ja{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ra.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,o={},a={},l={};for(const c in s){const e=ul[c]||c.toLowerCase();o[e]=s[c]}for(const c in e.attributes){const t=ul[c]||c.toLowerCase();if(void 0!==s[c]){const r=n.accessors[e.attributes[c]],i=ol[r.componentType];l[t]=i.name,a[t]=!0===r.normalized}}return t.getDependency("bufferView",i).then((function(e){return new Promise((function(t,n){r.decodeDracoFile(e,(function(e){for(const t in e.attributes){const n=e.attributes[t],r=a[t];void 0!==r&&(n.normalized=r)}t(e)}),o,l,Ee,n)}))}))}}class el{constructor(){this.name=Ra.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(void 0===t.texCoord||t.texCoord===e.channel)&&void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class tl{constructor(){this.name=Ra.KHR_MESH_QUANTIZATION}}class nl extends Wt{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r;for(let s=0;s!==r;s++)t[s]=n[i+s];return t}interpolate_(e,t,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,c=r-t,u=(n-t)/c,h=u*u,d=h*u,p=e*l,f=p-l,m=-2*d+3*h,g=d-h,v=1-m,y=g-h+u;for(let _=0;_!==o;_++){const e=s[f+_+o],t=s[f+_+a]*c,n=s[p+_+o],r=s[p+_]*c;i[_]=v*e+y*t+m*n+g*r}return i}}const rl=new Ge;class il extends nl{interpolate_(e,t,n,r){const i=super.interpolate_(e,t,n,r);return rl.fromArray(i).normalize().toArray(i),i}}const sl={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},ol={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},al={9728:_e,9729:pe,9984:wt,9985:bt,9986:xt,9987:_t},ll={33071:At,33648:Mt,10497:Tt},cl={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ul={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},hl={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},dl={CUBICSPLINE:void 0,LINEAR:kt,STEP:Dt},pl="OPAQUE",fl="MASK",ml="BLEND";function gl(e,t,n){for(const r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function vl(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function yl(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,r=n.length;t<r;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function _l(e){let t;const n=e.extensions&&e.extensions[Ra.KHR_DRACO_MESH_COMPRESSION];if(t=n?"draco:"+n.bufferView+":"+n.indices+":"+xl(n.attributes):e.indices+":"+xl(e.attributes)+":"+e.mode,void 0!==e.targets)for(let r=0,i=e.targets.length;r<i;r++)t+=":"+xl(e.targets[r]);return t}function xl(e){let t="";const n=Object.keys(e).sort();for(let r=0,i=n.length;r<i;r++)t+=n[r]+":"+e[n[r]]+";";return t}function bl(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const wl=new Ne;class Tl{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Ca,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,r=-1,i=!1,s=-1;if(typeof navigator<"u"){const e=navigator.userAgent;n=!0===/^((?!chrome|android).)*safari/i.test(e);const t=e.match(/Version\/(\d+)/);r=n&&t?parseInt(t[1],10):-1,i=e.indexOf("Firefox")>-1,s=i?e.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||n&&r<17||i&&s<98?this.textureLoader=new De(this.options.manager):this.textureLoader=new vt(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new nt(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){const s={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};return gl(i,s,r),vl(s,r),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(s)}))).then((function(){for(const e of s.scenes)e.updateMatrixWorld();e(s)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let r=0,i=t.length;r<i;r++){const n=t[r].joints;for(let t=0,r=n.length;t<r;t++)e[n[t]].isBone=!0}for(let r=0,i=e.length;r<i;r++){const t=e[r];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(n[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone(),i=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[r,s]of e.children.entries())i(s,t.children[r])};return i(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const i=e(t[r]);i&&n.push(i)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":r=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":r=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne((function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)})),!r)throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return n.getDependency(e,r)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[Ra.KHR_BINARY_GLTF].body);const r=this.options;return new Promise((function(e,i){n.load(tt.resolveURL(t.uri,r.path),e,void 0,(function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)}))}loadAccessor(e){const t=this,n=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse){const e=cl[r.type],t=ol[r.componentType],n=!0===r.normalized,i=new t(r.count*e);return Promise.resolve(new $(i,e,n))}const i=[];return void 0!==r.bufferView?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),void 0!==r.sparse&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then((function(e){const i=e[0],s=cl[r.type],o=ol[r.componentType],a=o.BYTES_PER_ELEMENT,l=a*s,c=r.byteOffset||0,u=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,h=!0===r.normalized;let d,p;if(u&&u!==l){const e=Math.floor(c/u),n="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+e+":"+r.count;let l=t.cache.get(n);l||(d=new o(i,e*u,r.count*u/a),l=new yt(d,u/a),t.cache.add(n,l)),p=new Ut(l,s,c%u/a,h)}else d=null===i?new o(r.count*s):new o(i,c,r.count*s),p=new $(d,s,h);if(void 0!==r.sparse){const t=cl.SCALAR,n=ol[r.sparse.indices.componentType],a=r.sparse.indices.byteOffset||0,l=r.sparse.values.byteOffset||0,c=new n(e[1],a,r.sparse.count*t),u=new o(e[2],l,r.sparse.count*s);null!==i&&(p=new $(p.array.slice(),p.itemSize,p.normalized)),p.normalized=!1;for(let e=0,r=c.length;e<r;e++){const t=c[e];if(p.setX(t,u[e*s]),s>=2&&p.setY(t,u[e*s+1]),s>=3&&p.setZ(t,u[e*s+2]),s>=4&&p.setW(t,u[e*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}p.normalized=h}return p}))}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,i=t.images[r];let s=this.textureLoader;if(i.uri){const e=n.manager.getHandler(i.uri);null!==e&&(s=e)}return this.loadTextureImage(e,r,s)}loadTextureImage(e,t,n){const r=this,i=this.json,s=i.textures[e],o=i.images[t],a=(o.uri||o.bufferView)+":"+s.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(t,n).then((function(t){t.flipY=!1,t.name=s.name||o.name||"",""===t.name&&"string"==typeof o.uri&&!1===o.uri.startsWith("data:image/")&&(t.name=o.uri);const n=(i.samplers||{})[s.sampler]||{};return t.magFilter=al[n.magFilter]||pe,t.minFilter=al[n.minFilter]||_t,t.wrapS=ll[n.wrapS]||Tt,t.wrapT=ll[n.wrapT]||Tt,t.generateMipmaps=!t.isCompressedTexture&&t.minFilter!==_e&&t.minFilter!==pe,r.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[a]=l,l}loadImageSource(e,t){const n=this.json,r=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const i=n.images[e],s=self.URL||self.webkitURL;let o=i.uri||"",a=!1;if(void 0!==i.bufferView)o=this.getDependency("bufferView",i.bufferView).then((function(e){a=!0;const t=new Blob([e],{type:i.mimeType});return o=s.createObjectURL(t),o}));else if(void 0===i.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const l=Promise.resolve(o).then((function(e){return new Promise((function(n,i){let s=n;!0===t.isImageBitmapLoader&&(s=function(e){const t=new Me(e);t.needsUpdate=!0,n(t)}),t.load(tt.resolveURL(e,r.path),s,void 0,i)}))})).then((function(e){return!0===a&&s.revokeObjectURL(o),vl(e,i),e.userData.mimeType=i.mimeType||((t=i.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":t.search(/\.ktx2($|\?)/i)>0||0===t.search(/^data\:image\/ktx2/)?"image/ktx2":"image/png"),e;var t})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),e}));return this.sourceCache[e]=l,l}assignTexture(e,t,n,r){const i=this;return this.getDependency("texture",n.index).then((function(s){if(!s)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((s=s.clone()).channel=n.texCoord),i.extensions[Ra.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[Ra.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=i.associations.get(s);s=i.extensions[Ra.KHR_TEXTURE_TRANSFORM].extendTexture(s,e),i.associations.set(s,t)}}return void 0!==r&&(s.colorSpace=r),e[t]=s,s}))}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const r=void 0===t.attributes.tangent,i=void 0!==t.attributes.color,s=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new je,Te.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new ot,Te.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,this.cache.add(e,t)),n=t}if(r||i||s){let e="ClonedMaterial:"+n.uuid+":";r&&(e+="derivative-tangents:"),i&&(e+="vertex-colors:"),s&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),i&&(t.vertexColors=!0),s&&(t.flatShading=!0),r&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}e.material=n}getMaterialType(){return Ze}loadMaterial(e){const t=this,n=this.json,r=this.extensions,i=n.materials[e];let s;const o={},a=[];if((i.extensions||{})[Ra.KHR_MATERIALS_UNLIT]){const e=r[Ra.KHR_MATERIALS_UNLIT];s=e.getMaterialType(),a.push(e.extendParams(o,i,t))}else{const n=i.pbrMetallicRoughness||{};if(o.color=new q(1,1,1),o.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;o.color.setRGB(e[0],e[1],e[2],Ee),o.opacity=e[3]}void 0!==n.baseColorTexture&&a.push(t.assignTexture(o,"map",n.baseColorTexture,K)),o.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,o.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(a.push(t.assignTexture(o,"metalnessMap",n.metallicRoughnessTexture)),a.push(t.assignTexture(o,"roughnessMap",n.metallicRoughnessTexture))),s=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),a.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,o)}))))}!0===i.doubleSided&&(o.side=se);const l=i.alphaMode||pl;if(l===ml?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,l===fl&&(o.alphaTest=void 0!==i.alphaCutoff?i.alphaCutoff:.5)),void 0!==i.normalTexture&&s!==ie&&(a.push(t.assignTexture(o,"normalMap",i.normalTexture)),o.normalScale=new te(1,1),void 0!==i.normalTexture.scale)){const e=i.normalTexture.scale;o.normalScale.set(e,e)}if(void 0!==i.occlusionTexture&&s!==ie&&(a.push(t.assignTexture(o,"aoMap",i.occlusionTexture)),void 0!==i.occlusionTexture.strength&&(o.aoMapIntensity=i.occlusionTexture.strength)),void 0!==i.emissiveFactor&&s!==ie){const e=i.emissiveFactor;o.emissive=(new q).setRGB(e[0],e[1],e[2],Ee)}return void 0!==i.emissiveTexture&&s!==ie&&a.push(t.assignTexture(o,"emissiveMap",i.emissiveTexture,K)),Promise.all(a).then((function(){const n=new s(o);return i.name&&(n.name=i.name),vl(n,i),t.associations.set(n,{materials:e}),i.extensions&&gl(r,n,i),n}))}createUniqueName(e){const t=St.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,r=this.primitiveCache;function i(e){return n[Ra.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return Ml(n,e,t)}))}const s=[];for(let o=0,a=e.length;o<a;o++){const n=e[o],a=_l(n),l=r[a];if(l)s.push(l.promise);else{let e;e=n.extensions&&n.extensions[Ra.KHR_DRACO_MESH_COMPRESSION]?i(n):Ml(new Ae,n,t),r[a]={primitive:n,promise:e},s.push(e)}}return Promise.all(s)}loadMesh(e){const t=this,n=this.json,r=this.extensions,i=n.meshes[e],s=i.primitives,o=[];for(let l=0,c=s.length;l<c;l++){const e=void 0===s[l].material?(void 0===(a=this.cache).DefaultMaterial&&(a.DefaultMaterial=new Ze({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ve})),a.DefaultMaterial):this.getDependency("material",s[l].material);o.push(e)}var a;return o.push(t.loadGeometries(s)),Promise.all(o).then((function(n){const o=n.slice(0,n.length-1),a=n[n.length-1],l=[];for(let u=0,h=a.length;u<h;u++){const n=a[u],c=s[u];let h;const d=o[u];if(c.mode===sl.TRIANGLES||c.mode===sl.TRIANGLE_STRIP||c.mode===sl.TRIANGLE_FAN||void 0===c.mode)h=!0===i.isSkinnedMesh?new Et(n,d):new oe(n,d),!0===h.isSkinnedMesh&&h.normalizeSkinWeights(),c.mode===sl.TRIANGLE_STRIP?h.geometry=Ea(h.geometry,Vt):c.mode===sl.TRIANGLE_FAN&&(h.geometry=Ea(h.geometry,Gt));else if(c.mode===sl.LINES)h=new st(n,d);else if(c.mode===sl.LINE_STRIP)h=new Pt(n,d);else if(c.mode===sl.LINE_LOOP)h=new Ct(n,d);else{if(c.mode!==sl.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);h=new He(n,d)}Object.keys(h.geometry.morphAttributes).length>0&&yl(h,i),h.name=t.createUniqueName(i.name||"mesh_"+e),vl(h,i),c.extensions&&gl(r,h,c),t.assignFinalMaterial(h),l.push(h)}for(let r=0,i=l.length;r<i;r++)t.associations.set(l[r],{meshes:e,primitives:r});if(1===l.length)return i.extensions&&gl(r,l[0],i),l[0];const c=new Oe;i.extensions&&gl(r,c,i),t.associations.set(c,{meshes:e});for(let e=0,t=l.length;e<t;e++)c.add(l[e]);return c}))}loadCamera(e){let t;const n=this.json.cameras[e],r=n[n.type];if(r)return"perspective"===n.type?t=new j(Y.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(t=new Le(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),vl(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n=[];for(let r=0,i=t.joints.length;r<i;r++)n.push(this._loadNodeShallow(t.joints[r]));return void 0!==t.inverseBindMatrices?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then((function(e){const n=e.pop(),r=e,i=[],s=[];for(let o=0,a=r.length;o<a;o++){const e=r[o];if(e){i.push(e);const t=new Ne;null!==n&&t.fromArray(n.array,16*o),s.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}return new Rt(i,s)}))}loadAnimation(e){const t=this.json,n=this,r=t.animations[e],i=r.name?r.name:"animation_"+e,s=[],o=[],a=[],l=[],c=[];for(let u=0,h=r.channels.length;u<h;u++){const e=r.channels[u],t=r.samplers[e.sampler],n=e.target,i=n.node,h=void 0!==r.parameters?r.parameters[t.input]:t.input,d=void 0!==r.parameters?r.parameters[t.output]:t.output;void 0!==n.node&&(s.push(this.getDependency("node",i)),o.push(this.getDependency("accessor",h)),a.push(this.getDependency("accessor",d)),l.push(t),c.push(n))}return Promise.all([Promise.all(s),Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c)]).then((function(e){const t=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=[];for(let i=0,c=t.length;i<c;i++){const e=t[i],c=r[i],u=s[i],h=o[i],d=a[i];if(void 0===e)continue;e.updateMatrix&&e.updateMatrix();const p=n._createAnimationTracks(e,c,u,h,d);if(p)for(let t=0;t<p.length;t++)l.push(p[t])}return new Lt(i,void 0,l)}))}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then((function(e){const t=n._getNodeRef(n.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,n=r.weights.length;t<n;t++)e.morphTargetInfluences[t]=r.weights[t]})),t}))}loadNode(e){const t=this,n=this.json.nodes[e],r=t._loadNodeShallow(e),i=[],s=n.children||[];for(let a=0,l=s.length;a<l;a++)i.push(t.getDependency("node",s[a]));const o=void 0===n.skin?Promise.resolve(null):t.getDependency("skin",n.skin);return Promise.all([r,Promise.all(i),o]).then((function(e){const t=e[0],n=e[1],r=e[2];null!==r&&t.traverse((function(e){e.isSkinnedMesh&&e.bind(r,wl)}));for(let i=0,s=n.length;i<s;i++)t.add(n[i]);return t}))}_loadNodeShallow(e){const t=this.json,n=this.extensions,r=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const i=t.nodes[e],s=i.name?r.createUniqueName(i.name):"",o=[],a=r._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return a&&o.push(a),void 0!==i.camera&&o.push(r.getDependency("camera",i.camera).then((function(e){return r._getNodeRef(r.cameraCache,i.camera,e)}))),r._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){o.push(e)})),this.nodeCache[e]=Promise.all(o).then((function(t){let o;if(o=!0===i.isBone?new It:t.length>1?new Oe:1===t.length?t[0]:new Z,o!==t[0])for(let e=0,n=t.length;e<n;e++)o.add(t[e]);if(i.name&&(o.userData.name=i.name,o.name=s),vl(o,i),i.extensions&&gl(n,o,i),void 0!==i.matrix){const e=new Ne;e.fromArray(i.matrix),o.applyMatrix4(e)}else void 0!==i.translation&&o.position.fromArray(i.translation),void 0!==i.rotation&&o.quaternion.fromArray(i.rotation),void 0!==i.scale&&o.scale.fromArray(i.scale);return r.associations.has(o)||r.associations.set(o,{}),r.associations.get(o).nodes=e,o})),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],r=this,i=new Oe;n.name&&(i.name=r.createUniqueName(n.name)),vl(i,n),n.extensions&&gl(t,i,n);const s=n.nodes||[],o=[];for(let a=0,l=s.length;a<l;a++)o.push(r.getDependency("node",s[a]));return Promise.all(o).then((function(e){for(let t=0,n=e.length;t<n;t++)i.add(e[t]);return r.associations=(e=>{const t=new Map;for(const[n,i]of r.associations)(n instanceof Te||n instanceof Me)&&t.set(n,i);return e.traverse((e=>{const n=r.associations.get(e);null!=n&&t.set(e,n)})),t})(i),i}))}_createAnimationTracks(e,t,n,r,i){const s=[],o=e.name?e.name:e.uuid,a=[];let l;switch(hl[i.path]===hl.weights?e.traverse((function(e){e.morphTargetInfluences&&a.push(e.name?e.name:e.uuid)})):a.push(o),hl[i.path]){case hl.weights:l=zt;break;case hl.rotation:l=Nt;break;case hl.position:case hl.scale:l=Bt;break;default:if(1===n.itemSize)l=zt;else l=Bt}const c=void 0!==r.interpolation?dl[r.interpolation]:kt,u=this._getArrayFromAccessor(n);for(let h=0,d=a.length;h<d;h++){const e=new l(a[h]+"."+hl[i.path],t.array,u,c);"CUBICSPLINE"===r.interpolation&&this._createCubicSplineTrackInterpolant(e),s.push(e)}return s}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=bl(t.constructor),n=new Float32Array(t.length);for(let r=0,i=t.length;r<i;r++)n[r]=t[r]*e;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof Nt?il:nl)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Ml(e,t,n){const r=t.attributes,i=[];function s(t,r){return n.getDependency("accessor",t).then((function(t){e.setAttribute(r,t)}))}for(const o in r){const t=ul[o]||o.toLowerCase();t in e.attributes||i.push(s(r[o],t))}if(void 0!==t.indices&&!e.index){const r=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));i.push(r)}return jt.workingColorSpace!==Ee&&"COLOR_0"in r&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${jt.workingColorSpace}" not supported.`),vl(e,t),function(e,t,n){const r=t.attributes,i=new ht;if(void 0===r.POSITION)return;{const e=n.json.accessors[r.POSITION],t=e.min,s=e.max;if(void 0===t||void 0===s)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(i.set(new ne(t[0],t[1],t[2]),new ne(s[0],s[1],s[2])),e.normalized){const t=bl(ol[e.componentType]);i.min.multiplyScalar(t),i.max.multiplyScalar(t)}}const s=t.targets;if(void 0!==s){const e=new ne,t=new ne;for(let r=0,i=s.length;r<i;r++){const i=s[r];if(void 0!==i.POSITION){const r=n.json.accessors[i.POSITION],s=r.min,o=r.max;if(void 0!==s&&void 0!==o){if(t.setX(Math.max(Math.abs(s[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(s[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(s[2]),Math.abs(o[2]))),r.normalized){const e=bl(ol[r.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(e)}e.boundingBox=i;const o=new qe;i.getCenter(o.center),o.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=o}(e,t,n),Promise.all(i).then((function(){return void 0!==t.targets?function(e,t,n){let r=!1,i=!1,s=!1;for(let c=0,u=t.length;c<u;c++){const e=t[c];if(void 0!==e.POSITION&&(r=!0),void 0!==e.NORMAL&&(i=!0),void 0!==e.COLOR_0&&(s=!0),r&&i&&s)break}if(!r&&!i&&!s)return Promise.resolve(e);const o=[],a=[],l=[];for(let c=0,u=t.length;c<u;c++){const u=t[c];if(r){const t=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):e.attributes.position;o.push(t)}if(i){const t=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):e.attributes.normal;a.push(t)}if(s){const t=void 0!==u.COLOR_0?n.getDependency("accessor",u.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then((function(t){const n=t[0],o=t[1],a=t[2];return r&&(e.morphAttributes.position=n),i&&(e.morphAttributes.normal=o),s&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}class Al extends Sa{constructor(e=rt){super(),this.manager=e,this.adjustmentTransform=new Ne}parse(e){const t=super.parse(e),n=t.glbBytes.slice().buffer;return new Promise(((e,r)=>{const i=this.manager,s=this.fetchOptions,o=i.getHandler("path.gltf")||new Pa(i);"include"===s.credentials&&"cors"===s.mode&&o.setCrossOrigin("use-credentials"),"credentials"in s&&o.setWithCredentials("include"===s.credentials),s.headers&&o.setRequestHeader(s.headers);let a=this.workingPath;!/[\\/]$/.test(a)&&a.length&&(a+="/");const l=this.adjustmentTransform;o.parse(n,a,(n=>{const{batchTable:r,featureTable:i}=t,{scene:s}=n,o=i.getData("RTC_CENTER",1,"FLOAT","VEC3");o&&(s.position.x+=o[0],s.position.y+=o[1],s.position.z+=o[2]),n.scene.updateMatrix(),n.scene.matrix.multiply(l),n.scene.matrix.decompose(n.scene.position,n.scene.quaternion,n.scene.scale),n.batchTable=r,n.featureTable=i,s.batchTable=r,s.featureTable=i,e(n)}),r)}))}}class Sl extends Ma{parse(e){const t=new DataView(e),n=Aa(t);console.assert("pnts"===n);const r=t.getUint32(4,!0);console.assert(1===r);const i=t.getUint32(8,!0);console.assert(i===e.byteLength);const s=t.getUint32(12,!0),o=t.getUint32(16,!0),a=t.getUint32(20,!0),l=t.getUint32(24,!0),c=e.slice(28,28+s+o),u=new ba(c,0,s,o),h=28+s+o,d=e.slice(h,h+a+l),p=new Ta(d,u.getData("BATCH_LENGTH")||u.getData("POINTS_LENGTH"),0,a,l);return Promise.resolve({version:r,featureTable:u,batchTable:p})}}function El(e){const t=e>>11,n=e>>5&63,r=31&e;return[Math.round(t/31*255),Math.round(n/63*255),Math.round(r/31*255)]}const Pl=new te;function Cl(e,t,n=new ne){Pl.set(e,t).divideScalar(256).multiplyScalar(2).subScalar(1),n.set(Pl.x,Pl.y,1-Math.abs(Pl.x)-Math.abs(Pl.y));const r=Y.clamp(-n.z,0,1);return n.x>=0?n.setX(n.x-r):n.setX(n.x+r),n.y>=0?n.setY(n.y-r):n.setY(n.y+r),n.normalize(),n}const Rl={RGB:"color",POSITION:"position"};class Ll extends Sl{constructor(e=rt){super(),this.manager=e}parse(e){return super.parse(e).then((async e=>{const{featureTable:t,batchTable:n}=e,r=new je,i=t.header.extensions,s=new ne;let o;if(i&&i["3DTILES_draco_point_compression"]){const{byteOffset:e,byteLength:n,properties:s}=i["3DTILES_draco_point_compression"],a=this.manager.getHandler("draco.drc");if(null==a)throw new Error("PNTSLoader: dracoLoader not available.");const l={};for(const t in s)if(t in Rl&&t in s){l[Rl[t]]=s[t]}const c={attributeIDs:l,attributeTypes:{position:"Float32Array",color:"Uint8Array"},useUniqueIDs:!0},u=t.getBuffer(e,n);o=await a.decodeGeometry(u,c),o.attributes.color&&(r.vertexColors=!0)}else{const e=t.getData("POINTS_LENGTH"),n=t.getData("POSITION",e,"FLOAT","VEC3"),i=t.getData("NORMAL",e,"FLOAT","VEC3"),a=t.getData("NORMAL",e,"UNSIGNED_BYTE","VEC2"),l=t.getData("RGB",e,"UNSIGNED_BYTE","VEC3"),c=t.getData("RGBA",e,"UNSIGNED_BYTE","VEC4"),u=t.getData("RGB565",e,"UNSIGNED_SHORT","SCALAR"),h=t.getData("CONSTANT_RGBA",e,"UNSIGNED_BYTE","VEC4"),d=t.getData("POSITION_QUANTIZED",e,"UNSIGNED_SHORT","VEC3"),p=t.getData("QUANTIZED_VOLUME_SCALE",e,"FLOAT","VEC3"),f=t.getData("QUANTIZED_VOLUME_OFFSET",e,"FLOAT","VEC3");if(o=new Ae,d){const t=new Float32Array(3*e);for(let n=0;n<e;n++)for(let e=0;e<3;e++){const r=3*n+e;t[r]=d[r]/65535*p[e]}s.x=f[0],s.y=f[1],s.z=f[2],o.setAttribute("position",new $(t,3,!1))}else o.setAttribute("position",new $(n,3,!1));if(null!==i)o.setAttribute("normal",new $(i,3,!1));else if(null!==a){const t=new Float32Array(3*e),n=new ne;for(let r=0;r<e;r++){const e=Cl(a[2*r],a[2*r+1],n);t[3*r]=e.x,t[3*r+1]=e.y,t[3*r+2]=e.z}o.setAttribute("normal",new $(t,3,!1))}if(null!==c)o.setAttribute("color",new $(c,4,!0)),r.vertexColors=!0,r.transparent=!0,r.depthWrite=!1;else if(null!==l)o.setAttribute("color",new $(l,3,!0)),r.vertexColors=!0;else if(null!==u){const t=new Uint8Array(3*e);for(let n=0;n<e;n++){const e=El(u[n]);for(let r=0;r<3;r++){t[3*n+r]=e[r]}}o.setAttribute("color",new $(t,3,!0)),r.vertexColors=!0}else if(null!==h){const e=new q(h[0],h[1],h[2]);r.color=e;const t=h[3]/255;t<1&&(r.opacity=t,r.transparent=!0,r.depthWrite=!1)}}const a=new He(o,r);a.position.copy(s),e.scene=a,e.scene.featureTable=t,e.scene.batchTable=n;const l=t.getData("RTC_CENTER",1,"FLOAT","VEC3");return l&&(e.scene.position.x+=l[0],e.scene.position.y+=l[1],e.scene.position.z+=l[2]),e}))}}class Il extends Ma{parse(e){const t=new DataView(e),n=Aa(t);console.assert("i3dm"===n);const r=t.getUint32(4,!0);console.assert(1===r);const i=t.getUint32(8,!0);console.assert(i===e.byteLength);const s=t.getUint32(12,!0),o=t.getUint32(16,!0),a=t.getUint32(20,!0),l=t.getUint32(24,!0),c=t.getUint32(28,!0),u=e.slice(32,32+s+o),h=new ba(u,0,s,o),d=32+s+o,p=e.slice(d,d+a+l),f=new Ta(p,h.getData("INSTANCES_LENGTH"),0,a,l),m=d+a+l,g=new Uint8Array(e,m,i-m);let v=null,y=null,_=null;if(c)v=g,y=Promise.resolve();else{const e=this.resolveExternalURL(_a(g)),t=e.split(/[\\/]/g);t.pop(),_=t.join("/"),y=fetch(e,this.fetchOptions).then((t=>{if(!t.ok)throw new Error(`I3DMLoaderBase : Failed to load file "${e}" with status ${t.status} : ${t.statusText}`);return t.arrayBuffer()})).then((e=>{v=new Uint8Array(e)}))}return y.then((()=>({version:r,featureTable:h,batchTable:f,glbBytes:v,gltfWorkingPath:_})))}}new ne;const Dl=new Qe,kl=new ne,Ol=new ne,Fl=new ne,Ul=new Ne,Bl=new Ne,zl=new Ne,Nl=new qe,jl=new ze,Hl=new ne,Gl=new ne,Vl=new ne,Wl=new ne,Xl=new Ve;class Kl{constructor(e=1,t=1,n=1){this.name="",this.radius=new ne(e,t,n)}intersectRay(e,t){return Ul.makeScale(...this.radius).invert(),Nl.center.set(0,0,0),Nl.radius=1,Xl.copy(e).applyMatrix4(Ul),Xl.intersectSphere(Nl,t)?(Ul.makeScale(...this.radius),t.applyMatrix4(Ul),t):null}getEastNorthUpFrame(e,t,n,r){return n.isMatrix4&&(r=n,n=0,console.warn('Ellipsoid: The signature for "getEastNorthUpFrame" has changed.')),this.getEastNorthUpAxes(e,t,Hl,Gl,Vl),this.getCartographicToPosition(e,t,n,Wl),r.makeBasis(Hl,Gl,Vl).setPosition(Wl)}getOrientedEastNorthUpFrame(e,t,n,r,i,s,o){return this.getObjectFrame(e,t,n,r,i,s,o,0)}getObjectFrame(e,t,n,r,i,s,o,a=2){return this.getEastNorthUpFrame(e,t,n,Ul),jl.set(i,s,-r,"ZXY"),o.makeRotationFromEuler(jl).premultiply(Ul),1===a?(jl.set(Math.PI/2,0,0,"XYZ"),Bl.makeRotationFromEuler(jl),o.multiply(Bl)):2===a&&(jl.set(-Math.PI/2,0,Math.PI,"XYZ"),Bl.makeRotationFromEuler(jl),o.multiply(Bl)),o}getCartographicFromObjectFrame(e,t,n=2){return 1===n?(jl.set(-Math.PI/2,0,0,"XYZ"),Bl.makeRotationFromEuler(jl).premultiply(e)):2===n?(jl.set(-Math.PI/2,0,Math.PI,"XYZ"),Bl.makeRotationFromEuler(jl).premultiply(e)):Bl.copy(e),Wl.setFromMatrixPosition(Bl),this.getPositionToCartographic(Wl,t),this.getEastNorthUpFrame(t.lat,t.lon,0,Ul).invert(),Bl.premultiply(Ul),jl.setFromRotationMatrix(Bl,"ZXY"),t.azimuth=-jl.z,t.elevation=jl.x,t.roll=jl.y,t}getEastNorthUpAxes(e,t,n,r,i,s=Wl){this.getCartographicToPosition(e,t,0,s),this.getCartographicToNormal(e,t,i),n.set(-s.y,s.x,0).normalize(),r.crossVectors(i,n).normalize()}getAzElRollFromRotationMatrix(e,t,n,r,i=0){return console.warn('Ellipsoid: "getAzElRollFromRotationMatrix" is deprecated. Use "getCartographicFromObjectFrame", instead.'),this.getCartographicToPosition(e,t,0,Wl),zl.copy(n).setPosition(Wl),this.getCartographicFromObjectFrame(zl,r,i),delete r.height,delete r.lat,delete r.lon,r}getRotationMatrixFromAzElRoll(e,t,n,r,i,s,o=0){return console.warn('Ellipsoid: "getRotationMatrixFromAzElRoll" function has been deprecated. Use "getObjectFrame", instead.'),this.getObjectFrame(e,t,0,n,r,i,s,o),s.setPosition(0,0,0),s}getFrame(e,t,n,r,i,s,o,a=0){return console.warn('Ellipsoid: "getFrame" function has been deprecated. Use "getObjectFrame", instead.'),this.getObjectFrame(e,t,s,n,r,i,o,a)}getCartographicToPosition(e,t,n,r){this.getCartographicToNormal(e,t,kl);const i=this.radius;Ol.copy(kl),Ol.x*=i.x**2,Ol.y*=i.y**2,Ol.z*=i.z**2;const s=Math.sqrt(kl.dot(Ol));return Ol.divideScalar(s),r.copy(Ol).addScaledVector(kl,n)}getPositionToCartographic(e,t){this.getPositionToSurfacePoint(e,Ol),this.getPositionToNormal(e,kl);const n=Fl.subVectors(e,Ol);return t.lon=Math.atan2(kl.y,kl.x),t.lat=Math.asin(kl.z),t.height=Math.sign(n.dot(e))*n.length(),t}getCartographicToNormal(e,t,n){return Dl.set(1,-e+Math.PI/2,t),n.setFromSpherical(Dl).normalize(),function(e){const{x:t,y:n,z:r}=e;e.x=r,e.y=t,e.z=n}(n),n}getPositionToNormal(e,t){const n=this.radius;return t.copy(e),t.x/=n.x**2,t.y/=n.y**2,t.z/=n.z**2,t.normalize(),t}getPositionToSurfacePoint(e,t){const n=this.radius,r=1/n.x**2,i=1/n.y**2,s=1/n.z**2,o=e.x*e.x*r,a=e.y*e.y*i,l=e.z*e.z*s,c=o+a+l,u=Math.sqrt(1/c),h=Ol.copy(e).multiplyScalar(u);if(c<.1)return isFinite(u)?t.copy(h):null;const d=Fl.set(h.x*r*2,h.y*i*2,h.z*s*2);let p,f,m,g,v,y,_,x,b,w,T,M=(1-u)*e.length()/(.5*d.length()),A=0;do{M-=A,m=1/(1+M*r),g=1/(1+M*i),v=1/(1+M*s),y=m*m,_=g*g,x=v*v,b=y*m,w=_*g,T=x*v,p=o*y+a*_+l*x-1,f=o*b*r+a*w*i+l*T*s;A=p/(-2*f)}while(Math.abs(p)>1e-12);return t.set(e.x*m,e.y*g,e.z*v)}calculateHorizonDistance(e,t){const n=this.calculateEffectiveRadius(e);return Math.sqrt(2*n*t+t**2)}calculateEffectiveRadius(e){const t=this.radius.x,n=1-this.radius.z**2/t**2,r=e*Y.DEG2RAD,i=Math.sin(r)**2;return t/Math.sqrt(1-n*i)}getPositionElevation(e){this.getPositionToSurfacePoint(e,Ol);const t=Fl.subVectors(e,Ol);return Math.sign(t.dot(e))*t.length()}copy(e){return this.radius.copy(e.radius),this}clone(){return(new this.constructor).copy(this)}}const ql=new Kl(ea,ea,6356752.314245179);ql.name="WGS84 Earth";const Yl=new ne,Zl=new ne,$l=new ne,Ql=new ne,Jl=new Ge,ec=new ne,tc=new Ne,nc=new Ne,rc=new ne,ic=new Ne,sc=new Ge,oc={};class ac extends Il{constructor(e=rt){super(),this.manager=e,this.adjustmentTransform=new Ne,this.ellipsoid=ql.clone()}resolveExternalURL(e){return this.manager.resolveURL(super.resolveExternalURL(e))}parse(e){return super.parse(e).then((e=>{const{featureTable:t,batchTable:n}=e,r=e.glbBytes.slice().buffer;return new Promise(((i,s)=>{const o=this.fetchOptions,a=this.manager,l=a.getHandler("path.gltf")||new Pa(a);"include"===o.credentials&&"cors"===o.mode&&l.setCrossOrigin("use-credentials"),"credentials"in o&&l.setWithCredentials("include"===o.credentials),o.headers&&l.setRequestHeader(o.headers);let c=e.gltfWorkingPath??this.workingPath;/[\\/]$/.test(c)||(c+="/");const u=this.adjustmentTransform;l.parse(r,c,(e=>{const r=t.getData("INSTANCES_LENGTH"),s=t.getData("POSITION",r,"FLOAT","VEC3"),o=t.getData("NORMAL_UP",r,"FLOAT","VEC3"),a=t.getData("NORMAL_RIGHT",r,"FLOAT","VEC3"),l=t.getData("SCALE_NON_UNIFORM",r,"FLOAT","VEC3"),c=t.getData("SCALE",r,"FLOAT","SCALAR"),h=t.getData("RTC_CENTER",1,"FLOAT","VEC3"),d=t.getData("EAST_NORTH_UP");["QUANTIZED_VOLUME_OFFSET","QUANTIZED_VOLUME_SCALE","POSITION_QUANTIZED","NORMAL_UP_OCT32P","NORMAL_RIGHT_OCT32P"].forEach((e=>{e in t.header&&console.warn(`I3DMLoader: Unsupported FeatureTable feature "${e}" detected.`)}));const p=new ne;for(let t=0;t<r;t++)p.x+=s[3*t+0]/r,p.y+=s[3*t+1]/r,p.z+=s[3*t+2]/r;const f=[],m=[];e.scene.updateMatrixWorld(),e.scene.traverse((e=>{if(e.isMesh){m.push(e);const{geometry:t,material:n}=e,i=new it(t,n,r);i.position.copy(p),h&&(i.position.x+=h[0],i.position.y+=h[1],i.position.z+=h[2]),f.push(i)}}));for(let t=0;t<r;t++){Ql.set(s[3*t+0]-p.x,s[3*t+1]-p.y,s[3*t+2]-p.z),Jl.identity(),o&&(Zl.set(o[3*t+0],o[3*t+1],o[3*t+2]),$l.set(a[3*t+0],a[3*t+1],a[3*t+2]),Yl.crossVectors($l,Zl).normalize(),tc.makeBasis($l,Zl,Yl),Jl.setFromRotationMatrix(tc)),ec.set(1,1,1),l&&ec.set(l[3*t+0],l[3*t+1],l[3*t+2]),c&&ec.multiplyScalar(c[t]);for(let e=0,n=f.length;e<n;e++){const n=f[e];sc.copy(Jl),d&&(n.updateMatrixWorld(),rc.copy(Ql).applyMatrix4(n.matrixWorld),this.ellipsoid.getPositionToCartographic(rc,oc),this.ellipsoid.getEastNorthUpFrame(oc.lat,oc.lon,ic),sc.setFromRotationMatrix(ic)),tc.compose(Ql,sc,ec).multiply(u);const r=m[e];nc.multiplyMatrices(tc,r.matrixWorld),n.setMatrixAt(t,nc)}}e.scene.clear(),e.scene.add(...f),e.batchTable=n,e.featureTable=t,e.scene.batchTable=n,e.scene.featureTable=t,i(e)}),s)}))}))}}class lc extends Ma{parse(e){const t=new DataView(e),n=Aa(t);console.assert("cmpt"===n,'CMPTLoader: The magic bytes equal "cmpt".');const r=t.getUint32(4,!0);console.assert(1===r,'CMPTLoader: The version listed in the header is "1".');const i=t.getUint32(8,!0);console.assert(i===e.byteLength,"CMPTLoader: The contents buffer length listed in the header matches the file.");const s=t.getUint32(12,!0),o=[];let a=16;for(let l=0;l<s;l++){const t=new DataView(e,a,12),n=Aa(t),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=new Uint8Array(e,a,i);o.push({type:n,buffer:s,version:r}),a+=i}return{version:r,tiles:o}}}class cc extends lc{constructor(e=rt){super(),this.manager=e,this.adjustmentTransform=new Ne,this.ellipsoid=ql.clone()}parse(e){const t=super.parse(e),{manager:n,ellipsoid:r,adjustmentTransform:i}=this,s=[];for(const o in t.tiles){const{type:e,buffer:a}=t.tiles[o];switch(e){case"b3dm":{const e=a.slice(),t=new Al(n);t.workingPath=this.workingPath,t.fetchOptions=this.fetchOptions,t.adjustmentTransform.copy(i);const r=t.parse(e.buffer);s.push(r);break}case"pnts":{const e=a.slice(),t=new Ll(n);t.workingPath=this.workingPath,t.fetchOptions=this.fetchOptions;const r=t.parse(e.buffer);s.push(r);break}case"i3dm":{const e=a.slice(),t=new ac(n);t.workingPath=this.workingPath,t.fetchOptions=this.fetchOptions,t.ellipsoid.copy(r),t.adjustmentTransform.copy(i);const o=t.parse(e.buffer);s.push(o);break}}}return Promise.all(s).then((e=>{const t=new Oe;return e.forEach((e=>{t.add(e.scene)})),{tiles:e,scene:t}}))}}const uc=new Ne;class hc extends Oe{constructor(e){super(),this.isTilesGroup=!0,this.name="TilesRenderer.TilesGroup",this.tilesRenderer=e,this.matrixWorldInverse=new Ne}raycast(e,t){return!this.tilesRenderer.optimizeRaycast||(this.tilesRenderer.raycast(e,t),!1)}updateMatrixWorld(e){if(this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldNeedsUpdate||e){null===this.parent?uc.copy(this.matrix):uc.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1;const e=uc.elements,t=this.matrixWorld.elements;let n=!1;for(let r=0;r<16;r++){const i=e[r],s=t[r];if(Math.abs(i-s)>Number.EPSILON){n=!0;break}}if(n){this.matrixWorld.copy(uc),this.matrixWorldInverse.copy(uc).invert();const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateMatrixWorld()}}}updateWorldMatrix(e,t){this.parent&&e&&this.parent.updateWorldMatrix(e,!1),this.updateMatrixWorld(!0)}}const dc=new Ve,pc=new ne,fc=[];function mc(e,t){return e.distance-t.distance}function gc(e,t,n,r){const{scene:i}=e.cached;n.invokeOnePlugin((n=>n.raycastTile&&n.raycastTile(e,i,t,r)))||t.intersectObject(i,!0,r)}function vc(e){return"__used"in e}function yc(e,t,n,r=null){const{group:i,activeTiles:s}=e;null===r&&(r=dc).copy(n.ray).applyMatrix4(i.matrixWorldInverse);const o=[],a=t.children;for(let u=0,h=a.length;u<h;u++){const e=a[u];vc(e)&&e.__used&&(null!==e.cached.boundingVolume.intersectRay(r,pc)&&(pc.applyMatrix4(i.matrixWorld),o.push({distance:pc.distanceToSquared(n.ray.origin),tile:e})))}o.sort(mc);let l=null,c=1/0;if(s.has(t)){const r=function(e,t,n){gc(e,t,n,fc),fc.sort(mc);const r=fc[0]||null;return fc.length=0,r}(t,n,e);r&&(l=r,c=r.distance*r.distance)}for(let u=0,h=o.length;u<h;u++){const t=o[u],i=t.distance,s=t.tile;if(i>c)break;const a=yc(e,s,n,r);if(a){const e=a.distance*a.distance;e<c&&(l=a,c=e)}}return l}function _c(e,t,n,r,i=null){if(!vc(t))return;const{group:s,activeTiles:o}=e,{boundingVolume:a}=t.cached;if(null===i&&(i=dc).copy(n.ray).applyMatrix4(s.matrixWorldInverse),!t.__used||!a.intersectsRay(i))return;o.has(t)&&gc(t,n,e,r);const l=t.children;for(let c=0,u=l.length;c<u;c++)_c(e,l[c],n,r,i)}const xc=new ne,bc=new ne,wc=new ne,Tc=new Ve;class Mc{constructor(e=new ht,t=new Ne){this.box=e.clone(),this.transform=t.clone(),this.inverseTransform=new Ne,this.points=new Array(8).fill().map((()=>new ne)),this.planes=new Array(6).fill().map((()=>new $e))}copy(e){return this.box.copy(e.box),this.transform.copy(e.transform),this.update(),this}clone(){return(new this.constructor).copy(this)}clampPoint(e,t){return t.copy(e).applyMatrix4(this.inverseTransform).clamp(this.box.min,this.box.max).applyMatrix4(this.transform)}distanceToPoint(e){return this.clampPoint(e,wc).distanceTo(e)}containsPoint(e){return wc.copy(e).applyMatrix4(this.inverseTransform),this.box.containsPoint(wc)}intersectsRay(e){return Tc.copy(e).applyMatrix4(this.inverseTransform),Tc.intersectsBox(this.box)}intersectRay(e,t){return Tc.copy(e).applyMatrix4(this.inverseTransform),Tc.intersectBox(this.box,t)?(t.applyMatrix4(this.transform),t):null}update(){const{points:e,inverseTransform:t,transform:n,box:r}=this;t.copy(n).invert();const{min:i,max:s}=r;let o=0;for(let a=-1;a<=1;a+=2)for(let t=-1;t<=1;t+=2)for(let r=-1;r<=1;r+=2)e[o].set(a<0?i.x:s.x,t<0?i.y:s.y,r<0?i.z:s.z).applyMatrix4(n),o++;this.updatePlanes()}updatePlanes(){xc.copy(this.box.min).applyMatrix4(this.transform),bc.copy(this.box.max).applyMatrix4(this.transform),wc.set(0,0,1).transformDirection(this.transform),this.planes[0].setFromNormalAndCoplanarPoint(wc,xc),this.planes[1].setFromNormalAndCoplanarPoint(wc,bc).negate(),wc.set(0,1,0).transformDirection(this.transform),this.planes[2].setFromNormalAndCoplanarPoint(wc,xc),this.planes[3].setFromNormalAndCoplanarPoint(wc,bc).negate(),wc.set(1,0,0).transformDirection(this.transform),this.planes[4].setFromNormalAndCoplanarPoint(wc,xc),this.planes[5].setFromNormalAndCoplanarPoint(wc,bc).negate()}intersectsSphere(e){return this.clampPoint(e.center,wc),wc.distanceToSquared(e.center)<=e.radius*e.radius}intersectsFrustum(e){return this._intersectsPlaneShape(e.planes,e.points)}intersectsOBB(e){return this._intersectsPlaneShape(e.planes,e.points)}_intersectsPlaneShape(e,t){const n=this.points,r=this.planes;for(let i=0;i<6;i++){const t=e[i];let r=-1/0;for(let e=0;e<8;e++){const i=n[e],s=t.distanceToPoint(i);r=r<s?s:r}if(r<0)return!1}for(let i=0;i<6;i++){const e=r[i];let n=-1/0;for(let r=0;r<8;r++){const i=t[r],s=e.distanceToPoint(i);n=n<s?s:n}if(n<0)return!1}return!0}}const Ac=Math.PI,Sc=Ac/2,Ec=new ne,Pc=new ne,Cc=new ne,Rc=new Ne;let Lc=0;const Ic=[];function Dc(e=!1){return e?(Ic[Lc]||(Ic[Lc]=new ne),Lc++,Ic[Lc-1]):new ne}function kc(){Lc=0}class Oc extends Kl{constructor(e,t,n,r=-Sc,i=Sc,s=0,o=2*Ac,a=0,l=0){super(e,t,n),this.latStart=r,this.latEnd=i,this.lonStart=s,this.lonEnd=o,this.heightStart=a,this.heightEnd=l}_getPoints(e=!1){const{latStart:t,latEnd:n,lonStart:r,lonEnd:i,heightStart:s,heightEnd:o}=this,a=Y.mapLinear(.5,0,1,t,n),l=Y.mapLinear(.5,0,1,r,i),c=Math.floor(r/Sc)*Sc,u=[[-Ac/2,0],[Ac/2,0],[0,c],[0,c+Ac/2],[0,c+Ac],[0,c+3*Ac/2],[t,i],[n,i],[t,r],[n,r],[0,r],[0,i],[a,l],[t,l],[n,l],[a,r],[a,i]],h=[],d=u.length;for(let p=0;p<=1;p++){const a=Y.mapLinear(p,0,1,s,o);for(let s=0,o=d;s<o;s++){const[o,l]=u[s];if(o>=t&&o<=n&&l>=r&&l<=i){const t=Dc(e);h.push(t),this.getCartographicToPosition(o,l,a,t)}}}return h}getBoundingBox(e,t){kc();const{latStart:n,latEnd:r,lonStart:i,lonEnd:s}=this;if(r-n<Ac/2){const e=Y.mapLinear(.5,0,1,n,r),o=Y.mapLinear(.5,0,1,i,s);this.getCartographicToNormal(e,o,Cc),Pc.set(0,0,1),Ec.crossVectors(Pc,Cc),Pc.crossVectors(Ec,Cc),t.makeBasis(Ec,Pc,Cc)}else Ec.set(1,0,0),Pc.set(0,1,0),Cc.set(0,0,1),t.makeBasis(Ec,Pc,Cc);Rc.copy(t).invert();const o=this._getPoints(!0);for(let a=0,l=o.length;a<l;a++)o[a].applyMatrix4(Rc);e.makeEmpty(),e.setFromPoints(o)}getBoundingSphere(e,t){kc();const n=this._getPoints(!0);e.makeEmpty(),e.setFromPoints(n,t)}}const Fc=new ne,Uc=new ne,Bc=new ne,zc=new ne,Nc=new ne;class jc{constructor(){this.sphere=null,this.obb=null,this.region=null,this.regionObb=null}intersectsRay(e){const t=this.sphere,n=this.obb||this.regionObb;return!(t&&!e.intersectsSphere(t)||n&&!n.intersectsRay(e))}intersectRay(e,t=null){const n=this.sphere,r=this.obb||this.regionObb;let i=-1/0,s=-1/0;n&&e.intersectSphere(n,zc)&&(i=n.containsPoint(e.origin)?0:e.origin.distanceToSquared(zc)),r&&r.intersectRay(e,Nc)&&(s=r.containsPoint(e.origin)?0:e.origin.distanceToSquared(Nc));const o=Math.max(i,s);return o===-1/0?null:(e.at(Math.sqrt(o),t),t)}distanceToPoint(e){const t=this.sphere,n=this.obb||this.regionObb;let r=-1/0,i=-1/0;return t&&(r=Math.max(t.distanceToPoint(e),0)),n&&(i=n.distanceToPoint(e)),r>i?r:i}intersectsFrustum(e){const t=this.obb||this.regionObb,n=this.sphere;return!(n&&!e.intersectsSphere(n)||t&&!t.intersectsFrustum(e))&&!(!n&&!t)}intersectsSphere(e){const t=this.obb||this.regionObb,n=this.sphere;return!(n&&!n.intersectsSphere(e)||t&&!t.intersectsSphere(e))&&!(!n&&!t)}intersectsOBB(e){const t=this.obb||this.regionObb,n=this.sphere;return!(n&&!e.intersectsSphere(n)||t&&!t.intersectsOBB(e))&&!(!n&&!t)}getOBB(e,t){const n=this.obb||this.regionObb;n?(e.copy(n.box),t.copy(n.transform)):(this.getAABB(e),t.identity())}getAABB(e){if(this.sphere)this.sphere.getBoundingBox(e);else{const t=this.obb||this.regionObb;e.copy(t.box).applyMatrix4(t.transform)}}getSphere(e){if(this.sphere)e.copy(this.sphere);else if(this.region)this.region.getBoundingSphere(e);else{const t=this.obb||this.regionObb;t.box.getBoundingSphere(e),e.applyMatrix4(t.transform)}}setObbData(e,t){const n=new Mc;Fc.set(e[3],e[4],e[5]),Uc.set(e[6],e[7],e[8]),Bc.set(e[9],e[10],e[11]);const r=Fc.length(),i=Uc.length(),s=Bc.length();Fc.normalize(),Uc.normalize(),Bc.normalize(),0===r&&Fc.crossVectors(Uc,Bc),0===i&&Uc.crossVectors(Fc,Bc),0===s&&Bc.crossVectors(Fc,Uc),n.transform.set(Fc.x,Uc.x,Bc.x,e[0],Fc.y,Uc.y,Bc.y,e[1],Fc.z,Uc.z,Bc.z,e[2],0,0,0,1).premultiply(t),n.box.min.set(-r,-i,-s),n.box.max.set(r,i,s),n.update(),this.obb=n}setSphereData(e,t,n,r,i){const s=new qe;s.center.set(e,t,n),s.radius=r,s.applyMatrix4(i),this.sphere=s}setRegionData(e,t,n,r,i,s,o){const a=new Oc(...e.radius,n,i,t,r,s,o),l=new Mc;a.getBoundingBox(l.box,l.transform),l.update(),this.region=a,this.regionObb=l}}const Hc=new ut;class Gc extends Je{constructor(){super(),this.points=Array(8).fill().map((()=>new ne))}setFromProjectionMatrix(e,t){return super.setFromProjectionMatrix(e,t),this.calculateFrustumPoints(),this}calculateFrustumPoints(){const{planes:e,points:t}=this;[[e[0],e[3],e[4]],[e[1],e[3],e[4]],[e[0],e[2],e[4]],[e[1],e[2],e[4]],[e[0],e[3],e[5]],[e[1],e[3],e[5]],[e[0],e[2],e[5]],[e[1],e[2],e[5]]].forEach(((e,n)=>{!function(e,t,n,r){const i=Hc.set(e.normal.x,e.normal.y,e.normal.z,t.normal.x,t.normal.y,t.normal.z,n.normal.x,n.normal.y,n.normal.z);r.set(-e.constant,-t.constant,-n.constant),r.applyMatrix3(i.invert())}(e[0],e[1],e[2],t[n])}))}}const Vc=new Ne,Wc=new ze,Xc=Symbol("INITIAL_FRUSTUM_CULLED"),Kc=new Ne,qc=new ne,Yc=new te,Zc={inView:!1,error:1/0},$c=new ne(1,0,0),Qc=new ne(0,1,0);function Jc(e,t){e.traverse((e=>{e.frustumCulled=e[Xc]&&t}))}class eu extends va{get autoDisableRendererCulling(){return this._autoDisableRendererCulling}set autoDisableRendererCulling(e){this._autoDisableRendererCulling!==e&&(super._autoDisableRendererCulling=e,this.forEachLoadedModel((t=>{Jc(t,!e)})))}get optimizeRaycast(){return this._optimizeRaycast}set optimizeRaycast(e){console.warn('TilesRenderer: The "optimizeRaycast" option has been deprecated.'),this._optimizeRaycast=e}constructor(...e){super(...e),this.group=new hc(this),this.ellipsoid=ql.clone(),this.cameras=[],this.cameraMap=new Map,this.cameraInfo=[],this._optimizeRaycast=!0,this._upRotationMatrix=new Ne,this.lruCache.computeMemoryUsageCallback=e=>e.cached.bytesUsed??null,this._autoDisableRendererCulling=!0;const t=new Ke;t.setURLModifier((e=>this.preprocessURL?this.preprocessURL(e):e)),this.manager=t,this._listeners={}}addEventListener(...e){Se.prototype.addEventListener.call(this,...e)}hasEventListener(...e){Se.prototype.hasEventListener.call(this,...e)}removeEventListener(...e){Se.prototype.removeEventListener.call(this,...e)}dispatchEvent(...e){Se.prototype.dispatchEvent.call(this,...e)}getBoundingBox(e){if(!this.root)return!1;const t=this.root.cached.boundingVolume;return!!t&&(t.getAABB(e),!0)}getOrientedBoundingBox(e,t){if(!this.root)return!1;const n=this.root.cached.boundingVolume;return!!n&&(n.getOBB(e,t),!0)}getBoundingSphere(e){if(!this.root)return!1;const t=this.root.cached.boundingVolume;return!!t&&(t.getSphere(e),!0)}forEachLoadedModel(e){this.traverse((t=>{const n=t.cached&&t.cached.scene;n&&e(n,t)}),null,!1)}raycast(e,t){if(this.root)if(e.firstHitOnly){const n=yc(this,this.root,e);n&&t.push(n)}else _c(this,this.root,e,t)}hasCamera(e){return this.cameraMap.has(e)}setCamera(e){const t=this.cameras,n=this.cameraMap;return!n.has(e)&&(n.set(e,new te),t.push(e),this.dispatchEvent({type:"add-camera",camera:e}),!0)}setResolution(e,t,n){const r=this.cameraMap;if(!r.has(e))return!1;const i=t.isVector2?t.x:t,s=t.isVector2?t.y:n,o=r.get(e);return(o.width!==i||o.height!==s)&&(o.set(i,s),this.dispatchEvent({type:"camera-resolution-change"})),!0}setResolutionFromRenderer(e,t){return t.getSize(Yc),this.setResolution(e,Yc.x,Yc.y)}deleteCamera(e){const t=this.cameras,n=this.cameraMap;if(n.has(e)){const r=t.indexOf(e);return t.splice(r,1),n.delete(e),this.dispatchEvent({type:"delete-camera",camera:e}),!0}return!1}loadRootTileSet(...e){return super.loadRootTileSet(...e).then((e=>{const{asset:t,extensions:n={}}=e;switch((t&&t.gltfUpAxis||"y").toLowerCase()){case"x":this._upRotationMatrix.makeRotationAxis(Qc,-Math.PI/2);break;case"y":this._upRotationMatrix.makeRotationAxis($c,Math.PI/2)}if("3DTILES_ellipsoid"in n){const e=n["3DTILES_ellipsoid"],{ellipsoid:t}=this;t.name=e.body,e.radii?t.radius.set(...e.radii):t.radius.set(1,1,1)}return e}))}update(){let e=null;if(this.invokeAllPlugins((t=>{if(t.doTilesNeedUpdate){const n=t.doTilesNeedUpdate();e=null===e?n:!(!e&&!n)}})),!1===e)return this.dispatchEvent({type:"update-before"}),void this.dispatchEvent({type:"update-after"});this.dispatchEvent({type:"update-before"});const t=this.group,n=this.cameras,r=this.cameraMap,i=this.cameraInfo;for(;i.length>n.length;)i.pop();for(;i.length<n.length;)i.push({frustum:new Gc,isOrthographic:!1,sseDenominator:-1,position:new ne,invScale:-1,pixelSize:0});qc.setFromMatrixScale(t.matrixWorldInverse),Math.abs(Math.max(qc.x-qc.y,qc.x-qc.z))>1e-6&&console.warn("ThreeTilesRenderer : Non uniform scale used for tile which may cause issues when calculating screen space error.");for(let s=0,o=i.length;s<o;s++){const e=n[s],o=i[s],a=o.frustum,l=o.position,c=r.get(e);(0===c.width||0===c.height)&&console.warn("TilesRenderer: resolution for camera error calculation is not set.");const u=e.projectionMatrix.elements;if(o.isOrthographic=1===u[15],o.isOrthographic){const e=2/u[0],t=2/u[5];o.pixelSize=Math.max(t/c.height,e/c.width)}else o.sseDenominator=2/u[5]/c.height;Kc.copy(t.matrixWorld),Kc.premultiply(e.matrixWorldInverse),Kc.premultiply(e.projectionMatrix),a.setFromProjectionMatrix(Kc),l.set(0,0,0),l.applyMatrix4(e.matrixWorld),l.applyMatrix4(t.matrixWorldInverse)}if(super.update(),this.dispatchEvent({type:"update-after"}),0===n.length&&this.root){let e=!1;this.invokeAllPlugins((t=>e=e||!(t===this||!t.calculateTileViewError))),!1===e&&console.warn("TilesRenderer: no cameras defined. Cannot update 3d tiles.")}}preprocessNode(e,t,n=null){super.preprocessNode(e,t,n);const r=new Ne;if(e.transform){const t=e.transform;for(let e=0;e<16;e++)r.elements[e]=t[e]}n&&r.premultiply(n.cached.transform);const i=(new Ne).copy(r).invert(),s=new jc;"sphere"in e.boundingVolume&&s.setSphereData(...e.boundingVolume.sphere,r),"box"in e.boundingVolume&&s.setObbData(e.boundingVolume.box,r),"region"in e.boundingVolume&&s.setRegionData(this.ellipsoid,...e.boundingVolume.region),e.cached={transform:r,transformInverse:i,active:!1,boundingVolume:s,metadata:null,scene:null,geometry:null,materials:null,textures:null}}async parseTile(e,t,n,r,i){const s=t.cached,o=r.split(/[\\/]/g);o.pop();const a=o.join("/"),l=this.fetchOptions,c=this.manager;let u=null;const h=s.transform,d=this._upRotationMatrix,p=(Aa(e)||n).toLowerCase();switch(p){case"b3dm":{const t=new Al(c);t.workingPath=a,t.fetchOptions=l,t.adjustmentTransform.copy(d),u=t.parse(e);break}case"pnts":{const t=new Ll(c);t.workingPath=a,t.fetchOptions=l,u=t.parse(e);break}case"i3dm":{const t=new ac(c);t.workingPath=a,t.fetchOptions=l,t.adjustmentTransform.copy(d),t.ellipsoid.copy(this.ellipsoid),u=t.parse(e);break}case"cmpt":{const t=new cc(c);t.workingPath=a,t.fetchOptions=l,t.adjustmentTransform.copy(d),t.ellipsoid.copy(this.ellipsoid),u=t.parse(e).then((e=>e.scene));break}case"gltf":case"glb":{const t=c.getHandler("path.gltf")||c.getHandler("path.glb")||new Pa(c);t.setWithCredentials("include"===l.credentials),t.setRequestHeader(l.headers||{}),"include"===l.credentials&&"cors"===l.mode&&t.setCrossOrigin("use-credentials");let n=t.resourcePath||t.path||a;!/[\\/]$/.test(n)&&n.length&&(n+="/"),u=t.parseAsync(e,n).then((e=>{e.scene=e.scene||new Oe;const{scene:t}=e;return t.updateMatrix(),t.matrix.multiply(d).decompose(t.position,t.quaternion,t.scale),e}));break}default:u=this.invokeOnePlugin((s=>s.parseToMesh&&s.parseToMesh(e,t,n,r,i)))}const f=await u;if(null===f)throw new Error(`TilesRenderer: Content type "${p}" not supported.`);let m,g;f.isObject3D?(m=f,g=null):(m=f.scene,g=f),await this.invokeAllPlugins((e=>e.processTileModel&&e.processTileModel(m,t))),m.updateMatrix(),m.matrix.premultiply(h),m.matrix.decompose(m.position,m.quaternion,m.scale),m.traverse((e=>{e[Xc]=e.frustumCulled})),Jc(m,!this.autoDisableRendererCulling);const v=[],y=[],_=[];if(m.traverse((e=>{if(e.geometry&&y.push(e.geometry),e.material){const t=e.material;v.push(e.material);for(const e in t){const n=t[e];n&&n.isTexture&&_.push(n)}}})),i.aborted)for(let x=0,b=_.length;x<b;x++){const e=_[x];e.image instanceof ImageBitmap&&e.image.close(),e.dispose()}else s.materials=v,s.geometry=y,s.textures=_,s.scene=m,s.metadata=g,s.bytesUsed=function(e){const{TextureUtils:t}=re;if(!t)return 0;const n=new Set;let r=0;return e.traverse((e=>{if(e.geometry&&!n.has(e.geometry)&&(r+=function(e){let t=0;for(const r in e.attributes){const n=e.getAttribute(r);t+=n.count*n.itemSize*n.array.BYTES_PER_ELEMENT}const n=e.getIndex();return t+=n?n.count*n.itemSize*n.array.BYTES_PER_ELEMENT:0,t}(e.geometry),n.add(e.geometry)),e.material){const i=e.material;for(const e in i){const s=i[e];if(s&&s.isTexture&&!n.has(s)){const{format:e,type:i,image:o}=s,{width:a,height:l}=o,c=t.getByteLength(a,l,e,i);r+=s.generateMipmaps?4*c/3:c,n.add(s)}}}})),r}(m)}disposeTile(e){super.disposeTile(e);const t=e.cached;if(t.scene){const n=t.materials,r=t.geometry,i=t.textures,s=t.scene.parent;t.scene.traverse((e=>{e.userData.meshFeatures&&e.userData.meshFeatures.dispose(),e.userData.structuralMetadata&&e.userData.structuralMetadata.dispose()}));for(let e=0,t=r.length;e<t;e++)r[e].dispose();for(let e=0,t=n.length;e<t;e++)n[e].dispose();for(let e=0,t=i.length;e<t;e++){const t=i[e];t.image instanceof ImageBitmap&&t.image.close(),t.dispose()}s&&s.remove(t.scene),this.dispatchEvent({type:"dispose-model",scene:t.scene,tile:e}),t.scene=null,t.materials=null,t.textures=null,t.geometry=null,t.metadata=null}}setTileVisible(e,t){const n=e.cached.scene,r=this.group;t?n&&(r.add(n),n.updateMatrixWorld(!0)):n&&r.remove(n),super.setTileVisible(e,t),this.dispatchEvent({type:"tile-visibility-change",scene:n,tile:e,visible:t})}calculateTileViewError(e,t){const n=e.cached,r=this.cameras,i=this.cameraInfo,s=n.boundingVolume;let o=!1,a=-1/0,l=1/0,c=-1/0,u=1/0;for(let h=0,d=r.length;h<d;h++){const t=i[h];let n,r;if(t.isOrthographic){const i=t.pixelSize;n=e.geometricError/i,r=1/0}else{const i=t.sseDenominator;r=s.distanceToPoint(t.position),n=e.geometricError/(r*i)}const d=i[h].frustum;s.intersectsFrustum(d)&&(o=!0,a=Math.max(a,n),l=Math.min(l,r)),c=Math.max(c,n),u=Math.min(u,r)}this.invokeAllPlugins((t=>{t!==this&&t.calculateTileViewError&&(t.calculateTileViewError(e,Zc),Zc.inView&&(o=!0,a=Math.max(a,Zc.error)),c=Math.max(c,Zc.error))})),o?(t.inView=!0,t.error=a,t.distanceFromCamera=l):(t.inView=!1,t.error=c,t.distanceFromCamera=u)}setLatLonToYUp(e,t){console.warn("TilesRenderer: setLatLonToYUp is deprecated. Use the ReorientationPlugin, instead.");const{ellipsoid:n,group:r}=this;Wc.set(Math.PI/2,Math.PI/2,0),Vc.makeRotationFromEuler(Wc),n.getEastNorthUpFrame(e,t,0,r.matrix).multiply(Vc).invert().decompose(r.position,r.quaternion,r.scale),r.updateMatrixWorld(!0)}dispose(){super.dispose(),this.group.removeFromParent()}}class tu extends oe{constructor(){super(new lt(0,0),new nu),this.renderOrder=1/0}onBeforeRender(e){const t=this.material.uniforms;e.getSize(t.resolution.value)}updateMatrixWorld(){this.matrixWorld.makeTranslation(this.position)}dispose(){this.geometry.dispose(),this.material.dispose()}}class nu extends ge{constructor(){super({depthWrite:!1,depthTest:!1,transparent:!0,uniforms:{resolution:{value:new te},size:{value:15},thickness:{value:2},opacity:{value:1}},vertexShader:"\n\n\t\t\t\tuniform float pixelRatio;\n\t\t\t\tuniform float size;\n\t\t\t\tuniform float thickness;\n\t\t\t\tuniform vec2 resolution;\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvUv = uv;\n\n\t\t\t\t\tfloat aspect = resolution.x / resolution.y;\n\t\t\t\t\tvec2 offset = uv * 2.0 - vec2( 1.0 );\n\t\t\t\t\toffset.y *= aspect;\n\n\t\t\t\t\tvec4 screenPoint = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t\tscreenPoint.xy += offset * ( size + thickness ) * screenPoint.w / resolution.x;\n\n\t\t\t\t\tgl_Position = screenPoint;\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform float size;\n\t\t\t\tuniform float thickness;\n\t\t\t\tuniform float opacity;\n\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tfloat ht = 0.5 * thickness;\n\t\t\t\t\tfloat planeDim = size + thickness;\n\t\t\t\t\tfloat offset = ( planeDim - ht - 2.0 ) / planeDim;\n\t\t\t\t\tfloat texelThickness = ht / planeDim;\n\n\t\t\t\t\tvec2 vec = vUv * 2.0 - vec2( 1.0 );\n\t\t\t\t\tfloat dist = abs( length( vec ) - offset );\n\t\t\t\t\tfloat fw = fwidth( dist ) * 0.5;\n\t\t\t\t\tfloat a = smoothstep( texelThickness - fw, texelThickness + fw, dist );\n\n\t\t\t\t\tgl_FragColor = vec4( 1, 1, 1, opacity * ( 1.0 - a ) );\n\n\t\t\t\t}\n\t\t\t"})}}const ru=new te,iu=new te;class su{constructor(){this.domElement=null,this.buttons=0,this.pointerType=null,this.pointerOrder=[],this.previousPositions={},this.pointerPositions={},this.startPositions={},this.pointerSetThisFrame={},this.hoverPosition=new te,this.hoverSet=!1}reset(){this.buttons=0,this.pointerType=null,this.pointerOrder=[],this.previousPositions={},this.pointerPositions={},this.startPositions={},this.pointerSetThisFrame={},this.hoverPosition=new te,this.hoverSet=!1}updateFrame(){const{previousPositions:e,pointerPositions:t}=this;for(const n in t)e[n].copy(t[n])}setHoverEvent(e){("mouse"===e.pointerType||"wheel"===e.type)&&(this.getAdjustedPointer(e,this.hoverPosition),this.hoverSet=!0)}getLatestPoint(e){return null!==this.pointerType?(this.getCenterPoint(e),e):this.hoverSet?(e.copy(this.hoverPosition),e):null}getAdjustedPointer(e,t){const n=(this.domElement?this.domElement:e.target).getBoundingClientRect(),r=e.clientX-n.left,i=e.clientY-n.top;t.set(r,i)}addPointer(e){const t=e.pointerId,n=new te;this.getAdjustedPointer(e,n),this.pointerOrder.push(t),this.pointerPositions[t]=n,this.previousPositions[t]=n.clone(),this.startPositions[t]=n.clone(),1===this.getPointerCount()&&(this.pointerType=e.pointerType,this.buttons=e.buttons)}updatePointer(e){const t=e.pointerId;return t in this.pointerPositions&&(this.getAdjustedPointer(e,this.pointerPositions[t]),!0)}deletePointer(e){const t=e.pointerId,n=this.pointerOrder;n.splice(n.indexOf(t),1),delete this.pointerPositions[t],delete this.previousPositions[t],delete this.startPositions[t],0===this.getPointerCount.length&&(this.buttons=0,this.pointerType=null)}getPointerCount(){return this.pointerOrder.length}getCenterPoint(e,t=this.pointerPositions){const n=this.pointerOrder;if(1===this.getPointerCount()||"mouse"===this.getPointerType()){const r=n[0];return e.copy(t[r]),e}if(2===this.getPointerCount()){const n=this.pointerOrder[0],r=this.pointerOrder[1],i=t[n],s=t[r];return e.addVectors(i,s).multiplyScalar(.5),e}return null}getPreviousCenterPoint(e){return this.getCenterPoint(e,this.previousPositions)}getStartCenterPoint(e){return this.getCenterPoint(e,this.startPositions)}getMoveDistance(){return this.getCenterPoint(ru),this.getPreviousCenterPoint(iu),ru.sub(iu).length()}getTouchPointerDistance(e=this.pointerPositions){if(this.getPointerCount()<=1||"mouse"===this.getPointerType())return 0;const{pointerOrder:t}=this,n=t[0],r=t[1],i=e[n],s=e[r];return i.distanceTo(s)}getPreviousTouchPointerDistance(){return this.getTouchPointerDistance(this.previousPositions)}getStartTouchPointerDistance(){return this.getTouchPointerDistance(this.startPositions)}getPointerType(){return this.pointerType}isPointerTouch(){return"touch"===this.getPointerType()}getPointerButtons(){return this.buttons}isLeftClicked(){return!!(1&this.buttons)}isRightClicked(){return!!(2&this.buttons)}}const ou=new Ne,au=new Ve,lu=new ne;function cu(e,t,n){return n.makeTranslation(-e.x,-e.y,-e.z),ou.makeRotationFromQuaternion(t),n.premultiply(ou),ou.makeTranslation(e.x,e.y,e.z),n.premultiply(ou),n}function uu(e,t,n,r){r.x=(e-n.offsetLeft)/n.clientWidth*2-1,r.y=-(t-n.offsetTop)/n.clientHeight*2+1,r.isVector3&&(r.z=0)}function hu(e,t,n){return t.intersectRay(e,n)?n:(ou.makeScale(...t.radius).invert(),au.copy(e).applyMatrix4(ou),lu.set(0,0,0),au.closestPointToPoint(lu,n).normalize(),ou.makeScale(...t.radius),n.applyMatrix4(ou))}function du(e,t,n){const r=e instanceof Ve?e:e.ray,{origin:i,direction:s}=r;i.set(t.x,t.y,-1).unproject(n),s.set(t.x,t.y,1).unproject(n).sub(i),e.isRay||(e.near=0,e.far=s.length(),e.camera=n),s.normalize()}const pu=.05,fu=.025,mu=new Ne,gu=new Ne,vu=new ne,yu=new ne,_u=new ne,xu=new ne,bu=new ne,wu=new ne,Tu=new ne,Mu=new ne,Au=new Ge,Su=new $e,Eu=new ne,Pu=new ne,Cu=new ne,Ru=new Ge,Lu=new Ve,Iu=new te,Du=new te,ku=new te,Ou=new te,Fu=new te,Uu=new te,Bu={type:"change"},zu={type:"start"},Nu={type:"end"};class ju extends Se{get enabled(){return this._enabled}set enabled(e){e!==this.enabled&&(this._enabled=e,this.resetState(),this.pointerTracker.reset(),this.enabled||(this.dragInertia.set(0,0,0),this.rotationInertia.set(0,0)))}constructor(e=null,t=null,n=null,r=null){super(),this.isEnvironmentControls=!0,this.domElement=null,this.camera=null,this.scene=null,this.tilesRenderer=null,this._enabled=!0,this.cameraRadius=5,this.rotationSpeed=1,this.minAltitude=0,this.maxAltitude=.45*Math.PI,this.minDistance=10,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.zoomSpeed=1,this.adjustHeight=!0,this.enableDamping=!1,this.dampingFactor=.15,this.fallbackPlane=new $e(new ne(0,1,0),0),this.useFallbackPlane=!0,this.scaleZoomOrientationAtEdges=!1,this.autoAdjustCameraRotation=!0,this.state=0,this.pointerTracker=new su,this.needsUpdate=!1,this.actionHeightOffset=0,this.pivotPoint=new ne,this.zoomDirectionSet=!1,this.zoomPointSet=!1,this.zoomDirection=new ne,this.zoomPoint=new ne,this.zoomDelta=0,this.rotationInertiaPivot=new ne,this.rotationInertia=new te,this.dragInertia=new ne,this.inertiaTargetDistance=1/0,this.inertiaStableFrames=0,this.pivotMesh=new tu,this.pivotMesh.raycast=()=>{},this.pivotMesh.scale.setScalar(.25),this.raycaster=new H,this.raycaster.firstHitOnly=!0,this.up=new ne(0,1,0),this.clock=new z,this._detachCallback=null,this._upInitialized=!1,this._lastUsedState=0,this._zoomPointWasSet=!1,this._tilesOnChangeCallback=()=>this.zoomPointSet=!1,n&&this.attach(n),t&&this.setCamera(t),e&&this.setScene(e),r&&this.setTilesRenderer(r)}setScene(e){this.scene=e}setCamera(e){this.camera=e,this._upInitialized=!1,this.zoomDirectionSet=!1,this.zoomPointSet=!1,this.needsUpdate=!0,this.raycaster.camera=e,this.resetState()}setTilesRenderer(e){console.warn('EnvironmentControls: "setTilesRenderer" has been deprecated. Use "setScene" and "setEllipsoid", instead.'),this.tilesRenderer=e,null!==this.tilesRenderer&&this.setScene(this.tilesRenderer.group)}attach(e){if(this.domElement)throw new Error("EnvironmentControls: Controls already attached to element");this.domElement=e,this.pointerTracker.domElement=e,e.style.touchAction="none";const t=e=>{this.enabled&&e.preventDefault()},n=e=>{if(!this.enabled)return;e.preventDefault();const{camera:t,raycaster:n,domElement:r,up:i,pivotMesh:s,pointerTracker:o,scene:a,pivotPoint:l,enabled:c}=this;if(o.addPointer(e),this.needsUpdate=!0,o.isPointerTouch())if(s.visible=!1,0===o.getPointerCount())r.setPointerCapture(e.pointerId);else if(o.getPointerCount()>2)return void this.resetState();o.getCenterPoint(Du),uu(Du.x,Du.y,r,Du),du(n,Du,t);const u=Math.abs(n.ray.direction.dot(i));if(u<pu||u<fu)return;const h=this._raycast(n);h&&(2===o.getPointerCount()||o.isRightClicked()||o.isLeftClicked()&&e.shiftKey?(this.setState(o.isPointerTouch()?4:2),l.copy(h.point),s.position.copy(h.point),s.visible=!o.isPointerTouch()&&c,s.updateMatrixWorld(),a.add(s)):o.isLeftClicked()&&(this.setState(1),l.copy(h.point),s.position.copy(h.point),s.updateMatrixWorld(),a.add(s)))};let r=!1;const i=e=>{if(!this.enabled)return;e.preventDefault();const{pivotMesh:t,enabled:n}=this;this.zoomDirectionSet=!1,this.zoomPointSet=!1,0!==this.state&&(this.needsUpdate=!0);const{pointerTracker:i}=this;i.setHoverEvent(e),i.updatePointer(e)&&(i.isPointerTouch()&&2===i.getPointerCount()&&(r||(r=!0,queueMicrotask((()=>{r=!1,i.getCenterPoint(Fu);const e=i.getStartTouchPointerDistance(),s=i.getTouchPointerDistance(),o=s-e;if(0===this.state||4===this.state){i.getCenterPoint(Fu),i.getStartCenterPoint(Uu);const e=2*window.devicePixelRatio,t=Fu.distanceTo(Uu);(Math.abs(o)>e||t>e)&&(Math.abs(o)>t?(this.setState(3),this.zoomDirectionSet=!1):this.setState(2))}if(3===this.state){const e=i.getPreviousTouchPointerDistance();this.zoomDelta+=s-e,t.visible=!1}else 2===this.state&&(t.visible=n)})))),this.dispatchEvent(Bu))},s=t=>{if(!this.enabled)return;const{pointerTracker:n}=this;n.deletePointer(t),"touch"===n.getPointerType()&&0===n.getPointerCount()&&e.releasePointerCapture(t.pointerId),this.resetState(),this.needsUpdate=!0},o=e=>{if(!this.enabled)return;e.preventDefault();const{pointerTracker:t}=this;let n;switch(t.setHoverEvent(e),t.updatePointer(e),this.dispatchEvent(zu),e.deltaMode){case 2:n=800*e.deltaY;break;case 1:n=40*e.deltaY;break;case 0:n=e.deltaY}const r=Math.sign(n),i=Math.abs(n);this.zoomDelta-=.25*r*i,this.needsUpdate=!0,this._lastUsedState=3,this.dispatchEvent(Nu)},a=e=>{if(!this.enabled)return;const{pointerTracker:t}=this;e.buttons!==t.getPointerButtons()&&(t.deletePointer(e),this.resetState())};e.addEventListener("contextmenu",t),e.addEventListener("pointerdown",n),e.addEventListener("pointermove",i),e.addEventListener("pointerup",s),e.addEventListener("wheel",o,{passive:!1}),e.addEventListener("pointerenter",a),this._detachCallback=()=>{e.removeEventListener("contextmenu",t),e.removeEventListener("pointerdown",n),e.removeEventListener("pointermove",i),e.removeEventListener("pointerup",s),e.removeEventListener("wheel",o),e.removeEventListener("pointerenter",a)}}detach(){this.domElement=null,this._detachCallback&&(this._detachCallback(),this._detachCallback=null,this.pointerTracker.reset())}getUpDirection(e,t){t.copy(this.up)}getCameraUpDirection(e){this.getUpDirection(this.camera.position,e)}getPivotPoint(e){let t=null;3===this._lastUsedState?this._zoomPointWasSet&&(t=e.copy(this.zoomPoint)):(2===this._lastUsedState||1===this._lastUsedState)&&(t=e.copy(this.pivotPoint));const{camera:n,raycaster:r}=this;null!==t&&(yu.copy(t).project(n),(yu.x<-1||yu.x>1||yu.y<-1||yu.y>1)&&(t=null)),du(r,{x:0,y:0},n);const i=this._raycast(r);return i&&(null===t||i.distance<t.distanceTo(r.ray.origin))&&(t=e.copy(i.point)),t}resetState(){0!==this.state&&this.dispatchEvent(Nu),this.state=0,this.pivotMesh.removeFromParent(),this.pivotMesh.visible=this.enabled,this.actionHeightOffset=0}setState(e=this.state,t=!0){this.state!==e&&(0===this.state&&t&&this.dispatchEvent(zu),this.pivotMesh.visible=this.enabled,this.dragInertia.set(0,0,0),this.rotationInertia.set(0,0),this.inertiaStableFrames=0,this.state=e,0!==e&&4!==e&&(this._lastUsedState=e))}update(e=Math.min(this.clock.getDelta(),.064)){if(!this.enabled||!this.camera||0===e)return;const{camera:t,cameraRadius:n,pivotPoint:r,up:i,state:s,adjustHeight:o,autoAdjustCameraRotation:a}=this;t.updateMatrixWorld(),this.getCameraUpDirection(Eu),this._upInitialized||(this._upInitialized=!0,this.up.copy(Eu)),this.zoomPointSet=!1;const l=this._inertiaNeedsUpdate(),c=this.needsUpdate||l;if(this.needsUpdate||l){const n=this.zoomDelta;this._updateZoom(),this._updatePosition(e),this._updateRotation(e),1===s||2===s?(bu.set(0,0,-1).transformDirection(t.matrixWorld),this.inertiaTargetDistance=yu.copy(r).sub(t.position).dot(bu)):0===s&&this._updateInertia(e),(0!==s||0!==n||l)&&this.dispatchEvent(Bu),this.needsUpdate=!1}const u=t.isOrthographicCamera?null:o&&this._getPointBelowCamera()||null;if(this.getCameraUpDirection(Eu),this._setFrame(Eu),(1===this.state||2===this.state)&&0!==this.actionHeightOffset){const{actionHeightOffset:e}=this;t.position.addScaledVector(i,-e),r.addScaledVector(i,-e),u&&(u.distance-=e)}if(this.actionHeightOffset=0,u){const e=u.distance;if(e<n){const s=n-e;t.position.addScaledVector(i,s),r.addScaledVector(i,s),this.actionHeightOffset=s}}this.pointerTracker.updateFrame(),c&&a&&(this.getCameraUpDirection(Eu),this._alignCameraUp(Eu,1),this.getCameraUpDirection(Eu),this._clampRotation(Eu))}adjustCamera(e){const{adjustHeight:t,cameraRadius:n}=this;if(e.isPerspectiveCamera){this.getUpDirection(e.position,Eu);const r=t&&this._getPointBelowCamera(e.position,Eu)||null;if(r){const t=r.distance;t<n&&e.position.addScaledVector(Eu,n-t)}}}dispose(){this.detach()}_updateInertia(e){const{rotationInertia:t,pivotPoint:n,dragInertia:r,enableDamping:i,dampingFactor:s,camera:o,cameraRadius:a,minDistance:l,inertiaTargetDistance:c}=this;if(!this.enableDamping||this.inertiaStableFrames>1)return r.set(0,0,0),void t.set(0,0,0);const u=Math.pow(2,-e/s),h=Math.max(o.near,a,l,c),d=25e-5;if(t.lengthSq()>0){du(Lu,yu.set(0,0,-1),o),Lu.applyMatrix4(o.matrixWorldInverse),Lu.direction.normalize(),Lu.recast(-Lu.direction.dot(Lu.origin)).at(h/Lu.direction.z,yu),yu.applyMatrix4(o.matrixWorld),du(Lu,vu.set(d,d,-1),o),Lu.applyMatrix4(o.matrixWorldInverse),Lu.direction.normalize(),Lu.recast(-Lu.direction.dot(Lu.origin)).at(h/Lu.direction.z,vu),vu.applyMatrix4(o.matrixWorld),yu.sub(n).normalize(),vu.sub(n).normalize();const r=yu.angleTo(vu)/e;t.multiplyScalar(u),(t.lengthSq()<r**2||!i)&&t.set(0,0)}if(r.lengthSq()>0){du(Lu,yu.set(0,0,-1),o),Lu.applyMatrix4(o.matrixWorldInverse),Lu.direction.normalize(),Lu.recast(-Lu.direction.dot(Lu.origin)).at(h/Lu.direction.z,yu),yu.applyMatrix4(o.matrixWorld),du(Lu,vu.set(d,d,-1),o),Lu.applyMatrix4(o.matrixWorldInverse),Lu.direction.normalize(),Lu.recast(-Lu.direction.dot(Lu.origin)).at(h/Lu.direction.z,vu),vu.applyMatrix4(o.matrixWorld);const t=yu.distanceTo(vu)/e;r.multiplyScalar(u),(r.lengthSq()<t**2||!i)&&r.set(0,0,0)}t.lengthSq()>0&&this._applyRotation(t.x*e,t.y*e,n),r.lengthSq()>0&&(o.position.addScaledVector(r,e),o.updateMatrixWorld())}_inertiaNeedsUpdate(){const{rotationInertia:e,dragInertia:t}=this;return 0!==e.lengthSq()||0!==t.lengthSq()}_updateZoom(){const{zoomPoint:e,zoomDirection:t,camera:n,minDistance:r,maxDistance:i,pointerTracker:s,domElement:o,minZoom:a,maxZoom:l,zoomSpeed:c,state:u}=this;let h=this.zoomDelta;if(this.zoomDelta=0,s.getLatestPoint(Du)&&(0!==h||3===u))if(this.rotationInertia.set(0,0),this.dragInertia.set(0,0,0),n.isOrthographicCamera){this._updateZoomDirection();const e=this.zoomPointSet||this._updateZoomPoint();Pu.unproject(n);const t=Math.pow(.95,Math.abs(.05*h));let r=h>0?1/Math.abs(t):t;r*=c,r>1?l<n.zoom*r&&(r=1):a>n.zoom*r&&(r=1),n.zoom*=r,n.updateProjectionMatrix(),e&&(uu(Du.x,Du.y,o,Cu),Cu.unproject(n),n.position.sub(Cu).add(Pu),n.updateMatrixWorld())}else{this._updateZoomDirection();const s=yu.copy(t);if(this.zoomPointSet||this._updateZoomPoint()){const s=e.distanceTo(n.position);if(h<0){const e=Math.min(0,s-i);h=h*s*c*.0025,h=Math.max(h,e)}else{const e=Math.max(0,s-r);h=h*Math.max(s-r,0)*c*.0025,h=Math.min(h,e)}n.position.addScaledVector(t,h),n.updateMatrixWorld()}else{const e=this._getPointBelowCamera();if(e){const t=e.distance;s.set(0,0,-1).transformDirection(n.matrixWorld),n.position.addScaledVector(s,h*t*.01),n.updateMatrixWorld()}}}}_updateZoomDirection(){if(this.zoomDirectionSet)return;const{domElement:e,raycaster:t,camera:n,zoomDirection:r,pointerTracker:i}=this;i.getLatestPoint(Du),uu(Du.x,Du.y,e,Pu),du(t,Pu,n),r.copy(t.ray.direction).normalize(),this.zoomDirectionSet=!0}_updateZoomPoint(){const{camera:e,zoomDirectionSet:t,zoomDirection:n,raycaster:r,zoomPoint:i,pointerTracker:s,domElement:o}=this;if(this._zoomPointWasSet=!1,!t)return!1;e.isOrthographicCamera&&s.getLatestPoint(Iu)?(uu(Iu.x,Iu.y,o,Iu),du(r,Iu,e)):(r.ray.origin.copy(e.position),r.ray.direction.copy(n),r.near=0,r.far=1/0);const a=this._raycast(r);return!!a&&(i.copy(a.point),this.zoomPointSet=!0,this._zoomPointWasSet=!0,!0)}_getPointBelowCamera(e=this.camera.position,t=this.up){const{raycaster:n}=this;n.ray.direction.copy(t).multiplyScalar(-1),n.ray.origin.copy(e).addScaledVector(t,1e5),n.near=0,n.far=1/0;const r=this._raycast(n);return r&&(r.distance-=1e5),r}_updatePosition(e){const{raycaster:t,camera:n,pivotPoint:r,up:i,pointerTracker:s,domElement:o,state:a,dragInertia:l}=this;if(1===a){if(s.getCenterPoint(Du),uu(Du.x,Du.y,o,Du),Su.setFromNormalAndCoplanarPoint(i,r),du(t,Du,n),Math.abs(t.ray.direction.dot(i))<pu){const e=Math.acos(pu);Mu.crossVectors(t.ray.direction,i).normalize(),t.ray.direction.copy(i).applyAxisAngle(Mu,e).multiplyScalar(-1)}if(this.getUpDirection(r,Eu),Math.abs(t.ray.direction.dot(Eu))<fu){const e=Math.acos(fu);Mu.crossVectors(t.ray.direction,Eu).normalize(),t.ray.direction.copy(Eu).applyAxisAngle(Mu,e).multiplyScalar(-1)}t.ray.intersectPlane(Su,yu)&&(vu.subVectors(r,yu),n.position.add(vu),n.updateMatrixWorld(),vu.multiplyScalar(1/e),s.getMoveDistance()/e<2*window.devicePixelRatio?this.inertiaStableFrames++:(l.copy(vu),this.inertiaStableFrames=0))}}_updateRotation(e){const{pivotPoint:t,pointerTracker:n,domElement:r,state:i,rotationInertia:s}=this;2===i&&(n.getCenterPoint(Du),n.getPreviousCenterPoint(ku),Ou.subVectors(Du,ku).multiplyScalar(2*Math.PI/r.clientHeight),this._applyRotation(Ou.x,Ou.y,t),Ou.multiplyScalar(1/e),n.getMoveDistance()/e<2*window.devicePixelRatio?this.inertiaStableFrames++:(s.copy(Ou),this.inertiaStableFrames=0))}_applyRotation(e,t,n){if(0===e&&0===t)return;const{camera:r,minAltitude:i,maxAltitude:s,rotationSpeed:o}=this,a=-e*o;let l,c=t*o;bu.set(0,0,1).transformDirection(r.matrixWorld),wu.set(1,0,0).transformDirection(r.matrixWorld),this.getUpDirection(n,Eu),Eu.dot(bu)>1-1e-10?l=0:(yu.crossVectors(Eu,bu).normalize(),l=Math.sign(yu.dot(wu))*Eu.angleTo(bu)),c>0?(c=Math.min(l-i,c),c=Math.max(0,c)):(c=Math.max(l-s,c),c=Math.min(0,c)),Au.setFromAxisAngle(Eu,a),cu(n,Au,mu),r.matrixWorld.premultiply(mu),wu.set(1,0,0).transformDirection(r.matrixWorld),Au.setFromAxisAngle(wu,-c),cu(n,Au,mu),r.matrixWorld.premultiply(mu),r.matrixWorld.decompose(r.position,r.quaternion,yu)}_setFrame(e){const{up:t,camera:n,zoomPoint:r,zoomDirectionSet:i,zoomPointSet:s,scaleZoomOrientationAtEdges:o}=this;if(i&&(s||this._updateZoomPoint())){if(Au.setFromUnitVectors(t,e),o){this.getUpDirection(r,yu);let e=Math.max(yu.dot(t)-.6,0)/.4;e=Y.mapLinear(e,0,.5,0,1),e=Math.min(e,1),n.isOrthographicCamera&&(e*=.1),Au.slerp(Ru,1-e)}cu(r,Au,mu),n.updateMatrixWorld(),n.matrixWorld.premultiply(mu),n.matrixWorld.decompose(n.position,n.quaternion,yu),this.zoomDirectionSet=!1,this._updateZoomDirection()}t.copy(e),n.updateMatrixWorld()}_raycast(e){const{scene:t,useFallbackPlane:n,fallbackPlane:r}=this,i=e.intersectObject(t)[0]||null;if(i)return i;if(n){const t=r;if(e.ray.intersectPlane(t,yu))return{point:yu.clone(),distance:e.ray.origin.distanceTo(yu)}}return null}_alignCameraUp(e,t=1){const{camera:n,state:r,pivotPoint:i,zoomPoint:s,zoomPointSet:o}=this;n.updateMatrixWorld(),bu.set(0,0,-1).transformDirection(n.matrixWorld),wu.set(-1,0,0).transformDirection(n.matrixWorld);let a=Y.mapLinear(1-Math.abs(bu.dot(e)),0,.2,0,1);a=Y.clamp(a,0,1),t*=a,Tu.crossVectors(e,bu),Tu.lerp(wu,1-t).normalize(),Au.setFromUnitVectors(wu,Tu),n.quaternion.premultiply(Au);let l=null;1===r||2===r?l=_u.copy(i):o&&(l=_u.copy(s)),l&&(gu.copy(n.matrixWorld).invert(),yu.copy(l).applyMatrix4(gu),n.updateMatrixWorld(),yu.applyMatrix4(n.matrixWorld),xu.subVectors(l,yu),n.position.add(xu)),n.updateMatrixWorld()}_clampRotation(e){const{camera:t,minAltitude:n,maxAltitude:r,state:i,pivotPoint:s,zoomPoint:o,zoomPointSet:a}=this;let l,c;if(t.updateMatrixWorld(),bu.set(0,0,1).transformDirection(t.matrixWorld),wu.set(1,0,0).transformDirection(t.matrixWorld),e.dot(bu)>1-1e-10?l=0:(yu.crossVectors(e,bu),l=Math.sign(yu.dot(wu))*e.angleTo(bu)),l>r)c=r;else{if(!(l<n))return;c=n}bu.copy(e),Au.setFromAxisAngle(wu,c),bu.applyQuaternion(Au).normalize(),yu.crossVectors(bu,wu).normalize(),mu.makeBasis(wu,yu,bu),t.quaternion.setFromRotationMatrix(mu);let u=null;1===i||2===i?u=_u.copy(s):a&&(u=_u.copy(o)),u&&(gu.copy(t.matrixWorld).invert(),yu.copy(u).applyMatrix4(gu),t.updateMatrixWorld(),yu.applyMatrix4(t.matrixWorld),xu.subVectors(u,yu),t.position.add(xu)),t.updateMatrixWorld()}}const Hu=new Ne,Gu=new Ne,Vu=new ne,Wu=new ne,Xu=new ne,Ku=new ne,qu=new ne,Yu=new ne,Zu=new Ge,$u=new ne,Qu=new ne,Ju=new Ve,eh=new Kl,th=new te,nh={};class rh extends ju{get tilesGroup(){return console.warn('GlobeControls: "tilesGroup" has been deprecated. Use "ellipsoidGroup", instead.'),this.ellipsoidFrame}get ellipsoidFrame(){return this.ellipsoidGroup.matrixWorld}get ellipsoidFrameInverse(){const{ellipsoidGroup:e,ellipsoidFrame:t,_ellipsoidFrameInverse:n}=this;return e.matrixWorldInverse?e.matrixWorldInverse:n.copy(t).invert()}constructor(e=null,t=null,n=null,r=null){super(e,t,n),this.isGlobeControls=!0,this._dragMode=0,this._rotationMode=0,this.maxZoom=.01,this.nearMargin=.25,this.farMargin=0,this.useFallbackPlane=!1,this.autoAdjustCameraRotation=!1,this.globeInertia=new Ge,this.globeInertiaFactor=0,this.ellipsoid=ql.clone(),this.ellipsoidGroup=new Oe,this._ellipsoidFrameInverse=new Ne,null!==r&&this.setTilesRenderer(r)}setTilesRenderer(e){super.setTilesRenderer(e),null!==e&&this.setEllipsoid(e.ellipsoid,e.group)}setEllipsoid(e,t){this.ellipsoid=e||ql.clone(),this.ellipsoidGroup=t||new Oe}getPivotPoint(e){const{camera:t,ellipsoidFrame:n,ellipsoidFrameInverse:r,ellipsoid:i}=this;return Ku.set(0,0,-1).transformDirection(t.matrixWorld),Ju.origin.copy(t.position),Ju.direction.copy(Ku),Ju.applyMatrix4(r),hu(Ju,i,Wu),Wu.applyMatrix4(n),(null===super.getPivotPoint(e)||Vu.subVectors(e,Ju.origin).dot(Ju.direction)>Vu.subVectors(Wu,Ju.origin).dot(Ju.direction))&&e.copy(Wu),e}getVectorToCenter(e){const{ellipsoidFrame:t,camera:n}=this;return e.setFromMatrixPosition(t).sub(n.position)}getDistanceToCenter(){return this.getVectorToCenter(Wu).length()}getUpDirection(e,t){const{ellipsoidFrame:n,ellipsoidFrameInverse:r,ellipsoid:i}=this;Wu.copy(e).applyMatrix4(r),i.getPositionToNormal(Wu,t),t.transformDirection(n)}getCameraUpDirection(e){const{ellipsoidFrame:t,ellipsoidFrameInverse:n,ellipsoid:r,camera:i}=this;i.isOrthographicCamera?(this._getVirtualOrthoCameraPosition(Wu),Wu.applyMatrix4(n),r.getPositionToNormal(Wu,e),e.transformDirection(t)):this.getUpDirection(i.position,e)}update(e=Math.min(this.clock.getDelta(),.064)){if(!this.enabled||!this.camera||0===e)return;const{camera:t,pivotMesh:n}=this;this._isNearControls()?this.scaleZoomOrientationAtEdges=this.zoomDelta<0:(0!==this.state&&1!==this._dragMode&&1!==this._rotationMode&&(n.visible=!1),this.scaleZoomOrientationAtEdges=!1);const r=this.needsUpdate||this._inertiaNeedsUpdate();super.update(e),this.adjustCamera(t),r&&this._isNearControls()&&(this.getCameraUpDirection(Yu),this._alignCameraUp(Yu,1),this.getCameraUpDirection(Yu),this._clampRotation(Yu))}adjustCamera(e){super.adjustCamera(e);const{ellipsoidFrame:t,ellipsoidFrameInverse:n,ellipsoid:r,nearMargin:i,farMargin:s}=this,o=Math.max(...r.radius);if(e.isPerspectiveCamera){const a=Wu.setFromMatrixPosition(t).sub(e.position).length(),l=i*o,c=Y.clamp((a-o)/l,0,1),u=Y.lerp(1,1e3,c);e.near=Math.max(u,a-o-l),Vu.copy(e.position).applyMatrix4(n),r.getPositionToCartographic(Vu,nh);const h=Math.max(r.getPositionElevation(Vu),2550),d=r.calculateHorizonDistance(nh.lat,h);e.far=d+.1+o*s,e.updateProjectionMatrix()}else{this._getVirtualOrthoCameraPosition(e.position,e),e.updateMatrixWorld(),Hu.copy(e.matrixWorld).invert(),Wu.setFromMatrixPosition(t).applyMatrix4(Hu);const n=-Wu.z;e.near=n-o*(1+i),e.far=n+.1+o*s,e.position.addScaledVector(Ku,e.near),e.far-=e.near,e.near=0,e.updateProjectionMatrix(),e.updateMatrixWorld()}}resetState(){super.resetState(),this._dragMode=0,this._rotationMode=0}_updateInertia(e){super._updateInertia(e);const{globeInertia:t,enableDamping:n,dampingFactor:r,camera:i,cameraRadius:s,minDistance:o,inertiaTargetDistance:a,ellipsoidFrame:l}=this;if(!this.enableDamping||this.inertiaStableFrames>1)return this.globeInertiaFactor=0,void this.globeInertia.identity();const c=Math.pow(2,-e/r),u=Math.max(i.near,s,o,a),h=25e-5;if(Xu.setFromMatrixPosition(l),0!==this.globeInertiaFactor){du(Ju,Wu.set(0,0,-1),i),Ju.applyMatrix4(i.matrixWorldInverse),Ju.direction.normalize(),Ju.recast(-Ju.direction.dot(Ju.origin)).at(u/Ju.direction.z,Wu),Wu.applyMatrix4(i.matrixWorld),du(Ju,Vu.set(h,h,-1),i),Ju.applyMatrix4(i.matrixWorldInverse),Ju.direction.normalize(),Ju.recast(-Ju.direction.dot(Ju.origin)).at(u/Ju.direction.z,Vu),Vu.applyMatrix4(i.matrixWorld),Wu.sub(Xu).normalize(),Vu.sub(Xu).normalize(),this.globeInertiaFactor*=c;const r=Wu.angleTo(Vu)/e;(2*Math.acos(t.w)*this.globeInertiaFactor<r||!n)&&(this.globeInertiaFactor=0,t.identity())}0!==this.globeInertiaFactor&&(1===t.w&&(0!==t.x||0!==t.y||0!==t.z)&&(t.w=Math.min(t.w,1-1e-9)),Xu.setFromMatrixPosition(l),Zu.identity().slerp(t,this.globeInertiaFactor*e),cu(Xu,Zu,Gu),i.matrixWorld.premultiply(Gu),i.matrixWorld.decompose(i.position,i.quaternion,Wu))}_inertiaNeedsUpdate(){return super._inertiaNeedsUpdate()||0!==this.globeInertiaFactor}_updatePosition(e){if(1===this.state){0===this._dragMode&&(this._dragMode=this._isNearControls()?1:-1);const{raycaster:t,camera:n,pivotPoint:r,pointerTracker:i,domElement:s,ellipsoidFrame:o,ellipsoidFrameInverse:a}=this,l=Vu,c=qu;i.getCenterPoint(th),uu(th.x,th.y,s,th),du(t,th,n),t.ray.applyMatrix4(a);const u=Wu.copy(r).applyMatrix4(a).length();eh.radius.setScalar(u),n.isPerspectiveCamera?eh.intersectRay(t.ray,Wu)||function(e,t,n){const r=e.origin.length(),i=Math.acos(t/r);n.copy(e.origin).multiplyScalar(-1).normalize();const s=lu.crossVectors(n,e.direction).normalize();n.multiplyScalar(-1).applyAxisAngle(s,-i).normalize().multiplyScalar(t)}(t.ray,u,Wu):hu(t.ray,eh,Wu),Wu.applyMatrix4(o),Xu.setFromMatrixPosition(o),l.subVectors(r,Xu).normalize(),c.subVectors(Wu,Xu).normalize(),Zu.setFromUnitVectors(c,l),cu(Xu,Zu,Gu),n.matrixWorld.premultiply(Gu),n.matrixWorld.decompose(n.position,n.quaternion,Wu),i.getMoveDistance()/e<2*window.devicePixelRatio?this.inertiaStableFrames++:(this.globeInertia.copy(Zu),this.globeInertiaFactor=1/e,this.inertiaStableFrames=0)}}_updateRotation(...e){1===this._rotationMode||this._isNearControls()?(this._rotationMode=1,super._updateRotation(...e)):(this.pivotMesh.visible=!1,this._rotationMode=-1)}_updateZoom(){const{zoomDelta:e,ellipsoid:t,zoomSpeed:n,zoomPoint:r,camera:i,maxZoom:s,state:o}=this;if(3!==o&&0===e)return;this.rotationInertia.set(0,0),this.dragInertia.set(0,0,0),this.globeInertia.identity(),this.globeInertiaFactor=0;const a=Y.clamp(Y.mapLinear(Math.abs(e),0,20,0,1),0,1);if(this._isNearControls()||e>0){if(this._updateZoomDirection(),e<0&&(this.zoomPointSet||this._updateZoomPoint())){Ku.set(0,0,-1).transformDirection(i.matrixWorld).normalize(),Qu.copy(this.up).multiplyScalar(-1),this.getUpDirection(r,$u);const e=Y.clamp(Y.mapLinear(-$u.dot(Qu),1,.95,0,1),0,1),t=1-Ku.dot(Qu),n=i.isOrthographicCamera?.05:1,s=Y.clamp(3*a,0,1),o=Math.min(e*t*n*s,.1);Qu.lerpVectors(Ku,Qu,o).normalize(),Zu.setFromUnitVectors(Ku,Qu),cu(r,Zu,Gu),i.matrixWorld.premultiply(Gu),i.matrixWorld.decompose(i.position,i.quaternion,Qu),this.zoomDirection.subVectors(r,i.position).normalize()}super._updateZoom()}else if(i.isPerspectiveCamera){const r=this._getPerspectiveTransitionDistance(),i=this._getMaxPerspectiveDistance(),s=Y.mapLinear(this.getDistanceToCenter(),r,i,0,1);this._tiltTowardsCenter(Y.lerp(0,.4,s*a)),this._alignCameraUpToNorth(Y.lerp(0,.2,s*a));const o=e*(this.getDistanceToCenter()-t.radius.x)*n*.0025,l=Math.max(o,Math.min(this.getDistanceToCenter()-i,0));this.getVectorToCenter(Wu).normalize(),this.camera.position.addScaledVector(Wu,l),this.camera.updateMatrixWorld(),this.zoomDelta=0}else{const e=this._getOrthographicTransitionZoom(),t=this._getMinOrthographicZoom(),r=Y.mapLinear(i.zoom,e,t,0,1);this._tiltTowardsCenter(Y.lerp(0,.4,r*a)),this._alignCameraUpToNorth(Y.lerp(0,.2,r*a));const o=this.zoomDelta,l=Math.pow(.95,Math.abs(.05*o)),c=o>0?1/Math.abs(l):l,u=t/i.zoom,h=Math.max(c*n,Math.min(u,1));i.zoom=Math.min(s,i.zoom*h),i.updateProjectionMatrix(),this.zoomDelta=0,this.zoomDirectionSet=!1}}_alignCameraUpToNorth(e){const{ellipsoidFrame:t}=this;Yu.set(0,0,1).transformDirection(t),this._alignCameraUp(Yu,e)}_tiltTowardsCenter(e){const{camera:t,ellipsoidFrame:n}=this;Ku.set(0,0,-1).transformDirection(t.matrixWorld).normalize(),Wu.setFromMatrixPosition(n).sub(t.position).normalize(),Wu.lerp(Ku,1-e).normalize(),Zu.setFromUnitVectors(Ku,Wu),t.quaternion.premultiply(Zu),t.updateMatrixWorld()}_getPerspectiveTransitionDistance(){const{camera:e,ellipsoid:t}=this;if(!e.isPerspectiveCamera)throw new Error;const n=Math.max(...t.radius),r=2*Math.atan(Math.tan(Y.DEG2RAD*e.fov*.5)*e.aspect),i=n/Math.tan(Y.DEG2RAD*e.fov*.5),s=n/Math.tan(.5*r);return Math.max(i,s)}_getMaxPerspectiveDistance(){const{camera:e,ellipsoid:t}=this;if(!e.isPerspectiveCamera)throw new Error;const n=Math.max(...t.radius),r=2*Math.atan(Math.tan(Y.DEG2RAD*e.fov*.5)*e.aspect),i=n/Math.tan(Y.DEG2RAD*e.fov*.5),s=n/Math.tan(.5*r);return 2*Math.max(i,s)}_getOrthographicTransitionZoom(){const{camera:e,ellipsoid:t}=this;if(!e.isOrthographicCamera)throw new Error;const n=e.top-e.bottom,r=e.right-e.left;return 2*Math.max(n,r)/(2*Math.max(...t.radius))}_getMinOrthographicZoom(){const{camera:e,ellipsoid:t}=this;if(!e.isOrthographicCamera)throw new Error;const n=e.top-e.bottom,r=e.right-e.left;return.7*Math.min(n,r)/(2*Math.max(...t.radius))}_getVirtualOrthoCameraPosition(e,t=this.camera){const{ellipsoidFrame:n,ellipsoidFrameInverse:r,ellipsoid:i}=this;if(!t.isOrthographicCamera)throw new Error;Ju.origin.copy(t.position),Ju.direction.set(0,0,-1).transformDirection(t.matrixWorld),Ju.applyMatrix4(r),hu(Ju,i,Vu),Vu.applyMatrix4(n);const s=t.top-t.bottom,o=t.right-t.left,a=Math.max(s,o)/t.zoom;Ku.set(0,0,-1).transformDirection(t.matrixWorld);const l=Vu.sub(t.position).dot(Ku);e.copy(t.position).addScaledVector(Ku,l-4*a)}_isNearControls(){const{camera:e}=this;return e.isPerspectiveCamera?this.getDistanceToCenter()<this._getPerspectiveTransitionDistance():e.zoom>this._getOrthographicTransitionZoom()}_raycast(e){const t=super._raycast(e);if(null===t){const{ellipsoid:t,ellipsoidFrame:n,ellipsoidFrameInverse:r}=this;Ju.copy(e.ray).applyMatrix4(r);const i=t.intersectRay(Ju,Wu);return null!==i?{point:i.clone().applyMatrix4(n)}:null}return t}}const ih=Symbol("TILE_X"),sh=Symbol("TILE_Y"),oh=Symbol("TILE_LEVEL");class ah{get tiling(){return this.imageSource.tiling}constructor(e={}){const{pixelSize:t=.01,center:n=!1,useRecommendedSettings:r=!0,imageSource:i=null}=e;this.priority=-10,this.tiles=null,this.imageSource=i,this.pixelSize=t,this.center=n,this.useRecommendedSettings=r}init(e){this.useRecommendedSettings&&(e.errorTarget=1),this.tiles=e,this.imageSource.fetchOptions=e.fetchOptions,this.imageSource.fetchData=(t,n)=>(e.invokeAllPlugins((e=>t=e.preprocessURL?e.preprocessURL(t,null):t)),e.invokeOnePlugin((e=>e!==this&&e.fetchData&&e.fetchData(t,n))))}async loadRootTileSet(){const{tiles:e,imageSource:t}=this;let n=e.rootURL;return e.invokeAllPlugins((e=>n=e.preprocessURL?e.preprocessURL(n,null):n)),await t.init(n),this.getTileset(n)}async parseToMesh(e,t,n,r,i){if(i.aborted)return null;const s=t[ih],o=t[sh],a=t[oh],l=await this.imageSource.processBufferToTexture(e);this.imageSource.setData(s,o,a,l);let c=1,u=1,h=0,d=0,p=0;const f=t.boundingVolume.box;f&&([h,d,p]=f,c=f[3],u=f[7]);const m=new oe(new lt(2*c,2*u),new ie({map:l,transparent:!0}));return m.position.set(h,d,p),m}preprocessNode(e){const{tiling:t}=this,n=t.maxLevel;e[oh]<n&&null!==e.parent&&this.expandChildren(e)}disposeTile(e){const t=e[ih],n=e[sh],r=e[oh],{imageSource:i}=this;i.has(t,n,r)&&i.release(t,n,r)}getTileset(e){const{tiling:t,tiles:n}=this,r=t.minLevel,{tileCountX:i,tileCountY:s}=t.getLevel(r),o=[];for(let l=0;l<i;l++)for(let e=0;e<s;e++){const t=this.createChild(l,e,r);null!==t&&o.push(t)}const a={asset:{version:"1.1"},geometricError:1e5,root:{refine:"REPLACE",geometricError:1e5,boundingVolume:this.createBoundingVolume(0,0,-1),children:o,[oh]:-1,[ih]:0,[sh]:0}};return n.preprocessTileSet(a,e),a}getUrl(e,t,n){return this.imageSource.getUrl(e,t,n)}createBoundingVolume(e,t,n){const{center:r,pixelSize:i,tiling:s}=this,{pixelWidth:o,pixelHeight:a}=s.getLevel(s.maxLevel),[l,c,u,h]=-1===n?s.getFullBounds(!0):s.getTileBounds(e,t,n,!0);let d=(u-l)/2,p=(h-c)/2,f=l+d,m=c+p;return r&&(f-=.5,m-=.5),f*=o*i,d*=o*i,m*=a*i,p*=a*i,{box:[f,m,0,d,0,0,0,p,0,0,0,0]}}createChild(e,t,n){const{pixelSize:r,tiling:i}=this;if(!i.getTileExists(e,t,n))return null;const{pixelWidth:s,pixelHeight:o}=i.getLevel(i.maxLevel),{pixelWidth:a,pixelHeight:l}=i.getLevel(n);return{refine:"REPLACE",geometricError:r*(Math.max(s/a,o/l)-1),boundingVolume:this.createBoundingVolume(e,t,n),content:{uri:this.getUrl(e,t,n)},children:[],[ih]:e,[sh]:t,[oh]:n}}expandChildren(e){const t=e[oh],n=e[ih],r=e[sh];for(let i=0;i<2;i++)for(let s=0;s<2;s++){const o=this.createChild(2*n+i,2*r+s,t+1);o&&e.children.push(o)}}}const lh=new ne,ch=new ne;const uh=new ne,hh=new ne,dh=new te,ph=new qe;class fh extends ah{get projection(){return this.tiling.projection}constructor(e={}){const{shape:t="planar",endCaps:n=!0,...r}=e;super(r),this.shape=t,this.endCaps=n}async parseToMesh(e,t,...n){const r=await super.parseToMesh(e,t,...n),{shape:i,projection:s,tiles:o,tiling:a}=this;if("ellipsoid"===i){const e=o.ellipsoid,n=t[oh],i=t[ih],l=t[sh],[c,u,h,d]=a.getTileBounds(i,l,n,!0),[p,f,m,g]=t.boundingVolume.region,v=Math.ceil((g-f)*Y.RAD2DEG*.25),y=Math.ceil((m-p)*Y.RAD2DEG*.25),_=Math.max(15,v),x=Math.max(30,y),b=new lt(1,1,x,_),{position:w,normal:T,uv:M}=b.attributes,A=w.count;t.cached.boundingVolume.getSphere(ph);for(let t=0;t<A;t++){uh.fromBufferAttribute(w,t),hh.fromBufferAttribute(T,t),dh.fromBufferAttribute(M,t);const n=Y.mapLinear(dh.x,0,1,p,m);let r=Y.mapLinear(dh.y,0,1,f,g);if(s.isMercator&&0!==dh.y&&1!==dh.y){const e=s.convertProjectionToLatitude(1),t=1/_,n=Y.mapLinear(dh.y-t,0,1,f,g),i=Y.mapLinear(dh.y+t,0,1,f,g);r>e&&n<e&&(r=e),r<-e&&i>-e&&(r=-e)}e.getCartographicToPosition(r,n,0,uh).sub(ph.center),e.getCartographicToNormal(r,n,hh);const i=Y.mapLinear(s.convertLongitudeToProjection(n),c,h,0,1),o=Y.mapLinear(s.convertLatitudeToProjection(r),u,d,0,1);M.setXY(t,i,o),w.setXYZ(t,...uh),T.setXYZ(t,...hh)}r.geometry=b,r.position.copy(ph.center)}return r}createBoundingVolume(e,t,n){if("ellipsoid"===this.shape){const{tiling:r,endCaps:i}=this,s=-1===n,o=s?r.getFullBounds(!0):r.getTileBounds(e,t,n,!0),a=s?r.getFullBounds():r.getTileBounds(e,t,n);return i&&(1===o[3]&&(a[3]=Math.PI/2),0===o[1]&&(a[1]=-Math.PI/2)),{region:[...a,-1,1]}}return super.createBoundingVolume(e,t,n)}preprocessNode(e,...t){super.preprocessNode(e,t);const{shape:n,projection:r,tiling:i}=this;if("ellipsoid"===n){const t=e[oh],n=e[ih],s=e[sh];if(-1===t)return e.geometricError=1e50,parent;const[o,a,l,c]=i.getTileBounds(n,s,t,!0),{tilePixelWidth:u,tilePixelHeight:h}=i.getLevel(t),{pixelWidth:d,pixelHeight:p}=i.getLevel(i.maxLevel),f=(l-o)/u,m=(c-a)/h,g=1/d,v=1/p,[,y,_,x]=i.getTileBounds(n,s,t),b=y>0!=x>0?0:Math.min(Math.abs(y),Math.abs(x)),w=r.convertLatitudeToProjection(b),T=r.getLongitudeDerivativeAtProjection(o),M=r.getLatitudeDerivativeAtProjection(w),[A,S]=function(e,t,n){const r=n+1e-5;let i=t+1e-5;Math.abs(i)>Math.PI/2&&(i-=1e-5),e.getCartographicToPosition(t,n,0,lh),e.getCartographicToPosition(i,n,0,ch);const s=lh.distanceTo(ch)/1e-5;return e.getCartographicToPosition(t,r,0,ch),[lh.distanceTo(ch)/1e-5,s]}(this.tiles.ellipsoid,b,_),E=Math.max(f*T*A,m*M*S),P=Math.max(g*T*A,v*M*S);e.geometricError=E-P,null===e.parent&&(e.geometricError=1e50)}return e}}class mh{get isMercator(){return"EPSG:3857"===this.scheme}constructor(e="EPSG:4326"){this.scheme=e,this.tileCountX=1,this.tileCountY=1,this.setScheme(e)}setScheme(e){switch(this.scheme=e,e){case"EPSG:4326":this.tileCountX=2,this.tileCountY=1;break;case"EPSG:3857":this.tileCountX=1,this.tileCountY=1;break;default:throw new Error}}convertProjectionToLatitude(e){if(this.isMercator){const t=Y.mapLinear(e,0,1,-1,1);return 2*Math.atan(Math.exp(t*Math.PI))-Math.PI/2}return Y.mapLinear(e,0,1,-Math.PI/2,Math.PI/2)}convertProjectionToLongitude(e){return Y.mapLinear(e,0,1,-Math.PI,Math.PI)}convertLatitudeToProjection(e){if(this.isMercator){return.5+1*Math.log(Math.tan(Math.PI/4+e/2))/(2*Math.PI)}return Y.mapLinear(e,-Math.PI/2,Math.PI/2,0,1)}convertLongitudeToProjection(e){return(e+Math.PI)/(2*Math.PI)}getLongitudeDerivativeAtProjection(e){return 2*Math.PI}getLatitudeDerivativeAtProjection(e){let t=e-1e-5;return t<0&&(t=e+1e-5),this.isMercator?Math.abs(this.convertProjectionToLatitude(e)-this.convertProjectionToLatitude(t))/1e-5:Math.PI}getBounds(){return[this.convertProjectionToLongitude(0),this.convertProjectionToLatitude(0),this.convertProjectionToLongitude(1),this.convertProjectionToLatitude(1)]}}function gh(...e){return e.join("_")}class vh{constructor(){this.cache={},this.count=0,this.cachedBytes=0}fetchItem(){}disposeItem(){}getMemoryUsage(e){return 0}setData(...e){const{cache:t}=this,n=e.pop(),r=gh(...e);if(r in t)throw new Error(`DataCache: "${r}" is already present.`);return this.cache[r]={abortController:new AbortController,result:n,count:1,bytes:this.getMemoryUsage(n)},this.count++,this.cachedBytes+=this.cache[r].bytes,n}lock(...e){const{cache:t}=this,n=gh(...e);if(n in t)t[n].count++;else{const t=new AbortController,r={abortController:t,result:null,count:1,bytes:0};r.result=this.fetchItem(...e,t.signal),r.result instanceof Promise?r.result.then((e=>(r.result=e,r.bytes=this.getMemoryUsage(e),this.cachedBytes+=r.bytes,e))):(r.bytes=this.getMemoryUsage(r.result),this.cachedBytes+=r.bytes),this.cache[n]=r,this.count++}return t[n].result}release(...e){const t=gh(...e);this.releaseViaFullKey(t)}get(...e){const{cache:t}=this,n=gh(...e);return n in t&&t[n].count>0?t[n].result:null}has(...e){const{cache:t}=this;return gh(...e)in t}dispose(){const{cache:e}=this;for(const t in e){const{abortController:n}=e[t];n.abort(),this.releaseViaFullKey(t,!0)}this.cache={}}releaseViaFullKey(e,t=!1){const{cache:n}=this;if(e in n&&n[e].count>0){const r=n[e];if(r.count--,0===r.count||t){const i=()=>{if(n[e]!==r)return;const{result:t,abortController:i}=r;i.abort(),t instanceof Promise?t.then((e=>this.disposeItem(e))).catch((()=>{})):this.disposeItem(t),delete n[e],this.count--,this.cachedBytes-=r.bytes};t?i():queueMicrotask((()=>{0===r.count&&i()}))}return!0}throw new Error("DataCache: Attempting to release key that does not exist")}}function yh(e,t,n){return Math.min(Math.max(e,t),n)}class _h{get levelCount(){return this._levels.length}get maxLevel(){return this.levelCount-1}get minLevel(){const e=this._levels;for(let t=0;t<e.length;t++)if(null!==e[t])return t;return-1}get rootBounds(){return this._rootBounds??this.projection?.getBounds()??[0,0,1,1]}get rootOrigin(){const e=this.rootBounds;return this._rootOrigin??[e[0],e[1]]}get aspect(){const{pixelWidth:e,pixelHeight:t}=this.getLevel(this.maxLevel);return e/t}constructor(){this.flipY=!1,this.pixelOverlap=0,this._rootBounds=null,this._rootOrigin=null,this.projection=null,this._levels=[]}setLevel(e,t={}){const n=this._levels;for(;n.length<e;)n.push(null);const{tilePixelWidth:r=256,tilePixelHeight:i=256,tileCountX:s=2**e,tileCountY:o=2**e}=t,{pixelWidth:a=r*s,pixelHeight:l=i*o}=t;n[e]={tilePixelWidth:r,tilePixelHeight:i,pixelWidth:a,pixelHeight:l,tileCountX:s,tileCountY:o}}generateLevels(e,t,n,r={}){const{minLevel:i=0,tilePixelWidth:s=256,tilePixelHeight:o=256}=r,a=e-1,{pixelWidth:l=s*t*2**a,pixelHeight:c=o*n*2**a}=r;for(let u=i;u<e;u++){const t=e-u-1,n=Math.ceil(l*2**-t),r=Math.ceil(c*2**-t),i=Math.ceil(n/s),a=Math.ceil(r/o);this.setLevel(u,{tilePixelWidth:s,tilePixelHeight:o,pixelWidth:n,pixelHeight:r,tileCountX:i,tileCountY:a})}}getLevel(e){return this._levels[e]}setOrigin(e,t){this._rootOrigin=[e,t]}setBounds(e,t,n,r){this._rootBounds=[e,t,n,r]}setProjection(e){this.projection=e}getTileAtPoint(e,t,n,r=!1){const{projection:i,flipY:s}=this,{tileCountX:o,tileCountY:a}=this.getLevel(n),l=1/o,c=1/a;i&&!r&&(e=i.convertLongitudeToProjection(e),t=i.convertLatitudeToProjection(t));const u=Math.floor(e/l);let h=Math.floor(t/c);return s&&(h=a-1-h),[u,h]}getTilesInRange(e,t,n,r,i,s=!1){const o=this.getTileAtPoint(e,t,i,s,!1),a=this.getTileAtPoint(n,r,i,s,!1);this.flipY&&([o[1],a[1]]=[a[1],o[1]]);const{tileCountX:l,tileCountY:c}=this.getLevel(i),[u,h]=o,[d,p]=a;return d<0||p<0||u>=l||h>=c?[0,0,-1,-1]:[yh(u,0,l-1),yh(h,0,c-1),yh(d,0,l-1),yh(p,0,c-1)]}getTileExists(e,t,n){const[r,i,s,o]=this.rootBounds,[a,l,c,u]=this.getTileBounds(e,t,n);return!(a>=c||l>=u)&&a<=s&&l<=o&&c>=r&&u>=i}getFullBounds(e=!1){const{projection:t}=this,n=[...this.rootBounds];return t&&e&&(n[0]=t.convertLongitudeToProjection(n[0]),n[1]=t.convertLatitudeToProjection(n[1]),n[2]=t.convertLongitudeToProjection(n[2]),n[3]=t.convertLatitudeToProjection(n[3])),n}getTileBounds(e,t,n,r=!1){const{flipY:i,pixelOverlap:s,projection:o}=this,{tilePixelWidth:a,tilePixelHeight:l,pixelWidth:c,pixelHeight:u}=this.getLevel(n);let h=a*e-s,d=l*t-s,p=h+a+2*s,f=d+l+2*s;if(h=Math.max(h,0),d=Math.max(d,0),p=Math.min(p,c),f=Math.min(f,u),h/=c,p/=c,d/=u,f/=u,i){const e=(f-d)/2,t=1-(d+f)/2;d=t-e,f=t+e}const m=[h,d,p,f];return o&&!r&&(m[0]=o.convertProjectionToLongitude(m[0]),m[1]=o.convertProjectionToLatitude(m[1]),m[2]=o.convertProjectionToLongitude(m[2]),m[3]=o.convertProjectionToLatitude(m[3])),m}toNormalizedPoint(e,t){const{projection:n}=this,r=[e,t];return this.projection&&(r[0]=n.convertLongitudeToProjection(r[0]),r[1]=n.convertLatitudeToProjection(r[1])),r}toNormalizedRange(e){return[...this.toNormalizedPoint(e[0],e[1]),...this.toNormalizedPoint(e[2],e[3])]}clampToBounds(e,t=!1){const n=[...e],{projection:r}=this;if(t||!r)n[0]=yh(n[0],0,1),n[1]=yh(n[1],0,1),n[2]=yh(n[2],0,1),n[3]=yh(n[3],0,1);else{const[e,t,i,s]=r.getBounds();n[0]=yh(n[0],e,i),n[1]=yh(n[1],t,s),n[2]=yh(n[2],e,i),n[3]=yh(n[3],t,s)}return n}}class xh extends vh{constructor(){super(),this.tiling=new _h,this.fetchOptions={},this.fetchData=(...e)=>fetch(...e)}init(e){}async processBufferToTexture(e){const t=new Blob([e]),n=await createImageBitmap(t,{premultiplyAlpha:"none",colorSpaceConversion:"none",imageOrientation:"flipY"}),r=new Me(n);return r.generateMipmaps=!1,r.colorSpace=K,r.needsUpdate=!0,r}getMemoryUsage(e){const{TextureUtils:t}=re;if(!t)return 0;const{format:n,type:r,image:i,generateMipmaps:s}=e,{width:o,height:a}=i,l=t.getByteLength(o,a,n,r);return s?4*l/3:l}fetchItem(...e){const t=this.getUrl(...e);return this.fetchData(t,this.fetchOptions).then((e=>e.arrayBuffer())).then((e=>this.processBufferToTexture(e)))}disposeItem(e){e.dispose(),e.image instanceof ImageBitmap&&e.image.close()}getUrl(...e){}}class bh extends xh{constructor(e={}){super();const{levels:t=20,tileDimension:n=256}=e;this.tileDimension=n,this.levels=t,this.url=null}getUrl(e,t,n){return this.url.replace("{z}",n).replace("{x}",e).replace("{y}",t)}init(e){const{tiling:t,tileDimension:n,levels:r}=this;return t.flipY=!0,t.setProjection(new mh("EPSG:3857")),t.generateLevels(r,1,1,{tilePixelWidth:n,tilePixelHeight:n}),this.url=e,Promise.resolve()}}class wh extends fh{constructor(e={}){const{levels:t=20,tileDimension:n=256,pixelSize:r=1e-5,...i}=e;super({pixelSize:r,...i}),this.name="XYZ_TILES_PLUGIN",this.imageSource=new bh({levels:t,tileDimension:n})}}const Th=new Ne;class Mh{constructor(){this.name="UPDATE_ON_CHANGE_PLUGIN",this.tiles=null,this.needsUpdate=!1,this.cameraMatrices=new Map}init(e){this.tiles=e,this._needsUpdateCallback=()=>{this.needsUpdate=!0},this._onCameraAdd=({camera:e})=>{this.needsUpdate=!0,this.cameraMatrices.set(e,new Ne)},this._onCameraDelete=({camera:e})=>{this.needsUpdate=!0,this.cameraMatrices.delete(e)},e.addEventListener("needs-update",this._needsUpdateCallback),e.addEventListener("add-camera",this._onCameraAdd),e.addEventListener("delete-camera",this._onCameraDelete),e.addEventListener("camera-resolution-change",this._needsUpdateCallback),e.cameras.forEach((e=>{this._onCameraAdd({camera:e})}))}doTilesNeedUpdate(){const e=this.tiles;let t=!1;this.cameraMatrices.forEach(((n,r)=>{Th.copy(e.group.matrixWorld).premultiply(r.matrixWorldInverse).premultiply(r.projectionMatrixInverse),t=t||!Th.equals(n),n.copy(Th)}));const n=this.needsUpdate;return this.needsUpdate=!1,n||t}preprocessNode(){this.needsUpdate=!0}dispose(){const e=this.tiles;e.removeEventListener("camera-resolution-change",this._needsUpdateCallback),e.removeEventListener("load-content",this._needsUpdateCallback),e.removeEventListener("camera-add",this._onCameraAdd),e.removeEventListener("camera-delete",this._onCameraDelete)}}const{clamp:Ah}=Y;class Sh{constructor(){this.duration=250,this.fadeCount=0,this._lastTick=-1,this._fadeState=new Map,this.onFadeComplete=null,this.onFadeStart=null,this.onFadeSetComplete=null,this.onFadeSetStart=null}deleteObject(e){e&&this.completeFade(e)}guaranteeState(e){const t=this._fadeState;if(t.has(e))return!1;return t.set(e,{fadeInTarget:0,fadeOutTarget:0,fadeIn:0,fadeOut:0}),!0}completeFade(e){const t=this._fadeState;if(!t.has(e))return;const n=0===t.get(e).fadeOutTarget;t.delete(e),this.fadeCount--,this.onFadeComplete&&this.onFadeComplete(e,n),0===this.fadeCount&&this.onFadeSetComplete&&this.onFadeSetComplete()}completeAllFades(){this._fadeState.forEach(((e,t)=>{this.completeFade(t)}))}forEachObject(e){this._fadeState.forEach(((t,n)=>{e(n,t)}))}fadeIn(e){const t=this.guaranteeState(e),n=this._fadeState.get(e);n.fadeInTarget=1,n.fadeOutTarget=0,n.fadeOut=0,t&&(this.fadeCount++,1===this.fadeCount&&this.onFadeSetStart&&this.onFadeSetStart(),this.onFadeStart&&this.onFadeStart(e))}fadeOut(e){const t=this.guaranteeState(e),n=this._fadeState.get(e);n.fadeOutTarget=1,t&&(n.fadeInTarget=1,n.fadeIn=1,this.fadeCount++,1===this.fadeCount&&this.onFadeSetStart&&this.onFadeSetStart(),this.onFadeStart&&this.onFadeStart(e))}isFading(e){return this._fadeState.has(e)}isFadingOut(e){const t=this._fadeState.get(e);return t&&1===t.fadeOutTarget}update(){const e=window.performance.now();-1===this._lastTick&&(this._lastTick=e);const t=Ah((e-this._lastTick)/this.duration,0,1);this._lastTick=e,this._fadeState.forEach(((e,n)=>{const{fadeOutTarget:r,fadeInTarget:i}=e;let{fadeOut:s,fadeIn:o}=e;const a=Math.sign(i-o);o=Ah(o+a*t,0,1);const l=Math.sign(r-s);s=Ah(s+l*t,0,1),e.fadeIn=o,e.fadeOut=s,((1===s||0===s)&&(1===o||0===o)||s>=o)&&this.completeFade(n)}))}}const Eh=Symbol("FADE_PARAMS");function Ph(e,t){if(e[Eh])return e[Eh];const n={fadeIn:{value:0},fadeOut:{value:0},fadeTexture:{value:null}};return e[Eh]=n,e.defines={...e.defines||{},FEATURE_FADE:0},e.onBeforeCompile=e=>{t&&t(e),e.uniforms={...e.uniforms,...n},e.vertexShader=e.vertexShader.replace(/void\s+main\(\)\s+{/,(e=>`\n\t\t\t\t\t#ifdef USE_BATCHING_FRAG\n\n\t\t\t\t\tvarying float vBatchId;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\t${e}\n\n\t\t\t\t\t\t#ifdef USE_BATCHING_FRAG\n\n\t\t\t\t\t\t// add 0.5 to the value to avoid floating error that may cause flickering\n\t\t\t\t\t\tvBatchId = getIndirectIndex( gl_DrawID ) + 0.5;\n\n\t\t\t\t\t\t#endif\n\t\t\t\t`)),e.fragmentShader=e.fragmentShader.replace(/void main\(/,(e=>`\n\t\t\t\t#if FEATURE_FADE\n\n\t\t\t\t// adapted from https://www.shadertoy.com/view/Mlt3z8\n\t\t\t\tfloat bayerDither2x2( vec2 v ) {\n\n\t\t\t\t\treturn mod( 3.0 * v.y + 2.0 * v.x, 4.0 );\n\n\t\t\t\t}\n\n\t\t\t\tfloat bayerDither4x4( vec2 v ) {\n\n\t\t\t\t\tvec2 P1 = mod( v, 2.0 );\n\t\t\t\t\tvec2 P2 = floor( 0.5 * mod( v, 4.0 ) );\n\t\t\t\t\treturn 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );\n\n\t\t\t\t}\n\n\t\t\t\t// the USE_BATCHING define is not available in fragment shaders\n\t\t\t\t#ifdef USE_BATCHING_FRAG\n\n\t\t\t\t// functions for reading the fade state of a given batch id\n\t\t\t\tuniform sampler2D fadeTexture;\n\t\t\t\tvarying float vBatchId;\n\t\t\t\tvec2 getFadeValues( const in float i ) {\n\n\t\t\t\t\tint size = textureSize( fadeTexture, 0 ).x;\n\t\t\t\t\tint j = int( i );\n\t\t\t\t\tint x = j % size;\n\t\t\t\t\tint y = j / size;\n\t\t\t\t\treturn texelFetch( fadeTexture, ivec2( x, y ), 0 ).rg;\n\n\t\t\t\t}\n\n\t\t\t\t#else\n\n\t\t\t\tuniform float fadeIn;\n\t\t\t\tuniform float fadeOut;\n\n\t\t\t\t#endif\n\n\t\t\t\t#endif\n\n\t\t\t\t${e}\n\t\t\t`)).replace(/#include <dithering_fragment>/,(e=>`\n\n\t\t\t\t${e}\n\n\t\t\t\t#if FEATURE_FADE\n\n\t\t\t\t#ifdef USE_BATCHING_FRAG\n\n\t\t\t\tvec2 fadeValues = getFadeValues( vBatchId );\n\t\t\t\tfloat fadeIn = fadeValues.r;\n\t\t\t\tfloat fadeOut = fadeValues.g;\n\n\t\t\t\t#endif\n\n\t\t\t\tfloat bayerValue = bayerDither4x4( floor( mod( gl_FragCoord.xy, 4.0 ) ) );\n\t\t\t\tfloat bayerBins = 16.0;\n\t\t\t\tfloat dither = ( 0.5 + bayerValue ) / bayerBins;\n\t\t\t\tif ( dither >= fadeIn ) {\n\n\t\t\t\t\tdiscard;\n\n\t\t\t\t}\n\n\t\t\t\tif ( dither < fadeOut ) {\n\n\t\t\t\t\tdiscard;\n\n\t\t\t\t}\n\n\t\t\t\t#endif\n\n\t\t\t`))},n}class Ch{constructor(){this._fadeParams=new WeakMap,this.fading=0}setFade(e,t,n){if(!e)return;const r=this._fadeParams;e.traverse((e=>{const i=e.material;if(i){const e=r.get(i);e.fadeIn.value=t,e.fadeOut.value=n;const s=+(!(0===t||1===t)||!(0===n||1===n));i.defines.FEATURE_FADE!==s&&(this.fading+=1===s?1:-1,i.defines.FEATURE_FADE=s,i.needsUpdate=!0)}}))}prepareScene(e){e.traverse((e=>{e.material&&this.prepareMaterial(e.material)}))}deleteScene(e){if(!e)return;this.setFade(e,1,0);const t=this._fadeParams;e.traverse((e=>{const n=e.material;n&&t.delete(n)}))}prepareMaterial(e){const t=this._fadeParams;t.has(e)||t.set(e,Ph(e,e.onBeforeCompile))}}class Rh{constructor(e,t=new ie){this.other=e,this.material=t,this.visible=!0,this.parent=null,this._instanceInfo=[],this._visibilityChanged=!0;const n=new Proxy(this,{get(t,r){if(r in t)return t[r];{const i=e[r];return i instanceof Function?(...e)=>(t.syncInstances(),i.call(n,...e)):e[r]}},set:(t,n,r)=>(n in t?t[n]=r:e[n]=r,!0),deleteProperty:(t,n)=>n in t?delete t[n]:delete e[n]});return n}syncInstances(){const e=this._instanceInfo,t=this.other._instanceInfo;for(;t.length>e.length;){const n=e.length;e.push(new Proxy({visible:!1},{get:(e,r)=>r in e?e[r]:t[n][r],set:(e,r,i)=>(r in e?e[r]=i:t[n][r]=i,!0)}))}}}class Lh extends Rh{constructor(...e){super(...e);const t=this.material,n=Ph(t,t.onBeforeCompile);t.defines.FEATURE_FADE=1,t.defines.USE_BATCHING_FRAG=1,t.needsUpdate=!0,this.fadeTexture=null,this._fadeParams=n}setFadeAt(e,t,n){this._initFadeTexture(),this.fadeTexture.setValueAt(e,255*t,255*n)}_initFadeTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=e*e*2,n=this.fadeTexture;if(!n||n.image.data.length!==t){const r=new Uint8Array(t),i=new Ih(r,e,e,ct,ae);if(n){n.dispose();const e=n.image.data,t=this.fadeTexture.image.data,r=Math.min(e.length,t.length);t.set(new e.constructor(e.buffer,0,r))}this.fadeTexture=i,this._fadeParams.fadeTexture.value=i,i.needsUpdate=!0}}dispose(){this.fadeTexture&&this.fadeTexture.dispose()}}class Ih extends Ft{setValueAt(e,...t){const{data:n,width:r,height:i}=this.image,s=Math.floor(n.length/(r*i));let o=!1;for(let a=0;a<s;a++){const r=e*s+a,i=n[r],l=t[a]||0;i!==l&&(n[r]=l,o=!0)}o&&(this.needsUpdate=!0)}}const Dh=Symbol("HAS_POPPED_IN"),kh=new ne,Oh=new ne,Fh=new Ge,Uh=new Ge,Bh=new ne;function zh(){const e=this._fadeManager,t=this.tiles;this._fadingBefore=e.fadeCount,this._displayActiveTiles=t.displayActiveTiles,t.displayActiveTiles=!0}function Nh(){const e=this._fadeManager,t=this._fadeMaterialManager,n=this._displayActiveTiles,r=this._fadingBefore,i=this._prevCameraTransforms,{tiles:s,maximumFadeOutTiles:o,batchedMesh:a}=this,{cameras:l}=s;s.displayActiveTiles=n,e.update();const c=e.fadeCount;if(0!==r&&0!==c&&(s.dispatchEvent({type:"fade-change"}),s.dispatchEvent({type:"needs-render"})),n||s.visibleTiles.forEach((e=>{const t=e.cached.scene;t&&(t.visible=e.__inFrustum),this.forEachBatchIds(e,((t,n,r)=>{n.setVisibleAt(t,e.__inFrustum),r.batchedMesh.setVisibleAt(t,e.__inFrustum)}))})),o<this._fadingOutCount){let t=!0;l.forEach((e=>{if(!i.has(e))return;const n=e.matrixWorld,r=i.get(e);n.decompose(Oh,Uh,Bh),r.decompose(kh,Fh,Bh);const s=Uh.angleTo(Fh),o=Oh.distanceTo(kh);t=t&&(s>.25||o>.1)})),t&&e.completeAllFades()}if(l.forEach((e=>{i.get(e).copy(e.matrixWorld)})),e.forEachObject(((n,{fadeIn:r,fadeOut:i})=>{const o=n.cached.scene,a=e.isFadingOut(n);s.markTileUsed(n),o&&(t.setFade(o,r,i),a&&(o.visible=!0)),this.forEachBatchIds(n,((e,t,n)=>{t.setFadeAt(e,r,i),t.setVisibleAt(e,!0),n.batchedMesh.setVisibleAt(e,!1)}))})),a){const e=s.getPluginByName("BATCHED_TILES_PLUGIN").batchedMesh.material;a.material.map=e.map}}class jh{get fadeDuration(){return this._fadeManager.duration}set fadeDuration(e){this._fadeManager.duration=Number(e)}get fadingTiles(){return this._fadeManager.fadeCount}constructor(e){e={maximumFadeOutTiles:50,fadeRootTiles:!1,fadeDuration:250,...e},this.name="FADE_TILES_PLUGIN",this.priority=-2,this.tiles=null,this.batchedMesh=null,this._fadeManager=new Sh,this._fadeMaterialManager=new Ch,this._prevCameraTransforms=null,this._fadingOutCount=0,this.maximumFadeOutTiles=e.maximumFadeOutTiles,this.fadeRootTiles=e.fadeRootTiles,this.fadeDuration=e.fadeDuration}init(e){this._onLoadModel=({scene:e})=>{this._fadeMaterialManager.prepareScene(e)},this._onDisposeModel=({tile:e,scene:t})=>{this._fadeManager.deleteObject(e),this._fadeMaterialManager.deleteScene(t)},this._onAddCamera=({camera:e})=>{this._prevCameraTransforms.set(e,new Ne)},this._onDeleteCamera=({camera:e})=>{this._prevCameraTransforms.delete(e)},this._onTileVisibilityChange=({tile:e,visible:t})=>{const n=e.cached.scene;n&&(n.visible=!0),this.forEachBatchIds(e,((e,t,n)=>{t.setFadeAt(e,0,0),t.setVisibleAt(e,!1),n.batchedMesh.setVisibleAt(e,!1)}))},this._onUpdateBefore=()=>{zh.call(this)},this._onUpdateAfter=()=>{Nh.call(this)},e.addEventListener("load-model",this._onLoadModel),e.addEventListener("dispose-model",this._onDisposeModel),e.addEventListener("add-camera",this._onAddCamera),e.addEventListener("delete-camera",this._onDeleteCamera),e.addEventListener("update-before",this._onUpdateBefore),e.addEventListener("update-after",this._onUpdateAfter),e.addEventListener("tile-visibility-change",this._onTileVisibilityChange);const t=this._fadeManager;t.onFadeSetStart=()=>{e.dispatchEvent({type:"fade-start"}),e.dispatchEvent({type:"needs-render"})},t.onFadeSetComplete=()=>{e.dispatchEvent({type:"fade-end"}),e.dispatchEvent({type:"needs-render"})},t.onFadeComplete=(t,n)=>{this._fadeMaterialManager.setFade(t.cached.scene,0,0),this.forEachBatchIds(t,((e,t,r)=>{t.setFadeAt(e,0,0),t.setVisibleAt(e,!1),r.batchedMesh.setVisibleAt(e,n)})),n||(e.invokeOnePlugin((e=>e!==this&&e.setTileVisible&&e.setTileVisible(t,!1))),this._fadingOutCount--)};const n=new Map;e.cameras.forEach((e=>{n.set(e,new Ne)})),e.forEachLoadedModel(((e,t)=>{this._onLoadModel({scene:e})})),this.tiles=e,this._fadeManager=t,this._prevCameraTransforms=n}initBatchedMesh(){const e=this.tiles.getPluginByName("BATCHED_TILES_PLUGIN")?.batchedMesh;if(e){if(null===this.batchedMesh){this._onBatchedMeshDispose=()=>{this.batchedMesh.dispose(),this.batchedMesh.removeFromParent(),this.batchedMesh=null,e.removeEventListener("dispose",this._onBatchedMeshDispose)};const t=e.material.clone();t.onBeforeCompile=e.material.onBeforeCompile,this.batchedMesh=new Lh(e,t),this.tiles.group.add(this.batchedMesh)}}else null!==this.batchedMesh&&(this._onBatchedMeshDispose(),this._onBatchedMeshDispose=null)}setTileVisible(e,t){const n=this._fadeManager,r=n.isFading(e);if(n.isFadingOut(e)&&this._fadingOutCount--,t?1===e.__depthFromRenderedParent?((e[Dh]||this.fadeRootTiles)&&this._fadeManager.fadeIn(e),e[Dh]=!0):this._fadeManager.fadeIn(e):(this._fadingOutCount++,n.fadeOut(e)),r)return!0;const i=this._fadeManager.isFading(e);return!(t||!i)}dispose(){const e=this.tiles;this._fadeManager.completeAllFades(),null!==this.batchedMesh&&this._onBatchedMeshDispose(),e.removeEventListener("load-model",this._onLoadModel),e.removeEventListener("dispose-model",this._onDisposeModel),e.removeEventListener("add-camera",this._onAddCamera),e.removeEventListener("delete-camera",this._onDeleteCamera),e.removeEventListener("update-before",this._onUpdateBefore),e.removeEventListener("update-after",this._onUpdateAfter),e.removeEventListener("tile-visibility-change",this._onTileVisibilityChange),e.forEachLoadedModel(((e,t)=>{this._fadeManager.deleteObject(t),e&&(e.visible=!0)}))}forEachBatchIds(e,t){if(this.initBatchedMesh(),this.batchedMesh){const n=this.tiles.getPluginByName("BATCHED_TILES_PLUGIN"),r=n.getTileBatchIds(e);r&&r.forEach((e=>{t(e,this.batchedMesh,n)}))}}}const Hh=new ne,Gh=["x","y","z"];class Vh extends st{constructor(e,t=16776960,n=40){const r=new Ae,i=[];for(let s=0;s<3;s++){const e=Gh[s],t=Gh[(s+1)%3];Hh.set(0,0,0);for(let r=0;r<n;r++){let s;s=2*Math.PI*r/(n-1),Hh[e]=Math.sin(s),Hh[t]=Math.cos(s),i.push(Hh.x,Hh.y,Hh.z),s=2*Math.PI*(r+1)/(n-1),Hh[e]=Math.sin(s),Hh[t]=Math.cos(s),i.push(Hh.x,Hh.y,Hh.z)}}r.setAttribute("position",new $(new Float32Array(i),3)),r.computeBoundingSphere(),super(r,new ot({color:t,toneMapped:!1})),this.sphere=e,this.type="SphereHelper"}updateMatrixWorld(e){const t=this.sphere;this.position.copy(t.center),this.scale.setScalar(t.radius),super.updateMatrixWorld(e)}}const Wh=new ne,Xh=new ne,Kh=new ne;new ne,new ne;class qh extends st{constructor(e=new Oc,t=16776960){super(),this.ellipsoidRegion=e,this.material.color.set(t),this.update()}update(){const e=function(e,{computeNormals:t=!1}={}){const{latStart:n=-Math.PI/2,latEnd:r=Math.PI/2,lonStart:i=0,lonEnd:s=2*Math.PI,heightStart:o=0,heightEnd:a=0}=e,l=new Ot(1,1,1,32,32),{normal:c,position:u}=l.attributes,h=u.clone();for(let d=0,p=u.count;d<p;d++){Kh.fromBufferAttribute(u,d);const t=Y.mapLinear(Kh.x,-.5,.5,n,r),l=Y.mapLinear(Kh.y,-.5,.5,i,s);let c=o;e.getCartographicToNormal(t,l,Wh),Kh.z<0&&(c=a),e.getCartographicToPosition(t,l,c,Kh),u.setXYZ(d,...Kh)}t&&l.computeVertexNormals();for(let d=0,p=h.count;d<p;d++){Kh.fromBufferAttribute(h,d);const t=Y.mapLinear(Kh.x,-.5,.5,n,r),o=Y.mapLinear(Kh.y,-.5,.5,i,s);Wh.fromBufferAttribute(c,d),e.getCartographicToNormal(t,o,Xh),Math.abs(Wh.dot(Xh))>.1&&(Kh.z>0&&Xh.multiplyScalar(-1),c.setXYZ(d,...Xh))}return l}(this.ellipsoidRegion);this.geometry.dispose(),this.geometry=new at(e,80)}dispose(){this.geometry.dispose(),this.material.dispose()}}const Yh=Symbol("ORIGINAL_MATERIAL"),Zh=Symbol("HAS_RANDOM_COLOR"),$h=Symbol("HAS_RANDOM_NODE_COLOR"),Qh=Symbol("LOAD_TIME"),Jh=Symbol("PARENT_BOUND_REF_COUNT"),ed=new qe,td=()=>{},nd={};function rd(e){if(!nd[e]){const t=Math.random(),n=.5+.5*Math.random(),r=.375+.25*Math.random();nd[e]=(new q).setHSL(t,n,r)}return nd[e]}const id=Object.freeze({NONE:0,SCREEN_ERROR:1,GEOMETRIC_ERROR:2,DISTANCE:3,DEPTH:4,RELATIVE_DEPTH:5,IS_LEAF:6,RANDOM_COLOR:7,RANDOM_NODE_COLOR:8,CUSTOM_COLOR:9,LOAD_ORDER:10});class sd{static get ColorModes(){return id}get unlit(){return this._unlit}set unlit(e){e!==this._unlit&&(this._unlit=e,this.materialsNeedUpdate=!0)}get colorMode(){return this._colorMode}set colorMode(e){e!==this._colorMode&&(this._colorMode=e,this.materialsNeedUpdate=!0)}constructor(e){e={displayParentBounds:!1,displayBoxBounds:!1,displaySphereBounds:!1,displayRegionBounds:!1,colorMode:0,maxDebugDepth:-1,maxDebugDistance:-1,maxDebugError:-1,customColorCallback:null,unlit:!1,enabled:!0,...e},this.name="DEBUG_TILES_PLUGIN",this.tiles=null,this._colorMode=null,this._unlit=null,this.materialsNeedUpdate=!1,this.extremeDebugDepth=-1,this.extremeDebugError=-1,this.boxGroup=null,this.sphereGroup=null,this.regionGroup=null,this._enabled=e.enabled,this._displayParentBounds=e.displayParentBounds,this.displayBoxBounds=e.displayBoxBounds,this.displaySphereBounds=e.displaySphereBounds,this.displayRegionBounds=e.displayRegionBounds,this.colorMode=e.colorMode,this.maxDebugDepth=e.maxDebugDepth,this.maxDebugDistance=e.maxDebugDistance,this.maxDebugError=e.maxDebugError,this.customColorCallback=e.customColorCallback,this.unlit=e.unlit,this.getDebugColor=(e,t)=>{t.setRGB(e,e,e)}}get enabled(){return this._enabled}set enabled(e){e!==this._enabled&&null!==this.tiles&&(e?this.init(this.tiles):this.dispose()),this._enabled=e}get displayParentBounds(){return this._displayParentBounds}set displayParentBounds(e){this._displayParentBounds!==e&&(this._displayParentBounds=e,e?this.tiles.traverse((e=>{e.__visible&&this._onTileVisibilityChange(e,!0)})):ca(this.tiles.root,null,(e=>{e[Jh]=null,this._onTileVisibilityChange(e,e.__visible)})))}init(e){if(this.tiles=e,!this.enabled)return;const t=e.group;this.boxGroup=new Oe,this.boxGroup.name="DebugTilesRenderer.boxGroup",t.add(this.boxGroup),this.boxGroup.updateMatrixWorld(),this.sphereGroup=new Oe,this.sphereGroup.name="DebugTilesRenderer.sphereGroup",t.add(this.sphereGroup),this.sphereGroup.updateMatrixWorld(),this.regionGroup=new Oe,this.regionGroup.name="DebugTilesRenderer.regionGroup",t.add(this.regionGroup),this.regionGroup.updateMatrixWorld(),this._onLoadTileSetCB=()=>{this._initExtremes()},this._onLoadModelCB=({scene:e,tile:t})=>{this._onLoadModel(e,t)},this._onDisposeModelCB=({tile:e})=>{this._onDisposeModel(e)},this._onUpdateAfterCB=()=>{this._onUpdateAfter()},this._onTileVisibilityChangeCB=({scene:e,tile:t,visible:n})=>{this._onTileVisibilityChange(t,n)},e.addEventListener("load-tile-set",this._onLoadTileSetCB),e.addEventListener("load-model",this._onLoadModelCB),e.addEventListener("dispose-model",this._onDisposeModelCB),e.addEventListener("update-after",this._onUpdateAfterCB),e.addEventListener("tile-visibility-change",this._onTileVisibilityChangeCB),this._initExtremes(),e.traverse((e=>{e.cached.scene&&this._onLoadModel(e.cached.scene,e)})),e.visibleTiles.forEach((e=>{this._onTileVisibilityChange(e,!0)}))}getTileInformationFromActiveObject(e){let t=null;return this.tiles.activeTiles.forEach((n=>{if(t)return!0;const r=n.cached.scene;r&&r.traverse((r=>{r===e&&(t=n)}))})),t?{distanceToCamera:t.__distanceFromCamera,geometricError:t.geometricError,screenSpaceError:t.__error,depth:t.__depth,isLeaf:t.__isLeaf}:null}_initExtremes(){if(!this.tiles||!this.tiles.root)return;let e=-1,t=-1;ca(this.tiles.root,null,((n,r,i)=>{e=Math.max(e,i),t=Math.max(t,n.geometricError)})),this.extremeDebugDepth=e,this.extremeDebugError=t}_onUpdateAfter(){const{tiles:e,colorMode:t}=this;if(!e.root)return;this.materialsNeedUpdate&&(e.forEachLoadedModel((e=>{this._updateMaterial(e)})),this.materialsNeedUpdate=!1),this.boxGroup.visible=this.displayBoxBounds,this.sphereGroup.visible=this.displaySphereBounds,this.regionGroup.visible=this.displayRegionBounds;let n=-1;n=-1===this.maxDebugDepth?this.extremeDebugDepth:this.maxDebugDepth;let r=-1;r=-1===this.maxDebugError?this.extremeDebugError:this.maxDebugError;let i=-1;-1===this.maxDebugDistance?(e.getBoundingSphere(ed),i=ed.radius):i=this.maxDebugDistance;const{errorTarget:s,visibleTiles:o}=e;let a;10===t&&(a=Array.from(o).sort(((e,t)=>e[Qh]-t[Qh]))),o.forEach((e=>{const o=e.cached.scene;let l,c,u;7===t&&(l=Math.random(),c=.5+.5*Math.random(),u=.375+.25*Math.random()),o.traverse((o=>{if(8===t&&(l=Math.random(),c=.5+.5*Math.random(),u=.375+.25*Math.random()),o.material)switch(7!==t&&delete o.material[Zh],8!==t&&delete o.material[$h],t){case 4:{const t=e.__depth/n;this.getDebugColor(t,o.material.color);break}case 5:{const t=e.__depthFromRenderedParent/n;this.getDebugColor(t,o.material.color);break}case 1:{const t=e.__error/s;t>1?o.material.color.setRGB(1,0,0):this.getDebugColor(t,o.material.color);break}case 2:{const t=Math.min(e.geometricError/r,1);this.getDebugColor(t,o.material.color);break}case 3:{const t=Math.min(e.__distanceFromCamera/i,1);this.getDebugColor(t,o.material.color);break}case 6:e.children&&0!==e.children.length?this.getDebugColor(0,o.material.color):this.getDebugColor(1,o.material.color);break;case 8:o.material[$h]||(o.material.color.setHSL(l,c,u),o.material[$h]=!0);break;case 7:o.material[Zh]||(o.material.color.setHSL(l,c,u),o.material[Zh]=!0);break;case 9:this.customColorCallback?this.customColorCallback(e,o):console.warn("DebugTilesRenderer: customColorCallback not defined");break;case 10:{const t=a.indexOf(e);this.getDebugColor(t/(a.length-1),o.material.color);break}}}))}))}_onTileVisibilityChange(e,t){this.displayParentBounds?function(e,t=null){let n=e;for(;n;){const e=n.__depth,r=n.parent;t&&t(n,r,e),n=r}}(e,(n=>{null==n[Jh]&&(n[Jh]=0),t?n[Jh]++:n[Jh]>0&&n[Jh]--;const r=n===e&&t||this.displayParentBounds&&n[Jh]>0;this._updateBoundHelper(n,r)})):this._updateBoundHelper(e,t)}_createBoundHelper(e){const t=this.tiles,n=e.cached,{sphere:r,obb:i,region:s}=n.boundingVolume;if(i){const r=new Oe;r.name="DebugTilesRenderer.boxHelperGroup",r.matrix.copy(i.transform),r.matrixAutoUpdate=!1;const s=new Ye(i.box,rd(e.__depth));s.raycast=td,r.add(s),n.boxHelperGroup=r,t.visibleTiles.has(e)&&this.displayBoxBounds&&(this.boxGroup.add(r),r.updateMatrixWorld(!0))}if(r){const i=new Vh(r,rd(e.__depth));i.raycast=td,n.sphereHelper=i,t.visibleTiles.has(e)&&this.displaySphereBounds&&(this.sphereGroup.add(i),i.updateMatrixWorld(!0))}if(s){const r=new qh(s,rd(e.__depth));r.raycast=td;const i=new qe;s.getBoundingSphere(i),r.position.copy(i.center),i.center.multiplyScalar(-1),r.geometry.translate(...i.center),n.regionHelper=r,t.visibleTiles.has(e)&&this.displayRegionBounds&&(this.regionGroup.add(r),r.updateMatrixWorld(!0))}}_updateHelperMaterial(e,t){e.__visible||!this.displayParentBounds?t.opacity=1:t.opacity=.2;const n=t.transparent;t.transparent=t.opacity<1,t.transparent!==n&&(t.needsUpdate=!0)}_updateBoundHelper(e,t){const n=e.cached;if(!n)return;const r=this.sphereGroup,i=this.boxGroup,s=this.regionGroup;t&&null==n.boxHelperGroup&&null==n.sphereHelper&&null==n.regionHelper&&this._createBoundHelper(e);const o=n.boxHelperGroup,a=n.sphereHelper,l=n.regionHelper;t?(o&&(i.add(o),o.updateMatrixWorld(!0),this._updateHelperMaterial(e,o.children[0].material)),a&&(r.add(a),a.updateMatrixWorld(!0),this._updateHelperMaterial(e,a.material)),l&&(s.add(l),l.updateMatrixWorld(!0),this._updateHelperMaterial(e,l.material))):(o&&i.remove(o),a&&r.remove(a),l&&s.remove(l))}_updateMaterial(e){const{colorMode:t,unlit:n}=this;e.traverse((e=>{if(!e.material)return;const r=e.material,i=e[Yh];if(r!==i&&r.dispose(),0!==t||n){if(e.isPoints){const t=new je;t.size=i.size,t.sizeAttenuation=i.sizeAttenuation,e.material=t}else n?e.material=new ie:(e.material=new Ze,e.material.flatShading=!0);0===t&&(e.material.map=i.map,e.material.color.set(i.color))}else e.material=i}))}_onLoadModel(e,t){t[Qh]=performance.now(),e.traverse((e=>{const t=e.material;t&&(e[Yh]=t)})),this._updateMaterial(e)}_onDisposeModel(e){const t=e.cached;t.boxHelperGroup&&(t.boxHelperGroup.children[0].geometry.dispose(),delete t.boxHelperGroup),t.sphereHelper&&(t.sphereHelper.geometry.dispose(),delete t.sphereHelper),t.regionHelper&&(t.regionHelper.geometry.dispose(),delete t.regionHelper)}dispose(){if(!this.enabled)return;const e=this.tiles;e.removeEventListener("load-tile-set",this._onLoadTileSetCB),e.removeEventListener("load-model",this._onLoadModelCB),e.removeEventListener("dispose-model",this._onDisposeModelCB),e.removeEventListener("update-after",this._onUpdateAfterCB),e.removeEventListener("tile-visibility-change",this._onTileVisibilityChangeCB),this.colorMode=0,this.unlit=!1,e.forEachLoadedModel((e=>{this._updateMaterial(e)})),e.traverse((e=>{this._onDisposeModel(e)})),this.boxGroup?.removeFromParent(),this.sphereGroup?.removeFromParent(),this.regionGroup?.removeFromParent()}}const od=["object"],ad=e({__name:"XYZTiles",props:{url:{},lruCacheMinSize:{default:900},lruCacheMaxSize:{default:1300},parseQueueMaxJobs:{default:10},errorTarget:{default:10},displayActiveTiles:{type:Boolean,default:!0},autoDisableRendererCulling:{type:Boolean,default:!0},tilesPlugins:{default:()=>({fadePlugin:{maximumFadeOutTiles:200},xyzPlugin:{center:!0,shape:"ellipsoid"}})}},setup(e){const{camera:t,renderer:n}=fr(),r=e;let i=B(new eu(r.url));function o(){i&&i.dispose(),i=B(new eu(r.url)),i.registerPlugin(new jh(r.tilesPlugins.fadePlugin)),i.registerPlugin(new Mh),i.registerPlugin(new wh(r.tilesPlugins.xyzPlugin)),i.lruCache.minSize=r.lruCacheMinSize,i.lruCache.maxSize=r.lruCacheMaxSize,i.parseQueue.maxJobs=r.parseQueueMaxJobs,i.setCamera(t.value),i.setResolutionFromRenderer(t.value,n.value),i.errorTarget=r.errorTarget,i.displayActiveTiles=r.displayActiveTiles,i.autoDisableRendererCulling=r.autoDisableRendererCulling}o(),a((()=>r.url),((e,t)=>{e!==t&&o()})),a((()=>r),(()=>{o()}),{deep:!0});const{onBeforeLoop:u}=Sr();return u((()=>{i&&(i.setResolutionFromRenderer(t.value,n.value),i.update())})),l((()=>{i&&i.dispose()})),(e,t)=>h(i)?(c(),s("primitive",{key:0,object:h(i).group},null,8,od)):C("",!0)}}),ld=e({__name:"TDTTiles",props:{url:{default:"https://t0.tianditu.gov.cn"},service:{default:"WMTS"},request:{default:"GetTile"},version:{default:"1.0.0"},layer:{default:"vec"},tileStyle:{default:"default"},tileMatrixSet:{default:"w"},format:{default:"tiles"},tk:{default:"您的密钥"}},setup(e){const t=e,n=g((()=>`${t.url}/${t.layer}_${t.tileMatrixSet}/${t.service.toLowerCase()}?SERVICE=${t.service.toUpperCase()}&REQUEST=${t.request}&VERSION=${t.version}&LAYER=${t.layer}&STYLE=${t.tileStyle}&TILEMATRIXSET=${t.tileMatrixSet}&FORMAT=${t.format}&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=${t.tk}`));return(e,t)=>(c(),P(ad,{url:n.value},null,8,["url"]))}});function cd(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ud(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t
/*!
 * GSAP 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/}var hd,dd,pd,fd,md,gd,vd,yd,_d,xd,bd,wd,Td,Md,Ad,Sd,Ed,Pd={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Cd={duration:.5,overwrite:!1,delay:0},Rd=1e8,Ld=1e-8,Id=2*Math.PI,Dd=Id/4,kd=0,Od=Math.sqrt,Fd=Math.cos,Ud=Math.sin,Bd=function(e){return"string"==typeof e},zd=function(e){return"function"==typeof e},Nd=function(e){return"number"==typeof e},jd=function(e){return typeof e>"u"},Hd=function(e){return"object"==typeof e},Gd=function(e){return!1!==e},Vd=function(){return typeof window<"u"},Wd=function(e){return zd(e)||Bd(e)},Xd="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},Kd=Array.isArray,qd=/(?:-?\.?\d|\.)+/gi,Yd=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Zd=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,$d=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,Qd=/[+-]=-?[.\d]+/,Jd=/[^,'"\[\]\s]+/gi,ep=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,tp={},np={},rp=function(e){return(np=Dp(e,tp))&&km},ip=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},sp=function(e,t){return!t&&console.warn(e)},op=function(e,t){return e&&(tp[e]=t)&&np&&(np[e]=t)||tp},ap=function(){return 0},lp={suppressEvents:!0,isStart:!0,kill:!1},cp={suppressEvents:!0,kill:!1},up={suppressEvents:!0},hp={},dp=[],pp={},fp={},mp={},gp=30,vp=[],yp="",_p=function(e){var t,n,r=e[0];if(Hd(r)||zd(r)||(e=[e]),!(t=(r._gsap||{}).harness)){for(n=vp.length;n--&&!vp[n].targetTest(r););t=vp[n]}for(n=e.length;n--;)e[n]&&(e[n]._gsap||(e[n]._gsap=new qf(e[n],t)))||e.splice(n,1);return e},xp=function(e){return e._gsap||_p(hf(e))[0]._gsap},bp=function(e,t,n){return(n=e[t])&&zd(n)?e[t]():jd(n)&&e.getAttribute&&e.getAttribute(t)||n},wp=function(e,t){return(e=e.split(",")).forEach(t)||e},Tp=function(e){return Math.round(1e5*e)/1e5||0},Mp=function(e){return Math.round(1e7*e)/1e7||0},Ap=function(e,t){var n=t.charAt(0),r=parseFloat(t.substr(2));return e=parseFloat(e),"+"===n?e+r:"-"===n?e-r:"*"===n?e*r:e/r},Sp=function(e,t){for(var n=t.length,r=0;e.indexOf(t[r])<0&&++r<n;);return r<n},Ep=function(){var e,t,n=dp.length,r=dp.slice(0);for(pp={},dp.length=0,e=0;e<n;e++)(t=r[e])&&t._lazy&&(t.render(t._lazy[0],t._lazy[1],!0)._lazy=0)},Pp=function(e){return!!(e._initted||e._startAt||e.add)},Cp=function(e,t,n,r){dp.length&&!dd&&Ep(),e.render(t,n,!!(dd&&t<0&&Pp(e))),dp.length&&!dd&&Ep()},Rp=function(e){var t=parseFloat(e);return(t||0===t)&&(e+"").match(Jd).length<2?t:Bd(e)?e.trim():e},Lp=function(e){return e},Ip=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},Dp=function(e,t){for(var n in t)e[n]=t[n];return e},kp=function e(t,n){for(var r in n)"__proto__"!==r&&"constructor"!==r&&"prototype"!==r&&(t[r]=Hd(n[r])?e(t[r]||(t[r]={}),n[r]):n[r]);return t},Op=function(e,t){var n,r={};for(n in e)n in t||(r[n]=e[n]);return r},Fp=function(e){var t=e.parent||fd,n=e.keyframes?function(e){return function(t,n){for(var r in n)r in t||"duration"===r&&e||"ease"===r||(t[r]=n[r])}}(Kd(e.keyframes)):Ip;if(Gd(e.inherit))for(;t;)n(e,t.vars.defaults),t=t.parent||t._dp;return e},Up=function(e,t,n,r,i){var s,o=e[r];if(i)for(s=t[i];o&&o[i]>s;)o=o._prev;return o?(t._next=o._next,o._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[r]=t,t._prev=o,t.parent=t._dp=e,t},Bp=function(e,t,n,r){void 0===n&&(n="_first"),void 0===r&&(r="_last");var i=t._prev,s=t._next;i?i._next=s:e[n]===t&&(e[n]=s),s?s._prev=i:e[r]===t&&(e[r]=i),t._next=t._prev=t.parent=null},zp=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},Np=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},jp=function(e,t,n,r){return e._startAt&&(dd?e._startAt.revert(cp):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,r))},Hp=function e(t){return!t||t._ts&&e(t.parent)},Gp=function(e){return e._repeat?Vp(e._tTime,e=e.duration()+e._rDelay)*e:0},Vp=function(e,t){var n=Math.floor(e=Mp(e/t));return e&&n===e?n-1:n},Wp=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},Xp=function(e){return e._end=Mp(e._start+(e._tDur/Math.abs(e._ts||e._rts||Ld)||0))},Kp=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=Mp(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),Xp(e),n._dirty||Np(n,e)),e},qp=function(e,t){var n;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(n=Wp(e.rawTime(),t),(!t._dur||af(0,t.totalDuration(),n)-t._tTime>Ld)&&t.render(n,!0)),Np(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-1e-8}},Yp=function(e,t,n,r){return t.parent&&zp(t),t._start=Mp((Nd(n)?n:n||e!==fd?rf(e,n,t):e._time)+t._delay),t._end=Mp(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),Up(e,t,"_first","_last",e._sort?"_start":0),Jp(t)||(e._recent=t),r||qp(e,t),e._ts<0&&Kp(e,e._tTime),e},Zp=function(e,t){return(tp.ScrollTrigger||ip("scrollTrigger",t))&&tp.ScrollTrigger.create(t,e)},$p=function(e,t,n,r,i){return nm(e,t,i),e._initted?!n&&e._pt&&!dd&&(e._dur&&!1!==e.vars.lazy||!e._dur&&e.vars.lazy)&&_d!==Of.frame?(dp.push(e),e._lazy=[i,r],1):void 0:1},Qp=function e(t){var n=t.parent;return n&&n._ts&&n._initted&&!n._lock&&(n.rawTime()<0||e(n))},Jp=function(e){var t=e.data;return"isFromStart"===t||"isStart"===t},ef=function(e,t,n,r){var i=e._repeat,s=Mp(t)||0,o=e._tTime/e._tDur;return o&&!r&&(e._time*=s/e._dur),e._dur=s,e._tDur=i?i<0?1e10:Mp(s*(i+1)+e._rDelay*i):s,o>0&&!r&&Kp(e,e._tTime=e._tDur*o),e.parent&&Xp(e),n||Np(e.parent,e),e},tf=function(e){return e instanceof Zf?Np(e):ef(e,e._dur)},nf={_start:0,endTime:ap,totalDuration:ap},rf=function e(t,n,r){var i,s,o,a=t.labels,l=t._recent||nf,c=t.duration()>=Rd?l.endTime(!1):t._dur;return Bd(n)&&(isNaN(n)||n in a)?(s=n.charAt(0),o="%"===n.substr(-1),i=n.indexOf("="),"<"===s||">"===s?(i>=0&&(n=n.replace(/=/,"")),("<"===s?l._start:l.endTime(l._repeat>=0))+(parseFloat(n.substr(1))||0)*(o?(i<0?l:r).totalDuration()/100:1)):i<0?(n in a||(a[n]=c),a[n]):(s=parseFloat(n.charAt(i-1)+n.substr(i+1)),o&&r&&(s=s/100*(Kd(r)?r[0]:r).totalDuration()),i>1?e(t,n.substr(0,i-1),r)+s:c+s)):null==n?c:+n},sf=function(e,t,n){var r,i,s=Nd(t[1]),o=(s?2:1)+(e<2?0:1),a=t[o];if(s&&(a.duration=t[1]),a.parent=n,e){for(r=a,i=n;i&&!("immediateRender"in r);)r=i.vars.defaults||{},i=Gd(i.vars.inherit)&&i.parent;a.immediateRender=Gd(r.immediateRender),e<2?a.runBackwards=1:a.startAt=t[o-1]}return new am(t[0],a,t[o+1])},of=function(e,t){return e||0===e?t(e):t},af=function(e,t,n){return n<e?e:n>t?t:n},lf=function(e,t){return Bd(e)&&(t=ep.exec(e))?t[1]:""},cf=[].slice,uf=function(e,t){return e&&Hd(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&Hd(e[0]))&&!e.nodeType&&e!==md},hf=function(e,t,n){return pd&&!t&&pd.selector?pd.selector(e):!Bd(e)||n||!gd&&Ff()?Kd(e)?function(e,t,n){return void 0===n&&(n=[]),e.forEach((function(e){var r;return Bd(e)&&!t||uf(e,1)?(r=n).push.apply(r,hf(e)):n.push(e)}))||n}(e,n):uf(e)?cf.call(e,0):e?[e]:[]:cf.call((t||vd).querySelectorAll(e),0)},df=function(e){return e=hf(e)[0]||sp("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return hf(t,n.querySelectorAll?n:n===e?sp("Invalid scope")||vd.createElement("div"):e)}},pf=function(e){return e.sort((function(){return.5-Math.random()}))},ff=function(e){if(zd(e))return e;var t=Hd(e)?e:{each:e},n=Gf(t.ease),r=t.from||0,i=parseFloat(t.base)||0,s={},o=r>0&&r<1,a=isNaN(r)||o,l=t.axis,c=r,u=r;return Bd(r)?c=u={center:.5,edges:.5,end:1}[r]||0:!o&&a&&(c=r[0],u=r[1]),function(e,o,h){var d,p,f,m,g,v,y,_,x,b=(h||t).length,w=s[b];if(!w){if(!(x="auto"===t.grid?0:(t.grid||[1,Rd])[1])){for(y=-1e8;y<(y=h[x++].getBoundingClientRect().left)&&x<b;);x<b&&x--}for(w=s[b]=[],d=a?Math.min(x,b)*c-.5:r%x,p=x===Rd?0:a?b*u/x-.5:r/x|0,y=0,_=Rd,v=0;v<b;v++)f=v%x-d,m=p-(v/x|0),w[v]=g=l?Math.abs("y"===l?m:f):Od(f*f+m*m),g>y&&(y=g),g<_&&(_=g);"random"===r&&pf(w),w.max=y-_,w.min=_,w.v=b=(parseFloat(t.amount)||parseFloat(t.each)*(x>b?b-1:l?"y"===l?b/x:x:Math.max(x,b/x))||0)*("edges"===r?-1:1),w.b=b<0?i-b:i,w.u=lf(t.amount||t.each)||0,n=n&&b<0?jf(n):n}return b=(w[e]-w.min)/w.max||0,Mp(w.b+(n?n(b):b)*w.v)+w.u}},mf=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(n){var r=Mp(Math.round(parseFloat(n)/e)*e*t);return(r-r%1)/t+(Nd(n)?0:lf(n))}},gf=function(e,t){var n,r,i=Kd(e);return!i&&Hd(e)&&(n=i=e.radius||Rd,e.values?(e=hf(e.values),(r=!Nd(e[0]))&&(n*=n)):e=mf(e.increment)),of(t,i?zd(e)?function(t){return r=e(t),Math.abs(r-t)<=n?r:t}:function(t){for(var i,s,o=parseFloat(r?t.x:t),a=parseFloat(r?t.y:0),l=Rd,c=0,u=e.length;u--;)r?i=(i=e[u].x-o)*i+(s=e[u].y-a)*s:i=Math.abs(e[u]-o),i<l&&(l=i,c=u);return c=!n||l<=n?e[c]:t,r||c===t||Nd(t)?c:c+lf(t)}:mf(e))},vf=function(e,t,n,r){return of(Kd(e)?!t:!0===n?!!(n=0):!r,(function(){return Kd(e)?e[~~(Math.random()*e.length)]:(n=n||1e-5)&&(r=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+.99*n))/n)*n*r)/r}))},yf=function(e,t,n){return of(n,(function(n){return e[~~t(n)]}))},_f=function(e){for(var t,n,r,i,s=0,o="";~(t=e.indexOf("random(",s));)r=e.indexOf(")",t),i="["===e.charAt(t+7),n=e.substr(t+7,r-t-7).match(i?Jd:qd),o+=e.substr(s,t-s)+vf(i?n:+n[0],i?0:+n[1],+n[2]||1e-5),s=r+1;return o+e.substr(s,e.length-s)},xf=function(e,t,n,r,i){var s=t-e,o=r-n;return of(i,(function(t){return n+((t-e)/s*o||0)}))},bf=function(e,t,n){var r,i,s,o=e.labels,a=Rd;for(r in o)(i=o[r]-t)<0==!!n&&i&&a>(i=Math.abs(i))&&(s=r,a=i);return s},wf=function(e,t,n){var r,i,s,o=e.vars,a=o[t],l=pd,c=e._ctx;if(a)return r=o[t+"Params"],i=o.callbackScope||e,n&&dp.length&&Ep(),c&&(pd=c),s=r?a.apply(i,r):a.call(i),pd=l,s},Tf=function(e){return zp(e),e.scrollTrigger&&e.scrollTrigger.kill(!!dd),e.progress()<1&&wf(e,"onInterrupt"),e},Mf=[],Af=function(e){if(e)if(e=!e.name&&e.default||e,Vd()||e.headless){var t=e.name,n=zd(e),r=t&&!n&&e.init?function(){this._props=[]}:e,i={init:ap,render:gm,add:em,kill:ym,modifier:vm,rawVars:0},s={targetTest:0,get:0,getSetter:dm,aliases:{},register:0};if(Ff(),e!==r){if(fp[t])return;Ip(r,Ip(Op(e,i),s)),Dp(r.prototype,Dp(i,Op(e,s))),fp[r.prop=t]=r,e.targetTest&&(vp.push(r),hp[t]=1),t=("css"===t?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}op(t,r),e.register&&e.register(km,r,bm)}else Mf.push(e)},Sf=255,Ef={aqua:[0,Sf,Sf],lime:[0,Sf,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Sf],navy:[0,0,128],white:[Sf,Sf,Sf],olive:[128,128,0],yellow:[Sf,Sf,0],orange:[Sf,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Sf,0,0],pink:[Sf,192,203],cyan:[0,Sf,Sf],transparent:[Sf,Sf,Sf,0]},Pf=function(e,t,n){return(6*(e+=e<0?1:e>1?-1:0)<1?t+(n-t)*e*6:e<.5?n:3*e<2?t+(n-t)*(2/3-e)*6:t)*Sf+.5|0},Cf=function(e,t,n){var r,i,s,o,a,l,c,u,h,d,p=e?Nd(e)?[e>>16,e>>8&Sf,e&Sf]:0:Ef.black;if(!p){if(","===e.substr(-1)&&(e=e.substr(0,e.length-1)),Ef[e])p=Ef[e];else if("#"===e.charAt(0)){if(e.length<6&&(r=e.charAt(1),i=e.charAt(2),s=e.charAt(3),e="#"+r+r+i+i+s+s+(5===e.length?e.charAt(4)+e.charAt(4):"")),9===e.length)return[(p=parseInt(e.substr(1,6),16))>>16,p>>8&Sf,p&Sf,parseInt(e.substr(7),16)/255];p=[(e=parseInt(e.substr(1),16))>>16,e>>8&Sf,e&Sf]}else if("hsl"===e.substr(0,3))if(p=d=e.match(qd),t){if(~e.indexOf("="))return p=e.match(Yd),n&&p.length<4&&(p[3]=1),p}else o=+p[0]%360/360,a=+p[1]/100,r=2*(l=+p[2]/100)-(i=l<=.5?l*(a+1):l+a-l*a),p.length>3&&(p[3]*=1),p[0]=Pf(o+1/3,r,i),p[1]=Pf(o,r,i),p[2]=Pf(o-1/3,r,i);else p=e.match(qd)||Ef.transparent;p=p.map(Number)}return t&&!d&&(r=p[0]/Sf,i=p[1]/Sf,s=p[2]/Sf,l=((c=Math.max(r,i,s))+(u=Math.min(r,i,s)))/2,c===u?o=a=0:(h=c-u,a=l>.5?h/(2-c-u):h/(c+u),o=c===r?(i-s)/h+(i<s?6:0):c===i?(s-r)/h+2:(r-i)/h+4,o*=60),p[0]=~~(o+.5),p[1]=~~(100*a+.5),p[2]=~~(100*l+.5)),n&&p.length<4&&(p[3]=1),p},Rf=function(e){var t=[],n=[],r=-1;return e.split(If).forEach((function(e){var i=e.match(Zd)||[];t.push.apply(t,i),n.push(r+=i.length+1)})),t.c=n,t},Lf=function(e,t,n){var r,i,s,o,a="",l=(e+a).match(If),c=t?"hsla(":"rgba(",u=0;if(!l)return e;if(l=l.map((function(e){return(e=Cf(e,t,1))&&c+(t?e[0]+","+e[1]+"%,"+e[2]+"%,"+e[3]:e.join(","))+")"})),n&&(s=Rf(e),(r=n.c).join(a)!==s.c.join(a)))for(o=(i=e.replace(If,"1").split(Zd)).length-1;u<o;u++)a+=i[u]+(~r.indexOf(u)?l.shift()||c+"0,0,0,0)":(s.length?s:l.length?l:n).shift());if(!i)for(o=(i=e.split(If)).length-1;u<o;u++)a+=i[u]+l[u];return a+i[o]},If=function(){var e,t="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(e in Ef)t+="|"+e+"\\b";return new RegExp(t+")","gi")}(),Df=/hsl[a]?\(/,kf=function(e){var t,n=e.join(" ");if(If.lastIndex=0,If.test(n))return t=Df.test(n),e[1]=Lf(e[1],t),e[0]=Lf(e[0],t,Rf(e[1])),!0},Of=function(){var e,t,n,r,i,s,o=Date.now,a=500,l=33,c=o(),u=c,h=1e3/240,d=h,p=[],f=function n(f){var m,g,v,y,_=o()-u,x=!0===f;if((_>a||_<0)&&(c+=_-l),((m=(v=(u+=_)-c)-d)>0||x)&&(y=++r.frame,i=v-1e3*r.time,r.time=v/=1e3,d+=m+(m>=h?4:h-m),g=1),x||(e=t(n)),g)for(s=0;s<p.length;s++)p[s](v,i,y,f)};return r={time:0,frame:0,tick:function(){f(!0)},deltaRatio:function(e){return i/(1e3/(e||60))},wake:function(){yd&&(!gd&&Vd()&&(md=gd=window,vd=md.document||{},tp.gsap=km,(md.gsapVersions||(md.gsapVersions=[])).push(km.version),rp(np||md.GreenSockGlobals||!md.gsap&&md||{}),Mf.forEach(Af)),n=typeof requestAnimationFrame<"u"&&requestAnimationFrame,e&&r.sleep(),t=n||function(e){return setTimeout(e,d-1e3*r.time+1|0)},bd=1,f(2))},sleep:function(){(n?cancelAnimationFrame:clearTimeout)(e),bd=0,t=ap},lagSmoothing:function(e,t){a=e||1/0,l=Math.min(t||33,a)},fps:function(e){h=1e3/(e||240),d=1e3*r.time+h},add:function(e,t,n){var i=t?function(t,n,s,o){e(t,n,s,o),r.remove(i)}:e;return r.remove(e),p[n?"unshift":"push"](i),Ff(),i},remove:function(e,t){~(t=p.indexOf(e))&&p.splice(t,1)&&s>=t&&s--},_listeners:p}}(),Ff=function(){return!bd&&Of.wake()},Uf={},Bf=/^[\d.\-M][\d.\-,\s]/,zf=/["']/g,Nf=function(e){for(var t,n,r,i={},s=e.substr(1,e.length-3).split(":"),o=s[0],a=1,l=s.length;a<l;a++)n=s[a],t=a!==l-1?n.lastIndexOf(","):n.length,r=n.substr(0,t),i[o]=isNaN(r)?r.replace(zf,"").trim():+r,o=n.substr(t+1).trim();return i},jf=function(e){return function(t){return 1-e(1-t)}},Hf=function e(t,n){for(var r,i=t._first;i;)i instanceof Zf?e(i,n):i.vars.yoyoEase&&(!i._yoyo||!i._repeat)&&i._yoyo!==n&&(i.timeline?e(i.timeline,n):(r=i._ease,i._ease=i._yEase,i._yEase=r,i._yoyo=n)),i=i._next},Gf=function(e,t){return e&&(zd(e)?e:Uf[e]||function(e){var t=(e+"").split("("),n=Uf[t[0]];return n&&t.length>1&&n.config?n.config.apply(null,~e.indexOf("{")?[Nf(t[1])]:function(e){var t=e.indexOf("(")+1,n=e.indexOf(")"),r=e.indexOf("(",t);return e.substring(t,~r&&r<n?e.indexOf(")",n+1):n)}(e).split(",").map(Rp)):Uf._CE&&Bf.test(e)?Uf._CE("",e):n}(e))||t},Vf=function(e,t,n,r){void 0===n&&(n=function(e){return 1-t(1-e)}),void 0===r&&(r=function(e){return e<.5?t(2*e)/2:1-t(2*(1-e))/2});var i,s={easeIn:t,easeOut:n,easeInOut:r};return wp(e,(function(e){for(var t in Uf[e]=tp[e]=s,Uf[i=e.toLowerCase()]=n,s)Uf[i+("easeIn"===t?".in":"easeOut"===t?".out":".inOut")]=Uf[e+"."+t]=s[t]})),s},Wf=function(e){return function(t){return t<.5?(1-e(1-2*t))/2:.5+e(2*(t-.5))/2}},Xf=function e(t,n,r){var i=n>=1?n:1,s=(r||(t?.3:.45))/(n<1?n:1),o=s/Id*(Math.asin(1/i)||0),a=function(e){return 1===e?1:i*Math.pow(2,-10*e)*Ud((e-o)*s)+1},l="out"===t?a:"in"===t?function(e){return 1-a(1-e)}:Wf(a);return s=Id/s,l.config=function(n,r){return e(t,n,r)},l},Kf=function e(t,n){void 0===n&&(n=1.70158);var r=function(e){return e?--e*e*((n+1)*e+n)+1:0},i="out"===t?r:"in"===t?function(e){return 1-r(1-e)}:Wf(r);return i.config=function(n){return e(t,n)},i};wp("Linear,Quad,Cubic,Quart,Quint,Strong",(function(e,t){var n=t<5?t+1:t;Vf(e+",Power"+(n-1),t?function(e){return Math.pow(e,n)}:function(e){return e},(function(e){return 1-Math.pow(1-e,n)}),(function(e){return e<.5?Math.pow(2*e,n)/2:1-Math.pow(2*(1-e),n)/2}))})),Uf.Linear.easeNone=Uf.none=Uf.Linear.easeIn,Vf("Elastic",Xf("in"),Xf("out"),Xf()),wd=7.5625,Ad=2*(Md=1/(Td=2.75)),Sd=2.5*Md,Vf("Bounce",(function(e){return 1-Ed(1-e)}),Ed=function(e){return e<Md?wd*e*e:e<Ad?wd*Math.pow(e-1.5/Td,2)+.75:e<Sd?wd*(e-=2.25/Td)*e+.9375:wd*Math.pow(e-2.625/Td,2)+.984375}),Vf("Expo",(function(e){return Math.pow(2,10*(e-1))*e+e*e*e*e*e*e*(1-e)})),Vf("Circ",(function(e){return-(Od(1-e*e)-1)})),Vf("Sine",(function(e){return 1===e?1:1-Fd(e*Dd)})),Vf("Back",Kf("in"),Kf("out"),Kf()),Uf.SteppedEase=Uf.steps=tp.SteppedEase={config:function(e,t){void 0===e&&(e=1);var n=1/e,r=e+(t?0:1),i=t?1:0,s=1-Ld;return function(e){return((r*af(0,s,e)|0)+i)*n}}},Cd.ease=Uf["quad.out"],wp("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",(function(e){return yp+=e+","+e+"Params,"}));var qf=function(e,t){this.id=kd++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:bp,this.set=t?t.getSetter:dm},Yf=function(){function e(e){this.vars=e,this._delay=+e.delay||0,(this._repeat=e.repeat===1/0?-2:e.repeat||0)&&(this._rDelay=e.repeatDelay||0,this._yoyo=!!e.yoyo||!!e.yoyoEase),this._ts=1,ef(this,+e.duration,1,1),this.data=e.data,pd&&(this._ctx=pd,pd.data.push(this)),bd||Of.wake()}var t=e.prototype;return t.delay=function(e){return e||0===e?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+e-this._delay),this._delay=e,this):this._delay},t.duration=function(e){return arguments.length?this.totalDuration(this._repeat>0?e+(e+this._rDelay)*this._repeat:e):this.totalDuration()&&this._dur},t.totalDuration=function(e){return arguments.length?(this._dirty=0,ef(this,this._repeat<0?e:(e-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},t.totalTime=function(e,t){if(Ff(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(Kp(this,e),!n._dp||n.parent||qp(n,this);n&&n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&e<this._tDur||this._ts<0&&e>0||!this._tDur&&!e)&&Yp(this._dp,this,this._start-this._delay)}return(this._tTime!==e||!this._dur&&!t||this._initted&&Math.abs(this._zTime)===Ld||!e&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=e),Cp(this,e,t)),this},t.time=function(e,t){return arguments.length?this.totalTime(Math.min(this.totalDuration(),e+Gp(this))%(this._dur+this._rDelay)||(e?this._dur:0),t):this._time},t.totalProgress=function(e,t){return arguments.length?this.totalTime(this.totalDuration()*e,t):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},t.progress=function(e,t){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?e:1-e)+Gp(this),t):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},t.iteration=function(e,t){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(e-1)*n,t):this._repeat?Vp(this._tTime,n)+1:1},t.timeScale=function(e,t){if(!arguments.length)return-1e-8===this._rts?0:this._rts;if(this._rts===e)return this;var n=this.parent&&this._ts?Wp(this.parent._time,this):this._tTime;return this._rts=+e||0,this._ts=this._ps||-1e-8===e?0:this._rts,this.totalTime(af(-Math.abs(this._delay),this.totalDuration(),n),!1!==t),Xp(this),function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e}(this)},t.paused=function(e){return arguments.length?(this._ps!==e&&(this._ps=e,e?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Ff(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==Ld&&(this._tTime-=Ld)))),this):this._ps},t.startTime=function(e){if(arguments.length){this._start=e;var t=this.parent||this._dp;return t&&(t._sort||!this.parent)&&Yp(t,this,e-this._delay),this}return this._start},t.endTime=function(e){return this._start+(Gd(e)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},t.rawTime=function(e){var t=this.parent||this._dp;return t?e&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Wp(t.rawTime(e),this):this._tTime:this._tTime},t.revert=function(e){void 0===e&&(e=up);var t=dd;return dd=e,Pp(this)&&(this.timeline&&this.timeline.revert(e),this.totalTime(-.01,e.suppressEvents)),"nested"!==this.data&&!1!==e.kill&&this.kill(),dd=t,this},t.globalTime=function(e){for(var t=this,n=arguments.length?e:t.rawTime();t;)n=t._start+n/(Math.abs(t._ts)||1),t=t._dp;return!this.parent&&this._sat?this._sat.globalTime(e):n},t.repeat=function(e){return arguments.length?(this._repeat=e===1/0?-2:e,tf(this)):-2===this._repeat?1/0:this._repeat},t.repeatDelay=function(e){if(arguments.length){var t=this._time;return this._rDelay=e,tf(this),t?this.time(t):this}return this._rDelay},t.yoyo=function(e){return arguments.length?(this._yoyo=e,this):this._yoyo},t.seek=function(e,t){return this.totalTime(rf(this,e),Gd(t))},t.restart=function(e,t){return this.play().totalTime(e?-this._delay:0,Gd(t)),this._dur||(this._zTime=-1e-8),this},t.play=function(e,t){return null!=e&&this.seek(e,t),this.reversed(!1).paused(!1)},t.reverse=function(e,t){return null!=e&&this.seek(e||this.totalDuration(),t),this.reversed(!0).paused(!1)},t.pause=function(e,t){return null!=e&&this.seek(e,t),this.paused(!0)},t.resume=function(){return this.paused(!1)},t.reversed=function(e){return arguments.length?(!!e!==this.reversed()&&this.timeScale(-this._rts||(e?-1e-8:0)),this):this._rts<0},t.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},t.isActive=function(){var e,t=this.parent||this._dp,n=this._start;return!(t&&!(this._ts&&this._initted&&t.isActive()&&(e=t.rawTime(!0))>=n&&e<this.endTime(!0)-Ld))},t.eventCallback=function(e,t,n){var r=this.vars;return arguments.length>1?(t?(r[e]=t,n&&(r[e+"Params"]=n),"onUpdate"===e&&(this._onUpdate=t)):delete r[e],this):r[e]},t.then=function(e){var t=this;return new Promise((function(n){var r=zd(e)?e:Lp,i=function(){var e=t.then;t.then=null,zd(r)&&(r=r(t))&&(r.then||r===t)&&(t.then=e),n(r),t.then=e};t._initted&&1===t.totalProgress()&&t._ts>=0||!t._tTime&&t._ts<0?i():t._prom=i}))},t.kill=function(){Tf(this)},e}();Ip(Yf.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var Zf=function(e){function t(t,n){var r;return void 0===t&&(t={}),(r=e.call(this,t)||this).labels={},r.smoothChildTiming=!!t.smoothChildTiming,r.autoRemoveChildren=!!t.autoRemoveChildren,r._sort=Gd(t.sortChildren),fd&&Yp(t.parent||fd,cd(r),n),t.reversed&&r.reverse(),t.paused&&r.paused(!0),t.scrollTrigger&&Zp(cd(r),t.scrollTrigger),r}ud(t,e);var n=t.prototype;return n.to=function(e,t,n){return sf(0,arguments,this),this},n.from=function(e,t,n){return sf(1,arguments,this),this},n.fromTo=function(e,t,n,r){return sf(2,arguments,this),this},n.set=function(e,t,n){return t.duration=0,t.parent=this,Fp(t).repeatDelay||(t.repeat=0),t.immediateRender=!!t.immediateRender,new am(e,t,rf(this,n),1),this},n.call=function(e,t,n){return Yp(this,am.delayedCall(0,e,t),n)},n.staggerTo=function(e,t,n,r,i,s,o){return n.duration=t,n.stagger=n.stagger||r,n.onComplete=s,n.onCompleteParams=o,n.parent=this,new am(e,n,rf(this,i)),this},n.staggerFrom=function(e,t,n,r,i,s,o){return n.runBackwards=1,Fp(n).immediateRender=Gd(n.immediateRender),this.staggerTo(e,t,n,r,i,s,o)},n.staggerFromTo=function(e,t,n,r,i,s,o,a){return r.startAt=n,Fp(r).immediateRender=Gd(r.immediateRender),this.staggerTo(e,t,r,i,s,o,a)},n.render=function(e,t,n){var r,i,s,o,a,l,c,u,h,d,p,f,m=this._time,g=this._dirty?this.totalDuration():this._tDur,v=this._dur,y=e<=0?0:Mp(e),_=this._zTime<0!=e<0&&(this._initted||!v);if(this!==fd&&y>g&&e>=0&&(y=g),y!==this._tTime||n||_){if(m!==this._time&&v&&(y+=this._time-m,e+=this._time-m),r=y,h=this._start,l=!(u=this._ts),_&&(v||(m=this._zTime),(e||!t)&&(this._zTime=e)),this._repeat){if(p=this._yoyo,a=v+this._rDelay,this._repeat<-1&&e<0)return this.totalTime(100*a+e,t,n);if(r=Mp(y%a),y===g?(o=this._repeat,r=v):((o=~~(d=Mp(y/a)))&&o===d&&(r=v,o--),r>v&&(r=v)),d=Vp(this._tTime,a),!m&&this._tTime&&d!==o&&this._tTime-d*a-this._dur<=0&&(d=o),p&&1&o&&(r=v-r,f=1),o!==d&&!this._lock){var x=p&&1&d,b=x===(p&&1&o);if(o<d&&(x=!x),m=x?0:y%v?v:y,this._lock=1,this.render(m||(f?0:Mp(o*a)),t,!v)._lock=0,this._tTime=y,!t&&this.parent&&wf(this,"onRepeat"),this.vars.repeatRefresh&&!f&&(this.invalidate()._lock=1),m&&m!==this._time||l!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(v=this._dur,g=this._tDur,b&&(this._lock=2,m=x?v:-1e-4,this.render(m,!0),this.vars.repeatRefresh&&!f&&this.invalidate()),this._lock=0,!this._ts&&!l)return this;Hf(this,f)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(c=function(e,t,n){var r;if(n>t)for(r=e._first;r&&r._start<=n;){if("isPause"===r.data&&r._start>t)return r;r=r._next}else for(r=e._last;r&&r._start>=n;){if("isPause"===r.data&&r._start<t)return r;r=r._prev}}(this,Mp(m),Mp(r)),c&&(y-=r-(r=c._start))),this._tTime=y,this._time=r,this._act=!u,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=e,m=0),!m&&y&&!t&&!d&&(wf(this,"onStart"),this._tTime!==y))return this;if(r>=m&&e>=0)for(i=this._first;i;){if(s=i._next,(i._act||r>=i._start)&&i._ts&&c!==i){if(i.parent!==this)return this.render(e,t,n);if(i.render(i._ts>0?(r-i._start)*i._ts:(i._dirty?i.totalDuration():i._tDur)+(r-i._start)*i._ts,t,n),r!==this._time||!this._ts&&!l){c=0,s&&(y+=this._zTime=-1e-8);break}}i=s}else{i=this._last;for(var w=e<0?e:r;i;){if(s=i._prev,(i._act||w<=i._end)&&i._ts&&c!==i){if(i.parent!==this)return this.render(e,t,n);if(i.render(i._ts>0?(w-i._start)*i._ts:(i._dirty?i.totalDuration():i._tDur)+(w-i._start)*i._ts,t,n||dd&&Pp(i)),r!==this._time||!this._ts&&!l){c=0,s&&(y+=this._zTime=w?-1e-8:Ld);break}}i=s}}if(c&&!t&&(this.pause(),c.render(r>=m?0:-1e-8)._zTime=r>=m?1:-1,this._ts))return this._start=h,Xp(this),this.render(e,t,n);this._onUpdate&&!t&&wf(this,"onUpdate",!0),(y===g&&this._tTime>=this.totalDuration()||!y&&m)&&(h===this._start||Math.abs(u)!==Math.abs(this._ts))&&(this._lock||((e||!v)&&(y===g&&this._ts>0||!y&&this._ts<0)&&zp(this,1),!t&&(!(e<0)||m)&&(y||m||!g)&&(wf(this,y===g&&e>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(y<g&&this.timeScale()>0)&&this._prom())))}return this},n.add=function(e,t){var n=this;if(Nd(t)||(t=rf(this,t,e)),!(e instanceof Yf)){if(Kd(e))return e.forEach((function(e){return n.add(e,t)})),this;if(Bd(e))return this.addLabel(e,t);if(!zd(e))return this;e=am.delayedCall(0,e)}return this!==e?Yp(this,e,t):this},n.getChildren=function(e,t,n,r){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===n&&(n=!0),void 0===r&&(r=-1e8);for(var i=[],s=this._first;s;)s._start>=r&&(s instanceof am?t&&i.push(s):(n&&i.push(s),e&&i.push.apply(i,s.getChildren(!0,t,n)))),s=s._next;return i},n.getById=function(e){for(var t=this.getChildren(1,1,1),n=t.length;n--;)if(t[n].vars.id===e)return t[n]},n.remove=function(e){return Bd(e)?this.removeLabel(e):zd(e)?this.killTweensOf(e):(e.parent===this&&Bp(this,e),e===this._recent&&(this._recent=this._last),Np(this))},n.totalTime=function(t,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Mp(Of.time-(this._ts>0?t/this._ts:(this.totalDuration()-t)/-this._ts))),e.prototype.totalTime.call(this,t,n),this._forcing=0,this):this._tTime},n.addLabel=function(e,t){return this.labels[e]=rf(this,t),this},n.removeLabel=function(e){return delete this.labels[e],this},n.addPause=function(e,t,n){var r=am.delayedCall(0,t||ap,n);return r.data="isPause",this._hasPause=1,Yp(this,r,rf(this,e))},n.removePause=function(e){var t=this._first;for(e=rf(this,e);t;)t._start===e&&"isPause"===t.data&&zp(t),t=t._next},n.killTweensOf=function(e,t,n){for(var r=this.getTweensOf(e,n),i=r.length;i--;)$f!==r[i]&&r[i].kill(e,t);return this},n.getTweensOf=function(e,t){for(var n,r=[],i=hf(e),s=this._first,o=Nd(t);s;)s instanceof am?Sp(s._targets,i)&&(o?(!$f||s._initted&&s._ts)&&s.globalTime(0)<=t&&s.globalTime(s.totalDuration())>t:!t||s.isActive())&&r.push(s):(n=s.getTweensOf(i,t)).length&&r.push.apply(r,n),s=s._next;return r},n.tweenTo=function(e,t){t=t||{};var n,r=this,i=rf(r,e),s=t,o=s.startAt,a=s.onStart,l=s.onStartParams,c=s.immediateRender,u=am.to(r,Ip({ease:t.ease||"none",lazy:!1,immediateRender:!1,time:i,overwrite:"auto",duration:t.duration||Math.abs((i-(o&&"time"in o?o.time:r._time))/r.timeScale())||Ld,onStart:function(){if(r.pause(),!n){var e=t.duration||Math.abs((i-(o&&"time"in o?o.time:r._time))/r.timeScale());u._dur!==e&&ef(u,e,0,1).render(u._time,!0,!0),n=1}a&&a.apply(u,l||[])}},t));return c?u.render(0):u},n.tweenFromTo=function(e,t,n){return this.tweenTo(t,Ip({startAt:{time:rf(this,e)}},n))},n.recent=function(){return this._recent},n.nextLabel=function(e){return void 0===e&&(e=this._time),bf(this,rf(this,e))},n.previousLabel=function(e){return void 0===e&&(e=this._time),bf(this,rf(this,e),1)},n.currentLabel=function(e){return arguments.length?this.seek(e,!0):this.previousLabel(this._time+Ld)},n.shiftChildren=function(e,t,n){void 0===n&&(n=0);for(var r,i=this._first,s=this.labels;i;)i._start>=n&&(i._start+=e,i._end+=e),i=i._next;if(t)for(r in s)s[r]>=n&&(s[r]+=e);return Np(this)},n.invalidate=function(t){var n=this._first;for(this._lock=0;n;)n.invalidate(t),n=n._next;return e.prototype.invalidate.call(this,t)},n.clear=function(e){void 0===e&&(e=!0);for(var t,n=this._first;n;)t=n._next,this.remove(n),n=t;return this._dp&&(this._time=this._tTime=this._pTime=0),e&&(this.labels={}),Np(this)},n.totalDuration=function(e){var t,n,r,i=0,s=this,o=s._last,a=Rd;if(arguments.length)return s.timeScale((s._repeat<0?s.duration():s.totalDuration())/(s.reversed()?-e:e));if(s._dirty){for(r=s.parent;o;)t=o._prev,o._dirty&&o.totalDuration(),(n=o._start)>a&&s._sort&&o._ts&&!s._lock?(s._lock=1,Yp(s,o,n-o._delay,1)._lock=0):a=n,n<0&&o._ts&&(i-=n,(!r&&!s._dp||r&&r.smoothChildTiming)&&(s._start+=n/s._ts,s._time-=n,s._tTime-=n),s.shiftChildren(-n,!1,-1/0),a=0),o._end>i&&o._ts&&(i=o._end),o=t;ef(s,s===fd&&s._time>i?s._time:i,1,1),s._dirty=0}return s._tDur},t.updateRoot=function(e){if(fd._ts&&(Cp(fd,Wp(e,fd)),_d=Of.frame),Of.frame>=gp){gp+=Pd.autoSleep||120;var t=fd._first;if((!t||!t._ts)&&Pd.autoSleep&&Of._listeners.length<2){for(;t&&!t._ts;)t=t._next;t||Of.sleep()}}},t}(Yf);Ip(Zf.prototype,{_lock:0,_hasPause:0,_forcing:0});var $f,Qf,Jf=function(e,t,n,r,i,s,o){var a,l,c,u,h,d,p,f,m=new bm(this._pt,e,t,0,1,mm,null,i),g=0,v=0;for(m.b=n,m.e=r,n+="",(p=~(r+="").indexOf("random("))&&(r=_f(r)),s&&(s(f=[n,r],e,t),n=f[0],r=f[1]),l=n.match($d)||[];a=$d.exec(r);)u=a[0],h=r.substring(g,a.index),c?c=(c+1)%5:"rgba("===h.substr(-5)&&(c=1),u!==l[v++]&&(d=parseFloat(l[v-1])||0,m._pt={_next:m._pt,p:h||1===v?h:",",s:d,c:"="===u.charAt(1)?Ap(d,u)-d:parseFloat(u)-d,m:c&&c<4?Math.round:0},g=$d.lastIndex);return m.c=g<r.length?r.substring(g,r.length):"",m.fp=o,(Qd.test(r)||p)&&(m.e=0),this._pt=m,m},em=function(e,t,n,r,i,s,o,a,l,c){zd(r)&&(r=r(i||0,e,s));var u,h=e[t],d="get"!==n?n:zd(h)?l?e[t.indexOf("set")||!zd(e["get"+t.substr(3)])?t:"get"+t.substr(3)](l):e[t]():h,p=zd(h)?l?um:cm:lm;if(Bd(r)&&(~r.indexOf("random(")&&(r=_f(r)),"="===r.charAt(1)&&(((u=Ap(d,r)+(lf(d)||0))||0===u)&&(r=u))),!c||d!==r||Qf)return isNaN(d*r)||""===r?(!h&&!(t in e)&&ip(t,r),Jf.call(this,e,t,d,r,p,a||Pd.stringFilter,l)):(u=new bm(this._pt,e,t,+d||0,r-(d||0),"boolean"==typeof h?fm:pm,0,p),l&&(u.fp=l),o&&u.modifier(o,this,e),this._pt=u)},tm=function(e,t,n,r,i,s){var o,a,l,c;if(fp[e]&&!1!==(o=new fp[e]).init(i,o.rawVars?t[e]:function(e,t,n,r,i){if(zd(e)&&(e=im(e,i,t,n,r)),!Hd(e)||e.style&&e.nodeType||Kd(e)||Xd(e))return Bd(e)?im(e,i,t,n,r):e;var s,o={};for(s in e)o[s]=im(e[s],i,t,n,r);return o}(t[e],r,i,s,n),n,r,s)&&(n._pt=a=new bm(n._pt,i,e,0,1,o.render,o,0,o.priority),n!==xd))for(l=n._ptLookup[n._targets.indexOf(i)],c=o._props.length;c--;)l[o._props[c]]=a;return o},nm=function e(t,n,r){var i,s,o,a,l,c,u,h,d,p,f,m,g,v=t.vars,y=v.ease,_=v.startAt,x=v.immediateRender,b=v.lazy,w=v.onUpdate,T=v.runBackwards,M=v.yoyoEase,A=v.keyframes,S=v.autoRevert,E=t._dur,P=t._startAt,C=t._targets,R=t.parent,L=R&&"nested"===R.data?R.vars.targets:C,I="auto"===t._overwrite&&!hd,D=t.timeline;if(D&&(!A||!y)&&(y="none"),t._ease=Gf(y,Cd.ease),t._yEase=M?jf(Gf(!0===M?y:M,Cd.ease)):0,M&&t._yoyo&&!t._repeat&&(M=t._yEase,t._yEase=t._ease,t._ease=M),t._from=!D&&!!v.runBackwards,!D||A&&!v.stagger){if(m=(h=C[0]?xp(C[0]).harness:0)&&v[h.prop],i=Op(v,hp),P&&(P._zTime<0&&P.progress(1),n<0&&T&&x&&!S?P.render(-1,!0):P.revert(T&&E?cp:lp),P._lazy=0),_){if(zp(t._startAt=am.set(C,Ip({data:"isStart",overwrite:!1,parent:R,immediateRender:!0,lazy:!P&&Gd(b),startAt:null,delay:0,onUpdate:w&&function(){return wf(t,"onUpdate")},stagger:0},_))),t._startAt._dp=0,t._startAt._sat=t,n<0&&(dd||!x&&!S)&&t._startAt.revert(cp),x&&E&&n<=0&&r<=0)return void(n&&(t._zTime=n))}else if(T&&E&&!P)if(n&&(x=!1),o=Ip({overwrite:!1,data:"isFromStart",lazy:x&&!P&&Gd(b),immediateRender:x,stagger:0,parent:R},i),m&&(o[h.prop]=m),zp(t._startAt=am.set(C,o)),t._startAt._dp=0,t._startAt._sat=t,n<0&&(dd?t._startAt.revert(cp):t._startAt.render(-1,!0)),t._zTime=n,x){if(!n)return}else e(t._startAt,Ld,Ld);for(t._pt=t._ptCache=0,b=E&&Gd(b)||b&&!E,s=0;s<C.length;s++){if(u=(l=C[s])._gsap||_p(C)[s]._gsap,t._ptLookup[s]=p={},pp[u.id]&&dp.length&&Ep(),f=L===C?s:L.indexOf(l),h&&!1!==(d=new h).init(l,m||i,t,f,L)&&(t._pt=a=new bm(t._pt,l,d.name,0,1,d.render,d,0,d.priority),d._props.forEach((function(e){p[e]=a})),d.priority&&(c=1)),!h||m)for(o in i)fp[o]&&(d=tm(o,i,t,f,l,L))?d.priority&&(c=1):p[o]=a=em.call(t,l,o,"get",i[o],f,L,0,v.stringFilter);t._op&&t._op[s]&&t.kill(l,t._op[s]),I&&t._pt&&($f=t,fd.killTweensOf(l,p,t.globalTime(n)),g=!t.parent,$f=0),t._pt&&b&&(pp[u.id]=1)}c&&xm(t),t._onInit&&t._onInit(t)}t._onUpdate=w,t._initted=(!t._op||t._pt)&&!g,A&&n<=0&&D.render(Rd,!0,!0)},rm=function(e,t,n,r){var i,s,o=t.ease||r||"power1.inOut";if(Kd(t))s=n[e]||(n[e]=[]),t.forEach((function(e,n){return s.push({t:n/(t.length-1)*100,v:e,e:o})}));else for(i in t)s=n[i]||(n[i]=[]),"ease"===i||s.push({t:parseFloat(e),v:t[i],e:o})},im=function(e,t,n,r,i){return zd(e)?e.call(t,n,r,i):Bd(e)&&~e.indexOf("random(")?_f(e):e},sm=yp+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",om={};wp(sm+",id,stagger,delay,duration,paused,scrollTrigger",(function(e){return om[e]=1}));var am=function(e){function t(t,n,r,i){var s;"number"==typeof n&&(r.duration=n,n=r,r=null);var o,a,l,c,u,h,d,p,f=(s=e.call(this,i?n:Fp(n))||this).vars,m=f.duration,g=f.delay,v=f.immediateRender,y=f.stagger,_=f.overwrite,x=f.keyframes,b=f.defaults,w=f.scrollTrigger,T=f.yoyoEase,M=n.parent||fd,A=(Kd(t)||Xd(t)?Nd(t[0]):"length"in n)?[t]:hf(t);if(s._targets=A.length?_p(A):sp("GSAP target "+t+" not found. https://gsap.com",!Pd.nullTargetWarn)||[],s._ptLookup=[],s._overwrite=_,x||y||Wd(m)||Wd(g)){if(n=s.vars,(o=s.timeline=new Zf({data:"nested",defaults:b||{},targets:M&&"nested"===M.data?M.vars.targets:A})).kill(),o.parent=o._dp=cd(s),o._start=0,y||Wd(m)||Wd(g)){if(c=A.length,d=y&&ff(y),Hd(y))for(u in y)~sm.indexOf(u)&&(p||(p={}),p[u]=y[u]);for(a=0;a<c;a++)(l=Op(n,om)).stagger=0,T&&(l.yoyoEase=T),p&&Dp(l,p),h=A[a],l.duration=+im(m,cd(s),a,h,A),l.delay=(+im(g,cd(s),a,h,A)||0)-s._delay,!y&&1===c&&l.delay&&(s._delay=g=l.delay,s._start+=g,l.delay=0),o.to(h,l,d?d(a,h,A):0),o._ease=Uf.none;o.duration()?m=g=0:s.timeline=0}else if(x){Fp(Ip(o.vars.defaults,{ease:"none"})),o._ease=Gf(x.ease||n.ease||"none");var S,E,P,C=0;if(Kd(x))x.forEach((function(e){return o.to(A,e,">")})),o.duration();else{for(u in l={},x)"ease"===u||"easeEach"===u||rm(u,x[u],l,x.easeEach);for(u in l)for(S=l[u].sort((function(e,t){return e.t-t.t})),C=0,a=0;a<S.length;a++)(P={ease:(E=S[a]).e,duration:(E.t-(a?S[a-1].t:0))/100*m})[u]=E.v,o.to(A,P,C),C+=P.duration;o.duration()<m&&o.to({},{duration:m-o.duration()})}}m||s.duration(m=o.duration())}else s.timeline=0;return!0===_&&!hd&&($f=cd(s),fd.killTweensOf(A),$f=0),Yp(M,cd(s),r),n.reversed&&s.reverse(),n.paused&&s.paused(!0),(v||!m&&!x&&s._start===Mp(M._time)&&Gd(v)&&Hp(cd(s))&&"nested"!==M.data)&&(s._tTime=-1e-8,s.render(Math.max(0,-g)||0)),w&&Zp(cd(s),w),s}ud(t,e);var n=t.prototype;return n.render=function(e,t,n){var r,i,s,o,a,l,c,u,h,d=this._time,p=this._tDur,f=this._dur,m=e<0,g=e>p-Ld&&!m?p:e<Ld?0:e;if(f){if(g!==this._tTime||!e||n||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==m||this._lazy){if(r=g,u=this.timeline,this._repeat){if(o=f+this._rDelay,this._repeat<-1&&m)return this.totalTime(100*o+e,t,n);if(r=Mp(g%o),g===p?(s=this._repeat,r=f):(s=~~(a=Mp(g/o)))&&s===a?(r=f,s--):r>f&&(r=f),(l=this._yoyo&&1&s)&&(h=this._yEase,r=f-r),a=Vp(this._tTime,o),r===d&&!n&&this._initted&&s===a)return this._tTime=g,this;s!==a&&(u&&this._yEase&&Hf(u,l),this.vars.repeatRefresh&&!l&&!this._lock&&r!==o&&this._initted&&(this._lock=n=1,this.render(Mp(o*s),!0).invalidate()._lock=0))}if(!this._initted){if($p(this,m?e:r,n,t,g))return this._tTime=0,this;if(!(d===this._time||n&&this.vars.repeatRefresh&&s!==a))return this;if(f!==this._dur)return this.render(e,t,n)}if(this._tTime=g,this._time=r,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=c=(h||this._ease)(r/f),this._from&&(this.ratio=c=1-c),!d&&g&&!t&&!a&&(wf(this,"onStart"),this._tTime!==g))return this;for(i=this._pt;i;)i.r(c,i.d),i=i._next;u&&u.render(e<0?e:u._dur*u._ease(r/this._dur),t,n)||this._startAt&&(this._zTime=e),this._onUpdate&&!t&&(m&&jp(this,e,0,n),wf(this,"onUpdate")),this._repeat&&s!==a&&this.vars.onRepeat&&!t&&this.parent&&wf(this,"onRepeat"),(g===this._tDur||!g)&&this._tTime===g&&(m&&!this._onUpdate&&jp(this,e,0,!0),(e||!f)&&(g===this._tDur&&this._ts>0||!g&&this._ts<0)&&zp(this,1),!t&&(!m||d)&&(g||d||l)&&(wf(this,g===p?"onComplete":"onReverseComplete",!0),this._prom&&!(g<p&&this.timeScale()>0)&&this._prom()))}}else!function(e,t,n,r){var i,s,o,a=e.ratio,l=t<0||!t&&(!e._start&&Qp(e)&&(e._initted||!Jp(e))||(e._ts<0||e._dp._ts<0)&&!Jp(e))?0:1,c=e._rDelay,u=0;if(c&&e._repeat&&(u=af(0,e._tDur,t),s=Vp(u,c),e._yoyo&&1&s&&(l=1-l),s!==Vp(e._tTime,c)&&(a=1-l,e.vars.repeatRefresh&&e._initted&&e.invalidate())),l!==a||dd||r||e._zTime===Ld||!t&&e._zTime){if(!e._initted&&$p(e,t,r,n,u))return;for(o=e._zTime,e._zTime=t||(n?Ld:0),n||(n=t&&!o),e.ratio=l,e._from&&(l=1-l),e._time=0,e._tTime=u,i=e._pt;i;)i.r(l,i.d),i=i._next;t<0&&jp(e,t,0,!0),e._onUpdate&&!n&&wf(e,"onUpdate"),u&&e._repeat&&!n&&e.parent&&wf(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===l&&(l&&zp(e,1),!n&&!dd&&(wf(e,l?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)}(this,e,t,n);return this},n.targets=function(){return this._targets},n.invalidate=function(t){return(!t||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(t),e.prototype.invalidate.call(this,t)},n.resetTo=function(e,t,n,r,i){bd||Of.wake(),this._ts||this.play();var s=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||nm(this,s),function(e,t,n,r,i,s,o,a){var l,c,u,h,d=(e._pt&&e._ptCache||(e._ptCache={}))[t];if(!d)for(d=e._ptCache[t]=[],u=e._ptLookup,h=e._targets.length;h--;){if((l=u[h][t])&&l.d&&l.d._pt)for(l=l.d._pt;l&&l.p!==t&&l.fp!==t;)l=l._next;if(!l)return Qf=1,e.vars[t]="+=0",nm(e,o),Qf=0,a?sp(t+" not eligible for reset"):1;d.push(l)}for(h=d.length;h--;)(l=(c=d[h])._pt||c).s=!r&&0!==r||i?l.s+(r||0)+s*l.c:r,l.c=n-l.s,c.e&&(c.e=Tp(n)+lf(c.e)),c.b&&(c.b=l.s+lf(c.b))}(this,e,t,n,r,this._ease(s/this._dur),s,i)?this.resetTo(e,t,n,r,1):(Kp(this,0),this.parent||Up(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},n.kill=function(e,t){if(void 0===t&&(t="all"),!(e||t&&"all"!==t))return this._lazy=this._pt=0,this.parent?Tf(this):this.scrollTrigger&&this.scrollTrigger.kill(!!dd),this;if(this.timeline){var n=this.timeline.totalDuration();return this.timeline.killTweensOf(e,t,$f&&!0!==$f.vars.overwrite)._first||Tf(this),this.parent&&n!==this.timeline.totalDuration()&&ef(this,this._dur*this.timeline._tDur/n,0,1),this}var r,i,s,o,a,l,c,u=this._targets,h=e?hf(e):u,d=this._ptLookup,p=this._pt;if((!t||"all"===t)&&function(e,t){for(var n=e.length,r=n===t.length;r&&n--&&e[n]===t[n];);return n<0}(u,h))return"all"===t&&(this._pt=0),Tf(this);for(r=this._op=this._op||[],"all"!==t&&(Bd(t)&&(a={},wp(t,(function(e){return a[e]=1})),t=a),t=function(e,t){var n,r,i,s,o=e[0]?xp(e[0]).harness:0,a=o&&o.aliases;if(!a)return t;for(r in n=Dp({},t),a)if(r in n)for(i=(s=a[r].split(",")).length;i--;)n[s[i]]=n[r];return n}(u,t)),c=u.length;c--;)if(~h.indexOf(u[c]))for(a in i=d[c],"all"===t?(r[c]=t,o=i,s={}):(s=r[c]=r[c]||{},o=t),o)(l=i&&i[a])&&((!("kill"in l.d)||!0===l.d.kill(a))&&Bp(this,l,"_pt"),delete i[a]),"all"!==s&&(s[a]=1);return this._initted&&!this._pt&&p&&Tf(this),this},t.to=function(e,n){return new t(e,n,arguments[2])},t.from=function(e,t){return sf(1,arguments)},t.delayedCall=function(e,n,r,i){return new t(n,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:e,onComplete:n,onReverseComplete:n,onCompleteParams:r,onReverseCompleteParams:r,callbackScope:i})},t.fromTo=function(e,t,n){return sf(2,arguments)},t.set=function(e,n){return n.duration=0,n.repeatDelay||(n.repeat=0),new t(e,n)},t.killTweensOf=function(e,t,n){return fd.killTweensOf(e,t,n)},t}(Yf);Ip(am.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),wp("staggerTo,staggerFrom,staggerFromTo",(function(e){am[e]=function(){var t=new Zf,n=cf.call(arguments,0);return n.splice("staggerFromTo"===e?5:4,0,0),t[e].apply(t,n)}}));var lm=function(e,t,n){return e[t]=n},cm=function(e,t,n){return e[t](n)},um=function(e,t,n,r){return e[t](r.fp,n)},hm=function(e,t,n){return e.setAttribute(t,n)},dm=function(e,t){return zd(e[t])?cm:jd(e[t])&&e.setAttribute?hm:lm},pm=function(e,t){return t.set(t.t,t.p,Math.round(1e6*(t.s+t.c*e))/1e6,t)},fm=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},mm=function(e,t){var n=t._pt,r="";if(!e&&t.b)r=t.b;else if(1===e&&t.e)r=t.e;else{for(;n;)r=n.p+(n.m?n.m(n.s+n.c*e):Math.round(1e4*(n.s+n.c*e))/1e4)+r,n=n._next;r+=t.c}t.set(t.t,t.p,r,t)},gm=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},vm=function(e,t,n,r){for(var i,s=this._pt;s;)i=s._next,s.p===r&&s.modifier(e,t,n),s=i},ym=function(e){for(var t,n,r=this._pt;r;)n=r._next,r.p===e&&!r.op||r.op===e?Bp(this,r,"_pt"):r.dep||(t=1),r=n;return!t},_m=function(e,t,n,r){r.mSet(e,t,r.m.call(r.tween,n,r.mt),r)},xm=function(e){for(var t,n,r,i,s=e._pt;s;){for(t=s._next,n=r;n&&n.pr>s.pr;)n=n._next;(s._prev=n?n._prev:i)?s._prev._next=s:r=s,(s._next=n)?n._prev=s:i=s,s=t}e._pt=r},bm=function(){function e(e,t,n,r,i,s,o,a,l){this.t=t,this.s=r,this.c=i,this.p=n,this.r=s||pm,this.d=o||this,this.set=a||lm,this.pr=l||0,this._next=e,e&&(e._prev=this)}return e.prototype.modifier=function(e,t,n){this.mSet=this.mSet||this.set,this.set=_m,this.m=e,this.mt=n,this.tween=t},e}();wp(yp+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",(function(e){return hp[e]=1})),tp.TweenMax=tp.TweenLite=am,tp.TimelineLite=tp.TimelineMax=Zf,fd=new Zf({sortChildren:!1,defaults:Cd,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),Pd.stringFilter=kf;var wm=[],Tm={},Mm=[],Am=0,Sm=0,Em=function(e){return(Tm[e]||Mm).map((function(e){return e()}))},Pm=function(){var e=Date.now(),t=[];e-Am>2&&(Em("matchMediaInit"),wm.forEach((function(e){var n,r,i,s,o=e.queries,a=e.conditions;for(r in o)(n=md.matchMedia(o[r]).matches)&&(i=1),n!==a[r]&&(a[r]=n,s=1);s&&(e.revert(),i&&t.push(e))})),Em("matchMediaRevert"),t.forEach((function(e){return e.onMatch(e,(function(t){return e.add(null,t)}))})),Am=e,Em("matchMedia"))},Cm=function(){function e(e,t){this.selector=t&&df(t),this.data=[],this._r=[],this.isReverted=!1,this.id=Sm++,e&&this.add(e)}var t=e.prototype;return t.add=function(e,t,n){zd(e)&&(n=t,t=e,e=zd);var r=this,i=function(){var e,i=pd,s=r.selector;return i&&i!==r&&i.data.push(r),n&&(r.selector=df(n)),pd=r,e=t.apply(r,arguments),zd(e)&&r._r.push(e),pd=i,r.selector=s,r.isReverted=!1,e};return r.last=i,e===zd?i(r,(function(e){return r.add(null,e)})):e?r[e]=i:i},t.ignore=function(e){var t=pd;pd=null,e(this),pd=t},t.getTweens=function(){var t=[];return this.data.forEach((function(n){return n instanceof e?t.push.apply(t,n.getTweens()):n instanceof am&&!(n.parent&&"nested"===n.parent.data)&&t.push(n)})),t},t.clear=function(){this._r.length=this.data.length=0},t.kill=function(e,t){var n=this;if(e?function(){for(var t,r=n.getTweens(),i=n.data.length;i--;)"isFlip"===(t=n.data[i]).data&&(t.revert(),t.getChildren(!0,!0,!1).forEach((function(e){return r.splice(r.indexOf(e),1)})));for(r.map((function(e){return{g:e._dur||e._delay||e._sat&&!e._sat.vars.immediateRender?e.globalTime(0):-1/0,t:e}})).sort((function(e,t){return t.g-e.g||-1/0})).forEach((function(t){return t.t.revert(e)})),i=n.data.length;i--;)(t=n.data[i])instanceof Zf?"nested"!==t.data&&(t.scrollTrigger&&t.scrollTrigger.revert(),t.kill()):!(t instanceof am)&&t.revert&&t.revert(e);n._r.forEach((function(t){return t(e,n)})),n.isReverted=!0}():this.data.forEach((function(e){return e.kill&&e.kill()})),this.clear(),t)for(var r=wm.length;r--;)wm[r].id===this.id&&wm.splice(r,1)},t.revert=function(e){this.kill(e||{})},e}(),Rm=function(){function e(e){this.contexts=[],this.scope=e,pd&&pd.data.push(this)}var t=e.prototype;return t.add=function(e,t,n){Hd(e)||(e={matches:e});var r,i,s,o=new Cm(0,n||this.scope),a=o.conditions={};for(i in pd&&!o.selector&&(o.selector=pd.selector),this.contexts.push(o),t=o.add("onMatch",t),o.queries=e,e)"all"===i?s=1:(r=md.matchMedia(e[i]))&&(wm.indexOf(o)<0&&wm.push(o),(a[i]=r.matches)&&(s=1),r.addListener?r.addListener(Pm):r.addEventListener("change",Pm));return s&&t(o,(function(e){return o.add(null,e)})),this},t.revert=function(e){this.kill(e||{})},t.kill=function(e){this.contexts.forEach((function(t){return t.kill(e,!0)}))},e}(),Lm={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((function(e){return Af(e)}))},timeline:function(e){return new Zf(e)},getTweensOf:function(e,t){return fd.getTweensOf(e,t)},getProperty:function(e,t,n,r){Bd(e)&&(e=hf(e)[0]);var i=xp(e||{}).get,s=n?Lp:Rp;return"native"===n&&(n=""),e&&(t?s((fp[t]&&fp[t].get||i)(e,t,n,r)):function(t,n,r){return s((fp[t]&&fp[t].get||i)(e,t,n,r))})},quickSetter:function(e,t,n){if((e=hf(e)).length>1){var r=e.map((function(e){return km.quickSetter(e,t,n)})),i=r.length;return function(e){for(var t=i;t--;)r[t](e)}}e=e[0]||{};var s=fp[t],o=xp(e),a=o.harness&&(o.harness.aliases||{})[t]||t,l=s?function(t){var r=new s;xd._pt=0,r.init(e,n?t+n:t,xd,0,[e]),r.render(1,r),xd._pt&&gm(1,xd)}:o.set(e,a);return s?l:function(t){return l(e,a,n?t+n:t,o,1)}},quickTo:function(e,t,n){var r,i=km.to(e,Ip(((r={})[t]="+=0.1",r.paused=!0,r.stagger=0,r),n||{})),s=function(e,n,r){return i.resetTo(t,e,n,r)};return s.tween=i,s},isTweening:function(e){return fd.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Gf(e.ease,Cd.ease)),kp(Cd,e||{})},config:function(e){return kp(Pd,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,r=e.plugins,i=e.defaults,s=e.extendTimeline;(r||"").split(",").forEach((function(e){return e&&!fp[e]&&!tp[e]&&sp(t+" effect requires "+e+" plugin.")})),mp[t]=function(e,t,r){return n(hf(e),Ip(t||{},i),r)},s&&(Zf.prototype[t]=function(e,n,r){return this.add(mp[t](e,Hd(n)?n:(r=n)&&{},this),r)})},registerEase:function(e,t){Uf[e]=Gf(t)},parseEase:function(e,t){return arguments.length?Gf(e,t):Uf},getById:function(e){return fd.getById(e)},exportRoot:function(e,t){void 0===e&&(e={});var n,r,i=new Zf(e);for(i.smoothChildTiming=Gd(e.smoothChildTiming),fd.remove(i),i._dp=0,i._time=i._tTime=fd._time,n=fd._first;n;)r=n._next,(t||!(!n._dur&&n instanceof am&&n.vars.onComplete===n._targets[0]))&&Yp(i,n,n._start-n._delay),n=r;return Yp(fd,i,0),i},context:function(e,t){return e?new Cm(e,t):pd},matchMedia:function(e){return new Rm(e)},matchMediaRefresh:function(){return wm.forEach((function(e){var t,n,r=e.conditions;for(n in r)r[n]&&(r[n]=!1,t=1);t&&e.revert()}))||Pm()},addEventListener:function(e,t){var n=Tm[e]||(Tm[e]=[]);~n.indexOf(t)||n.push(t)},removeEventListener:function(e,t){var n=Tm[e],r=n&&n.indexOf(t);r>=0&&n.splice(r,1)},utils:{wrap:function e(t,n,r){var i=n-t;return Kd(t)?yf(t,e(0,t.length),n):of(r,(function(e){return(i+(e-t)%i)%i+t}))},wrapYoyo:function e(t,n,r){var i=n-t,s=2*i;return Kd(t)?yf(t,e(0,t.length-1),n):of(r,(function(e){return t+((e=(s+(e-t)%s)%s||0)>i?s-e:e)}))},distribute:ff,random:vf,snap:gf,normalize:function(e,t,n){return xf(e,t,0,1,n)},getUnit:lf,clamp:function(e,t,n){return of(n,(function(n){return af(e,t,n)}))},splitColor:Cf,toArray:hf,selector:df,mapRange:xf,pipe:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduce((function(e,t){return t(e)}),e)}},unitize:function(e,t){return function(n){return e(parseFloat(n))+(t||lf(n))}},interpolate:function e(t,n,r,i){var s=isNaN(t+n)?0:function(e){return(1-e)*t+e*n};if(!s){var o,a,l,c,u,h=Bd(t),d={};if(!0===r&&(i=1)&&(r=null),h)t={p:t},n={p:n};else if(Kd(t)&&!Kd(n)){for(l=[],c=t.length,u=c-2,a=1;a<c;a++)l.push(e(t[a-1],t[a]));c--,s=function(e){e*=c;var t=Math.min(u,~~e);return l[t](e-t)},r=n}else i||(t=Dp(Kd(t)?[]:{},t));if(!l){for(o in n)em.call(d,t,o,"get",n[o]);s=function(e){return gm(e,d)||(h?t.p:t)}}}return of(r,s)},shuffle:pf},install:rp,effects:mp,ticker:Of,updateRoot:Zf.updateRoot,plugins:fp,globalTimeline:fd,core:{PropTween:bm,globals:op,Tween:am,Timeline:Zf,Animation:Yf,getCache:xp,_removeLinkedListItem:Bp,reverting:function(){return dd},context:function(e){return e&&pd&&(pd.data.push(e),e._ctx=pd),pd},suppressOverwrites:function(e){return hd=e}}};wp("to,from,fromTo,delayedCall,set,killTweensOf",(function(e){return Lm[e]=am[e]})),Of.add(Zf.updateRoot),xd=Lm.to({},{duration:0});var Im=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},Dm=function(e,t){return{name:e,headless:1,rawVars:1,init:function(e,n,r){r._onInit=function(e){var r,i;if(Bd(n)&&(r={},wp(n,(function(e){return r[e]=1})),n=r),t){for(i in r={},n)r[i]=t(n[i]);n=r}!function(e,t){var n,r,i,s=e._targets;for(n in t)for(r=s.length;r--;)(i=e._ptLookup[r][n])&&(i=i.d)&&(i._pt&&(i=Im(i,n)),i&&i.modifier&&i.modifier(t[n],e,s[r],n))}(e,n)}}}},km=Lm.registerPlugin({name:"attr",init:function(e,t,n,r,i){var s,o,a;for(s in this.tween=n,t)a=e.getAttribute(s)||"",(o=this.add(e,"setAttribute",(a||0)+"",t[s],r,i,0,0,s)).op=s,o.b=a,this._props.push(s)},render:function(e,t){for(var n=t._pt;n;)dd?n.set(n.t,n.p,n.b,n):n.r(e,n.d),n=n._next}},{name:"endArray",headless:1,init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n],0,0,0,0,0,1)}},Dm("roundProps",mf),Dm("modifiers"),Dm("snap",gf))||Lm;am.version=Zf.version=km.version="3.13.0",yd=1,Vd()&&Ff(),Uf.Power0,Uf.Power1,Uf.Power2,Uf.Power3,Uf.Power4,Uf.Linear,Uf.Quad,Uf.Cubic,Uf.Quart,Uf.Quint,Uf.Strong,Uf.Elastic,Uf.Back,Uf.SteppedEase,Uf.Bounce,Uf.Sine,Uf.Expo,Uf.Circ;
/*!
 * CSSPlugin 3.13.0
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/
var Om,Fm,Um,Bm,zm,Nm,jm,Hm,Gm={},Vm=180/Math.PI,Wm=Math.PI/180,Xm=Math.atan2,Km=1e8,qm=/([A-Z])/g,Ym=/(left|right|width|margin|padding|x)/i,Zm=/[\s,\(]\S/,$m={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Qm=function(e,t){return t.set(t.t,t.p,Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},Jm=function(e,t){return t.set(t.t,t.p,1===e?t.e:Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},eg=function(e,t){return t.set(t.t,t.p,e?Math.round(1e4*(t.s+t.c*e))/1e4+t.u:t.b,t)},tg=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},ng=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},rg=function(e,t){return t.set(t.t,t.p,1!==e?t.b:t.e,t)},ig=function(e,t,n){return e.style[t]=n},sg=function(e,t,n){return e.style.setProperty(t,n)},og=function(e,t,n){return e._gsap[t]=n},ag=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},lg=function(e,t,n,r,i){var s=e._gsap;s.scaleX=s.scaleY=n,s.renderTransform(i,s)},cg=function(e,t,n,r,i){var s=e._gsap;s[t]=n,s.renderTransform(i,s)},ug="transform",hg=ug+"Origin",dg=function e(t,n){var r=this,i=this.target,s=i.style,o=i._gsap;if(t in Gm&&s){if(this.tfm=this.tfm||{},"transform"===t)return $m.transform.split(",").forEach((function(t){return e.call(r,t,n)}));if(~(t=$m[t]||t).indexOf(",")?t.split(",").forEach((function(e){return r.tfm[e]=Rg(i,e)})):this.tfm[t]=o.x?o[t]:Rg(i,t),t===hg&&(this.tfm.zOrigin=o.zOrigin),this.props.indexOf(ug)>=0)return;o.svg&&(this.svgo=i.getAttribute("data-svg-origin"),this.props.push(hg,n,"")),t=ug}(s||n)&&this.props.push(t,n,s[t])},pg=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},fg=function(){var e,t,n=this.props,r=this.target,i=r.style,s=r._gsap;for(e=0;e<n.length;e+=3)n[e+1]?2===n[e+1]?r[n[e]](n[e+2]):r[n[e]]=n[e+2]:n[e+2]?i[n[e]]=n[e+2]:i.removeProperty("--"===n[e].substr(0,2)?n[e]:n[e].replace(qm,"-$1").toLowerCase());if(this.tfm){for(t in this.tfm)s[t]=this.tfm[t];s.svg&&(s.renderTransform(),r.setAttribute("data-svg-origin",this.svgo||"")),(!(e=jm())||!e.isStart)&&!i[ug]&&(pg(i),s.zOrigin&&i[hg]&&(i[hg]+=" "+s.zOrigin+"px",s.zOrigin=0,s.renderTransform()),s.uncache=1)}},mg=function(e,t){var n={target:e,props:[],revert:fg,save:dg};return e._gsap||km.core.getCache(e),t&&e.style&&e.nodeType&&t.split(",").forEach((function(e){return n.save(e)})),n},gg=function(e,t){var n=Fm.createElementNS?Fm.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Fm.createElement(e);return n&&n.style?n:Fm.createElement(e)},vg=function e(t,n,r){var i=getComputedStyle(t);return i[n]||i.getPropertyValue(n.replace(qm,"-$1").toLowerCase())||i.getPropertyValue(n)||!r&&e(t,_g(n)||n,1)||""},yg="O,Moz,ms,Ms,Webkit".split(","),_g=function(e,t,n){var r=(t||zm).style,i=5;if(e in r&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);i--&&!(yg[i]+e in r););return i<0?null:(3===i?"ms":i>=0?yg[i]:"")+e},xg=function(){typeof window<"u"&&window.document&&(Om=window,Fm=Om.document,Um=Fm.documentElement,zm=gg("div")||{style:{}},gg("div"),ug=_g(ug),hg=ug+"Origin",zm.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",Hm=!!_g("perspective"),jm=km.core.reverting,Bm=1)},bg=function(e){var t,n=e.ownerSVGElement,r=gg("svg",n&&n.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=e.cloneNode(!0);i.style.display="block",r.appendChild(i),Um.appendChild(r);try{t=i.getBBox()}catch{}return r.removeChild(i),Um.removeChild(r),t},wg=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},Tg=function(e){var t,n;try{t=e.getBBox()}catch{t=bg(e),n=1}return t&&(t.width||t.height)||n||(t=bg(e)),!t||t.width||t.x||t.y?t:{x:+wg(e,["x","cx","x1"])||0,y:+wg(e,["y","cy","y1"])||0,width:0,height:0}},Mg=function(e){return!(!e.getCTM||e.parentNode&&!e.ownerSVGElement||!Tg(e))},Ag=function(e,t){if(t){var n,r=e.style;t in Gm&&t!==hg&&(t=ug),r.removeProperty?(("ms"===(n=t.substr(0,2))||"webkit"===t.substr(0,6))&&(t="-"+t),r.removeProperty("--"===n?t:t.replace(qm,"-$1").toLowerCase())):r.removeAttribute(t)}},Sg=function(e,t,n,r,i,s){var o=new bm(e._pt,t,n,0,1,s?rg:ng);return e._pt=o,o.b=r,o.e=i,e._props.push(n),o},Eg={deg:1,rad:1,turn:1},Pg={grid:1,flex:1},Cg=function e(t,n,r,i){var s,o,a,l,c=parseFloat(r)||0,u=(r+"").trim().substr((c+"").length)||"px",h=zm.style,d=Ym.test(n),p="svg"===t.tagName.toLowerCase(),f=(p?"client":"offset")+(d?"Width":"Height"),m=100,g="px"===i,v="%"===i;if(i===u||!c||Eg[i]||Eg[u])return c;if("px"!==u&&!g&&(c=e(t,n,r,"px")),l=t.getCTM&&Mg(t),(v||"%"===u)&&(Gm[n]||~n.indexOf("adius")))return s=l?t.getBBox()[d?"width":"height"]:t[f],Tp(v?c/s*m:c/100*s);if(h[d?"width":"height"]=m+(g?u:i),o="rem"!==i&&~n.indexOf("adius")||"em"===i&&t.appendChild&&!p?t:t.parentNode,l&&(o=(t.ownerSVGElement||{}).parentNode),(!o||o===Fm||!o.appendChild)&&(o=Fm.body),(a=o._gsap)&&v&&a.width&&d&&a.time===Of.time&&!a.uncache)return Tp(c/a.width*m);if(!v||"height"!==n&&"width"!==n)(v||"%"===u)&&!Pg[vg(o,"display")]&&(h.position=vg(t,"position")),o===t&&(h.position="static"),o.appendChild(zm),s=zm[f],o.removeChild(zm),h.position="absolute";else{var y=t.style[n];t.style[n]=m+i,s=t[f],y?t.style[n]=y:Ag(t,n)}return d&&v&&((a=xp(o)).time=Of.time,a.width=o[f]),Tp(g?s*c/m:s&&c?m/s*c:0)},Rg=function(e,t,n,r){var i;return Bm||xg(),t in $m&&"transform"!==t&&(~(t=$m[t]).indexOf(",")&&(t=t.split(",")[0])),Gm[t]&&"transform"!==t?(i=Hg(e,r),i="transformOrigin"!==t?i[t]:i.svg?i.origin:Gg(vg(e,hg))+" "+i.zOrigin+"px"):(!(i=e.style[t])||"auto"===i||r||~(i+"").indexOf("calc("))&&(i=Og[t]&&Og[t](e,t,n)||vg(e,t)||bp(e,t)||("opacity"===t?1:0)),n&&!~(i+"").trim().indexOf(" ")?Cg(e,t,i,n)+n:i},Lg=function(e,t,n,r){if(!n||"none"===n){var i=_g(t,e,1),s=i&&vg(e,i,1);s&&s!==n?(t=i,n=s):"borderColor"===t&&(n=vg(e,"borderTopColor"))}var o,a,l,c,u,h,d,p,f,m,g,v=new bm(this._pt,e.style,t,0,1,mm),y=0,_=0;if(v.b=n,v.e=r,n+="","var(--"===(r+="").substring(0,6)&&(r=vg(e,r.substring(4,r.indexOf(")")))),"auto"===r&&(h=e.style[t],e.style[t]=r,r=vg(e,t)||r,h?e.style[t]=h:Ag(e,t)),kf(o=[n,r]),r=o[1],l=(n=o[0]).match(Zd)||[],(r.match(Zd)||[]).length){for(;a=Zd.exec(r);)d=a[0],f=r.substring(y,a.index),u?u=(u+1)%5:("rgba("===f.substr(-5)||"hsla("===f.substr(-5))&&(u=1),d!==(h=l[_++]||"")&&(c=parseFloat(h)||0,g=h.substr((c+"").length),"="===d.charAt(1)&&(d=Ap(c,d)+g),p=parseFloat(d),m=d.substr((p+"").length),y=Zd.lastIndex-m.length,m||(m=m||Pd.units[t]||g,y===r.length&&(r+=m,v.e+=m)),g!==m&&(c=Cg(e,t,h,m)||0),v._pt={_next:v._pt,p:f||1===_?f:",",s:c,c:p-c,m:u&&u<4||"zIndex"===t?Math.round:0});v.c=y<r.length?r.substring(y,r.length):""}else v.r="display"===t&&"none"===r?rg:ng;return Qd.test(r)&&(v.e=0),this._pt=v,v},Ig={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Dg=function(e){var t=e.split(" "),n=t[0],r=t[1]||"50%";return("top"===n||"bottom"===n||"left"===r||"right"===r)&&(e=n,n=r,r=e),t[0]=Ig[n]||n,t[1]=Ig[r]||r,t.join(" ")},kg=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n,r,i,s=t.t,o=s.style,a=t.u,l=s._gsap;if("all"===a||!0===a)o.cssText="",r=1;else for(i=(a=a.split(",")).length;--i>-1;)n=a[i],Gm[n]&&(r=1,n="transformOrigin"===n?hg:ug),Ag(s,n);r&&(Ag(s,ug),l&&(l.svg&&s.removeAttribute("transform"),o.scale=o.rotate=o.translate="none",Hg(s,1),l.uncache=1,pg(o)))}},Og={clearProps:function(e,t,n,r,i){if("isFromStart"!==i.data){var s=e._pt=new bm(e._pt,t,n,0,0,kg);return s.u=r,s.pr=-10,s.tween=i,e._props.push(n),1}}},Fg=[1,0,0,1,0,0],Ug={},Bg=function(e){return"matrix(1, 0, 0, 1, 0, 0)"===e||"none"===e||!e},zg=function(e){var t=vg(e,ug);return Bg(t)?Fg:t.substr(7).match(Yd).map(Tp)},Ng=function(e,t){var n,r,i,s,o=e._gsap||xp(e),a=e.style,l=zg(e);return o.svg&&e.getAttribute("transform")?"1,0,0,1,0,0"===(l=[(i=e.transform.baseVal.consolidate().matrix).a,i.b,i.c,i.d,i.e,i.f]).join(",")?Fg:l:(l===Fg&&!e.offsetParent&&e!==Um&&!o.svg&&(i=a.display,a.display="block",(!(n=e.parentNode)||!e.offsetParent&&!e.getBoundingClientRect().width)&&(s=1,r=e.nextElementSibling,Um.appendChild(e)),l=zg(e),i?a.display=i:Ag(e,"display"),s&&(r?n.insertBefore(e,r):n?n.appendChild(e):Um.removeChild(e))),t&&l.length>6?[l[0],l[1],l[4],l[5],l[12],l[13]]:l)},jg=function(e,t,n,r,i,s){var o,a,l,c=e._gsap,u=i||Ng(e,!0),h=c.xOrigin||0,d=c.yOrigin||0,p=c.xOffset||0,f=c.yOffset||0,m=u[0],g=u[1],v=u[2],y=u[3],_=u[4],x=u[5],b=t.split(" "),w=parseFloat(b[0])||0,T=parseFloat(b[1])||0;n?u!==Fg&&(a=m*y-g*v)&&(l=w*(-g/a)+T*(m/a)-(m*x-g*_)/a,w=w*(y/a)+T*(-v/a)+(v*x-y*_)/a,T=l):(w=(o=Tg(e)).x+(~b[0].indexOf("%")?w/100*o.width:w),T=o.y+(~(b[1]||b[0]).indexOf("%")?T/100*o.height:T)),r||!1!==r&&c.smooth?(_=w-h,x=T-d,c.xOffset=p+(_*m+x*v)-_,c.yOffset=f+(_*g+x*y)-x):c.xOffset=c.yOffset=0,c.xOrigin=w,c.yOrigin=T,c.smooth=!!r,c.origin=t,c.originIsAbsolute=!!n,e.style[hg]="0px 0px",s&&(Sg(s,c,"xOrigin",h,w),Sg(s,c,"yOrigin",d,T),Sg(s,c,"xOffset",p,c.xOffset),Sg(s,c,"yOffset",f,c.yOffset)),e.setAttribute("data-svg-origin",w+" "+T)},Hg=function(e,t){var n=e._gsap||new qf(e);if("x"in n&&!t&&!n.uncache)return n;var r,i,s,o,a,l,c,u,h,d,p,f,m,g,v,y,_,x,b,w,T,M,A,S,E,P,C,R,L,I,D,k,O=e.style,F=n.scaleX<0,U="px",B="deg",z=getComputedStyle(e),N=vg(e,hg)||"0";return r=i=s=l=c=u=h=d=p=0,o=a=1,n.svg=!(!e.getCTM||!Mg(e)),z.translate&&(("none"!==z.translate||"none"!==z.scale||"none"!==z.rotate)&&(O[ug]=("none"!==z.translate?"translate3d("+(z.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+("none"!==z.rotate?"rotate("+z.rotate+") ":"")+("none"!==z.scale?"scale("+z.scale.split(" ").join(",")+") ":"")+("none"!==z[ug]?z[ug]:"")),O.scale=O.rotate=O.translate="none"),g=Ng(e,n.svg),n.svg&&(n.uncache?(E=e.getBBox(),N=n.xOrigin-E.x+"px "+(n.yOrigin-E.y)+"px",S=""):S=!t&&e.getAttribute("data-svg-origin"),jg(e,S||N,!!S||n.originIsAbsolute,!1!==n.smooth,g)),f=n.xOrigin||0,m=n.yOrigin||0,g!==Fg&&(x=g[0],b=g[1],w=g[2],T=g[3],r=M=g[4],i=A=g[5],6===g.length?(o=Math.sqrt(x*x+b*b),a=Math.sqrt(T*T+w*w),l=x||b?Xm(b,x)*Vm:0,(h=w||T?Xm(w,T)*Vm+l:0)&&(a*=Math.abs(Math.cos(h*Wm))),n.svg&&(r-=f-(f*x+m*w),i-=m-(f*b+m*T))):(k=g[6],I=g[7],C=g[8],R=g[9],L=g[10],D=g[11],r=g[12],i=g[13],s=g[14],c=(v=Xm(k,L))*Vm,v&&(S=M*(y=Math.cos(-v))+C*(_=Math.sin(-v)),E=A*y+R*_,P=k*y+L*_,C=M*-_+C*y,R=A*-_+R*y,L=k*-_+L*y,D=I*-_+D*y,M=S,A=E,k=P),u=(v=Xm(-w,L))*Vm,v&&(y=Math.cos(-v),D=T*(_=Math.sin(-v))+D*y,x=S=x*y-C*_,b=E=b*y-R*_,w=P=w*y-L*_),l=(v=Xm(b,x))*Vm,v&&(S=x*(y=Math.cos(v))+b*(_=Math.sin(v)),E=M*y+A*_,b=b*y-x*_,A=A*y-M*_,x=S,M=E),c&&Math.abs(c)+Math.abs(l)>359.9&&(c=l=0,u=180-u),o=Tp(Math.sqrt(x*x+b*b+w*w)),a=Tp(Math.sqrt(A*A+k*k)),v=Xm(M,A),h=Math.abs(v)>2e-4?v*Vm:0,p=D?1/(D<0?-D:D):0),n.svg&&(S=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!Bg(vg(e,ug)),S&&e.setAttribute("transform",S))),Math.abs(h)>90&&Math.abs(h)<270&&(F?(o*=-1,h+=l<=0?180:-180,l+=l<=0?180:-180):(a*=-1,h+=h<=0?180:-180)),t=t||n.uncache,n.x=r-((n.xPercent=r&&(!t&&n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-r)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+U,n.y=i-((n.yPercent=i&&(!t&&n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-i)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+U,n.z=s+U,n.scaleX=Tp(o),n.scaleY=Tp(a),n.rotation=Tp(l)+B,n.rotationX=Tp(c)+B,n.rotationY=Tp(u)+B,n.skewX=h+B,n.skewY=d+B,n.transformPerspective=p+U,(n.zOrigin=parseFloat(N.split(" ")[2])||!t&&n.zOrigin||0)&&(O[hg]=Gg(N)),n.xOffset=n.yOffset=0,n.force3D=Pd.force3D,n.renderTransform=n.svg?Zg:Hm?Yg:Wg,n.uncache=0,n},Gg=function(e){return(e=e.split(" "))[0]+" "+e[1]},Vg=function(e,t,n){var r=lf(t);return Tp(parseFloat(t)+parseFloat(Cg(e,"x",n+"px",r)))+r},Wg=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,Yg(e,t)},Xg="0deg",Kg="0px",qg=") ",Yg=function(e,t){var n=t||this,r=n.xPercent,i=n.yPercent,s=n.x,o=n.y,a=n.z,l=n.rotation,c=n.rotationY,u=n.rotationX,h=n.skewX,d=n.skewY,p=n.scaleX,f=n.scaleY,m=n.transformPerspective,g=n.force3D,v=n.target,y=n.zOrigin,_="",x="auto"===g&&e&&1!==e||!0===g;if(y&&(u!==Xg||c!==Xg)){var b,w=parseFloat(c)*Wm,T=Math.sin(w),M=Math.cos(w);w=parseFloat(u)*Wm,b=Math.cos(w),s=Vg(v,s,T*b*-y),o=Vg(v,o,-Math.sin(w)*-y),a=Vg(v,a,M*b*-y+y)}m!==Kg&&(_+="perspective("+m+qg),(r||i)&&(_+="translate("+r+"%, "+i+"%) "),(x||s!==Kg||o!==Kg||a!==Kg)&&(_+=a!==Kg||x?"translate3d("+s+", "+o+", "+a+") ":"translate("+s+", "+o+qg),l!==Xg&&(_+="rotate("+l+qg),c!==Xg&&(_+="rotateY("+c+qg),u!==Xg&&(_+="rotateX("+u+qg),(h!==Xg||d!==Xg)&&(_+="skew("+h+", "+d+qg),(1!==p||1!==f)&&(_+="scale("+p+", "+f+qg),v.style[ug]=_||"translate(0, 0)"},Zg=function(e,t){var n,r,i,s,o,a=t||this,l=a.xPercent,c=a.yPercent,u=a.x,h=a.y,d=a.rotation,p=a.skewX,f=a.skewY,m=a.scaleX,g=a.scaleY,v=a.target,y=a.xOrigin,_=a.yOrigin,x=a.xOffset,b=a.yOffset,w=a.forceCSS,T=parseFloat(u),M=parseFloat(h);d=parseFloat(d),p=parseFloat(p),(f=parseFloat(f))&&(p+=f=parseFloat(f),d+=f),d||p?(d*=Wm,p*=Wm,n=Math.cos(d)*m,r=Math.sin(d)*m,i=Math.sin(d-p)*-g,s=Math.cos(d-p)*g,p&&(f*=Wm,o=Math.tan(p-f),i*=o=Math.sqrt(1+o*o),s*=o,f&&(o=Math.tan(f),n*=o=Math.sqrt(1+o*o),r*=o)),n=Tp(n),r=Tp(r),i=Tp(i),s=Tp(s)):(n=m,s=g,r=i=0),(T&&!~(u+"").indexOf("px")||M&&!~(h+"").indexOf("px"))&&(T=Cg(v,"x",u,"px"),M=Cg(v,"y",h,"px")),(y||_||x||b)&&(T=Tp(T+y-(y*n+_*i)+x),M=Tp(M+_-(y*r+_*s)+b)),(l||c)&&(o=v.getBBox(),T=Tp(T+l/100*o.width),M=Tp(M+c/100*o.height)),o="matrix("+n+","+r+","+i+","+s+","+T+","+M+")",v.setAttribute("transform",o),w&&(v.style[ug]=o)},$g=function(e,t,n,r,i){var s,o,a=360,l=Bd(i),c=parseFloat(i)*(l&&~i.indexOf("rad")?Vm:1)-r,u=r+c+"deg";return l&&("short"===(s=i.split("_")[1])&&((c%=a)!==c%180&&(c+=c<0?a:-360)),"cw"===s&&c<0?c=(c+a*Km)%a-~~(c/a)*a:"ccw"===s&&c>0&&(c=(c-a*Km)%a-~~(c/a)*a)),e._pt=o=new bm(e._pt,t,n,r,c,Jm),o.e=u,o.u="deg",e._props.push(n),o},Qg=function(e,t){for(var n in t)e[n]=t[n];return e},Jg=function(e,t,n){var r,i,s,o,a,l,c,u=Qg({},n._gsap),h=n.style;for(i in u.svg?(s=n.getAttribute("transform"),n.setAttribute("transform",""),h[ug]=t,r=Hg(n,1),Ag(n,ug),n.setAttribute("transform",s)):(s=getComputedStyle(n)[ug],h[ug]=t,r=Hg(n,1),h[ug]=s),Gm)(s=u[i])!==(o=r[i])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(i)<0&&(a=lf(s)!==(c=lf(o))?Cg(n,i,s,c):parseFloat(s),l=parseFloat(o),e._pt=new bm(e._pt,r,i,a,l-a,Qm),e._pt.u=c||0,e._props.push(i));Qg(r,u)};wp("padding,margin,Width,Radius",(function(e,t){var n="Top",r="Right",i="Bottom",s="Left",o=(t<3?[n,r,i,s]:[n+s,n+r,i+r,i+s]).map((function(n){return t<2?e+n:"border"+n+e}));Og[t>1?"border"+e:e]=function(e,t,n,r,i){var s,a;if(arguments.length<4)return s=o.map((function(t){return Rg(e,t,n)})),5===(a=s.join(" ")).split(s[0]).length?s[0]:a;s=(r+"").split(" "),a={},o.forEach((function(e,t){return a[e]=s[t]=s[t]||s[(t-1)/2|0]})),e.init(t,a,i)}}));var ev={name:"css",register:xg,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,r,i){var s,o,a,l,c,u,h,d,p,f,m,g,v,y,_,x,b=this._props,w=e.style,T=n.vars.startAt;for(h in Bm||xg(),this.styles=this.styles||mg(e),x=this.styles.props,this.tween=n,t)if("autoRound"!==h&&(o=t[h],!fp[h]||!tm(h,t,n,r,e,i)))if(c=typeof o,u=Og[h],"function"===c&&(c=typeof(o=o.call(n,r,e,i))),"string"===c&&~o.indexOf("random(")&&(o=_f(o)),u)u(this,e,h,o,n)&&(_=1);else if("--"===h.substr(0,2))s=(getComputedStyle(e).getPropertyValue(h)+"").trim(),o+="",If.lastIndex=0,If.test(s)||(d=lf(s),p=lf(o)),p?d!==p&&(s=Cg(e,h,s,p)+p):d&&(o+=d),this.add(w,"setProperty",s,o,r,i,0,0,h),b.push(h),x.push(h,0,w[h]);else if("undefined"!==c){if(T&&h in T?(s="function"==typeof T[h]?T[h].call(n,r,e,i):T[h],Bd(s)&&~s.indexOf("random(")&&(s=_f(s)),lf(s+"")||"auto"===s||(s+=Pd.units[h]||lf(Rg(e,h))||""),"="===(s+"").charAt(1)&&(s=Rg(e,h))):s=Rg(e,h),l=parseFloat(s),(f="string"===c&&"="===o.charAt(1)&&o.substr(0,2))&&(o=o.substr(2)),a=parseFloat(o),h in $m&&("autoAlpha"===h&&(1===l&&"hidden"===Rg(e,"visibility")&&a&&(l=0),x.push("visibility",0,w.visibility),Sg(this,w,"visibility",l?"inherit":"hidden",a?"inherit":"hidden",!a)),"scale"!==h&&"transform"!==h&&(~(h=$m[h]).indexOf(",")&&(h=h.split(",")[0]))),m=h in Gm)if(this.styles.save(h),"string"===c&&"var(--"===o.substring(0,6)&&(o=vg(e,o.substring(4,o.indexOf(")"))),a=parseFloat(o)),g||((v=e._gsap).renderTransform&&!t.parseTransform||Hg(e,t.parseTransform),y=!1!==t.smoothOrigin&&v.smooth,(g=this._pt=new bm(this._pt,w,ug,0,1,v.renderTransform,v,0,-1)).dep=1),"scale"===h)this._pt=new bm(this._pt,v,"scaleY",v.scaleY,(f?Ap(v.scaleY,f+a):a)-v.scaleY||0,Qm),this._pt.u=0,b.push("scaleY",h),h+="X";else{if("transformOrigin"===h){x.push(hg,0,w[hg]),o=Dg(o),v.svg?jg(e,o,0,y,0,this):((p=parseFloat(o.split(" ")[2])||0)!==v.zOrigin&&Sg(this,v,"zOrigin",v.zOrigin,p),Sg(this,w,h,Gg(s),Gg(o)));continue}if("svgOrigin"===h){jg(e,o,1,y,0,this);continue}if(h in Ug){$g(this,v,h,l,f?Ap(l,f+o):o);continue}if("smoothOrigin"===h){Sg(this,v,"smooth",v.smooth,o);continue}if("force3D"===h){v[h]=o;continue}if("transform"===h){Jg(this,o,e);continue}}else h in w||(h=_g(h)||h);if(m||(a||0===a)&&(l||0===l)&&!Zm.test(o)&&h in w)a||(a=0),(d=(s+"").substr((l+"").length))!==(p=lf(o)||(h in Pd.units?Pd.units[h]:d))&&(l=Cg(e,h,s,p)),this._pt=new bm(this._pt,m?v:w,h,l,(f?Ap(l,f+a):a)-l,m||"px"!==p&&"zIndex"!==h||!1===t.autoRound?Qm:tg),this._pt.u=p||0,d!==p&&"%"!==p&&(this._pt.b=s,this._pt.r=eg);else if(h in w)Lg.call(this,e,h,s,f?f+o:o);else if(h in e)this.add(e,h,s||e[h],f?f+o:o,r,i);else if("parseTransform"!==h){ip(h,o);continue}m||(h in w?x.push(h,0,w[h]):"function"==typeof e[h]?x.push(h,2,e[h]()):x.push(h,1,s||e[h])),b.push(h)}_&&xm(this)},render:function(e,t){if(t.tween._time||!jm())for(var n=t._pt;n;)n.r(e,n.d),n=n._next;else t.styles.revert()},get:Rg,aliases:$m,getSetter:function(e,t,n){var r=$m[t];return r&&r.indexOf(",")<0&&(t=r),t in Gm&&t!==hg&&(e._gsap.x||Rg(e,"x"))?n&&Nm===n?"scale"===t?ag:og:(Nm=n||{})&&("scale"===t?lg:cg):e.style&&!jd(e.style[t])?ig:~t.indexOf("-")?sg:dm(e,t)},core:{_removeProperty:Ag,_getMatrix:Ng}};km.utils.checkPrefix=_g,km.core.getStyleSaver=mg,function(e,t){var n=wp(e+","+t+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",(function(e){Gm[e]=1}));wp(t,(function(e){Pd.units[e]="deg",Ug[e]=1})),$m[n[13]]=e+","+t,wp("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",(function(e){var t=e.split(":");$m[t[1]]=n[t[0]]}))}("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY"),wp("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",(function(e){Pd.units[e]="px"})),km.registerPlugin(ev);var tv=km.registerPlugin(ev)||km;tv.core.Tween;const nv={linear:"none",easeInQuad:"power2.in",easeOutQuad:"power2.out"};class rv{constructor(e,t,n={}){this.target=e,this.toVars=t,this.config=n}tween=null;start(){return new Promise((e=>{this.tween&&this.tween.kill();const{duration:t=.5,easing:n=nv.linear,delay:r=0,repeat:i=0,yoyo:s=!1,onStart:o,onUpdate:a,onComplete:l,onPause:c,onResume:u}=this.config;this.tween=tv.to(this.target.scale,{...this.toVars,duration:t,ease:n,delay:r,repeat:i,yoyo:s,onStart:()=>{o?.()},onUpdate:()=>{this.target.updateMatrixWorld(!0);const e=this.tween?.progress()||0;a?.(e,this.target)},onComplete:()=>{l?.(),e()},onPause:()=>{c?.()},onResume:()=>{u?.()}})}))}stop(){this.tween&&(this.tween.kill(),this.tween=null)}isRunning(){return!!this.tween&&this.tween.isActive()}pause(){this.tween&&this.tween.pause()}resume(){this.tween&&this.tween.resume()}progress(e){return this.tween?void 0!==e?(this.tween.progress(e),e):this.tween.progress():0}}function iv(e,t,n,r={}){return function(e,t,n,r={}){return e.scale.copy(t),new rv(e,{x:n.x,y:n.y,z:n.z},r)}(e,new ne(1,t,1),new ne(1,n,1),r)}class sv{animations=new Map;timeline=null;constructor(){this.timeline=tv.timeline()}async startAnimation(e,t,n=!0){n&&this.animations.has(e)&&this.stopAnimation(e),this.animations.set(e,t);try{await t.start()}finally{this.animations.delete(e)}}stopAnimation(e){const t=this.animations.get(e);t&&(t.stop(),this.animations.delete(e))}pauseAnimation(e){const t=this.animations.get(e);t&&t.pause()}resumeAnimation(e){const t=this.animations.get(e);t&&t.resume()}setAnimationProgress(e,t){const n=this.animations.get(e);n&&n.progress(t)}stopAllAnimations(){this.animations.forEach((e=>e.stop())),this.animations.clear()}pauseAllAnimations(){this.animations.forEach((e=>e.pause()))}resumeAllAnimations(){this.animations.forEach((e=>e.resume()))}isAnimationRunning(e){const t=this.animations.get(e);return!!t&&t.isRunning()}getRunningAnimationsCount(){return Array.from(this.animations.values()).filter((e=>e.isRunning())).length}getAnimationKeys(){return Array.from(this.animations.keys())}cleanup(){this.stopAllAnimations(),this.timeline&&(this.timeline.kill(),this.timeline=null)}}new sv;const ov={easing:nv.easeOutQuad,duration:.3},av={easing:nv.easeInQuad,duration:.2},lv=["object"],cv=e({__name:"Tileset",props:{url:{}},setup(e,{expose:t}){const n=e,{camera:r,renderer:i}=fr();let o=B(new eu(n.url));o.fetchOptions.mode="cors",o.lruCache.minSize=900,o.lruCache.maxSize=1300,o.errorTarget=12,o.registerPlugin(new sd),o.getPluginByName("DEBUG_TILES_PLUGIN").displayBoxBounds=!0;const u=new sv;function d(e){return`tile_${e.uuid}`}a(r,(()=>{r.value&&(o.setCamera(r.value),o.setResolutionFromRenderer(r.value,i.value))}),{immediate:!0}),o.addEventListener("load-model",(({scene:e})=>{e.traverse((e=>{if(e.material){const t=e;Array.isArray(t.material)?t.material.forEach((e=>{e.side=se})):t.material.side=se}}))})),((e,t)=>{e.addEventListener("tile-visibility-change",(({tile:e,visible:n})=>{const r=e.cached.scene;n&&t(r,e)}))})(o,(async(e,t)=>{if(e){const t=e.children[0],n=d(t),r=iv(t,0,1,{...ov,duration:.2});await u.startAnimation(n,r,!0)}})),((e,t)=>{e.addEventListener("tile-visibility-change",(({tile:n,visible:r})=>{const i=n.cached.scene,s=e.group;r||(i&&(s.add(i),i.updateMatrixWorld(!0)),t(i,n).then((()=>{i&&s.remove(i)})))}))})(o,(async(e,t)=>{if(e){const t=e.children[0],n=d(t),r=iv(t,1,0,{...av,duration:.2});await u.startAnimation(n,r,!0)}}));const{onBeforeLoop:p}=Sr();return p((()=>{o.update()})),l((()=>{console.log("清理动画管理器"),u.cleanup()})),t({animationManager:u,pauseAllAnimations:()=>u.pauseAllAnimations(),resumeAllAnimations:()=>u.resumeAllAnimations(),stopAllAnimations:()=>u.stopAllAnimations(),getRunningAnimationsCount:()=>u.getRunningAnimationsCount(),getAnimationKeys:()=>u.getAnimationKeys()}),(e,t)=>h(o)?(c(),s("primitive",{key:0,object:h(o)?.group},null,8,lv)):C("",!0)}});var uv=Object.defineProperty,hv=(e,t,n)=>((e,t,n)=>t in e?uv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);function dv(e,t,n,r){const i=class extends ge{constructor(r={}){const i=Object.entries(e);super({uniforms:i.reduce(((e,[t,n])=>({...e,...Xt.clone({[t]:{value:n}})})),{}),vertexShader:t,fragmentShader:n}),hv(this,"key",""),i.forEach((([e])=>Object.defineProperty(this,e,{get:()=>this.uniforms[e].value,set:t=>this.uniforms[e].value=t}))),Object.assign(this,r)}};return i.key=Y.generateUUID(),i}typeof WorkerGlobalScope<"u"&&(globalThis,WorkerGlobalScope),dv({color:new q("white"),scale:new te(1,1),imageBounds:new te(1,1),resolution:1024,map:null,zoom:1,radius:0,grayscale:0,opacity:1},"\n    varying vec2 vUv;\n    varying vec2 vPos;\n    void main() {\n      gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);\n      vUv = uv;\n      vPos = position.xy;\n    }\n  ","\n    // mostly from https://gist.github.com/statico/df64c5d167362ecf7b34fca0b1459a44\n    varying vec2 vUv;\n    varying vec2 vPos;\n    uniform vec2 scale;\n    uniform vec2 imageBounds;\n    uniform float resolution;\n    uniform vec3 color;\n    uniform sampler2D map;\n    uniform float radius;\n    uniform float zoom;\n    uniform float grayscale;\n    uniform float opacity;\n    const vec3 luma = vec3(.299, 0.587, 0.114);\n    vec4 toGrayscale(vec4 color, float intensity) {\n      return vec4(mix(color.rgb, vec3(dot(color.rgb, luma)), intensity), color.a);\n    }\n    vec2 aspect(vec2 size) {\n      return size / min(size.x, size.y);\n    }\n    \n    const float PI = 3.14159265;\n      \n    // from https://iquilezles.org/articles/distfunctions\n    float udRoundBox( vec2 p, vec2 b, float r ) {\n      return length(max(abs(p)-b+r,0.0))-r;\n    }\n  \n    void main() {\n      vec2 s = aspect(scale);\n      vec2 i = aspect(imageBounds);\n      float rs = s.x / s.y;\n      float ri = i.x / i.y;\n      vec2 new = rs < ri ? vec2(i.x * s.y / i.y, s.y) : vec2(s.x, i.y * s.x / i.x);\n      vec2 offset = (rs < ri ? vec2((new.x - s.x) / 2.0, 0.0) : vec2(0.0, (new.y - s.y) / 2.0)) / new;\n      vec2 uv = vUv * s / new + offset;\n      vec2 zUv = (uv - vec2(0.5, 0.5)) / zoom + vec2(0.5, 0.5);\n  \n      vec2 res = vec2(scale * resolution);\n      vec2 halfRes = 0.5 * res;\n      float b = udRoundBox(vUv.xy * res - halfRes, halfRes, resolution * radius);    \n        vec3 a = mix(vec3(1.0,0.0,0.0), vec3(0.0,0.0,0.0), smoothstep(0.0, 1.0, b));\n      gl_FragColor = toGrayscale(texture2D(map, zUv) * vec4(color, opacity * a), grayscale);\n      \n      #include <tonemapping_fragment>\n      #include <colorspace_fragment>\n    }\n  ");const pv=parseInt(J.replace(/\D+/g,""));function fv(e,t){if(t===Ht)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===Gt||t===Vt){let n=e.getIndex();if(null===n){const t=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<r.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const r=n.count-2,i=[];if(n)if(t===Gt)for(let e=1;e<=r;e++)i.push(n.getX(0)),i.push(n.getX(e)),i.push(n.getX(e+1));else for(let e=0;e<r;e++)e%2==0?(i.push(n.getX(e)),i.push(n.getX(e+1)),i.push(n.getX(e+2))):(i.push(n.getX(e+2)),i.push(n.getX(e+1)),i.push(n.getX(e)));i.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=e.clone();return s.setIndex(i),s.clearGroups(),s}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}var mv=Object.defineProperty;async function gv(e){const t=await e.arrayBuffer(),n=btoa(String.fromCharCode(...new Uint8Array(t)));return`data:${e.type||""};base64,${n}`}let vv,yv,_v,xv;function bv(e,t=1/0,n=null){yv||(yv=new lt(2,2,1,1)),_v||(_v=new ge({uniforms:{blitTexture:new be(e)},vertexShader:"\n        varying vec2 vUv;\n        void main(){\n            vUv = uv;\n            gl_Position = vec4(position.xy * 1.0,0.,.999999);\n        }\n      ",fragmentShader:"\n          uniform sampler2D blitTexture; \n          varying vec2 vUv;\n\n          void main(){ \n              gl_FragColor = vec4(vUv.xy, 0, 1);\n              \n              #ifdef IS_SRGB\n              gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );\n              #else\n              gl_FragColor = texture2D( blitTexture, vUv);\n              #endif\n          }\n      "})),_v.uniforms.blitTexture.value=e,_v.defines.IS_SRGB="colorSpace"in e?"srgb"===e.colorSpace:3001===e.encoding,_v.needsUpdate=!0,xv||(xv=new oe(yv,_v),xv.frustrumCulled=!1);const r=new j,i=new N;i.add(xv),n||(n=vv=new G({antialias:!1})),n.setSize(Math.min(e.image.width,t),Math.min(e.image.height,t)),n.clear(),n.render(i,r);const s=new Me(n.domElement);return s.minFilter=e.minFilter,s.magFilter=e.magFilter,s.wrapS=e.wrapS,s.wrapT=e.wrapT,s.name=e.name,vv&&(vv.dispose(),vv=null),s}const wv={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class Tv{constructor(){this.pluginCallbacks=[],this.register((function(e){return new ry(e)})),this.register((function(e){return new iy(e)})),this.register((function(e){return new ay(e)})),this.register((function(e){return new ly(e)})),this.register((function(e){return new cy(e)})),this.register((function(e){return new uy(e)})),this.register((function(e){return new sy(e)})),this.register((function(e){return new oy(e)})),this.register((function(e){return new hy(e)})),this.register((function(e){return new dy(e)})),this.register((function(e){return new py(e)}))}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){const i=new ny,s=[];for(let o=0,a=this.pluginCallbacks.length;o<a;o++)s.push(this.pluginCallbacks[o](i));i.setPlugins(s),i.write(e,t,r).catch(n)}parseAsync(e,t){const n=this;return new Promise((function(r,i){n.parse(e,r,i,t)}))}}((e,t,n)=>{((e,t,n)=>{t in e?mv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,t+"",n)})(Tv,"Utils",{insertKeyframe:function(e,t){const n=e.getValueSize(),r=new e.TimeBufferType(e.times.length+1),i=new e.ValueBufferType(e.values.length+n),s=e.createInterpolant(new e.ValueBufferType(n));let o;if(0===e.times.length){r[0]=t;for(let e=0;e<n;e++)i[e]=0;o=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<.001)return 0;r[0]=t,r.set(e.times,1),i.set(s.evaluate(t),0),i.set(e.values,n),o=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<.001)return e.times.length-1;r[r.length-1]=t,r.set(e.times,0),i.set(e.values,0),i.set(s.evaluate(t),e.values.length),o=r.length-1}else for(let a=0;a<e.times.length;a++){if(Math.abs(e.times[a]-t)<.001)return a;if(e.times[a]<t&&e.times[a+1]>t){r.set(e.times.slice(0,a+1),0),r[a+1]=t,r.set(e.times.slice(a+1),a+2),i.set(e.values.slice(0,(a+1)*n),0),i.set(s.evaluate(t),(a+1)*n),i.set(e.values.slice((a+1)*n),(a+2)*n),o=a+1;break}}return e.times=r,e.values=i,o},mergeMorphTargetTracks:function(e,t){const n=[],r={},i=e.tracks;for(let s=0;s<i.length;++s){let e=i[s];const o=St.parseTrackName(e.name),a=St.findNode(t,o.nodeName);if("morphTargetInfluences"!==o.propertyName||void 0===o.propertyIndex){n.push(e);continue}if(e.createInterpolant!==e.InterpolantFactoryMethodDiscrete&&e.createInterpolant!==e.InterpolantFactoryMethodLinear){if(e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),e=e.clone(),e.setInterpolation(kt)}const l=a.morphTargetInfluences.length,c=a.morphTargetDictionary[o.propertyIndex];if(void 0===c)throw new Error("THREE.GLTFExporter: Morph target name not found: "+o.propertyIndex);let u;if(void 0===r[a.uuid]){u=e.clone();const t=new u.ValueBufferType(l*u.times.length);for(let e=0;e<u.times.length;e++)t[e*l+c]=u.values[e];u.name=(o.nodeName||"")+".morphTargetInfluences",u.values=t,r[a.uuid]=u,n.push(u);continue}const h=e.createInterpolant(new e.ValueBufferType(1));u=r[a.uuid];for(let t=0;t<u.times.length;t++)u.values[t*l+c]=h.evaluate(u.times[t]);for(let t=0;t<e.times.length;t++){const n=this.insertKeyframe(u,e.times[t]);u.values[n*l+c]=e.values[t]}}return e.tracks=n,e}});const Mv=0,Av=1,Sv=2,Ev=3,Pv=4,Cv=5120,Rv=5121,Lv=5122,Iv=5123,Dv=5124,kv=5125,Ov=5126,Fv=34962,Uv=34963,Bv=9728,zv=9729,Nv=9984,jv=9985,Hv=9986,Gv=9987,Vv=33071,Wv=33648,Xv=10497,Kv="KHR_mesh_quantization",qv={};qv[_e]=Bv,qv[wt]=Nv,qv[xt]=Hv,qv[pe]=zv,qv[bt]=jv,qv[_t]=Gv,qv[At]=Vv,qv[Tt]=Xv,qv[Mt]=Wv;const Yv={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},Zv=new q;function $v(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))}function Qv(e){return 4*Math.ceil(e/4)}function Jv(e,t=0){const n=Qv(e.byteLength);if(n!==e.byteLength){const r=new Uint8Array(n);if(r.set(new Uint8Array(e)),0!==t)for(let i=e.byteLength;i<n;i++)r[i]=t;return r.buffer}return e}function ey(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function ty(e,t){if(void 0!==e.toBlob)return new Promise((n=>e.toBlob(n,t)));let n;return"image/jpeg"===t?n=.92:"image/webp"===t&&(n=.8),e.convertToBlob({type:t,quality:n})}class ny{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,n={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const r=this,i=r.buffers,s=r.json;n=r.options;const o=r.extensionsUsed,a=r.extensionsRequired,l=new Blob(i,{type:"application/octet-stream"}),c=Object.keys(o),u=Object.keys(a);c.length>0&&(s.extensionsUsed=c),u.length>0&&(s.extensionsRequired=u),s.buffers&&s.buffers.length>0&&(s.buffers[0].byteLength=l.size),!0===n.binary?l.arrayBuffer().then((e=>{const n=Jv(e),r=new DataView(new ArrayBuffer(8));r.setUint32(0,n.byteLength,!0),r.setUint32(4,5130562,!0);const i=Jv(function(e){return(new TextEncoder).encode(e).buffer}(JSON.stringify(s)),32),o=new DataView(new ArrayBuffer(8));o.setUint32(0,i.byteLength,!0),o.setUint32(4,1313821514,!0);const a=new ArrayBuffer(12),l=new DataView(a);l.setUint32(0,1179937895,!0),l.setUint32(4,2,!0);const c=12+o.byteLength+i.byteLength+r.byteLength+n.byteLength;l.setUint32(8,c,!0),new Blob([a,o,i,r,n],{type:"application/octet-stream"}).arrayBuffer().then(t)})):s.buffers&&s.buffers.length>0?gv(l).then((e=>{s.buffers[0].uri=e,t(s)})):t(s)}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;const n=this.options,r=this.extensionsUsed;try{const i=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&i.gltfExtensions){void 0===t.extensions&&(t.extensions={});for(const e in i.gltfExtensions)t.extensions[e]=i.gltfExtensions[e],r[e]=!0;delete i.gltfExtensions}Object.keys(i).length>0&&(t.extras=i)}catch(Ed){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+Ed.message)}}getUID(e,t=!1){if(!1===this.uids.has(e)){const t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new ne;for(let n=0,r=e.count;n<r;n++)if(Math.abs(t.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const n=e.clone(),r=new ne;for(let i=0,s=n.count;i<s;i++)r.fromBufferAttribute(n,i),0===r.x&&0===r.y&&0===r.z?r.setX(1):r.normalize(),n.setXYZ(i,r.x,r.y,r.z);return t.attributesNormalized.set(e,n),n}applyTextureTransform(e,t){let n=!1;const r={};(0!==t.offset.x||0!==t.offset.y)&&(r.offset=t.offset.toArray(),n=!0),0!==t.rotation&&(r.rotation=t.rotation,n=!0),(1!==t.repeat.x||1!==t.repeat.y)&&(r.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=r,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function n(e){return("colorSpace"in e?"srgb"===e.colorSpace:3001===e.encoding)?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof Yt&&(e=bv(e)),t instanceof Yt&&(t=bv(t));const r=e?e.image:null,i=t?t.image:null,s=Math.max(r?r.width:0,i?i.width:0),o=Math.max(r?r.height:0,i?i.height:0),a=ey();a.width=s,a.height=o;const l=a.getContext("2d");l.fillStyle="#00ffff",l.fillRect(0,0,s,o);const c=l.getImageData(0,0,s,o);if(r){l.drawImage(r,0,0,s,o);const t=n(e),i=l.getImageData(0,0,s,o).data;for(let e=2;e<i.length;e+=4)c.data[e]=256*t(i[e]/256)}if(i){l.drawImage(i,0,0,s,o);const e=n(t),r=l.getImageData(0,0,s,o).data;for(let t=1;t<r.length;t+=4)c.data[t]=256*e(r[t]/256)}l.putImageData(c,0,0);const u=(e||t).clone();return u.source=new Me(a).source,"colorSpace"in u?u.colorSpace="":u.encoding=3e3,u.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),u}processBuffer(e){const t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}processBufferView(e,t,n,r,i){const s=this.json;let o;switch(s.bufferViews||(s.bufferViews=[]),t){case Cv:case Rv:o=1;break;case Lv:case Iv:o=2;break;default:o=4}const a=Qv(r*e.itemSize*o),l=new DataView(new ArrayBuffer(a));let c=0;for(let h=n;h<n+r;h++)for(let n=0;n<e.itemSize;n++){let r;e.itemSize>4?r=e.array[h*e.itemSize+n]:(0===n?r=e.getX(h):1===n?r=e.getY(h):2===n?r=e.getZ(h):3===n&&(r=e.getW(h)),!0===e.normalized&&(r=Y.normalize(r,e.array))),t===Ov?l.setFloat32(c,r,!0):t===Dv?l.setInt32(c,r,!0):t===kv?l.setUint32(c,r,!0):t===Lv?l.setInt16(c,r,!0):t===Iv?l.setUint16(c,r,!0):t===Cv?l.setInt8(c,r):t===Rv&&l.setUint8(c,r),c+=o}const u={buffer:this.processBuffer(l.buffer),byteOffset:this.byteOffset,byteLength:a};return void 0!==i&&(u.target=i),i===Fv&&(u.byteStride=e.itemSize*o),this.byteOffset+=a,s.bufferViews.push(u),{id:s.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,n=t.json;return n.bufferViews||(n.bufferViews=[]),e.arrayBuffer().then((e=>{const r=Jv(e),i={buffer:t.processBuffer(r),byteOffset:t.byteOffset,byteLength:r.byteLength};return t.byteOffset+=r.byteLength,n.bufferViews.push(i)-1}))}processAccessor(e,t,n,r){const i=this.json;let s;if(e.array.constructor===Float32Array)s=Ov;else if(e.array.constructor===Int32Array)s=Dv;else if(e.array.constructor===Uint32Array)s=kv;else if(e.array.constructor===Int16Array)s=Lv;else if(e.array.constructor===Uint16Array)s=Iv;else if(e.array.constructor===Int8Array)s=Cv;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);s=Rv}if(void 0===n&&(n=0),void 0===r&&(r=e.count),0===r)return null;const o=function(e,t,n){const r={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let i=t;i<t+n;i++)for(let t=0;t<e.itemSize;t++){let n;e.itemSize>4?n=e.array[i*e.itemSize+t]:(0===t?n=e.getX(i):1===t?n=e.getY(i):2===t?n=e.getZ(i):3===t&&(n=e.getW(i)),!0===e.normalized&&(n=Y.normalize(n,e.array))),r.min[t]=Math.min(r.min[t],n),r.max[t]=Math.max(r.max[t],n)}return r}(e,n,r);let a;void 0!==t&&(a=e===t.index?Uv:Fv);const l=this.processBufferView(e,s,n,r,a),c={bufferView:l.id,byteOffset:l.byteOffset,componentType:s,count:r,max:o.max,min:o.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(c.normalized=!0),i.accessors||(i.accessors=[]),i.accessors.push(c)-1}processImage(e,t,n,r="image/png"){if(null!==e){const i=this,s=i.cache,o=i.json,a=i.options,l=i.pending;s.images.has(e)||s.images.set(e,{});const c=s.images.get(e),u=r+":flipY/"+n.toString();if(void 0!==c[u])return c[u];o.images||(o.images=[]);const h={mimeType:r},d=ey();d.width=Math.min(e.width,a.maxTextureSize),d.height=Math.min(e.height,a.maxTextureSize);const p=d.getContext("2d");if(!0===n&&(p.translate(0,d.height),p.scale(1,-1)),void 0!==e.data){t!==Zt&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>a.maxTextureSize||e.height>a.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const n=new Uint8ClampedArray(e.height*e.width*4);for(let t=0;t<n.length;t+=4)n[t+0]=e.data[t+0],n[t+1]=e.data[t+1],n[t+2]=e.data[t+2],n[t+3]=e.data[t+3];p.putImageData(new ImageData(n,e.width,e.height),0,0)}else p.drawImage(e,0,0,d.width,d.height);!0===a.binary?l.push(ty(d,r).then((e=>i.processBufferViewImage(e))).then((e=>{h.bufferView=e}))):void 0!==d.toDataURL?h.uri=d.toDataURL(r):l.push(ty(d,r).then(gv).then((e=>{h.uri=e})));const f=o.images.push(h)-1;return c[u]=f,f}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const n={magFilter:qv[e.magFilter],minFilter:qv[e.minFilter],wrapS:qv[e.wrapS],wrapT:qv[e.wrapT]};return t.samplers.push(n)-1}processTexture(e){const t=this.options,n=this.cache,r=this.json;if(n.textures.has(e))return n.textures.get(e);r.textures||(r.textures=[]),e instanceof Yt&&(e=bv(e,t.maxTextureSize));let i=e.userData.mimeType;"image/webp"===i&&(i="image/png");const s={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,i)};e.name&&(s.name=e.name),this._invokeAll((function(t){t.writeTexture&&t.writeTexture(e,s)}));const o=r.textures.push(s)-1;return n.textures.set(e,o),o}processMaterial(e){const t=this.cache,n=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);const r={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const i=e.color.toArray().concat([e.opacity]);if($v(i,[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=i),e.isMeshStandardMaterial?(r.pbrMetallicRoughness.metallicFactor=e.metalness,r.pbrMetallicRoughness.roughnessFactor=e.roughness):(r.pbrMetallicRoughness.metallicFactor=.5,r.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const t=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),n={index:this.processTexture(t),channel:t.channel};this.applyTextureTransform(n,t),r.pbrMetallicRoughness.metallicRoughnessTexture=n}if(e.map){const t={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(t,e.map),r.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){const t=e.emissive;if(Math.max(t.r,t.g,t.b)>0&&(r.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const t={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(t,e.emissiveMap),r.emissiveTexture=t}}if(e.normalMap){const t={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),r.normalTexture=t}if(e.aoMap){const t={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),r.occlusionTexture=t}e.transparent?r.alphaMode="BLEND":e.alphaTest>0&&(r.alphaMode="MASK",r.alphaCutoff=e.alphaTest),e.side===se&&(r.doubleSided=!0),""!==e.name&&(r.name=e.name),this.serializeUserData(e,r),this._invokeAll((function(t){t.writeMaterial&&t.writeMaterial(e,r)}));const s=n.materials.push(r)-1;return t.materials.set(e,s),s}processMesh(e){const t=this.cache,n=this.json,r=[e.geometry.uuid];if(Array.isArray(e.material))for(let y=0,_=e.material.length;y<_;y++)r.push(e.material[y].uuid);else r.push(e.material.uuid);const i=r.join(":");if(t.meshes.has(i))return t.meshes.get(i);const s=e.geometry;let o;o=e.isLineSegments?Av:e.isLineLoop?Sv:e.isLine?Ev:e.isPoints?Mv:e.material.wireframe?Av:Pv;const a={},l={},c=[],u=[],h={...pv>=152?{uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3"}:{uv:"TEXCOORD_0",uv2:"TEXCOORD_1"},color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},d=s.getAttribute("normal");void 0!==d&&!this.isNormalizedNormalAttribute(d)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),s.setAttribute("normal",this.createNormalizedNormalAttribute(d)));let p=null;for(let y in s.attributes){if("morph"===y.slice(0,5))continue;const e=s.attributes[y];if(y=h[y]||y.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(y)||(y="_"+y),t.attributes.has(this.getUID(e))){l[y]=t.attributes.get(this.getUID(e));continue}p=null;const n=e.array;"JOINTS_0"===y&&!(n instanceof Uint16Array)&&!(n instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),p=new $(new Uint16Array(n),e.itemSize,e.normalized));const r=this.processAccessor(p||e,s);null!==r&&(y.startsWith("_")||this.detectMeshQuantization(y,e),l[y]=r,t.attributes.set(this.getUID(e),r))}if(void 0!==d&&s.setAttribute("normal",d),0===Object.keys(l).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){const n=[],r=[],i={};if(void 0!==e.morphTargetDictionary)for(const t in e.morphTargetDictionary)i[e.morphTargetDictionary[t]]=t;for(let o=0;o<e.morphTargetInfluences.length;++o){const a={};let l=!1;for(const e in s.morphAttributes){if("position"!==e&&"normal"!==e){l||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),l=!0);continue}const n=s.morphAttributes[e][o],r=e.toUpperCase(),i=s.attributes[e];if(t.attributes.has(this.getUID(n,!0))){a[r]=t.attributes.get(this.getUID(n,!0));continue}const c=n.clone();if(!s.morphTargetsRelative)for(let e=0,t=n.count;e<t;e++)for(let r=0;r<n.itemSize;r++)0===r&&c.setX(e,n.getX(e)-i.getX(e)),1===r&&c.setY(e,n.getY(e)-i.getY(e)),2===r&&c.setZ(e,n.getZ(e)-i.getZ(e)),3===r&&c.setW(e,n.getW(e)-i.getW(e));a[r]=this.processAccessor(c,s),t.attributes.set(this.getUID(i,!0),a[r])}u.push(a),n.push(e.morphTargetInfluences[o]),void 0!==e.morphTargetDictionary&&r.push(i[o])}a.weights=n,r.length>0&&(a.extras={},a.extras.targetNames=r)}const f=Array.isArray(e.material);if(f&&0===s.groups.length)return null;const m=f?e.material:[e.material],g=f?s.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let y=0,_=g.length;y<_;y++){const e={mode:o,attributes:l};if(this.serializeUserData(s,e),u.length>0&&(e.targets=u),null!==s.index){let n=this.getUID(s.index);(void 0!==g[y].start||void 0!==g[y].count)&&(n+=":"+g[y].start+":"+g[y].count),t.attributes.has(n)?e.indices=t.attributes.get(n):(e.indices=this.processAccessor(s.index,s,g[y].start,g[y].count),t.attributes.set(n,e.indices)),null===e.indices&&delete e.indices}const n=this.processMaterial(m[g[y].materialIndex]);null!==n&&(e.material=n),c.push(e)}a.primitives=c,n.meshes||(n.meshes=[]),this._invokeAll((function(t){t.writeMesh&&t.writeMesh(e,a)}));const v=n.meshes.push(a)-1;return t.meshes.set(i,v),v}detectMeshQuantization(e,t){if(this.extensionsUsed[Kv])return;let n;switch(t.array.constructor){case Int8Array:n="byte";break;case Uint8Array:n="unsigned byte";break;case Int16Array:n="short";break;case Uint16Array:n="unsigned short";break;default:return}t.normalized&&(n+=" normalized");const r=e.split("_",1)[0];wv[r]&&wv[r].includes(n)&&(this.extensionsUsed[Kv]=!0,this.extensionsRequired[Kv]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const n=e.isOrthographicCamera,r={type:n?"orthographic":"perspective"};return n?r.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:Y.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(r.name=e.type),t.cameras.push(r)-1}processAnimation(e,t){const n=this.json,r=this.nodeMap;n.animations||(n.animations=[]);const i=(e=Tv.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,s=[],o=[];for(let a=0;a<i.length;++a){const e=i[a],n=St.parseTrackName(e.name);let l=St.findNode(t,n.nodeName);const c=Yv[n.propertyName];if("bones"===n.objectName&&(l=!0===l.isSkinnedMesh?l.skeleton.getBoneByName(n.objectIndex):void 0),!l||!c)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',e.name),null;const u=1;let h,d=e.values.length/e.times.length;c===Yv.morphTargetInfluences&&(d/=l.morphTargetInfluences.length),!0===e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(h="CUBICSPLINE",d/=3):h=e.getInterpolation()===Dt?"STEP":"LINEAR",o.push({input:this.processAccessor(new $(e.times,u)),output:this.processAccessor(new $(e.values,d)),interpolation:h}),s.push({sampler:o.length-1,target:{node:r.get(l),path:c}})}return n.animations.push({name:e.name||"clip_"+n.animations.length,samplers:o,channels:s}),n.animations.length-1}processSkin(e){const t=this.json,n=this.nodeMap,r=t.nodes[n.get(e)],i=e.skeleton;if(void 0===i)return null;const s=e.skeleton.bones[0];if(void 0===s)return null;const o=[],a=new Float32Array(16*i.bones.length),l=new Ne;for(let c=0;c<i.bones.length;++c)o.push(n.get(i.bones[c])),l.copy(i.boneInverses[c]),l.multiply(e.bindMatrix).toArray(a,16*c);return void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new $(a,16)),joints:o,skeleton:n.get(s)}),r.skin=t.skins.length-1}processNode(e){const t=this.json,n=this.options,r=this.nodeMap;t.nodes||(t.nodes=[]);const i={};if(n.trs){const t=e.quaternion.toArray(),n=e.position.toArray(),r=e.scale.toArray();$v(t,[0,0,0,1])||(i.rotation=t),$v(n,[0,0,0])||(i.translation=n),$v(r,[1,1,1])||(i.scale=r)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===function(e){return $v(e.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}(e.matrix)&&(i.matrix=e.matrix.elements);if(""!==e.name&&(i.name=String(e.name)),this.serializeUserData(e,i),e.isMesh||e.isLine||e.isPoints){const t=this.processMesh(e);null!==t&&(i.mesh=t)}else e.isCamera&&(i.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const t=[];for(let r=0,i=e.children.length;r<i;r++){const i=e.children[r];if(i.visible||!1===n.onlyVisible){const e=this.processNode(i);null!==e&&t.push(e)}}t.length>0&&(i.children=t)}this._invokeAll((function(t){t.writeNode&&t.writeNode(e,i)}));const s=t.nodes.push(i)-1;return r.set(e,s),s}processScene(e){const t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);const r={};""!==e.name&&(r.name=e.name),t.scenes.push(r);const i=[];for(let s=0,o=e.children.length;s<o;s++){const t=e.children[s];if(t.visible||!1===n.onlyVisible){const e=this.processNode(t);null!==e&&i.push(e)}}i.length>0&&(r.nodes=i),this.serializeUserData(e,r)}processObjects(e){const t=new N;t.name="AuxScene";for(let n=0;n<e.length;n++)t.children.push(e[n]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll((function(t){t.beforeParse&&t.beforeParse(e)}));const n=[];for(let r=0;r<e.length;r++)e[r]instanceof N?this.processScene(e[r]):n.push(e[r]);n.length>0&&this.processObjects(n);for(let r=0;r<this.skins.length;++r)this.processSkin(this.skins[r]);for(let r=0;r<t.animations.length;++r)this.processAnimation(t.animations[r],e[0]);this._invokeAll((function(t){t.afterParse&&t.afterParse(e)}))}_invokeAll(e){for(let t=0,n=this.plugins.length;t<n;t++)e(this.plugins[t])}}class ry{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const n=this.writer,r=n.json,i=n.extensionsUsed,s={};e.name&&(s.name=e.name),s.color=e.color.toArray(),s.intensity=e.intensity,e.isDirectionalLight?s.type="directional":e.isPointLight?(s.type="point",e.distance>0&&(s.range=e.distance)):e.isSpotLight&&(s.type="spot",e.distance>0&&(s.range=e.distance),s.spot={},s.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,s.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||0!==e.target.position.x||0!==e.target.position.y||-1!==e.target.position.z)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),i[this.name]||(r.extensions=r.extensions||{},r.extensions[this.name]={lights:[]},i[this.name]=!0);const o=r.extensions[this.name].lights;o.push(s),t.extensions=t.extensions||{},t.extensions[this.name]={light:o.length-1}}}let iy=class{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const n=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},n[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}},sy=class{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.clearcoat)return;const n=this.writer,r=n.extensionsUsed,i={};if(i.clearcoatFactor=e.clearcoat,e.clearcoatMap){const t={index:n.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};n.applyTextureTransform(t,e.clearcoatMap),i.clearcoatTexture=t}if(i.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const t={index:n.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};n.applyTextureTransform(t,e.clearcoatRoughnessMap),i.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){const t={index:n.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};n.applyTextureTransform(t,e.clearcoatNormalMap),i.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}},oy=class{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.iridescence)return;const n=this.writer,r=n.extensionsUsed,i={};if(i.iridescenceFactor=e.iridescence,e.iridescenceMap){const t={index:n.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};n.applyTextureTransform(t,e.iridescenceMap),i.iridescenceTexture=t}if(i.iridescenceIor=e.iridescenceIOR,i.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],i.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const t={index:n.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};n.applyTextureTransform(t,e.iridescenceThicknessMap),i.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}},ay=class{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const n=this.writer,r=n.extensionsUsed,i={};if(i.transmissionFactor=e.transmission,e.transmissionMap){const t={index:n.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};n.applyTextureTransform(t,e.transmissionMap),i.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}},ly=class{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const n=this.writer,r=n.extensionsUsed,i={};if(i.thicknessFactor=e.thickness,e.thicknessMap){const t={index:n.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};n.applyTextureTransform(t,e.thicknessMap),i.thicknessTexture=t}i.attenuationDistance=e.attenuationDistance,i.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}},cy=class{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1.5===e.ior)return;const n=this.writer.extensionsUsed,r={};r.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}},uy=class{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1===e.specularIntensity&&e.specularColor.equals(Zv)&&!e.specularIntensityMap&&!e.specularColorTexture)return;const n=this.writer,r=n.extensionsUsed,i={};if(e.specularIntensityMap){const t={index:n.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};n.applyTextureTransform(t,e.specularIntensityMap),i.specularTexture=t}if(e.specularColorMap){const t={index:n.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};n.applyTextureTransform(t,e.specularColorMap),i.specularColorTexture=t}i.specularFactor=e.specularIntensity,i.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}},hy=class{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0==e.sheen)return;const n=this.writer,r=n.extensionsUsed,i={};if(e.sheenRoughnessMap){const t={index:n.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};n.applyTextureTransform(t,e.sheenRoughnessMap),i.sheenRoughnessTexture=t}if(e.sheenColorMap){const t={index:n.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};n.applyTextureTransform(t,e.sheenColorMap),i.sheenColorTexture=t}i.sheenRoughnessFactor=e.sheenRoughness,i.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}},dy=class{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0==e.anisotropy)return;const n=this.writer,r=n.extensionsUsed,i={};if(e.anisotropyMap){const t={index:n.processTexture(e.anisotropyMap)};n.applyTextureTransform(t,e.anisotropyMap),i.anisotropyTexture=t}i.anisotropyStrength=e.anisotropy,i.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}},py=class{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||1===e.emissiveIntensity)return;const n=this.writer.extensionsUsed,r={};r.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}};var fy=Uint8Array,my=Uint16Array,gy=Uint32Array,vy=new fy([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),yy=new fy([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),_y=function(e,t){for(var n=new my(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var i=new gy(n[30]);for(r=1;r<30;++r)for(var s=n[r];s<n[r+1];++s)i[s]=s-n[r]<<5|r;return[n,i]},xy=_y(vy,2),by=xy[0],wy=xy[1];by[28]=258,wy[258]=28,_y(yy,0);for(var Ty=new my(32768),My=0;My<32768;++My){var Ay=(43690&My)>>>1|(21845&My)<<1;Ay=(61680&(Ay=(52428&Ay)>>>2|(13107&Ay)<<2))>>>4|(3855&Ay)<<4,Ty[My]=((65280&Ay)>>>8|(255&Ay)<<8)>>>1}var Sy=new fy(288);for(My=0;My<144;++My)Sy[My]=8;for(My=144;My<256;++My)Sy[My]=9;for(My=256;My<280;++My)Sy[My]=7;for(My=280;My<288;++My)Sy[My]=8;var Ey=new fy(32);for(My=0;My<32;++My)Ey[My]=5;var Py=new fy(0),Cy=typeof TextDecoder<"u"&&new TextDecoder;try{Cy.decode(Py,{stream:!0})}catch{}var Ry=Object.defineProperty;const Ly=class extends oe{constructor(e,t={}){super(e),this.isReflector=!0,this.type="Reflector",this.camera=new j;const n=this,r=void 0!==t.color?new q(t.color):new q(8355711),i=t.textureWidth||512,s=t.textureHeight||512,o=t.clipBias||0,a=t.shader||Ly.ReflectorShader,l=void 0!==t.multisample?t.multisample:4,c=new $e,u=new ne,h=new ne,d=new ne,p=new Ne,f=new ne(0,0,-1),m=new Ce,g=new ne,v=new ne,y=new Ce,_=new Ne,x=this.camera,b=new de(i,s,{samples:l,type:Re}),w=new ge({uniforms:Xt.clone(a.uniforms),fragmentShader:a.fragmentShader,vertexShader:a.vertexShader});w.uniforms.tDiffuse.value=b.texture,w.uniforms.color.value=r,w.uniforms.textureMatrix.value=_,this.material=w,this.onBeforeRender=function(e,t,r){if(h.setFromMatrixPosition(n.matrixWorld),d.setFromMatrixPosition(r.matrixWorld),p.extractRotation(n.matrixWorld),u.set(0,0,1),u.applyMatrix4(p),g.subVectors(h,d),g.dot(u)>0)return;g.reflect(u).negate(),g.add(h),p.extractRotation(r.matrixWorld),f.set(0,0,-1),f.applyMatrix4(p),f.add(d),v.subVectors(h,f),v.reflect(u).negate(),v.add(h),x.position.copy(g),x.up.set(0,1,0),x.up.applyMatrix4(p),x.up.reflect(u),x.lookAt(v),x.far=r.far,x.updateMatrixWorld(),x.projectionMatrix.copy(r.projectionMatrix),_.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),_.multiply(x.projectionMatrix),_.multiply(x.matrixWorldInverse),_.multiply(n.matrixWorld),c.setFromNormalAndCoplanarPoint(u,h),c.applyMatrix4(x.matrixWorldInverse),m.set(c.normal.x,c.normal.y,c.normal.z,c.constant);const i=x.projectionMatrix;y.x=(Math.sign(m.x)+i.elements[8])/i.elements[0],y.y=(Math.sign(m.y)+i.elements[9])/i.elements[5],y.z=-1,y.w=(1+i.elements[10])/i.elements[14],m.multiplyScalar(2/m.dot(y)),i.elements[2]=m.x,i.elements[6]=m.y,i.elements[10]=m.z+1-o,i.elements[14]=m.w,n.visible=!1;const s=e.getRenderTarget(),a=e.xr.enabled,l=e.shadowMap.autoUpdate,w=e.toneMapping;let T=!1;T="outputColorSpace"in e?"srgb"===e.outputColorSpace:3001===e.outputEncoding,e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,"outputColorSpace"in e?e.outputColorSpace="srgb-linear":e.outputEncoding=3e3,e.toneMapping=V,e.setRenderTarget(b),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,x),e.xr.enabled=a,e.shadowMap.autoUpdate=l,e.toneMapping=w,"outputColorSpace"in e?e.outputColorSpace=T?"srgb":"srgb-linear":e.outputEncoding=T?3001:3e3,e.setRenderTarget(s);const M=r.viewport;void 0!==M&&e.state.viewport(M),n.visible=!0},this.getRenderTarget=function(){return b},this.dispose=function(){b.dispose(),n.material.dispose()}}};let Iy=Ly;((e,t,n)=>{((e,t,n)=>{t in e?Ry(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,t+"",n)})(Iy,"ReflectorShader",{uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:"\n\t\tuniform mat4 textureMatrix;\n\t\tvarying vec4 vUv;\n\n\t\t#include <common>\n\t\t#include <logdepthbuf_pars_vertex>\n\n\t\tvoid main() {\n\n\t\t\tvUv = textureMatrix * vec4( position, 1.0 );\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t\t#include <logdepthbuf_vertex>\n\n\t\t}",fragmentShader:`\n\t\tuniform vec3 color;\n\t\tuniform sampler2D tDiffuse;\n\t\tvarying vec4 vUv;\n\n\t\t#include <logdepthbuf_pars_fragment>\n\n\t\tfloat blendOverlay( float base, float blend ) {\n\n\t\t\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n\n\t\t}\n\n\t\tvec3 blendOverlay( vec3 base, vec3 blend ) {\n\n\t\t\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\tvec4 base = texture2DProj( tDiffuse, vUv );\n\t\t\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <${pv>=154?"colorspace_fragment":"encodings_fragment"}>\n\n\t\t}`});var Dy=Object.defineProperty,ky=(e,t,n)=>(((e,t,n)=>{t in e?Dy(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);const Oy=new Ae,Fy=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),Uy=new yt(Fy,5);Oy.setIndex([0,1,2,0,2,3]),Oy.setAttribute("position",new Ut(Uy,3,0,!1)),Oy.setAttribute("uv",new Ut(Uy,2,3,!1));const By=class extends oe{constructor(){super(By.Geometry,new ie({opacity:0,transparent:!0})),this.isLensflare=!0,this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;const e=new ne,t=new ne,n=new Ft(new Uint8Array(768),16,16,Zt);n.minFilter=_e,n.magFilter=_e,n.wrapS=At,n.wrapT=At;const r=new Ft(new Uint8Array(768),16,16,Zt);r.minFilter=_e,r.magFilter=_e,r.wrapS=At,r.wrapT=At;const i=By.Geometry,s=new $t({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:"\n\n\t\t\t\tprecision highp float;\n\n\t\t\t\tuniform vec3 screenPosition;\n\t\t\t\tuniform vec2 scale;\n\n\t\t\t\tattribute vec3 position;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );\n\n\t\t\t\t}",fragmentShader:"\n\n\t\t\t\tprecision highp float;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tgl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );\n\n\t\t\t\t}",depthTest:!0,depthWrite:!1,transparent:!1}),o=new $t({uniforms:{map:{value:n},scale:{value:null},screenPosition:{value:null}},vertexShader:"\n\n\t\t\t\tprecision highp float;\n\n\t\t\t\tuniform vec3 screenPosition;\n\t\t\t\tuniform vec2 scale;\n\n\t\t\t\tattribute vec3 position;\n\t\t\t\tattribute vec2 uv;\n\n\t\t\t\tvarying vec2 vUV;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvUV = uv;\n\n\t\t\t\t\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );\n\n\t\t\t\t}",fragmentShader:"\n\n\t\t\t\tprecision highp float;\n\n\t\t\t\tuniform sampler2D map;\n\n\t\t\t\tvarying vec2 vUV;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tgl_FragColor = texture2D( map, vUV );\n\n\t\t\t\t}",depthTest:!1,depthWrite:!1,transparent:!1}),a=new oe(i,s),l=[],c=zy.Shader,u=new $t({uniforms:{map:{value:null},occlusionMap:{value:r},color:{value:new q(16777215)},scale:{value:new te},screenPosition:{value:new ne}},vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:Qt,transparent:!0,depthWrite:!1}),h=new oe(i,u);this.addElement=function(e){l.push(e)};const d=new te,p=new te,f=new Jt,m=new Ce;this.onBeforeRender=function(c,g,v){c.getCurrentViewport(m);const y=m.w/m.z,_=m.z/2,x=m.w/2;let b=16/m.w;if(d.set(b*y,b),f.min.set(m.x,m.y),f.max.set(m.x+(m.z-16),m.y+(m.w-16)),t.setFromMatrixPosition(this.matrixWorld),t.applyMatrix4(v.matrixWorldInverse),!(t.z>0)&&(e.copy(t).applyMatrix4(v.projectionMatrix),p.x=m.x+e.x*_+_-8,p.y=m.y+e.y*x+x-8,f.containsPoint(p))){c.copyFramebufferToTexture(p,n);let t=s.uniforms;t.scale.value=d,t.screenPosition.value=e,c.renderBufferDirect(v,null,i,s,a,null),c.copyFramebufferToTexture(p,r),t=o.uniforms,t.scale.value=d,t.screenPosition.value=e,c.renderBufferDirect(v,null,i,o,a,null);const f=2*-e.x,g=2*-e.y;for(let n=0,r=l.length;n<r;n++){const t=l[n],r=u.uniforms;r.color.value.copy(t.color),r.map.value=t.texture,r.screenPosition.value.x=e.x+f*t.distance,r.screenPosition.value.y=e.y+g*t.distance,b=t.size/m.w;const s=m.w/m.z;r.scale.value.set(b*s,b),u.uniformsNeedUpdate=!0,c.renderBufferDirect(v,null,i,u,h,null)}}},this.dispose=function(){s.dispose(),o.dispose(),u.dispose(),n.dispose(),r.dispose();for(let e=0,t=l.length;e<t;e++)l[e].texture.dispose()}}};ky(By,"Geometry",Oy);class zy{constructor(e,t=1,n=0,r=new q(16777215)){this.texture=e,this.size=t,this.distance=n,this.color=r}}ky(zy,"Shader",{uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:"\n\n\t\tprecision highp float;\n\n\t\tuniform vec3 screenPosition;\n\t\tuniform vec2 scale;\n\n\t\tuniform sampler2D occlusionMap;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\n\t\tvarying vec2 vUV;\n\t\tvarying float vVisibility;\n\n\t\tvoid main() {\n\n\t\t\tvUV = uv;\n\n\t\t\tvec2 pos = position.xy;\n\n\t\t\tvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\n\t\t\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\n\t\t\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\n\t\t\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\n\t\t\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\n\t\t\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\n\t\t\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\n\t\t\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\n\t\t\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\n\n\t\t\tvVisibility =        visibility.r / 9.0;\n\t\t\tvVisibility *= 1.0 - visibility.g / 9.0;\n\t\t\tvVisibility *=       visibility.b / 9.0;\n\n\t\t\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tprecision highp float;\n\n\t\tuniform sampler2D map;\n\t\tuniform vec3 color;\n\n\t\tvarying vec2 vUV;\n\t\tvarying float vVisibility;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texture = texture2D( map, vUV );\n\t\t\ttexture.a *= vVisibility;\n\t\t\tgl_FragColor = texture;\n\t\t\tgl_FragColor.rgb *= color;\n\n\t\t}"});var Ny=Object.defineProperty,jy=(e,t,n)=>(((e,t,n)=>{t in e?Ny(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);const Hy={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new ne},up:{value:new ne(0,1,0)}},vertexShader:"\n      uniform vec3 sunPosition;\n      uniform float rayleigh;\n      uniform float turbidity;\n      uniform float mieCoefficient;\n      uniform vec3 up;\n\n      varying vec3 vWorldPosition;\n      varying vec3 vSunDirection;\n      varying float vSunfade;\n      varying vec3 vBetaR;\n      varying vec3 vBetaM;\n      varying float vSunE;\n\n      // constants for atmospheric scattering\n      const float e = 2.71828182845904523536028747135266249775724709369995957;\n      const float pi = 3.141592653589793238462643383279502884197169;\n\n      // wavelength of used primaries, according to preetham\n      const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );\n      // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:\n      // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))\n      const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );\n\n      // mie stuff\n      // K coefficient for the primaries\n      const float v = 4.0;\n      const vec3 K = vec3( 0.686, 0.678, 0.666 );\n      // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K\n      const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );\n\n      // earth shadow hack\n      // cutoffAngle = pi / 1.95;\n      const float cutoffAngle = 1.6110731556870734;\n      const float steepness = 1.5;\n      const float EE = 1000.0;\n\n      float sunIntensity( float zenithAngleCos ) {\n        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );\n        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );\n      }\n\n      vec3 totalMie( float T ) {\n        float c = ( 0.2 * T ) * 10E-18;\n        return 0.434 * c * MieConst;\n      }\n\n      void main() {\n\n        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n        vWorldPosition = worldPosition.xyz;\n\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        gl_Position.z = gl_Position.w; // set z to camera.far\n\n        vSunDirection = normalize( sunPosition );\n\n        vSunE = sunIntensity( dot( vSunDirection, up ) );\n\n        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );\n\n        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );\n\n      // extinction (absorbtion + out scattering)\n      // rayleigh coefficients\n        vBetaR = totalRayleigh * rayleighCoefficient;\n\n      // mie coefficients\n        vBetaM = totalMie( turbidity ) * mieCoefficient;\n\n      }\n    ",fragmentShader:`\n      varying vec3 vWorldPosition;\n      varying vec3 vSunDirection;\n      varying float vSunfade;\n      varying vec3 vBetaR;\n      varying vec3 vBetaM;\n      varying float vSunE;\n\n      uniform float mieDirectionalG;\n      uniform vec3 up;\n\n      const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );\n\n      // constants for atmospheric scattering\n      const float pi = 3.141592653589793238462643383279502884197169;\n\n      const float n = 1.0003; // refractive index of air\n      const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)\n\n      // optical length at zenith for molecules\n      const float rayleighZenithLength = 8.4E3;\n      const float mieZenithLength = 1.25E3;\n      // 66 arc seconds -> degrees, and the cosine of that\n      const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;\n\n      // 3.0 / ( 16.0 * pi )\n      const float THREE_OVER_SIXTEENPI = 0.05968310365946075;\n      // 1.0 / ( 4.0 * pi )\n      const float ONE_OVER_FOURPI = 0.07957747154594767;\n\n      float rayleighPhase( float cosTheta ) {\n        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );\n      }\n\n      float hgPhase( float cosTheta, float g ) {\n        float g2 = pow( g, 2.0 );\n        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );\n        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );\n      }\n\n      void main() {\n\n        vec3 direction = normalize( vWorldPosition - cameraPos );\n\n      // optical length\n      // cutoff angle at 90 to avoid singularity in next formula.\n        float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );\n        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );\n        float sR = rayleighZenithLength * inverse;\n        float sM = mieZenithLength * inverse;\n\n      // combined extinction factor\n        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );\n\n      // in scattering\n        float cosTheta = dot( direction, vSunDirection );\n\n        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );\n        vec3 betaRTheta = vBetaR * rPhase;\n\n        float mPhase = hgPhase( cosTheta, mieDirectionalG );\n        vec3 betaMTheta = vBetaM * mPhase;\n\n        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );\n        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );\n\n      // nightsky\n        float theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]\n        float phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]\n        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );\n        vec3 L0 = vec3( 0.1 ) * Fex;\n\n      // composition + solar disc\n        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );\n        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;\n\n        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );\n\n        vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );\n\n        gl_FragColor = vec4( retColor, 1.0 );\n\n      #include <tonemapping_fragment>\n      #include <${pv>=154?"colorspace_fragment":"encodings_fragment"}>\n\n      }\n    `},Gy=new ge({name:"SkyShader",fragmentShader:Hy.fragmentShader,vertexShader:Hy.vertexShader,uniforms:Xt.clone(Hy.uniforms),side:me,depthWrite:!1});class Vy extends oe{constructor(){super(new Ot(1,1,1),Gy)}}function Wy(e){if(typeof TextDecoder<"u")return(new TextDecoder).decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}}jy(Vy,"SkyShader",Hy),jy(Vy,"material",Gy),new Kt,new ne,new ze(0,0,0,"YXZ"),new ne,new Ve,new $e;const Xy="srgb",Ky="srgb-linear";class qy extends et{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new e_(e)})),this.register((function(e){return new t_(e)})),this.register((function(e){return new u_(e)})),this.register((function(e){return new h_(e)})),this.register((function(e){return new d_(e)})),this.register((function(e){return new r_(e)})),this.register((function(e){return new i_(e)})),this.register((function(e){return new s_(e)})),this.register((function(e){return new o_(e)})),this.register((function(e){return new Jy(e)})),this.register((function(e){return new a_(e)})),this.register((function(e){return new n_(e)})),this.register((function(e){return new c_(e)})),this.register((function(e){return new l_(e)})),this.register((function(e){return new $y(e)})),this.register((function(e){return new p_(e)})),this.register((function(e){return new f_(e)}))}load(e,t,n,r){const i=this;let s;if(""!==this.resourcePath)s=this.resourcePath;else if(""!==this.path){const t=tt.extractUrlBase(e);s=tt.resolveURL(t,this.path)}else s=tt.extractUrlBase(e);this.manager.itemStart(e);const o=function(t){r?r(t):console.error(t),i.manager.itemError(e),i.manager.itemEnd(e)},a=new nt(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{i.parse(n,s,(function(n){t(n),i.manager.itemEnd(e)}),o)}catch(r){o(r)}}),n,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let i;const s={},o={};if("string"==typeof e)i=JSON.parse(e);else if(e instanceof ArrayBuffer)if(Wy(new Uint8Array(e.slice(0,4)))===m_){try{s[Zy.KHR_BINARY_GLTF]=new y_(e)}catch(l){return void(r&&r(l))}i=JSON.parse(s[Zy.KHR_BINARY_GLTF].content)}else i=JSON.parse(Wy(new Uint8Array(e)));else i=e;if(void 0===i.asset||i.asset.version[0]<2)return void(r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const a=new V_(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});a.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const e=this.pluginCallbacks[c](a);e.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[e.name]=e,s[e.name]=!0}if(i.extensionsUsed)for(let c=0;c<i.extensionsUsed.length;++c){const e=i.extensionsUsed[c],t=i.extensionsRequired||[];switch(e){case Zy.KHR_MATERIALS_UNLIT:s[e]=new Qy;break;case Zy.KHR_DRACO_MESH_COMPRESSION:s[e]=new __(i,this.dracoLoader);break;case Zy.KHR_TEXTURE_TRANSFORM:s[e]=new x_;break;case Zy.KHR_MESH_QUANTIZATION:s[e]=new b_;break;default:t.indexOf(e)>=0&&void 0===o[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}a.setExtensions(s),a.setPlugins(o),a.parse(n,r)}parseAsync(e,t){const n=this;return new Promise((function(r,i){n.parse(e,t,r,i)}))}}function Yy(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const Zy={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class $y{constructor(e){this.parser=e,this.name=Zy.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;const i=t.json,s=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let o;const a=new q(16777215);void 0!==s.color&&a.setRGB(s.color[0],s.color[1],s.color[2],Ky);const l=void 0!==s.range?s.range:0;switch(s.type){case"directional":o=new mt(a),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new ft(a),o.distance=l;break;case"spot":o=new pt(a),o.distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,o.angle=s.spot.outerConeAngle,o.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return o.position.set(0,0,0),o.decay=2,B_(o,s),void 0!==s.intensity&&(o.intensity=s.intensity),o.name=t.createUniqueName(s.name||"light_"+e),r=Promise.resolve(o),t.cache.add(n,r),r}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],i=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(e){return n._getNodeRef(t.cache,i,e)}))}}class Qy{constructor(){this.name=Zy.KHR_MATERIALS_UNLIT}getMaterialType(){return ie}extendParams(e,t,n){const r=[];e.color=new q(1,1,1),e.opacity=1;const i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const t=i.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],Ky),e.opacity=t[3]}void 0!==i.baseColorTexture&&r.push(n.assignTexture(e,"map",i.baseColorTexture,Xy))}return Promise.all(r)}}class Jy{constructor(e){this.parser=e,this.name=Zy.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name].emissiveStrength;return void 0!==r&&(t.emissiveIntensity=r),Promise.resolve()}}class e_{constructor(e){this.parser=e,this.name=Zy.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dt:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];if(void 0!==s.clearcoatFactor&&(t.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&i.push(n.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&i.push(n.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(i.push(n.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){const e=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new te(e,e)}return Promise.all(i)}}class t_{constructor(e){this.parser=e,this.name=Zy.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dt:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.dispersion=void 0!==r.dispersion?r.dispersion:0,Promise.resolve()}}class n_{constructor(e){this.parser=e,this.name=Zy.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dt:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return void 0!==s.iridescenceFactor&&(t.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&i.push(n.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(t.iridescenceIOR=s.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&i.push(n.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(i)}}class r_{constructor(e){this.parser=e,this.name=Zy.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dt:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[];t.sheenColor=new q(0,0,0),t.sheenRoughness=0,t.sheen=1;const s=r.extensions[this.name];if(void 0!==s.sheenColorFactor){const e=s.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],Ky)}return void 0!==s.sheenRoughnessFactor&&(t.sheenRoughness=s.sheenRoughnessFactor),void 0!==s.sheenColorTexture&&i.push(n.assignTexture(t,"sheenColorMap",s.sheenColorTexture,Xy)),void 0!==s.sheenRoughnessTexture&&i.push(n.assignTexture(t,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(i)}}class i_{constructor(e){this.parser=e,this.name=Zy.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dt:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&i.push(n.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(i)}}class s_{constructor(e){this.parser=e,this.name=Zy.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dt:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];t.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&i.push(n.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||1/0;const o=s.attenuationColor||[1,1,1];return t.attenuationColor=(new q).setRGB(o[0],o[1],o[2],Ky),Promise.all(i)}}class o_{constructor(e){this.parser=e,this.name=Zy.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dt:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.ior=void 0!==r.ior?r.ior:1.5,Promise.resolve()}}class a_{constructor(e){this.parser=e,this.name=Zy.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dt:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];t.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&i.push(n.assignTexture(t,"specularIntensityMap",s.specularTexture));const o=s.specularColorFactor||[1,1,1];return t.specularColor=(new q).setRGB(o[0],o[1],o[2],Ky),void 0!==s.specularColorTexture&&i.push(n.assignTexture(t,"specularColorMap",s.specularColorTexture,Xy)),Promise.all(i)}}class l_{constructor(e){this.parser=e,this.name=Zy.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dt:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return t.bumpScale=void 0!==s.bumpFactor?s.bumpFactor:1,void 0!==s.bumpTexture&&i.push(n.assignTexture(t,"bumpMap",s.bumpTexture)),Promise.all(i)}}class c_{constructor(e){this.parser=e,this.name=Zy.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dt:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return void 0!==s.anisotropyStrength&&(t.anisotropy=s.anisotropyStrength),void 0!==s.anisotropyRotation&&(t.anisotropyRotation=s.anisotropyRotation),void 0!==s.anisotropyTexture&&i.push(n.assignTexture(t,"anisotropyMap",s.anisotropyTexture)),Promise.all(i)}}class u_{constructor(e){this.parser=e,this.name=Zy.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const i=r.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,s)}}class h_{constructor(e){this.parser=e,this.name=Zy.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;const s=i.extensions[t],o=r.images[s.source];let a=n.textureLoader;if(o.uri){const e=n.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(e,s.source,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class d_{constructor(e){this.parser=e,this.name=Zy.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;const s=i.extensions[t],o=r.images[s.source];let a=n.textureLoader;if(o.uri){const e=n.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(e,s.source,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class p_{constructor(e){this.name=Zy.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],r=this.parser.getDependency("buffer",e.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then((function(t){const n=e.byteOffset||0,r=e.byteLength||0,s=e.count,o=e.byteStride,a=new Uint8Array(t,n,r);return i.decodeGltfBufferAsync?i.decodeGltfBufferAsync(s,o,a,e.mode,e.filter).then((function(e){return e.buffer})):i.ready.then((function(){const t=new ArrayBuffer(s*o);return i.decodeGltfBuffer(new Uint8Array(t),s,o,a,e.mode,e.filter),t}))}))}return null}}class f_{constructor(e){this.name=Zy.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;const r=t.meshes[n.mesh];for(const a of r.primitives)if(a.mode!==A_.TRIANGLES&&a.mode!==A_.TRIANGLE_STRIP&&a.mode!==A_.TRIANGLE_FAN&&void 0!==a.mode)return null;const i=n.extensions[this.name].attributes,s=[],o={};for(const a in i)s.push(this.parser.getDependency("accessor",i[a]).then((e=>(o[a]=e,o[a]))));return s.length<1?null:(s.push(this.parser.createNodeMesh(e)),Promise.all(s).then((e=>{const t=e.pop(),n=t.isGroup?t.children:[t],r=e[0].count,i=[];for(const s of n){const e=new Ne,t=new ne,n=new Ge,a=new ne(1,1,1),l=new it(s.geometry,s.material,r);for(let i=0;i<r;i++)o.TRANSLATION&&t.fromBufferAttribute(o.TRANSLATION,i),o.ROTATION&&n.fromBufferAttribute(o.ROTATION,i),o.SCALE&&a.fromBufferAttribute(o.SCALE,i),l.setMatrixAt(i,e.compose(t,n,a));for(const r in o)if("_COLOR_0"===r){const e=o[r];l.instanceColor=new gt(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==r&&"ROTATION"!==r&&"SCALE"!==r&&s.geometry.setAttribute(r,o[r]);Z.prototype.copy.call(l,s),this.parser.assignFinalMaterial(l),i.push(l)}return t.isGroup?(t.clear(),t.add(...i),t):i[0]})))}}const m_="glTF",g_=1313821514,v_=5130562;class y_{constructor(e){this.name=Zy.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:Wy(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==m_)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,r=new DataView(e,12);let i=0;for(;i<n;){const t=r.getUint32(i,!0);i+=4;const n=r.getUint32(i,!0);if(i+=4,n===g_){const n=new Uint8Array(e,12+i,t);this.content=Wy(n)}else if(n===v_){const n=12+i;this.body=e.slice(n,n+t)}i+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class __{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Zy.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,o={},a={},l={};for(const c in s){const e=R_[c]||c.toLowerCase();o[e]=s[c]}for(const c in e.attributes){const t=R_[c]||c.toLowerCase();if(void 0!==s[c]){const r=n.accessors[e.attributes[c]],i=S_[r.componentType];l[t]=i.name,a[t]=!0===r.normalized}}return t.getDependency("bufferView",i).then((function(e){return new Promise((function(t,n){r.decodeDracoFile(e,(function(e){for(const t in e.attributes){const n=e.attributes[t],r=a[t];void 0!==r&&(n.normalized=r)}t(e)}),o,l,Ky,n)}))}))}}class x_{constructor(){this.name=Zy.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(void 0===t.texCoord||t.texCoord===e.channel)&&void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class b_{constructor(){this.name=Zy.KHR_MESH_QUANTIZATION}}class w_ extends Wt{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r;for(let s=0;s!==r;s++)t[s]=n[i+s];return t}interpolate_(e,t,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,c=r-t,u=(n-t)/c,h=u*u,d=h*u,p=e*l,f=p-l,m=-2*d+3*h,g=d-h,v=1-m,y=g-h+u;for(let _=0;_!==o;_++){const e=s[f+_+o],t=s[f+_+a]*c,n=s[p+_+o],r=s[p+_]*c;i[_]=v*e+y*t+m*n+g*r}return i}}const T_=new Ge;class M_ extends w_{interpolate_(e,t,n,r){const i=super.interpolate_(e,t,n,r);return T_.fromArray(i).normalize().toArray(i),i}}const A_={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},S_={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},E_={9728:_e,9729:pe,9984:wt,9985:bt,9986:xt,9987:_t},P_={33071:At,33648:Mt,10497:Tt},C_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},R_={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...pv>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},L_={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},I_={CUBICSPLINE:void 0,LINEAR:kt,STEP:Dt},D_="OPAQUE",k_="MASK",O_="BLEND";function F_(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new Ze({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ve})),e.DefaultMaterial}function U_(e,t,n){for(const r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function B_(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function z_(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,r=n.length;t<r;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function N_(e){let t;const n=e.extensions&&e.extensions[Zy.KHR_DRACO_MESH_COMPRESSION];if(t=n?"draco:"+n.bufferView+":"+n.indices+":"+j_(n.attributes):e.indices+":"+j_(e.attributes)+":"+e.mode,void 0!==e.targets)for(let r=0,i=e.targets.length;r<i;r++)t+=":"+j_(e.targets[r]);return t}function j_(e){let t="";const n=Object.keys(e).sort();for(let r=0,i=n.length;r<i;r++)t+=n[r]+":"+e[n[r]]+";";return t}function H_(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const G_=new Ne;class V_{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Yy,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,r=!1,i=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(n=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),r=navigator.userAgent.indexOf("Firefox")>-1,i=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||r&&i<98?this.textureLoader=new De(this.options.manager):this.textureLoader=new vt(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new nt(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){const s={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};return U_(i,s,r),B_(s,r),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(s)}))).then((function(){for(const e of s.scenes)e.updateMatrixWorld();e(s)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let r=0,i=t.length;r<i;r++){const n=t[r].joints;for(let t=0,r=n.length;t<r;t++)e[n[t]].isBone=!0}for(let r=0,i=e.length;r<i;r++){const t=e[r];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(n[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone(),i=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[r,s]of e.children.entries())i(s,t.children[r])};return i(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const i=e(t[r]);i&&n.push(i)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":r=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":r=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne((function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)})),!r)throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return n.getDependency(e,r)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[Zy.KHR_BINARY_GLTF].body);const r=this.options;return new Promise((function(e,i){n.load(tt.resolveURL(t.uri,r.path),e,void 0,(function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)}))}loadAccessor(e){const t=this,n=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse){const e=C_[r.type],t=S_[r.componentType],n=!0===r.normalized,i=new t(r.count*e);return Promise.resolve(new $(i,e,n))}const i=[];return void 0!==r.bufferView?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),void 0!==r.sparse&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then((function(e){const i=e[0],s=C_[r.type],o=S_[r.componentType],a=o.BYTES_PER_ELEMENT,l=a*s,c=r.byteOffset||0,u=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,h=!0===r.normalized;let d,p;if(u&&u!==l){const e=Math.floor(c/u),n="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+e+":"+r.count;let l=t.cache.get(n);l||(d=new o(i,e*u,r.count*u/a),l=new yt(d,u/a),t.cache.add(n,l)),p=new Ut(l,s,c%u/a,h)}else d=null===i?new o(r.count*s):new o(i,c,r.count*s),p=new $(d,s,h);if(void 0!==r.sparse){const t=C_.SCALAR,n=S_[r.sparse.indices.componentType],a=r.sparse.indices.byteOffset||0,l=r.sparse.values.byteOffset||0,c=new n(e[1],a,r.sparse.count*t),u=new o(e[2],l,r.sparse.count*s);null!==i&&(p=new $(p.array.slice(),p.itemSize,p.normalized));for(let e=0,r=c.length;e<r;e++){const t=c[e];if(p.setX(t,u[e*s]),s>=2&&p.setY(t,u[e*s+1]),s>=3&&p.setZ(t,u[e*s+2]),s>=4&&p.setW(t,u[e*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p}))}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,i=t.images[r];let s=this.textureLoader;if(i.uri){const e=n.manager.getHandler(i.uri);null!==e&&(s=e)}return this.loadTextureImage(e,r,s)}loadTextureImage(e,t,n){const r=this,i=this.json,s=i.textures[e],o=i.images[t],a=(o.uri||o.bufferView)+":"+s.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(t,n).then((function(t){t.flipY=!1,t.name=s.name||o.name||"",""===t.name&&"string"==typeof o.uri&&!1===o.uri.startsWith("data:image/")&&(t.name=o.uri);const n=(i.samplers||{})[s.sampler]||{};return t.magFilter=E_[n.magFilter]||pe,t.minFilter=E_[n.minFilter]||_t,t.wrapS=P_[n.wrapS]||Tt,t.wrapT=P_[n.wrapT]||Tt,r.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[a]=l,l}loadImageSource(e,t){const n=this.json,r=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const i=n.images[e],s=self.URL||self.webkitURL;let o=i.uri||"",a=!1;if(void 0!==i.bufferView)o=this.getDependency("bufferView",i.bufferView).then((function(e){a=!0;const t=new Blob([e],{type:i.mimeType});return o=s.createObjectURL(t),o}));else if(void 0===i.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const l=Promise.resolve(o).then((function(e){return new Promise((function(n,i){let s=n;!0===t.isImageBitmapLoader&&(s=function(e){const t=new Me(e);t.needsUpdate=!0,n(t)}),t.load(tt.resolveURL(e,r.path),s,void 0,i)}))})).then((function(e){return!0===a&&s.revokeObjectURL(o),B_(e,i),e.userData.mimeType=i.mimeType||function(e){return e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/)?"image/jpeg":e.search(/\.webp($|\?)/i)>0||0===e.search(/^data\:image\/webp/)?"image/webp":"image/png"}(i.uri),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),e}));return this.sourceCache[e]=l,l}assignTexture(e,t,n,r){const i=this;return this.getDependency("texture",n.index).then((function(s){if(!s)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((s=s.clone()).channel=n.texCoord),i.extensions[Zy.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[Zy.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=i.associations.get(s);s=i.extensions[Zy.KHR_TEXTURE_TRANSFORM].extendTexture(s,e),i.associations.set(s,t)}}return void 0!==r&&("number"==typeof r&&(r=3001===r?Xy:Ky),"colorSpace"in s?s.colorSpace=r:s.encoding=r===Xy?3001:3e3),e[t]=s,s}))}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const r=void 0===t.attributes.tangent,i=void 0!==t.attributes.color,s=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new je,Te.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new ot,Te.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,this.cache.add(e,t)),n=t}if(r||i||s){let e="ClonedMaterial:"+n.uuid+":";r&&(e+="derivative-tangents:"),i&&(e+="vertex-colors:"),s&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),i&&(t.vertexColors=!0),s&&(t.flatShading=!0),r&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}e.material=n}getMaterialType(){return Ze}loadMaterial(e){const t=this,n=this.json,r=this.extensions,i=n.materials[e];let s;const o={},a=[];if((i.extensions||{})[Zy.KHR_MATERIALS_UNLIT]){const e=r[Zy.KHR_MATERIALS_UNLIT];s=e.getMaterialType(),a.push(e.extendParams(o,i,t))}else{const n=i.pbrMetallicRoughness||{};if(o.color=new q(1,1,1),o.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;o.color.setRGB(e[0],e[1],e[2],Ky),o.opacity=e[3]}void 0!==n.baseColorTexture&&a.push(t.assignTexture(o,"map",n.baseColorTexture,Xy)),o.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,o.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(a.push(t.assignTexture(o,"metalnessMap",n.metallicRoughnessTexture)),a.push(t.assignTexture(o,"roughnessMap",n.metallicRoughnessTexture))),s=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),a.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,o)}))))}!0===i.doubleSided&&(o.side=se);const l=i.alphaMode||D_;if(l===O_?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,l===k_&&(o.alphaTest=void 0!==i.alphaCutoff?i.alphaCutoff:.5)),void 0!==i.normalTexture&&s!==ie&&(a.push(t.assignTexture(o,"normalMap",i.normalTexture)),o.normalScale=new te(1,1),void 0!==i.normalTexture.scale)){const e=i.normalTexture.scale;o.normalScale.set(e,e)}if(void 0!==i.occlusionTexture&&s!==ie&&(a.push(t.assignTexture(o,"aoMap",i.occlusionTexture)),void 0!==i.occlusionTexture.strength&&(o.aoMapIntensity=i.occlusionTexture.strength)),void 0!==i.emissiveFactor&&s!==ie){const e=i.emissiveFactor;o.emissive=(new q).setRGB(e[0],e[1],e[2],Ky)}return void 0!==i.emissiveTexture&&s!==ie&&a.push(t.assignTexture(o,"emissiveMap",i.emissiveTexture,Xy)),Promise.all(a).then((function(){const n=new s(o);return i.name&&(n.name=i.name),B_(n,i),t.associations.set(n,{materials:e}),i.extensions&&U_(r,n,i),n}))}createUniqueName(e){const t=St.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,r=this.primitiveCache;function i(e){return n[Zy.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return W_(n,e,t)}))}const s=[];for(let o=0,a=e.length;o<a;o++){const n=e[o],a=N_(n),l=r[a];if(l)s.push(l.promise);else{let e;e=n.extensions&&n.extensions[Zy.KHR_DRACO_MESH_COMPRESSION]?i(n):W_(new Ae,n,t),r[a]={primitive:n,promise:e},s.push(e)}}return Promise.all(s)}loadMesh(e){const t=this,n=this.json,r=this.extensions,i=n.meshes[e],s=i.primitives,o=[];for(let a=0,l=s.length;a<l;a++){const e=void 0===s[a].material?F_(this.cache):this.getDependency("material",s[a].material);o.push(e)}return o.push(t.loadGeometries(s)),Promise.all(o).then((function(n){const o=n.slice(0,n.length-1),a=n[n.length-1],l=[];for(let u=0,h=a.length;u<h;u++){const n=a[u],c=s[u];let h;const d=o[u];if(c.mode===A_.TRIANGLES||c.mode===A_.TRIANGLE_STRIP||c.mode===A_.TRIANGLE_FAN||void 0===c.mode)h=!0===i.isSkinnedMesh?new Et(n,d):new oe(n,d),!0===h.isSkinnedMesh&&h.normalizeSkinWeights(),c.mode===A_.TRIANGLE_STRIP?h.geometry=fv(h.geometry,Vt):c.mode===A_.TRIANGLE_FAN&&(h.geometry=fv(h.geometry,Gt));else if(c.mode===A_.LINES)h=new st(n,d);else if(c.mode===A_.LINE_STRIP)h=new Pt(n,d);else if(c.mode===A_.LINE_LOOP)h=new Ct(n,d);else{if(c.mode!==A_.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);h=new He(n,d)}Object.keys(h.geometry.morphAttributes).length>0&&z_(h,i),h.name=t.createUniqueName(i.name||"mesh_"+e),B_(h,i),c.extensions&&U_(r,h,c),t.assignFinalMaterial(h),l.push(h)}for(let r=0,i=l.length;r<i;r++)t.associations.set(l[r],{meshes:e,primitives:r});if(1===l.length)return i.extensions&&U_(r,l[0],i),l[0];const c=new Oe;i.extensions&&U_(r,c,i),t.associations.set(c,{meshes:e});for(let e=0,t=l.length;e<t;e++)c.add(l[e]);return c}))}loadCamera(e){let t;const n=this.json.cameras[e],r=n[n.type];if(r)return"perspective"===n.type?t=new j(Y.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(t=new Le(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),B_(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n=[];for(let r=0,i=t.joints.length;r<i;r++)n.push(this._loadNodeShallow(t.joints[r]));return void 0!==t.inverseBindMatrices?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then((function(e){const n=e.pop(),r=e,i=[],s=[];for(let o=0,a=r.length;o<a;o++){const e=r[o];if(e){i.push(e);const t=new Ne;null!==n&&t.fromArray(n.array,16*o),s.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}return new Rt(i,s)}))}loadAnimation(e){const t=this.json,n=this,r=t.animations[e],i=r.name?r.name:"animation_"+e,s=[],o=[],a=[],l=[],c=[];for(let u=0,h=r.channels.length;u<h;u++){const e=r.channels[u],t=r.samplers[e.sampler],n=e.target,i=n.node,h=void 0!==r.parameters?r.parameters[t.input]:t.input,d=void 0!==r.parameters?r.parameters[t.output]:t.output;void 0!==n.node&&(s.push(this.getDependency("node",i)),o.push(this.getDependency("accessor",h)),a.push(this.getDependency("accessor",d)),l.push(t),c.push(n))}return Promise.all([Promise.all(s),Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c)]).then((function(e){const t=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=[];for(let i=0,c=t.length;i<c;i++){const e=t[i],c=r[i],u=s[i],h=o[i],d=a[i];if(void 0===e)continue;e.updateMatrix&&e.updateMatrix();const p=n._createAnimationTracks(e,c,u,h,d);if(p)for(let t=0;t<p.length;t++)l.push(p[t])}return new Lt(i,void 0,l)}))}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then((function(e){const t=n._getNodeRef(n.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,n=r.weights.length;t<n;t++)e.morphTargetInfluences[t]=r.weights[t]})),t}))}loadNode(e){const t=this,n=this.json.nodes[e],r=t._loadNodeShallow(e),i=[],s=n.children||[];for(let a=0,l=s.length;a<l;a++)i.push(t.getDependency("node",s[a]));const o=void 0===n.skin?Promise.resolve(null):t.getDependency("skin",n.skin);return Promise.all([r,Promise.all(i),o]).then((function(e){const t=e[0],n=e[1],r=e[2];null!==r&&t.traverse((function(e){e.isSkinnedMesh&&e.bind(r,G_)}));for(let i=0,s=n.length;i<s;i++)t.add(n[i]);return t}))}_loadNodeShallow(e){const t=this.json,n=this.extensions,r=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const i=t.nodes[e],s=i.name?r.createUniqueName(i.name):"",o=[],a=r._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return a&&o.push(a),void 0!==i.camera&&o.push(r.getDependency("camera",i.camera).then((function(e){return r._getNodeRef(r.cameraCache,i.camera,e)}))),r._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){o.push(e)})),this.nodeCache[e]=Promise.all(o).then((function(t){let o;if(o=!0===i.isBone?new It:t.length>1?new Oe:1===t.length?t[0]:new Z,o!==t[0])for(let e=0,n=t.length;e<n;e++)o.add(t[e]);if(i.name&&(o.userData.name=i.name,o.name=s),B_(o,i),i.extensions&&U_(n,o,i),void 0!==i.matrix){const e=new Ne;e.fromArray(i.matrix),o.applyMatrix4(e)}else void 0!==i.translation&&o.position.fromArray(i.translation),void 0!==i.rotation&&o.quaternion.fromArray(i.rotation),void 0!==i.scale&&o.scale.fromArray(i.scale);return r.associations.has(o)||r.associations.set(o,{}),r.associations.get(o).nodes=e,o})),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],r=this,i=new Oe;n.name&&(i.name=r.createUniqueName(n.name)),B_(i,n),n.extensions&&U_(t,i,n);const s=n.nodes||[],o=[];for(let a=0,l=s.length;a<l;a++)o.push(r.getDependency("node",s[a]));return Promise.all(o).then((function(e){for(let t=0,n=e.length;t<n;t++)i.add(e[t]);return r.associations=(e=>{const t=new Map;for(const[n,i]of r.associations)(n instanceof Te||n instanceof Me)&&t.set(n,i);return e.traverse((e=>{const n=r.associations.get(e);null!=n&&t.set(e,n)})),t})(i),i}))}_createAnimationTracks(e,t,n,r,i){const s=[],o=e.name?e.name:e.uuid,a=[];let l;switch(L_[i.path]===L_.weights?e.traverse((function(e){e.morphTargetInfluences&&a.push(e.name?e.name:e.uuid)})):a.push(o),L_[i.path]){case L_.weights:l=zt;break;case L_.rotation:l=Nt;break;case L_.position:case L_.scale:l=Bt;break;default:if(1===n.itemSize)l=zt;else l=Bt}const c=void 0!==r.interpolation?I_[r.interpolation]:kt,u=this._getArrayFromAccessor(n);for(let h=0,d=a.length;h<d;h++){const e=new l(a[h]+"."+L_[i.path],t.array,u,c);"CUBICSPLINE"===r.interpolation&&this._createCubicSplineTrackInterpolant(e),s.push(e)}return s}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=H_(t.constructor),n=new Float32Array(t.length);for(let r=0,i=t.length;r<i;r++)n[r]=t[r]*e;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof Nt?M_:w_)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function W_(e,t,n){const r=t.attributes,i=[];function s(t,r){return n.getDependency("accessor",t).then((function(t){e.setAttribute(r,t)}))}for(const o in r){const t=R_[o]||o.toLowerCase();t in e.attributes||i.push(s(r[o],t))}if(void 0!==t.indices&&!e.index){const r=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));i.push(r)}return B_(e,t),function(e,t,n){const r=t.attributes,i=new ht;if(void 0===r.POSITION)return;{const e=n.json.accessors[r.POSITION],t=e.min,s=e.max;if(void 0===t||void 0===s)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(i.set(new ne(t[0],t[1],t[2]),new ne(s[0],s[1],s[2])),e.normalized){const t=H_(S_[e.componentType]);i.min.multiplyScalar(t),i.max.multiplyScalar(t)}}const s=t.targets;if(void 0!==s){const e=new ne,t=new ne;for(let r=0,i=s.length;r<i;r++){const i=s[r];if(void 0!==i.POSITION){const r=n.json.accessors[i.POSITION],s=r.min,o=r.max;if(void 0!==s&&void 0!==o){if(t.setX(Math.max(Math.abs(s[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(s[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(s[2]),Math.abs(o[2]))),r.normalized){const e=H_(S_[r.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(e)}e.boundingBox=i;const o=new qe;i.getCenter(o.center),o.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=o}(e,t,n),Promise.all(i).then((function(){return void 0!==t.targets?function(e,t,n){let r=!1,i=!1,s=!1;for(let c=0,u=t.length;c<u;c++){const e=t[c];if(void 0!==e.POSITION&&(r=!0),void 0!==e.NORMAL&&(i=!0),void 0!==e.COLOR_0&&(s=!0),r&&i&&s)break}if(!r&&!i&&!s)return Promise.resolve(e);const o=[],a=[],l=[];for(let c=0,u=t.length;c<u;c++){const u=t[c];if(r){const t=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):e.attributes.position;o.push(t)}if(i){const t=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):e.attributes.normal;a.push(t)}if(s){const t=void 0!==u.COLOR_0?n.getDependency("accessor",u.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then((function(t){const n=t[0],o=t[1],a=t[2];return r&&(e.morphAttributes.position=n),i&&(e.morphAttributes.normal=o),s&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}new ne,new ze,new ne;var X_=Object.defineProperty,K_=(e,t,n)=>(((e,t,n)=>{t in e?X_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class q_{constructor(e){K_(this,"data"),this.data=e}generateShapes(e,t=100,n){const r=[],i={letterSpacing:0,lineHeight:1,...n},s=function(e,t,n,r){const i=Array.from(e),s=t/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*s,a=[];let l=0,c=0;for(let u=0;u<i.length;u++){const e=i[u];if("\n"===e)l=0,c-=o*r.lineHeight;else{const t=Y_(e,s,l,c,n);t&&(l+=t.offsetX+r.letterSpacing,a.push(t.path))}}return a}(e,t,this.data,i);for(let o=0,a=s.length;o<a;o++)Array.prototype.push.apply(r,s[o].toShapes(!1));return r}}function Y_(e,t,n,r,i){const s=i.glyphs[e]||i.glyphs["?"];if(!s)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".");const o=new en;let a,l,c,u,h,d,p,f;if(s.o){const e=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let i=0,s=e.length;i<s;)switch(e[i++]){case"m":a=parseInt(e[i++])*t+n,l=parseInt(e[i++])*t+r,o.moveTo(a,l);break;case"l":a=parseInt(e[i++])*t+n,l=parseInt(e[i++])*t+r,o.lineTo(a,l);break;case"q":c=parseInt(e[i++])*t+n,u=parseInt(e[i++])*t+r,h=parseInt(e[i++])*t+n,d=parseInt(e[i++])*t+r,o.quadraticCurveTo(h,d,c,u);break;case"b":c=parseInt(e[i++])*t+n,u=parseInt(e[i++])*t+r,h=parseInt(e[i++])*t+n,d=parseInt(e[i++])*t+r,p=parseInt(e[i++])*t+n,f=parseInt(e[i++])*t+r,o.bezierCurveTo(h,d,p,f,c,u)}}return{offsetX:s.ha*t,path:o}}K_(q_,"isFont"),K_(q_,"type");const Z_=new WeakMap;class $_ extends et{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,r){const i=new nt(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,(e=>{const n={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,n).then(t).catch(r)}),n,r)}decodeDracoFile(e,t,n,r){const i={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,i).then(t)}decodeGeometry(e,t){for(const a in t.attributeTypes){const e=t.attributeTypes[a];void 0!==e.BYTES_PER_ELEMENT&&(t.attributeTypes[a]=e.name)}const n=JSON.stringify(t);if(Z_.has(e)){const t=Z_.get(e);if(t.key===n)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const i=this.workerNextTaskID++,s=e.byteLength,o=this._getWorker(i,s).then((n=>(r=n,new Promise(((n,s)=>{r._callbacks[i]={resolve:n,reject:s},r.postMessage({type:"decode",id:i,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return o.catch((()=>!0)).then((()=>{r&&i&&this._releaseTask(r,i)})),Z_.set(e,{key:n,promise:o}),o}_createGeometry(e){const t=new Ae;e.index&&t.setIndex(new $(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const r=e.attributes[n],i=r.name,s=r.array,o=r.itemSize;t.setAttribute(i,new $(s,o))}return t}_loadLibrary(e,t){const n=new nt(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise(((t,r)=>{n.load(e,t,void 0,r)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{const n=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const r=Q_.toString(),i=["/* draco decoder */",n,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const n=t.data;switch(n.type){case"decode":e._callbacks[n.id].resolve(n);break;case"error":e._callbacks[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function Q_(){let e,t;function n(e,t,n,r,i,s){const o=s.num_components(),a=n.num_points()*o,l=a*i.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,i),u=e._malloc(l);t.GetAttributeDataArrayForAllPoints(n,s,c,l,u);const h=new i(e.HEAPF32.buffer,u,a).slice();return e._free(u),{name:r,array:h,itemSize:o}}onmessage=function(r){const i=r.data;switch(i.type){case"init":e=i.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":const r=i.buffer,s=i.taskConfig;t.then((e=>{const t=e.draco,o=new t.Decoder,a=new t.DecoderBuffer;a.Init(new Int8Array(r),r.byteLength);try{const e=function(e,t,r,i){const s=i.attributeIDs,o=i.attributeTypes;let a,l;const c=t.GetEncodedGeometryType(r);if(c===e.TRIANGULAR_MESH)a=new e.Mesh,l=t.DecodeBufferToMesh(r,a);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new e.PointCloud,l=t.DecodeBufferToPointCloud(r,a)}if(!l.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const u={index:null,attributes:[]};for(const h in s){const r=self[o[h]];let l,c;if(i.useUniqueIDs)c=s[h],l=t.GetAttributeByUniqueId(a,c);else{if(c=t.GetAttributeId(a,e[s[h]]),-1===c)continue;l=t.GetAttribute(a,c)}u.attributes.push(n(e,t,a,h,r,l))}return c===e.TRIANGULAR_MESH&&(u.index=function(e,t,n){const r=3*n.num_faces(),i=4*r,s=e._malloc(i);t.GetTrianglesUInt32Array(n,i,s);const o=new Uint32Array(e.HEAPF32.buffer,s,r).slice();return e._free(s),{array:o,itemSize:1}}(e,t,a)),e.destroy(a),u}(t,o,a,s),r=e.attributes.map((e=>e.array.buffer));e.index&&r.push(e.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:e},r)}catch(l){console.error(l),self.postMessage({type:"error",id:i.id,error:l.message})}finally{t.destroy(a),t.destroy(o)}}))}}}var J_;new ht,new ne,new Ce,new ne,new ne,new Ce,new Ce,new Ce,new ne,new Ne,new qt,new ne,new ht,new qe,new Ce,Y.clamp,Y.lerp,dv({screenspace:!1,color:new q("black"),opacity:1,thickness:.05,size:new te(1,1)},"#include <common>\n   #include <morphtarget_pars_vertex>\n   #include <skinning_pars_vertex>\n   uniform float thickness;\n   uniform bool screenspace;\n   uniform vec2 size;\n   void main() {\n     #if defined (USE_SKINNING)\n       #include <beginnormal_vertex>\n       #include <morphnormal_vertex>\n       #include <skinbase_vertex>\n       #include <skinnormal_vertex>\n       #include <defaultnormal_vertex>\n     #endif\n     #include <begin_vertex>\n     #include <morphtarget_vertex>\n     #include <skinning_vertex>\n     #include <project_vertex>\n     vec4 tNormal = vec4(normal, 0.0);\n     vec4 tPosition = vec4(transformed, 1.0);\n     #ifdef USE_INSTANCING\n       tNormal = instanceMatrix * tNormal;\n       tPosition = instanceMatrix * tPosition;\n     #endif\n     if (screenspace) {\n       vec3 newPosition = tPosition.xyz + tNormal.xyz * thickness;\n       gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0); \n     } else {\n       vec4 clipPosition = projectionMatrix * modelViewMatrix * tPosition;\n       vec4 clipNormal = projectionMatrix * modelViewMatrix * tNormal;\n       vec2 offset = normalize(clipNormal.xy) * thickness / size * clipPosition.w * 2.0;\n       clipPosition.xy += offset;\n       gl_Position = clipPosition;\n     }\n   }","uniform vec3 color;\n   uniform float opacity;\n   void main(){\n     gl_FragColor = vec4(color, opacity);\n     #include <tonemapping_fragment>\n     #include <colorspace_fragment>\n   }"),Iy.ReflectorShader,new ne,new ne,new ne,/Mac/.test(null===(J_=globalThis?.navigator)||void 0===J_?void 0:J_.platform);const ex=class extends et{constructor(e){super(e),hv(this,"gltfLoader"),this.gltfLoader=new qy(e)}load(e,t,n,r){const i=Array.isArray(e)?e[0]:e;this.gltfLoader.load(i,t,n,r)}async loadAsync(e){const t=Array.isArray(e)?e[0]:e;return this.gltfLoader.loadAsync(t)}setDRACOLoader(e){return this.gltfLoader.setDRACOLoader(e)}};let tx=null;async function nx(e,t={draco:!1},n){const r=await async function(e,t,n,r){const{logError:i}=Jn(),s=new e;return n&&n(s),await new Promise(((e,n)=>{s.load(t,(t=>{const n=t;n.scene&&Object.assign(n,function(e){const t={nodes:{},materials:{}};return e&&e.traverse((e=>{e.name&&(t.nodes[e.name]=e),e.material&&!t.materials[e.material.name]&&(t.materials[e.material.name]=e.material)})),t}(n.scene)),e(n)}),r,(e=>{i("[useLoader] - Failed to load resource",e),n(e)}))}))}(ex,e,function(e){return t=>{e.draco&&(tx||(tx=new $_),tx.setDecoderPath(e.decoderPath||"https://www.gstatic.com/draco/versioned/decoders/1.4.3/"),t.setDRACOLoader&&t.setDRACOLoader(tx))}}(t));return tx?.dispose(),tx=null,r}function rx(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ix,sx,ox,ax,lx,cx,ux,hx,dx,px,fx,mx,gx,vx,yx,_x={exports:{}};function xx(){return ox||(ox=1,sx=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","uint","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"]),sx}function bx(){return ux||(ux=1,cx=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"]),cx}function wx(){if(gx)return mx;gx=1,mx=function(x){var b,w,T,M=0,A=0,S=s,E=[],P=[],C=1,R=0,L=0,I=!1,D=!1,k="",O=n,F=e;"300 es"===(x=x||{}).version&&(O=i,F=r);var U={},B={};for(M=0;M<O.length;M++)U[O[M]]=!0;for(M=0;M<F.length;M++)B[F[M]]=!0;return function(e){return P=[],null!==e?function(e){M=0,e.toString&&(e=e.toString()),k+=e.replace(/\r\n/g,"\n"),T=k.length;for(var t;b=k[M],M<T;){switch(t=M,S){case a:M=V();break;case l:M=G();break;case c:M=H();break;case u:M=W();break;case h:M=q();break;case y:M=K();break;case d:M=Y();break;case o:M=Z();break;case g:M=j();break;case s:M=N()}if(t!==M)if("\n"===k[t])R=0,++C;else++R}return A+=M,k=k.slice(M),P}(e):(E.length&&z(E.join("")),S=v,z("(eof)"),P)};function z(e){e.length&&P.push({type:_[S],data:e,position:L,line:C,column:R})}function N(){return E=E.length?[]:E,"/"===w&&"*"===b?(L=A+M-1,S=a,w=b,M+1):"/"===w&&"/"===b?(L=A+M-1,S=l,w=b,M+1):"#"===b?(S=c,L=A+M,M):/\s/.test(b)?(S=g,L=A+M,M):(I=/\d/.test(b),D=/[^\w_]/.test(b),L=A+M,S=I?h:D?u:o,M)}function j(){return/[^\s]/g.test(b)?(z(E.join("")),S=s,M):(E.push(b),w=b,M+1)}function H(){return"\r"!==b&&"\n"!==b||"\\"===w?(E.push(b),w=b,M+1):(z(E.join("")),S=s,M)}function G(){return H()}function V(){return"/"===b&&"*"===w?(E.push(b),z(E.join("")),S=s,M+1):(E.push(b),w=b,M+1)}function W(){if("."===w&&/\d/.test(b))return S=d,M;if("/"===w&&"*"===b)return S=a,M;if("/"===w&&"/"===b)return S=l,M;if("."===b&&E.length){for(;X(E););return S=d,M}if(";"===b||")"===b||"("===b){if(E.length)for(;X(E););return z(b),S=s,M+1}var e=2===E.length&&"="!==b;if(/[\w_\d\s]/.test(b)||e){for(;X(E););return S=s,M}return E.push(b),w=b,M+1}function X(e){for(var n,r,i=0;;){if(n=t.indexOf(e.slice(0,e.length+i).join("")),r=t[n],-1===n){if(i--+e.length>0)continue;r=e.slice(0,1).join("")}return z(r),L+=r.length,(E=E.slice(r.length)).length}}function K(){return/[^a-fA-F0-9]/.test(b)?(z(E.join("")),S=s,M):(E.push(b),w=b,M+1)}function q(){return"."===b||/[eE]/.test(b)?(E.push(b),S=d,w=b,M+1):"x"===b&&1===E.length&&"0"===E[0]?(S=y,E.push(b),w=b,M+1):/[^\d]/.test(b)?(z(E.join("")),S=s,M):(E.push(b),w=b,M+1)}function Y(){return"f"===b&&(E.push(b),w=b,M+=1),/[eE]/.test(b)||("-"===b||"+"===b)&&/[eE]/.test(w)?(E.push(b),w=b,M+1):/[^\d]/.test(b)?(z(E.join("")),S=s,M):(E.push(b),w=b,M+1)}function Z(){if(/[^\d\w_]/.test(b)){var e=E.join("");return S=B[e]?m:U[e]?f:p,z(E.join("")),S=s,M}return E.push(b),w=b,M+1}};var e=xx(),t=(lx||(lx=1,ax=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"]),ax),n=bx(),r=function(){if(dx)return hx;dx=1;var e=xx();return hx=e.slice().concat(["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray"])}(),i=function(){if(fx)return px;fx=1;var e=bx();return e=e.slice().filter((function(e){return!/^(gl\_|texture)/.test(e)})),px=e.concat(["gl_VertexID","gl_InstanceID","gl_Position","gl_PointSize","gl_FragCoord","gl_FrontFacing","gl_FragDepth","gl_PointCoord","gl_MaxVertexAttribs","gl_MaxVertexUniformVectors","gl_MaxVertexOutputVectors","gl_MaxFragmentInputVectors","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformVectors","gl_MaxDrawBuffers","gl_MinProgramTexelOffset","gl_MaxProgramTexelOffset","gl_DepthRangeParameters","gl_DepthRange","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"])}(),s=999,o=9999,a=0,l=1,c=2,u=3,h=4,d=5,p=6,f=7,m=8,g=9,v=10,y=11,_=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];return mx}function Tx(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function Mx(e,t,n){return(t=Tx(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}ix||(ix=1,_x.exports=function e(t,n,r){function i(o,a){if(!n[o]){if(!t[o]){if(!a&&rx)return rx(o);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}a=n[o]={exports:{}},t[o][0].call(a.exports,(function(e){return i(t[o][1][e]||e)}),a,a.exports,e,t,n,r)}return n[o].exports}for(var s=rx,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){(function(r,i,s,o,a,l,c,u,h){var d=e("crypto");function p(e,t){var n;return void 0===(n="passthrough"!==(t=g(e,t)).algorithm?d.createHash(t.algorithm):new _).write&&(n.write=n.update,n.end=n.update),y(t,n).dispatch(e),n.update||n.end(""),n.digest?n.digest("buffer"===t.encoding?void 0:t.encoding):(e=n.read(),"buffer"!==t.encoding?e.toString(t.encoding):e)}(n=t.exports=p).sha1=function(e){return p(e)},n.keys=function(e){return p(e,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},n.MD5=function(e){return p(e,{algorithm:"md5",encoding:"hex"})},n.keysMD5=function(e){return p(e,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var f=d.getHashes?d.getHashes().slice():["sha1","md5"],m=(f.push("passthrough"),["buffer","hex","binary","base64"]);function g(e,t){var n={};if(n.algorithm=(t=t||{}).algorithm||"sha1",n.encoding=t.encoding||"hex",n.excludeValues=!!t.excludeValues,n.algorithm=n.algorithm.toLowerCase(),n.encoding=n.encoding.toLowerCase(),n.ignoreUnknown=!0===t.ignoreUnknown,n.respectType=!1!==t.respectType,n.respectFunctionNames=!1!==t.respectFunctionNames,n.respectFunctionProperties=!1!==t.respectFunctionProperties,n.unorderedArrays=!0===t.unorderedArrays,n.unorderedSets=!1!==t.unorderedSets,n.unorderedObjects=!1!==t.unorderedObjects,n.replacer=t.replacer||void 0,n.excludeKeys=t.excludeKeys||void 0,void 0===e)throw new Error("Object argument required.");for(var r=0;r<f.length;++r)f[r].toLowerCase()===n.algorithm.toLowerCase()&&(n.algorithm=f[r]);if(-1===f.indexOf(n.algorithm))throw new Error('Algorithm "'+n.algorithm+'"  not supported. supported values: '+f.join(", "));if(-1===m.indexOf(n.encoding)&&"passthrough"!==n.algorithm)throw new Error('Encoding "'+n.encoding+'"  not supported. supported values: '+m.join(", "));return n}function v(e){if("function"==typeof e)return null!=/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(e))}function y(e,t,n){function r(e){return t.update?t.update(e,"utf8"):t.write(e,"utf8")}return n=n||[],{dispatch:function(t){return this["_"+(null===(t=e.replacer?e.replacer(t):t)?"null":typeof t)](t)},_object:function(t){var i,o=Object.prototype.toString.call(t),a=/\[object (.*)\]/i.exec(o);if(a=(a=a?a[1]:"unknown:["+o+"]").toLowerCase(),0<=(o=n.indexOf(t)))return this.dispatch("[CIRCULAR:"+o+"]");if(n.push(t),void 0!==s&&s.isBuffer&&s.isBuffer(t))return r("buffer:"),r(t);if("object"===a||"function"===a||"asyncfunction"===a)return o=Object.keys(t),e.unorderedObjects&&(o=o.sort()),!1===e.respectType||v(t)||o.splice(0,0,"prototype","__proto__","constructor"),e.excludeKeys&&(o=o.filter((function(t){return!e.excludeKeys(t)}))),r("object:"+o.length+":"),i=this,o.forEach((function(n){i.dispatch(n),r(":"),e.excludeValues||i.dispatch(t[n]),r(",")}));if(!this["_"+a]){if(e.ignoreUnknown)return r("["+a+"]");throw new Error('Unknown object type "'+a+'"')}this["_"+a](t)},_array:function(t,i){i=void 0!==i?i:!1!==e.unorderedArrays;var s=this;if(r("array:"+t.length+":"),!i||t.length<=1)return t.forEach((function(e){return s.dispatch(e)}));var o=[];return i=t.map((function(t){var r=new _,i=n.slice();return y(e,r,i).dispatch(t),o=o.concat(i.slice(n.length)),r.read().toString()})),n=n.concat(o),i.sort(),this._array(i,!1)},_date:function(e){return r("date:"+e.toJSON())},_symbol:function(e){return r("symbol:"+e.toString())},_error:function(e){return r("error:"+e.toString())},_boolean:function(e){return r("bool:"+e.toString())},_string:function(e){r("string:"+e.length+":"),r(e.toString())},_function:function(t){r("fn:"),v(t)?this.dispatch("[native]"):this.dispatch(t.toString()),!1!==e.respectFunctionNames&&this.dispatch("function-name:"+String(t.name)),e.respectFunctionProperties&&this._object(t)},_number:function(e){return r("number:"+e.toString())},_xml:function(e){return r("xml:"+e.toString())},_null:function(){return r("Null")},_undefined:function(){return r("Undefined")},_regexp:function(e){return r("regex:"+e.toString())},_uint8array:function(e){return r("uint8array:"),this.dispatch(Array.prototype.slice.call(e))},_uint8clampedarray:function(e){return r("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(e))},_int8array:function(e){return r("int8array:"),this.dispatch(Array.prototype.slice.call(e))},_uint16array:function(e){return r("uint16array:"),this.dispatch(Array.prototype.slice.call(e))},_int16array:function(e){return r("int16array:"),this.dispatch(Array.prototype.slice.call(e))},_uint32array:function(e){return r("uint32array:"),this.dispatch(Array.prototype.slice.call(e))},_int32array:function(e){return r("int32array:"),this.dispatch(Array.prototype.slice.call(e))},_float32array:function(e){return r("float32array:"),this.dispatch(Array.prototype.slice.call(e))},_float64array:function(e){return r("float64array:"),this.dispatch(Array.prototype.slice.call(e))},_arraybuffer:function(e){return r("arraybuffer:"),this.dispatch(new Uint8Array(e))},_url:function(e){return r("url:"+e.toString())},_map:function(t){return r("map:"),t=Array.from(t),this._array(t,!1!==e.unorderedSets)},_set:function(t){return r("set:"),t=Array.from(t),this._array(t,!1!==e.unorderedSets)},_file:function(e){return r("file:"),this.dispatch([e.name,e.size,e.type,e.lastModfied])},_blob:function(){if(e.ignoreUnknown)return r("[blob]");throw Error('Hashing Blob objects is currently not supported\n(see https://github.com/puleos/object-hash/issues/26)\nUse "options.replacer" or "options.ignoreUnknown"\n')},_domwindow:function(){return r("domwindow")},_bigint:function(e){return r("bigint:"+e.toString())},_process:function(){return r("process")},_timer:function(){return r("timer")},_pipe:function(){return r("pipe")},_tcp:function(){return r("tcp")},_udp:function(){return r("udp")},_tty:function(){return r("tty")},_statwatcher:function(){return r("statwatcher")},_securecontext:function(){return r("securecontext")},_connection:function(){return r("connection")},_zlib:function(){return r("zlib")},_context:function(){return r("context")},_nodescript:function(){return r("nodescript")},_httpparser:function(){return r("httpparser")},_dataview:function(){return r("dataview")},_signal:function(){return r("signal")},_fsevent:function(){return r("fsevent")},_tlswrap:function(){return r("tlswrap")}}}function _(){return{buf:"",write:function(e){this.buf+=e},end:function(e){this.buf+=e},read:function(){return this.buf}}}n.writeToStream=function(e,t,n){return void 0===n&&(n=t,t={}),y(t=g(e,t),n).dispatch(e)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(e,t,n){(function(e,t,r,i,s,o,a,l,c){!function(e){var t=typeof Uint8Array<"u"?Uint8Array:Array,n=43,r=47,i=48,s=97,o=65,a=45,l=95;function c(e){return(e=e.charCodeAt(0))===n||e===a?62:e===r||e===l?63:e<i?-1:e<i+10?e-i+26+26:e<o+26?e-o:e<s+26?e-s+26:void 0}e.toByteArray=function(e){var n,r;if(0<e.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var i=e.length,s=(i="="===e.charAt(i-2)?2:"="===e.charAt(i-1)?1:0,new t(3*e.length/4-i)),o=0<i?e.length-4:e.length,a=0;function l(e){s[a++]=e}for(n=0;n<o;n+=4,0)l((16711680&(r=c(e.charAt(n))<<18|c(e.charAt(n+1))<<12|c(e.charAt(n+2))<<6|c(e.charAt(n+3))))>>16),l((65280&r)>>8),l(255&r);return 2==i?l(255&(r=c(e.charAt(n))<<2|c(e.charAt(n+1))>>4)):1==i&&(l((r=c(e.charAt(n))<<10|c(e.charAt(n+1))<<4|c(e.charAt(n+2))>>2)>>8&255),l(255&r)),s},e.fromByteArray=function(e){var t,n,r,i,s=e.length%3,o="";function a(e){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e)}for(t=0,r=e.length-s;t<r;t+=3)o+=a((i=n=(e[t]<<16)+(e[t+1]<<8)+e[t+2])>>18&63)+a(i>>12&63)+a(i>>6&63)+a(63&i);switch(s){case 1:o=(o+=a((n=e[e.length-1])>>2))+a(n<<4&63)+"==";break;case 2:o=(o=(o+=a((n=(e[e.length-2]<<8)+e[e.length-1])>>10))+a(n>>4&63))+a(n<<2&63)+"="}return o}}(void 0===n?this.base64js={}:n)}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(e,t,n){(function(t,r,i,s,o,a,l,c,u){var h=e("base64-js"),d=e("ieee754");function i(e,t,n){if(!(this instanceof i))return new i(e,t,n);var r,s,o,a,l=typeof e;if("base64"===t&&"string"==l)for(e=(a=e).trim?a.trim():a.replace(/^\s+|\s+$/g,"");e.length%4!=0;)e+="=";if("number"==l)r=R(e);else if("string"==l)r=i.byteLength(e,t);else{if("object"!=l)throw new Error("First argument needs to be a number, array or string.");r=R(e.length)}if(i._useTypedArrays?s=i._augment(new Uint8Array(r)):((s=this).length=r,s._isBuffer=!0),i._useTypedArrays&&"number"==typeof e.byteLength)s._set(e);else if(L(a=e)||i.isBuffer(a)||a&&"object"==typeof a&&"number"==typeof a.length)for(o=0;o<r;o++)i.isBuffer(e)?s[o]=e.readUInt8(o):s[o]=e[o];else if("string"==l)s.write(e,0,t);else if("number"==l&&!i._useTypedArrays&&!n)for(o=0;o<r;o++)s[o]=0;return s}function p(e,t,n,r){return i._charsWritten=O(function(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function f(e,t,n,r){return i._charsWritten=O(function(e){for(var t,n,r=[],i=0;i<e.length;i++)t=(n=e.charCodeAt(i))>>8,n%=256,r.push(n),r.push(t);return r}(t),e,n,r)}function m(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;i++)r+=String.fromCharCode(e[i]);return r}function g(e,t,n,r){var i;if(r||(N("boolean"==typeof n,"missing or invalid endian"),N(null!=t,"missing offset"),N(t+1<e.length,"Trying to read beyond buffer length")),!((r=e.length)<=t))return n?(i=e[t],t+1<r&&(i|=e[t+1]<<8)):(i=e[t]<<8,t+1<r&&(i|=e[t+1])),i}function v(e,t,n,r){var i;if(r||(N("boolean"==typeof n,"missing or invalid endian"),N(null!=t,"missing offset"),N(t+3<e.length,"Trying to read beyond buffer length")),!((r=e.length)<=t))return n?(t+2<r&&(i=e[t+2]<<16),t+1<r&&(i|=e[t+1]<<8),i|=e[t],t+3<r&&(i+=e[t+3]<<24>>>0)):(t+1<r&&(i=e[t+1]<<16),t+2<r&&(i|=e[t+2]<<8),t+3<r&&(i|=e[t+3]),i+=e[t]<<24>>>0),i}function y(e,t,n,r){if(r||(N("boolean"==typeof n,"missing or invalid endian"),N(null!=t,"missing offset"),N(t+1<e.length,"Trying to read beyond buffer length")),!(e.length<=t))return 32768&(r=g(e,t,n,!0))?-1*(65535-r+1):r}function _(e,t,n,r){if(r||(N("boolean"==typeof n,"missing or invalid endian"),N(null!=t,"missing offset"),N(t+3<e.length,"Trying to read beyond buffer length")),!(e.length<=t))return 2147483648&(r=v(e,t,n,!0))?-1*(4294967295-r+1):r}function x(e,t,n,r){return r||(N("boolean"==typeof n,"missing or invalid endian"),N(t+3<e.length,"Trying to read beyond buffer length")),d.read(e,t,n,23,4)}function b(e,t,n,r){return r||(N("boolean"==typeof n,"missing or invalid endian"),N(t+7<e.length,"Trying to read beyond buffer length")),d.read(e,t,n,52,8)}function w(e,t,n,r,i){if(i||(N(null!=t,"missing value"),N("boolean"==typeof r,"missing or invalid endian"),N(null!=n,"missing offset"),N(n+1<e.length,"trying to write beyond buffer length"),U(t,65535)),!((i=e.length)<=n))for(var s=0,o=Math.min(i-n,2);s<o;s++)e[n+s]=(t&255<<8*(r?s:1-s))>>>8*(r?s:1-s)}function T(e,t,n,r,i){if(i||(N(null!=t,"missing value"),N("boolean"==typeof r,"missing or invalid endian"),N(null!=n,"missing offset"),N(n+3<e.length,"trying to write beyond buffer length"),U(t,4294967295)),!((i=e.length)<=n))for(var s=0,o=Math.min(i-n,4);s<o;s++)e[n+s]=t>>>8*(r?s:3-s)&255}function M(e,t,n,r,i){i||(N(null!=t,"missing value"),N("boolean"==typeof r,"missing or invalid endian"),N(null!=n,"missing offset"),N(n+1<e.length,"Trying to write beyond buffer length"),B(t,32767,-32768)),e.length<=n||w(e,0<=t?t:65535+t+1,n,r,i)}function A(e,t,n,r,i){i||(N(null!=t,"missing value"),N("boolean"==typeof r,"missing or invalid endian"),N(null!=n,"missing offset"),N(n+3<e.length,"Trying to write beyond buffer length"),B(t,2147483647,-2147483648)),e.length<=n||T(e,0<=t?t:4294967295+t+1,n,r,i)}function S(e,t,n,r,i){i||(N(null!=t,"missing value"),N("boolean"==typeof r,"missing or invalid endian"),N(null!=n,"missing offset"),N(n+3<e.length,"Trying to write beyond buffer length"),z(t,34028234663852886e22,-34028234663852886e22)),e.length<=n||d.write(e,t,n,r,23,4)}function E(e,t,n,r,i){i||(N(null!=t,"missing value"),N("boolean"==typeof r,"missing or invalid endian"),N(null!=n,"missing offset"),N(n+7<e.length,"Trying to write beyond buffer length"),z(t,17976931348623157e292,-17976931348623157e292)),e.length<=n||d.write(e,t,n,r,52,8)}n.Buffer=i,n.SlowBuffer=i,n.INSPECT_MAX_BYTES=50,i.poolSize=8192,i._useTypedArrays=function(){try{var e=new ArrayBuffer(0),t=new Uint8Array(e);return t.foo=function(){return 42},42===t.foo()&&"function"==typeof t.subarray}catch{return!1}}(),i.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.isBuffer=function(e){return!(null==e||!e._isBuffer)},i.byteLength=function(e,t){var n;switch(e+="",t||"utf8"){case"hex":n=e.length/2;break;case"utf8":case"utf-8":n=D(e).length;break;case"ascii":case"binary":case"raw":n=e.length;break;case"base64":n=k(e).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":n=2*e.length;break;default:throw new Error("Unknown encoding")}return n},i.concat=function(e,t){if(N(L(e),"Usage: Buffer.concat(list, [totalLength])\nlist should be an Array."),0===e.length)return new i(0);if(1===e.length)return e[0];if("number"!=typeof t)for(s=t=0;s<e.length;s++)t+=e[s].length;for(var n=new i(t),r=0,s=0;s<e.length;s++){var o=e[s];o.copy(n,r),r+=o.length}return n},i.prototype.write=function(e,t,n,r){isFinite(t)?isFinite(n)||(r=n,n=void 0):(c=r,r=t,t=n,n=c),t=Number(t)||0;var s,o,a,l,c=this.length-t;switch((!n||c<(n=Number(n)))&&(n=c),r=String(r||"utf8").toLowerCase()){case"hex":s=function(e,t,n,r){n=Number(n)||0;var s=e.length-n;(!r||s<(r=Number(r)))&&(r=s),N((s=t.length)%2==0,"Invalid hex string"),s/2<r&&(r=s/2);for(var o=0;o<r;o++){var a=parseInt(t.substr(2*o,2),16);N(!isNaN(a),"Invalid hex string"),e[n+o]=a}return i._charsWritten=2*o,o}(this,e,t,n);break;case"utf8":case"utf-8":o=this,a=t,l=n,s=i._charsWritten=O(D(e),o,a,l);break;case"ascii":case"binary":s=p(this,e,t,n);break;case"base64":o=this,a=t,l=n,s=i._charsWritten=O(k(e),o,a,l);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":s=f(this,e,t,n);break;default:throw new Error("Unknown encoding")}return s},i.prototype.toString=function(e,t,n){var r,i,s,o,a=this;if(e=String(e||"utf8").toLowerCase(),t=Number(t)||0,(n=void 0!==n?Number(n):a.length)===t)return"";switch(e){case"hex":r=function(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||r<n)&&(n=r);for(var i="",s=t;s<n;s++)i+=I(e[s]);return i}(a,t,n);break;case"utf8":case"utf-8":r=function(e,t,n){var r="",i="";n=Math.min(e.length,n);for(var s=t;s<n;s++)e[s]<=127?(r+=F(i)+String.fromCharCode(e[s]),i=""):i+="%"+e[s].toString(16);return r+F(i)}(a,t,n);break;case"ascii":case"binary":r=m(a,t,n);break;case"base64":i=a,o=n,r=0===(s=t)&&o===i.length?h.fromByteArray(i):h.fromByteArray(i.slice(s,o));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":r=function(e,t,n){for(var r=e.slice(t,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}(a,t,n);break;default:throw new Error("Unknown encoding")}return r},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},i.prototype.copy=function(e,t,n,r){if(t=t||0,(r=r||0===r?r:this.length)!==(n=n||0)&&0!==e.length&&0!==this.length){N(n<=r,"sourceEnd < sourceStart"),N(0<=t&&t<e.length,"targetStart out of bounds"),N(0<=n&&n<this.length,"sourceStart out of bounds"),N(0<=r&&r<=this.length,"sourceEnd out of bounds"),r>this.length&&(r=this.length);var s=(r=e.length-t<r-n?e.length-t+n:r)-n;if(s<100||!i._useTypedArrays)for(var o=0;o<s;o++)e[o+t]=this[o+n];else e._set(this.subarray(n,n+s),t)}},i.prototype.slice=function(e,t){var n=this.length;if(e=C(e,n,0),t=C(t,n,n),i._useTypedArrays)return i._augment(this.subarray(e,t));for(var r=t-e,s=new i(r,void 0,!0),o=0;o<r;o++)s[o]=this[o+e];return s},i.prototype.get=function(e){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(e)},i.prototype.set=function(e,t){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(e,t)},i.prototype.readUInt8=function(e,t){if(t||(N(null!=e,"missing offset"),N(e<this.length,"Trying to read beyond buffer length")),!(e>=this.length))return this[e]},i.prototype.readUInt16LE=function(e,t){return g(this,e,!0,t)},i.prototype.readUInt16BE=function(e,t){return g(this,e,!1,t)},i.prototype.readUInt32LE=function(e,t){return v(this,e,!0,t)},i.prototype.readUInt32BE=function(e,t){return v(this,e,!1,t)},i.prototype.readInt8=function(e,t){if(t||(N(null!=e,"missing offset"),N(e<this.length,"Trying to read beyond buffer length")),!(e>=this.length))return 128&this[e]?-1*(255-this[e]+1):this[e]},i.prototype.readInt16LE=function(e,t){return y(this,e,!0,t)},i.prototype.readInt16BE=function(e,t){return y(this,e,!1,t)},i.prototype.readInt32LE=function(e,t){return _(this,e,!0,t)},i.prototype.readInt32BE=function(e,t){return _(this,e,!1,t)},i.prototype.readFloatLE=function(e,t){return x(this,e,!0,t)},i.prototype.readFloatBE=function(e,t){return x(this,e,!1,t)},i.prototype.readDoubleLE=function(e,t){return b(this,e,!0,t)},i.prototype.readDoubleBE=function(e,t){return b(this,e,!1,t)},i.prototype.writeUInt8=function(e,t,n){n||(N(null!=e,"missing value"),N(null!=t,"missing offset"),N(t<this.length,"trying to write beyond buffer length"),U(e,255)),t>=this.length||(this[t]=e)},i.prototype.writeUInt16LE=function(e,t,n){w(this,e,t,!0,n)},i.prototype.writeUInt16BE=function(e,t,n){w(this,e,t,!1,n)},i.prototype.writeUInt32LE=function(e,t,n){T(this,e,t,!0,n)},i.prototype.writeUInt32BE=function(e,t,n){T(this,e,t,!1,n)},i.prototype.writeInt8=function(e,t,n){n||(N(null!=e,"missing value"),N(null!=t,"missing offset"),N(t<this.length,"Trying to write beyond buffer length"),B(e,127,-128)),t>=this.length||(0<=e?this.writeUInt8(e,t,n):this.writeUInt8(255+e+1,t,n))},i.prototype.writeInt16LE=function(e,t,n){M(this,e,t,!0,n)},i.prototype.writeInt16BE=function(e,t,n){M(this,e,t,!1,n)},i.prototype.writeInt32LE=function(e,t,n){A(this,e,t,!0,n)},i.prototype.writeInt32BE=function(e,t,n){A(this,e,t,!1,n)},i.prototype.writeFloatLE=function(e,t,n){S(this,e,t,!0,n)},i.prototype.writeFloatBE=function(e,t,n){S(this,e,t,!1,n)},i.prototype.writeDoubleLE=function(e,t,n){E(this,e,t,!0,n)},i.prototype.writeDoubleBE=function(e,t,n){E(this,e,t,!1,n)},i.prototype.fill=function(e,t,n){if(t=t||0,n=n||this.length,N("number"==typeof(e="string"==typeof(e=e||0)?e.charCodeAt(0):e)&&!isNaN(e),"value is not a number"),N(t<=n,"end < start"),n!==t&&0!==this.length){N(0<=t&&t<this.length,"start out of bounds"),N(0<=n&&n<=this.length,"end out of bounds");for(var r=t;r<n;r++)this[r]=e}},i.prototype.inspect=function(){for(var e=[],t=this.length,r=0;r<t;r++)if(e[r]=I(this[r]),r===n.INSPECT_MAX_BYTES){e[r+1]="...";break}return"<Buffer "+e.join(" ")+">"},i.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(i._useTypedArrays)return new i(this).buffer;for(var e=new Uint8Array(this.length),t=0,n=e.length;t<n;t+=1)e[t]=this[t];return e.buffer};var P=i.prototype;function C(e,t,n){return"number"!=typeof e?n:t<=(e=~~e)?t:0<=e||0<=(e+=t)?e:0}function R(e){return(e=~~Math.ceil(+e))<0?0:e}function L(e){return(Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)})(e)}function I(e){return e<16?"0"+e.toString(16):e.toString(16)}function D(e){for(var t=[],n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<=127)t.push(e.charCodeAt(n));else for(var i=n,s=(55296<=r&&r<=57343&&n++,encodeURIComponent(e.slice(i,n+1)).substr(1).split("%")),o=0;o<s.length;o++)t.push(parseInt(s[o],16))}return t}function k(e){return h.toByteArray(e)}function O(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);i++)t[i+n]=e[i];return i}function F(e){try{return decodeURIComponent(e)}catch{return"�"}}function U(e,t){N("number"==typeof e,"cannot write a non-number as a number"),N(0<=e,"specified a negative value for writing an unsigned value"),N(e<=t,"value is larger than maximum value for type"),N(Math.floor(e)===e,"value has a fractional component")}function B(e,t,n){N("number"==typeof e,"cannot write a non-number as a number"),N(e<=t,"value larger than maximum allowed value"),N(n<=e,"value smaller than minimum allowed value"),N(Math.floor(e)===e,"value has a fractional component")}function z(e,t,n){N("number"==typeof e,"cannot write a non-number as a number"),N(e<=t,"value larger than maximum allowed value"),N(n<=e,"value smaller than minimum allowed value")}function N(e,t){if(!e)throw new Error(t||"Failed assertion")}i._augment=function(e){return e._isBuffer=!0,e._get=e.get,e._set=e.set,e.get=P.get,e.set=P.set,e.write=P.write,e.toString=P.toString,e.toLocaleString=P.toString,e.toJSON=P.toJSON,e.copy=P.copy,e.slice=P.slice,e.readUInt8=P.readUInt8,e.readUInt16LE=P.readUInt16LE,e.readUInt16BE=P.readUInt16BE,e.readUInt32LE=P.readUInt32LE,e.readUInt32BE=P.readUInt32BE,e.readInt8=P.readInt8,e.readInt16LE=P.readInt16LE,e.readInt16BE=P.readInt16BE,e.readInt32LE=P.readInt32LE,e.readInt32BE=P.readInt32BE,e.readFloatLE=P.readFloatLE,e.readFloatBE=P.readFloatBE,e.readDoubleLE=P.readDoubleLE,e.readDoubleBE=P.readDoubleBE,e.writeUInt8=P.writeUInt8,e.writeUInt16LE=P.writeUInt16LE,e.writeUInt16BE=P.writeUInt16BE,e.writeUInt32LE=P.writeUInt32LE,e.writeUInt32BE=P.writeUInt32BE,e.writeInt8=P.writeInt8,e.writeInt16LE=P.writeInt16LE,e.writeInt16BE=P.writeInt16BE,e.writeInt32LE=P.writeInt32LE,e.writeInt32BE=P.writeInt32BE,e.writeFloatLE=P.writeFloatLE,e.writeFloatBE=P.writeFloatBE,e.writeDoubleLE=P.writeDoubleLE,e.writeDoubleBE=P.writeDoubleBE,e.fill=P.fill,e.inspect=P.inspect,e.toArrayBuffer=P.toArrayBuffer,e}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(e,t,n){(function(n,r,i,s,o,a,l,c,u){i=e("buffer").Buffer;var h=4,d=new i(h);d.fill(0),t.exports={hash:function(e,t,n,r){for(var s=t(function(e,t){e.length%h!=0&&(n=e.length+(h-e.length%h),e=i.concat([e,d],n));for(var n,r=[],s=t?e.readInt32BE:e.readInt32LE,o=0;o<e.length;o+=h)r.push(s.call(e,o));return r}(e=i.isBuffer(e)?e:new i(e),r),8*e.length),o=(t=r,new i(n)),a=t?o.writeInt32BE:o.writeInt32LE,l=0;l<s.length;l++)a.call(o,s[l],4*l,!0);return o}}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(e,t,n){(function(t,r,i,s,o,a,l,c,u){i=e("buffer").Buffer;var h=e("./sha"),d=e("./sha256"),p=e("./rng"),f={sha1:h,sha256:d,md5:e("./md5")},m=64,g=new i(m);function v(e,t){var n=f[e=e||"sha1"],r=[];return n||y("algorithm:",e,"is not yet supported"),{update:function(e){return i.isBuffer(e)||(e=new i(e)),r.push(e),e.length,this},digest:function(e){var s=i.concat(r);return s=t?function(e,t,n){i.isBuffer(t)||(t=new i(t)),i.isBuffer(n)||(n=new i(n)),t.length>m?t=e(t):t.length<m&&(t=i.concat([t,g],m));for(var r=new i(m),s=new i(m),o=0;o<m;o++)r[o]=54^t[o],s[o]=92^t[o];return n=e(i.concat([r,n])),e(i.concat([s,n]))}(n,t,s):n(s),r=null,e?s.toString(e):s}}}function y(){var e=[].slice.call(arguments).join(" ");throw new Error([e,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join("\n"))}g.fill(0),n.createHash=function(e){return v(e)},n.createHmac=v,n.randomBytes=function(e,t){if(!t||!t.call)return new i(p(e));try{t.call(this,void 0,new i(p(e)))}catch(n){t(n)}};var _,x=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],b=function(e){n[e]=function(){y("sorry,",e,"is not implemented yet")}};for(_ in x)b(x[_])}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(e,t,n){(function(n,r,i,s,o,a,l,c,u){var h=e("./helpers");function d(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,r=-271733879,i=-1732584194,s=271733878,o=0;o<e.length;o+=16){var a=n,l=r,c=i,u=s;n=f(n,r,i,s,e[o+0],7,-680876936),s=f(s,n,r,i,e[o+1],12,-389564586),i=f(i,s,n,r,e[o+2],17,606105819),r=f(r,i,s,n,e[o+3],22,-1044525330),n=f(n,r,i,s,e[o+4],7,-176418897),s=f(s,n,r,i,e[o+5],12,1200080426),i=f(i,s,n,r,e[o+6],17,-1473231341),r=f(r,i,s,n,e[o+7],22,-45705983),n=f(n,r,i,s,e[o+8],7,1770035416),s=f(s,n,r,i,e[o+9],12,-1958414417),i=f(i,s,n,r,e[o+10],17,-42063),r=f(r,i,s,n,e[o+11],22,-1990404162),n=f(n,r,i,s,e[o+12],7,1804603682),s=f(s,n,r,i,e[o+13],12,-40341101),i=f(i,s,n,r,e[o+14],17,-1502002290),n=m(n,r=f(r,i,s,n,e[o+15],22,1236535329),i,s,e[o+1],5,-165796510),s=m(s,n,r,i,e[o+6],9,-1069501632),i=m(i,s,n,r,e[o+11],14,643717713),r=m(r,i,s,n,e[o+0],20,-373897302),n=m(n,r,i,s,e[o+5],5,-701558691),s=m(s,n,r,i,e[o+10],9,38016083),i=m(i,s,n,r,e[o+15],14,-660478335),r=m(r,i,s,n,e[o+4],20,-405537848),n=m(n,r,i,s,e[o+9],5,568446438),s=m(s,n,r,i,e[o+14],9,-1019803690),i=m(i,s,n,r,e[o+3],14,-187363961),r=m(r,i,s,n,e[o+8],20,1163531501),n=m(n,r,i,s,e[o+13],5,-1444681467),s=m(s,n,r,i,e[o+2],9,-51403784),i=m(i,s,n,r,e[o+7],14,1735328473),n=g(n,r=m(r,i,s,n,e[o+12],20,-1926607734),i,s,e[o+5],4,-378558),s=g(s,n,r,i,e[o+8],11,-2022574463),i=g(i,s,n,r,e[o+11],16,1839030562),r=g(r,i,s,n,e[o+14],23,-35309556),n=g(n,r,i,s,e[o+1],4,-1530992060),s=g(s,n,r,i,e[o+4],11,1272893353),i=g(i,s,n,r,e[o+7],16,-155497632),r=g(r,i,s,n,e[o+10],23,-1094730640),n=g(n,r,i,s,e[o+13],4,681279174),s=g(s,n,r,i,e[o+0],11,-358537222),i=g(i,s,n,r,e[o+3],16,-722521979),r=g(r,i,s,n,e[o+6],23,76029189),n=g(n,r,i,s,e[o+9],4,-640364487),s=g(s,n,r,i,e[o+12],11,-421815835),i=g(i,s,n,r,e[o+15],16,530742520),n=v(n,r=g(r,i,s,n,e[o+2],23,-995338651),i,s,e[o+0],6,-198630844),s=v(s,n,r,i,e[o+7],10,1126891415),i=v(i,s,n,r,e[o+14],15,-1416354905),r=v(r,i,s,n,e[o+5],21,-57434055),n=v(n,r,i,s,e[o+12],6,1700485571),s=v(s,n,r,i,e[o+3],10,-1894986606),i=v(i,s,n,r,e[o+10],15,-1051523),r=v(r,i,s,n,e[o+1],21,-2054922799),n=v(n,r,i,s,e[o+8],6,1873313359),s=v(s,n,r,i,e[o+15],10,-30611744),i=v(i,s,n,r,e[o+6],15,-1560198380),r=v(r,i,s,n,e[o+13],21,1309151649),n=v(n,r,i,s,e[o+4],6,-145523070),s=v(s,n,r,i,e[o+11],10,-1120210379),i=v(i,s,n,r,e[o+2],15,718787259),r=v(r,i,s,n,e[o+9],21,-343485551),n=y(n,a),r=y(r,l),i=y(i,c),s=y(s,u)}return Array(n,r,i,s)}function p(e,t,n,r,i,s){return y((t=y(y(t,e),y(r,s)))<<i|t>>>32-i,n)}function f(e,t,n,r,i,s,o){return p(t&n|~t&r,e,t,i,s,o)}function m(e,t,n,r,i,s,o){return p(t&r|n&~r,e,t,i,s,o)}function g(e,t,n,r,i,s,o){return p(t^n^r,e,t,i,s,o)}function v(e,t,n,r,i,s,o){return p(n^(t|~r),e,t,i,s,o)}function y(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}t.exports=function(e){return h.hash(e,d,16)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(e,t,n){(function(e,n,r,i,s,o,a,l,c){t.exports=function(e){for(var t,n=new Array(e),r=0;r<e;r++)!(3&r)&&(t=4294967296*Math.random()),n[r]=t>>>((3&r)<<3)&255;return n}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(e,t,n){(function(n,r,i,s,o,a,l,c,u){var h=e("./helpers");function d(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var n,r,i,s=Array(80),o=1732584193,a=-271733879,l=-1732584194,c=271733878,u=-1009589776,h=0;h<e.length;h+=16){for(var d=o,m=a,g=l,v=c,y=u,_=0;_<80;_++){s[_]=_<16?e[h+_]:f(s[_-3]^s[_-8]^s[_-14]^s[_-16],1);var x=p(p(f(o,5),(x=a,r=l,i=c,(n=_)<20?x&r|~x&i:!(n<40)&&n<60?x&r|x&i|r&i:x^r^i)),p(p(u,s[_]),(n=_)<20?1518500249:n<40?1859775393:n<60?-1894007588:-899497514));u=c,c=l,l=f(a,30),a=o,o=x}o=p(o,d),a=p(a,m),l=p(l,g),c=p(c,v),u=p(u,y)}return Array(o,a,l,c,u)}function p(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function f(e,t){return e<<t|e>>>32-t}t.exports=function(e){return h.hash(e,d,20,!0)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(e,t,n){(function(n,r,i,s,o,a,l,c,u){function h(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function d(e,t){var n,r=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),i=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),s=new Array(64);e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var o,a,l=0;l<e.length;l+=16){for(var c=i[0],u=i[1],d=i[2],p=i[3],g=i[4],v=i[5],y=i[6],_=i[7],x=0;x<64;x++)s[x]=x<16?e[x+l]:h(h(h((a=s[x-2],f(a,17)^f(a,19)^m(a,10)),s[x-7]),(a=s[x-15],f(a,7)^f(a,18)^m(a,3))),s[x-16]),n=h(h(h(h(_,f(a=g,6)^f(a,11)^f(a,25)),g&v^~g&y),r[x]),s[x]),o=h(f(o=c,2)^f(o,13)^f(o,22),c&u^c&d^u&d),_=y,y=v,v=g,g=h(p,n),p=d,d=u,u=c,c=h(n,o);i[0]=h(c,i[0]),i[1]=h(u,i[1]),i[2]=h(d,i[2]),i[3]=h(p,i[3]),i[4]=h(g,i[4]),i[5]=h(v,i[5]),i[6]=h(y,i[6]),i[7]=h(_,i[7])}return i}var p=e("./helpers"),f=function(e,t){return e>>>t|e<<32-t},m=function(e,t){return e>>>t};t.exports=function(e){return p.hash(e,d,32,!0)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(e,t,n){(function(e,t,r,i,s,o,a,l,c){n.read=function(e,t,n,r,i){var s,o,a=8*i-r-1,l=(1<<a)-1,c=l>>1,u=-7,h=n?i-1:0,d=n?-1:1;for(i=e[t+h],h+=d,s=i&(1<<-u)-1,i>>=-u,u+=a;0<u;s=256*s+e[t+h],h+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;0<u;o=256*o+e[t+h],h+=d,u-=8);if(0===s)s=1-c;else{if(s===l)return o?NaN:1/0*(i?-1:1);o+=Math.pow(2,r),s-=c}return(i?-1:1)*o*Math.pow(2,s-r)},n.write=function(e,t,n,r,i,s){var o,a,l=8*s-i-1,c=(1<<l)-1,u=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,p=r?1:-1;for(s=t<0||0===t&&1/t<0?1:0,t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(r=Math.pow(2,-o))<1&&(o--,r*=2),2<=(t+=1<=o+u?h/r:h*Math.pow(2,1-u))*r&&(o++,r/=2),c<=o+u?(a=0,o=c):1<=o+u?(a=(t*r-1)*Math.pow(2,i),o+=u):(a=t*Math.pow(2,u-1)*Math.pow(2,i),o=0));8<=i;e[n+d]=255&a,d+=p,a/=256,i-=8);for(o=o<<i|a,l+=i;0<l;e[n+d]=255&o,d+=p,o/=256,l-=8);e[n+d-p]|=128*s}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(e,t,n){(function(e,n,r,i,s,o,a,l,c){var u,h,d;function p(){}(e=t.exports={}).nextTick=(h=typeof window<"u"&&window.setImmediate,d=typeof window<"u"&&window.postMessage&&window.addEventListener,h?function(e){return window.setImmediate(e)}:d?(u=[],window.addEventListener("message",(function(e){var t=e.source;t!==window&&null!==t||"process-tick"!==e.data||(e.stopPropagation(),0<u.length&&u.shift()())}),!0),function(e){u.push(e),window.postMessage("process-tick","*")}):function(e){setTimeout(e,0)}),e.title="browser",e.browser=!0,e.env={},e.argv=[],e.on=p,e.addListener=p,e.once=p,e.off=p,e.removeListener=p,e.removeAllListeners=p,e.emit=p,e.binding=function(e){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(e){throw new Error("process.chdir is not supported")}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)),function(){if(yx)return vx;yx=1;var e=wx();vx=function(t,n){var r=e(n),i=[];return i=i.concat(r(t)),i=i.concat(r(null)),i}}();var Ax,Sx,Ex,Px="csm_Position",Cx="csm_PositionRaw",Rx="csm_PointSize",Lx="csm_FragColor",Ix="csm_DiffuseColor",Dx="csm_Normal",kx="csm_Roughness",Ox="csm_Metalness",Fx="csm_Emissive",Ux="csm_AO",Bx="csm_Bump",zx="csm_DepthAlpha";Mx(Ax={},"".concat(Dx),{"#include <beginnormal_vertex>":"\n    vec3 objectNormal = ".concat(Dx,";\n    #ifdef USE_TANGENT\n\t    vec3 objectTangent = vec3( tangent.xyz );\n    #endif\n    ")}),Mx(Ax,"".concat(Px),{"#include <begin_vertex>":"\n    vec3 transformed = ".concat(Px,";\n  ")}),Mx(Ax,"".concat(Cx),{"#include <begin_vertex>":"\n    vec4 csm_internal_positionUnprojected = ".concat(Cx,";\n    mat4x4 csm_internal_unprojectMatrix = projectionMatrix * modelViewMatrix;\n    #ifdef USE_INSTANCING\n      csm_internal_unprojectMatrix = csm_internal_unprojectMatrix * instanceMatrix;\n    #endif\n    csm_internal_positionUnprojected = inverse(csm_internal_unprojectMatrix) * csm_internal_positionUnprojected;\n    vec3 transformed = csm_internal_positionUnprojected.xyz;\n  ")}),Mx(Ax,"".concat(Rx),{"gl_PointSize = size;":"\n    gl_PointSize = ".concat(Rx,";\n    ")}),Mx(Ax,"".concat(Ix),{"#include <color_fragment>":"\n    #include <color_fragment>\n    diffuseColor = ".concat(Ix,";\n  ")}),Mx(Ax,"".concat(Lx),{"#include <dithering_fragment>":"\n    #include <dithering_fragment>\n    gl_FragColor  = ".concat(Lx,";\n  ")}),Mx(Ax,"".concat(Fx),{"vec3 totalEmissiveRadiance = emissive;":"\n    vec3 totalEmissiveRadiance = ".concat(Fx,";\n    ")}),Mx(Ax,"".concat(kx),{"#include <roughnessmap_fragment>":"\n    #include <roughnessmap_fragment>\n    roughnessFactor = ".concat(kx,";\n    ")}),Mx(Ax,"".concat(Ox),{"#include <metalnessmap_fragment>":"\n    #include <metalnessmap_fragment>\n    metalnessFactor = ".concat(Ox,";\n    ")}),Mx(Ax,"".concat(Ux),{"#include <aomap_fragment>":"\n    #include <aomap_fragment>\n    reflectedLight.indirectDiffuse *= 1. - ".concat(Ux,";\n    ")}),Mx(Ax,"".concat(Bx),{"#include <normal_fragment_maps>":"\n    #include <normal_fragment_maps>\n\n    vec3 csm_internal_orthogonal = ".concat(Bx," - (dot(").concat(Bx,", normal) * normal);\n    vec3 csm_internal_projectedbump = mat3(csm_internal_vModelViewMatrix) * csm_internal_orthogonal;\n    normal = normalize(normal - csm_internal_projectedbump);\n    ")}),Mx(Ax,"".concat(zx),{"gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );":"\n      gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity * ".concat(zx," );\n    "),"gl_FragColor = packDepthToRGBA( fragCoordZ );":"\n      gl_FragColor = packDepthToRGBA( fragCoordZ );\n      gl_FragColor.a *= ".concat(zx,";\n    ")}),Mx(Sx={},"".concat(Px),{"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );":"\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( ".concat(Px,", 1.0 );\n  ")}),Mx(Sx,"".concat(Cx),{"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );":"\n    gl_Position = ".concat(Px,";\n  ")}),Mx(Sx,"".concat(Ix),{"gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );":"\n    gl_FragColor = ".concat(Ix,";\n  ")}),Mx(Sx,"".concat(Lx),{"gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );":"\n    gl_FragColor = ".concat(Lx,";\n  ")}),Mx(Ex={},"".concat(Px),"*"),Mx(Ex,"".concat(Cx),"*"),Mx(Ex,"".concat(Dx),"*"),Mx(Ex,"".concat(Rx),["PointsMaterial"]),Mx(Ex,"".concat(Ix),"*"),Mx(Ex,"".concat(Lx),"*"),Mx(Ex,"".concat(Fx),["MeshStandardMaterial","MeshPhysicalMaterial"]),Mx(Ex,"".concat(kx),["MeshStandardMaterial","MeshPhysicalMaterial"]),Mx(Ex,"".concat(Ox),["MeshStandardMaterial","MeshPhysicalMaterial"]),Mx(Ex,"".concat(Ux),["MeshStandardMaterial","MeshPhysicalMaterial","MeshBasicMaterial","MeshLambertMaterial","MeshPhongMaterial","MeshToonMaterial"]),Mx(Ex,"".concat(Bx),["MeshLambertMaterial","MeshMatcapMaterial","MeshNormalMaterial","MeshPhongMaterial","MeshPhysicalMaterial","MeshStandardMaterial","MeshToonMaterial","ShadowMaterial"]),Mx(Ex,"".concat(zx),"*"),new ne(0,0,0),new ne(0,0,0),new ne(0,0,0),new lt;var Nx,jx={exports:{}};Nx||(Nx=1,jx.exports=function(){var e=function(){function t(e){return i.appendChild(e.dom),e}function n(e){for(var t=0;t<i.children.length;t++)i.children[t].style.display=t===e?"block":"none";r=e}var r=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(e){e.preventDefault(),n(++r%i.children.length)}),!1);var s=(performance||Date).now(),o=s,a=0,l=t(new e.Panel("FPS","#0ff","#002")),c=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=t(new e.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:i,addPanel:t,showPanel:n,begin:function(){s=(performance||Date).now()},end:function(){a++;var e=(performance||Date).now();if(c.update(e-s,200),e>o+1e3&&(l.update(1e3*a/(e-o),100),o=e,a=0,u)){var t=performance.memory;u.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){s=this.end()},domElement:i,setMode:n}};return e.Panel=function(e,t,n){var r=1/0,i=0,s=Math.round,o=s(window.devicePixelRatio||1),a=80*o,l=48*o,c=3*o,u=2*o,h=3*o,d=15*o,p=74*o,f=30*o,m=document.createElement("canvas");m.width=a,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,a,l),g.fillStyle=t,g.fillText(e,c,u),g.fillRect(h,d,p,f),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h,d,p,f),{dom:m,update:function(l,v){r=Math.min(r,l),i=Math.max(i,l),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,a,d),g.fillStyle=t,g.fillText(s(l)+" "+e+" ("+s(r)+"-"+s(i)+")",c,u),g.drawImage(m,h+o,d,p-o,f,h,d,p-o,f),g.fillRect(h+p-o,d,o,f),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h+p-o,d,o,s((1-l/v)*f))}}},e}()),new q(16777215);const Hx=["object"],Gx=e({__name:"GeoGLTF",props:{url:{},draco:{type:Boolean,default:!1},decoderPath:{default:"./draco/"},renderOrder:{default:1}},setup(e){const t=e,n=i();return o((async()=>{const{scene:e}=await nx(t.url,{draco:t.draco,decoderPath:t.draco?t.decoderPath:void 0});n.value=e,n.value.userData.tiles=[],n.value.renderOrder=t.renderOrder})),(e,t)=>n.value?(c(),s("primitive",{key:0,object:n.value,scale:1,position:[0,0,0]},null,8,Hx)):C("",!0)}}),Vx=e({__name:"GeoCSS2DRenderer",setup(e){const{camera:t,renderer:n}=fr(),r=i(),s=()=>{r.value?.setSize(window.innerWidth,window.innerHeight)};return o((()=>{t.value&&t.value.layers.enableAll(),r.value=new qi,r.value.setSize(window.innerWidth,window.innerHeight),r.value.domElement.style.position="fixed",r.value.domElement.style.top="0",r.value.domElement.style.left="0",r.value.domElement.style.pointerEvents="none",n.value.domElement?.parentElement?.appendChild(r.value.domElement);const{onAfterRender:e}=mr();e((({scene:e,camera:t})=>{r.value?.render(e,t)})),window.addEventListener("resize",s)})),A((()=>{window.removeEventListener("resize",s),n.value.domElement?.parentElement?.removeChild(r.value.domElement)})),()=>{}}}),Wx=e({__name:"GeoCanvas",props:{canvasConfig:{default:()=>({windowSize:!0,alpha:!0,antialias:!0,shadows:!1,autoClear:!0,disableRender:!0,outputColorSpace:K,toneMapping:V,pixelRatio:1})},cameraConfig:{default:()=>({fov:29,aspect:window.innerWidth/window.innerHeight,near:50,far:1e4,position:[0,0,175e5],lookAt:[0,0,0]})}},setup(e){const t=e,{canvasConfig:n,cameraConfig:i}=t,s=r(null);return o((()=>{const e=s.value?.context?.renderer;e?.value&&(window.devicePixelRatio=n.pixelRatio,e.value.setPixelRatio(window.devicePixelRatio))})),(e,t)=>(c(),P(h(Wr),U({clearColor:"#fff"},h(n),{ref_key:"canvasRef",ref:s}),{default:L((()=>[R("TresPerspectiveCamera",O(F(h(i))),null,16),I(Vx),T(e.$slots,"default")])),_:3},16))}}),Xx=e({__name:"GeoControls",props:S({enableDamping:{type:Boolean,default:!0},adjustHeight:{type:Boolean,default:!1},minDistance:{default:150}},{position:{required:!0},positionModifiers:{}}),emits:["update:position"],setup(e){const{scene:t,camera:n,renderer:r}=fr(),i=E(e,"position"),s=e,{onAfterRender:c}=mr();let u=null;o((()=>{u=new rh(t.value,n.value,r.value.domElement),u.setTilesRenderer({group:t.value}),u.enableDamping=s.enableDamping,u.adjustHeight=s.adjustHeight,u.minDistance=s.minDistance}));const h=()=>{n.value&&((e,t,n,r,i,s)=>{new ms(t,gs(n),gs(r)).decompose(new is(gs(i),gs(s)).toECEF(),e.position,e.quaternion,e.up),e.updateMatrixWorld()})(n.value,i.value.distance,i.value.heading,i.value.pitch,i.value.longitude,i.value.latitude)},d=((e,t,n)=>{let r;const i=()=>{r=a(e,t,n)};return i(),e=>{r(),e().then((()=>{i()}))}})([i,n],(()=>{h()}),{immediate:!0});return c((()=>{if(u?.update?.(),n.value){const e=(e=>{_s.setFromCamera(e);const t=bs.setFromMatrixPosition(e.matrixWorld),n=ws.set(0,0,.5).unproject(e).sub(t).normalize(),r=Ms.getIntersection(Ts.set(t,n));return xs.setFromECEF(r),{distance:_s.distance,heading:vs(_s.heading),pitch:vs(_s.pitch),longitude:vs(xs.longitude),latitude:vs(xs.latitude)}})(n.value);d((async()=>{i.value=e}))}})),l((()=>{u?.dispose()})),(e,t)=>null}}),Kx=["color","intensity"],qx=["color","intensity","position"],Yx=e({__name:"GeoScene",props:{sceneConfig:{default:()=>({effectProps:{enabled:!0,focusArea:.7,feather:.1},ambientLight:{color:"#fff",intensity:1},directionalLight:{color:"#fff",intensity:2,position:[-1500,500,500]},background:"/farm_field_puresky_2k.jpg"})}},setup(e){const t=e,{sceneConfig:n}=t,i=w(n.effectProps),a=w(n.ambientLight),l=w(n.directionalLight),u=r(null),d=r(null),{scene:p}=fr();return o((()=>{const e=new De;if(n.background){const t=e.load(n.background);t.mapping=ke,t.colorSpace=K,p.value.background=t}})),(e,t)=>(c(),s("TresGroup",null,[T(e.$slots,"default"),i.enabled?(c(),P(D,{key:0},{default:L((()=>[I(h(Fi),null,{default:L((()=>[I(h(ji),{focusArea:i.focusArea,feather:i.feather},null,8,["focusArea","feather"])])),_:1})])),_:1})):C("",!0),R("TresAmbientLight",{ref_key:"ambientLightRef",ref:u,color:a.color,intensity:a.intensity},null,8,Kx),R("TresDirectionalLight",{ref_key:"directionalLightRef",ref:d,color:l.color,intensity:l.intensity,position:l.position},null,8,qx)]))}});export{Xs as G,Ko as P,Vx as Y,Yx as _,Uo as a,Wo as c,cv as d,Ps as e,Xx as g,ld as h,ks as i,$s as j,No as l,Wx as m,Is as n,Qs as o,Gx as p,Fs as s,Rs as t,qo as u};
