import{o as t}from"./mobx-preact.CWb_pbao1763540743861.js";import{u as e,x as o,_ as n,b as r,n as i}from"./preact.8mrV7GhH1763540743861.js";import{r as a,c as s,s as l,h as d,u as p,q as c,v as u,w as h,x as f,y,a as g,f as v,z as m,A as x,B as b,m as E,n as M,o as w,t as O,C as _,l as S,D as T,E as P,j as A,F as N,G as D,H as C,I as j,J as L}from"./lodash-es.B7GkVYRo1763540743861.js";import{c as I,t as R,i as k,s as B,o as X,a as z,b as H,r as G}from"./mobx.2AEeuwdD1763540743861.js";import{v as Y}from"./uuid.P-OY1HC21763540743861.js";import{c as F}from"./classnames.CvsNZWyV1763540743861.js";import{M as W}from"./mousetrap.HUeCSN8D1763540743861.js";import{d as U}from"./mobx-utils.DRuFfyn81763540743861.js";import{M as V}from"./medium-editor.BVowxDgG1763540743861.js";import{P as Z}from"./vanilla-picker.GdzCElJN1763540743861.js";import{r as K}from"./rangy.DQ-NcE4k1763540743861.js";import{r as q,A as J,S as $}from"./@vue.Co_gxueH1763540743861.js";var Q,tt=function(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(o[n[r]]=t[n[r]])}return o};!function(t){t.get=function(e){var o=tt(e,[]);if(!e.container)throw new Error("Ensure the container of LogicFlow is specified and valid.");return a({},t.defaults,o)}}(Q||(Q={})),function(t){t.defaults={background:!1,grid:!1,textEdit:!0,snapline:!0,outline:!1,disabledTools:[]}}(Q||(Q={}));var et={node:!1,edge:!1},ot={node:!0,edge:!0};function nt(t){try{return JSON.parse(JSON.stringify(t))}catch(e){return t}}var rt,it,at,st,lt,dt,pt,ct=200;!function(t){t[t.DEFAULT=1]="DEFAULT",t[t.TEXT_EDIT=2]="TEXT_EDIT",t[t.SHOW_MENU=3]="SHOW_MENU",t[t.ALLOW_CONNECT=4]="ALLOW_CONNECT",t[t.NOT_ALLOW_CONNECT=5]="NOT_ALLOW_CONNECT"}(rt||(rt={})),function(t){t.NODE="node",t.EDGE="edge",t.GRAPH="graph"}(it||(it={})),function(t){t.NODE="node",t.CIRCLE_NODE="circle-node",t.POLYGON_NODE="polygon-node",t.RECT_NODE="rect-node",t.TEXT_NODE="text-node",t.ELLIPSE_NODE="ellipse-node",t.DIAMOND_NODE="diamond-node",t.HTML_NODE="html-node",t.CUSTOM_HTML_NODE="custom-html-node",t.EDGE="edge",t.LINE_EDGE="line-edge",t.POLYLINE_EDGE="polyline-edge",t.BEZIER_EDGE="bezier-edge",t.GRAPH="graph"}(at||(at={})),function(t){t.ELEMENT_CLICK="element:click",t.NODE_ADD="node:add",t.NODE_DELETE="node:delete",t.NODE_CLICK="node:click",t.NODE_DBCLICK="node:dbclick",t.NODE_GROUP_COPY="node:group-copy-add",t.NODE_DND_ADD="node:dnd-add",t.NODE_DND_DRAG="node:dnd-drag",t.NODE_MOUSEDOWN="node:mousedown",t.NODE_DRAGSTART="node:dragstart",t.NODE_DRAG="node:drag",t.NODE_DROP="node:drop",t.NODE_MOUSEUP="node:mouseup",t.NODE_MOUSEMOVE="node:mousemove",t.NODE_MOUSEENTER="node:mouseenter",t.NODE_MOUSELEAVE="node:mouseleave",t.NODE_CONTEXTMENU="node:contextmenu",t.NODE_ROTATE="node:rotate",t.NODE_RESIZE="node:resize",t.NODE_FOCUS="node:focus",t.NODE_BLUR="node:blur",t.NODE_PROPERTIES_CHANGE="node:properties-change",t.NODE_PROPERTIES_DELETE="node:properties-delete",t.EDGE_ADD="edge:add",t.EDGE_DELETE="edge:delete",t.EDGE_CLICK="edge:click",t.EDGE_DBCLICK="edge:dbclick",t.EDGE_FOCUS="edge:focus",t.EDGE_BLUR="edge:blur",t.EDGE_MOUSEENTER="edge:mouseenter",t.EDGE_MOUSELEAVE="edge:mouseleave",t.EDGE_CONTEXTMENU="edge:contextmenu",t.EDGE_ADJUST="edge:adjust",t.EDGE_EXCHANGE_NODE="edge:exchange-node",t.ANCHOR_CLICK="anchor:click",t.ANCHOR_MOUSEDOWN="anchor:mousedown",t.ANCHOR_DRAGSTART="anchor:dragstart",t.ANCHOR_DRAG="anchor:drag",t.ANCHOR_DROP="anchor:drop",t.ANCHOR_DRAGEND="anchor:dragend",t.ADJUST_POINT_MOUSEDOWN="adjustPoint:mousedown",t.ADJUST_POINT_MOUSEUP="adjustPoint:mouseup",t.ADJUST_POINT_MOUSEMOVE="adjustPoint:mousemove",t.ADJUST_POINT_DRAGSTART="adjustPoint:dragstart",t.ADJUST_POINT_DRAG="adjustPoint:drag",t.ADJUST_POINT_DROP="adjustPoint:drop",t.ADJUST_POINT_DRAGEND="adjustPoint:dragend",t.BLANK_MOUSEDOWN="blank:mousedown",t.BLANK_DRAGSTART="blank:dragstart",t.BLANK_DRAG="blank:drag",t.BLANK_DROP="blank:drop",t.BLANK_MOUSEMOVE="blank:mousemove",t.BLANK_CANVAS_MOUSEMOVE="blank:canvas-mousemove",t.BLANK_MOUSEUP="blank:mouseup",t.BLANK_CLICK="blank:click",t.BLANK_CONTEXTMENU="blank:contextmenu",t.SELECTION_MOUSEDOWN="selection:mousedown",t.SELECTION_DRAGSTART="selection:dragstart",t.SELECTION_DRAG="selection:drag",t.SELECTION_DROP="selection:drop",t.SELECTION_MOUSEMOVE="selection:mousemove",t.SELECTION_MOUSEUP="selection:mouseup",t.SELECTION_CONTEXTMENU="selection:contextmenu",t.CONNECTION_NOT_ALLOWED="connection:not-allowed",t.TEXT_MOUSEDOWN="text:mousedown",t.TEXT_DRAGSTART="text:dragstart",t.TEXT_DRAG="text:drag",t.TEXT_DROP="text:drop",t.TEXT_CLICK="text:click",t.TEXT_DBCLICK="text:dbclick",t.TEXT_BLUR="text:blur",t.TEXT_MOUSEMOVE="text:mousemove",t.TEXT_MOUSEUP="text:mouseup",t.TEXT_FOCUS="text:focus",t.TEXT_ADD="text:add",t.TEXT_UPDATE="text:update",t.TEXT_CLEAR="text:clear",t.LABEL_MOUSEDOWN="label:mousedown",t.LABEL_DRAGSTART="label:dragstart",t.LABEL_DRAG="label:drag",t.LABEL_DROP="label:drop",t.LABEL_CLICK="label:click",t.LABEL_DBCLICK="label:dbclick",t.LABEL_BLUR="label:blur",t.LABEL_MOUSEMOVE="label:mousemove",t.LABEL_MOUSEUP="label:mouseup",t.LABEL_FOCUS="label:focus",t.LABEL_ADD="label:add",t.LABEL_UPDATE="label:update",t.LABEL_CLEAR="label:clear",t.LABEL_DELETE="label:delete",t.LABEL_SHOULD_ADD="label:should-add",t.LABEL_BATCH_ADD="label:batch-add",t.LABEL_SHOULD_UPDATE="label:should-update",t.LABEL_SHOULD_DELETE="label:should-delete",t.LABEL_BATCH_DELETE="label:batch-delete",t.LABEL_NOT_ALLOWED_ADD="label:not-allowed-add",t.HISTORY_CHANGE="history:change",t.GRAPH_TRANSFORM="graph:transform",t.GRAPH_RENDERED="graph:rendered",t.GRAPH_UPDATED="graph:updated",t.EDIT_CONFIG_CHANGED="editConfig:changed"}(st||(st={})),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.INCREASE=1]="INCREASE"}(lt||(lt={})),function(t){t.HORIZONTAL="horizontal",t.VERTICAL="vertical"}(dt||(dt={})),function(t){t.TEXT="text",t.LABEL="label"}(pt||(pt={}));var ut=function(){function t(t){var e=t.onDragStart,o=void 0===e?p:e,n=t.onDragging,r=void 0===n?p:n,i=t.onDragEnd,a=void 0===i?p:i,s=t.eventType,l=void 0===s?"":s,d=t.eventCenter,c=t.step,u=void 0===c?1:c,h=t.isStopPropagation,f=void 0===h||h,y=t.model,g=t.data,v=this;this.isDragging=!1,this.isStartDragging=!1,this.startX=0,this.startY=0,this.sumDeltaX=0,this.sumDeltaY=0,this.handleMouseDown=function(t){var e,o,n=null===window||void 0===window?void 0:window.document;if(0===t.button){v.isStopPropagation&&t.stopPropagation(),v.isStartDragging=!0,v.startX=t.clientX,v.startY=t.clientY,n.addEventListener("mousemove",v.handleMouseMove,!1),n.addEventListener("mouseup",v.handleMouseUp,!1);var r=null===(e=v.model)||void 0===e?void 0:e.getData();null===(o=v.eventCenter)||void 0===o||o.emit(st["".concat(v.eventType,"_MOUSEDOWN")],{e:t,data:v.data||r}),v.startTime=(new Date).getTime()}},this.handleMouseMove=function(t){var e,o;if(v.isStopPropagation&&t.stopPropagation(),v.isStartDragging&&(v.sumDeltaX+=t.clientX-v.startX,v.sumDeltaY+=t.clientY-v.startY,v.startX=t.clientX,v.startY=t.clientY,v.step<=1||Math.abs(v.sumDeltaX)>v.step||Math.abs(v.sumDeltaY)>v.step)){var n=v.sumDeltaX%v.step,r=v.sumDeltaY%v.step,i=v.sumDeltaX-n,a=v.sumDeltaY-r;v.sumDeltaX=n,v.sumDeltaY=r;var s=null===(e=v.model)||void 0===e?void 0:e.getData();v.isDragging||(null===(o=v.eventCenter)||void 0===o||o.emit(st["".concat(v.eventType,"_DRAGSTART")],{e:t,data:v.data||s}),v.onDragStart({event:t})),v.isDragging=!0,Promise.resolve().then(function(){var e,o;v.onDragging({deltaX:i,deltaY:a,event:t}),null===(e=v.eventCenter)||void 0===e||e.emit(st["".concat(v.eventType,"_MOUSEMOVE")],{deltaX:i,deltaY:a,e:t,data:v.data||s}),null===(o=v.eventCenter)||void 0===o||o.emit(st["".concat(v.eventType,"_DRAG")],{e:t,data:v.data||s})})}},this.handleMouseUp=function(t){var e=window.document;v.isStartDragging=!1,v.isStopPropagation&&t.stopPropagation(),Promise.resolve().then(function(){var o,n,r;e.removeEventListener("mousemove",v.handleMouseMove,!1),e.removeEventListener("mouseup",v.handleMouseUp,!1);var i=null===(o=v.model)||void 0===o?void 0:o.getData();null===(n=v.eventCenter)||void 0===n||n.emit(st["".concat(v.eventType,"_MOUSEUP")],{e:t,data:v.data||i}),v.isDragging&&(v.isDragging=!1,v.onDragEnd({event:t}),null===(r=v.eventCenter)||void 0===r||r.emit(st["".concat(v.eventType,"_DROP")],{e:t,data:v.data||i}))})},this.cancelDrag=function(){var t=null===window||void 0===window?void 0:window.document;t.removeEventListener("mousemove",v.handleMouseMove,!1),t.removeEventListener("mouseup",v.handleMouseUp,!1),v.onDragEnd({event:void 0}),v.isDragging=!1},this.destroy=function(){v.isStartDragging&&v.cancelDrag()},this.onDragStart=o,this.onDragging=r,this.onDragEnd=a,this.step=u,this.isStopPropagation=f,this.eventType=l,this.eventCenter=d,this.model=y,this.data=g}return t.prototype.setStep=function(t){this.step=t},t.prototype.setModel=function(t){this.model=t},t}(),ht=function(t){return t.modelType===at.LINE_EDGE?function(t){var e=t.startPoint,o=t.endPoint,n=(e.x+o.x)/2,r=(e.y+o.y)/2,i=Math.abs(e.x-o.x)+10,a=Math.abs(e.y-o.y)+10;return{x:n-i/2,y:r-a/2,x1:n+i/2,y1:r+a/2}}(t):t.modelType===at.POLYLINE_EDGE?function(t){var e=t.points,o=Xt(e),n=wt(o,8),r=n.x,i=n.y,a=n.width,s=n.height;return{x:r-a/2,y:i-s/2,x1:r+a/2,y1:i+s/2}}(t):t.modelType===at.BEZIER_EDGE?function(t){var e=t.path,o=Ft(e),n=wt(o,8),r=n.x,i=n.y,a=n.width,s=n.height;return{x:r-a/2,y:i-s/2,x1:r+a/2,y1:i+s/2}}(t):void 0},ft=function(t,e,o){var n=t.x,r=t.y,i=e.x,a=e.y,s=o.x,l=o.y,d=(l-a)/(s-i),p=a-d*i;return(n>=i&&n<=s||n<=i&&n>=s)&&(r>=a&&r<=l||r<=a&&r>=l)&&Math.abs(r-d*n-p)<Number.EPSILON},yt=function(t){var e=t.start,o=t.end,n=t.offset,r=t.verticalLength,i=t.type,a={leftX:0,leftY:0,rightX:0,rightY:0},s=Math.atan((o.y-e.y)/(o.x-e.x)),l=Math.atan(n/r),d=Math.sqrt(r*r+n*n);return"start"===i?o.x>=e.x?(a.leftX=e.x+d*Math.sin(s+l),a.leftY=e.y-d*Math.cos(s+l),a.rightX=e.x-d*Math.sin(s-l),a.rightY=e.y+d*Math.cos(s-l)):(a.leftX=e.x-d*Math.sin(s+l),a.leftY=e.y+d*Math.cos(s+l),a.rightX=e.x+d*Math.sin(s-l),a.rightY=e.y-d*Math.cos(s-l)):"end"===i&&(o.x>=e.x?(a.leftX=o.x+d*Math.sin(s-l),a.leftY=o.y-d*Math.cos(s-l),a.rightX=o.x-d*Math.sin(s+l),a.rightY=o.y+d*Math.cos(s+l)):(a.leftX=o.x-d*Math.sin(s-l),a.leftY=o.y+d*Math.cos(s-l),a.rightX=o.x+d*Math.sin(s+l),a.rightY=o.y-d*Math.cos(s+l))),a},gt=function(){return gt=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},gt.apply(this,arguments)},vt=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},mt=function(t,e,o){if(o||2===arguments.length)for(var n,r=0,i=e.length;r<i;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))},xt=function(t){var e=[],o={};return t.forEach(function(t){var e="".concat(t.x,"-").concat(t.y);t.id=e,o[e]=t}),Object.keys(o).forEach(function(t){e.push(o[t])}),e},bt=function(t,e){return 0===t.width&&0===t.height?t:{x:t.x,y:t.y,centerX:t.centerX,centerY:t.centerY,minX:t.minX-e,minY:t.minY-e,maxX:t.maxX+e,maxY:t.maxY+e,height:t.height+2*e,width:t.width+2*e}},Et=function(t,e,o){var n=function(t,e){var o=Math.abs(t.x-e.centerX),n=Math.abs(t.y-e.centerY);return o/e.width>n/e.height?dt.HORIZONTAL:dt.VERTICAL}(o,e);return n===dt.HORIZONTAL?{x:o.x>t.centerX?t.maxX:t.minX,y:o.y}:{x:o.x,y:o.y>t.centerY?t.maxY:t.minY}},Mt=function(t,e){var o=Math.min(t.minX,e.minX),n=Math.min(t.minY,e.minY),r=Math.max(t.maxX,e.maxX),i=Math.max(t.maxY,e.maxY);return{x:(o+r)/2,y:(n+i)/2,centerX:(o+r)/2,centerY:(n+i)/2,minX:o,minY:n,maxX:r,maxY:i,height:i-n,width:r-o}},wt=function(t,e){void 0===t&&(t=[]);var o=[],n=[];t.forEach(function(t){o.push(t.x),n.push(t.y)});var r=Math.min.apply(Math,mt([],vt(o),!1)),i=Math.max.apply(Math,mt([],vt(o),!1)),a=Math.min.apply(Math,mt([],vt(n),!1)),s=Math.max.apply(Math,mt([],vt(n),!1)),l=i-r,d=s-a;return e&&(l+=e,d+=e),{centerX:(r+i)/2,centerY:(a+s)/2,maxX:i,maxY:s,minX:r,minY:a,x:(r+i)/2,y:(a+s)/2,height:d,width:l}},Ot=function(t){var e=t.minX,o=t.minY,n=t.maxX,r=t.maxY;return[{x:e,y:o},{x:n,y:o},{x:n,y:r},{x:e,y:r}]},_t=function(t,e){var o=t.x,n=t.y;return o<e.minX||o>e.maxX||n<e.minY||n>e.maxY},St=function(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},Tt=function(t,e,o,n,r){return St(t,e)+St(t,o)+function(t,e){var o=0;return e.forEach(function(e){e&&(t.x===e.x&&(o+=-2),t.y===e.y&&(o+=-2))}),o}(t,[e,o,n,r])},Pt=function(t,e,o,n,r){r||(r=0),t.unshift(e[n]),o[n]&&o[n]!==n&&r<=100&&Pt(t,e,o,o[n],r+1)},At=function(t,e,o,n){var r=e.x-t.x,i=e.y-t.y,a=n.x-o.x,s=n.y-o.y,l=(-i*(t.x-o.x)+r*(t.y-o.y))/(-a*i+r*s),d=(a*(t.y-o.y)-s*(t.x-o.x))/(-a*i+r*s);return l>=0&&l<=1&&d>=0&&d<=1},Nt=function(t,e,o){if(0===o.width&&0===o.height)return!1;var n=vt(Ot(o),4),r=n[0],i=n[1],a=n[2],s=n[3];return At(t,e,r,i)||At(t,e,r,s)||At(t,e,i,a)||At(t,e,a,s)},Dt=function(t,e,o,n,r,i,a){var s=[],l=[e],d={},p={},c={};e.id&&(p[e.id]=0,c[e.id]=Tt(e,o,e));var u={};t.forEach(function(t){t.id&&(u[t.id]=t)});for(var h=function(){var h,f,y,g,v=1/0;if(l.forEach(function(t){t.id&&c[t.id]<v&&(v=c[t.id],h=t)}),h===o&&o.id){var m=[];return Pt(m,u,d,o.id),{value:m}}if(!h)return{value:[e,o]};y=h,(g=(f=l).indexOf(y))>-1&&f.splice(g,1),s.push(h),function(t,e,o,n){var r=[];return t.forEach(function(t){t!==e&&(t.x!==e.x&&t.y!==e.y||Nt(t,e,o)||Nt(t,e,n)||r.push(t))}),xt(r)}(t,h,n,r).forEach(function(t){if(-1===s.indexOf(t)&&(-1===l.indexOf(t)&&l.push(t),(null==h?void 0:h.id)&&(null==t?void 0:t.id))){var n=c[h.id]+St(h,t);if(p[t.id]&&n>=p[t.id])return;d[t.id]=h.id,p[t.id]=n,c[t.id]=p[t.id]+Tt(t,o,e,i,a)}})};l.length;){var f=h();if("object"==typeof f)return f.value}return[e,o]},Ct=function(t){return Me(t)},jt=function(t){for(var e=1;e<t.length-1;){var o=t[e-1],n=t[e],r=t[e+1];o.x===n.x&&n.x===r.x||o.y===n.y&&n.y===r.y?t.splice(e,1):e++}return t},Lt=function(t,e,o,n,r){var i,a,s=Ct(o),l=Ct(n),d=bt(s,r),p=bt(l,r),c=Et(d,s,t),u=Et(p,l,e);if(i=d,a=p,2*Math.abs(i.centerX-a.centerX)<i.width+a.width&&2*Math.abs(i.centerY-a.centerY)<i.height+a.height){var h=zt(t,e,c,u);return mt(mt([t,c],vt(h),!1),[u,e],!1)}var f=wt([c,u]),y=Mt(d,f),g=Mt(p,f),v=[];v=(v=v.concat(Ot(y))).concat(Ot(g));var m={x:(t.x+e.x)/2,y:(t.y+e.y)/2};[f,y,g].forEach(function(t){v=v.concat(function(t,e){return mt(mt([],vt(function(t,e){return e<t.minX||e>t.maxX?[]:[{x:e,y:t.minY},{x:e,y:t.maxY}]}(t,e.x)),!1),vt(function(t,e){return e<t.minY||e>t.maxY?[]:[{x:t.minX,y:e},{x:t.maxX,y:e}]}(t,e.y)),!1)}(t,m).filter(function(t){return _t(t,d)&&_t(t,p)}))}),[{x:c.x,y:u.y},{x:u.x,y:c.y}].forEach(function(t){_t(t,d)&&_t(t,p)&&v.push(t)}),v.unshift(c),v.push(u),v=xt(v);var x=Dt(v,c,u,s,l,t,e);return x.unshift(t),x.push(e),x.length>2&&(x=jt(x)),xt(x)},It=function(t,e,o){var n=be(t,o),r=be(e,o);return n&&r},Rt=function(t,e,o){var n=be(t,o),r=be(e,o);return!(n&&r)&&(n||r)},kt=function(t,e,o){for(var n=void 0,r=Me(o),i=Ot(r),a=0;a<i.length;a++){At(t,e,i[a],i[(a+1)%i.length])&&(n=[i[a],i[(a+1)%i.length]])}if(n)return function(t,e,o,n){var r=(e.y-t.y)*(n.x-o.x)-(t.x-e.x)*(o.y-n.y);if(0===r)return!1;var i=((e.x-t.x)*(n.x-o.x)*(o.y-t.y)+(e.y-t.y)*(n.x-o.x)*t.x-(n.y-o.y)*(e.x-t.x)*o.x)/r,a=-((e.y-t.y)*(n.y-o.y)*(o.x-t.x)+(e.x-t.x)*(n.y-o.y)*t.y-(n.x-o.x)*(e.y-t.y)*o.y)/r;return(i-t.x)*(i-e.x)<=0&&(a-t.y)*(a-e.y)<=0&&(i-o.x)*(i-n.x)<=0&&(a-o.y)*(a-n.y)<=0&&{x:i,y:a}}(t,e,n[0],n[1])},Bt=function(t,e){var o=void 0;return t.x===e.x?o=dt.VERTICAL:t.y===e.y&&(o=dt.HORIZONTAL),o},Xt=function(t){var e=t.split(" "),o=[];return e&&e.forEach(function(t){var e=vt(t.split(","),2),n=e[0],r=e[1];o.push({x:Number(n),y:Number(r)})}),o},zt=function(t,e,o,n){var r=[];if(Bt(t,o)===Bt(e,n))t.y===o.y?(r.push({x:o.x,y:(o.y+n.y)/2}),r.push({x:n.x,y:(o.y+n.y)/2})):(r.push({x:(o.x+n.x)/2,y:o.y}),r.push({x:(o.x+n.x)/2,y:n.y}));else{var i={x:o.x,y:n.y},a=ft(i,t,o),s=ft(i,e,n);if(a||s)i={x:n.x,y:o.y};else{var l=Ht(i,t,o),d=Ht(i,e,n);l&&d&&(i={x:n.x,y:o.y})}r.push(i)}return r},Ht=function(t,e,o){return t.x===e.x&&t.x===o.x||t.y===e.y&&t.y===o.y},Gt=function(t){if(!t)return 0;for(var e=0,o=0;o<t.length;o++){var n=t.charCodeAt(o);t.match(/[A-Z]/)?e+=1.5:e+=n>=1&&n<=126||n>=65376&&n<=65439?1:2}return e},Yt=function(t){var e=t.start,o=t.end,n=t.sourceNode,r=t.targetNode,i=t.offset,a=Me(n),s=Me(r),l=bt(a,i),d=bt(s,i);return{sNext:Et(l,a,e),ePre:Et(d,s,o)}},Ft=function(t){var e=t.replace(/M/g,"").replace(/C/g,",").split(",");return[Wt(e[0]),Wt(e[1]),Wt(e[2]),Wt(e[3])]},Wt=function(t){var e=vt(t.replace(/(^\s*)/g,"").split(" "),2);return{x:+e[0],y:+e[1]}},Ut=function(t,e){var o=vt(t,4),n=function(t,e,o,n,r){var i=function(r){if(r<0||r>1)throw new RangeError('The value range of parameter "t" is [0,1]');return{x:t.x*Math.pow(1-r,3)+3*e.x*r*Math.pow(1-r,2)+3*o.x*Math.pow(r,2)*(1-r)+n.x*Math.pow(r,3),y:t.y*Math.pow(1-r,3)+3*e.y*r*Math.pow(1-r,2)+3*o.y*Math.pow(r,2)*(1-r)+n.y*Math.pow(r,3)}},a=0,s=2,l=n.x,d=n.y,p=n;for(;a<r&&s<50;){var c=(p=i(1-s/vo)).x,u=p.y;a=xe(l,d,c,u),s++}return p}(o[0],o[1],o[2],o[3],e);return[n,t[3]]},Vt=function(t,e){for(var o,n=t.x,r=t.y,i=Xt(e),a=Number.MAX_SAFE_INTEGER,s=[],l=0;l<i.length;l++)s.push({start:i[l],end:i[(l+1)%i.length]});if(s.forEach(function(t){var e=t.start,i=t.end;if(e.x===i.x){var s={x:e.x,y:r};if(ft(s,e,i))(l=Math.abs(e.x-n))<a&&(a=l,o=s)}else if(e.y===i.y){var l;s={x:n,y:e.y};if(ft(s,e,i))(l=Math.abs(e.y-r))<a&&(a=l,o=s)}}),!o){var d=s[0],p=d.start,c=d.end;o={x:p.x+(c.x-p.x)/2,y:p.y+(c.y-p.y)/2}}return o},Zt=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))};var Kt=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},qt=function(t,e,o){if(o||2===arguments.length)for(var n,r=0,i=e.length;r<i;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))};function Jt(t,e,o){return o&&e*Math.round(t/e)||t}var $t,Qt=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},te=function(t,e,o){var n=Qt(t,2),r=n[0],i=n[1],a=Qt(e,2),s=a[0],l=a[1],d=Qt(o,2),p=d[0],c=d[1];return r>s&&r<p&&i>l&&i<c},ee=function(t,e){var o=!1;switch(e.multipleSelectKey){case"meta":o=t.metaKey;break;case"alt":o=t.altKey;break;case"shift":o=t.shiftKey;break;case"ctrl":o=t.ctrlKey;break;default:o=!1}return o},oe=($t=function(t,e){return $t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},$t(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}$t(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});function ne(t,e){return!!(t instanceof ie&&e instanceof ie)}var re=function(t){function e(o,n,r){var i=t.call(this,3)||this;return i[0]=o,i[1]=n,i[2]=r,i.x=o,i.y=n,i.z=r,Object.setPrototypeOf(i,e.prototype),i}return oe(e,t),e.prototype.add=function(t){if(ne(this,t))return new ie(this.x+t.x,this.y+t.y);var e=this.z+t.z;return new ae((this.x+t.x)/e,(this.y+t.y)/e)},e.prototype.subtract=function(t){if(ne(this,t))return new ie(this.x-t.x,this.y-t.y);var e=this.z-t.z;return 0===e?new ie(this.x-t.x,this.y-t.y):new ae((this.x-t.x)/e,(this.y-t.y)/e)},e}(Array),ie=function(t){function e(o,n,r){var i=t.call(this,o,n,null!=r?r:0)||this;return Object.setPrototypeOf(i,e.prototype),i}return oe(e,t),e.prototype.toString=function(){return"Vector"},e.prototype.dot=function(t){var e=this;return t.reduce(function(t,o,n){return t+o*e[n]})},e.prototype.cross=function(t){return new e(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},e.prototype.getLength=function(){return Math.hypot(this.x,this.y)},e.prototype.normalize=function(){var t=this.getLength();return new e(this.x/t,this.y/t)},e.prototype.crossZ=function(t){return this.x*t.y-this.y*t.x},e.prototype.angle=function(t){var e=this.crossZ(t),o=Math.acos(this.normalize().dot(t.normalize()));return e>=0?o:-o},e}(re),ae=function(t){function e(o,n){var r=t.call(this,o,n,1)||this;return Object.setPrototypeOf(r,e.prototype),r}return oe(e,t),e.prototype.toString=function(){return"Point"},e}(re),se=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),le=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},de=function(t,e,o){if(o||2===arguments.length)for(var n,r=0,i=e.length;r<i;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))},pe=function(t){function e(){for(var o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];var r=t.call(this,o.length)||this;return r.fill(new Array(3)),o.forEach(function(t,e){r[e]=t}),r.columns=o[0].length,r.rows=o.length,Object.setPrototypeOf(r,e.prototype),r}return se(e,t),e.prototype.getRow=function(t){return this[t]},e.prototype.getColumn=function(t){return de([],le(this.map(function(e){return e[t]})),!1)},e.prototype.transpose=function(){for(var t=[],o=0;o<this.columns;o++)t.push(this.getColumn(o));return new(e.bind.apply(e,de([void 0],le(t),!1)))},e.prototype.cross=function(t){var o=new Array(this.rows).fill("").map(function(){return[]});if(this.columns===t.rows)for(var n=0;n<this.rows;n++)for(var r=this.getRow(n),i=function(e){var i=t.getColumn(e);o[n][e]=r.reduce(function(t,e,o){return t+e*i[o]},0)},a=0;a<t.columns;a++)i(a);return new(e.bind.apply(e,de([void 0],le(o),!1)))},e.prototype.to2D=function(){return this.map(function(t){return[t[0],t[1]]})},e.prototype.toPoints=function(){return this.map(function(t){return new ae(t[0],t[1])})},e.prototype.toString=function(){var t=le(this[0],2),e=t[0],o=t[1],n=le(this[1],2),r=n[0],i=n[1],a=le(this[2],2),s=a[0],l=a[1];return"matrix(".concat(e," ").concat(o," ").concat(r," ").concat(i," ").concat(s," ").concat(l,")")},e.prototype.translate=function(t,e){return this.cross(new he(t,e))},e.prototype.rotate=function(t){return this.cross(new ce(t))},e.prototype.scale=function(t,e){return this.cross(new ue(t,e))},e}(Array),ce=function(t){function e(o){var n=t.call(this,new ie(+Math.cos(o).toFixed(2),+Math.sin(o).toFixed(2),0),new ie(-Math.sin(o).toFixed(2),+Math.cos(o).toFixed(2),0),new ie(0,0,1))||this;return Object.setPrototypeOf(n,e.prototype),n}return se(e,t),e.prototype.inverse=function(){return this.transpose()},e}(pe),ue=function(t){function e(o,n){var r=t.call(this,new ie(o,0,0),new ie(0,n,0),new ie(0,0,1))||this;return r.sx=o,r.sy=n,Object.setPrototypeOf(r,e.prototype),r}return se(e,t),e.prototype.inverse=function(){return new e(1/this.sx,1/this.sy)},e}(pe),he=function(t){function e(o,n){var r=t.call(this,new ie(1,0,0),new ie(0,1,0),new ie(o,n,1))||this;return r.tx=o,r.ty=n,Object.setPrototypeOf(r,e.prototype),r}return se(e,t),e.prototype.inverse=function(){return new e(-this.tx,-this.ty)},e}(pe);I({});var fe=function(){return fe=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},fe.apply(this,arguments)},ye=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},ge=function(t){return t.anchors},ve=function(t,e){for(var o,n=e.nodes,r=n.length-1;r>=0;r--){var i=n[r];if(Ee(t,i)){var a=i.getTargetAnchor(t);if(a){var s={node:i,anchorIndex:a.index,anchor:a.anchor};o&&!me(i,o.node,e)||(o=s)}}}return o},me=function(t,e,o){return t.zIndex>e.zIndex||o.nodesMap[t.id].index>o.nodesMap[e.id].index},xe=function(t,e,o,n){return Math.hypot(t-o,e-n)},be=function(t,e,o){void 0===o&&(o=0);var n=!1,r=Me(e),i=ye(new pe([t.x,t.y,1]).translate(-e.x,-e.y).rotate(-e.rotate).translate(e.x,e.y)[0],2),a=i[0],s=i[1];return a>=r.minX-o&&a<=r.maxX+o&&s>=r.minY-o&&s<=r.maxY+o&&(n=!0),n},Ee=function(t,e){return be(t,e,5)},Me=function(t){var e=t.x,o=t.y,n=t.width,r=t.height;return{minX:e-n/2,minY:o-r/2,maxX:e+n/2,maxY:o+r/2,x:e,y:o,width:n,height:r,centerX:e,centerY:o}},we=function(t,e,o){var n,r=function(t){var e=t,o=e.x,n=e.y,r=e.width,i=e.height,a=e.radius;return[{x:o-r/2+a,y:n-i/2+a,r:a},{x:o+r/2-a,y:n-i/2+a,r:a},{x:o-r/2+a,y:n+i/2-a,r:a},{x:o+r/2-a,y:n+i/2-a,r:a}]}(o),i=Number.MAX_SAFE_INTEGER;return r.forEach(function(e){var o=xe(t.x,t.y,e.x,e.y);o<i&&(i=o,n=e)}),Oe(t,e,n)},Oe=function(t,e,o){var n,r=o.x,i=o.y,a=o.r;if(e===dt.HORIZONTAL){var s=r-Math.sqrt(a*a-(t.y-i)*(t.y-i)),l=r+Math.sqrt(a*a-(t.y-i)*(t.y-i));n={x:Math.abs(s-t.x)<Math.abs(l-t.x)?s:l,y:t.y}}else if(e===dt.VERTICAL){var d=i-Math.sqrt(a*a-(t.x-r)*(t.x-r)),p=i+Math.sqrt(a*a-(t.x-r)*(t.x-r)),c=Math.abs(d-t.y)<Math.abs(p-t.y)?d:p;n={x:t.x,y:c}}return n},_e=function(t,e){var o=e,n=!1,r=o.x,i=o.y,a=o.width,s=o.height,l=o.radius,d=r-a/2+l,p=r+a/2-l,c=i-s/2+l,u=i+s/2-l;return t.y===i+s/2||t.y===i-s/2?n=t.x>d&&t.x<p:t.x!==r+a/2&&t.x!==r-a/2||(n=t.y>c&&t.y<u),n},Se=function(t,e,o){var n,r=o,i=r.x,a=r.y,s=r.rx,l=r.ry;if(e===dt.HORIZONTAL){var d=i-Math.sqrt(s*s-(t.y-a)*(t.y-a)*s*s/(l*l)),p=i+Math.sqrt(s*s-(t.y-a)*(t.y-a)*s*s/(l*l));n={x:Math.abs(d-t.x)<Math.abs(p-t.x)?d:p,y:t.y}}else if(e===dt.VERTICAL){var c=a-Math.sqrt(l*l-(t.x-i)*(t.x-i)*l*l/(s*s)),u=a+Math.sqrt(l*l-(t.x-i)*(t.x-i)*l*l/(s*s)),h=Math.abs(c-t.y)<Math.abs(u-t.y)?c:u;n={x:t.x,y:h}}return n},Te=function(t,e,o){for(var n,r=o.pointsPosition,i=Number.MAX_SAFE_INTEGER,a=[],s=0;s<r.length;s++)a.push({start:r[s],end:r[(s+1)%r.length]});return a.forEach(function(o){var r=o.start,a=o.end,s=r,l=a;r.x>a.x&&(s=a,l=r);var d={x:t.x,y:t.y};if(s.x===l.x&&e===dt.HORIZONTAL&&(d={x:s.x,y:t.y}),s.y===l.y&&e===dt.VERTICAL&&(d={x:t.x,y:s.y}),s.x!==l.x&&s.y!==l.y){var p=(l.y-s.y)/(l.x-s.x),c=(s.x*l.y-l.x*s.y)/(s.x-l.x);e===dt.HORIZONTAL?d={x:(t.y-c)/p,y:t.y}:e===dt.VERTICAL&&(d={x:t.x,y:p*t.x+c})}if(ft(d,r,a)){var u=xe(d.x,d.y,t.x,t.y);u<i&&(i=u,n=d)}}),n},Pe=function(t,e,o,n){var r=t.x,i=t.y;return e.x>t.x?r=t.x+o/2:e.x<t.x&&(r=t.x-o/2),e.y>t.y?i=t.y+n/2:e.y<t.y&&(i=t.y-n/2),{x:r,y:i}},Ae=function(t){var e=t.rows,o=t.style,n=t.rowsLength,r=t.className,i=document.createElement("div");i.className=r,i.style.fontSize="".concat(o.fontSize),i.style.width="".concat(o.width),i.style.lineHeight="".concat(o.lineHeight),i.style.padding="".concat(o.padding),o.fontFamily&&(i.style.fontFamily="".concat(o.fontFamily)),n>1?e.forEach(function(t){var e=document.createElement("div");e.textContent=t,i.appendChild(e)}):i.textContent=e[0],document.body.appendChild(i);var a=i.clientHeight;return document.body.removeChild(i),a},Ne=function(t){var e=t.rows,o=t.rowsLength,n=t.fontSize,r=0;return e&&e.forEach(function(t){var e=Gt(t);r=e>r?e:r}),{width:Math.ceil(r/2)*n+n/4,height:o*(n+2)+n/4}},De=function(t){return"object"!=typeof t?{isAllPass:!!t,msg:t?"":"不允许连接"}:t},Ce=function(){return Y()},je=new Map,Le=function(t){var e=Ce();var o=window.requestAnimationFrame(function o(){if(t(),je.get(e)){var n=window.requestAnimationFrame(o);je.set(e,n)}});return je.set(e,o),e},Ie=function(t){var e=je.get(t);e&&(window.cancelAnimationFrame(e),je.delete(t))},Re=function(){return Re=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Re.apply(this,arguments)},ke=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a};function Be(t){var o=t.x,n=void 0===o?0:o,r=t.y,i=void 0===r?0:r,a=t.value,s=t.fontSize,l=void 0===s?12:s,d=t.fill,p=void 0===d?"currentColor":d,c=t.overflowMode,f=void 0===c?"default":c,y=t.textWidth,g=void 0===y?void 0:y,v=t.model,m={x:n,y:i,fill:p,fontSize:l,textAnchor:"middle",dominantBaseline:"central"};if(u(h(t),function(t){var e=ke(t,2),o=e[0],n=e[1];"object"!=typeof n&&(m[o]=n)}),a){var x=String(a).split(/[\r\n]/g),b=x.length;if("default"!==f){var E=v.BaseType,M=v.modelType;if(E===it.NODE&&M!==at.TEXT_NODE||E===it.EDGE&&g)return function(t){var o=t.x,n=t.y,r=t.value,i=t.model,a=t.textWidth,s=t.fontSize,l=void 0===s?12:s,d=t.lineHeight,p=t.fontFamily,c=void 0===p?"":p,u=t.wrapPadding,h=void 0===u?"0, 0":u,f=t.overflowMode,y=i.width,g=i.height,v=i.textHeight,m=a||y,x=String(r).split(/[\r\n]/g),b=x.length,E=Ae({rows:x,style:{fontSize:"".concat(l,"px"),width:"".concat(m,"px"),fontFamily:c,lineHeight:d,padding:h},rowsLength:b,className:"lf-get-text-height"}),M=g>E?g:E;v&&(M=v);var w="ellipsis"===f;w&&(M=l+2);return e("g",{children:e("foreignObject",{width:m,height:M,x:o-m/2,y:n-M/2,style:{overflow:"visible",textAlign:"left"},children:e("div",{className:"lf-node-text-auto-wrap",style:{minHeight:M,width:m,padding:h},children:e("div",{className:w?"lf-node-text-ellipsis-content":"lf-node-text-auto-wrap-content",title:w?x.join(""):"",style:Re({},t),children:x.map(function(t){return e("div",{className:"lf-node-text--auto-wrap-inner",children:t})})})})})})}(t)}if(b>1){var w=x.map(function(t,o){return e("tspan",{className:"lf-text-tspan",x:n,y:i+(o-(b-1)/2)*(l+2),children:t})});return e("text",Re({},m,{children:w}))}return e("text",Re({},m,{children:a}))}return null}var Xe=function(){return Xe=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Xe.apply(this,arguments)},ze=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a};function He(t){var o={x1:10,y1:10,x2:20,y2:20,stroke:"black"};return u(h(t),function(t){var e=ze(t,2),n=e[0],r=e[1];("style"===n||"object"!=typeof r)&&(o[n]=r)}),e("line",Xe({},o))}var Ge=function(){return Ge=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Ge.apply(this,arguments)},Ye=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a};function Fe(t){var o=t.x,n=t.y,r=t.width,i=t.height,a=t.className,s=t.strokeWidth,l=t.radius,d=void 0===l?0:l,p=o-r/2,c=n-i/2,f={};return f["stroke-width"]=s,u(h(t),function(t){var e=Ye(t,2),o=e[0],n=e[1];"object"!=typeof n&&(f[o]=n)}),f.className=a?"lf-basic-shape ".concat(a):"lf-basic-shape",d&&(f.rx=d,f.ry=d),f.x=p,f.y=c,e("rect",Ge({},f))}var We=function(){return We=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},We.apply(this,arguments)},Ue=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a};function Ve(t){var o={d:""};return u(h(t),function(t){var e=Ue(t,2),n=e[0],r=e[1];"style"!==n&&"object"==typeof r||(o[n]=r)}),e("path",We({},o))}var Ze=function(){return Ze=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Ze.apply(this,arguments)},Ke=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a};function qe(t){var o=t.x,n=void 0===o?0:o,r=t.y,i=void 0===r?0:r,a=t.r,s=void 0===a?4:a,l=t.className,d={cx:n,cy:i,r:s,fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1};return u(h(t),function(t){var e=Ke(t,2),o=e[0],n=e[1];"object"!=typeof n&&(d[o]=n)}),d.className=l?"lf-basic-shape ".concat(l):"lf-basic-shape",e("circle",Ze({},d))}var Je=function(){return Je=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Je.apply(this,arguments)},$e=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a};function Qe(t){var o=t.x,n=void 0===o?0:o,r=t.y,i=void 0===r?0:r,a=t.rx,s=void 0===a?4:a,l=t.ry,d=void 0===l?4:l,p=t.className,c={cx:n,cy:i,rx:s,ry:d,fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1};return u(h(t),function(t){var e=$e(t,2),o=e[0],n=e[1];"object"!=typeof n&&(c[o]=n)}),c.className=p?"lf-basic-shape ".concat(p):"lf-basic-shape",e("ellipse",Je({},c))}var to=function(){return to=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},to.apply(this,arguments)},eo=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a};function oo(t){var o=t.points,n=void 0===o?[]:o,r=t.className,i=t.radius,a={fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1,points:""};if(u(h(t),function(t){var e=eo(t,2),o=e[0],n=e[1];"object"!=typeof n&&(a[o]=n)}),r?a.classNmae="lf-basic-shape ".concat(r):a.className="lf-basic-shape",i){var s=function(t,e){var o=t.map(function(t){return{x:t[0],y:t[1]}}),n=o.length;if(n<3)return"";for(var r=Math.abs(e),i="",a=0;a<n;a++){var s=o[(a-1+n)%n],l=o[a],d=o[(a+1)%n],p={x:l.x-s.x,y:l.y-s.y},c={x:d.x-l.x,y:d.y-l.y},u=Math.hypot(p.x,p.y),h=Math.hypot(c.x,c.y),f={x:p.x/u,y:p.y/u},y={x:c.x/h,y:c.y/h},g={x:l.x-f.x*r,y:l.y-f.y*r},v={x:l.x+y.x*r,y:l.y+y.y*r};i+=0===a?"M ".concat(g.x," ").concat(g.y," "):"L ".concat(g.x," ").concat(g.y," "),i+="Q ".concat(l.x," ").concat(l.y," ").concat(v.x," ").concat(v.y," ")}return i+"Z"}(n,i);return a.d=s,e("path",to({},a))}return a.points=n.map(function(t){return t.join(",")}).join(" "),e("polygon",to({},a))}var no=function(){return no=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},no.apply(this,arguments)},ro=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a};function io(t){var o=t.className,n={points:"",fill:"none"};return u(h(t),function(t){var e=ro(t,2),o=e[0],r=e[1];("style"===o||"object"!=typeof r)&&(n[o]=r)}),o&&(n.className="".concat(o)),e("polyline",no({},n))}var ao,so=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),lo=function(){return lo=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},lo.apply(this,arguments)},po=function(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(o[n[r]]=t[n[r]])}return o},co=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a};!function(t){t[t.LEFT_TOP=0]="LEFT_TOP",t[t.RIGHT_TOP=1]="RIGHT_TOP",t[t.RIGHT_BOTTOM=2]="RIGHT_BOTTOM",t[t.LEFT_BOTTOM=3]="LEFT_BOTTOM"}(ao||(ao={}));var uo=function(t){function o(e){var o=t.call(this)||this;o.isShiftPressed=!1,o.bindKeyboardEvents=function(){document.addEventListener("keydown",o.handleKeyDown),document.addEventListener("keyup",o.handleKeyUp)},o.handleKeyDown=function(t){"Shift"===t.key&&(o.isShiftPressed=!0)},o.handleKeyUp=function(t){"Shift"===t.key&&(o.isShiftPressed=!1)},o.updateEdgePointByAnchors=function(){var t=o.nodeModel,e=t.id,n=t.anchors,r=o.graphModel.getNodeEdges(e);u(r,function(t){if(t.sourceNodeId===e)(o=y(n,function(e){return e.id===t.sourceAnchorId}))&&t.updateStartPoint({x:o.x,y:o.y});else if(t.targetNodeId===e){var o;(o=y(n,function(e){return e.id===t.targetAnchorId}))&&t.updateEndPoint({x:o.x,y:o.y})}})},o.triggerResizeEvent=function(t,e,n,r,i,a){o.graphModel.eventCenter.emit(st.NODE_RESIZE,{preData:t,data:e,deltaX:n,deltaY:r,index:i,model:a})},o.recalcResizeInfo=function(t,e,o,n,r){void 0===o&&(o=1),void 0===n&&(n=!1),void 0===r&&(r=!1);var i=s(e),a=i.deltaX,l=i.deltaY,d=i.width,p=i.height,c=i.PCTResizeInfo;if(c){var u=0,h=0;switch(t){case ao.LEFT_TOP:h=(-1*a-l)/4;break;case ao.RIGHT_TOP:h=(a-l)/4;break;case ao.RIGHT_BOTTOM:h=(a+l)/4;break;case ao.LEFT_BOTTOM:h=(-1*a+l)/4}0!==h&&(u=Math.round(h/c.ResizeBasis.basisHeight*1e5)/1e3),c.ResizePCT.widthPCT=Math.max(Math.min(c.ResizePCT.widthPCT+u,c.ScaleLimit.maxScaleLimit),c.ScaleLimit.minScaleLimit),c.ResizePCT.heightPCT=Math.max(Math.min(c.ResizePCT.heightPCT+u,c.ScaleLimit.maxScaleLimit),c.ScaleLimit.minScaleLimit);var f=Math.round(c.ResizePCT.widthPCT*c.ResizeBasis.basisWidth/100),y=Math.round(c.ResizePCT.heightPCT*c.ResizeBasis.basisHeight/100);switch(t){case ao.LEFT_TOP:a=d-f,l=p-y;break;case ao.RIGHT_TOP:a=f-d,l=p-y;break;case ao.RIGHT_BOTTOM:a=f-d,l=y-p;break;case ao.LEFT_BOTTOM:a=d-f,l=y-p}return i}switch(t){case ao.LEFT_TOP:i.width=n?d:d-a*o,i.height=r?p:p-l*o;break;case ao.RIGHT_TOP:i.width=n?d:d+a*o,i.height=r?p:p-l*o;break;case ao.RIGHT_BOTTOM:i.width=n?d:d+a*o,i.height=r?p:p+l*o;break;case ao.LEFT_BOTTOM:i.width=n?d:d-a*o,i.height=r?p:p+l*o}return i},o.resizeNode=function(t){var e=t.deltaX,n=t.deltaY,r=o.index,i=o.props,a=i.model,s=i.graphModel,l=i.x,d=i.y;go({x:l,y:d,deltaX:e,deltaY:n,index:r,nodeModel:a,graphModel:s,forceProportional:o.isShiftPressed,cancelCallback:function(){o.dragHandler.cancelDrag()}})},o.onDragStart=function(){o.graphModel.selectNodeById(o.nodeModel.id)},o.onDragging=function(t){var e=t.deltaX,n=t.deltaY,r=o.graphModel.transformModel,i=co(r.fixDeltaXY(e,n),2),a=i[0],s=i[1];o.resizeNode({deltaX:a,deltaY:s})},o.onDragEnd=function(){var t=o.nodeModel.x,e=o.nodeModel.y;o.nodeModel.moveTo(t,e),o.updateEdgePointByAnchors()};var n=e.index,r=e.model,i=e.graphModel;return o.index=n,o.nodeModel=r,o.graphModel=i,o.dragHandler=new ut({onDragStart:o.onDragStart,onDragging:o.onDragging,onDragEnd:o.onDragEnd,step:i.gridSize}),o.bindKeyboardEvents(),o}return so(o,t),o.prototype.componentWillUnmount=function(){this.dragHandler.destroy(),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)},o.prototype.render=function(){var t=this.props,o=t.x,n=t.y,r=t.direction,i=t.model.getResizeControlStyle(),a=i.width,s=i.height,l=po(i,["width","height"]);return e("g",{className:"lf-resize-control lf-resize-control-".concat(r),children:[e(Fe,lo({className:"lf-resize-control-content",x:o,y:n,width:null!=a?a:7,height:null!=s?s:7},l)),e(Fe,{className:"lf-resize-control-content",x:o,y:n,width:25,height:25,fill:"transparent",stroke:"transparent",onMouseDown:this.dragHandler.handleMouseDown})]})},o}(o),ho=function(t){function o(){return t.call(this)||this}return so(o,t),o.prototype.getResizeControl=function(){var t=this.props,o=t.model,n=t.graphModel,r=Me(o),i=r.minX,a=r.minY,s=r.maxX,l=r.maxY,d=[{index:ao.LEFT_TOP,direction:"nw",x:i,y:a},{index:ao.RIGHT_TOP,direction:"ne",x:s,y:a},{index:ao.RIGHT_BOTTOM,direction:"se",x:s,y:l},{index:ao.LEFT_BOTTOM,direction:"sw",x:i,y:l}];return f(d,function(t){return e(uo,lo({},t,{model:o,graphModel:n}))})},o.prototype.getResizeOutline=function(){var t=this.props.model,o=t.x,n=t.y,r=t.width,i=t.height,a=t.getResizeOutlineStyle();return e(Fe,lo({},a,{x:o,y:n,width:r,height:i}))},o.prototype.render=function(){return e("g",{className:"lf-resize-control-group",children:[this.getResizeOutline(),this.getResizeControl()]})},o}(o);function fo(t,e,o){var n=function(t){return t*Math.PI/180}(o),r=t.x-e.x,i=t.y-e.y;return{x:r*Math.cos(n)-i*Math.sin(n)+e.x,y:r*Math.sin(n)+i*Math.cos(n)+e.y}}function yo(t,e,o,n,r,i,a,s,l){void 0===s&&(s=!1),void 0===l&&(l=!1);var d=e.deltaX,p=e.deltaY,c=e.width,u=e.height,h=o/Math.PI*180,f={x:i,y:a},y=fo({x:n,y:r},f,h),g=function(t,e,o,n,r,i,a,s){void 0===r&&(r=!1),void 0===i&&(i=!1);var l,d,p,c,u={x:o.x-(t.x-o.x),y:o.y-(t.y-o.y)},h=(d=e,p=(l=u).x,c=l.y,{x:p+(d.x-p)/2,y:c+(d.y-c)/2}),f=fo(e,h,-n),y=fo(u,h,-n);if(r){var g=Math.abs(f.x-y.x)-a;h.x>f.x?h.x=h.x+g/2:h.x=h.x-g/2}if(i){var v=Math.abs(f.y-y.y)-s;h.y>f.y?h.y=h.y+v/2:h.y=h.y-v/2}if(r||i){var m=fo(y,h,n),x=m.x-u.x,b=m.y-u.y;h.x=h.x-x,h.y=h.y-b,y=fo(u,h,-n),f={x:h.x-(y.x-h.x),y:h.y-(y.y-h.y)}}var E=Math.abs(f.x-y.x),M=Math.abs(f.y-y.y);return r&&(E=a),i&&(M=s),{width:E,height:M,center:h}}(y,{x:y.x+d,y:y.y+p},f,h,s,l,c,u),v=g.width,m=g.height,x=g.center;return e.width=v*t,e.height=m*t,e.deltaX=2*(x.x-f.x),e.deltaY=2*(x.y-f.y),e}var go=function(t){var e=t.x,o=t.y,n=t.deltaX,r=t.deltaY,i=t.index,a=t.nodeModel,l=t.graphModel,d=t.cancelCallback,p=t.forceProportional,c=void 0!==p&&p,h=a.r,f=a.rx,g=a.ry,v=a.width,m=a.height,x=a.PCTResizeInfo,b=a.minWidth,E=a.minHeight,M=a.maxWidth,w=a.maxHeight,O=a.rotate,_=b===M,S=E===w,T=e,P=o,A=function(t,e,o,n,r,i,a,l,d,p,c){void 0===o&&(o=1),void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===i&&(i=0),void 0===c&&(c=!1);var u=s(e),h=u.deltaX,f=u.deltaY,y=u.width,g=u.height,v=u.PCTResizeInfo;if(v){var m=0,x=0;switch(t){case ao.LEFT_TOP:x=(-1*h-f)/4;break;case ao.RIGHT_TOP:x=(h-f)/4;break;case ao.RIGHT_BOTTOM:x=(h+f)/4;break;case ao.LEFT_BOTTOM:x=(-1*h+f)/4}0!==x&&(m=Math.round(x/v.ResizeBasis.basisHeight*1e5)/1e3),v.ResizePCT.widthPCT=Math.max(Math.min(v.ResizePCT.widthPCT+m,v.ScaleLimit.maxScaleLimit),v.ScaleLimit.minScaleLimit),v.ResizePCT.heightPCT=Math.max(Math.min(v.ResizePCT.heightPCT+m,v.ScaleLimit.maxScaleLimit),v.ScaleLimit.minScaleLimit);var b=Math.round(v.ResizePCT.widthPCT*v.ResizeBasis.basisWidth/100),E=Math.round(v.ResizePCT.heightPCT*v.ResizeBasis.basisHeight/100);switch(t){case ao.LEFT_TOP:h=y-b,f=g-E;break;case ao.RIGHT_TOP:h=b-y,f=g-E;break;case ao.RIGHT_BOTTOM:h=b-y,f=E-g;break;case ao.LEFT_BOTTOM:h=y-b,f=E-g}return u}if(i%(2*Math.PI)!=0&&void 0!==a&&void 0!==l)return yo(o,u,i,a,l,d,p,n,r);if(c){var M=y/g,w=0,O=y,_=g;switch(t){case ao.LEFT_TOP:w=Math.abs(h)>Math.abs(f)?-h:-f,M>=1?_=(O=y+w)/M:O=(_=g+w)*M,u.width=O,u.height=_,u.deltaX=y-O,u.deltaY=g-_;break;case ao.RIGHT_TOP:w=Math.abs(h)>Math.abs(f)?h:-f,M>=1?_=(O=y+w)/M:O=(_=g-w)*M,u.width=O,u.height=_,u.deltaX=O-y,u.deltaY=g-_;break;case ao.RIGHT_BOTTOM:w=Math.abs(h)>Math.abs(f)?h:f,M>=1?_=(O=y+w)/M:O=(_=g+w)*M,u.width=O,u.height=_,u.deltaX=O-y,u.deltaY=_-g;break;case ao.LEFT_BOTTOM:w=Math.abs(h)>Math.abs(f)?-h:f,M>=1?_=(O=y-w)/M:O=(_=g+w)*M,u.width=O,u.height=_,u.deltaX=y-O,u.deltaY=_-g}return u}switch(t){case ao.LEFT_TOP:u.width=n?y:y-h*o,u.height=r?g:g-f*o;break;case ao.RIGHT_TOP:u.width=n?y:y+h*o,u.height=r?g:g-f*o;break;case ao.RIGHT_BOTTOM:u.width=n?y:y+h*o,u.height=r?g:g+f*o;break;case ao.LEFT_BOTTOM:u.width=n?y:y-h*o,u.height=r?g:g+f*o}return u}(i,{width:h||f||v,height:h||g||m,deltaX:n,deltaY:r,PCTResizeInfo:x},h||f&&g?.5:1,_,S,O,T,P,a.x,a.y,c);if(A.width<b||A.width>M||A.height<E||A.height>w)null==d||d();else{(O%(2*Math.PI)==0||x||void 0===T||void 0===P)&&(A.deltaX=_?0:A.deltaX,A.deltaY=S?0:A.deltaY);var N=a.getData(),D=a.resize(A);N.x===D.x&&N.y===D.y||(function(t,e){var o=t.id,n=t.anchors,r=e.getNodeEdges(o);u(r,function(t){if(t.sourceNodeId===o)(e=y(n,function(e){return e.id===t.sourceAnchorId}))&&t.updateStartPoint({x:e.x,y:e.y});else if(t.targetNodeId===o){var e;(e=y(n,function(e){return e.id===t.targetAnchorId}))&&t.updateEndPoint({x:e.x,y:e.y})}})}(a,l),function(t,e,o,n,r,i,a){a.eventCenter.emit(st.NODE_RESIZE,{preData:t,data:e,deltaX:o,deltaY:n,index:r,model:i})}(N,D,n,r,i,a,l))}},vo=100,mo={x:1,y:0};function xo(t){var e=Math.hypot(t.x,t.y);return{x:t.x/e,y:t.y/e,z:0}}function bo(t){return n=function(t,e){return t.x*e.y-t.y*e.x}(e=mo,o=t),r=Math.acos(function(t,e){var o=[t.x,t.y,t.z];return[e.x,e.y,e.z].reduce(function(t,e,n){return t+e*o[n]})}(xo(e),xo(o))),n>=0?r:-r;var e,o,n,r}var Eo={baseNode:{fill:"#fff",stroke:"#000",strokeWidth:2},baseEdge:{stroke:"#000",strokeWidth:2},rect:{},circle:{},diamond:{},ellipse:{},polygon:{},text:{color:"#000",stroke:"none",fontSize:12,background:{fill:"transparent"}},anchor:{stroke:"#000",fill:"#fff",r:4,hover:{r:10,fill:"#949494",fillOpacity:.5,stroke:"#949494"}},anchorLine:{stroke:"#000",strokeWidth:2,strokeDasharray:"3,2"},nodeText:{color:"#000",overflowMode:"default",fontSize:12,lineHeight:1.2},edgeText:{textWidth:100,overflowMode:"default",fontSize:12,background:{fill:"#fff"}},line:{},polyline:{},bezier:{fill:"none",adjustLine:{stroke:"#949494"},adjustAnchor:{r:4,fill:"#949494",fillOpacity:1,stroke:"#949494"}},arrow:{offset:10,verticalLength:5},snapline:{stroke:"#949494",strokeWidth:1},edgeAdjust:{r:4,fill:"#fff",stroke:"#949494",strokeWidth:2},outline:{fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},edgeAnimation:{stroke:"red",strokeDasharray:"10,10",strokeDashoffset:"100%",animationName:"lf_animate_dash",animationDuration:"20s",animationIterationCount:"infinite",animationTimingFunction:"linear",animationDirection:"normal"},rotateControl:{stroke:"#000",fill:"#fff",strokeWidth:1.5},resizeControl:{width:7,height:7,fill:"#fff",stroke:"#000"},resizeOutline:{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},Mo={colorful:{rect:{fill:"#72CBFF",stroke:"#3ABDF9",radius:8},circle:{fill:"#FFE075",stroke:"#F9CE3A",radius:8},ellipse:{fill:"#FFA8A8",stroke:"#FF6B66",radius:8},text:{fill:"#72CBFF",radius:8},diamond:{fill:"#96F7AF",stroke:"#40EF7E",radius:8},polygon:{fill:"#E0A8FF",stroke:"#C271FF",radius:8},polyline:{radius:8},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},dark:{baseNode:{fill:"#23272e",stroke:"#fefeff"},baseEdge:{stroke:"#fefeff"},rect:{radius:8},diamond:{radius:8},polygon:{radius:8},polyline:{radius:8},nodeText:{color:"#fefeff",overflowMode:"default",fontSize:12,lineHeight:1.2},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},radius:{rect:{radius:8},diamond:{radius:8},polygon:{radius:8},polyline:{radius:8},arrow:{strokeLinecap:"round",strokeLinejoin:"round",offset:10,verticalLength:5},snapline:{strokeLinecap:"round",strokeLinejoin:"round",stroke:"#949494",strokeWidth:1},outline:{radius:8,fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},resizeOutline:{radius:8,fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},default:Eo},wo={background:"#ffffff"},Oo={colorful:{background:"#fefeff"},dark:{background:"#23272e"},radius:wo,default:wo},_o={color:"#acacac",thickness:1},So={colorful:{color:"#dadada",thickness:1},dark:{color:"#66676a",thickness:1},radius:_o,default:_o},To=function(t,e){var o=s(Eo);return e&&(o=l(o,Mo[e])),t&&(o=l(o,t)),o},Po=function(){var t={colorful:{},dark:{},radius:{},default:{}};a(Mo,t),a(Oo,t),a(So,t)},Ao=To,No=1e3,Do=999,Co=function(){return++No},jo=function(){return jo=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},jo.apply(this,arguments)},Lo=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},Io=function(){function t(t,e){var o;this.BaseType=it.EDGE,this.id="",this.type="",this.sourceNodeId="",this.targetNodeId="",this.textMode=pt.TEXT,this.text={value:"",x:0,y:0,draggable:!1,editable:!0},this.points="",this.pointsList=[],this.virtual=!1,this.isSelected=!1,this.isHovered=!1,this.isHitable=!0,this.isHittable=!0,this.draggable=!0,this.visible=!0,this.isAnimation=!1,this.isShowAdjustPoint=!1,this.zIndex=0,this.state=rt.DEFAULT,this.modelType=at.EDGE,this.customTextPosition=!1,this.style={},this.arrowConfig={markerEnd:"url(#marker-end-".concat(this.id,")"),markerStart:"url(#marker-start-".concat(this.id,")")},this.graphModel=e,this.properties=null!==(o=t.properties)&&void 0!==o?o:{},this.initEdgeData(t),this.setAttributes()}return t.prototype.initEdgeData=function(t){if(t.properties||(t.properties={}),!t.id){var e=this.graphModel.idGenerator,o=e&&e(t.type),n=this.createId();t.id=n||o||Ce()}this.arrowConfig.markerEnd="url(#marker-end-".concat(t.id,")"),this.arrowConfig.markerStart="url(#marker-start-".concat(t.id,")");var r=this.graphModel.editConfigModel.adjustEdgeStartAndEnd;this.isShowAdjustPoint=r,a(this,function(t){return c(t,["id","type","sourceNodeId","sourceAnchorId","targetNodeId","targetAnchorId","pointsList","startPoint","endPoint","properties"])}(t)),this.graphModel.overlapMode===lt.INCREASE&&(this.zIndex=t.zIndex||Co()),this.setAnchors(),this.initPoints(),this.formatText(t)},t.prototype.setAttributes=function(){},t.prototype.createId=function(){return null},t.prototype.getEdgeStyle=function(){return jo(jo({},this.graphModel.theme.baseEdge),this.style)},t.prototype.getAdjustPointStyle=function(){return jo({},this.graphModel.theme.edgeAdjust)},t.prototype.getTextStyle=function(){var t=this.graphModel.theme.edgeText;return s(t)},t.prototype.getEdgeAnimationStyle=function(){var t=this.graphModel.theme.edgeAnimation;return s(t)},t.prototype.getArrowStyle=function(){var t=this.getEdgeStyle(),e=this.getEdgeAnimationStyle(),o=this.graphModel.theme.arrow,n=this.isAnimation?e.stroke:t.stroke;return jo(jo(jo({},t),{fill:n,stroke:n}),o)},t.prototype.getOutlineStyle=function(){var t=this.graphModel.theme.outline;return s(t)},t.prototype.getTextPosition=function(){return{x:0,y:0}},Object.defineProperty(t.prototype,"sourceNode",{get:function(){var t,e;return null===(e=null===(t=this.graphModel)||void 0===t?void 0:t.nodesMap[this.sourceNodeId])||void 0===e?void 0:e.model},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"targetNode",{get:function(){var t,e;return null===(e=null===(t=this.graphModel)||void 0===t?void 0:t.nodesMap[this.targetNodeId])||void 0===e?void 0:e.model},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textPosition",{get:function(){return this.getTextPosition()},enumerable:!1,configurable:!0}),t.prototype.getBeginAnchor=function(t,e,o){var n,r,i=ge(t);if(o){if(n=y(i,function(t){return t.id===o}))return n;console.warn("未在节点上找到指定的起点锚点".concat(o,"，已使用默认锚点作为起点"))}return i.forEach(function(t){var o=Zt(t,e);(void 0===r||o<r)&&(r=o,n=t)}),n},t.prototype.getEndAnchor=function(t,e){var o,n,r=this,i=ge(t);if(e){if(o=y(i,function(t){return t.id===e}))return o;console.warn("未在节点上找到指定的终点锚点".concat(e,"，已使用默认锚点作为终点"))}return i.forEach(function(t){if(r.startPoint){var e=Zt(t,r.startPoint);(void 0===n||e<n)&&(n=e,o=t)}}),o},t.prototype.getProperties=function(){return R(this.properties)},t.prototype.getData=function(){var t=this.properties;k(t)&&(t=R(t));var e={id:this.id,type:this.type,properties:t,sourceNodeId:this.sourceNodeId,targetNodeId:this.targetNodeId,sourceAnchorId:this.sourceAnchorId,targetAnchorId:this.targetAnchorId,startPoint:a({},this.startPoint),endPoint:a({},this.endPoint)};this.graphModel.overlapMode===lt.INCREASE&&(e.zIndex=this.zIndex);var o=this.text,n=o.x,r=o.y,i=o.value;return i&&(e.text={x:n,y:r,value:i}),e},t.prototype.getHistoryData=function(){return this.getData()},t.prototype.setProperty=function(t,e){B(this.properties,t,nt(e)),this.setAttributes()},t.prototype.deleteProperty=function(t){delete this.properties[t],this.setAttributes()},t.prototype.setProperties=function(t){this.properties=jo(jo({},R(this.properties)),nt(t)),this.setAttributes()},t.prototype.changeEdgeId=function(t){var e=this.arrowConfig,o=e.markerEnd,n=e.markerStart;n&&n==="url(#marker-start-".concat(this.id,")")&&(this.arrowConfig.markerStart="url(#marker-start-".concat(t,")")),o&&o==="url(#marker-end-".concat(this.id,")")&&(this.arrowConfig.markerEnd="url(#marker-end-".concat(t,")")),this.id=t},t.prototype.setStyle=function(t,e){var o;this.style=jo(jo({},this.style),((o={})[t]=nt(e),o))},t.prototype.setStyles=function(t){this.style=jo(jo({},this.style),nt(t))},t.prototype.updateStyles=function(t){this.style=jo({},nt(t))},t.prototype.setTextMode=function(t){this.textMode=t},t.prototype.formatText=function(t){var e,o,n,r=this.graphModel.editConfigModel,i=r.edgeTextDraggable,a=r.edgeTextEdit,s=this.textPosition,l=s.x,d=s.y,p=t.text,c={value:"",x:l,y:d,draggable:i,editable:a};p&&("string"==typeof p?c=jo(jo({},c),{value:p}):(c=jo(jo({},c),{x:null!==(e=p.x)&&void 0!==e?e:l,y:null!==(o=p.y)&&void 0!==o?o:d,value:null!==(n=p.value)&&void 0!==n?n:""}),g(p.draggable)||(c.draggable=p.draggable),g(p.editable)||(c.editable=p.editable))),this.text=c},t.prototype.resetTextPosition=function(){var t=this.textPosition,e=t.x,o=t.y;this.text.x=e,this.text.y=o},t.prototype.moveText=function(t,e){var o=this.text,n=o.x,r=o.y,i=o.value,a=o.draggable,s=o.editable;this.text={value:i,editable:s,draggable:a,x:n+t,y:r+e}},t.prototype.setText=function(t){t&&a(this.text,t)},t.prototype.updateText=function(t){this.text=jo(jo({},R(this.text)),{value:t})},t.prototype.setAnchors=function(){if(!this.sourceAnchorId||!this.startPoint){if(!(t=this.getBeginAnchor(this.sourceNode,this.targetNode,this.sourceAnchorId)))throw new Error("无法获取beginAnchor，请检查anchors相关逻辑，anchors不能为空");this.startPoint||(this.startPoint={x:t.x,y:t.y}),this.sourceAnchorId||(this.sourceAnchorId=t.id)}if(!this.targetAnchorId||!this.endPoint){var t;if(!(t=this.getEndAnchor(this.targetNode,this.targetAnchorId)))throw new Error("无法获取endAnchor，请检查anchors相关逻辑，anchors不能为空");this.endPoint||(this.endPoint={x:t.x,y:t.y}),this.targetAnchorId||(this.targetAnchorId=t.id)}},t.prototype.setSelected=function(t){void 0===t&&(t=!0),this.isSelected=t},t.prototype.setHovered=function(t){void 0===t&&(t=!0),this.isHovered=t},t.prototype.setHitable=function(t){void 0===t&&(t=!0),this.isHitable=t},t.prototype.setHittable=function(t){void 0===t&&(t=!0),this.isHittable=t},t.prototype.openEdgeAnimation=function(){this.isAnimation=!0},t.prototype.closeEdgeAnimation=function(){this.isAnimation=!1},t.prototype.setElementState=function(t,e){this.state=t,this.additionStateData=e},t.prototype.updateStartPoint=function(t){this.startPoint=t},t.prototype.moveStartPoint=function(t,e){this.startPoint&&(this.startPoint.x+=t,this.startPoint.y+=e)},t.prototype.updateEndPoint=function(t){this.endPoint=t},t.prototype.moveEndPoint=function(t,e){this.endPoint&&(this.endPoint.x+=t,this.endPoint.y+=e)},t.prototype.setZIndex=function(t){void 0===t&&(t=0),this.zIndex=t},t.prototype.initPoints=function(){},t.prototype.updateAttributes=function(t){a(this,t)},t.prototype.getAdjustStart=function(){return this.startPoint},t.prototype.getAdjustEnd=function(){return this.endPoint},t.prototype.updateAfterAdjustStartAndEnd=function(t){var e=t.startPoint,o=t.endPoint;this.updateStartPoint({x:e.x,y:e.y}),this.updateEndPoint({x:o.x,y:o.y})},t.BaseType=it.EDGE,Lo([X],t.prototype,"type",void 0),Lo([X],t.prototype,"sourceNodeId",void 0),Lo([X],t.prototype,"targetNodeId",void 0),Lo([X],t.prototype,"startPoint",void 0),Lo([X],t.prototype,"endPoint",void 0),Lo([X],t.prototype,"textMode",void 0),Lo([X],t.prototype,"text",void 0),Lo([X],t.prototype,"properties",void 0),Lo([X],t.prototype,"points",void 0),Lo([X],t.prototype,"pointsList",void 0),Lo([X],t.prototype,"isSelected",void 0),Lo([X],t.prototype,"isHovered",void 0),Lo([X],t.prototype,"isHitable",void 0),Lo([X],t.prototype,"isHittable",void 0),Lo([X],t.prototype,"draggable",void 0),Lo([X],t.prototype,"visible",void 0),Lo([X],t.prototype,"isAnimation",void 0),Lo([X],t.prototype,"isShowAdjustPoint",void 0),Lo([X],t.prototype,"zIndex",void 0),Lo([X],t.prototype,"state",void 0),Lo([X],t.prototype,"style",void 0),Lo([X],t.prototype,"arrowConfig",void 0),Lo([z],t.prototype,"sourceNode",null),Lo([z],t.prototype,"targetNode",null),Lo([z],t.prototype,"textPosition",null),Lo([H],t.prototype,"setProperty",null),Lo([H],t.prototype,"deleteProperty",null),Lo([H],t.prototype,"setProperties",null),Lo([H],t.prototype,"changeEdgeId",null),Lo([H],t.prototype,"setStyle",null),Lo([H],t.prototype,"setStyles",null),Lo([H],t.prototype,"updateStyles",null),Lo([H],t.prototype,"setTextMode",null),Lo([H],t.prototype,"formatText",null),Lo([H],t.prototype,"resetTextPosition",null),Lo([H],t.prototype,"moveText",null),Lo([H],t.prototype,"setText",null),Lo([H],t.prototype,"updateText",null),Lo([H],t.prototype,"setAnchors",null),Lo([H],t.prototype,"setSelected",null),Lo([H],t.prototype,"setHovered",null),Lo([H],t.prototype,"setHitable",null),Lo([H],t.prototype,"setHittable",null),Lo([H],t.prototype,"openEdgeAnimation",null),Lo([H],t.prototype,"closeEdgeAnimation",null),Lo([H],t.prototype,"setElementState",null),Lo([H],t.prototype,"updateStartPoint",null),Lo([H],t.prototype,"moveStartPoint",null),Lo([H],t.prototype,"updateEndPoint",null),Lo([H],t.prototype,"moveEndPoint",null),Lo([H],t.prototype,"setZIndex",null),Lo([H],t.prototype,"initPoints",null),Lo([H],t.prototype,"updateAttributes",null),Lo([H],t.prototype,"getAdjustStart",null),Lo([H],t.prototype,"getAdjustEnd",null),Lo([H],t.prototype,"updateAfterAdjustStartAndEnd",null),t}(),Ro=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),ko=function(){return ko=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},ko.apply(this,arguments)},Bo=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},Xo=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},zo=function(t){function e(e,o){var n=t.call(this,e,o)||this;return n.modelType=at.BEZIER_EDGE,n.path="",n.initEdgeData(e),n.setAttributes(),n}return Ro(e,t),e.prototype.initEdgeData=function(e){this.offset=d(e,"properties.offset",100),t.prototype.initEdgeData.call(this,e)},e.prototype.getEdgeStyle=function(){var e=this.graphModel.theme.bezier,o=t.prototype.getEdgeStyle.call(this),n=this.properties.style,r=void 0===n?{}:n;return ko(ko(ko({},o),s(e)),s(r))},e.prototype.getTextPosition=function(){if(this.pointsList&&this.pointsList.length>0){var t=0,e=0;return this.pointsList.forEach(function(o){var n=o.x,r=o.y;t+=n,e+=r}),{x:t/this.pointsList.length,y:e/this.pointsList.length}}return{x:(this.startPoint.x+this.endPoint.x)/2,y:(this.startPoint.y+this.endPoint.y)/2}},e.prototype.getData=function(){var e=t.prototype.getData.call(this),o=this.pointsList.map(function(t){return{x:t.x,y:t.y}});return ko(ko({},e),{pointsList:o})},e.prototype.getControls=function(){var t=this.startPoint,e=this.endPoint;return Yt({start:t,end:e,sourceNode:this.sourceNode,targetNode:this.targetNode,offset:this.offset})},e.prototype.getPath=function(t){var e=Xo(t,4),o=e[0],n=e[1],r=e[2],i=e[3];return"M ".concat(o.x," ").concat(o.y,"\n    C ").concat(n.x," ").concat(n.y,",\n    ").concat(r.x," ").concat(r.y,",\n    ").concat(i.x," ").concat(i.y)},e.prototype.initPoints=function(){this.pointsList.length>0?this.path=this.getPath(this.pointsList):this.updatePoints()},e.prototype.updatePoints=function(){var t=this.getControls(),e=t.sNext,o=t.ePre;this.updatePath(e,o)},e.prototype.updatePath=function(t,e){t=s(t),e=s(e);var o={x:this.startPoint.x,y:this.startPoint.y},n={x:this.endPoint.x,y:this.endPoint.y};if(!t||!e){var r=this.getControls();t=r.sNext,e=r.ePre}this.pointsList=[o,t,e,n],this.path=this.getPath(this.pointsList)},e.prototype.updateStartPoint=function(t){this.startPoint=Object.assign({},t),this.updatePoints()},e.prototype.updateEndPoint=function(t){this.endPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveStartPoint=function(t,e){this.startPoint.x+=t,this.startPoint.y+=e;var o=Xo(this.pointsList,3),n=o[1],r=o[2];n.x+=t,n.y+=e,this.updatePath(n,r)},e.prototype.moveEndPoint=function(t,e){this.endPoint.x+=t,this.endPoint.y+=e;var o=Xo(this.pointsList,3),n=o[1],r=o[2];r.x+=t,r.y+=e,this.updatePath(n,r)},e.prototype.updateAdjustAnchor=function(t,e){var o;"sNext"===e?this.pointsList[1]=t:"ePre"===e&&(this.pointsList[2]=t),this.path=this.getPath(this.pointsList),(null===(o=this.text)||void 0===o?void 0:o.value)&&this.setText(a({},this.text,this.textPosition))},e.prototype.getAdjustStart=function(){return this.pointsList[0]||this.startPoint},e.prototype.getAdjustEnd=function(){var t=this.pointsList;return t[t.length-1]||this.endPoint},e.prototype.updateAfterAdjustStartAndEnd=function(t){var e=t.startPoint,o=t.endPoint,n=t.sourceNode,r=t.targetNode,i=Yt({start:e,end:o,sourceNode:n,targetNode:r,offset:this.offset}),a=i.sNext,s=i.ePre;this.pointsList=[e,a,s,o],this.initPoints()},Bo([X],e.prototype,"offset",void 0),Bo([X],e.prototype,"path",void 0),Bo([H],e.prototype,"initPoints",null),Bo([H],e.prototype,"updatePoints",null),Bo([H],e.prototype,"updateStartPoint",null),Bo([H],e.prototype,"updateEndPoint",null),Bo([H],e.prototype,"moveStartPoint",null),Bo([H],e.prototype,"moveEndPoint",null),Bo([H],e.prototype,"updateAdjustAnchor",null),Bo([H],e.prototype,"getAdjustStart",null),Bo([H],e.prototype,"getAdjustEnd",null),Bo([H],e.prototype,"updateAfterAdjustStartAndEnd",null),e}(Io),Ho=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Go=function(){return Go=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Go.apply(this,arguments)},Yo=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},Fo=function(t,e,o){if(o||2===arguments.length)for(var n,r=0,i=e.length;r<i;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))},Wo=function(t){function e(){var e=t.apply(this,Fo([],Yo(arguments),!1))||this;return e.modelType=at.LINE_EDGE,e}return Ho(e,t),e.prototype.getEdgeStyle=function(){var e=this.graphModel.theme.line,o=t.prototype.getEdgeStyle.call(this),n=this.properties.style,r=void 0===n?{}:n;return Go(Go(Go({},o),s(e)),s(r))},e.prototype.initEdgeData=function(e){t.prototype.initEdgeData.call(this,e),this.points=this.getPath([this.startPoint,this.endPoint])},e.prototype.getPath=function(t){var e=Yo(t,2),o=e[0],n=e[1];return"".concat(o.x,",").concat(o.y," ").concat(n.x,",").concat(n.y)},e.prototype.getTextPosition=function(){return{x:(this.startPoint.x+this.endPoint.x)/2,y:(this.startPoint.y+this.endPoint.y)/2}},e}(Io),Uo=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Vo=function(){return Vo=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Vo.apply(this,arguments)},Zo=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},Ko=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},qo=function(t,e,o){if(o||2===arguments.length)for(var n,r=0,i=e.length;r<i;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))},Jo=function(t){function e(){var e=t.apply(this,qo([],Ko(arguments),!1))||this;return e.modelType=at.POLYLINE_EDGE,e.draggingPointList=[],e}return Uo(e,t),e.prototype.initEdgeData=function(e){this.offset=d(e,"properties.offset",30),e.pointsList&&(this.pointsList=e.pointsList),t.prototype.initEdgeData.call(this,e)},e.prototype.getEdgeStyle=function(){var e=this.graphModel.theme.polyline,o=t.prototype.getEdgeStyle.call(this),n=this.properties.style,r=void 0===n?{}:n;return Vo(Vo(Vo({},o),s(e)),s(r))},e.prototype.getTextPosition=function(){var t,e=null===(t=this.text)||void 0===t?void 0:t.value;if(this.dbClickPosition&&!e){var o=this.dbClickPosition;return{x:o.x,y:o.y}}var n=Xt(this.points),r=Ko(function(t){if(1===t.length){var e=vt(t,1)[0];return[e,e]}for(var o=t[0],n=t[1],r=xe(o.x,o.y,n.x,n.y),i=1;i<t.length-1;i++){var a=t[i],s=t[i+1],l=xe(a.x,a.y,s.x,s.y);l>r&&(r=l,o=a,n=s)}return[o,n]}(n),2),i=r[0],a=r[1];return{x:(i.x+a.x)/2,y:(i.y+a.y)/2}},e.prototype.getAfterAnchor=function(t,e,o){var n,r;return o.forEach(function(o){var i;t===dt.HORIZONTAL?i=Math.abs(e.y-o.y):t===dt.VERTICAL&&(i=Math.abs(e.x-o.x)),(!r||r>i)&&(r=i,n=o)}),n},e.prototype.getCrossPoint=function(t,e,o){var n;return t===dt.HORIZONTAL?n={x:o.x,y:e.y}:t===dt.VERTICAL&&(n={x:e.x,y:o.y}),n},e.prototype.removeCrossPoints=function(t,e,o){var n=o.map(function(t){return t});if(1===t){var r=n[t],i=n[e],a=n[t-1];if(It(a,r,this.sourceNode)){if(Rt(r,i,this.sourceNode))(s=kt(r,i,this.sourceNode))&&(n[t]=s,n.splice(t-1,1),t--,e--)}else this.sourceNode.anchors.forEach(function(e){(e.x===a.x&&e.x===r.x||e.y===a.y&&e.y===r.y)&&(xe(e.x,e.y,r.x,r.y)<xe(a.x,a.y,r.x,r.y)&&(n[t-1]=e))})}if(e===o.length-2){var s,l=n[t],d=n[e],p=n[e+1];if(It(d,p,this.targetNode)){if(Rt(l,d,this.targetNode))(s=kt(l,d,this.targetNode))&&(n[e]=s,n.splice(e+1,1))}else this.targetNode.anchors.forEach(function(t){(t.x===p.x&&t.x===d.x||t.y===p.y&&t.y===d.y)&&(xe(t.x,t.y,d.x,d.y)<xe(p.x,p.y,d.x,d.y)&&(n[e+1]=t))})}return n},e.prototype.getDraggingPoints=function(t,e,o,n,r){var i=r.map(function(t){return t}),a=this.getAfterAnchor(t,o,n),s=this.getCrossPoint(t,o,a);return"start"===e?(i.unshift(s),i.unshift(a)):(i.push(s),i.push(a)),i},e.prototype.updateCrossPoints=function(t){var e=t.map(function(t){return t}),o=t[0],n=t[1],r=t[e.length-2],i=t[e.length-1],a=this.sourceNode,s=this.targetNode,l=a.modelType,d=s.modelType,p=Bt(o,n),c=e[0];switch(l){case at.RECT_NODE:if(0!==a.radius)_e(o,a)||(c=we(o,p,a));break;case at.CIRCLE_NODE:c=Oe(o,p,a);break;case at.ELLIPSE_NODE:c=Se(o,p,a);break;case at.DIAMOND_NODE:case at.POLYGON_NODE:c=Te(o,p,a)}c&&(e[0]=c);var u=Bt(r,i),h=e[e.length-1];switch(d){case at.RECT_NODE:if(0!==s.radius)_e(i,s)||(h=we(i,u,s));break;case at.CIRCLE_NODE:h=Oe(i,u,s);break;case at.ELLIPSE_NODE:h=Se(i,u,s);break;case at.DIAMOND_NODE:case at.POLYGON_NODE:h=Te(i,u,s)}return h&&(e[e.length-1]=h),e},e.prototype.updatePath=function(t){this.pointsList=t,this.points=this.getPath(this.pointsList)},e.prototype.getData=function(){var e=t.prototype.getData.call(this),o=this.pointsList.map(function(t){return{x:t.x,y:t.y}});return Object.assign({},e,{pointsList:o})},e.prototype.getPath=function(t){return t.map(function(t){return"".concat(t.x,",").concat(t.y)}).join(" ")},e.prototype.initPoints=function(){this.pointsList.length>0?this.points=this.getPath(this.pointsList):this.updatePoints()},e.prototype.updatePoints=function(){var t=Lt({x:this.startPoint.x,y:this.startPoint.y},{x:this.endPoint.x,y:this.endPoint.y},this.sourceNode,this.targetNode,this.offset||0);this.pointsList=t,this.points=t.map(function(t){return"".concat(t.x,",").concat(t.y)}).join(" ")},e.prototype.updateStartPoint=function(t){this.startPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveStartPoint=function(t,e){this.startPoint.x+=t,this.startPoint.y+=e,this.updatePoints()},e.prototype.updateEndPoint=function(t){this.endPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveEndPoint=function(t,e){this.endPoint.x+=t,this.endPoint.y+=e,this.updatePoints()},e.prototype.updatePointsList=function(t,e){this.pointsList.forEach(function(o){o.x+=t,o.y+=e});var o=this.pointsList[0];this.startPoint=Object.assign({},o);var n=this.pointsList[this.pointsList.length-1];this.endPoint=Object.assign({},n),this.initPoints()},e.prototype.dragAppendStart=function(){this.draggingPointList=this.pointsList.map(function(t){return t})},e.prototype.dragAppendSimple=function(t,e){var o;this.isDragging=!0;var n=t.start,r=t.end,i=t.startIndex,s=t.endIndex,l=t.direction,d=this.pointsList,p=d;return l===dt.HORIZONTAL?(d[i]={x:n.x,y:n.y+e.y},d[s]={x:r.x,y:r.y+e.y},p=this.pointsList.map(function(t){return t})):l===dt.VERTICAL&&(d[i]={x:n.x+e.x,y:n.y},d[s]={x:r.x+e.x,y:r.y},p=this.pointsList.map(function(t){return t})),this.updatePointsAfterDrag(p),this.draggingPointList=p,(null===(o=this.text)||void 0===o?void 0:o.value)&&this.setText(a({},this.text,this.textPosition)),{start:a({},d[i]),end:a({},d[s]),startIndex:i,endIndex:s,direction:l}},e.prototype.dragAppend=function(t,e){var o;this.isDragging=!0;var n=t.start,r=t.end,i=t.startIndex,s=t.endIndex,l=t.direction,d=this.pointsList;if(l===dt.HORIZONTAL){d[i]={x:n.x,y:n.y+e.y},d[s]={x:r.x,y:r.y+e.y};var p=this.pointsList.map(function(t){return t});if(0!==i&&s!==this.pointsList.length-1&&(p=this.removeCrossPoints(i,s,p)),0===i){var c={x:n.x,y:n.y+e.y};if(!be(c,this.sourceNode)){var u=this.sourceNode.anchors;p=this.getDraggingPoints(l,"start",c,u,p)}}if(s===this.pointsList.length-1){var h={x:r.x,y:r.y+e.y};if(!be(h,this.targetNode)){u=this.targetNode.anchors;p=this.getDraggingPoints(l,"end",h,u,p)}}this.updatePointsAfterDrag(p),this.draggingPointList=p}else if(l===dt.VERTICAL){d[i]={x:n.x+e.x,y:n.y},d[s]={x:r.x+e.x,y:r.y};p=this.pointsList.map(function(t){return t});if(0!==i&&s!==this.pointsList.length-1&&(p=this.removeCrossPoints(i,s,p)),0===i){c={x:n.x+e.x,y:n.y};if(!be(c,this.sourceNode)){u=this.sourceNode.anchors;p=this.getDraggingPoints(l,"start",c,u,p)}}if(s===this.pointsList.length-1){h={x:r.x+e.x,y:r.y};if(!be(h,this.targetNode)){u=this.targetNode.anchors;p=this.getDraggingPoints(l,"end",h,u,p)}}this.updatePointsAfterDrag(p),this.draggingPointList=p}return(null===(o=this.text)||void 0===o?void 0:o.value)&&this.setText(a({},this.text,this.textPosition)),{start:a({},d[i]),end:a({},d[s]),startIndex:i,endIndex:s,direction:l}},e.prototype.dragAppendEnd=function(){if(this.draggingPointList){var t=jt(Xt(this.points));this.pointsList=t.map(function(t){return t}),this.draggingPointList=[];var e=t[0];this.startPoint=a({},e);var o=t[t.length-1];this.endPoint=a({},o)}this.isDragging=!1},e.prototype.updatePointsAfterDrag=function(t){var e=this.updateCrossPoints(t);this.points=e.map(function(t){return"".concat(t.x,",").concat(t.y)}).join(" ")},e.prototype.getAdjustStart=function(){return this.pointsList[0]||this.startPoint},e.prototype.getAdjustEnd=function(){var t=this.pointsList;return t[t.length-1]||this.endPoint},e.prototype.updateAfterAdjustStartAndEnd=function(t){var e=t.startPoint,o=t.endPoint,n=t.sourceNode,r=t.targetNode;this.pointsList=Lt({x:e.x,y:e.y},{x:o.x,y:o.y},n,r,this.offset||0),this.initPoints()},Zo([X],e.prototype,"offset",void 0),Zo([X],e.prototype,"dbClickPosition",void 0),Zo([H],e.prototype,"initPoints",null),Zo([H],e.prototype,"updatePoints",null),Zo([H],e.prototype,"updateStartPoint",null),Zo([H],e.prototype,"moveStartPoint",null),Zo([H],e.prototype,"updateEndPoint",null),Zo([H],e.prototype,"moveEndPoint",null),Zo([H],e.prototype,"updatePointsList",null),Zo([H],e.prototype,"dragAppendStart",null),Zo([H],e.prototype,"dragAppendSimple",null),Zo([H],e.prototype,"dragAppend",null),Zo([H],e.prototype,"dragAppendEnd",null),Zo([H],e.prototype,"updatePointsAfterDrag",null),Zo([H],e.prototype,"getAdjustStart",null),Zo([H],e.prototype,"getAdjustEnd",null),Zo([H],e.prototype,"updateAfterAdjustStartAndEnd",null),e}(Io),$o=function(){return $o=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},$o.apply(this,arguments)},Qo=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},tn=function(t){var e="function"==typeof Symbol&&Symbol.iterator,o=e&&t[e],n=0;if(o)return o.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},en=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},on=function(){function t(t,e){var o;this.BaseType=it.NODE,this.id="",this.type="",this.x=0,this.y=0,this.textMode=pt.TEXT,this.text={value:"",x:0,y:0,draggable:!1,editable:!0},this._width=100,this._height=80,this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3,this.anchorsOffset=[],this.virtual=!1,this.isSelected=!1,this.isHovered=!1,this.isShowAnchor=!1,this.isDragging=!1,this.isHitable=!0,this.isHittable=!0,this.draggable=!0,this.visible=!0,this.rotatable=!0,this.resizable=!0,this.zIndex=1,this.state=rt.DEFAULT,this.autoToFront=!0,this.style={},this._rotate=0,this.modelType=at.NODE,this.additionStateData={},this.targetRules=[],this.sourceRules=[],this.moveRules=[],this.resizeRules=[],this.hasSetTargetRules=!1,this.hasSetSourceRules=!1,this.graphModel=e,this.properties=null!==(o=t.properties)&&void 0!==o?o:{},this.initNodeData(t),this.setAttributes()}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotate",{get:function(){return this._rotate},set:function(t){this._rotate=t;var e=this.x,o=void 0===e?0:e,n=this.y,r=void 0===n?0:n;this.transform=new he(-o,-r).rotate(t).translate(o,r).toString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"incoming",{get:function(){return{nodes:this.graphModel.getNodeIncomingNode(this.id),edges:this.graphModel.getNodeIncomingEdge(this.id)}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"outgoing",{get:function(){return{nodes:this.graphModel.getNodeOutgoingNode(this.id),edges:this.graphModel.getNodeOutgoingEdge(this.id)}},enumerable:!1,configurable:!0}),t.prototype.initNodeData=function(t){if(t.properties||(t.properties={}),!t.id){var e=this.graphModel.idGenerator,o=e&&e(t.type),n=this.createId();t.id=n||o||Ce()}this.formatText(t),a(this,function(t){return c(t,["id","type","x","y","text","label","properties","virtual","rotate","resizable","rotatable"])}(t)),this.graphModel.overlapMode===lt.INCREASE&&(this.zIndex=t.zIndex||Co())},t.prototype.setAttributes=function(){},t.prototype.createId=function(){return null},t.prototype.setTextMode=function(t){this.textMode=t},t.prototype.formatText=function(t){var e,o,n,r=this.graphModel.editConfigModel,i=r.nodeTextDraggable,a=r.nodeTextEdit,s=t.x,l=t.y,d=t.text,p={value:"",x:s,y:l,draggable:i,editable:a};d&&("string"==typeof d?p.value=d:(p=$o($o({},p),{x:null!==(e=d.x)&&void 0!==e?e:s,y:null!==(o=d.y)&&void 0!==o?o:l,value:null!==(n=d.value)&&void 0!==n?n:""}),g(d.draggable)||(p.draggable=d.draggable),g(d.editable)||(p.editable=d.editable))),t.text=p},t.prototype.resize=function(t){var e=t.width,o=t.height,n=t.deltaX,r=t.deltaY;return this.isAllowResizeNode(n,r,e,o)?(this.move(n/2,r/2),this.width=e,this.height=o,this.setProperties({width:e,height:o}),this.getData()):this.getData()},t.prototype.proportionalResize=function(){},t.prototype.getData=function(){var t=this.text,e=t.x,o=t.y,n=t.value,r=this.properties;k(r)&&(r=R(r)),v(r.width)&&(r.width=this.width),v(r.height)&&(r.height=this.height);var i={id:this.id,type:this.type,x:this.x,y:this.y,properties:r};return this.rotate&&(i.rotate=this.rotate),this.graphModel.overlapMode===lt.INCREASE&&(i.zIndex=this.zIndex),n&&(i.text={x:e,y:o,value:n}),i},t.prototype.getHistoryData=function(){return this.getData()},t.prototype.getProperties=function(){return R(this.properties)},t.prototype.getOuterGAttributes=function(){return{className:""}},t.prototype.getNodeStyle=function(){return $o($o({},this.graphModel.theme.baseNode),this.style)},t.prototype.getTextStyle=function(){var t=this.graphModel.theme.nodeText,e=this.properties.textStyle,o=void 0===e?{}:e;return $o($o({},s(t)),s(o))},t.prototype.getRotateControlStyle=function(){var t=this.graphModel.theme.rotateControl;return s(t)},t.prototype.getResizeControlStyle=function(){var t=this.graphModel.theme.resizeControl;return s(t)},t.prototype.getResizeOutlineStyle=function(){var t=this.graphModel.theme.resizeOutline;return s(t)},t.prototype.getAnchorStyle=function(t){var e=this.graphModel.theme.anchor;return s(e)},t.prototype.getAnchorLineStyle=function(t){var e=this.graphModel.theme.anchorLine;return s(e)},t.prototype.getOutlineStyle=function(){var t=this.graphModel.theme.outline;return s(t)},t.prototype.isAllowConnectedAsSource=function(t,e,o,n){var r=this.hasSetSourceRules?this.sourceRules:this.getConnectedSourceRules();this.hasSetSourceRules=!0;for(var i=!0,a="",s=0;s<r.length;s++){var l=r[s];if(!l.validate.call(this,this,t,e,o,n)){i=!1,a=l.message;break}}return{isAllPass:i,msg:a}},t.prototype.getConnectedSourceRules=function(){return this.sourceRules},t.prototype.isAllowConnectedAsTarget=function(t,e,o,n){var r=this.hasSetTargetRules?this.targetRules:this.getConnectedTargetRules();this.hasSetTargetRules=!0;for(var i=!0,a="",s=0;s<r.length;s++){var l=r[s];if(!l.validate.call(this,t,this,e,o,n)){i=!1,a=l.message;break}}return{isAllPass:i,msg:a}},t.prototype.isAllowMoveNode=function(t,e){var o,n,r=!0,i=!0,a=this.moveRules.concat(this.graphModel.nodeMoveRules);try{for(var s=tn(a),l=s.next();!l.done;l=s.next()){var d=(0,l.value)(this,t,e);if(!d)return!1;if("object"==typeof d){var p=d;if(!p.x&&!p.y)return!1;r=r&&p.x,i=i&&p.y}}}catch(c){o={error:c}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(o)throw o.error}}return{x:r,y:i}},t.prototype.getConnectedTargetRules=function(){return this.targetRules},t.prototype.getAnchorsByOffset=function(){var t=this,e=t.anchorsOffset,o=t.id,n=t.x,r=t.y;return e&&e.length>0?e.map(function(t,e){return t.length?{id:"".concat(o,"_").concat(e),x:n+t[0],y:r+t[1]}:$o($o({},t),{x:n+t.x,y:r+t.y,id:t.id||"".concat(o,"_").concat(e)})}):this.getDefaultAnchor()},t.prototype.getDefaultAnchor=function(){return[]},t.prototype.getTargetAnchor=function(t){return function(t,e){for(var o,n=ge(e),r=Number.MAX_SAFE_INTEGER,i=0;i<n.length;i++){var a=xe(t.x,t.y,n[i].x,n[i].y);a<r&&(r=a,o={index:i,anchor:fe(fe({},n[i]),{x:n[i].x,y:n[i].y,id:n[i].id})})}return o}(t,this)},t.prototype.getBounds=function(){return{minX:this.x-this.width/2,minY:this.y-this.height/2,maxX:this.x+this.width/2,maxY:this.y+this.height/2}},Object.defineProperty(t.prototype,"anchors",{get:function(){var t=this.getAnchorsByOffset(),e=this,o=e.x,n=e.y,r=e.rotate;return t.forEach(function(t){var e=t.x,i=t.y,a=en(new pe([e,i,1]).translate(-o,-n).rotate(r).translate(o,n)[0],2),s=a[0],l=a[1];t.x=s,t.y=l}),t},enumerable:!1,configurable:!0}),t.prototype.getAnchorInfo=function(t){if(!v(t))for(var e=0;e<this.anchors.length;e++){var o=this.anchors[e];if(o.id===t)return o}},t.prototype.addNodeMoveRules=function(t){this.moveRules.includes(t)||this.moveRules.push(t)},t.prototype.isAllowMoveByXORY=function(t,e,o){var n,r;if(o)n=!0,r=!0;else{var i=this.isAllowMoveNode(t,e);"boolean"==typeof i?(n=i,r=i):(n=i.x,r=i.y)}return{isAllowMoveX:n,isAllowMoveY:r}},t.prototype.move=function(t,e,o){void 0===o&&(o=!1);var n=this.isAllowMoveByXORY(t,e,o),r=n.isAllowMoveX,i=n.isAllowMoveY;return r&&(this.x=this.x+t,this.text&&this.moveText(t,0)),i&&(this.y=this.y+e,this.text&&this.moveText(0,e)),(r||i)&&(this.rotate=this._rotate),r||i},t.prototype.getMoveDistance=function(t,e,o){void 0===o&&(o=!1);var n=this.isAllowMoveByXORY(t,e,o),r=n.isAllowMoveX,i=n.isAllowMoveY,a=0,s=0;return r&&t&&(this.x=this.x+t,this.text&&this.moveText(t,0),a=t),i&&e&&(this.y=this.y+e,this.text&&this.moveText(0,e),s=e),this.transform=new he(-this.x,-this.y).rotate(this.rotate).translate(this.x,this.y).toString(),[a,s]},t.prototype.moveTo=function(t,e,o){void 0===o&&(o=!1);var n=t-this.x,r=e-this.y;return!(!o&&!this.isAllowMoveNode(n,r))&&(this.text&&this.moveText(n,r),this.x=t,this.y=e,!0)},t.prototype.moveText=function(t,e){var o=this.text,n=o.x,r=o.y,i=o.value,a=o.draggable,s=o.editable;this.text={value:i,editable:s,draggable:a,x:n+t,y:r+e}},t.prototype.updateText=function(t){this.text=$o($o({},R(this.text)),{value:t})},t.prototype.addNodeResizeRules=function(t){this.resizeRules.includes(t)||this.resizeRules.push(t)},t.prototype.isAllowResizeNode=function(t,e,o,n){var r,i,a=this.resizeRules.concat(this.graphModel.nodeResizeRules);try{for(var s=tn(a),l=s.next();!l.done;l=s.next()){if(!(0,l.value)(this,t,e,o,n))return!1}}catch(d){r={error:d}}finally{try{l&&!l.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return!0},t.prototype.setSelected=function(t){void 0===t&&(t=!0),this.isSelected=t},t.prototype.setHovered=function(t){void 0===t&&(t=!0),this.isHovered=t,this.setIsShowAnchor(t)},t.prototype.setIsShowAnchor=function(t){void 0===t&&(t=!0),this.isShowAnchor=t},t.prototype.setRotatable=function(t){void 0===t&&(t=!0),this.rotatable=t},t.prototype.setResizable=function(t){void 0===t&&(t=!0),this.resizable=t},t.prototype.setHitable=function(t){void 0===t&&(t=!0),this.isHitable=t},t.prototype.setHittable=function(t){void 0===t&&(t=!0),this.isHittable=t},t.prototype.setElementState=function(t,e){this.state=t,this.additionStateData=e},t.prototype.updateProperties=function(t,e){var o=R(this.properties);this.properties=t,this.setAttributes(),this.graphModel.eventCenter.emit(st.NODE_PROPERTIES_CHANGE,{id:this.id,keys:e,preProperties:o,properties:t})},t.prototype.setProperty=function(t,e){var o=R(this.properties),n=s(o);m(n,t,nt(e)),this.updateProperties(n,[t])},t.prototype.setProperties=function(t){var e=R(this.properties),o=$o($o({},e),nt(t)),n=[];x(t,function(t,o){(b(e,o)&&e[o]!==t||!b(e,o))&&n.push(o)}),this.updateProperties(o,n)},t.prototype.deleteProperty=function(t){delete this.properties[t],this.setAttributes()},t.prototype.setStyle=function(t,e){var o;this.style=$o($o({},this.style),((o={})[t]=nt(e),o))},t.prototype.setStyles=function(t){this.style=$o($o({},this.style),nt(t))},t.prototype.updateStyles=function(t){this.style=$o({},nt(t))},t.prototype.setZIndex=function(t){void 0===t&&(t=1),this.zIndex=t},t.prototype.updateAttributes=function(t){a(this,t)},t.BaseType=it.NODE,Qo([X],t.prototype,"type",void 0),Qo([X],t.prototype,"x",void 0),Qo([X],t.prototype,"y",void 0),Qo([X],t.prototype,"textMode",void 0),Qo([X],t.prototype,"text",void 0),Qo([X],t.prototype,"properties",void 0),Qo([X],t.prototype,"_width",void 0),Qo([X],t.prototype,"_height",void 0),Qo([X],t.prototype,"anchorsOffset",void 0),Qo([X],t.prototype,"isSelected",void 0),Qo([X],t.prototype,"isHovered",void 0),Qo([X],t.prototype,"isShowAnchor",void 0),Qo([X],t.prototype,"isDragging",void 0),Qo([X],t.prototype,"isHitable",void 0),Qo([X],t.prototype,"isHittable",void 0),Qo([X],t.prototype,"draggable",void 0),Qo([X],t.prototype,"visible",void 0),Qo([X],t.prototype,"rotatable",void 0),Qo([X],t.prototype,"resizable",void 0),Qo([X],t.prototype,"zIndex",void 0),Qo([X],t.prototype,"state",void 0),Qo([X],t.prototype,"autoToFront",void 0),Qo([X],t.prototype,"style",void 0),Qo([X],t.prototype,"transform",void 0),Qo([X],t.prototype,"_rotate",void 0),Qo([z],t.prototype,"incoming",null),Qo([z],t.prototype,"outgoing",null),Qo([H],t.prototype,"setTextMode",null),Qo([H],t.prototype,"addNodeMoveRules",null),Qo([H],t.prototype,"move",null),Qo([H],t.prototype,"getMoveDistance",null),Qo([H],t.prototype,"moveTo",null),Qo([H],t.prototype,"moveText",null),Qo([H],t.prototype,"updateText",null),Qo([H],t.prototype,"addNodeResizeRules",null),Qo([H],t.prototype,"setSelected",null),Qo([H],t.prototype,"setHovered",null),Qo([H],t.prototype,"setIsShowAnchor",null),Qo([H],t.prototype,"setRotatable",null),Qo([H],t.prototype,"setResizable",null),Qo([H],t.prototype,"setHitable",null),Qo([H],t.prototype,"setHittable",null),Qo([H],t.prototype,"setElementState",null),Qo([H],t.prototype,"setProperty",null),Qo([H],t.prototype,"setProperties",null),Qo([H],t.prototype,"deleteProperty",null),Qo([H],t.prototype,"setStyle",null),Qo([H],t.prototype,"setStyles",null),Qo([H],t.prototype,"updateStyles",null),Qo([H],t.prototype,"setZIndex",null),Qo([H],t.prototype,"updateAttributes",null),t}(),nn=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),rn=function(){return rn=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},rn.apply(this,arguments)},an=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},sn=function(t){function e(e,o){var n=t.call(this,e,o)||this;return n.modelType=at.CIRCLE_NODE,n.r=50,n.initNodeData(e),n.setAttributes(),n}return nn(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return 2*this.r},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return 2*this.r},enumerable:!1,configurable:!0}),e.prototype.setAttributes=function(){t.prototype.setAttributes.call(this);var e=this.properties.r;e&&(this.r=e)},e.prototype.getNodeStyle=function(){var e=t.prototype.getNodeStyle.call(this),o=this.graphModel.theme.circle,n=this.properties.style,r=void 0===n?{}:n;return rn(rn(rn({},e),s(o)),s(r))},e.prototype.getDefaultAnchor=function(){var t=this,e=t.x,o=t.y,n=t.r;return[{x:e,y:o-n,id:"".concat(this.id,"_0")},{x:e+n,y:o,id:"".concat(this.id,"_1")},{x:e,y:o+n,id:"".concat(this.id,"_2")},{x:e-n,y:o,id:"".concat(this.id,"_3")}]},e.prototype.resize=function(t){var e=t.width,o=t.deltaX,n=t.deltaY;return this.move(o/2,n/2),this.r=e,this.setProperties({r:e}),this.getData()},an([X],e.prototype,"r",void 0),an([z],e.prototype,"width",null),an([z],e.prototype,"height",null),e}(on),ln=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),dn=function(){return dn=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},dn.apply(this,arguments)},pn=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},cn=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},un=function(t){function e(e,o){var n=t.call(this,e,o)||this;return n.modelType=at.DIAMOND_NODE,n.rx=30,n.ry=50,n.initNodeData(e),n.setAttributes(),n}return ln(e,t),e.prototype.setAttributes=function(){t.prototype.setAttributes.call(this);var e=this.properties,o=e.rx,n=e.ry;o&&(this.rx=o),n&&(this.ry=n)},e.prototype.getNodeStyle=function(){var e=t.prototype.getNodeStyle.call(this),o=this.graphModel.theme.diamond,n=this.properties.style,r=void 0===n?{}:n;return dn(dn(dn({},e),s(o)),s(r))},Object.defineProperty(e.prototype,"points",{get:function(){var t=this,e=t.x,o=t.y,n=t.rx,r=t.ry;return[[e,o-r],[e+n,o],[e,o+r],[e-n,o]]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointsPosition",{get:function(){return f(this.points,function(t){var e=cn(t,2);return{x:e[0],y:e[1]}})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){var t=Number.MAX_SAFE_INTEGER,e=Number.MIN_SAFE_INTEGER;return u(this.points,function(o){var n=cn(o,1)[0];n<t&&(t=n),n>e&&(e=n)}),e-t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=Number.MAX_SAFE_INTEGER,e=Number.MIN_SAFE_INTEGER;return u(this.points,function(o){var n=cn(o,2)[1];n<t&&(t=n),n>e&&(e=n)}),e-t},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this;return f(this.points,function(e,o){var n=cn(e,2);return{x:n[0],y:n[1],id:"".concat(t.id,"_").concat(o)}})},e.prototype.resize=function(t){var e=t.width,o=t.height,n=t.deltaX,r=t.deltaY;return this.move(n/2,r/2),this.rx=e,this.ry=o,this.setProperties({rx:e,ry:o}),this.getData()},pn([X],e.prototype,"rx",void 0),pn([X],e.prototype,"ry",void 0),pn([z],e.prototype,"points",null),pn([z],e.prototype,"pointsPosition",null),pn([z],e.prototype,"width",null),pn([z],e.prototype,"height",null),e}(on),hn=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),fn=function(){return fn=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},fn.apply(this,arguments)},yn=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},gn=function(t){function e(e,o){var n=t.call(this,e,o)||this;return n.modelType=at.ELLIPSE_NODE,n.rx=30,n.ry=45,n.initNodeData(e),n.setAttributes(),n}return hn(e,t),e.prototype.setAttributes=function(){t.prototype.setAttributes.call(this);var e=this.properties,o=e.rx,n=e.ry;o&&(this.rx=o),n&&(this.ry=n)},e.prototype.getNodeStyle=function(){var e=t.prototype.getNodeStyle.call(this),o=this.graphModel.theme.ellipse,n=this.properties.style,r=void 0===n?{}:n;return fn(fn(fn({},e),s(o)),s(r))},Object.defineProperty(e.prototype,"width",{get:function(){return 2*this.rx},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return 2*this.ry},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this,e=t.x,o=t.y,n=t.rx,r=t.ry;return[{x:e,y:o-r,id:"".concat(this.id,"_0")},{x:e+n,y:o,id:"".concat(this.id,"_1")},{x:e,y:o+r,id:"".concat(this.id,"_2")},{x:e-n,y:o,id:"".concat(this.id,"_3")}]},e.prototype.resize=function(t){var e=t.width,o=t.height,n=t.deltaX,r=t.deltaY;return this.move(n/2,r/2),this.rx=e,this.ry=o,this.setProperties({rx:e,ry:o}),this.getData()},yn([X],e.prototype,"rx",void 0),yn([X],e.prototype,"ry",void 0),yn([z],e.prototype,"width",null),yn([z],e.prototype,"height",null),e}(on),vn=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),mn=function(){return mn=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},mn.apply(this,arguments)},xn=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},bn=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},En=function(t){function e(e,o){var n=t.call(this,e,o)||this;return n.modelType=at.POLYGON_NODE,n.points=[[50,0],[100,50],[50,100],[0,50]],n.initNodeData(e),n.setAttributes(),n}return vn(e,t),e.prototype.setAttributes=function(){t.prototype.setAttributes.call(this);var e=this.properties,o=e.points,n=e.width,r=e.height,i=o||this.points;this.points=function(t,e,o){if(!t)return[];var n=Math.min.apply(Math,qt([],Kt(t.map(function(t){return t[0]})),!1)),r=Math.max.apply(Math,qt([],Kt(t.map(function(t){return t[0]})),!1)),i=Math.min.apply(Math,qt([],Kt(t.map(function(t){return t[1]})),!1)),a=Math.max.apply(Math,qt([],Kt(t.map(function(t){return t[1]})),!1)),s=-n,l=-i,d=t.map(function(t){var e=Kt(t,2),o=e[0],n=e[1];return[o+s,n+l]}),p=e?e/(r-n):1,c=o?o/(a-i):1,u=Math.min(p,c);return d.map(function(t){var e=Kt(t,2),o=e[0],n=e[1];return[o*u,n*u]})}(i,n,r)},e.prototype.getNodeStyle=function(){var e=t.prototype.getNodeStyle.call(this),o=this.graphModel.theme.polygon,n=this.properties.style,r=void 0===n?{}:n;return mn(mn(mn({},e),s(o)),s(r))},Object.defineProperty(e.prototype,"pointsPosition",{get:function(){var t=this,e=t.x,o=t.y,n=t.width,r=t.height;return this.points.map(function(t){return{x:t[0]+e-n/2,y:t[1]+o-r/2}})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){var t=Number.MAX_SAFE_INTEGER,e=Number.MIN_SAFE_INTEGER;return this.points.forEach(function(o){var n=bn(o,1)[0];n<t&&(t=n),n>e&&(e=n)}),e-t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=Number.MAX_SAFE_INTEGER,e=Number.MIN_SAFE_INTEGER;return this.points.forEach(function(o){var n=bn(o,2)[1];n<t&&(t=n),n>e&&(e=n)}),e-t},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this,e=this,o=e.x,n=e.y,r=e.width,i=e.height;return e.points.map(function(e,a){var s=bn(e,2),l=s[0],d=s[1];return{x:o+l-r/2,y:n+d-i/2,id:"".concat(t.id,"_").concat(a)}})},e.prototype.resize=function(t){var e=this,o=t.width,n=t.height,r=t.deltaX,i=t.deltaY;this.move(r/2,i/2);var a=f(this.points,function(t){var r=bn(t,2),i=r[0],a=r[1];return[i*o/e.width,a*n/e.height]});return this.points=a,this.properties.points=a,this.getData()},xn([X],e.prototype,"points",void 0),xn([z],e.prototype,"pointsPosition",null),xn([z],e.prototype,"width",null),xn([z],e.prototype,"height",null),e}(on),Mn=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),wn=function(){return wn=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},wn.apply(this,arguments)},On=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},_n=function(t){function e(e,o){var n=t.call(this,e,o)||this;return n.modelType=at.RECT_NODE,n.radius=0,n.initNodeData(e),n.setAttributes(),n}return Mn(e,t),e.prototype.setAttributes=function(){t.prototype.setAttributes.call(this);var e=this.properties,o=e.width,n=e.height,r=e.radius,i=this.getNodeStyle().radius;v(o)||(this.width=o),v(n)||(this.height=n),v(r)||(this.radius=r),v(i)||(this.radius=i)},e.prototype.getDefaultAnchor=function(){var t=this,e=t.x,o=t.y,n=t.width,r=t.height;return[{x:e,y:o-r/2,id:"".concat(this.id,"_0")},{x:e+n/2,y:o,id:"".concat(this.id,"_1")},{x:e,y:o+r/2,id:"".concat(this.id,"_2")},{x:e-n/2,y:o,id:"".concat(this.id,"_3")}]},e.prototype.getNodeStyle=function(){var e=t.prototype.getNodeStyle.call(this),o=this.graphModel.theme.rect,n=this.properties.style,r=void 0===n?{}:n;return wn(wn(wn({},e),s(o)),s(r))},On([X],e.prototype,"radius",void 0),e}(on),Sn=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Tn=function(){return Tn=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Tn.apply(this,arguments)},Pn=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},An=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},Nn=function(t,e,o){if(o||2===arguments.length)for(var n,r=0,i=e.length;r<i;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))},Dn=function(t){function e(){var e=t.apply(this,Nn([],An(arguments),!1))||this;return e.modelType=at.TEXT_NODE,e}return Sn(e,t),e.prototype.getTextStyle=function(){var e=t.prototype.getTextStyle.call(this),o=this.graphModel.theme.text,n=this.properties.textStyle;return Tn(Tn(Tn({},e),s(o)),s(n))},Object.defineProperty(e.prototype,"width",{get:function(){var t=String(this.text.value).split(/[\r\n]/g),e=this.getTextStyle().fontSize;return Ne({rows:t,fontSize:e,rowsLength:t.length}).width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=String(this.text.value).split(/[\r\n]/g),e=this.getTextStyle().fontSize;return Ne({rows:t,fontSize:e,rowsLength:t.length}).height},enumerable:!1,configurable:!0}),Pn([z],e.prototype,"width",null),Pn([z],e.prototype,"height",null),e}(on),Cn=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),jn=function(t){function e(e,o){var n=t.call(this,e,o)||this;return n.modelType=at.HTML_NODE,n.setAttributes(),n}return Cn(e,t),e.prototype.setAttributes=function(){t.prototype.setAttributes.call(this);var e=this.properties,o=e.width,n=e.height;o&&(this.width=o),n&&(this.height=n)},e.prototype.getDefaultAnchor=function(){var t=this,e=t.x,o=t.y,n=t.width,r=t.height;return[{x:e,y:o-r/2,id:"".concat(this.id,"_0")},{x:e+n/2,y:o,id:"".concat(this.id,"_1")},{x:e,y:o+r/2,id:"".concat(this.id,"_2")},{x:e-n/2,y:o,id:"".concat(this.id,"_3")}]},e}(on),Ln=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},In={stopZoomGraph:!1,stopScrollGraph:!1,stopMoveGraph:!1,adjustEdge:!1,adjustEdgeStartAndEnd:!1,adjustNodePosition:!1,hideAnchors:!0,allowRotate:!1,allowResize:!1,nodeSelectedOutline:!0,textEdit:!1,nodeTextEdit:!1,edgeTextEdit:!1,textDraggable:!1,nodeTextDraggable:!1,edgeTextDraggable:!1},Rn=["isSilentMode","stopZoomGraph","stopScrollGraph","stopMoveGraph","snapGrid","adjustEdge","adjustEdgeMiddle","adjustEdgeStartAndEnd","adjustEdgeStart","adjustEdgeEnd","adjustNodePosition","hideAnchors","allowRotate","allowResize","autoExpand","hoverOutline","nodeSelectedOutline","edgeSelectedOutline","textEdit","nodeTextEdit","edgeTextEdit","textDraggable","nodeTextDraggable","edgeTextDraggable","multipleSelectKey","textMode","nodeTextMode","edgeTextMode","nodeTextMultiple","edgeTextMultiple","nodeTextVertical","edgeTextVertical"],kn=function(){function t(t){this.isSilentMode=!1,this.stopZoomGraph=!1,this.stopMoveGraph=!1,this.stopScrollGraph=!1,this.snapGrid=!1,this.textMode=pt.TEXT,this.textEdit=!0,this.textDraggable=!1,this.nodeTextEdit=!0,this.nodeTextDraggable=!1,this.nodeTextMultiple=!1,this.nodeTextVertical=!1,this.nodeTextMode=pt.TEXT,this.edgeTextMode=pt.TEXT,this.edgeTextEdit=!0,this.edgeTextDraggable=!1,this.edgeTextMultiple=!1,this.edgeTextVertical=!1,this.hideAnchors=!1,this.allowRotate=!1,this.allowResize=!1,this.hoverOutline=!0,this.nodeSelectedOutline=!0,this.adjustNodePosition=!0,this.autoExpand=!1,this.adjustEdge=!0,this.adjustEdgeMiddle=!1,this.adjustEdgeStartAndEnd=!1,this.adjustEdgeStart=!1,this.adjustEdgeEnd=!1,this.edgeSelectedOutline=!0,this.multipleSelectKey="",a(this,this.computeConfig(t))}return t.prototype.updateEditConfig=function(t){var e=this.computeConfig(t);a(this,e)},t.prototype.computeConfig=function(t){var e=t.isSilentMode,o=t.textDraggable,n=t.textMode,r=t.textEdit,i=t.adjustEdgeStartAndEnd,s={};if(!1===e&&a(s,this.stagedConfig),!0===e&&e!==this.isSilentMode){var l=c(In,Rn);this.stagedConfig=c(this,Rn),a(s,l)}g(r)||a(s,{nodeTextEdit:r,edgeTextEdit:r}),g(o)||a(s,{nodeTextDraggable:o,edgeTextDraggable:o}),n&&a(s,{nodeTextMode:n,edgeTextMode:n}),E(i)&&a(s,{adjustEdgeStart:i,adjustEdgeEnd:i});var d=c(t,Rn);return a(s,d)},t.prototype.updateTextMode=function(t){this.textMode=t,this.edgeTextMode=t,this.nodeTextMode=t},t.prototype.getConfig=function(){return c(this,Rn)},Ln([X],t.prototype,"isSilentMode",void 0),Ln([X],t.prototype,"stopZoomGraph",void 0),Ln([X],t.prototype,"stopMoveGraph",void 0),Ln([X],t.prototype,"stopScrollGraph",void 0),Ln([X],t.prototype,"snapGrid",void 0),Ln([X],t.prototype,"textMode",void 0),Ln([X],t.prototype,"textEdit",void 0),Ln([X],t.prototype,"textDraggable",void 0),Ln([X],t.prototype,"nodeTextEdit",void 0),Ln([X],t.prototype,"nodeTextDraggable",void 0),Ln([X],t.prototype,"nodeTextMultiple",void 0),Ln([X],t.prototype,"nodeTextVertical",void 0),Ln([X],t.prototype,"nodeTextMode",void 0),Ln([X],t.prototype,"edgeTextMode",void 0),Ln([X],t.prototype,"edgeTextEdit",void 0),Ln([X],t.prototype,"edgeTextDraggable",void 0),Ln([X],t.prototype,"edgeTextMultiple",void 0),Ln([X],t.prototype,"edgeTextVertical",void 0),Ln([X],t.prototype,"hideAnchors",void 0),Ln([X],t.prototype,"allowRotate",void 0),Ln([X],t.prototype,"allowResize",void 0),Ln([X],t.prototype,"hoverOutline",void 0),Ln([X],t.prototype,"nodeSelectedOutline",void 0),Ln([X],t.prototype,"adjustNodePosition",void 0),Ln([X],t.prototype,"autoExpand",void 0),Ln([X],t.prototype,"adjustEdge",void 0),Ln([X],t.prototype,"adjustEdgeMiddle",void 0),Ln([X],t.prototype,"adjustEdgeStartAndEnd",void 0),Ln([X],t.prototype,"adjustEdgeStart",void 0),Ln([X],t.prototype,"adjustEdgeEnd",void 0),Ln([X],t.prototype,"edgeSelectedOutline",void 0),Ln([H],t.prototype,"updateEditConfig",null),Ln([H],t.prototype,"updateTextMode",null),t}(),Bn=function(){function t(){this._events={}}return t.prototype.on=function(t,e,o){var n=this;null==t||t.split(",").forEach(function(t){t=t.trim(),n._events[t]||(n._events[t]=[]),n._events[t].push({callback:e,once:!!o})})},t.prototype.once=function(t,e){var o=this;null==t||t.split(",").forEach(function(t){t=t.trim(),o.on(t,e,!0)})},t.prototype.emit=function(t,e){var o=this;null==t||t.split(",").forEach(function(t){var n=o._events[t]||[],r=o._events["*"]||[],i=function(n){for(var r=n.length,i=0;i<r;i++)if(n[i]){var a=n[i],s=a.callback;a.once&&(n.splice(i,1),0===n.length&&delete o._events[t],r--,i--),s.apply(o,[e])}};i(n),i(r)})},t.prototype.off=function(t,e){var o=this;t||(this._events={}),t.split(",").forEach(function(t){if(e){for(var n=o._events[t]||[],r=n.length,i=0;i<r;i++)n[i].callback===e&&(n.splice(i,1),r--,i--);0===n.length&&delete o._events[t]}else delete o._events[t]})},t.prototype.getEvents=function(){return this._events},t.prototype.destroy=function(){this._events={}},t}(),Xn=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),zn=function(){return zn=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},zn.apply(this,arguments)},Hn=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},Gn=function(t){function o(e){var o=t.call(this)||this;o.stepScrollX=0,o.stepScrollY=0,o.onDragging=function(t){var e=t.deltaX,n=t.deltaY;o.setState({isDragging:!0});var r=o.props.graphModel,i=r.transformModel;!0!==r.editConfigModel.stopMoveGraph&&i.translate(e,n)},o.onDragEnd=function(){o.setState({isDragging:!1})},o.zoomHandler=function(t){var e=o.props,n=e.graphModel,r=n.editConfigModel,i=n.transformModel,a=n.gridSize,s=e.graphModel,l=t.deltaX,d=t.deltaY,p=r.stopScrollGraph,c=r.stopZoomGraph;if(p||t.ctrlKey||t.metaKey){if(!c){t.preventDefault();var u=s.getPointByClient({x:t.clientX,y:t.clientY}).canvasOverlayPosition,h=u.x,f=u.y;i.zoom(t.deltaY<0,[h,f])}}else{if(t.preventDefault(),o.stepScrollX+=l,o.stepScrollY+=d,Math.abs(o.stepScrollX)>=a){var y=o.stepScrollX%a,g=o.stepScrollX-y;i.translate(-g*i.SCALE_X,0),o.stepScrollX=y}if(Math.abs(o.stepScrollY)>=a){var v=o.stepScrollY%a,m=o.stepScrollY-v;i.translate(0,-m*i.SCALE_Y),o.stepScrollY=v}}},o.clickHandler=function(t){if("canvas-overlay"===t.target.getAttribute("name")){var e=o.props.graphModel;e.selectElements.size>0&&e.clearSelectElements(),e.eventCenter.emit(st.BLANK_CLICK,{e:t})}},o.handleContextMenu=function(t){if("canvas-overlay"===t.target.getAttribute("name")){t.preventDefault();var e=o.props.graphModel,n=e.getPointByClient({x:t.clientX,y:t.clientY});e.eventCenter.emit(st.BLANK_CONTEXTMENU,{e:t,position:n})}},o.mouseDownHandler=function(t){var e=o.props.graphModel,n=e.eventCenter,r=e.editConfigModel,i=e.transformModel.SCALE_X,a=e.gridSize,s=r.adjustEdge,l=r.adjustNodePosition,d=r.stopMoveGraph,p=!s&&!l;("canvas-overlay"===t.target.getAttribute("name")||p)&&(!0!==d?(o.stepDrag.setStep(a*i),o.stepDrag.handleMouseDown(t)):n.emit(st.BLANK_MOUSEDOWN,{e:t}),o.clickHandler(t))};var n=e.graphModel,r=n.gridSize,i=n.eventCenter;return o.stepDrag=new ut({onDragging:o.onDragging,onDragEnd:o.onDragEnd,step:r,eventType:"BLANK",isStopPropagation:!1,eventCenter:i,model:void 0}),o.state={isDragging:!1},o}return Xn(o,t),o.prototype.render=function(){var t=this.props.graphModel.transformModel.getTransformStyle().transform,o=this.props,n=o.children,r=o.dnd,i=this.state.isDragging;return e("svg",zn({xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%",name:"canvas-overlay",onWheel:this.zoomHandler,onMouseDown:this.mouseDownHandler,onContextMenu:this.handleContextMenu,className:i?"lf-canvas-overlay lf-dragging":"lf-canvas-overlay lf-drag-able"},r.eventMap(),{children:e("g",{transform:t,children:n})}))},o=Hn([_a],o)}(o),Yn=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Fn=function(){return Fn=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Fn.apply(this,arguments)},Wn=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},Un=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},Vn=function(t){function o(){var e=t.call(this)||this;return e.onDragging=function(t){var o=t.event,n=e.props,r=n.graphModel,i=n.bezierModel,a=n.type,s=r.getPointByClient({x:o.clientX,y:o.clientY}).canvasOverlayPosition,l=s.x,d=s.y;i.updateAdjustAnchor({x:l,y:d},a),r.eventCenter.emit(st.EDGE_ADJUST,{data:i.getData()})},e.onDragEnd=function(){e.props.bezierModel.isDragging=!1},e.dragHandler=new ut({onDragging:e.onDragging,onDragEnd:e.onDragEnd}),e}return Yn(o,t),o.prototype.render=function(){var t=this,o=this.props.position,n=o.x,r=o.y,i=this.props.bezierModel.getEdgeStyle().adjustAnchor;return e(qe,Fn({className:"lf-bezier-adjust-anchor",x:n,y:r},i,{onMouseDown:function(e){t.dragHandler.handleMouseDown(e)}}))},o}(o),Zn=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return Yn(o,t),o.prototype.getBezierAdjust=function(t,o){var n=t.path,r=t.id,i=Ft(n),a=Un(i,4),s=a[0],l=a[1],d=a[2],p=a[3],c=t.getEdgeStyle().adjustLine,u=[];return u.push(e(He,Fn({x1:s.x,y1:s.y,x2:l.x,y2:l.y},c))),u.push(e(Vn,{position:l,bezierModel:t,graphModel:o,type:"sNext"},"".concat(r,"_ePre"))),u.push(e(He,Fn({x1:p.x,y1:p.y,x2:d.x,y2:d.y},c))),u.push(e(Vn,{position:d,bezierModel:t,graphModel:o,type:"ePre"},"".concat(r,"_sNext"))),u},o.prototype.selectedBezierEdge=function(){for(var t=this.props.graphModel,e=t.edges,o=[],n=0;n<e.length;n++){var r=e[n];r.isSelected&&r.modelType===at.BEZIER_EDGE&&r.draggable&&o.push(this.getBezierAdjust(r,t))}return o},o.prototype.render=function(){return e("g",{className:"lf-bezier-adjust",children:this.selectedBezierEdge()})},o=Wn([_a],o)}(o),Kn=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),qn=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},Jn=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return Kn(o,t),o.prototype.render=function(){var t=this.props.background;return e("div",{className:"lf-background",children:e("div",{style:M(t)?t:{},className:"lf-background-area"})})},o=qn([_a],o)}(o),$n=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Qn=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},tr=function(t){function o(e){var o=t.call(this,e)||this;return o.id=Ce(),o.gridOptions=o.props.graphModel.grid,o}return $n(o,t),o.prototype.renderDot=function(){var t=this.gridOptions,o=t.config,n=t.size,r=void 0===n?1:n,i=t.visible,a=null!=o?o:{},s=a.color,l=a.thickness,d=void 0===l?2:l,p=Math.min(Math.max(2,d),r/4);return e("g",{fill:s,opacity:i?1:0,children:[e("circle",{cx:0,cy:0,r:p/2}),e("circle",{cx:0,cy:r,r:p/2}),e("circle",{cx:r,cy:0,r:p/2}),e("circle",{cx:r,cy:r,r:p/2})]})},o.prototype.renderMesh=function(){var t=this.gridOptions,o=t.config,n=t.size,r=void 0===n?1:n,i=t.visible,a=null!=o?o:{},s=a.color,l=a.thickness,d=void 0===l?1:l,p=Math.min(Math.max(1,d),r/2),c="M 0 0 H ".concat(r," V ").concat(r," H 0 Z");return e("path",{d:c,stroke:s,strokeWidth:p/2,opacity:i?1:0,fill:"transparent"})},o.prototype.render=function(){var t=this.props.graphModel,o=t.transformModel,n=t.grid;this.gridOptions=n;var r=this.gridOptions,i=r.type,a=r.size,s=void 0===a?1:a,l=[o.SCALE_X,o.SKEW_Y,o.SKEW_X,o.SCALE_Y,o.TRANSLATE_X,o.TRANSLATE_Y].join(","),d="matrix(".concat(l,")");return e("div",{className:"lf-grid",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",children:[e("defs",{children:e("pattern",{id:this.id,patternUnits:"userSpaceOnUse",patternTransform:d,x:"0",y:"0",width:s,height:s,children:["dot"===i&&this.renderDot(),"mesh"===i&&this.renderMesh()]})}),e("rect",{width:"100%",height:"100%",fill:"url(#".concat(this.id,")")})]})})},o=Qn([_a],o)}(o);!function(t){t.defaultProps={size:10,visible:!0,type:"dot",config:{color:"#ababab",thickness:1}},t.getGridOptions=function(e){var o=s(t.defaultProps);return a(o,"number"==typeof e?{size:e}:"boolean"==typeof e?{visible:e}:e)}}(tr||(tr={}));var er=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),or=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},nr=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return er(o,t),o.prototype.render=function(){var t=this.props.graphModel.transformModel.getTransformStyle().transform,o=this.props.children;return e("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",className:"modification-overlay",children:e("g",{transform:t,children:o})})},o=or([_a],o)}(o),rr=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),ir=function(){return ir=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},ir.apply(this,arguments)},ar=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},sr=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return rr(o,t),o.prototype.getNodesOutline=function(){var t=this.props.graphModel,o=t.nodes,n=t.editConfigModel,r=n.hoverOutline,i=n.nodeSelectedOutline,a=[];return o.forEach(function(t){if(t.isHovered||t.isSelected){var o=t.isHovered,n=t.isSelected,s=t.x,l=t.y,d=t.width,p=t.height;if(i&&n||r&&o){var c=t.getOutlineStyle(),u={};if(Object.keys(c).forEach(function(t){"hover"!==t&&(u[t]=c[t])}),o){var h=c.hover;u=ir(ir({},u),h)}a.push(e(Fe,ir({transform:t.transform,className:"lf-outline-node",x:s,y:l,width:d+10,height:p+10},u)))}}}),a},o.prototype.getEdgeOutline=function(){for(var t=this.props.graphModel,e=t.edges,o=t.editConfigModel,n=o.edgeSelectedOutline,r=o.hoverOutline,i=[],a=0;a<e.length;a++){var s=e[a];(n&&s.isSelected||r&&s.isHovered)&&(s.modelType===at.LINE_EDGE?i.push(this.getLineOutline(s)):s.modelType===at.POLYLINE_EDGE?i.push(this.getPolylineOutline(s)):s.modelType===at.BEZIER_EDGE&&i.push(this.getBezierOutline(s)))}return i},o.prototype.getLineOutline=function(t){var o=t.startPoint,n=t.endPoint,r=(o.x+n.x)/2,i=(o.y+n.y)/2,a=Math.abs(o.x-n.x)+10,s=Math.abs(o.y-n.y)+10,l=t.getOutlineStyle();return e(Fe,ir({className:"lf-outline-edge",x:r,y:i,width:a,height:s},l))},o.prototype.getPolylineOutline=function(t){var o=t.points,n=Xt(o),r=wt(n,8),i=r.x,a=r.y,s=r.width,l=r.height,d=t.getOutlineStyle();return e(Fe,ir({className:"lf-outline",x:i,y:a,width:s,height:l},d))},o.prototype.getBezierOutline=function(t){var o=t.path,n=Ft(o),r=wt(n,8),i=r.x,a=r.y,s=r.width,l=r.height,d=t.getOutlineStyle();return e(Fe,ir({className:"lf-outline",x:i,y:a,width:s,height:l},d))},o.prototype.render=function(){return e("g",{className:"lf-outline",children:[this.getNodesOutline(),this.getEdgeOutline()]})},o=ar([_a],o)}(o),lr=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),dr=function(){return dr=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},dr.apply(this,arguments)},pr=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},cr=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return lr(o,t),o.prototype.render=function(){var t=this.props.snaplineModel,o=null!=t?t:{},n=o.position,r=o.isShowHorizontal,i=o.isShowVertical,a=null==t?void 0:t.getStyle(),s=null!=n?n:{},l=s.x,d=void 0===l?0:l,p=s.y,c=void 0===p?0:p,u=dr(dr({x1:-1e5,y1:c,x2:1e5,y2:c},a),{stroke:r?null==a?void 0:a.stroke:"none"}),h=dr(dr({x1:d,y1:-1e5,x2:d,y2:1e5},a),{stroke:i?null==a?void 0:a.stroke:"none"});return e("g",{className:"lf-snapline",children:[e(He,dr({},u)),e(He,dr({},h))]})},o=pr([_a],o)}(o),ur=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),hr=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},fr=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return ur(o,t),o.prototype.componentDidMount=function(){this.triggerToolRender()},o.prototype.componentDidUpdate=function(){this.triggerToolRender()},o.prototype.getTools=function(){var t=this.props,e=t.tool,o=t.graphModel,r=o.textEditElement,i=e.getTools().map(function(t){return n(t,{textEditElement:r,graphModel:o,lf:e.instance})});return e.components=i,i},o.prototype.triggerToolRender=function(){var t=this.props,e=t.tool,o=t.graphModel,n=document.querySelector("#ToolOverlay_".concat(o.flowId)),r=e.getInstance();r.components.forEach(function(t){return t(r,n)}),r.components=[]},o.prototype.render=function(){var t=this.props.graphModel;return e("div",{className:"lf-tool-overlay",id:"ToolOverlay_".concat(t.flowId),children:this.getTools()})},o=hr([_a],o)}(o),yr=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},gr=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},vr={false:[-1/0,-1/0,1/0,1/0],true:[-1/0,-1/0,1/0,1/0],vertical:[-1/0,0,1/0,0],horizontal:[0,-1/0,0,1/0]},mr=function(){function t(t,e){this.MINI_SCALE_SIZE=.2,this.MAX_SCALE_SIZE=16,this.SCALE_X=1,this.SKEW_Y=0,this.SKEW_X=0,this.SCALE_Y=1,this.TRANSLATE_X=0,this.TRANSLATE_Y=0,this.ZOOM_SIZE=.04,this.translateLimitMinX=-1/0,this.translateLimitMinY=-1/0,this.translateLimitMaxX=1/0,this.translateLimitMaxY=1/0,this.eventCenter=t;var o=e.stopMoveGraph,n=void 0!==o&&o;this.updateTranslateLimits(n)}return t.prototype.setZoomMiniSize=function(t){this.MINI_SCALE_SIZE=t},t.prototype.setZoomMaxSize=function(t){this.MAX_SCALE_SIZE=t},t.prototype.HtmlPointToCanvasPoint=function(t){var e=gr(t,2),o=e[0],n=e[1];return[(o-this.TRANSLATE_X)/this.SCALE_X,(n-this.TRANSLATE_Y)/this.SCALE_Y]},t.prototype.CanvasPointToHtmlPoint=function(t){var e=gr(t,2),o=e[0],n=e[1];return[o*this.SCALE_X+this.TRANSLATE_X,n*this.SCALE_Y+this.TRANSLATE_Y]},t.prototype.moveCanvasPointByHtml=function(t,e,o){var n=gr(t,2),r=n[0],i=n[1];return[r+e/this.SCALE_X,i+o/this.SCALE_Y]},t.prototype.fixDeltaXY=function(t,e){return[t/this.SCALE_X,e/this.SCALE_Y]},t.prototype.getTransformStyle=function(){var t=[this.SCALE_X,this.SKEW_Y,this.SKEW_X,this.SCALE_Y,this.TRANSLATE_X,this.TRANSLATE_Y].join(",");return{transform:"matrix(".concat(t,")")}},t.prototype.zoom=function(t,e){void 0===t&&(t=!1);var o=this.SCALE_X,n=this.SCALE_Y;return"number"==typeof t?(o=t,n=t):t?(o+=this.ZOOM_SIZE,n+=this.ZOOM_SIZE):(o-=this.ZOOM_SIZE,n-=this.ZOOM_SIZE),o<this.MINI_SCALE_SIZE||o>this.MAX_SCALE_SIZE||(e&&(this.TRANSLATE_X-=(o-this.SCALE_X)*e[0],this.TRANSLATE_Y-=(n-this.SCALE_Y)*e[1]),this.SCALE_X=o,this.SCALE_Y=n,this.emitGraphTransform("zoom")),"".concat(100*this.SCALE_X,"%")},t.prototype.emitGraphTransform=function(t){this.eventCenter.emit(st.GRAPH_TRANSFORM,{type:t,transform:{SCALE_X:this.SCALE_X,SKEW_Y:this.SKEW_Y,SKEW_X:this.SKEW_X,SCALE_Y:this.SCALE_Y,TRANSLATE_X:this.TRANSLATE_X,TRANSLATE_Y:this.TRANSLATE_Y}})},t.prototype.resetZoom=function(){this.SCALE_X=1,this.SCALE_Y=1,this.emitGraphTransform("resetZoom")},t.prototype.translate=function(t,e){this.TRANSLATE_X+t<=this.translateLimitMaxX&&this.TRANSLATE_X+t>=this.translateLimitMinX&&(this.TRANSLATE_X+=t),this.TRANSLATE_Y+e<=this.translateLimitMaxY&&this.TRANSLATE_Y+e>=this.translateLimitMinY&&(this.TRANSLATE_Y+=e),this.emitGraphTransform("translate")},t.prototype.focusOn=function(t,e,o,n){var r=gr(this.CanvasPointToHtmlPoint([t,e]),2),i=r[0],a=r[1],s=gr([o/2-i,n/2-a],2),l=s[0],d=s[1];this.TRANSLATE_X+=l,this.TRANSLATE_Y+=d,this.emitGraphTransform("focusOn")},t.prototype.updateTranslateLimits=function(t){var e;e=gr(Array.isArray(t)&&4===t.length?t:vr[t.toString()],4),this.translateLimitMinX=e[0],this.translateLimitMinY=e[1],this.translateLimitMaxX=e[2],this.translateLimitMaxY=e[3]},yr([X],t.prototype,"SCALE_X",void 0),yr([X],t.prototype,"SKEW_Y",void 0),yr([X],t.prototype,"SKEW_X",void 0),yr([X],t.prototype,"SCALE_Y",void 0),yr([X],t.prototype,"TRANSLATE_X",void 0),yr([X],t.prototype,"TRANSLATE_Y",void 0),yr([X],t.prototype,"ZOOM_SIZE",void 0),yr([H],t.prototype,"zoom",null),yr([H],t.prototype,"resetZoom",null),yr([H],t.prototype,"translate",null),yr([H],t.prototype,"focusOn",null),t}(),xr=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),br=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},Er=function(t){function e(e,o){var n=t.call(this,e,o)||this;return n.parentTransform=o.parentTransform,n}return xr(e,t),e.prototype.setParentTransform=function(t){this.parentTransform=t},e.prototype.getCumulativeScale=function(){var t=this.SCALE_X,o=this.SCALE_Y;if(this.parentTransform)if(this.parentTransform instanceof e){var n=this.parentTransform.getCumulativeScale();t*=n.scaleX,o*=n.scaleY}else t*=this.parentTransform.SCALE_X,o*=this.parentTransform.SCALE_Y;return{scaleX:t,scaleY:o}},e.prototype.getCumulativeTranslate=function(){var t=this.TRANSLATE_X,o=this.TRANSLATE_Y;if(this.parentTransform&&this.parentTransform instanceof e){var n=this.parentTransform.getCumulativeScale();t*=n.scaleX,o*=n.scaleY}return{translateX:t,translateY:o}},e.prototype.HtmlPointToCanvasPoint=function(t){var e=br(t,2),o=e[0],n=e[1],r=this.getCumulativeScale(),i=r.scaleX,a=r.scaleY,s=this.getCumulativeTranslate();return[(o-s.translateX)/i,(n-s.translateY)/a]},e.prototype.CanvasPointToHtmlPoint=function(t){var e=br(t,2),o=e[0],n=e[1],r=this.getCumulativeScale(),i=r.scaleX,a=r.scaleY,s=this.getCumulativeTranslate();return[o*i+s.translateX,n*a+s.translateY]},e.prototype.moveCanvasPointByHtml=function(t,e,o){var n=br(t,2),r=n[0],i=n[1],a=this.getCumulativeScale();return[r+e/a.scaleX,i+o/a.scaleY]},e.prototype.fixDeltaXY=function(t,e){var o=this.getCumulativeScale();return[t/o.scaleX,e/o.scaleY]},e}(mr),Mr=function(){return Mr=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Mr.apply(this,arguments)},wr=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},Or=function(t){var e="function"==typeof Symbol&&Symbol.iterator,o=e&&t[e],n=0;if(o)return o.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},_r=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},Sr=function(t,e,o){if(o||2===arguments.length)for(var n,r=0,i=e.length;r<i;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))},Tr=function(){function t(t){var e,o,n=this;this.modelMap=new Map,this.nodeModelMap=new Map,this.edgeModelMap=new Map,this.elementsModelMap=new Map,this.nodeMoveRules=[],this.nodeResizeRules=[],this.nodes=[],this.edges=[],this.overlapMode=lt.DEFAULT,this.gridSize=1,this.partial=!1,this.waitCleanEffects=[];var r,i=t.container,a=t.partial,d=t.background,p=void 0===d?{}:d,c=t.grid,u=t.idGenerator,h=t.edgeGenerator,f=t.animation,y=t.customTrajectory;this.rootEl=i,this.partial=!!a,this.background=p,"object"==typeof c&&t.snapGrid&&(this.gridSize=c.size||1),this.customStyles=t.style||{},this.grid=tr.getGridOptions(null!=c&&c),this.theme=To(t.style,t.themeMode),this.theme.grid=s(this.grid),this.theme.background=s(this.background),this.edgeType=t.edgeType||"polyline",this.animation=(r=f)&&"boolean"!=typeof r?l(s(et),r):s(!0===r?ot:et),this.overlapMode=t.overlapMode||lt.DEFAULT,this.width=null!==(e=t.width)&&void 0!==e?e:this.rootEl.getBoundingClientRect().width,this.isContainerWidth=v(t.width),this.height=null!==(o=t.height)&&void 0!==o?o:this.rootEl.getBoundingClientRect().height,this.isContainerHeight=v(t.height);var g,m,x=new ResizeObserver(w(function(t){var e,o;try{for(var r=Or(t),i=r.next();!i.done;i=r.next()){var a=i.value;a.target===n.rootEl&&(n.resize(),n.eventCenter.emit("graph:resize",{target:n.rootEl,contentRect:a.contentRect}))}}catch(s){e={error:s}}finally{try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(e)throw e.error}}},16));x.observe(this.rootEl),this.waitCleanEffects.push(function(){x.disconnect()}),this.eventCenter=new Bn,this.editConfigModel=new kn(t),this.transformModel=new Er(this.eventCenter,t),this.flowId=Ce(),this.idGenerator=u,this.edgeGenerator=(g=this,"function"!=typeof(m=h)?function(t,e,o){return Object.assign({type:g.edgeType},o)}:function(t,e,o){var n=m(t,e,o);return n?"string"==typeof n?Object.assign({},o,{type:n}):Object.assign({type:n},o):{type:g.edgeType}}),this.customTrajectory=y}return Object.defineProperty(t.prototype,"nodesMap",{get:function(){return this.nodes.reduce(function(t,e,o){return t[e.id]={index:o,model:e},t},{})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"edgesMap",{get:function(){return this.edges.reduce(function(t,e,o){return t[e.id]={index:o,model:e},t},{})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"modelsMap",{get:function(){return Sr(Sr([],_r(this.nodes),!1),_r(this.edges),!1).reduce(function(t,e){return t[e.id]=e,t},{})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sortElements",{get:function(){for(var t=Sr(Sr([],_r(this.nodes),!1),_r(this.edges),!1).sort(function(t,e){return t.zIndex-e.zIndex}),e=[],o=[-200,-200],n=[this.width+ct,this.height+ct],r=0;r<t.length;r++){var i=t[r];i.visible&&(!this.partial||i.isSelected||this.isElementInArea(i,o,n,!1,!1))&&e.push(i)}return e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textEditElement",{get:function(){var t=this.nodes.find(function(t){return t.state===rt.TEXT_EDIT}),e=this.edges.find(function(t){return t.state===rt.TEXT_EDIT});return t||e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectElements",{get:function(){var t=new Map;return this.nodes.forEach(function(e){e.isSelected&&t.set(e.id,e)}),this.edges.forEach(function(e){e.isSelected&&t.set(e.id,e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectNodes",{get:function(){var t=[];return this.nodes.forEach(function(e){e.isSelected&&t.push(e)}),t},enumerable:!1,configurable:!0}),t.prototype.getAreaElement=function(t,e,o,n,r){var i=this;void 0===o&&(o=!0),void 0===n&&(n=!0),void 0===r&&(r=!1);var a=[];return u(Sr(Sr([],_r(this.nodes),!1),_r(this.edges),!1),function(s){var l=i.isElementInArea(s,t,e,o,n);r&&!s.visible||!l||a.push(s)}),a},t.prototype.getModel=function(t){return this.modelMap.get(t)},t.prototype.getNodeModelById=function(t){var e;return this.fakeNode&&t===this.fakeNode.id?this.fakeNode:null===(e=this.nodesMap[t])||void 0===e?void 0:e.model},t.prototype.getPointByClient=function(t){var e=t.x,o=t.y,n=this.rootEl.getBoundingClientRect(),r={x:e-n.left,y:o-n.top},i=_r(this.transformModel.HtmlPointToCanvasPoint([r.x,r.y]),2);return{domOverlayPosition:r,canvasOverlayPosition:{x:i[0],y:i[1]}}},t.prototype.isElementInArea=function(t,e,o,n,r){var i;if(void 0===n&&(n=!0),void 0===r&&(r=!0),t.BaseType===it.NODE){for(var a=Me(t),s=a.minX,l=a.minY,d=a.maxX,p=a.maxY,c=[{x:s,y:l},{x:d,y:l},{x:d,y:p},{x:s,y:p}],u=r,h=0;h<c.length;h++){var f=c[h],y=f.x,g=f.y;if(y=(i=_r(this.transformModel.CanvasPointToHtmlPoint([y,g]),2))[0],g=i[1],te([y,g],e,o)!==r){u=!r;break}}return u}if(t.BaseType===it.EDGE){var v=t.startPoint,m=t.endPoint,x=this.transformModel.CanvasPointToHtmlPoint([v.x,v.y]),b=this.transformModel.CanvasPointToHtmlPoint([m.x,m.y]),E=te(x,e,o),M=te(b,e,o);return n?E&&M:E||M}return!1},t.prototype.graphDataToModel=function(t){var e=this;if(t)if(this.elementsModelMap.clear(),this.nodeModelMap.clear(),this.edgeModelMap.clear(),t.nodes?this.nodes=f(t.nodes,function(t){var o=e.getModelAfterSnapToGrid(t);return e.elementsModelMap.set(o.id,o),e.nodeModelMap.set(o.id,o),o}):this.nodes=[],t.edges){var o=this.edgeType;this.edges=f(t.edges,function(t){var n,r=e.getModel(null!==(n=t.type)&&void 0!==n?n:o);if(!r)throw new Error("找不到".concat(t.type,"对应的边。"));var i=new r(t,e);return e.edgeModelMap.set(i.id,i),e.elementsModelMap.set(i.id,i),i})}else this.edges=[];else this.clearData()},t.prototype.modelToGraphData=function(){var t=[];this.edges.forEach(function(e){var o=e.getData();o&&!e.virtual&&t.push(o)});var e=[];return this.nodes.forEach(function(t){var o=t.getData();o&&!t.virtual&&e.push(o)}),{nodes:e,edges:t}},t.prototype.modelToHistoryData=function(){for(var t=!1,e=[],o=0;o<this.nodes.length;o++){var n=this.nodes[o];if(n.isDragging){t=!0;break}e.push(n.getHistoryData())}if(t)return!1;for(var r=!1,i=[],a=0;a<this.edges.length;a++){var s=this.edges[a];if(s.isDragging){r=!0;break}i.push(s.getHistoryData())}return!r&&{nodes:e,edges:i}},t.prototype.getEdgeModelById=function(t){var e;return null===(e=this.edgesMap[t])||void 0===e?void 0:e.model},t.prototype.getElement=function(t){return this.modelsMap[t]},t.prototype.getNodeEdges=function(t){for(var e=[],o=0;o<this.edges.length;o++){var n=this.edges[o],r=n.sourceNodeId===t,i=n.targetNodeId===t;(r||i)&&e.push(n)}return e},t.prototype.getSelectElements=function(t){void 0===t&&(t=!0);var e=this.selectElements,o={nodes:[],edges:[]};return e.forEach(function(n){if(n.BaseType===it.NODE&&o.nodes.push(n.getData()),n.BaseType===it.EDGE){var r=n.getData(),i=e.get(r.sourceNodeId)&&e.get(r.targetNodeId);(t||i)&&o.edges.push(r)}}),o},t.prototype.updateAttributes=function(t,e){var o=this.getElement(t);null==o||o.updateAttributes(e)},t.prototype.changeNodeId=function(t,e){return e||(e=Ce()),this.nodesMap[e]?(console.warn("当前流程图已存在节点".concat(e,", 修改失败")),""):this.nodesMap[t]?(this.edges.forEach(function(o){o.sourceNodeId===t&&(o.sourceNodeId=e),o.targetNodeId===t&&(o.targetNodeId=e)}),this.nodesMap[t].model.id=e,this.nodesMap[e]=this.nodesMap[t],e):(console.warn("当前流程图找不到节点".concat(t,", 修改失败")),"")},t.prototype.changeEdgeId=function(t,e){return e||(e=Ce()),this.edgesMap[e]?(console.warn("当前流程图已存在边: ".concat(e,", 修改失败")),""):this.edgesMap[t]?(this.edges.forEach(function(o){o.id===t&&o.changeEdgeId(e)}),e):(console.warn("当前流程图找不到边: ".concat(e,", 修改失败")),"")},t.prototype.getTextModel=function(t){var e=this.editConfigModel,o=e.textMode,n=e.nodeTextMode,r=e.edgeTextMode;return t.BaseType===it.NODE?t.textMode||n||o||pt.TEXT:t.BaseType===it.EDGE?t.textMode||r||o||pt.TEXT:void 0},t.prototype.setTextMode=function(t,e){this.editConfigModel.updateEditConfig({textMode:t})},t.prototype.setFakeNode=function(t){this.fakeNode=t},t.prototype.removeFakeNode=function(){this.fakeNode=null},t.prototype.setModel=function(t,e){return this.modelMap.set(t,e)},t.prototype.toFront=function(t){var e,o,n,r=(null===(e=this.nodesMap[t])||void 0===e?void 0:e.model)||(null===(o=this.edgesMap[t])||void 0===o?void 0:o.model);r&&(this.overlapMode===lt.DEFAULT&&(null===(n=this.topElement)||void 0===n||n.setZIndex(),r.setZIndex(9999),this.topElement=r),this.overlapMode===lt.INCREASE&&this.setElementZIndex(t,"top"))},t.prototype.setElementZIndex=function(t,e){var o,n,r=(null===(o=this.nodesMap[t])||void 0===o?void 0:o.model)||(null===(n=this.edgesMap[t])||void 0===n?void 0:n.model);if(r){var i=void 0;"number"==typeof e?i=e:("top"===e&&(i=Co()),"bottom"===e&&(i=--Do)),r.setZIndex(i)}},t.prototype.deleteNode=function(t){var e=this.nodesMap[t].model,o=e.getData();this.deleteEdgeBySource(t),this.deleteEdgeByTarget(t),this.nodes.splice(this.nodesMap[t].index,1),this.eventCenter.emit(st.NODE_DELETE,{data:o,model:e})},t.prototype.addNode=function(t,e,o){void 0===e&&(e=st.NODE_ADD);var n=nt(t),r=n.id;r&&this.nodesMap[r]&&delete n.id;var i=this.getModelAfterSnapToGrid(n);this.nodes.push(i);var a={data:i.getData()};return o&&(a.e=o),this.eventCenter.emit(e,a),i},t.prototype.getModelAfterSnapToGrid=function(t){var e=this.getModel(t.type),o=this.editConfigModel.snapGrid;if(!e)throw new Error("找不到".concat(t.type,"对应的节点，请确认是否已注册此类型节点。"));var n=t.x,r=t.y;n&&r&&(t.x=Jt(n,this.gridSize,o),t.y=Jt(r,this.gridSize,o),"object"==typeof t.text&&null!==t.text&&(t.text.x+=t.x-n,t.text.y+=t.y-r));var i=new e(t,this);return this.nodeModelMap.set(i.id,i),this.elementsModelMap.set(i.id,i),i},t.prototype.cloneNode=function(t){var e=this.getNodeModelById(t),o=null==e?void 0:e.getData();if(o){o.x+=30,o.y+=30,o.id="","object"==typeof o.text&&null!==o.text&&(o.text.x+=30,o.text.y+=30);var n=this.addNode(o);return n.setSelected(!0),null==e||e.setSelected(!1),n.getData()}},t.prototype.moveNode=function(t,e,o,n){var r;void 0===n&&(n=!1);var i=this.nodesMap[t];if(i){var a=i.model;e=(r=_r(a.getMoveDistance(e,o,n),2))[0],o=r[1],this.moveEdge(t,e,o)}else console.warn("不存在id为".concat(t,"的节点"))},t.prototype.moveNode2Coordinate=function(t,e,o,n){void 0===n&&(n=!1);var r=this.nodesMap[t];if(r){var i=r.model,a=e-i.x,s=o-i.y;this.moveNode(t,a,s,n)}else console.warn("不存在id为".concat(t,"的节点"))},t.prototype.editText=function(t){this.setElementStateById(t,rt.TEXT_EDIT)},t.prototype.addEdge=function(t){var e=nt(t),o=e.type;o||(o=this.edgeType),e.id&&this.edgesMap[e.id]&&(delete e.id,delete e.sourceAnchorId,delete e.targetAnchorId);var n=this.getModel(o);if(!n)throw new Error("找不到".concat(o,"对应的边，请确认是否已注册此类型边。"));var r=new n(Mr(Mr({},e),{type:o}),this);this.edgeModelMap.set(r.id,r),this.elementsModelMap.set(r.id,r);var i=r.getData();return this.edges.push(r),this.eventCenter.emit(st.EDGE_ADD,{data:i}),r},t.prototype.moveEdge=function(t,e,o){for(var n=0;n<this.edges.length;n++){var r=this.edges[n],i=r.textPosition,a=i.x,s=i.y,l=this.edges[n].sourceNodeId===t,d=this.edges[n].targetNodeId===t;l&&r.moveStartPoint(e,o),d&&r.moveEndPoint(e,o),(l||d)&&this.handleEdgeTextMove(r,a,s)}},t.prototype.handleEdgeTextMove=function(t,e,o){var n;if(t.customTextPosition)t.resetTextPosition();else{if(t.modelType===at.POLYLINE_EDGE&&(null===(n=t.text)||void 0===n?void 0:n.value)){var r=t.text,i=Vt(r,t.points);t.moveText(i.x-r.x,i.y-r.y)}var a=t.textPosition,s=a.x,l=a.y;t.moveText(s-e,l-o)}},t.prototype.deleteEdgeBySourceAndTarget=function(t,e){for(var o=0;o<this.edges.length;o++)if(this.edges[o].sourceNodeId===t&&this.edges[o].targetNodeId===e){var n=this.edges[o].getData();this.edges.splice(o,1),o--,this.eventCenter.emit(st.EDGE_DELETE,{data:n})}},t.prototype.deleteEdgeById=function(t){if(this.edgesMap[t]){var e=this.edgesMap[t].index,o=this.edgesMap[t].model.getData();this.edges.splice(e,1),this.eventCenter.emit(st.EDGE_DELETE,{data:o})}},t.prototype.deleteEdgeBySource=function(t){for(var e=0;e<this.edges.length;e++)if(this.edges[e].sourceNodeId===t){var o=this.edges[e].getData();this.edges.splice(e,1),e--,this.eventCenter.emit(st.EDGE_DELETE,{data:o})}},t.prototype.deleteEdgeByTarget=function(t){for(var e=0;e<this.edges.length;e++)if(this.edges[e].targetNodeId===t){var o=this.edges[e].getData();this.edges.splice(e,1),e--,this.eventCenter.emit(st.EDGE_DELETE,{data:o})}},t.prototype.setElementStateById=function(t,e,o){this.nodes.forEach(function(n){n.id===t?n.setElementState(e,o):n.setElementState(rt.DEFAULT)}),this.edges.forEach(function(n){n.id===t?n.setElementState(e,o):n.setElementState(rt.DEFAULT)})},t.prototype.updateText=function(t,e){var o=y(Sr(Sr([],_r(this.nodes),!1),_r(this.edges),!1),function(e){return e.id===t});null==o||o.updateText(e)},t.prototype.selectNodeById=function(t,e){var o;void 0===e&&(e=!1),e||this.clearSelectElements();var n=null===(o=this.nodesMap[t])||void 0===o?void 0:o.model;null==n||n.setSelected(!0)},t.prototype.selectEdgeById=function(t,e){var o;void 0===e&&(e=!1),e||this.clearSelectElements();var n=null===(o=this.edgesMap[t])||void 0===o?void 0:o.model;null==n||n.setSelected(!0)},t.prototype.selectElementById=function(t,e){void 0===e&&(e=!1),e||this.clearSelectElements();var o=this.getElement(t);null==o||o.setSelected(!0)},t.prototype.deselectElementById=function(t){var e=this.getElement(t);e&&e.setSelected(!1)},t.prototype.clearSelectElements=function(){var t;this.selectElements.forEach(function(t){null==t||t.setSelected(!1)}),this.selectElements.clear(),this.overlapMode===lt.DEFAULT&&(null===(t=this.topElement)||void 0===t||t.setZIndex())},t.prototype.moveNodes=function(t,e,o,n){var r,i,a,s=this;void 0===n&&(n=!1);for(var l=t.reduce(function(t,r){var i,a=null===(i=s.nodesMap[r])||void 0===i?void 0:i.model;return a&&(t[r]=a.getMoveDistance(e,o,n)),t},{}),d=0;d<this.edges.length;d++){var p=this.edges[d],c=p.textPosition,u=c.x,h=c.y,f=l[p.sourceNodeId],y=l[p.targetNodeId],g=void 0,v=void 0;f&&y&&p.modelType===at.POLYLINE_EDGE?(g=(r=_r(f,2))[0],v=r[1],p.updatePointsList(g,v)):(f&&(g=(i=_r(f,2))[0],v=i[1],p.moveStartPoint(g,v)),y&&(g=(a=_r(y,2))[0],v=a[1],p.moveEndPoint(g,v))),(f||y)&&this.handleEdgeTextMove(p,u,h)}},t.prototype.addNodeMoveRules=function(t){this.nodeMoveRules.includes(t)||this.nodeMoveRules.push(t)},t.prototype.addNodeResizeRules=function(t){this.nodeResizeRules.includes(t)||this.nodeResizeRules.push(t)},t.prototype.setDefaultEdgeType=function(t){this.edgeType=t},t.prototype.changeNodeType=function(t,e){var o=this.getNodeModelById(t);if(o){var n=o.getData();n.type=e;var r=this.getModel(e);if(!r)throw new Error("找不到".concat(e,"对应的节点，请确认是否已注册此类型节点。"));var i=new r(n,this);this.nodes.splice(this.nodesMap[t].index,1,i),this.getNodeEdges(t).forEach(function(e){if(e.sourceNodeId===t){var o=Pe(i,e.startPoint,i.width,i.height);e.updateStartPoint(o)}if(e.targetNodeId===t){o=Pe(i,e.endPoint,i.width,i.height);e.updateEndPoint(o)}})}else console.warn("找不到id为".concat(t,"的节点"))},t.prototype.changeEdgeType=function(t,e){var o=this.getEdgeModelById(t);if(o){if(o.type!==e){var n=o.getData();n.type=e;var r=this.getModel(e);if(!r)throw new Error("找不到".concat(e,"对应的节点，请确认是否已注册此类型节点。"));delete n.pointsList;var i=new r(n,this);this.edges.splice(this.edgesMap[t].index,1,i)}}else console.warn("找不到id为".concat(t,"的边"))},t.prototype.getNodeIncomingEdge=function(t){var e=[];return this.edges.forEach(function(o){o.targetNodeId===t&&e.push(o)}),e},t.prototype.getNodeOutgoingEdge=function(t){var e=[];return this.edges.forEach(function(o){o.sourceNodeId===t&&e.push(o)}),e},t.prototype.getAnchorIncomingEdge=function(t){var e=[];return this.edges.forEach(function(o){o.targetAnchorId===t&&e.push(o)}),e},t.prototype.getAnchorOutgoingEdge=function(t){var e=[];return this.edges.forEach(function(o){o.sourceAnchorId===t&&e.push(o)}),e},t.prototype.getNodeIncomingNode=function(t){var e=this,o=[];return this.edges.forEach(function(n){var r;n.targetNodeId===t&&o.push(null===(r=e.nodesMap[n.sourceNodeId])||void 0===r?void 0:r.model)}),o},t.prototype.getNodeOutgoingNode=function(t){var e=this,o=[];return this.edges.forEach(function(n){n.sourceNodeId===t&&o.push(e.nodesMap[n.targetNodeId].model)}),o},t.prototype.setTheme=function(t,e){var o;if(e&&(Oo[e]&&this.updateBackgroundOptions(Mr(Mr({},"object"==typeof this.background?this.background:{}),Oo[e])),So[e]&&this.updateGridOptions(tr.getGridOptions(Mr(Mr({},this.grid),So[e])))),t.background&&this.updateBackgroundOptions(t.background),t.grid){var n=tr.getGridOptions(null!==(o=t.grid)&&void 0!==o&&o);this.updateGridOptions(n)}this.theme=Ao(Mr(Mr({},this.customStyles),t),e),this.customStyles=Mr(Mr({},this.customStyles),t)},t.prototype.getTheme=function(){var t=this.background,e=this.grid;return Mr(Mr({},s(this.theme)),{background:t,grid:e})},t.prototype.updateGridOptions=function(t){l(this.grid,t)},t.prototype.updateGridSize=function(t){this.gridSize=t},t.prototype.updateBackgroundOptions=function(t){E(t)||E(this.background)?this.background=t:this.background=Mr(Mr({},this.background),t)},t.prototype.resize=function(t,e){this.width=null!=t?t:this.rootEl.getBoundingClientRect().width,this.isContainerWidth=v(t),this.height=null!=e?e:this.rootEl.getBoundingClientRect().height,this.isContainerHeight=v(e),this.width&&this.height||console.warn("渲染画布的时候无法获取画布宽高，请确认在container已挂载到DOM。@see https://github.com/didi/LogicFlow/issues/675")},t.prototype.clearData=function(){this.nodes=[],this.edges=[],this.edgeModelMap.clear(),this.nodeModelMap.clear(),this.elementsModelMap.clear()},t.prototype.getVirtualRectSize=function(){var t=this.nodes,e=[],o=[];t.forEach(function(t){var n=t.x,r=t.y,i=t.width,a=t.height,s=t.getNodeStyle().strokeWidth,l=void 0===s?0:s,d=n+i/2+l,p=n-i/2-l,c=r+a/2+l,u=r-a/2-l;e=e.concat([d,p].filter(function(t){return!Number.isNaN(t)})),o=o.concat([c,u].filter(function(t){return!Number.isNaN(t)}))});var n=Math.min.apply(Math,Sr([],_r(e),!1)),r=Math.max.apply(Math,Sr([],_r(e),!1)),i=Math.min.apply(Math,Sr([],_r(o),!1)),a=r-n||0,s=Math.max.apply(Math,Sr([],_r(o),!1))-i||0;return{width:a,height:s,x:n+a/2,y:i+s/2}},t.prototype.translateCenter=function(){var t=this,e=t.nodes,o=t.width,n=t.height,r=t.rootEl,i=t.transformModel;if(e.length){var a=o||r.clientWidth,s=n||r.clientHeight,l=this.getVirtualRectSize(),d=l.x,p=l.y;i.focusOn(d,p,a,s)}},t.prototype.fitView=function(t,e){void 0===t&&(t=20),void 0===e&&(e=20);var o=this,n=o.nodes,r=o.width,i=o.height,a=o.rootEl,s=o.transformModel;if(n.length){var l=r||a.clientWidth,d=i||a.clientHeight,p=this.getVirtualRectSize(),c=p.width,u=p.height,h=p.x,f=p.y,y=(c+e)/l,g=(u+t)/d,v=1/Math.max(y,g),m=[l/2,d/2];s.zoom(v,m),s.focusOn(h,f,l,d)}},t.prototype.openEdgeAnimation=function(t){var e=this.getEdgeModelById(t);null==e||e.openEdgeAnimation()},t.prototype.closeEdgeAnimation=function(t){var e=this.getEdgeModelById(t);null==e||e.closeEdgeAnimation()},t.prototype.getPartial=function(){return this.partial},t.prototype.setPartial=function(t){this.partial=t},t.prototype.destroy=function(){try{this.waitCleanEffects.forEach(function(t){t()})}catch(t){console.warn("error on destroy GraphModel",t)}this.waitCleanEffects.length=0,this.eventCenter.destroy()},wr([X],t.prototype,"width",void 0),wr([X],t.prototype,"height",void 0),wr([X],t.prototype,"theme",void 0),wr([X],t.prototype,"grid",void 0),wr([X],t.prototype,"edgeType",void 0),wr([X],t.prototype,"nodes",void 0),wr([X],t.prototype,"edges",void 0),wr([X],t.prototype,"fakeNode",void 0),wr([X],t.prototype,"overlapMode",void 0),wr([X],t.prototype,"background",void 0),wr([X],t.prototype,"gridSize",void 0),wr([X],t.prototype,"transformModel",void 0),wr([X],t.prototype,"editConfigModel",void 0),wr([X],t.prototype,"partial",void 0),wr([z],t.prototype,"nodesMap",null),wr([z],t.prototype,"edgesMap",null),wr([z],t.prototype,"modelsMap",null),wr([z],t.prototype,"sortElements",null),wr([z],t.prototype,"textEditElement",null),wr([z],t.prototype,"selectElements",null),wr([z],t.prototype,"selectNodes",null),wr([H],t.prototype,"setTextMode",null),wr([H],t.prototype,"setFakeNode",null),wr([H],t.prototype,"removeFakeNode",null),wr([H],t.prototype,"setModel",null),wr([H],t.prototype,"toFront",null),wr([H],t.prototype,"setElementZIndex",null),wr([H],t.prototype,"deleteNode",null),wr([H],t.prototype,"addNode",null),wr([H],t.prototype,"cloneNode",null),wr([H],t.prototype,"moveNode",null),wr([H],t.prototype,"moveNode2Coordinate",null),wr([H],t.prototype,"editText",null),wr([H],t.prototype,"addEdge",null),wr([H],t.prototype,"moveEdge",null),wr([H],t.prototype,"deleteEdgeBySourceAndTarget",null),wr([H],t.prototype,"deleteEdgeById",null),wr([H],t.prototype,"deleteEdgeBySource",null),wr([H],t.prototype,"deleteEdgeByTarget",null),wr([H],t.prototype,"setElementStateById",null),wr([H],t.prototype,"updateText",null),wr([H],t.prototype,"selectNodeById",null),wr([H],t.prototype,"selectEdgeById",null),wr([H],t.prototype,"selectElementById",null),wr([H],t.prototype,"deselectElementById",null),wr([H],t.prototype,"clearSelectElements",null),wr([H],t.prototype,"moveNodes",null),wr([H],t.prototype,"setDefaultEdgeType",null),wr([H],t.prototype,"changeNodeType",null),wr([H],t.prototype,"changeEdgeType",null),wr([H],t.prototype,"getNodeIncomingEdge",null),wr([H],t.prototype,"getNodeOutgoingEdge",null),wr([H],t.prototype,"getAnchorIncomingEdge",null),wr([H],t.prototype,"getAnchorOutgoingEdge",null),wr([H],t.prototype,"getNodeIncomingNode",null),wr([H],t.prototype,"getNodeOutgoingNode",null),wr([H],t.prototype,"setTheme",null),wr([H],t.prototype,"getTheme",null),wr([H],t.prototype,"resize",null),wr([H],t.prototype,"clearData",null),wr([H],t.prototype,"translateCenter",null),wr([H],t.prototype,"fitView",null),wr([H],t.prototype,"openEdgeAnimation",null),wr([H],t.prototype,"closeEdgeAnimation",null),wr([H],t.prototype,"setPartial",null),t}(),Pr=function(){return Pr=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Pr.apply(this,arguments)},Ar=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},Nr=function(){function t(t,e){void 0===e&&(e=1),this.isShowHorizontal=!1,this.isShowVertical=!1,this.position={x:0,y:0},this.graphModel=t,this.epsilon=e}return t.prototype.getStyle=function(){return Pr({},this.graphModel.theme.snapline)},t.prototype.getCenterSnapLine=function(t,e){for(var o=t.x,n=t.y,r=!1,i=!1,a=0;a<e.length;a++){var s=e[a];if(s.id!==t.id&&(Dr(o,s.x,this.epsilon)&&(r=!0),Dr(n,s.y,this.epsilon)&&(i=!0),r&&i))break}return{isShowVertical:r,isShowHorizontal:i,position:{x:o,y:n}}},t.prototype.getHorizontalSnapline=function(t,e){var o,n=!1,r=0,i=t.id;if(i){var a=this.graphModel.fakeNode;if(a&&a.id===i)o=Me(a);else{var s=this.graphModel.getNodeModelById(i);s&&(o=Me(s))}}for(var l=0;l<e.length;l++){var d=e[l];if(d.id!==t.id){var p=Me(d);if(Dr(p.minY,null==o?void 0:o.minY,this.epsilon)||Dr(p.maxY,null==o?void 0:o.minY,this.epsilon)){n=!0,r=o.minY;break}if(Dr(p.minY,null==o?void 0:o.maxY,this.epsilon)||Dr(p.maxY,null==o?void 0:o.maxY,this.epsilon)){n=!0,r=o.maxY;break}}}return{isShowHorizontal:n,isShowVertical:this.isShowVertical,position:Pr(Pr({},this.position),{y:r})}},t.prototype.getVerticalSnapline=function(t,e){var o,n=!1,r=0,i=t.id;if(i){var a=this.graphModel.fakeNode;if(a&&a.id===i)o=Me(a);else{var s=this.graphModel.getNodeModelById(i);s&&(o=Me(s))}}for(var l=0;l<e.length;l++){var d=e[l];if(d.id!==t.id){var p=Me(d);if(Dr(p.minX,null==o?void 0:o.minX,this.epsilon)){n=!0,r=o.minX;break}if(Dr(p.minX,null==o?void 0:o.minX,this.epsilon)||Dr(p.maxX,null==o?void 0:o.minX,this.epsilon)){n=!0,r=o.minX;break}if(Dr(p.minX,null==o?void 0:o.maxX,this.epsilon)||Dr(p.maxX,null==o?void 0:o.maxX,this.epsilon)){n=!0,r=o.maxX;break}}}return{isShowHorizontal:this.isShowHorizontal,isShowVertical:n,position:Pr(Pr({},this.position),{x:r})}},t.prototype.getSnapLinePosition=function(t,e){var o=this.getCenterSnapLine(t,e),n=o.isShowHorizontal,r=o.isShowVertical;if(!n){var i=this.getHorizontalSnapline(t,e);i.isShowHorizontal&&(o.isShowHorizontal=i.isShowHorizontal,o.position.y=i.position.y)}if(!r){var a=this.getVerticalSnapline(t,e);a.isShowVertical&&(o.isShowVertical=a.isShowVertical,o.position.x=a.position.x)}return o},t.prototype.setSnaplineInfo=function(t){var e=t.isShowHorizontal,o=t.isShowVertical,n=t.position;this.position=n,this.isShowHorizontal=e,this.isShowVertical=o},t.prototype.clearSnapline=function(){this.position={x:0,y:0},this.isShowHorizontal=!1,this.isShowVertical=!1},t.prototype.setNodeSnapLine=function(t){var e=this.graphModel.nodes,o=this.getSnapLinePosition(t,e);this.setSnaplineInfo(o)},Ar([X],t.prototype,"isShowHorizontal",void 0),Ar([X],t.prototype,"isShowVertical",void 0),Ar([X],t.prototype,"position",void 0),Ar([H],t.prototype,"clearSnapline",null),Ar([H],t.prototype,"setNodeSnapLine",null),t}();function Dr(t,e,o){return Math.abs(t-e)<=o}var Cr,jr=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Lr=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},Ir=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},Rr=function(t,e,o){if(o||2===arguments.length)for(var n,r=0,i=e.length;r<i;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))},kr=function(t){function o(){var e=t.apply(this,Rr([],Ir(arguments),!1))||this;return e.handleResize=function(){var t=e.props,o=t.graphModel,n=t.options,r=o.width,i=o.height,a=r,s=i,l=!1;o.isContainerWidth&&(a=void 0,l=!0),o.isContainerHeight&&(s=void 0,l=!0),l&&o.resize(a,s),n.width=r,n.height=i},e.throttleResize=O(e.handleResize,200),e}return jr(o,t),o.prototype.componentDidMount=function(){window.addEventListener("resize",this.throttleResize)},o.prototype.componentDidUpdate=function(){var t=this.props.graphModel.modelToGraphData();this.props.graphModel.eventCenter.emit(st.GRAPH_UPDATED,{data:t})},o.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.throttleResize)},o.prototype.getComponent=function(t,o,n){void 0===n&&(n="canvas-overlay");var r=(0,this.props.getView)(t.type);return r?e(r,{model:t,graphModel:o,overlay:n},t.id):null},o.prototype.render=function(){var t=this,o=this.props,n=o.graphModel,r=o.tool,i=o.options,a=o.dnd,s=o.snaplineModel,l={};i.width&&(l.width="".concat(n.width,"px")),i.height&&(l.height="".concat(n.height,"px"));var d=n.fakeNode,p=n.editConfigModel,c=n.background,u=p.adjustEdge;return e("div",{className:"lf-graph","flow-id":n.flowId,style:l,children:[e(Gn,{graphModel:n,dnd:a,children:[e("g",{className:"lf-base",children:f(n.sortElements,function(e){return t.getComponent(e,n)})}),d?this.getComponent(d,n):""]}),e(nr,{graphModel:n,children:[e(sr,{graphModel:n}),u?e(Zn,{graphModel:n}):"",!1!==i.snapline?e(cr,{snaplineModel:s}):""]}),e(fr,{graphModel:n,tool:r}),c&&e(Jn,{background:c}),e(tr,{graphModel:n})]})},o=Lr([_a],o)}(o),Br=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Xr=function(){return Xr=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Xr.apply(this,arguments)},zr=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},Hr=function(t){function o(){var e=t.call(this)||this;return e.onDragStart=function(t){var o=t.event,n=e.props,r=n.anchorData,i=n.nodeModel,a=n.graphModel;a.selectNodeById(i.id),i.autoToFront&&a.toFront(i.id),a.eventCenter.emit(st.ANCHOR_DRAGSTART,{data:r,e:o,nodeModel:i}),e.setState({startX:r.x,startY:r.y,endX:r.x,endY:r.y})},e.onDragging=function(t){var o=t.event,n=e.props,r=n.graphModel,i=n.nodeModel,a=n.anchorData,s=r.transformModel,l=r.eventCenter,d=r.width,p=r.height,c=r.editConfigModel,u=c.autoExpand,h=c.stopMoveGraph;if(o){var f=o.clientX,y=o.clientY,g=r.getPointByClient({x:f,y:y}),v=g.domOverlayPosition,m=v.x,x=v.y,b=g.canvasOverlayPosition,E=b.x,M=b.y;e.t&&Ie(e.t);var w=[];m<10?w=[10,0]:m+10>d?w=[-10,0]:x<10?w=[0,10]:x+10>p&&(w=[0,-10]),e.setState({endX:E,endY:M,dragging:!0}),e.moveAnchorEnd(E,M),w.length>0&&!h&&u&&(e.t=Le(function(){var t=zr(w,2),o=t[0],n=t[1];s.translate(o,n);var r=e.state,i=r.endX,a=r.endY;e.setState({endX:i-o,endY:a-n}),e.moveAnchorEnd(i-o,a-n)})),l.emit(st.ANCHOR_DRAG,{data:a,e:o,nodeModel:i})}},e.onDragEnd=function(t){var o=t.event;e.t&&Ie(e.t);var n=e.checkEnd(o);e.setState({startX:0,startY:0,endX:0,endY:0,dragging:!1}),e.sourceRuleResults.clear(),e.targetRuleResults.clear();var r=e.props,i=r.graphModel,a=r.nodeModel,s=r.anchorData;i.eventCenter.emit(st.ANCHOR_DRAGEND,{data:s,e:o,nodeModel:a,edgeModel:null!=n?n:void 0})},e.checkEnd=function(t){var o,n=e.props,r=n.graphModel,i=n.nodeModel,a=n.anchorData,s=a.x,l=a.y,d=a.id,p=e.state,c=p.endX,u=p.endY,h=p.dragging,f=ve({x:c,y:u},r);if(e.preTargetNode&&e.preTargetNode.state!==rt.DEFAULT&&e.preTargetNode.setElementState(rt.DEFAULT),h&&f&&f.node){var y=f.node,g=f.anchor.id,v="".concat(i.id,"_").concat(y.id,"_").concat(g,"_").concat(d),m=e.sourceRuleResults.get(v)||{},x=m.isAllPass,b=m.msg,E=e.targetRuleResults.get(v)||{},M=E.isAllPass,w=E.msg;if(x&&M){y.setElementState(rt.DEFAULT);var O=r.getNodeModelById(f.node.id),_=null===(o=r.edgeGenerator)||void 0===o?void 0:o.call(r,i.getData(),null==O?void 0:O.getData()),S=r.addEdge(Xr(Xr({},_),{sourceNodeId:i.id,sourceAnchorId:d,startPoint:{x:s,y:l},targetNodeId:f.node.id,targetAnchorId:f.anchor.id,endPoint:{x:f.anchor.x,y:f.anchor.y}})),T=e.props.anchorData;return r.eventCenter.emit(st.ANCHOR_DROP,{data:T,e:t,nodeModel:i,edgeModel:S}),S}var P=y.getData();return r.eventCenter.emit(st.CONNECTION_NOT_ALLOWED,{data:P,msg:w||b||"不允许添加连线"}),null}},e.sourceRuleResults=new Map,e.targetRuleResults=new Map,e.state={startX:0,startY:0,endX:0,endY:0,dragging:!1},e.dragHandler=new ut({onDragStart:e.onDragStart,onDragging:e.onDragging,onDragEnd:e.onDragEnd}),e}return Br(o,t),o.prototype.getAnchorShape=function(){var t=this.props,o=t.anchorData,n=t.style,r=t.node.getAnchorShape(o);if(r)return r;var i=o.x,a=o.y,s=Xr(Xr({},n),null==n?void 0:n.hover);return e("g",{children:[e(qe,Xr({className:"lf-node-anchor-hover"},s,{x:i,y:a})),e(qe,Xr({className:"lf-node-anchor"},n,{x:i,y:a}))]})},Object.defineProperty(o.prototype,"customTrajectory",{get:function(){return this.props.graphModel.customTrajectory},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"relateEdges",{get:function(){var t=this.props,e=t.graphModel,o=e.getAnchorIncomingEdge,n=e.getAnchorOutgoingEdge,r=t.anchorData.id;return{incomingEdgeList:o(r),outgoingEdgeList:n(r)}},enumerable:!1,configurable:!0}),o.prototype.moveAnchorEnd=function(t,e){var o,n,r=this.props,i=r.graphModel,a=r.nodeModel,s=r.anchorData,l=ve({x:t,y:e},i);if(l){var d=l.node,p=l.anchor.id;if(this.preTargetNode&&this.preTargetNode!==l.node&&this.preTargetNode.setElementState(rt.DEFAULT),s.id===p)return;this.preTargetNode=d;var c="".concat(a.id,"_").concat(d.id,"_").concat(p,"_").concat(s.id);if(!this.targetRuleResults.has(c)){var u=l.anchor,h=a.isAllowConnectedAsSource(d,s,u),f=d.isAllowConnectedAsTarget(a,s,u);this.sourceRuleResults.set(c,De(h)),this.targetRuleResults.set(c,De(f))}var y=(null!==(o=this.sourceRuleResults.get(c))&&void 0!==o?o:{}).isAllPass,g=(null!==(n=this.targetRuleResults.get(c))&&void 0!==n?n:{}).isAllPass;y&&g?d.setElementState(rt.ALLOW_CONNECT):d.setElementState(rt.NOT_ALLOW_CONNECT)}else this.preTargetNode&&this.preTargetNode.state!==rt.DEFAULT&&this.preTargetNode.setElementState(rt.DEFAULT)},o.prototype.isShowLine=function(){var t=this.state,e=t.startX,o=t.startY,n=t.endX,r=t.endY;return xe(e,o,n,r)>10},o.prototype.render=function(){var t=this,o=this.state,n=o.startX,r=o.startY,i=o.endX,a=o.endY,s=this.props,l=s.anchorData,d=s.edgeStyle,p=s.nodeModel,c=s.graphModel,u=l.edgeAddable;return e("g",{className:"lf-anchor",children:[e("g",{onClick:function(t){t.stopPropagation(),c.eventCenter.emit(st.ANCHOR_CLICK,{data:l,e:t,nodeModel:p})},onMouseDown:function(e){c.eventCenter.emit(st.ANCHOR_MOUSEDOWN,{data:l,e:e,nodeModel:p}),!1!==u&&t.dragHandler.handleMouseDown(e)},children:this.getAnchorShape()}),this.isShowLine()&&(this.customTrajectory?this.customTrajectory(Xr({sourcePoint:{x:n,y:r},targetPoint:{x:i,y:a}},d)):e(He,Xr({x1:n,y1:r,x2:i,y2:a},d,{"pointer-events":"none"})))]})},o}(o),Gr=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Yr=function(){return Yr=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Yr.apply(this,arguments)},Fr=function(t){function o(e){var o=t.call(this,e)||this;return o.style={},o.onDragging=function(t){var e,n=t.event,r=o.props,i=r.graphModel,a=r.nodeModel,s=r.eventCenter,l=i.selectNodes,d=a.x,p=a.y,c=n.clientX,u=n.clientY,h=i.getPointByClient({x:c,y:u}).canvasOverlayPosition,y=h.x,g=h.y,v=new ie(y-d,g-p),m=(null===(e=o.normal)||void 0===e?void 0:e.angle(v))-o.defaultAngle,x=new he(-d,-p).rotate(m).translate(d,p).toString();a.transform=x,a.rotate=m;var b=f(l,function(t){return t.id});-1===b.indexOf(a.id)&&(b=[a.id]);var E=_(b,function(t,e){var o=i.getNodeModelById(e);return t[e]=null==o?void 0:o.getMoveDistance(0,0,!1),t},{});b.forEach(function(t){i.getNodeEdges(t).forEach(function(t){if(E[t.sourceNodeId]){var e=i.getNodeModelById(t.sourceNodeId).anchors.find(function(e){return e.id===t.sourceAnchorId});t.updateStartPoint(e)}if(E[t.targetNodeId]){e=i.getNodeModelById(t.targetNodeId).anchors.find(function(e){return e.id===t.targetAnchorId});t.updateEndPoint(e)}})}),s.emit(st.NODE_ROTATE,{e:n,model:a,data:a.getData()})},o.style=e.style,o.stepperDrag=new ut({onDragging:o.onDragging}),o}return Gr(o,t),o.prototype.render=function(){var t=this,o=this.props.nodeModel,n=o.x,r=o.y,i=n+o.width/2+20,a=r-o.height/2-20;return this.normal=new ie(1,0),this.defaultAngle=this.normal.angle(new ie(i-n,a-r)),o.defaultAngle=this.defaultAngle,e("g",{className:"lf-rotate-control",children:e("g",{onMouseDown:function(e){t.stepperDrag.handleMouseDown(e)},children:e(qe,Yr({},this.style,{cx:i,cy:a}))})})},o}(o),Wr=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Ur=function(){return Ur=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Ur.apply(this,arguments)},Vr=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},Zr=function(t){function o(e){var o=t.call(this)||this;o.mouseDownHandler=function(t){var e=o.props,n=e.draggable,r=e.model,i=e.graphModel.editConfigModel.nodeTextDraggable;(null!=n?n:i)&&(t.stopPropagation(),o.stepperDrag.model=r,o.stepperDrag.handleMouseDown(t))},o.onDragging=function(t){var e=t.deltaX,n=t.deltaY,r=o.props,i=r.model,a=r.graphModel.transformModel;if(e||n){var s=Vr(a.fixDeltaXY(e,n),2),l=s[0],d=s[1];i.moveText(l,d)}},o.dbClickHandler=function(){var t=o.props,e=t.editable,n=t.graphModel.eventCenter,r=t.model;e&&r.setElementState(rt.TEXT_EDIT),n.emit(st.TEXT_DBCLICK,{data:r.text,model:r})};var n=e.draggable;return o.stepperDrag=new ut({onDragging:o.onDragging,step:1,eventType:"TEXT",isStopPropagation:n}),o}return Wr(o,t),o.prototype.getShape=function(){var t=this.props,o=t.model,n=t.graphModel.editConfigModel,r=o.text,i=r.value,a=r.x,s=r.y,l=r.editable,d=r.draggable,p={x:a,y:s,className:"",value:i},c=o.getTextStyle(),u=n.nodeTextDraggable||d;return e(Be,Ur({},p,c,{className:F({"lf-element-text":l,"lf-text-draggable":!l&&u,"lf-text-disabled":!l&&!u}),model:o}))},o.prototype.render=function(){if(this.props.model.text)return e("g",{onMouseDown:this.mouseDownHandler,onDblClick:this.dbClickHandler,children:this.getShape()})},o}(o),Kr=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),qr=function(){return qr=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},qr.apply(this,arguments)},Jr=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},$r=function(t){function o(e){var o=t.call(this,e)||this;return o.setHoverOn=function(){o.setState({isHovered:!0})},o.setHoverOff=function(){o.setState({isHovered:!1})},o.state={isHovered:!1},o}return Kr(o,t),o.prototype.getBackground=function(){var t=this.state.isHovered,o=this.props.model,n=o.text,r=o.getTextStyle(),i=r.background||{};if(t&&r.hover&&r.hover.background&&(i=qr(qr({},i),r.hover.background)),(null==n?void 0:n.value)&&"transparent"!==(null==i?void 0:i.fill)){var a=r.fontSize,s=r.textWidth,l=r.lineHeight,d=r.overflowMode,p=i.wrapPadding,c=null==n?void 0:n.value.split(/[\r\n]/g),h=c.length,f=n.x,y=n.y,g={};if("autoWrap"===d&&s){var v=Ae({rows:c,style:{fontSize:"".concat(a,"px"),width:"".concat(s,"px"),lineHeight:l,padding:p},rowsLength:h,className:"lf-get-text-height"});g=qr(qr({},i),{x:f,y:y,width:s,height:v})}else{var m=function(t){var e=t.rows,o=t.rowsLength,n=t.fontSize,r=0;return u(e,function(t){var e=Gt(t);r=e>r?e:r}),{width:Math.ceil(r/2)*n+n/4,height:o*(n+2)+n/4}}({rows:c,rowsLength:h,fontSize:a}),x=m.width,b=m.height;if("ellipsis"===d&&(x=s,b=a+2),"string"==typeof i.wrapPadding){var E=i.wrapPadding.split(",").filter(function(t){return t.trim()}).map(function(t){return parseFloat(t.trim())});if(E.length>0&&E.length<=4){if(1===E.length){var M=Jr(E,1)[0];E=[M,M,M,M]}else if(2===E.length){var w=Jr(E,2),O=w[0];E=[O,_=w[1],O,_]}else if(3===E.length){var _,S=Jr(E,3);E=[S[0],_=S[1],S[2],_]}var T=Jr(E,4),P=T[0],A=T[1],N=T[2],D=T[3];x+=A+D,b+=P+N,f+=(A-D)/2,y+=(N-P)/2}}g=qr(qr({},i),{x:f-1,y:y-1,width:x,height:b})}return e(Fe,qr({},g))}return null},o.prototype.getShape=function(){var t=this.props.model,o=t.text,n=o.x,r=o.y,i=o.value;if(!i)return null;var a=t.getTextStyle(),s=qr({x:n,y:r,value:i,model:t,className:"lf-element-text"},a);return e("g",{className:"lf-line-text",onMouseEnter:this.setHoverOn,onMouseLeave:this.setHoverOff,children:[this.getBackground(),e(Be,qr({},s))]})},o}(Zr),Qr=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),ti=function(){return ti=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},ti.apply(this,arguments)},ei=function(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(o[n[r]]=t[n[r]])}return o},oi=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},ni=function(t){function o(e){var o=t.call(this)||this;o.onDragStart=function(t){var e=t.event,n=o.props,r=n.model,i=n.graphModel;if(e){var a=i.getPointByClient({x:e.clientX,y:e.clientY}).canvasOverlayPosition,s=a.x,l=a.y;o.moveOffset={dx:r.x-s,dy:r.y-l}}},o.onDragging=function(t){var e,n,r,i,a=t.event,s=o.props,l=s.model,d=s.graphModel,p=d.editConfigModel,c=p.stopMoveGraph,u=p.autoExpand,h=p.snapGrid,f=d.transformModel,y=d.selectNodes,g=d.width,v=d.height,m=d.gridSize;l.isDragging=!0;var x=a,b=x.clientX,E=x.clientY,M=d.getPointByClient({x:b,y:E}).canvasOverlayPosition,w=M.x,O=M.y,_=oi(f.CanvasPointToHtmlPoint([w,O]),2),S=_[0],T=_[1];if(w+=null!==(n=null===(e=o.moveOffset)||void 0===e?void 0:e.dx)&&void 0!==n?n:0,O+=null!==(i=null===(r=o.moveOffset)||void 0===r?void 0:r.dy)&&void 0!==i?i:0,w=Jt(w,m,h),O=Jt(O,m,h),g&&v){if(!u||c||!(S<0||T<0||S>g||T>v)){var P=oi(f.CanvasPointToHtmlPoint([w-l.width/2,O-l.height/2]),2),A=P[0],N=P[1],D=oi(f.CanvasPointToHtmlPoint([w+l.width/2,O+l.height/2]),2),C=D[0],j=D[1],L=Math.max(m,20),I=[];A<0?I=[L,0]:C>d.width?I=[-L,0]:N<0?I=[0,L]:j>d.height&&(I=[0,-L]),o.t&&Ie(o.t);var R=y.map(function(t){return t.id});-1===R.indexOf(l.id)&&(R=[l.id]),I.length>0&&!c&&u?o.t=Le(function(){var t=oi(I,2),e=t[0],o=t[1];f.translate(null!=e?e:0,null!=o?o:0);var n=-(null!=e?e:0)/f.SCALE_X,r=-(null!=o?o:0)/f.SCALE_X;d.moveNodes(R,n,r)}):d.moveNodes(R,w-l.x,O-l.y)}}else d.moveNode2Coordinate(l.id,w,O)},o.onDragEnd=function(){o.t&&Ie(o.t),o.props.model.isDragging=!1},o.onMouseOut=function(t){null!==d(window,"navigator.userAgent","").match(/MSIE|Trident/)&&o.setHoverOff(t)},o.handleMouseUp=function(){var t=o.props.model;o.mouseUpDrag=t.isDragging},o.handleClick=function(t){var e=!1===o.mouseUpDrag;if(o.startTime){var n=o.props,r=n.model,i=n.graphModel;if(e){var a={data:r.getData(),e:t,position:i.getPointByClient({x:t.clientX,y:t.clientY}),isSelected:!1,isMultiple:!1},s=2===t.button,l=2===t.detail;if(!s){var d=i.editConfigModel,p=ee(t,d);a.isMultiple=p,r.isSelected&&!l&&p?(a.isSelected=!1,r.setSelected(!1)):(i.selectNodeById(r.id,p),a.isSelected=!0,d.isSilentMode||o.toFront()),l?(d.nodeTextEdit&&r.text.editable&&d.textMode===pt.TEXT&&(r.setSelected(!1),i.setElementStateById(r.id,rt.TEXT_EDIT)),i.eventCenter.emit(st.NODE_DBCLICK,a)):(i.eventCenter.emit(st.ELEMENT_CLICK,a),i.eventCenter.emit(st.NODE_CLICK,a))}}}},o.handleContextMenu=function(t){t.preventDefault();var e=o.props,n=e.model,r=e.graphModel,i=r.editConfigModel,a=n.getData(),s=r.getPointByClient({x:t.clientX,y:t.clientY});r.setElementStateById(n.id,rt.SHOW_MENU,s.domOverlayPosition),n.isSelected||r.selectNodeById(n.id),r.eventCenter.emit(st.NODE_CONTEXTMENU,{data:a,e:t,position:s}),i.isSilentMode||o.toFront()},o.handleMouseDown=function(t){var e=o.props,n=e.model,r=e.graphModel;o.startTime=(new Date).getTime(),r.editConfigModel.adjustNodePosition&&n.draggable&&o.stepDrag&&o.stepDrag.handleMouseDown(t)},o.handleFocus=function(){var t=o.props,e=t.model;t.graphModel.eventCenter.emit(st.NODE_FOCUS,{data:e.getData()})},o.handleBlur=function(){var t=o.props,e=t.model;t.graphModel.eventCenter.emit(st.NODE_BLUR,{data:e.getData()})},o.setHoverOn=function(t){var e=o.props,n=e.model,r=e.graphModel;if(!n.isHovered){var i=n.getData();n.setHovered(!0),r.eventCenter.emit(st.NODE_MOUSEENTER,{data:i,e:t})}},o.setHoverOff=function(t){var e=o.props,n=e.model,r=e.graphModel,i=n.getData();n.isHovered&&(n.setHovered(!1),r.eventCenter.emit(st.NODE_MOUSELEAVE,{data:i,e:t}))};var n=e.graphModel,r=n.gridSize,i=n.eventCenter,a=e.model;return o.stepDrag=new ut({onDragStart:o.onDragStart,onDragging:o.onDragging,onDragEnd:o.onDragEnd,step:r,eventType:"NODE",isStopPropagation:!1,eventCenter:i,model:a}),o.modelDisposer=G(function(){return o.props},function(t){t&&t.model&&o.stepDrag.setModel(t.model)}),o}return Qr(o,t),o.prototype.componentWillUnmount=function(){this.modelDisposer&&this.modelDisposer(),this.render.$mobx&&this.render.$mobx.dispose()},o.prototype.componentDidMount=function(){},o.prototype.componentDidUpdate=function(){},o.prototype.getAnchorShape=function(t){return null},o.prototype.getAnchors=function(){var t=this,o=this.props,n=o.model,r=o.graphModel,i=n.isSelected,a=n.isHitable,s=n.isDragging,l=n.isShowAnchor;return a&&(i||l)&&!s?f(n.anchors,function(o,i){var a=n.getAnchorLineStyle(o),s=n.getAnchorStyle(o);return e(Hr,{anchorData:o,node:t,style:s,edgeStyle:a,anchorIndex:i,nodeModel:n,graphModel:r,setHoverOff:t.setHoverOff})}):[]},o.prototype.getRotateControl=function(){var t=this.props,o=t.model,n=t.graphModel,r=n.editConfigModel,i=r.isSilentMode,a=r.allowRotate,s=o.isSelected,l=o.isHitable,d=o.rotatable,p=o.isHovered,c=a&&d,u=o.getRotateControlStyle();if(!i&&l&&(s||p)&&c)return e(Fr,{graphModel:n,nodeModel:o,eventCenter:n.eventCenter,style:u})},o.prototype.getResizeControl=function(){var t=this.props,o=t.model,n=t.graphModel,r=n.editConfigModel,i=r.isSilentMode,a=r.allowResize,s=o.isSelected,l=o.isHitable,d=o.resizable,p=o.isHovered,c=a&&d,u=o.getResizeControlStyle();return!i&&l&&(s||p)&&c?e(ho,{style:u,model:o,graphModel:n}):null},o.prototype.getText=function(){var t,o=this.props,n=o.model,r=o.graphModel,i=r.editConfigModel;if(i.nodeTextMode!==pt.TEXT)return null;if(n.state===rt.TEXT_EDIT)return null;if(n.text){var a=!1;return i.nodeTextDraggable&&n.text.draggable&&(a=!0),e(Zr,{editable:i.nodeTextEdit&&(null===(t=n.text.editable)||void 0===t||t),model:n,graphModel:r,draggable:a})}return null},o.prototype.getStateClassName=function(){var t=this.props.model,e=t.state,o=t.isDragging,n=t.isSelected,r="lf-node";switch(e){case rt.ALLOW_CONNECT:r+=" lf-node-allow";break;case rt.NOT_ALLOW_CONNECT:r+=" lf-node-not-allow";break;default:r+=" lf-node-default"}return o&&(r+=" lf-dragging"),n&&(r+=" lf-node-selected"),r},o.prototype.toFront=function(){var t=this.props,e=t.model,o=t.graphModel;e.autoToFront&&o.toFront(e.id)},o.prototype.render=function(){var t,o=this.props,n=o.model,r=o.graphModel,i=r.editConfigModel,a=i.hideAnchors,s=i.adjustNodePosition,l=i.allowRotate,d=i.allowResize,p=r.gridSize,c=r.transformModel.SCALE_X,u=n.isHitable,h=n.draggable,f=n.transform,y=n.getOuterGAttributes(),g=y.className,v=void 0===g?"":g,m=ei(y,["className"]),x=e("g",{className:"lf-node-content",children:[e("g",{transform:f,children:[this.getShape(),this.getText(),l&&this.getRotateControl(),d&&this.getResizeControl()]}),!a&&this.getAnchors()]});return u?(s&&h&&this.stepDrag.setStep(p*c),t=e("g",ti({className:"".concat(this.getStateClassName()," ").concat(v),onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onClick:this.handleClick,onMouseEnter:this.setHoverOn,onMouseOver:this.setHoverOn,onMouseLeave:this.setHoverOff,onMouseOut:this.onMouseOut,onContextMenu:this.handleContextMenu,onFocus:this.handleFocus,onBlur:this.handleBlur},m,{children:x}))):t=e("g",ti({className:"".concat(this.getStateClassName()," ").concat(v)},m,{children:x})),t},o.isObserved=!1,o}(o),ri=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),ii=function(){return ii=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},ii.apply(this,arguments)},ai=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return ri(o,t),o.prototype.getShape=function(){var t=this.props.model,o=t.getNodeStyle();return e(Fe,ii({},o,{x:t.x,y:t.y,width:t.width,height:t.height,radius:t.radius}))},o}(ni),si=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),li=function(){return li=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},li.apply(this,arguments)},di=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return si(o,t),o.prototype.getShape=function(){var t=this.props.model,o=t.x,n=t.y,r=t.r,i=t.getNodeStyle();return e(qe,li({},i,{x:o,y:n,r:r}))},o}(ni),pi=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),ci=function(){return ci=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},ci.apply(this,arguments)},ui=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return pi(o,t),o.prototype.getShape=function(){var t=this.props.model,o=t,n=o.x,r=o.y,i=o.width,a=o.height,s=o.points,l=t.getNodeStyle(),d={transform:"matrix(1 0 0 1 ".concat(n-i/2," ").concat(r-a/2,")")};return e("g",ci({},d,{children:e(oo,ci({},l,{points:s,x:n,y:r}))}))},o}(ni),hi=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),fi=function(){return fi=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},fi.apply(this,arguments)},yi=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return hi(o,t),o.prototype.getShape=function(){var t=this.props.model,o=t.getNodeStyle();return e("g",{children:e(oo,fi({},o,{points:t.points,x:t.x,y:t.y}))})},o}(ni),gi=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),vi=function(){return vi=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},vi.apply(this,arguments)},mi=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return gi(o,t),o.prototype.getShape=function(){var t=this.props.model,o=t.getNodeStyle();return e(Qe,vi({},o,{x:t.x,y:t.y,rx:t.rx,ry:t.ry}))},o}(ni),xi=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),bi=function(){return bi=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},bi.apply(this,arguments)},Ei=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return xi(o,t),o.prototype.getBackground=function(){var t=this.props.model,o=t.getTextStyle(),n=t.width,r=t.height,i=t.x,a=t.y,s=bi(bi({},o.background),{x:i,y:a,width:n,height:r});return e(Fe,bi({},s))},o.prototype.getResizeControl=function(){return null},o.prototype.getShape=function(){return e("g",{children:this.getBackground()})},o}(ni),Mi=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),wi=function(){return wi=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},wi.apply(this,arguments)},Oi=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},_i=function(t,e,o){if(o||2===arguments.length)for(var n,r=0,i=e.length;r<i;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))},Si=function(t){function o(){var e=t.apply(this,_i([],Oi(arguments),!1))||this;return e.ref=r(),e}return Mi(o,t),Object.defineProperty(o.prototype,"rootEl",{get:function(){return this.ref.current},enumerable:!1,configurable:!0}),o.prototype.setHtml=function(t){t.appendChild(document.createElement("div"))},o.prototype.confirmUpdate=function(t){this.setHtml(t)},o.prototype.shouldUpdate=function(){return(!this.preProperties||this.preProperties!==this.currentProperties)&&(this.preProperties=this.currentProperties,!0)},o.prototype.componentDidMount=function(){this.shouldUpdate()&&this.rootEl&&this.setHtml(this.rootEl)},o.prototype.componentDidUpdate=function(){this.shouldUpdate()&&this.rootEl&&this.confirmUpdate(this.rootEl)},o.prototype.componentWillUnmount=function(){t.prototype.componentWillUnmount.call(this),this.rootEl.innerHTML=""},o.prototype.getShape=function(){var t=this.props.model,o=t.x,n=t.y,r=t.height,i=t.width,a=t.getNodeStyle();return this.currentProperties=JSON.stringify(t.properties),e("foreignObject",wi({},a,{x:o-i/2,y:n-r/2,width:i,height:r,ref:this.ref}))},o}(ni),Ti=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Pi=function(){return Pi=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Pi.apply(this,arguments)},Ai=function(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(o[n[r]]=t[n[r]])}return o},Ni=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a};!function(t){t.SOURCE="SOURCE",t.TARGET="TARGET"}(Cr||(Cr={}));var Di=function(t){function o(e){var o=t.call(this)||this;o.handleMouseDown=function(t){o.stepDrag&&o.stepDrag.handleMouseDown(t)},o.onDragStart=function(){var t=o.props,e=t.x,n=t.y,r=t.edgeModel,i=r.startPoint,a=r.endPoint,s=r.pointsList;o.oldEdge={startPoint:i,endPoint:a,pointsList:s},o.setState({endX:e,endY:n,dragging:!0})},o.onDragging=function(t){var e=t.deltaX,n=t.deltaY,r=o.state,i=r.endX,a=r.endY,s=o.props,l=s.graphModel,d=s.type,p=l.transformModel,c=l.editConfigModel,u=Ni(p.moveCanvasPointByHtml([i,a],e,n),2),h=u[0],f=u[1];o.setState({endX:h,endY:f,dragging:!0});var y=o.props.edgeModel,g=ve({x:i,y:a},l);if(g&&g.node&&o.isAllowAdjust(g).pass){var v=y.startPoint,m=y.endPoint,x=y.sourceNode,b=y.targetNode,E=d===Cr.SOURCE?{startPoint:{x:g.anchor.x,y:g.anchor.y},endPoint:{x:m.x,y:m.y},sourceNode:g.node,targetNode:b}:{startPoint:{x:v.x,y:v.y},endPoint:{x:g.anchor.x,y:g.anchor.y},sourceNode:x,targetNode:g.node};y.updateAfterAdjustStartAndEnd(E)}else d===Cr.SOURCE?y.updateStartPoint({x:h,y:f}):y.updateEndPoint({x:h,y:f});y.text.value&&c.adjustEdge&&y.setText(Object.assign({},y.text,y.textPosition))},o.onDragEnd=function(t){var e,n,r,i=t.event;try{o.setState({dragging:!1});var a=o.props,s=a.graphModel,l=a.edgeModel,d=a.type,p=o.state,c=p.endX,u=p.endY,h=p.dragging,f=ve({x:c,y:u},s);if(!h)return;var y=!1,g=void 0;if(f&&f.node){var v=o.isAllowAdjust(f),m=v.pass,x=v.msg,b=v.newTargetNode;if(m){var E=l.getData(),M=E.text,w=E.sourceAnchorId,O=void 0===w?"":w,_=E.targetAnchorId,S=void 0===_?"":_,T=Ai(E,["text","sourceAnchorId","targetAnchorId"]);if(g=Pi(Pi({sourceAnchorId:O,targetAnchorId:S},T),{text:(null==M?void 0:M.value)||""}),d===Cr.SOURCE){var P=s.getNodeModelById(f.node.id),A=s.getNodeModelById(l.targetNodeId),N=null===(e=s.edgeGenerator)||void 0===e?void 0:e.call(s,null==P?void 0:P.getData(),null==A?void 0:A.getData(),g);g=Pi(Pi({},N),{sourceNodeId:f.node.id,sourceAnchorId:f.anchor.id,startPoint:{x:f.anchor.x,y:f.anchor.y},targetNodeId:l.targetNodeId,endPoint:Pi({},l.endPoint)}),l.sourceNodeId===f.node.id&&l.sourceAnchorId===f.anchor.id&&(y=!0)}else if(d===Cr.TARGET){P=s.getNodeModelById(l.sourceNodeId),A=s.getNodeModelById(f.node.id),N=null===(n=s.edgeGenerator)||void 0===n?void 0:n.call(s,null==P?void 0:P.getData(),null==A?void 0:A.getData(),g);g=Pi(Pi({},N),{sourceNodeId:l.sourceNodeId,startPoint:Pi({},l.startPoint),targetNodeId:f.node.id,targetAnchorId:f.anchor.id,endPoint:{x:f.anchor.x,y:f.anchor.y}}),l.targetNodeId===f.node.id&&l.targetAnchorId===f.anchor.id&&(y=!0)}}else{y=!0;var D=b.getData();s.eventCenter.emit(st.CONNECTION_NOT_ALLOWED,{data:D,msg:x})}}else y=!0;if(y)o.recoveryEdge();else{var C=l.getData();s.deleteEdgeById(l.id);var j=s.addEdge(Pi({},g));s.eventCenter.emit(st.EDGE_EXCHANGE_NODE,{data:{newEdge:j.getData(),oldEdge:C}})}null===(r=o.preTargetNode)||void 0===r||r.setElementState(rt.DEFAULT)}finally{(s=o.props.graphModel).eventCenter.emit(st.ADJUST_POINT_DRAGEND,{e:i,data:o.stepDragData})}},o.recoveryEdge=function(){var t=o.props.edgeModel,e=o.oldEdge,n=e.startPoint,r=e.endPoint,i=e.pointsList;t.updateStartPoint(n),t.updateEndPoint(r),t.modelType!==at.LINE_EDGE&&(t.pointsList=null!=i?i:[],t.initPoints())},o.getAdjustPointStyle=function(){return o.props.graphModel.theme.edgeAdjust},o.state={dragging:!1,endX:0,endY:0},o.targetRuleResults=new Map,o.sourceRuleResults=new Map;var n=e.type,r=e.edgeModel,i=e.graphModel.eventCenter;return o.stepDragData={type:n,edgeData:r.getData()},o.stepDrag=new ut({onDragStart:o.onDragStart,onDragging:o.onDragging,onDragEnd:o.onDragEnd,eventType:"ADJUST_POINT",isStopPropagation:!1,eventCenter:i,data:o.stepDragData}),o}return Ti(o,t),o.prototype.isAllowAdjust=function(t){var e,o,n,r,i=this.props,a=i.edgeModel,s=a.id,l=a.sourceNode,d=a.targetNode,p=a.sourceAnchorId,c=a.targetAnchorId,u=i.type;if(u===Cr.SOURCE?(e=t.node,o=d,n=t.anchor,r=d.getAnchorInfo(c)):(e=l,o=t.node,r=t.anchor,n=l.getAnchorInfo(p)),this.preTargetNode&&this.preTargetNode!==t.node&&this.preTargetNode.setElementState(rt.DEFAULT),this.preTargetNode=t.node,r.id===n.id)return{pass:!1,msg:"",newTargetNode:o};var h="".concat(e.id,"_").concat(o.id,"_").concat(n.id,"_").concat(r.id);if(!this.targetRuleResults.has(h)){var f=e.isAllowConnectedAsSource(o,n,r,s),y=o.isAllowConnectedAsTarget(e,n,r,s);this.sourceRuleResults.set(h,De(f)),this.targetRuleResults.set(h,De(y))}var g=this.sourceRuleResults.get(h),v=g.isAllPass,m=g.msg,x=this.targetRuleResults.get(h),b=x.isAllPass,E=x.msg,M=v&&b?rt.ALLOW_CONNECT:rt.NOT_ALLOW_CONNECT;return u===Cr.SOURCE?e.setElementState(M):o.setElementState(M),{pass:v&&b,msg:E||m,newTargetNode:o}},o.prototype.render=function(){var t=this.props,o=t.x,n=t.y,r=t.getAdjustPointShape,i=t.edgeModel,a=this.state.dragging;return e("g",{pointerEvents:a?"none":"",onMouseDown:this.handleMouseDown,children:a?"":r(o,n,i)})},o}(o),Ci=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),ji=function(){return ji=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},ji.apply(this,arguments)};!function(t){function o(){return null!==t&&t.apply(this,arguments)||this}Ci(o,t),o.prototype.getArrowAttributes=function(){var t=this.props,e=t.arrowInfo,o=t.style,n=e.start,r=e.end,i={start:n,end:r,offset:o.offset,verticalLength:o.verticalLength,type:"end"},a=yt(i),s=a.leftX,l=a.leftY,d=a.rightX,p=a.rightY;return ji({d:"M".concat(s," ").concat(l," L").concat(r.x," ").concat(r.y," L").concat(d," ").concat(p," z")},o)},o.prototype.getShape=function(){var t=this.getArrowAttributes(),o=t.d,n=t.strokeWidth,r=t.stroke,i=t.fill;return e(Ve,{d:o,fill:i,strokeWidth:n,stroke:r})},o.prototype.render=function(){return e("g",{className:"lf-arrow",children:this.getShape()})}}(o);var Li=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Ii=function(){return Ii=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Ii.apply(this,arguments)},Ri=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},ki=function(t){function o(){var e=t.call(this)||this;return e.textRef=r(),e.handleHover=function(t,o){var n=e.props,r=n.model,i=n.graphModel.eventCenter;r.setHovered(t);var a=t?st.EDGE_MOUSEENTER:st.EDGE_MOUSELEAVE,s=r.getData();i.emit(a,{data:s,e:o})},e.setHoverOn=function(t){e.props.model.isHovered||(e.textRef&&e.textRef.current&&e.textRef.current.setHoverOn(),e.handleHover(!0,t))},e.setHoverOff=function(t){e.props.model.isHovered&&(e.textRef&&e.textRef.current&&e.textRef.current.setHoverOff(),e.handleHover(!1,t))},e.handleContextMenu=function(t){t.preventDefault(),e.contextMenuTime=(new Date).getTime(),e.clickTimer&&clearTimeout(e.clickTimer);var o=e.props,n=o.model,r=o.graphModel,i=r.editConfigModel,a=r.getPointByClient({x:t.clientX,y:t.clientY});r.setElementStateById(n.id,rt.SHOW_MENU,a.domOverlayPosition),i.isSilentMode||e.toFront(),n.isSelected||r.selectEdgeById(n.id);var s=null==n?void 0:n.getData();r.eventCenter.emit(st.EDGE_CONTEXTMENU,{data:s,e:t,position:a})},e.handleMouseDown=function(t){t.stopPropagation(),e.startTime=(new Date).getTime()},e.handleMouseUp=function(){var t=e.props.model;e.mouseUpDrag=t.isDragging},e.handleClick=function(t){if(e.startTime&&!(e.mouseUpDrag||2===t.button)){var o=2===t.detail,n=e.props,r=n.model,i=n.graphModel,a=null==r?void 0:r.getData(),s=i.getPointByClient({x:t.clientX,y:t.clientY});if(o){var l=i.editConfigModel,d=i.textEditElement,p=r.id,c=r.text,u=r.modelType;if(d&&d.id===p&&i.setElementStateById(p,rt.DEFAULT),l.edgeTextEdit&&c.editable&&(r.setSelected(!1),i.setElementStateById(p,rt.TEXT_EDIT)),u===at.POLYLINE_EDGE){var h=r,f=i.getPointByClient({x:t.x,y:t.y}).canvasOverlayPosition,y=f.x,g=f.y;h.dbClickPosition=Vt({x:y,y:g},h.points)}i.eventCenter.emit(st.EDGE_DBCLICK,{data:a,e:t,position:s})}else i.eventCenter.emit(st.ELEMENT_CLICK,{data:a,e:t,position:s}),i.eventCenter.emit(st.EDGE_CLICK,{data:a,e:t,position:s});var v=i.editConfigModel;i.selectEdgeById(r.id,ee(t,v)),v.isSilentMode||e.toFront()}},e.handleFocus=function(){var t=e.props,o=t.model;t.graphModel.eventCenter.emit(st.EDGE_FOCUS,{data:o.getData()})},e.handleBlur=function(){var t=e.props,o=t.model;t.graphModel.eventCenter.emit(st.EDGE_BLUR,{data:o.getData()})},e}return Li(o,t),o.prototype.getShape=function(){return e("g",{children:this.getEdge()})},o.prototype.getTextStyle=function(){},o.prototype.getText=function(){var t,o=this.props,n=o.model,r=o.graphModel,i=r.editConfigModel;if(i.edgeTextMode!==pt.TEXT)return null;if(n.state===rt.TEXT_EDIT)return null;if(n.text){var a=!1;return i.edgeTextDraggable&&n.text.draggable&&(a=!0),e($r,{ref:this.textRef,editable:i.edgeTextEdit&&(null===(t=n.text.editable)||void 0===t||t),model:n,graphModel:r,draggable:a})}return null},o.prototype.getArrowInfo=function(){var t=this.props.model,e=t.startPoint,o=t.endPoint,n=t.isSelected;return{start:e,end:o,hover:this.state.hover,isSelected:n}},o.prototype.getLastTwoPoints=function(){var t=this.props.model;return[t.startPoint,t.endPoint]},o.prototype.getArrowStyle=function(){return console.error("getArrowStyle is deprecated in 1.2.0, please use model.getArrowStyle"),null},o.prototype.getArrow=function(){var t=this.props.model,o=t.id,n=t.getArrowStyle(),r=n.refY,i=void 0===r?0:r,a=n.refX,s=void 0===a?2:a,l=Ri(this.getLastTwoPoints(),2),d=l[0],p=l[1],c="auto";return null!==d&&null!==p&&(c=bo({x:p.x-d.x,y:p.y-d.y})*(180/Math.PI)),e("g",{children:e("defs",{children:[e("marker",{id:"marker-start-".concat(o),refX:-s,refY:i,overflow:"visible",orient:"auto",markerUnits:"userSpaceOnUse",children:this.getStartArrow()}),e("marker",{id:"marker-end-".concat(o),refX:s,refY:i,overflow:"visible",orient:c,markerUnits:"userSpaceOnUse",children:this.getEndArrow()})]})})},o.prototype.getArrowPath=function(t,o){var n=o.stroke,r=o.fill,i=void 0===r?n:r,a=o.strokeWidth,s=o.offset,l=void 0===s?10:s,d=o.verticalLength,p=o.strokeLinecap,c=o.strokeLinejoin,u=o.transform,h="";switch(t){case"solid":h="M".concat(-l/4,",0 L").concat(3*l/4,",").concat(d," L").concat(3*l/4,",-").concat(d," Z");break;case"hollow":h="M".concat(-l/4,",0 L").concat(3*l/4,",").concat(d," L").concat(-l/4,",0 L").concat(3*l/4,",-").concat(d," L").concat(-l/4,",0 Z");break;case"diamond":h="M".concat(-l/2,",0 L0,").concat(d," L").concat(l/2,",0 L0,-").concat(d," L").concat(-l/2,",0 Z");break;case"circle":h="M".concat(-l/2,",0 A").concat(l/4,",").concat(l/4," 0 1,0 ").concat(l/2,",0 A").concat(l/4,",").concat(l/4," 0 1,0 ").concat(-l/2,",0 Z");break;default:h=""}return e("path",{d:h,stroke:n,fill:i,strokeWidth:a,strokeLinecap:p,strokeLinejoin:c,transform:u})},o.prototype.getStartArrow=function(){var t=this.props.model.getArrowStyle(),e=t.stroke,o=t.strokeWidth,n=t.offset,r=t.verticalLength,i=t.startArrowType,a=void 0===i?"none":i,s=t.strokeLinecap,l=t.strokeLinejoin;return this.getArrowPath(a,{stroke:e,strokeWidth:o,offset:n,verticalLength:r,strokeLinecap:s,strokeLinejoin:l})},o.prototype.getEndArrow=function(){var t=this.props.model.getArrowStyle(),e=t.stroke,o=t.strokeWidth,n=t.offset,r=t.verticalLength,i=t.endArrowType,a=void 0===i?"solid":i,s=t.strokeLinecap,l=t.strokeLinejoin;return this.getArrowPath(a,{stroke:e,strokeWidth:o,offset:n,verticalLength:r,strokeLinecap:s,strokeLinejoin:l,transform:"rotate(180)"})},o.prototype.getAdjustPointShape=function(t,o,n){var r=n.getAdjustPointStyle();return e(qe,Ii({className:"lf-edge-adjust-point"},r,{x:t,y:o}))},o.prototype.getAdjustPoints=function(){var t=this.props,o=t.model,n=t.graphModel,r=n.editConfigModel,i=r.adjustEdgeStartAndEnd,a=r.adjustEdgeStart,s=r.adjustEdgeEnd,l=o.getAdjustStart(),d=o.getAdjustEnd();return e("g",{children:[i&&a&&e(Di,Ii({type:Cr.SOURCE},l,{getAdjustPointShape:this.getAdjustPointShape,edgeModel:o,graphModel:n})),i&&s&&e(Di,Ii({type:Cr.TARGET},d,{getAdjustPointShape:this.getAdjustPointShape,edgeModel:o,graphModel:n}))]})},o.prototype.getAnimation=function(){console.error("getAnimation is deprecated in 1.2.0, please use model.getEdgeAnimationStyle")},o.prototype.getAppendWidth=function(){return e("g",{})},o.prototype.getAppend=function(){return e("g",{className:"lf-edge-append",children:this.getAppendWidth()})},o.prototype.getEdge=function(){return null},o.prototype.toFront=function(){var t=this.props,e=t.graphModel,o=t.model;e.toFront(o.id)},o.prototype.render=function(){var t=this.props.model,o=t.isSelected,n=t.isHitable,r=t.isShowAdjustPoint;return e("g",{children:[e("g",{className:["lf-edge",!n&&"pointer-none",o&&"lf-edge-selected"].filter(Boolean).join(" "),onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onClick:this.handleClick,onContextMenu:this.handleContextMenu,onMouseOver:this.setHoverOn,onMouseEnter:this.setHoverOn,onMouseLeave:this.setHoverOff,onFocus:this.handleFocus,onBlur:this.handleBlur,children:[this.getShape(),this.getAppend(),this.getText(),this.getArrow()]}),r&&o?this.getAdjustPoints():""]})},o.isObserved=!1,o}(o),Bi=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Xi=function(){return Xi=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Xi.apply(this,arguments)},zi=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},Hi=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return Bi(o,t),o.prototype.getEdge=function(){var t=this.props.model,o=t.getEdgeStyle(),n=t,r=n.path,i=n.isAnimation,a=n.arrowConfig,s=t.getEdgeAnimationStyle(),l=s.strokeDasharray,d=s.stroke,p=s.strokeDashoffset,c=s.animationName,u=s.animationDuration,h=s.animationIterationCount,f=s.animationTimingFunction,y=s.animationDirection;return e(Ve,Xi({d:r},o,a,i?{strokeDasharray:l,stroke:d,style:{strokeDashoffset:p,animationName:c,animationDuration:u,animationIterationCount:h,animationTimingFunction:f,animationDirection:y}}:{}))},o.prototype.getAppendWidth=function(){var t=this.props.model.path;return e(Ve,{d:t,strokeWidth:10,stroke:"transparent",fill:"none"})},o.prototype.getArrowInfo=function(){var t=this.props.model,e=this.state.hover,o=t.isSelected,n=t.getArrowStyle().offset,r=t.pointsList.map(function(t){return{x:t.x,y:t.y}}),i=zi(Ut(r,n),2);return{start:i[0],end:i[1],hover:e,isSelected:o}},o.prototype.getLastTwoPoints=function(){var t=this.props.model,e=t.getArrowStyle().offset,o=t.pointsList.map(function(t){return{x:t.x,y:t.y}});return Ut(o,e)},o}(ki),Gi=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Yi=function(){return Yi=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Yi.apply(this,arguments)},Fi=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return Gi(o,t),o.prototype.getEdge=function(){var t=this.props.model,o=t.startPoint,n=t.endPoint,r=t.isAnimation,i=t.arrowConfig,a=t.getEdgeStyle(),s=t.getEdgeAnimationStyle(),l=s.strokeDasharray,d=s.stroke,p=s.strokeDashoffset,c=s.animationName,u=s.animationDuration,h=s.animationIterationCount,f=s.animationTimingFunction,y=s.animationDirection;return e(He,Yi({},a,{x1:o.x,y1:o.y,x2:n.x,y2:n.y},i,r?{strokeDasharray:l,stroke:d,style:{strokeDashoffset:p,animationName:c,animationDuration:u,animationIterationCount:h,animationTimingFunction:f,animationDirection:y}}:{}))},o.prototype.getAppendWidth=function(){var t=this.props.model,o=function(t){var e,o=t.start,n=t.end;if(o.x===n.x&&o.y===n.y)e="";else{var r={start:o,end:n,offset:10,verticalLength:5},i=yt(gt(gt({},r),{type:"start"})),a=yt(gt(gt({},r),{type:"end"}));e="M".concat(i.leftX," ").concat(i.leftY,"\n    L").concat(i.rightX," ").concat(i.rightY,"\n    L").concat(a.rightX," ").concat(a.rightY,"\n    L").concat(a.leftX," ").concat(a.leftY," z")}return{d:e,fill:"transparent",stroke:"transparent",strokeWidth:1,strokeDasharray:"4, 4"}}({start:t.startPoint,end:t.endPoint}),n=o.d,r=o.strokeWidth,i=o.fill,a=o.strokeDasharray,s=o.stroke;return e(Ve,{d:n,fill:i,strokeWidth:r,stroke:s,strokeDasharray:a})},o}(ki),Wi=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Ui=function(){return Ui=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Ui.apply(this,arguments)},Vi=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},Zi=function(t){function o(){var e=t.call(this)||this;return e.onDragStart=function(){var t=e.props.model;t.dragAppendStart(),e.isShowAdjustPointTemp=t.isShowAdjustPoint,t.isShowAdjustPoint=!1},e.onDragging=function(t){var o=t.deltaX,n=t.deltaY,r=e.props,i=r.model,a=r.graphModel;e.isDragging=!0;var s=a.transformModel,l=a.editConfigModel,d=Vi(s.fixDeltaXY(o,n),2),p=d[0],c=d[1],u=i,h=l.adjustEdgeMiddle;e.appendInfo=h?u.dragAppendSimple(e.appendInfo,{x:p,y:c}):u.dragAppend(e.appendInfo,{x:p,y:c})},e.onDragEnd=function(){var t,o=e.props,n=o.model,r=o.graphModel.eventCenter,i=n;i.dragAppendEnd(),e.isDragging=!1,i.isShowAdjustPoint=null!==(t=e.isShowAdjustPointTemp)&&void 0!==t&&t,e.appendInfo=void 0,r.emit(st.EDGE_ADJUST,{data:i.getData()})},e.beforeDragStart=function(t,o){o.draggable&&e.drag.handleMouseDown(t),e.appendInfo=o},e.drag=new ut({onDragStart:e.onDragStart,onDragging:e.onDragging,onDragEnd:e.onDragEnd,isStopPropagation:!1}),e}return Wi(o,t),o.prototype.getEdge=function(){var t=this.props.model,o=t.points,n=t.isAnimation,r=t.arrowConfig,i=t.getEdgeStyle(),a=t.getEdgeAnimationStyle(),s=a.strokeDasharray,l=a.stroke,d=a.strokeDashoffset,p=a.animationName,c=a.animationDuration,u=a.animationIterationCount,h=a.animationTimingFunction,f=a.animationDirection;return e(io,Ui({points:o},i,r,n?{strokeDasharray:s,stroke:l,style:{strokeDashoffset:d,animationName:p,animationDuration:c,animationIterationCount:u,animationTimingFunction:h,animationDirection:f}}:{}))},o.prototype.getArrowInfo=function(){var t=this.props.model,e=t.points,o=t.isSelected,n=this.state.hover,r=Xt(e),i=r[0],a=r[0];return r.length>=2&&(i=r[r.length-2],a=r[r.length-1]),{start:i,end:a,hover:n,isSelected:o}},o.prototype.getLastTwoPoints=function(){var t=this.props.model.points,e=Xt(t),o=e[0],n=e[0];return e.length>=2&&(o=e[e.length-2],n=e[e.length-1]),[o,n]},o.prototype.getAppendAttributes=function(t){var e,o=t.start,n=t.end;if(o.x===n.x&&o.y===n.y)e="";else{var r={start:o,end:n,offset:10,verticalLength:5},i=yt(Ui(Ui({},r),{type:"start"})),a=yt(Ui(Ui({},r),{type:"end"}));e="M".concat(i.leftX," ").concat(i.leftY,"\n      L").concat(i.rightX," ").concat(i.rightY,"\n      L").concat(a.rightX," ").concat(a.rightY,"\n      L").concat(a.leftX," ").concat(a.leftY," z")}return{d:e,fill:"transparent",stroke:"transparent",strokeWidth:1,strokeDasharray:"4, 4"}},o.prototype.getAppendShape=function(t){var o=this.getAppendAttributes(t),n=o.d,r=o.strokeWidth,i=o.fill,a=o.strokeDasharray,s=o.stroke;return e(Ve,{d:n,fill:i,strokeWidth:r,stroke:s,strokeDasharray:a})},o.prototype.getAppendWidth=function(){for(var t=this,o=this.props,n=o.model,r=o.graphModel,i=n.pointsList,a=n.draggable,s=[],l=i.length,d=function(o){var n="lf-polyline-append",d={start:{x:i[o].x,y:i[o].y},end:{x:i[o+1].x,y:i[o+1].y},startIndex:o,endIndex:o+1,direction:dt.HORIZONTAL,draggable:!0},c=e("g",{className:n,children:p.getAppendShape(d)}),u=r.editConfigModel,h=u.adjustEdge,f=u.adjustEdgeMiddle;if(h&&a){var y=d.startIndex,g=d.endIndex,v=f&&(0===y||g===l-1);d.draggable=!v,d.start.x===d.end.x?(d.draggable&&(n+="-ew-resize"),d.direction=dt.VERTICAL):d.start.y===d.end.y&&(d.draggable&&(n+="-ns-resize"),d.direction=dt.HORIZONTAL),c=e("g",{className:p.isDragging?"lf-dragging":"lf-drag-able",onMouseDown:function(e){return t.beforeDragStart(e,d)},children:e("g",{className:n,children:p.getAppendShape(d)})})}s.push(c)},p=this,c=0;c<l-1;c++)d(c);return e("g",{children:s})},o}(ki),Ki=function(){return Ki=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Ki.apply(this,arguments)},qi=function(){function t(t){var e=this;this.nodeConfig=null,this.fakeNode=null,this.stopDrag=function(){e.nodeConfig=null,window.document.removeEventListener("mouseup",e.stopDrag)},this.dragEnter=function(t){e.nodeConfig&&!e.fakeNode&&(e.fakeNode=e.lf.createFakeNode(Ki(Ki({},e.nodeConfig),e.clientToLocalPoint({x:t.clientX,y:t.clientY}))))},this.onDragOver=function(t){if(e.lf.graphModel.eventCenter.emit(st.BLANK_CANVAS_MOUSEMOVE,{e:t}),t.preventDefault(),e.fakeNode){var o=e.clientToLocalPoint({x:t.clientX,y:t.clientY}),n=o.x,r=o.y;e.fakeNode.moveTo(n,r);var i=e.fakeNode.getData();e.lf.setNodeSnapLine(i),e.lf.graphModel.eventCenter.emit(st.NODE_DND_DRAG,{data:i,e:t})}return!1},this.onDragLeave=function(){e.fakeNode&&(e.lf.removeNodeSnapLine(),e.lf.graphModel.removeFakeNode(),e.fakeNode=null)},this.onDrop=function(t){e.lf.graphModel&&t&&e.nodeConfig&&(e.lf.addNode(Ki(Ki({},e.nodeConfig),e.clientToLocalPoint({x:t.clientX,y:t.clientY})),st.NODE_DND_ADD,t),t.preventDefault(),t.stopPropagation(),e.nodeConfig=null,e.lf.removeNodeSnapLine(),e.lf.graphModel.removeFakeNode(),e.fakeNode=null)};var o=t.lf;this.lf=o}return t.prototype.clientToLocalPoint=function(t){var e=t.x,o=t.y,n=d(this.lf.options,["grid","size"]),r=this.lf.graphModel.getPointByClient({x:e,y:o}).canvasOverlayPosition,i=r.x,a=r.y,s=this.lf.graphModel.editConfigModel.snapGrid;return{x:Jt(i,n,s),y:Jt(a,n,s)}},t.prototype.startDrag=function(t){var e=this.lf.graphModel.editConfigModel;(null==e?void 0:e.isSilentMode)||(this.nodeConfig=t,window.document.addEventListener("mouseup",this.stopDrag))},t.prototype.eventMap=function(){return{onMouseEnter:this.dragEnter,onMouseOver:this.dragEnter,onMouseMove:this.onDragOver,onMouseLeave:this.onDragLeave,onMouseUp:this.onDrop}},t}();var Ji=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),$i=function(){return $i=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},$i.apply(this,arguments)},Qi=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},ta=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},ea=function(t){function o(e){var o=t.call(this,e)||this;return o.ref=r(),o.__prevText={type:"",text:"",id:""},o.keyupHandler=function(t){var e=o.props.graphModel.textEditElement;"Enter"===t.key&&t.altKey&&(null==e||e.setElementState(rt.DEFAULT))},o.inputHandler=function(t){var e=t.target.innerText,n=o.props.graphModel.textEditElement;n&&(o.__prevText={type:n.type,text:e.replace(/(\r\n)+$|(\n)+$/,""),id:n.id})},o.keydownHandler=function(t){t.stopPropagation()},o.state={style:{left:0,top:0}},o}return Ji(o,t),o.getDerivedStateFromProps=function(t){var e,o,n=t.textEditElement,r=t.graphModel,i=r.transformModel,a=r.theme,s=a.inputText;if(n){if(!(null===(e=n.text)||void 0===e?void 0:e.value)&&n.BaseType===it.EDGE){var l=n.text,d=n.textPosition,p=d.x,c=d.y;l.x=p,l.y=c,n.setText(l)}var u={resize:"auto",whiteSpace:"normal",wordBreak:"break-all"};if(n.BaseType===it.EDGE){var h=a.edgeText,f=h.overflowMode,y=h.lineHeight,g=h.wrapPadding;(m=h.textWidth)&&"autoWrap"===f&&(o=$i($i({},u),{width:m,minWidth:m,lineHeight:y,padding:g}))}else if(n.BaseType===it.NODE){var v=a.nodeText,m=(f=v.overflowMode,y=v.lineHeight,g=v.wrapPadding,v.textWidth),x=n.width,b=n.modelType,E=n.textWidth||m||x;(b!==at.TEXT_NODE&&"autoWrap"===f||b===at.TEXT_NODE&&m)&&(o=$i($i({},u),{width:E,minWidth:E,lineHeight:y,padding:g}))}var M=n.text,w=M.x,O=M.y,_=ta(i.CanvasPointToHtmlPoint([w,O]),2),S=_[0],T=_[1];return{style:$i($i({left:S,top:T},o),s)}}return null},o.prototype.componentDidUpdate=function(){var t=this.props.graphModel;if(this.ref.current&&(this.ref.current.focus(),this.placeCaretAtEnd(this.ref.current)),""!==this.__prevText.id){var e=this.__prevText,o=e.text,n=e.id;t.updateText(n,o),t.eventCenter.emit(st.TEXT_UPDATE,{data:$i({},this.__prevText)}),this.__prevText.id="",this.__prevText.text="",this.__prevText.type=""}},o.prototype.placeCaretAtEnd=function(t){if(void 0!==window.getSelection&&void 0!==document.createRange){var e=document.createRange();e.selectNodeContents(t),e.collapse(!1);var o=window.getSelection();null==o||o.removeAllRanges(),null==o||o.addRange(e)}},o.prototype.render=function(){var t,o=this.props.graphModel.textEditElement,n=this.state.style;return o?e("div",{contentEditable:!0,className:"lf-text-input",style:n,ref:this.ref,onKeyUp:this.keyupHandler,onKeyDown:this.keydownHandler,onKeyPress:this.keydownHandler,onInput:this.inputHandler,children:null===(t=o.text)||void 0===t?void 0:t.value},o.id):null},o.toolName="text-edit-tool",o=Qi([_a],o)}(o),oa=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),na=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},ra=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},ia=function(t,e,o){if(o||2===arguments.length)for(var n,r=0,i=e.length;r<i;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))},aa=function(t){function o(e){var o=t.call(this,e)||this;o.handleMouseDown=function(t){o.stepDrag.handleMouseDown(t)},o.handleWheelEvent=function(t){var e,n;t.preventDefault();var r=t.deltaX,i=t.deltaY,a=t.clientX,s=t.clientY,l=t.ctrlKey,d=new WheelEvent("wheel",{deltaX:r,deltaY:i,clientX:a,clientY:s,ctrlKey:l});null===(n=null===(e=o.props.lf.container)||void 0===e?void 0:e.querySelector('.lf-canvas-overlay[name="canvas-overlay"]'))||void 0===n||n.dispatchEvent(d)},o.onDragging=function(t){var e=t.deltaX,n=t.deltaY,r=o.props,i=r.graphModel,a=r.lf.getTransform(),s=a.SCALE_X,l=a.SCALE_Y,d=i.getSelectElements(!0);i.moveNodes(d.nodes.map(function(t){return t.id}),e/s,n/l)},o.handleContextMenu=function(t){t.preventDefault();var e=o.props,n=e.graphModel,r=e.graphModel,i=r.eventCenter,a=r.selectElements,s=n.getPointByClient({x:t.clientX,y:t.clientY}),l={nodes:[],edges:[]};ia([],ra(a.values()),!1).forEach(function(t){t.BaseType===it.NODE&&l.nodes.push(t.getData()),t.BaseType===it.EDGE&&l.edges.push(t.getData())}),i.emit(st.SELECTION_CONTEXTMENU,{data:l,e:t,position:s})};var n=e.graphModel,r=n.gridSize,i=n.eventCenter;return o.stepDrag=new ut({onDragging:o.onDragging,step:r,eventType:"SELECTION",eventCenter:i}),o}return oa(o,t),o.prototype.render=function(){var t,o,n=this.props.graphModel,r=n.selectElements,i=n.transformModel,a=this.props.lf.getTransform(),s=a.SCALE_X,l=a.SCALE_Y;if(!(r.size<=1)){var d=Number.MAX_SAFE_INTEGER,p=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER,u=Number.MIN_SAFE_INTEGER;r.forEach(function(t){var e;t.BaseType===it.NODE&&(e=function(t){var e=t.x,o=t.y,n=t.width,r=t.height;return{x:e-n/2,y:o-r/2,x1:e+n/2,y1:o+r/2}}(t)),t.BaseType===it.EDGE&&(e=ht(t)),void 0!==e&&(d=Math.min(d,e.x),p=Math.min(p,e.y),c=Math.max(c,e.x1),u=Math.max(u,e.y1))}),t=ra(i.CanvasPointToHtmlPoint([d,p]),2),d=t[0],p=t[1],o=ra(i.CanvasPointToHtmlPoint([c,u]),2),c=o[0],u=o[1];var h={left:"".concat(d-20*s/2,"px"),top:"".concat(p-20*l/2,"px"),width:"".concat(c-d+20*s,"px"),height:"".concat(u-p+20*l,"px"),"border-width":"".concat(2*s,"px")};return e("div",{className:"lf-multiple-select",style:h,onMouseDown:this.handleMouseDown,onContextMenu:this.handleContextMenu,onWheel:this.handleWheelEvent})}},o.toolName="multiple-select-tool",o=na([_a],o)}(o),sa=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},la=[ea,aa],da=function(){function t(t){var e=this;this.toolMap=new Map,this.disabledToolMap=new Map,this.instance=t,u(la,function(t){e.isDisabled(t.toolName)||e.registerTool(t.toolName,t)});var o=t.graphModel;o.eventCenter.on("".concat(st.GRAPH_TRANSFORM,",").concat(st.NODE_CLICK,",").concat(st.BLANK_CLICK," "),function(){var t,e=o.textEditElement,n=o.editConfigModel,r=n.edgeTextEdit,i=n.nodeTextEdit;(r||i)&&e&&(null===(t=o.textEditElement)||void 0===t||t.setElementState(rt.DEFAULT))})}return t.prototype.isDisabled=function(t){var e;return-1!==(null===(e=this.instance.options.disabledTools)||void 0===e?void 0:e.indexOf(t))},t.prototype.registerTool=function(t,e){this.toolMap.set(t,e)},t.prototype.disableTool=function(t){var e=this.toolMap.get(t);if(e)return this.disabledToolMap.set(t,e),this.toolMap.delete(t),!0;throw new Error("禁用失败，不存在名为 ".concat(e," 的工具"))},t.prototype.enableTool=function(t){var e=this.disabledToolMap.get(t);if(e)return this.toolMap.set(t,e),this.disabledToolMap.delete(t),!0;throw new Error("不存在名为 ".concat(e," 的工具"))},t.prototype.getTools=function(){return Array.from(this.toolMap.values())},t.prototype.getInstance=function(){return this.instance},t.prototype.destroy=function(){this.toolMap.clear(),this.disabledToolMap.clear()},sa([X],t.prototype,"toolMap",void 0),sa([H],t.prototype,"disableTool",null),sa([H],t.prototype,"enableTool",null),t}(),pa=function(){return pa=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},pa.apply(this,arguments)},ca=function(){function t(t){this.undos=[],this.redos=[],this.callbacks=[],this.stopWatch=null,this.curData=null,this.maxSize=50,this.waitTime=100,this.eventCenter=t}return t.prototype.add=function(t){S(T(this.undos),t)||(this.undos.push(t),S(this.curData,t)||(this.redos=[]),this.eventCenter.emit(st.HISTORY_CHANGE,{data:{undos:this.undos,redos:this.redos,undoAble:this.undoAble(),redoAble:this.redoAble()}}),this.undos.length>this.maxSize&&this.undos.shift())},t.prototype.undoAble=function(){return this.undos.length>1},t.prototype.undo=function(){if(this.undoAble()){var t=this.undos.pop();this.redos.push(t);var e=this.undos.pop();return this.curData=s(e),e}},t.prototype.redoAble=function(){return this.redos.length>0},t.prototype.redo=function(){if(this.redoAble()){var t=this.redos.pop();return this.curData=s(t),t}},t.prototype.watch=function(t){var e=this;this.stopWatch&&this.stopWatch(),this.undos.push(t.modelToGraphData()),this.stopWatch=U(t,w(function(){var o=t.modelToHistoryData();o&&e.add(pa({},o))},this.waitTime))},t.prototype.destroy=function(){this.undos=[],this.redos=[],this.curData=null,this.stopWatch&&this.stopWatch()},t}(),ua=function(){return ua=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},ua.apply(this,arguments)},ha=function(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(o[n[r]]=t[n[r]])}return o},fa=null;function ya(t,e){var o,n;return t.x+=e,t.y+=e,P(t.text)||(t.text.x+=e,t.text.y+=e),P(null===(o=t.properties)||void 0===o?void 0:o._label)||null===(n=t.properties)||void 0===n||n._label.forEach(function(t){t.x+=e,t.y+=e}),t}function ga(t,e){return t.startPoint&&(t.startPoint.x+=e,t.startPoint.y+=e),t.endPoint&&(t.endPoint.x+=e,t.endPoint.y+=e),t.pointsList&&t.pointsList.length>0&&t.pointsList.forEach(function(t){t.x+=e,t.y+=e}),P(t.text)||(t.text.x+=e,t.text.y+=e),t}var va=40,ma=40;var xa=function(){function t(t){t.keyboard||(t.keyboard={enabled:!1}),this.options=t;var e=t.lf;this.target=e.container,this.mousetrap=new W(this.target),t.keyboard.enabled&&!e.options.isSilentMode&&this.enable(!0)}return t.prototype.initShortcuts=function(){var t,e=this,o=(null!==(t=this.options.keyboard)&&void 0!==t?t:{}).shortcuts;if(o)if(A(o))o.forEach(function(t){var o=t.keys,n=t.callback,r=t.action;return e.on(o,n,r)});else{var n=o.keys,r=o.callback,i=o.action;this.on(n,r,i)}},t.prototype.on=function(t,e,o){this.mousetrap.bind(this.getKeys(t),e,o)},Object.defineProperty(t.prototype,"disabled",{get:function(){var t,e;return!0!==(null===(e=null===(t=this.options)||void 0===t?void 0:t.keyboard)||void 0===e?void 0:e.enabled)},enumerable:!1,configurable:!0}),t.prototype.off=function(t,e){this.mousetrap.unbind(this.getKeys(t),e)},t.prototype.enable=function(t){(this.disabled||t)&&(this.options.keyboard&&(this.options.keyboard.enabled=!0),this.target instanceof HTMLElement&&(this.target.setAttribute("tabindex","-1"),this.target.style.outline="none"))},t.prototype.disable=function(){this.disabled||(this.options.keyboard&&(this.options.keyboard.enabled=!1),this.target instanceof HTMLElement&&this.target.removeAttribute("tabindex"))},t.prototype.destroy=function(){this.mousetrap.reset()},t.prototype.getKeys=function(t){var e=this;return(Array.isArray(t)?t:[t]).map(function(t){return e.formatKey(t)})},t.prototype.formatKey=function(t){return t.toLowerCase().replace(/\s/g,"").replace("delete","del").replace("cmd","command")},t}(),ba=function(){return ba=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},ba.apply(this,arguments)},Ea=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},Ma=function(t,e,o){if(o||2===arguments.length)for(var n,r=0,i=e.length;r<i;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))},wa=Symbol("plugin registered by Logicflow.use"),Oa=function(){function t(t){var e,o=this;this.viewMap=new Map,this.components=[],this.extension={},this.setView=function(t,e){return o.viewMap.set(t,e)},this.getView=function(t){return o.viewMap.get(t)};var n=Q.get(t),r=n.container,i=n.width,a=n.height;this.options=n,this.container=this.initContainer(r,i,a),this.graphModel=new Tr(ba(ba({},n),{container:this.container})),this.plugins=null!==(e=n.plugins)&&void 0!==e?e:[];var s,l,d,p,c=this.graphModel.eventCenter;this.tool=new da(this),this.dnd=new qi({lf:this}),this.history=new ca(c),this.keyboard=new xa({lf:this,keyboard:n.keyboard}),!1!==n.snapline&&(this.snaplineModel=new Nr(this.graphModel,n.snaplineEpsilon),function(t,e){t.on("node:mousemove",function(t){var o=t.data;e.setNodeSnapLine(o)}),t.on("node:mouseup",function(){e.clearSnapline()})}(c,this.snaplineModel)),n.isSilentMode||(s=this,l=this.graphModel,d=s.keyboard,p=d.options.keyboard,d.on(["cmd + c","ctrl + c"],function(){if(ma=va,!(null==p?void 0:p.enabled))return!0;if(l.textEditElement)return!0;var t=s.options.guards,e=l.getSelectElements(!1);return t&&t.beforeClone&&!t.beforeClone(e)||0===e.nodes.length&&0===e.edges.length?(fa=null,!0):((fa=e).nodes.forEach(function(t){return ya(t,va)}),fa.edges.forEach(function(t){return ga(t,va)}),!1)}),d.on(["cmd + v","ctrl + v"],function(){if(!(null==p?void 0:p.enabled))return!0;if(l.textEditElement)return!0;if(fa&&(fa.nodes||fa.edges)){s.clearSelectElements();var t=s.addElements(fa,ma);if(!t)return!0;t.nodes.forEach(function(t){return s.selectElementById(t.id,!0)}),t.edges.forEach(function(t){return s.selectElementById(t.id,!0)}),fa.nodes.forEach(function(t){return ya(t,va)}),fa.edges.forEach(function(t){return ga(t,va)}),ma+=va}return!1}),d.on(["cmd + z","ctrl + z"],function(){return!(null==p?void 0:p.enabled)||!!l.textEditElement||(s.undo(),!1)}),d.on(["cmd + y","ctrl + y"],function(){return!(null==p?void 0:p.enabled)||!!l.textEditElement||(s.redo(),!1)}),d.on(["backspace"],function(){if(!(null==p?void 0:p.enabled))return!0;if(l.textEditElement)return!0;var t=l.getSelectElements(!0);return s.clearSelectElements(),t.edges.forEach(function(t){return t.id&&s.deleteEdge(t.id)}),t.nodes.forEach(function(t){return t.id&&s.deleteNode(t.id)}),!1}),this.keyboard.initShortcuts()),this.defaultRegister(),this.installPlugins(n.disabledPlugins)}return t.prototype.initContainer=function(t,e,o){var n=document.createElement("div");return n.style.position="relative",n.style.width=e?"".concat(e,"px"):"100%",n.style.height=o?"".concat(o,"px"):"100%",t.innerHTML="",t.appendChild(n),n},Object.defineProperty(t.prototype,Symbol.toStringTag,{get:function(){return t.toStringTag},enumerable:!1,configurable:!0}),t.prototype.register=function(t,e,o){if(void 0===o&&(o=!0),"string"==typeof t){var r={BaseEdge:ki,BaseEdgeModel:Io,BaseNode:ni,BaseNodeModel:on,RectNode:ai,RectNodeModel:_n,CircleNode:di,CircleNodeModel:sn,PolygonNode:ui,PolygonNodeModel:En,TextNode:Ei,TextNodeModel:Dn,LineEdge:Fi,LineEdgeModel:Wo,DiamondNode:yi,DiamondNodeModel:un,PolylineEdge:Zi,PolylineEdgeModel:Jo,BezierEdge:Hi,BezierEdgeModel:zo,EllipseNode:mi,EllipseNodeModel:gn,HtmlNode:Si,HtmlNodeModel:jn,h:n,type:t};if(this.viewMap.forEach(function(t){var e=t.extendKey;e&&(r[e]=t)}),this.graphModel.modelMap.forEach(function(t){var e=t.extendKey;e&&(r[e]=t)}),e){var i=e(r),a=i.view,s=i.model,l=a;o&&!l.isObserved&&(l.isObserved=!0,l=_a(l)),this.setView(t,l),this.graphModel.setModel(t,s)}}else this.registerElement(t)},t.prototype.registerElement=function(t){var e=t.view;!1===t.isObserverView||e.isObserved||(e.isObserved=!0,e=_a(e)),this.setView(t.type,e),this.graphModel.setModel(t.type,t.model)},t.prototype.batchRegister=function(t){var e=this;void 0===t&&(t=[]),u(t,function(t){e.registerElement(t)})},t.prototype.defaultRegister=function(){var t=[{type:"rect",view:ai,model:_n},{type:"circle",view:di,model:sn},{type:"polygon",view:ui,model:En},{type:"text",view:Ei,model:Dn},{type:"ellipse",view:mi,model:gn},{type:"diamond",view:yi,model:un},{type:"html",view:Si,model:jn},{type:"line",view:Fi,model:Wo},{type:"polyline",view:Zi,model:Jo},{type:"bezier",view:Hi,model:zo}];this.batchRegister(t)},t.prototype.addNode=function(t,e,o){return void 0===e&&(e=st.NODE_ADD),this.graphModel.addNode(t,e,o)},t.prototype.deleteNode=function(t){var e=this.graphModel.getNodeModelById(t);if(!e)return!1;var o=e.getData(),n=this.options.guards,r=!(null==n?void 0:n.beforeDelete)||n.beforeDelete(o);return r&&this.graphModel.deleteNode(t),r},t.prototype.cloneNode=function(t){var e=this.graphModel.getNodeModelById(t),o=null==e?void 0:e.getData();if(o){var n=this.options.guards;if(!(null==n?void 0:n.beforeClone)||n.beforeClone(o))return this.graphModel.cloneNode(t)}},t.prototype.changeNodeId=function(t,e){return this.graphModel.changeNodeId(t,e)},t.prototype.changeNodeType=function(t,e){this.graphModel.changeNodeType(t,e)},t.prototype.getNodeModelById=function(t){return this.graphModel.getNodeModelById(t)},t.prototype.getNodeDataById=function(t){var e=this.getNodeModelById(t);return null==e?void 0:e.getData()},t.prototype.getNodeIncomingEdge=function(t){return this.graphModel.getNodeIncomingEdge(t)},t.prototype.getNodeOutgoingEdge=function(t){return this.graphModel.getNodeOutgoingEdge(t)},t.prototype.getNodeIncomingNode=function(t){return this.graphModel.getNodeIncomingNode(t)},t.prototype.getNodeOutgoingNode=function(t){return this.graphModel.getNodeOutgoingNode(t)},t.prototype.createFakeNode=function(t){var e=this.graphModel.modelMap.get(t.type);if(!e)return console.warn("不存在为".concat(t.type,"类型的节点")),null;var o=new e(ba(ba({},t),{virtual:!0}),this.graphModel);return this.graphModel.setFakeNode(o),o},t.prototype.removeFakeNode=function(){this.graphModel.removeFakeNode()},t.prototype.setNodeSnapLine=function(t){var e;null===(e=this.snaplineModel)||void 0===e||e.setNodeSnapLine(t)},t.prototype.removeNodeSnapLine=function(){var t;null===(t=this.snaplineModel)||void 0===t||t.clearSnapline()},t.prototype.setDefaultEdgeType=function(t){this.graphModel.setDefaultEdgeType(t)},t.prototype.addEdge=function(t){return this.graphModel.addEdge(t)},t.prototype.getEdgeDataById=function(t){var e=this.getEdgeModelById(t);return null==e?void 0:e.getData()},t.prototype.getEdgeModelById=function(t){return this.graphModel.getEdgeModelById(t)},t.prototype.getEdgeModels=function(t){var e=t.sourceNodeId,o=t.targetNodeId,n=[],r=this.graphModel.edges;return e&&o?u(r,function(t){t.sourceNodeId===e&&t.targetNodeId===o&&n.push(t)}):e?u(r,function(t){t.sourceNodeId===e&&n.push(t)}):o&&u(r,function(t){t.targetNodeId===o&&n.push(t)}),n},t.prototype.changeEdgeId=function(t,e){return this.graphModel.changeEdgeId(t,e)},t.prototype.changeEdgeType=function(t,e){this.graphModel.changeEdgeType(t,e)},t.prototype.deleteEdge=function(t){var e=this.graphModel.getEdgeModelById(t);if(!e)return!1;var o=e.getData(),n=this.options.guards,r=!(null==n?void 0:n.beforeDelete)||n.beforeDelete(o);return r&&this.graphModel.deleteEdgeById(t),r},t.prototype.deleteEdgeByNodeId=function(t){var e=t.sourceNodeId,o=t.targetNodeId;e&&o?this.graphModel.deleteEdgeBySourceAndTarget(e,o):e?this.graphModel.deleteEdgeBySource(e):o&&this.graphModel.deleteEdgeByTarget(o)},t.prototype.getNodeEdges=function(t){return this.graphModel.getNodeEdges(t)},t.prototype.addElements=function(t,e){var o=this,n=t.nodes,r=t.edges;void 0===e&&(e=40),console.log("distance",e);var i={},a={nodes:[],edges:[]};return u(n,function(t){var e=t.id,n=o.addNode(t);e&&(i[e]=n.id),a.nodes.push(n)}),u(r,function(t){var e=t.sourceNodeId,n=t.targetNodeId;i[e]&&(e=i[e]),i[n]&&(n=i[n]);var r=o.graphModel.addEdge(ba(ba({},t),{sourceNodeId:e,targetNodeId:n}));a.edges.push(r)}),a},t.prototype.selectElementById=function(t,e,o){void 0===e&&(e=!1),void 0===o&&(o=!0),this.graphModel.selectElementById(t,e),!e&&o&&this.graphModel.toFront(t)},t.prototype.deselectElementById=function(t){this.graphModel.deselectElementById(t)},t.prototype.getSelectElements=function(t){return void 0===t&&(t=!0),this.graphModel.getSelectElements(t)},t.prototype.clearSelectElements=function(){this.graphModel.clearSelectElements()},t.prototype.getModelById=function(t){return this.graphModel.getElement(t)},t.prototype.getDataById=function(t){var e;return null===(e=this.graphModel.getElement(t))||void 0===e?void 0:e.getData()},t.prototype.deleteElement=function(t){var e,o,n,r=this.getModelById(t);return!!r&&(null!==(n=null===(o=((e={})[it.NODE]=this.deleteNode,e[it.EDGE]=this.deleteEdge,e)[r.BaseType])||void 0===o?void 0:o.call(this,t))&&void 0!==n&&n)},t.prototype.setElementZIndex=function(t,e){return this.graphModel.setElementZIndex(t,e)},t.prototype.getAreaElement=function(t,e,o,n,r){return void 0===o&&(o=!0),void 0===n&&(n=!0),void 0===r&&(r=!1),this.graphModel.getAreaElement(t,e,o,n,r).map(function(t){return t.getData()})},t.prototype.setProperties=function(t,e){var o;null===(o=this.graphModel.getElement(t))||void 0===o||o.setProperties(nt(e))},t.prototype.getProperties=function(t){var e;return null===(e=this.graphModel.getElement(t))||void 0===e?void 0:e.getProperties()},t.prototype.deleteProperty=function(t,e){var o;null===(o=this.graphModel.getElement(t))||void 0===o||o.deleteProperty(e)},t.prototype.updateAttributes=function(t,e){this.graphModel.updateAttributes(t,e)},t.prototype.editText=function(t){this.graphModel.editText(t)},t.prototype.updateText=function(t,e){this.graphModel.updateText(t,e)},t.prototype.updateEditConfig=function(t){var e=this.graphModel,o=e.editConfigModel,n=e.transformModel,r=o.snapGrid;if(o.updateEditConfig(t),void 0!==(null==t?void 0:t.stopMoveGraph)&&n.updateTranslateLimits(t.stopMoveGraph),(null==t?void 0:t.isSilentMode)?this.keyboard.disable():this.keyboard.enable(!0),!v(null==t?void 0:t.snapGrid)&&t.snapGrid!==r){var i=this.graphModel.grid.size,a=void 0===i?1:i;this.graphModel.updateGridSize(t.snapGrid?a:1)}this.emit(st.EDIT_CONFIG_CHANGED,{data:o.getConfig()})},t.prototype.getEditConfig=function(){return this.graphModel.editConfigModel.getConfig()},t.prototype.setTheme=function(t,e){this.graphModel.setTheme(t,e)},t.prototype.getTheme=function(){return this.graphModel.getTheme()},t.prototype.focusByElement=function(t){var e=void 0,o=this.getNodeModelById(t);if(o){var n=o.getData();e={x:n.x,y:n.y}}var r=this.getEdgeModelById(t);if(r){var i=r.textPosition;e={x:i.x,y:i.y}}e&&this.focusByCoordinate(e)},t.prototype.focusByCoordinate=function(t){var e=this.graphModel,o=e.transformModel,n=e.width,r=e.height,i=t.x,a=t.y;o.focusOn(i,a,n,r)},t.prototype.focusOn=function(t){if("string"==typeof t)this.focusByElement(t);else if("x"in t&&"y"in t)this.focusByCoordinate(t);else{var e=t.id,o=t.coordinate;e&&this.focusByElement(e),o&&this.focusByCoordinate(o)}},t.prototype.resize=function(t,e){this.graphModel.resize(t,e),this.options.width=this.graphModel.width,this.options.height=this.graphModel.height},t.prototype.toFront=function(t){this.graphModel.toFront(t)},t.prototype.getPointByClient=function(t,e){return"object"==typeof t?this.graphModel.getPointByClient(t):"number"==typeof e?this.graphModel.getPointByClient({x:t,y:e}):void 0},t.prototype.getGraphData=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=this.getGraphRawData();return this.adapterOut?this.adapterOut.apply(this,Ma([o],Ea(t),!1)):o},t.prototype.getGraphRawData=function(){return this.graphModel.modelToGraphData()},t.prototype.clearData=function(){this.graphModel.clearData(),this.render({})},t.prototype.renderRawData=function(t){this.graphModel.graphDataToModel(nt(t)),!1!==this.options.history&&this.history.watch(this.graphModel),i(e(kr,{getView:this.getView,tool:this.tool,options:this.options,dnd:this.dnd,snaplineModel:this.snaplineModel,graphModel:this.graphModel}),this.container),this.emit(st.GRAPH_RENDERED,{data:this.graphModel.modelToGraphData(),graphModel:this.graphModel})},t.prototype.render=function(t){var e=s(t);this.adapterIn&&(e=this.adapterIn(e)),this.renderRawData(e)},t.prototype.undo=function(){if(this.history.undoAble()){var t=nt(this.history.undo());this.clearSelectElements(),this.graphModel.graphDataToModel(t)}},t.prototype.redo=function(){if(this.history.redoAble()){var t=nt(this.history.redo());this.clearSelectElements(),this.graphModel.graphDataToModel(t)}},t.prototype.zoom=function(t,e){return this.graphModel.transformModel.zoom(t,e)},t.prototype.resetZoom=function(){this.graphModel.transformModel.resetZoom()},t.prototype.setZoomMiniSize=function(t){this.graphModel.transformModel.setZoomMiniSize(t)},t.prototype.setZoomMaxSize=function(t){this.graphModel.transformModel.setZoomMaxSize(t)},t.prototype.getTransform=function(){var t=this.graphModel.transformModel;return{SCALE_X:t.SCALE_X,SCALE_Y:t.SCALE_Y,TRANSLATE_X:t.TRANSLATE_X,TRANSLATE_Y:t.TRANSLATE_Y}},t.prototype.translate=function(t,e){this.graphModel.transformModel.translate(t,e)},t.prototype.resetTranslate=function(){var t=this.graphModel.transformModel,e=t.TRANSLATE_X,o=t.TRANSLATE_Y;this.translate(-e,-o)},t.prototype.translateCenter=function(){this.graphModel.translateCenter()},t.prototype.fitView=function(t,e){void 0===e&&(e=t),this.graphModel.fitView(t,e)},t.prototype.openEdgeAnimation=function(t){this.graphModel.openEdgeAnimation(t)},t.prototype.closeEdgeAnimation=function(t){this.graphModel.closeEdgeAnimation(t)},t.prototype.on=function(t,e){this.graphModel.eventCenter.on(t,e)},t.prototype.off=function(t,e){this.graphModel.eventCenter.off(t,e)},t.prototype.once=function(t,e){this.graphModel.eventCenter.once(t,e)},t.prototype.emit=function(t,e){this.graphModel.eventCenter.emit(t,e)},t.use=function(t,e){var o,n=t.pluginName;if(!n)throw new Error("请给插件指定 pluginName!");this.extensions.set(n,((o={})[wa]=wa,o.extension=t,o.props=e,o))},t.addThemeMode=function(t,e){!function(t,e){Mo[t]?console.warn("theme mode ".concat(t," already exists")):(Mo[t]=e,Oo[t]=e.background||wo,So[t]=e.grid||_o)}(t,e)},t.removeThemeMode=function(t){!function(t){delete Mo[t],delete Oo[t],delete So[t]}(t)},t.clearThemeMode=function(){Po()},t.prototype.installPlugins=function(e){var o=this;void 0===e&&(e=[]);var n=Array.from(t.extensions,function(t){return Ea(t,2)[1]}),r=Ma(Ma([],Ea(this.plugins),!1),Ea(n),!1);u(r,function(t){var n,r;wa in t?(n=t.extension,r=t.props):n=t;var i=null==n?void 0:n.pluginName;-1===N(e,i)&&o.installPlugin(n,r)})},t.prototype.installPlugin=function(e,o){var n,r;if("pluginName"in e&&"install"in e){var i=e.pluginName,a=e.install,s=e.render;i&&(a&&a.call(e,this,t),s&&this.components.push(s.bind(e)),this.extension[i]=e)}else{var l=e,d=l.pluginName,p=new l({lf:this,LogicFlow:t,props:o,options:null!==(r=null===(n=this.options.pluginsOptions)||void 0===n?void 0:n[d])&&void 0!==r?r:{}});p.render&&this.components.push(p.render.bind(p)),this.extension[d]=p}},t.prototype.destroy=function(){var t;for(var e in this.clearData(),i(null,this.container),this.keyboard.destroy(),this.graphModel.destroy(),this.tool.destroy(),this.history.destroy(),Po(),this.extension){var o=this.extension[e];"destroy"in o&&(null===(t=o.destroy)||void 0===t||t.call(o))}},t.extensions=new Map,t}();function _a(e){return t(e)}!function(t){t.toStringTag="LF.".concat(t.name)}(Oa||(Oa={}));var Sa=40,Ta=40,Pa=40,Aa=40,Na=40,Da=40,Ca=100,ja=80,La=100,Ia=80,Ra=function(){function t(){globalThis._ids=this,this._ids=new Set}return t.prototype.generateId=function(){return"xxxxxxx".replace(/[x]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},t.prototype.next=function(){for(var t=this.generateId();this._ids.has(t);)t=this.generateId();return this._ids.add(t),t},t}(),ka=(null===globalThis||void 0===globalThis?void 0:globalThis._ids)||new Ra;function Ba(){return ka.next()}var Xa=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();!function(t){function e(e,o){return e.id||(e.id="Event_".concat(Ba())),e.text||(e.text=""),e.text&&"string"==typeof e.text&&(e.text={value:e.text,x:e.x,y:e.y+40}),t.call(this,e,o)||this}Xa(e,t),e.prototype.setAttributes=function(){this.r=18},e.prototype.getConnectedTargetRules=function(){var e=t.prototype.getConnectedTargetRules.call(this);return e.push({message:"起始节点不能作为边的终点",validate:function(){return!1}}),e},e.extendKey="StartEventModel"}(sn),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}Xa(e,t),e.extendKey="StartEventNode"}(di);var za=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Ha=function(){return Ha=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Ha.apply(this,arguments)};!function(t){function e(e,o){return e.id||(e.id="Event_".concat(Ba())),e.text||(e.text=""),e.text&&"string"==typeof e.text&&(e.text={value:e.text,x:e.x,y:e.y+40}),t.call(this,e,o)||this}za(e,t),e.prototype.setAttributes=function(){this.r=18},e.prototype.getConnectedSourceRules=function(){var e=t.prototype.getConnectedSourceRules.call(this);return e.push({message:"结束节点不能作为边的起点",validate:function(){return!1}}),e},e.extendKey="EndEventModel"}(sn),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}za(e,t),e.prototype.getAnchorStyle=function(){return{visibility:"hidden"}},e.prototype.getShape=function(){var e=this.props.model,o=e.getNodeStyle(),r=e,i=r.x,a=r.y,s=r.r,l=t.prototype.getShape.call(this);return n("g",{},l,n("circle",Ha(Ha({},o),{cx:i,cy:a,r:s-5})))},e.extendKey="EndEventView"}(di);var Ga=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();!function(t){function e(e,o){return e.id||(e.id="Flow_".concat(Ba())),t.call(this,e,o)||this}Ga(e,t),e.extendKey="SequenceFlowModel"}(Jo),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}Ga(e,t),e.extendKey="SequenceFlowEdge"}(Zi);var Ya=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Fa=function(){return Fa=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Fa.apply(this,arguments)};!function(t){function e(e,o){var n=this;return e.id||(e.id="Gateway_".concat(Ba())),e.text||(e.text=""),e.text&&"string"==typeof e.text&&(e.text={value:e.text,x:e.x,y:e.y+40}),(n=t.call(this,e,o)||this).points=[[25,0],[50,25],[25,50],[0,25]],n}Ya(e,t),e.extendKey="ExclusiveGatewayModel"}(En),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}Ya(e,t),e.prototype.getShape=function(){var t=this.props.model,e=t,o=e.x,r=e.y,i=e.width,a=e.height,s=e.points,l=t.getNodeStyle();return n("g",{transform:"matrix(1 0 0 1 ".concat(o-i/2," ").concat(r-a/2,")")},n("polygon",Fa(Fa({},l),{x:o,y:r,points:s})),n("path",Fa({d:"m 16,15 7.42857142857143,9.714285714285715 -7.42857142857143,9.714285714285715 3.428571428571429,0 5.714285714285715,-7.464228571428572 5.714285714285715,7.464228571428572 3.428571428571429,0 -7.42857142857143,-9.714285714285715 7.42857142857143,-9.714285714285715 -3.428571428571429,0 -5.714285714285715,7.464228571428572 -5.714285714285715,-7.464228571428572 -3.428571428571429,0 z"},l)))},e.extendKey="ExclusiveGatewayNode"}(ui);var Wa=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Ua=function(){return Ua=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Ua.apply(this,arguments)};!function(t){function e(e,o){return e.id||(e.id="Activity_".concat(Ba())),t.call(this,e,o)||this}Wa(e,t),e.extendKey="ServiceTaskModel"}(_n),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}Wa(e,t),e.prototype.getLabelShape=function(){var t=this.props.model,e=t.x,o=t.y,r=t.width,i=t.height,a=t.getNodeStyle();return n("svg",{x:e-r/2+5,y:o-i/2+5,width:30,height:30,viewBox:"0 0 1274 1024"},n("path",{fill:a.stroke,d:"M882.527918 434.149934c-2.234901-5.303796-7.311523-8.853645-13.059434-9.138124l-61.390185-3.009544c-6.635117-20.973684-15.521508-41.175795-26.513864-60.282968l42.051745-47.743374c4.308119-4.889357 4.955872-12.004405 1.602498-17.59268-46.384423-77.30362-103.969956-101.422947-106.400309-102.410438-5.332449-2.170432-11.432377-1.090844-15.693424 2.77009L654.674467 240.664222c-17.004279-8.654101-35.092239-15.756869-53.995775-21.210068l-3.26537-66.490344c-0.280386-5.747911-3.833305-10.824533-9.134031-13.059434-1.683339-0.709151-30.193673-12.391215-76.866668-12.051477-46.672996-0.339738-75.18333 11.342326-76.866668 12.051477-5.300726 2.234901-8.853645 7.311523-9.134031 13.059434l-3.26537 66.490344c-18.903535 5.453199-36.991496 12.555967-53.995775 21.210068l-48.450479-43.922349c-4.261047-3.860934-10.360975-4.940522-15.693424-2.77009-2.430352 0.98749-60.015885 25.106818-106.400309 102.410438-3.353374 5.588275-2.705622 12.703323 1.602498 17.59268l42.051745 47.743374c-10.992355 19.107173-19.878746 39.309284-26.513864 60.282968l-61.390185 3.009544c-5.747911 0.284479-10.824533 3.834328-13.059434 9.138124-1.01512 2.415003-24.687262 60.190871-2.822278 147.651828 1.583055 6.324032 7.072069 10.893094 13.57518 11.308557 5.892197 0.37146 11.751648 0.523933 17.419741 0.667196 14.498202 0.372483 28.193109 0.723477 40.908712 4.63353 4.212952 1.294482 6.435573 8.270361 9.349949 18.763342 1.287319 4.640694 2.617617 9.43693 4.484128 14.010085 1.794879 4.393054 3.75758 8.570189 5.66093 12.607132 1.302669 2.765997 2.529613 5.380544 3.689019 8.018627 2.986007 6.803963 2.682086 9.773598 2.578732 10.349719-3.061732 3.672646-6.391571 7.238868-9.91379 11.015891-1.810229 1.943258-3.680832 3.949962-5.523807 5.980201l-22.560832 24.8909c-3.865028 4.261047-4.940522 10.365068-2.774183 15.693424 0.991584 2.426259 25.102724 60.011792 102.414531 106.400309 5.588275 3.353374 12.703323 2.701528 17.591657-1.603521l23.476691-20.682042c2.346441-2.061962 4.64888-4.336772 6.875594-6.534833 9.05319-8.93858 14.018272-12.95608 17.73185-11.576663 3.305279 1.222851 6.907317 3.166109 10.720156 5.228071 3.325745 1.794879 6.764054 3.650133 10.465352 5.288446 6.016017 2.662643 12.120039 4.688789 18.019399 6.65149 6.827499 2.266623 13.279445 4.409426 18.819624 7.275707 1.518586 0.782829 1.926886 0.994654 2.358721 7.830339 0.726547 11.496845 1.25048 23.276123 1.753947 34.672684 0.264013 5.900384 0.528026 11.803837 0.815575 17.700127 0.284479 5.743818 3.833305 10.82044 9.138124 13.05534 1.654686 0.698918 29.371958 12.063757 74.869175 12.063757 0.328481 0 3.65832 0 3.986801 0 45.497217 0 73.214489-11.364839 74.869175-12.063757 5.304819-2.234901 8.853645-7.311523 9.138124-13.05534 0.287549-5.89629 0.551562-11.799744 0.815575-17.700127 0.503467-11.396561 1.027399-23.175839 1.753947-34.672684 0.431835-6.835685 0.840134-7.04751 2.358721-7.830339 5.54018-2.866281 11.992125-5.009084 18.819624-7.275707 5.89936-1.962701 12.003382-3.988848 18.019399-6.65149 3.701299-1.638313 7.139607-3.493567 10.465352-5.288446 3.812839-2.061962 7.414877-4.00522 10.720156-5.228071 3.713578-1.379417 8.67866 2.638083 17.73185 11.576663 2.226714 2.198062 4.529153 4.472871 6.875594 6.534833l23.476691 20.682042c4.888334 4.305049 12.003382 4.956895 17.591657 1.603521 77.311807-46.388517 101.422947-103.97405 102.414531-106.400309 2.166339-5.328355 1.090844-11.432377-2.774183-15.693424l-22.560832-24.8909c-1.842974-2.030239-3.713578-4.036943-5.523807-5.980201-3.52222-3.777023-6.852058-7.343245-9.91379-11.015891-0.103354-0.576121-0.407276-3.545756 2.578732-10.349719 1.159406-2.638083 2.38635-5.252631 3.689019-8.018627 1.90335-4.036943 3.866051-8.214079 5.66093-12.607132 1.866511-4.573155 3.196809-9.369392 4.484128-14.010085 2.914376-10.492982 5.136997-17.46886 9.349949-18.763342 12.715603-3.910053 26.41051-4.261047 40.908712-4.63353 5.668093-0.143263 11.527544-0.295735 17.419741-0.667196 6.503111-0.415462 11.992125-4.984524 13.57518-11.308557C907.21518 494.340805 883.543038 436.564937 882.527918 434.149934zM643.49894 643.761929c-35.280528 35.280528-82.191954 54.711066-132.086317 54.711066s-96.806813-19.430538-132.086317-54.711066c-35.280528-35.279504-54.711066-82.191954-54.711066-132.086317 0-49.894364 19.430538-96.80272 54.711066-132.082224 35.283598-35.284621 82.191954-54.711066 132.086317-54.711066s96.80579 19.426445 132.086317 54.711066c35.279504 35.279504 54.711066 82.187861 54.711066 132.082224C698.210006 561.569976 678.782537 608.482425 643.49894 643.761929z"}))},e.prototype.getShape=function(){var t=this.props.model,e=t.x,o=t.y,r=t.width,i=t.height,a=t.radius,s=t.getNodeStyle();return n("g",{},[n("rect",Ua({x:e-r/2,y:o-i/2,rx:a,ry:a,width:r,height:i},s)),this.getLabelShape()])},e.extendKey="ServiceTaskNode"}(ai);var Va=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Za=function(){return Za=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Za.apply(this,arguments)};!function(t){function e(e,o){return e.id||(e.id="Activity_".concat(Ba())),t.call(this,e,o)||this}Va(e,t),e.extendKey="UserTaskModel"}(_n),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}Va(e,t),e.prototype.getLabelShape=function(){var t=this.props.model,e=t.x,o=t.y,r=t.width,i=t.height,a=t.getNodeStyle();return n("svg",{x:e-r/2+5,y:o-i/2+5,width:25,height:25,viewBox:"0 0 1274 1024"},n("path",{fill:a.stroke,d:"M655.807326 287.35973m-223.989415 0a218.879 218.879 0 1 0 447.978829 0 218.879 218.879 0 1 0-447.978829 0ZM1039.955839 895.482975c-0.490184-212.177424-172.287821-384.030443-384.148513-384.030443-211.862739 0-383.660376 171.85302-384.15056 384.030443L1039.955839 895.482975z"}))},e.prototype.getShape=function(){var t=this.props.model,e=t.x,o=t.y,r=t.width,i=t.height,a=t.radius,s=t.getNodeStyle();return n("g",{},[n("rect",Za(Za({},s),{x:e-r/2,y:o-i/2,rx:a,ry:a,width:r,height:i})),this.getLabelShape()])},e.extendKey="UserTaskNode"}(ai);var Ka=function(){function t(){globalThis._ids=this,this._ids=new Set}return t.prototype.generateId=function(){return"xxxxxxx".replace(/[x]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},t.prototype.next=function(){for(var t=this.generateId();this._ids.has(t);)t=this.generateId();return this._ids.add(t),t},t}(),qa=(null===globalThis||void 0===globalThis?void 0:globalThis._ids)||new Ka;function Ja(){return qa.next()}function $a(t){return Object.prototype.toString.call(t)}function Qa(t){var e=t;return"[object Object]"===$a(t)?(e={},Object.keys(t).forEach(function(o){var n=o;"-"===o.charAt(0)&&(n=o.substring(1)),e[n]=Qa(t[o])})):Array.isArray(t)&&(e=[],t.forEach(function(t,o){e[o]=Qa(t)})),e}var ts="\t\n";function es(t,e,o){var n=function(t){return"  ".repeat(t)}(o);if(0!==t&&!1!==t&&!t)return ts+n+"<".concat(e," />");var r="";if("#text"===e)return ts+n+t;if("#cdata-section"===e)return ts+n+"<![CDATA["+t+"]]>";if("#comment"===e)return ts+n+"\x3c!--"+t+"--\x3e";if("-"==="".concat(e).charAt(0))return" "+e.substring(1)+'="'+function(t){var e=t;try{"string"!=typeof e&&(e=JSON.parse(t))}catch(o){e=JSON.stringify(Qa(t)).replace(/"/g,"'")}return e}(t)+'"';if(Array.isArray(t))t.forEach(function(t){r+=es(t,e,o+1)});else if("[object Object]"===$a(t)){var i=Object.keys(t),a="",s="";r+=(0===o?"":ts+n)+"<"+e,i.forEach(function(e){"-"===e.charAt(0)?a+=es(t[e],e,o+1):s+=es(t[e],e,o+1)}),r+=a+(""!==s?">".concat(s).concat(ts+n,"</").concat(e,">"):" />")}else r+=ts+n+"<".concat(e,">").concat(t.toString(),"</").concat(e,">");return r}var os=function(){};(os.ObjTree=function(){return this}).VERSION="0.23",os.ObjTree.prototype.xmlDecl='<?xml version="1.0" encoding="UTF-8" ?>\n',os.ObjTree.prototype.attr_prefix="-",os.ObjTree.prototype.parseXML=function(t){var e;if(window.DOMParser){var o=new DOMParser,n=o.parseFromString(t,"application/xml");if(!n)return;e=n.documentElement}else window.ActiveXObject&&((o=new ActiveXObject("Microsoft.XMLDOM")).async=!1,o.loadXML(t),e=o.documentElement);if(e)return this.parseDOM(e)},os.ObjTree.prototype.parseHTTP=function(t,e,o){var n,r={};for(var i in e)r[i]=e[i];if(r.method||(void 0===r.postBody&&void 0===r.postbody&&void 0===r.parameters?r.method="get":r.method="post"),o){r.asynchronous=!0;var a=this,s=o,l=r.onComplete;r.onComplete=function(t){var e;t&&t.responseXML&&t.responseXML.documentElement&&(e=a.parseDOM(t.responseXML.documentElement)),s(e,t),l&&l(t)}}else r.asynchronous=!1;if("undefined"!=typeof HTTP&&HTTP.Request)r.uri=t,(d=new HTTP.Request(r))&&(n=d.transport);else if("undefined"!=typeof Ajax&&Ajax.Request){var d;(d=new Ajax.Request(t,r))&&(n=d.transport)}return o?n:n&&n.responseXML&&n.responseXML.documentElement?this.parseDOM(n.responseXML.documentElement):void 0},os.ObjTree.prototype.parseDOM=function(t){if(t){if(this.__force_array={},this.force_array)for(var e=0;e<this.force_array.length;e++)this.__force_array[this.force_array[e]]=1;var o=this.parseElement(t);if(this.__force_array[t.nodeName]&&(o=[o]),11!=t.nodeType){var n={};n[t.nodeName]=o,o=n}return o}},os.ObjTree.prototype.parseElement=function(t){if(7!=t.nodeType){if(3==t.nodeType||4==t.nodeType||8==t.nodeType){if(null==t.nodeValue.match(/[^\x00-\x20]/))return;return t.nodeValue}var e=null,o={};if(t.attributes&&t.attributes.length){e={};for(var n=0;n<t.attributes.length;n++){if("string"==typeof(s=t.attributes[n].nodeName)){var r=t.attributes[n].nodeValue;try{r=JSON.parse(t.attributes[n].nodeValue.replace(/'/g,'"'))}catch(l){r=t.attributes[n].nodeValue}r&&(void 0===o[s=this.attr_prefix+s]&&(o[s]=0),o[s]++,this.addNode(e,s,o[s],r))}}}if(t.childNodes&&t.childNodes.length){var i=!0;e&&(i=!1);for(n=0;n<t.childNodes.length&&i;n++){var a=t.childNodes[n].nodeType;3!=a&&4!=a&&8!=a&&(i=!1)}if(i){e||(e="");for(n=0;n<t.childNodes.length;n++)e+=t.childNodes[n].nodeValue}else{e||(e={});for(n=0;n<t.childNodes.length;n++){var s;if("string"==typeof(s=t.childNodes[n].nodeName))(r=this.parseElement(t.childNodes[n]))&&(void 0===o[s]&&(o[s]=0),o[s]++,this.addNode(e,s,o[s],r))}}}else null===e&&(e={});return e}},os.ObjTree.prototype.addNode=function(t,e,o,n){this.__force_array[e]?(1==o&&(t[e]=[]),t[e][t[e].length]=n):1==o?t[e]=n:2==o?t[e]=[t[e],n]:t[e][t[e].length]=n},os.ObjTree.prototype.writeXML=function(t){var e=this.hash_to_xml(null,t);return this.xmlDecl+e},os.ObjTree.prototype.hash_to_xml=function(t,e){var o=[],n=[];for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];r.charAt(0)!=this.attr_prefix?void 0===i||null==i?o[o.length]="<"+r+" />":"object"==typeof i&&i.constructor==Array?o[o.length]=this.array_to_xml(r,i):o[o.length]="object"==typeof i?this.hash_to_xml(r,i):this.scalar_to_xml(r,i):n[n.length]=" "+r.substring(1)+'="'+this.xml_escape(i)+'"'}var a=n.join(""),s=o.join("");return void 0===t||null==t||(s=o.length>0?s.match(/\n/)?"<"+t+a+">\n"+s+"</"+t+">\n":"<"+t+a+">"+s+"</"+t+">\n":"<"+t+a+" />\n"),s},os.ObjTree.prototype.array_to_xml=function(t,e){for(var o=[],n=0;n<e.length;n++){var r=e[n];void 0===r||null==r?o[o.length]="<"+t+" />":"object"==typeof r&&r.constructor==Array?o[o.length]=this.array_to_xml(t,r):o[o.length]="object"==typeof r?this.hash_to_xml(t,r):this.scalar_to_xml(t,r)}return o.join("")},os.ObjTree.prototype.scalar_to_xml=function(t,e){return"#text"==t?this.xml_escape(e):"<"+t+">"+this.xml_escape(e)+"</"+t+">\n"},os.ObjTree.prototype.xml_escape=function(t){return t.replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">").replace(/"/g,'"')};var ns,rs=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),is=function(){return is=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},is.apply(this,arguments)},as=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a};!function(t){t.START="bpmn:startEvent",t.END="bpmn:endEvent",t.GATEWAY="bpmn:exclusiveGateway",t.USER="bpmn:userTask",t.SYSTEM="bpmn:serviceTask",t.FLOW="bpmn:sequenceFlow"}(ns||(ns={}));var ss=["-name","-id","bpmn:incoming","bpmn:outgoing","-sourceRef","-targetRef"],ls=["properties","startPoint","endPoint","pointsList"];function ds(t){var e=t?ls.concat(t):ls;return function(t){return function t(o){var n={};return"string"==typeof o?o:Array.isArray(o)?o.map(function(e){return t(e)}):(Object.entries(o).forEach(function(o){var r=as(o,2),i=r[0],a=r[1];"object"!=typeof a?0===i.indexOf("-")||["#text","#cdata-section","#comment"].includes(i)?n[i]=a:n["-".concat(i)]=a:e.includes(i)?n["-".concat(i)]=t(a):n[i]=t(a)}),n)}(t)}}function ps(t){var e={};return Object.entries(t).forEach(function(t){var o=as(t,2),n=o[0],r=o[1];0===n.indexOf("-")?e[n.substring(1)]=Qa(r):"string"==typeof r?e[n]=r:"[object Object]"===Object.prototype.toString.call(r)?e[n]=ps(r):Array.isArray(r)?e[n]=r.map(function(t){return ps(t)}):e[n]=r}),e}function cs(t,e){t["bpmndi:BPMNEdge"]=e.edges.map(function(t){var e,o=t.id,n=t.pointsList.map(function(t){return{"-x":t.x,"-y":t.y}}),r={"-id":"".concat(o,"_di"),"-bpmnElement":o,"di:waypoint":n};return(null===(e=t.text)||void 0===e?void 0:e.value)&&(r["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-10*t.text.value.length/2,"-y":t.text.y-7,"-width":10*t.text.value.length,"-height":14}}),r}),t["bpmndi:BPMNShape"]=e.nodes.map(function(t){var e,o=t.id,n=100,r=80,i=t.x,a=t.y,s=ys.shapeConfigMap.get(t.type);s&&(n=s.width,r=s.height),i-=n/2,a-=r/2;var l={"-id":"".concat(o,"_di"),"-bpmnElement":o,"dc:Bounds":{"-x":i,"-y":a,"-width":n,"-height":r}};return(null===(e=t.text)||void 0===e?void 0:e.value)&&(l["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-10*t.text.value.length/2,"-y":t.text.y-7,"-width":10*t.text.value.length,"-height":14}}),l})}function us(t){var e=[],o=[],n=t["bpmn:definitions"];if(n){var r=n["bpmn:process"];Object.keys(r).forEach(function(t){if(0===t.indexOf("bpmn:")){var i=r[t];if(t===ns.FLOW){var a=n["bpmndi:BPMNDiagram"]["bpmndi:BPMNPlane"]["bpmndi:BPMNEdge"];o=function(t,e){var o=[];if(Array.isArray(t))t.forEach(function(t){var n;n=Array.isArray(e)?e.find(function(e){return e["-bpmnElement"]===t["-id"]}):e,o.push(fs(n,t))});else{var n=void 0;n=Array.isArray(e)?e.find(function(e){return e["-bpmnElement"]===t["-id"]}):e,o.push(fs(n,t))}return o}(i,a)}else{var s=n["bpmndi:BPMNDiagram"]["bpmndi:BPMNPlane"]["bpmndi:BPMNShape"];e=e.concat(function(t,e,o){var n=[];if(Array.isArray(t))t.forEach(function(t){var r=hs(Array.isArray(e)?e.find(function(e){return e["-bpmnElement"]===t["-id"]}):e,o,t);n.push(r)});else{var r=hs(Array.isArray(e)?e.find(function(e){return e["-bpmnElement"]===t["-id"]}):e,o,t);n.push(r)}return n}(i,s,t))}}})}return{nodes:e,edges:o}}function hs(t,e,o){var n,r,i=Number(t["dc:Bounds"]["-x"]),a=Number(t["dc:Bounds"]["-y"]),s=o["-name"],l=ys.shapeConfigMap.get(e);if(l&&(i+=l.width/2,a+=l.height/2),Object.entries(o).forEach(function(t){var e=as(t,2),o=e[0],r=e[1];-1===ss.indexOf(o)&&(n||(n={}),n[o]=r)}),n&&(n=ps(n)),s&&(r={x:i,y:a,value:s},t["bpmndi:BPMNLabel"]&&t["bpmndi:BPMNLabel"]["dc:Bounds"])){var d=t["bpmndi:BPMNLabel"]["dc:Bounds"];r.x=Number(d["-x"])+Number(d["-width"])/2,r.y=Number(d["-y"])+Number(d["-height"])/2}var p={id:t["-bpmnElement"],type:e,x:i,y:a,properties:n};return r&&(p.text=r),p}function fs(t,e){var o,n,r=e["-name"]?"".concat(e["-name"]):"";if(r){var i=t["bpmndi:BPMNLabel"]["dc:Bounds"],a=0;r.split("\n").forEach(function(t){a<t.length&&(a=t.length)}),o={value:r,x:Number(i["-x"])+10*a/2,y:Number(i["-y"])+7}}Object.entries(e).forEach(function(t){var e=as(t,2),o=e[0],r=e[1];-1===ss.indexOf(o)&&(n||(n={}),n[o]=r)}),n&&(n=ps(n));var s={id:e["-id"],type:ns.FLOW,pointsList:t["di:waypoint"].map(function(t){return{x:Number(t["-x"]),y:Number(t["-y"])}}),sourceNodeId:e["-sourceRef"],targetNodeId:e["-targetRef"],properties:n};return o&&(s.text=o),s}var ys=function(){function t(t){var e=t.lf,o=this;this.adapterOut=function(t,e){var n=is({},o.processAttributes);!function(t,e,o){var n=new Map;e.nodes.forEach(function(e){var r,i={"-id":e.id};if((null===(r=e.text)||void 0===r?void 0:r.value)&&(i["-name"]=e.text.value),e.properties){var a=ds(o)(e.properties);Object.assign(i,a)}n.set(e.id,i),t[e.type]?Array.isArray(t[e.type])?t[e.type].push(i):t[e.type]=[t[e.type],i]:t[e.type]=i});var r=e.edges.map(function(t){var e,r,i=n.get(t.targetNodeId);i["bpmn:incoming"]?Array.isArray(i["bpmn:incoming"])?i["bpmn:incoming"].push(t.id):i["bpmn:incoming"]=[i["bpmn:incoming"],t.id]:i["bpmn:incoming"]=t.id;var a={"-id":t.id,"-sourceRef":t.sourceNodeId,"-targetRef":t.targetNodeId};if((null===(e=t.text)||void 0===e?void 0:e.value)&&(a["-name"]=null===(r=t.text)||void 0===r?void 0:r.value),t.properties){var s=ds(o)(t.properties);Object.assign(a,s)}return a});e.edges.forEach(function(t){var e=n.get(t.sourceNodeId);e["bpmn:outgoing"]?Array.isArray(e["bpmn:outgoing"])?e["bpmn:outgoing"].push(t.id):e["bpmn:outgoing"]=[e["bpmn:outgoing"],t.id]:e["bpmn:outgoing"]=t.id}),t[ns.FLOW]=r}(n,t,e);var r={"-id":"BPMNPlane_1","-bpmnElement":n["-id"]};cs(r,t);var i=o.definitionAttributes;return i["bpmn:process"]=n,i["bpmndi:BPMNDiagram"]={"-id":"BPMNDiagram_1","bpmndi:BPMNPlane":r},{"bpmn:definitions":i}},this.adapterIn=function(t){if(t)return us(t)},e.adapterIn=function(t){return o.adapterIn(t)},e.adapterOut=function(t,e){return o.adapterOut(t,e)},this.processAttributes={"-isExecutable":"true","-id":"Process_".concat(Ja())},this.definitionAttributes={"-id":"Definitions_".concat(Ja()),"-xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","-xmlns:bpmn":"http://www.omg.org/spec/BPMN/20100524/MODEL","-xmlns:bpmndi":"http://www.omg.org/spec/BPMN/20100524/DI","-xmlns:dc":"http://www.omg.org/spec/DD/20100524/DC","-xmlns:di":"http://www.omg.org/spec/DD/20100524/DI","-targetNamespace":"http://logic-flow.org","-exporter":"logicflow","-exporterVersion":"1.2.0"}}return t.prototype.setCustomShape=function(e,o){t.shapeConfigMap.set(e,o)},t.pluginName="bpmn-adapter",t.shapeConfigMap=new Map,t}();ys.shapeConfigMap.set(ns.START,{width:Sa,height:Ta}),ys.shapeConfigMap.set(ns.END,{width:Pa,height:Aa}),ys.shapeConfigMap.set(ns.GATEWAY,{width:Na,height:Da}),ys.shapeConfigMap.set(ns.SYSTEM,{width:Ca,height:ja}),ys.shapeConfigMap.set(ns.USER,{width:La,height:Ia}),function(t){function e(e){var o=t.call(this,e)||this;o.adapterXmlIn=function(t){var e,n=(e=t,(new os.ObjTree).parseXML(e));return o.adapterIn(n)},o.adapterXmlOut=function(t,e){return function(t){var e="";for(var o in t)e+=es(t[o],o,0);return e}(o.adapterOut(t,e))};var n=e.lf;return n.adapterIn=o.adapterXmlIn,n.adapterOut=o.adapterXmlOut,o}rs(e,t),e.pluginName="bpmnXmlAdapter"}(ys);var gs=function(){function t(){globalThis._ids=this,this._ids=new Set}return t.prototype.generateId=function(){return"xxxxxxx".replace(/[x]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},t.prototype.next=function(){for(var t=this.generateId();this._ids.has(t);)t=this.generateId();return this._ids.add(t),t},t}(),vs=(null===globalThis||void 0===globalThis?void 0:globalThis._ids)||new gs;!function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)}}();!function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)}}();!function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)}}();!function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)}}();!function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)}}();n("circle",{cx:18,cy:18,r:11,style:"stroke-linecap: round;stroke-linejoin: round;stroke: rgb(34, 36, 42);stroke-width: 2px;fill: white"}),n("path",{d:"M 18,18 l 2.25,-7.5 m -2.25,7.5 l 5.25,1.5",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 2px;"}),n("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(0,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),n("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(30,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),n("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(60,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),n("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(90,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),n("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(120,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),n("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(150,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),n("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(180,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),n("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(210,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),n("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(240,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),n("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(270,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),n("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(300,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),n("path",{d:"M 18,18 m 0,7.5 l -0,2.25",transform:"rotate(330,18,18)",style:"fill: none; stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 1px;"}),n("circle",{cx:18,cy:18,r:10,style:"stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 4px; fill: rgb(34, 36, 42);"}),n("circle",{cx:25,cy:25,r:13,style:"stroke-linecap: round; stroke-linejoin: round; stroke: rgb(34, 36, 42); stroke-width: 2.5px; fill: white;"}),function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)}}();!function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)}}();var ms=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),xs=function(){return xs=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},xs.apply(this,arguments)},bs=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},Es=ut,Ms=function(t){function o(e){var o=t.call(this)||this;return o.updatePosition=function(t){var e=t.deltaX,n=t.deltaY,r=o.nodeModel,i=r.x,a=r.y;o.nodeModel.x=i+e/2,o.nodeModel.y=a+n/2,o.nodeModel.moveText(e/2,n/2)},o.getResize=function(t){var e=t.index,o=t.deltaX,n=t.deltaY,r=t.width,i=t.height,a=t.PCTResizeInfo,s=t.pct,l=void 0===s?1:s,d=t.freezeWidth,p=void 0!==d&&d,c=t.freezeHeight,u=void 0!==c&&c,h={width:r,height:i,deltaX:o,deltaY:n};if(a){var f=0,y=0;switch(e){case 0:y=(-1*o-n)/4;break;case 1:y=(o-n)/4;break;case 2:y=(o+n)/4;break;case 3:y=(-1*o+n)/4}0!==y&&(f=Math.round(y/a.ResizeBasis.basisHeight*1e5)/1e3),a.ResizePCT.widthPCT=Math.max(Math.min(a.ResizePCT.widthPCT+f,a.ScaleLimit.maxScaleLimit),a.ScaleLimit.minScaleLimit),a.ResizePCT.heightPCT=Math.max(Math.min(a.ResizePCT.heightPCT+f,a.ScaleLimit.maxScaleLimit),a.ScaleLimit.minScaleLimit);var g=Math.round(a.ResizePCT.widthPCT*a.ResizeBasis.basisWidth/100),v=Math.round(a.ResizePCT.heightPCT*a.ResizeBasis.basisHeight/100);switch(e){case 0:o=r-g,n=i-v;break;case 1:o=g-r,n=i-v;break;case 2:o=g-r,n=v-i;break;case 3:o=r-g,n=v-i}return h.width=g,h.height=v,h.deltaX=o/l,h.deltaY=n/l,h}switch(e){case 0:h.width=p?r:r-o*l,h.height=u?i:i-n*l;break;case 1:h.width=p?r:r+o*l,h.height=u?i:i-n*l;break;case 2:h.width=p?r:r+o*l,h.height=u?i:i+n*l;break;case 3:h.width=p?r:r-o*l,h.height=u?i:i+n*l}return h},o.updateEdgePointByAnchors=function(){var t=o.nodeModel,e=t.id,n=t.anchors,r=o.getNodeEdges(e);r.sourceEdges.forEach(function(t){var e=n.find(function(e){return e.id===t.sourceAnchorId});e&&t.updateStartPoint({x:e.x,y:e.y})}),r.targetEdges.forEach(function(t){var e=n.find(function(e){return e.id===t.targetAnchorId});e&&t.updateEndPoint({x:e.x,y:e.y})})},o.updateRect=function(t){var e=t.deltaX,n=t.deltaY,r=o.nodeModel,i=r.x,a=r.y,s=r.width,l=r.height,d=r.radius,p=r.PCTResizeInfo,c=o.nodeModel,u=c.minWidth,h=c.minHeight,f=c.maxWidth,y=c.maxHeight,g=o.index,v=u===f,m=h===y,x=o.getResize({index:g,deltaX:e,deltaY:n,width:s,height:l,PCTResizeInfo:p,pct:1,freezeWidth:v,freezeHeight:m});if(x.width<u||x.width>f||x.height<h||x.height>y)o.dragHandler.cancelDrag();else{o.updatePosition({deltaX:v?0:x.deltaX,deltaY:m?0:x.deltaY}),o.nodeModel.width=x.width,o.nodeModel.height=x.height,o.nodeModel.setProperties({nodeSize:{width:x.width,height:x.height}});var b={x:i,y:a,width:s,height:l,radius:d},E={x:o.nodeModel.x,y:o.nodeModel.y,width:o.nodeModel.width,height:o.nodeModel.height,radius:d};o.updateEdgePointByAnchors(),o.eventEmit({deltaX:e,deltaY:n,beforeNode:b,afterNode:E})}},o.updateEllipse=function(t){var e=t.deltaX,n=t.deltaY,r=o.nodeModel,i=r.rx,a=r.ry,s=r.x,l=r.y,d=r.PCTResizeInfo,p=o.index,c=o.nodeModel,u=c.minWidth,h=c.minHeight,f=c.maxWidth,y=c.maxHeight,g=u===f,v=h===y,m=i,x=a,b=o.getResize({index:p,deltaX:e,deltaY:n,width:m,height:x,PCTResizeInfo:d,pct:.5,freezeWidth:g,freezeHeight:v});if(b.width<u/2||b.width>f/2||b.height<h/2||b.height>y/2)o.dragHandler.cancelDrag();else{o.updatePosition({deltaX:g?0:b.deltaX,deltaY:v?0:b.deltaY}),o.nodeModel.rx=b.width,o.nodeModel.ry=b.height,o.nodeModel.setProperties({nodeSize:{rx:b.width,ry:b.height}});var E={x:s,y:l},M={rx:b.width,ry:b.height,x:o.nodeModel.x,y:o.nodeModel.y};o.updateEdgePointByAnchors(),o.eventEmit({deltaX:e,deltaY:n,beforeNode:xs(xs({},E),{rx:i,ry:a}),afterNode:M})}},o.updateDiamond=function(t){var e=t.deltaX,n=t.deltaY,r=o.nodeModel,i=r.rx,a=r.ry,s=r.x,l=r.y,d=r.PCTResizeInfo,p=o.index,c=o.nodeModel,u=c.minWidth,h=c.minHeight,f=c.maxWidth,y=c.maxHeight,g=u===f,v=h===y,m=i,x=a,b=o.getResize({index:p,deltaX:e,deltaY:n,width:m,height:x,PCTResizeInfo:d,pct:.5,freezeWidth:g,freezeHeight:v});if(b.width<u/2||b.width>f/2||b.height<h/2||b.height>y/2)o.dragHandler.cancelDrag();else{o.updatePosition({deltaX:g?0:b.deltaX,deltaY:v?0:b.deltaY}),o.nodeModel.rx=b.width,o.nodeModel.ry=b.height,o.nodeModel.setProperties({nodeSize:{rx:b.width,ry:b.height}});var E={x:s,y:l,rx:i,ry:a},M={rx:b.width,ry:b.height,x:o.nodeModel.x,y:o.nodeModel.y};o.updateEdgePointByAnchors(),o.eventEmit({deltaX:e,deltaY:n,beforeNode:E,afterNode:M})}},o.eventEmit=function(t){var e=t.deltaX,n=t.deltaY,r=t.beforeNode,i=t.afterNode,a=o.nodeModel,s=a.id,l=a.modelType,d=a.type,p=xs({id:s,modelType:l,type:d},r),c=xs({id:s,modelType:l,type:d},i);o.graphModel.eventCenter.emit("node:resize",{preData:p,data:c,deltaX:e,deltaY:n,index:o.index,model:o.nodeModel})},o.onDragging=function(t){var e,n=t.deltaX,r=t.deltaY,i=o.graphModel.transformModel,a=o.nodeModel.modelType;n=(e=bs(i.fixDeltaXY(n,r),2))[0],r=e[1],a===at.RECT_NODE||a===at.HTML_NODE?o.updateRect({deltaX:n,deltaY:r}):a===at.ELLIPSE_NODE?o.updateEllipse({deltaX:n,deltaY:r}):a===at.DIAMOND_NODE&&o.updateDiamond({deltaX:n,deltaY:r})},o.onDragEnd=function(){var t=o.graphModel.gridSize,e=void 0===t?1:t,n=e*Math.round(o.nodeModel.x/e),r=e*Math.round(o.nodeModel.y/e);o.nodeModel.moveTo(n,r),o.updateEdgePointByAnchors()},o.index=e.index,o.nodeModel=e.model,o.graphModel=e.graphModel,o.dragHandler=new Es({onDragging:o.onDragging,onDragEnd:o.onDragEnd,step:1}),o}return ms(o,t),o.prototype.getNodeEdges=function(t){for(var e=this.graphModel.edges,o=[],n=[],r=0;r<e.length;r++){var i=e[r];i.sourceNodeId===t?o.push(i):e[r].targetNodeId===t&&n.push(i)}return{sourceEdges:o,targetEdges:n}},o.prototype.render=function(){var t=this.props,o=t.x,n=t.y,r=t.index,i=t.model.getControlPointStyle();return e("g",{className:"lf-resize-control-".concat(r),children:e(Fe,xs({className:"lf-node-control",x:o,y:n},i,{onMouseDown:this.dragHandler.handleMouseDown}))})},o}(o),ws=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Os=function(){return Os=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Os.apply(this,arguments)},_s=function(t){function o(){var e=t.call(this)||this;return e.state={},e}return ws(o,t),o.prototype.getResizeControl=function(){var t=this.props,o=t.model,n=t.graphModel,r=o.x,i=o.y,a=o.width,s=o.height,l={minX:r-a/2,minY:i-s/2,maxX:r+a/2,maxY:i+s/2},d=l.minX,p=l.minY,c=l.maxX,u=l.maxY;return[{x:d,y:p},{x:c,y:p},{x:c,y:u},{x:d,y:u}].map(function(t,r){return e(Ms,Os({index:r},t,{model:o,graphModel:n}))})},o.prototype.getGroupSolid=function(){var t=this.props.model,o=t.x,n=t.y,r=t.width,i=t.height,a=t.getResizeOutlineStyle();return e(Fe,Os({},a,{x:o,y:n,width:r,height:i}))},o.prototype.render=function(){return e("g",{className:"lf-resize-control",children:[this.getGroupSolid(),this.getResizeControl()]})},o}(o),Ss=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();!function(t){function e(e,o){var n=t.call(this,e,o)||this,r=e.properties.nodeSize;return r&&(n.rx=r.rx,n.ry=r.ry),n}Ss(e,t),e.prototype.initNodeData=function(e){t.prototype.initNodeData.call(this,e),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var e=t.prototype.getOutlineStyle.call(this);return this.graphModel.editConfigModel.isSilentMode||(e.stroke="none",e.hover&&(e.hover.stroke="none")),e},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(void 0===t&&(t=!0),t){var e={basisWidth:this.rx,basisHeight:this.ry},o={maxScaleLimit:Math.min(this.maxWidth/(2*this.rx)*100,this.maxHeight/(2*this.ry)*100),minScaleLimit:Math.max(this.minWidth/(2*this.rx)*100,this.minHeight/(2*this.ry)*100)};this.PCTResizeInfo={ResizePCT:{widthPCT:100,heightPCT:100},ResizeBasis:e,ScaleLimit:o}}else delete this.PCTResizeInfo}}(gn),function(t){function o(){return null!==t&&t.apply(this,arguments)||this}Ss(o,t),o.prototype.getControlGroup=function(){var t=this.props,o=t.model,n=t.graphModel;return e(_s,{model:o,graphModel:n})},o.prototype.getResizeShape=function(){return t.prototype.getShape.call(this)},o.prototype.getShape=function(){var t=this.props,o=t.model,n=t.graphModel.editConfigModel.isSilentMode;return e("g",{children:[this.getResizeShape(),o.isSelected&&!n?this.getControlGroup():""]})}}(mi);var Ts=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Ps=function(){return Ps=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Ps.apply(this,arguments)};!function(t){function e(e,o){var n=t.call(this,e,o)||this,r=e.properties.nodeSize;return r&&(n.rx=r.rx,n.ry=r.ry),n}Ts(e,t),e.prototype.initNodeData=function(e){t.prototype.initNodeData.call(this,e),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3,this.gridSize=1},e.prototype.getOutlineStyle=function(){var e=t.prototype.getOutlineStyle.call(this);return this.graphModel.editConfigModel.isSilentMode||(e.stroke="none",e.hover&&(e.hover.stroke="none")),e},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(void 0===t&&(t=!0),t){var e={basisWidth:this.rx,basisHeight:this.ry},o={maxScaleLimit:Math.min(this.maxWidth/(2*this.rx)*100,this.maxHeight/(2*this.ry)*100),minScaleLimit:Math.max(this.minWidth/(2*this.rx)*100,this.minHeight/(2*this.ry)*100)};this.PCTResizeInfo={ResizePCT:{widthPCT:100,heightPCT:100},ResizeBasis:e,ScaleLimit:o}}else delete this.PCTResizeInfo}}(un),function(t){function o(){return null!==t&&t.apply(this,arguments)||this}Ts(o,t),o.prototype.getControlGroup=function(){var t=this.props,o=t.model,n=t.graphModel;return e(_s,{model:o,graphModel:n})},o.prototype.getResizeShape=function(){var t=this.props.model,o=t.points,n=t.getNodeStyle();return e("g",{children:e(oo,Ps({},n,{points:o}))})},o.prototype.getShape=function(){var t=this.props,o=t.model.isSelected,n=t.graphModel.editConfigModel.isSilentMode;return e("g",{children:[this.getResizeShape(),o&&!n?this.getControlGroup():""]})}}(yi);var As=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();!function(t){function e(e,o){var n=t.call(this,e,o)||this,r=e.properties.nodeSize;return r&&(n.width=r.width,n.height=r.height),n}As(e,t),e.prototype.initNodeData=function(e){t.prototype.initNodeData.call(this,e),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var e=t.prototype.getOutlineStyle.call(this);return this.graphModel.editConfigModel.isSilentMode||(e.stroke="none",e.hover&&(e.hover.stroke="none")),e},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(void 0===t&&(t=!0),t){var e={basisWidth:this.width,basisHeight:this.height},o={maxScaleLimit:Math.min(this.maxWidth/this.width*100,this.maxHeight/this.height*100),minScaleLimit:Math.max(this.minWidth/this.width*100,this.minHeight/this.height*100)};this.PCTResizeInfo={ResizePCT:{widthPCT:100,heightPCT:100},ResizeBasis:e,ScaleLimit:o}}else delete this.PCTResizeInfo}}(jn),function(t){function o(){return null!==t&&t.apply(this,arguments)||this}As(o,t),o.prototype.getControlGroup=function(){var t=this.props,o=t.model,n=t.graphModel;return e(_s,{model:o,graphModel:n})},o.prototype.getResizeShape=function(){return t.prototype.getShape.call(this)},o.prototype.getShape=function(){var t=this.props,o=t.model.isSelected,n=t.graphModel.editConfigModel.isSilentMode;return e("g",{children:[this.getResizeShape(),o&&!n?this.getControlGroup():""]})}}(Si);var Ns=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Ds=function(t){function e(e,o){var n=t.call(this,e,o)||this,r=e.properties.nodeSize;return r&&(n.width=r.width,n.height=r.height),n}return Ns(e,t),e.prototype.initNodeData=function(e){t.prototype.initNodeData.call(this,e),this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3},e.prototype.getOutlineStyle=function(){var e=t.prototype.getOutlineStyle.call(this);return this.graphModel.editConfigModel.isSilentMode||(e.stroke="none",e.hover&&(e.hover.stroke="none")),e},e.prototype.getResizeOutlineStyle=function(){return{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},e.prototype.getControlPointStyle=function(){return{width:7,height:7,fill:"#FFFFFF",stroke:"#000000"}},e.prototype.enableProportionResize=function(t){if(void 0===t&&(t=!0),t){var e={basisWidth:this.width,basisHeight:this.height},o={maxScaleLimit:Math.min(this.maxWidth/this.width*100,this.maxHeight/this.height*100),minScaleLimit:Math.max(this.minWidth/this.width*100,this.minHeight/this.height*100)};this.PCTResizeInfo={ResizePCT:{widthPCT:100,heightPCT:100},ResizeBasis:e,ScaleLimit:o}}else delete this.PCTResizeInfo},e}(_n),Cs=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return Ns(o,t),o.prototype.getControlGroup=function(){var t=this.props,o=t.model,n=t.graphModel;return e(_s,{model:o,graphModel:n})},o.prototype.getResizeShape=function(){return t.prototype.getShape.call(this)},o.prototype.getShape=function(){var t=this.props,o=t.model.isSelected,n=t.graphModel.editConfigModel.isSilentMode;return e("g",{children:[this.getResizeShape(),o&&!n?this.getControlGroup():""]})},o}(ai),js=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Ls=function(){return Ls=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Ls.apply(this,arguments)},Is=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},Rs=function(t,e,o){if(o||2===arguments.length)for(var n,r=0,i=e.length;r<i;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))};!function(t){function e(){var e=t.apply(this,Rs([],Is(arguments),!1))||this;return e.isGroup=!0,e.isFolded=!1,e.unfoldedWidth=500,e.unfoldedHeight=300,e.childrenLastFoldStatus={},e}js(e,t),e.prototype.initNodeData=function(e){var o=this;t.prototype.initNodeData.call(this,e);var n=[];A(e.children)&&(n=e.children),this.children=new Set(n),this.width=500,this.height=300,this.foldedWidth=80,this.foldedHeight=60,this.zIndex=-1e4,this.radius=0,this.text.editable=!1,this.text.draggable=!1,this.isRestrict=!1,this.resizable=!1,this.autoToFront=!1,this.foldable=!1,void 0===this.properties.isFolded&&(this.properties.isFolded=!1),this.isFolded=!!this.properties.isFolded,setTimeout(function(){o.isFolded&&o.foldGroup(o.isFolded)})},e.prototype.getResizeOutlineStyle=function(){var e=t.prototype.getResizeOutlineStyle.call(this);return e.stroke="none",e},e.prototype.foldGroup=function(t){var e=this;if(t!==this.isFolded){this.setProperty("isFolded",t),this.isFolded=t,t?(this.x=this.x-this.width/2+this.foldedWidth/2,this.y=this.y-this.height/2+this.foldedHeight/2,this.unfoldedWidth=this.width,this.unfoldedHeight=this.height,this.width=this.foldedWidth,this.height=this.foldedHeight):(this.width=this.unfoldedWidth,this.height=this.unfoldedHeight,this.x=this.x+this.width/2-this.foldedWidth/2,this.y=this.y+this.height/2-this.foldedHeight/2);var o=Rs(Rs([],Is(this.incoming.edges),!1),Is(this.outgoing.edges),!1);this.children.forEach(function(n){var r=e.graphModel.getElement(n);if(r){var i=r.isFolded;if(r.isGroup&&!r.isFolded&&r.foldGroup(t),r.isGroup&&!t){var a=e.childrenLastFoldStatus[n];void 0!==a&&a!==r.isFolded&&r.foldGroup(a)}e.childrenLastFoldStatus[n]=!!i,r.visible=!t;var s=r.incoming.edges,l=r.outgoing.edges;o=Rs(Rs(Rs([],Is(o),!1),Is(s),!1),Is(l),!1)}}),this.foldEdge(t,o)}},e.prototype.getAnchorStyle=function(e){var o=t.prototype.getAnchorStyle.call(this,e);return o.stroke="transparent",o.fill="transparent",o.hover.fill="transparent",o.hover.stroke="transparent",o},e.prototype.foldEdge=function(t,e){var o=this;e.forEach(function(e,n){var r=e.id,i=e.sourceNodeId,a=e.targetNodeId,s=e.startPoint,l=e.endPoint,d=e.type,p=e.text,c=e.getProperties(),u={id:"".concat(r,"__").concat(n),sourceNodeId:i,targetNodeId:a,startPoint:s,endPoint:l,type:d,properties:c,text:null==p?void 0:p.value};e.virtual&&o.graphModel.deleteEdgeById(e.id);var h=o.graphModel.group.getNodeGroup(a);h||(h=o.graphModel.getNodeModelById(a));var f=o.graphModel.group.getNodeGroup(i);f||(f=o.graphModel.getNodeModelById(i)),t&&!1!==e.visible&&(o.children.has(i)||o.id===i?(u.startPoint=void 0,u.sourceNodeId=o.id):(u.endPoint=void 0,u.targetNodeId=o.id),h.id===o.id&&f.id===o.id||o.createVirtualEdge(u),e.visible=!1),t||!1!==e.visible||(h&&h.isGroup&&h.isFolded?(u.targetNodeId=h.id,u.endPoint=void 0,o.createVirtualEdge(u)):f&&f.isGroup&&f.isFolded?(u.sourceNodeId=f.id,u.startPoint=void 0,o.createVirtualEdge(u)):e.visible=!0)})},e.prototype.createVirtualEdge=function(t){t.pointsList=void 0;var e=this.graphModel.addEdge(t);e.virtual=!0,e.text.editable=!1,e.isFoldedEdge=!0},e.prototype.isInRange=function(t){var e=t.minX,o=t.minY,n=t.maxX,r=t.maxY;return e>=this.x-this.width/2&&n<=this.x+this.width/2&&o>=this.y-this.height/2&&r<=this.y+this.height/2},e.prototype.isAllowMoveTo=function(t){var e=t.minX,o=t.minY,n=t.maxX,r=t.maxY;return{x:e>=this.x-this.width/2&&n<=this.x+this.width/2,y:o>=this.y-this.height/2&&r<=this.y+this.height/2}},e.prototype.setAllowAppendChild=function(t){this.setProperty("groupAddable",t)},e.prototype.addChild=function(t){this.children.add(t),this.graphModel.eventCenter.emit("group:add-node",{data:this.getData()})},e.prototype.removeChild=function(t){this.children.delete(t),this.graphModel.eventCenter.emit("group:remove-node",{data:this.getData()})},e.prototype.getAddableOutlineStyle=function(){return{stroke:"#FEB663",strokeWidth:2,strokeDasharray:"4 4",fill:"transparent"}},e.prototype.getData=function(){var e=this,o=t.prototype.getData.call(this);o.children=[],this.children.forEach(function(t){var n=e.graphModel.getNodeModelById(t);n&&!n.virtual&&o.children.push(t)});var n=o.properties;return null==n||delete n.groupAddable,null==n||delete n.isFolded,o},e.prototype.getHistoryData=function(){var e=t.prototype.getData.call(this);e.children=Rs([],Is(this.children),!1),e.isGroup=!0;var o=e.properties;return null==o||delete o.groupAddable,(null==o?void 0:o.isFolded)&&(e.x=e.x+this.unfoldedWidth/2-this.foldedWidth/2,e.y=e.y+this.unfoldedHeight/2-this.foldedHeight/2),e},e.prototype.isAllowAppendIn=function(t){return console.info("_nodeData",t),!0},e.prototype.toBack=function(){this.zIndex--}}(Ds),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}js(e,t),e.prototype.getControlGroup=function(){var e=this.props.model,o=e.resizable,n=e.properties;return o&&!n.isFolded?t.prototype.getControlGroup.call(this):null},e.prototype.getAddableShape=function(){var t=this.props.model,e=t.width,o=t.height,r=t.x,i=t.y,a=t.radius,s=t.properties,l=t.getAddableOutlineStyle;if(!s.groupAddable)return null;var d=this.props.model.getNodeStyle().strokeWidth,p=void 0===d?0:d,c=l(),u=e+p+8,h=o+p+8;return n("rect",Ls(Ls({},c),{width:u,height:h,x:r-u/2,y:i-h/2,rx:a,ry:a}))},e.prototype.getFoldIcon=function(){var t=this.props.model,e=t.x-t.width/2+5,o=t.y-t.height/2+5;if(!t.foldable)return null;var r=n("path",{fill:"none",stroke:"#818281",strokeWidth:2,"pointer-events":"none",d:t.properties.isFolded?"M ".concat(e+3,",").concat(o+6," ").concat(e+11,",").concat(o+6," M").concat(e+7,",").concat(o+2," ").concat(e+7,",").concat(o+10):"M ".concat(e+3,",").concat(o+6," ").concat(e+11,",").concat(o+6," ")});return n("g",{},[n("rect",{height:12,width:14,rx:2,ry:2,strokeWidth:1,fill:"#F4F5F6",stroke:"#CECECE",cursor:"pointer",x:t.x-t.width/2+5,y:t.y-t.height/2+5,onClick:function(){t.foldGroup(!t.properties.isFolded)}}),r])},e.prototype.getResizeShape=function(){return n("g",{},[this.getAddableShape(),t.prototype.getResizeShape.call(this),this.getFoldIcon()])}}(Cs);!function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)}}();var ks=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Bs=function(){return Bs=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Bs.apply(this,arguments)};(function(t){function e(e,o){e.id||(e.id="Flow_".concat(vs.next()));var n=Bs(Bs(Bs({},{}),e.properties),{isDefaultFlow:!1});return e.properties=n,t.call(this,e,o)||this}ks(e,t),e.extendKey="SequenceFlowModel"})(Jo),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}ks(e,t),e.prototype.getStartArrow=function(){var t=this.props.model.properties.isDefaultFlow;return n("path",t?{refX:15,stroke:"#000000",strokeWidth:2,d:"M 20 5 10 -5 z"}:{d:""})},e.extendKey="SequenceFlowEdge"}(Zi);var Xs=40,zs=40,Hs=40,Gs=40,Ys=100,Fs=80,Ws=100,Us=80,Vs=100,Zs=80,Ks=100,qs=80,Js=100,$s=80,Qs=100,tl=80,el=100,ol=80,nl=100,rl=80,il=function(){};(il.ObjTree=function(){return this}).VERSION="0.23",il.ObjTree.prototype.xmlDecl='<?xml version="1.0" encoding="UTF-8" ?>\n',il.ObjTree.prototype.attr_prefix="-",il.ObjTree.prototype.parseXML=function(t){var e;if(window.DOMParser){var o=new DOMParser,n=o.parseFromString(t,"application/xml");if(!n)return;e=n.documentElement}else window.ActiveXObject&&((o=new ActiveXObject("Microsoft.XMLDOM")).async=!1,o.loadXML(t),e=o.documentElement);if(e)return this.parseDOM(e)},il.ObjTree.prototype.parseHTTP=function(t,e,o){var n,r={};for(var i in e)r[i]=e[i];if(r.method||(void 0===r.postBody&&void 0===r.postbody&&void 0===r.parameters?r.method="get":r.method="post"),o){r.asynchronous=!0;var a=this,s=o,l=r.onComplete;r.onComplete=function(t){var e;t&&t.responseXML&&t.responseXML.documentElement&&(e=a.parseDOM(t.responseXML.documentElement)),s(e,t),l&&l(t)}}else r.asynchronous=!1;if("undefined"!=typeof HTTP&&HTTP.Request)r.uri=t,(d=new HTTP.Request(r))&&(n=d.transport);else if("undefined"!=typeof Ajax&&Ajax.Request){var d;(d=new Ajax.Request(t,r))&&(n=d.transport)}return o?n:n&&n.responseXML&&n.responseXML.documentElement?this.parseDOM(n.responseXML.documentElement):void 0},il.ObjTree.prototype.parseDOM=function(t){if(t){if(this.__force_array={},this.force_array)for(var e=0;e<this.force_array.length;e++)this.__force_array[this.force_array[e]]=1;var o=this.parseElement(t);if(this.__force_array[t.nodeName]&&(o=[o]),11!==t.nodeType){var n={};n[t.nodeName]=o,o=n}return o}},il.ObjTree.prototype.parseElement=function(t){if(7!==t.nodeType){if(3===t.nodeType||4===t.nodeType||8===t.nodeType){if(null==t.nodeValue.match(/[^\x00-\x20]/))return;return t.nodeValue}var e=null,o={};if(t.attributes&&t.attributes.length){e={};for(var n=0;n<t.attributes.length;n++){if("string"==typeof(s=t.attributes[n].nodeName)){var r=t.attributes[n].nodeValue;try{r=JSON.parse(t.attributes[n].nodeValue.replace(/'/g,'"'))}catch(l){r=t.attributes[n].nodeValue}null!=r&&(void 0===o[s=this.attr_prefix+s]&&(o[s]=0),o[s]++,this.addNode(e,s,o[s],r))}}}if(t.childNodes&&t.childNodes.length){var i=!0;e&&(i=!1);for(n=0;n<t.childNodes.length&&i;n++){var a=t.childNodes[n].nodeType;3!==a&&4!==a&&8!==a&&(i=!1)}if(i){e||(e="");for(n=0;n<t.childNodes.length;n++)e+=t.childNodes[n].nodeValue}else{e||(e={});for(n=0;n<t.childNodes.length;n++){var s;if("string"==typeof(s=t.childNodes[n].nodeName))(r=this.parseElement(t.childNodes[n]))&&(void 0===o[s]&&(o[s]=0),o[s]++,this.addNode(e,s,o[s],r))}}}else null===e&&(e={});return e}},il.ObjTree.prototype.addNode=function(t,e,o,n){this.__force_array[e]?(1===o&&(t[e]=[]),t[e][t[e].length]=n):1===o?t[e]=n:2===o?t[e]=[t[e],n]:t[e][t[e].length]=n},il.ObjTree.prototype.writeXML=function(t){var e=this.hash_to_xml(null,t);return this.xmlDecl+e},il.ObjTree.prototype.hash_to_xml=function(t,e){var o=[],n=[];for(var r in e)if(b(e,r)){var i=e[r];r.charAt(0)!==this.attr_prefix?void 0===i||null==i?o[o.length]="<".concat(r," />"):"object"==typeof i&&i.constructor===Array?o[o.length]=this.array_to_xml(r,i):o[o.length]="object"==typeof i?this.hash_to_xml(r,i):this.scalar_to_xml(r,i):n[n.length]=" ".concat(r.substring(1),'="').concat(this.xml_escape(i),'"')}var a=n.join(""),s=o.join("");return void 0===t||null==t||(s=o.length>0?s.match(/\n/)?"<".concat(t).concat(a,">\n").concat(s,"</").concat(t,">\n"):"<".concat(t).concat(a,">").concat(s,"</").concat(t,">\n"):"<".concat(t).concat(a," />\n")),s},il.ObjTree.prototype.array_to_xml=function(t,e){for(var o=[],n=0;n<e.length;n++){var r=e[n];void 0===r||null==r?o[o.length]="<".concat(t," />"):"object"==typeof r&&r.constructor===Array?o[o.length]=this.array_to_xml(t,r):o[o.length]="object"==typeof r?this.hash_to_xml(t,r):this.scalar_to_xml(t,r)}return o.join("")},il.ObjTree.prototype.scalar_to_xml=function(t,e){return"#text"===t?this.xml_escape(e):"<".concat(t,">").concat(this.xml_escape(e),"</").concat(t,">\n")},il.ObjTree.prototype.xml_escape=function(t){return t.replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">").replace(/"/g,'"')};function al(t){return Object.prototype.toString.call(t)}function sl(t){return"  ".repeat(t)}function ll(t){return"[object Object]"===al(t)?Object.keys(t).reduce(function(e,o){var n=o;return"-"===o.charAt(0)&&(n=o.substring(1)),e[n]=ll(t[o]),e},{}):Array.isArray(t)?t.map(function(t){return ll(t)}):t}function dl(t,e,o){var n="",r="\t\n"+sl(o);if("-json"===e)return"";if("#text"===e)return r+t;if("#cdata-section"===e)return"".concat(r,"<![CDATA[").concat(t,"]]>");if("#comment"===e)return"".concat(r,"\x3c!--").concat(t,"--\x3e");if("-"==="".concat(e).charAt(0))return" ".concat(e.substring(1),'="').concat(function(t){var e=t;try{"string"!=typeof e&&(e=JSON.parse(t))}catch(o){e=JSON.stringify(ll(t)).replace(/"/g,"'")}return e}(t),'"');if(Array.isArray(t))n+=t.map(function(t){return dl(t,e,o+1)}).join("");else if("[object Object]"===al(t)){var i=Object.keys(t),a="",s=t["-json"]?"\t\n"+sl(o+1)+t["-json"]:"";n+="".concat(0===o?"":r,"<").concat(e),i.forEach(function(e){"-"===e.charAt(0)?a+=dl(t[e],e,o+1):s+=dl(t[e],e,o+1)}),n+=a+(""!==s?">".concat(s).concat(r,"</").concat(e,">"):" />")}else n+="".concat(r,"<").concat(e,">").concat(t.toString(),"</").concat(e,">");return n}var pl,cl=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),ul=function(){return ul=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},ul.apply(this,arguments)},hl=function(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(o[n[r]]=t[n[r]])}return o},fl=function(t){var e="function"==typeof Symbol&&Symbol.iterator,o=e&&t[e],n=0;if(o)return o.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},yl=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},gl=function(t,e,o){if(o||2===arguments.length)for(var n,r=0,i=e.length;r<i;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))};!function(t){t.START="bpmn:startEvent",t.END="bpmn:endEvent",t.INTERMEDIATE_CATCH="bpmn:intermediateCatchEvent",t.INTERMEDIATE_THROW="bpmn:intermediateThrowEvent",t.BOUNDARY="bpmn:boundaryEvent",t.PARALLEL_GATEWAY="bpmn:parallelGateway",t.INCLUSIVE_GATEWAY="bpmn:inclusiveGateway",t.EXCLUSIVE_GATEWAY="bpmn:exclusiveGateway",t.USER="bpmn:userTask",t.SYSTEM="bpmn:serviceTask",t.FLOW="bpmn:sequenceFlow",t.SUBPROCESS="bpmn:subProcess"}(pl||(pl={}));var vl=["-name","-id","bpmn:incoming","bpmn:outgoing","-sourceRef","-targetRef","-children"],ml=["properties","startPoint","endPoint","pointsList"],xl=[],bl=["properties.panels","properties.nodeSize","properties.definitionId","properties.timerValue","properties.timerType","properties.definitionType","properties.parent","properties.isBoundaryEventTouchingTask"],El=function(t,e){return Object.keys(e||{}).forEach(function(o){if(t[o]){var n=e[o],r=n.in,i=n.out;r&&(t[o].in=r),i&&(t[o].out=i)}else t[o]=e[o]}),t},Ml={"bpmn:startEvent":{out:function(t){var e,o,n=t.properties;return(null===(o=null===(e=Ml[n.definitionType])||void 0===e?void 0:e.out)||void 0===o?void 0:o.call(e,t))||{}}},"bpmn:intermediateCatchEvent":{out:function(t){var e,o,n=t.properties;return(null===(o=null===(e=Ml[n.definitionType])||void 0===e?void 0:e.out)||void 0===o?void 0:o.call(e,t))||{}}},"bpmn:intermediateThrowEvent":{out:function(t){var e,o,n=t.properties;return(null===(o=null===(e=Ml[n.definitionType])||void 0===e?void 0:e.out)||void 0===o?void 0:o.call(e,t))||{}}},"bpmn:boundaryEvent":{out:function(t){var e,o,n=t.properties;return(null===(o=null===(e=Ml[n.definitionType])||void 0===e?void 0:e.out)||void 0===o?void 0:o.call(e,t))||{}}},"bpmn:sequenceFlow":{out:function(t){var e=t.properties,o=e.expressionType,n=e.condition;return n?"cdata"===o?{json:'<bpmn:conditionExpression xsi:type="bpmn2:tFormalExpression"><![CDATA[${'.concat(n,"}]]></bpmn:conditionExpression>")}:{json:'<bpmn:conditionExpression xsi:type="bpmn2:tFormalExpression">'.concat(n,"</bpmn:conditionExpression>")}:{json:""}}},"bpmn:timerEventDefinition":{out:function(t){var e=t.properties,o=e.timerType,n=e.timerValue,r=e.definitionId;return{json:'<bpmn:timerEventDefinition id="'.concat(r,'"').concat(o&&n?">".concat("<bpmn:".concat(o,' xsi:type="bpmn:tFormalExpression">').concat(n,"</bpmn:").concat(o,">"),"</bpmn:timerEventDefinition>"):"/>")}},in:function(t,e){var o,n,r,i=t,a=e["-id"],s="",l="";try{for(var d=fl(Object.keys(e)),p=d.next();!p.done;p=d.next()){var c=p.value;c.includes("bpmn:")&&(s=yl(c.split(":"),2)[1],l=null===(r=e[c])||void 0===r?void 0:r["#text"])}}catch(u){o={error:u}}finally{try{p&&!p.done&&(n=d.return)&&n.call(d)}finally{if(o)throw o.error}}return{"-definitionId":a,"-definitionType":i,"-timerType":s,"-timerValue":l}}},"bpmn:conditionExpression":{in:function(t,e){var o,n="",r="";return e["#cdata-section"]?(r="cdata",n=(null===(o=/^\$\{(.*)\}$/g.exec(e["#cdata-section"]))||void 0===o?void 0:o[1])||""):e["#text"]&&(r="normal",n=e["#text"]),{"-condition":n,"-expressionType":r}}}};function wl(t){var e,o,n={};try{for(var r=fl(Object.entries(t)),i=r.next();!i.done;i=r.next()){var a=yl(i.value,2),s=a[0],l=a[1];0===s.indexOf("-")?n[s.substring(1)]=ll(l):"string"==typeof l?n[s]=l:"[object Object]"===Object.prototype.toString.call(l)?n[s]=wl(l):Array.isArray(l)?n[s]=l.map(function(t){return wl(t)}):n[s]=l}}catch(d){e={error:d}}finally{try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(e)throw e.error}}return n}function Ol(t,e,o){var n,r=new Map,i=function(t){var e=null!=t?t:{},o=e.retainedAttrsFields,n=e.excludeFields,r=e.transformer,i=new Set(gl(gl([],yl(ml),!1),yl(o||[]),!1)),a={in:new Set(gl(gl([],yl(xl),!1),yl((null==n?void 0:n.in)||[]),!1)),out:new Set(gl(gl([],yl(bl),!1),yl((null==n?void 0:n.out)||[]),!1))};return Ml=El(Ml,r),function(t){var e=t.nodes,o=t.edges;return function t(n,r){var s,l;if(1!==(null==n?void 0:n.flag)){var d;if((d=Ml[n.type])&&d.out){var p=d.out(n),c=Object.keys(p);c.length>0&&c.forEach(function(t){n[t]=p[t]})}(null==n?void 0:n.children)&&(n.children=n.children.map(function(t){return e.find(function(e){return e.id===t})||o.find(function(e){return e.id===t})||{}}));var u={};if("string"==typeof n)return n;if(Array.isArray(n))return n.map(function(e){return t(e,"")}).filter(function(t){return null!=t});try{for(var h=fl(Object.entries(n)),f=h.next();!f.done;f=h.next()){var y=yl(f.value,2),g=y[0],v=y[1];if(1===(null==v?void 0:v.flag))return;var m=[r,g].filter(function(t){return t}).join(".");a.out.has(m)||("object"!=typeof v?0===g.indexOf("-")||["#text","#cdata-section","#comment"].includes(g)?u[g]=v:u["-".concat(g)]=v:i.has(m)?u["-".concat(g)]=t(v,m):u[g]=t(v,m))}}catch(x){s={error:x}}finally{try{f&&!f.done&&(l=h.return)&&l.call(h)}finally{if(s)throw s.error}}return u}}(t,"")}}(o)(e);i.nodes.forEach(function(e){var o=e["-id"],n=e["-type"],i=e.text,a=e.children,s=hl(e,["-id","-type","text","children"]),l={"-id":o};(null==i?void 0:i["-value"])&&(l["-name"]=i["-value"]),s["-json"]&&(l["-json"]=s["-json"]),s["-properties"]&&Object.assign(l,s["-properties"]),a&&(l.children=a),t[n]||(t[n]=[]),t[n].push(l),r.set(o,l)});var a=i.edges.map(function(t){var e=t["-id"],o=t["-sourceNodeId"],n=t["-targetNodeId"],i=t.text,a=hl(t,["-id","-sourceNodeId","-targetNodeId","text"]),s=r.get(n);s["bpmn:incoming"]||(s["bpmn:incoming"]=[]),s["bpmn:incoming"].push(e);var l={"-id":e,"-sourceRef":o,"-targetRef":n};return(null==i?void 0:i["-value"])&&(l["-name"]=i["-value"]),a["-json"]&&(l["-json"]=a["-json"]),a["-properties"]&&Object.assign(l,a["-properties"]),l});return e.edges.forEach(function(t){var e=t.sourceNodeId,o=t.id,n=r.get(e);n["bpmn:outgoing"]||(n["bpmn:outgoing"]=[]),n["bpmn:outgoing"].push(o)}),null===(n=t["bpmn:subProcess"])||void 0===n||n.forEach(function(e){var o={"bpmn:incoming":new Set,"bpmn:outgoing":new Set},n=[];e.children.forEach(function(n){var i,a=r.get(n["-id"]);["bpmn:incoming","bpmn:outgoing"].forEach(function(t){a[t]&&a[t].forEach(function(e){o[t].add(e)})});var s=null===(i=t[n["-type"]])||void 0===i?void 0:i.findIndex(function(t){return t["-id"]===n["-id"]});s>=0&&t[n["-type"]].splice(s,1),r.delete(n["-id"]),e[n["-type"]]||(e[n["-type"]]=[]),e[n["-type"]].push(a)});var i=o["bpmn:incoming"];o["bpmn:outgoing"].forEach(function(t){i.has(t)&&n.push(t)});for(var s,l=function(t){var o=a.findIndex(function(e){return e["-id"]===n[t]});o>=0?(e["bpmn:sequenceFlow"]||(e["bpmn:sequenceFlow"]=[]),e["bpmn:sequenceFlow"].push(a[o]),a.splice(o,1)):t++,s=t},d=0;d<n.length;)l(d),d=s;delete e.children}),t[pl.FLOW]=a,t}function _l(t,e){t["bpmndi:BPMNEdge"]=e.edges.map(function(t){var e,o=t.id,n=t.pointsList.map(function(t){return{"-x":t.x,"-y":t.y}}),r={"-id":"".concat(o,"_di"),"-bpmnElement":o,"di:waypoint":n};return(null===(e=t.text)||void 0===e?void 0:e.value)&&(r["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-10*t.text.value.length/2,"-y":t.text.y-7,"-width":10*t.text.value.length,"-height":14}}),r}),t["bpmndi:BPMNShape"]=e.nodes.map(function(t){var e,o=t.id,n=100,r=80,i=t.x,a=t.y,s=Nl.shapeConfigMap.get(t.type);s&&(n=s.width,r=s.height),i-=n/2,a-=r/2;var l={"-id":"".concat(o,"_di"),"-bpmnElement":o,"dc:Bounds":{"-x":i,"-y":a,"-width":n,"-height":r}};return(null===(e=t.text)||void 0===e?void 0:e.value)&&(l["bpmndi:BPMNLabel"]={"dc:Bounds":{"-x":t.text.x-10*t.text.value.length/2,"-y":t.text.y-7,"-width":10*t.text.value.length,"-height":14}}),l})}var Sl=["bpmn:incoming","bpmn:outgoing"];function Tl(t,e){var o=[],n=[],r=new Map,i=null!=e?e:{},a=i.transformer,s=i.excludeFields,l={in:new Set(gl(gl([],yl(xl),!1),yl((null==s?void 0:s.in)||[]),!1)),out:new Set(gl(gl([],yl(bl),!1),yl((null==s?void 0:s.out)||[]),!1))};Ml=El(Ml,a);var d,p,c=t["bpmn:definitions"];if(c){var u=c["bpmn:process"];d=u,p=[function(t){function e(t){t["-children"]||(t["-children"]=[]),Object.keys(t).forEach(function(e){var o;0!==e.indexOf("bpmn:")||Sl.includes(e)||(u[e]||(u[e]=[]),!Array.isArray(u[e])&&(u[e]=[u[e]]),Array.isArray(t[e])?(o=u[e]).push.apply(o,gl([],yl(t[e]),!1)):u[e].push(t[e]),Array.isArray(t[e])?t[e].forEach(function(o){!e.includes("Flow")&&t["-children"].push(o["-id"])}):!e.includes("Flow")&&t["-children"].push(t[e]["-id"]),delete t[e])})}if("bpmn:subProcess"===t){var o=u[t];Array.isArray(o)?o.forEach(function(o){"bpmn:subProcess"===t&&e(o)}):e(o)}},function(t){function e(t){var o;r.set(t["-id"],t),Array.isArray(t)?t.forEach(function(t){e(t)}):"object"==typeof t&&(o=t,Object.keys(o).forEach(function(t){var n,r;if(t.includes("bpmn:")){var i={};Ml[t]&&Ml[t].in?(i=null===(r=(n=Ml[t]).in)||void 0===r?void 0:r.call(n,t,D.cloneDeep(o[t])),delete o[t]):e(o[t]);var a=void 0;(a=Reflect.ownKeys(i)).length>0&&a.forEach(function(t){Reflect.set(o,t,i[t])})}}))}e(u[t])},function(t){if(0===t.indexOf("bpmn:")){var e=u[t];if("bpmn:sequenceFlow"===t){var i=c["bpmndi:BPMNDiagram"]["bpmndi:BPMNPlane"]["bpmndi:BPMNEdge"];n=function(t,e){var o=[];if(Array.isArray(t))t.forEach(function(t){var n;n=Array.isArray(e)?e.find(function(e){return e["-bpmnElement"]===t["-id"]}):e,o.push(Al(n,t))});else{var n=void 0;n=Array.isArray(e)?e.find(function(e){return e["-bpmnElement"]===t["-id"]}):e,o.push(Al(n,t))}return o}(e,i)}else{var a=c["bpmndi:BPMNDiagram"]["bpmndi:BPMNPlane"]["bpmndi:BPMNShape"];if("bpmn:boundaryEvent"===t){var s=u[t],l=function(t){var e=t["-attachedToRef"],o=r.get(e);o["-boundaryEvents"]||(o["-boundaryEvents"]=[]),o["-boundaryEvents"].push(t["-id"])};Array.isArray(s)?s.forEach(function(t){l(t)}):l(s)}o=o.concat(function(t,e,o){var n=[];if(Array.isArray(t))t.forEach(function(t){var r=Pl(Array.isArray(e)?e.find(function(e){return e["-bpmnElement"]===t["-id"]}):e,o,t);n.push(r)});else{var r=Pl(Array.isArray(e)?e.find(function(e){return e["-bpmnElement"]===t["-id"]}):e,o,t);n.push(r)}return n}(e,a,t))}}}],p.forEach(function(t){try{Object.keys(d).forEach(function(e){try{t(e)}catch(o){console.error(o)}})}catch(e){console.error(e)}})}var h=function(t,e,o){Object.keys(t).forEach(function(n){var r=o?"".concat(o,".").concat(n):n;e.has(r)?delete t[n]:"object"==typeof t[n]&&h(t[n],e,r)})};return o.forEach(function(t){var o,n;if(null===(o=null==e?void 0:e.mapping)||void 0===o?void 0:o.in){var r=null===(n=null==e?void 0:e.mapping)||void 0===n?void 0:n.in,i=t.type;r[i]&&(t.type=r[i])}h(t,l.in,"")}),n.forEach(function(t){var o,n;if(null===(o=null==e?void 0:e.mapping)||void 0===o?void 0:o.in){var r=null===(n=null==e?void 0:e.mapping)||void 0===n?void 0:n.in,i=t.type;r[i]&&(t.type=r[i])}h(t,l.in,"")}),{nodes:o,edges:n}}function Pl(t,e,o){var n=Number(t["dc:Bounds"]["-x"]),r=Number(t["dc:Bounds"]["-y"]),i=o["-children"],a=o["-name"],s=Nl.shapeConfigMap.get(e);s&&(n+=s.width/2,r+=s.height/2);var l,d={};if(Object.entries(o).forEach(function(t){var e=yl(t,2),o=e[0],n=e[1];vl.includes(o)||(d[o]=n)}),d=wl(d),a&&(l={x:n,y:r,value:a},t["bpmndi:BPMNLabel"]&&t["bpmndi:BPMNLabel"]["dc:Bounds"])){var p=t["bpmndi:BPMNLabel"]["dc:Bounds"];l.x=Number(p["-x"])+Number(p["-width"])/2,l.y=Number(p["-y"])+Number(p["-height"])/2}var c={id:t["-bpmnElement"],type:e,x:n,y:r,properties:d};return i&&(c.children=i),l&&(c.text=l),c}function Al(t,e){var o,n=e["-name"]?"".concat(e["-name"]):"";if(n){var r=t["bpmndi:BPMNLabel"]["dc:Bounds"],i=0;n.split("\n").forEach(function(t){i<t.length&&(i=t.length)}),o={value:n,x:Number(r["-x"])+10*i/2,y:Number(r["-y"])+7}}var a={};Object.entries(e).forEach(function(t){var e=yl(t,2),o=e[0],n=e[1];vl.includes(o)||(a[o]=n)}),a=wl(a);var s=t["di:waypoint"].map(function(t){return{x:Number(t["-x"]),y:Number(t["-y"])}}),l={id:e["-id"],type:pl.FLOW,pointsList:s,sourceNodeId:e["-sourceRef"],targetNodeId:e["-targetRef"],properties:a};return o&&(l.text=o),l}var Nl=function(){function t(t){var e=t.lf,o=this;this.adapterOut=function(t,e){var n,r,i=ul({},o.processAttributes);Ol(i,t,e);var a={"-id":"BPMNPlane_1","-bpmnElement":i["-id"]};_l(a,t);var s=o.definitionAttributes;s["bpmn:process"]=i,s["bpmndi:BPMNDiagram"]={"-id":"BPMNDiagram_1","bpmndi:BPMNPlane":a};var l={"bpmn:definitions":s};if(null===(n=null==e?void 0:e.mapping)||void 0===n?void 0:n.out){var d=null===(r=null==e?void 0:e.mapping)||void 0===r?void 0:r.out,p=function(t){Array.isArray(t)&&t.forEach(function(t){return p(t)}),"object"==typeof t&&Object.keys(t).forEach(function(e){var o;(o=d[e])?(t[o]=D.cloneDeep(t[e]),delete t[e],p(t[o])):p(t[e])})};p(l)}return l},this.adapterIn=function(t,e){if(t)return Tl(t,e)},e.adapterIn=this.adapterIn,e.adapterOut=this.adapterOut,this.processAttributes={"-isExecutable":"true","-id":"Process"},this.definitionAttributes={"-id":"Definitions","-xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","-xmlns:bpmn":"http://www.omg.org/spec/BPMN/20100524/MODEL","-xmlns:bpmndi":"http://www.omg.org/spec/BPMN/20100524/DI","-xmlns:dc":"http://www.omg.org/spec/DD/20100524/DC","-xmlns:di":"http://www.omg.org/spec/DD/20100524/DI","-targetNamespace":"http://logic-flow.org","-exporter":"logicflow","-exporterVersion":"1.2.10"}}return t.prototype.setCustomShape=function(e,o){t.shapeConfigMap.set(e,o)},t.pluginName="bpmn-adapter",t.shapeConfigMap=new Map,t}();Nl.shapeConfigMap.set(pl.START,{width:Xs,height:zs}),Nl.shapeConfigMap.set(pl.END,{width:Hs,height:Gs}),Nl.shapeConfigMap.set(pl.INTERMEDIATE_CATCH,{width:Ws,height:Us}),Nl.shapeConfigMap.set(pl.INTERMEDIATE_THROW,{width:Ws,height:Us}),Nl.shapeConfigMap.set(pl.BOUNDARY,{width:Ys,height:Fs}),Nl.shapeConfigMap.set(pl.PARALLEL_GATEWAY,{width:Vs,height:Zs}),Nl.shapeConfigMap.set(pl.INCLUSIVE_GATEWAY,{width:Ks,height:qs}),Nl.shapeConfigMap.set(pl.EXCLUSIVE_GATEWAY,{width:Js,height:$s}),Nl.shapeConfigMap.set(pl.SYSTEM,{width:Qs,height:tl}),Nl.shapeConfigMap.set(pl.USER,{width:el,height:ol}),Nl.shapeConfigMap.set(pl.SUBPROCESS,{width:nl,height:rl}),function(t){function e(e){var o=t.call(this,e)||this;o.adapterXmlIn=function(t){var e,n=(e=t,(new il.ObjTree).parseXML(e));return o.adapterIn(n,o.props)},o.adapterXmlOut=function(t){return function(t){var e="";for(var o in t)e+=dl(t[o],o,0);return e}(o.adapterOut(t,o.props))};var n=e.lf,r=e.props;return n.adapterIn=o.adapterXmlIn,n.adapterOut=o.adapterXmlOut,o.props=r,o}cl(e,t),e.pluginName="BPMNAdapter"}(Nl);var Dl=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Cl=function(){return Cl=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Cl.apply(this,arguments)},jl=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},Ll=function(t,e,o){if(o||2===arguments.length)for(var n,r=0,i=e.length;r<i;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))},Il=function(t){function e(){var e=t.apply(this,Ll([],jl(arguments),!1))||this;return e.childrenPositionMap=new Map,e.onNodeRotate=function(t){var o=t.model,n=e.props,r=n.model,i=n.graphModel,a=r.transformWithContainer,s=r.isRestrict,l=e.childrenPositionMap;if(a&&!s&&o.id===r.id){var d={x:r.x,y:r.y};u(Array.from(r.children),function(t){var e=i.getNodeModelById(t);if(e){var n={x:e.x,y:e.y};l.has(e.id)?n=l.get(e.id):l.set(e.id,n);var r=o.rotate*(180/Math.PI);r<0&&(r+=360);var a=r*(Math.PI/180),s=function(t,e,o){var n=e.x,r=e.y,i=t.x-n,a=t.y-r;return{x:i*Math.cos(o)-a*Math.sin(o)+n,y:i*Math.sin(o)+a*Math.cos(o)+r}}(n,d,a);e.moveTo(s.x,s.y),e.rotate=o.rotate}})}},e.onNodeResize=function(t){var o=t.deltaX,n=t.deltaY,r=t.index,i=t.model,a=t.preData,s=e.props,l=s.model,d=s.graphModel,p=l.transformWithContainer,c=l.isRestrict;if(p&&!c&&i.id===l.id){var h=a.properties||{},f=h.width,y=h.height;u(Array.from(l.children),function(t){var e=d.getNodeModelById(t);if(e){var i=e.width/f*o,a=e.height/y*n;go({deltaX:i,deltaY:a,index:r,nodeModel:e,graphModel:d,cancelCallback:function(){}})}})}},e.onNodeMouseMove=function(){},e.graphRendered=function(){var t=e.props.model;t.isCollapsed&&t.toggleCollapse(!0)},e}return Dl(e,t),e.prototype.componentDidMount=function(){t.prototype.componentDidMount.call(this);var e=this.props.graphModel.eventCenter;e.on("node:rotate",this.onNodeRotate),e.on("node:resize",this.onNodeResize),e.on("node:mousemove",this.onNodeMouseMove),e.on("graph:rendered",this.graphRendered)},e.prototype.componentWillUnmount=function(){t.prototype.componentWillUnmount.call(this);var e=this.props.graphModel.eventCenter;e.off("node:rotate",this.onNodeRotate),e.off("node:resize",this.onNodeResize),e.off("node:mousemove",this.onNodeMouseMove),e.off("graph:rendered",this.graphRendered)},e.prototype.getNodesInGroup=function(t,e){var o=this,n=[];return t.isGroup&&u(Array.from(t.children),function(t){n.push(t);var r=e.getNodeModelById(t);(null==r?void 0:r.isGroup)&&(n=n.concat(o.getNodesInGroup(r,e)))}),n},e.prototype.getResizeControl=function(){var e=this.props.model,o=e.resizable,n=e.isCollapsed;return o&&!n?t.prototype.getResizeControl.call(this):null},e.prototype.getAppendAreaShape=function(){var t=this.props.model,e=t.width,o=t.height,r=t.x,i=t.y,a=t.radius;if(!t.groupAddable)return null;var s=t.getNodeStyle().strokeWidth,l=void 0===s?0:s,d=t.getAddableOutlineStyle(),p=e+l+8,c=o+l+8;return n("rect",Cl(Cl({},d),{width:p,height:c,x:r-p/2,y:i-c/2,rx:a,ry:a}))},e.prototype.getCollapseIcon=function(t,e){return"M ".concat(t+3,",").concat(e+6," ").concat(t+11,",").concat(e+6," M").concat(t+7,",").concat(e+2," ").concat(t+7,",").concat(e+10)},e.prototype.getExpandIcon=function(t,e){return"M ".concat(t+3,",").concat(e+6," ").concat(t+11,",").concat(e+6," ")},e.prototype.getOperateIcon=function(){var t=this.props.model,e=t.x,o=t.y,r=e-t.width/2+10,i=o-t.height/2+10;if(!t.collapsible)return null;var a=(null==t?void 0:t.isCollapsed)?this.getCollapseIcon(r,i):this.getExpandIcon(r,i),s=n("path",{fill:"none",stroke:"#818281",strokeWidth:2,"pointer-events":"none",d:a});return n("g",{},[n("rect",{height:12,width:14,rx:2,ry:2,strokeWidth:1,fill:"#f4f5f6",stroke:"#cecece",cursor:"pointer",x:r,y:i,onClick:function(){t.toggleCollapse(!t.isCollapsed)}}),s])},e.prototype.getShape=function(){return n("g",{},[this.getAppendAreaShape(),t.prototype.getShape.call(this),this.getOperateIcon()])},e}(ai),Rl=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),kl=function(){return kl=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},kl.apply(this,arguments)},Bl=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},Xl=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},zl=function(t,e,o){if(o||2===arguments.length)for(var n,r=0,i=e.length;r<i;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))},Hl=function(t){function e(e,o){var n=t.call(this,e,o)||this;return n.isGroup=!0,n.isRestrict=!1,n.autoResize=!1,n.collapsible=!0,n.isCollapsed=!1,n.groupAddable=!1,n.transformWithContainer=!1,n.childrenLastCollapseStateDict=new Map,n.childrenLastCollapseStateDict=new Map,n.initNodeData(e),n.setAttributes(),n}return Rl(e,t),e.prototype.initNodeData=function(e){var o;t.prototype.initNodeData.call(this,e);var n=null!==(o=e.properties)&&void 0!==o?o:{},r=n.children,i=n.width,a=n.height,s=n.collapsedWidth,l=n.collapsedHeight,d=n.collapsible,p=n.isCollapsed,c=n.zIndex,u=n.isRestrict,h=n.autoResize,f=n.autoToFront,y=n.transformWithContainer;this.children=r?new Set(r):new Set,this.zIndex=null!=c?c:-1e4,this.isCollapsed=null!=p&&p,this.setProperties({isCollapsed:null!=p&&p});var g=null!=i?i:400,v=null!=a?a:230;this.width=g,this.height=v,this.expandWidth=g,this.expandHeight=v,this.collapsedWidth=null!=s?s:80,this.collapsedHeight=null!=l?l:60,this.isRestrict=null!=u&&u,this.transformWithContainer=null!=y&&y,this.autoResize=null!=h&&h,this.collapsible=null==d||d,this.autoToFront=null!=f&&f,this.text.editable=!1,this.text.draggable=!1},e.prototype.setAttributes=function(){t.prototype.setAttributes.call(this)},e.prototype.getData=function(){var e=this,o=t.prototype.getData.call(this),n=[];return u(Array.from(this.children),function(t){var o=e.graphModel.getNodeModelById(t);o&&!o.virtual&&n.push(t)}),o.children=n,o.properties&&(o.properties.children=n,o.properties.isCollapsed=this.isCollapsed),o},e.prototype.getNodesInGroup=function(t){var e=[];return t.isGroup&&u(Array.from(t.children),function(t){e.push(t)}),e},e.prototype.getMoveDistance=function(e,o,n){void 0===n&&(n=!1);var r=Xl(t.prototype.getMoveDistance.call(this,e,o,n),2),i=r[0],a=r[1],s=this.getNodesInGroup(this);return this.graphModel.moveNodes(s,e,o,n),[i,a]},e.prototype.getHistoryData=function(){var e=t.prototype.getHistoryData.call(this);e.children=Array.from(this.children),e.isGroup=!0;var o=this,n=o.x,r=o.y,i=o.collapsedWidth,a=o.collapsedHeight,s=o.expandWidth,l=o.expandHeight;return o.isCollapsed&&(e.x=n+s/2-i/2,e.y=r+l/2-a/2,e.text&&(e.text.x=e.text.x+s/2-i/2,e.text.y=e.text.y+l/2-a/2)),e},e.prototype.toggleCollapse=function(t){var e=this,o=this.graphModel,n=!!t;this.isCollapsed=n,this.setProperties({isCollapsed:n}),o.eventCenter.emit("dynamicGroup:collapse",{collapse:n,nodeModel:this}),n?this.collapse():this.expand();var r=zl(zl([],Xl(this.incoming.edges),!1),Xl(this.outgoing.edges),!1),i=Array.from(this.children);u(i,function(o){var n,i,a=e.graphModel.elementsModelMap.get(o);if(a){var s=a.isCollapsed;if(a.isGroup){var l=a;if(l.isCollapsed||l.toggleCollapse(t),!t){var d=null===(n=e.childrenLastCollapseStateDict)||void 0===n?void 0:n.get(o);void 0!==d&&d!==a.isCollapsed&&l.toggleCollapse(d)}}if(null===(i=e.childrenLastCollapseStateDict)||void 0===i||i.set(o,!!s),a.visible=!t,a.BaseType===it.NODE){var p=a.incoming.edges,c=a.outgoing.edges;r=zl(zl(zl([],Xl(r),!1),Xl(p),!1),Xl(c),!1)}}}),this.collapseEdge(n,r)},e.prototype.collapse=function(){var t=this,e=t.x,o=t.y,n=t.text,r=t.width,i=t.height,a=t.collapsedWidth,s=t.collapsedHeight;this.x=e-r/2+a/2,this.y=o-i/2+s/2,this.text.x=n.x-r/2+a/2,this.text.y=n.y-i/2+s/2,this.expandWidth=r,this.expandHeight=i,this.width=a,this.height=s},e.prototype.expand=function(){var t=this,e=t.x,o=t.y,n=t.text,r=t.expandWidth,i=t.expandHeight,a=t.collapsedWidth,s=t.collapsedHeight;this.width=r,this.height=i,this.x=e+this.width/2-a/2,this.y=o+this.height/2-s/2,this.text.x=n.x+this.width/2-a/2,this.text.y=n.y+this.height/2-s/2},e.prototype.createVirtualEdge=function(t){t.pointsList=void 0;var e=this.graphModel.addEdge(t);e.virtual=!0,e.text.editable=!1,e.isCollapsedEdge=!0},e.prototype.collapseEdge=function(t,e){var o=this,n=this.graphModel;u(e,function(e,r){var i,a=e.getData(),s=a.targetNodeId,l=a.sourceNodeId,d=kl(kl({},a),{id:"".concat(a.id,"__").concat(r),text:null===(i=a.text)||void 0===i?void 0:i.value});e.virtual&&n.deleteEdgeById(e.id);var p=n.dynamicGroup.getGroupByNodeId(s);p||(p=n.getNodeModelById(s));var c=n.dynamicGroup.getGroupByNodeId(l);c||(c=n.getNodeModelById(l)),t&&e.visible&&(o.children.has(l)||o.id===l?(d.startPoint=void 0,d.sourceNodeId=o.id):(d.endPoint=void 0,d.targetNodeId=o.id),p.id===o.id&&c.id===o.id||o.createVirtualEdge(d),e.visible=!1),t||e.visible||(p&&p.isGroup&&p.isCollapsed?(d.targetNodeId=p.id,d.endPoint=void 0,o.createVirtualEdge(d)):c&&c.isGroup&&c.isCollapsed?(d.sourceNodeId=c.id,d.startPoint=void 0,o.createVirtualEdge(d)):e.visible=!0)})},e.prototype.isAllowAppendIn=function(t){return!0},e.prototype.setAllowAppendChild=function(t){this.groupAddable=t},e.prototype.addChild=function(t){this.children.add(t);var e=this.getData();this.graphModel.eventCenter.emit("group:add-node",{data:e,childId:t})},e.prototype.removeChild=function(t){this.children.delete(t);var e=this.getData();this.graphModel.eventCenter.emit("group:remove-node",{data:e})},e.prototype.toBack=function(){this.zIndex--},e.prototype.getResizeOutlineStyle=function(){var e=t.prototype.getResizeOutlineStyle.call(this);return e.stroke="none",e},e.prototype.getAnchorStyle=function(){var e=t.prototype.getAnchorStyle.call(this);return e.stroke="transparent",e.fill="transparent",e.hover&&(e.hover.fill="transparent",e.hover.stroke="transparent"),e},e.prototype.getAddableOutlineStyle=function(){return{stroke:"#feb663",strokeWidth:2,strokeDasharray:"4 4",fill:"transparent"}},Bl([X],e.prototype,"isCollapsed",void 0),Bl([X],e.prototype,"groupAddable",void 0),Bl([X],e.prototype,"transformWithContainer",void 0),e}(_n);var Gl,Yl=function(){return Yl=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Yl.apply(this,arguments)},Fl=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},Wl=function(t,e,o){if(o||2===arguments.length)for(var n,r=0,i=e.length;r<i;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))},Ul={type:"dynamic-group",view:Il,model:Hl},Vl=-1e4,Zl=function(){function t(t){var e=t.lf,o=t.options,n=this;this.topGroupZIndex=Vl,this.nodeGroupMap=new Map,this.onSelectionDrop=function(){n.lf.graphModel.getSelectElements().nodes.forEach(function(t){n.addNodeToGroup(t)})},this.onNodeAddOrDrop=function(t){var e=t.data;n.addNodeToGroup(e)},this.addNodeToGroup=function(t){var e=n.nodeGroupMap.get(t.id);e&&((a=n.lf.getNodeModelById(e)).removeChild(t.id),n.nodeGroupMap.delete(t.id),a.setAllowAppendChild(!1));var o=n.lf.getNodeModelById(t.id),r=null==o?void 0:o.getBounds();if(o&&r){if(o.isGroup){var i=o;u(Array.from(i.children),function(e){n.nodeGroupMap.set(e,t.id)}),n.calibrateTopGroupZIndex([t]),n.onNodeSelect({data:t,isSelected:!1,isMultiple:!1})}var a;if(a=n.getGroupByBounds(r,t))a.isAllowAppendIn(t)?(a.addChild(t.id),a.setAllowAppendChild(!1)):n.lf.emit("group:not-allowed",{group:a.getData(),node:t})}},this.onGroupAddNode=function(t){var e=t.data,o=t.childId;n.nodeGroupMap.set(o,e.id)},this.removeNodeFromGroup=function(t){var e=t.data;t.model.isGroup&&e.children&&u(Array.from(e.children),function(t){n.nodeGroupMap.delete(t),n.lf.deleteNode(t)});var o=n.nodeGroupMap.get(e.id);if(o){var r=n.lf.getNodeModelById(o);r&&r.removeChild(e.id),n.nodeGroupMap.delete(e.id)}},this.onSelectionDrag=function(){n.lf.graphModel.getSelectElements().nodes.forEach(function(t){n.setActiveGroup(t)})},this.onNodeDrag=function(t){var e=t.data;n.setActiveGroup(e)},this.setActiveGroup=function(t){var e=n.lf.getNodeModelById(t.id),o=null==e?void 0:e.getBounds();if(e&&o){var r=n.getGroupByBounds(o,t);if(n.activeGroup&&n.activeGroup.setAllowAppendChild(!1),!r||e.isGroup&&r.id===t.id)return;if(!r.isAllowAppendIn(t))return;n.activeGroup=r,n.activeGroup.setAllowAppendChild(!0)}},this.onNodeSelect=function(t){var e=t.data,o=t.isMultiple,r=t.isSelected,i=n.lf.getNodeModelById(e.id);if(n.sendNodeToFront(i),n.topGroupZIndex>-1e3){var a=n.lf.graphModel.nodes;n.topGroupZIndex=Vl;var s=j(C(a,function(t){return!!t.isGroup}),"zIndex"),l=0;u(s,function(t){t.zIndex!==l&&(n.topGroupZIndex++,l=t.zIndex),t.setZIndex(n.topGroupZIndex)})}if(o&&r)if(null==i?void 0:i.isGroup){var d=i.children;u(Array.from(d),function(t){var e=n.lf.getNodeModelById(t);null==e||e.setSelected(!1)})}else{var p=n.nodeGroupMap.get(e.id);if(p){var c=n.lf.getNodeModelById(p);(null==c?void 0:c.isSelected)&&(null==i||i.setSelected(!1))}}},this.onNodeMove=function(t){var e=t.deltaX,o=t.deltaY,r=t.data,i=r.id,a=r.x,s=r.y,l=r.properties;if(l){var d=l.width,p=l.height,c=n.nodeGroupMap.get(i);if(c){var u=n.lf.getNodeModelById(c);if(u&&u.isRestrict&&u.autoResize){var h=a+e/2,f=s+o/2,y=h-d/2,g=f-p/2,v=h+d/2,m=f+p/2,x=!1,b=u.getBounds(),E=Object.assign({},b);if(y<E.minX&&(E.minX=y,x=!0),g<E.minY&&(E.minY=g,x=!0),v>E.maxX&&(E.maxX=v,x=!0),m>E.maxY&&(E.maxY=m,x=!0),x){var M=E.minX+(E.maxX-E.minX)/2,w=E.minY+(E.maxY-E.minY)/2,O=E.maxX-E.minX,_=E.maxY-E.minY;u.moveTo(M,w),u.width=O,u.height=_}}}}},this.onGraphRendered=function(t){var e=t.data;u(e.nodes,function(t){t.children&&u(t.children,function(e){n.nodeGroupMap.set(e,t.id)})}),n.calibrateTopGroupZIndex(e.nodes)},e.register(Ul),this.lf=e,a(this,o),this.init()}return t.prototype.getGroupByNodeId=function(t){var e=this.nodeGroupMap.get(t);if(e)return this.lf.getNodeModelById(e)},t.prototype.getGroupByBounds=function(t,e){var o=this.lf.graphModel.nodes,n=C(o,function(o){return!!o.isGroup&&function(t,e){var o=t.minX,n=t.minY,r=t.maxX,i=t.maxY,a=e.x,s=e.y,l=e.width,d=e.height;return o>=a-l/2&&r<=a+l/2&&n>=s-d/2&&i<=s+d/2}(t,o)&&o.id!==e.id}),r=n.length;if(r<=1)return n[0];for(var i=n[r-1],a=r-2;a>=0;a--)n[a].zIndex>i.zIndex&&(i=n[a]);return i},t.prototype.sendNodeToFront=function(t){var e=this;if(t&&t.isGroup&&(this.topGroupZIndex++,t.setZIndex(this.topGroupZIndex),t.children)){var o=t.children;u(Array.from(o),function(t){var o=e.lf.getNodeModelById(t);e.sendNodeToFront(o)})}},t.prototype.getMaxZIndex=function(t){var e=this,o=Vl;if(t.isGroup&&(o=Math.max(o,t.zIndex)),t.children){var n=t.children;u(Array.from(n),function(t){var n=e.lf.getNodeModelById(t);if(null==n?void 0:n.isGroup){var r=e.getMaxZIndex(n);o=Math.max(o,r)}})}return o},t.prototype.calibrateTopGroupZIndex=function(t){var e=this,o=Vl;if(u(t,function(t){var n=e.lf.getNodeModelById(t.id);if(n){var r=e.getMaxZIndex(n);r>o&&(o=r)}}),!(this.topGroupZIndex>=o)){var n=this.lf.graphModel.nodes,r=C(n,function(t){return!!t.isGroup}),i=this.topGroupZIndex;u(r,function(t){t.zIndex>i&&(i=t.zIndex)}),this.topGroupZIndex=i}},t.prototype.removeChildrenInGroupNodeData=function(t){var e,o=s(t);return delete o.children,(null===(e=o.properties)||void 0===e?void 0:e.children)&&delete o.properties.children,o},t.prototype.initGroupChildNodes=function(t,e,o,n){var r=this,i=[],a=[],s=[];u(Array.from(e),function(e){var l=r.lf.getNodeModelById(e);if(l){var d=l.children,p=l.getData(),c=st.NODE_GROUP_COPY||"node:group-copy-add",u=function(t,e){var o=t.x,n=t.y,r=t.text,i=r?{x:r.x+e,y:r.y+e,value:r.value}:void 0;return ua(ua({},t),{id:"",x:o+e,y:n+e,text:i})}(r.removeChildrenInGroupNodeData(p),n),h=r.lf.addNode(u,c);if(o.addChild(h.id),t[e]=h.id,i.push(h),s.push.apply(s,Wl([],Fl(Wl(Wl([],Fl(h.incoming.edges),!1),Fl(h.outgoing.edges),!1)),!1)),d instanceof Set){var f=r.initGroupChildNodes(t,d,h,n),y=f.childNodes,g=f.edgesData;i.push.apply(i,Wl([],Fl(y),!1)),a.push.apply(a,Wl([],Fl(g),!1))}}});var l=C(s,function(e){return b(t,e.sourceNodeId)&&b(t,e.targetNodeId)}),d=f(l,function(t){return t.getData()});return{childNodes:i,edgesData:a.concat(d)}},t.prototype.createEdge=function(t,e,o){var n,r,i=t.sourceNodeId,a=t.targetNodeId,l=null!==(n=e[i])&&void 0!==n?n:i,d=null!==(r=e[a])&&void 0!==r?r:a,p=s(t);return t.id&&"object"==typeof t.text&&null!==t.text&&(p=function(t,e){var o=t.startPoint,n=t.endPoint,r=t.pointsList,i=t.text,a=ha(t,["startPoint","endPoint","pointsList","text"]);a.id="";var s={x:o.x+e,y:o.y+e},l={x:n.x+e,y:n.y+e},d=f(r,function(t){return{x:t.x+e,y:t.y+e}}),p=i?ua(ua({},i),{x:i.x+e,y:i.y+e}):void 0;return ua(ua({},a),{startPoint:s,endPoint:l,pointsList:d,text:p})}(t,o)),this.lf.graphModel.addEdge(Yl(Yl({},p),{sourceNodeId:l,targetNodeId:d}))},t.prototype.checkGroupBoundsWithChildren=function(t,e,o,n,r){if(t.children)for(var i=t.children,a=t.x+e/2,s=t.y+o/2,l=a-n/2,d=s-r/2,p=a+n/2,c=s+r/2,u=Array.from(i),h=0;h<u.length;h++){var f=u[h],y=this.lf.getNodeModelById(f);if(y){var g=y.getBounds(),v=g.minX,m=g.minY,x=g.maxX,b=g.maxY;if(!(l<=v&&d<=m&&p>=x&&c>=b))return!1}}return!0},t.prototype.init=function(){var t=this,e=this.lf,o=e.graphModel;o.addNodeMoveRules(function(e,o,n){if(e.isGroup)return!0;var r=t.nodeGroupMap.get(e.id),i=t.lf.getNodeModelById(r);return!i||!i.isRestrict||(!!i.autoResize||function(t,e,o,n){var r=t.minX,i=t.minY,a=t.maxX,s=t.maxY,l=e.x,d=e.y,p=e.width,c=e.height;return{x:l+o>=r+p/2&&l+o<=a-p/2,y:d+n>=i+c/2&&d+n<=s-c/2}}(i.getBounds(),e,o,n))}),o.addNodeResizeRules(function(e,o,n,r,i){return!e.isGroup||!e.isRestrict||t.checkGroupBoundsWithChildren(e,o,n,r,i)}),o.dynamicGroup=this,e.on("node:add,node:drop,node:dnd-add",this.onNodeAddOrDrop),e.on("selection:drop",this.onSelectionDrop),e.on("node:delete",this.removeNodeFromGroup),e.on("node:drag,node:dnd-drag",this.onNodeDrag),e.on("selection:drag",this.onSelectionDrag),e.on("node:click",this.onNodeSelect),e.on("node:mousemove",this.onNodeMove),e.on("graph:rendered",this.onGraphRendered),e.on("group:add-node",this.onGroupAddNode),e.addElements=function(o,n){var r=o.nodes,i=o.edges;void 0===n&&(n=40);var a={},s={nodes:[],edges:[]},l=[];return u(r,function(o){var r,i,d=o.id,p=null!==(i=null===(r=o.properties)||void 0===r?void 0:r.children)&&void 0!==i?i:o.children,c=e.addNode(t.removeChildrenInGroupNodeData(o));if(d&&(a[d]=c.id),s.nodes.push(c),c.isGroup){var u=t.initGroupChildNodes(a,p,c,n).edgesData;l.push.apply(l,Wl([],Fl(u),!1))}}),u(l,function(e){t.createEdge(e,a,n)}),u(i,function(e){s.edges.push(t.createEdge(e,a,n))}),s},this.render()},t.prototype.render=function(){},t.prototype.destroy=function(){this.lf.off("node:add,node:drop,node:dnd-add",this.onNodeAddOrDrop),this.lf.off("selection:drop",this.onSelectionDrop),this.lf.off("node:delete",this.removeNodeFromGroup),this.lf.off("node:drag,node:dnd-drag",this.onNodeDrag),this.lf.off("selection:drag",this.onSelectionDrag),this.lf.off("node:click",this.onNodeSelect),this.lf.off("node:mousemove",this.onNodeMove),this.lf.off("graph:rendered",this.onGraphRendered),this.lf.off("group:add-node",this.onGroupAddNode)},t.pluginName="dynamicGroup",t}();!function(t){t.HORIZONTAL="horizontal",t.VERTICAL="vertical"}(Gl||(Gl={}));var Kl=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),ql=function(){return ql=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},ql.apply(this,arguments)},Jl=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},$l=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},Ql=function(t){function o(e){var o=t.call(this,e)||this;o.textRef=r(),o.setHoverOn=function(){var t=o.props.element;t.isDragging||o.state.isHovered||(o.setState({isHovered:!0}),t.setHovered(!0))},o.setHoverOff=function(){var t=o.props.element;o.state.isHovered&&(o.setState({isHovered:!1}),t.setHovered(!1))},o.handleMouseDown=function(t){var e,n=o.props,r=n.label,i=n.graphModel.editConfigModel.nodeTextDraggable;!(null!==(e=r.draggable)&&void 0!==e?e:i)||o.state.isDragging||o.state.isEditing||o.stepDrag.handleMouseDown(t)},o.handleMouseUp=function(t){o.state.isDragging&&o.stepDrag.handleMouseUp(t)},o.handleDragging=function(t){var e=t.deltaX,n=t.deltaY;o.state.isDragging||o.setState({isDragging:!0});var r=o.props,i=r.label,a=r.graphModel,s=a.transformModel,l=$l(s.fixDeltaXY(e,n),2),d=l[0],p=l[1];o.setElementModelLabelInfo({x:i.x+d,y:i.y+p}),a.eventCenter.emit("label:drag",{data:i.getData(),model:i})},o.handleDragEnd=function(){o.setState({isDragging:!1})},o.handleClick=function(t){var e=o.props,n=e.label,r=e.element,i=e.graphModel;r.setSelected(!o.state.isSelected),o.setState({isSelected:!o.state.isSelected}),o.setElementModelLabelInfo({isSelected:!0}),i.eventCenter.emit("label:click",{data:n.getData(),e:t,model:r})},o.handleDbClick=function(t){var e=o.props,n=e.label,r=e.element;if(e.graphModel.eventCenter.emit("label:dblclick",{data:n.getData(),e:t,model:r}),n.editable){if(r.setSelected(),r.setElementState(rt.TEXT_EDIT),o.setState({isEditing:!0}),o.textRef.current){o.textRef.current.contentEditable="true",o.textRef.current.focus();var i=document.createRange(),a=window.getSelection();i.selectNodeContents(o.textRef.current),i.collapse(!1),null==a||a.removeAllRanges(),null==a||a.addRange(i)}}else r.setSelected(!0)},o.handleBlur=function(t){var e=o.props,n=e.label,r=e.element;e.graphModel.eventCenter.emit("label:blur",{e:t,model:r,data:n.getData(),element:o.textRef.current}),o.setState({isDragging:!1,isHovered:!1,isSelected:!1})},o.handleInput=function(t){var e=o.props,n=e.label;e.graphModel.eventCenter.emit("label:input",{e:t,data:n.getData()})},o.reCalcLabelSize=function(){};var n=e.label,i=e.graphModel,a=i.gridSize,s=i.eventCenter;return o.stepDrag=new ut({onDragging:o.handleDragging,onDragEnd:o.handleDragEnd,step:a,eventType:"LABEL",model:n,eventCenter:s}),o.state={isEditing:!1,isHovered:!1,isDragging:!1,isSelected:!1},o}return Kl(o,t),o.prototype.setElementModelLabelInfo=function(t){var e=this.props,o=e.label,n=e.element,r=e.graphModel,i=n.properties._label,a=L(i,function(t){return t.id===o.id}),s=i[a];i[a]=ql(ql({},s),t);var l=r.getElement(n.id);null==l||l.setProperty("_label",i)},o.prototype.componentDidMount=function(){var t=this,e=this.props,o=e.label,n=e.element;e.graphModel.eventCenter.on("blank:click,node:click,edge:click,label:click",function(e){var r,i,a,s,l=e.data;if(("label"!==(null==l?void 0:l.type)||"label"===l.type&&l.id!==o.id||t.state.isSelected)&&t.setState({isSelected:!1}),("label"!==(null==l?void 0:l.type)||"label"==l.type&&l.id!==o.id)&&t.state.isEditing){t.setState({isEditing:!1});var d=null!==(i=null===(r=t.textRef.current)||void 0===r?void 0:r.innerText)&&void 0!==i?i:"",p=null!==(s=null===(a=t.textRef.current)||void 0===a?void 0:a.innerHTML)&&void 0!==s?s:"";t.setElementModelLabelInfo({value:d,content:p,isSelected:!1}),n.setElementState(rt.DEFAULT)}("label"!==(null==l?void 0:l.type)||"label"==l.type&&l.id!==o.id)&&t.textRef.current&&(t.textRef.current.contentEditable="false")})},o.prototype.componentDidUpdate=function(){},o.prototype.componentWillUnmount=function(){this.props.graphModel.eventCenter.off("blank:click,node:click,edge:click")},o.prototype.render=function(){var t,o=this.props,n=o.label,r=o.element,i=o.graphModel,a=this.state,s=a.isDragging,l=a.isHovered,d=a.isSelected,p=a.isEditing,c=i.transformModel.getTransformStyle().transform,u=n.id,h=n.x,f=n.y,y=n.zIndex,g=n.vertical,v=n.style,m=n.rotate,x=n.content,b=n.labelWidth,E=n.textOverflowMode,M=null!=b?b:"node"===r.BaseType?r.width-20:80,w={left:"".concat(h-M/2,"px"),top:"".concat(f-10,"px"),width:"".concat(M,"px"),height:"20px",zIndex:null!=y?y:1,transform:m?"".concat(c," rotate(").concat(m,"deg)"):"".concat(c," rotate(").concat(g?-.25:0,"turn)")};return e("div",{id:"element-container-".concat(u),className:F("lf-label-editor-container"),style:w,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onClick:this.handleClick,onDblClick:this.handleDbClick,onBlur:this.handleBlur,onMouseEnter:this.setHoverOn,onMouseOver:this.setHoverOn,onMouseLeave:this.setHoverOff,children:e("div",{ref:this.textRef,id:"editor-container-".concat(u),className:F("lf-label-editor",(t={"lf-label-editor-dragging":s,"lf-label-editor-editing":p,"lf-label-editor-hover":!p&&(l||d)},t["lf-label-editor-".concat(E)]=!p,t)),onInput:this.handleInput,style:ql({maxWidth:"".concat(M,"px"),boxSizing:"border-box",display:"inline-block",background:p||"edge"===r.BaseType?"#fff":"transparent"},v),dangerouslySetInnerHTML:{__html:x}})})},o=Jl([_a],o)}(o),td=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},ed=Ce,od=function(){function t(t,e,o){var n;this.type="label",this.content="",this.value="",this.style={},this.vertical=!1,this.editable=!0,this.draggable=!0,this.textOverflowMode="default",this.element=e,this.graphModel=o,this.id=null!==(n=t.id)&&void 0!==n?n:ed(),this.initLabelData(t)}return t.prototype.initLabelData=function(t){a(this,t)},t.prototype.getData=function(){return{id:this.id,x:this.x,y:this.y,type:"label",content:this.content,value:this.value,rotate:this.rotate,style:R(this.style),draggable:this.draggable,editable:this.editable,labelWidth:this.labelWidth,textOverflowMode:this.textOverflowMode,vertical:this.vertical}},td([X],t.prototype,"x",void 0),td([X],t.prototype,"y",void 0),td([X],t.prototype,"content",void 0),td([X],t.prototype,"value",void 0),td([X],t.prototype,"rotate",void 0),td([X],t.prototype,"style",void 0),td([X],t.prototype,"zIndex",void 0),td([X],t.prototype,"vertical",void 0),td([X],t.prototype,"editable",void 0),td([X],t.prototype,"draggable",void 0),td([X],t.prototype,"labelWidth",void 0),td([X],t.prototype,"textOverflowMode",void 0),t}(),nd={toolbar:{allowMultiParagraphSelection:!0,buttons:["bold","colorpicker","italic","underline","strikethrough","quote","justifyLeft","justifyCenter","justifyRight","justifyFull","superscript","subscript","orderedlist","unorderedlist","pre","removeFormat","outdent","indent","h2","h3"],standardizeSelectionStart:!1,updateOnEmptySelection:!1},placeholder:{text:"请输入内容",hideOnClick:!0},disableEditing:!0},rd=V.extensions.button.extend({name:"colorpicker",tagNames:["mark"],contentDefault:"<b>Color</b>",aria:"Color Picker",action:"colorPicker",init:function(){var t=this;K.init(),V.extensions.button.prototype.init.call(this),this.colorPicker=new Z({parent:this.button,color:"#000",onDone:function(e){t.coloredText&&t.coloredText.isAppliedToSelection()&&t.coloredText.undoToSelection(),t.coloredText=K.createClassApplier("colored",{elementTagName:"span",elementProperties:{style:{color:e.hex}},normalize:!0}),t.coloredText.toggleSelection(),t.base.checkContentChanged(),t.setInactive()}})},getButton:function(){return this.button},handleClick:function(){this.setActive(),this.colorPicker.show()},isAlreadyApplied:function(t){return"mark"===t.nodeName.toLowerCase()},isActive:function(){return this.button.classList.contains("medium-editor-button-active")},setInactive:function(){this.button.classList.remove("medium-editor-button-active")},setActive:function(){this.button.classList.add("medium-editor-button-active")}}),id=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),ad=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},sd=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},ld=function(t,e,o){if(o||2===arguments.length)for(var n,r=0,i=e.length;r<i;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))};!function(t){function o(e){var o=t.call(this,e)||this;o.labelMap=new Map;var n=e.lf,r=e.graphModel;return o.lf=n,o.graphModel=r,o.state={tick:0},o}id(o,t),o.prototype.componentDidMount=function(){var t=this,e=this.props.graphModel;this.editor=new V(".lf-label-editor",l(nd,{autoLink:!0,extensions:{colorPicker:new rd}})),e.eventCenter.on("text:update,node:mousemove,node:resize,node:rotate,node:drag,label:drop,node:drop",function(){}),e.eventCenter.on("node:properties-change,node:properties-delete",function(){t.setState({tick:t.state.tick+1})})},o.prototype.componentDidUpdate=function(){var t;this.editor&&this.editor.elements.length>0?this.editor.addElements(".lf-label-editor"):(null===(t=this.editor)||void 0===t||t.destroy(),this.editor=new V(".lf-label-editor",l(nd,{autoLink:!0,extensions:{colorPicker:new rd}})))},o.prototype.componentWillUnmount=function(){var t;null===(t=this.editor)||void 0===t||t.destroy()},o.prototype.getLabels=function(){var t=this,o=this.props,n=o.lf.extension,r=o.graphModel,i=ld(ld([],sd(r.nodes),!1),sd(r.edges),!1);if(n.label){var a=[];return u(i,function(o){var n,i,s=null!==(i=null===(n=o.getData().properties)||void 0===n?void 0:n._label)&&void 0!==i?i:[];u(s,function(n){var i=t.labelMap,s=new od(n,o,r);i.set(s.id,s),a.push(e(Ql,{label:s,element:o,graphModel:r},s.id))})}),a}return null},o.prototype.render=function(){return e("foreignObject",{id:"lf-label-overlay",class:"lf-label-overlay",children:this.getLabels()})},o.toolName="label-edit-tool",o=ad([_a],o)}(o);var dd=function(){return dd=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},dd.apply(this,arguments)},pd=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},cd=function(t,e,o){if(o||2===arguments.length)for(var n,r=0,i=e.length;r<i;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))},ud="lf:defaultNodeMenu",hd="lf:defaultEdgeMenu",fd="lf:defaultGraphMenu",yd="lf:defaultSelectionMenu",gd={nodeMenu:ud,edgeMenu:hd,graphMenu:fd,selectionMenu:yd},vd={nodeMenu:[],edgeMenu:[],graphMenu:[],selectionMenu:[]},md=function(){function t(t){var e=t.lf,o=this;this.__currentData=null,this.__isSilentMode=!1,this.lf=e,this.__menuDOM=document.createElement("ul"),this.__isSilentMode=e.graphModel.editConfigModel.isSilentMode,this.menuTypeMap=new Map,this.init(),this.lf.setMenuConfig=function(t){o.setMenuConfig(t)},this.lf.addMenuConfig=function(t){o.addMenuConfig(t)},this.lf.setMenuByType=function(t){o.setMenuByType(t)},this.lf.changeMenuItemDisableStatus=function(t,e,n){o.changeMenuItemDisableStatus(t,e,n)},this.lf.getMenuConfig=function(t){return o.getMenuConfig(t)},this.lf.resetMenuConfigByType=function(t){o.resetMenuConfigByType(t)}}return t.prototype.init=function(){var t,e,o,n=this;vd.nodeMenu=[{text:"删除",callback:function(t){n.lf.deleteNode(t.id)}},{text:"编辑文本",callback:function(t){n.lf.graphModel.editText(t.id)}},{text:"复制",callback:function(t){n.lf.cloneNode(t.id)}}],null===(t=this.menuTypeMap)||void 0===t||t.set(ud,vd.nodeMenu),vd.edgeMenu=[{text:"删除",callback:function(t){n.lf.deleteEdge(t.id)}},{text:"编辑文本",callback:function(t){n.lf.graphModel.editText(t.id)}}],null===(e=this.menuTypeMap)||void 0===e||e.set(hd,vd.edgeMenu),vd.graphMenu=[],vd.selectionMenu=[{text:"删除",callback:function(t){n.lf.clearSelectElements(),t.edges.forEach(function(t){return n.lf.deleteEdge(t.id)}),t.nodes.forEach(function(t){return n.lf.deleteNode(t.id)})}}],null===(o=this.menuTypeMap)||void 0===o||o.set(yd,vd.selectionMenu)},t.prototype.showMenu=function(t,e,o,n){if(!this.__isSilentMode&&o&&o.length){var r=this.__menuDOM;if(r){if(r.innerHTML="",r.append.apply(r,cd([],pd(this.__getMenuDom(o)),!1)),!r.children.length)return;if(r.style.display="block",!n)return r.style.top="".concat(e,"px"),void(r.style.left="".concat(t,"px"));var i=n.width,a=n.height,s=n.clientX,l=n.clientY,d=this.lf.graphModel,p=r.offsetWidth,c=!0,u=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,h=u-s,f=d.rootEl.getBoundingClientRect(),y=f.left+f.width;y<u&&(h=y-s),h<p&&(c=!1),r.style.left="".concat(c?t:t-i,"px");var g=r.offsetHeight,v=!0,m=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,x=m-l,b=f.top+f.height;b<m&&(x=b-l),x<g&&(v=!1),r.style.top="".concat(v?e:e-a,"px")}}},t.prototype.processMenuConfig=function(t,e){var o=this;if(t){["nodeMenu","edgeMenu","graphMenu","selectionMenu"].forEach(function(n){var r,i,a,s,l=t[n],d=gd[n];if(void 0!==l)if("set"===e)null===(r=o.menuTypeMap)||void 0===r||r.set(d,l||[]);else if("add"===e&&Array.isArray(l)){var p=null!==(a=null===(i=o.menuTypeMap)||void 0===i?void 0:i.get(d))&&void 0!==a?a:[];null===(s=o.menuTypeMap)||void 0===s||s.set(d,p.concat(l))}})}},t.prototype.createImageElement=function(t,e){var o=document.createElement("img");return o.src=t,o.alt=e,o.style.width="16px",o.style.height="16px",o.style.objectFit="contain",o},t.prototype.isImageFile=function(t){return[".png",".jpg",".jpeg",".gif",".svg",".webp",".ico",".bmp"].some(function(e){return t.toLowerCase().includes(e)})},t.prototype.processIcon=function(t,e,o){var n;if("string"==typeof e){var r=e;if(r.startsWith("data:image/")){var i=this.createImageElement(r,o||"icon");t.appendChild(i)}else if(this.isImageFile(r)){i=this.createImageElement(r,o||"icon");t.appendChild(i)}else if(r.includes("<")&&r.includes(">"))t.innerHTML=r;else if(r.includes(" ")||r.startsWith(".")){var a=r.replace(/^\./,"").split(" ");(n=t.classList).add.apply(n,cd([],pd(a),!1))}else t.classList.add(r)}},t.prototype.__getMenuDom=function(t){var e=this,o=[];return t&&t.length>0&&t.forEach(function(t){var n=document.createElement("li");if(t.className?n.className="lf-menu-item ".concat(t.disabled?"lf-menu-item__disabled":""," ").concat(t.className):n.className="lf-menu-item ".concat(t.disabled?"lf-menu-item__disabled":""),t.icon){var r=document.createElement("span");r.className="lf-menu-item-icon",e.processIcon(r,t.icon,t.text),n.appendChild(r)}var i=document.createElement("span");i.className="lf-menu-item-text",t.text&&(i.innerText=t.text),n.appendChild(i),t.disabled&&n.setAttribute("disabled","true"),n.onclickCallback=t.callback,o.push(n)}),o},t.prototype.updateMenuItemDOMStatus=function(t,e){if(this.__menuDOM&&"none"!==this.__menuDOM.style.display){var o=Array.from(this.__menuDOM.querySelectorAll(".lf-menu-item")).find(function(e){var o=e.querySelector(".lf-menu-item-text");return(null==o?void 0:o.textContent)===t});if(o){var n=o;e?(n.classList.add("lf-menu-item__disabled"),n.setAttribute("disabled","true")):(n.classList.remove("lf-menu-item__disabled"),n.removeAttribute("disabled"))}}},t.prototype.setupSilentModeListener=function(){var t=this;this.__editConfigChangeHandler=function(e){var o=e.data.isSilentMode;o!==t.__isSilentMode&&(t.__isSilentMode=o,t.updateMenuVisibility(!o))},this.lf.on("editConfig:changed",this.__editConfigChangeHandler)},t.prototype.updateMenuVisibility=function(t){this.__menuDOM&&(t?this.__currentData&&(this.__menuDOM.style.display="block"):(this.__menuDOM.style.display="none",this.__currentData=null))},t.prototype.refreshCurrentMenu=function(){var t,e,o,n,r,i,a,s,l,d,p;if(this.__menuDOM&&"none"!==this.__menuDOM.style.display&&this.__currentData){var c=this.__menuDOM.style,u=c.left,h=c.top,f=[];if(this.__currentData&&"object"==typeof this.__currentData)if("sourceNodeId"in this.__currentData&&"targetNodeId"in this.__currentData){if(g=this.lf.graphModel.getEdgeModelById(this.__currentData.id)){var y=null===(e=this.menuTypeMap)||void 0===e?void 0:e.get(g.type);f=g.menu&&Array.isArray(g.menu)?g.menu:y||(null!==(n=null===(o=this.menuTypeMap)||void 0===o?void 0:o.get(hd))&&void 0!==n?n:[])}}else if("id"in this.__currentData&&"type"in this.__currentData){var g;if(g=this.lf.graphModel.getNodeModelById(this.__currentData.id)){y=null===(r=this.menuTypeMap)||void 0===r?void 0:r.get(g.type);f=g.menu&&Array.isArray(g.menu)?g.menu:y||(null!==(a=null===(i=this.menuTypeMap)||void 0===i?void 0:i.get(ud))&&void 0!==a?a:[])}}else f="nodes"in this.__currentData&&"edges"in this.__currentData?null!==(l=null===(s=this.menuTypeMap)||void 0===s?void 0:s.get(yd))&&void 0!==l?l:[]:null!==(p=null===(d=this.menuTypeMap)||void 0===d?void 0:d.get(fd))&&void 0!==p?p:[];f&&f.length>0?(this.__menuDOM.innerHTML="",(t=this.__menuDOM).append.apply(t,cd([],pd(this.__getMenuDom(f)),!1)),u&&(this.__menuDOM.style.left=u),h&&(this.__menuDOM.style.top=h)):(this.__menuDOM.style.display="none",this.__currentData=null)}},t.prototype.setMenuByType=function(t){var e,o=t.type,n=t.menu;o&&n&&(null===(e=this.menuTypeMap)||void 0===e||e.set(o,n),this.refreshCurrentMenu())},t.prototype.getMenuConfig=function(t){var e,o;return null!==(o=null===(e=this.menuTypeMap)||void 0===e?void 0:e.get(gd[t]))&&void 0!==o?o:[]},t.prototype.resetMenuConfigByType=function(t){var e;this.setMenuConfig(((e={})[t]=vd[t],e))},t.prototype.resetAllMenuConfig=function(){this.setMenuConfig(vd)},t.prototype.setMenuConfig=function(t){this.processMenuConfig(t,"set"),this.refreshCurrentMenu()},t.prototype.addMenuConfig=function(t){this.processMenuConfig(t,"add"),this.refreshCurrentMenu()},t.prototype.changeMenuItem=function(t,e){if("add"===t)this.addMenuConfig(e);else{if("reset"!==t)throw new Error("The first parameter of changeMenuConfig should be 'add' or 'reset'");this.setMenuConfig(e)}},t.prototype.changeMenuItemDisableStatus=function(t,e,o){var n,r;if(t&&e){var i=null!==(r=null===(n=this.menuTypeMap)||void 0===n?void 0:n.get(gd[t]))&&void 0!==r?r:[];if(i.length){var a=i.find(function(t){return t.text===e});a?(a.disabled=o,this.updateMenuItemDOMStatus(e,o)):console.warn("menuItem: ".concat(e," is not exist"))}else console.warn("menuMap: ".concat(t," is not exist"))}else console.warn("params is vaild")},t.prototype.render=function(t,e){var o=this;t.graphModel.editConfigModel.isSilentMode||(this.__container=e,this.__currentData=null,this.setupSilentModeListener(),this.__menuDOM&&(this.__menuDOM.className="lf-menu",e.appendChild(this.__menuDOM),this.__menuDOM.addEventListener("click",function(t){t.stopPropagation();for(var e=t.target;-1===Array.from(e.classList).indexOf("lf-menu-item")&&-1===Array.from(e.classList).indexOf("lf-menu");)e=null==e?void 0:e.parentElement;Array.from(e.classList).indexOf("lf-menu-item__disabled")>-1||(Array.from(e.classList).indexOf("lf-menu-item")>-1?(e.onclickCallback(o.__currentData,e),o.__menuDOM&&(o.__menuDOM.style.display="none"),o.__currentData=null):console.warn("点击区域不在菜单项内，请检查代码！"))},!0)),this.lf.on("node:contextmenu",function(t){var e,n,r=t.data,i=t.position,a=t.e,s=i.domOverlayPosition,l=s.x,d=s.y,p=r.id,c=o.lf.graphModel.getNodeModelById(p);if(c&&!o.__isSilentMode){var u=[],h=null===(e=o.menuTypeMap)||void 0===e?void 0:e.get(c.type);u=c&&c.menu&&Array.isArray(c.menu)?c.menu:h||(null===(n=o.menuTypeMap)||void 0===n?void 0:n.get(ud)),o.__currentData=r,o.showMenu(l,d,u,{width:c.width,height:c.height,clientX:a.clientX,clientY:a.clientY})}}),this.lf.on("edge:contextmenu",function(t){var e,n,r,i=t.data,a=t.position,s=t.e,l=a.domOverlayPosition,d=l.x,p=l.y,c=i.id,u=o.lf.graphModel.getEdgeModelById(c);if(u&&!o.__isSilentMode){var h=[],f=null===(e=o.menuTypeMap)||void 0===e?void 0:e.get(u.type);h=u&&u.menu&&Array.isArray(u.menu)?u.menu:f||(null!==(r=null===(n=o.menuTypeMap)||void 0===n?void 0:n.get(hd))&&void 0!==r?r:[]),o.__currentData=i,o.showMenu(d,p,h,{width:u.width,height:u.height,clientX:s.clientX,clientY:s.clientY})}}),this.lf.on("blank:contextmenu",function(t){var e,n,r=t.position;if(!o.__isSilentMode){var i=null!==(n=null===(e=o.menuTypeMap)||void 0===e?void 0:e.get(fd))&&void 0!==n?n:[],a=r.domOverlayPosition,s=a.x,l=a.y;o.__currentData=dd({},r.canvasOverlayPosition),o.showMenu(s,l,i)}}),this.lf.on("selection:contextmenu",function(t){var e,n=t.data,r=t.position;if(!o.__isSilentMode){var i=null===(e=o.menuTypeMap)||void 0===e?void 0:e.get(yd),a=r.domOverlayPosition,s=a.x,l=a.y;o.__currentData=n,o.showMenu(s,l,i)}}),this.lf.on("node:mousedown",function(){o.__menuDOM.style.display="none"}),this.lf.on("edge:click",function(){o.__menuDOM.style.display="none"}),this.lf.on("blank:click",function(){o.__menuDOM.style.display="none"}))},t.prototype.destroy=function(){var t;this.__editConfigChangeHandler&&this.lf.off("editConfig:changed",this.__editConfigChangeHandler),this.__menuDOM&&(null===(t=null==this?void 0:this.__container)||void 0===t||t.removeChild(this.__menuDOM),this.__menuDOM=void 0)},t.pluginName="menu",t}(),xd=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),bd=function(){return bd=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},bd.apply(this,arguments)};!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}xd(e,t),e.prototype.setAttributes=function(){var t=this.properties,e=t.width,o=t.height,n=t.radius;v(e)||(this.width=e),v(o)||(this.height=o),v(n)||(this.radius=n)},e.prototype.getTextStyle=function(){var e=this.properties,o=e.refX,n=void 0===o?0:o,r=e.refY,i=void 0===r?0:r,a=e.textStyle,l=t.prototype.getTextStyle.call(this);return bd(bd(bd({},l),s(a)||{}),{transform:"matrix(1 0 0 1 ".concat(n," ").concat(i,")")})},e.prototype.getNodeStyle=function(){var e=t.prototype.getNodeStyle.call(this),o=this.properties.style;return bd(bd({},e),s(o)||{})}}(jn);var Ed={};q({});var Md=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}Md(e,t),e.prototype.getComponentContainer=function(){return this.root},e.prototype.targetId=function(){return"".concat(this.props.graphModel.flowId,":").concat(this.props.model.id)},e.prototype.componentWillUnmount=function(){t.prototype.componentWillUnmount.call(this),this.unmount()},e.prototype.setHtml=function(t){var e=document.createElement("div");e.className="custom-vue-node-content",this.root=e,t.appendChild(e),this.renderVueComponent()},e.prototype.confirmUpdate=function(t){},e.prototype.renderVueComponent=function(){var t;this.unmountVueComponent();var e=this.getComponentContainer(),o=this.props,n=o.model,r=o.graphModel;if(e){var i=Ed[n.type].component;i&&(this.vm=J({render:function(){return $(i,{node:n,graph:r})},provide:function(){return{getNode:function(){return n},getGraph:function(){return r}}}}),null===(t=this.vm)||void 0===t||t.mount(e))}},e.prototype.unmountVueComponent=function(){var t=this.getComponentContainer();return this.vm&&(this.vm.unmount(),this.vm=null),t&&(t.innerHTML=""),t},e.prototype.unmount=function(){this.unmountVueComponent()}}(Si);var wd=function(t){var e="function"==typeof Symbol&&Symbol.iterator,o=e&&t[e],n=0;if(o)return o.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Od=function(){function t(t){var e=t.lf,o=t.LogicFlow,n=t.options,r=this;this.width=200,this.height=150,this.scale=1,this.translateX=0,this.translateY=0,this.showEdge=!1,this.viewPortTop=0,this.viewPortLeft=0,this.viewPortWidth=150,this.viewPortHeight=75,this.isShow=!1,this.isShowHeader=!1,this.isShowCloseIcon=!1,this.headerTitle="导航",this.disabledPlugins=["miniMap","control","selectionSelect"],this.onGraphResize=function(){r.updateViewPortBounds(),r.isShow&&r.updateViewPort()},this.render=function(t,e){r.container=e,r.lf.on("history:change",function(){r.isShow&&r.setView()}),r.lf.on("graph:transform",function(){r.isShow&&r.setView(!1)})},this.show=function(t,e){r.isShow||(r.createMiniMap(t,e),r.setView()),r.isShow=!0},this.hide=function(){r.isShow&&(r.removeMiniMap(),r.lf.emit("miniMap:close",{})),r.isShow=!1},this.updatePosition=function(t){if("object"==typeof t)void 0===t.left&&void 0===t.right||(r.leftPosition=t.left,r.rightPosition=t.right),void 0===t.top&&void 0===t.bottom||(r.topPosition=t.top,r.bottomPosition=t.bottom);else switch(t){case"left-top":r.leftPosition=0,r.rightPosition=void 0,r.topPosition=0,r.bottomPosition=void 0;break;case"right-top":r.leftPosition=void 0,r.rightPosition=0,r.topPosition=0,r.bottomPosition=void 0;break;case"left-bottom":r.leftPosition=0,r.rightPosition=void 0,r.topPosition=void 0,r.bottomPosition=0;break;case"right-bottom":r.leftPosition=void 0,r.rightPosition=0,r.topPosition=void 0,r.bottomPosition=0}r.updateMiniMapPosition()},this.reset=function(){r.lf.resetTranslate(),r.lf.resetZoom()},this.setShowEdge=function(t){r.showEdge!==t&&(r.showEdge=t,r.setView())},this.startDrag=function(t){document.addEventListener("mousemove",r.drag),document.addEventListener("mouseup",r.drop);var e=t.x,o=t.y;r.startPosition={x:e,y:o}},this.drag=function(t){var e=t.x,o=t.y,n=(e-r.startPosition.x)/r.scale,i=(o-r.startPosition.y)/r.scale,a=r.viewPortLeft+n+r.viewPortWidth/r.scale/2,s=r.viewPortTop+i+r.viewPortHeight/r.scale/2;r.startPosition={x:e,y:o},r.lf.focusOn({coordinate:{x:a,y:s}})},this.drop=function(){document.removeEventListener("mousemove",r.drag),document.removeEventListener("mouseup",r.drop)},this.mapClick=function(t){var e=t.offsetX,o=t.offsetY,n=r.translateX+e/r.scale,i=r.translateY+o/r.scale;r.lf.focusOn({coordinate:{x:n,y:i}})},this.lf=e,this.LFCtor=o,n&&this.setOption(n),this.viewPortWidth=e.graphModel.width,this.viewPortHeight=e.graphModel.height;var i={left:0,right:this.viewPortWidth,top:0,bottom:this.viewPortHeight};this.bounds=i,this.elementAreaBounds=i,this.viewPortBounds=i,this.initMiniMap(),e.on("graph:resize",this.onGraphResize)}return t.prototype.setOption=function(t){var e=t.width,o=void 0===e?150:e,n=t.height,r=void 0===n?220:n,i=t.showEdge,a=void 0!==i&&i,s=t.isShowHeader,l=void 0!==s&&s,d=t.isShowCloseIcon,p=void 0!==d&&d,c=t.leftPosition,u=t.topPosition,h=t.rightPosition,f=void 0===h?0:h,y=t.bottomPosition,g=void 0===y?0:y,v=t.headerTitle,m=void 0===v?"导航":v;this.width=o,this.height=r,this.showEdge=a,this.isShowHeader=l,this.isShowCloseIcon=p,this.leftPosition=c,this.rightPosition=void 0!==c?void 0:f,this.topPosition=u,this.bottomPosition=void 0!==u?void 0:g,this.headerTitle=m},t.prototype.initMiniMap=function(){var t=document.createElement("div");t.className="lf-mini-map-graph",t.style.width="".concat(this.width,"px"),t.style.height="".concat(this.height,"px"),this.lfMap=new this.LFCtor({container:t,grid:!1,isSilentMode:!0,stopZoomGraph:!0,stopScrollGraph:!0,stopMoveGraph:!1,history:!1,snapline:!1,disabledPlugins:this.disabledPlugins}),this.lfMap.graphModel.flowId,this.miniMapWrap=t,this.createViewPort(),t.addEventListener("click",this.mapClick)},t.prototype.createMiniMap=function(t,e){var o,n=document.createElement("div");this.miniMapContainer=n,n.appendChild(this.miniMapWrap),n.style.position="absolute",void 0===t&&void 0===e||(this.leftPosition=t||0,this.topPosition=e||0,this.rightPosition=void 0,this.bottomPosition=void 0),this.updateMiniMapPosition(),n.className="lf-mini-map",this.isShowCloseIcon||n.classList.add("lf-mini-map-no-close-icon"),this.isShowHeader||n.classList.add("lf-mini-map-no-header"),null===(o=this.container)||void 0===o||o.appendChild(n),this.miniMapWrap.appendChild(this.viewport);var r=document.createElement("div");r.className="lf-mini-map-header",r.innerText=this.headerTitle,n.appendChild(r);var i=document.createElement("span");i.className="lf-mini-map-close",i.addEventListener("click",this.hide),n.appendChild(i)},t.prototype.updateMiniMapPosition=function(){if(this.miniMapContainer){var t=this.miniMapContainer.style;void 0!==this.rightPosition?(t.right="".concat(this.rightPosition,"px"),t.left=""):(t.left="".concat(this.leftPosition,"px"),t.right=""),void 0!==this.bottomPosition?(t.bottom="".concat(this.bottomPosition,"px"),t.top=""):(t.top="".concat(this.topPosition,"px"),t.bottom="")}},t.prototype.removeMiniMap=function(){var t;this.miniMapContainer&&(null===(t=this.container)||void 0===t||t.removeChild(this.miniMapContainer))},t.prototype.updateBounds=function(t){t&&this.updateElementAreaBounds(t),this.updateViewPortBounds(),this.bounds={left:Math.min(this.elementAreaBounds.left,this.viewPortBounds.left),right:Math.max(this.elementAreaBounds.right,this.viewPortBounds.right),top:Math.min(this.elementAreaBounds.top,this.viewPortBounds.top),bottom:Math.max(this.elementAreaBounds.bottom,this.viewPortBounds.bottom)}},t.prototype.updateElementAreaBounds=function(t){var e={left:0,right:0,top:0,bottom:0},o=t.nodes;o&&o.length>0&&o.forEach(function(t){var o,n,r=t.x,i=t.y,a=null!==(o=t.width)&&void 0!==o?o:200,s=null!==(n=t.height)&&void 0!==n?n:200,l=r-a/2,d=r+a/2,p=i-s/2,c=i+s/2;e.left=Math.min(l,e.left),e.right=Math.max(d,e.right),e.top=Math.min(p,e.top),e.bottom=Math.max(c,e.bottom)}),this.elementAreaBounds=e},t.prototype.updateViewPortBounds=function(){var t=this.lf.getTransform(),e=t.TRANSLATE_X,o=t.TRANSLATE_Y,n=t.SCALE_X,r=t.SCALE_Y,i=this.lf.graphModel,a=i.width,s=i.height;this.viewPortBounds={left:-e/n,right:(-e+a)/n,top:-o/r,bottom:(-o+s)/r}},t.prototype.resetData=function(t){var e=t.nodes,o=t.edges;return e.forEach(function(t){t.text=void 0}),this.showEdge&&o.forEach(function(t){t.text=void 0}),{nodes:e,edges:this.showEdge?o:[]}},t.prototype.setView=function(t){var e,o;if(void 0===t&&(t=!0),t){var n=this.lf.getGraphRawData(),r=this.resetData(n),i=this.lf.viewMap,a=this.lf.graphModel.modelMap,s=this.lfMap.viewMap;try{for(var l=wd(i.keys()),d=l.next();!d.done;d=l.next()){var p=d.value;s.has(p)||this.lfMap.register({type:p,view:i.get(p),model:a.get(p)})}}catch(M){e={error:M}}finally{try{d&&!d.done&&(o=l.return)&&o.call(l)}finally{if(e)throw e.error}}this.lfMap.render(r),this.updateBounds(r)}else this.updateBounds();var c=this.bounds,u=c.left,h=c.top,f=c.right-u,y=c.bottom-h,g=this.width/f,v=this.height/y,m=Math.min(g,v);this.scale=m;var x=u-(this.width/m-f)/2,b=h-(this.height/m-y)/2;if(this.lfMap.graphModel.transformModel.translate(-x+this.translateX,-b+this.translateY),this.translateX=x,this.translateY=b,this.miniMapWrap.firstChild){var E=this.miniMapWrap.firstChild.style;E.pointerEvents="none",E.transform="matrix(".concat(m,", 0, 0, ").concat(m,", 0, 0)"),E.transformOrigin="left top",E.height="".concat(this.height/m,"px"),E.width="".concat(this.width/m,"px"),this.updateViewPort()}},t.prototype.updateViewPort=function(){var t=this.viewport.style,e=this.lf.getTransform(),o=e.TRANSLATE_X,n=e.TRANSLATE_Y,r=e.SCALE_X,i=e.SCALE_Y,a=this.lf.graphModel,s=a.width,l=a.height;this.viewPortLeft=-o/r,this.viewPortTop=-n/i,this.viewPortWidth=s/r*this.scale,this.viewPortHeight=l/i*this.scale,t.width="".concat(this.viewPortWidth,"px"),t.height="".concat(this.viewPortHeight,"px"),t.left="".concat((this.viewPortLeft-this.translateX)*this.scale,"px"),t.top="".concat((this.viewPortTop-this.translateY)*this.scale,"px")},t.prototype.createViewPort=function(){var t=document.createElement("div");t.className="lf-minimap-viewport",t.addEventListener("mousedown",this.startDrag),t.addEventListener("click",function(t){t.stopPropagation()}),this.viewport=t},t.prototype.destroy=function(){this.lfMap.graphModel.flowId,this.lf.off("graph:resize",this.onGraphResize)},t.pluginName="miniMap",t}(),_d=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},Sd=function(t,e,o){if(o||2===arguments.length)for(var n,r=0,i=e.length;r<i;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))},Td=function(){function t(t){var e,o=t.lf,n=t.options,r=this;this.disabled=!0,this.isWholeNode=!0,this.isWholeEdge=!0,this.exclusiveMode=!1,this.mouseDownInfo=null,this.originalStopMoveGraph=!1,this.handleBlankMouseDown=function(t){var e=t.e;r.handleMouseDown(e)},this.draw=function(t){var e=r.lf.getPointByClient(t.clientX,t.clientY).domOverlayPosition,o=e.x,n=e.y;if(r.endPoint={x:o,y:n},r.startPoint){var i=r.startPoint,a=i.x,s=i.y,l=a,d=s,p=o-a,c=n-s;o<a&&(l=o,p=a-o),n<s&&(d=n,c=s-n),r.wrapper&&(r.wrapper.style.left="".concat(l,"px"),r.wrapper.style.top="".concat(d,"px"),r.wrapper.style.width="".concat(p,"px"),r.wrapper.style.height="".concat(c,"px"))}},this.drawOff=function(t){if(r.mouseDownInfo){var e=r.mouseDownInfo,o=e.x,n=e.y,i=e.time;if(Math.abs(t.clientX-o)<5&&Math.abs(t.clientY-n)<5&&Date.now()-i<200)return r.lf.clearSelectElements(),void r.cleanupSelectionState()}var a=s(r.startPoint),l=s(r.endPoint);if(document.removeEventListener("mousemove",r.draw),r.exclusiveMode||document.removeEventListener("mouseup",r.drawOff),r.lf.updateEditConfig({stopMoveGraph:r.originalStopMoveGraph}),a&&l){o=a.x,n=a.y;var d=l.x,p=l.y,c=[Math.min(o,d),Math.min(n,p)],u=[Math.max(o,d),Math.max(n,p)];if(r.lf.emit("selection:selected-area",{topLeft:c,bottomRight:u}),Math.abs(d-o)<10&&Math.abs(p-n)<10)return void(r.wrapper&&(r.wrapper.oncontextmenu=null,r.container&&r.wrapper.parentNode===r.container&&r.container.removeChild(r.wrapper),r.wrapper=void 0));var h=r.lf.graphModel.getAreaElement(c,u,r.isWholeEdge,r.isWholeNode,!0),f=r.lf.graphModel,y=f.dynamicGroup,g=f.group,v=[],m=r.lf.getSelectElements(),x=new Set(Sd(Sd([],_d(m.nodes.map(function(t){return t.id})),!1),_d(m.edges.map(function(t){return t.id})),!1));h.forEach(function(t){if(g){var e=g.getNodeGroup(t.id);if(h.includes(e))return}if(y){e=y.getGroupByNodeId(t.id);if(h.includes(e))return}r.exclusiveMode&&x.has(t.id)?r.lf.deselectElementById(t.id):(r.lf.selectElementById(t.id,!0),v.push(t))}),r.startPoint=void 0,r.endPoint=void 0,v.length>0&&r.lf.emit("selection:drop",{e:t}),r.lf.emit("selection:selected",{elements:v,leftTopPoint:c,rightBottomPoint:u})}r.wrapper&&(r.wrapper.oncontextmenu=null,r.container&&r.wrapper.parentNode===r.container&&r.container.removeChild(r.wrapper),r.wrapper=void 0)},this.lf=o,this.exclusiveMode=null!==(e=null==n?void 0:n.exclusiveMode)&&void 0!==e&&e,o.openSelectionSelect=function(){r.openSelectionSelect()},o.closeSelectionSelect=function(){r.closeSelectionSelect()},o.setSelectionSelectMode=function(t){r.setExclusiveMode(t)},this.handleMouseDown=this.handleMouseDown.bind(this),this.draw=this.draw.bind(this),this.drawOff=this.drawOff.bind(this)}return t.prototype.render=function(t,e){this.container=e},t.prototype.cleanupSelectionState=function(){this.wrapper&&(this.wrapper.oncontextmenu=null,this.container&&this.wrapper.parentNode===this.container&&this.container.removeChild(this.wrapper),this.wrapper=void 0),this.startPoint=void 0,this.endPoint=void 0,this.mouseDownInfo=null,document.removeEventListener("mousemove",this.draw),document.removeEventListener("mouseup",this.drawOff)},t.prototype.setExclusiveMode=function(t){void 0===t&&(t=!1),this.exclusiveMode!==t&&(this.cleanupSelectionState(),this.exclusiveMode=t,this.container&&!this.disabled&&(this.removeEventListeners(),this.addEventListeners()))},t.prototype.addEventListeners=function(){this.container&&(this.exclusiveMode?(this.container.style.pointerEvents="auto",this.container.addEventListener("mousedown",this.handleMouseDown)):(this.container.style.pointerEvents="none",this.lf.on("blank:mousedown",this.handleBlankMouseDown)))},t.prototype.removeEventListeners=function(){this.container&&(this.container.style.pointerEvents="none",this.container.removeEventListener("mousedown",this.handleMouseDown)),this.lf.off("blank:mousedown",this.handleBlankMouseDown)},t.prototype.handleMouseDown=function(t){var e;if(this.container&&!this.disabled&&!(2===t.button)){this.cleanupSelectionState(),this.mouseDownInfo={x:t.clientX,y:t.clientY,time:Date.now()},this.originalStopMoveGraph=this.lf.getEditConfig().stopMoveGraph,this.lf.updateEditConfig({stopMoveGraph:!0});var o=this.lf.getPointByClient(t.clientX,t.clientY).domOverlayPosition,n=o.x,r=o.y;this.startPoint={x:n,y:r},this.endPoint={x:n,y:r};var i=document.createElement("div");i.className="lf-selection-select",i.oncontextmenu=function(t){t.preventDefault()},i.style.top="".concat(this.startPoint.y,"px"),i.style.left="".concat(this.startPoint.x,"px"),null===(e=this.container)||void 0===e||e.appendChild(i),this.wrapper=i,document.addEventListener("mousemove",this.draw),document.addEventListener("mouseup",this.drawOff)}},t.prototype.setSelectionSense=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!0),this.isWholeEdge=t,this.isWholeNode=e},t.prototype.openSelectionSelect=function(){this.disabled||this.closeSelectionSelect(),this.container&&(this.cleanupSelectionState(),this.addEventListeners(),this.open())},t.prototype.closeSelectionSelect=function(){if(this.container){if(this.wrapper&&this.startPoint&&this.endPoint){var t=s(this.endPoint),e=new MouseEvent("mouseup",{clientX:t.x,clientY:t.y});this.drawOff(e)}this.cleanupSelectionState(),this.removeEventListeners(),this.close()}},t.prototype.open=function(){this.disabled=!1},t.prototype.close=function(){this.disabled=!0},t.pluginName="selectionSelect",t}(),Pd=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Ad=function(){return Ad=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Ad.apply(this,arguments)},Nd=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},Dd={tr:"tl",lb:"tl",tl:"tr",rb:"tr",br:"bl",lt:"bl",bl:"br",rt:"br"};function Cd(t,e,o,n){var r,i="",a="";t[0]===e[0]?i=t[1]>e[1]?"t":"b":t[1]===e[1]&&(i=t[0]>e[0]?"l":"r"),e[0]===o[0]?a=e[1]>o[1]?"t":"b":e[1]===o[1]&&(a=e[0]>o[0]?"l":"r");var s=Math.min(Math.hypot(e[0]-t[0],e[1]-t[1])/2,Math.hypot(o[0]-e[0],o[1]-e[1])/2,n)||.2*n,l="".concat(i).concat(a),d=Dd[l]||"-",p="L ".concat(t[0]," ").concat(t[1]);if("-"===d)p+="L ".concat(e[0]," ").concat(e[1]," L ").concat(o[0]," ").concat(o[1]);else{var c=Nd(function(t,e,o,n){var r=[t[0],t[1]],i=[t[0],t[1]];switch(o){case"tl":return"tr"===e?(r[1]+=n,i[0]+=n):"lb"===e&&(r[0]+=n,i[1]+=n),[r,i];case"tr":return"tl"===e?(r[1]+=n,i[0]-=n):"rb"===e&&(r[0]-=n,i[1]+=n),[r,i];case"bl":return"br"===e?(r[1]-=n,i[0]+=n):"lt"===e&&(r[0]+=n,i[1]-=n),[r,i];case"br":return"bl"===e?(r[1]-=n,i[0]-=n):"rt"===e&&(r[0]-=n,i[1]-=n),[r,i];default:return[]}}(e,l,d,s),2),u=c[0],h=c[1];u&&h&&(p+="L ".concat(u[0]," ").concat(u[1]," Q ").concat(e[0]," ").concat(e[1]," ").concat(h[0]," ").concat(h[1]),r=Nd(h,2),e[0]=r[0],e[1]=r[1])}return p}!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}Pd(e,t),e.prototype.getEdge=function(){var t=this.props.model,e=t.points,o=t.isAnimation,r=t.arrowConfig,i=t.radius,a=void 0===i?5:i,s=t.getEdgeStyle(),l=t.getEdgeAnimationStyle(),d=function(t){for(var e=t,o=1;o<e.length-1;){var n=Nd(e[o-1],2),r=n[0],i=n[1],a=Nd(e[o],2),s=a[0],l=a[1],d=Nd(e[o+1],2),p=d[0],c=d[1];r===s&&s===p||i===l&&l===c?e.splice(o,1):o++}return e}(e.split(" ").map(function(t){return t.split(",").map(function(t){return+t})})),p=function(t,e){var o=0,n="";if(2===t.length)n+="M".concat(t[o][0]," ").concat(t[o++][1]," L ").concat(t[o][0]," ").concat(t[o][1]);else{for(n+="M".concat(t[o][0]," ").concat(t[o++][1]);o+1<t.length;)n+=Cd(t[o-1],t[o],t[1+o++],e);n+="L ".concat(t[o][0]," ").concat(t[o][1])}return n}(d,a),c=Ad(Ad(Ad({style:o?l:{}},s),r),{fill:"none"});return n("path",Ad({d:p},c))}}(Zi),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}Pd(e,t)}(Jo);var jd=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Ld=function(){return Ld=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Ld.apply(this,arguments)},Id=function(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},Rd=function(t,e,o){if(o||2===arguments.length)for(var n,r=0,i=e.length;r<i;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))},kd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return jd(e,t),e.prototype.getLabelShape=function(){var t=this.props.model,e=t.id,o=t.x,r=t.y,i=t.width,a=t.height,s=t.properties,l=this.props.model.getNodeStyle();return n("svg",{x:o-i/2,y:r-a/2,width:50,height:24,style:"z-index: 0; background: none; overflow: auto;"},[s.labelText?n("text",{x:0,y:-5,fontSize:"16px",fill:l.stroke},s.labelText):"",s.disabledDelete?"":n("text",{x:s.labelText?50:0,y:-5,fontSize:"24px",cursor:"pointer",fill:l.stroke,onclick:this.handleCustomDeleteIconClick.bind(this,e)},"x")])},e.prototype.getShape=function(){var t=this.props.model,e=t.x,o=t.y,r=t.width,i=t.height,a=t.id,s=this.props.model.getNodeStyle();return n("g",{},[n("rect",Ld(Ld({},s),{x:e-r/2,y:o-i/2,width:r,height:i,id:a})),this.getLabelShape()])},e.prototype.toFront=function(){},e.prototype.handleCustomDeleteIconClick=function(t){this.props.graphModel.deleteNode(t)},e}(ui),Bd=function(t){function e(){var e=t.apply(this,Rd([],Id(arguments),!1))||this;return e.d=10,e.isResize=!1,e}return jd(e,t),e.prototype.initNodeData=function(e){e.text={value:"",x:e.x,y:e.y,draggable:!1,editable:!1},t.prototype.initNodeData.call(this,e),this.zIndex=0,this.draggable=!0},e.prototype.setAttributes=function(){var t,e=this;this.points=[],(null===(t=this.properties)||void 0===t?void 0:t.node_selection_ids).length>1&&setTimeout(function(){var t;e.updatePointsByNodes((null===(t=e.properties)||void 0===t?void 0:t.node_selection_ids)||[])})},e.prototype.getNodeStyle=function(){var e=t.prototype.getNodeStyle.call(this);return e.stroke=this.properties.strokeColor||"#008000",e.strokeDasharray="10 5",e},e.prototype.getDefaultAnchor=function(){return[]},e.prototype.updatePoints=function(t){this.points=t},e.prototype.updateCoordinate=function(t){var e=t.x,o=t.y;this.x=e,this.y=o},e.prototype.updatePointsByNodes=function(t){var e=this,o=[],n=1/0,r=1/0,i=-1/0,a=-1/0;t.forEach(function(t){var o=e.graphModel.getNodeModelById(t);if(o){var s=o.width,l=o.height,d=o.x,p=o.y;n=Math.min(n,d-s/2-e.d),r=Math.min(r,p-l/2-e.d),i=Math.max(i,d+s/2+e.d),a=Math.max(a,p+l/2+e.d)}}),o.push([n,r],[i,r],[i,a],[n,a]),[n,r,i,a].some(function(t){return Math.abs(t)===1/0})||(this.updatePoints(o),this.updateCoordinate({x:(i+n)/2,y:(a+r)/2}))},e.prototype.resize=function(e){var o;this.isResize=!0;for(var n=e.width,r=e.height,i=n/this.width,a=r/this.height,s=(this.properties.node_selection_ids||[]).slice(),l=[],d=new Set;s.length;){var p=s.shift(),c=null===(o=this.graphModel.nodesMap[p])||void 0===o?void 0:o.model;c&&(zd(c)?d.has(c.id)||(d.add(c.id),s.push.apply(s,Rd([],Id(c.properties.node_selection_ids||[]),!1))):l.push(c))}var u=this.x-this.width/2,h=this.y-this.height/2,f=t.prototype.resize.call(this,e),y=this.x-this.width/2,g=this.y-this.height/2;return l.forEach(function(t){t.width=t.width*i,t.height=t.height*a;var e=(t.x-u)*i+y-t.x,o=(t.y-h)*a+g-t.y;t.move(e,o,!0)}),this.isResize=!1,f},e}(En),Xd="node-selection";!function(){function t(t){var e=t.lf;this.selectNodes=[],this.d=10,this.lf=e,e.register({type:Xd,view:kd,model:Bd})}Object.defineProperty(t.prototype,"selectNodesIds",{get:function(){return this.selectNodes.map(function(t){return t.id})},enumerable:!1,configurable:!0}),t.prototype.addNodeSelection=function(){this.lf.addNode({type:"node-selection",text:"",properties:{node_selection_ids:this.selectNodesIds},x:0,y:0}).updatePointsByNodes(this.selectNodesIds)},t.prototype.updateNodeSelection=function(){var t,e=this.getNodeSelection();e&&(this.lf.setProperties(e.id,{node_selection_ids:this.selectNodesIds}),null===(t=this.lf.getNodeModelById(e.id))||void 0===t||t.updatePointsByNodes(this.selectNodesIds))},t.prototype.getNodeSelection=function(){var t=this,e=this.selectNodesIds,o=this.lf.getGraphRawData(),n=e.filter(function(e){return e!==t.currentClickNode.id});return o.nodes.find(function(t){if("node-selection"===t.type){var e=d(t,"properties.node_selection_ids",[]);return n.every(function(t){return e.includes(t)})}return!1})},t.prototype.onNodeChange=function(t,e){var o=t.graphModel.nodes.filter(function(t){return!!zd(t)&&(t.properties.node_selection_ids||[]).includes(e.id)});Promise.resolve().then(function(){o.forEach(function(t){t.updatePointsByNodes(t.properties.node_selection_ids||[])})})},t.prototype.render=function(t){var e=this;this.lf=t,t.on("node:click",function(o){var n;if(o.e.shiftKey&&o.data.type!==Xd){e.currentClickNode=o.data;var r=!1;e.selectNodesIds.includes(o.data.id)&&(null===(n=e.lf.getNodeModelById(o.data.id))||void 0===n||n.setSelected(!1),r=!0);var i=t.getSelectElements(!0).nodes;e.selectNodes=i,1===e.selectNodes.length?r?e.updateNodeSelection():e.addNodeSelection():e.selectNodes.length>1&&e.updateNodeSelection()}}),t.graphModel.addNodeMoveRules(function(o,n,r){if(e.onNodeChange(t,o),zd(o)&&!o.isResize){var i=o.properties.node_selection_ids||[];return t.graphModel.moveNodes(i,n,r,!0),!0}return!0}),t.graphModel.addNodeResizeRules(function(o){return zd(o)||e.onNodeChange(t,o),!0})},t.pluginName="node-selection"}();var zd=function(t){return!(!t||t.type!==Xd)},Hd=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Gd=function(){return Gd=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Gd.apply(this,arguments)};!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}Hd(e,t),e.prototype.getLabelShape=function(){var t=this.props.model,e=t.x,o=t.y,r=t.width,i=t.height,a=t.properties;return n("text",{x:e-r/2+5,y:o-i/2+16,fontSize:12,fill:"blue"},a.moreText)},e.prototype.getShape=function(){var t=this.props.model,e=t.x,o=t.y,r=t.width,i=t.height,a=this.props.model.getNodeStyle();return n("g",{},[n("rect",Gd(Gd({},a),{fill:"#FFFFFF",x:e-r/2,y:o-i/2})),this.getLabelShape()])}}(ai);export{Hl as D,rt as E,jn as H,Oa as L,md as M,_n as R,Td as S,Si as a,ai as b,Il as c,Zl as d,Od as e};
