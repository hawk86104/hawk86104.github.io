import{i as e}from"./3d-tiles-renderer.CbgZh8zU1767066396612.js";import{z as t,K as n}from"./@tresjs.B1f7s3pS1767066396612.js";import{ar as o}from"./three.BD1hRFgo1767066396612.js";import{_ as a}from"./XRcom.vue_vue_type_script_setup_true_lang.b5WXWI-k1767066396612.js";const{Clock:r,Vector3:i,Quaternion:s,Matrix4:l}=await e("three"),c=new i(1,1,1),u=new i;let d=null;async function m(){null===d&&(d=await import("https://cdn.skypack.dev/@dimforge/rapier3d-compat@0.15.0"),await d.init());const e=new i(0,-9.81,0),t=new d.World(e),n=[],o=new WeakMap,a=new i,m=new s,h=new l;function p(e,t=0,r=0){const i=function(e){const t=e.parameters;if("BoxGeometry"===e.type){const e=void 0!==t.width?t.width/2:.5,n=void 0!==t.height?t.height/2:.5,o=void 0!==t.depth?t.depth/2:.5;return d.ColliderDesc.cuboid(e,n,o)}if("SphereGeometry"===e.type||"IcosahedronGeometry"===e.type){const e=void 0!==t.radius?t.radius:1;return d.ColliderDesc.ball(e)}return null}(e.geometry);if(null===i)return;i.setMass(t),i.setRestitution(r);const s=e.isInstancedMesh?function(e,t,n){const o=e.instanceMatrix.array,r=[];for(let i=0;i<e.count;i++){const e=a.fromArray(o,16*i+12);r.push(f(e,null,t,n))}return r}(e,t,i):f(e.position,e.quaternion,t,i);t>0&&(n.push(e),o.set(e,s))}function f(e,n,o,a){const r=o>0?d.RigidBodyDesc.dynamic():d.RigidBodyDesc.fixed();r.setTranslation(...e),null!==n&&r.setRotation(n);const i=t.createRigidBody(r);return t.createCollider(a,i),i}const w=new r;return setInterval(function(){t.timestep=w.getDelta(),t.step();for(let e=0,t=n.length;e<t;e++){const t=n[e];if(t.isInstancedMesh){const e=t.instanceMatrix.array,n=o.get(t);for(let t=0;t<n.length;t++){const o=n[t],a=o.translation();m.copy(o.rotation()),h.compose(a,m,c).toArray(e,16*t)}t.instanceMatrix.needsUpdate=!0,t.computeBoundingSphere()}else{const e=o.get(t);t.position.copy(e.translation()),t.quaternion.copy(e.rotation())}}},1e3/60),{addScene:function(e){e.traverse(e=>{if(e.isMesh){const t=e.userData.physics;t&&p(e,t.mass,t.restitution)}})},addMesh:p,setMeshPosition:function(e,t,n=0){let a=o.get(e);e.isInstancedMesh&&(a=a[n]),a.setAngvel(u),a.setLinvel(u),a.setTranslation(t)},setMeshVelocity:function(e,t,n=0){let a=o.get(e);e.isInstancedMesh&&(a=a[n]),a.setLinvel(t)}}}const{withAsyncContext:h,defineComponent:p}=await e("vue"),{unref:f,createElementVNode:w,Fragment:y,openBlock:g,createElementBlock:M}=await e("vue"),v=["geometry","material"],B=["rotation-z","geometry","material"],x=["rotation-z","geometry","material"],D=["rotation-x","geometry","material"],L=["rotation-x","geometry","material"],C=["object"],{onMounted:R}=await e("vue"),_=await e("three"),k=p({__name:"physicsBalls",props:{XRcom:{default:null}},async setup(e){let n,o;const a=e,r=new _.BoxGeometry(6,2,6),i=new _.MeshNormalMaterial({visible:!1}),s={physics:{mass:0}},l=new _.IcosahedronGeometry(.08,3),c=new _.MeshLambertMaterial,u=new _.InstancedMesh(l,c,800);u.instanceMatrix.setUsage(_.DynamicDrawUsage),u.userData.physics={mass:1,restitution:1.1};const d=new _.Matrix4,p=new _.Color;for(let t=0;t<u.count;t++){const e=4*Math.random()-2,n=4*Math.random(),o=4*Math.random()-2;d.setPosition(e,n,o),u.setMatrixAt(t,d),u.setColorAt(t,p.setHex(16777215*Math.random()))}const{scene:k}=t(),P=([n,o]=h(()=>m()),n=await n,o(),n);R(()=>{P.addScene(k.value)});let S=0;const b=new _.Vector3;function E(e){e.userData.isSelecting&&(P.setMeshPosition(u,e.position,S),b.x=2*(Math.random()-.5),b.y=2*(Math.random()-.5),b.z=Math.random()-9,b.applyQuaternion(e.quaternion),P.setMeshVelocity(u,b,S),++S===u.count&&(S=0))}return a.XRcom.onBeforeLoop(()=>{E(a.XRcom.controller0),E(a.XRcom.controller1)}),(e,t)=>(g(),M(y,null,[w("TresMesh",{name:"floor",position:[0,-1,0],geometry:f(r),material:f(i),userData:s},null,8,v),w("TresMesh",{name:"wallPX",position:[4,3,0],"rotation-z":Math.PI/2,geometry:f(r),material:f(i),userData:s},null,8,B),w("TresMesh",{name:"wallNX",position:[-4,3,0],"rotation-z":Math.PI/2,geometry:f(r),material:f(i),userData:s},null,8,x),w("TresMesh",{name:"wallPZ",position:[0,3,4],"rotation-x":Math.PI/2,geometry:f(r),material:f(i),userData:s},null,8,D),w("TresMesh",{name:"wallNZ",position:[0,3,-4],"rotation-x":Math.PI/2,geometry:f(r),material:f(i),userData:s},null,8,L),w("primitive",{object:f(u)},null,8,C)],64))}}),{defineComponent:P}=await e("vue"),{unref:S,createElementVNode:b,createVNode:E,openBlock:I,createBlock:T,createCommentVNode:A,Suspense:z,withCtx:V,Fragment:X,createElementBlock:N}=await e("vue"),G=["geometry"],{ref:j,watch:F}=await e("vue"),q=await e("three"),U=P({__name:"ballShooterSence",setup(e){const t=new o(6,6,6,10,10,10),n=function(){this?.userData&&(this.userData.isSelecting=!0)},r=function(){this?.userData&&(this.userData.isSelecting=!1)},i=function(e){let t,n;switch(e.targetRayMode){case"tracked-pointer":return t=new q.BufferGeometry,t.setAttribute("position",new q.Float32BufferAttribute([0,0,0,0,0,-1],3)),t.setAttribute("color",new q.Float32BufferAttribute([.5,.5,.5,0,0,0],3)),n=new q.LineBasicMaterial({vertexColors:!0,blending:q.AdditiveBlending}),new q.Line(t,n);case"gaze":return t=new q.RingGeometry(.02,.04,32).translate(0,0,-1),n=new q.MeshBasicMaterial({opacity:.5,transparent:!0}),new q.Mesh(t,n)}return new q.Group},s=j(null);return F(s,e=>{e&&(e.controller0.addEventListener("selectstart",n),e.controller0.addEventListener("selectend",r),e.controller0.addEventListener("connected",function(e){this.add(i(e.data))}),e.controller0.addEventListener("disconnected",function(){this.remove(this.children[0])}),e.controller1.addEventListener("selectstart",n),e.controller1.addEventListener("selectend",r),e.controller1.addEventListener("connected",function(e){this.add(i(e.data))}),e.controller1.addEventListener("disconnected",function(){this.remove(this.children[0])}))}),(e,n)=>(I(),N(X,null,[b("TresLineSegments",{position:[0,3,0],geometry:S(t)},[...n[0]||(n[0]=[b("TresLineBasicMaterial",{color:8421504},null,-1)])],8,G),E(a,{ref_key:"XRcomRef",ref:s,sessionInit:{optionalFeatures:["depth-sensing"],depthSensing:{usagePreference:["gpu-optimized"],dataFormatPreference:[]}}},null,512),(I(),T(z,null,{default:V(()=>[s.value?(I(),T(k,{key:0,XRcom:s.value},null,8,["XRcom"])):A("",!0)]),_:1}))],64))}}),{defineComponent:H}=await e("vue"),{createElementVNode:Q,unref:W,createVNode:Z,resolveComponent:K,normalizeProps:J,guardReactiveProps:O,withCtx:Y,openBlock:$,createBlock:ee}=await e("vue"),{reactive:te}=await e("vue"),ne=H({__name:"ballShooter",setup(e){const t=te({clearColor:"#444444",antialias:!0,renderMode:"demand",windowSize:!0});return(e,o)=>{const a=K("TresCanvas");return $(),ee(a,J(O(t)),{default:Y(()=>[o[0]||(o[0]=Q("TresPerspectiveCamera",{position:[0,1.6,3],fov:50,near:.1,far:100},null,-1)),Z(W(n)),o[1]||(o[1]=Q("TresHemisphereLight",{args:[12303291,8947848,3]},null,-1)),o[2]||(o[2]=Q("TresDirectionalLight",{position:[1,1,1],intensity:3},null,-1)),Z(U)]),_:1},16)}}});export{ne as default};
