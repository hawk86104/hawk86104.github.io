{"version":3,"file":"reflectorDUDV.vue_vue_type_script_setup_true_lang.Cce3m26z1767105581793.js","sources":["../../src/plugins/floor/components/reflectorDUDV.vue"],"sourcesContent":["<!--\n * @Description: \n * @Version: 1.668\n * @Autor: 地虎降天龙\n * @Date: 2023-12-25 11:41:13\n * @LastEditors: 地虎降天龙\n * @LastEditTime: 2025-10-15 11:12:54\n-->\n<template>\n    <TresGroup :scale=\"[scale, 1, scale]\" v-if=\"!isLoading\">\n        <primitive :object=\"toRaw(mirror)\" :position-y=\"-0.01\" />\n        <primitive :object=\"gridHelp\" />\n    </TresGroup>\n</template>\n\n<script lang=\"ts\" setup>\nimport * as THREE from 'three'\nimport { Mesh, PlaneGeometry, RepeatWrapping, GridHelper } from 'three'\nimport { useTexture } from '@tresjs/cientos'\nimport { Reflector, ReflectorDudvMaterial } from '../lib/alienJS/all.three.js'\nimport { qiankunWindow } from 'vite-plugin-qiankun/dist/helper'\nimport { fixSpritesForMirror } from '../common/utils.js'\n\nimport { watchEffect, watch, ref, toRaw } from 'vue'\nconst props = withDefaults(\n    defineProps<{\n        reflectivity?: number\n        showGridHelper?: boolean\n        scale?: number\n        ignoreObjects?: THREE.Object3D[]\n        size?: number[]\n        mapUrl?: string\n    }>(),\n    {\n        reflectivity: 0.8,\n        scale: 1.0,\n        showGridHelper: true,\n        ignoreObjects: () => [],\n        size: () => [10, 10],\n        mapUrl: './plugins/floor/image/waterdudv.jpg',\n    },\n)\n\nconst reflector = new Reflector()\nconst gridHelp = new GridHelper(props.size[0] - 0.5, props.size[1])\ngridHelp.visible = props.showGridHelper\n\nlet mapurl = props.mapUrl\nif (qiankunWindow.__POWERED_BY_QIANKUN__) {\n    mapurl = qiankunWindow.__INJECTED_PUBLIC_PATH_BY_QIANKUN__ + mapurl\n    // if (process.env.NODE_ENV === 'development') {\n    //     mapurl = qiankunWindow.__INJECTED_PUBLIC_PATH_BY_QIANKUN__ + mapurl\n    // } else {\n    //     mapurl = process.env.BASE_URL + mapurl\n    // }\n    console.log('qiankunWindow.__INJECTED_PUBLIC_PATH_BY_QIANKUN__', qiankunWindow.__INJECTED_PUBLIC_PATH_BY_QIANKUN__)\n    console.log('process.env.BASE_URL', process.env.BASE_URL)\n}\nlet material = null as any\nlet mirror = ref(null) as any\nconst { state: map, isLoading } = useTexture(mapurl)\nwatch(\n    () => map.value,\n    (mapv) => {\n        if (mapv) {\n            mapv.wrapS = RepeatWrapping\n            mapv.wrapT = RepeatWrapping\n            mapv.colorSpace = THREE.SRGBColorSpace\n            mapv.repeat.set(6, 3)\n            material = new ReflectorDudvMaterial({\n                map: mapv,\n                reflectivity: props.reflectivity as any,\n            })\n            material.uniforms.tReflect = { value: reflector.renderTarget.texture }\n            material.uniforms.tReflectBlur = reflector.renderTargetUniform\n            material.uniforms.uMatrix = reflector.textureMatrixUniform\n\n            mirror.value = new Mesh(new PlaneGeometry(props.size[0], props.size[1]), undefined)\n            mirror.value.material = material\n            mirror.value.rotation.x = -Math.PI / 2\n            mirror.value.add(reflector)\n\n            mirror.value.onBeforeRender = (rendererSelf: any, sceneSelf: any, cameraSelf: any) => {\n                mirror.value.visible = false\n                props.ignoreObjects.forEach((child: any) => {\n                    if (child.isMesh) {\n                        child.visible = false\n                    }\n                    if (child.value && child.value.isMesh) {\n                        child.value.visible = false\n                    }\n                })\n                fixSpritesForMirror(sceneSelf)\n                reflector.update(rendererSelf, sceneSelf, cameraSelf)\n                fixSpritesForMirror(sceneSelf, false)\n                props.ignoreObjects.forEach((child: any) => {\n                    if (child.isMesh) {\n                        child.visible = true\n                    }\n                    if (child.value && child.value.isMesh) {\n                        child.value.visible = true\n                    }\n                })\n                mirror.value.visible = true\n            }\n        }\n    }\n)\nwatchEffect(() => {\n    if (props.reflectivity && material) {\n        material.uniforms.uReflectivity.value = props.reflectivity\n    }\n})\n\nwatch(\n    () => props.showGridHelper,\n    (newVal) => {\n        gridHelp.visible = newVal\n    },\n)\n\ndefineExpose({\n    reflector,\n})\n</script>\n"],"names":["qiankunWindow","useTexture","scale"],"mappings":"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"}