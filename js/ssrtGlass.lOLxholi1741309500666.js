import{_ as t}from"./index.ou95lFHK1741309500666.js";import{_ as e,p as n,o as r,aV as o,J as i,C as a,r as c}from"./three.8tDGqmLF1741309500666.js";import{m as s,e as l,a as u,D as f,o as p}from"./@tresjs.yaBKiR-I1741309500666.js";import{_ as v}from"./whiteFloorMesh.vue_vue_type_script_setup_true_lang.unRa8xzh1741309500666.js";import{_ as d}from"./skyBoxAmesh.vue_vue_type_script_setup_true_lang.Mi4P_XKm1741309500666.js";import{P as m}from"./tweakpane.yDiyAAkA1741309500666.js";import{d as h,a3 as x,a2 as g,w as y,o as w,H as b,u as _,r as C,e as S,j as P,g as F,N as I,f as j,al as D,aj as z,ak as k,m as N,F as E}from"./@vue.NRI7TcgI1741309500666.js";import"./index.JeJ9CWTx1741309500666.js";import"./@fesjs.x4z0tZxE1741309500666.js";import"./vue-router.vxk1Hu8C1741309500666.js";import"./lodash-es.pklfUAS51741309500666.js";import"./@qlin.yHhFDldE1741309500666.js";import"./pinia.f1wUCX_f1741309500666.js";import"./@floating-ui.BPbuo5Gx1741309500666.js";import"./@juggle.7yjBMqoW1741309500666.js";import"./chalk.9FGrMJNn1741309500666.js";/* empty css                                 */import"./iconify-icon.BVOVpC8G1741309500666.js";import"./@iconify.dt4P0LGS1741309500666.js";import"./dompurify.rQUea5mq1741309500666.js";import"./postprocessing.5pHDeDVF1741309500666.js";import"./@vueuse.7Aa9Vkmy1741309500666.js";import"./utils.1_pz9HT21741309500666.js";import"./default.vue_vue_type_script_setup_true_lang.U8w_0HOg1741309500666.js";import"./three-mesh-ui.module.jQpPm9ZQ1741309500666.js";var M=T;!function(t,e){for(var n=T,r=W();;)try{if(497256===parseInt(n(268))/1+-parseInt(n(249))/2+-parseInt(n(260))/3*(-parseInt(n(279))/4)+parseInt(n(291))/5+-parseInt(n(273))/6*(parseInt(n(254))/7)+-parseInt(n(271))/8+-parseInt(n(266))/9*(-parseInt(n(247))/10))break;r.push(r.shift())}catch(o){r.push(r.shift())}}();var R=function(){var t=!0;return function(e,n){var r=t?function(){if(n){var t=n.apply(e,arguments);return n=null,t}}:function(){};return t=!1,r}}();function T(t,e){var n=W();return(T=function(t,e){return n[t-=244]})(t,e)}!function(){R(this,(function(){var t=T,e=new RegExp(t(263)),n=new RegExp(t(294),"i"),r=X(t(252));e[t(274)](r+t(289))&&n[t(274)](r+t(287))?X():r("0")}))()}();var B=function(){var t=!0;return function(e,n){var r=t?function(){if(n){var t=n[T(276)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();function W(){var t=["PerspectiveCamera","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","bind",'{}.constructor("return this")( )',"Mesh","mesh","2036080BoqKiK","gl_FragColor = texture2D(uTexture, vUv);","1955210LLfwqL","__proto__","material","init","console","226555hukiGI","\n                varying vec2 vUv;\n\n                void main() {\n                    vUv = uv;\n                    gl_Position = vec4(position.xy, 0.0, 1.0);    \n                }","error","PlaneGeometry","return (function() ","action","123OfBXbE","gger","render","function *\\( *\\)","setRenderTarget","toString","63XOlPVw","debu","518721leMoNe","\n                uniform sampler2D uTexture;\n\n                varying vec2 vUv;\n\n                void main() {\n                    ","value","1665640OmWKEe","call","120glyDVC","test","trace","apply","length","blit","2284ETWURv","ShaderMaterial","constructor","string","table","camera","  \n                }","uTexture","input","scene","chain","log","1814890GYVxcr","renderer"];return(W=function(){return t})()}B(void 0,(function(){var t,e=T;try{t=Function(e(258)+e(244)+");")()}catch(s){t=window}for(var n=t[e(253)]=t.console||{},r=[e(290),"warn","info",e(256),"exception",e(283),e(275)],o=0;o<r[e(277)];o++){var i=B.constructor.prototype.bind(B),a=r[o],c=n[a]||i;i[e(250)]=B[e(295)](B),i[e(265)]=c[e(265)][e(295)](c),n[a]=i}}))();class V{constructor(t,r){var o=T;this[o(251)]=new(e[o(280)])({uniforms:{uTexture:{type:"t",value:null}},vertexShader:o(255),fragmentShader:o(269)+(r||o(248))+o(285),depthTest:!1,depthWrite:!1}),this.mesh=new(e[o(245)])(new(e[o(257)])(2,2),this.material),this[o(284)]=new(e[o(293)])(45,window.innerWidth/window.innerHeight,1,1e3),this[o(292)]=t,this[o(288)]=new n,this.scene.add(this[o(246)])}[M(278)](t,e){var n=M;this[n(292)][n(264)](e),this[n(251)].uniforms[n(286)][n(270)]=t,this[n(292)][n(262)](this[n(288)],this.camera),this[n(292)][n(264)](null)}}function X(t){function e(t){var n=T;if(typeof t===n(282))return function(t){}.constructor("while (true) {}")[n(276)]("counter");1!==(""+t/t).length||t%20==0?function(){return!0}.constructor(n(267)+n(261))[n(272)](n(259)):function(){return!1}[n(281)](n(267)+"gger")[n(276)]("stateObject"),e(++t)}try{if(t)return e;e(0)}catch(n){}}const H=L;!function(t,e){const n=L,r=Z();for(;;)try{if(985598===parseInt(n(209))/1*(-parseInt(n(183))/2)+parseInt(n(162))/3*(parseInt(n(171))/4)+parseInt(n(196))/5+-parseInt(n(213))/6+-parseInt(n(179))/7*(parseInt(n(154))/8)+-parseInt(n(195))/9*(-parseInt(n(205))/10)+-parseInt(n(187))/11*(parseInt(n(160))/12))break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const A=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[L(185)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();!function(){A(this,(function(){const t=L,e=new RegExp("function *\\( *\\)"),n=new RegExp("\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","i"),r=q(t(176));e.test(r+t(173))&&n.test(r+t(192))?q():r("0")}))()}();const O=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[L(185)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();function Z(){const t=["renderer","add","warn","49RxQLnq","Scene","prototype","debu","2919156BVLAXd","bind","material","uniforms","console","log","return (function() ","traverse","\n                varying vec3 vCameraSpacePos;\n                varying vec3 vWorldSpaceNormal;\n\n                void main() {\n                    vCameraSpacePos = (modelViewMatrix * vec4(position, 1.0)).xyz;\n                    vWorldSpaceNormal = normal;\n\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);    \n                }","constructor",'{}.constructor("return this")( )',"exception","WebGLRenderTarget","getFrontFaceTexture","707696WqwEpu","gger","\n                uniform sampler2D uPrevDepth;\n                uniform float uCameraFarInverse;\n                uniform float uSample;\n                uniform vec2  uScreenSize;\n\n                varying vec3 vWorldSpaceNormal;\n                varying vec3 vCameraSpacePos;\n\n                void main() {\n\n                    vec2 uv = gl_FragCoord.xy / uScreenSize;\n                    float prevRegisteredDepth = texture2D(uPrevDepth, uv).w;\n                    float currentDepth        = abs(vCameraSpacePos.z) * uCameraFarInverse;\n\n                    if(currentDepth <= prevRegisteredDepth) {\n                        discard;\n                    }\n\n                    gl_FragColor = vec4(vWorldSpaceNormal, currentDepth);    \n                }","DoubleSide","resultBuffer","render","1846512EmiyBF","uSample","5067YIHmtB","clone","FrontSide","pong","call","action","autoClear","mesh","length","4500XfvIjQ","setRenderTarget","chain","blitProgram","value","init","texture","Mesh","91RjObuK","frontFaceRT","camera","compute","9332eFjDlC","string","apply","__proto__","198MPklcu","while (true) {}","toString","scene","Vector2","input","ShaderMaterial","table","5886GtYvPA","8778955hxasqh","FloatType","uCameraFarInverse","clear","counter","uPrevDepth","info","ping","far","30040pJsXcN"];return(Z=function(){return t})()}function L(t,e){const n=Z();return(L=function(t,e){return n[t-=152]})(t,e)}O(void 0,(function(){const t=L,e=function(){const t=L;let e;try{e=Function(t(219)+t(223)+");")()}catch(n){e=window}return e}(),n=e[t(217)]=e.console||{},r=[t(218),t(208),t(202),"error",t(224),t(194),"trace"];for(let o=0;o<r[t(170)];o++){const e=O[t(222)][t(211)][t(214)](O),i=r[o],a=n[i]||e;e[t(186)]=O[t(214)](O),e[t(189)]=a[t(189)].bind(a),n[i]=e}}))();class U{constructor(t,n,o){const i=L;this[i(169)]=t[i(163)](),this[i(181)]=n,this[i(206)]=o,this[i(190)]=new(e[i(210)]),this.scene[i(207)](this[i(169)]),this.blitProgram=new V(this[i(206)]),this[i(203)]=new(e[i(152)])(innerWidth,innerHeight,{type:e[i(197)],depthBuffer:!1,stencilBuffer:!1}),this[i(165)]=new(e[i(152)])(innerWidth,innerHeight,{type:r,depthBuffer:!1,stencilBuffer:!1}),this[i(180)]=new(e[i(152)])(innerWidth,innerHeight,{type:r}),this.frontFaceMaterial=new(e[i(193)])({uniforms:{uCameraFarInverse:{value:1/this[i(181)].far}},vertexShader:i(221),fragmentShader:"\n                uniform float uCameraFarInverse;\n\n                varying vec3 vWorldSpaceNormal;\n                varying vec3 vCameraSpacePos;\n\n                void main() {\n                    float currentDepth = abs(vCameraSpacePos.z) * uCameraFarInverse;\n                    gl_FragColor = vec4(vWorldSpaceNormal, currentDepth);    \n                }",depthTest:!0,depthWrite:!0,side:e[i(164)]}),this[i(215)]=new(e[i(193)])({uniforms:{uScreenSize:{value:new(e[i(191)])(innerWidth,innerHeight)},uPrevDepth:{type:"t",value:this[i(203)].texture},uCameraFarInverse:{value:1/this[i(181)][i(204)]},uSample:{value:0}},vertexShader:"\n                varying vec3 vCameraSpacePos;\n                varying vec3 vWorldSpaceNormal;\n\n                void main() {\n                    vCameraSpacePos = (modelViewMatrix * vec4(position, 1.0)).xyz;\n                    vWorldSpaceNormal = normalize((modelMatrix * vec4(normal, 0.0)).xyz);\n\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);    \n                }",fragmentShader:i(156),depthTest:!1,depthWrite:!1,side:e[i(157)]}),this[i(169)].traverse((t=>{const n=i;t instanceof e[n(178)]&&(t.material=this[n(215)])}))}[H(182)](t){const n=H;this[n(206)][n(172)](this[n(203)]),this.renderer.clear(),this[n(206)][n(172)](this.pong),this[n(206)][n(199)](),this.mesh.traverse((t=>{const r=n;t instanceof e[r(178)]&&(t.material=this[r(215)])})),this[n(215)][n(216)][n(198)][n(175)]=1/this[n(181)][n(204)];for(let e=0;e<t;e++){let t=e%2==0?this[n(203)]:this.pong,r=e%2==0?this[n(165)]:this.ping;this[n(215)][n(216)][n(201)][n(175)]=t[n(177)],this[n(215)][n(216)][n(161)][n(175)]=e,this[n(206)][n(168)]=!1,this[n(206)][n(172)](r),this[n(206)].render(this[n(190)],this[n(181)]),this.renderer[n(168)]=!0,this[n(174)].blit(r[n(177)],t)}this[n(158)]=t%2==0?this[n(203)]:this[n(165)],this[n(169)][n(220)]((t=>{const r=n;t instanceof e[r(178)]&&(t[r(215)]=this.frontFaceMaterial)})),this[n(206)][n(172)](this[n(180)]),this[n(206)][n(159)](this[n(190)],this[n(181)])}getBackFaceTexture(){const t=H;return this[t(158)][t(177)]}[H(153)](){const t=H;return this.frontFaceRT[t(177)]}}function q(t){function e(t){const n=L;if(typeof t===n(184))return function(t){}.constructor(n(188))[n(185)](n(200));1!==(""+t/t)[n(170)]||t%20==0?function(){return!0}[n(222)](n(212)+n(155))[n(166)](n(167)):function(){return!1}.constructor(n(212)+n(155))[n(185)]("stateObject"),e(++t)}try{if(t)return e;e(0)}catch(n){}}const G=J;!function(t,e){const n=J,r=et();for(;;)try{if(607762===-parseInt(n(288))/1+parseInt(n(227))/2*(parseInt(n(206))/3)+parseInt(n(273))/4*(-parseInt(n(287))/5)+-parseInt(n(282))/6*(-parseInt(n(248))/7)+parseInt(n(234))/8*(parseInt(n(281))/9)+parseInt(n(237))/10+-parseInt(n(265))/11*(parseInt(n(285))/12))break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const Y=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n.apply(e,arguments);return n=null,t}}:function(){};return t=!1,r}}();!function(){Y(this,(function(){const t=J,e=new RegExp(t(246)),n=new RegExp(t(280),"i"),r=tt(t(269));e.test(r+t(262))&&n[t(275)](r+"input")?tt():r("0")}))()}();const K=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[J(252)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();K(void 0,(function(){const t=J,e=function(){let t;try{t=Function('return (function() {}.constructor("return this")( ));')()}catch(e){t=window}return t}(),n=e.console=e.console||{},r=[t(264),t(238),t(254),t(261),t(230),t(260),t(214)];for(let o=0;o<r[t(267)];o++){const e=K.constructor[t(223)][t(255)](K),i=r[o],a=n[i]||e;e.__proto__=K[t(255)](K),e[t(216)]=a.toString[t(255)](a),n[i]=e}}))();const $=[G(251)];function J(t,e){const n=et();return(J=function(t,e){return n[t-=206]})(t,e)}const Q=h({__name:G(286),props:{skyBoxTexture:{},modelPath:{},modelName:{},extintionFactor:{default:5},reflectionFactor:{default:1},exposure:{default:0},extintionColor1:{default:G(289)},extintionColor2:{default:"rgb(26, 166, 192)"},extintionCol1Random:{type:Boolean,default:!1},extintionCol2Random:{type:Boolean,default:!1}},async setup(t){const n=G;let r,p;const v=t,{map:d}=([r,p]=x((()=>u({map:v[n(229)]}))),r=await r,p(),r);d[n(258)]=o,d[n(241)]=e[n(207)],d[n(244)]=e[n(231)],d[n(271)]=i;const{camera:m,renderer:h,scene:C}=s(),S=new(e[n(266)])({uniforms:{uSkybox:{type:"t",value:d},uBackFaceBuffer:{type:"t",value:null},uFrontFaceBuffer:{type:"t",value:null},uCameraFarInverse:{value:1/m[n(256)][n(284)]},uScreenSizeInv:{value:new(e[n(212)])(1/window[n(226)],1/window[n(249)])},uCameraPos:{value:new(e[n(217)])(0,0,0)},uTime:{value:0},uExtintionColor1:{value:new(e[n(225)])(n(263))[n(228)](new(e[n(225)])(v[n(277)])[n(257)]())},uExtintionColor2:{value:new(e[n(225)])(n(263))[n(228)](new a(v[n(291)])[n(257)]())},uExtintionFactor:{value:v[n(293)]},uExposure:{value:v.exposure},uReflectionFactor:{value:v.reflectionFactor},uExtinctionFX1:{value:new(e[n(219)])(v[n(233)]?1:0,v[n(292)]?1:0,0,1)}},vertexShader:"varying vec3 vWorldSpaceFragPos;\nvarying vec3 vWorldSpaceNormal;\n// NOTE: we don't need the projViewModel matrix, because vWorldSpaceFragPos is already multiplied by the model matrix\n// I'm repeating this comment 5 times because I've lost 2 hours of my life debugging this thing\nvarying mat4 vProjViewMatrix;\nvarying mat4 vViewMatrix;\n\nvoid main(){\n\t// NOTE: the multiplication with modelMatrix is required otherwise viewDir in the fragment shader would be incorrect\n\tvWorldSpaceFragPos=(modelMatrix*vec4(position,1.)).xyz;\n\tvWorldSpaceNormal=normalize((modelMatrix*vec4(normal,0.)).xyz);\n\t\n\tgl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);\n\tvProjViewMatrix=projectionMatrix*viewMatrix;\n\tvViewMatrix=viewMatrix;\n}",fragmentShader:"uniform sampler2D uSkybox;\nuniform sampler2D uBackFaceBuffer;\nuniform sampler2D uFrontFaceBuffer;\n\nuniform vec3 uExtintionColor1;\nuniform vec3 uExtintionColor2;\nuniform float uExtintionFactor;\nuniform float uExposure;\nuniform float uReflectionFactor;\nuniform vec4 uExtinctionFX1;\n\nuniform float uTime;\n\nuniform vec3 uCameraPos;\nuniform vec2 uScreenSizeInv;\nuniform float uCameraFarInverse;\n\nvarying vec3 vWorldSpaceFragPos;\nvarying vec3 vWorldSpaceNormal;\nvarying mat4 vProjViewMatrix;\nvarying mat4 vViewMatrix;\n\nconst float PI=3.14159265359;\nconst float e=2.7182818284590;\n\nconst float planeSize=3.;\nconst vec3 planeColor=pow(vec3(202./255.,205./255.,185./255.),vec3(3.));\n\nfloat mod289(float x){return x-floor(x*(1./289.))*289.;}\nvec4 mod289(vec4 x){return x-floor(x*(1./289.))*289.;}\nvec4 perm(vec4 x){return mod289(((x*34.)+1.)*x);}\n\nfloat noise(vec3 p){\n\tvec3 a=floor(p);\n\tvec3 d=p-a;\n\td=d*d*(3.-2.*d);\n\t\n\tvec4 b=a.xxyy+vec4(0.,1.,0.,1.);\n\tvec4 k1=perm(b.xyxy);\n\tvec4 k2=perm(k1.xyxy+b.zzww);\n\t\n\tvec4 c=k2+a.zzzz;\n\tvec4 k3=perm(c);\n\tvec4 k4=perm(c+1.);\n\t\n\tvec4 o1=fract(k3*(1./41.));\n\tvec4 o2=fract(k4*(1./41.));\n\t\n\tvec4 o3=o2*d.z+o1*(1.-d.z);\n\tvec2 o4=o3.yw*d.x+o3.xz*(1.-d.x);\n\t\n\treturn o4.y*d.y+o4.x*(1.-d.y);\n}\n\nvec3 acesFilm(const vec3 x){\n\tconst float a=2.51;\n\tconst float b=.03;\n\tconst float c=2.43;\n\tconst float d=.59;\n\tconst float e=.14;\n\treturn clamp((x*(a*x+b))/(x*(c*x+d)+e),0.,1.);\n}\n\n// gets the skybox color from a given view direction\nvec3 getSkyboxColor(vec3 viewDir){\n\t// skybox coordinates\n\tvec2 skyboxUV=vec2(\n\t\t(atan(viewDir.x,viewDir.z)+PI)/(PI*2.),\n\t\t(asin(viewDir.y)+PI*.5)/(PI)\n\t);\n\t\n\tvec3 col=texture2D(uSkybox,skyboxUV).xyz;\n\tcol=pow(col,vec3(2.2));\n\treturn col;\n}\n\nbool refract2(vec3 v,vec3 n,float ni_over_nt,inout vec3 refracted){\n\tvec3 uv=normalize(v);\n\tfloat dt=dot(uv,n);\n\tfloat discriminant=1.-ni_over_nt*ni_over_nt*(1.-dt*dt);\n\tif(discriminant>0.){\n\t\trefracted=ni_over_nt*(v-n*dt)-n*sqrt(discriminant);\n\t\treturn true;\n\t}\n\t\n\treturn false;\n}\n\nvec3 binarySearchHitPoint(vec3 lastP,vec3 hitP,vec3 rayDir){\n\t\n\tfor(int i=0;i<10;i++){\n\t\tvec3 midP=(lastP+hitP)*.5;\n\t\t\n\t\t// project midP in uv space\n\t\tvec4 projCoord=vProjViewMatrix*vec4(midP,1.);\n\t\tprojCoord.xyz/=projCoord.w;\n\t\t\n\t\tvec2 midpNDC=projCoord.xy;\n\t\tvec2 midpUV=midpNDC*.5+.5;\n\t\t\n\t\t// get depth at point\n\t\tvec4 backBuffer=texture2D(uBackFaceBuffer,midpUV);\n\t\tfloat depth=backBuffer.w;\n\t\t\n\t\tfloat midpDepth=abs((vViewMatrix*vec4(midP,1.)).z)*uCameraFarInverse;\n\t\tif(midpDepth>depth){\n\t\t\thitP=midP;\n\t\t}else{\n\t\t\tlastP=midP;\n\t\t}\n\t}\n\t\n\treturn hitP;\n}\n\nvec3 getRefractedColor(vec3 refractionDir,vec3 hitPoint,float refractionIndex){\n\t// move the hitpoint inside the mesh with epsilon\n\thitPoint+=refractionDir*.0001;\n\t\n\t// raymarch!\n\tfloat stepSize=.02;\n\tfloat stepMult=1.5;\n\t\n\tvec3 lastP=hitPoint;\n\tvec3 p=hitPoint;\n\tvec3 hitPNormal;\n\tfloat currStepSize=stepSize;\n\tfloat transmissionDistance=0.;\n\tfor(int i=0;i<20;i++){\n\t\tp+=currStepSize*refractionDir;\n\t\t\n\t\t// project p in uv space\n\t\tvec4 projCoord=vProjViewMatrix*vec4(p,1.);\n\t\tprojCoord.xyz/=projCoord.w;\n\t\t\n\t\tvec2 pNDC=projCoord.xy;\n\t\tvec2 pUV=pNDC*.5+.5;\n\t\t\n\t\t// get depth at point\n\t\tvec4 backBuffer=texture2D(uBackFaceBuffer,pUV);\n\t\tfloat depth=backBuffer.w;\n\t\tvec3 norm=backBuffer.xyz;\n\t\t\n\t\t// get p depth\n\t\tfloat pDepth=abs((vViewMatrix*vec4(p,1.)).z)*uCameraFarInverse;\n\t\t\n\t\tif(pDepth>depth){\n\t\t\t\n\t\t\tvec3 hitp=binarySearchHitPoint(lastP,p,refractionDir);\n\t\t\tp=hitp;\n\t\t\t\n\t\t\t// ************ get the hitpoint normal\n\t\t\tvec4 projCoord=vProjViewMatrix*vec4(p,1.);\n\t\t\tprojCoord.xyz/=projCoord.w;\n\t\t\t\n\t\t\tvec2 pNDC=projCoord.xy;\n\t\t\tvec2 pUV=pNDC*.5+.5;\n\t\t\t\n\t\t\t// get depth at point\n\t\t\thitPNormal=texture2D(uBackFaceBuffer,pUV).xyz;\n\t\t\t// ************ get the hitpoint normal - END\n\t\t\t\n\t\t\tbreak;\n\t\t}\n\t\t\n\t\tlastP=p;\n\t\tcurrStepSize*=stepMult;\n\t}\n\t\n\ttransmissionDistance=length(hitPoint-p);\n\t\n\t// ******************** recalc directions\n\tvec3 outward_normal;\n\tvec3 reflected=reflect(refractionDir,hitPNormal);\n\tfloat ni_over_nt;\n\tvec3 refr;\n\t// vec3 refracted;\n\tfloat reflect_prob;\n\tfloat cosine;\n\t\n\tif(dot(refractionDir,hitPNormal)>0.){\n\t\toutward_normal=-hitPNormal;\n\t\tni_over_nt=refractionIndex;\n\t\tcosine=refractionIndex*dot(refractionDir,hitPNormal);\n\t}else{\n\t\toutward_normal=hitPNormal;\n\t\tni_over_nt=1./refractionIndex;\n\t\tcosine=-dot(refractionDir,hitPNormal);\n\t}\n\t\n\t// if (refract2(refractionDir, outward_normal, ni_over_nt, refracted)) {\n\t\tif(refract2(refractionDir,outward_normal,ni_over_nt,refr)){\n\t\t\tfloat r0=(1.-refractionIndex)/(1.+refractionIndex);\n\t\t\tr0*=r0;\n\t\t\treflect_prob=r0+(1.-r0)*pow((1.-cosine),5.);\n\t\t}else{\n\t\t\treflect_prob=1.;\n\t\t}\n\t\t// ******************** recalc directions - END\n\t\t\n\t\t// ******************** get colors\n\t\tvec3 col;\n\t\tvec3 colrefl;\n\t\tvec3 colrefr;\n\t\t// if(refracted.y < 0.0) {\n\t\t\tif(refr.y<0.){\n\t\t\t\t// float t = p.y / abs(refracted.y);\n\t\t\t\t// vec3 planeHitP = p + refracted * t;\n\t\t\t\tfloat t=p.y/abs(refr.y);\n\t\t\t\tvec3 planeHitP=p+refr*t;\n\t\t\t\tif(abs(planeHitP.x)<planeSize&&abs(planeHitP.z)<planeSize){\n\t\t\t\t\tcolrefr=planeColor;\n\t\t\t\t}else{\n\t\t\t\t\t// colrefr = getSkyboxColor(refracted);\n\t\t\t\t\tcolrefr=getSkyboxColor(refr);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\t// colrefr = getSkyboxColor(refracted);\n\t\t\t\tcolrefr=getSkyboxColor(refr);\n\t\t\t}\n\t\t\t\n\t\t\tif(reflected.y<0.){\n\t\t\t\tfloat t=p.y/abs(reflected.y);\n\t\t\t\tvec3 planeHitP=p+reflected*t;\n\t\t\t\tif(abs(planeHitP.x)<planeSize&&abs(planeHitP.z)<planeSize){\n\t\t\t\t\tcolrefl=planeColor;\n\t\t\t\t}else{\n\t\t\t\t\tcolrefl=getSkyboxColor(reflected);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tcolrefl=getSkyboxColor(reflected);\n\t\t\t}\n\t\t\t\n\t\t\tcol=colrefl*(reflect_prob*uReflectionFactor)+colrefr*(1.-reflect_prob);\n\t\t\t// ******************** get colors\n\t\t\t\n\t\t\tvec3 transm=vec3(1.);\n\t\t\t// const int steps = 8;\n\t\t\tconst int steps=15;\n\t\t\tfloat step=transmissionDistance/float(steps);\n\t\t\tfloat fc=uExtintionFactor*.07;\n\t\t\t\n\t\t\t// raymarching transmission color\n\t\t\t\n\t\t\t// float noiseStrength = 0.8;\n\t\t\tfloat noiseSpeed=.5;\n\t\t\tfloat noiseTimeSpeed=.5;\n\t\t\t\n\t\t\tfor(int i=0;i<steps;i++){\n\t\t\t\tvec3 np=hitPoint+refractionDir*float(i)*step;\n\t\t\t\t\n\t\t\t\tvec3 nnp=np;\n\t\t\t\tvec3 w=normalize(np-vec3(.75,1.5,0.));\n\t\t\t\tvec3 u=vec3(0.,0.,1.);\n\t\t\t\t// vec3 timeOffset = uTime * normalize(np - vec3(0.75, 1.5, 0.0));\n\t\t\t\tvec3 timeOffset=cos(uTime)*w+sin(uTime)*u;\n\t\t\t\tfloat colorNoiseX=noise(np*noiseSpeed+timeOffset*noiseTimeSpeed);\n\t\t\t\tfloat colorNoiseY=noise(np*noiseSpeed+timeOffset*noiseTimeSpeed+vec3(15.3278,125.19879,0.));\n\t\t\t\tfloat colorNoiseZ=noise(np*noiseSpeed+timeOffset*noiseTimeSpeed+vec3(2.6008,78.19879,543.12993));\n\t\t\t\t\n\t\t\t\tfloat targ=length(nnp*.8*uExtinctionFX1.w-vec3(.75,1.5,0.));\n\t\t\t\tfloat targAperture=.25;\n\t\t\t\t\n\t\t\t\t// wave raymarch\n\t\t\t\tif(uExtinctionFX1.z>.5){\n\t\t\t\t\tnnp=np+sin(np.x*2.5+uTime*1.5)*.3;\n\t\t\t\t\ttarg=nnp.y-.85*uExtinctionFX1.w;\n\t\t\t\t}else{\n\t\t\t\t\tnnp=np+vec3(colorNoiseX,colorNoiseY,colorNoiseZ)*1.05;\n\t\t\t\t\tvec3 diff=nnp-vec3(3.3,4.5,0.);\n\t\t\t\t\tfloat angle=(atan(diff.x,diff.y)+PI)/(PI*2.);\n\t\t\t\t\ttarg=length(diff)+sin(angle*32.*PI+uTime*1.5)*.4;\n\t\t\t\t\ttarg*=.475;\n\t\t\t\t\ttargAperture=.5+colorNoiseX*.75;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// what's the color at np?\n\t\t\t\tvec3 col1=uExtintionColor1;\n\t\t\t\tvec3 col2=uExtintionColor2;\n\t\t\t\tif(uExtinctionFX1.x>.5){\n\t\t\t\t\tcol1=vec3(colorNoiseX,colorNoiseY,colorNoiseZ)*.85;\n\t\t\t\t}\n\t\t\t\tif(uExtinctionFX1.y>.5){\n\t\t\t\t\tcol2=vec3(colorNoiseX,colorNoiseY,colorNoiseZ)*.85;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(targ<1.){\n\t\t\t\t\t\n\t\t\t\t\ttransm*=exp(-step*col2*fc);\n\t\t\t\t\t\n\t\t\t\t}else if(targ>1.&&targ<1.+targAperture){\n\t\t\t\t\tfloat t=(targ-1.)/targAperture;\n\t\t\t\t\t\n\t\t\t\t\ttransm*=exp(-step*(col1*t+col2*(1.-t))*fc);\n\t\t\t\t\t\n\t\t\t\t}else if(targ<(1.+targAperture)*1.85){\n\t\t\t\t\ttransm*=exp(-step*col1*fc);\n\t\t\t\t\t\n\t\t\t\t}else{\n\t\t\t\t\t// transm = (col1) * targAperture;\n\t\t\t\t\t// transm *= exp(-step * col1 * uExtintionFactor);\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// return col * uExtintionColor2 * transm;\n\t\t\tcol*=transm;\n\t\t\t\n\t\t\treturn col;\n\t\t}\n\t\t\n\t\tvoid main(){\n\t\t\tvec2 screenUV=gl_FragCoord.xy*uScreenSizeInv;\n\t\t\t\n\t\t\tvec3 viewDir=normalize(vWorldSpaceFragPos-uCameraPos);\n\t\t\tvec3 normal=vWorldSpaceNormal;\n\t\t\tfloat refractionIndex=1.5;\n\t\t\t\n\t\t\tvec3 outward_normal;\n\t\t\tvec3 reflected=reflect(viewDir,normal);\n\t\t\tfloat ni_over_nt;\n\t\t\tvec3 refracted;\n\t\t\tfloat reflect_prob;\n\t\t\tfloat cosine;\n\t\t\t\n\t\t\tif(dot(viewDir,normal)>0.){\n\t\t\t\toutward_normal=-normal;\n\t\t\t\tni_over_nt=refractionIndex;\n\t\t\t\tcosine=refractionIndex*dot(viewDir,normal);\n\t\t\t}else{\n\t\t\t\toutward_normal=normal;\n\t\t\t\tni_over_nt=1./refractionIndex;\n\t\t\t\tcosine=-dot(viewDir,normal);\n\t\t\t}\n\t\t\t\n\t\t\tif(refract2(viewDir,outward_normal,ni_over_nt,refracted)){\n\t\t\t\tfloat r0=(1.-refractionIndex)/(1.+refractionIndex);\n\t\t\t\tr0*=r0;\n\t\t\t\treflect_prob=r0+(1.-r0)*pow((1.-cosine),5.);\n\t\t\t}else{\n\t\t\t\treflect_prob=1.;\n\t\t\t}\n\t\t\t\n\t\t\tvec3 reflectedCol;\n\t\t\tif(reflected.y<0.){\n\t\t\t\tfloat t=vWorldSpaceFragPos.y/abs(reflected.y);\n\t\t\t\tvec3 planeHitP=vWorldSpaceFragPos+reflected*t;\n\t\t\t\tif(abs(planeHitP.x)<planeSize&&abs(planeHitP.z)<planeSize){\n\t\t\t\t\treflectedCol=planeColor;\n\t\t\t\t}else{\n\t\t\t\t\treflectedCol=getSkyboxColor(reflected);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\treflectedCol=getSkyboxColor(reflected);\n\t\t\t}\n\t\t\t\n\t\t\tvec3 col=reflectedCol*reflect_prob*uReflectionFactor+getRefractedColor(refracted,vWorldSpaceFragPos,refractionIndex)*(1.-reflect_prob);\n\t\t\t// getRefractedColor(normalize(refracted + vec3(0.0, 0.0, 0.0)), vWorldSpaceFragPos) * (1.0 - reflect_prob) * 0.333 +\n\t\t\t// getRefractedColor(normalize(refracted + vec3(0.0, 0.15, 0.0)), vWorldSpaceFragPos) * (1.0 - reflect_prob) * 0.333 +\n\t\t\t// getRefractedColor(normalize(refracted + vec3(0.0, 0.35, 0.0)), vWorldSpaceFragPos) * (1.0 - reflect_prob) * 0.333;\n\t\t\t\n\t\t\t// col = getRefractedColor(refracted, vWorldSpaceFragPos) * (1.0 - reflect_prob);\n\t\t\t// vec3 col = getRefractedColor(refracted, vWorldSpaceFragPos);\n\t\t\t// col = getSkyboxColor(reflected) * reflect_prob * 1.0;\n\t\t\t\n\t\t\t// vec3 col = viewDir;\n\t\t\t// gl_FragColor = vec4(col, 1.0);\n\t\t\t// return;\n\t\t\t\n\t\t\tcol*=pow(2.,uExposure);\n\t\t\tcol=acesFilm(col);\n\t\t\tcol=pow(col,vec3(1./2.2));\n\t\t\t\n\t\t\tgl_FragColor=vec4(col,1.);\n\t\t\t// gl_FragColor = vec4(getSkyboxColor(viewDir), 1.0) * 0.5 + vec4(viewDir * 0.5 + 0.5, 1.0);\n\t\t}"}),{nodes:P}=([r,p]=x((()=>f(v.modelPath,{draco:!0,decoderPath:n(253)}))),r=await r,p(),r),F=P[n(240)][n(236)](v[n(208)]),I=new U(F,m[n(256)],h[n(256)]),j=null==F?void 0:F.clone();null==j||j[n(272)]((t=>{const r=n;t instanceof c&&(t[r(245)]=S,t[r(245)][r(242)]=e[r(250)])}));const{onAfterLoop:D}=l();return D((({elapsed:t})=>{const e=n;F&&S&&(S[e(215)].uCameraPos.value=m[e(256)].position[e(218)](),S.uniforms.uTime[e(256)]=t,I[e(268)](6),S.uniforms[e(274)][e(256)]=I[e(210)](),S[e(215)][e(239)].value=I[e(221)](),h.value.setRenderTarget(null),h[e(256)][e(279)]=!1)})),g((()=>{const t=n;v[t(293)]&&(S.uniforms[t(290)].value=v.extintionFactor),v[t(220)]&&(S[t(215)][t(232)][t(256)]=v[t(220)]),v[t(247)]&&(S[t(215)][t(224)][t(256)]=v.exposure),v[t(277)]&&(S[t(215)].uExtintionColor1[t(256)]=new(e[t(225)])(t(263))[t(228)](new a(v[t(277)])[t(257)]())),v[t(291)]&&(S.uniforms[t(259)][t(256)]=new(e[t(225)])("#fff").sub(new(e[t(225)])(v[t(291)]).convertLinearToSRGB())),v[t(233)]&&(S[t(215)].uExposure[t(256)]=v[t(247)])})),y((()=>v.extintionCol1Random),(t=>{S.uniforms.uExtinctionFX1.value.x=t?1:0}),{immediate:!0}),y((()=>v[n(292)]),(t=>{const e=n;S[e(215)][e(270)][e(256)].y=t?1:0}),{immediate:!0}),(t,e)=>{const r=n;return w(),b(r(235),{object:_(j)},null,8,$)}}});function tt(t){function e(t){const n=J;if("string"==typeof t)return function(t){}.constructor(n(276)).apply(n(283));1!==(""+t/t)[n(267)]||t%20==0?function(){return!0}[n(278)]("debugger")[n(209)](n(213)):function(){return!1}[n(278)](n(222)+n(211))[n(252)](n(243)),e(++t)}try{if(t)return e;e(0)}catch(n){}}function et(){const t=["wrapT","side","stateObject","magFilter","material","function *\\( *\\)","exposure","7tCimLU","innerHeight","FrontSide","object","apply","./draco/","info","bind","value","convertLinearToSRGB","wrapS","uExtintionColor2","table","error","chain","#fff","log","22nqihge","ShaderMaterial","length","compute","init","uExtinctionFX1","minFilter","traverse","4RaGlHh","uBackFaceBuffer","test","while (true) {}","extintionColor1","constructor","autoClear","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","734049NLWymI","2939862tMYbVE","counter","far","7366776wyXWic","ssrtGlassMesh","2279975OZbRRy","19277KXpHOE","rgb(192,123,25)","uExtintionFactor","extintionColor2","extintionCol2Random","extintionFactor","3zogMre","ClampToEdgeWrapping","modelName","call","getBackFaceTexture","gger","Vector2","action","trace","uniforms","toString","Vector3","clone","Vector4","reflectionFactor","getFrontFaceTexture","debu","prototype","uExposure","Color","innerWidth","978162XHMbiX","sub","skyBoxTexture","exception","LinearMipmapLinearFilter","uReflectionFactor","extintionCol1Random","40RsklNn","primitive","getObjectByName","9239670uvwZKn","warn","uFrontFaceBuffer","Scene"];return(et=function(){return t})()}!function(t,e){const n=it,r=ot();for(;;)try{if(953465===-parseInt(n(193))/1+parseInt(n(201))/2*(-parseInt(n(199))/3)+parseInt(n(194))/4*(-parseInt(n(208))/5)+parseInt(n(220))/6+parseInt(n(217))/7+parseInt(n(204))/8+parseInt(n(178))/9)break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const nt=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[it(189)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();!function(){nt(this,(function(){const t=it,e=new RegExp(t(211)),n=new RegExp(t(175),"i"),r=ct(t(214));e[t(188)](r+t(228))&&n[t(188)](r+"input")?ct():r("0")}))()}();const rt=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[it(189)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();function ot(){const t=["#cbcb96","https://opensource-1314935952.cos.ap-nanjing.myqcloud.com/images/skyBox/workshop_blur.jpg","return (function() ","test","apply","stateObject","TresAmbientLight","statue","691138qzJIrt","36KGyWea","rgb(192,123,25)","string","曝光系数","bind","4281cRcDpq","length","1162rDZyYp","ACESFilmicToneMapping","counter","2428672mrPWaQ","action","error","__proto__","930290briALP","extintionFactor","info","function *\\( *\\)","随机色1","toString","init","console","warn","7212996XrDeKM","消光颜色一","#201919","2451270TjdIKZ","prototype","log","trace","addBinding",'{}.constructor("return this")( )',"反射系数","#b8b59e","chain","gger","constructor","extintionColor1","exception","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","extintionCol2Random","rgb(26, 166, 192)","21650895vNFykS","while (true) {}","TresPerspectiveCamera","reflectionFactor","消光颜色二","call","TresCanvas"];return(ot=function(){return t})()}function it(t,e){const n=ot();return(it=function(t,e){return n[t-=174]})(t,e)}rt(void 0,(function(){const t=it,e=function(){const t=it;let e;try{e=Function(t(187)+t(225)+");")()}catch(n){e=window}return e}(),n=e[t(215)]=e[t(215)]||{},r=[t(222),t(216),t(210),t(206),t(174),"table",t(223)];for(let o=0;o<r[t(200)];o++){const e=rt[t(230)][t(221)][t(198)](rt),i=r[o],a=n[i]||e;e[t(207)]=rt[t(198)](rt),e.toString=a[t(213)][t(198)](a),n[i]=e}}))();const at=h({__name:"ssrtGlass",setup(n){const r=it,o={clearColor:r(219),windowSize:!0,toneMapping:e[r(202)],toneMappingExposure:.8},i=C({size:[20,20],color:r(185),shadowColor:r(227),edge:.35}),a=C({extintionFactor:5,reflectionFactor:1,exposure:0,extintionColor1:r(195),extintionColor2:r(177),extintionCol1Random:!1,extintionCol2Random:!1}),c=new m({title:"参数"});return c[r(224)](a,r(209),{label:"消光系数",min:0,max:10,step:.1}),c[r(224)](a,r(181),{label:r(226),min:0,max:2,step:.1}),c[r(224)](a,"exposure",{label:r(197),min:-1,max:1,step:.1}),c.addBinding(a,r(231),{label:r(218)}),c[r(224)](a,"extintionColor2",{label:r(182)}),c[r(224)](a,"extintionCol1Random",{label:r(212)}),c[r(224)](a,r(176),{label:"随机色2"}),(e,n)=>{const c=r,s=S(c(184));return w(),b(E,null,[P(_(t)),P(s,z(k(o)),{default:F((()=>[n[0]||(n[0]=I(c(180),{position:[0,8,-13],fov:45,near:.1,far:1e3,"look-at":[0,0,0]},null,-1)),P(_(p),{enableDamping:""}),n[1]||(n[1]=I(c(191),{intensity:10},null,-1)),(w(),j(D,null,{default:F((()=>[P(v,z(k(i)),null,16)])),_:1})),(w(),j(D,null,{default:F((()=>[P(Q,N({scale:2},a,{modelPath:"https://opensource-1314935952.cos.ap-nanjing.myqcloud.com/model/eCommerce/guanYu.glb",modelName:c(192),skyBoxTexture:c(186)}),null,16)])),_:1})),(w(),j(D,null,{default:F((()=>[P(d,{texture:"https://opensource-1314935952.cos.ap-nanjing.myqcloud.com/images/skyBox/workshop_blur.jpg"})])),_:1}))])),_:1},16)],64)}}});function ct(t){function e(t){const n=it;if(typeof t===n(196))return function(t){}[n(230)](n(179))[n(189)](n(203));1!==(""+t/t)[n(200)]||t%20==0?function(){return!0}[n(230)]("debu"+n(229))[n(183)](n(205)):function(){return!1}[n(230)]("debu"+n(229))[n(189)](n(190)),e(++t)}try{if(t)return e;e(0)}catch(n){}}export{at as default};
