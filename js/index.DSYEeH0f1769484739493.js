import{importShared as e}from"./3d-tiles-renderer.qyEDeaaW1769484739493.js";import{MqttClientWrapper as l}from"./mqttTvt.CJKnO3P-1769484739493.js";import{_export_sfc as a}from"./index.CuW8EyFk1769484739493.js";import{Button as t}from"./Button.Dm4b10Vv1769484739493.js";import{NDivider as u,NLog as o}from"./Log.DE00QT8A1769484739493.js";import{useMessage as n,NMessageProvider as r}from"./use-message.02i7TXqw1769484739493.js";import{NCard as s}from"./Card.JT4TRoUg1769484739493.js";import{NForm as d,NFormItem as i}from"./FormItem.CDfgG_qx1769484739493.js";import{NTag as v}from"./Tag.CfGeh5iF1769484739493.js";import{NInput as c}from"./Input.4BgkSjFW1769484739493.js";import{NInputNumber as f}from"./InputNumber.skr6-1tG1769484739493.js";import{NSpace as m}from"./Space.gQHDSOGR1769484739493.js";const{createTextVNode:p,unref:_,withCtx:b,createVNode:w,renderList:g,Fragment:h,openBlock:y,createElementBlock:j,toDisplayString:T,createBlock:k}=await e("vue"),x={class:"w-full",style:{"background-color":"#ffffff"}},{ref:U,reactive:C,onUnmounted:I}=await e("vue"),B=a({__name:"MqttTesterUI",setup(e){const a=n(),r=C({host:"a5183db3.ala.asia-southeast1.emqxsl.com",port:8084,protocol:"wss",clientId:`tvt-test-client-${Math.random().toString(16).slice(2,8)}`,username:"tvt.js",password:"test",topic:"tvtDevices/#"}),B=U("tvtDevices/uiDemo"),M=U('{ "hello": "world" }'),N=U(null),S=U(!1),q=U([]),D=U(!1);function $(){N.value&&(N.value.removeAllListeners(),N.value.disconnect(),N.value=null,S.value=!1)}function Q(){$(),D.value=!0,N.value=new l(r),N.value.on("connected",()=>{S.value=!0,D.value=!1,a.success("MQTT 连接成功")}),N.value.on("close",()=>{S.value=!1,D.value=!1,a.warning("MQTT 连接关闭")}),N.value.on("error",e=>{D.value=!1,console.error(e),a.error(`MQTT 错误: ${e.message}`)}),N.value.on("message",(e,l)=>{q.value.push(`[${e}] ${JSON.stringify(l)}`),q.value.length>100&&q.value.shift()}),N.value.connect()}const A=U(new Set);function F(){if(N.value)for(const e of A.value)N.value.unsubscribe(e);A.value.clear(),$(),a.success("已断开连接")}function J(){if(!N.value||!S.value)return void a.warning("尚未连接 MQTT");const e=r.topic?.trim();e?A.value.has(e)?a.info(`已订阅该主题：${e}`):(N.value.subscribe(e),A.value.add(e),a.success(`订阅成功：${e}`)):a.warning("请输入订阅主题")}function L(){try{const e=JSON.parse(M.value);N.value.publish(B.value,e),a.info("已发送消息")}catch(e){a.error("JSON 格式错误")}}return I(()=>{F()}),(e,l)=>(y(),j("div",x,[w(_(s),{title:"MQTT 调试面板",class:"max-w-4xl mx-auto"},{default:b(()=>[w(_(d),{model:r,"label-width":"100"},{default:b(()=>[w(_(i),{label:"注意："},{default:b(()=>[w(_(v),{style:{"margin-left":"10px"},type:"warning"},{default:b(()=>[...l[8]||(l[8]=[p("免费服务每月流量/次数有限，若连接失败请自行更换自己的mqtt服务",-1)])]),_:1})]),_:1}),w(_(i),{label:"地址"},{default:b(()=>[w(_(c),{value:r.host,"onUpdate:value":l[0]||(l[0]=e=>r.host=e),placeholder:"例如: broker.hivemq.com"},null,8,["value"])]),_:1}),w(_(i),{label:"端口"},{default:b(()=>[w(_(f),{value:r.port,"onUpdate:value":l[1]||(l[1]=e=>r.port=e),min:1},null,8,["value"]),w(_(v),{style:{"margin-left":"10px"},type:"info"},{default:b(()=>[...l[9]||(l[9]=[p("浏览器端只支持：wws方式 的 mqtt",-1)])]),_:1})]),_:1}),w(_(i),{label:"Client ID"},{default:b(()=>[w(_(c),{value:r.clientId,"onUpdate:value":l[2]||(l[2]=e=>r.clientId=e),placeholder:"随机生成也可"},null,8,["value"])]),_:1}),w(_(i),{label:"用户名"},{default:b(()=>[w(_(c),{value:r.username,"onUpdate:value":l[3]||(l[3]=e=>r.username=e)},null,8,["value"])]),_:1}),w(_(i),{label:"密码"},{default:b(()=>[w(_(c),{value:r.password,"onUpdate:value":l[4]||(l[4]=e=>r.password=e)},null,8,["value"])]),_:1}),w(_(i),{label:"订阅主题"},{default:b(()=>[w(_(c),{value:r.topic,"onUpdate:value":l[5]||(l[5]=e=>r.topic=e),placeholder:"例如: tvt/demo"},null,8,["value"])]),_:1}),w(_(m),null,{default:b(()=>[w(_(t),{type:"primary",disabled:S.value||D.value,loading:D.value,onClick:Q},{default:b(()=>[...l[10]||(l[10]=[p("连接",-1)])]),_:1},8,["disabled","loading"]),w(_(t),{type:"warning",disabled:!S.value,onClick:F},{default:b(()=>[...l[11]||(l[11]=[p("断开",-1)])]),_:1},8,["disabled"]),w(_(t),{type:"success",disabled:!S.value,onClick:J},{default:b(()=>[...l[12]||(l[12]=[p("订阅",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"]),w(_(u),null,{default:b(()=>[...l[13]||(l[13]=[p("已订阅主题",-1)])]),_:1}),w(_(m),null,{default:b(()=>[(y(!0),j(h,null,g(Array.from(A.value),e=>(y(),k(_(v),{key:e,type:"info",round:""},{default:b(()=>[p(T(e),1)]),_:2},1024))),128))]),_:1}),w(_(u),null,{default:b(()=>[...l[14]||(l[14]=[p("发送消息 [主题/json消息]",-1)])]),_:1}),w(_(c),{value:B.value,"onUpdate:value":l[6]||(l[6]=e=>B.value=e),placeholder:"主题",class:"mb-2"},null,8,["value"]),w(_(c),{value:M.value,"onUpdate:value":l[7]||(l[7]=e=>M.value=e),type:"textarea",placeholder:'{ "key": "value" }',rows:4},null,8,["value"]),w(_(t),{type:"info",class:"mt-2",disabled:!S.value,onClick:L},{default:b(()=>[...l[15]||(l[15]=[p("发送",-1)])]),_:1},8,["disabled"]),w(_(u),null,{default:b(()=>[...l[16]||(l[16]=[p("收到的消息",-1)])]),_:1}),w(_(o),{log:q.value.join("\n"),rows:12},null,8,["log"])]),_:1})]))}},[["__scopeId","data-v-e8d1d438"]]),{createVNode:M,unref:N,withCtx:S,openBlock:q,createBlock:D}=await e("vue"),$={__name:"index",setup:e=>(e,l)=>(q(),D(N(r),null,{default:S(()=>[M(B)]),_:1}))};export{$ as default};
