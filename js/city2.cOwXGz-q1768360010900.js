import{importShared as e}from"./3d-tiles-renderer.CvhCoabY1768360010900.js";import{useLoop as n,useGLTF as i,OrbitControls_default as o}from"./index.CsTVQ09Z1768360010900.js";import{LineSegmentsGeometry as a,LineMaterial as l,LineSegments2 as r}from"./LineSegments2.Ct8zH0ba1768360010900.js";import{B as t}from"./three-custom-shader-material.es.D0tCJZN-1768360010900.js";import{resetUV as s,initMeshBvh as m,setThreeWater2 as d}from"./utils.DNaHl0jz1768360010900.js";import{buildingsCustomShaderMaterial_default as c,buildingsCustomShaderMaterial_default$1 as u}from"./buildingsCustomShaderMaterial.D6vHRvel1768360010900.js";import{_sfc_main as v}from"./roadLight.vue_vue_type_script_setup_true_lang.D0mJ1JYY1768360010900.js";const{ShaderMaterial:f,Clock:g,Uniform:p,Color:h,NormalBlending:y,AdditiveBlending:_,FrontSide:w,BackSide:x,DoubleSide:S}=await e("three");class b extends f{constructor(e={}){super(),this.vertexShader="\n      #define STANDARD\n      varying vec3 vViewPosition;\n      #ifdef USE_TRANSMISSION\n      varying vec3 vWorldPosition;\n      #endif\n    \n      varying vec2 vUv;\n      varying vec4 vPos;\n      varying vec3 vNormalW;\n      varying vec3 vPositionW;\n\n      #include <common>\n      #include <uv_pars_vertex>\n      #include <envmap_pars_vertex>\n      #include <color_pars_vertex>\n      #include <fog_pars_vertex>\n      #include <morphtarget_pars_vertex>\n      #include <skinning_pars_vertex>\n      #include <logdepthbuf_pars_vertex>\n      #include <clipping_planes_pars_vertex>\n\n      void main() {\n        \n        #include <uv_vertex>\n        #include <color_vertex>\n        #include <morphcolor_vertex>\n      \n        #if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n      \n          #include <beginnormal_vertex>\n          #include <morphnormal_vertex>\n          #include <skinbase_vertex>\n          #include <skinnormal_vertex>\n          #include <defaultnormal_vertex>\n      \n        #endif\n      \n        #include <begin_vertex>\n        #include <morphtarget_vertex>\n        #include <skinning_vertex>\n        #include <project_vertex>\n        #include <logdepthbuf_vertex>\n        #include <clipping_planes_vertex>\n      \n        #include <worldpos_vertex>\n        #include <envmap_vertex>\n        #include <fog_vertex>\n\n        mat4 modelViewProjectionMatrix = projectionMatrix * modelViewMatrix;\n\n        vUv = uv;\n        vPos = projectionMatrix * modelViewMatrix * vec4( transformed, 1.0 );\n        vPositionW = vec3( vec4( transformed, 1.0 ) * modelMatrix);\n        vNormalW = normalize( vec3( vec4( normal, 0.0 ) * modelMatrix ) );\n        \n        gl_Position = modelViewProjectionMatrix * vec4( transformed, 1.0 );\n\n      }",this.fragmentShader=" \n      varying vec2 vUv;\n      varying vec3 vPositionW;\n      varying vec4 vPos;\n      varying vec3 vNormalW;\n      \n      uniform float time;\n      uniform float fresnelOpacity;\n      uniform float scanlineSize;\n      uniform float fresnelAmount;\n      uniform float signalSpeed;\n      uniform float hologramBrightness;\n      uniform float hologramOpacity;\n      uniform bool blinkFresnelOnly;\n      uniform bool enableBlinking;\n      uniform vec3 hologramColor;\n\n      float flicker( float amt, float time ) {return clamp( fract( cos( time ) * 43758.5453123 ), amt, 1.0 );}\n      float random(in float a, in float b) { return fract((cos(dot(vec2(a,b) ,vec2(12.9898,78.233))) * 43758.5453)); }\n\n      void main() {\n        vec2 vCoords = vPos.xy;\n        vCoords /= vPos.w;\n        vCoords = vCoords * 0.5 + 0.5;\n        vec2 myUV = fract( vCoords );\n\n        // Defines hologram main color\n        vec4 hologramColor = vec4(hologramColor, mix(hologramBrightness, vUv.y, 0.5));\n\n        // Add scanlines\n        float scanlines = 10.;\n        scanlines += 20. * sin(time *signalSpeed * 20.8 - myUV.y * 60. * scanlineSize);\n        scanlines *= smoothstep(1.3 * cos(time *signalSpeed + myUV.y * scanlineSize), 0.78, 0.9);\n        scanlines *= max(0.25, sin(time *signalSpeed) * 1.0);        \n        \n        // Scanlines offsets\n        float r = random(vUv.x, vUv.y);\n        float g = random(vUv.y * 20.2, \tvUv.y * .2);\n        float b = random(vUv.y * .9, \tvUv.y * .2);\n\n        // Scanline composition\n        hologramColor += vec4(r*scanlines, b*scanlines, r, 1.0) / 84.;\n        vec4 scanlineMix = mix(vec4(0.0), hologramColor, hologramColor.a);\n\n        // Calculates fresnel\n        vec3 viewDirectionW = normalize(cameraPosition - vPositionW);\n        float fresnelEffect = dot(viewDirectionW, vNormalW) * (1.6 - fresnelOpacity/2.);\n        fresnelEffect = clamp(fresnelAmount - fresnelEffect, 0., fresnelOpacity);\n\n        // Blinkin effect\n        //Suggested by Octano - https://x.com/OtanoDesign?s=20\n        float blinkValue = enableBlinking ? 0.6 - signalSpeed : 1.0;\n        float blink = flicker(blinkValue, time * signalSpeed * .02);\n    \n        // Final shader composition\n        vec3 finalColor;\n\n        if(blinkFresnelOnly){\n          // finalColor = vec3(1.0,1.0,0);\n          finalColor = scanlineMix.rgb + fresnelEffect * blink;\n        }else{\n          finalColor = scanlineMix.rgb * blink + fresnelEffect;\n        }\n\n        gl_FragColor = vec4( finalColor, hologramOpacity);\n\n      }",this.uniforms={time:new p(0),fresnelOpacity:new p(void 0!==e.fresnelOpacity?e.fresnelOpacity:1),fresnelAmount:new p(void 0!==e.fresnelAmount?e.fresnelAmount:.45),scanlineSize:new p(void 0!==e.scanlineSize?e.scanlineSize:8),hologramBrightness:new p(void 0!==e.hologramBrightness?e.hologramBrightness:1),signalSpeed:new p(void 0!==e.signalSpeed?e.signalSpeed:1),hologramColor:new p(void 0!==e.hologramColor?new h(e.hologramColor):new h("#00d5ff")),enableBlinking:new p(void 0===e.enableBlinking||e.enableBlinking),blinkFresnelOnly:new p(void 0===e.blinkFresnelOnly||e.blinkFresnelOnly),hologramOpacity:new p(void 0!==e.hologramOpacity?e.hologramOpacity:1)},this.clock=new g,this.setValues(e),this.depthTest=void 0!==e.depthTest&&e.depthTest,this.blending=void 0!==e.blendMode?e.blendMode:_,this.transparent=!0,this.side=void 0!==e.side?e.side:w}update(){this.uniforms.time.value=this.clock.getElapsedTime()}}const{defineComponent:C}=await e("vue"),{Color:B,DoubleSide:k,AdditiveBlending:O}=await e("three"),j=C({__name:"importantBuildings",props:{group:{}},setup(e){const i=e,o=0,a=0,l=15,r=1.3,t="#e05b0f",m=new b({blendMode:O,hologramBrightness:2.5,side:k});m.uniforms.fresnelAmount.value=o,m.uniforms.scanlineSize.value=l,m.uniforms.signalSpeed.value=r,m.uniforms.fresnelOpacity.value=a,m.uniforms.hologramColor.value=new B(t),m.uniforms.enableBlinking.value=!1,m.depthTest=!0;let d,c,u=null;(()=>{const e=i.group.getObjectByName("02-huanqiujinrongzhongxin_huanqiujinrongzhongxin_0");e.name="环球金融中心",e.material.dispose(),s(e.geometry),e.material=m,d=i.group.getObjectByName("01-shanghaizhongxindasha_shanghaizhongxindasha_0"),d.name="上海中心",d.material.dispose(),s(d.geometry),d.material=m.clone(),d.material.uniforms.hologramColor.value=new B("#006cf9"),d.material.uniforms.fresnelAmount.value=1,d.material.uniforms.scanlineSize.value=2.1,d.material.uniforms.signalSpeed.value=.4,c=i.group.getObjectByName("03-jinmaodasha_jjinmaodasha_0"),c.name="金茂大厦",c.material.dispose(),s(c.geometry),c.material=m.clone(),c.material.uniforms.hologramColor.value=new B("#5e0fe0"),c.material.uniforms.scanlineSize.value=15,c.material.uniforms.signalSpeed.value=.18,u=i.group.getObjectByName("04-dongfangmingzhu_dongfangmingzhu_0"),u.name="东方明珠塔",u.material.dispose(),s(u.geometry),u.material=m.clone(),u.material.uniforms.scanlineSize.value=5,u.material.uniforms.signalSpeed.value=1.3,u.material.uniforms.hologramColor.value=new B("#e00f0f"),u.material.uniforms.fresnelOpacity.value=.1})();const{onBeforeRender:v}=n();return v(()=>{m.update(),d.material.update(),c.material.update(),u.material.update()}),(e,n)=>null}}),{defineComponent:M}=await e("vue"),{openBlock:z,createElementBlock:N,createCommentVNode:P,createBlock:T,Fragment:U}=await e("vue"),A=["object"],{ref:V,watch:W,toRaw:E}=await e("vue"),{Color:D,DoubleSide:F,EdgesGeometry:R,MeshStandardMaterial:G}=await e("three"),L=M({__name:"buildingsMode",setup(e){m();const{state:o}=i("https://opensource.cdn.icegl.cn/model/digitalCity/shanghaiDraco/shanghaiDraco.gltf",{draco:!0,decoderPath:"./draco/"}),s=V(null);W(()=>o.value,e=>{e?.scene&&(s.value=e.scene.clone(),s.value.traverse(async e=>{if(e.isMesh&&(-1!==e.name.indexOf("Shanghai")||-1!==e.name.indexOf("Object")))if(-1!==e.name.indexOf("Floor"));else if(-1!==e.name.indexOf("River")){const n=await d(E(e));n.position.set(0,0,1800),e.add(n)}else f(E(e)),g(E(e))}))});const v=V(0),f=e=>{const{geometry:n}=e;n.computeBoundingBox(),n.computeBoundingSphere(),n.computeBoundsTree();const{max:i,min:o}=n.boundingBox,a=new t({baseMaterial:G,vertexShader:u,fragmentShader:c,silent:!0,uniforms:{uMax:{value:i},uMin:{value:o},uBorderWidth:{value:.006},uCircleTime:{value:3},uColor:{value:new D("#005c58")},uOpacity:{value:.8},uLightColor:{value:new D("#990")},uTopColor:{value:new D("#888800")},uTime:v,uGradient:{value:!0}},depthWrite:!0,depthTest:!0,transparent:!0,side:F});e.material.dispose(),e.material=a},g=e=>{const n=new R(e.geometry,1e3);let i=(new a).fromEdgesGeometry(n);i.computeBoundsTree();let o=new l({color:new D("#000"),linewidth:.8,opacity:.6,transparent:!0,depthWrite:!0,depthTest:!0});o.resolution.set(window.innerWidth,window.innerHeight),e.add(new r(i,o))},{onBeforeRender:p}=n();return p(({delta:e})=>{v.value+=e}),(e,n)=>(z(),N(U,null,[s.value?(z(),N("primitive",{key:0,object:E(s.value),position:[1,0,1]},null,8,A)):P("",!0),s.value?(z(),T(j,{key:1,group:E(s.value)},null,8,["group"])):P("",!0)],64))}}),{defineComponent:I}=await e("vue"),{createElementVNode:q,unref:H,createVNode:J,Suspense:K,withCtx:Q,openBlock:Z,createBlock:X,resolveComponent:Y}=await e("vue"),$=I({__name:"city2",setup:e=>(e,n)=>{const i=Y("TresCanvas");return Z(),X(i,{shadows:"","window-size":"",clearColor:"#333"},{default:Q(()=>[n[0]||(n[0]=q("TresPerspectiveCamera",{position:[.5,2,1.5],fov:45,near:.1,far:1e5},null,-1)),J(H(o)),n[1]||(n[1]=q("TresAmbientLight",{color:"#ffffff"},null,-1)),n[2]||(n[2]=q("TresDirectionalLight",{position:[0,3,3],intensity:2,color:"#ffffff","cast-shadow":"","shadow-mapSize-width":1024,"shadow-mapSize-height":1024},null,-1)),(Z(),X(K,null,{default:Q(()=>[J(L)]),_:1})),(Z(),X(K,null,{default:Q(()=>[J(v,{color:"#ffffff",radius:1,speed:1,geoJson:"plugins/digitalCity/geojson/secondarySmall.geojson","rotation-y":1.3826597599330712,scale:.001025905404044292,position:[-1.877460474821603,.01,-1.5464791950519081]})]),_:1})),n[3]||(n[3]=q("TresGridHelper",{args:[6,10],position:[0,0,0]},null,-1))]),_:1})}});export{$ as default};
