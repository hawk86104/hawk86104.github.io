import{importShared as d}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{NA as $,Fs as W,Kk as H}from"./index.DTe2qqjO1767148983502.js";const{Frustum:q,Vector3:s,Matrix4:K,Quaternion:Q}=await d("three"),F=new q,w=new s,v=new s,a=new s,m=new s,c=new s,p=new s,u=new s,y=new s,g=new s,M=new s,P=new s,C=new s,E=new s,S=new s,D=new K,Z=new Q,G=new s;class J{constructor(t,e,n=Number.MAX_VALUE){this.camera=t,this.scene=e,this.startPoint=new s,this.endPoint=new s,this.collection=[],this.instances={},this.deep=n}select(t,e){return this.startPoint=t||this.startPoint,this.endPoint=e||this.endPoint,this.collection=[],this._updateFrustum(this.startPoint,this.endPoint),this._searchChildInFrustum(F,this.scene),this.collection}_updateFrustum(t,e){if(t=t||this.startPoint,e=e||this.endPoint,t.x===e.x&&(e.x+=Number.EPSILON),t.y===e.y&&(e.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera){v.copy(t),v.x=Math.min(t.x,e.x),v.y=Math.max(t.y,e.y),e.x=Math.max(t.x,e.x),e.y=Math.min(t.y,e.y),a.setFromMatrixPosition(this.camera.matrixWorld),m.copy(v),c.set(e.x,v.y,0),p.copy(e),u.set(v.x,e.y,0),m.unproject(this.camera),c.unproject(this.camera),p.unproject(this.camera),u.unproject(this.camera),C.copy(m).sub(a),E.copy(c).sub(a),S.copy(p).sub(a),C.normalize(),E.normalize(),S.normalize(),C.multiplyScalar(this.deep),E.multiplyScalar(this.deep),S.multiplyScalar(this.deep),C.add(a),E.add(a),S.add(a);const n=F.planes;n[0].setFromCoplanarPoints(a,m,c),n[1].setFromCoplanarPoints(a,c,p),n[2].setFromCoplanarPoints(p,u,a),n[3].setFromCoplanarPoints(u,m,a),n[4].setFromCoplanarPoints(c,p,u),n[5].setFromCoplanarPoints(S,E,C),n[5].normal.multiplyScalar(-1)}else if(this.camera.isOrthographicCamera){const n=Math.min(t.x,e.x),r=Math.max(t.y,e.y),i=Math.max(t.x,e.x),f=Math.min(t.y,e.y);m.set(n,r,-1),c.set(i,r,-1),p.set(i,f,-1),u.set(n,f,-1),y.set(n,r,1),g.set(i,r,1),M.set(i,f,1),P.set(n,f,1),m.unproject(this.camera),c.unproject(this.camera),p.unproject(this.camera),u.unproject(this.camera),y.unproject(this.camera),g.unproject(this.camera),M.unproject(this.camera),P.unproject(this.camera);const o=F.planes;o[0].setFromCoplanarPoints(m,y,g),o[1].setFromCoplanarPoints(c,g,M),o[2].setFromCoplanarPoints(M,P,u),o[3].setFromCoplanarPoints(P,y,m),o[4].setFromCoplanarPoints(c,p,u),o[5].setFromCoplanarPoints(M,g,y),o[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}_searchChildInFrustum(t,e){if(e.isMesh||e.isLine||e.isPoints)if(e.isInstancedMesh){this.instances[e.uuid]=[];for(let n=0;n<e.count;n++)e.getMatrixAt(n,D),D.decompose(w,Z,G),w.applyMatrix4(e.matrixWorld),t.containsPoint(w)&&this.instances[e.uuid].push(n)}else e.geometry.boundingSphere===null&&e.geometry.computeBoundingSphere(),w.copy(e.geometry.boundingSphere.center),w.applyMatrix4(e.matrixWorld),t.containsPoint(w)&&this.collection.push(e);if(e.children.length>0)for(let n=0;n<e.children.length;n++)this._searchChildInFrustum(t,e.children[n])}}const{Vector2:B}=await d("three");class j{constructor(t,e){this.element=document.createElement("div"),this.element.classList.add(e),this.element.style.pointerEvents="none",this.renderer=t,this.isDown=!1,this.enabled=!0,this._startPoint=new B,this._pointTopLeft=new B,this._pointBottomRight=new B,this._onPointerDown=function(n){this.enabled!==!1&&(this.isDown=!0,this._onSelectStart(n))}.bind(this),this._onPointerMove=function(n){this.enabled!==!1&&this.isDown&&this._onSelectMove(n)}.bind(this),this._onPointerUp=function(){this.enabled!==!1&&(this.isDown=!1,this._onSelectOver())}.bind(this),this.renderer.domElement.addEventListener("pointerdown",this._onPointerDown),this.renderer.domElement.addEventListener("pointermove",this._onPointerMove),this.renderer.domElement.addEventListener("pointerup",this._onPointerUp)}dispose(){this.renderer.domElement.removeEventListener("pointerdown",this._onPointerDown),this.renderer.domElement.removeEventListener("pointermove",this._onPointerMove),this.renderer.domElement.removeEventListener("pointerup",this._onPointerUp),this.element.remove()}_onSelectStart(t){this.element.style.display="none",this.renderer.domElement.parentElement.appendChild(this.element),this.element.style.left=t.clientX+"px",this.element.style.top=t.clientY+"px",this.element.style.width="0px",this.element.style.height="0px",this._startPoint.x=t.clientX,this._startPoint.y=t.clientY}_onSelectMove(t){this.element.style.display="block",this._pointBottomRight.x=Math.max(this._startPoint.x,t.clientX),this._pointBottomRight.y=Math.max(this._startPoint.y,t.clientY),this._pointTopLeft.x=Math.min(this._startPoint.x,t.clientX),this._pointTopLeft.y=Math.min(this._startPoint.y,t.clientY),this.element.style.left=this._pointTopLeft.x+"px",this.element.style.top=this._pointTopLeft.y+"px",this.element.style.width=this._pointBottomRight.x-this._pointTopLeft.x+"px",this.element.style.height=this._pointBottomRight.y-this._pointTopLeft.y+"px"}_onSelectOver(){this.element.remove()}}const{defineComponent:ee}=await d("vue"),{unref:R,openBlock:te,createElementBlock:ne,createCommentVNode:se}=await d("vue"),oe=["object"],{onMounted:ie,watchEffect:re}=await d("vue"),T=await d("three"),ae=ee({__name:"frameSelect",setup(L){const{state:t}=$("https://opensource.cdn.icegl.cn/model/operationTool/湖中小亭/湖中小亭.gltf"),{camera:e,renderer:n,scene:r,sizes:i,controls:f}=W(),o=new J(e.value,r.value),I=new j(n,"selectBox"),Y=function(){document.addEventListener("mousedown",U,!1),document.addEventListener("mousemove",A,!1),document.addEventListener("mouseup",O,!1)};let U=function(h){console.log(f.value);for(const l of o.collection)l instanceof T.Mesh&&l.material.emissive.set(0);o.collection.length=0,o.startPoint.set(h.clientX/i.width.value*2-1,-(h.clientY/i.height.value)*2+1,.5)},A=function(h){if(I.isDown){o.endPoint.set(h.clientX/i.width.value*2-1,-(h.clientY/i.height.value)*2+1,.5);const l=o.select();console.log("allSelected",l);for(let _=0;_<l.length;_++){const x=l[_];x instanceof T.Mesh&&x.material.emissive.set(16252928)}}},O=function(h){const l=o.select();o.endPoint.set(h.clientX/i.width.value*2-1,-(h.clientY/i.height.value)*2+1,.5);for(let _=0;_<l.length;_++){const x=l[_];x instanceof T.Mesh&&x.material.emissive.set(0)}};return ie(()=>{Y()}),re(()=>{}),(h,l)=>R(t)?(te(),ne("primitive",{key:0,object:R(t)?.scene},null,8,oe)):se("",!0)}}),{defineComponent:le}=await d("vue"),{createElementVNode:N,unref:ce,normalizeProps:he,guardReactiveProps:me,createVNode:k,Suspense:pe,withCtx:V,openBlock:X,createBlock:b,resolveComponent:ue,mergeProps:de}=await d("vue"),{reactive:z}=await d("vue"),we=le({__name:"frameSelect",setup(L){const t=z({alpha:!0,antialias:!0}),e=z({enableDamping:!1,enableZoom:!1,autoRotate:!1,enablePan:!1,enableRotate:!1,makeDefault:!0});return(n,r)=>{const i=ue("TresCanvas");return X(),b(i,de({clearColor:"#201919","window-size":""},t),{default:V(()=>[r[0]||(r[0]=N("TresPerspectiveCamera",{fov:60,near:.1,far:2e3,position:[0,10,-28]},null,-1)),r[1]||(r[1]=N("TresAmbientLight",{intensity:1},null,-1)),k(ce(H),he(me(e)),null,16),(X(),b(pe,null,{default:V(()=>[k(ae)]),_:1}))]),_:1},16)}}});export{we as default};
