var u=u||{};u.collision||(u.collision={});u.collision.broadphase||(u.collision.broadphase={});u.collision.broadphase.BroadPhase=class{constructor(a){this._type=a,this._numProxies=0,this._proxyList=null,this._proxyListLast=null,this._proxyPairList=null,this._incremental=!1,this._testCount=0,this._proxyPairPool=null,this._idCount=0,this._convexSweep=new u.collision.broadphase._BroadPhase.ConvexSweepGeometry,this._aabb=new u.collision.broadphase._BroadPhase.AabbGeometry,this.identity=new u.common.Transform,this.zero=new u.common.Vec3,this.rayCastHit=new u.collision.geometry.RayCastHit}createProxy(a,t){return null}destroyProxy(a){}moveProxy(a,t,i){}isOverlapping(a,t){return a._aabbMinX<t._aabbMaxX&&a._aabbMaxX>t._aabbMinX&&a._aabbMinY<t._aabbMaxY&&a._aabbMaxY>t._aabbMinY&&a._aabbMinZ<t._aabbMaxZ?a._aabbMaxZ>t._aabbMinZ:!1}collectPairs(){}getProxyPairList(){return this._proxyPairList}isIncremental(){return this._incremental}getTestCount(){return this._testCount}rayCast(a,t,i){}convexCast(a,t,i,o){}aabbTest(a,t){}};u.collision.geometry||(u.collision.geometry={});u.collision.geometry.Geometry=class{constructor(a){this._type=a,this._volume=0}_updateMass(){}_computeAabb(a,t){}_rayCastLocal(a,t,i,o,r,e,_){return!1}getType(){return this._type}getVolume(){return this._volume}rayCast(a,t,i,o){var r,e,_,h,v,s,l=a;r=l.x,e=l.y,_=l.z;var x=t;h=x.x,v=x.y,s=x.z,r-=i._positionX,e-=i._positionY,_-=i._positionZ,h-=i._positionX,v-=i._positionY,s-=i._positionZ;var b,f,n;b=i._rotation00*r+i._rotation10*e+i._rotation20*_,f=i._rotation01*r+i._rotation11*e+i._rotation21*_,n=i._rotation02*r+i._rotation12*e+i._rotation22*_,r=b,e=f,_=n;var c,z,p;if(c=i._rotation00*h+i._rotation10*v+i._rotation20*s,z=i._rotation01*h+i._rotation11*v+i._rotation21*s,p=i._rotation02*h+i._rotation12*v+i._rotation22*s,h=c,v=z,s=p,this._rayCastLocal(r,e,_,h,v,s,o)){var y,V,M,I,k,X,L=o.position;y=L.x,V=L.y,M=L.z;var m=o.normal;I=m.x,k=m.y,X=m.z;var g,N,d;g=i._rotation00*y+i._rotation01*V+i._rotation02*M,N=i._rotation10*y+i._rotation11*V+i._rotation12*M,d=i._rotation20*y+i._rotation21*V+i._rotation22*M,y=g,V=N,M=d;var F,S,Y;F=i._rotation00*I+i._rotation01*k+i._rotation02*X,S=i._rotation10*I+i._rotation11*k+i._rotation12*X,Y=i._rotation20*I+i._rotation21*k+i._rotation22*X,I=F,k=S,X=Y,y+=i._positionX,V+=i._positionY,M+=i._positionZ;var Q=o.position;Q.x=y,Q.y=V,Q.z=M;var C=o.normal;return C.x=I,C.y=k,C.z=X,!0}return!1}};u.collision.geometry.ConvexGeometry=class extends u.collision.geometry.Geometry{constructor(a){super(a),this._gjkMargin=u.common.Setting.defaultGJKMargin,this._useGjkRayCast=!1}getGjkMergin(){return this._gjkMargin}setGjkMergin(a){a<0&&(a=0),this._gjkMargin=a}computeLocalSupportingVertex(a,t){}rayCast(a,t,i,o){return this._useGjkRayCast?u.collision.narrowphase.detector.gjkepa.GjkEpa.instance.rayCast(this,i,a,t,o):super.rayCast(a,t,i,o)}};u.collision.broadphase._BroadPhase||(u.collision.broadphase._BroadPhase={});u.collision.broadphase._BroadPhase.ConvexSweepGeometry=class extends u.collision.geometry.ConvexGeometry{constructor(){super(-1)}init(a,t,i){this.c=a;var o,r,e,_=i;o=_.x,r=_.y,e=_.z;var h,v,s,l,x,b;l=t._rotation00*o+t._rotation10*r+t._rotation20*e,x=t._rotation01*o+t._rotation11*r+t._rotation21*e,b=t._rotation02*o+t._rotation12*r+t._rotation22*e,h=l,v=x,s=b,this.localTranslation=new u.common.Vec3;var f=this.localTranslation;f.x=h,f.y=v,f.z=s,this._gjkMargin=a._gjkMargin}computeLocalSupportingVertex(a,t){this.c.computeLocalSupportingVertex(a,t);var i=this.localTranslation;if(a.x*i.x+a.y*i.y+a.z*i.z>0){var o=this.localTranslation,r=t.x+o.x,e=t.y+o.y,_=t.z+o.z;t.x=r,t.y=e,t.z=_}}};u.collision.broadphase._BroadPhase.AabbGeometry=class extends u.collision.geometry.ConvexGeometry{constructor(){super(-1),this.min=new u.common.Vec3,this.max=new u.common.Vec3}computeLocalSupportingVertex(a,t){t.x=a.x>0?this.max.x:this.min.x,t.y=a.y>0?this.max.y:this.min.y,t.z=a.z>0?this.max.z:this.min.z}};u.collision.broadphase.BroadPhaseProxyCallback=class{constructor(){}process(a){}};u.collision.broadphase.BroadPhaseType=class{};u.collision.broadphase.Proxy=class{constructor(a,t){this.userData=a,this._id=t,this._prev=null,this._next=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}getId(){return this._id}getFatAabb(){var a=new u.collision.geometry.Aabb;return a._minX=this._aabbMinX,a._minY=this._aabbMinY,a._minZ=this._aabbMinZ,a._maxX=this._aabbMaxX,a._maxY=this._aabbMaxY,a._maxZ=this._aabbMaxZ,a}getFatAabbTo(a){a._minX=this._aabbMinX,a._minY=this._aabbMinY,a._minZ=this._aabbMinZ,a._maxX=this._aabbMaxX,a._maxY=this._aabbMaxY,a._maxZ=this._aabbMaxZ}};u.collision.broadphase.ProxyPair=class{constructor(){this._p1=null,this._p2=null}getProxy1(){return this._p1}getProxy2(){return this._p2}getNext(){return this._next}};u.collision.broadphase.bruteforce||(u.collision.broadphase.bruteforce={});u.collision.broadphase.bruteforce.BruteForceBroadPhase=class extends u.collision.broadphase.BroadPhase{constructor(){super(1),this._incremental=!1}createProxy(a,t){var i=new u.collision.broadphase.Proxy(a,this._idCount++);return this._numProxies++,this._proxyList==null?(this._proxyList=i,this._proxyListLast=i):(this._proxyListLast._next=i,i._prev=this._proxyListLast,this._proxyListLast=i),i._aabbMinX=t._minX,i._aabbMinY=t._minY,i._aabbMinZ=t._minZ,i._aabbMaxX=t._maxX,i._aabbMaxY=t._maxY,i._aabbMaxZ=t._maxZ,i}destroyProxy(a){this._numProxies--;var t=a._prev,i=a._next;t!=null&&(t._next=i),i!=null&&(i._prev=t),a==this._proxyList&&(this._proxyList=this._proxyList._next),a==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),a._next=null,a._prev=null,a.userData=null}moveProxy(a,t,i){a._aabbMinX=t._minX,a._aabbMinY=t._minY,a._aabbMinZ=t._minZ,a._aabbMaxX=t._maxX,a._aabbMaxY=t._maxY,a._aabbMaxZ=t._maxZ}collectPairs(){var a=this._proxyPairList;if(a!=null){for(;a._p1=null,a._p2=null,a=a._next,a!=null;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}this._testCount=0;for(var t=this._proxyList;t!=null;){for(var i=t._next,o=t._next;o!=null;){var r=o._next;if(this._testCount++,t._aabbMinX<o._aabbMaxX&&t._aabbMaxX>o._aabbMinX&&t._aabbMinY<o._aabbMaxY&&t._aabbMaxY>o._aabbMinY&&t._aabbMinZ<o._aabbMaxZ&&t._aabbMaxZ>o._aabbMinZ){var e=this._proxyPairPool;e!=null?(this._proxyPairPool=e._next,e._next=null):e=new u.collision.broadphase.ProxyPair;var _=e;this._proxyPairList==null?this._proxyPairList=_:(_._next=this._proxyPairList,this._proxyPairList=_),_._p1=t,_._p2=o}o=r}t=i}}rayCast(a,t,i){var o,r,e,_,h,v,s=a;o=s.x,r=s.y,e=s.z;var l=t;_=l.x,h=l.y,v=l.z;for(var x=this._proxyList;x!=null;){var b=x._next,f=o,n=r,c=e,z=_,p=h,y=v,V=f<z?f:z,M=n<p?n:p,I=c<y?c:y,k=f>z?f:z,X=n>p?n:p,L=c>y?c:y,m=x._aabbMinX,g=x._aabbMinY,N=x._aabbMinZ,d=x._aabbMaxX,F=x._aabbMaxY,S=x._aabbMaxZ,Y;if(m>k||d<V||g>X||F<M||N>L||S<I)Y=!1;else{var Q=z-f,C=p-n,B=y-c,Z=Q<0?-Q:Q,$=C<0?-C:C,K=B<0?-B:B,E=(d-m)*.5,J=(F-g)*.5,A=(S-N)*.5,R=(d+m)*.5,U=(F+g)*.5,G=(S+N)*.5,D=f-R,H=n-U,j=c-G,ia,ea,W=H*B-j*C;if((W<0?-W:W)-(J*K+A*$)>0)ea=!0;else{var q=j*Q-D*B;ea=(q<0?-q:q)-(A*Z+E*K)>0}if(ea)ia=!0;else{var na=D*C-H*Q;ia=(na<0?-na:na)-(E*$+J*Z)>0}Y=!ia}Y&&i.process(x),x=b}}convexCast(a,t,i,o){for(var r=this._proxyList;r!=null;){var e=r._next,_=this._aabb.min;_.x=r._aabbMinX,_.y=r._aabbMinY,_.z=r._aabbMinZ;var h=this._aabb.max;h.x=r._aabbMaxX,h.y=r._aabbMaxY,h.z=r._aabbMaxZ,this._convexSweep.init(a,t,i);var v=u.collision.narrowphase.detector.gjkepa.GjkEpa.instance;v.computeClosestPointsImpl(this._convexSweep,this._aabb,t,this.identity,null,!1)==0&&v.distance<=0&&o.process(r),r=e}}aabbTest(a,t){for(var i=this._proxyList;i!=null;){var o=i._next;a._minX<i._aabbMaxX&&a._maxX>i._aabbMinX&&a._minY<i._aabbMaxY&&a._maxY>i._aabbMinY&&a._minZ<i._aabbMaxZ&&a._maxZ>i._aabbMinZ&&t.process(i),i=o}}};u.collision.broadphase.bvh||(u.collision.broadphase.bvh={});u.collision.broadphase.bvh.BvhBroadPhase=class extends u.collision.broadphase.BroadPhase{constructor(){super(2),this._incremental=!0,this._tree=new u.collision.broadphase.bvh.BvhTree;var a=new Array(1024);this.movedProxies=a,this.numMovedProxies=0}collide(a,t){this._testCount++;var i=a._height==0,o=t._height==0;if(a==t){if(i)return;this.collide(a._children[0],t),this.collide(a._children[1],t);return}if(a._aabbMinX<t._aabbMaxX&&a._aabbMaxX>t._aabbMinX&&a._aabbMinY<t._aabbMaxY&&a._aabbMaxY>t._aabbMinY&&a._aabbMinZ<t._aabbMaxZ&&a._aabbMaxZ>t._aabbMinZ){if(i&&o){var r=a._proxy,e=t._proxy,_=this._proxyPairPool;_!=null?(this._proxyPairPool=_._next,_._next=null):_=new u.collision.broadphase.ProxyPair;var h=_;this._proxyPairList==null?this._proxyPairList=h:(h._next=this._proxyPairList,this._proxyPairList=h),h._p1=r,h._p2=e;return}o||a._height>t._height?(this.collide(a._children[0],t),this.collide(a._children[1],t)):(this.collide(t._children[0],a),this.collide(t._children[1],a))}}rayCastRecursive(a,t,i,o,r,e,_,h){var v,s,l,x,b,f;v=t,s=i,l=o,x=r,b=e,f=_;var n=v,c=s,z=l,p=x,y=b,V=f,M=n<p?n:p,I=c<y?c:y,k=z<V?z:V,X=n>p?n:p,L=c>y?c:y,m=z>V?z:V,g=a._aabbMinX,N=a._aabbMinY,d=a._aabbMinZ,F=a._aabbMaxX,S=a._aabbMaxY,Y=a._aabbMaxZ,Q;if(g>X||F<M||N>L||S<I||d>m||Y<k)Q=!1;else{var C=p-n,B=y-c,Z=V-z,$=C<0?-C:C,K=B<0?-B:B,E=Z<0?-Z:Z,J=(F-g)*.5,A=(S-N)*.5,R=(Y-d)*.5,U=(F+g)*.5,G=(S+N)*.5,D=(Y+d)*.5,H=n-U,j=c-G,ia=z-D,ea,W,q=j*Z-ia*B;if((q<0?-q:q)-(A*E+R*K)>0)W=!0;else{var na=ia*C-H*Z;W=(na<0?-na:na)-(R*$+J*E)>0}if(W)ea=!0;else{var oa=H*B-j*C;ea=(oa<0?-oa:oa)-(J*K+A*$)>0}Q=!ea}if(Q){if(a._height==0){h.process(a._proxy);return}this.rayCastRecursive(a._children[0],v,s,l,x,b,f,h),this.rayCastRecursive(a._children[1],v,s,l,x,b,f,h)}}convexCastRecursive(a,t,i,o,r){var e=this._aabb.min;e.x=a._aabbMinX,e.y=a._aabbMinY,e.z=a._aabbMinZ;var _=this._aabb.max;_.x=a._aabbMaxX,_.y=a._aabbMaxY,_.z=a._aabbMaxZ,this._convexSweep.init(t,i,o);var h=u.collision.narrowphase.detector.gjkepa.GjkEpa.instance;if(h.computeClosestPointsImpl(this._convexSweep,this._aabb,i,this.identity,null,!1)==0&&h.distance<=0){if(a._height==0){r.process(a._proxy);return}this.convexCastRecursive(a._children[0],t,i,o,r),this.convexCastRecursive(a._children[1],t,i,o,r)}}aabbTestRecursive(a,t,i){if(a._aabbMinX<t._maxX&&a._aabbMaxX>t._minX&&a._aabbMinY<t._maxY&&a._aabbMaxY>t._minY&&a._aabbMinZ<t._maxZ&&a._aabbMaxZ>t._minZ){if(a._height==0){i.process(a._proxy);return}this.aabbTestRecursive(a._children[0],t,i),this.aabbTestRecursive(a._children[1],t,i)}}createProxy(a,t){var i=new u.collision.broadphase.bvh.BvhProxy(a,this._idCount++);this._numProxies++,this._proxyList==null?(this._proxyList=i,this._proxyListLast=i):(this._proxyListLast._next=i,i._prev=this._proxyListLast,this._proxyListLast=i),i._aabbMinX=t._minX,i._aabbMinY=t._minY,i._aabbMinZ=t._minZ,i._aabbMaxX=t._maxX,i._aabbMaxY=t._maxY,i._aabbMaxZ=t._maxZ;var o=u.common.Setting.bvhProxyPadding,r,e,_;r=o,e=o,_=o,i._aabbMinX-=r,i._aabbMinY-=e,i._aabbMinZ-=_,i._aabbMaxX+=r,i._aabbMaxY+=e,i._aabbMaxZ+=_;var h=this._tree,v=h._nodePool;v!=null?(h._nodePool=v._next,v._next=null):v=new u.collision.broadphase.bvh.BvhNode;var s=v;if(s._proxy=i,i._leaf=s,s._aabbMinX=i._aabbMinX,s._aabbMinY=i._aabbMinY,s._aabbMinZ=i._aabbMinZ,s._aabbMaxX=i._aabbMaxX,s._aabbMaxY=i._aabbMaxY,s._aabbMaxZ=i._aabbMaxZ,h._numLeaves++,h.leafList==null?(h.leafList=s,h.leafListLast=s):(h.leafListLast._nextLeaf=s,s._prevLeaf=h.leafListLast,h.leafListLast=s),h._root==null)h._root=s;else{for(var l=h._root;l._height>0;){var x=h._strategy._decideInsertion(l,s);if(x==-1)break;l=l._children[x]}var b=l._parent,f=h._nodePool;f!=null?(h._nodePool=f._next,f._next=null):f=new u.collision.broadphase.bvh.BvhNode;var n=f;if(b==null)h._root=n;else{var c=l._childIndex;b._children[c]=n,n._parent=b,n._childIndex=c}var z=l._childIndex;n._children[z]=l,l._parent=n,l._childIndex=z;var p=l._childIndex^1;for(n._children[p]=s,s._parent=n,s._childIndex=p;n!=null;){if(h._strategy._balancingEnabled){var y=n._height;if(y<2)n=n;else{var V=n._parent,M=n._children[0],I=n._children[1],k=M._height,X=I._height,L=k-X,m=n._childIndex;if(L>1){var g=M._children[0],N=M._children[1],d=g._height,F=N._height;if(d>F){M._children[1]=n,n._parent=M,n._childIndex=1,n._children[0]=N,N._parent=n,N._childIndex=0;var S=M._children[0],Y=M._children[1];M._aabbMinX=S._aabbMinX<Y._aabbMinX?S._aabbMinX:Y._aabbMinX,M._aabbMinY=S._aabbMinY<Y._aabbMinY?S._aabbMinY:Y._aabbMinY,M._aabbMinZ=S._aabbMinZ<Y._aabbMinZ?S._aabbMinZ:Y._aabbMinZ,M._aabbMaxX=S._aabbMaxX>Y._aabbMaxX?S._aabbMaxX:Y._aabbMaxX,M._aabbMaxY=S._aabbMaxY>Y._aabbMaxY?S._aabbMaxY:Y._aabbMaxY,M._aabbMaxZ=S._aabbMaxZ>Y._aabbMaxZ?S._aabbMaxZ:Y._aabbMaxZ;var Q=M._children[0]._height,C=M._children[1]._height;M._height=(Q>C?Q:C)+1;var B=n._children[0],Z=n._children[1];n._aabbMinX=B._aabbMinX<Z._aabbMinX?B._aabbMinX:Z._aabbMinX,n._aabbMinY=B._aabbMinY<Z._aabbMinY?B._aabbMinY:Z._aabbMinY,n._aabbMinZ=B._aabbMinZ<Z._aabbMinZ?B._aabbMinZ:Z._aabbMinZ,n._aabbMaxX=B._aabbMaxX>Z._aabbMaxX?B._aabbMaxX:Z._aabbMaxX,n._aabbMaxY=B._aabbMaxY>Z._aabbMaxY?B._aabbMaxY:Z._aabbMaxY,n._aabbMaxZ=B._aabbMaxZ>Z._aabbMaxZ?B._aabbMaxZ:Z._aabbMaxZ;var $=n._children[0]._height,K=n._children[1]._height;n._height=($>K?$:K)+1}else{M._children[0]=n,n._parent=M,n._childIndex=0,n._children[0]=g,g._parent=n,g._childIndex=0;var E=M._children[0],J=M._children[1];M._aabbMinX=E._aabbMinX<J._aabbMinX?E._aabbMinX:J._aabbMinX,M._aabbMinY=E._aabbMinY<J._aabbMinY?E._aabbMinY:J._aabbMinY,M._aabbMinZ=E._aabbMinZ<J._aabbMinZ?E._aabbMinZ:J._aabbMinZ,M._aabbMaxX=E._aabbMaxX>J._aabbMaxX?E._aabbMaxX:J._aabbMaxX,M._aabbMaxY=E._aabbMaxY>J._aabbMaxY?E._aabbMaxY:J._aabbMaxY,M._aabbMaxZ=E._aabbMaxZ>J._aabbMaxZ?E._aabbMaxZ:J._aabbMaxZ;var A=M._children[0]._height,R=M._children[1]._height;M._height=(A>R?A:R)+1;var U=n._children[0],G=n._children[1];n._aabbMinX=U._aabbMinX<G._aabbMinX?U._aabbMinX:G._aabbMinX,n._aabbMinY=U._aabbMinY<G._aabbMinY?U._aabbMinY:G._aabbMinY,n._aabbMinZ=U._aabbMinZ<G._aabbMinZ?U._aabbMinZ:G._aabbMinZ,n._aabbMaxX=U._aabbMaxX>G._aabbMaxX?U._aabbMaxX:G._aabbMaxX,n._aabbMaxY=U._aabbMaxY>G._aabbMaxY?U._aabbMaxY:G._aabbMaxY,n._aabbMaxZ=U._aabbMaxZ>G._aabbMaxZ?U._aabbMaxZ:G._aabbMaxZ;var D=n._children[0]._height,H=n._children[1]._height;n._height=(D>H?D:H)+1}V!=null?(V._children[m]=M,M._parent=V,M._childIndex=m):(h._root=M,M._parent=null),n=M}else if(L<-1){var j=I._children[0],ia=I._children[1],ea=j._height,W=ia._height;if(ea>W){I._children[1]=n,n._parent=I,n._childIndex=1,n._children[1]=ia,ia._parent=n,ia._childIndex=1;var q=I._children[0],na=I._children[1];I._aabbMinX=q._aabbMinX<na._aabbMinX?q._aabbMinX:na._aabbMinX,I._aabbMinY=q._aabbMinY<na._aabbMinY?q._aabbMinY:na._aabbMinY,I._aabbMinZ=q._aabbMinZ<na._aabbMinZ?q._aabbMinZ:na._aabbMinZ,I._aabbMaxX=q._aabbMaxX>na._aabbMaxX?q._aabbMaxX:na._aabbMaxX,I._aabbMaxY=q._aabbMaxY>na._aabbMaxY?q._aabbMaxY:na._aabbMaxY,I._aabbMaxZ=q._aabbMaxZ>na._aabbMaxZ?q._aabbMaxZ:na._aabbMaxZ;var oa=I._children[0]._height,aa=I._children[1]._height;I._height=(oa>aa?oa:aa)+1;var T=n._children[0],ca=n._children[1];n._aabbMinX=T._aabbMinX<ca._aabbMinX?T._aabbMinX:ca._aabbMinX,n._aabbMinY=T._aabbMinY<ca._aabbMinY?T._aabbMinY:ca._aabbMinY,n._aabbMinZ=T._aabbMinZ<ca._aabbMinZ?T._aabbMinZ:ca._aabbMinZ,n._aabbMaxX=T._aabbMaxX>ca._aabbMaxX?T._aabbMaxX:ca._aabbMaxX,n._aabbMaxY=T._aabbMaxY>ca._aabbMaxY?T._aabbMaxY:ca._aabbMaxY,n._aabbMaxZ=T._aabbMaxZ>ca._aabbMaxZ?T._aabbMaxZ:ca._aabbMaxZ;var _a=n._children[0]._height,w=n._children[1]._height;n._height=(_a>w?_a:w)+1}else{I._children[0]=n,n._parent=I,n._childIndex=0,n._children[1]=j,j._parent=n,j._childIndex=1;var ta=I._children[0],ra=I._children[1];I._aabbMinX=ta._aabbMinX<ra._aabbMinX?ta._aabbMinX:ra._aabbMinX,I._aabbMinY=ta._aabbMinY<ra._aabbMinY?ta._aabbMinY:ra._aabbMinY,I._aabbMinZ=ta._aabbMinZ<ra._aabbMinZ?ta._aabbMinZ:ra._aabbMinZ,I._aabbMaxX=ta._aabbMaxX>ra._aabbMaxX?ta._aabbMaxX:ra._aabbMaxX,I._aabbMaxY=ta._aabbMaxY>ra._aabbMaxY?ta._aabbMaxY:ra._aabbMaxY,I._aabbMaxZ=ta._aabbMaxZ>ra._aabbMaxZ?ta._aabbMaxZ:ra._aabbMaxZ;var la=I._children[0]._height,va=I._children[1]._height;I._height=(la>va?la:va)+1;var ua=n._children[0],za=n._children[1];n._aabbMinX=ua._aabbMinX<za._aabbMinX?ua._aabbMinX:za._aabbMinX,n._aabbMinY=ua._aabbMinY<za._aabbMinY?ua._aabbMinY:za._aabbMinY,n._aabbMinZ=ua._aabbMinZ<za._aabbMinZ?ua._aabbMinZ:za._aabbMinZ,n._aabbMaxX=ua._aabbMaxX>za._aabbMaxX?ua._aabbMaxX:za._aabbMaxX,n._aabbMaxY=ua._aabbMaxY>za._aabbMaxY?ua._aabbMaxY:za._aabbMaxY,n._aabbMaxZ=ua._aabbMaxZ>za._aabbMaxZ?ua._aabbMaxZ:za._aabbMaxZ;var Ma=n._children[0]._height,Xa=n._children[1]._height;n._height=(Ma>Xa?Ma:Xa)+1}V!=null?(V._children[m]=I,I._parent=V,I._childIndex=m):(h._root=I,I._parent=null),n=I}else n=n}}var Za=n._children[0]._height,fa=n._children[1]._height;n._height=(Za>fa?Za:fa)+1;var ba=n._children[0],sa=n._children[1];n._aabbMinX=ba._aabbMinX<sa._aabbMinX?ba._aabbMinX:sa._aabbMinX,n._aabbMinY=ba._aabbMinY<sa._aabbMinY?ba._aabbMinY:sa._aabbMinY,n._aabbMinZ=ba._aabbMinZ<sa._aabbMinZ?ba._aabbMinZ:sa._aabbMinZ,n._aabbMaxX=ba._aabbMaxX>sa._aabbMaxX?ba._aabbMaxX:sa._aabbMaxX,n._aabbMaxY=ba._aabbMaxY>sa._aabbMaxY?ba._aabbMaxY:sa._aabbMaxY,n._aabbMaxZ=ba._aabbMaxZ>sa._aabbMaxZ?ba._aabbMaxZ:sa._aabbMaxZ,n=n._parent}}if(!i._moved){if(i._moved=!0,this.movedProxies.length==this.numMovedProxies){for(var ha=this.numMovedProxies<<1,ma=new Array(ha),ya=ma,Ba=0,pa=this.numMovedProxies;Ba<pa;){var Ya=Ba++;ya[Ya]=this.movedProxies[Ya],this.movedProxies[Ya]=null}this.movedProxies=ya}this.movedProxies[this.numMovedProxies++]=i}return i}destroyProxy(a){this._numProxies--;var t=a._prev,i=a._next;t!=null&&(t._next=i),i!=null&&(i._prev=t),a==this._proxyList&&(this._proxyList=this._proxyList._next),a==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),a._next=null,a._prev=null;var o=a,r=this._tree,e=o._leaf;r._numLeaves--;var _=e._prevLeaf,h=e._nextLeaf;if(_!=null&&(_._nextLeaf=h),h!=null&&(h._prevLeaf=_),e==r.leafList&&(r.leafList=r.leafList._nextLeaf),e==r.leafListLast&&(r.leafListLast=r.leafListLast._prevLeaf),e._nextLeaf=null,e._prevLeaf=null,r._root==e)r._root=null;else{var v=e._parent,s=v._children[e._childIndex^1],l=v._parent;if(l==null)s._parent=null,s._childIndex=0,r._root=s,v._next=null,v._childIndex=0,v._children[0]=null,v._children[1]=null,v._childIndex=0,v._parent=null,v._height=0,v._proxy=null,v._next=r._nodePool,r._nodePool=v;else{s._parent=l;var x=v._childIndex;l._children[x]=s,s._parent=l,s._childIndex=x,v._next=null,v._childIndex=0,v._children[0]=null,v._children[1]=null,v._childIndex=0,v._parent=null,v._height=0,v._proxy=null,v._next=r._nodePool,r._nodePool=v;for(var b=l;b!=null;){if(r._strategy._balancingEnabled){var f=b._height;if(f<2)b=b;else{var n=b._parent,c=b._children[0],z=b._children[1],p=c._height,y=z._height,V=p-y,M=b._childIndex;if(V>1){var I=c._children[0],k=c._children[1],X=I._height,L=k._height;if(X>L){c._children[1]=b,b._parent=c,b._childIndex=1,b._children[0]=k,k._parent=b,k._childIndex=0;var m=c._children[0],g=c._children[1];c._aabbMinX=m._aabbMinX<g._aabbMinX?m._aabbMinX:g._aabbMinX,c._aabbMinY=m._aabbMinY<g._aabbMinY?m._aabbMinY:g._aabbMinY,c._aabbMinZ=m._aabbMinZ<g._aabbMinZ?m._aabbMinZ:g._aabbMinZ,c._aabbMaxX=m._aabbMaxX>g._aabbMaxX?m._aabbMaxX:g._aabbMaxX,c._aabbMaxY=m._aabbMaxY>g._aabbMaxY?m._aabbMaxY:g._aabbMaxY,c._aabbMaxZ=m._aabbMaxZ>g._aabbMaxZ?m._aabbMaxZ:g._aabbMaxZ;var N=c._children[0]._height,d=c._children[1]._height;c._height=(N>d?N:d)+1;var F=b._children[0],S=b._children[1];b._aabbMinX=F._aabbMinX<S._aabbMinX?F._aabbMinX:S._aabbMinX,b._aabbMinY=F._aabbMinY<S._aabbMinY?F._aabbMinY:S._aabbMinY,b._aabbMinZ=F._aabbMinZ<S._aabbMinZ?F._aabbMinZ:S._aabbMinZ,b._aabbMaxX=F._aabbMaxX>S._aabbMaxX?F._aabbMaxX:S._aabbMaxX,b._aabbMaxY=F._aabbMaxY>S._aabbMaxY?F._aabbMaxY:S._aabbMaxY,b._aabbMaxZ=F._aabbMaxZ>S._aabbMaxZ?F._aabbMaxZ:S._aabbMaxZ;var Y=b._children[0]._height,Q=b._children[1]._height;b._height=(Y>Q?Y:Q)+1}else{c._children[0]=b,b._parent=c,b._childIndex=0,b._children[0]=I,I._parent=b,I._childIndex=0;var C=c._children[0],B=c._children[1];c._aabbMinX=C._aabbMinX<B._aabbMinX?C._aabbMinX:B._aabbMinX,c._aabbMinY=C._aabbMinY<B._aabbMinY?C._aabbMinY:B._aabbMinY,c._aabbMinZ=C._aabbMinZ<B._aabbMinZ?C._aabbMinZ:B._aabbMinZ,c._aabbMaxX=C._aabbMaxX>B._aabbMaxX?C._aabbMaxX:B._aabbMaxX,c._aabbMaxY=C._aabbMaxY>B._aabbMaxY?C._aabbMaxY:B._aabbMaxY,c._aabbMaxZ=C._aabbMaxZ>B._aabbMaxZ?C._aabbMaxZ:B._aabbMaxZ;var Z=c._children[0]._height,$=c._children[1]._height;c._height=(Z>$?Z:$)+1;var K=b._children[0],E=b._children[1];b._aabbMinX=K._aabbMinX<E._aabbMinX?K._aabbMinX:E._aabbMinX,b._aabbMinY=K._aabbMinY<E._aabbMinY?K._aabbMinY:E._aabbMinY,b._aabbMinZ=K._aabbMinZ<E._aabbMinZ?K._aabbMinZ:E._aabbMinZ,b._aabbMaxX=K._aabbMaxX>E._aabbMaxX?K._aabbMaxX:E._aabbMaxX,b._aabbMaxY=K._aabbMaxY>E._aabbMaxY?K._aabbMaxY:E._aabbMaxY,b._aabbMaxZ=K._aabbMaxZ>E._aabbMaxZ?K._aabbMaxZ:E._aabbMaxZ;var J=b._children[0]._height,A=b._children[1]._height;b._height=(J>A?J:A)+1}n!=null?(n._children[M]=c,c._parent=n,c._childIndex=M):(r._root=c,c._parent=null),b=c}else if(V<-1){var R=z._children[0],U=z._children[1],G=R._height,D=U._height;if(G>D){z._children[1]=b,b._parent=z,b._childIndex=1,b._children[1]=U,U._parent=b,U._childIndex=1;var H=z._children[0],j=z._children[1];z._aabbMinX=H._aabbMinX<j._aabbMinX?H._aabbMinX:j._aabbMinX,z._aabbMinY=H._aabbMinY<j._aabbMinY?H._aabbMinY:j._aabbMinY,z._aabbMinZ=H._aabbMinZ<j._aabbMinZ?H._aabbMinZ:j._aabbMinZ,z._aabbMaxX=H._aabbMaxX>j._aabbMaxX?H._aabbMaxX:j._aabbMaxX,z._aabbMaxY=H._aabbMaxY>j._aabbMaxY?H._aabbMaxY:j._aabbMaxY,z._aabbMaxZ=H._aabbMaxZ>j._aabbMaxZ?H._aabbMaxZ:j._aabbMaxZ;var ia=z._children[0]._height,ea=z._children[1]._height;z._height=(ia>ea?ia:ea)+1;var W=b._children[0],q=b._children[1];b._aabbMinX=W._aabbMinX<q._aabbMinX?W._aabbMinX:q._aabbMinX,b._aabbMinY=W._aabbMinY<q._aabbMinY?W._aabbMinY:q._aabbMinY,b._aabbMinZ=W._aabbMinZ<q._aabbMinZ?W._aabbMinZ:q._aabbMinZ,b._aabbMaxX=W._aabbMaxX>q._aabbMaxX?W._aabbMaxX:q._aabbMaxX,b._aabbMaxY=W._aabbMaxY>q._aabbMaxY?W._aabbMaxY:q._aabbMaxY,b._aabbMaxZ=W._aabbMaxZ>q._aabbMaxZ?W._aabbMaxZ:q._aabbMaxZ;var na=b._children[0]._height,oa=b._children[1]._height;b._height=(na>oa?na:oa)+1}else{z._children[0]=b,b._parent=z,b._childIndex=0,b._children[1]=R,R._parent=b,R._childIndex=1;var aa=z._children[0],T=z._children[1];z._aabbMinX=aa._aabbMinX<T._aabbMinX?aa._aabbMinX:T._aabbMinX,z._aabbMinY=aa._aabbMinY<T._aabbMinY?aa._aabbMinY:T._aabbMinY,z._aabbMinZ=aa._aabbMinZ<T._aabbMinZ?aa._aabbMinZ:T._aabbMinZ,z._aabbMaxX=aa._aabbMaxX>T._aabbMaxX?aa._aabbMaxX:T._aabbMaxX,z._aabbMaxY=aa._aabbMaxY>T._aabbMaxY?aa._aabbMaxY:T._aabbMaxY,z._aabbMaxZ=aa._aabbMaxZ>T._aabbMaxZ?aa._aabbMaxZ:T._aabbMaxZ;var ca=z._children[0]._height,_a=z._children[1]._height;z._height=(ca>_a?ca:_a)+1;var w=b._children[0],ta=b._children[1];b._aabbMinX=w._aabbMinX<ta._aabbMinX?w._aabbMinX:ta._aabbMinX,b._aabbMinY=w._aabbMinY<ta._aabbMinY?w._aabbMinY:ta._aabbMinY,b._aabbMinZ=w._aabbMinZ<ta._aabbMinZ?w._aabbMinZ:ta._aabbMinZ,b._aabbMaxX=w._aabbMaxX>ta._aabbMaxX?w._aabbMaxX:ta._aabbMaxX,b._aabbMaxY=w._aabbMaxY>ta._aabbMaxY?w._aabbMaxY:ta._aabbMaxY,b._aabbMaxZ=w._aabbMaxZ>ta._aabbMaxZ?w._aabbMaxZ:ta._aabbMaxZ;var ra=b._children[0]._height,la=b._children[1]._height;b._height=(ra>la?ra:la)+1}n!=null?(n._children[M]=z,z._parent=n,z._childIndex=M):(r._root=z,z._parent=null),b=z}else b=b}}var va=b._children[0]._height,ua=b._children[1]._height;b._height=(va>ua?va:ua)+1;var za=b._children[0],Ma=b._children[1];b._aabbMinX=za._aabbMinX<Ma._aabbMinX?za._aabbMinX:Ma._aabbMinX,b._aabbMinY=za._aabbMinY<Ma._aabbMinY?za._aabbMinY:Ma._aabbMinY,b._aabbMinZ=za._aabbMinZ<Ma._aabbMinZ?za._aabbMinZ:Ma._aabbMinZ,b._aabbMaxX=za._aabbMaxX>Ma._aabbMaxX?za._aabbMaxX:Ma._aabbMaxX,b._aabbMaxY=za._aabbMaxY>Ma._aabbMaxY?za._aabbMaxY:Ma._aabbMaxY,b._aabbMaxZ=za._aabbMaxZ>Ma._aabbMaxZ?za._aabbMaxZ:Ma._aabbMaxZ,b=b._parent}}}o._leaf=null,e._next=null,e._childIndex=0,e._children[0]=null,e._children[1]=null,e._childIndex=0,e._parent=null,e._height=0,e._proxy=null,e._next=r._nodePool,r._nodePool=e,o.userData=null,o._next=null,o._prev=null,o._moved&&(o._moved=!1)}moveProxy(a,t,i){var o=a;if(!(o._aabbMinX<=t._minX&&o._aabbMaxX>=t._maxX&&o._aabbMinY<=t._minY&&o._aabbMaxY>=t._maxY&&o._aabbMinZ<=t._minZ&&o._aabbMaxZ>=t._maxZ)){o._aabbMinX=t._minX,o._aabbMinY=t._minY,o._aabbMinZ=t._minZ,o._aabbMaxX=t._maxX,o._aabbMaxY=t._maxY,o._aabbMaxZ=t._maxZ;var r=u.common.Setting.bvhProxyPadding,e,_,h;if(e=r,_=r,h=r,o._aabbMinX-=e,o._aabbMinY-=_,o._aabbMinZ-=h,o._aabbMaxX+=e,o._aabbMaxY+=_,o._aabbMaxZ+=h,i!=null){var v,s,l,x,b,f,n,c,z,p,y,V;x=0,b=0,f=0;var M=i;v=M.x,s=M.y,l=M.z,n=x<v?x:v,c=b<s?b:s,z=f<l?f:l,p=x>v?x:v,y=b>s?b:s,V=f>l?f:l,o._aabbMinX+=n,o._aabbMinY+=c,o._aabbMinZ+=z,o._aabbMaxX+=p,o._aabbMaxY+=y,o._aabbMaxZ+=V}if(!o._moved){if(o._moved=!0,this.movedProxies.length==this.numMovedProxies){for(var I=this.numMovedProxies<<1,k=new Array(I),X=k,L=0,m=this.numMovedProxies;L<m;){var g=L++;X[g]=this.movedProxies[g],this.movedProxies[g]=null}this.movedProxies=X}this.movedProxies[this.numMovedProxies++]=o}}}collectPairs(){var a=this._proxyPairList;if(a!=null){for(;a._p1=null,a._p2=null,a=a._next,a!=null;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}if(this._testCount=0,!(this._numProxies<2)){for(var t=this.numMovedProxies/this._numProxies<u.common.Setting.bvhIncrementalCollisionThreshold,i=0,o=this.numMovedProxies;i<o;){var r=i++,e=this.movedProxies[r];if(e._moved){var _=this._tree,h=e._leaf;_._numLeaves--;var v=h._prevLeaf,s=h._nextLeaf;if(v!=null&&(v._nextLeaf=s),s!=null&&(s._prevLeaf=v),h==_.leafList&&(_.leafList=_.leafList._nextLeaf),h==_.leafListLast&&(_.leafListLast=_.leafListLast._prevLeaf),h._nextLeaf=null,h._prevLeaf=null,_._root==h)_._root=null;else{var l=h._parent,x=l._children[h._childIndex^1],b=l._parent;if(b==null)x._parent=null,x._childIndex=0,_._root=x,l._next=null,l._childIndex=0,l._children[0]=null,l._children[1]=null,l._childIndex=0,l._parent=null,l._height=0,l._proxy=null,l._next=_._nodePool,_._nodePool=l;else{x._parent=b;var f=l._childIndex;b._children[f]=x,x._parent=b,x._childIndex=f,l._next=null,l._childIndex=0,l._children[0]=null,l._children[1]=null,l._childIndex=0,l._parent=null,l._height=0,l._proxy=null,l._next=_._nodePool,_._nodePool=l;for(var n=b;n!=null;){if(_._strategy._balancingEnabled){var c=n._height;if(c<2)n=n;else{var z=n._parent,p=n._children[0],y=n._children[1],V=p._height,M=y._height,I=V-M,k=n._childIndex;if(I>1){var X=p._children[0],L=p._children[1],m=X._height,g=L._height;if(m>g){p._children[1]=n,n._parent=p,n._childIndex=1,n._children[0]=L,L._parent=n,L._childIndex=0;var N=p._children[0],d=p._children[1];p._aabbMinX=N._aabbMinX<d._aabbMinX?N._aabbMinX:d._aabbMinX,p._aabbMinY=N._aabbMinY<d._aabbMinY?N._aabbMinY:d._aabbMinY,p._aabbMinZ=N._aabbMinZ<d._aabbMinZ?N._aabbMinZ:d._aabbMinZ,p._aabbMaxX=N._aabbMaxX>d._aabbMaxX?N._aabbMaxX:d._aabbMaxX,p._aabbMaxY=N._aabbMaxY>d._aabbMaxY?N._aabbMaxY:d._aabbMaxY,p._aabbMaxZ=N._aabbMaxZ>d._aabbMaxZ?N._aabbMaxZ:d._aabbMaxZ;var F=p._children[0]._height,S=p._children[1]._height;p._height=(F>S?F:S)+1;var Y=n._children[0],Q=n._children[1];n._aabbMinX=Y._aabbMinX<Q._aabbMinX?Y._aabbMinX:Q._aabbMinX,n._aabbMinY=Y._aabbMinY<Q._aabbMinY?Y._aabbMinY:Q._aabbMinY,n._aabbMinZ=Y._aabbMinZ<Q._aabbMinZ?Y._aabbMinZ:Q._aabbMinZ,n._aabbMaxX=Y._aabbMaxX>Q._aabbMaxX?Y._aabbMaxX:Q._aabbMaxX,n._aabbMaxY=Y._aabbMaxY>Q._aabbMaxY?Y._aabbMaxY:Q._aabbMaxY,n._aabbMaxZ=Y._aabbMaxZ>Q._aabbMaxZ?Y._aabbMaxZ:Q._aabbMaxZ;var C=n._children[0]._height,B=n._children[1]._height;n._height=(C>B?C:B)+1}else{p._children[0]=n,n._parent=p,n._childIndex=0,n._children[0]=X,X._parent=n,X._childIndex=0;var Z=p._children[0],$=p._children[1];p._aabbMinX=Z._aabbMinX<$._aabbMinX?Z._aabbMinX:$._aabbMinX,p._aabbMinY=Z._aabbMinY<$._aabbMinY?Z._aabbMinY:$._aabbMinY,p._aabbMinZ=Z._aabbMinZ<$._aabbMinZ?Z._aabbMinZ:$._aabbMinZ,p._aabbMaxX=Z._aabbMaxX>$._aabbMaxX?Z._aabbMaxX:$._aabbMaxX,p._aabbMaxY=Z._aabbMaxY>$._aabbMaxY?Z._aabbMaxY:$._aabbMaxY,p._aabbMaxZ=Z._aabbMaxZ>$._aabbMaxZ?Z._aabbMaxZ:$._aabbMaxZ;var K=p._children[0]._height,E=p._children[1]._height;p._height=(K>E?K:E)+1;var J=n._children[0],A=n._children[1];n._aabbMinX=J._aabbMinX<A._aabbMinX?J._aabbMinX:A._aabbMinX,n._aabbMinY=J._aabbMinY<A._aabbMinY?J._aabbMinY:A._aabbMinY,n._aabbMinZ=J._aabbMinZ<A._aabbMinZ?J._aabbMinZ:A._aabbMinZ,n._aabbMaxX=J._aabbMaxX>A._aabbMaxX?J._aabbMaxX:A._aabbMaxX,n._aabbMaxY=J._aabbMaxY>A._aabbMaxY?J._aabbMaxY:A._aabbMaxY,n._aabbMaxZ=J._aabbMaxZ>A._aabbMaxZ?J._aabbMaxZ:A._aabbMaxZ;var R=n._children[0]._height,U=n._children[1]._height;n._height=(R>U?R:U)+1}z!=null?(z._children[k]=p,p._parent=z,p._childIndex=k):(_._root=p,p._parent=null),n=p}else if(I<-1){var G=y._children[0],D=y._children[1],H=G._height,j=D._height;if(H>j){y._children[1]=n,n._parent=y,n._childIndex=1,n._children[1]=D,D._parent=n,D._childIndex=1;var ia=y._children[0],ea=y._children[1];y._aabbMinX=ia._aabbMinX<ea._aabbMinX?ia._aabbMinX:ea._aabbMinX,y._aabbMinY=ia._aabbMinY<ea._aabbMinY?ia._aabbMinY:ea._aabbMinY,y._aabbMinZ=ia._aabbMinZ<ea._aabbMinZ?ia._aabbMinZ:ea._aabbMinZ,y._aabbMaxX=ia._aabbMaxX>ea._aabbMaxX?ia._aabbMaxX:ea._aabbMaxX,y._aabbMaxY=ia._aabbMaxY>ea._aabbMaxY?ia._aabbMaxY:ea._aabbMaxY,y._aabbMaxZ=ia._aabbMaxZ>ea._aabbMaxZ?ia._aabbMaxZ:ea._aabbMaxZ;var W=y._children[0]._height,q=y._children[1]._height;y._height=(W>q?W:q)+1;var na=n._children[0],oa=n._children[1];n._aabbMinX=na._aabbMinX<oa._aabbMinX?na._aabbMinX:oa._aabbMinX,n._aabbMinY=na._aabbMinY<oa._aabbMinY?na._aabbMinY:oa._aabbMinY,n._aabbMinZ=na._aabbMinZ<oa._aabbMinZ?na._aabbMinZ:oa._aabbMinZ,n._aabbMaxX=na._aabbMaxX>oa._aabbMaxX?na._aabbMaxX:oa._aabbMaxX,n._aabbMaxY=na._aabbMaxY>oa._aabbMaxY?na._aabbMaxY:oa._aabbMaxY,n._aabbMaxZ=na._aabbMaxZ>oa._aabbMaxZ?na._aabbMaxZ:oa._aabbMaxZ;var aa=n._children[0]._height,T=n._children[1]._height;n._height=(aa>T?aa:T)+1}else{y._children[0]=n,n._parent=y,n._childIndex=0,n._children[1]=G,G._parent=n,G._childIndex=1;var ca=y._children[0],_a=y._children[1];y._aabbMinX=ca._aabbMinX<_a._aabbMinX?ca._aabbMinX:_a._aabbMinX,y._aabbMinY=ca._aabbMinY<_a._aabbMinY?ca._aabbMinY:_a._aabbMinY,y._aabbMinZ=ca._aabbMinZ<_a._aabbMinZ?ca._aabbMinZ:_a._aabbMinZ,y._aabbMaxX=ca._aabbMaxX>_a._aabbMaxX?ca._aabbMaxX:_a._aabbMaxX,y._aabbMaxY=ca._aabbMaxY>_a._aabbMaxY?ca._aabbMaxY:_a._aabbMaxY,y._aabbMaxZ=ca._aabbMaxZ>_a._aabbMaxZ?ca._aabbMaxZ:_a._aabbMaxZ;var w=y._children[0]._height,ta=y._children[1]._height;y._height=(w>ta?w:ta)+1;var ra=n._children[0],la=n._children[1];n._aabbMinX=ra._aabbMinX<la._aabbMinX?ra._aabbMinX:la._aabbMinX,n._aabbMinY=ra._aabbMinY<la._aabbMinY?ra._aabbMinY:la._aabbMinY,n._aabbMinZ=ra._aabbMinZ<la._aabbMinZ?ra._aabbMinZ:la._aabbMinZ,n._aabbMaxX=ra._aabbMaxX>la._aabbMaxX?ra._aabbMaxX:la._aabbMaxX,n._aabbMaxY=ra._aabbMaxY>la._aabbMaxY?ra._aabbMaxY:la._aabbMaxY,n._aabbMaxZ=ra._aabbMaxZ>la._aabbMaxZ?ra._aabbMaxZ:la._aabbMaxZ;var va=n._children[0]._height,ua=n._children[1]._height;n._height=(va>ua?va:ua)+1}z!=null?(z._children[k]=y,y._parent=z,y._childIndex=k):(_._root=y,y._parent=null),n=y}else n=n}}var za=n._children[0]._height,Ma=n._children[1]._height;n._height=(za>Ma?za:Ma)+1;var Xa=n._children[0],Za=n._children[1];n._aabbMinX=Xa._aabbMinX<Za._aabbMinX?Xa._aabbMinX:Za._aabbMinX,n._aabbMinY=Xa._aabbMinY<Za._aabbMinY?Xa._aabbMinY:Za._aabbMinY,n._aabbMinZ=Xa._aabbMinZ<Za._aabbMinZ?Xa._aabbMinZ:Za._aabbMinZ,n._aabbMaxX=Xa._aabbMaxX>Za._aabbMaxX?Xa._aabbMaxX:Za._aabbMaxX,n._aabbMaxY=Xa._aabbMaxY>Za._aabbMaxY?Xa._aabbMaxY:Za._aabbMaxY,n._aabbMaxZ=Xa._aabbMaxZ>Za._aabbMaxZ?Xa._aabbMaxZ:Za._aabbMaxZ,n=n._parent}}}e._leaf=null,h._next=null,h._childIndex=0,h._children[0]=null,h._children[1]=null,h._childIndex=0,h._parent=null,h._height=0,h._proxy=null,h._next=_._nodePool,_._nodePool=h;var fa=this._tree,ba=fa._nodePool;ba!=null?(fa._nodePool=ba._next,ba._next=null):ba=new u.collision.broadphase.bvh.BvhNode;var sa=ba;if(sa._proxy=e,e._leaf=sa,sa._aabbMinX=e._aabbMinX,sa._aabbMinY=e._aabbMinY,sa._aabbMinZ=e._aabbMinZ,sa._aabbMaxX=e._aabbMaxX,sa._aabbMaxY=e._aabbMaxY,sa._aabbMaxZ=e._aabbMaxZ,fa._numLeaves++,fa.leafList==null?(fa.leafList=sa,fa.leafListLast=sa):(fa.leafListLast._nextLeaf=sa,sa._prevLeaf=fa.leafListLast,fa.leafListLast=sa),fa._root==null)fa._root=sa;else{for(var ha=fa._root;ha._height>0;){var ma=fa._strategy._decideInsertion(ha,sa);if(ma==-1)break;ha=ha._children[ma]}var ya=ha._parent,Ba=fa._nodePool;Ba!=null?(fa._nodePool=Ba._next,Ba._next=null):Ba=new u.collision.broadphase.bvh.BvhNode;var pa=Ba;if(ya==null)fa._root=pa;else{var Ya=ha._childIndex;ya._children[Ya]=pa,pa._parent=ya,pa._childIndex=Ya}var Ra=ha._childIndex;pa._children[Ra]=ha,ha._parent=pa,ha._childIndex=Ra;var ga=ha._childIndex^1;for(pa._children[ga]=sa,sa._parent=pa,sa._childIndex=ga;pa!=null;){if(fa._strategy._balancingEnabled){var xa=pa._height;if(xa<2)pa=pa;else{var wa=pa._parent,ka=pa._children[0],Pa=pa._children[1],zt=ka._height,Oa=Pa._height,Aa=zt-Oa,nt=pa._childIndex;if(Aa>1){var Ea=ka._children[0],Fa=ka._children[1],da=Ea._height,ft=Fa._height;if(da>ft){ka._children[1]=pa,pa._parent=ka,pa._childIndex=1,pa._children[0]=Fa,Fa._parent=pa,Fa._childIndex=0;var Wa=ka._children[0],Ha=ka._children[1];ka._aabbMinX=Wa._aabbMinX<Ha._aabbMinX?Wa._aabbMinX:Ha._aabbMinX,ka._aabbMinY=Wa._aabbMinY<Ha._aabbMinY?Wa._aabbMinY:Ha._aabbMinY,ka._aabbMinZ=Wa._aabbMinZ<Ha._aabbMinZ?Wa._aabbMinZ:Ha._aabbMinZ,ka._aabbMaxX=Wa._aabbMaxX>Ha._aabbMaxX?Wa._aabbMaxX:Ha._aabbMaxX,ka._aabbMaxY=Wa._aabbMaxY>Ha._aabbMaxY?Wa._aabbMaxY:Ha._aabbMaxY,ka._aabbMaxZ=Wa._aabbMaxZ>Ha._aabbMaxZ?Wa._aabbMaxZ:Ha._aabbMaxZ;var bt=ka._children[0]._height,it=ka._children[1]._height;ka._height=(bt>it?bt:it)+1;var Ka=pa._children[0],_t=pa._children[1];pa._aabbMinX=Ka._aabbMinX<_t._aabbMinX?Ka._aabbMinX:_t._aabbMinX,pa._aabbMinY=Ka._aabbMinY<_t._aabbMinY?Ka._aabbMinY:_t._aabbMinY,pa._aabbMinZ=Ka._aabbMinZ<_t._aabbMinZ?Ka._aabbMinZ:_t._aabbMinZ,pa._aabbMaxX=Ka._aabbMaxX>_t._aabbMaxX?Ka._aabbMaxX:_t._aabbMaxX,pa._aabbMaxY=Ka._aabbMaxY>_t._aabbMaxY?Ka._aabbMaxY:_t._aabbMaxY,pa._aabbMaxZ=Ka._aabbMaxZ>_t._aabbMaxZ?Ka._aabbMaxZ:_t._aabbMaxZ;var gt=pa._children[0]._height,pt=pa._children[1]._height;pa._height=(gt>pt?gt:pt)+1}else{ka._children[0]=pa,pa._parent=ka,pa._childIndex=0,pa._children[0]=Ea,Ea._parent=pa,Ea._childIndex=0;var Ga=ka._children[0],rt=ka._children[1];ka._aabbMinX=Ga._aabbMinX<rt._aabbMinX?Ga._aabbMinX:rt._aabbMinX,ka._aabbMinY=Ga._aabbMinY<rt._aabbMinY?Ga._aabbMinY:rt._aabbMinY,ka._aabbMinZ=Ga._aabbMinZ<rt._aabbMinZ?Ga._aabbMinZ:rt._aabbMinZ,ka._aabbMaxX=Ga._aabbMaxX>rt._aabbMaxX?Ga._aabbMaxX:rt._aabbMaxX,ka._aabbMaxY=Ga._aabbMaxY>rt._aabbMaxY?Ga._aabbMaxY:rt._aabbMaxY,ka._aabbMaxZ=Ga._aabbMaxZ>rt._aabbMaxZ?Ga._aabbMaxZ:rt._aabbMaxZ;var xt=ka._children[0]._height,Da=ka._children[1]._height;ka._height=(xt>Da?xt:Da)+1;var Ta=pa._children[0],Na=pa._children[1];pa._aabbMinX=Ta._aabbMinX<Na._aabbMinX?Ta._aabbMinX:Na._aabbMinX,pa._aabbMinY=Ta._aabbMinY<Na._aabbMinY?Ta._aabbMinY:Na._aabbMinY,pa._aabbMinZ=Ta._aabbMinZ<Na._aabbMinZ?Ta._aabbMinZ:Na._aabbMinZ,pa._aabbMaxX=Ta._aabbMaxX>Na._aabbMaxX?Ta._aabbMaxX:Na._aabbMaxX,pa._aabbMaxY=Ta._aabbMaxY>Na._aabbMaxY?Ta._aabbMaxY:Na._aabbMaxY,pa._aabbMaxZ=Ta._aabbMaxZ>Na._aabbMaxZ?Ta._aabbMaxZ:Na._aabbMaxZ;var Vt=pa._children[0]._height,Pt=pa._children[1]._height;pa._height=(Vt>Pt?Vt:Pt)+1}wa!=null?(wa._children[nt]=ka,ka._parent=wa,ka._childIndex=nt):(fa._root=ka,ka._parent=null),pa=ka}else if(Aa<-1){var st=Pa._children[0],Xt=Pa._children[1],Yt=st._height,Mt=Xt._height;if(Yt>Mt){Pa._children[1]=pa,pa._parent=Pa,pa._childIndex=1,pa._children[1]=Xt,Xt._parent=pa,Xt._childIndex=1;var Ia=Pa._children[0],O=Pa._children[1];Pa._aabbMinX=Ia._aabbMinX<O._aabbMinX?Ia._aabbMinX:O._aabbMinX,Pa._aabbMinY=Ia._aabbMinY<O._aabbMinY?Ia._aabbMinY:O._aabbMinY,Pa._aabbMinZ=Ia._aabbMinZ<O._aabbMinZ?Ia._aabbMinZ:O._aabbMinZ,Pa._aabbMaxX=Ia._aabbMaxX>O._aabbMaxX?Ia._aabbMaxX:O._aabbMaxX,Pa._aabbMaxY=Ia._aabbMaxY>O._aabbMaxY?Ia._aabbMaxY:O._aabbMaxY,Pa._aabbMaxZ=Ia._aabbMaxZ>O._aabbMaxZ?Ia._aabbMaxZ:O._aabbMaxZ;var Va=Pa._children[0]._height,lt=Pa._children[1]._height;Pa._height=(Va>lt?Va:lt)+1;var P=pa._children[0],wt=pa._children[1];pa._aabbMinX=P._aabbMinX<wt._aabbMinX?P._aabbMinX:wt._aabbMinX,pa._aabbMinY=P._aabbMinY<wt._aabbMinY?P._aabbMinY:wt._aabbMinY,pa._aabbMinZ=P._aabbMinZ<wt._aabbMinZ?P._aabbMinZ:wt._aabbMinZ,pa._aabbMaxX=P._aabbMaxX>wt._aabbMaxX?P._aabbMaxX:wt._aabbMaxX,pa._aabbMaxY=P._aabbMaxY>wt._aabbMaxY?P._aabbMaxY:wt._aabbMaxY,pa._aabbMaxZ=P._aabbMaxZ>wt._aabbMaxZ?P._aabbMaxZ:wt._aabbMaxZ;var At=pa._children[0]._height,dt=pa._children[1]._height;pa._height=(At>dt?At:dt)+1}else{Pa._children[0]=pa,pa._parent=Pa,pa._childIndex=0,pa._children[1]=st,st._parent=pa,st._childIndex=1;var yt=Pa._children[0],kt=Pa._children[1];Pa._aabbMinX=yt._aabbMinX<kt._aabbMinX?yt._aabbMinX:kt._aabbMinX,Pa._aabbMinY=yt._aabbMinY<kt._aabbMinY?yt._aabbMinY:kt._aabbMinY,Pa._aabbMinZ=yt._aabbMinZ<kt._aabbMinZ?yt._aabbMinZ:kt._aabbMinZ,Pa._aabbMaxX=yt._aabbMaxX>kt._aabbMaxX?yt._aabbMaxX:kt._aabbMaxX,Pa._aabbMaxY=yt._aabbMaxY>kt._aabbMaxY?yt._aabbMaxY:kt._aabbMaxY,Pa._aabbMaxZ=yt._aabbMaxZ>kt._aabbMaxZ?yt._aabbMaxZ:kt._aabbMaxZ;var mt=Pa._children[0]._height,ht=Pa._children[1]._height;Pa._height=(mt>ht?mt:ht)+1;var ut=pa._children[0],Qa=pa._children[1];pa._aabbMinX=ut._aabbMinX<Qa._aabbMinX?ut._aabbMinX:Qa._aabbMinX,pa._aabbMinY=ut._aabbMinY<Qa._aabbMinY?ut._aabbMinY:Qa._aabbMinY,pa._aabbMinZ=ut._aabbMinZ<Qa._aabbMinZ?ut._aabbMinZ:Qa._aabbMinZ,pa._aabbMaxX=ut._aabbMaxX>Qa._aabbMaxX?ut._aabbMaxX:Qa._aabbMaxX,pa._aabbMaxY=ut._aabbMaxY>Qa._aabbMaxY?ut._aabbMaxY:Qa._aabbMaxY,pa._aabbMaxZ=ut._aabbMaxZ>Qa._aabbMaxZ?ut._aabbMaxZ:Qa._aabbMaxZ;var et=pa._children[0]._height,Ca=pa._children[1]._height;pa._height=(et>Ca?et:Ca)+1}wa!=null?(wa._children[nt]=Pa,Pa._parent=wa,Pa._childIndex=nt):(fa._root=Pa,Pa._parent=null),pa=Pa}else pa=pa}}var vt=pa._children[0]._height,qa=pa._children[1]._height;pa._height=(vt>qa?vt:qa)+1;var at=pa._children[0],Ua=pa._children[1];pa._aabbMinX=at._aabbMinX<Ua._aabbMinX?at._aabbMinX:Ua._aabbMinX,pa._aabbMinY=at._aabbMinY<Ua._aabbMinY?at._aabbMinY:Ua._aabbMinY,pa._aabbMinZ=at._aabbMinZ<Ua._aabbMinZ?at._aabbMinZ:Ua._aabbMinZ,pa._aabbMaxX=at._aabbMaxX>Ua._aabbMaxX?at._aabbMaxX:Ua._aabbMaxX,pa._aabbMaxY=at._aabbMaxY>Ua._aabbMaxY?at._aabbMaxY:Ua._aabbMaxY,pa._aabbMaxZ=at._aabbMaxZ>Ua._aabbMaxZ?at._aabbMaxZ:Ua._aabbMaxZ,pa=pa._parent}}t&&this.collide(this._tree._root,e._leaf),e._moved=!1}this.movedProxies[r]=null}t||this.collide(this._tree._root,this._tree._root),this.numMovedProxies=0}}rayCast(a,t,i){if(this._tree._root!=null){var o,r,e,_,h,v,s=a;o=s.x,r=s.y,e=s.z;var l=t;_=l.x,h=l.y,v=l.z,this.rayCastRecursive(this._tree._root,o,r,e,_,h,v,i)}}convexCast(a,t,i,o){this._tree._root!=null&&this.convexCastRecursive(this._tree._root,a,t,i,o)}aabbTest(a,t){this._tree._root!=null&&this.aabbTestRecursive(this._tree._root,a,t)}getTreeBalance(){return this._tree._getBalance()}};u.collision.broadphase.bvh.BvhInsertionStrategy=class{};u.collision.broadphase.bvh.BvhNode=class{constructor(){this._next=null,this._prevLeaf=null,this._nextLeaf=null;var a=new Array(2);this._children=a,this._childIndex=0,this._parent=null,this._height=0,this._proxy=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}};u.collision.broadphase.bvh.BvhProxy=class extends u.collision.broadphase.Proxy{constructor(a,t){super(a,t),this._leaf=null,this._moved=!1}};u.collision.broadphase.bvh.BvhStrategy=class{constructor(){this._insertionStrategy=0,this._balancingEnabled=!1}_decideInsertion(a,t){switch(this._insertionStrategy){case 0:var i,o,r;i=t._aabbMinX+t._aabbMaxX,o=t._aabbMinY+t._aabbMaxY,r=t._aabbMinZ+t._aabbMaxZ;var e=a._children[0],_=a._children[1],h,v,s,l,x,b;h=e._aabbMinX+e._aabbMaxX,v=e._aabbMinY+e._aabbMaxY,s=e._aabbMinZ+e._aabbMaxZ,l=_._aabbMinX+_._aabbMaxX,x=_._aabbMinY+_._aabbMaxY,b=_._aabbMinZ+_._aabbMaxZ,h-=i,v-=o,s-=r,l-=i,x-=o,b-=r;var f=h*h+v*v+s*s,n=l*l+x*x+b*b;return f<n?0:1;case 1:var c=a._children[0],z=a._children[1],p=a._aabbMaxX-a._aabbMinX,y=a._aabbMaxY-a._aabbMinY,V=a._aabbMaxZ-a._aabbMinZ,M=(p*(y+V)+y*V)*2,I,k,X,L,m,g;I=a._aabbMinX<t._aabbMinX?a._aabbMinX:t._aabbMinX,k=a._aabbMinY<t._aabbMinY?a._aabbMinY:t._aabbMinY,X=a._aabbMinZ<t._aabbMinZ?a._aabbMinZ:t._aabbMinZ,L=a._aabbMaxX>t._aabbMaxX?a._aabbMaxX:t._aabbMaxX,m=a._aabbMaxY>t._aabbMaxY?a._aabbMaxY:t._aabbMaxY,g=a._aabbMaxZ>t._aabbMaxZ?a._aabbMaxZ:t._aabbMaxZ;var N=L-I,d=m-k,F=g-X,S=(N*(d+F)+d*F)*2,Y=S*2,Q=(S-M)*2,C=Q;if(I=c._aabbMinX<t._aabbMinX?c._aabbMinX:t._aabbMinX,k=c._aabbMinY<t._aabbMinY?c._aabbMinY:t._aabbMinY,X=c._aabbMinZ<t._aabbMinZ?c._aabbMinZ:t._aabbMinZ,L=c._aabbMaxX>t._aabbMaxX?c._aabbMaxX:t._aabbMaxX,m=c._aabbMaxY>t._aabbMaxY?c._aabbMaxY:t._aabbMaxY,g=c._aabbMaxZ>t._aabbMaxZ?c._aabbMaxZ:t._aabbMaxZ,c._height==0){var B=L-I,Z=m-k,$=g-X;C+=(B*(Z+$)+Z*$)*2}else{var K=L-I,E=m-k,J=g-X,A=c._aabbMaxX-c._aabbMinX,R=c._aabbMaxY-c._aabbMinY,U=c._aabbMaxZ-c._aabbMinZ;C+=(K*(E+J)+E*J)*2-(A*(R+U)+R*U)*2}var G=Q;if(I=z._aabbMinX<t._aabbMinX?z._aabbMinX:t._aabbMinX,k=z._aabbMinY<t._aabbMinY?z._aabbMinY:t._aabbMinY,X=z._aabbMinZ<t._aabbMinZ?z._aabbMinZ:t._aabbMinZ,L=z._aabbMaxX>t._aabbMaxX?z._aabbMaxX:t._aabbMaxX,m=z._aabbMaxY>t._aabbMaxY?z._aabbMaxY:t._aabbMaxY,g=z._aabbMaxZ>t._aabbMaxZ?z._aabbMaxZ:t._aabbMaxZ,z._height==0){var D=L-I,H=m-k,j=g-X;G+=(D*(H+j)+H*j)*2}else{var ia=L-I,ea=m-k,W=g-X,q=z._aabbMaxX-z._aabbMinX,na=z._aabbMaxY-z._aabbMinY,oa=z._aabbMaxZ-z._aabbMinZ;G+=(ia*(ea+W)+ea*W)*2-(q*(na+oa)+na*oa)*2}return Y<C?Y<G?-1:1:C<G?0:1;default:return console.log("src/oimo/collision/broadphase/bvh/BvhStrategy.hx:37:","invalid BVH insertion strategy: "+this._insertionStrategy),-1}}_splitLeaves(a,t,i){var o=1/(i-t),r,e,_;r=0,e=0,_=0;for(var h=t,v=i;h<v;){var s=h++,l=a[s];l._tmpX=l._aabbMaxX+l._aabbMinX,l._tmpY=l._aabbMaxY+l._aabbMinY,l._tmpZ=l._aabbMaxZ+l._aabbMinZ,r+=l._tmpX,e+=l._tmpY,_+=l._tmpZ}r*=o,e*=o,_*=o;var x,b,f;x=0,b=0,f=0;for(var n=t,c=i;n<c;){var z=n++,p=a[z],y,V,M;y=p._tmpX-r,V=p._tmpY-e,M=p._tmpZ-_,y*=y,V*=V,M*=M,x+=y,b+=V,f+=M}var I=x,k=b,X=f,L=t,m=i-1;if(I>k)if(I>X)for(var g=r;;){for(;;){var N=a[L];if(N._tmpX<=g)break;++L}for(;;){var d=a[m];if(d._tmpX>=g)break;--m}if(L>=m)break;var F=a[L];a[L]=a[m],a[m]=F,++L,--m}else for(var S=_;;){for(;;){var Y=a[L];if(Y._tmpZ<=S)break;++L}for(;;){var Q=a[m];if(Q._tmpZ>=S)break;--m}if(L>=m)break;var C=a[L];a[L]=a[m],a[m]=C,++L,--m}else if(k>X)for(var B=e;;){for(;;){var Z=a[L];if(Z._tmpY<=B)break;++L}for(;;){var $=a[m];if($._tmpY>=B)break;--m}if(L>=m)break;var K=a[L];a[L]=a[m],a[m]=K,++L,--m}else for(var E=_;;){for(;;){var J=a[L];if(J._tmpZ<=E)break;++L}for(;;){var A=a[m];if(A._tmpZ>=E)break;--m}if(L>=m)break;var R=a[L];a[L]=a[m],a[m]=R,++L,--m}return L}};u.collision.broadphase.bvh.BvhTree=class{constructor(){this._root=null,this._numLeaves=0,this._strategy=new u.collision.broadphase.bvh.BvhStrategy,this._nodePool=null,this.leafList=null,this.leafListLast=null;var a=new Array(1024);this.tmp=a}_print(a,t){if(t==null&&(t=""),a!=null)if(a._height==0)console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:39:",t+a._proxy._id);else{this._print(a._children[0],t+"  ");var i,o,r,e;o=a._aabbMaxX-a._aabbMinX,r=a._aabbMaxY-a._aabbMinY,e=a._aabbMaxZ-a._aabbMinZ;var _=o,h=r,v=e;if(_*(h+v)+h*v>0){var s,l,x;s=a._aabbMaxX-a._aabbMinX,l=a._aabbMaxY-a._aabbMinY,x=a._aabbMaxZ-a._aabbMinZ;var b=s,f=l,n=x;i=((b*(f+n)+f*n)*1e3+.5|0)/1e3}else{var c,z,p;c=a._aabbMaxX-a._aabbMinX,z=a._aabbMaxY-a._aabbMinY,p=a._aabbMaxZ-a._aabbMinZ;var y=c,V=z,M=p;i=((y*(V+M)+V*M)*1e3-.5|0)/1e3}console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:42:",t+"#"+a._height+", "+i),this._print(a._children[1],t+"  ")}}_getBalance(){return this.getBalanceRecursive(this._root)}deleteRecursive(a){if(a._height==0){var t=a._prevLeaf,i=a._nextLeaf;t!=null&&(t._nextLeaf=i),i!=null&&(i._prevLeaf=t),a==this.leafList&&(this.leafList=this.leafList._nextLeaf),a==this.leafListLast&&(this.leafListLast=this.leafListLast._prevLeaf),a._nextLeaf=null,a._prevLeaf=null,a._proxy._leaf=null,a._next=null,a._childIndex=0,a._children[0]=null,a._children[1]=null,a._childIndex=0,a._parent=null,a._height=0,a._proxy=null,a._next=this._nodePool,this._nodePool=a;return}this.deleteRecursive(a._children[0]),this.deleteRecursive(a._children[1]),a._next=null,a._childIndex=0,a._children[0]=null,a._children[1]=null,a._childIndex=0,a._parent=null,a._height=0,a._proxy=null,a._next=this._nodePool,this._nodePool=a}decomposeRecursive(a){if(a._height==0){a._childIndex=0,a._parent=null;return}this.decomposeRecursive(a._children[0]),this.decomposeRecursive(a._children[1]),a._next=null,a._childIndex=0,a._children[0]=null,a._children[1]=null,a._childIndex=0,a._parent=null,a._height=0,a._proxy=null,a._next=this._nodePool,this._nodePool=a}buildTopDownRecursive(a,t,i){var o=i-t;if(o==1){var r=a[t],e=r._proxy;return r._aabbMinX=e._aabbMinX,r._aabbMinY=e._aabbMinY,r._aabbMinZ=e._aabbMinZ,r._aabbMaxX=e._aabbMaxX,r._aabbMaxY=e._aabbMaxY,r._aabbMaxZ=e._aabbMaxZ,r}var _=this._strategy._splitLeaves(a,t,i),h=this.buildTopDownRecursive(a,t,_),v=this.buildTopDownRecursive(a,_,i),s=this._nodePool;s!=null?(this._nodePool=s._next,s._next=null):s=new u.collision.broadphase.bvh.BvhNode;var l=s;l._children[0]=h,h._parent=l,h._childIndex=0,l._children[1]=v,v._parent=l,v._childIndex=1;var x=l._children[0],b=l._children[1];l._aabbMinX=x._aabbMinX<b._aabbMinX?x._aabbMinX:b._aabbMinX,l._aabbMinY=x._aabbMinY<b._aabbMinY?x._aabbMinY:b._aabbMinY,l._aabbMinZ=x._aabbMinZ<b._aabbMinZ?x._aabbMinZ:b._aabbMinZ,l._aabbMaxX=x._aabbMaxX>b._aabbMaxX?x._aabbMaxX:b._aabbMaxX,l._aabbMaxY=x._aabbMaxY>b._aabbMaxY?x._aabbMaxY:b._aabbMaxY,l._aabbMaxZ=x._aabbMaxZ>b._aabbMaxZ?x._aabbMaxZ:b._aabbMaxZ;var f=l._children[0]._height,n=l._children[1]._height;return l._height=(f>n?f:n)+1,l}getBalanceRecursive(a){if(a==null||a._height==0)return 0;var t=a._children[0]._height-a._children[1]._height;return t<0&&(t=-t),t+this.getBalanceRecursive(a._children[0])+this.getBalanceRecursive(a._children[1])}};u.collision.geometry.Aabb=class{constructor(){this._minX=0,this._minY=0,this._minZ=0,this._maxX=0,this._maxY=0,this._maxZ=0}init(a,t){var i=a;this._minX=i.x,this._minY=i.y,this._minZ=i.z;var o=t;return this._maxX=o.x,this._maxY=o.y,this._maxZ=o.z,this}getMin(){var a=new u.common.Vec3,t=a;return t.x=this._minX,t.y=this._minY,t.z=this._minZ,a}getMinTo(a){var t=a;t.x=this._minX,t.y=this._minY,t.z=this._minZ}setMin(a){var t=a;return this._minX=t.x,this._minY=t.y,this._minZ=t.z,this}getMax(){var a=new u.common.Vec3,t=a;return t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ,a}getMaxTo(a){var t=a;t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ}setMax(a){var t=a;return this._maxX=t.x,this._maxY=t.y,this._maxZ=t.z,this}getCenter(){var a=new u.common.Vec3,t,i,o;t=this._minX+this._maxX,i=this._minY+this._maxY,o=this._minZ+this._maxZ,t*=.5,i*=.5,o*=.5;var r=a;return r.x=t,r.y=i,r.z=o,a}getCenterTo(a){var t,i,o;t=this._minX+this._maxX,i=this._minY+this._maxY,o=this._minZ+this._maxZ,t*=.5,i*=.5,o*=.5;var r=a;r.x=t,r.y=i,r.z=o}getExtents(){var a=new u.common.Vec3,t,i,o;t=this._maxX-this._minX,i=this._maxY-this._minY,o=this._maxZ-this._minZ,t*=.5,i*=.5,o*=.5;var r=a;return r.x=t,r.y=i,r.z=o,a}getExtentsTo(a){var t,i,o;t=this._maxX-this._minX,i=this._maxY-this._minY,o=this._maxZ-this._minZ,t*=.5,i*=.5,o*=.5;var r=a;r.x=t,r.y=i,r.z=o}combine(a){return this._minX=this._minX<a._minX?this._minX:a._minX,this._minY=this._minY<a._minY?this._minY:a._minY,this._minZ=this._minZ<a._minZ?this._minZ:a._minZ,this._maxX=this._maxX>a._maxX?this._maxX:a._maxX,this._maxY=this._maxY>a._maxY?this._maxY:a._maxY,this._maxZ=this._maxZ>a._maxZ?this._maxZ:a._maxZ,this}combined(a){var t=new u.collision.geometry.Aabb;return t._minX=this._minX<a._minX?this._minX:a._minX,t._minY=this._minY<a._minY?this._minY:a._minY,t._minZ=this._minZ<a._minZ?this._minZ:a._minZ,t._maxX=this._maxX>a._maxX?this._maxX:a._maxX,t._maxY=this._maxY>a._maxY?this._maxY:a._maxY,t._maxZ=this._maxZ>a._maxZ?this._maxZ:a._maxZ,t}overlap(a){return this._minX<a._maxX&&this._maxX>a._minX&&this._minY<a._maxY&&this._maxY>a._minY&&this._minZ<a._maxZ?this._maxZ>a._minZ:!1}getIntersection(a){var t=new u.collision.geometry.Aabb;return t._minX=this._minX>a._minX?this._minX:a._minX,t._minY=this._minY>a._minY?this._minY:a._minY,t._minZ=this._minZ>a._minZ?this._minZ:a._minZ,t._maxX=this._maxX<a._maxX?this._maxX:a._maxX,t._maxY=this._maxY<a._maxY?this._maxY:a._maxY,t._maxZ=this._maxZ<a._maxZ?this._maxZ:a._maxZ,t}getIntersectionTo(a,t){t._minX=this._minX>a._minX?this._minX:a._minX,t._minY=this._minY>a._minY?this._minY:a._minY,t._minZ=this._minZ>a._minZ?this._minZ:a._minZ,t._maxX=this._maxX<a._maxX?this._maxX:a._maxX,t._maxY=this._maxY<a._maxY?this._maxY:a._maxY,t._maxZ=this._maxZ<a._maxZ?this._maxZ:a._maxZ}copyFrom(a){return this._minX=a._minX,this._minY=a._minY,this._minZ=a._minZ,this._maxX=a._maxX,this._maxY=a._maxY,this._maxZ=a._maxZ,this}clone(){var a=new u.collision.geometry.Aabb;return a._minX=this._minX,a._minY=this._minY,a._minZ=this._minZ,a._maxX=this._maxX,a._maxY=this._maxY,a._maxZ=this._maxZ,a}};u.collision.geometry.BoxGeometry=class extends u.collision.geometry.ConvexGeometry{constructor(a){super(1);var t=a;this._halfExtentsX=t.x,this._halfExtentsY=t.y,this._halfExtentsZ=t.z,this._halfAxisXX=a.x,this._halfAxisXY=0,this._halfAxisXZ=0,this._halfAxisYX=0,this._halfAxisYY=a.y,this._halfAxisYZ=0,this._halfAxisZX=0,this._halfAxisZY=0,this._halfAxisZZ=a.z,this._updateMass();var i=a.x<a.y?a.z<a.x?a.z:a.x:a.z<a.y?a.z:a.y;this._gjkMargin>i*.2&&(this._gjkMargin=i*.2)}getHalfExtents(){var a=new u.common.Vec3,t=a;return t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ,a}getHalfExtentsTo(a){var t=a;t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ}_updateMass(){this._volume=8*(this._halfExtentsX*this._halfExtentsY*this._halfExtentsZ);var a,t,i;a=this._halfExtentsX*this._halfExtentsX,t=this._halfExtentsY*this._halfExtentsY,i=this._halfExtentsZ*this._halfExtentsZ,this._inertiaCoeff00=.3333333333333333*(t+i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(i+a),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(a+t)}_computeAabb(a,t){var i,o,r,e,_,h,v,s,l,x,b,f;x=t._rotation00*this._halfAxisXX+t._rotation01*this._halfAxisXY+t._rotation02*this._halfAxisXZ,b=t._rotation10*this._halfAxisXX+t._rotation11*this._halfAxisXY+t._rotation12*this._halfAxisXZ,f=t._rotation20*this._halfAxisXX+t._rotation21*this._halfAxisXY+t._rotation22*this._halfAxisXZ,i=x,o=b,r=f;var n,c,z;n=t._rotation00*this._halfAxisYX+t._rotation01*this._halfAxisYY+t._rotation02*this._halfAxisYZ,c=t._rotation10*this._halfAxisYX+t._rotation11*this._halfAxisYY+t._rotation12*this._halfAxisYZ,z=t._rotation20*this._halfAxisYX+t._rotation21*this._halfAxisYY+t._rotation22*this._halfAxisYZ,e=n,_=c,h=z;var p,y,V;p=t._rotation00*this._halfAxisZX+t._rotation01*this._halfAxisZY+t._rotation02*this._halfAxisZZ,y=t._rotation10*this._halfAxisZX+t._rotation11*this._halfAxisZY+t._rotation12*this._halfAxisZZ,V=t._rotation20*this._halfAxisZX+t._rotation21*this._halfAxisZY+t._rotation22*this._halfAxisZZ,v=p,s=y,l=V,i=i<0?-i:i,o=o<0?-o:o,r=r<0?-r:r,e=e<0?-e:e,_=_<0?-_:_,h=h<0?-h:h,v=v<0?-v:v,s=s<0?-s:s,l=l<0?-l:l;var M,I,k;M=i+e,I=o+_,k=r+h,M+=v,I+=s,k+=l,a._minX=t._positionX-M,a._minY=t._positionY-I,a._minZ=t._positionZ-k,a._maxX=t._positionX+M,a._maxY=t._positionY+I,a._maxZ=t._positionZ+k}computeLocalSupportingVertex(a,t){var i,o,r,e,_,h;i=this._gjkMargin,o=this._gjkMargin,r=this._gjkMargin,i=i<this._halfExtentsX?i:this._halfExtentsX,o=o<this._halfExtentsY?o:this._halfExtentsY,r=r<this._halfExtentsZ?r:this._halfExtentsZ,e=this._halfExtentsX-i,_=this._halfExtentsY-o,h=this._halfExtentsZ-r,t.x=a.x>0?e:-e,t.y=a.y>0?_:-_,t.z=a.z>0?h:-h}_rayCastLocal(a,t,i,o,r,e,_){var h=a,v=t,s=i,l=o,x=r,b=e,f=this._halfExtentsX,n=this._halfExtentsY,c=this._halfExtentsZ,z=l-h,p=x-v,y=b-s,V=0,M=0,I=0,k=1,X=1,L=1;if(z>-1e-6&&z<1e-6){if(h<=-f||h>=f)return!1}else{var m=1/z,g=(-f-h)*m,N=(f-h)*m;if(g>N){var d=g;g=N,N=d}g>0&&(V=g),N<1&&(k=N)}if(p>-1e-6&&p<1e-6){if(v<=-n||v>=n)return!1}else{var F=1/p,S=(-n-v)*F,Y=(n-v)*F;if(S>Y){var Q=S;S=Y,Y=Q}S>0&&(M=S),Y<1&&(X=Y)}if(y>-1e-6&&y<1e-6){if(s<=-c||s>=c)return!1}else{var C=1/y,B=(-c-s)*C,Z=(c-s)*C;if(B>Z){var $=B;B=Z,Z=$}B>0&&(I=B),Z<1&&(L=Z)}if(V>=1||M>=1||I>=1||k<=0||X<=0||L<=0)return!1;var K=V,E=k,J=0;if(M>K&&(K=M,J=1),I>K&&(K=I,J=2),X<E&&(E=X),L<E&&(E=L),K>E||K==0)return!1;switch(J){case 0:_.normal.init(z>0?-1:1,0,0);break;case 1:_.normal.init(0,p>0?-1:1,0);break;case 2:_.normal.init(0,0,y>0?-1:1);break}return _.position.init(h+K*z,v+K*p,s+K*y),_.fraction=K,!0}};u.collision.geometry.CapsuleGeometry=class extends u.collision.geometry.ConvexGeometry{constructor(a,t){super(4),this._radius=a,this._halfHeight=t,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){var a=this._radius*this._radius,t=this._halfHeight*this._halfHeight,i=6.28318530717958*a*this._halfHeight,o=3.14159265358979*a*this._radius*4/3;this._volume=i+o;var r=this._volume==0?0:1/this._volume,e=r*(i*a*.5+o*a*.4),_=r*(i*(a*.25+t/3)+o*(a*.4+this._halfHeight*this._radius*.75+t));this._inertiaCoeff00=_,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=e,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=_}_computeAabb(a,t){var i,o,r;i=this._radius,o=this._radius,r=this._radius;var e,_,h;e=t._rotation01,_=t._rotation11,h=t._rotation21,e=e<0?-e:e,_=_<0?-_:_,h=h<0?-h:h,e*=this._halfHeight,_*=this._halfHeight,h*=this._halfHeight,i+=e,o+=_,r+=h,a._minX=t._positionX-i,a._minY=t._positionY-o,a._minZ=t._positionZ-r,a._maxX=t._positionX+i,a._maxY=t._positionY+o,a._maxZ=t._positionZ+r}computeLocalSupportingVertex(a,t){a.y>0?t.init(0,this._halfHeight,0):t.init(0,-this._halfHeight,0)}_rayCastLocal(a,t,i,o,r,e,_){var h=a,v=t,s=i,l=o,x=r,b=e,f=this._halfHeight,n=l-h,c=x-v,z=b-s,p=0,y=1,V=n*n+z*z,M=h*n+s*z,I=h*h+s*s-this._radius*this._radius,k=M*M-V*I;if(k<0)return!1;if(V>0){var X=Math.sqrt(k);if(p=(-M-X)/V,y=(-M+X)/V,p>=1||y<=0)return!1}else{if(I>=0)return!1;p=0,y=1}var L=v+c*p,m;if(L>-f&&L<f){if(p>0){m=p;var g=_.normal.init(h+n*m,0,s+z*m),N=Math.sqrt(g.x*g.x+g.y*g.y+g.z*g.z);N>0&&(N=1/N);var d=g.x*N,F=g.y*N,S=g.z*N;return g.x=d,g.y=F,g.z=S,_.position.init(h+m*n,L,s+m*z),_.fraction=m,!0}return!1}var Y=L<0?-f:f,Q,C,B,Z,$,K;Q=0,C=Y,B=0,Z=a-Q,$=t-C,K=i-B;var E,J,A;if(E=o-a,J=r-t,A=e-i,V=E*E+J*J+A*A,M=Z*E+$*J+K*A,I=Z*Z+$*$+K*K-this._radius*this._radius,k=M*M-V*I,k<0)return!1;var R=(-M-Math.sqrt(k))/V;if(R<0||R>1)return!1;var U,G,D,H,j,ia;U=Z+E*R,G=$+J*R,D=K+A*R;var ea=U*U+G*G+D*D;ea>0&&(ea=1/Math.sqrt(ea)),H=U*ea,j=G*ea,ia=D*ea,U+=Q,G+=C,D+=B;var W=_.position;W.x=U,W.y=G,W.z=D;var q=_.normal;return q.x=H,q.y=j,q.z=ia,_.fraction=R,!0}};u.collision.geometry.ConeGeometry=class extends u.collision.geometry.ConvexGeometry{constructor(a,t){super(3),this._radius=a,this._halfHeight=t,this.sinTheta=a/Math.sqrt(a*a+4*t*t),this.cosTheta=2*t/Math.sqrt(a*a+4*t*t),this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){var a=this._radius*this._radius,t=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*a*this._halfHeight*2/3,this._inertiaCoeff00=.05*(3*a+2*t),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3*a,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.05*(3*a+2*t)}_computeAabb(a,t){var i,o,r,e,_,h,v,s,l,x,b,f;i=t._rotation01,o=t._rotation11,r=t._rotation21,e=i*i,_=o*o,h=r*r;var n=e,c=_,z=h;x=Math.sqrt(1-n),b=Math.sqrt(1-c),f=Math.sqrt(1-z),x*=this._radius,b*=this._radius,f*=this._radius,v=i*this._halfHeight,s=o*this._halfHeight,l=r*this._halfHeight;var p,y,V,M,I,k;p=-v,y=-s,V=-l,p-=x,y-=b,V-=f,M=-v,I=-s,k=-l,M+=x,I+=b,k+=f;var X,L,m,g,N,d;X=p>M?p:M,L=y>I?y:I,m=V>k?V:k,X=X>v?X:v,L=L>s?L:s,m=m>l?m:l,g=p<M?p:M,N=y<I?y:I,d=V<k?V:k,g=g<v?g:v,N=N<s?N:s,d=d<l?d:l,a._minX=t._positionX+g,a._minY=t._positionY+N,a._minZ=t._positionZ+d,a._maxX=t._positionX+X,a._maxY=t._positionY+L,a._maxZ=t._positionZ+m}computeLocalSupportingVertex(a,t){var i=a.x,o=a.y,r=a.z;if(o>0&&o*o>this.sinTheta*this.sinTheta*(i*i+o*o+r*r)){t.init(0,this._halfHeight-this._gjkMargin/this.sinTheta,0),t.y<0&&(t.y=0);return}var e=a.x,_=a.z,h=e*e+_*_,v=2*this._halfHeight,s=(v-this._gjkMargin)/v*this._radius-this._gjkMargin/this.cosTheta;s<0&&(s=0);var l=h>0?s/Math.sqrt(h):0,x=this._halfHeight-this._gjkMargin;x<0&&(x=0),t.x=e*l,t.y=-x,t.z=_*l}_rayCastLocal(a,t,i,o,r,e,_){var h=a,v=t,s=i,l=o,x=r,b=e,f=this._halfHeight,n=l-h,c=x-v,z=b-s,p=0,y=1;if(c>-1e-6&&c<1e-6){if(v<=-f||v>=f)return!1}else{var V=1/c,M=(-f-v)*V,I=(f-v)*V;if(M>I){var k=M;M=I,I=k}M>0&&(p=M),I<1&&(y=I)}if(p>=1||y<=0)return!1;var X=0,L=0;v-=f;var m=this.cosTheta*this.cosTheta,g=m*(n*n+c*c+z*z)-c*c,N=m*(h*n+v*c+s*z)-v*c,d=m*(h*h+v*v+s*s)-v*v,F=N*N-g*d;if(g!=0){if(F<0)return!1;var S=Math.sqrt(F);if(g<0){if(c>0){if(X=0,L=(-N+S)/g,L<=0)return!1}else if(X=(-N-S)/g,L=1,X>=1)return!1}else if(X=(-N-S)/g,L=(-N+S)/g,X>=1||L<=0)return!1}else{var Y=-d/(2*N);if(N>0){if(X=0,L=Y,Y<=0)return!1}else if(X=Y,L=1,Y>=1)return!1}v+=f;var Q;if(L<=p||y<=X)return!1;if(X<p){if(Q=p,Q==0)return!1;_.normal.init(0,c>0?-1:1,0)}else{if(Q=X,Q==0)return!1;var C=_.normal.init(h+n*Q,0,s+z*Q),B=Math.sqrt(C.x*C.x+C.y*C.y+C.z*C.z);B>0&&(B=1/B);var Z=C.x*B,$=C.y*B,K=C.z*B;C.x=Z,C.y=$,C.z=K;var E=C,J=this.cosTheta,A=E.x*J,R=E.y*J,U=E.z*J;E.x=A,E.y=R,E.z=U,_.normal.y+=this.sinTheta}return _.position.init(h+Q*n,v+Q*c,s+Q*z),_.fraction=Q,!0}};u.collision.geometry.ConvexHullGeometry=class extends u.collision.geometry.ConvexGeometry{constructor(a){super(5),this._numVertices=a.length;var t=new Array(this._numVertices);this._vertices=t;var i=new Array(this._numVertices);this._tmpVertices=i;for(var o=0,r=this._numVertices;o<r;){var e=o++;this._vertices[e]=a[e],this._tmpVertices[e]=new u.common.Vec3}this._useGjkRayCast=!0,this._updateMass()}getVertices(){return this._vertices}_updateMass(){this._volume=1,this._inertiaCoeff00=1,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=1,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=1;for(var a=this._vertices[0].x,t=this._vertices[0].y,i=this._vertices[0].z,o=this._vertices[0].x,r=this._vertices[0].y,e=this._vertices[0].z,_=1,h=this._numVertices;_<h;){var v=_++,s=this._vertices[v].x,l=this._vertices[v].y,x=this._vertices[v].z;s<a?a=s:s>o&&(o=s),l<t?t=l:l>r&&(r=l),x<i?i=x:x>e&&(e=x)}var b=o-a,f=r-t,n=e-i;this._volume=b*f*n;var c=((a+o)*(a+o)+(t+r)*(t+r)+(i+e)*(i+e))*.25;b=b*b*.25,f=f*f*.25,n=n*n*.25,this._inertiaCoeff00=.3333333333333333*(f+n)+c,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(n+b)+c,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(b+f)+c}_computeAabb(a,t){var i,o,r,e,_,h,v,s,l;v=this._gjkMargin,s=this._gjkMargin,l=this._gjkMargin;var x,b,f,n=this._vertices[0];x=n.x,b=n.y,f=n.z;var c,z,p,y,V,M;y=t._rotation00*x+t._rotation01*b+t._rotation02*f,V=t._rotation10*x+t._rotation11*b+t._rotation12*f,M=t._rotation20*x+t._rotation21*b+t._rotation22*f,c=y,z=V,p=M,c+=t._positionX,z+=t._positionY,p+=t._positionZ,i=c,o=z,r=p,e=c,_=z,h=p;for(var I=1,k=this._numVertices;I<k;){var X=I++,L=this._vertices[X];x=L.x,b=L.y,f=L.z;var m,g,N;m=t._rotation00*x+t._rotation01*b+t._rotation02*f,g=t._rotation10*x+t._rotation11*b+t._rotation12*f,N=t._rotation20*x+t._rotation21*b+t._rotation22*f,c=m,z=g,p=N,c+=t._positionX,z+=t._positionY,p+=t._positionZ,i=i<c?i:c,o=o<z?o:z,r=r<p?r:p,e=e>c?e:c,_=_>z?_:z,h=h>p?h:p}a._minX=i-v,a._minY=o-s,a._minZ=r-l,a._maxX=e+v,a._maxY=_+s,a._maxZ=h+l}computeLocalSupportingVertex(a,t){for(var i=this._vertices[0],o=i.x*a.x+i.y*a.y+i.z*a.z,r=0,e=1,_=this._numVertices;e<_;){var h=e++,v=this._vertices[h],s=v.x*a.x+v.y*a.y+v.z*a.z;s>o&&(o=s,r=h)}var l=this._vertices[r];t.x=l.x,t.y=l.y,t.z=l.z}};u.collision.geometry.CylinderGeometry=class extends u.collision.geometry.ConvexGeometry{constructor(a,t){super(2),this._radius=a,this._halfHeight=t,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){var a=this._radius*this._radius,t=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*a*this._halfHeight*2,this._inertiaCoeff00=.08333333333333333*(3*a+t),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.5*a,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.08333333333333333*(3*a+t)}_computeAabb(a,t){var i,o,r,e,_,h,v,s,l,x,b,f;i=t._rotation01,o=t._rotation11,r=t._rotation21,i=i<0?-i:i,o=o<0?-o:o,r=r<0?-r:r,e=i*i,_=o*o,h=r*r;var n=e,c=_,z=h;x=Math.sqrt(1-n),b=Math.sqrt(1-c),f=Math.sqrt(1-z),x*=this._radius,b*=this._radius,f*=this._radius,v=i*this._halfHeight,s=o*this._halfHeight,l=r*this._halfHeight;var p,y,V;p=x+v,y=b+s,V=f+l,a._minX=t._positionX-p,a._minY=t._positionY-y,a._minZ=t._positionZ-V,a._maxX=t._positionX+p,a._maxY=t._positionY+y,a._maxZ=t._positionZ+V}computeLocalSupportingVertex(a,t){var i=a.x,o=a.z,r=i*i+o*o,e=this._radius-this._gjkMargin;e<0&&(e=0);var _=r>0?e/Math.sqrt(r):0,h=this._halfHeight-this._gjkMargin;h<0&&(h=0),t.x=i*_,t.y=a.y>0?h:-h,t.z=o*_}_rayCastLocal(a,t,i,o,r,e,_){var h=a,v=t,s=i,l=o,x=r,b=e,f=this._halfHeight,n=l-h,c=x-v,z=b-s,p=0,y=1;if(c>-1e-6&&c<1e-6){if(v<=-f||v>=f)return!1}else{var V=1/c,M=(-f-v)*V,I=(f-v)*V;if(M>I){var k=M;M=I,I=k}M>0&&(p=M),I<1&&(y=I)}if(p>=1||y<=0)return!1;var X=0,L=1,m=n*n+z*z,g=h*n+s*z,N=h*h+s*s-this._radius*this._radius,d=g*g-m*N;if(d<0)return!1;if(m>0){var F=Math.sqrt(d);if(X=(-g-F)/m,L=(-g+F)/m,X>=1||L<=0)return!1}else{if(N>=0)return!1;X=0,L=1}var S;if(L<=p||y<=X)return!1;if(X<p){if(S=p,S==0)return!1;_.normal.init(0,c>0?-1:1,0)}else{if(S=X,S==0)return!1;var Y=_.normal.init(h+n*S,0,s+z*S),Q=Math.sqrt(Y.x*Y.x+Y.y*Y.y+Y.z*Y.z);Q>0&&(Q=1/Q);var C=Y.x*Q,B=Y.y*Q,Z=Y.z*Q;Y.x=C,Y.y=B,Y.z=Z}return _.position.init(h+S*n,v+S*c,s+S*z),_.fraction=S,!0}};u.collision.geometry.GeometryType=class{};u.collision.geometry.RayCastHit=class{constructor(){this.position=new u.common.Vec3,this.normal=new u.common.Vec3,this.fraction=0}};u.collision.geometry.SphereGeometry=class extends u.collision.geometry.ConvexGeometry{constructor(a){super(0),this._radius=a,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}_updateMass(){this._volume=4.188790204786386*this._radius*this._radius*this._radius,this._inertiaCoeff00=.4*this._radius*this._radius,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.4*this._radius*this._radius,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.4*this._radius*this._radius}_computeAabb(a,t){var i,o,r;i=this._radius,o=this._radius,r=this._radius,a._minX=t._positionX-i,a._minY=t._positionY-o,a._minZ=t._positionZ-r,a._maxX=t._positionX+i,a._maxY=t._positionY+o,a._maxZ=t._positionZ+r}computeLocalSupportingVertex(a,t){t.zero()}_rayCastLocal(a,t,i,o,r,e,_){var h,v,s;h=o-a,v=r-t,s=e-i;var l=h*h+v*v+s*s,x=a*h+t*v+i*s,b=a*a+t*t+i*i-this._radius*this._radius,f=x*x-l*b;if(f<0)return!1;var n=(-x-Math.sqrt(f))/l;if(n<0||n>1)return!1;var c,z,p,y,V,M;c=a+h*n,z=t+v*n,p=i+s*n;var I=c*c+z*z+p*p;I>0&&(I=1/Math.sqrt(I)),y=c*I,V=z*I,M=p*I;var k=_.position;k.x=c,k.y=z,k.z=p;var X=_.normal;return X.x=y,X.y=V,X.z=M,_.fraction=n,!0}};u.collision.narrowphase||(u.collision.narrowphase={});u.collision.narrowphase.CollisionMatrix=class{constructor(){var a=new Array(8);this.detectors=a;var t=this.detectors,i=new Array(8);t[0]=i;var o=this.detectors,r=new Array(8);o[1]=r;var e=this.detectors,_=new Array(8);e[2]=_;var h=this.detectors,v=new Array(8);h[3]=v;var s=this.detectors,l=new Array(8);s[4]=l;var x=this.detectors,b=new Array(8);x[5]=b;var f=new u.collision.narrowphase.detector.GjkEpaDetector,n=0,c=1,z=2,p=3,y=4,V=5;this.detectors[n][n]=new u.collision.narrowphase.detector.SphereSphereDetector,this.detectors[n][c]=new u.collision.narrowphase.detector.SphereBoxDetector(!1),this.detectors[n][z]=f,this.detectors[n][p]=f,this.detectors[n][y]=new u.collision.narrowphase.detector.SphereCapsuleDetector(!1),this.detectors[n][V]=f,this.detectors[c][n]=new u.collision.narrowphase.detector.SphereBoxDetector(!0),this.detectors[c][c]=new u.collision.narrowphase.detector.BoxBoxDetector,this.detectors[c][z]=f,this.detectors[c][p]=f,this.detectors[c][y]=f,this.detectors[c][V]=f,this.detectors[z][n]=f,this.detectors[z][c]=f,this.detectors[z][z]=f,this.detectors[z][p]=f,this.detectors[z][y]=f,this.detectors[z][V]=f,this.detectors[p][n]=f,this.detectors[p][c]=f,this.detectors[p][z]=f,this.detectors[p][p]=f,this.detectors[p][y]=f,this.detectors[p][V]=f,this.detectors[y][n]=new u.collision.narrowphase.detector.SphereCapsuleDetector(!0),this.detectors[y][c]=f,this.detectors[y][z]=f,this.detectors[y][p]=f,this.detectors[y][y]=new u.collision.narrowphase.detector.CapsuleCapsuleDetector,this.detectors[y][V]=f,this.detectors[V][n]=f,this.detectors[V][c]=f,this.detectors[V][z]=f,this.detectors[V][p]=f,this.detectors[V][y]=f,this.detectors[V][V]=f}getDetector(a,t){return this.detectors[a][t]}};u.collision.narrowphase.DetectorResult=class{constructor(){this.numPoints=0,this.normal=new u.common.Vec3;var a=new Array(u.common.Setting.maxManifoldPoints);this.points=a,this.incremental=!1;for(var t=0,i=u.common.Setting.maxManifoldPoints;t<i;){var o=t++;this.points[o]=new u.collision.narrowphase.DetectorResultPoint}}getMaxDepth(){for(var a=0,t=0,i=this.numPoints;t<i;){var o=t++;this.points[o].depth>a&&(a=this.points[o].depth)}return a}clear(){this.numPoints=0;for(var a=0,t=this.points;a<t.length;){var i=t[a];++a,i.position1.zero(),i.position2.zero(),i.depth=0,i.id=0}this.normal.zero()}};u.collision.narrowphase.DetectorResultPoint=class{constructor(){this.position1=new u.common.Vec3,this.position2=new u.common.Vec3,this.depth=0,this.id=0}};u.collision.narrowphase.detector||(u.collision.narrowphase.detector={});u.collision.narrowphase.detector.Detector=class{constructor(a){this.swapped=a}setNormal(a,t,i,o){var r=a.normal;if(r.x=t,r.y=i,r.z=o,this.swapped){var e=a.normal,_=-e.x,h=-e.y,v=-e.z;e.x=_,e.y=h,e.z=v}}addPoint(a,t,i,o,r,e,_,h,v){var s=a.points[a.numPoints++];if(s.depth=h,s.id=v,this.swapped){var l=s.position1;l.x=r,l.y=e,l.z=_;var x=s.position2;x.x=t,x.y=i,x.z=o}else{var b=s.position1;b.x=t,b.y=i,b.z=o;var f=s.position2;f.x=r,f.y=e,f.z=_}}detectImpl(a,t,i,o,r,e){}detect(a,t,i,o,r,e){a.numPoints=0;for(var _=0,h=a.points;_<h.length;){var v=h[_];++_,v.position1.zero(),v.position2.zero(),v.depth=0,v.id=0}a.normal.zero(),this.swapped?this.detectImpl(a,i,t,r,o,e):this.detectImpl(a,t,i,o,r,e)}};u.collision.narrowphase.detector.BoxBoxDetector=class extends u.collision.narrowphase.detector.Detector{constructor(){super(!1),this.clipper=new u.collision.narrowphase.detector._BoxBoxDetector.FaceClipper}detectImpl(a,t,i,o,r,e){var _=t,h=i;a.incremental=!1;var v,s,l,x,b,f,n,c,z;v=o._positionX,s=o._positionY,l=o._positionZ,x=r._positionX,b=r._positionY,f=r._positionZ,n=x-v,c=b-s,z=f-l;var p,y,V,M,I,k,X,L,m,g,N,d,F,S,Y,Q,C,B;p=o._rotation00,y=o._rotation10,V=o._rotation20,M=o._rotation01,I=o._rotation11,k=o._rotation21,X=o._rotation02,L=o._rotation12,m=o._rotation22,g=r._rotation00,N=r._rotation10,d=r._rotation20,F=r._rotation01,S=r._rotation11,Y=r._rotation21,Q=r._rotation02,C=r._rotation12,B=r._rotation22;var Z=_._halfExtentsX,$=_._halfExtentsY,K=_._halfExtentsZ,E=h._halfExtentsX,J=h._halfExtentsY,A=h._halfExtentsZ,R,U,G,D,H,j,ia,ea,W,q,na,oa,aa,T,ca,_a,w,ta;R=p*Z,U=y*Z,G=V*Z,D=M*$,H=I*$,j=k*$,ia=X*K,ea=L*K,W=m*K,q=g*E,na=N*E,oa=d*E,aa=F*J,T=S*J,ca=Y*J,_a=Q*A,w=C*A,ta=B*A;var ra=1/0,la=-1,va=0,ua,za,Ma;ua=0,za=0,Ma=0;var Xa=Z,Za=p*q+y*na+V*oa,fa=p*aa+y*T+V*ca,ba=p*_a+y*w+V*ta;Za<0&&(Za=-Za),fa<0&&(fa=-fa),ba<0&&(ba=-ba);var sa=Za+fa+ba,ha=p*n+y*c+V*z,ma=Xa+sa,ya=ha<0,Ba=ya?-ha:ha;if(Ba<ma){var pa=ma-Ba;pa<ra&&(ra=pa,la=0,ua=p,za=y,Ma=V,va=ya?-1:1)}else return;Xa=$;var Ya=M*q+I*na+k*oa,Ra=M*aa+I*T+k*ca,ga=M*_a+I*w+k*ta;Ya<0&&(Ya=-Ya),Ra<0&&(Ra=-Ra),ga<0&&(ga=-ga),sa=Ya+Ra+ga,ha=M*n+I*c+k*z;var xa=Xa+sa,wa=ha<0,ka=wa?-ha:ha;if(ka<xa){var Pa=xa-ka;Pa<ra&&(ra=Pa,la=1,ua=M,za=I,Ma=k,va=wa?-1:1)}else return;Xa=K;var zt=X*q+L*na+m*oa,Oa=X*aa+L*T+m*ca,Aa=X*_a+L*w+m*ta;zt<0&&(zt=-zt),Oa<0&&(Oa=-Oa),Aa<0&&(Aa=-Aa),sa=zt+Oa+Aa,ha=X*n+L*c+m*z;var nt=Xa+sa,Ea=ha<0,Fa=Ea?-ha:ha;if(Fa<nt){var da=nt-Fa;da<ra&&(ra=da,la=2,ua=X,za=L,Ma=m,va=Ea?-1:1)}else return;ra>u.common.Setting.linearSlop?ra-=u.common.Setting.linearSlop:ra=0;var ft=g*R+N*U+d*G,Wa=g*D+N*H+d*j,Ha=g*ia+N*ea+d*W;ft<0&&(ft=-ft),Wa<0&&(Wa=-Wa),Ha<0&&(Ha=-Ha),Xa=ft+Wa+Ha,sa=E,ha=g*n+N*c+d*z;var bt=Xa+sa,it=ha<0,Ka=it?-ha:ha;if(Ka<bt){var _t=bt-Ka;_t<ra&&(ra=_t,la=3,ua=g,za=N,Ma=d,va=it?-1:1)}else return;var gt=F*R+S*U+Y*G,pt=F*D+S*H+Y*j,Ga=F*ia+S*ea+Y*W;gt<0&&(gt=-gt),pt<0&&(pt=-pt),Ga<0&&(Ga=-Ga),Xa=gt+pt+Ga,sa=J,ha=F*n+S*c+Y*z;var rt=Xa+sa,xt=ha<0,Da=xt?-ha:ha;if(Da<rt){var Ta=rt-Da;Ta<ra&&(ra=Ta,la=4,ua=F,za=S,Ma=Y,va=xt?-1:1)}else return;var Na=Q*R+C*U+B*G,Vt=Q*D+C*H+B*j,Pt=Q*ia+C*ea+B*W;Na<0&&(Na=-Na),Vt<0&&(Vt=-Vt),Pt<0&&(Pt=-Pt),Xa=Na+Vt+Pt,sa=A,ha=Q*n+C*c+B*z;var st=Xa+sa,Xt=ha<0,Yt=Xt?-ha:ha;if(Yt<st){var Mt=st-Yt;Mt<ra&&(ra=Mt,la=5,ua=Q,za=C,Ma=B,va=Xt?-1:1)}else return;ra>u.common.Setting.linearSlop?ra-=u.common.Setting.linearSlop:ra=0;var Ia,O,Va;if(Ia=y*d-V*N,O=V*g-p*d,Va=p*N-y*g,!(Ia==0&&O==0&&Va==0)){var lt=Ia*Ia+O*O+Va*Va;lt>0&&(lt=1/Math.sqrt(lt)),Ia*=lt,O*=lt,Va*=lt;var P=Ia*D+O*H+Va*j,wt=Ia*ia+O*ea+Va*W;P<0&&(P=-P),wt<0&&(wt=-wt),Xa=P+wt;var At=Ia*aa+O*T+Va*ca,dt=Ia*_a+O*w+Va*ta;At<0&&(At=-At),dt<0&&(dt=-dt),sa=At+dt,ha=Ia*n+O*c+Va*z;var yt=Xa+sa,kt=ha<0,mt=kt?-ha:ha;if(mt<yt){var ht=yt-mt;ht<ra&&(ra=ht,la=6,ua=Ia,za=O,Ma=Va,va=kt?-1:1)}else return}if(Ia=y*Y-V*S,O=V*F-p*Y,Va=p*S-y*F,!(Ia==0&&O==0&&Va==0)){var ut=Ia*Ia+O*O+Va*Va;ut>0&&(ut=1/Math.sqrt(ut)),Ia*=ut,O*=ut,Va*=ut;var Qa=Ia*D+O*H+Va*j,et=Ia*ia+O*ea+Va*W;Qa<0&&(Qa=-Qa),et<0&&(et=-et),Xa=Qa+et;var Ca=Ia*q+O*na+Va*oa,vt=Ia*_a+O*w+Va*ta;Ca<0&&(Ca=-Ca),vt<0&&(vt=-vt),sa=Ca+vt,ha=Ia*n+O*c+Va*z;var qa=Xa+sa,at=ha<0,Ua=at?-ha:ha;if(Ua<qa){var tt=qa-Ua;tt<ra&&(ra=tt,la=7,ua=Ia,za=O,Ma=Va,va=at?-1:1)}else return}if(Ia=y*B-V*C,O=V*Q-p*B,Va=p*C-y*Q,!(Ia==0&&O==0&&Va==0)){var ct=Ia*Ia+O*O+Va*Va;ct>0&&(ct=1/Math.sqrt(ct)),Ia*=ct,O*=ct,Va*=ct;var Sa=Ia*D+O*H+Va*j,Ja=Ia*ia+O*ea+Va*W;Sa<0&&(Sa=-Sa),Ja<0&&(Ja=-Ja),Xa=Sa+Ja;var ja=Ia*q+O*na+Va*oa,La=Ia*aa+O*T+Va*ca;ja<0&&(ja=-ja),La<0&&(La=-La),sa=ja+La,ha=Ia*n+O*c+Va*z;var ot=Xa+sa,It=ha<0,oi=It?-ha:ha;if(oi<ot){var gi=ot-oi;gi<ra&&(ra=gi,la=8,ua=Ia,za=O,Ma=Va,va=It?-1:1)}else return}if(Ia=I*d-k*N,O=k*g-M*d,Va=M*N-I*g,!(Ia==0&&O==0&&Va==0)){var ai=Ia*Ia+O*O+Va*Va;ai>0&&(ai=1/Math.sqrt(ai)),Ia*=ai,O*=ai,Va*=ai;var Ct=Ia*R+O*U+Va*G,_i=Ia*ia+O*ea+Va*W;Ct<0&&(Ct=-Ct),_i<0&&(_i=-_i),Xa=Ct+_i;var Et=Ia*aa+O*T+Va*ca,St=Ia*_a+O*w+Va*ta;Et<0&&(Et=-Et),St<0&&(St=-St),sa=Et+St,ha=Ia*n+O*c+Va*z;var Jt=Xa+sa,Ki=ha<0,vi=Ki?-ha:ha;if(vi<Jt){var li=Jt-vi;li<ra&&(ra=li,la=9,ua=Ia,za=O,Ma=Va,va=Ki?-1:1)}else return}if(Ia=I*Y-k*S,O=k*F-M*Y,Va=M*S-I*F,!(Ia==0&&O==0&&Va==0)){var ti=Ia*Ia+O*O+Va*Va;ti>0&&(ti=1/Math.sqrt(ti)),Ia*=ti,O*=ti,Va*=ti;var Oi=Ia*R+O*U+Va*G,Xi=Ia*ia+O*ea+Va*W;Oi<0&&(Oi=-Oi),Xi<0&&(Xi=-Xi),Xa=Oi+Xi;var zi=Ia*q+O*na+Va*oa,Zt=Ia*_a+O*w+Va*ta;zi<0&&(zi=-zi),Zt<0&&(Zt=-Zt),sa=zi+Zt,ha=Ia*n+O*c+Va*z;var ri=Xa+sa,Wt=ha<0,ni=Wt?-ha:ha;if(ni<ri){var $i=ri-ni;$i<ra&&(ra=$i,la=10,ua=Ia,za=O,Ma=Va,va=Wt?-1:1)}else return}if(Ia=I*B-k*C,O=k*Q-M*B,Va=M*C-I*Q,!(Ia==0&&O==0&&Va==0)){var Ut=Ia*Ia+O*O+Va*Va;Ut>0&&(Ut=1/Math.sqrt(Ut)),Ia*=Ut,O*=Ut,Va*=Ut;var ji=Ia*R+O*U+Va*G,Ii=Ia*ia+O*ea+Va*W;ji<0&&(ji=-ji),Ii<0&&(Ii=-Ii),Xa=ji+Ii;var pr=Ia*q+O*na+Va*oa,Wi=Ia*aa+O*T+Va*ca;pr<0&&(pr=-pr),Wi<0&&(Wi=-Wi),sa=pr+Wi,ha=Ia*n+O*c+Va*z;var Lt=Xa+sa,jt=ha<0,Tt=jt?-ha:ha;if(Tt<Lt){var bi=Lt-Tt;bi<ra&&(ra=bi,la=11,ua=Ia,za=O,Ma=Va,va=jt?-1:1)}else return}if(Ia=L*d-m*N,O=m*g-X*d,Va=X*N-L*g,!(Ia==0&&O==0&&Va==0)){var Mi=Ia*Ia+O*O+Va*Va;Mi>0&&(Mi=1/Math.sqrt(Mi)),Ia*=Mi,O*=Mi,Va*=Mi;var vr=Ia*R+O*U+Va*G,qt=Ia*D+O*H+Va*j;vr<0&&(vr=-vr),qt<0&&(qt=-qt),Xa=vr+qt;var fi=Ia*aa+O*T+Va*ca,Bt=Ia*_a+O*w+Va*ta;fi<0&&(fi=-fi),Bt<0&&(Bt=-Bt),sa=fi+Bt,ha=Ia*n+O*c+Va*z;var xi=Xa+sa,hi=ha<0,sr=hi?-ha:ha;if(sr<xi){var Xr=xi-sr;Xr<ra&&(ra=Xr,la=12,ua=Ia,za=O,Ma=Va,va=hi?-1:1)}else return}if(Ia=L*Y-m*S,O=m*F-X*Y,Va=X*S-L*F,!(Ia==0&&O==0&&Va==0)){var ro=Ia*Ia+O*O+Va*Va;ro>0&&(ro=1/Math.sqrt(ro)),Ia*=ro,O*=ro,Va*=ro;var Gt=Ia*R+O*U+Va*G,fr=Ia*D+O*H+Va*j;Gt<0&&(Gt=-Gt),fr<0&&(fr=-fr),Xa=Gt+fr;var mr=Ia*q+O*na+Va*oa,Dt=Ia*_a+O*w+Va*ta;mr<0&&(mr=-mr),Dt<0&&(Dt=-Dt),sa=mr+Dt,ha=Ia*n+O*c+Va*z;var Br=Xa+sa,Si=ha<0,Dr=Si?-ha:ha;if(Dr<Br){var Hn=Br-Dr;Hn<ra&&(ra=Hn,la=13,ua=Ia,za=O,Ma=Va,va=Si?-1:1)}else return}if(Ia=L*B-m*C,O=m*Q-X*B,Va=X*C-L*Q,!(Ia==0&&O==0&&Va==0)){var oo=Ia*Ia+O*O+Va*Va;oo>0&&(oo=1/Math.sqrt(oo)),Ia*=oo,O*=oo,Va*=oo;var Ar=Ia*R+O*U+Va*G,no=Ia*D+O*H+Va*j;Ar<0&&(Ar=-Ar),no<0&&(no=-no),Xa=Ar+no;var yn=Ia*q+O*na+Va*oa,Ao=Ia*aa+O*T+Va*ca;yn<0&&(yn=-yn),Ao<0&&(Ao=-Ao),sa=yn+Ao,ha=Ia*n+O*c+Va*z;var Io=Xa+sa,ui=ha<0,qr=ui?-ha:ha;if(qr<Io){var dr=Io-qr;dr<ra&&(ra=dr,la=14,ua=Ia,za=O,Ma=Va,va=ui?-1:1)}else return}if(la>=6){ua*=va,za*=va,Ma*=va;var yr=(la-6)/3|0,So=la-6-yr*3,Di,Sr,gr,Qt,Hi,Li,Cn,Me,js,pe,Ts,qs;switch(yr){case 0:Cn=p,Me=y,js=V;var D_=D*ua+H*za+j*Ma>0,gn=ia*ua+ea*za+W*Ma>0;D_?gn?(Di=D+ia,Sr=H+ea,gr=j+W):(Di=D-ia,Sr=H-ea,gr=j-W):gn?(Di=ia-D,Sr=ea-H,gr=W-j):(Di=D+ia,Sr=H+ea,gr=j+W,Di=-Di,Sr=-Sr,gr=-gr);break;case 1:Cn=M,Me=I,js=k;var Pi=R*ua+U*za+G*Ma>0,No=ia*ua+ea*za+W*Ma>0;Pi?No?(Di=R+ia,Sr=U+ea,gr=G+W):(Di=R-ia,Sr=U-ea,gr=G-W):No?(Di=ia-R,Sr=ea-U,gr=W-G):(Di=R+ia,Sr=U+ea,gr=G+W,Di=-Di,Sr=-Sr,gr=-gr);break;default:Cn=X,Me=L,js=m;var Wr=R*ua+U*za+G*Ma>0,ks=D*ua+H*za+j*Ma>0;Wr?ks?(Di=R+D,Sr=U+H,gr=G+j):(Di=R-D,Sr=U-H,gr=G-j):ks?(Di=D-R,Sr=H-U,gr=j-G):(Di=R+D,Sr=U+H,gr=G+j,Di=-Di,Sr=-Sr,gr=-gr)}switch(Di=v+Di,Sr=s+Sr,gr=l+gr,So){case 0:pe=g,Ts=N,qs=d;var on=aa*ua+T*za+ca*Ma>0,Tn=_a*ua+w*za+ta*Ma>0;on?Tn?(Qt=aa+_a,Hi=T+w,Li=ca+ta):(Qt=aa-_a,Hi=T-w,Li=ca-ta):Tn?(Qt=_a-aa,Hi=w-T,Li=ta-ca):(Qt=aa+_a,Hi=T+w,Li=ca+ta,Qt=-Qt,Hi=-Hi,Li=-Li);break;case 1:pe=F,Ts=S,qs=Y;var Kn=q*ua+na*za+oa*Ma>0,ws=_a*ua+w*za+ta*Ma>0;Kn?ws?(Qt=q+_a,Hi=na+w,Li=oa+ta):(Qt=q-_a,Hi=na-w,Li=oa-ta):ws?(Qt=_a-q,Hi=w-na,Li=ta-oa):(Qt=q+_a,Hi=na+w,Li=oa+ta,Qt=-Qt,Hi=-Hi,Li=-Li);break;default:pe=Q,Ts=C,qs=B;var k_=q*ua+na*za+oa*Ma>0,Qs=aa*ua+T*za+ca*Ma>0;k_?Qs?(Qt=q+aa,Hi=na+T,Li=oa+ca):(Qt=q-aa,Hi=na-T,Li=oa-ca):Qs?(Qt=aa-q,Hi=T-na,Li=ca-oa):(Qt=q+aa,Hi=na+T,Li=oa+ca,Qt=-Qt,Hi=-Hi,Li=-Li)}Qt=x-Qt,Hi=b-Hi,Li=f-Li;var Vi,Ir,xr;Vi=Di-Qt,Ir=Sr-Hi,xr=gr-Li;var so=Cn*pe+Me*Ts+js*qs,Qn=Cn*Vi+Me*Ir+js*xr,me=pe*Vi+Ts*Ir+qs*xr,nn=1/(1-so*so),Rn=(so*me-Qn)*nn,ci=(me-so*Qn)*nn,ho,Fr,En,ae,Rs,Es;ho=Di+Cn*Rn,Fr=Sr+Me*Rn,En=gr+js*Rn,ae=Qt+pe*ci,Rs=Hi+Ts*ci,Es=Li+qs*ci;var Ds,hs,ii;Ds=-ua,hs=-za,ii=-Ma,this.setNormal(a,Ds,hs,ii),this.addPoint(a,ho,Fr,En,ae,Rs,Es,ra,4);return}var ir,Ri,Fi,fo;if(la>=3){va=-va,n=-n,c=-c,z=-z;var Po=_;_=h,h=Po;var e_=Z;Z=E,E=e_;var Fs=$;$=J,J=Fs;var te=K;K=A,A=te,ir=v,Ri=s,Fi=l,v=x,s=b,l=f,x=ir,b=Ri,f=Fi,ir=p,Ri=y,Fi=V,p=g,y=N,V=d,g=ir,N=Ri,d=Fi,ir=M,Ri=I,Fi=k,M=F,I=S,k=Y,F=ir,S=Ri,Y=Fi,ir=X,Ri=L,Fi=m,X=Q,L=C,m=B,Q=ir,C=Ri,B=Fi,ir=R,Ri=U,Fi=G,R=q,U=na,G=oa,q=ir,na=Ri,oa=Fi,ir=D,Ri=H,Fi=j,D=aa,H=T,j=ca,aa=ir,T=Ri,ca=Fi,ir=ia,Ri=ea,Fi=W,ia=_a,ea=w,W=ta,_a=ir,w=Ri,ta=Fi,la-=3,fo=!0}else fo=!1;var Dn,co,Ft,Ni,lr,Vo,cs,Xs,Ls,xo,$t,Vr,er,Jo;switch(la){case 0:Dn=R,co=U,Ft=G,Ni=p,lr=y,Vo=V,cs=M,Xs=I,Ls=k,xo=X,$t=L,Vr=m,er=$,Jo=K;break;case 1:Dn=D,co=H,Ft=j,Ni=M,lr=I,Vo=k,cs=X,Xs=L,Ls=m,xo=p,$t=y,Vr=V,er=K,Jo=Z;break;default:Dn=ia,co=ea,Ft=W,Ni=X,lr=L,Vo=m,cs=p,Xs=y,Ls=V,xo=M,$t=I,Vr=k,er=Z,Jo=$}if(va<0){Dn=-Dn,co=-co,Ft=-Ft,Ni=-Ni,lr=-lr,Vo=-Vo,ir=cs,Ri=Xs,Fi=Ls,cs=xo,Xs=$t,Ls=Vr,xo=ir,$t=Ri,Vr=Fi;var Ne=er;er=Jo,Jo=Ne}Dn+=v,co+=s,Ft+=l;var Co=1,ko=0,Nr=Ni*g+lr*N+Vo*d;Nr<Co&&(Co=Nr,ko=0),-Nr<Co&&(Co=-Nr,ko=1),Nr=Ni*F+lr*S+Vo*Y,Nr<Co&&(Co=Nr,ko=2),-Nr<Co&&(Co=-Nr,ko=3),Nr=Ni*Q+lr*C+Vo*B,Nr<Co&&(Co=Nr,ko=4),-Nr<Co&&(Co=-Nr,ko=5);var Pr,Cr,Lr,Rt,Ji,Yi,Qi,zr,qi,Jr,Gr,ao;switch(ko){case 0:Pr=q+aa,Cr=na+T,Lr=oa+ca,Pr+=_a,Cr+=w,Lr+=ta,Rt=q-aa,Ji=na-T,Yi=oa-ca,Rt+=_a,Ji+=w,Yi+=ta,Qi=q-aa,zr=na-T,qi=oa-ca,Qi-=_a,zr-=w,qi-=ta,Jr=q+aa,Gr=na+T,ao=oa+ca,Jr-=_a,Gr-=w,ao-=ta;break;case 1:Pr=aa-q,Cr=T-na,Lr=ca-oa,Pr+=_a,Cr+=w,Lr+=ta,Rt=aa-q,Ji=T-na,Yi=ca-oa,Rt-=_a,Ji-=w,Yi-=ta,Qi=q+aa,zr=na+T,qi=oa+ca,Qi=-Qi,zr=-zr,qi=-qi,Qi-=_a,zr-=w,qi-=ta,Jr=q+aa,Gr=na+T,ao=oa+ca,Jr=-Jr,Gr=-Gr,ao=-ao,Jr+=_a,Gr+=w,ao+=ta;break;case 2:Pr=q+aa,Cr=na+T,Lr=oa+ca,Pr+=_a,Cr+=w,Lr+=ta,Rt=q+aa,Ji=na+T,Yi=oa+ca,Rt-=_a,Ji-=w,Yi-=ta,Qi=aa-q,zr=T-na,qi=ca-oa,Qi-=_a,zr-=w,qi-=ta,Jr=aa-q,Gr=T-na,ao=ca-oa,Jr+=_a,Gr+=w,ao+=ta;break;case 3:Pr=q-aa,Cr=na-T,Lr=oa-ca,Pr+=_a,Cr+=w,Lr+=ta,Rt=q+aa,Ji=na+T,Yi=oa+ca,Rt=-Rt,Ji=-Ji,Yi=-Yi,Rt+=_a,Ji+=w,Yi+=ta,Qi=q+aa,zr=na+T,qi=oa+ca,Qi=-Qi,zr=-zr,qi=-qi,Qi-=_a,zr-=w,qi-=ta,Jr=q-aa,Gr=na-T,ao=oa-ca,Jr-=_a,Gr-=w,ao-=ta;break;case 4:Pr=q+aa,Cr=na+T,Lr=oa+ca,Pr+=_a,Cr+=w,Lr+=ta,Rt=aa-q,Ji=T-na,Yi=ca-oa,Rt+=_a,Ji+=w,Yi+=ta,Qi=q+aa,zr=na+T,qi=oa+ca,Qi=-Qi,zr=-zr,qi=-qi,Qi+=_a,zr+=w,qi+=ta,Jr=q-aa,Gr=na-T,ao=oa-ca,Jr+=_a,Gr+=w,ao+=ta;break;default:Pr=q+aa,Cr=na+T,Lr=oa+ca,Pr-=_a,Cr-=w,Lr-=ta,Rt=q-aa,Ji=na-T,Yi=oa-ca,Rt-=_a,Ji-=w,Yi-=ta,Qi=q+aa,zr=na+T,qi=oa+ca,Qi=-Qi,zr=-zr,qi=-qi,Qi-=_a,zr-=w,qi-=ta,Jr=aa-q,Gr=T-na,ao=ca-oa,Jr-=_a,Gr-=w,ao-=ta}Pr+=n,Cr+=c,Lr+=z,Rt+=n,Ji+=c,Yi+=z,Qi+=n,zr+=c,qi+=z,Jr+=n,Gr+=c,ao+=z;var bs=this.clipper;bs.w=er,bs.h=Jo,bs.numVertices=0,bs.numTmpVertices=0;var ki=this.clipper,sn=ki.vertices[ki.numVertices++];sn.x=Pr*cs+Cr*Xs+Lr*Ls,sn.y=Pr*xo+Cr*$t+Lr*Vr,sn.wx=Pr,sn.wy=Cr,sn.wz=Lr;var Yr=this.clipper,Go=Yr.vertices[Yr.numVertices++];Go.x=Rt*cs+Ji*Xs+Yi*Ls,Go.y=Rt*xo+Ji*$t+Yi*Vr,Go.wx=Rt,Go.wy=Ji,Go.wz=Yi;var ye=this.clipper,In=ye.vertices[ye.numVertices++];In.x=Qi*cs+zr*Xs+qi*Ls,In.y=Qi*xo+zr*$t+qi*Vr,In.wx=Qi,In.wy=zr,In.wz=qi;var ge=this.clipper,Vn=ge.vertices[ge.numVertices++];Vn.x=Jr*cs+Gr*Xs+ao*Ls,Vn.y=Jr*xo+Gr*$t+ao*Vr,Vn.wx=Jr,Vn.wy=Gr,Vn.wz=ao,this.clipper.clip(),this.clipper.reduce();var Ci,To,eo;fo?(Ci=Ni,To=lr,eo=Vo):(Ci=-Ni,To=-lr,eo=-Vo),this.setNormal(a,Ci,To,eo);for(var Fn=0,Ns=this.clipper.numVertices;Fn<Ns;){var Nn=Fn++,Wo=this.clipper.vertices[Nn],kn,Ys,Ot;kn=Wo.wx,Ys=Wo.wy,Ot=Wo.wz,kn+=v,Ys+=s,Ot+=l;var Qo,Ur,wn;Qo=Dn-kn,Ur=co-Ys,wn=Ft-Ot;var Jn=Qo*Ni+Ur*lr+wn*Vo,fs,Ie,Uo;fs=kn+Ni*Jn,Ie=Ys+lr*Jn,Uo=Ot+Vo*Jn,Jn>-u.common.Setting.contactPersistenceThreshold&&(fo?this.addPoint(a,kn,Ys,Ot,fs,Ie,Uo,Jn,Nn):this.addPoint(a,fs,Ie,Uo,kn,Ys,Ot,Jn,Nn))}}};u.collision.narrowphase.detector._BoxBoxDetector||(u.collision.narrowphase.detector._BoxBoxDetector={});u.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex=class{constructor(){this.x=0,this.y=0,this.wx=0,this.wy=0,this.wz=0}};u.collision.narrowphase.detector._BoxBoxDetector.FaceClipper=class{constructor(){this.w=0,this.h=0,this.numVertices=0,this.numTmpVertices=0;var a=new Array(8);this.vertices=a;var t=new Array(8);this.tmpVertices=t,this.vertices[0]=new u.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[0]=new u.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[1]=new u.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[1]=new u.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[2]=new u.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[2]=new u.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[3]=new u.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[3]=new u.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[4]=new u.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[4]=new u.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[5]=new u.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[5]=new u.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[6]=new u.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[6]=new u.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[7]=new u.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[7]=new u.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex}clip(){for(var a=0,t=this.numVertices;a<t;){var i=a++,o=this.vertices[i],r=this.vertices[(i+1)%this.numVertices],e=this.w+o.x,_=this.w+r.x;if(e>0&&_>0){var h=this.tmpVertices[this.numTmpVertices++];h.x=o.x,h.y=o.y,h.wx=o.wx,h.wy=o.wy,h.wz=o.wz}else if(e>0&&_<=0){var v=this.tmpVertices[this.numTmpVertices++];v.x=o.x,v.y=o.y,v.wx=o.wx,v.wy=o.wy,v.wz=o.wz;var s=e/(e-_),l=this.tmpVertices[this.numTmpVertices++];l.x=o.x+(r.x-o.x)*s,l.y=o.y+(r.y-o.y)*s,l.wx=o.wx+(r.wx-o.wx)*s,l.wy=o.wy+(r.wy-o.wy)*s,l.wz=o.wz+(r.wz-o.wz)*s}else if(e<=0&&_>0){var x=e/(e-_),b=this.tmpVertices[this.numTmpVertices++];b.x=o.x+(r.x-o.x)*x,b.y=o.y+(r.y-o.y)*x,b.wx=o.wx+(r.wx-o.wx)*x,b.wy=o.wy+(r.wy-o.wy)*x,b.wz=o.wz+(r.wz-o.wz)*x}}var f=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=f,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var n=0,c=this.numVertices;n<c;){var z=n++,p=this.vertices[z],y=this.vertices[(z+1)%this.numVertices],V=this.w-p.x,M=this.w-y.x;if(V>0&&M>0){var I=this.tmpVertices[this.numTmpVertices++];I.x=p.x,I.y=p.y,I.wx=p.wx,I.wy=p.wy,I.wz=p.wz}else if(V>0&&M<=0){var k=this.tmpVertices[this.numTmpVertices++];k.x=p.x,k.y=p.y,k.wx=p.wx,k.wy=p.wy,k.wz=p.wz;var X=V/(V-M),L=this.tmpVertices[this.numTmpVertices++];L.x=p.x+(y.x-p.x)*X,L.y=p.y+(y.y-p.y)*X,L.wx=p.wx+(y.wx-p.wx)*X,L.wy=p.wy+(y.wy-p.wy)*X,L.wz=p.wz+(y.wz-p.wz)*X}else if(V<=0&&M>0){var m=V/(V-M),g=this.tmpVertices[this.numTmpVertices++];g.x=p.x+(y.x-p.x)*m,g.y=p.y+(y.y-p.y)*m,g.wx=p.wx+(y.wx-p.wx)*m,g.wy=p.wy+(y.wy-p.wy)*m,g.wz=p.wz+(y.wz-p.wz)*m}}var N=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=N,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var d=0,F=this.numVertices;d<F;){var S=d++,Y=this.vertices[S],Q=this.vertices[(S+1)%this.numVertices],C=this.h+Y.y,B=this.h+Q.y;if(C>0&&B>0){var Z=this.tmpVertices[this.numTmpVertices++];Z.x=Y.x,Z.y=Y.y,Z.wx=Y.wx,Z.wy=Y.wy,Z.wz=Y.wz}else if(C>0&&B<=0){var $=this.tmpVertices[this.numTmpVertices++];$.x=Y.x,$.y=Y.y,$.wx=Y.wx,$.wy=Y.wy,$.wz=Y.wz;var K=C/(C-B),E=this.tmpVertices[this.numTmpVertices++];E.x=Y.x+(Q.x-Y.x)*K,E.y=Y.y+(Q.y-Y.y)*K,E.wx=Y.wx+(Q.wx-Y.wx)*K,E.wy=Y.wy+(Q.wy-Y.wy)*K,E.wz=Y.wz+(Q.wz-Y.wz)*K}else if(C<=0&&B>0){var J=C/(C-B),A=this.tmpVertices[this.numTmpVertices++];A.x=Y.x+(Q.x-Y.x)*J,A.y=Y.y+(Q.y-Y.y)*J,A.wx=Y.wx+(Q.wx-Y.wx)*J,A.wy=Y.wy+(Q.wy-Y.wy)*J,A.wz=Y.wz+(Q.wz-Y.wz)*J}}var R=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=R,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var U=0,G=this.numVertices;U<G;){var D=U++,H=this.vertices[D],j=this.vertices[(D+1)%this.numVertices],ia=this.h-H.y,ea=this.h-j.y;if(ia>0&&ea>0){var W=this.tmpVertices[this.numTmpVertices++];W.x=H.x,W.y=H.y,W.wx=H.wx,W.wy=H.wy,W.wz=H.wz}else if(ia>0&&ea<=0){var q=this.tmpVertices[this.numTmpVertices++];q.x=H.x,q.y=H.y,q.wx=H.wx,q.wy=H.wy,q.wz=H.wz;var na=ia/(ia-ea),oa=this.tmpVertices[this.numTmpVertices++];oa.x=H.x+(j.x-H.x)*na,oa.y=H.y+(j.y-H.y)*na,oa.wx=H.wx+(j.wx-H.wx)*na,oa.wy=H.wy+(j.wy-H.wy)*na,oa.wz=H.wz+(j.wz-H.wz)*na}else if(ia<=0&&ea>0){var aa=ia/(ia-ea),T=this.tmpVertices[this.numTmpVertices++];T.x=H.x+(j.x-H.x)*aa,T.y=H.y+(j.y-H.y)*aa,T.wx=H.wx+(j.wx-H.wx)*aa,T.wy=H.wy+(j.wy-H.wy)*aa,T.wz=H.wz+(j.wz-H.wz)*aa}}var ca=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=ca,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}reduce(){if(!(this.numVertices<4)){for(var a=-1/0,t=1/0,i=-1/0,o=1/0,r=null,e=null,_=null,h=null,v=1,s=1,l=-1,x=1,b=0,f=this.numVertices;b<f;){var n=b++,c=this.vertices[n],z=c.x*v+c.y*s,p=c.x*l+c.y*x;z>a&&(a=z,r=c),z<t&&(t=z,e=c),p>i&&(i=p,_=c),p<o&&(o=p,h=c)}var y=this.tmpVertices[this.numTmpVertices++];y.x=r.x,y.y=r.y,y.wx=r.wx,y.wy=r.wy,y.wz=r.wz;var V=this.tmpVertices[this.numTmpVertices++];V.x=_.x,V.y=_.y,V.wx=_.wx,V.wy=_.wy,V.wz=_.wz;var M=this.tmpVertices[this.numTmpVertices++];M.x=e.x,M.y=e.y,M.wx=e.wx,M.wy=e.wy,M.wz=e.wz;var I=this.tmpVertices[this.numTmpVertices++];I.x=h.x,I.y=h.y,I.wx=h.wx,I.wy=h.wy,I.wz=h.wz;var k=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=k,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}}};u.collision.narrowphase.detector.BoxBoxDetectorMacro=class{};u.collision.narrowphase.detector.CachedDetectorData=class{constructor(){}_clear(){this._gjkCache!=null&&this._gjkCache.clear()}};u.collision.narrowphase.detector.CapsuleCapsuleDetector=class extends u.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(a,t,i,o,r,e){var _=t,h=i;a.incremental=!1;var v,s,l,x,b,f;v=o._rotation01,s=o._rotation11,l=o._rotation21,x=r._rotation01,b=r._rotation11,f=r._rotation21;var n=_._halfHeight,c=h._halfHeight,z=_._radius,p=h._radius,y,V,M,I,k,X,L,m,g,N,d,F;y=o._positionX+v*-n,V=o._positionY+s*-n,M=o._positionZ+l*-n,I=o._positionX+v*n,k=o._positionY+s*n,X=o._positionZ+l*n,L=r._positionX+x*-c,m=r._positionY+b*-c,g=r._positionZ+f*-c,N=r._positionX+x*c,d=r._positionY+b*c,F=r._positionZ+f*c;var S,Y,Q;S=y-L,Y=V-m,Q=M-g;var C,B,Z,$,K,E;C=I-y,B=k-V,Z=X-M,$=N-L,K=d-m,E=F-g;var J=-(S*C+Y*B+Q*Z),A=S*$+Y*K+Q*E,R=n*n*4,U=C*$+B*K+Z*E,G=c*c*4,D,H;if(R==0&&G==0)D=0,H=0;else if(R==0)D=0,H=A,H<0?H=0:H>G?H=1:H/=G;else if(G==0)H=0,D=J,D<0?D=0:D>R?D=1:D/=R;else{var j=R*G-U*U;j==0?D=0:(D=U*A+G*J,D<0?D=0:D>j?D=1:D/=j),H=D*U+A,H<0?(H=0,D=J,D<0?D=0:D>R?D=1:D/=R):H>G?(H=1,D=U+J,D<0?D=0:D>R?D=1:D/=R):H/=G}var ia,ea,W,q,na,oa;ia=y+C*D,ea=V+B*D,W=M+Z*D,q=L+$*H,na=m+K*H,oa=g+E*H;var aa,T,ca;aa=ia-q,T=ea-na,ca=W-oa;var _a=aa*aa+T*T+ca*ca;if(!(_a>=(z+p)*(z+p))){var w=Math.sqrt(_a),ta,ra,la;w>0?(ta=aa*(1/w),ra=T*(1/w),la=ca*(1/w)):(ta=1,ra=0,la=0),this.setNormal(a,ta,ra,la);var va,ua,za,Ma,Xa,Za;va=ia+ta*-z,ua=ea+ra*-z,za=W+la*-z,Ma=q+ta*p,Xa=na+ra*p,Za=oa+la*p,this.addPoint(a,va,ua,za,Ma,Xa,Za,z+p-w,0)}}};u.collision.narrowphase.detector.GjkEpaDetector=class extends u.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(a,t,i,o,r,e){var _=u.collision.narrowphase.detector.gjkepa.GjkEpa.instance,h=t,v=i,s=_.computeClosestPointsImpl(h,v,o,r,u.common.Setting.enableGJKCaching?e:null,!0);if(a.incremental=!0,s!=u.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED){console.log("src/oimo/collision/narrowphase/detector/GjkEpaDetector.hx:28:","GJK/EPA failed: status="+s);return}var l=h._gjkMargin,x=v._gjkMargin;if(!(_.distance>l+x)){var b,f,n,c,z,p,y=_.closestPoint1;b=y.x,f=y.y,n=y.z;var V=_.closestPoint2;c=V.x,z=V.y,p=V.z;var M,I,k;if(M=b-c,I=f-z,k=n-p,M*M+I*I+k*k!=0){_.distance<0&&(M=-M,I=-I,k=-k);var X=M*M+I*I+k*k;X>0&&(X=1/Math.sqrt(X)),M*=X,I*=X,k*=X,this.setNormal(a,M,I,k),b+=M*-h._gjkMargin,f+=I*-h._gjkMargin,n+=k*-h._gjkMargin,c+=M*v._gjkMargin,z+=I*v._gjkMargin,p+=k*v._gjkMargin,this.addPoint(a,b,f,n,c,z,p,h._gjkMargin+v._gjkMargin-_.distance,0)}}}};u.collision.narrowphase.detector.SphereBoxDetector=class extends u.collision.narrowphase.detector.Detector{constructor(a){super(a)}detectImpl(a,t,i,o,r,e){var _=t,h=i;a.incremental=!1;var v,s,l,x,b,f;v=h._halfExtentsX,s=h._halfExtentsY,l=h._halfExtentsZ,x=-v,b=-s,f=-l;var n=_._radius,c,z,p;c=o._positionX-r._positionX,z=o._positionY-r._positionY,p=o._positionZ-r._positionZ;var y,V,M,I,k,X;I=r._rotation00*c+r._rotation10*z+r._rotation20*p,k=r._rotation01*c+r._rotation11*z+r._rotation21*p,X=r._rotation02*c+r._rotation12*z+r._rotation22*p,y=I,V=k,M=X;var L=x<y&&v>y&&b<V&&s>V&&f<M&&l>M;if(L){var m,g,N;m=y<0?-y:y,g=V<0?-V:V,N=M<0?-M:M,m=v-m,g=s-g,N=l-N;var d,F,S,Y=m,Q=g,C=N,B,Z,$,K;Y<Q?Y<C?(y>0?(d=1,F=0,S=0):(d=-1,F=0,S=0),Z=0,$=1,K=1,B=Y):(M>0?(d=0,F=0,S=1):(d=0,F=0,S=-1),Z=1,$=1,K=0,B=C):Q<C?(V>0?(d=0,F=1,S=0):(d=0,F=-1,S=0),Z=1,$=0,K=1,B=Q):(M>0?(d=0,F=0,S=1):(d=0,F=0,S=-1),Z=1,$=1,K=0,B=C);var E,J,A;E=Z*y,J=$*V,A=K*M;var R,U,G;R=d*v,U=F*s,G=S*l,R+=E,U+=J,G+=A;var D,H,j,ia,ea,W,q,na,oa;q=r._rotation00*R+r._rotation01*U+r._rotation02*G,na=r._rotation10*R+r._rotation11*U+r._rotation12*G,oa=r._rotation20*R+r._rotation21*U+r._rotation22*G,D=q,H=na,j=oa;var aa,T,ca;aa=r._rotation00*d+r._rotation01*F+r._rotation02*S,T=r._rotation10*d+r._rotation11*F+r._rotation12*S,ca=r._rotation20*d+r._rotation21*F+r._rotation22*S,ia=aa,ea=T,W=ca,this.setNormal(a,ia,ea,W);var _a,w,ta,ra,la,va;_a=o._positionX+ia*-n,w=o._positionY+ea*-n,ta=o._positionZ+W*-n,ra=r._positionX+D,la=r._positionY+H,va=r._positionZ+j,this.addPoint(a,_a,w,ta,ra,la,va,B,0);return}var ua,za,Ma,Xa=1e-9,Za,fa,ba;Za=Xa,fa=Xa,ba=Xa,v-=Za,s-=fa,l-=ba,x+=Za,b+=fa,f+=ba,ua=y<v?y:v,za=V<s?V:s,Ma=M<l?M:l,ua=ua>x?ua:x,za=za>b?za:b,Ma=Ma>f?Ma:f;var sa,ha,ma;sa=y-ua,ha=V-za,ma=M-Ma;var ya=sa*sa+ha*ha+ma*ma;if(!(ya>=n*n)){ya=Math.sqrt(ya);var Ba,pa,Ya,Ra,ga,xa,wa,ka,Pa;wa=r._rotation00*ua+r._rotation01*za+r._rotation02*Ma,ka=r._rotation10*ua+r._rotation11*za+r._rotation12*Ma,Pa=r._rotation20*ua+r._rotation21*za+r._rotation22*Ma,Ba=wa,pa=ka,Ya=Pa;var zt,Oa,Aa;zt=r._rotation00*sa+r._rotation01*ha+r._rotation02*ma,Oa=r._rotation10*sa+r._rotation11*ha+r._rotation12*ma,Aa=r._rotation20*sa+r._rotation21*ha+r._rotation22*ma,Ra=zt,ga=Oa,xa=Aa;var nt,Ea,Fa,da=Ra*Ra+ga*ga+xa*xa;da>0&&(da=1/Math.sqrt(da)),nt=Ra*da,Ea=ga*da,Fa=xa*da,this.setNormal(a,nt,Ea,Fa);var ft,Wa,Ha,bt,it,Ka;ft=o._positionX+nt*-n,Wa=o._positionY+Ea*-n,Ha=o._positionZ+Fa*-n,bt=r._positionX+Ba,it=r._positionY+pa,Ka=r._positionZ+Ya,this.addPoint(a,ft,Wa,Ha,bt,it,Ka,n-ya,0)}}};u.collision.narrowphase.detector.SphereCapsuleDetector=class extends u.collision.narrowphase.detector.Detector{constructor(a){super(a)}detectImpl(a,t,i,o,r,e){var _=t,h=i;a.incremental=!1;var v=h._halfHeight,s=_._radius,l=h._radius,x,b,f;x=r._rotation01,b=r._rotation11,f=r._rotation21;var n,c,z;n=o._positionX,c=o._positionY,z=o._positionZ;var p,y,V,M,I,k;p=r._positionX+x*-v,y=r._positionY+b*-v,V=r._positionZ+f*-v,M=r._positionX+x*v,I=r._positionY+b*v,k=r._positionZ+f*v;var X,L,m;X=n-p,L=c-y,m=z-V;var g,N,d;g=M-p,N=I-y,d=k-V;var F=v*v*4,S=X*g+L*N+m*d;S<0?S=0:S>F?S=1:S/=F;var Y,Q,C;Y=p+g*S,Q=y+N*S,C=V+d*S;var B,Z,$;B=n-Y,Z=c-Q,$=z-C;var K=B*B+Z*Z+$*$;if(!(K>=(s+l)*(s+l))){var E=Math.sqrt(K),J,A,R;E>0?(J=B*(1/E),A=Z*(1/E),R=$*(1/E)):(J=1,A=0,R=0),this.setNormal(a,J,A,R);var U,G,D,H,j,ia;U=n+J*-s,G=c+A*-s,D=z+R*-s,H=Y+J*l,j=Q+A*l,ia=C+R*l,this.addPoint(a,U,G,D,H,j,ia,s+l-E,0)}}};u.collision.narrowphase.detector.SphereSphereDetector=class extends u.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(a,t,i,o,r,e){var _=t,h=i;a.incremental=!1;var v,s,l;v=o._positionX-r._positionX,s=o._positionY-r._positionY,l=o._positionZ-r._positionZ;var x=_._radius,b=h._radius,f=v*v+s*s+l*l;if(!(f>=(x+b)*(x+b))){var n=Math.sqrt(f),c,z,p;n>0?(c=v*(1/n),z=s*(1/n),p=l*(1/n)):(c=1,z=0,p=0),this.setNormal(a,c,z,p);var y,V,M,I,k,X;y=o._positionX+c*-x,V=o._positionY+z*-x,M=o._positionZ+p*-x,I=r._positionX+c*b,k=r._positionY+z*b,X=r._positionZ+p*b,this.addPoint(a,y,V,M,I,k,X,x+b-n,0)}}};u.collision.narrowphase.detector.gjkepa||(u.collision.narrowphase.detector.gjkepa={});u.collision.narrowphase.detector.gjkepa.EpaPolyhedron=class{constructor(){var a=new Array(u.common.Setting.maxEPAVertices);this._vertices=a,this._center=new u.common.Vec3,this._numVertices=0,this._triangleList=null,this._triangleListLast=null,this._numTriangles=0,this._trianglePool=null,this._vertexPool=null}dumpHoleEdge(a){}validate(){for(var a=this._triangleList;a!=null;){var t=a._next;if(a._vertices[0]._tmpEdgeLoopOuterTriangle=null,a._vertices[0]._tmpEdgeLoopNext=null,a._adjacentPairIndex[0]==-1)return this._status=2,!1;if(a._adjacentTriangles[0]==null)return this._status=3,!1;if(a._vertices[1]._tmpEdgeLoopOuterTriangle=null,a._vertices[1]._tmpEdgeLoopNext=null,a._adjacentPairIndex[1]==-1)return this._status=2,!1;if(a._adjacentTriangles[1]==null)return this._status=3,!1;if(a._vertices[2]._tmpEdgeLoopOuterTriangle=null,a._vertices[2]._tmpEdgeLoopNext=null,a._adjacentPairIndex[2]==-1)return this._status=2,!1;if(a._adjacentTriangles[2]==null)return this._status=3,!1;a=t}return!0}findEdgeLoop(a,t,i){if(t._tmpDfsId!=a){t._tmpDfsId=a;var o=t.tmp;o.x=i.x,o.y=i.y,o.z=i.z;var r=o,e=t._vertices[0].v,_=r.x-e.x,h=r.y-e.y,v=r.z-e.z;r.x=_,r.y=h,r.z=v;var s=t.tmp,l=t._normal;if(t._tmpDfsVisible=s.x*l.x+s.y*l.y+s.z*l.z>0,!t._tmpDfsVisible){this._status=6;return}for(var x=0;x<3;){var b=x++,f=t._adjacentTriangles[b];if(f!=null){var n=f.tmp;n.x=i.x,n.y=i.y,n.z=i.z;var c=n,z=f._vertices[0].v,p=c.x-z.x,y=c.y-z.y,V=c.z-z.z;c.x=p,c.y=y,c.z=V;var M=f.tmp,I=f._normal;if(f._tmpDfsVisible=M.x*I.x+M.y*I.y+M.z*I.z>0,f._tmpDfsVisible)this.findEdgeLoop(a,f,i);else{var k=t._nextIndex[b],X=t._vertices[b],L=t._vertices[k];X._tmpEdgeLoopNext=L,X._tmpEdgeLoopOuterTriangle=f}}}var m=t._adjacentTriangles[0];if(m!=null){var g=t._adjacentPairIndex[0];m._adjacentTriangles[g]=null,m._adjacentPairIndex[g]=-1,t._adjacentTriangles[0]=null,t._adjacentPairIndex[0]=-1}var N=t._adjacentTriangles[1];if(N!=null){var d=t._adjacentPairIndex[1];N._adjacentTriangles[d]=null,N._adjacentPairIndex[d]=-1,t._adjacentTriangles[1]=null,t._adjacentPairIndex[1]=-1}var F=t._adjacentTriangles[2];if(F!=null){var S=t._adjacentPairIndex[2];F._adjacentTriangles[S]=null,F._adjacentPairIndex[S]=-1,t._adjacentTriangles[2]=null,t._adjacentPairIndex[2]=-1}this._numTriangles--;var Y=t._prev,Q=t._next;Y!=null&&(Y._next=Q),Q!=null&&(Q._prev=Y),t==this._triangleList&&(this._triangleList=this._triangleList._next),t==this._triangleListLast&&(this._triangleListLast=this._triangleListLast._prev),t._next=null,t._prev=null,t.removeReferences(),t._next=this._trianglePool,this._trianglePool=t}}_init(a,t,i,o){this._status=0,this._numVertices=4,this._vertices[0]=a,this._vertices[1]=t,this._vertices[2]=i,this._vertices[3]=o;var r=this._center,e=a.v;r.x=e.x,r.y=e.y,r.z=e.z;var _=r,h=t.v,v=_.x+h.x,s=_.y+h.y,l=_.z+h.z;_.x=v,_.y=s,_.z=l;var x=_,b=i.v,f=x.x+b.x,n=x.y+b.y,c=x.z+b.z;x.x=f,x.y=n,x.z=c;var z=x,p=o.v,y=z.x+p.x,V=z.y+p.y,M=z.z+p.z;z.x=y,z.y=V,z.z=M;var I=z,k=I.x*.25,X=I.y*.25,L=I.z*.25;I.x=k,I.y=X,I.z=L;var m=this._trianglePool;m!=null?(this._trianglePool=m._next,m._next=null):m=new u.collision.narrowphase.detector.gjkepa.EpaTriangle;var g=m,N=this._trianglePool;N!=null?(this._trianglePool=N._next,N._next=null):N=new u.collision.narrowphase.detector.gjkepa.EpaTriangle;var d=N,F=this._trianglePool;F!=null?(this._trianglePool=F._next,F._next=null):F=new u.collision.narrowphase.detector.gjkepa.EpaTriangle;var S=F,Y=this._trianglePool;Y!=null?(this._trianglePool=Y._next,Y._next=null):Y=new u.collision.narrowphase.detector.gjkepa.EpaTriangle;var Q=Y,C=!0;g.init(a,t,i,this._center,C)||(this._status=1);var B=!0;d.init(a,t,o,this._center,B)||(this._status=1);var Z=!0;S.init(a,i,o,this._center,Z)||(this._status=1);var $=!0;return Q.init(t,i,o,this._center,$)||(this._status=1),g.setAdjacentTriangle(d)||(this._status=1),g.setAdjacentTriangle(S)||(this._status=1),g.setAdjacentTriangle(Q)||(this._status=1),d.setAdjacentTriangle(S)||(this._status=1),d.setAdjacentTriangle(Q)||(this._status=1),S.setAdjacentTriangle(Q)||(this._status=1),this._numTriangles++,this._triangleList==null?(this._triangleList=g,this._triangleListLast=g):(this._triangleListLast._next=g,g._prev=this._triangleListLast,this._triangleListLast=g),this._numTriangles++,this._triangleList==null?(this._triangleList=d,this._triangleListLast=d):(this._triangleListLast._next=d,d._prev=this._triangleListLast,this._triangleListLast=d),this._numTriangles++,this._triangleList==null?(this._triangleList=S,this._triangleListLast=S):(this._triangleListLast._next=S,S._prev=this._triangleListLast,this._triangleListLast=S),this._numTriangles++,this._triangleList==null?(this._triangleList=Q,this._triangleListLast=Q):(this._triangleListLast._next=Q,Q._prev=this._triangleListLast,this._triangleListLast=Q),this._status==0}_addVertex(a,t){this._vertices[this._numVertices++]=a;var i=t._vertices[0];if(this.findEdgeLoop(this._numVertices,t,a.v),this._status!=0)return!1;for(var o=i,r=i,e=null,_=null;;){if(o._tmpEdgeLoopNext==null)return this._dumpAsObjModel(),this._status=4,!1;if(o._tmpEdgeLoopOuterTriangle==null)return this._status=5,!1;var h=this._trianglePool;h!=null?(this._trianglePool=h._next,h._next=null):h=new u.collision.narrowphase.detector.gjkepa.EpaTriangle;var v=h;if(_==null&&(_=v),v.init(o,o._tmpEdgeLoopNext,a,this._center,!1)||(this._status=1),this._status!=0)return!1;if(this._numTriangles++,this._triangleList==null?(this._triangleList=v,this._triangleListLast=v):(this._triangleListLast._next=v,v._prev=this._triangleListLast,this._triangleListLast=v),v.setAdjacentTriangle(o._tmpEdgeLoopOuterTriangle)||(this._status=1),e!=null&&(v.setAdjacentTriangle(e)||(this._status=1)),e=v,o=o._tmpEdgeLoopNext,o==r)break}return e.setAdjacentTriangle(_)||(this._status=1),this._status==0?this.validate():!1}_dumpAsObjModel(){}};u.collision.narrowphase.detector.gjkepa.EpaPolyhedronState=class{};u.collision.narrowphase.detector.gjkepa.EpaTriangle=class{constructor(){this.id=++u.collision.narrowphase.detector.gjkepa.EpaTriangle.count,this._next=null,this._prev=null,this._normal=new u.common.Vec3,this._distanceSq=0,this._tmpDfsId=0,this._tmpDfsVisible=!1;var a=new Array(3);this._vertices=a;var t=new Array(3);this._adjacentTriangles=t;var i=new Array(3);this._adjacentPairIndex=i,this.tmp=new u.common.Vec3;var o=new Array(3);this._nextIndex=o,this._nextIndex[0]=1,this._nextIndex[1]=2,this._nextIndex[2]=0}init(a,t,i,o,r){r==null&&(r=!1);var e,_,h,v,s,l,x,b,f,n,c,z,p=a.v;e=p.x,_=p.y,h=p.z;var y=t.v;v=y.x,s=y.y,l=y.z;var V=i.v;x=V.x,b=V.y,f=V.z;var M=o;n=M.x,c=M.y,z=M.z;var I,k,X,L,m,g,N,d,F;I=v-e,k=s-_,X=l-h,L=x-e,m=b-_,g=f-h,N=e-n,d=_-c,F=h-z;var S,Y,Q;S=k*g-X*m,Y=X*L-I*g,Q=I*m-k*L;var C=!1,B=N*S+d*Y+F*Q;if(B<0)if(r){var Z=t;t=i,i=Z,S*=-1,Y*=-1,Q*=-1}else C=!0;this._vertices[0]=a,this._vertices[1]=t,this._vertices[2]=i;var $=this._normal;$.x=S,$.y=Y,$.z=Q;var K=a.v,E=t.v,J=i.v,A=this.tmp,R,U,G,D,H,j,ia,ea,W,q,na,oa,aa,T,ca,_a,w,ta,ra=K;R=ra.x,U=ra.y,G=ra.z;var la=E;D=la.x,H=la.y,j=la.z;var va=J;ia=va.x,ea=va.y,W=va.z,q=D-R,na=H-U,oa=j-G,aa=ia-D,T=ea-H,ca=W-j,_a=R-ia,w=U-ea,ta=G-W;var ua,za,Ma;ua=na*ca-oa*T,za=oa*aa-q*ca,Ma=q*T-na*aa;var Xa,Za,fa,ba,sa,ha,ma,ya,Ba;Xa=na*Ma-oa*za,Za=oa*ua-q*Ma,fa=q*za-na*ua,ba=T*Ma-ca*za,sa=ca*ua-aa*Ma,ha=aa*za-T*ua,ma=w*Ma-ta*za,ya=ta*ua-_a*Ma,Ba=_a*za-w*ua;var pa=R*Xa+U*Za+G*fa,Ya=D*ba+H*sa+j*ha,Ra=ia*ma+ea*ya+W*Ba,ga=-1,xa,wa,ka;if(xa=0,wa=0,ka=0,pa<0){var Pa,zt,Oa,Aa,nt,Ea,Fa=K;Pa=Fa.x,zt=Fa.y,Oa=Fa.z;var da=E;Aa=da.x,nt=da.y,Ea=da.z;var ft,Wa,Ha;ft=Aa-Pa,Wa=nt-zt,Ha=Ea-Oa;var bt=ft*ft+Wa*Wa+Ha*Ha,it=ft*Pa+Wa*zt+Ha*Oa;if(it=-it/bt,it<0){var Ka=A;Ka.x=Pa,Ka.y=zt,Ka.z=Oa}else if(it>1){var _t=A;_t.x=Aa,_t.y=nt,_t.z=Ea}else{var gt,pt,Ga;gt=Pa+ft*it,pt=zt+Wa*it,Ga=Oa+Ha*it;var rt=A;rt.x=gt,rt.y=pt,rt.z=Ga}var xt=A.x*A.x+A.y*A.y+A.z*A.z;ga=xt;var Da=A;xa=Da.x,wa=Da.y,ka=Da.z}if(Ya<0){var Ta,Na,Vt,Pt,st,Xt,Yt=E;Ta=Yt.x,Na=Yt.y,Vt=Yt.z;var Mt=J;Pt=Mt.x,st=Mt.y,Xt=Mt.z;var Ia,O,Va;Ia=Pt-Ta,O=st-Na,Va=Xt-Vt;var lt=Ia*Ia+O*O+Va*Va,P=Ia*Ta+O*Na+Va*Vt;if(P=-P/lt,P<0){var wt=A;wt.x=Ta,wt.y=Na,wt.z=Vt}else if(P>1){var At=A;At.x=Pt,At.y=st,At.z=Xt}else{var dt,yt,kt;dt=Ta+Ia*P,yt=Na+O*P,kt=Vt+Va*P;var mt=A;mt.x=dt,mt.y=yt,mt.z=kt}var ht=A.x*A.x+A.y*A.y+A.z*A.z;if(ga<0||ht<ga){ga=ht;var ut=A;xa=ut.x,wa=ut.y,ka=ut.z}}if(Ra<0){var Qa,et,Ca,vt,qa,at,Ua=K;Qa=Ua.x,et=Ua.y,Ca=Ua.z;var tt=J;vt=tt.x,qa=tt.y,at=tt.z;var ct,Sa,Ja;ct=vt-Qa,Sa=qa-et,Ja=at-Ca;var ja=ct*ct+Sa*Sa+Ja*Ja,La=ct*Qa+Sa*et+Ja*Ca;if(La=-La/ja,La<0){var ot=A;ot.x=Qa,ot.y=et,ot.z=Ca}else if(La>1){var It=A;It.x=vt,It.y=qa,It.z=at}else{var oi,gi,ai;oi=Qa+ct*La,gi=et+Sa*La,ai=Ca+Ja*La;var Ct=A;Ct.x=oi,Ct.y=gi,Ct.z=ai}var _i=A.x*A.x+A.y*A.y+A.z*A.z;if(ga<0||_i<ga){ga=_i;var Et=A;xa=Et.x,wa=Et.y,ka=Et.z}}if(ga>0){var St=A;St.x=xa,St.y=wa,St.z=ka}else{var Jt=ua*ua+za*za+Ma*Ma;Jt>0&&(Jt=1/Math.sqrt(Jt)),ua*=Jt,za*=Jt,Ma*=Jt;var Ki=R*ua+U*za+G*Ma,vi=ua*ua+za*za+Ma*Ma;vi=Ki/vi,xa=ua*vi,wa=za*vi,ka=Ma*vi;var li=A;li.x=xa,li.y=wa,li.z=ka}var ti=this.tmp;return this._distanceSq=ti.x*ti.x+ti.y*ti.y+ti.z*ti.z,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=-1,this._adjacentPairIndex[1]=-1,this._adjacentPairIndex[2]=-1,!C}setAdjacentTriangle(a){var t=0,i=this._nextIndex[0],o=this._nextIndex[0];this._vertices[0]==a._vertices[o]&&this._vertices[i]==a._vertices[0]&&(this._adjacentTriangles[0]=a,this._adjacentPairIndex[0]=0,a._adjacentTriangles[0]=this,a._adjacentPairIndex[0]=0,++t);var r=this._nextIndex[0],e=this._nextIndex[1];this._vertices[0]==a._vertices[e]&&this._vertices[r]==a._vertices[1]&&(this._adjacentTriangles[0]=a,this._adjacentPairIndex[0]=1,a._adjacentTriangles[1]=this,a._adjacentPairIndex[1]=0,++t);var _=this._nextIndex[0],h=this._nextIndex[2];this._vertices[0]==a._vertices[h]&&this._vertices[_]==a._vertices[2]&&(this._adjacentTriangles[0]=a,this._adjacentPairIndex[0]=2,a._adjacentTriangles[2]=this,a._adjacentPairIndex[2]=0,++t);var v=this._nextIndex[1],s=this._nextIndex[0];this._vertices[1]==a._vertices[s]&&this._vertices[v]==a._vertices[0]&&(this._adjacentTriangles[1]=a,this._adjacentPairIndex[1]=0,a._adjacentTriangles[0]=this,a._adjacentPairIndex[0]=1,++t);var l=this._nextIndex[1],x=this._nextIndex[1];this._vertices[1]==a._vertices[x]&&this._vertices[l]==a._vertices[1]&&(this._adjacentTriangles[1]=a,this._adjacentPairIndex[1]=1,a._adjacentTriangles[1]=this,a._adjacentPairIndex[1]=1,++t);var b=this._nextIndex[1],f=this._nextIndex[2];this._vertices[1]==a._vertices[f]&&this._vertices[b]==a._vertices[2]&&(this._adjacentTriangles[1]=a,this._adjacentPairIndex[1]=2,a._adjacentTriangles[2]=this,a._adjacentPairIndex[2]=1,++t);var n=this._nextIndex[2],c=this._nextIndex[0];this._vertices[2]==a._vertices[c]&&this._vertices[n]==a._vertices[0]&&(this._adjacentTriangles[2]=a,this._adjacentPairIndex[2]=0,a._adjacentTriangles[0]=this,a._adjacentPairIndex[0]=2,++t);var z=this._nextIndex[2],p=this._nextIndex[1];this._vertices[2]==a._vertices[p]&&this._vertices[z]==a._vertices[1]&&(this._adjacentTriangles[2]=a,this._adjacentPairIndex[2]=1,a._adjacentTriangles[1]=this,a._adjacentPairIndex[1]=2,++t);var y=this._nextIndex[2],V=this._nextIndex[2];return this._vertices[2]==a._vertices[V]&&this._vertices[y]==a._vertices[2]&&(this._adjacentTriangles[2]=a,this._adjacentPairIndex[2]=2,a._adjacentTriangles[2]=this,a._adjacentPairIndex[2]=2,++t),t==1}removeAdjacentTriangles(){var a=this._adjacentTriangles[0];if(a!=null){var t=this._adjacentPairIndex[0];a._adjacentTriangles[t]=null,a._adjacentPairIndex[t]=-1,this._adjacentTriangles[0]=null,this._adjacentPairIndex[0]=-1}var i=this._adjacentTriangles[1];if(i!=null){var o=this._adjacentPairIndex[1];i._adjacentTriangles[o]=null,i._adjacentPairIndex[o]=-1,this._adjacentTriangles[1]=null,this._adjacentPairIndex[1]=-1}var r=this._adjacentTriangles[2];if(r!=null){var e=this._adjacentPairIndex[2];r._adjacentTriangles[e]=null,r._adjacentPairIndex[e]=-1,this._adjacentTriangles[2]=null,this._adjacentPairIndex[2]=-1}}removeReferences(){this._next=null,this._prev=null,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._distanceSq=0,this._vertices[0]=null,this._vertices[1]=null,this._vertices[2]=null,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=0,this._adjacentPairIndex[1]=0,this._adjacentPairIndex[2]=0}dump(){}};u.collision.narrowphase.detector.gjkepa.EpaVertex=class{constructor(){this.randId=Math.random()*1e5|0,this.v=new u.common.Vec3,this.w1=new u.common.Vec3,this.w2=new u.common.Vec3}init(a,t,i){var o=this.v;o.x=a.x,o.y=a.y,o.z=a.z;var r=this.w1;r.x=t.x,r.y=t.y,r.z=t.z;var e=this.w2;return e.x=i.x,e.y=i.y,e.z=i.z,this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null,this}removeReferences(){this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null}};u.collision.narrowphase.detector.gjkepa.GjkCache=class{constructor(){this.prevClosestDir=new u.common.Vec3}clear(){this.prevClosestDir.zero()}};u.common||(u.common={});u.common.Vec3=class{constructor(a,t,i){i==null&&(i=0),t==null&&(t=0),a==null&&(a=0),this.x=a,this.y=t,this.z=i,u.common.Vec3.numCreations++}init(a,t,i){return this.x=a,this.y=t,this.z=i,this}zero(){var a=0,t=0,i=0;return this.x=a,this.y=t,this.z=i,this}add(a){return new u.common.Vec3(this.x+a.x,this.y+a.y,this.z+a.z)}add3(a,t,i){return new u.common.Vec3(this.x+a,this.y+t,this.z+i)}addScaled(a,t){return new u.common.Vec3(this.x+a.x*t,this.y+a.y*t,this.z+a.z*t)}sub(a){return new u.common.Vec3(this.x-a.x,this.y-a.y,this.z-a.z)}sub3(a,t,i){return new u.common.Vec3(this.x-a,this.y-t,this.z-i)}scale(a){return new u.common.Vec3(this.x*a,this.y*a,this.z*a)}scale3(a,t,i){return new u.common.Vec3(this.x*a,this.y*t,this.z*i)}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z}cross(a){return new u.common.Vec3(this.y*a.z-this.z*a.y,this.z*a.x-this.x*a.z,this.x*a.y-this.y*a.x)}addEq(a){var t=this.x+a.x,i=this.y+a.y,o=this.z+a.z;return this.x=t,this.y=i,this.z=o,this}add3Eq(a,t,i){var o=this.x+a,r=this.y+t,e=this.z+i;return this.x=o,this.y=r,this.z=e,this}addScaledEq(a,t){var i=this.x+a.x*t,o=this.y+a.y*t,r=this.z+a.z*t;return this.x=i,this.y=o,this.z=r,this}subEq(a){var t=this.x-a.x,i=this.y-a.y,o=this.z-a.z;return this.x=t,this.y=i,this.z=o,this}sub3Eq(a,t,i){var o=this.x-a,r=this.y-t,e=this.z-i;return this.x=o,this.y=r,this.z=e,this}scaleEq(a){var t=this.x*a,i=this.y*a,o=this.z*a;return this.x=t,this.y=i,this.z=o,this}scale3Eq(a,t,i){var o=this.x*a,r=this.y*t,e=this.z*i;return this.x=o,this.y=r,this.z=e,this}crossEq(a){var t=this.y*a.z-this.z*a.y,i=this.z*a.x-this.x*a.z,o=this.x*a.y-this.y*a.x;return this.x=t,this.y=i,this.z=o,this}mulMat3(a){return new u.common.Vec3(this.x*a.e00+this.y*a.e01+this.z*a.e02,this.x*a.e10+this.y*a.e11+this.z*a.e12,this.x*a.e20+this.y*a.e21+this.z*a.e22)}mulMat4(a){return new u.common.Vec3(this.x*a.e00+this.y*a.e01+this.z*a.e02+a.e03,this.x*a.e10+this.y*a.e11+this.z*a.e12+a.e13,this.x*a.e20+this.y*a.e21+this.z*a.e22+a.e23)}mulTransform(a){var t,i,o,r=this;t=r.x,i=r.y,o=r.z;var e,_,h;e=a._rotation00*t+a._rotation01*i+a._rotation02*o,_=a._rotation10*t+a._rotation11*i+a._rotation12*o,h=a._rotation20*t+a._rotation21*i+a._rotation22*o,t=e,i=_,o=h,t+=a._positionX,i+=a._positionY,o+=a._positionZ;var v=new u.common.Vec3,s=v;return s.x=t,s.y=i,s.z=o,v}mulMat3Eq(a){var t=this.x*a.e00+this.y*a.e01+this.z*a.e02,i=this.x*a.e10+this.y*a.e11+this.z*a.e12,o=this.x*a.e20+this.y*a.e21+this.z*a.e22;return this.x=t,this.y=i,this.z=o,this}mulMat4Eq(a){var t=this.x*a.e00+this.y*a.e01+this.z*a.e02+a.e03,i=this.x*a.e10+this.y*a.e11+this.z*a.e12+a.e13,o=this.x*a.e20+this.y*a.e21+this.z*a.e22+a.e23;return this.x=t,this.y=i,this.z=o,this}mulTransformEq(a){var t,i,o,r=this;t=r.x,i=r.y,o=r.z;var e,_,h;e=a._rotation00*t+a._rotation01*i+a._rotation02*o,_=a._rotation10*t+a._rotation11*i+a._rotation12*o,h=a._rotation20*t+a._rotation21*i+a._rotation22*o,t=e,i=_,o=h,t+=a._positionX,i+=a._positionY,o+=a._positionZ;var v=this;return v.x=t,v.y=i,v.z=o,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}normalized(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return a>0&&(a=1/a),new u.common.Vec3(this.x*a,this.y*a,this.z*a)}normalize(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);a>0&&(a=1/a);var t=this.x*a,i=this.y*a,o=this.z*a;return this.x=t,this.y=i,this.z=o,this}negate(){return new u.common.Vec3(-this.x,-this.y,-this.z)}negateEq(){var a=-this.x,t=-this.y,i=-this.z;return this.x=a,this.y=t,this.z=i,this}copyFrom(a){return this.x=a.x,this.y=a.y,this.z=a.z,this}clone(){return new u.common.Vec3(this.x,this.y,this.z)}toString(){return"Vec3["+(this.x>0?(this.x*1e7+.5|0)/1e7:(this.x*1e7-.5|0)/1e7)+", "+(this.y>0?(this.y*1e7+.5|0)/1e7:(this.y*1e7-.5|0)/1e7)+", "+(this.z>0?(this.z*1e7+.5|0)/1e7:(this.z*1e7-.5|0)/1e7)+"]"}};u.common.Transform=class{constructor(){this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1}identity(){return this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1,this}getPosition(){var a=new u.common.Vec3,t=a;return t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ,a}getPositionTo(a){var t=a;t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ}setPosition(a){var t=a;return this._positionX=t.x,this._positionY=t.y,this._positionZ=t.z,this}translate(a){var t,i,o,r=a;t=r.x,i=r.y,o=r.z,this._positionX+=t,this._positionY+=i,this._positionZ+=o}getRotation(){var a=new u.common.Mat3,t=a;return t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22,a}getRotationTo(a){var t=a;t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22}setRotation(a){var t=a;return this._rotation00=t.e00,this._rotation01=t.e01,this._rotation02=t.e02,this._rotation10=t.e10,this._rotation11=t.e11,this._rotation12=t.e12,this._rotation20=t.e20,this._rotation21=t.e21,this._rotation22=t.e22,this}setRotationXyz(a){var t,i,o,r=a;t=r.x,i=r.y,o=r.z;var e=Math.sin(t),_=Math.sin(i),h=Math.sin(o),v=Math.cos(t),s=Math.cos(i),l=Math.cos(o);this._rotation00=s*l,this._rotation01=-s*h,this._rotation02=_,this._rotation10=v*h+l*e*_,this._rotation11=v*l-e*_*h,this._rotation12=-s*e,this._rotation20=e*h-v*l*_,this._rotation21=l*e+v*_*h,this._rotation22=v*s}rotate(a){var t,i,o,r,e,_,h,v,s,l=a;t=l.e00,i=l.e01,o=l.e02,r=l.e10,e=l.e11,_=l.e12,h=l.e20,v=l.e21,s=l.e22;var x,b,f,n,c,z,p,y,V;x=t*this._rotation00+i*this._rotation10+o*this._rotation20,b=t*this._rotation01+i*this._rotation11+o*this._rotation21,f=t*this._rotation02+i*this._rotation12+o*this._rotation22,n=r*this._rotation00+e*this._rotation10+_*this._rotation20,c=r*this._rotation01+e*this._rotation11+_*this._rotation21,z=r*this._rotation02+e*this._rotation12+_*this._rotation22,p=h*this._rotation00+v*this._rotation10+s*this._rotation20,y=h*this._rotation01+v*this._rotation11+s*this._rotation21,V=h*this._rotation02+v*this._rotation12+s*this._rotation22,this._rotation00=x,this._rotation01=b,this._rotation02=f,this._rotation10=n,this._rotation11=c,this._rotation12=z,this._rotation20=p,this._rotation21=y,this._rotation22=V}rotateXyz(a){var t,i,o,r,e,_,h,v,s,l,x,b,f=a;t=f.x,i=f.y,o=f.z;var n=Math.sin(t),c=Math.sin(i),z=Math.sin(o),p=Math.cos(t),y=Math.cos(i),V=Math.cos(o);r=y*V,e=-y*z,_=c,h=p*z+V*n*c,v=p*V-n*c*z,s=-y*n,l=n*z-p*V*c,x=V*n+p*c*z,b=p*y;var M,I,k,X,L,m,g,N,d;M=r*this._rotation00+e*this._rotation10+_*this._rotation20,I=r*this._rotation01+e*this._rotation11+_*this._rotation21,k=r*this._rotation02+e*this._rotation12+_*this._rotation22,X=h*this._rotation00+v*this._rotation10+s*this._rotation20,L=h*this._rotation01+v*this._rotation11+s*this._rotation21,m=h*this._rotation02+v*this._rotation12+s*this._rotation22,g=l*this._rotation00+x*this._rotation10+b*this._rotation20,N=l*this._rotation01+x*this._rotation11+b*this._rotation21,d=l*this._rotation02+x*this._rotation12+b*this._rotation22,this._rotation00=M,this._rotation01=I,this._rotation02=k,this._rotation10=X,this._rotation11=L,this._rotation12=m,this._rotation20=g,this._rotation21=N,this._rotation22=d}getOrientation(){var a=new u.common.Quat,t,i,o,r,e=this._rotation00,_=this._rotation11,h=this._rotation22,v=e+_+h,s;v>0?(s=Math.sqrt(v+1),r=.5*s,s=.5/s,t=(this._rotation21-this._rotation12)*s,i=(this._rotation02-this._rotation20)*s,o=(this._rotation10-this._rotation01)*s):e>_?e>h?(s=Math.sqrt(e-_-h+1),t=.5*s,s=.5/s,i=(this._rotation01+this._rotation10)*s,o=(this._rotation02+this._rotation20)*s,r=(this._rotation21-this._rotation12)*s):(s=Math.sqrt(h-e-_+1),o=.5*s,s=.5/s,t=(this._rotation02+this._rotation20)*s,i=(this._rotation12+this._rotation21)*s,r=(this._rotation10-this._rotation01)*s):_>h?(s=Math.sqrt(_-h-e+1),i=.5*s,s=.5/s,t=(this._rotation01+this._rotation10)*s,o=(this._rotation12+this._rotation21)*s,r=(this._rotation02-this._rotation20)*s):(s=Math.sqrt(h-e-_+1),o=.5*s,s=.5/s,t=(this._rotation02+this._rotation20)*s,i=(this._rotation12+this._rotation21)*s,r=(this._rotation10-this._rotation01)*s);var l=a;return l.x=t,l.y=i,l.z=o,l.w=r,a}getOrientationTo(a){var t,i,o,r,e=this._rotation00,_=this._rotation11,h=this._rotation22,v=e+_+h,s;v>0?(s=Math.sqrt(v+1),r=.5*s,s=.5/s,t=(this._rotation21-this._rotation12)*s,i=(this._rotation02-this._rotation20)*s,o=(this._rotation10-this._rotation01)*s):e>_?e>h?(s=Math.sqrt(e-_-h+1),t=.5*s,s=.5/s,i=(this._rotation01+this._rotation10)*s,o=(this._rotation02+this._rotation20)*s,r=(this._rotation21-this._rotation12)*s):(s=Math.sqrt(h-e-_+1),o=.5*s,s=.5/s,t=(this._rotation02+this._rotation20)*s,i=(this._rotation12+this._rotation21)*s,r=(this._rotation10-this._rotation01)*s):_>h?(s=Math.sqrt(_-h-e+1),i=.5*s,s=.5/s,t=(this._rotation01+this._rotation10)*s,o=(this._rotation12+this._rotation21)*s,r=(this._rotation02-this._rotation20)*s):(s=Math.sqrt(h-e-_+1),o=.5*s,s=.5/s,t=(this._rotation02+this._rotation20)*s,i=(this._rotation12+this._rotation21)*s,r=(this._rotation10-this._rotation01)*s);var l=a;l.x=t,l.y=i,l.z=o,l.w=r}setOrientation(a){var t,i,o,r,e=a;t=e.x,i=e.y,o=e.z,r=e.w;var _=t,h=i,v=o,s=r,l=2*_,x=2*h,b=2*v,f=_*l,n=h*x,c=v*b,z=_*x,p=h*b,y=_*b,V=s*l,M=s*x,I=s*b;return this._rotation00=1-n-c,this._rotation01=z-I,this._rotation02=y+M,this._rotation10=z+I,this._rotation11=1-f-c,this._rotation12=p-V,this._rotation20=y-M,this._rotation21=p+V,this._rotation22=1-f-n,this}clone(){var a=new u.common.Transform;return a._positionX=this._positionX,a._positionY=this._positionY,a._positionZ=this._positionZ,a._rotation00=this._rotation00,a._rotation01=this._rotation01,a._rotation02=this._rotation02,a._rotation10=this._rotation10,a._rotation11=this._rotation11,a._rotation12=this._rotation12,a._rotation20=this._rotation20,a._rotation21=this._rotation21,a._rotation22=this._rotation22,a}copyFrom(a){return this._positionX=a._positionX,this._positionY=a._positionY,this._positionZ=a._positionZ,this._rotation00=a._rotation00,this._rotation01=a._rotation01,this._rotation02=a._rotation02,this._rotation10=a._rotation10,this._rotation11=a._rotation11,this._rotation12=a._rotation12,this._rotation20=a._rotation20,this._rotation21=a._rotation21,this._rotation22=a._rotation22,this}};u.common.Setting=class{};u.collision.narrowphase.detector.gjkepa.GjkEpa=class{constructor(){var a=new Array(4);this.s=a;var t=new Array(4);this.w1=t;var i=new Array(4);this.w2=i;var o=new Array(3);this.baseDirs=o,this.baseDirs[0]=new u.common.Vec3(1,0,0),this.baseDirs[1]=new u.common.Vec3(0,1,0),this.baseDirs[2]=new u.common.Vec3(0,0,1),this.tl1=new u.common.Vec3,this.tl2=new u.common.Vec3,this.rayX=new u.common.Vec3,this.rayR=new u.common.Vec3,this.tempTransform=new u.common.Transform,this.s[0]=new u.common.Vec3,this.w1[0]=new u.common.Vec3,this.w2[0]=new u.common.Vec3,this.s[1]=new u.common.Vec3,this.w1[1]=new u.common.Vec3,this.w2[1]=new u.common.Vec3,this.s[2]=new u.common.Vec3,this.w1[2]=new u.common.Vec3,this.w2[2]=new u.common.Vec3,this.s[3]=new u.common.Vec3,this.w1[3]=new u.common.Vec3,this.w2[3]=new u.common.Vec3,this.dir=new u.common.Vec3,this.closest=new u.common.Vec3,this.closestPoint1=new u.common.Vec3,this.closestPoint2=new u.common.Vec3,this.polyhedron=new u.collision.narrowphase.detector.gjkepa.EpaPolyhedron}computeClosestPointsImpl(a,t,i,o,r,e){this.c1=a,this.c2=t,this.tf1=i,this.tf2=o;var _=this.s,h=this.w1,v=this.w2,s=this.closest,l=this.dir;if(r!=null?(r._gjkCache==null&&(r._gjkCache=new u.collision.narrowphase.detector.gjkepa.GjkCache),this.loadCache(r._gjkCache)):l.zero(),l.x*l.x+l.y*l.y+l.z*l.z==0){var x,b,f;x=o._positionX-i._positionX,b=o._positionY-i._positionY,f=o._positionZ-i._positionZ;var n=l;n.x=x,n.y=b,n.z=f,l.x*l.x+l.y*l.y+l.z*l.z<1e-6&&l.init(1,0,0)}this.simplexSize=0,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var c=this.s[this.simplexSize],z=this.w1[this.simplexSize];c.x=z.x,c.y=z.y,c.z=z.z;var p=c,y=this.w2[this.simplexSize],V=p.x-y.x,M=p.y-y.y,I=p.z-y.z;p.x=V,p.y=M,p.z=I,this.simplexSize=1;for(var k=0,X=40,L=1e-4,m=L*L;k<X;){var g=0;switch(this.simplexSize){case 1:var N=_[0];s.x=N.x,s.y=N.y,s.z=N.z,g=1;break;case 2:var d,F,S,Y,Q,C,B=_[0];d=B.x,F=B.y,S=B.z;var Z=_[1];Y=Z.x,Q=Z.y,C=Z.z;var $,K,E;$=Y-d,K=Q-F,E=C-S;var J=$*$+K*K+E*E,A=$*d+K*F+E*S;if(A=-A/J,A<0){var R=s;R.x=d,R.y=F,R.z=S,g=1}else if(A>1){var U=s;U.x=Y,U.y=Q,U.z=C,g=2}else{var G,D,H;G=d+$*A,D=F+K*A,H=S+E*A;var j=s;j.x=G,j.y=D,j.z=H,g=3}break;case 3:var ia=_[0],ea=_[1],W=_[2],q,na,oa,aa,T,ca,_a,w,ta,ra,la,va,ua,za,Ma,Xa,Za,fa,ba=ia;q=ba.x,na=ba.y,oa=ba.z;var sa=ea;aa=sa.x,T=sa.y,ca=sa.z;var ha=W;_a=ha.x,w=ha.y,ta=ha.z,ra=aa-q,la=T-na,va=ca-oa,ua=_a-aa,za=w-T,Ma=ta-ca,Xa=q-_a,Za=na-w,fa=oa-ta;var ma,ya,Ba;ma=la*Ma-va*za,ya=va*ua-ra*Ma,Ba=ra*za-la*ua;var pa,Ya,Ra,ga,xa,wa,ka,Pa,zt;pa=la*Ba-va*ya,Ya=va*ma-ra*Ba,Ra=ra*ya-la*ma,ga=za*Ba-Ma*ya,xa=Ma*ma-ua*Ba,wa=ua*ya-za*ma,ka=Za*Ba-fa*ya,Pa=fa*ma-Xa*Ba,zt=Xa*ya-Za*ma;var Oa=q*pa+na*Ya+oa*Ra,Aa=aa*ga+T*xa+ca*wa,nt=_a*ka+w*Pa+ta*zt,Ea=-1,Fa,da,ft,Wa=0;if(Fa=0,da=0,ft=0,Oa<0){var Ha,bt,it,Ka,_t,gt,pt=ia;Ha=pt.x,bt=pt.y,it=pt.z;var Ga=ea;Ka=Ga.x,_t=Ga.y,gt=Ga.z;var rt,xt,Da;rt=Ka-Ha,xt=_t-bt,Da=gt-it;var Ta=rt*rt+xt*xt+Da*Da,Na=rt*Ha+xt*bt+Da*it;Na=-Na/Ta;var Vt;if(Na<0){var Pt=s;Pt.x=Ha,Pt.y=bt,Pt.z=it,Vt=1}else if(Na>1){var st=s;st.x=Ka,st.y=_t,st.z=gt,Vt=2}else{var Xt,Yt,Mt;Xt=Ha+rt*Na,Yt=bt+xt*Na,Mt=it+Da*Na;var Ia=s;Ia.x=Xt,Ia.y=Yt,Ia.z=Mt,Vt=3}var O=s.x*s.x+s.y*s.y+s.z*s.z;Wa=Vt,Ea=O;var Va=s;Fa=Va.x,da=Va.y,ft=Va.z}if(Aa<0){var lt,P,wt,At,dt,yt,kt=ea;lt=kt.x,P=kt.y,wt=kt.z;var mt=W;At=mt.x,dt=mt.y,yt=mt.z;var ht,ut,Qa;ht=At-lt,ut=dt-P,Qa=yt-wt;var et=ht*ht+ut*ut+Qa*Qa,Ca=ht*lt+ut*P+Qa*wt;Ca=-Ca/et;var vt;if(Ca<0){var qa=s;qa.x=lt,qa.y=P,qa.z=wt,vt=1}else if(Ca>1){var at=s;at.x=At,at.y=dt,at.z=yt,vt=2}else{var Ua,tt,ct;Ua=lt+ht*Ca,tt=P+ut*Ca,ct=wt+Qa*Ca;var Sa=s;Sa.x=Ua,Sa.y=tt,Sa.z=ct,vt=3}var Ja=s.x*s.x+s.y*s.y+s.z*s.z;if(Ea<0||Ja<Ea){Wa=vt<<1,Ea=Ja;var ja=s;Fa=ja.x,da=ja.y,ft=ja.z}}if(nt<0){var La,ot,It,oi,gi,ai,Ct=ia;La=Ct.x,ot=Ct.y,It=Ct.z;var _i=W;oi=_i.x,gi=_i.y,ai=_i.z;var Et,St,Jt;Et=oi-La,St=gi-ot,Jt=ai-It;var Ki=Et*Et+St*St+Jt*Jt,vi=Et*La+St*ot+Jt*It;vi=-vi/Ki;var li;if(vi<0){var ti=s;ti.x=La,ti.y=ot,ti.z=It,li=1}else if(vi>1){var Oi=s;Oi.x=oi,Oi.y=gi,Oi.z=ai,li=2}else{var Xi,zi,Zt;Xi=La+Et*vi,zi=ot+St*vi,Zt=It+Jt*vi;var ri=s;ri.x=Xi,ri.y=zi,ri.z=Zt,li=3}var Wt=s.x*s.x+s.y*s.y+s.z*s.z;if(Ea<0||Wt<Ea){Wa=li&1|(li&2)<<1,Ea=Wt;var ni=s;Fa=ni.x,da=ni.y,ft=ni.z}}if(Ea>0){var $i=s;$i.x=Fa,$i.y=da,$i.z=ft,g=Wa}else{var Ut=ma*ma+ya*ya+Ba*Ba;Ut>0&&(Ut=1/Math.sqrt(Ut)),ma*=Ut,ya*=Ut,Ba*=Ut;var ji=q*ma+na*ya+oa*Ba,Ii=ma*ma+ya*ya+Ba*Ba;Ii=ji/Ii,Fa=ma*Ii,da=ya*Ii,ft=Ba*Ii;var pr=s;pr.x=Fa,pr.y=da,pr.z=ft,g=7}break;case 4:var Wi=_[0],Lt=_[1],jt=_[2],Tt=_[3],bi,Mi,vr,qt,fi,Bt,xi,hi,sr,Xr,ro,Gt,fr,mr,Dt,Br,Si,Dr,Hn,oo,Ar,no,yn,Ao,Io,ui,qr,dr=Wi;bi=dr.x,Mi=dr.y,vr=dr.z;var yr=Lt;qt=yr.x,fi=yr.y,Bt=yr.z;var So=jt;xi=So.x,hi=So.y,sr=So.z;var Di=Tt;Xr=Di.x,ro=Di.y,Gt=Di.z,fr=qt-bi,mr=fi-Mi,Dt=Bt-vr,Br=xi-bi,Si=hi-Mi,Dr=sr-vr,Hn=Xr-bi,oo=ro-Mi,Ar=Gt-vr,no=xi-qt,yn=hi-fi,Ao=sr-Bt,Io=Xr-qt,ui=ro-fi,qr=Gt-Bt;var Sr,gr,Qt,Hi,Li,Cn,Me,js,pe,Ts,qs,D_;Sr=mr*Dr-Dt*Si,gr=Dt*Br-fr*Dr,Qt=fr*Si-mr*Br,Hi=Si*Ar-Dr*oo,Li=Dr*Hn-Br*Ar,Cn=Br*oo-Si*Hn,Me=oo*Dt-Ar*mr,js=Ar*fr-Hn*Dt,pe=Hn*mr-oo*fr,Ts=ui*Ao-qr*yn,qs=qr*no-Io*Ao,D_=Io*yn-ui*no;var gn=fr*Ts+mr*qs+Dt*D_>0?1:-1,Pi=bi*Sr+Mi*gr+vr*Qt,No=bi*Hi+Mi*Li+vr*Cn,Wr=bi*Me+Mi*js+vr*pe,ks=qt*Ts+fi*qs+Bt*D_,on=-1,Tn,Kn,ws,k_=0;if(Tn=0,Kn=0,ws=0,Pi*gn<0){var Qs,Vi,Ir,xr,so,Qn,me,nn,Rn,ci,ho,Fr,En,ae,Rs,Es,Ds,hs,ii=Wi;Qs=ii.x,Vi=ii.y,Ir=ii.z;var ir=Lt;xr=ir.x,so=ir.y,Qn=ir.z;var Ri=jt;me=Ri.x,nn=Ri.y,Rn=Ri.z,ci=xr-Qs,ho=so-Vi,Fr=Qn-Ir,En=me-xr,ae=nn-so,Rs=Rn-Qn,Es=Qs-me,Ds=Vi-nn,hs=Ir-Rn;var Fi,fo,Po;Fi=ho*Rs-Fr*ae,fo=Fr*En-ci*Rs,Po=ci*ae-ho*En;var e_,Fs,te,Dn,co,Ft,Ni,lr,Vo;e_=ho*Po-Fr*fo,Fs=Fr*Fi-ci*Po,te=ci*fo-ho*Fi,Dn=ae*Po-Rs*fo,co=Rs*Fi-En*Po,Ft=En*fo-ae*Fi,Ni=Ds*Po-hs*fo,lr=hs*Fi-Es*Po,Vo=Es*fo-Ds*Fi;var cs=Qs*e_+Vi*Fs+Ir*te,Xs=xr*Dn+so*co+Qn*Ft,Ls=me*Ni+nn*lr+Rn*Vo,xo=-1,$t,Vr,er,Jo=0;if($t=0,Vr=0,er=0,cs<0){var Ne,Co,ko,Nr,Pr,Cr,Lr=Wi;Ne=Lr.x,Co=Lr.y,ko=Lr.z;var Rt=Lt;Nr=Rt.x,Pr=Rt.y,Cr=Rt.z;var Ji,Yi,Qi;Ji=Nr-Ne,Yi=Pr-Co,Qi=Cr-ko;var zr=Ji*Ji+Yi*Yi+Qi*Qi,qi=Ji*Ne+Yi*Co+Qi*ko;qi=-qi/zr;var Jr;if(qi<0){var Gr=s;Gr.x=Ne,Gr.y=Co,Gr.z=ko,Jr=1}else if(qi>1){var ao=s;ao.x=Nr,ao.y=Pr,ao.z=Cr,Jr=2}else{var bs,ki,sn;bs=Ne+Ji*qi,ki=Co+Yi*qi,sn=ko+Qi*qi;var Yr=s;Yr.x=bs,Yr.y=ki,Yr.z=sn,Jr=3}var Go=s.x*s.x+s.y*s.y+s.z*s.z;Jo=Jr,xo=Go;var ye=s;$t=ye.x,Vr=ye.y,er=ye.z}if(Xs<0){var In,ge,Vn,Ci,To,eo,Fn=Lt;In=Fn.x,ge=Fn.y,Vn=Fn.z;var Ns=jt;Ci=Ns.x,To=Ns.y,eo=Ns.z;var Nn,Wo,kn;Nn=Ci-In,Wo=To-ge,kn=eo-Vn;var Ys=Nn*Nn+Wo*Wo+kn*kn,Ot=Nn*In+Wo*ge+kn*Vn;Ot=-Ot/Ys;var Qo;if(Ot<0){var Ur=s;Ur.x=In,Ur.y=ge,Ur.z=Vn,Qo=1}else if(Ot>1){var wn=s;wn.x=Ci,wn.y=To,wn.z=eo,Qo=2}else{var Jn,fs,Ie;Jn=In+Nn*Ot,fs=ge+Wo*Ot,Ie=Vn+kn*Ot;var Uo=s;Uo.x=Jn,Uo.y=fs,Uo.z=Ie,Qo=3}var Ve=s.x*s.x+s.y*s.y+s.z*s.z;if(xo<0||Ve<xo){Jo=Qo<<1,xo=Ve;var w_=s;$t=w_.x,Vr=w_.y,er=w_.z}}if(Ls<0){var Je,X_,Js,F_,N_,Or,wo=Wi;Je=wo.x,X_=wo.y,Js=wo.z;var Xo=jt;F_=Xo.x,N_=Xo.y,Or=Xo.z;var Gn,wi,Wn;Gn=F_-Je,wi=N_-X_,Wn=Or-Js;var Ro=Gn*Gn+wi*wi+Wn*Wn,to=Gn*Je+wi*X_+Wn*Js;to=-to/Ro;var J_;if(to<0){var G_=s;G_.x=Je,G_.y=X_,G_.z=Js,J_=1}else if(to>1){var L_=s;L_.x=F_,L_.y=N_,L_.z=Or,J_=2}else{var ie,__,v_;ie=Je+Gn*to,__=X_+wi*to,v_=Js+Wn*to;var re=s;re.x=ie,re.y=__,re.z=v_,J_=3}var pi=s.x*s.x+s.y*s.y+s.z*s.z;if(xo<0||pi<xo){Jo=J_&1|(J_&2)<<1,xo=pi;var Oo=s;$t=Oo.x,Vr=Oo.y,er=Oo.z}}var ar;if(xo>0){var Zs=s;Zs.x=$t,Zs.y=Vr,Zs.z=er,ar=Jo}else{var Ge=Fi*Fi+fo*fo+Po*Po;Ge>0&&(Ge=1/Math.sqrt(Ge)),Fi*=Ge,fo*=Ge,Po*=Ge;var hv=Qs*Fi+Vi*fo+Ir*Po,xs=Fi*Fi+fo*fo+Po*Po;xs=hv/xs,$t=Fi*xs,Vr=fo*xs,er=Po*xs;var Gs=s;Gs.x=$t,Gs.y=Vr,Gs.z=er,ar=7}var $n=s.x*s.x+s.y*s.y+s.z*s.z;k_=ar,on=$n;var We=s;Tn=We.x,Kn=We.y,ws=We.z}if(No*gn<0){var Ti,Lo,Tr,en,ke,Y_,Ws,jn,Xn,oe,Bs,ne,Ue,l_,As,ds,qn,mi,uo=Wi;Ti=uo.x,Lo=uo.y,Tr=uo.z;var Zr=jt;en=Zr.x,ke=Zr.y,Y_=Zr.z;var Ho=Tt;Ws=Ho.x,jn=Ho.y,Xn=Ho.z,oe=en-Ti,Bs=ke-Lo,ne=Y_-Tr,Ue=Ws-en,l_=jn-ke,As=Xn-Y_,ds=Ti-Ws,qn=Lo-jn,mi=Tr-Xn;var Yo,Hr,Eo;Yo=Bs*As-ne*l_,Hr=ne*Ue-oe*As,Eo=oe*l_-Bs*Ue;var we,as,Oe,W_,ts,Nt,Kr,Do,Xe;we=Bs*Eo-ne*Hr,as=ne*Yo-oe*Eo,Oe=oe*Hr-Bs*Yo,W_=l_*Eo-As*Hr,ts=As*Yo-Ue*Eo,Nt=Ue*Hr-l_*Yo,Kr=qn*Eo-mi*Hr,Do=mi*Yo-ds*Eo,Xe=ds*Hr-qn*Yo;var kv=Ti*we+Lo*as+Tr*Oe,i0=en*W_+ke*ts+Y_*Nt,U_=Ws*Kr+jn*Do+Xn*Xe,Ht=-1,Ln,Qr,Yn,Z_=0;if(Ln=0,Qr=0,Yn=0,kv<0){var He,h_,bo,se,ee,us,Zi=Wi;He=Zi.x,h_=Zi.y,bo=Zi.z;var Ko=jt;se=Ko.x,ee=Ko.y,us=Ko.z;var kr,Zo,Us;kr=se-He,Zo=ee-h_,Us=us-bo;var cv=kr*kr+Zo*Zo+Us*Us,zs=kr*He+Zo*h_+Us*bo;zs=-zs/cv;var Ke;if(zs<0){var wv=s;wv.x=He,wv.y=h_,wv.z=bo,Ke=1}else if(zs>1){var Os=s;Os.x=se,Os.y=ee,Os.z=us,Ke=2}else{var si,Zn,_n;si=He+kr*zs,Zn=h_+Zo*zs,_n=bo+Us*zs;var vn=s;vn.x=si,vn.y=Zn,vn.z=_n,Ke=3}var B_=s.x*s.x+s.y*s.y+s.z*s.z;Z_=Ke,Ht=B_;var bv=s;Ln=bv.x,Qr=bv.y,Yn=bv.z}if(i0<0){var is,Ss,c_,O_,fv,xv,b_=jt;is=b_.x,Ss=b_.y,c_=b_.z;var Hs=Tt;O_=Hs.x,fv=Hs.y,xv=Hs.z;var zo,_e,ve;zo=O_-is,_e=fv-Ss,ve=xv-c_;var Ui=zo*zo+_e*_e+ve*ve,Mo=zo*is+_e*Ss+ve*c_;Mo=-Mo/Ui;var _o;if(Mo<0){var le=s;le.x=is,le.y=Ss,le.z=c_,_o=1}else if(Mo>1){var Le=s;Le.x=O_,Le.y=fv,Le.z=xv,_o=2}else{var Ye,Ze,A_;Ye=is+zo*Mo,Ze=Ss+_e*Mo,A_=c_+ve*Mo;var Ms=s;Ms.x=Ye,Ms.y=Ze,Ms.z=A_,_o=3}var he=s.x*s.x+s.y*s.y+s.z*s.z;if(Ht<0||he<Ht){Z_=_o<<1,Ht=he;var H_=s;Ln=H_.x,Qr=H_.y,Yn=H_.z}}if(U_<0){var $e,Un,ps,Xv,d_,$o,ln=Wi;$e=ln.x,Un=ln.y,ps=ln.z;var po=Tt;Xv=po.x,d_=po.y,$o=po.z;var Kt,$r,vo;Kt=Xv-$e,$r=d_-Un,vo=$o-ps;var je=Kt*Kt+$r*$r+vo*vo,Be=Kt*$e+$r*Un+vo*ps;Be=-Be/je;var qe;if(Be<0){var S_=s;S_.x=$e,S_.y=Un,S_.z=ps,qe=1}else if(Be>1){var jo=s;jo.x=Xv,jo.y=d_,jo.z=$o,qe=2}else{var rs,K_,uv;rs=$e+Kt*Be,K_=Un+$r*Be,uv=ps+vo*Be;var Bi=s;Bi.x=rs,Bi.y=K_,Bi.z=uv,qe=3}var mo=s.x*s.x+s.y*s.y+s.z*s.z;if(Ht<0||mo<Ht){Z_=qe&1|(qe&2)<<1,Ht=mo;var Rr=s;Ln=Rr.x,Qr=Rr.y,Yn=Rr.z}}var io;if(Ht>0){var $_=s;$_.x=Ln,$_.y=Qr,$_.z=Yn,io=Z_}else{var j_=Yo*Yo+Hr*Hr+Eo*Eo;j_>0&&(j_=1/Math.sqrt(j_)),Yo*=j_,Hr*=j_,Eo*=j_;var Lv=Ti*Yo+Lo*Hr+Tr*Eo,a_=Yo*Yo+Hr*Hr+Eo*Eo;a_=Lv/a_,Ln=Yo*a_,Qr=Hr*a_,Yn=Eo*a_;var Yv=s;Yv.x=Ln,Yv.y=Qr,Yv.z=Yn,io=7}var q_=s.x*s.x+s.y*s.y+s.z*s.z;if(on<0||q_<on){k_=io&1|(io&6)<<1,on=q_;var Ai=s;Tn=Ai.x,Kn=Ai.y,ws=Ai.z}}if(Wr*gn<0){var av,Ae,de,ce,be,Se,Zv,ms,jr,t_,yo,i_,Fo,Pe,qo,ys,ei,an,_r=Wi;av=_r.x,Ae=_r.y,de=_r.z;var os=Lt;ce=os.x,be=os.y,Se=os.z;var gs=Tt;Zv=gs.x,ms=gs.y,jr=gs.z,t_=ce-av,yo=be-Ae,i_=Se-de,Fo=Zv-ce,Pe=ms-be,qo=jr-Se,ys=av-Zv,ei=Ae-ms,an=de-jr;var Bo,Er,Bn;Bo=yo*qo-i_*Pe,Er=i_*Fo-t_*qo,Bn=t_*Pe-yo*Fo;var tv,r_,P_,iv,ns,An,Is,E0,M0;tv=yo*Bn-i_*Er,r_=i_*Bo-t_*Bn,P_=t_*Er-yo*Bo,iv=Pe*Bn-qo*Er,ns=qo*Bo-Fo*Bn,An=Fo*Er-Pe*Bo,Is=ei*Bn-an*Er,E0=an*Bo-ys*Bn,M0=ys*Er-ei*Bo;var hl=av*tv+Ae*r_+de*P_,D0=ce*iv+be*ns+Se*An,hr=Zv*Is+ms*E0+jr*M0,On=-1,go,fe,rv,zv=0;if(go=0,fe=0,rv=0,hl<0){var o_,Bv,Ce,f_,x_,di,Te=Wi;o_=Te.x,Bv=Te.y,Ce=Te.z;var lo=Lt;f_=lo.x,x_=lo.y,di=lo.z;var Ps,Mv,Qe;Ps=f_-o_,Mv=x_-Bv,Qe=di-Ce;var u_=Ps*Ps+Mv*Mv+Qe*Qe,ov=Ps*o_+Mv*Bv+Qe*Ce;ov=-ov/u_;var r0;if(ov<0){var o0=s;o0.x=o_,o0.y=Bv,o0.z=Ce,r0=1}else if(ov>1){var nv=s;nv.x=f_,nv.y=x_,nv.z=di,r0=2}else{var tr,Ks,dn;tr=o_+Ps*ov,Ks=Bv+Mv*ov,dn=Ce+Qe*ov;var xe=s;xe.x=tr,xe.y=Ks,xe.z=dn,r0=3}var F0=s.x*s.x+s.y*s.y+s.z*s.z;zv=r0,On=F0;var Dv=s;go=Dv.x,fe=Dv.y,rv=Dv.z}if(D0<0){var C_,p0,Av,n0,m0,N0,s0=Lt;C_=s0.x,p0=s0.y,Av=s0.z;var e0=Tt;n0=e0.x,m0=e0.y,N0=e0.z;var y0,Fv,cr;y0=n0-C_,Fv=m0-p0,cr=N0-Av;var pv=y0*y0+Fv*Fv+cr*cr,hn=y0*C_+Fv*p0+cr*Av;hn=-hn/pv;var Nv;if(hn<0){var Hl=s;Hl.x=C_,Hl.y=p0,Hl.z=Av,Nv=1}else if(hn>1){var g0=s;g0.x=n0,g0.y=m0,g0.z=N0,Nv=2}else{var I0,cl,Bl;I0=C_+y0*hn,cl=p0+Fv*hn,Bl=Av+cr*hn;var Jv=s;Jv.x=I0,Jv.y=cl,Jv.z=Bl,Nv=3}var Kl=s.x*s.x+s.y*s.y+s.z*s.z;if(On<0||Kl<On){zv=Nv<<1,On=Kl;var $l=s;go=$l.x,fe=$l.y,rv=$l.z}}if(hr<0){var bl,Al,dl,jl,fl,ql,xl=Wi;bl=xl.x,Al=xl.y,dl=xl.z;var rr=Tt;jl=rr.x,fl=rr.y,ql=rr.z;var ue,tn,mv;ue=jl-bl,tn=fl-Al,mv=ql-dl;var yh=ue*ue+tn*tn+mv*mv,Gv=ue*bl+tn*Al+mv*dl;Gv=-Gv/yh;var J0;if(Gv<0){var ul=s;ul.x=bl,ul.y=Al,ul.z=dl,J0=1}else if(Gv>1){var V0=s;V0.x=jl,V0.y=fl,V0.z=ql,J0=2}else{var k0,G0,Mr;k0=bl+ue*Gv,G0=Al+tn*Gv,Mr=dl+mv*Gv;var ze=s;ze.x=k0,ze.y=G0,ze.z=Mr,J0=3}var ss=s.x*s.x+s.y*s.y+s.z*s.z;if(On<0||ss<On){zv=J0&1|(J0&2)<<1,On=ss;var _0=s;go=_0.x,fe=_0.y,rv=_0.z}}var Sl;if(On>0){var lh=s;lh.x=go,lh.y=fe,lh.z=rv,Sl=zv}else{var W0=Bo*Bo+Er*Er+Bn*Bn;W0>0&&(W0=1/Math.sqrt(W0)),Bo*=W0,Er*=W0,Bn*=W0;var hh=av*Bo+Ae*Er+de*Bn,U0=Bo*Bo+Er*Er+Bn*Bn;U0=hh/U0,go=Bo*U0,fe=Er*U0,rv=Bn*U0;var Pl=s;Pl.x=go,Pl.y=fe,Pl.z=rv,Sl=7}var zl=s.x*s.x+s.y*s.y+s.z*s.z;if(on<0||zl<on){k_=Sl&3|(Sl&4)<<1,on=zl;var Cs=s;Tn=Cs.x,Kn=Cs.y,ws=Cs.z}}if(ks*gn<0){var w0,z_,Cl,O0,H0,Tl,Ml,X0,v0,M_,Wv,Uv,sv,L0,dv,l0,es,h0,Y0=Lt;w0=Y0.x,z_=Y0.y,Cl=Y0.z;var Re=jt;O0=Re.x,H0=Re.y,Tl=Re.z;var K0=Tt;Ml=K0.x,X0=K0.y,v0=K0.z,M_=O0-w0,Wv=H0-z_,Uv=Tl-Cl,sv=Ml-O0,L0=X0-H0,dv=v0-Tl,l0=w0-Ml,es=z_-X0,h0=Cl-v0;var yi,cn,wr;yi=Wv*dv-Uv*L0,cn=Uv*sv-M_*dv,wr=M_*L0-Wv*sv;var Ov,c0,ch,ah,p_,$s,Ee,th,bh;Ov=Wv*wr-Uv*cn,c0=Uv*yi-M_*wr,ch=M_*cn-Wv*yi,ah=L0*wr-dv*cn,p_=dv*yi-sv*wr,$s=sv*cn-L0*yi,Ee=es*wr-h0*cn,th=h0*yi-l0*wr,bh=l0*cn-es*yi;var Ql=w0*Ov+z_*c0+Cl*ch,br=O0*ah+H0*p_+Tl*$s,n_=Ml*Ee+X0*th+v0*bh,bn=-1,yv,$0,gv,pl=0;if(yv=0,$0=0,gv=0,Ql<0){var ml,yl,T_,Sv,Sn,Iv,Pv=Lt;ml=Pv.x,yl=Pv.y,T_=Pv.z;var Q_=jt;Sv=Q_.x,Sn=Q_.y,Iv=Q_.z;var _s,R_,Cv;_s=Sv-ml,R_=Sn-yl,Cv=Iv-T_;var Hv=_s*_s+R_*R_+Cv*Cv,or=_s*ml+R_*yl+Cv*T_;or=-or/Hv;var m_;if(or<0){var vs=s;vs.x=ml,vs.y=yl,vs.z=T_,m_=1}else if(or>1){var Gi=s;Gi.x=Sv,Gi.y=Sn,Gi.z=Iv,m_=2}else{var y_,Pn,j0;y_=ml+_s*or,Pn=yl+R_*or,j0=T_+Cv*or;var b0=s;b0.x=y_,b0.y=Pn,b0.z=j0,m_=3}var fh=s.x*s.x+s.y*s.y+s.z*s.z;pl=m_,bn=fh;var q0=s;yv=q0.x,$0=q0.y,gv=q0.z}if(br<0){var al,gl,Z0,xh,Il,gh,ih=jt;al=ih.x,gl=ih.y,Z0=ih.z;var Vl=Tt;xh=Vl.x,Il=Vl.y,gh=Vl.z;var B0,A0,kl;B0=xh-al,A0=Il-gl,kl=gh-Z0;var rh=B0*B0+A0*A0+kl*kl,Kv=B0*al+A0*gl+kl*Z0;Kv=-Kv/rh;var Rl;if(Kv<0){var $v=s;$v.x=al,$v.y=gl,$v.z=Z0,Rl=1}else if(Kv>1){var nr=s;nr.x=xh,nr.y=Il,nr.z=gh,Rl=2}else{var g_,rn,wl;g_=al+B0*Kv,rn=gl+A0*Kv,wl=Z0+kl*Kv;var d0=s;d0.x=g_,d0.y=rn,d0.z=wl,Rl=3}var oh=s.x*s.x+s.y*s.y+s.z*s.z;if(bn<0||oh<bn){pl=Rl<<1,bn=oh;var El=s;yv=El.x,$0=El.y,gv=El.z}}if(n_<0){var tl,Dl,S0,nh,sh,Fl,Nl=Lt;tl=Nl.x,Dl=Nl.y,S0=Nl.z;var ev=Tt;nh=ev.x,sh=ev.y,Fl=ev.z;var Tv,jv,De;Tv=nh-tl,jv=sh-Dl,De=Fl-S0;var uh=Tv*Tv+jv*jv+De*De,f0=Tv*tl+jv*Dl+De*S0;f0=-f0/uh;var Xl;if(f0<0){var Qv=s;Qv.x=tl,Qv.y=Dl,Qv.z=S0,Xl=1}else if(f0>1){var qv=s;qv.x=nh,qv.y=sh,qv.z=Fl,Xl=2}else{var Rv,x0,Zh;Rv=tl+Tv*f0,x0=Dl+jv*f0,Zh=S0+De*f0;var P0=s;P0.x=Rv,P0.y=x0,P0.z=Zh,Xl=3}var a0=s.x*s.x+s.y*s.y+s.z*s.z;if(bn<0||a0<bn){pl=Xl&1|(Xl&2)<<1,bn=a0;var Jl=s;yv=Jl.x,$0=Jl.y,gv=Jl.z}}var Gl;if(bn>0){var zh=s;zh.x=yv,zh.y=$0,zh.z=gv,Gl=pl}else{var Ev=yi*yi+cn*cn+wr*wr;Ev>0&&(Ev=1/Math.sqrt(Ev)),yi*=Ev,cn*=Ev,wr*=Ev;var ur=w0*yi+z_*cn+Cl*wr,Vs=yi*yi+cn*cn+wr*wr;Vs=ur/Vs,yv=yi*Vs,$0=cn*Vs,gv=wr*Vs;var ls=s;ls.x=yv,ls.y=$0,ls.z=gv,Gl=7}var C0=s.x*s.x+s.y*s.y+s.z*s.z;if(on<0||C0<on){k_=Gl<<1,on=C0;var Wl=s;Tn=Wl.x,Kn=Wl.y,ws=Wl.z}}if(on>0){var Fe=s;Fe.x=Tn,Fe.y=Kn,Fe.z=ws,g=k_}else s.zero(),g=15;break}if(s.x*s.x+s.y*s.y+s.z*s.z<m){if(!e)return this.distance=0,0;switch(this.simplexSize){case 1:this.pointToTetrahedron();break;case 2:this.lineToTetrahedron();break;case 3:this.triangleToTetrahedron();break}if(this.simplexSize==4){var u0=this.computeDepth(a,t,i,o,_,h,v);return u0!=0?(this.distance=0,u0):(this.distance=-this.depth,0)}return this.distance=0,1}this.shrinkSimplex(g),l.x=s.x,l.y=s.y,l.z=s.z;var Ll=l,Ul=-Ll.x,Ol=-Ll.y,Ih=-Ll.z;Ll.x=Ul,Ll.y=Ol,Ll.z=Ih,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var _v=this.s[this.simplexSize],vv=this.w1[this.simplexSize];_v.x=vv.x,_v.y=vv.y,_v.z=vv.z;var T0=_v,I_=this.w2[this.simplexSize],Yl=T0.x-I_.x,Vh=T0.y-I_.y,Bh=T0.z-I_.z;if(T0.x=Yl,T0.y=Vh,T0.z=Bh,l.x*l.x+l.y*l.y+l.z*l.z<m)throw new Error("!?");var t0=s.x*l.x+s.y*l.y+s.z*l.z,lv=_[this.simplexSize],kh=lv.x*l.x+lv.y*l.y+lv.z*l.z;if(kh-t0<m)return this.interpolateClosestPoints(),this.distance=Math.sqrt(s.x*s.x+s.y*s.y+s.z*s.z),r!=null&&r._gjkCache!=null&&this.saveCache(r._gjkCache),0;this.simplexSize++,++k}return 2}convexCastImpl(a,t,i,o,r,e,_){this.c1=a,this.c2=t,this.tf1=i,this.tf2=o;var h=this.s;this.w1,this.w2;var v=this.closest,s=this.dir,l,x,b;l=o._positionX-i._positionX,x=o._positionY-i._positionY,b=o._positionZ-i._positionZ;var f=s;if(f.x=l,f.y=x,f.z=b,s.x*s.x+s.y*s.y+s.z*s.z<1e-6&&s.init(1,0,0),this.simplexSize=0,this.c1!=null)this.computeWitnessPoint1(!0);else{var n=this.w1[this.simplexSize];n.x=this.tf1._positionX,n.y=this.tf1._positionY,n.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);var c=this.s[this.simplexSize],z=this.w1[this.simplexSize];c.x=z.x,c.y=z.y,c.z=z.z;var p=c,y=this.w2[this.simplexSize],V=p.x-y.x,M=p.y-y.y,I=p.z-y.z;p.x=V,p.y=M,p.z=I,this.simplexSize=1;var k=0,X=40,L=0,m=this.rayX,g=this.rayR;m.zero(),g.x=e.x,g.y=e.y,g.z=e.z;var N=g,d=N.x-r.x,F=N.y-r.y,S=N.z-r.z;N.x=d,N.y=F,N.z=S;for(var Y=1e-4,Q=Y*Y;k<X;){var C=0;switch(this.simplexSize){case 1:var B=h[0];v.x=B.x,v.y=B.y,v.z=B.z,C=1;break;case 2:var Z,$,K,E,J,A,R=h[0];Z=R.x,$=R.y,K=R.z;var U=h[1];E=U.x,J=U.y,A=U.z;var G,D,H;G=E-Z,D=J-$,H=A-K;var j=G*G+D*D+H*H,ia=G*Z+D*$+H*K;if(ia=-ia/j,ia<0){var ea=v;ea.x=Z,ea.y=$,ea.z=K,C=1}else if(ia>1){var W=v;W.x=E,W.y=J,W.z=A,C=2}else{var q,na,oa;q=Z+G*ia,na=$+D*ia,oa=K+H*ia;var aa=v;aa.x=q,aa.y=na,aa.z=oa,C=3}break;case 3:var T=h[0],ca=h[1],_a=h[2],w,ta,ra,la,va,ua,za,Ma,Xa,Za,fa,ba,sa,ha,ma,ya,Ba,pa,Ya=T;w=Ya.x,ta=Ya.y,ra=Ya.z;var Ra=ca;la=Ra.x,va=Ra.y,ua=Ra.z;var ga=_a;za=ga.x,Ma=ga.y,Xa=ga.z,Za=la-w,fa=va-ta,ba=ua-ra,sa=za-la,ha=Ma-va,ma=Xa-ua,ya=w-za,Ba=ta-Ma,pa=ra-Xa;var xa,wa,ka;xa=fa*ma-ba*ha,wa=ba*sa-Za*ma,ka=Za*ha-fa*sa;var Pa,zt,Oa,Aa,nt,Ea,Fa,da,ft;Pa=fa*ka-ba*wa,zt=ba*xa-Za*ka,Oa=Za*wa-fa*xa,Aa=ha*ka-ma*wa,nt=ma*xa-sa*ka,Ea=sa*wa-ha*xa,Fa=Ba*ka-pa*wa,da=pa*xa-ya*ka,ft=ya*wa-Ba*xa;var Wa=w*Pa+ta*zt+ra*Oa,Ha=la*Aa+va*nt+ua*Ea,bt=za*Fa+Ma*da+Xa*ft,it=-1,Ka,_t,gt,pt=0;if(Ka=0,_t=0,gt=0,Wa<0){var Ga,rt,xt,Da,Ta,Na,Vt=T;Ga=Vt.x,rt=Vt.y,xt=Vt.z;var Pt=ca;Da=Pt.x,Ta=Pt.y,Na=Pt.z;var st,Xt,Yt;st=Da-Ga,Xt=Ta-rt,Yt=Na-xt;var Mt=st*st+Xt*Xt+Yt*Yt,Ia=st*Ga+Xt*rt+Yt*xt;Ia=-Ia/Mt;var O;if(Ia<0){var Va=v;Va.x=Ga,Va.y=rt,Va.z=xt,O=1}else if(Ia>1){var lt=v;lt.x=Da,lt.y=Ta,lt.z=Na,O=2}else{var P,wt,At;P=Ga+st*Ia,wt=rt+Xt*Ia,At=xt+Yt*Ia;var dt=v;dt.x=P,dt.y=wt,dt.z=At,O=3}var yt=v.x*v.x+v.y*v.y+v.z*v.z;pt=O,it=yt;var kt=v;Ka=kt.x,_t=kt.y,gt=kt.z}if(Ha<0){var mt,ht,ut,Qa,et,Ca,vt=ca;mt=vt.x,ht=vt.y,ut=vt.z;var qa=_a;Qa=qa.x,et=qa.y,Ca=qa.z;var at,Ua,tt;at=Qa-mt,Ua=et-ht,tt=Ca-ut;var ct=at*at+Ua*Ua+tt*tt,Sa=at*mt+Ua*ht+tt*ut;Sa=-Sa/ct;var Ja;if(Sa<0){var ja=v;ja.x=mt,ja.y=ht,ja.z=ut,Ja=1}else if(Sa>1){var La=v;La.x=Qa,La.y=et,La.z=Ca,Ja=2}else{var ot,It,oi;ot=mt+at*Sa,It=ht+Ua*Sa,oi=ut+tt*Sa;var gi=v;gi.x=ot,gi.y=It,gi.z=oi,Ja=3}var ai=v.x*v.x+v.y*v.y+v.z*v.z;if(it<0||ai<it){pt=Ja<<1,it=ai;var Ct=v;Ka=Ct.x,_t=Ct.y,gt=Ct.z}}if(bt<0){var _i,Et,St,Jt,Ki,vi,li=T;_i=li.x,Et=li.y,St=li.z;var ti=_a;Jt=ti.x,Ki=ti.y,vi=ti.z;var Oi,Xi,zi;Oi=Jt-_i,Xi=Ki-Et,zi=vi-St;var Zt=Oi*Oi+Xi*Xi+zi*zi,ri=Oi*_i+Xi*Et+zi*St;ri=-ri/Zt;var Wt;if(ri<0){var ni=v;ni.x=_i,ni.y=Et,ni.z=St,Wt=1}else if(ri>1){var $i=v;$i.x=Jt,$i.y=Ki,$i.z=vi,Wt=2}else{var Ut,ji,Ii;Ut=_i+Oi*ri,ji=Et+Xi*ri,Ii=St+zi*ri;var pr=v;pr.x=Ut,pr.y=ji,pr.z=Ii,Wt=3}var Wi=v.x*v.x+v.y*v.y+v.z*v.z;if(it<0||Wi<it){pt=Wt&1|(Wt&2)<<1,it=Wi;var Lt=v;Ka=Lt.x,_t=Lt.y,gt=Lt.z}}if(it>0){var jt=v;jt.x=Ka,jt.y=_t,jt.z=gt,C=pt}else{var Tt=xa*xa+wa*wa+ka*ka;Tt>0&&(Tt=1/Math.sqrt(Tt)),xa*=Tt,wa*=Tt,ka*=Tt;var bi=w*xa+ta*wa+ra*ka,Mi=xa*xa+wa*wa+ka*ka;Mi=bi/Mi,Ka=xa*Mi,_t=wa*Mi,gt=ka*Mi;var vr=v;vr.x=Ka,vr.y=_t,vr.z=gt,C=7}break;case 4:var qt=h[0],fi=h[1],Bt=h[2],xi=h[3],hi,sr,Xr,ro,Gt,fr,mr,Dt,Br,Si,Dr,Hn,oo,Ar,no,yn,Ao,Io,ui,qr,dr,yr,So,Di,Sr,gr,Qt,Hi=qt;hi=Hi.x,sr=Hi.y,Xr=Hi.z;var Li=fi;ro=Li.x,Gt=Li.y,fr=Li.z;var Cn=Bt;mr=Cn.x,Dt=Cn.y,Br=Cn.z;var Me=xi;Si=Me.x,Dr=Me.y,Hn=Me.z,oo=ro-hi,Ar=Gt-sr,no=fr-Xr,yn=mr-hi,Ao=Dt-sr,Io=Br-Xr,ui=Si-hi,qr=Dr-sr,dr=Hn-Xr,yr=mr-ro,So=Dt-Gt,Di=Br-fr,Sr=Si-ro,gr=Dr-Gt,Qt=Hn-fr;var js,pe,Ts,qs,D_,gn,Pi,No,Wr,ks,on,Tn;js=Ar*Io-no*Ao,pe=no*yn-oo*Io,Ts=oo*Ao-Ar*yn,qs=Ao*dr-Io*qr,D_=Io*ui-yn*dr,gn=yn*qr-Ao*ui,Pi=qr*no-dr*Ar,No=dr*oo-ui*no,Wr=ui*Ar-qr*oo,ks=gr*Di-Qt*So,on=Qt*yr-Sr*Di,Tn=Sr*So-gr*yr;var Kn=oo*ks+Ar*on+no*Tn>0?1:-1,ws=hi*js+sr*pe+Xr*Ts,k_=hi*qs+sr*D_+Xr*gn,Qs=hi*Pi+sr*No+Xr*Wr,Vi=ro*ks+Gt*on+fr*Tn,Ir=-1,xr,so,Qn,me=0;if(xr=0,so=0,Qn=0,ws*Kn<0){var nn,Rn,ci,ho,Fr,En,ae,Rs,Es,Ds,hs,ii,ir,Ri,Fi,fo,Po,e_,Fs=qt;nn=Fs.x,Rn=Fs.y,ci=Fs.z;var te=fi;ho=te.x,Fr=te.y,En=te.z;var Dn=Bt;ae=Dn.x,Rs=Dn.y,Es=Dn.z,Ds=ho-nn,hs=Fr-Rn,ii=En-ci,ir=ae-ho,Ri=Rs-Fr,Fi=Es-En,fo=nn-ae,Po=Rn-Rs,e_=ci-Es;var co,Ft,Ni;co=hs*Fi-ii*Ri,Ft=ii*ir-Ds*Fi,Ni=Ds*Ri-hs*ir;var lr,Vo,cs,Xs,Ls,xo,$t,Vr,er;lr=hs*Ni-ii*Ft,Vo=ii*co-Ds*Ni,cs=Ds*Ft-hs*co,Xs=Ri*Ni-Fi*Ft,Ls=Fi*co-ir*Ni,xo=ir*Ft-Ri*co,$t=Po*Ni-e_*Ft,Vr=e_*co-fo*Ni,er=fo*Ft-Po*co;var Jo=nn*lr+Rn*Vo+ci*cs,Ne=ho*Xs+Fr*Ls+En*xo,Co=ae*$t+Rs*Vr+Es*er,ko=-1,Nr,Pr,Cr,Lr=0;if(Nr=0,Pr=0,Cr=0,Jo<0){var Rt,Ji,Yi,Qi,zr,qi,Jr=qt;Rt=Jr.x,Ji=Jr.y,Yi=Jr.z;var Gr=fi;Qi=Gr.x,zr=Gr.y,qi=Gr.z;var ao,bs,ki;ao=Qi-Rt,bs=zr-Ji,ki=qi-Yi;var sn=ao*ao+bs*bs+ki*ki,Yr=ao*Rt+bs*Ji+ki*Yi;Yr=-Yr/sn;var Go;if(Yr<0){var ye=v;ye.x=Rt,ye.y=Ji,ye.z=Yi,Go=1}else if(Yr>1){var In=v;In.x=Qi,In.y=zr,In.z=qi,Go=2}else{var ge,Vn,Ci;ge=Rt+ao*Yr,Vn=Ji+bs*Yr,Ci=Yi+ki*Yr;var To=v;To.x=ge,To.y=Vn,To.z=Ci,Go=3}var eo=v.x*v.x+v.y*v.y+v.z*v.z;Lr=Go,ko=eo;var Fn=v;Nr=Fn.x,Pr=Fn.y,Cr=Fn.z}if(Ne<0){var Ns,Nn,Wo,kn,Ys,Ot,Qo=fi;Ns=Qo.x,Nn=Qo.y,Wo=Qo.z;var Ur=Bt;kn=Ur.x,Ys=Ur.y,Ot=Ur.z;var wn,Jn,fs;wn=kn-Ns,Jn=Ys-Nn,fs=Ot-Wo;var Ie=wn*wn+Jn*Jn+fs*fs,Uo=wn*Ns+Jn*Nn+fs*Wo;Uo=-Uo/Ie;var Ve;if(Uo<0){var w_=v;w_.x=Ns,w_.y=Nn,w_.z=Wo,Ve=1}else if(Uo>1){var Je=v;Je.x=kn,Je.y=Ys,Je.z=Ot,Ve=2}else{var X_,Js,F_;X_=Ns+wn*Uo,Js=Nn+Jn*Uo,F_=Wo+fs*Uo;var N_=v;N_.x=X_,N_.y=Js,N_.z=F_,Ve=3}var Or=v.x*v.x+v.y*v.y+v.z*v.z;if(ko<0||Or<ko){Lr=Ve<<1,ko=Or;var wo=v;Nr=wo.x,Pr=wo.y,Cr=wo.z}}if(Co<0){var Xo,Gn,wi,Wn,Ro,to,J_=qt;Xo=J_.x,Gn=J_.y,wi=J_.z;var G_=Bt;Wn=G_.x,Ro=G_.y,to=G_.z;var L_,ie,__;L_=Wn-Xo,ie=Ro-Gn,__=to-wi;var v_=L_*L_+ie*ie+__*__,re=L_*Xo+ie*Gn+__*wi;re=-re/v_;var pi;if(re<0){var Oo=v;Oo.x=Xo,Oo.y=Gn,Oo.z=wi,pi=1}else if(re>1){var ar=v;ar.x=Wn,ar.y=Ro,ar.z=to,pi=2}else{var Zs,Ge,hv;Zs=Xo+L_*re,Ge=Gn+ie*re,hv=wi+__*re;var xs=v;xs.x=Zs,xs.y=Ge,xs.z=hv,pi=3}var Gs=v.x*v.x+v.y*v.y+v.z*v.z;if(ko<0||Gs<ko){Lr=pi&1|(pi&2)<<1,ko=Gs;var $n=v;Nr=$n.x,Pr=$n.y,Cr=$n.z}}var We;if(ko>0){var Ti=v;Ti.x=Nr,Ti.y=Pr,Ti.z=Cr,We=Lr}else{var Lo=co*co+Ft*Ft+Ni*Ni;Lo>0&&(Lo=1/Math.sqrt(Lo)),co*=Lo,Ft*=Lo,Ni*=Lo;var Tr=nn*co+Rn*Ft+ci*Ni,en=co*co+Ft*Ft+Ni*Ni;en=Tr/en,Nr=co*en,Pr=Ft*en,Cr=Ni*en;var ke=v;ke.x=Nr,ke.y=Pr,ke.z=Cr,We=7}var Y_=v.x*v.x+v.y*v.y+v.z*v.z;me=We,Ir=Y_;var Ws=v;xr=Ws.x,so=Ws.y,Qn=Ws.z}if(k_*Kn<0){var jn,Xn,oe,Bs,ne,Ue,l_,As,ds,qn,mi,uo,Zr,Ho,Yo,Hr,Eo,we,as=qt;jn=as.x,Xn=as.y,oe=as.z;var Oe=Bt;Bs=Oe.x,ne=Oe.y,Ue=Oe.z;var W_=xi;l_=W_.x,As=W_.y,ds=W_.z,qn=Bs-jn,mi=ne-Xn,uo=Ue-oe,Zr=l_-Bs,Ho=As-ne,Yo=ds-Ue,Hr=jn-l_,Eo=Xn-As,we=oe-ds;var ts,Nt,Kr;ts=mi*Yo-uo*Ho,Nt=uo*Zr-qn*Yo,Kr=qn*Ho-mi*Zr;var Do,Xe,kv,i0,U_,Ht,Ln,Qr,Yn;Do=mi*Kr-uo*Nt,Xe=uo*ts-qn*Kr,kv=qn*Nt-mi*ts,i0=Ho*Kr-Yo*Nt,U_=Yo*ts-Zr*Kr,Ht=Zr*Nt-Ho*ts,Ln=Eo*Kr-we*Nt,Qr=we*ts-Hr*Kr,Yn=Hr*Nt-Eo*ts;var Z_=jn*Do+Xn*Xe+oe*kv,He=Bs*i0+ne*U_+Ue*Ht,h_=l_*Ln+As*Qr+ds*Yn,bo=-1,se,ee,us,Zi=0;if(se=0,ee=0,us=0,Z_<0){var Ko,kr,Zo,Us,cv,zs,Ke=qt;Ko=Ke.x,kr=Ke.y,Zo=Ke.z;var wv=Bt;Us=wv.x,cv=wv.y,zs=wv.z;var Os,si,Zn;Os=Us-Ko,si=cv-kr,Zn=zs-Zo;var _n=Os*Os+si*si+Zn*Zn,vn=Os*Ko+si*kr+Zn*Zo;vn=-vn/_n;var B_;if(vn<0){var bv=v;bv.x=Ko,bv.y=kr,bv.z=Zo,B_=1}else if(vn>1){var is=v;is.x=Us,is.y=cv,is.z=zs,B_=2}else{var Ss,c_,O_;Ss=Ko+Os*vn,c_=kr+si*vn,O_=Zo+Zn*vn;var fv=v;fv.x=Ss,fv.y=c_,fv.z=O_,B_=3}var xv=v.x*v.x+v.y*v.y+v.z*v.z;Zi=B_,bo=xv;var b_=v;se=b_.x,ee=b_.y,us=b_.z}if(He<0){var Hs,zo,_e,ve,Ui,Mo,_o=Bt;Hs=_o.x,zo=_o.y,_e=_o.z;var le=xi;ve=le.x,Ui=le.y,Mo=le.z;var Le,Ye,Ze;Le=ve-Hs,Ye=Ui-zo,Ze=Mo-_e;var A_=Le*Le+Ye*Ye+Ze*Ze,Ms=Le*Hs+Ye*zo+Ze*_e;Ms=-Ms/A_;var he;if(Ms<0){var H_=v;H_.x=Hs,H_.y=zo,H_.z=_e,he=1}else if(Ms>1){var $e=v;$e.x=ve,$e.y=Ui,$e.z=Mo,he=2}else{var Un,ps,Xv;Un=Hs+Le*Ms,ps=zo+Ye*Ms,Xv=_e+Ze*Ms;var d_=v;d_.x=Un,d_.y=ps,d_.z=Xv,he=3}var $o=v.x*v.x+v.y*v.y+v.z*v.z;if(bo<0||$o<bo){Zi=he<<1,bo=$o;var ln=v;se=ln.x,ee=ln.y,us=ln.z}}if(h_<0){var po,Kt,$r,vo,je,Be,qe=qt;po=qe.x,Kt=qe.y,$r=qe.z;var S_=xi;vo=S_.x,je=S_.y,Be=S_.z;var jo,rs,K_;jo=vo-po,rs=je-Kt,K_=Be-$r;var uv=jo*jo+rs*rs+K_*K_,Bi=jo*po+rs*Kt+K_*$r;Bi=-Bi/uv;var mo;if(Bi<0){var Rr=v;Rr.x=po,Rr.y=Kt,Rr.z=$r,mo=1}else if(Bi>1){var io=v;io.x=vo,io.y=je,io.z=Be,mo=2}else{var $_,j_,Lv;$_=po+jo*Bi,j_=Kt+rs*Bi,Lv=$r+K_*Bi;var a_=v;a_.x=$_,a_.y=j_,a_.z=Lv,mo=3}var Yv=v.x*v.x+v.y*v.y+v.z*v.z;if(bo<0||Yv<bo){Zi=mo&1|(mo&2)<<1,bo=Yv;var q_=v;se=q_.x,ee=q_.y,us=q_.z}}var Ai;if(bo>0){var av=v;av.x=se,av.y=ee,av.z=us,Ai=Zi}else{var Ae=ts*ts+Nt*Nt+Kr*Kr;Ae>0&&(Ae=1/Math.sqrt(Ae)),ts*=Ae,Nt*=Ae,Kr*=Ae;var de=jn*ts+Xn*Nt+oe*Kr,ce=ts*ts+Nt*Nt+Kr*Kr;ce=de/ce,se=ts*ce,ee=Nt*ce,us=Kr*ce;var be=v;be.x=se,be.y=ee,be.z=us,Ai=7}var Se=v.x*v.x+v.y*v.y+v.z*v.z;if(Ir<0||Se<Ir){me=Ai&1|(Ai&6)<<1,Ir=Se;var Zv=v;xr=Zv.x,so=Zv.y,Qn=Zv.z}}if(Qs*Kn<0){var ms,jr,t_,yo,i_,Fo,Pe,qo,ys,ei,an,_r,os,gs,Bo,Er,Bn,tv,r_=qt;ms=r_.x,jr=r_.y,t_=r_.z;var P_=fi;yo=P_.x,i_=P_.y,Fo=P_.z;var iv=xi;Pe=iv.x,qo=iv.y,ys=iv.z,ei=yo-ms,an=i_-jr,_r=Fo-t_,os=Pe-yo,gs=qo-i_,Bo=ys-Fo,Er=ms-Pe,Bn=jr-qo,tv=t_-ys;var ns,An,Is;ns=an*Bo-_r*gs,An=_r*os-ei*Bo,Is=ei*gs-an*os;var E0,M0,hl,D0,hr,On,go,fe,rv;E0=an*Is-_r*An,M0=_r*ns-ei*Is,hl=ei*An-an*ns,D0=gs*Is-Bo*An,hr=Bo*ns-os*Is,On=os*An-gs*ns,go=Bn*Is-tv*An,fe=tv*ns-Er*Is,rv=Er*An-Bn*ns;var zv=ms*E0+jr*M0+t_*hl,o_=yo*D0+i_*hr+Fo*On,Bv=Pe*go+qo*fe+ys*rv,Ce=-1,f_,x_,di,Te=0;if(f_=0,x_=0,di=0,zv<0){var lo,Ps,Mv,Qe,u_,ov,r0=qt;lo=r0.x,Ps=r0.y,Mv=r0.z;var o0=fi;Qe=o0.x,u_=o0.y,ov=o0.z;var nv,tr,Ks;nv=Qe-lo,tr=u_-Ps,Ks=ov-Mv;var dn=nv*nv+tr*tr+Ks*Ks,xe=nv*lo+tr*Ps+Ks*Mv;xe=-xe/dn;var F0;if(xe<0){var Dv=v;Dv.x=lo,Dv.y=Ps,Dv.z=Mv,F0=1}else if(xe>1){var C_=v;C_.x=Qe,C_.y=u_,C_.z=ov,F0=2}else{var p0,Av,n0;p0=lo+nv*xe,Av=Ps+tr*xe,n0=Mv+Ks*xe;var m0=v;m0.x=p0,m0.y=Av,m0.z=n0,F0=3}var N0=v.x*v.x+v.y*v.y+v.z*v.z;Te=F0,Ce=N0;var s0=v;f_=s0.x,x_=s0.y,di=s0.z}if(o_<0){var e0,y0,Fv,cr,pv,hn,Nv=fi;e0=Nv.x,y0=Nv.y,Fv=Nv.z;var Hl=xi;cr=Hl.x,pv=Hl.y,hn=Hl.z;var g0,I0,cl;g0=cr-e0,I0=pv-y0,cl=hn-Fv;var Bl=g0*g0+I0*I0+cl*cl,Jv=g0*e0+I0*y0+cl*Fv;Jv=-Jv/Bl;var Kl;if(Jv<0){var $l=v;$l.x=e0,$l.y=y0,$l.z=Fv,Kl=1}else if(Jv>1){var bl=v;bl.x=cr,bl.y=pv,bl.z=hn,Kl=2}else{var Al,dl,jl;Al=e0+g0*Jv,dl=y0+I0*Jv,jl=Fv+cl*Jv;var fl=v;fl.x=Al,fl.y=dl,fl.z=jl,Kl=3}var ql=v.x*v.x+v.y*v.y+v.z*v.z;if(Ce<0||ql<Ce){Te=Kl<<1,Ce=ql;var xl=v;f_=xl.x,x_=xl.y,di=xl.z}}if(Bv<0){var rr,ue,tn,mv,yh,Gv,J0=qt;rr=J0.x,ue=J0.y,tn=J0.z;var ul=xi;mv=ul.x,yh=ul.y,Gv=ul.z;var V0,k0,G0;V0=mv-rr,k0=yh-ue,G0=Gv-tn;var Mr=V0*V0+k0*k0+G0*G0,ze=V0*rr+k0*ue+G0*tn;ze=-ze/Mr;var ss;if(ze<0){var _0=v;_0.x=rr,_0.y=ue,_0.z=tn,ss=1}else if(ze>1){var Sl=v;Sl.x=mv,Sl.y=yh,Sl.z=Gv,ss=2}else{var lh,W0,hh;lh=rr+V0*ze,W0=ue+k0*ze,hh=tn+G0*ze;var U0=v;U0.x=lh,U0.y=W0,U0.z=hh,ss=3}var Pl=v.x*v.x+v.y*v.y+v.z*v.z;if(Ce<0||Pl<Ce){Te=ss&1|(ss&2)<<1,Ce=Pl;var zl=v;f_=zl.x,x_=zl.y,di=zl.z}}var Cs;if(Ce>0){var w0=v;w0.x=f_,w0.y=x_,w0.z=di,Cs=Te}else{var z_=ns*ns+An*An+Is*Is;z_>0&&(z_=1/Math.sqrt(z_)),ns*=z_,An*=z_,Is*=z_;var Cl=ms*ns+jr*An+t_*Is,O0=ns*ns+An*An+Is*Is;O0=Cl/O0,f_=ns*O0,x_=An*O0,di=Is*O0;var H0=v;H0.x=f_,H0.y=x_,H0.z=di,Cs=7}var Tl=v.x*v.x+v.y*v.y+v.z*v.z;if(Ir<0||Tl<Ir){me=Cs&3|(Cs&4)<<1,Ir=Tl;var Ml=v;xr=Ml.x,so=Ml.y,Qn=Ml.z}}if(Vi*Kn<0){var X0,v0,M_,Wv,Uv,sv,L0,dv,l0,es,h0,Y0,Re,K0,yi,cn,wr,Ov,c0=fi;X0=c0.x,v0=c0.y,M_=c0.z;var ch=Bt;Wv=ch.x,Uv=ch.y,sv=ch.z;var ah=xi;L0=ah.x,dv=ah.y,l0=ah.z,es=Wv-X0,h0=Uv-v0,Y0=sv-M_,Re=L0-Wv,K0=dv-Uv,yi=l0-sv,cn=X0-L0,wr=v0-dv,Ov=M_-l0;var p_,$s,Ee;p_=h0*yi-Y0*K0,$s=Y0*Re-es*yi,Ee=es*K0-h0*Re;var th,bh,Ql,br,n_,bn,yv,$0,gv;th=h0*Ee-Y0*$s,bh=Y0*p_-es*Ee,Ql=es*$s-h0*p_,br=K0*Ee-yi*$s,n_=yi*p_-Re*Ee,bn=Re*$s-K0*p_,yv=wr*Ee-Ov*$s,$0=Ov*p_-cn*Ee,gv=cn*$s-wr*p_;var pl=X0*th+v0*bh+M_*Ql,ml=Wv*br+Uv*n_+sv*bn,yl=L0*yv+dv*$0+l0*gv,T_=-1,Sv,Sn,Iv,Pv=0;if(Sv=0,Sn=0,Iv=0,pl<0){var Q_,_s,R_,Cv,Hv,or,m_=fi;Q_=m_.x,_s=m_.y,R_=m_.z;var vs=Bt;Cv=vs.x,Hv=vs.y,or=vs.z;var Gi,y_,Pn;Gi=Cv-Q_,y_=Hv-_s,Pn=or-R_;var j0=Gi*Gi+y_*y_+Pn*Pn,b0=Gi*Q_+y_*_s+Pn*R_;b0=-b0/j0;var fh;if(b0<0){var q0=v;q0.x=Q_,q0.y=_s,q0.z=R_,fh=1}else if(b0>1){var al=v;al.x=Cv,al.y=Hv,al.z=or,fh=2}else{var gl,Z0,xh;gl=Q_+Gi*b0,Z0=_s+y_*b0,xh=R_+Pn*b0;var Il=v;Il.x=gl,Il.y=Z0,Il.z=xh,fh=3}var gh=v.x*v.x+v.y*v.y+v.z*v.z;Pv=fh,T_=gh;var ih=v;Sv=ih.x,Sn=ih.y,Iv=ih.z}if(ml<0){var Vl,B0,A0,kl,rh,Kv,Rl=Bt;Vl=Rl.x,B0=Rl.y,A0=Rl.z;var $v=xi;kl=$v.x,rh=$v.y,Kv=$v.z;var nr,g_,rn;nr=kl-Vl,g_=rh-B0,rn=Kv-A0;var wl=nr*nr+g_*g_+rn*rn,d0=nr*Vl+g_*B0+rn*A0;d0=-d0/wl;var oh;if(d0<0){var El=v;El.x=Vl,El.y=B0,El.z=A0,oh=1}else if(d0>1){var tl=v;tl.x=kl,tl.y=rh,tl.z=Kv,oh=2}else{var Dl,S0,nh;Dl=Vl+nr*d0,S0=B0+g_*d0,nh=A0+rn*d0;var sh=v;sh.x=Dl,sh.y=S0,sh.z=nh,oh=3}var Fl=v.x*v.x+v.y*v.y+v.z*v.z;if(T_<0||Fl<T_){Pv=oh<<1,T_=Fl;var Nl=v;Sv=Nl.x,Sn=Nl.y,Iv=Nl.z}}if(yl<0){var ev,Tv,jv,De,uh,f0,Xl=fi;ev=Xl.x,Tv=Xl.y,jv=Xl.z;var Qv=xi;De=Qv.x,uh=Qv.y,f0=Qv.z;var qv,Rv,x0;qv=De-ev,Rv=uh-Tv,x0=f0-jv;var Zh=qv*qv+Rv*Rv+x0*x0,P0=qv*ev+Rv*Tv+x0*jv;P0=-P0/Zh;var a0;if(P0<0){var Jl=v;Jl.x=ev,Jl.y=Tv,Jl.z=jv,a0=1}else if(P0>1){var Gl=v;Gl.x=De,Gl.y=uh,Gl.z=f0,a0=2}else{var zh,Ev,ur;zh=ev+qv*P0,Ev=Tv+Rv*P0,ur=jv+x0*P0;var Vs=v;Vs.x=zh,Vs.y=Ev,Vs.z=ur,a0=3}var ls=v.x*v.x+v.y*v.y+v.z*v.z;if(T_<0||ls<T_){Pv=a0&1|(a0&2)<<1,T_=ls;var C0=v;Sv=C0.x,Sn=C0.y,Iv=C0.z}}var Wl;if(T_>0){var Fe=v;Fe.x=Sv,Fe.y=Sn,Fe.z=Iv,Wl=Pv}else{var u0=p_*p_+$s*$s+Ee*Ee;u0>0&&(u0=1/Math.sqrt(u0)),p_*=u0,$s*=u0,Ee*=u0;var Ll=X0*p_+v0*$s+M_*Ee,Ul=p_*p_+$s*$s+Ee*Ee;Ul=Ll/Ul,Sv=p_*Ul,Sn=$s*Ul,Iv=Ee*Ul;var Ol=v;Ol.x=Sv,Ol.y=Sn,Ol.z=Iv,Wl=7}var Ih=v.x*v.x+v.y*v.y+v.z*v.z;if(Ir<0||Ih<Ir){me=Wl<<1,Ir=Ih;var _v=v;xr=_v.x,so=_v.y,Qn=_v.z}}if(Ir>0){var vv=v;vv.x=xr,vv.y=so,vv.z=Qn,C=me}else v.zero(),C=15;break}if(this.shrinkSimplex(C),v.x*v.x+v.y*v.y+v.z*v.z<Q){if(L==0||this.simplexSize==4)return _.fraction=L,!1;this.interpolateClosestPoints(),_.fraction=L;var T0=_.normal;T0.x=s.x,T0.y=s.y,T0.z=s.z;var I_=T0,Yl=Math.sqrt(I_.x*I_.x+I_.y*I_.y+I_.z*I_.z);Yl>0&&(Yl=1/Yl);var Vh=I_.x*Yl,Bh=I_.y*Yl,t0=I_.z*Yl;I_.x=Vh,I_.y=Bh,I_.z=t0;var lv=_.position,kh=this.closestPoint1;lv.x=kh.x,lv.y=kh.y,lv.z=kh.z;var Zl=lv,wh=Zl.x+r.x*L,Kh=Zl.y+r.y*L,eh=Zl.z+r.z*L;return Zl.x=wh,Zl.y=Kh,Zl.z=eh,!0}s.x=v.x,s.y=v.y,s.z=v.z;var Ei=s,s_=-Ei.x,V_=-Ei.y,_h=-Ei.z;if(Ei.x=s_,Ei.y=V_,Ei.z=_h,this.c1!=null)this.computeWitnessPoint1(!0);else{var Ah=this.w1[this.simplexSize];Ah.x=this.tf1._positionX,Ah.y=this.tf1._positionY,Ah.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);var dh=this.s[this.simplexSize],Mh=this.w1[this.simplexSize];dh.x=Mh.x,dh.y=Mh.y,dh.z=Mh.z;var Vv=dh,Qh=this.w2[this.simplexSize],Rh=Vv.x-Qh.x,$h=Vv.y-Qh.y,jh=Vv.z-Qh.z;Vv.x=Rh,Vv.y=$h,Vv.z=jh;var ph=h[this.simplexSize],Sh=ph.x-m.x,il=ph.y-m.y,ic=ph.z-m.z;if(ph.x=Sh,ph.y=il,ph.z=ic,s.x*s.x+s.y*s.y+s.z*s.z<Q)throw new Error("!?");var Xh=h[this.simplexSize],E_=s,Eh=Xh.x*E_.x+Xh.y*E_.y+Xh.z*E_.z;if(Eh<0){if(g.x*E_.x+g.y*E_.y+g.z*E_.z>=0)return!1;var mh=Eh/(g.x*E_.x+g.y*E_.y+g.z*E_.z);if(L+=mh,L>=1)return!1;var qh=m.x+g.x*mh,Lh=m.y+g.y*mh,ac=m.z+g.z*mh;m.x=qh,m.y=Lh,m.z=ac;for(var Ph=0,Q0=this.simplexSize+1;Ph<Q0;){var rc=Ph++,vh=h[rc],Yh=-mh,Dh=vh.x+g.x*Yh,Ch=vh.y+g.y*Yh,R0=vh.z+g.z*Yh;vh.x=Dh,vh.y=Ch,vh.z=R0}}for(var z0=!1,nc=0,sc=this.simplexSize;nc<sc;){var Fh=nc++,oc=h[Fh].x-h[this.simplexSize].x,tc=h[Fh].y-h[this.simplexSize].y,rl=h[Fh].z-h[this.simplexSize].z;if(oc*oc+tc*tc+rl*rl<Q){z0=!0;break}}z0||this.simplexSize++,++k}return!1}interpolateClosestPoints(){switch(this.simplexSize){case 1:var a=this.closestPoint1,t=this.w1[0];a.x=t.x,a.y=t.y,a.z=t.z;var i=this.closestPoint2,o=this.w2[0];i.x=o.x,i.y=o.y,i.z=o.z;break;case 2:var r,e,_,h=this.closest;r=h.x,e=h.y,_=h.z;var v,s,l,x,b,f,n,c,z,p,y,V,M,I,k,X,L,m,g=this.s[0];v=g.x,s=g.y,l=g.z;var N=this.w1[0];x=N.x,b=N.y,f=N.z;var d=this.w2[0];n=d.x,c=d.y,z=d.z;var F=this.s[1];p=F.x,y=F.y,V=F.z;var S=this.w1[1];M=S.x,I=S.y,k=S.z;var Y=this.w2[1];X=Y.x,L=Y.y,m=Y.z;var Q=this.s[2];Q.x,Q.y,Q.z;var C=this.w1[2];C.x,C.y,C.z;var B=this.w2[2];B.x,B.y,B.z;var Z,$,K;Z=p-v,$=y-s,K=V-l;var E=Z*Z+$*$+K*K;E!=0&&(E=1/E);var J,A,R;J=r-v,A=e-s,R=_-l;var U=(J*Z+A*$+R*K)*E,G,D,H,j,ia,ea,W,q,na;G=M-x,D=I-b,H=k-f,j=x+G*U,ia=b+D*U,ea=f+H*U,G=X-n,D=L-c,H=m-z,W=n+G*U,q=c+D*U,na=z+H*U;var oa=this.closestPoint1;oa.x=j,oa.y=ia,oa.z=ea;var aa=this.closestPoint2;aa.x=W,aa.y=q,aa.z=na;break;case 3:var T,ca,_a,w=this.closest;T=w.x,ca=w.y,_a=w.z;var ta,ra,la,va,ua,za,Ma,Xa,Za,fa,ba,sa,ha,ma,ya,Ba,pa,Ya,Ra,ga,xa,wa,ka,Pa,zt,Oa,Aa,nt=this.s[0];ta=nt.x,ra=nt.y,la=nt.z;var Ea=this.w1[0];va=Ea.x,ua=Ea.y,za=Ea.z;var Fa=this.w2[0];Ma=Fa.x,Xa=Fa.y,Za=Fa.z;var da=this.s[1];fa=da.x,ba=da.y,sa=da.z;var ft=this.w1[1];ha=ft.x,ma=ft.y,ya=ft.z;var Wa=this.w2[1];Ba=Wa.x,pa=Wa.y,Ya=Wa.z;var Ha=this.s[2];Ra=Ha.x,ga=Ha.y,xa=Ha.z;var bt=this.w1[2];wa=bt.x,ka=bt.y,Pa=bt.z;var it=this.w2[2];zt=it.x,Oa=it.y,Aa=it.z;var Ka,_t,gt,pt,Ga,rt,xt,Da,Ta;Ka=fa-ta,_t=ba-ra,gt=sa-la,pt=Ra-ta,Ga=ga-ra,rt=xa-la,xt=T-ta,Da=ca-ra,Ta=_a-la;var Na=Ka*Ka+_t*_t+gt*gt,Vt=Ka*pt+_t*Ga+gt*rt,Pt=pt*pt+Ga*Ga+rt*rt,st=Ka*xt+_t*Da+gt*Ta,Xt=pt*xt+Ga*Da+rt*Ta,Yt=Na*Pt-Vt*Vt;Yt!=0&&(Yt=1/Yt);var Mt=(st*Pt-Xt*Vt)*Yt,Ia=(-st*Vt+Xt*Na)*Yt,O,Va,lt,P,wt,At,dt,yt,kt;O=ha-va,Va=ma-ua,lt=ya-za,P=va+O*Mt,wt=ua+Va*Mt,At=za+lt*Mt,O=wa-va,Va=ka-ua,lt=Pa-za,P+=O*Ia,wt+=Va*Ia,At+=lt*Ia,O=Ba-Ma,Va=pa-Xa,lt=Ya-Za,dt=Ma+O*Mt,yt=Xa+Va*Mt,kt=Za+lt*Mt,O=zt-Ma,Va=Oa-Xa,lt=Aa-Za,dt+=O*Ia,yt+=Va*Ia,kt+=lt*Ia;var mt=this.closestPoint1;mt.x=P,mt.y=wt,mt.z=At;var ht=this.closestPoint2;ht.x=dt,ht.y=yt,ht.z=kt;break;default:throw new Error("!?")}}loadCache(a){var t=this.dir,i=a.prevClosestDir;t.x=i.x,t.y=i.y,t.z=i.z}saveCache(a){var t=a.prevClosestDir,i=this.closest;t.x=i.x,t.y=i.y,t.z=i.z;var o=t,r=-o.x,e=-o.y,_=-o.z;o.x=r,o.y=e,o.z=_}shrinkSimplex(a){switch(this.simplexSize=a,this.simplexSize=(this.simplexSize&5)+(this.simplexSize>>1&5),this.simplexSize=(this.simplexSize&3)+(this.simplexSize>>2&3),a){case 2:var t=this.s[0],i=this.s[1];t.x=i.x,t.y=i.y,t.z=i.z;var o=this.w1[0],r=this.w1[1];o.x=r.x,o.y=r.y,o.z=r.z;var e=this.w2[0],_=this.w2[1];e.x=_.x,e.y=_.y,e.z=_.z;break;case 4:var h=this.s[0],v=this.s[2];h.x=v.x,h.y=v.y,h.z=v.z;var s=this.w1[0],l=this.w1[2];s.x=l.x,s.y=l.y,s.z=l.z;var x=this.w2[0],b=this.w2[2];x.x=b.x,x.y=b.y,x.z=b.z;break;case 5:var f=this.s[1],n=this.s[2];f.x=n.x,f.y=n.y,f.z=n.z;var c=this.w1[1],z=this.w1[2];c.x=z.x,c.y=z.y,c.z=z.z;var p=this.w2[1],y=this.w2[2];p.x=y.x,p.y=y.y,p.z=y.z;break;case 6:var V=this.s[0],M=this.s[2];V.x=M.x,V.y=M.y,V.z=M.z;var I=this.w1[0],k=this.w1[2];I.x=k.x,I.y=k.y,I.z=k.z;var X=this.w2[0],L=this.w2[2];X.x=L.x,X.y=L.y,X.z=L.z;break;case 8:var m=this.s[0],g=this.s[3];m.x=g.x,m.y=g.y,m.z=g.z;var N=this.w1[0],d=this.w1[3];N.x=d.x,N.y=d.y,N.z=d.z;var F=this.w2[0],S=this.w2[3];F.x=S.x,F.y=S.y,F.z=S.z;break;case 9:var Y=this.s[1],Q=this.s[3];Y.x=Q.x,Y.y=Q.y,Y.z=Q.z;var C=this.w1[1],B=this.w1[3];C.x=B.x,C.y=B.y,C.z=B.z;var Z=this.w2[1],$=this.w2[3];Z.x=$.x,Z.y=$.y,Z.z=$.z;break;case 10:var K=this.s[0],E=this.s[3];K.x=E.x,K.y=E.y,K.z=E.z;var J=this.w1[0],A=this.w1[3];J.x=A.x,J.y=A.y,J.z=A.z;var R=this.w2[0],U=this.w2[3];R.x=U.x,R.y=U.y,R.z=U.z;break;case 11:var G=this.s[2],D=this.s[3];G.x=D.x,G.y=D.y,G.z=D.z;var H=this.w1[2],j=this.w1[3];H.x=j.x,H.y=j.y,H.z=j.z;var ia=this.w2[2],ea=this.w2[3];ia.x=ea.x,ia.y=ea.y,ia.z=ea.z;break;case 12:var W=this.s[0],q=this.s[2];W.x=q.x,W.y=q.y,W.z=q.z;var na=this.w1[0],oa=this.w1[2];na.x=oa.x,na.y=oa.y,na.z=oa.z;var aa=this.w2[0],T=this.w2[2];aa.x=T.x,aa.y=T.y,aa.z=T.z;var ca=this.s[1],_a=this.s[3];ca.x=_a.x,ca.y=_a.y,ca.z=_a.z;var w=this.w1[1],ta=this.w1[3];w.x=ta.x,w.y=ta.y,w.z=ta.z;var ra=this.w2[1],la=this.w2[3];ra.x=la.x,ra.y=la.y,ra.z=la.z;break;case 13:var va=this.s[1],ua=this.s[3];va.x=ua.x,va.y=ua.y,va.z=ua.z;var za=this.w1[1],Ma=this.w1[3];za.x=Ma.x,za.y=Ma.y,za.z=Ma.z;var Xa=this.w2[1],Za=this.w2[3];Xa.x=Za.x,Xa.y=Za.y,Xa.z=Za.z;break;case 14:var fa=this.s[0],ba=this.s[3];fa.x=ba.x,fa.y=ba.y,fa.z=ba.z;var sa=this.w1[0],ha=this.w1[3];sa.x=ha.x,sa.y=ha.y,sa.z=ha.z;var ma=this.w2[0],ya=this.w2[3];ma.x=ya.x,ma.y=ya.y,ma.z=ya.z;break}}computeWitnessPoint1(a){var t,i,o,r,e,_,h=this.dir;r=h.x,e=h.y,_=h.z;var v,s,l,x,b,f;x=this.tf1._rotation00*r+this.tf1._rotation10*e+this.tf1._rotation20*_,b=this.tf1._rotation01*r+this.tf1._rotation11*e+this.tf1._rotation21*_,f=this.tf1._rotation02*r+this.tf1._rotation12*e+this.tf1._rotation22*_,v=x,s=b,l=f;var n,c,z,p=this.dir;if(p.x=v,p.y=s,p.z=l,this.c1.computeLocalSupportingVertex(this.dir,this.w1[this.simplexSize]),a){var y=this.dir,V=Math.sqrt(y.x*y.x+y.y*y.y+y.z*y.z);V>0&&(V=1/V);var M=y.x*V,I=y.y*V,k=y.z*V;y.x=M,y.y=I,y.z=k;var X=this.w1[this.simplexSize],L=this.dir,m=this.c1._gjkMargin,g=X.x+L.x*m,N=X.y+L.y*m,d=X.z+L.z*m;X.x=g,X.y=N,X.z=d}var F=this.w1[this.simplexSize];t=F.x,i=F.y,o=F.z;var S,Y,Q;S=this.tf1._rotation00*t+this.tf1._rotation01*i+this.tf1._rotation02*o,Y=this.tf1._rotation10*t+this.tf1._rotation11*i+this.tf1._rotation12*o,Q=this.tf1._rotation20*t+this.tf1._rotation21*i+this.tf1._rotation22*o,n=S,c=Y,z=Q,n+=this.tf1._positionX,c+=this.tf1._positionY,z+=this.tf1._positionZ;var C=this.w1[this.simplexSize];C.x=n,C.y=c,C.z=z;var B=this.dir;B.x=r,B.y=e,B.z=_}computeWitnessPoint2(a){var t,i,o,r,e,_,h=this.dir;r=h.x,e=h.y,_=h.z;var v,s,l,x,b,f;x=this.tf2._rotation00*r+this.tf2._rotation10*e+this.tf2._rotation20*_,b=this.tf2._rotation01*r+this.tf2._rotation11*e+this.tf2._rotation21*_,f=this.tf2._rotation02*r+this.tf2._rotation12*e+this.tf2._rotation22*_,v=x,s=b,l=f,v=-v,s=-s,l=-l;var n,c,z,p=this.dir;if(p.x=v,p.y=s,p.z=l,this.c2.computeLocalSupportingVertex(this.dir,this.w2[this.simplexSize]),a){var y=this.dir,V=Math.sqrt(y.x*y.x+y.y*y.y+y.z*y.z);V>0&&(V=1/V);var M=y.x*V,I=y.y*V,k=y.z*V;y.x=M,y.y=I,y.z=k;var X=this.w2[this.simplexSize],L=this.dir,m=this.c2._gjkMargin,g=X.x+L.x*m,N=X.y+L.y*m,d=X.z+L.z*m;X.x=g,X.y=N,X.z=d}var F=this.w2[this.simplexSize];t=F.x,i=F.y,o=F.z;var S,Y,Q;S=this.tf2._rotation00*t+this.tf2._rotation01*i+this.tf2._rotation02*o,Y=this.tf2._rotation10*t+this.tf2._rotation11*i+this.tf2._rotation12*o,Q=this.tf2._rotation20*t+this.tf2._rotation21*i+this.tf2._rotation22*o,n=S,c=Y,z=Q,n+=this.tf2._positionX,c+=this.tf2._positionY,z+=this.tf2._positionZ;var C=this.w2[this.simplexSize];C.x=n,C.y=c,C.z=z;var B=this.dir;B.x=r,B.y=e,B.z=_}pointToTetrahedron(){for(var a=0;a<3;){var t=a++,i=this.dir,o=this.baseDirs[t];i.x=o.x,i.y=o.y,i.z=o.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var r=this.s[this.simplexSize],e=this.w1[this.simplexSize];r.x=e.x,r.y=e.y,r.z=e.z;var _=r,h=this.w2[this.simplexSize],v=_.x-h.x,s=_.y-h.y,l=_.z-h.z;if(_.x=v,_.y=s,_.z=l,this.simplexSize++,this.lineToTetrahedron(),this.simplexSize==4)break;this.simplexSize--;var x=this.dir,b=-x.x,f=-x.y,n=-x.z;x.x=b,x.y=f,x.z=n,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var c=this.s[this.simplexSize],z=this.w1[this.simplexSize];c.x=z.x,c.y=z.y,c.z=z.z;var p=c,y=this.w2[this.simplexSize],V=p.x-y.x,M=p.y-y.y,I=p.z-y.z;if(p.x=V,p.y=M,p.z=I,this.simplexSize++,this.lineToTetrahedron(),this.simplexSize==4)break;this.simplexSize--}}lineToTetrahedron(){var a,t,i,o=this.dir;a=o.x,t=o.y,i=o.z;var r,e,_,h,v,s,l,x,b,f=this.s[0];r=f.x,e=f.y,_=f.z;var n=this.s[1];h=n.x,v=n.y,s=n.z,l=r-h,x=e-v,b=_-s;for(var c=0;c<3;){var z=c++,p,y,V,M=this.baseDirs[z];p=M.x,y=M.y,V=M.z;var I,k,X;I=x*V-b*y,k=b*p-l*V,X=l*y-x*p;var L=this.dir;L.x=I,L.y=k,L.z=X,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var m=this.s[this.simplexSize],g=this.w1[this.simplexSize];m.x=g.x,m.y=g.y,m.z=g.z;var N=m,d=this.w2[this.simplexSize],F=N.x-d.x,S=N.y-d.y,Y=N.z-d.z;if(N.x=F,N.y=S,N.z=Y,this.simplexSize++,this.triangleToTetrahedron(),this.simplexSize==4)break;this.simplexSize--;var Q=this.dir,C=-Q.x,B=-Q.y,Z=-Q.z;Q.x=C,Q.y=B,Q.z=Z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var $=this.s[this.simplexSize],K=this.w1[this.simplexSize];$.x=K.x,$.y=K.y,$.z=K.z;var E=$,J=this.w2[this.simplexSize],A=E.x-J.x,R=E.y-J.y,U=E.z-J.z;if(E.x=A,E.y=R,E.z=U,this.simplexSize++,this.triangleToTetrahedron(),this.simplexSize==4)break;this.simplexSize--}var G=this.dir;G.x=a,G.y=t,G.z=i}triangleToTetrahedron(){var a,t,i,o=this.dir;for(a=o.x,t=o.y,i=o.z;;){var r,e,_,h,v,s,l,x,b,f,n,c,z,p,y,V=this.s[0];r=V.x,e=V.y,_=V.z;var M=this.s[1];h=M.x,v=M.y,s=M.z;var I=this.s[2];l=I.x,x=I.y,b=I.z,f=h-r,n=v-e,c=s-_,z=l-r,p=x-e,y=b-_;var k,X,L;k=n*y-c*p,X=c*z-f*y,L=f*p-n*z;var m=this.dir;m.x=k,m.y=X,m.z=L,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var g=this.s[this.simplexSize],N=this.w1[this.simplexSize];g.x=N.x,g.y=N.y,g.z=N.z;var d=g,F=this.w2[this.simplexSize],S=d.x-F.x,Y=d.y-F.y,Q=d.z-F.z;if(d.x=S,d.y=Y,d.z=Q,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;var C=this.dir,B=-C.x,Z=-C.y,$=-C.z;C.x=B,C.y=Z,C.z=$,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var K=this.s[this.simplexSize],E=this.w1[this.simplexSize];K.x=E.x,K.y=E.y,K.z=E.z;var J=K,A=this.w2[this.simplexSize],R=J.x-A.x,U=J.y-A.y,G=J.z-A.z;if(J.x=R,J.y=U,J.z=G,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;break}var D=this.dir;D.x=a,D.y=t,D.z=i}isValidTetrahedron(){var a=this.s[1].x-this.s[0].x,t=this.s[1].y-this.s[0].y,i=this.s[1].z-this.s[0].z,o=this.s[2].x-this.s[0].x,r=this.s[2].y-this.s[0].y,e=this.s[2].z-this.s[0].z,_=this.s[3].x-this.s[0].x,h=this.s[3].y-this.s[0].y,v=this.s[3].z-this.s[0].z,s=a*(r*v-e*h)-t*(o*v-e*_)+i*(o*h-r*_);return s>1e-12?!0:s<-1e-12}computeDepth(a,t,i,o,r,e,_){for(var h=this.polyhedron;h._numTriangles>0;){var v=h._triangleList;h._numTriangles--;var s=v._prev,l=v._next;s!=null&&(s._next=l),l!=null&&(l._prev=s),v==h._triangleList&&(h._triangleList=h._triangleList._next),v==h._triangleListLast&&(h._triangleListLast=h._triangleListLast._prev),v._next=null,v._prev=null,v.removeReferences(),v._next=h._trianglePool,h._trianglePool=v}for(;h._numVertices>0;){var x=h._vertices[--h._numVertices];x.removeReferences(),x._next=h._vertexPool,h._vertexPool=x}var b=this.polyhedron,f=this.polyhedron,n=f._vertexPool;n!=null?(f._vertexPool=n._next,n._next=null):n=new u.collision.narrowphase.detector.gjkepa.EpaVertex;var c=n.init(r[0],e[0],_[0]),z=this.polyhedron,p=z._vertexPool;p!=null?(z._vertexPool=p._next,p._next=null):p=new u.collision.narrowphase.detector.gjkepa.EpaVertex;var y=p.init(r[1],e[1],_[1]),V=this.polyhedron,M=V._vertexPool;M!=null?(V._vertexPool=M._next,M._next=null):M=new u.collision.narrowphase.detector.gjkepa.EpaVertex;var I=M.init(r[2],e[2],_[2]),k=this.polyhedron,X=k._vertexPool;if(X!=null?(k._vertexPool=X._next,X._next=null):X=new u.collision.narrowphase.detector.gjkepa.EpaVertex,!b._init(c,y,I,X.init(r[3],e[3],_[3])))return u.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT;this.simplexSize=0;for(var L=this.s[0],m=this.w1[0],g=this.w2[0],N=0,d=40;N<d;){for(var F=this.polyhedron._triangleList,S=1/0,Y=null;F!=null;){var Q=F._next;F._distanceSq<S&&(S=F._distanceSq,Y=F),F=Q}var C=Y,B=this.dir,Z=C._normal;B.x=Z.x,B.y=Z.y,B.z=Z.z;var $=B,K=Math.sqrt($.x*$.x+$.y*$.y+$.z*$.z);K>0&&(K=1/K);var E=$.x*K,J=$.y*K,A=$.z*K;$.x=E,$.y=J,$.z=A,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var R=this.s[this.simplexSize],U=this.w1[this.simplexSize];R.x=U.x,R.y=U.y,R.z=U.z;var G=R,D=this.w2[this.simplexSize],H=G.x-D.x,j=G.y-D.y,ia=G.z-D.z;G.x=H,G.y=j,G.z=ia;var ea=C._vertices[0],W=C._vertices[1],q=C._vertices[2],na=ea.v,oa=this.dir,aa=na.x*oa.x+na.y*oa.y+na.z*oa.z,T=this.dir,ca=L.x*T.x+L.y*T.y+L.z*T.z;if(ca-aa<1e-6||N==d-1){var _a=this.closest,w=this.dir;_a.x=w.x,_a.y=w.y,_a.z=w.z;var ta=_a,ra=this.dir,la=ea.v,va=this.dir,ua=(ra.x*la.x+ra.y*la.y+ra.z*la.z)/(va.x*va.x+va.y*va.y+va.z*va.z),za=ta.x*ua,Ma=ta.y*ua,Xa=ta.z*ua;ta.x=za,ta.y=Ma,ta.z=Xa;var Za,fa,ba,sa=this.closest;Za=sa.x,fa=sa.y,ba=sa.z;var ha,ma,ya,Ba,pa,Ya,Ra,ga,xa,wa,ka,Pa,zt,Oa,Aa,nt,Ea,Fa,da,ft,Wa,Ha,bt,it,Ka,_t,gt,pt=ea.v;ha=pt.x,ma=pt.y,ya=pt.z;var Ga=ea.w1;Ba=Ga.x,pa=Ga.y,Ya=Ga.z;var rt=ea.w2;Ra=rt.x,ga=rt.y,xa=rt.z;var xt=W.v;wa=xt.x,ka=xt.y,Pa=xt.z;var Da=W.w1;zt=Da.x,Oa=Da.y,Aa=Da.z;var Ta=W.w2;nt=Ta.x,Ea=Ta.y,Fa=Ta.z;var Na=q.v;da=Na.x,ft=Na.y,Wa=Na.z;var Vt=q.w1;Ha=Vt.x,bt=Vt.y,it=Vt.z;var Pt=q.w2;Ka=Pt.x,_t=Pt.y,gt=Pt.z;var st,Xt,Yt,Mt,Ia,O,Va,lt,P;st=wa-ha,Xt=ka-ma,Yt=Pa-ya,Mt=da-ha,Ia=ft-ma,O=Wa-ya,Va=Za-ha,lt=fa-ma,P=ba-ya;var wt=st*st+Xt*Xt+Yt*Yt,At=st*Mt+Xt*Ia+Yt*O,dt=Mt*Mt+Ia*Ia+O*O,yt=st*Va+Xt*lt+Yt*P,kt=Mt*Va+Ia*lt+O*P,mt=wt*dt-At*At;mt!=0&&(mt=1/mt);var ht=(yt*dt-kt*At)*mt,ut=(-yt*At+kt*wt)*mt,Qa,et,Ca,vt,qa,at,Ua,tt,ct;Qa=zt-Ba,et=Oa-pa,Ca=Aa-Ya,vt=Ba+Qa*ht,qa=pa+et*ht,at=Ya+Ca*ht,Qa=Ha-Ba,et=bt-pa,Ca=it-Ya,vt+=Qa*ut,qa+=et*ut,at+=Ca*ut,Qa=nt-Ra,et=Ea-ga,Ca=Fa-xa,Ua=Ra+Qa*ht,tt=ga+et*ht,ct=xa+Ca*ht,Qa=Ka-Ra,et=_t-ga,Ca=gt-xa,Ua+=Qa*ut,tt+=et*ut,ct+=Ca*ut;var Sa=this.closestPoint1;Sa.x=vt,Sa.y=qa,Sa.z=at;var Ja=this.closestPoint2;Ja.x=Ua,Ja.y=tt,Ja.z=ct;var ja=this.closest;return this.depth=Math.sqrt(ja.x*ja.x+ja.y*ja.y+ja.z*ja.z),u.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED}var La=this.polyhedron,ot=La._vertexPool;ot!=null?(La._vertexPool=ot._next,ot._next=null):ot=new u.collision.narrowphase.detector.gjkepa.EpaVertex;var It=ot.init(L,m,g);if(!this.polyhedron._addVertex(It,C))return u.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX;++N}return u.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE}computeClosestPoints(a,t,i,o,r){return this.computeClosestPointsImpl(a,t,i,o,r,!0)}computeDistance(a,t,i,o,r){return this.computeClosestPointsImpl(a,t,i,o,r,!1)}convexCast(a,t,i,o,r,e,_){return this.convexCastImpl(a,t,i,o,r,e,_)}rayCast(a,t,i,o,r){var e=this.tempTransform,_=t,h=i;e._positionX=h.x,e._positionY=h.y,e._positionZ=h.z;var v=this.tl1,s=this.tl2;v.x=o.x,v.y=o.y,v.z=o.z;var l=v,x=l.x-i.x,b=l.y-i.y,f=l.z-i.z;return l.x=x,l.y=b,l.z=f,s.zero(),this.convexCastImpl(null,a,e,_,v,s,r)}static getInstance(){return u.collision.narrowphase.detector.gjkepa.GjkEpa.instance}};u.collision.narrowphase.detector.gjkepa.GjkEpaLog=class{};u.collision.narrowphase.detector.gjkepa.GjkEpaResultState=class{};u.collision.narrowphase.detector.gjkepa.SimplexUtil=class{static projectOrigin2(a,t,i){var o,r,e,_,h,v,s=a;o=s.x,r=s.y,e=s.z;var l=t;_=l.x,h=l.y,v=l.z;var x,b,f;x=_-o,b=h-r,f=v-e;var n=x*x+b*b+f*f,c=x*o+b*r+f*e;if(c=-c/n,c<0){var z=i;return z.x=o,z.y=r,z.z=e,1}if(c>1){var p=i;return p.x=_,p.y=h,p.z=v,2}var y,V,M;y=o+x*c,V=r+b*c,M=e+f*c;var I=i;return I.x=y,I.y=V,I.z=M,3}static projectOrigin3(a,t,i,o){var r,e,_,h,v,s,l,x,b,f,n,c,z,p,y,V,M,I,k=a;r=k.x,e=k.y,_=k.z;var X=t;h=X.x,v=X.y,s=X.z;var L=i;l=L.x,x=L.y,b=L.z,f=h-r,n=v-e,c=s-_,z=l-h,p=x-v,y=b-s,V=r-l,M=e-x,I=_-b;var m,g,N;m=n*y-c*p,g=c*z-f*y,N=f*p-n*z;var d,F,S,Y,Q,C,B,Z,$;d=n*N-c*g,F=c*m-f*N,S=f*g-n*m,Y=p*N-y*g,Q=y*m-z*N,C=z*g-p*m,B=M*N-I*g,Z=I*m-V*N,$=V*g-M*m;var K=r*d+e*F+_*S,E=h*Y+v*Q+s*C,J=l*B+x*Z+b*$,A=-1,R,U,G,D=0;if(R=0,U=0,G=0,K<0){var H,j,ia,ea,W,q,na=a;H=na.x,j=na.y,ia=na.z;var oa=t;ea=oa.x,W=oa.y,q=oa.z;var aa,T,ca;aa=ea-H,T=W-j,ca=q-ia;var _a=aa*aa+T*T+ca*ca,w=aa*H+T*j+ca*ia;w=-w/_a;var ta;if(w<0){var ra=o;ra.x=H,ra.y=j,ra.z=ia,ta=1}else if(w>1){var la=o;la.x=ea,la.y=W,la.z=q,ta=2}else{var va,ua,za;va=H+aa*w,ua=j+T*w,za=ia+ca*w;var Ma=o;Ma.x=va,Ma.y=ua,Ma.z=za,ta=3}var Xa=o.x*o.x+o.y*o.y+o.z*o.z;D=ta,A=Xa;var Za=o;R=Za.x,U=Za.y,G=Za.z}if(E<0){var fa,ba,sa,ha,ma,ya,Ba=t;fa=Ba.x,ba=Ba.y,sa=Ba.z;var pa=i;ha=pa.x,ma=pa.y,ya=pa.z;var Ya,Ra,ga;Ya=ha-fa,Ra=ma-ba,ga=ya-sa;var xa=Ya*Ya+Ra*Ra+ga*ga,wa=Ya*fa+Ra*ba+ga*sa;wa=-wa/xa;var ka;if(wa<0){var Pa=o;Pa.x=fa,Pa.y=ba,Pa.z=sa,ka=1}else if(wa>1){var zt=o;zt.x=ha,zt.y=ma,zt.z=ya,ka=2}else{var Oa,Aa,nt;Oa=fa+Ya*wa,Aa=ba+Ra*wa,nt=sa+ga*wa;var Ea=o;Ea.x=Oa,Ea.y=Aa,Ea.z=nt,ka=3}var Fa=o.x*o.x+o.y*o.y+o.z*o.z;if(A<0||Fa<A){D=ka<<1,A=Fa;var da=o;R=da.x,U=da.y,G=da.z}}if(J<0){var ft,Wa,Ha,bt,it,Ka,_t=a;ft=_t.x,Wa=_t.y,Ha=_t.z;var gt=i;bt=gt.x,it=gt.y,Ka=gt.z;var pt,Ga,rt;pt=bt-ft,Ga=it-Wa,rt=Ka-Ha;var xt=pt*pt+Ga*Ga+rt*rt,Da=pt*ft+Ga*Wa+rt*Ha;Da=-Da/xt;var Ta;if(Da<0){var Na=o;Na.x=ft,Na.y=Wa,Na.z=Ha,Ta=1}else if(Da>1){var Vt=o;Vt.x=bt,Vt.y=it,Vt.z=Ka,Ta=2}else{var Pt,st,Xt;Pt=ft+pt*Da,st=Wa+Ga*Da,Xt=Ha+rt*Da;var Yt=o;Yt.x=Pt,Yt.y=st,Yt.z=Xt,Ta=3}var Mt=o.x*o.x+o.y*o.y+o.z*o.z;if(A<0||Mt<A){D=Ta&1|(Ta&2)<<1,A=Mt;var Ia=o;R=Ia.x,U=Ia.y,G=Ia.z}}if(A>0){var O=o;return O.x=R,O.y=U,O.z=G,D}var Va=m*m+g*g+N*N;Va>0&&(Va=1/Math.sqrt(Va)),m*=Va,g*=Va,N*=Va;var lt=r*m+e*g+_*N,P=m*m+g*g+N*N;P=lt/P,R=m*P,U=g*P,G=N*P;var wt=o;return wt.x=R,wt.y=U,wt.z=G,7}static projectOrigin4(a,t,i,o,r){var e,_,h,v,s,l,x,b,f,n,c,z,p,y,V,M,I,k,X,L,m,g,N,d,F,S,Y,Q=a;e=Q.x,_=Q.y,h=Q.z;var C=t;v=C.x,s=C.y,l=C.z;var B=i;x=B.x,b=B.y,f=B.z;var Z=o;n=Z.x,c=Z.y,z=Z.z,p=v-e,y=s-_,V=l-h,M=x-e,I=b-_,k=f-h,X=n-e,L=c-_,m=z-h,g=x-v,N=b-s,d=f-l,F=n-v,S=c-s,Y=z-l;var $,K,E,J,A,R,U,G,D,H,j,ia;$=y*k-V*I,K=V*M-p*k,E=p*I-y*M,J=I*m-k*L,A=k*X-M*m,R=M*L-I*X,U=L*V-m*y,G=m*p-X*V,D=X*y-L*p,H=S*d-Y*N,j=Y*g-F*d,ia=F*N-S*g;var ea=p*H+y*j+V*ia>0?1:-1,W=e*$+_*K+h*E,q=e*J+_*A+h*R,na=e*U+_*G+h*D,oa=v*H+s*j+l*ia,aa=-1,T,ca,_a,w=0;if(T=0,ca=0,_a=0,W*ea<0){var ta,ra,la,va,ua,za,Ma,Xa,Za,fa,ba,sa,ha,ma,ya,Ba,pa,Ya,Ra=a;ta=Ra.x,ra=Ra.y,la=Ra.z;var ga=t;va=ga.x,ua=ga.y,za=ga.z;var xa=i;Ma=xa.x,Xa=xa.y,Za=xa.z,fa=va-ta,ba=ua-ra,sa=za-la,ha=Ma-va,ma=Xa-ua,ya=Za-za,Ba=ta-Ma,pa=ra-Xa,Ya=la-Za;var wa,ka,Pa;wa=ba*ya-sa*ma,ka=sa*ha-fa*ya,Pa=fa*ma-ba*ha;var zt,Oa,Aa,nt,Ea,Fa,da,ft,Wa;zt=ba*Pa-sa*ka,Oa=sa*wa-fa*Pa,Aa=fa*ka-ba*wa,nt=ma*Pa-ya*ka,Ea=ya*wa-ha*Pa,Fa=ha*ka-ma*wa,da=pa*Pa-Ya*ka,ft=Ya*wa-Ba*Pa,Wa=Ba*ka-pa*wa;var Ha=ta*zt+ra*Oa+la*Aa,bt=va*nt+ua*Ea+za*Fa,it=Ma*da+Xa*ft+Za*Wa,Ka=-1,_t,gt,pt,Ga=0;if(_t=0,gt=0,pt=0,Ha<0){var rt,xt,Da,Ta,Na,Vt,Pt=a;rt=Pt.x,xt=Pt.y,Da=Pt.z;var st=t;Ta=st.x,Na=st.y,Vt=st.z;var Xt,Yt,Mt;Xt=Ta-rt,Yt=Na-xt,Mt=Vt-Da;var Ia=Xt*Xt+Yt*Yt+Mt*Mt,O=Xt*rt+Yt*xt+Mt*Da;O=-O/Ia;var Va;if(O<0){var lt=r;lt.x=rt,lt.y=xt,lt.z=Da,Va=1}else if(O>1){var P=r;P.x=Ta,P.y=Na,P.z=Vt,Va=2}else{var wt,At,dt;wt=rt+Xt*O,At=xt+Yt*O,dt=Da+Mt*O;var yt=r;yt.x=wt,yt.y=At,yt.z=dt,Va=3}var kt=r.x*r.x+r.y*r.y+r.z*r.z;Ga=Va,Ka=kt;var mt=r;_t=mt.x,gt=mt.y,pt=mt.z}if(bt<0){var ht,ut,Qa,et,Ca,vt,qa=t;ht=qa.x,ut=qa.y,Qa=qa.z;var at=i;et=at.x,Ca=at.y,vt=at.z;var Ua,tt,ct;Ua=et-ht,tt=Ca-ut,ct=vt-Qa;var Sa=Ua*Ua+tt*tt+ct*ct,Ja=Ua*ht+tt*ut+ct*Qa;Ja=-Ja/Sa;var ja;if(Ja<0){var La=r;La.x=ht,La.y=ut,La.z=Qa,ja=1}else if(Ja>1){var ot=r;ot.x=et,ot.y=Ca,ot.z=vt,ja=2}else{var It,oi,gi;It=ht+Ua*Ja,oi=ut+tt*Ja,gi=Qa+ct*Ja;var ai=r;ai.x=It,ai.y=oi,ai.z=gi,ja=3}var Ct=r.x*r.x+r.y*r.y+r.z*r.z;if(Ka<0||Ct<Ka){Ga=ja<<1,Ka=Ct;var _i=r;_t=_i.x,gt=_i.y,pt=_i.z}}if(it<0){var Et,St,Jt,Ki,vi,li,ti=a;Et=ti.x,St=ti.y,Jt=ti.z;var Oi=i;Ki=Oi.x,vi=Oi.y,li=Oi.z;var Xi,zi,Zt;Xi=Ki-Et,zi=vi-St,Zt=li-Jt;var ri=Xi*Xi+zi*zi+Zt*Zt,Wt=Xi*Et+zi*St+Zt*Jt;Wt=-Wt/ri;var ni;if(Wt<0){var $i=r;$i.x=Et,$i.y=St,$i.z=Jt,ni=1}else if(Wt>1){var Ut=r;Ut.x=Ki,Ut.y=vi,Ut.z=li,ni=2}else{var ji,Ii,pr;ji=Et+Xi*Wt,Ii=St+zi*Wt,pr=Jt+Zt*Wt;var Wi=r;Wi.x=ji,Wi.y=Ii,Wi.z=pr,ni=3}var Lt=r.x*r.x+r.y*r.y+r.z*r.z;if(Ka<0||Lt<Ka){Ga=ni&1|(ni&2)<<1,Ka=Lt;var jt=r;_t=jt.x,gt=jt.y,pt=jt.z}}var Tt;if(Ka>0){var bi=r;bi.x=_t,bi.y=gt,bi.z=pt,Tt=Ga}else{var Mi=wa*wa+ka*ka+Pa*Pa;Mi>0&&(Mi=1/Math.sqrt(Mi)),wa*=Mi,ka*=Mi,Pa*=Mi;var vr=ta*wa+ra*ka+la*Pa,qt=wa*wa+ka*ka+Pa*Pa;qt=vr/qt,_t=wa*qt,gt=ka*qt,pt=Pa*qt;var fi=r;fi.x=_t,fi.y=gt,fi.z=pt,Tt=7}var Bt=r.x*r.x+r.y*r.y+r.z*r.z;w=Tt,aa=Bt;var xi=r;T=xi.x,ca=xi.y,_a=xi.z}if(q*ea<0){var hi,sr,Xr,ro,Gt,fr,mr,Dt,Br,Si,Dr,Hn,oo,Ar,no,yn,Ao,Io,ui=a;hi=ui.x,sr=ui.y,Xr=ui.z;var qr=i;ro=qr.x,Gt=qr.y,fr=qr.z;var dr=o;mr=dr.x,Dt=dr.y,Br=dr.z,Si=ro-hi,Dr=Gt-sr,Hn=fr-Xr,oo=mr-ro,Ar=Dt-Gt,no=Br-fr,yn=hi-mr,Ao=sr-Dt,Io=Xr-Br;var yr,So,Di;yr=Dr*no-Hn*Ar,So=Hn*oo-Si*no,Di=Si*Ar-Dr*oo;var Sr,gr,Qt,Hi,Li,Cn,Me,js,pe;Sr=Dr*Di-Hn*So,gr=Hn*yr-Si*Di,Qt=Si*So-Dr*yr,Hi=Ar*Di-no*So,Li=no*yr-oo*Di,Cn=oo*So-Ar*yr,Me=Ao*Di-Io*So,js=Io*yr-yn*Di,pe=yn*So-Ao*yr;var Ts=hi*Sr+sr*gr+Xr*Qt,qs=ro*Hi+Gt*Li+fr*Cn,D_=mr*Me+Dt*js+Br*pe,gn=-1,Pi,No,Wr,ks=0;if(Pi=0,No=0,Wr=0,Ts<0){var on,Tn,Kn,ws,k_,Qs,Vi=a;on=Vi.x,Tn=Vi.y,Kn=Vi.z;var Ir=i;ws=Ir.x,k_=Ir.y,Qs=Ir.z;var xr,so,Qn;xr=ws-on,so=k_-Tn,Qn=Qs-Kn;var me=xr*xr+so*so+Qn*Qn,nn=xr*on+so*Tn+Qn*Kn;nn=-nn/me;var Rn;if(nn<0){var ci=r;ci.x=on,ci.y=Tn,ci.z=Kn,Rn=1}else if(nn>1){var ho=r;ho.x=ws,ho.y=k_,ho.z=Qs,Rn=2}else{var Fr,En,ae;Fr=on+xr*nn,En=Tn+so*nn,ae=Kn+Qn*nn;var Rs=r;Rs.x=Fr,Rs.y=En,Rs.z=ae,Rn=3}var Es=r.x*r.x+r.y*r.y+r.z*r.z;ks=Rn,gn=Es;var Ds=r;Pi=Ds.x,No=Ds.y,Wr=Ds.z}if(qs<0){var hs,ii,ir,Ri,Fi,fo,Po=i;hs=Po.x,ii=Po.y,ir=Po.z;var e_=o;Ri=e_.x,Fi=e_.y,fo=e_.z;var Fs,te,Dn;Fs=Ri-hs,te=Fi-ii,Dn=fo-ir;var co=Fs*Fs+te*te+Dn*Dn,Ft=Fs*hs+te*ii+Dn*ir;Ft=-Ft/co;var Ni;if(Ft<0){var lr=r;lr.x=hs,lr.y=ii,lr.z=ir,Ni=1}else if(Ft>1){var Vo=r;Vo.x=Ri,Vo.y=Fi,Vo.z=fo,Ni=2}else{var cs,Xs,Ls;cs=hs+Fs*Ft,Xs=ii+te*Ft,Ls=ir+Dn*Ft;var xo=r;xo.x=cs,xo.y=Xs,xo.z=Ls,Ni=3}var $t=r.x*r.x+r.y*r.y+r.z*r.z;if(gn<0||$t<gn){ks=Ni<<1,gn=$t;var Vr=r;Pi=Vr.x,No=Vr.y,Wr=Vr.z}}if(D_<0){var er,Jo,Ne,Co,ko,Nr,Pr=a;er=Pr.x,Jo=Pr.y,Ne=Pr.z;var Cr=o;Co=Cr.x,ko=Cr.y,Nr=Cr.z;var Lr,Rt,Ji;Lr=Co-er,Rt=ko-Jo,Ji=Nr-Ne;var Yi=Lr*Lr+Rt*Rt+Ji*Ji,Qi=Lr*er+Rt*Jo+Ji*Ne;Qi=-Qi/Yi;var zr;if(Qi<0){var qi=r;qi.x=er,qi.y=Jo,qi.z=Ne,zr=1}else if(Qi>1){var Jr=r;Jr.x=Co,Jr.y=ko,Jr.z=Nr,zr=2}else{var Gr,ao,bs;Gr=er+Lr*Qi,ao=Jo+Rt*Qi,bs=Ne+Ji*Qi;var ki=r;ki.x=Gr,ki.y=ao,ki.z=bs,zr=3}var sn=r.x*r.x+r.y*r.y+r.z*r.z;if(gn<0||sn<gn){ks=zr&1|(zr&2)<<1,gn=sn;var Yr=r;Pi=Yr.x,No=Yr.y,Wr=Yr.z}}var Go;if(gn>0){var ye=r;ye.x=Pi,ye.y=No,ye.z=Wr,Go=ks}else{var In=yr*yr+So*So+Di*Di;In>0&&(In=1/Math.sqrt(In)),yr*=In,So*=In,Di*=In;var ge=hi*yr+sr*So+Xr*Di,Vn=yr*yr+So*So+Di*Di;Vn=ge/Vn,Pi=yr*Vn,No=So*Vn,Wr=Di*Vn;var Ci=r;Ci.x=Pi,Ci.y=No,Ci.z=Wr,Go=7}var To=r.x*r.x+r.y*r.y+r.z*r.z;if(aa<0||To<aa){w=Go&1|(Go&6)<<1,aa=To;var eo=r;T=eo.x,ca=eo.y,_a=eo.z}}if(na*ea<0){var Fn,Ns,Nn,Wo,kn,Ys,Ot,Qo,Ur,wn,Jn,fs,Ie,Uo,Ve,w_,Je,X_,Js=a;Fn=Js.x,Ns=Js.y,Nn=Js.z;var F_=t;Wo=F_.x,kn=F_.y,Ys=F_.z;var N_=o;Ot=N_.x,Qo=N_.y,Ur=N_.z,wn=Wo-Fn,Jn=kn-Ns,fs=Ys-Nn,Ie=Ot-Wo,Uo=Qo-kn,Ve=Ur-Ys,w_=Fn-Ot,Je=Ns-Qo,X_=Nn-Ur;var Or,wo,Xo;Or=Jn*Ve-fs*Uo,wo=fs*Ie-wn*Ve,Xo=wn*Uo-Jn*Ie;var Gn,wi,Wn,Ro,to,J_,G_,L_,ie;Gn=Jn*Xo-fs*wo,wi=fs*Or-wn*Xo,Wn=wn*wo-Jn*Or,Ro=Uo*Xo-Ve*wo,to=Ve*Or-Ie*Xo,J_=Ie*wo-Uo*Or,G_=Je*Xo-X_*wo,L_=X_*Or-w_*Xo,ie=w_*wo-Je*Or;var __=Fn*Gn+Ns*wi+Nn*Wn,v_=Wo*Ro+kn*to+Ys*J_,re=Ot*G_+Qo*L_+Ur*ie,pi=-1,Oo,ar,Zs,Ge=0;if(Oo=0,ar=0,Zs=0,__<0){var hv,xs,Gs,$n,We,Ti,Lo=a;hv=Lo.x,xs=Lo.y,Gs=Lo.z;var Tr=t;$n=Tr.x,We=Tr.y,Ti=Tr.z;var en,ke,Y_;en=$n-hv,ke=We-xs,Y_=Ti-Gs;var Ws=en*en+ke*ke+Y_*Y_,jn=en*hv+ke*xs+Y_*Gs;jn=-jn/Ws;var Xn;if(jn<0){var oe=r;oe.x=hv,oe.y=xs,oe.z=Gs,Xn=1}else if(jn>1){var Bs=r;Bs.x=$n,Bs.y=We,Bs.z=Ti,Xn=2}else{var ne,Ue,l_;ne=hv+en*jn,Ue=xs+ke*jn,l_=Gs+Y_*jn;var As=r;As.x=ne,As.y=Ue,As.z=l_,Xn=3}var ds=r.x*r.x+r.y*r.y+r.z*r.z;Ge=Xn,pi=ds;var qn=r;Oo=qn.x,ar=qn.y,Zs=qn.z}if(v_<0){var mi,uo,Zr,Ho,Yo,Hr,Eo=t;mi=Eo.x,uo=Eo.y,Zr=Eo.z;var we=o;Ho=we.x,Yo=we.y,Hr=we.z;var as,Oe,W_;as=Ho-mi,Oe=Yo-uo,W_=Hr-Zr;var ts=as*as+Oe*Oe+W_*W_,Nt=as*mi+Oe*uo+W_*Zr;Nt=-Nt/ts;var Kr;if(Nt<0){var Do=r;Do.x=mi,Do.y=uo,Do.z=Zr,Kr=1}else if(Nt>1){var Xe=r;Xe.x=Ho,Xe.y=Yo,Xe.z=Hr,Kr=2}else{var kv,i0,U_;kv=mi+as*Nt,i0=uo+Oe*Nt,U_=Zr+W_*Nt;var Ht=r;Ht.x=kv,Ht.y=i0,Ht.z=U_,Kr=3}var Ln=r.x*r.x+r.y*r.y+r.z*r.z;if(pi<0||Ln<pi){Ge=Kr<<1,pi=Ln;var Qr=r;Oo=Qr.x,ar=Qr.y,Zs=Qr.z}}if(re<0){var Yn,Z_,He,h_,bo,se,ee=a;Yn=ee.x,Z_=ee.y,He=ee.z;var us=o;h_=us.x,bo=us.y,se=us.z;var Zi,Ko,kr;Zi=h_-Yn,Ko=bo-Z_,kr=se-He;var Zo=Zi*Zi+Ko*Ko+kr*kr,Us=Zi*Yn+Ko*Z_+kr*He;Us=-Us/Zo;var cv;if(Us<0){var zs=r;zs.x=Yn,zs.y=Z_,zs.z=He,cv=1}else if(Us>1){var Ke=r;Ke.x=h_,Ke.y=bo,Ke.z=se,cv=2}else{var wv,Os,si;wv=Yn+Zi*Us,Os=Z_+Ko*Us,si=He+kr*Us;var Zn=r;Zn.x=wv,Zn.y=Os,Zn.z=si,cv=3}var _n=r.x*r.x+r.y*r.y+r.z*r.z;if(pi<0||_n<pi){Ge=cv&1|(cv&2)<<1,pi=_n;var vn=r;Oo=vn.x,ar=vn.y,Zs=vn.z}}var B_;if(pi>0){var bv=r;bv.x=Oo,bv.y=ar,bv.z=Zs,B_=Ge}else{var is=Or*Or+wo*wo+Xo*Xo;is>0&&(is=1/Math.sqrt(is)),Or*=is,wo*=is,Xo*=is;var Ss=Fn*Or+Ns*wo+Nn*Xo,c_=Or*Or+wo*wo+Xo*Xo;c_=Ss/c_,Oo=Or*c_,ar=wo*c_,Zs=Xo*c_;var O_=r;O_.x=Oo,O_.y=ar,O_.z=Zs,B_=7}var fv=r.x*r.x+r.y*r.y+r.z*r.z;if(aa<0||fv<aa){w=B_&3|(B_&4)<<1,aa=fv;var xv=r;T=xv.x,ca=xv.y,_a=xv.z}}if(oa*ea<0){var b_,Hs,zo,_e,ve,Ui,Mo,_o,le,Le,Ye,Ze,A_,Ms,he,H_,$e,Un,ps=t;b_=ps.x,Hs=ps.y,zo=ps.z;var Xv=i;_e=Xv.x,ve=Xv.y,Ui=Xv.z;var d_=o;Mo=d_.x,_o=d_.y,le=d_.z,Le=_e-b_,Ye=ve-Hs,Ze=Ui-zo,A_=Mo-_e,Ms=_o-ve,he=le-Ui,H_=b_-Mo,$e=Hs-_o,Un=zo-le;var $o,ln,po;$o=Ye*he-Ze*Ms,ln=Ze*A_-Le*he,po=Le*Ms-Ye*A_;var Kt,$r,vo,je,Be,qe,S_,jo,rs;Kt=Ye*po-Ze*ln,$r=Ze*$o-Le*po,vo=Le*ln-Ye*$o,je=Ms*po-he*ln,Be=he*$o-A_*po,qe=A_*ln-Ms*$o,S_=$e*po-Un*ln,jo=Un*$o-H_*po,rs=H_*ln-$e*$o;var K_=b_*Kt+Hs*$r+zo*vo,uv=_e*je+ve*Be+Ui*qe,Bi=Mo*S_+_o*jo+le*rs,mo=-1,Rr,io,$_,j_=0;if(Rr=0,io=0,$_=0,K_<0){var Lv,a_,Yv,q_,Ai,av,Ae=t;Lv=Ae.x,a_=Ae.y,Yv=Ae.z;var de=i;q_=de.x,Ai=de.y,av=de.z;var ce,be,Se;ce=q_-Lv,be=Ai-a_,Se=av-Yv;var Zv=ce*ce+be*be+Se*Se,ms=ce*Lv+be*a_+Se*Yv;ms=-ms/Zv;var jr;if(ms<0){var t_=r;t_.x=Lv,t_.y=a_,t_.z=Yv,jr=1}else if(ms>1){var yo=r;yo.x=q_,yo.y=Ai,yo.z=av,jr=2}else{var i_,Fo,Pe;i_=Lv+ce*ms,Fo=a_+be*ms,Pe=Yv+Se*ms;var qo=r;qo.x=i_,qo.y=Fo,qo.z=Pe,jr=3}var ys=r.x*r.x+r.y*r.y+r.z*r.z;j_=jr,mo=ys;var ei=r;Rr=ei.x,io=ei.y,$_=ei.z}if(uv<0){var an,_r,os,gs,Bo,Er,Bn=i;an=Bn.x,_r=Bn.y,os=Bn.z;var tv=o;gs=tv.x,Bo=tv.y,Er=tv.z;var r_,P_,iv;r_=gs-an,P_=Bo-_r,iv=Er-os;var ns=r_*r_+P_*P_+iv*iv,An=r_*an+P_*_r+iv*os;An=-An/ns;var Is;if(An<0){var E0=r;E0.x=an,E0.y=_r,E0.z=os,Is=1}else if(An>1){var M0=r;M0.x=gs,M0.y=Bo,M0.z=Er,Is=2}else{var hl,D0,hr;hl=an+r_*An,D0=_r+P_*An,hr=os+iv*An;var On=r;On.x=hl,On.y=D0,On.z=hr,Is=3}var go=r.x*r.x+r.y*r.y+r.z*r.z;if(mo<0||go<mo){j_=Is<<1,mo=go;var fe=r;Rr=fe.x,io=fe.y,$_=fe.z}}if(Bi<0){var rv,zv,o_,Bv,Ce,f_,x_=t;rv=x_.x,zv=x_.y,o_=x_.z;var di=o;Bv=di.x,Ce=di.y,f_=di.z;var Te,lo,Ps;Te=Bv-rv,lo=Ce-zv,Ps=f_-o_;var Mv=Te*Te+lo*lo+Ps*Ps,Qe=Te*rv+lo*zv+Ps*o_;Qe=-Qe/Mv;var u_;if(Qe<0){var ov=r;ov.x=rv,ov.y=zv,ov.z=o_,u_=1}else if(Qe>1){var r0=r;r0.x=Bv,r0.y=Ce,r0.z=f_,u_=2}else{var o0,nv,tr;o0=rv+Te*Qe,nv=zv+lo*Qe,tr=o_+Ps*Qe;var Ks=r;Ks.x=o0,Ks.y=nv,Ks.z=tr,u_=3}var dn=r.x*r.x+r.y*r.y+r.z*r.z;if(mo<0||dn<mo){j_=u_&1|(u_&2)<<1,mo=dn;var xe=r;Rr=xe.x,io=xe.y,$_=xe.z}}var F0;if(mo>0){var Dv=r;Dv.x=Rr,Dv.y=io,Dv.z=$_,F0=j_}else{var C_=$o*$o+ln*ln+po*po;C_>0&&(C_=1/Math.sqrt(C_)),$o*=C_,ln*=C_,po*=C_;var p0=b_*$o+Hs*ln+zo*po,Av=$o*$o+ln*ln+po*po;Av=p0/Av,Rr=$o*Av,io=ln*Av,$_=po*Av;var n0=r;n0.x=Rr,n0.y=io,n0.z=$_,F0=7}var m0=r.x*r.x+r.y*r.y+r.z*r.z;if(aa<0||m0<aa){w=F0<<1,aa=m0;var N0=r;T=N0.x,ca=N0.y,_a=N0.z}}if(aa>0){var s0=r;return s0.x=T,s0.y=ca,s0.z=_a,w}return r.zero(),15}};u.common.Mat3=class{constructor(a,t,i,o,r,e,_,h,v){v==null&&(v=1),h==null&&(h=0),_==null&&(_=0),e==null&&(e=0),r==null&&(r=1),o==null&&(o=0),i==null&&(i=0),t==null&&(t=0),a==null&&(a=1),this.e00=a,this.e01=t,this.e02=i,this.e10=o,this.e11=r,this.e12=e,this.e20=_,this.e21=h,this.e22=v,u.common.Mat3.numCreations++}init(a,t,i,o,r,e,_,h,v){return this.e00=a,this.e01=t,this.e02=i,this.e10=o,this.e11=r,this.e12=e,this.e20=_,this.e21=h,this.e22=v,this}identity(){var a=1,t=0,i=0,o=0,r=1,e=0,_=0,h=0,v=1;return this.e00=a,this.e01=t,this.e02=i,this.e10=o,this.e11=r,this.e12=e,this.e20=_,this.e21=h,this.e22=v,this}add(a){return new u.common.Mat3(this.e00+a.e00,this.e01+a.e01,this.e02+a.e02,this.e10+a.e10,this.e11+a.e11,this.e12+a.e12,this.e20+a.e20,this.e21+a.e21,this.e22+a.e22)}sub(a){return new u.common.Mat3(this.e00-a.e00,this.e01-a.e01,this.e02-a.e02,this.e10-a.e10,this.e11-a.e11,this.e12-a.e12,this.e20-a.e20,this.e21-a.e21,this.e22-a.e22)}scale(a){return new u.common.Mat3(this.e00*a,this.e01*a,this.e02*a,this.e10*a,this.e11*a,this.e12*a,this.e20*a,this.e21*a,this.e22*a)}mul(a){return new u.common.Mat3(this.e00*a.e00+this.e01*a.e10+this.e02*a.e20,this.e00*a.e01+this.e01*a.e11+this.e02*a.e21,this.e00*a.e02+this.e01*a.e12+this.e02*a.e22,this.e10*a.e00+this.e11*a.e10+this.e12*a.e20,this.e10*a.e01+this.e11*a.e11+this.e12*a.e21,this.e10*a.e02+this.e11*a.e12+this.e12*a.e22,this.e20*a.e00+this.e21*a.e10+this.e22*a.e20,this.e20*a.e01+this.e21*a.e11+this.e22*a.e21,this.e20*a.e02+this.e21*a.e12+this.e22*a.e22)}addEq(a){var t=this.e00+a.e00,i=this.e01+a.e01,o=this.e02+a.e02,r=this.e10+a.e10,e=this.e11+a.e11,_=this.e12+a.e12,h=this.e20+a.e20,v=this.e21+a.e21,s=this.e22+a.e22;return this.e00=t,this.e01=i,this.e02=o,this.e10=r,this.e11=e,this.e12=_,this.e20=h,this.e21=v,this.e22=s,this}subEq(a){var t=this.e00-a.e00,i=this.e01-a.e01,o=this.e02-a.e02,r=this.e10-a.e10,e=this.e11-a.e11,_=this.e12-a.e12,h=this.e20-a.e20,v=this.e21-a.e21,s=this.e22-a.e22;return this.e00=t,this.e01=i,this.e02=o,this.e10=r,this.e11=e,this.e12=_,this.e20=h,this.e21=v,this.e22=s,this}scaleEq(a){var t=this.e00*a,i=this.e01*a,o=this.e02*a,r=this.e10*a,e=this.e11*a,_=this.e12*a,h=this.e20*a,v=this.e21*a,s=this.e22*a;return this.e00=t,this.e01=i,this.e02=o,this.e10=r,this.e11=e,this.e12=_,this.e20=h,this.e21=v,this.e22=s,this}mulEq(a){var t=this.e00*a.e00+this.e01*a.e10+this.e02*a.e20,i=this.e00*a.e01+this.e01*a.e11+this.e02*a.e21,o=this.e00*a.e02+this.e01*a.e12+this.e02*a.e22,r=this.e10*a.e00+this.e11*a.e10+this.e12*a.e20,e=this.e10*a.e01+this.e11*a.e11+this.e12*a.e21,_=this.e10*a.e02+this.e11*a.e12+this.e12*a.e22,h=this.e20*a.e00+this.e21*a.e10+this.e22*a.e20,v=this.e20*a.e01+this.e21*a.e11+this.e22*a.e21,s=this.e20*a.e02+this.e21*a.e12+this.e22*a.e22;return this.e00=t,this.e01=i,this.e02=o,this.e10=r,this.e11=e,this.e12=_,this.e20=h,this.e21=v,this.e22=s,this}prependScale(a,t,i){return new u.common.Mat3(this.e00*a,this.e01*a,this.e02*a,this.e10*t,this.e11*t,this.e12*t,this.e20*i,this.e21*i,this.e22*i)}appendScale(a,t,i){return new u.common.Mat3(this.e00*a,this.e01*t,this.e02*i,this.e10*a,this.e11*t,this.e12*i,this.e20*a,this.e21*t,this.e22*i)}prependRotation(a,t,i,o){var r=Math.sin(a),e=Math.cos(a),_=1-e,h=t*t*_+e,v=t*i*_-o*r,s=t*o*_+i*r,l=i*t*_+o*r,x=i*i*_+e,b=i*o*_-t*r,f=o*t*_-i*r,n=o*i*_+t*r,c=o*o*_+e;return new u.common.Mat3(h*this.e00+v*this.e10+s*this.e20,h*this.e01+v*this.e11+s*this.e21,h*this.e02+v*this.e12+s*this.e22,l*this.e00+x*this.e10+b*this.e20,l*this.e01+x*this.e11+b*this.e21,l*this.e02+x*this.e12+b*this.e22,f*this.e00+n*this.e10+c*this.e20,f*this.e01+n*this.e11+c*this.e21,f*this.e02+n*this.e12+c*this.e22)}appendRotation(a,t,i,o){var r=Math.sin(a),e=Math.cos(a),_=1-e,h=t*t*_+e,v=t*i*_-o*r,s=t*o*_+i*r,l=i*t*_+o*r,x=i*i*_+e,b=i*o*_-t*r,f=o*t*_-i*r,n=o*i*_+t*r,c=o*o*_+e;return new u.common.Mat3(this.e00*h+this.e01*l+this.e02*f,this.e00*v+this.e01*x+this.e02*n,this.e00*s+this.e01*b+this.e02*c,this.e10*h+this.e11*l+this.e12*f,this.e10*v+this.e11*x+this.e12*n,this.e10*s+this.e11*b+this.e12*c,this.e20*h+this.e21*l+this.e22*f,this.e20*v+this.e21*x+this.e22*n,this.e20*s+this.e21*b+this.e22*c)}prependScaleEq(a,t,i){var o=this.e00*a,r=this.e01*a,e=this.e02*a,_=this.e10*t,h=this.e11*t,v=this.e12*t,s=this.e20*i,l=this.e21*i,x=this.e22*i;return this.e00=o,this.e01=r,this.e02=e,this.e10=_,this.e11=h,this.e12=v,this.e20=s,this.e21=l,this.e22=x,this}appendScaleEq(a,t,i){var o=this.e00*a,r=this.e01*t,e=this.e02*i,_=this.e10*a,h=this.e11*t,v=this.e12*i,s=this.e20*a,l=this.e21*t,x=this.e22*i;return this.e00=o,this.e01=r,this.e02=e,this.e10=_,this.e11=h,this.e12=v,this.e20=s,this.e21=l,this.e22=x,this}prependRotationEq(a,t,i,o){var r=Math.sin(a),e=Math.cos(a),_=1-e,h=t*t*_+e,v=t*i*_-o*r,s=t*o*_+i*r,l=i*t*_+o*r,x=i*i*_+e,b=i*o*_-t*r,f=o*t*_-i*r,n=o*i*_+t*r,c=o*o*_+e,z=h*this.e00+v*this.e10+s*this.e20,p=h*this.e01+v*this.e11+s*this.e21,y=h*this.e02+v*this.e12+s*this.e22,V=l*this.e00+x*this.e10+b*this.e20,M=l*this.e01+x*this.e11+b*this.e21,I=l*this.e02+x*this.e12+b*this.e22,k=f*this.e00+n*this.e10+c*this.e20,X=f*this.e01+n*this.e11+c*this.e21,L=f*this.e02+n*this.e12+c*this.e22;return this.e00=z,this.e01=p,this.e02=y,this.e10=V,this.e11=M,this.e12=I,this.e20=k,this.e21=X,this.e22=L,this}appendRotationEq(a,t,i,o){var r=Math.sin(a),e=Math.cos(a),_=1-e,h=t*t*_+e,v=t*i*_-o*r,s=t*o*_+i*r,l=i*t*_+o*r,x=i*i*_+e,b=i*o*_-t*r,f=o*t*_-i*r,n=o*i*_+t*r,c=o*o*_+e,z=this.e00*h+this.e01*l+this.e02*f,p=this.e00*v+this.e01*x+this.e02*n,y=this.e00*s+this.e01*b+this.e02*c,V=this.e10*h+this.e11*l+this.e12*f,M=this.e10*v+this.e11*x+this.e12*n,I=this.e10*s+this.e11*b+this.e12*c,k=this.e20*h+this.e21*l+this.e22*f,X=this.e20*v+this.e21*x+this.e22*n,L=this.e20*s+this.e21*b+this.e22*c;return this.e00=z,this.e01=p,this.e02=y,this.e10=V,this.e11=M,this.e12=I,this.e20=k,this.e21=X,this.e22=L,this}transpose(){return new u.common.Mat3(this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22)}transposeEq(){var a=this.e00,t=this.e10,i=this.e20,o=this.e01,r=this.e11,e=this.e21,_=this.e02,h=this.e12,v=this.e22;return this.e00=a,this.e01=t,this.e02=i,this.e10=o,this.e11=r,this.e12=e,this.e20=_,this.e21=h,this.e22=v,this}determinant(){return this.e00*(this.e11*this.e22-this.e12*this.e21)-this.e01*(this.e10*this.e22-this.e12*this.e20)+this.e02*(this.e10*this.e21-this.e11*this.e20)}trace(){return this.e00+this.e11+this.e22}inverse(){var a=this.e11*this.e22-this.e12*this.e21,t=this.e10*this.e22-this.e12*this.e20,i=this.e10*this.e21-this.e11*this.e20,o=this.e01*this.e22-this.e02*this.e21,r=this.e00*this.e22-this.e02*this.e20,e=this.e00*this.e21-this.e01*this.e20,_=this.e01*this.e12-this.e02*this.e11,h=this.e00*this.e12-this.e02*this.e10,v=this.e00*this.e11-this.e01*this.e10,s=this.e00*a-this.e01*t+this.e02*i;return s!=0&&(s=1/s),new u.common.Mat3(a*s,-o*s,_*s,-t*s,r*s,-h*s,i*s,-e*s,v*s)}inverseEq(){var a=this.e11*this.e22-this.e12*this.e21,t=this.e10*this.e22-this.e12*this.e20,i=this.e10*this.e21-this.e11*this.e20,o=this.e01*this.e22-this.e02*this.e21,r=this.e00*this.e22-this.e02*this.e20,e=this.e00*this.e21-this.e01*this.e20,_=this.e01*this.e12-this.e02*this.e11,h=this.e00*this.e12-this.e02*this.e10,v=this.e00*this.e11-this.e01*this.e10,s=this.e00*a-this.e01*t+this.e02*i;s!=0&&(s=1/s);var l=a*s,x=-o*s,b=_*s,f=-t*s,n=r*s,c=-h*s,z=i*s,p=-e*s,y=v*s;return this.e00=l,this.e01=x,this.e02=b,this.e10=f,this.e11=n,this.e12=c,this.e20=z,this.e21=p,this.e22=y,this}toArray(a){return a==null&&(a=!1),a?[this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22]:[this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22]}copyFrom(a){return this.e00=a.e00,this.e01=a.e01,this.e02=a.e02,this.e10=a.e10,this.e11=a.e11,this.e12=a.e12,this.e20=a.e20,this.e21=a.e21,this.e22=a.e22,this}clone(){return new u.common.Mat3(this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22)}fromQuat(a){var t=a.x,i=a.y,o=a.z,r=a.w,e=2*t,_=2*i,h=2*o,v=t*e,s=i*_,l=o*h,x=t*_,b=i*h,f=t*h,n=r*e,c=r*_,z=r*h;return this.e00=1-s-l,this.e01=x-z,this.e02=f+c,this.e10=x+z,this.e11=1-v-l,this.e12=b-n,this.e20=f-c,this.e21=b+n,this.e22=1-v-s,this}toQuat(){var a=new u.common.Quat,t=this.e00,i=this.e11,o=this.e22,r=t+i+o,e;return r>0?(e=Math.sqrt(r+1),a.w=.5*e,e=.5/e,a.x=(this.e21-this.e12)*e,a.y=(this.e02-this.e20)*e,a.z=(this.e10-this.e01)*e):t>i?t>o?(e=Math.sqrt(t-i-o+1),a.x=.5*e,e=.5/e,a.y=(this.e01+this.e10)*e,a.z=(this.e02+this.e20)*e,a.w=(this.e21-this.e12)*e):(e=Math.sqrt(o-t-i+1),a.z=.5*e,e=.5/e,a.x=(this.e02+this.e20)*e,a.y=(this.e12+this.e21)*e,a.w=(this.e10-this.e01)*e):i>o?(e=Math.sqrt(i-o-t+1),a.y=.5*e,e=.5/e,a.x=(this.e01+this.e10)*e,a.z=(this.e12+this.e21)*e,a.w=(this.e02-this.e20)*e):(e=Math.sqrt(o-t-i+1),a.z=.5*e,e=.5/e,a.x=(this.e02+this.e20)*e,a.y=(this.e12+this.e21)*e,a.w=(this.e10-this.e01)*e),a}fromEulerXyz(a){var t=Math.sin(a.x),i=Math.sin(a.y),o=Math.sin(a.z),r=Math.cos(a.x),e=Math.cos(a.y),_=Math.cos(a.z),h=e*_,v=-e*o,s=i,l=r*o+_*t*i,x=r*_-t*i*o,b=-e*t,f=t*o-r*_*i,n=_*t+r*i*o,c=r*e;return this.e00=h,this.e01=v,this.e02=s,this.e10=l,this.e11=x,this.e12=b,this.e20=f,this.e21=n,this.e22=c,this}toEulerXyz(){var a=this.e02;if(a<=-1){var t=Math.atan2(this.e21,this.e11);return new u.common.Vec3(t*.5,-1.570796326794895,-t*.5)}if(a>=1){var i=Math.atan2(this.e21,this.e11);return new u.common.Vec3(i*.5,1.570796326794895,i*.5)}var o=Math.asin(a),r=Math.atan2(-this.e12,this.e22),e=Math.atan2(-this.e01,this.e00);return new u.common.Vec3(r,o,e)}getRow(a){return a==0?new u.common.Vec3(this.e00,this.e01,this.e02):a==1?new u.common.Vec3(this.e10,this.e11,this.e12):a==2?new u.common.Vec3(this.e20,this.e21,this.e22):null}getCol(a){return a==0?new u.common.Vec3(this.e00,this.e10,this.e20):a==1?new u.common.Vec3(this.e01,this.e11,this.e21):a==2?new u.common.Vec3(this.e02,this.e12,this.e22):null}getRowTo(a,t){a==0?t.init(this.e00,this.e01,this.e02):a==1?t.init(this.e10,this.e11,this.e12):a==2?t.init(this.e20,this.e21,this.e22):t.zero()}getColTo(a,t){a==0?t.init(this.e00,this.e10,this.e20):a==1?t.init(this.e01,this.e11,this.e21):a==2?t.init(this.e02,this.e12,this.e22):t.zero()}fromRows(a,t,i){var o=a.x,r=a.y,e=a.z,_=t.x,h=t.y,v=t.z,s=i.x,l=i.y,x=i.z;return this.e00=o,this.e01=r,this.e02=e,this.e10=_,this.e11=h,this.e12=v,this.e20=s,this.e21=l,this.e22=x,this}fromCols(a,t,i){var o=a.x,r=t.x,e=i.x,_=a.y,h=t.y,v=i.y,s=a.z,l=t.z,x=i.z;return this.e00=o,this.e01=r,this.e02=e,this.e10=_,this.e11=h,this.e12=v,this.e20=s,this.e21=l,this.e22=x,this}toString(){return"Mat3["+(this.e00>0?(this.e00*1e7+.5|0)/1e7:(this.e00*1e7-.5|0)/1e7)+", "+(this.e01>0?(this.e01*1e7+.5|0)/1e7:(this.e01*1e7-.5|0)/1e7)+", "+(this.e02>0?(this.e02*1e7+.5|0)/1e7:(this.e02*1e7-.5|0)/1e7)+",\n     "+(this.e10>0?(this.e10*1e7+.5|0)/1e7:(this.e10*1e7-.5|0)/1e7)+", "+(this.e11>0?(this.e11*1e7+.5|0)/1e7:(this.e11*1e7-.5|0)/1e7)+", "+(this.e12>0?(this.e12*1e7+.5|0)/1e7:(this.e12*1e7-.5|0)/1e7)+",\n     "+(this.e20>0?(this.e20*1e7+.5|0)/1e7:(this.e20*1e7-.5|0)/1e7)+", "+(this.e21>0?(this.e21*1e7+.5|0)/1e7:(this.e21*1e7-.5|0)/1e7)+", "+(this.e22>0?(this.e22*1e7+.5|0)/1e7:(this.e22*1e7-.5|0)/1e7)+"]"}};u.common.Mat4=class{constructor(a,t,i,o,r,e,_,h,v,s,l,x,b,f,n,c){c==null&&(c=1),n==null&&(n=0),f==null&&(f=0),b==null&&(b=0),x==null&&(x=0),l==null&&(l=1),s==null&&(s=0),v==null&&(v=0),h==null&&(h=0),_==null&&(_=0),e==null&&(e=1),r==null&&(r=0),o==null&&(o=0),i==null&&(i=0),t==null&&(t=0),a==null&&(a=1),this.e00=a,this.e01=t,this.e02=i,this.e03=o,this.e10=r,this.e11=e,this.e12=_,this.e13=h,this.e20=v,this.e21=s,this.e22=l,this.e23=x,this.e30=b,this.e31=f,this.e32=n,this.e33=c,u.common.Mat4.numCreations++}init(a,t,i,o,r,e,_,h,v,s,l,x,b,f,n,c){return this.e00=a,this.e01=t,this.e02=i,this.e03=o,this.e10=r,this.e11=e,this.e12=_,this.e13=h,this.e20=v,this.e21=s,this.e22=l,this.e23=x,this.e30=b,this.e31=f,this.e32=n,this.e33=c,this}identity(){var a=1,t=0,i=0,o=0,r=0,e=1,_=0,h=0,v=0,s=0,l=1,x=0,b=0,f=0,n=0,c=1;return this.e00=a,this.e01=t,this.e02=i,this.e03=o,this.e10=r,this.e11=e,this.e12=_,this.e13=h,this.e20=v,this.e21=s,this.e22=l,this.e23=x,this.e30=b,this.e31=f,this.e32=n,this.e33=c,this}add(a){return new u.common.Mat4(this.e00+a.e00,this.e01+a.e01,this.e02+a.e02,this.e03+a.e03,this.e10+a.e10,this.e11+a.e11,this.e12+a.e12,this.e13+a.e13,this.e20+a.e20,this.e21+a.e21,this.e22+a.e22,this.e23+a.e23,this.e30+a.e30,this.e31+a.e31,this.e32+a.e32,this.e33+a.e33)}sub(a){return new u.common.Mat4(this.e00-a.e00,this.e01-a.e01,this.e02-a.e02,this.e03-a.e03,this.e10-a.e10,this.e11-a.e11,this.e12-a.e12,this.e13-a.e13,this.e20-a.e20,this.e21-a.e21,this.e22-a.e22,this.e23-a.e23,this.e30-a.e30,this.e31-a.e31,this.e32-a.e32,this.e33-a.e33)}scale(a){return new u.common.Mat4(this.e00*a,this.e01*a,this.e02*a,this.e03*a,this.e10*a,this.e11*a,this.e12*a,this.e13*a,this.e20*a,this.e21*a,this.e22*a,this.e23*a,this.e30*a,this.e31*a,this.e32*a,this.e33*a)}mul(a){return new u.common.Mat4(this.e00*a.e00+this.e01*a.e10+this.e02*a.e20+this.e03*a.e30,this.e00*a.e01+this.e01*a.e11+this.e02*a.e21+this.e03*a.e31,this.e00*a.e02+this.e01*a.e12+this.e02*a.e22+this.e03*a.e32,this.e00*a.e03+this.e01*a.e13+this.e02*a.e23+this.e03*a.e33,this.e10*a.e00+this.e11*a.e10+this.e12*a.e20+this.e13*a.e30,this.e10*a.e01+this.e11*a.e11+this.e12*a.e21+this.e13*a.e31,this.e10*a.e02+this.e11*a.e12+this.e12*a.e22+this.e13*a.e32,this.e10*a.e03+this.e11*a.e13+this.e12*a.e23+this.e13*a.e33,this.e20*a.e00+this.e21*a.e10+this.e22*a.e20+this.e23*a.e30,this.e20*a.e01+this.e21*a.e11+this.e22*a.e21+this.e23*a.e31,this.e20*a.e02+this.e21*a.e12+this.e22*a.e22+this.e23*a.e32,this.e20*a.e03+this.e21*a.e13+this.e22*a.e23+this.e23*a.e33,this.e30*a.e00+this.e31*a.e10+this.e32*a.e20+this.e33*a.e30,this.e30*a.e01+this.e31*a.e11+this.e32*a.e21+this.e33*a.e31,this.e30*a.e02+this.e31*a.e12+this.e32*a.e22+this.e33*a.e32,this.e30*a.e03+this.e31*a.e13+this.e32*a.e23+this.e33*a.e33)}addEq(a){var t=this.e00+a.e00,i=this.e01+a.e01,o=this.e02+a.e02,r=this.e03+a.e03,e=this.e10+a.e10,_=this.e11+a.e11,h=this.e12+a.e12,v=this.e13+a.e13,s=this.e20+a.e20,l=this.e21+a.e21,x=this.e22+a.e22,b=this.e23+a.e23,f=this.e30+a.e30,n=this.e31+a.e31,c=this.e32+a.e32,z=this.e33+a.e33;return this.e00=t,this.e01=i,this.e02=o,this.e03=r,this.e10=e,this.e11=_,this.e12=h,this.e13=v,this.e20=s,this.e21=l,this.e22=x,this.e23=b,this.e30=f,this.e31=n,this.e32=c,this.e33=z,this}subEq(a){var t=this.e00-a.e00,i=this.e01-a.e01,o=this.e02-a.e02,r=this.e03-a.e03,e=this.e10-a.e10,_=this.e11-a.e11,h=this.e12-a.e12,v=this.e13-a.e13,s=this.e20-a.e20,l=this.e21-a.e21,x=this.e22-a.e22,b=this.e23-a.e23,f=this.e30-a.e30,n=this.e31-a.e31,c=this.e32-a.e32,z=this.e33-a.e33;return this.e00=t,this.e01=i,this.e02=o,this.e03=r,this.e10=e,this.e11=_,this.e12=h,this.e13=v,this.e20=s,this.e21=l,this.e22=x,this.e23=b,this.e30=f,this.e31=n,this.e32=c,this.e33=z,this}scaleEq(a){var t=this.e00*a,i=this.e01*a,o=this.e02*a,r=this.e03*a,e=this.e10*a,_=this.e11*a,h=this.e12*a,v=this.e13*a,s=this.e20*a,l=this.e21*a,x=this.e22*a,b=this.e23*a,f=this.e30*a,n=this.e31*a,c=this.e32*a,z=this.e33*a;return this.e00=t,this.e01=i,this.e02=o,this.e03=r,this.e10=e,this.e11=_,this.e12=h,this.e13=v,this.e20=s,this.e21=l,this.e22=x,this.e23=b,this.e30=f,this.e31=n,this.e32=c,this.e33=z,this}mulEq(a){var t=this.e00*a.e00+this.e01*a.e10+this.e02*a.e20+this.e03*a.e30,i=this.e00*a.e01+this.e01*a.e11+this.e02*a.e21+this.e03*a.e31,o=this.e00*a.e02+this.e01*a.e12+this.e02*a.e22+this.e03*a.e32,r=this.e00*a.e03+this.e01*a.e13+this.e02*a.e23+this.e03*a.e33,e=this.e10*a.e00+this.e11*a.e10+this.e12*a.e20+this.e13*a.e30,_=this.e10*a.e01+this.e11*a.e11+this.e12*a.e21+this.e13*a.e31,h=this.e10*a.e02+this.e11*a.e12+this.e12*a.e22+this.e13*a.e32,v=this.e10*a.e03+this.e11*a.e13+this.e12*a.e23+this.e13*a.e33,s=this.e20*a.e00+this.e21*a.e10+this.e22*a.e20+this.e23*a.e30,l=this.e20*a.e01+this.e21*a.e11+this.e22*a.e21+this.e23*a.e31,x=this.e20*a.e02+this.e21*a.e12+this.e22*a.e22+this.e23*a.e32,b=this.e20*a.e03+this.e21*a.e13+this.e22*a.e23+this.e23*a.e33,f=this.e30*a.e00+this.e31*a.e10+this.e32*a.e20+this.e33*a.e30,n=this.e30*a.e01+this.e31*a.e11+this.e32*a.e21+this.e33*a.e31,c=this.e30*a.e02+this.e31*a.e12+this.e32*a.e22+this.e33*a.e32,z=this.e30*a.e03+this.e31*a.e13+this.e32*a.e23+this.e33*a.e33;return this.e00=t,this.e01=i,this.e02=o,this.e03=r,this.e10=e,this.e11=_,this.e12=h,this.e13=v,this.e20=s,this.e21=l,this.e22=x,this.e23=b,this.e30=f,this.e31=n,this.e32=c,this.e33=z,this}prependScale(a,t,i){return new u.common.Mat4(this.e00*a,this.e01*a,this.e02*a,this.e03*a,this.e10*t,this.e11*t,this.e12*t,this.e13*t,this.e20*i,this.e21*i,this.e22*i,this.e23*i,this.e30,this.e31,this.e32,this.e33)}appendScale(a,t,i){return new u.common.Mat4(this.e00*a,this.e01*t,this.e02*i,this.e03,this.e10*a,this.e11*t,this.e12*i,this.e13,this.e20*a,this.e21*t,this.e22*i,this.e23,this.e30*a,this.e31*t,this.e32*i,this.e33)}prependRotation(a,t,i,o){var r=Math.sin(a),e=Math.cos(a),_=1-e,h=t*t*_+e,v=t*i*_-o*r,s=t*o*_+i*r,l=i*t*_+o*r,x=i*i*_+e,b=i*o*_-t*r,f=o*t*_-i*r,n=o*i*_+t*r,c=o*o*_+e;return new u.common.Mat4(h*this.e00+v*this.e10+s*this.e20,h*this.e01+v*this.e11+s*this.e21,h*this.e02+v*this.e12+s*this.e22,h*this.e03+v*this.e13+s*this.e23,l*this.e00+x*this.e10+b*this.e20,l*this.e01+x*this.e11+b*this.e21,l*this.e02+x*this.e12+b*this.e22,l*this.e03+x*this.e13+b*this.e23,f*this.e00+n*this.e10+c*this.e20,f*this.e01+n*this.e11+c*this.e21,f*this.e02+n*this.e12+c*this.e22,f*this.e03+n*this.e13+c*this.e23,this.e30,this.e31,this.e32,this.e33)}appendRotation(a,t,i,o){var r=Math.sin(a),e=Math.cos(a),_=1-e,h=t*t*_+e,v=t*i*_-o*r,s=t*o*_+i*r,l=i*t*_+o*r,x=i*i*_+e,b=i*o*_-t*r,f=o*t*_-i*r,n=o*i*_+t*r,c=o*o*_+e;return new u.common.Mat4(this.e00*h+this.e01*l+this.e02*f,this.e00*v+this.e01*x+this.e02*n,this.e00*s+this.e01*b+this.e02*c,this.e03,this.e10*h+this.e11*l+this.e12*f,this.e10*v+this.e11*x+this.e12*n,this.e10*s+this.e11*b+this.e12*c,this.e13,this.e20*h+this.e21*l+this.e22*f,this.e20*v+this.e21*x+this.e22*n,this.e20*s+this.e21*b+this.e22*c,this.e23,this.e30*h+this.e31*l+this.e32*f,this.e30*v+this.e31*x+this.e32*n,this.e30*s+this.e31*b+this.e32*c,this.e33)}prependTranslation(a,t,i){return new u.common.Mat4(this.e00+a*this.e30,this.e01+a*this.e31,this.e02+a*this.e32,this.e03+a*this.e33,this.e10+t*this.e30,this.e11+t*this.e31,this.e12+t*this.e32,this.e13+t*this.e33,this.e20+i*this.e30,this.e21+i*this.e31,this.e22+i*this.e32,this.e23+i*this.e33,this.e30,this.e31,this.e32,this.e33)}appendTranslation(a,t,i){return new u.common.Mat4(this.e00,this.e01,this.e02,this.e00*a+this.e01*t+this.e02*i+this.e03,this.e10,this.e11,this.e12,this.e10*a+this.e11*t+this.e12*i+this.e13,this.e20,this.e21,this.e22,this.e20*a+this.e21*t+this.e22*i+this.e23,this.e30,this.e31,this.e32,this.e30*a+this.e31*t+this.e32*i+this.e33)}prependScaleEq(a,t,i){var o=this.e00*a,r=this.e01*a,e=this.e02*a,_=this.e03*a,h=this.e10*t,v=this.e11*t,s=this.e12*t,l=this.e13*t,x=this.e20*i,b=this.e21*i,f=this.e22*i,n=this.e23*i,c=this.e30,z=this.e31,p=this.e32,y=this.e33;return this.e00=o,this.e01=r,this.e02=e,this.e03=_,this.e10=h,this.e11=v,this.e12=s,this.e13=l,this.e20=x,this.e21=b,this.e22=f,this.e23=n,this.e30=c,this.e31=z,this.e32=p,this.e33=y,this}appendScaleEq(a,t,i){var o=this.e00*a,r=this.e01*t,e=this.e02*i,_=this.e03,h=this.e10*a,v=this.e11*t,s=this.e12*i,l=this.e13,x=this.e20*a,b=this.e21*t,f=this.e22*i,n=this.e23,c=this.e30*a,z=this.e31*t,p=this.e32*i,y=this.e33;return this.e00=o,this.e01=r,this.e02=e,this.e03=_,this.e10=h,this.e11=v,this.e12=s,this.e13=l,this.e20=x,this.e21=b,this.e22=f,this.e23=n,this.e30=c,this.e31=z,this.e32=p,this.e33=y,this}prependRotationEq(a,t,i,o){var r=Math.sin(a),e=Math.cos(a),_=1-e,h=t*t*_+e,v=t*i*_-o*r,s=t*o*_+i*r,l=i*t*_+o*r,x=i*i*_+e,b=i*o*_-t*r,f=o*t*_-i*r,n=o*i*_+t*r,c=o*o*_+e,z=h*this.e00+v*this.e10+s*this.e20,p=h*this.e01+v*this.e11+s*this.e21,y=h*this.e02+v*this.e12+s*this.e22,V=h*this.e03+v*this.e13+s*this.e23,M=l*this.e00+x*this.e10+b*this.e20,I=l*this.e01+x*this.e11+b*this.e21,k=l*this.e02+x*this.e12+b*this.e22,X=l*this.e03+x*this.e13+b*this.e23,L=f*this.e00+n*this.e10+c*this.e20,m=f*this.e01+n*this.e11+c*this.e21,g=f*this.e02+n*this.e12+c*this.e22,N=f*this.e03+n*this.e13+c*this.e23,d=this.e30,F=this.e31,S=this.e32,Y=this.e33;return this.e00=z,this.e01=p,this.e02=y,this.e03=V,this.e10=M,this.e11=I,this.e12=k,this.e13=X,this.e20=L,this.e21=m,this.e22=g,this.e23=N,this.e30=d,this.e31=F,this.e32=S,this.e33=Y,this}appendRotationEq(a,t,i,o){var r=Math.sin(a),e=Math.cos(a),_=1-e,h=t*t*_+e,v=t*i*_-o*r,s=t*o*_+i*r,l=i*t*_+o*r,x=i*i*_+e,b=i*o*_-t*r,f=o*t*_-i*r,n=o*i*_+t*r,c=o*o*_+e,z=this.e00*h+this.e01*l+this.e02*f,p=this.e00*v+this.e01*x+this.e02*n,y=this.e00*s+this.e01*b+this.e02*c,V=this.e03,M=this.e10*h+this.e11*l+this.e12*f,I=this.e10*v+this.e11*x+this.e12*n,k=this.e10*s+this.e11*b+this.e12*c,X=this.e13,L=this.e20*h+this.e21*l+this.e22*f,m=this.e20*v+this.e21*x+this.e22*n,g=this.e20*s+this.e21*b+this.e22*c,N=this.e23,d=this.e30*h+this.e31*l+this.e32*f,F=this.e30*v+this.e31*x+this.e32*n,S=this.e30*s+this.e31*b+this.e32*c,Y=this.e33;return this.e00=z,this.e01=p,this.e02=y,this.e03=V,this.e10=M,this.e11=I,this.e12=k,this.e13=X,this.e20=L,this.e21=m,this.e22=g,this.e23=N,this.e30=d,this.e31=F,this.e32=S,this.e33=Y,this}prependTranslationEq(a,t,i){var o=this.e00+a*this.e30,r=this.e01+a*this.e31,e=this.e02+a*this.e32,_=this.e03+a*this.e33,h=this.e10+t*this.e30,v=this.e11+t*this.e31,s=this.e12+t*this.e32,l=this.e13+t*this.e33,x=this.e20+i*this.e30,b=this.e21+i*this.e31,f=this.e22+i*this.e32,n=this.e23+i*this.e33,c=this.e30,z=this.e31,p=this.e32,y=this.e33;return this.e00=o,this.e01=r,this.e02=e,this.e03=_,this.e10=h,this.e11=v,this.e12=s,this.e13=l,this.e20=x,this.e21=b,this.e22=f,this.e23=n,this.e30=c,this.e31=z,this.e32=p,this.e33=y,this}appendTranslationEq(a,t,i){var o=this.e00,r=this.e01,e=this.e02,_=this.e00*a+this.e01*t+this.e02*i+this.e03,h=this.e10,v=this.e11,s=this.e12,l=this.e10*a+this.e11*t+this.e12*i+this.e13,x=this.e20,b=this.e21,f=this.e22,n=this.e20*a+this.e21*t+this.e22*i+this.e23,c=this.e30,z=this.e31,p=this.e32,y=this.e30*a+this.e31*t+this.e32*i+this.e33;return this.e00=o,this.e01=r,this.e02=e,this.e03=_,this.e10=h,this.e11=v,this.e12=s,this.e13=l,this.e20=x,this.e21=b,this.e22=f,this.e23=n,this.e30=c,this.e31=z,this.e32=p,this.e33=y,this}transpose(){return new u.common.Mat4(this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33)}transposeEq(){var a=this.e00,t=this.e10,i=this.e20,o=this.e30,r=this.e01,e=this.e11,_=this.e21,h=this.e31,v=this.e02,s=this.e12,l=this.e22,x=this.e32,b=this.e03,f=this.e13,n=this.e23,c=this.e33;return this.e00=a,this.e01=t,this.e02=i,this.e03=o,this.e10=r,this.e11=e,this.e12=_,this.e13=h,this.e20=v,this.e21=s,this.e22=l,this.e23=x,this.e30=b,this.e31=f,this.e32=n,this.e33=c,this}determinant(){var a=this.e20*this.e31-this.e21*this.e30,t=this.e20*this.e32-this.e22*this.e30,i=this.e20*this.e33-this.e23*this.e30,o=this.e21*this.e32-this.e22*this.e31,r=this.e21*this.e33-this.e23*this.e31,e=this.e22*this.e33-this.e23*this.e32;return this.e00*(this.e11*e-this.e12*r+this.e13*o)-this.e01*(this.e10*e-this.e12*i+this.e13*t)+this.e02*(this.e10*r-this.e11*i+this.e13*a)-this.e03*(this.e10*o-this.e11*t+this.e12*a)}trace(){return this.e00+this.e11+this.e22+this.e33}inverse(){var a=this.e00*this.e11-this.e01*this.e10,t=this.e00*this.e12-this.e02*this.e10,i=this.e00*this.e13-this.e03*this.e10,o=this.e01*this.e12-this.e02*this.e11,r=this.e01*this.e13-this.e03*this.e11,e=this.e02*this.e13-this.e03*this.e12,_=this.e20*this.e31-this.e21*this.e30,h=this.e20*this.e32-this.e22*this.e30,v=this.e20*this.e33-this.e23*this.e30,s=this.e21*this.e32-this.e22*this.e31,l=this.e21*this.e33-this.e23*this.e31,x=this.e22*this.e33-this.e23*this.e32,b=this.e11*x-this.e12*l+this.e13*s,f=this.e10*x-this.e12*v+this.e13*h,n=this.e10*l-this.e11*v+this.e13*_,c=this.e10*s-this.e11*h+this.e12*_,z=this.e01*x-this.e02*l+this.e03*s,p=this.e00*x-this.e02*v+this.e03*h,y=this.e00*l-this.e01*v+this.e03*_,V=this.e00*s-this.e01*h+this.e02*_,M=this.e31*e-this.e32*r+this.e33*o,I=this.e30*e-this.e32*i+this.e33*t,k=this.e30*r-this.e31*i+this.e33*a,X=this.e30*o-this.e31*t+this.e32*a,L=this.e21*e-this.e22*r+this.e23*o,m=this.e20*e-this.e22*i+this.e23*t,g=this.e20*r-this.e21*i+this.e23*a,N=this.e20*o-this.e21*t+this.e22*a,d=this.e00*b-this.e01*f+this.e02*n-this.e03*c;return d!=0&&(d=1/d),new u.common.Mat4(b*d,-z*d,M*d,-L*d,-f*d,p*d,-I*d,m*d,n*d,-y*d,k*d,-g*d,-c*d,V*d,-X*d,N*d)}inverseEq(){var a=this.e00*this.e11-this.e01*this.e10,t=this.e00*this.e12-this.e02*this.e10,i=this.e00*this.e13-this.e03*this.e10,o=this.e01*this.e12-this.e02*this.e11,r=this.e01*this.e13-this.e03*this.e11,e=this.e02*this.e13-this.e03*this.e12,_=this.e20*this.e31-this.e21*this.e30,h=this.e20*this.e32-this.e22*this.e30,v=this.e20*this.e33-this.e23*this.e30,s=this.e21*this.e32-this.e22*this.e31,l=this.e21*this.e33-this.e23*this.e31,x=this.e22*this.e33-this.e23*this.e32,b=this.e11*x-this.e12*l+this.e13*s,f=this.e10*x-this.e12*v+this.e13*h,n=this.e10*l-this.e11*v+this.e13*_,c=this.e10*s-this.e11*h+this.e12*_,z=this.e01*x-this.e02*l+this.e03*s,p=this.e00*x-this.e02*v+this.e03*h,y=this.e00*l-this.e01*v+this.e03*_,V=this.e00*s-this.e01*h+this.e02*_,M=this.e31*e-this.e32*r+this.e33*o,I=this.e30*e-this.e32*i+this.e33*t,k=this.e30*r-this.e31*i+this.e33*a,X=this.e30*o-this.e31*t+this.e32*a,L=this.e21*e-this.e22*r+this.e23*o,m=this.e20*e-this.e22*i+this.e23*t,g=this.e20*r-this.e21*i+this.e23*a,N=this.e20*o-this.e21*t+this.e22*a,d=this.e00*b-this.e01*f+this.e02*n-this.e03*c;d!=0&&(d=1/d);var F=b*d,S=-z*d,Y=M*d,Q=-L*d,C=-f*d,B=p*d,Z=-I*d,$=m*d,K=n*d,E=-y*d,J=k*d,A=-g*d,R=-c*d,U=V*d,G=-X*d,D=N*d;return this.e00=F,this.e01=S,this.e02=Y,this.e03=Q,this.e10=C,this.e11=B,this.e12=Z,this.e13=$,this.e20=K,this.e21=E,this.e22=J,this.e23=A,this.e30=R,this.e31=U,this.e32=G,this.e33=D,this}lookAt(a,t,i,o,r,e,_,h,v){var s=a-o,l=t-r,x=i-e,b=1/Math.sqrt(s*s+l*l+x*x);s*=b,l*=b,x*=b;var f=h*x-v*l,n=v*s-_*x,c=_*l-h*s;b=1/Math.sqrt(f*f+n*n+c*c),f*=b,n*=b,c*=b;var z=l*c-x*n,p=x*f-s*c,y=s*n-l*f;return this.e00=f,this.e01=n,this.e02=c,this.e03=-(f*a+n*t+c*i),this.e10=z,this.e11=p,this.e12=y,this.e13=-(z*a+p*t+y*i),this.e20=s,this.e21=l,this.e22=x,this.e23=-(s*a+l*t+x*i),this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}perspective(a,t,i,o){var r=1/Math.tan(a*.5),e=o/(i-o);return this.e00=r/t,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=r,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=e,this.e23=i*e,this.e30=0,this.e31=0,this.e32=-1,this.e33=0,this}ortho(a,t,i,o){var r=1/(i-o);return this.e00=2/a,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=2/t,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=r,this.e23=i*r,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}toArray(a){return a==null&&(a=!1),a?[this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33]:[this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33]}copyFrom(a){return this.e00=a.e00,this.e01=a.e01,this.e02=a.e02,this.e03=a.e03,this.e10=a.e10,this.e11=a.e11,this.e12=a.e12,this.e13=a.e13,this.e20=a.e20,this.e21=a.e21,this.e22=a.e22,this.e23=a.e23,this.e30=a.e30,this.e31=a.e31,this.e32=a.e32,this.e33=a.e33,this}fromMat3(a){var t=a.e00,i=a.e01,o=a.e02,r=0,e=a.e10,_=a.e11,h=a.e12,v=0,s=a.e20,l=a.e21,x=a.e22,b=0,f=0,n=0,c=0,z=1;return this.e00=t,this.e01=i,this.e02=o,this.e03=r,this.e10=e,this.e11=_,this.e12=h,this.e13=v,this.e20=s,this.e21=l,this.e22=x,this.e23=b,this.e30=f,this.e31=n,this.e32=c,this.e33=z,this}fromTransform(a){var t=this;return t.e00=a._rotation00,t.e01=a._rotation01,t.e02=a._rotation02,t.e10=a._rotation10,t.e11=a._rotation11,t.e12=a._rotation12,t.e20=a._rotation20,t.e21=a._rotation21,t.e22=a._rotation22,t.e03=a._positionX,t.e13=a._positionY,t.e23=a._positionZ,t.e30=0,t.e31=0,t.e32=0,t.e33=1,this}clone(){return new u.common.Mat4(this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33)}toString(){return"Mat4["+(this.e00>0?(this.e00*1e7+.5|0)/1e7:(this.e00*1e7-.5|0)/1e7)+", "+(this.e01>0?(this.e01*1e7+.5|0)/1e7:(this.e01*1e7-.5|0)/1e7)+", "+(this.e02>0?(this.e02*1e7+.5|0)/1e7:(this.e02*1e7-.5|0)/1e7)+", "+(this.e03>0?(this.e03*1e7+.5|0)/1e7:(this.e03*1e7-.5|0)/1e7)+",\n    "+(this.e10>0?(this.e10*1e7+.5|0)/1e7:(this.e10*1e7-.5|0)/1e7)+", "+(this.e11>0?(this.e11*1e7+.5|0)/1e7:(this.e11*1e7-.5|0)/1e7)+", "+(this.e12>0?(this.e12*1e7+.5|0)/1e7:(this.e12*1e7-.5|0)/1e7)+", "+(this.e13>0?(this.e13*1e7+.5|0)/1e7:(this.e13*1e7-.5|0)/1e7)+",\n    "+(this.e20>0?(this.e20*1e7+.5|0)/1e7:(this.e20*1e7-.5|0)/1e7)+", "+(this.e21>0?(this.e21*1e7+.5|0)/1e7:(this.e21*1e7-.5|0)/1e7)+", "+(this.e22>0?(this.e22*1e7+.5|0)/1e7:(this.e22*1e7-.5|0)/1e7)+", "+(this.e23>0?(this.e23*1e7+.5|0)/1e7:(this.e23*1e7-.5|0)/1e7)+",\n    "+(this.e30>0?(this.e30*1e7+.5|0)/1e7:(this.e30*1e7-.5|0)/1e7)+", "+(this.e31>0?(this.e31*1e7+.5|0)/1e7:(this.e31*1e7-.5|0)/1e7)+", "+(this.e32>0?(this.e32*1e7+.5|0)/1e7:(this.e32*1e7-.5|0)/1e7)+", "+(this.e33>0?(this.e33*1e7+.5|0)/1e7:(this.e33*1e7-.5|0)/1e7)+"]"}};u.common.MathUtil=class{static abs(a){return a>0?a:-a}static sin(a){return Math.sin(a)}static cos(a){return Math.cos(a)}static tan(a){return Math.tan(a)}static asin(a){return Math.asin(a)}static acos(a){return Math.acos(a)}static atan(a){return Math.atan(a)}static safeAsin(a){return a<=-1?-1.570796326794895:a>=1?1.570796326794895:Math.asin(a)}static safeAcos(a){return a<=-1?3.14159265358979:a>=1?0:Math.acos(a)}static atan2(a,t){return Math.atan2(a,t)}static sqrt(a){return Math.sqrt(a)}static clamp(a,t,i){return a<t?t:a>i?i:a}static rand(){return Math.random()}static randIn(a,t){return a+Math.random()*(t-a)}static randVec3In(a,t){return new u.common.Vec3(a+Math.random()*(t-a),a+Math.random()*(t-a),a+Math.random()*(t-a))}static randVec3(){return new u.common.Vec3(-1+Math.random()*2,-1+Math.random()*2,-1+Math.random()*2)}};u.common.Pool=class{constructor(){var a=new Array(256);this.stackVec3=a,this.sizeVec3=0;var t=new Array(256);this.stackMat3=t,this.sizeMat3=0;var i=new Array(256);this.stackMat4=i,this.sizeMat4=0;var o=new Array(256);this.stackQuat=o,this.sizeQuat=0}vec3(){return this.sizeVec3==0?new u.common.Vec3:this.stackVec3[--this.sizeVec3]}mat3(){return this.sizeMat3==0?new u.common.Mat3:this.stackMat3[--this.sizeMat3]}mat4(){return this.sizeMat4==0?new u.common.Mat4:this.stackMat4[--this.sizeMat4]}quat(){return this.sizeQuat==0?new u.common.Quat:this.stackQuat[--this.sizeQuat]}dispose(a,t,i,o){if(a!=null){if(a.zero(),this.sizeVec3==this.stackVec3.length){for(var r=this.sizeVec3<<1,e=new Array(r),_=e,h=0,v=this.sizeVec3;h<v;){var s=h++;_[s]=this.stackVec3[s],this.stackVec3[s]=null}this.stackVec3=_}this.stackVec3[this.sizeVec3++]=a}if(t!=null){var l=1,x=0,b=0,f=0,n=1,c=0,z=0,p=0,y=1;if(t.e00=l,t.e01=x,t.e02=b,t.e10=f,t.e11=n,t.e12=c,t.e20=z,t.e21=p,t.e22=y,this.sizeMat3==this.stackMat3.length){for(var V=this.sizeMat3<<1,M=new Array(V),I=M,k=0,X=this.sizeMat3;k<X;){var L=k++;I[L]=this.stackMat3[L],this.stackMat3[L]=null}this.stackMat3=I}this.stackMat3[this.sizeMat3++]=t}if(i!=null){var m=1,g=0,N=0,d=0,F=0,S=1,Y=0,Q=0,C=0,B=0,Z=1,$=0,K=0,E=0,J=0,A=1;if(i.e00=m,i.e01=g,i.e02=N,i.e03=d,i.e10=F,i.e11=S,i.e12=Y,i.e13=Q,i.e20=C,i.e21=B,i.e22=Z,i.e23=$,i.e30=K,i.e31=E,i.e32=J,i.e33=A,this.sizeMat4==this.stackMat4.length){for(var R=this.sizeMat4<<1,U=new Array(R),G=U,D=0,H=this.sizeMat4;D<H;){var j=D++;G[j]=this.stackMat4[j],this.stackMat4[j]=null}this.stackMat4=G}this.stackMat4[this.sizeMat4++]=i}if(o!=null){var ia=0,ea=0,W=0,q=1;if(o.x=ia,o.y=ea,o.z=W,o.w=q,this.sizeQuat==this.stackQuat.length){for(var na=this.sizeQuat<<1,oa=new Array(na),aa=oa,T=0,ca=this.sizeQuat;T<ca;){var _a=T++;aa[_a]=this.stackQuat[_a],this.stackQuat[_a]=null}this.stackQuat=aa}this.stackQuat[this.sizeQuat++]=o}}disposeVec3(a){if(a.zero(),this.sizeVec3==this.stackVec3.length){for(var t=this.sizeVec3<<1,i=new Array(t),o=i,r=0,e=this.sizeVec3;r<e;){var _=r++;o[_]=this.stackVec3[_],this.stackVec3[_]=null}this.stackVec3=o}this.stackVec3[this.sizeVec3++]=a}disposeMat3(a){var t=1,i=0,o=0,r=0,e=1,_=0,h=0,v=0,s=1;if(a.e00=t,a.e01=i,a.e02=o,a.e10=r,a.e11=e,a.e12=_,a.e20=h,a.e21=v,a.e22=s,this.sizeMat3==this.stackMat3.length){for(var l=this.sizeMat3<<1,x=new Array(l),b=x,f=0,n=this.sizeMat3;f<n;){var c=f++;b[c]=this.stackMat3[c],this.stackMat3[c]=null}this.stackMat3=b}this.stackMat3[this.sizeMat3++]=a}disposeMat4(a){var t=1,i=0,o=0,r=0,e=0,_=1,h=0,v=0,s=0,l=0,x=1,b=0,f=0,n=0,c=0,z=1;if(a.e00=t,a.e01=i,a.e02=o,a.e03=r,a.e10=e,a.e11=_,a.e12=h,a.e13=v,a.e20=s,a.e21=l,a.e22=x,a.e23=b,a.e30=f,a.e31=n,a.e32=c,a.e33=z,this.sizeMat4==this.stackMat4.length){for(var p=this.sizeMat4<<1,y=new Array(p),V=y,M=0,I=this.sizeMat4;M<I;){var k=M++;V[k]=this.stackMat4[k],this.stackMat4[k]=null}this.stackMat4=V}this.stackMat4[this.sizeMat4++]=a}disposeQuat(a){var t=0,i=0,o=0,r=1;if(a.x=t,a.y=i,a.z=o,a.w=r,this.sizeQuat==this.stackQuat.length){for(var e=this.sizeQuat<<1,_=new Array(e),h=_,v=0,s=this.sizeQuat;v<s;){var l=v++;h[l]=this.stackQuat[l],this.stackQuat[l]=null}this.stackQuat=h}this.stackQuat[this.sizeQuat++]=a}};u.common.Quat=class{constructor(a,t,i,o){o==null&&(o=1),i==null&&(i=0),t==null&&(t=0),a==null&&(a=0),this.x=a,this.y=t,this.z=i,this.w=o,u.common.Quat.numCreations++}identity(){var a=0,t=0,i=0,o=1;return this.x=a,this.y=t,this.z=i,this.w=o,this}init(a,t,i,o){return this.x=a,this.y=t,this.z=i,this.w=o,this}add(a){return new u.common.Quat(this.x+a.x,this.y+a.y,this.z+a.z,this.w+a.w)}sub(a){return new u.common.Quat(this.x-a.x,this.y-a.y,this.z-a.z,this.w-a.w)}scale(a){return new u.common.Quat(this.x*a,this.y*a,this.z*a,this.w*a)}addEq(a){var t=this.x+a.x,i=this.y+a.y,o=this.z+a.z,r=this.w+a.w;return this.x=t,this.y=i,this.z=o,this.w=r,this}subEq(a){var t=this.x-a.x,i=this.y-a.y,o=this.z-a.z,r=this.w-a.w;return this.x=t,this.y=i,this.z=o,this.w=r,this}scaleEq(a){var t=this.x*a,i=this.y*a,o=this.z*a,r=this.w*a;return this.x=t,this.y=i,this.z=o,this.w=r,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w}normalized(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return a>0&&(a=1/a),new u.common.Quat(this.x*a,this.y*a,this.z*a,this.w*a)}normalize(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);a>0&&(a=1/a);var t=this.x*a,i=this.y*a,o=this.z*a,r=this.w*a;return this.x=t,this.y=i,this.z=o,this.w=r,this}setArc(a,t){var i=a.x,o=a.y,r=a.z,e=t.x,_=t.y,h=t.z,v=i*e+o*_+r*h;if(this.w=Math.sqrt((1+v)*.5),this.w==0)return e=i*i,_=o*o,h=r*r,e<_?e<h?(v=1/Math.sqrt(_+h),this.x=0,this.y=r*v,this.z=-o*v):(v=1/Math.sqrt(e+_),this.z=0,this.x=o*v,this.y=-i*v):_<h?(v=1/Math.sqrt(h+e),this.y=0,this.z=i*v,this.x=-r*v):(v=1/Math.sqrt(e+_),this.z=0,this.x=o*v,this.y=-i*v),this;v=.5/this.w;var s=o*h-r*_,l=r*e-i*h,x=i*_-o*e;return this.x=s*v,this.y=l*v,this.z=x*v,this}slerp(a,t){var i,o,r,e,_=this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w;if(_<0?(_=-_,i=-a.x,o=-a.y,r=-a.z,e=-a.w):(i=a.x,o=a.y,r=a.z,e=a.w),_>.999999){var h=new u.common.Quat(this.x+(i-this.x)*t,this.y+(o-this.y)*t,this.z+(r-this.z)*t,this.w+(e-this.w)*t),v=Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z+h.w*h.w);v>0&&(v=1/v);var s=h.x*v,l=h.y*v,x=h.z*v,b=h.w*v;return h.x=s,h.y=l,h.z=x,h.w=b,h}var f=t*Math.acos(_);i-=this.x*_,o-=this.y*_,r-=this.z*_,e-=this.w*_;var n=1/Math.sqrt(i*i+o*o+r*r+e*e);i*=n,o*=n,r*=n,e*=n;var c=Math.sin(f),z=Math.cos(f);return new u.common.Quat(this.x*z+i*c,this.y*z+o*c,this.z*z+r*c,this.w*z+e*c)}copyFrom(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w,this}clone(){return new u.common.Quat(this.x,this.y,this.z,this.w)}fromMat3(a){var t=a.e00,i=a.e11,o=a.e22,r=t+i+o,e;return r>0?(e=Math.sqrt(r+1),this.w=.5*e,e=.5/e,this.x=(a.e21-a.e12)*e,this.y=(a.e02-a.e20)*e,this.z=(a.e10-a.e01)*e):t>i?t>o?(e=Math.sqrt(t-i-o+1),this.x=.5*e,e=.5/e,this.y=(a.e01+a.e10)*e,this.z=(a.e02+a.e20)*e,this.w=(a.e21-a.e12)*e):(e=Math.sqrt(o-t-i+1),this.z=.5*e,e=.5/e,this.x=(a.e02+a.e20)*e,this.y=(a.e12+a.e21)*e,this.w=(a.e10-a.e01)*e):i>o?(e=Math.sqrt(i-o-t+1),this.y=.5*e,e=.5/e,this.x=(a.e01+a.e10)*e,this.z=(a.e12+a.e21)*e,this.w=(a.e02-a.e20)*e):(e=Math.sqrt(o-t-i+1),this.z=.5*e,e=.5/e,this.x=(a.e02+a.e20)*e,this.y=(a.e12+a.e21)*e,this.w=(a.e10-a.e01)*e),this}toMat3(){var a=new u.common.Mat3,t=this.x,i=this.y,o=this.z,r=this.w,e=2*t,_=2*i,h=2*o,v=t*e,s=i*_,l=o*h,x=t*_,b=i*h,f=t*h,n=r*e,c=r*_,z=r*h;return a.e00=1-s-l,a.e01=x-z,a.e02=f+c,a.e10=x+z,a.e11=1-v-l,a.e12=b-n,a.e20=f-c,a.e21=b+n,a.e22=1-v-s,a}toString(){return"Quat["+(this.x>0?(this.x*1e7+.5|0)/1e7:(this.x*1e7-.5|0)/1e7)+" i,\n    "+(this.y>0?(this.y*1e7+.5|0)/1e7:(this.y*1e7-.5|0)/1e7)+" j,\n    "+(this.z>0?(this.z*1e7+.5|0)/1e7:(this.z*1e7-.5|0)/1e7)+" k,\n    "+(this.w>0?(this.w*1e7+.5|0)/1e7:(this.w*1e7-.5|0)/1e7)+"]"}};u.dynamics||(u.dynamics={});u.dynamics.Contact=class{constructor(){this._next=null,this._prev=null,this._link1=new u.dynamics.ContactLink,this._link2=new u.dynamics.ContactLink,this._s1=null,this._s2=null,this._b1=null,this._b2=null,this._detector=null,this._cachedDetectorData=new u.collision.narrowphase.detector.CachedDetectorData,this._detectorResult=new u.collision.narrowphase.DetectorResult,this._latest=!1,this._shouldBeSkipped=!1,this._manifold=new u.dynamics.constraint.contact.Manifold,this._updater=new u.dynamics.constraint.contact.ManifoldUpdater(this._manifold),this._contactConstraint=new u.dynamics.constraint.contact.ContactConstraint(this._manifold),this._touching=!1}_updateManifold(){if(this._detector!=null){var a=this._touching,t=this._detectorResult;this._detector.detect(t,this._s1._geom,this._s2._geom,this._s1._transform,this._s2._transform,this._cachedDetectorData);var i=t.numPoints;if(this._touching=i>0,this._touching?(this._manifold._buildBasis(t.normal),t.getMaxDepth()>u.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold?this._contactConstraint._positionCorrectionAlgorithm=u.common.Setting.alternativeContactPositionCorrectionAlgorithm:this._contactConstraint._positionCorrectionAlgorithm=u.common.Setting.defaultContactPositionCorrectionAlgorithm,t.incremental?this._updater.incrementalUpdate(t,this._b1._transform,this._b2._transform):this._updater.totalUpdate(t,this._b1._transform,this._b2._transform)):this._manifold._clear(),this._touching&&!a){var o=this._s1._contactCallback,r=this._s2._contactCallback;o==r&&(r=null),o!=null&&o.beginContact(this),r!=null&&r.beginContact(this)}if(!this._touching&&a){var e=this._s1._contactCallback,_=this._s2._contactCallback;e==_&&(_=null),e!=null&&e.endContact(this),_!=null&&_.endContact(this)}if(this._touching){var h=this._s1._contactCallback,v=this._s2._contactCallback;h==v&&(v=null),h!=null&&h.preSolve(this),v!=null&&v.preSolve(this)}}}_postSolve(){var a=this._s1._contactCallback,t=this._s2._contactCallback;a==t&&(t=null),a!=null&&a.postSolve(this),t!=null&&t.postSolve(this)}getShape1(){return this._s1}getShape2(){return this._s2}isTouching(){return this._touching}getManifold(){return this._manifold}getContactConstraint(){return this._contactConstraint}getPrev(){return this._prev}getNext(){return this._next}};u.dynamics.ContactLink=class{constructor(){this._prev=null,this._next=null,this._contact=null,this._other=null}getContact(){return this._contact}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}};u.dynamics.ContactManager=class{constructor(a){this._broadPhase=a,this._collisionMatrix=new u.collision.narrowphase.CollisionMatrix,this._numContacts=0}createContacts(){for(var a=this._broadPhase._proxyPairList;a!=null;){for(var t=a._next;;){var i,o;if(a._p1._id<a._p2._id?(i=a._p1.userData,o=a._p2.userData):(i=a._p2.userData,o=a._p1.userData),!this.shouldCollide(i,o))break;var r=i._rigidBody,e=o._rigidBody,_=r._numContactLinks,h=e._numContactLinks,v;_<h?v=r._contactLinkList:v=e._contactLinkList;for(var s=i._id,l=o._id,x=!1;v!=null;){var b=v._next,f=v._contact;if(f._s1._id==s&&f._s2._id==l){f._latest=!0,x=!0;break}v=b}if(!x){var n=this._contactPool;n!=null?(this._contactPool=n._next,n._next=null):n=new u.dynamics.Contact;var c=n;this._contactList==null?(this._contactList=c,this._contactListLast=c):(this._contactListLast._next=c,c._prev=this._contactListLast,this._contactListLast=c),c._latest=!0;var z=this._collisionMatrix.detectors[i._geom._type][o._geom._type];c._s1=i,c._s2=o,c._b1=i._rigidBody,c._b2=o._rigidBody,c._touching=!1,c._b1._contactLinkList==null?(c._b1._contactLinkList=c._link1,c._b1._contactLinkListLast=c._link1):(c._b1._contactLinkListLast._next=c._link1,c._link1._prev=c._b1._contactLinkListLast,c._b1._contactLinkListLast=c._link1),c._b2._contactLinkList==null?(c._b2._contactLinkList=c._link2,c._b2._contactLinkListLast=c._link2):(c._b2._contactLinkListLast._next=c._link2,c._link2._prev=c._b2._contactLinkListLast,c._b2._contactLinkListLast=c._link2),c._b1._numContactLinks++,c._b2._numContactLinks++,c._link1._other=c._b2,c._link2._other=c._b1,c._link1._contact=c,c._link2._contact=c,c._detector=z;var p=c._contactConstraint;p._s1=i,p._s2=o,p._b1=p._s1._rigidBody,p._b2=p._s2._rigidBody,p._tf1=p._b1._transform,p._tf2=p._b2._transform,this._numContacts++}break}a=t}}destroyOutdatedContacts(){for(var a=this._broadPhase._incremental,t=this._contactList;t!=null;){for(var i=t._next;;){if(t._latest){t._latest=!1,t._shouldBeSkipped=!1;break}if(!a){var o=t._prev,r=t._next;if(o!=null&&(o._next=r),r!=null&&(r._prev=o),t==this._contactList&&(this._contactList=this._contactList._next),t==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),t._next=null,t._prev=null,t._touching){var e=t._s1._contactCallback,_=t._s2._contactCallback;e==_&&(_=null),e!=null&&e.endContact(t),_!=null&&_.endContact(t)}var h=t._link1._prev,v=t._link1._next;h!=null&&(h._next=v),v!=null&&(v._prev=h),t._link1==t._b1._contactLinkList&&(t._b1._contactLinkList=t._b1._contactLinkList._next),t._link1==t._b1._contactLinkListLast&&(t._b1._contactLinkListLast=t._b1._contactLinkListLast._prev),t._link1._next=null,t._link1._prev=null;var s=t._link2._prev,l=t._link2._next;s!=null&&(s._next=l),l!=null&&(l._prev=s),t._link2==t._b2._contactLinkList&&(t._b2._contactLinkList=t._b2._contactLinkList._next),t._link2==t._b2._contactLinkListLast&&(t._b2._contactLinkListLast=t._b2._contactLinkListLast._prev),t._link2._next=null,t._link2._prev=null,t._b1._numContactLinks--,t._b2._numContactLinks--,t._link1._other=null,t._link2._other=null,t._link1._contact=null,t._link2._contact=null,t._s1=null,t._s2=null,t._b1=null,t._b2=null,t._touching=!1,t._cachedDetectorData._clear(),t._manifold._clear(),t._detector=null;var x=t._contactConstraint;x._s1=null,x._s2=null,x._b1=null,x._b2=null,x._tf1=null,x._tf2=null,t._next=this._contactPool,this._contactPool=t,this._numContacts--;break}var b=t._s1,f=t._s2,n=b._rigidBody,c=f._rigidBody,z=!n._sleeping&&n._type!=1,p=!c._sleeping&&c._type!=1;if(!z&&!p){t._shouldBeSkipped=!0;break}var y=b._aabb,V=f._aabb,M=b._proxy,I=f._proxy;if(!(M._aabbMinX<I._aabbMaxX&&M._aabbMaxX>I._aabbMinX&&M._aabbMinY<I._aabbMaxY&&M._aabbMaxY>I._aabbMinY&&M._aabbMinZ<I._aabbMaxZ&&M._aabbMaxZ>I._aabbMinZ)||!this.shouldCollide(b,f)){var k=t._prev,X=t._next;if(k!=null&&(k._next=X),X!=null&&(X._prev=k),t==this._contactList&&(this._contactList=this._contactList._next),t==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),t._next=null,t._prev=null,t._touching){var L=t._s1._contactCallback,m=t._s2._contactCallback;L==m&&(m=null),L!=null&&L.endContact(t),m!=null&&m.endContact(t)}var g=t._link1._prev,N=t._link1._next;g!=null&&(g._next=N),N!=null&&(N._prev=g),t._link1==t._b1._contactLinkList&&(t._b1._contactLinkList=t._b1._contactLinkList._next),t._link1==t._b1._contactLinkListLast&&(t._b1._contactLinkListLast=t._b1._contactLinkListLast._prev),t._link1._next=null,t._link1._prev=null;var d=t._link2._prev,F=t._link2._next;d!=null&&(d._next=F),F!=null&&(F._prev=d),t._link2==t._b2._contactLinkList&&(t._b2._contactLinkList=t._b2._contactLinkList._next),t._link2==t._b2._contactLinkListLast&&(t._b2._contactLinkListLast=t._b2._contactLinkListLast._prev),t._link2._next=null,t._link2._prev=null,t._b1._numContactLinks--,t._b2._numContactLinks--,t._link1._other=null,t._link2._other=null,t._link1._contact=null,t._link2._contact=null,t._s1=null,t._s2=null,t._b1=null,t._b2=null,t._touching=!1,t._cachedDetectorData._clear(),t._manifold._clear(),t._detector=null;var S=t._contactConstraint;S._s1=null,S._s2=null,S._b1=null,S._b2=null,S._tf1=null,S._tf2=null,t._next=this._contactPool,this._contactPool=t,this._numContacts--;break}var Y=y._minX<V._maxX&&y._maxX>V._minX&&y._minY<V._maxY&&y._maxY>V._minY&&y._minZ<V._maxZ&&y._maxZ>V._minZ;t._shouldBeSkipped=!Y;break}t=i}}shouldCollide(a,t){var i=a._rigidBody,o=t._rigidBody;if(i==o||i._type!=0&&o._type!=0||!(a._collisionGroup&t._collisionMask)||!(t._collisionGroup&a._collisionMask))return!1;var r,e;for(i._numJointLinks<o._numJointLinks?(r=i._jointLinkList,e=o):(r=o._jointLinkList,e=i);r!=null;){var _=r._next;if(r._other==e&&!r._joint._allowCollision)return!1;r=_}return!0}_updateContacts(){this._broadPhase.collectPairs(),this.createContacts(),this.destroyOutdatedContacts()}_postSolve(){for(var a=this._contactList;a!=null;){var t=a._next;a._touching&&a._postSolve(),a=t}}getNumContacts(){return this._numContacts}getContactList(){return this._contactList}};u.dynamics.Island=class{constructor(){var a=new Array(u.common.Setting.islandInitialRigidBodyArraySize);this.rigidBodies=a;var t=new Array(u.common.Setting.islandInitialConstraintArraySize);this.solvers=t;var i=new Array(u.common.Setting.islandInitialConstraintArraySize);this.solversSi=i;var o=new Array(u.common.Setting.islandInitialConstraintArraySize);this.solversNgs=o,this.numRigidBodies=0,this.numSolvers=0,this.numSolversSi=0,this.numSolversNgs=0}_clear(){for(;this.numRigidBodies>0;)this.rigidBodies[--this.numRigidBodies]=null;for(;this.numSolvers>0;)this.solvers[--this.numSolvers]=null;for(;this.numSolversSi>0;)this.solversSi[--this.numSolversSi]=null;for(;this.numSolversNgs>0;)this.solversNgs[--this.numSolversNgs]=null}_addRigidBody(a){if(this.numRigidBodies==this.rigidBodies.length){for(var t=this.numRigidBodies<<1,i=new Array(t),o=i,r=0,e=this.numRigidBodies;r<e;){var _=r++;o[_]=this.rigidBodies[_],this.rigidBodies[_]=null}this.rigidBodies=o}a._addedToIsland=!0,this.rigidBodies[this.numRigidBodies++]=a}_addConstraintSolver(a,t){if(this.numSolvers==this.solvers.length){for(var i=this.numSolvers<<1,o=new Array(i),r=o,e=0,_=this.numSolvers;e<_;){var h=e++;r[h]=this.solvers[h],this.solvers[h]=null}this.solvers=r}if(a._addedToIsland=!0,this.solvers[this.numSolvers++]=a,t==u.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE){if(this.numSolversSi==this.solversSi.length){for(var v=this.numSolversSi<<1,s=new Array(v),l=s,x=0,b=this.numSolversSi;x<b;){var f=x++;l[f]=this.solversSi[f],this.solversSi[f]=null}this.solversSi=l}this.solversSi[this.numSolversSi++]=a}if(t==u.dynamics.constraint.PositionCorrectionAlgorithm.NGS){if(this.numSolversNgs==this.solversNgs.length){for(var n=this.numSolversNgs<<1,c=new Array(n),z=c,p=0,y=this.numSolversNgs;p<y;){var V=p++;z[V]=this.solversNgs[V],this.solversNgs[V]=null}this.solversNgs=z}this.solversNgs[this.numSolversNgs++]=a}}_stepSingleRigidBody(a,t){var i=a.dt,o=t._ptransform,r=t._transform;if(o._positionX=r._positionX,o._positionY=r._positionY,o._positionZ=r._positionZ,o._rotation00=r._rotation00,o._rotation01=r._rotation01,o._rotation02=r._rotation02,o._rotation10=r._rotation10,o._rotation11=r._rotation11,o._rotation12=r._rotation12,o._rotation20=r._rotation20,o._rotation21=r._rotation21,o._rotation22=r._rotation22,t._linearContactImpulseX=0,t._linearContactImpulseY=0,t._linearContactImpulseZ=0,t._angularContactImpulseX=0,t._angularContactImpulseY=0,t._angularContactImpulseZ=0,t._autoSleep&&t._velX*t._velX+t._velY*t._velY+t._velZ*t._velZ<u.common.Setting.sleepingVelocityThreshold*u.common.Setting.sleepingVelocityThreshold&&t._angVelX*t._angVelX+t._angVelY*t._angVelY+t._angVelZ*t._angVelZ<u.common.Setting.sleepingAngularVelocityThreshold*u.common.Setting.sleepingAngularVelocityThreshold?(t._sleepTime+=i,t._sleepTime>u.common.Setting.sleepingTimeThreshold&&(t._sleeping=!0,t._sleepTime=0)):t._sleepTime=0,!t._sleeping){if(t._type==0){var e=i*t._linearDamping,_=e*e,h=1/(1+e+_*(.5+e*.16666666666666666+_*.041666666666666664)),v=i*t._angularDamping,s=v*v,l=1/(1+v+s*(.5+v*.16666666666666666+s*.041666666666666664)),x,b,f,n,c,z;x=this.gravityX*t._gravityScale,b=this.gravityY*t._gravityScale,f=this.gravityZ*t._gravityScale,x+=t._forceX*t._invMass,b+=t._forceY*t._invMass,f+=t._forceZ*t._invMass;var p,y,V;p=t._invInertia00*t._torqueX+t._invInertia01*t._torqueY+t._invInertia02*t._torqueZ,y=t._invInertia10*t._torqueX+t._invInertia11*t._torqueY+t._invInertia12*t._torqueZ,V=t._invInertia20*t._torqueX+t._invInertia21*t._torqueY+t._invInertia22*t._torqueZ,n=p,c=y,z=V,t._velX+=x*i,t._velY+=b*i,t._velZ+=f*i,t._velX*=h,t._velY*=h,t._velZ*=h,t._angVelX+=n*i,t._angVelY+=c*i,t._angVelZ+=z*i,t._angVelX*=l,t._angVelY*=l,t._angVelZ*=l}t._integrate(i);for(var M=t._shapeList;M!=null;){var I=M._next,k=M._ptransform,X=M._localTransform,L=t._ptransform,m,g,N,d,F,S,Y,Q,C;m=L._rotation00*X._rotation00+L._rotation01*X._rotation10+L._rotation02*X._rotation20,g=L._rotation00*X._rotation01+L._rotation01*X._rotation11+L._rotation02*X._rotation21,N=L._rotation00*X._rotation02+L._rotation01*X._rotation12+L._rotation02*X._rotation22,d=L._rotation10*X._rotation00+L._rotation11*X._rotation10+L._rotation12*X._rotation20,F=L._rotation10*X._rotation01+L._rotation11*X._rotation11+L._rotation12*X._rotation21,S=L._rotation10*X._rotation02+L._rotation11*X._rotation12+L._rotation12*X._rotation22,Y=L._rotation20*X._rotation00+L._rotation21*X._rotation10+L._rotation22*X._rotation20,Q=L._rotation20*X._rotation01+L._rotation21*X._rotation11+L._rotation22*X._rotation21,C=L._rotation20*X._rotation02+L._rotation21*X._rotation12+L._rotation22*X._rotation22,k._rotation00=m,k._rotation01=g,k._rotation02=N,k._rotation10=d,k._rotation11=F,k._rotation12=S,k._rotation20=Y,k._rotation21=Q,k._rotation22=C;var B,Z,$;B=L._rotation00*X._positionX+L._rotation01*X._positionY+L._rotation02*X._positionZ,Z=L._rotation10*X._positionX+L._rotation11*X._positionY+L._rotation12*X._positionZ,$=L._rotation20*X._positionX+L._rotation21*X._positionY+L._rotation22*X._positionZ,k._positionX=B,k._positionY=Z,k._positionZ=$,k._positionX+=L._positionX,k._positionY+=L._positionY,k._positionZ+=L._positionZ;var K=M._transform,E=M._localTransform,J=t._transform,A,R,U,G,D,H,j,ia,ea;A=J._rotation00*E._rotation00+J._rotation01*E._rotation10+J._rotation02*E._rotation20,R=J._rotation00*E._rotation01+J._rotation01*E._rotation11+J._rotation02*E._rotation21,U=J._rotation00*E._rotation02+J._rotation01*E._rotation12+J._rotation02*E._rotation22,G=J._rotation10*E._rotation00+J._rotation11*E._rotation10+J._rotation12*E._rotation20,D=J._rotation10*E._rotation01+J._rotation11*E._rotation11+J._rotation12*E._rotation21,H=J._rotation10*E._rotation02+J._rotation11*E._rotation12+J._rotation12*E._rotation22,j=J._rotation20*E._rotation00+J._rotation21*E._rotation10+J._rotation22*E._rotation20,ia=J._rotation20*E._rotation01+J._rotation21*E._rotation11+J._rotation22*E._rotation21,ea=J._rotation20*E._rotation02+J._rotation21*E._rotation12+J._rotation22*E._rotation22,K._rotation00=A,K._rotation01=R,K._rotation02=U,K._rotation10=G,K._rotation11=D,K._rotation12=H,K._rotation20=j,K._rotation21=ia,K._rotation22=ea;var W,q,na;W=J._rotation00*E._positionX+J._rotation01*E._positionY+J._rotation02*E._positionZ,q=J._rotation10*E._positionX+J._rotation11*E._positionY+J._rotation12*E._positionZ,na=J._rotation20*E._positionX+J._rotation21*E._positionY+J._rotation22*E._positionZ,K._positionX=W,K._positionY=q,K._positionZ=na,K._positionX+=J._positionX,K._positionY+=J._positionY,K._positionZ+=J._positionZ;var oa,aa,T,ca,_a,w;if(M._geom._computeAabb(M._aabb,M._ptransform),oa=M._aabb._minX,aa=M._aabb._minY,T=M._aabb._minZ,ca=M._aabb._maxX,_a=M._aabb._maxY,w=M._aabb._maxZ,M._geom._computeAabb(M._aabb,M._transform),M._aabb._minX=oa<M._aabb._minX?oa:M._aabb._minX,M._aabb._minY=aa<M._aabb._minY?aa:M._aabb._minY,M._aabb._minZ=T<M._aabb._minZ?T:M._aabb._minZ,M._aabb._maxX=ca>M._aabb._maxX?ca:M._aabb._maxX,M._aabb._maxY=_a>M._aabb._maxY?_a:M._aabb._maxY,M._aabb._maxZ=w>M._aabb._maxZ?w:M._aabb._maxZ,M._proxy!=null){var ta,ra,la;ta=M._transform._positionX-M._ptransform._positionX,ra=M._transform._positionY-M._ptransform._positionY,la=M._transform._positionZ-M._ptransform._positionZ;var va=M.displacement;va.x=ta,va.y=ra,va.z=la,M._rigidBody._world._broadPhase.moveProxy(M._proxy,M._aabb,M.displacement)}M=I}}}_step(a,t,i){for(var o=a.dt,r=!0,e=0,_=this.numRigidBodies;e<_;){var h=e++,v=this.rigidBodies[h],s=v._ptransform,l=v._transform;if(s._positionX=l._positionX,s._positionY=l._positionY,s._positionZ=l._positionZ,s._rotation00=l._rotation00,s._rotation01=l._rotation01,s._rotation02=l._rotation02,s._rotation10=l._rotation10,s._rotation11=l._rotation11,s._rotation12=l._rotation12,s._rotation20=l._rotation20,s._rotation21=l._rotation21,s._rotation22=l._rotation22,v._linearContactImpulseX=0,v._linearContactImpulseY=0,v._linearContactImpulseZ=0,v._angularContactImpulseX=0,v._angularContactImpulseY=0,v._angularContactImpulseZ=0,v._sleeping=!1,v._autoSleep&&v._velX*v._velX+v._velY*v._velY+v._velZ*v._velZ<u.common.Setting.sleepingVelocityThreshold*u.common.Setting.sleepingVelocityThreshold&&v._angVelX*v._angVelX+v._angVelY*v._angVelY+v._angVelZ*v._angVelZ<u.common.Setting.sleepingAngularVelocityThreshold*u.common.Setting.sleepingAngularVelocityThreshold?v._sleepTime+=o:v._sleepTime=0,v._sleepTime<u.common.Setting.sleepingTimeThreshold&&(r=!1),v._type==0){var x=o*v._linearDamping,b=x*x,f=1/(1+x+b*(.5+x*.16666666666666666+b*.041666666666666664)),n=o*v._angularDamping,c=n*n,z=1/(1+n+c*(.5+n*.16666666666666666+c*.041666666666666664)),p,y,V,M,I,k;p=this.gravityX*v._gravityScale,y=this.gravityY*v._gravityScale,V=this.gravityZ*v._gravityScale,p+=v._forceX*v._invMass,y+=v._forceY*v._invMass,V+=v._forceZ*v._invMass;var X,L,m;X=v._invInertia00*v._torqueX+v._invInertia01*v._torqueY+v._invInertia02*v._torqueZ,L=v._invInertia10*v._torqueX+v._invInertia11*v._torqueY+v._invInertia12*v._torqueZ,m=v._invInertia20*v._torqueX+v._invInertia21*v._torqueY+v._invInertia22*v._torqueZ,M=X,I=L,k=m,v._velX+=p*o,v._velY+=y*o,v._velZ+=V*o,v._velX*=f,v._velY*=f,v._velZ*=f,v._angVelX+=M*o,v._angVelY+=I*o,v._angVelZ+=k*o,v._angVelX*=z,v._angVelY*=z,v._angVelZ*=z}}if(r){for(var g=0,N=this.numRigidBodies;g<N;){var d=g++,F=this.rigidBodies[d];F._sleeping=!0,F._sleepTime=0}return}for(var S=0,Y=this.numSolvers;S<Y;){var Q=S++,C=this.solvers[Q];C.preSolveVelocity(a)}for(var B=0,Z=this.numSolvers;B<Z;){var $=B++,K=this.solvers[$];K.warmStart(a)}for(var E=0,J=t;E<J;){E++;for(var A=0,R=this.numSolvers;A<R;){var U=A++,G=this.solvers[U];G.solveVelocity()}}for(var D=0,H=this.numSolvers;D<H;){var j=D++,ia=this.solvers[j];ia.postSolveVelocity(a)}for(var ea=0,W=this.numRigidBodies;ea<W;){var q=ea++,na=this.rigidBodies[q];na._integrate(o)}for(var oa=0,aa=this.numSolversSi;oa<aa;){var T=oa++,ca=this.solversSi[T];ca.preSolvePosition(a)}for(var _a=0,w=i;_a<w;){_a++;for(var ta=0,ra=this.numSolversSi;ta<ra;){var la=ta++,va=this.solversSi[la];va.solvePositionSplitImpulse()}}for(var ua=0,za=this.numRigidBodies;ua<za;){var Ma=ua++,Xa=this.rigidBodies[Ma];Xa._integratePseudoVelocity()}for(var Za=0,fa=this.numSolversNgs;Za<fa;){var ba=Za++,sa=this.solversNgs[ba];sa.preSolvePosition(a)}for(var ha=0,ma=i;ha<ma;){ha++;for(var ya=0,Ba=this.numSolversNgs;ya<Ba;){var pa=ya++,Ya=this.solversNgs[pa];Ya.solvePositionNgs(a)}}for(var Ra=0,ga=this.numSolvers;Ra<ga;){var xa=Ra++,wa=this.solvers[xa];wa.postSolve()}for(var ka=0,Pa=this.numRigidBodies;ka<Pa;)for(var zt=ka++,Oa=this.rigidBodies[zt],Aa=Oa._shapeList;Aa!=null;){var nt=Aa._next,Ea=Aa._ptransform,Fa=Aa._localTransform,da=Oa._ptransform,ft,Wa,Ha,bt,it,Ka,_t,gt,pt;ft=da._rotation00*Fa._rotation00+da._rotation01*Fa._rotation10+da._rotation02*Fa._rotation20,Wa=da._rotation00*Fa._rotation01+da._rotation01*Fa._rotation11+da._rotation02*Fa._rotation21,Ha=da._rotation00*Fa._rotation02+da._rotation01*Fa._rotation12+da._rotation02*Fa._rotation22,bt=da._rotation10*Fa._rotation00+da._rotation11*Fa._rotation10+da._rotation12*Fa._rotation20,it=da._rotation10*Fa._rotation01+da._rotation11*Fa._rotation11+da._rotation12*Fa._rotation21,Ka=da._rotation10*Fa._rotation02+da._rotation11*Fa._rotation12+da._rotation12*Fa._rotation22,_t=da._rotation20*Fa._rotation00+da._rotation21*Fa._rotation10+da._rotation22*Fa._rotation20,gt=da._rotation20*Fa._rotation01+da._rotation21*Fa._rotation11+da._rotation22*Fa._rotation21,pt=da._rotation20*Fa._rotation02+da._rotation21*Fa._rotation12+da._rotation22*Fa._rotation22,Ea._rotation00=ft,Ea._rotation01=Wa,Ea._rotation02=Ha,Ea._rotation10=bt,Ea._rotation11=it,Ea._rotation12=Ka,Ea._rotation20=_t,Ea._rotation21=gt,Ea._rotation22=pt;var Ga,rt,xt;Ga=da._rotation00*Fa._positionX+da._rotation01*Fa._positionY+da._rotation02*Fa._positionZ,rt=da._rotation10*Fa._positionX+da._rotation11*Fa._positionY+da._rotation12*Fa._positionZ,xt=da._rotation20*Fa._positionX+da._rotation21*Fa._positionY+da._rotation22*Fa._positionZ,Ea._positionX=Ga,Ea._positionY=rt,Ea._positionZ=xt,Ea._positionX+=da._positionX,Ea._positionY+=da._positionY,Ea._positionZ+=da._positionZ;var Da=Aa._transform,Ta=Aa._localTransform,Na=Oa._transform,Vt,Pt,st,Xt,Yt,Mt,Ia,O,Va;Vt=Na._rotation00*Ta._rotation00+Na._rotation01*Ta._rotation10+Na._rotation02*Ta._rotation20,Pt=Na._rotation00*Ta._rotation01+Na._rotation01*Ta._rotation11+Na._rotation02*Ta._rotation21,st=Na._rotation00*Ta._rotation02+Na._rotation01*Ta._rotation12+Na._rotation02*Ta._rotation22,Xt=Na._rotation10*Ta._rotation00+Na._rotation11*Ta._rotation10+Na._rotation12*Ta._rotation20,Yt=Na._rotation10*Ta._rotation01+Na._rotation11*Ta._rotation11+Na._rotation12*Ta._rotation21,Mt=Na._rotation10*Ta._rotation02+Na._rotation11*Ta._rotation12+Na._rotation12*Ta._rotation22,Ia=Na._rotation20*Ta._rotation00+Na._rotation21*Ta._rotation10+Na._rotation22*Ta._rotation20,O=Na._rotation20*Ta._rotation01+Na._rotation21*Ta._rotation11+Na._rotation22*Ta._rotation21,Va=Na._rotation20*Ta._rotation02+Na._rotation21*Ta._rotation12+Na._rotation22*Ta._rotation22,Da._rotation00=Vt,Da._rotation01=Pt,Da._rotation02=st,Da._rotation10=Xt,Da._rotation11=Yt,Da._rotation12=Mt,Da._rotation20=Ia,Da._rotation21=O,Da._rotation22=Va;var lt,P,wt;lt=Na._rotation00*Ta._positionX+Na._rotation01*Ta._positionY+Na._rotation02*Ta._positionZ,P=Na._rotation10*Ta._positionX+Na._rotation11*Ta._positionY+Na._rotation12*Ta._positionZ,wt=Na._rotation20*Ta._positionX+Na._rotation21*Ta._positionY+Na._rotation22*Ta._positionZ,Da._positionX=lt,Da._positionY=P,Da._positionZ=wt,Da._positionX+=Na._positionX,Da._positionY+=Na._positionY,Da._positionZ+=Na._positionZ;var At,dt,yt,kt,mt,ht;if(Aa._geom._computeAabb(Aa._aabb,Aa._ptransform),At=Aa._aabb._minX,dt=Aa._aabb._minY,yt=Aa._aabb._minZ,kt=Aa._aabb._maxX,mt=Aa._aabb._maxY,ht=Aa._aabb._maxZ,Aa._geom._computeAabb(Aa._aabb,Aa._transform),Aa._aabb._minX=At<Aa._aabb._minX?At:Aa._aabb._minX,Aa._aabb._minY=dt<Aa._aabb._minY?dt:Aa._aabb._minY,Aa._aabb._minZ=yt<Aa._aabb._minZ?yt:Aa._aabb._minZ,Aa._aabb._maxX=kt>Aa._aabb._maxX?kt:Aa._aabb._maxX,Aa._aabb._maxY=mt>Aa._aabb._maxY?mt:Aa._aabb._maxY,Aa._aabb._maxZ=ht>Aa._aabb._maxZ?ht:Aa._aabb._maxZ,Aa._proxy!=null){var ut,Qa,et;ut=Aa._transform._positionX-Aa._ptransform._positionX,Qa=Aa._transform._positionY-Aa._ptransform._positionY,et=Aa._transform._positionZ-Aa._ptransform._positionZ;var Ca=Aa.displacement;Ca.x=ut,Ca.y=Qa,Ca.z=et,Aa._rigidBody._world._broadPhase.moveProxy(Aa._proxy,Aa._aabb,Aa.displacement)}Aa=nt}}};u.dynamics.TimeStep=class{constructor(){this.dt=0,this.invDt=0,this.dtRatio=1}};u.dynamics.World=class{constructor(a,t){switch(a==null&&(a=2),a){case 1:this._broadPhase=new u.collision.broadphase.bruteforce.BruteForceBroadPhase;break;case 2:this._broadPhase=new u.collision.broadphase.bvh.BvhBroadPhase;break}this._contactManager=new u.dynamics.ContactManager(this._broadPhase),t==null&&(t=new u.common.Vec3(0,-9.80665,0)),this._gravity=new u.common.Vec3(t.x,t.y,t.z),this._rigidBodyList=null,this._rigidBodyListLast=null,this._jointList=null,this._jointListLast=null,this._numRigidBodies=0,this._numShapes=0,this._numJoints=0,this._numIslands=0,this._numVelocityIterations=10,this._numPositionIterations=5,this._rayCastWrapper=new u.dynamics._World.RayCastWrapper,this._convexCastWrapper=new u.dynamics._World.ConvexCastWrapper,this._aabbTestWrapper=new u.dynamics._World.AabbTestWrapper,this._island=new u.dynamics.Island;var i=new Array(u.common.Setting.islandInitialConstraintArraySize);this._solversInIslands=i;var o=new Array(u.common.Setting.islandInitialRigidBodyArraySize);this._rigidBodyStack=o,this._timeStep=new u.dynamics.TimeStep,this._pool=new u.common.Pool,this._shapeIdCount=0}_updateContacts(){var a=Date.now()/1e3;this._contactManager._updateContacts();var t=Date.now()/1e3;u.dynamics.common.Performance.broadPhaseCollisionTime=(t-a)*1e3;for(var i=Date.now()/1e3,o=this._contactManager._contactList;o!=null;){var r=o._next;o._shouldBeSkipped||o._updateManifold(),o=r}var e=Date.now()/1e3;u.dynamics.common.Performance.narrowPhaseCollisionTime=(e-i)*1e3}_solveIslands(){var a=Date.now()/1e3;if(u.common.Setting.disableSleeping)for(var t=this._rigidBodyList;t!=null;){var i=t._next;t._sleeping=!1,t._sleepTime=0,t=i}if(this._rigidBodyStack.length<this._numRigidBodies){for(var o=this._rigidBodyStack.length<<1;o<this._numRigidBodies;)o<<=1;var r=new Array(o);this._rigidBodyStack=r}this._numIslands=0;var e=this._island,_=this._gravity;e.gravityX=_.x,e.gravityY=_.y,e.gravityZ=_.z;var h=this._rigidBodyList;for(this._numSolversInIslands=0;h!=null;){for(var v=h._next;!(h._addedToIsland||h._sleeping||h._type==1);){if(h._numContactLinks==0&&h._numJointLinks==0){this._island._stepSingleRigidBody(this._timeStep,h),this._numIslands++;break}this.buildIsland(h),this._island._step(this._timeStep,this._numVelocityIterations,this._numPositionIterations),this._island._clear(),this._numIslands++;break}h=v}for(this._contactManager._postSolve(),h=this._rigidBodyList;h!=null;){var s=h._next;h._addedToIsland=!1,h=s}for(h=this._rigidBodyList;h!=null;){var l=h._next;h._forceX=0,h._forceY=0,h._forceZ=0,h._torqueX=0,h._torqueY=0,h._torqueZ=0,h=l}for(;this._numSolversInIslands>0;)this._solversInIslands[--this._numSolversInIslands]._addedToIsland=!1,this._solversInIslands[this._numSolversInIslands]=null;var x=Date.now()/1e3;u.dynamics.common.Performance.dynamicsTime=(x-a)*1e3}buildIsland(a){var t=1;for(this._island._addRigidBody(a),this._rigidBodyStack[0]=a;t>0;){var i=this._rigidBodyStack[--t];if(this._rigidBodyStack[t]=null,i._type!=1){for(var o=i._contactLinkList;o!=null;){var r=o._next,e=o._contact._contactConstraint,_=o._contact._contactConstraint._solver;if(e.isTouching()&&!_._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){for(var h=this._numSolversInIslands<<1,v=new Array(h),s=v,l=0,x=this._numSolversInIslands;l<x;){var b=l++;s[b]=this._solversInIslands[b],this._solversInIslands[b]=null}this._solversInIslands=s}this._solversInIslands[this._numSolversInIslands++]=_,this._island._addConstraintSolver(_,e._positionCorrectionAlgorithm);var f=o._other;f._addedToIsland||(this._island._addRigidBody(f),this._rigidBodyStack[t++]=f)}o=r}for(var n=i._jointLinkList;n!=null;){var c=n._next,z=n._joint,p=z._solver;if(!p._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){for(var y=this._numSolversInIslands<<1,V=new Array(y),M=V,I=0,k=this._numSolversInIslands;I<k;){var X=I++;M[X]=this._solversInIslands[X],this._solversInIslands[X]=null}this._solversInIslands=M}this._solversInIslands[this._numSolversInIslands++]=p,this._island._addConstraintSolver(p,z._positionCorrectionAlgorithm);var L=n._other;L._addedToIsland||(this._island._addRigidBody(L),this._rigidBodyStack[t++]=L)}n=c}}}}_drawBvh(a,t){a.drawBvh&&this._drawBvhNode(a,t._root,0,a.style.bvhNodeColor)}_drawBvhNode(a,t,i,o){if(t!=null){if(i>=a.drawBvhMinLevel&&i<=a.drawBvhMaxLevel){var r=this._pool,e=r.sizeVec3==0?new u.common.Vec3:r.stackVec3[--r.sizeVec3],_=this._pool,h=_.sizeVec3==0?new u.common.Vec3:_.stackVec3[--_.sizeVec3],v=e;v.x=t._aabbMinX,v.y=t._aabbMinY,v.z=t._aabbMinZ;var s=h;s.x=t._aabbMaxX,s.y=t._aabbMaxY,s.z=t._aabbMaxZ,a.aabb(e,h,o);var l=this._pool,x=null,b=null,f=null;if(e!=null){if(e.zero(),l.sizeVec3==l.stackVec3.length){for(var n=l.sizeVec3<<1,c=new Array(n),z=c,p=0,y=l.sizeVec3;p<y;){var V=p++;z[V]=l.stackVec3[V],l.stackVec3[V]=null}l.stackVec3=z}l.stackVec3[l.sizeVec3++]=e}if(x!=null){var M=1,I=0,k=0,X=0,L=1,m=0,g=0,N=0,d=1;if(x.e00=M,x.e01=I,x.e02=k,x.e10=X,x.e11=L,x.e12=m,x.e20=g,x.e21=N,x.e22=d,l.sizeMat3==l.stackMat3.length){for(var F=l.sizeMat3<<1,S=new Array(F),Y=S,Q=0,C=l.sizeMat3;Q<C;){var B=Q++;Y[B]=l.stackMat3[B],l.stackMat3[B]=null}l.stackMat3=Y}l.stackMat3[l.sizeMat3++]=x}if(b!=null){var Z=1,$=0,K=0,E=0,J=0,A=1,R=0,U=0,G=0,D=0,H=1,j=0,ia=0,ea=0,W=0,q=1;if(b.e00=Z,b.e01=$,b.e02=K,b.e03=E,b.e10=J,b.e11=A,b.e12=R,b.e13=U,b.e20=G,b.e21=D,b.e22=H,b.e23=j,b.e30=ia,b.e31=ea,b.e32=W,b.e33=q,l.sizeMat4==l.stackMat4.length){for(var na=l.sizeMat4<<1,oa=new Array(na),aa=oa,T=0,ca=l.sizeMat4;T<ca;){var _a=T++;aa[_a]=l.stackMat4[_a],l.stackMat4[_a]=null}l.stackMat4=aa}l.stackMat4[l.sizeMat4++]=b}if(f!=null){var w=0,ta=0,ra=0,la=1;if(f.x=w,f.y=ta,f.z=ra,f.w=la,l.sizeQuat==l.stackQuat.length){for(var va=l.sizeQuat<<1,ua=new Array(va),za=ua,Ma=0,Xa=l.sizeQuat;Ma<Xa;){var Za=Ma++;za[Za]=l.stackQuat[Za],l.stackQuat[Za]=null}l.stackQuat=za}l.stackQuat[l.sizeQuat++]=f}var fa=this._pool,ba=null,sa=null,ha=null;if(h!=null){if(h.zero(),fa.sizeVec3==fa.stackVec3.length){for(var ma=fa.sizeVec3<<1,ya=new Array(ma),Ba=ya,pa=0,Ya=fa.sizeVec3;pa<Ya;){var Ra=pa++;Ba[Ra]=fa.stackVec3[Ra],fa.stackVec3[Ra]=null}fa.stackVec3=Ba}fa.stackVec3[fa.sizeVec3++]=h}if(ba!=null){var ga=1,xa=0,wa=0,ka=0,Pa=1,zt=0,Oa=0,Aa=0,nt=1;if(ba.e00=ga,ba.e01=xa,ba.e02=wa,ba.e10=ka,ba.e11=Pa,ba.e12=zt,ba.e20=Oa,ba.e21=Aa,ba.e22=nt,fa.sizeMat3==fa.stackMat3.length){for(var Ea=fa.sizeMat3<<1,Fa=new Array(Ea),da=Fa,ft=0,Wa=fa.sizeMat3;ft<Wa;){var Ha=ft++;da[Ha]=fa.stackMat3[Ha],fa.stackMat3[Ha]=null}fa.stackMat3=da}fa.stackMat3[fa.sizeMat3++]=ba}if(sa!=null){var bt=1,it=0,Ka=0,_t=0,gt=0,pt=1,Ga=0,rt=0,xt=0,Da=0,Ta=1,Na=0,Vt=0,Pt=0,st=0,Xt=1;if(sa.e00=bt,sa.e01=it,sa.e02=Ka,sa.e03=_t,sa.e10=gt,sa.e11=pt,sa.e12=Ga,sa.e13=rt,sa.e20=xt,sa.e21=Da,sa.e22=Ta,sa.e23=Na,sa.e30=Vt,sa.e31=Pt,sa.e32=st,sa.e33=Xt,fa.sizeMat4==fa.stackMat4.length){for(var Yt=fa.sizeMat4<<1,Mt=new Array(Yt),Ia=Mt,O=0,Va=fa.sizeMat4;O<Va;){var lt=O++;Ia[lt]=fa.stackMat4[lt],fa.stackMat4[lt]=null}fa.stackMat4=Ia}fa.stackMat4[fa.sizeMat4++]=sa}if(ha!=null){var P=0,wt=0,At=0,dt=1;if(ha.x=P,ha.y=wt,ha.z=At,ha.w=dt,fa.sizeQuat==fa.stackQuat.length){for(var yt=fa.sizeQuat<<1,kt=new Array(yt),mt=kt,ht=0,ut=fa.sizeQuat;ht<ut;){var Qa=ht++;mt[Qa]=fa.stackQuat[Qa],fa.stackQuat[Qa]=null}fa.stackQuat=mt}fa.stackQuat[fa.sizeQuat++]=ha}}this._drawBvhNode(a,t._children[0],i+1,o),this._drawBvhNode(a,t._children[1],i+1,o)}}_drawRigidBodies(a){for(var t=a.style,i=this._rigidBodyList;i!=null;){var o=i._next;if(a.drawBases){var r=a.style;a.basis(i._transform,r.basisLength,r.basisColorX,r.basisColorY,r.basisColorZ)}var e=null,_=i._type==0;_||(e=i._type==2?t.kinematicShapeColor:t.staticShapeColor);for(var h=i._shapeList;h!=null;){var v=h._next;if(_&&(h._id&1?e=i._sleeping?t.sleepingShapeColor2:i._sleepTime>u.common.Setting.sleepingTimeThreshold?t.sleepyShapeColor2:t.shapeColor2:e=i._sleeping?t.sleepingShapeColor1:i._sleepTime>u.common.Setting.sleepingTimeThreshold?t.sleepyShapeColor1:t.shapeColor1),a.drawShapes){var s=h._geom,l=h._transform;switch(s._type){case 0:a.sphere(l,s._radius,e);break;case 1:var x=s,b=this._pool,f=b.sizeVec3==0?new u.common.Vec3:b.stackVec3[--b.sizeVec3],n=f;n.x=x._halfExtentsX,n.y=x._halfExtentsY,n.z=x._halfExtentsZ,a.box(l,f,e);var c=this._pool,z=null,p=null,y=null;if(f!=null){if(f.zero(),c.sizeVec3==c.stackVec3.length){for(var V=c.sizeVec3<<1,M=new Array(V),I=M,k=0,X=c.sizeVec3;k<X;){var L=k++;I[L]=c.stackVec3[L],c.stackVec3[L]=null}c.stackVec3=I}c.stackVec3[c.sizeVec3++]=f}if(z!=null){var m=1,g=0,N=0,d=0,F=1,S=0,Y=0,Q=0,C=1;if(z.e00=m,z.e01=g,z.e02=N,z.e10=d,z.e11=F,z.e12=S,z.e20=Y,z.e21=Q,z.e22=C,c.sizeMat3==c.stackMat3.length){for(var B=c.sizeMat3<<1,Z=new Array(B),$=Z,K=0,E=c.sizeMat3;K<E;){var J=K++;$[J]=c.stackMat3[J],c.stackMat3[J]=null}c.stackMat3=$}c.stackMat3[c.sizeMat3++]=z}if(p!=null){var A=1,R=0,U=0,G=0,D=0,H=1,j=0,ia=0,ea=0,W=0,q=1,na=0,oa=0,aa=0,T=0,ca=1;if(p.e00=A,p.e01=R,p.e02=U,p.e03=G,p.e10=D,p.e11=H,p.e12=j,p.e13=ia,p.e20=ea,p.e21=W,p.e22=q,p.e23=na,p.e30=oa,p.e31=aa,p.e32=T,p.e33=ca,c.sizeMat4==c.stackMat4.length){for(var _a=c.sizeMat4<<1,w=new Array(_a),ta=w,ra=0,la=c.sizeMat4;ra<la;){var va=ra++;ta[va]=c.stackMat4[va],c.stackMat4[va]=null}c.stackMat4=ta}c.stackMat4[c.sizeMat4++]=p}if(y!=null){var ua=0,za=0,Ma=0,Xa=1;if(y.x=ua,y.y=za,y.z=Ma,y.w=Xa,c.sizeQuat==c.stackQuat.length){for(var Za=c.sizeQuat<<1,fa=new Array(Za),ba=fa,sa=0,ha=c.sizeQuat;sa<ha;){var ma=sa++;ba[ma]=c.stackQuat[ma],c.stackQuat[ma]=null}c.stackQuat=ba}c.stackQuat[c.sizeQuat++]=y}break;case 2:var ya=s;a.cylinder(l,ya._radius,ya._halfHeight,e);break;case 3:var Ba=s;a.cone(l,Ba._radius,Ba._halfHeight,e);break;case 4:var pa=s;a.capsule(l,pa._radius,pa._halfHeight,e);break;case 5:var Ya=s,Ra=Ya._numVertices,ga=this._pool,xa=ga.sizeVec3==0?new u.common.Vec3:ga.stackVec3[--ga.sizeVec3],wa=this._pool,ka=wa.sizeVec3==0?new u.common.Vec3:wa.stackVec3[--wa.sizeVec3],Pa=this._pool,zt=Pa.sizeVec3==0?new u.common.Vec3:Pa.stackVec3[--Pa.sizeVec3],Oa=this._pool,Aa=Oa.sizeVec3==0?new u.common.Vec3:Oa.stackVec3[--Oa.sizeVec3],nt=this._pool,Ea=nt.sizeVec3==0?new u.common.Vec3:nt.stackVec3[--nt.sizeVec3],Fa=this._pool,da=Fa.sizeVec3==0?new u.common.Vec3:Fa.stackVec3[--Fa.sizeVec3],ft=this._pool,Wa=ft.sizeMat3==0?new u.common.Mat3:ft.stackMat3[--ft.sizeMat3],Ha=this._pool,bt=Ha.sizeVec3==0?new u.common.Vec3:Ha.stackVec3[--Ha.sizeVec3],it=Wa;it.e00=l._rotation00,it.e01=l._rotation01,it.e02=l._rotation02,it.e10=l._rotation10,it.e11=l._rotation11,it.e12=l._rotation12,it.e20=l._rotation20,it.e21=l._rotation21,it.e22=l._rotation22;var Ka=bt;Ka.x=l._positionX,Ka.y=l._positionY,Ka.z=l._positionZ;for(var _t=0,gt=Ra;_t<gt;){var pt=_t++,Ga=Ya._tmpVertices[pt],rt=Ya._vertices[pt];Ga.x=rt.x,Ga.y=rt.y,Ga.z=rt.z;var xt=Ga,Da=xt.x*Wa.e00+xt.y*Wa.e01+xt.z*Wa.e02,Ta=xt.x*Wa.e10+xt.y*Wa.e11+xt.z*Wa.e12,Na=xt.x*Wa.e20+xt.y*Wa.e21+xt.z*Wa.e22;xt.x=Da,xt.y=Ta,xt.z=Na;var Vt=xt,Pt=Vt.x+bt.x,st=Vt.y+bt.y,Xt=Vt.z+bt.z;Vt.x=Pt,Vt.y=st,Vt.z=Xt}if(Ra>30)for(var Yt=0,Mt=Ra;Yt<Mt;){var Ia=Yt++,O=Ya._tmpVertices[Ia];xa.x=O.x,xa.y=O.y,xa.z=O.z;var Va=Ya._tmpVertices[(Ia+1)%Ra];ka.x=Va.x,ka.y=Va.y,ka.z=Va.z,a.line(xa,ka,e)}else if(this._debugDraw.wireframe||Ra>10)for(var lt=0,P=Ra;lt<P;){var wt=lt++,At=Ya._tmpVertices[wt];xa.x=At.x,xa.y=At.y,xa.z=At.z;for(var dt=0,yt=wt;dt<yt;){var kt=dt++,mt=Ya._tmpVertices[kt];ka.x=mt.x,ka.y=mt.y,ka.z=mt.z,a.line(xa,ka,e)}}else for(var ht=0,ut=Ra;ht<ut;){var Qa=ht++,et=Ya._tmpVertices[Qa];xa.x=et.x,xa.y=et.y,xa.z=et.z;for(var Ca=0,vt=Qa;Ca<vt;){var qa=Ca++,at=Ya._tmpVertices[qa];ka.x=at.x,ka.y=at.y,ka.z=at.z;for(var Ua=0,tt=qa;Ua<tt;){var ct=Ua++,Sa=Ya._tmpVertices[ct];zt.x=Sa.x,zt.y=Sa.y,zt.z=Sa.z,Aa.x=ka.x,Aa.y=ka.y,Aa.z=ka.z;var Ja=Aa,ja=Ja.x-xa.x,La=Ja.y-xa.y,ot=Ja.z-xa.z;Ja.x=ja,Ja.y=La,Ja.z=ot,Ea.x=zt.x,Ea.y=zt.y,Ea.z=zt.z;var It=Ea,oi=It.x-xa.x,gi=It.y-xa.y,ai=It.z-xa.z;It.x=oi,It.y=gi,It.z=ai,da.x=Aa.x,da.y=Aa.y,da.z=Aa.z;var Ct=da,_i=Ct.y*Ea.z-Ct.z*Ea.y,Et=Ct.z*Ea.x-Ct.x*Ea.z,St=Ct.x*Ea.y-Ct.y*Ea.x;Ct.x=_i,Ct.y=Et,Ct.z=St;var Jt=Ct,Ki=Math.sqrt(Jt.x*Jt.x+Jt.y*Jt.y+Jt.z*Jt.z);Ki>0&&(Ki=1/Ki);var vi=Jt.x*Ki,li=Jt.y*Ki,ti=Jt.z*Ki;Jt.x=vi,Jt.y=li,Jt.z=ti,a.triangle(xa,ka,zt,da,da,da,e);var Oi=-da.x,Xi=-da.y,zi=-da.z;da.x=Oi,da.y=Xi,da.z=zi,a.triangle(xa,zt,ka,da,da,da,e)}}}var Zt=this._pool,ri=null,Wt=null,ni=null;if(xa!=null){if(xa.zero(),Zt.sizeVec3==Zt.stackVec3.length){for(var $i=Zt.sizeVec3<<1,Ut=new Array($i),ji=Ut,Ii=0,pr=Zt.sizeVec3;Ii<pr;){var Wi=Ii++;ji[Wi]=Zt.stackVec3[Wi],Zt.stackVec3[Wi]=null}Zt.stackVec3=ji}Zt.stackVec3[Zt.sizeVec3++]=xa}if(ri!=null){var Lt=1,jt=0,Tt=0,bi=0,Mi=1,vr=0,qt=0,fi=0,Bt=1;if(ri.e00=Lt,ri.e01=jt,ri.e02=Tt,ri.e10=bi,ri.e11=Mi,ri.e12=vr,ri.e20=qt,ri.e21=fi,ri.e22=Bt,Zt.sizeMat3==Zt.stackMat3.length){for(var xi=Zt.sizeMat3<<1,hi=new Array(xi),sr=hi,Xr=0,ro=Zt.sizeMat3;Xr<ro;){var Gt=Xr++;sr[Gt]=Zt.stackMat3[Gt],Zt.stackMat3[Gt]=null}Zt.stackMat3=sr}Zt.stackMat3[Zt.sizeMat3++]=ri}if(Wt!=null){var fr=1,mr=0,Dt=0,Br=0,Si=0,Dr=1,Hn=0,oo=0,Ar=0,no=0,yn=1,Ao=0,Io=0,ui=0,qr=0,dr=1;if(Wt.e00=fr,Wt.e01=mr,Wt.e02=Dt,Wt.e03=Br,Wt.e10=Si,Wt.e11=Dr,Wt.e12=Hn,Wt.e13=oo,Wt.e20=Ar,Wt.e21=no,Wt.e22=yn,Wt.e23=Ao,Wt.e30=Io,Wt.e31=ui,Wt.e32=qr,Wt.e33=dr,Zt.sizeMat4==Zt.stackMat4.length){for(var yr=Zt.sizeMat4<<1,So=new Array(yr),Di=So,Sr=0,gr=Zt.sizeMat4;Sr<gr;){var Qt=Sr++;Di[Qt]=Zt.stackMat4[Qt],Zt.stackMat4[Qt]=null}Zt.stackMat4=Di}Zt.stackMat4[Zt.sizeMat4++]=Wt}if(ni!=null){var Hi=0,Li=0,Cn=0,Me=1;if(ni.x=Hi,ni.y=Li,ni.z=Cn,ni.w=Me,Zt.sizeQuat==Zt.stackQuat.length){for(var js=Zt.sizeQuat<<1,pe=new Array(js),Ts=pe,qs=0,D_=Zt.sizeQuat;qs<D_;){var gn=qs++;Ts[gn]=Zt.stackQuat[gn],Zt.stackQuat[gn]=null}Zt.stackQuat=Ts}Zt.stackQuat[Zt.sizeQuat++]=ni}var Pi=this._pool,No=null,Wr=null,ks=null;if(ka!=null){if(ka.zero(),Pi.sizeVec3==Pi.stackVec3.length){for(var on=Pi.sizeVec3<<1,Tn=new Array(on),Kn=Tn,ws=0,k_=Pi.sizeVec3;ws<k_;){var Qs=ws++;Kn[Qs]=Pi.stackVec3[Qs],Pi.stackVec3[Qs]=null}Pi.stackVec3=Kn}Pi.stackVec3[Pi.sizeVec3++]=ka}if(No!=null){var Vi=1,Ir=0,xr=0,so=0,Qn=1,me=0,nn=0,Rn=0,ci=1;if(No.e00=Vi,No.e01=Ir,No.e02=xr,No.e10=so,No.e11=Qn,No.e12=me,No.e20=nn,No.e21=Rn,No.e22=ci,Pi.sizeMat3==Pi.stackMat3.length){for(var ho=Pi.sizeMat3<<1,Fr=new Array(ho),En=Fr,ae=0,Rs=Pi.sizeMat3;ae<Rs;){var Es=ae++;En[Es]=Pi.stackMat3[Es],Pi.stackMat3[Es]=null}Pi.stackMat3=En}Pi.stackMat3[Pi.sizeMat3++]=No}if(Wr!=null){var Ds=1,hs=0,ii=0,ir=0,Ri=0,Fi=1,fo=0,Po=0,e_=0,Fs=0,te=1,Dn=0,co=0,Ft=0,Ni=0,lr=1;if(Wr.e00=Ds,Wr.e01=hs,Wr.e02=ii,Wr.e03=ir,Wr.e10=Ri,Wr.e11=Fi,Wr.e12=fo,Wr.e13=Po,Wr.e20=e_,Wr.e21=Fs,Wr.e22=te,Wr.e23=Dn,Wr.e30=co,Wr.e31=Ft,Wr.e32=Ni,Wr.e33=lr,Pi.sizeMat4==Pi.stackMat4.length){for(var Vo=Pi.sizeMat4<<1,cs=new Array(Vo),Xs=cs,Ls=0,xo=Pi.sizeMat4;Ls<xo;){var $t=Ls++;Xs[$t]=Pi.stackMat4[$t],Pi.stackMat4[$t]=null}Pi.stackMat4=Xs}Pi.stackMat4[Pi.sizeMat4++]=Wr}if(ks!=null){var Vr=0,er=0,Jo=0,Ne=1;if(ks.x=Vr,ks.y=er,ks.z=Jo,ks.w=Ne,Pi.sizeQuat==Pi.stackQuat.length){for(var Co=Pi.sizeQuat<<1,ko=new Array(Co),Nr=ko,Pr=0,Cr=Pi.sizeQuat;Pr<Cr;){var Lr=Pr++;Nr[Lr]=Pi.stackQuat[Lr],Pi.stackQuat[Lr]=null}Pi.stackQuat=Nr}Pi.stackQuat[Pi.sizeQuat++]=ks}var Rt=this._pool,Ji=null,Yi=null,Qi=null;if(zt!=null){if(zt.zero(),Rt.sizeVec3==Rt.stackVec3.length){for(var zr=Rt.sizeVec3<<1,qi=new Array(zr),Jr=qi,Gr=0,ao=Rt.sizeVec3;Gr<ao;){var bs=Gr++;Jr[bs]=Rt.stackVec3[bs],Rt.stackVec3[bs]=null}Rt.stackVec3=Jr}Rt.stackVec3[Rt.sizeVec3++]=zt}if(Ji!=null){var ki=1,sn=0,Yr=0,Go=0,ye=1,In=0,ge=0,Vn=0,Ci=1;if(Ji.e00=ki,Ji.e01=sn,Ji.e02=Yr,Ji.e10=Go,Ji.e11=ye,Ji.e12=In,Ji.e20=ge,Ji.e21=Vn,Ji.e22=Ci,Rt.sizeMat3==Rt.stackMat3.length){for(var To=Rt.sizeMat3<<1,eo=new Array(To),Fn=eo,Ns=0,Nn=Rt.sizeMat3;Ns<Nn;){var Wo=Ns++;Fn[Wo]=Rt.stackMat3[Wo],Rt.stackMat3[Wo]=null}Rt.stackMat3=Fn}Rt.stackMat3[Rt.sizeMat3++]=Ji}if(Yi!=null){var kn=1,Ys=0,Ot=0,Qo=0,Ur=0,wn=1,Jn=0,fs=0,Ie=0,Uo=0,Ve=1,w_=0,Je=0,X_=0,Js=0,F_=1;if(Yi.e00=kn,Yi.e01=Ys,Yi.e02=Ot,Yi.e03=Qo,Yi.e10=Ur,Yi.e11=wn,Yi.e12=Jn,Yi.e13=fs,Yi.e20=Ie,Yi.e21=Uo,Yi.e22=Ve,Yi.e23=w_,Yi.e30=Je,Yi.e31=X_,Yi.e32=Js,Yi.e33=F_,Rt.sizeMat4==Rt.stackMat4.length){for(var N_=Rt.sizeMat4<<1,Or=new Array(N_),wo=Or,Xo=0,Gn=Rt.sizeMat4;Xo<Gn;){var wi=Xo++;wo[wi]=Rt.stackMat4[wi],Rt.stackMat4[wi]=null}Rt.stackMat4=wo}Rt.stackMat4[Rt.sizeMat4++]=Yi}if(Qi!=null){var Wn=0,Ro=0,to=0,J_=1;if(Qi.x=Wn,Qi.y=Ro,Qi.z=to,Qi.w=J_,Rt.sizeQuat==Rt.stackQuat.length){for(var G_=Rt.sizeQuat<<1,L_=new Array(G_),ie=L_,__=0,v_=Rt.sizeQuat;__<v_;){var re=__++;ie[re]=Rt.stackQuat[re],Rt.stackQuat[re]=null}Rt.stackQuat=ie}Rt.stackQuat[Rt.sizeQuat++]=Qi}var pi=this._pool,Oo=null,ar=null,Zs=null;if(Aa!=null){if(Aa.zero(),pi.sizeVec3==pi.stackVec3.length){for(var Ge=pi.sizeVec3<<1,hv=new Array(Ge),xs=hv,Gs=0,$n=pi.sizeVec3;Gs<$n;){var We=Gs++;xs[We]=pi.stackVec3[We],pi.stackVec3[We]=null}pi.stackVec3=xs}pi.stackVec3[pi.sizeVec3++]=Aa}if(Oo!=null){var Ti=1,Lo=0,Tr=0,en=0,ke=1,Y_=0,Ws=0,jn=0,Xn=1;if(Oo.e00=Ti,Oo.e01=Lo,Oo.e02=Tr,Oo.e10=en,Oo.e11=ke,Oo.e12=Y_,Oo.e20=Ws,Oo.e21=jn,Oo.e22=Xn,pi.sizeMat3==pi.stackMat3.length){for(var oe=pi.sizeMat3<<1,Bs=new Array(oe),ne=Bs,Ue=0,l_=pi.sizeMat3;Ue<l_;){var As=Ue++;ne[As]=pi.stackMat3[As],pi.stackMat3[As]=null}pi.stackMat3=ne}pi.stackMat3[pi.sizeMat3++]=Oo}if(ar!=null){var ds=1,qn=0,mi=0,uo=0,Zr=0,Ho=1,Yo=0,Hr=0,Eo=0,we=0,as=1,Oe=0,W_=0,ts=0,Nt=0,Kr=1;if(ar.e00=ds,ar.e01=qn,ar.e02=mi,ar.e03=uo,ar.e10=Zr,ar.e11=Ho,ar.e12=Yo,ar.e13=Hr,ar.e20=Eo,ar.e21=we,ar.e22=as,ar.e23=Oe,ar.e30=W_,ar.e31=ts,ar.e32=Nt,ar.e33=Kr,pi.sizeMat4==pi.stackMat4.length){for(var Do=pi.sizeMat4<<1,Xe=new Array(Do),kv=Xe,i0=0,U_=pi.sizeMat4;i0<U_;){var Ht=i0++;kv[Ht]=pi.stackMat4[Ht],pi.stackMat4[Ht]=null}pi.stackMat4=kv}pi.stackMat4[pi.sizeMat4++]=ar}if(Zs!=null){var Ln=0,Qr=0,Yn=0,Z_=1;if(Zs.x=Ln,Zs.y=Qr,Zs.z=Yn,Zs.w=Z_,pi.sizeQuat==pi.stackQuat.length){for(var He=pi.sizeQuat<<1,h_=new Array(He),bo=h_,se=0,ee=pi.sizeQuat;se<ee;){var us=se++;bo[us]=pi.stackQuat[us],pi.stackQuat[us]=null}pi.stackQuat=bo}pi.stackQuat[pi.sizeQuat++]=Zs}var Zi=this._pool,Ko=null,kr=null,Zo=null;if(Ea!=null){if(Ea.zero(),Zi.sizeVec3==Zi.stackVec3.length){for(var Us=Zi.sizeVec3<<1,cv=new Array(Us),zs=cv,Ke=0,wv=Zi.sizeVec3;Ke<wv;){var Os=Ke++;zs[Os]=Zi.stackVec3[Os],Zi.stackVec3[Os]=null}Zi.stackVec3=zs}Zi.stackVec3[Zi.sizeVec3++]=Ea}if(Ko!=null){var si=1,Zn=0,_n=0,vn=0,B_=1,bv=0,is=0,Ss=0,c_=1;if(Ko.e00=si,Ko.e01=Zn,Ko.e02=_n,Ko.e10=vn,Ko.e11=B_,Ko.e12=bv,Ko.e20=is,Ko.e21=Ss,Ko.e22=c_,Zi.sizeMat3==Zi.stackMat3.length){for(var O_=Zi.sizeMat3<<1,fv=new Array(O_),xv=fv,b_=0,Hs=Zi.sizeMat3;b_<Hs;){var zo=b_++;xv[zo]=Zi.stackMat3[zo],Zi.stackMat3[zo]=null}Zi.stackMat3=xv}Zi.stackMat3[Zi.sizeMat3++]=Ko}if(kr!=null){var _e=1,ve=0,Ui=0,Mo=0,_o=0,le=1,Le=0,Ye=0,Ze=0,A_=0,Ms=1,he=0,H_=0,$e=0,Un=0,ps=1;if(kr.e00=_e,kr.e01=ve,kr.e02=Ui,kr.e03=Mo,kr.e10=_o,kr.e11=le,kr.e12=Le,kr.e13=Ye,kr.e20=Ze,kr.e21=A_,kr.e22=Ms,kr.e23=he,kr.e30=H_,kr.e31=$e,kr.e32=Un,kr.e33=ps,Zi.sizeMat4==Zi.stackMat4.length){for(var Xv=Zi.sizeMat4<<1,d_=new Array(Xv),$o=d_,ln=0,po=Zi.sizeMat4;ln<po;){var Kt=ln++;$o[Kt]=Zi.stackMat4[Kt],Zi.stackMat4[Kt]=null}Zi.stackMat4=$o}Zi.stackMat4[Zi.sizeMat4++]=kr}if(Zo!=null){var $r=0,vo=0,je=0,Be=1;if(Zo.x=$r,Zo.y=vo,Zo.z=je,Zo.w=Be,Zi.sizeQuat==Zi.stackQuat.length){for(var qe=Zi.sizeQuat<<1,S_=new Array(qe),jo=S_,rs=0,K_=Zi.sizeQuat;rs<K_;){var uv=rs++;jo[uv]=Zi.stackQuat[uv],Zi.stackQuat[uv]=null}Zi.stackQuat=jo}Zi.stackQuat[Zi.sizeQuat++]=Zo}var Bi=this._pool,mo=null,Rr=null,io=null;if(da!=null){if(da.zero(),Bi.sizeVec3==Bi.stackVec3.length){for(var $_=Bi.sizeVec3<<1,j_=new Array($_),Lv=j_,a_=0,Yv=Bi.sizeVec3;a_<Yv;){var q_=a_++;Lv[q_]=Bi.stackVec3[q_],Bi.stackVec3[q_]=null}Bi.stackVec3=Lv}Bi.stackVec3[Bi.sizeVec3++]=da}if(mo!=null){var Ai=1,av=0,Ae=0,de=0,ce=1,be=0,Se=0,Zv=0,ms=1;if(mo.e00=Ai,mo.e01=av,mo.e02=Ae,mo.e10=de,mo.e11=ce,mo.e12=be,mo.e20=Se,mo.e21=Zv,mo.e22=ms,Bi.sizeMat3==Bi.stackMat3.length){for(var jr=Bi.sizeMat3<<1,t_=new Array(jr),yo=t_,i_=0,Fo=Bi.sizeMat3;i_<Fo;){var Pe=i_++;yo[Pe]=Bi.stackMat3[Pe],Bi.stackMat3[Pe]=null}Bi.stackMat3=yo}Bi.stackMat3[Bi.sizeMat3++]=mo}if(Rr!=null){var qo=1,ys=0,ei=0,an=0,_r=0,os=1,gs=0,Bo=0,Er=0,Bn=0,tv=1,r_=0,P_=0,iv=0,ns=0,An=1;if(Rr.e00=qo,Rr.e01=ys,Rr.e02=ei,Rr.e03=an,Rr.e10=_r,Rr.e11=os,Rr.e12=gs,Rr.e13=Bo,Rr.e20=Er,Rr.e21=Bn,Rr.e22=tv,Rr.e23=r_,Rr.e30=P_,Rr.e31=iv,Rr.e32=ns,Rr.e33=An,Bi.sizeMat4==Bi.stackMat4.length){for(var Is=Bi.sizeMat4<<1,E0=new Array(Is),M0=E0,hl=0,D0=Bi.sizeMat4;hl<D0;){var hr=hl++;M0[hr]=Bi.stackMat4[hr],Bi.stackMat4[hr]=null}Bi.stackMat4=M0}Bi.stackMat4[Bi.sizeMat4++]=Rr}if(io!=null){var On=0,go=0,fe=0,rv=1;if(io.x=On,io.y=go,io.z=fe,io.w=rv,Bi.sizeQuat==Bi.stackQuat.length){for(var zv=Bi.sizeQuat<<1,o_=new Array(zv),Bv=o_,Ce=0,f_=Bi.sizeQuat;Ce<f_;){var x_=Ce++;Bv[x_]=Bi.stackQuat[x_],Bi.stackQuat[x_]=null}Bi.stackQuat=Bv}Bi.stackQuat[Bi.sizeQuat++]=io}var di=this._pool,Te=null,lo=null,Ps=null;if(Te!=null){if(Te.zero(),di.sizeVec3==di.stackVec3.length){for(var Mv=di.sizeVec3<<1,Qe=new Array(Mv),u_=Qe,ov=0,r0=di.sizeVec3;ov<r0;){var o0=ov++;u_[o0]=di.stackVec3[o0],di.stackVec3[o0]=null}di.stackVec3=u_}di.stackVec3[di.sizeVec3++]=Te}if(Wa!=null){var nv=1,tr=0,Ks=0,dn=0,xe=1,F0=0,Dv=0,C_=0,p0=1;if(Wa.e00=nv,Wa.e01=tr,Wa.e02=Ks,Wa.e10=dn,Wa.e11=xe,Wa.e12=F0,Wa.e20=Dv,Wa.e21=C_,Wa.e22=p0,di.sizeMat3==di.stackMat3.length){for(var Av=di.sizeMat3<<1,n0=new Array(Av),m0=n0,N0=0,s0=di.sizeMat3;N0<s0;){var e0=N0++;m0[e0]=di.stackMat3[e0],di.stackMat3[e0]=null}di.stackMat3=m0}di.stackMat3[di.sizeMat3++]=Wa}if(lo!=null){var y0=1,Fv=0,cr=0,pv=0,hn=0,Nv=1,Hl=0,g0=0,I0=0,cl=0,Bl=1,Jv=0,Kl=0,$l=0,bl=0,Al=1;if(lo.e00=y0,lo.e01=Fv,lo.e02=cr,lo.e03=pv,lo.e10=hn,lo.e11=Nv,lo.e12=Hl,lo.e13=g0,lo.e20=I0,lo.e21=cl,lo.e22=Bl,lo.e23=Jv,lo.e30=Kl,lo.e31=$l,lo.e32=bl,lo.e33=Al,di.sizeMat4==di.stackMat4.length){for(var dl=di.sizeMat4<<1,jl=new Array(dl),fl=jl,ql=0,xl=di.sizeMat4;ql<xl;){var rr=ql++;fl[rr]=di.stackMat4[rr],di.stackMat4[rr]=null}di.stackMat4=fl}di.stackMat4[di.sizeMat4++]=lo}if(Ps!=null){var ue=0,tn=0,mv=0,yh=1;if(Ps.x=ue,Ps.y=tn,Ps.z=mv,Ps.w=yh,di.sizeQuat==di.stackQuat.length){for(var Gv=di.sizeQuat<<1,J0=new Array(Gv),ul=J0,V0=0,k0=di.sizeQuat;V0<k0;){var G0=V0++;ul[G0]=di.stackQuat[G0],di.stackQuat[G0]=null}di.stackQuat=ul}di.stackQuat[di.sizeQuat++]=Ps}var Mr=this._pool,ze=null,ss=null,_0=null;if(bt!=null){if(bt.zero(),Mr.sizeVec3==Mr.stackVec3.length){for(var Sl=Mr.sizeVec3<<1,lh=new Array(Sl),W0=lh,hh=0,U0=Mr.sizeVec3;hh<U0;){var Pl=hh++;W0[Pl]=Mr.stackVec3[Pl],Mr.stackVec3[Pl]=null}Mr.stackVec3=W0}Mr.stackVec3[Mr.sizeVec3++]=bt}if(ze!=null){var zl=1,Cs=0,w0=0,z_=0,Cl=1,O0=0,H0=0,Tl=0,Ml=1;if(ze.e00=zl,ze.e01=Cs,ze.e02=w0,ze.e10=z_,ze.e11=Cl,ze.e12=O0,ze.e20=H0,ze.e21=Tl,ze.e22=Ml,Mr.sizeMat3==Mr.stackMat3.length){for(var X0=Mr.sizeMat3<<1,v0=new Array(X0),M_=v0,Wv=0,Uv=Mr.sizeMat3;Wv<Uv;){var sv=Wv++;M_[sv]=Mr.stackMat3[sv],Mr.stackMat3[sv]=null}Mr.stackMat3=M_}Mr.stackMat3[Mr.sizeMat3++]=ze}if(ss!=null){var L0=1,dv=0,l0=0,es=0,h0=0,Y0=1,Re=0,K0=0,yi=0,cn=0,wr=1,Ov=0,c0=0,ch=0,ah=0,p_=1;if(ss.e00=L0,ss.e01=dv,ss.e02=l0,ss.e03=es,ss.e10=h0,ss.e11=Y0,ss.e12=Re,ss.e13=K0,ss.e20=yi,ss.e21=cn,ss.e22=wr,ss.e23=Ov,ss.e30=c0,ss.e31=ch,ss.e32=ah,ss.e33=p_,Mr.sizeMat4==Mr.stackMat4.length){for(var $s=Mr.sizeMat4<<1,Ee=new Array($s),th=Ee,bh=0,Ql=Mr.sizeMat4;bh<Ql;){var br=bh++;th[br]=Mr.stackMat4[br],Mr.stackMat4[br]=null}Mr.stackMat4=th}Mr.stackMat4[Mr.sizeMat4++]=ss}if(_0!=null){var n_=0,bn=0,yv=0,$0=1;if(_0.x=n_,_0.y=bn,_0.z=yv,_0.w=$0,Mr.sizeQuat==Mr.stackQuat.length){for(var gv=Mr.sizeQuat<<1,pl=new Array(gv),ml=pl,yl=0,T_=Mr.sizeQuat;yl<T_;){var Sv=yl++;ml[Sv]=Mr.stackQuat[Sv],Mr.stackQuat[Sv]=null}Mr.stackQuat=ml}Mr.stackQuat[Mr.sizeQuat++]=_0}break}}if(a.drawAabbs){var Sn=h._aabb,Iv=t.aabbColor,Pv=this._pool,Q_=Pv.sizeVec3==0?new u.common.Vec3:Pv.stackVec3[--Pv.sizeVec3],_s=this._pool,R_=_s.sizeVec3==0?new u.common.Vec3:_s.stackVec3[--_s.sizeVec3],Cv=Q_;Cv.x=Sn._minX,Cv.y=Sn._minY,Cv.z=Sn._minZ;var Hv=R_;Hv.x=Sn._maxX,Hv.y=Sn._maxY,Hv.z=Sn._maxZ,a.aabb(Q_,R_,Iv);var or=this._pool,m_=null,vs=null,Gi=null;if(Q_!=null){if(Q_.zero(),or.sizeVec3==or.stackVec3.length){for(var y_=or.sizeVec3<<1,Pn=new Array(y_),j0=Pn,b0=0,fh=or.sizeVec3;b0<fh;){var q0=b0++;j0[q0]=or.stackVec3[q0],or.stackVec3[q0]=null}or.stackVec3=j0}or.stackVec3[or.sizeVec3++]=Q_}if(m_!=null){var al=1,gl=0,Z0=0,xh=0,Il=1,gh=0,ih=0,Vl=0,B0=1;if(m_.e00=al,m_.e01=gl,m_.e02=Z0,m_.e10=xh,m_.e11=Il,m_.e12=gh,m_.e20=ih,m_.e21=Vl,m_.e22=B0,or.sizeMat3==or.stackMat3.length){for(var A0=or.sizeMat3<<1,kl=new Array(A0),rh=kl,Kv=0,Rl=or.sizeMat3;Kv<Rl;){var $v=Kv++;rh[$v]=or.stackMat3[$v],or.stackMat3[$v]=null}or.stackMat3=rh}or.stackMat3[or.sizeMat3++]=m_}if(vs!=null){var nr=1,g_=0,rn=0,wl=0,d0=0,oh=1,El=0,tl=0,Dl=0,S0=0,nh=1,sh=0,Fl=0,Nl=0,ev=0,Tv=1;if(vs.e00=nr,vs.e01=g_,vs.e02=rn,vs.e03=wl,vs.e10=d0,vs.e11=oh,vs.e12=El,vs.e13=tl,vs.e20=Dl,vs.e21=S0,vs.e22=nh,vs.e23=sh,vs.e30=Fl,vs.e31=Nl,vs.e32=ev,vs.e33=Tv,or.sizeMat4==or.stackMat4.length){for(var jv=or.sizeMat4<<1,De=new Array(jv),uh=De,f0=0,Xl=or.sizeMat4;f0<Xl;){var Qv=f0++;uh[Qv]=or.stackMat4[Qv],or.stackMat4[Qv]=null}or.stackMat4=uh}or.stackMat4[or.sizeMat4++]=vs}if(Gi!=null){var qv=0,Rv=0,x0=0,Zh=1;if(Gi.x=qv,Gi.y=Rv,Gi.z=x0,Gi.w=Zh,or.sizeQuat==or.stackQuat.length){for(var P0=or.sizeQuat<<1,a0=new Array(P0),Jl=a0,Gl=0,zh=or.sizeQuat;Gl<zh;){var Ev=Gl++;Jl[Ev]=or.stackQuat[Ev],or.stackQuat[Ev]=null}or.stackQuat=Jl}or.stackQuat[or.sizeQuat++]=Gi}var ur=this._pool,Vs=null,ls=null,C0=null;if(R_!=null){if(R_.zero(),ur.sizeVec3==ur.stackVec3.length){for(var Wl=ur.sizeVec3<<1,Fe=new Array(Wl),u0=Fe,Ll=0,Ul=ur.sizeVec3;Ll<Ul;){var Ol=Ll++;u0[Ol]=ur.stackVec3[Ol],ur.stackVec3[Ol]=null}ur.stackVec3=u0}ur.stackVec3[ur.sizeVec3++]=R_}if(Vs!=null){var Ih=1,_v=0,vv=0,T0=0,I_=1,Yl=0,Vh=0,Bh=0,t0=1;if(Vs.e00=Ih,Vs.e01=_v,Vs.e02=vv,Vs.e10=T0,Vs.e11=I_,Vs.e12=Yl,Vs.e20=Vh,Vs.e21=Bh,Vs.e22=t0,ur.sizeMat3==ur.stackMat3.length){for(var lv=ur.sizeMat3<<1,kh=new Array(lv),Zl=kh,wh=0,Kh=ur.sizeMat3;wh<Kh;){var eh=wh++;Zl[eh]=ur.stackMat3[eh],ur.stackMat3[eh]=null}ur.stackMat3=Zl}ur.stackMat3[ur.sizeMat3++]=Vs}if(ls!=null){var Ei=1,s_=0,V_=0,_h=0,Ah=0,dh=1,Mh=0,Vv=0,Qh=0,Rh=0,$h=1,jh=0,ph=0,Sh=0,il=0,ic=1;if(ls.e00=Ei,ls.e01=s_,ls.e02=V_,ls.e03=_h,ls.e10=Ah,ls.e11=dh,ls.e12=Mh,ls.e13=Vv,ls.e20=Qh,ls.e21=Rh,ls.e22=$h,ls.e23=jh,ls.e30=ph,ls.e31=Sh,ls.e32=il,ls.e33=ic,ur.sizeMat4==ur.stackMat4.length){for(var Xh=ur.sizeMat4<<1,E_=new Array(Xh),Eh=E_,mh=0,qh=ur.sizeMat4;mh<qh;){var Lh=mh++;Eh[Lh]=ur.stackMat4[Lh],ur.stackMat4[Lh]=null}ur.stackMat4=Eh}ur.stackMat4[ur.sizeMat4++]=ls}if(C0!=null){var ac=0,Ph=0,Q0=0,rc=1;if(C0.x=ac,C0.y=Ph,C0.z=Q0,C0.w=rc,ur.sizeQuat==ur.stackQuat.length){for(var vh=ur.sizeQuat<<1,Yh=new Array(vh),Dh=Yh,Ch=0,R0=ur.sizeQuat;Ch<R0;){var z0=Ch++;Dh[z0]=ur.stackQuat[z0],ur.stackQuat[z0]=null}ur.stackQuat=Dh}ur.stackQuat[ur.sizeQuat++]=C0}}h=v}i=o}}_drawConstraints(a){var t=a.style;if(a.drawPairs||a.drawContacts)for(var i=this._contactManager._contactList;i!=null;){var o=i._next;if(a.drawPairs){var r=t.pairColor,e=this._pool,_=e.sizeVec3==0?new u.common.Vec3:e.stackVec3[--e.sizeVec3],h=this._pool,v=h.sizeVec3==0?new u.common.Vec3:h.stackVec3[--h.sizeVec3],s=_;s.x=i._s1._transform._positionX,s.y=i._s1._transform._positionY,s.z=i._s1._transform._positionZ;var l=v;l.x=i._s2._transform._positionX,l.y=i._s2._transform._positionY,l.z=i._s2._transform._positionZ,a.line(_,v,r);var x=this._pool,b=null,f=null,n=null;if(_!=null){if(_.zero(),x.sizeVec3==x.stackVec3.length){for(var c=x.sizeVec3<<1,z=new Array(c),p=z,y=0,V=x.sizeVec3;y<V;){var M=y++;p[M]=x.stackVec3[M],x.stackVec3[M]=null}x.stackVec3=p}x.stackVec3[x.sizeVec3++]=_}if(b!=null){var I=1,k=0,X=0,L=0,m=1,g=0,N=0,d=0,F=1;if(b.e00=I,b.e01=k,b.e02=X,b.e10=L,b.e11=m,b.e12=g,b.e20=N,b.e21=d,b.e22=F,x.sizeMat3==x.stackMat3.length){for(var S=x.sizeMat3<<1,Y=new Array(S),Q=Y,C=0,B=x.sizeMat3;C<B;){var Z=C++;Q[Z]=x.stackMat3[Z],x.stackMat3[Z]=null}x.stackMat3=Q}x.stackMat3[x.sizeMat3++]=b}if(f!=null){var $=1,K=0,E=0,J=0,A=0,R=1,U=0,G=0,D=0,H=0,j=1,ia=0,ea=0,W=0,q=0,na=1;if(f.e00=$,f.e01=K,f.e02=E,f.e03=J,f.e10=A,f.e11=R,f.e12=U,f.e13=G,f.e20=D,f.e21=H,f.e22=j,f.e23=ia,f.e30=ea,f.e31=W,f.e32=q,f.e33=na,x.sizeMat4==x.stackMat4.length){for(var oa=x.sizeMat4<<1,aa=new Array(oa),T=aa,ca=0,_a=x.sizeMat4;ca<_a;){var w=ca++;T[w]=x.stackMat4[w],x.stackMat4[w]=null}x.stackMat4=T}x.stackMat4[x.sizeMat4++]=f}if(n!=null){var ta=0,ra=0,la=0,va=1;if(n.x=ta,n.y=ra,n.z=la,n.w=va,x.sizeQuat==x.stackQuat.length){for(var ua=x.sizeQuat<<1,za=new Array(ua),Ma=za,Xa=0,Za=x.sizeQuat;Xa<Za;){var fa=Xa++;Ma[fa]=x.stackQuat[fa],x.stackQuat[fa]=null}x.stackQuat=Ma}x.stackQuat[x.sizeQuat++]=n}var ba=this._pool,sa=null,ha=null,ma=null;if(v!=null){if(v.zero(),ba.sizeVec3==ba.stackVec3.length){for(var ya=ba.sizeVec3<<1,Ba=new Array(ya),pa=Ba,Ya=0,Ra=ba.sizeVec3;Ya<Ra;){var ga=Ya++;pa[ga]=ba.stackVec3[ga],ba.stackVec3[ga]=null}ba.stackVec3=pa}ba.stackVec3[ba.sizeVec3++]=v}if(sa!=null){var xa=1,wa=0,ka=0,Pa=0,zt=1,Oa=0,Aa=0,nt=0,Ea=1;if(sa.e00=xa,sa.e01=wa,sa.e02=ka,sa.e10=Pa,sa.e11=zt,sa.e12=Oa,sa.e20=Aa,sa.e21=nt,sa.e22=Ea,ba.sizeMat3==ba.stackMat3.length){for(var Fa=ba.sizeMat3<<1,da=new Array(Fa),ft=da,Wa=0,Ha=ba.sizeMat3;Wa<Ha;){var bt=Wa++;ft[bt]=ba.stackMat3[bt],ba.stackMat3[bt]=null}ba.stackMat3=ft}ba.stackMat3[ba.sizeMat3++]=sa}if(ha!=null){var it=1,Ka=0,_t=0,gt=0,pt=0,Ga=1,rt=0,xt=0,Da=0,Ta=0,Na=1,Vt=0,Pt=0,st=0,Xt=0,Yt=1;if(ha.e00=it,ha.e01=Ka,ha.e02=_t,ha.e03=gt,ha.e10=pt,ha.e11=Ga,ha.e12=rt,ha.e13=xt,ha.e20=Da,ha.e21=Ta,ha.e22=Na,ha.e23=Vt,ha.e30=Pt,ha.e31=st,ha.e32=Xt,ha.e33=Yt,ba.sizeMat4==ba.stackMat4.length){for(var Mt=ba.sizeMat4<<1,Ia=new Array(Mt),O=Ia,Va=0,lt=ba.sizeMat4;Va<lt;){var P=Va++;O[P]=ba.stackMat4[P],ba.stackMat4[P]=null}ba.stackMat4=O}ba.stackMat4[ba.sizeMat4++]=ha}if(ma!=null){var wt=0,At=0,dt=0,yt=1;if(ma.x=wt,ma.y=At,ma.z=dt,ma.w=yt,ba.sizeQuat==ba.stackQuat.length){for(var kt=ba.sizeQuat<<1,mt=new Array(kt),ht=mt,ut=0,Qa=ba.sizeQuat;ut<Qa;){var et=ut++;ht[et]=ba.stackQuat[et],ba.stackQuat[et]=null}ba.stackQuat=ht}ba.stackQuat[ba.sizeQuat++]=ma}}if(a.drawContacts)for(var Ca=i._contactConstraint,vt=i._contactConstraint._manifold._points,qa=0,at=i._contactConstraint._manifold._numPoints;qa<at;){var Ua=qa++,tt=vt[Ua],ct=a.style;Ca._s1._transform,Ca._s2._transform;var Sa=this._pool,Ja=Sa.sizeVec3==0?new u.common.Vec3:Sa.stackVec3[--Sa.sizeVec3],ja=this._pool,La=ja.sizeVec3==0?new u.common.Vec3:ja.stackVec3[--ja.sizeVec3],ot=this._pool,It=ot.sizeVec3==0?new u.common.Vec3:ot.stackVec3[--ot.sizeVec3],oi=this._pool,gi=oi.sizeVec3==0?new u.common.Vec3:oi.stackVec3[--oi.sizeVec3],ai=this._pool,Ct=ai.sizeVec3==0?new u.common.Vec3:ai.stackVec3[--ai.sizeVec3],_i=Ja;_i.x=tt._pos1X,_i.y=tt._pos1Y,_i.z=tt._pos1Z;var Et=La;Et.x=tt._pos2X,Et.y=tt._pos2Y,Et.z=tt._pos2Z;var St=It;St.x=Ca._manifold._normalX,St.y=Ca._manifold._normalY,St.z=Ca._manifold._normalZ;var Jt=gi;Jt.x=Ca._manifold._tangentX,Jt.y=Ca._manifold._tangentY,Jt.z=Ca._manifold._tangentZ;var Ki=Ct;if(Ki.x=Ca._manifold._binormalX,Ki.y=Ca._manifold._binormalY,Ki.z=Ca._manifold._binormalZ,tt._disabled)a.point(Ja,ct.disabledContactColor),a.point(La,ct.disabledContactColor),a.line(Ja,La,ct.disabledContactColor);else if(tt._warmStarted){var vi;switch(tt._id&3){case 0:vi=ct.contactColor;break;case 1:vi=ct.contactColor2;break;case 2:vi=ct.contactColor3;break;default:vi=ct.contactColor4}a.point(Ja,vi),a.point(La,vi),a.line(Ja,La,ct.contactColor)}else a.point(Ja,ct.newContactColor),a.point(La,ct.newContactColor),a.line(Ja,La,ct.newContactColor);La.x=Ja.x,La.y=Ja.y,La.z=Ja.z;var li=La,ti=ct.contactNormalLength,Oi=li.x+It.x*ti,Xi=li.y+It.y*ti,zi=li.z+It.z*ti;if(li.x=Oi,li.y=Xi,li.z=zi,a.line(Ja,La,ct.contactNormalColor),a.drawContactBases){La.x=Ja.x,La.y=Ja.y,La.z=Ja.z;var Zt=La,ri=ct.contactTangentLength,Wt=Zt.x+gi.x*ri,ni=Zt.y+gi.y*ri,$i=Zt.z+gi.z*ri;Zt.x=Wt,Zt.y=ni,Zt.z=$i,a.line(Ja,La,ct.contactTangentColor),La.x=Ja.x,La.y=Ja.y,La.z=Ja.z;var Ut=La,ji=ct.contactBinormalLength,Ii=Ut.x+Ct.x*ji,pr=Ut.y+Ct.y*ji,Wi=Ut.z+Ct.z*ji;Ut.x=Ii,Ut.y=pr,Ut.z=Wi,a.line(Ja,La,ct.contactBinormalColor)}var Lt=this._pool,jt=null,Tt=null,bi=null;if(Ja!=null){if(Ja.zero(),Lt.sizeVec3==Lt.stackVec3.length){for(var Mi=Lt.sizeVec3<<1,vr=new Array(Mi),qt=vr,fi=0,Bt=Lt.sizeVec3;fi<Bt;){var xi=fi++;qt[xi]=Lt.stackVec3[xi],Lt.stackVec3[xi]=null}Lt.stackVec3=qt}Lt.stackVec3[Lt.sizeVec3++]=Ja}if(jt!=null){var hi=1,sr=0,Xr=0,ro=0,Gt=1,fr=0,mr=0,Dt=0,Br=1;if(jt.e00=hi,jt.e01=sr,jt.e02=Xr,jt.e10=ro,jt.e11=Gt,jt.e12=fr,jt.e20=mr,jt.e21=Dt,jt.e22=Br,Lt.sizeMat3==Lt.stackMat3.length){for(var Si=Lt.sizeMat3<<1,Dr=new Array(Si),Hn=Dr,oo=0,Ar=Lt.sizeMat3;oo<Ar;){var no=oo++;Hn[no]=Lt.stackMat3[no],Lt.stackMat3[no]=null}Lt.stackMat3=Hn}Lt.stackMat3[Lt.sizeMat3++]=jt}if(Tt!=null){var yn=1,Ao=0,Io=0,ui=0,qr=0,dr=1,yr=0,So=0,Di=0,Sr=0,gr=1,Qt=0,Hi=0,Li=0,Cn=0,Me=1;if(Tt.e00=yn,Tt.e01=Ao,Tt.e02=Io,Tt.e03=ui,Tt.e10=qr,Tt.e11=dr,Tt.e12=yr,Tt.e13=So,Tt.e20=Di,Tt.e21=Sr,Tt.e22=gr,Tt.e23=Qt,Tt.e30=Hi,Tt.e31=Li,Tt.e32=Cn,Tt.e33=Me,Lt.sizeMat4==Lt.stackMat4.length){for(var js=Lt.sizeMat4<<1,pe=new Array(js),Ts=pe,qs=0,D_=Lt.sizeMat4;qs<D_;){var gn=qs++;Ts[gn]=Lt.stackMat4[gn],Lt.stackMat4[gn]=null}Lt.stackMat4=Ts}Lt.stackMat4[Lt.sizeMat4++]=Tt}if(bi!=null){var Pi=0,No=0,Wr=0,ks=1;if(bi.x=Pi,bi.y=No,bi.z=Wr,bi.w=ks,Lt.sizeQuat==Lt.stackQuat.length){for(var on=Lt.sizeQuat<<1,Tn=new Array(on),Kn=Tn,ws=0,k_=Lt.sizeQuat;ws<k_;){var Qs=ws++;Kn[Qs]=Lt.stackQuat[Qs],Lt.stackQuat[Qs]=null}Lt.stackQuat=Kn}Lt.stackQuat[Lt.sizeQuat++]=bi}var Vi=this._pool,Ir=null,xr=null,so=null;if(La!=null){if(La.zero(),Vi.sizeVec3==Vi.stackVec3.length){for(var Qn=Vi.sizeVec3<<1,me=new Array(Qn),nn=me,Rn=0,ci=Vi.sizeVec3;Rn<ci;){var ho=Rn++;nn[ho]=Vi.stackVec3[ho],Vi.stackVec3[ho]=null}Vi.stackVec3=nn}Vi.stackVec3[Vi.sizeVec3++]=La}if(Ir!=null){var Fr=1,En=0,ae=0,Rs=0,Es=1,Ds=0,hs=0,ii=0,ir=1;if(Ir.e00=Fr,Ir.e01=En,Ir.e02=ae,Ir.e10=Rs,Ir.e11=Es,Ir.e12=Ds,Ir.e20=hs,Ir.e21=ii,Ir.e22=ir,Vi.sizeMat3==Vi.stackMat3.length){for(var Ri=Vi.sizeMat3<<1,Fi=new Array(Ri),fo=Fi,Po=0,e_=Vi.sizeMat3;Po<e_;){var Fs=Po++;fo[Fs]=Vi.stackMat3[Fs],Vi.stackMat3[Fs]=null}Vi.stackMat3=fo}Vi.stackMat3[Vi.sizeMat3++]=Ir}if(xr!=null){var te=1,Dn=0,co=0,Ft=0,Ni=0,lr=1,Vo=0,cs=0,Xs=0,Ls=0,xo=1,$t=0,Vr=0,er=0,Jo=0,Ne=1;if(xr.e00=te,xr.e01=Dn,xr.e02=co,xr.e03=Ft,xr.e10=Ni,xr.e11=lr,xr.e12=Vo,xr.e13=cs,xr.e20=Xs,xr.e21=Ls,xr.e22=xo,xr.e23=$t,xr.e30=Vr,xr.e31=er,xr.e32=Jo,xr.e33=Ne,Vi.sizeMat4==Vi.stackMat4.length){for(var Co=Vi.sizeMat4<<1,ko=new Array(Co),Nr=ko,Pr=0,Cr=Vi.sizeMat4;Pr<Cr;){var Lr=Pr++;Nr[Lr]=Vi.stackMat4[Lr],Vi.stackMat4[Lr]=null}Vi.stackMat4=Nr}Vi.stackMat4[Vi.sizeMat4++]=xr}if(so!=null){var Rt=0,Ji=0,Yi=0,Qi=1;if(so.x=Rt,so.y=Ji,so.z=Yi,so.w=Qi,Vi.sizeQuat==Vi.stackQuat.length){for(var zr=Vi.sizeQuat<<1,qi=new Array(zr),Jr=qi,Gr=0,ao=Vi.sizeQuat;Gr<ao;){var bs=Gr++;Jr[bs]=Vi.stackQuat[bs],Vi.stackQuat[bs]=null}Vi.stackQuat=Jr}Vi.stackQuat[Vi.sizeQuat++]=so}var ki=this._pool,sn=null,Yr=null,Go=null;if(It!=null){if(It.zero(),ki.sizeVec3==ki.stackVec3.length){for(var ye=ki.sizeVec3<<1,In=new Array(ye),ge=In,Vn=0,Ci=ki.sizeVec3;Vn<Ci;){var To=Vn++;ge[To]=ki.stackVec3[To],ki.stackVec3[To]=null}ki.stackVec3=ge}ki.stackVec3[ki.sizeVec3++]=It}if(sn!=null){var eo=1,Fn=0,Ns=0,Nn=0,Wo=1,kn=0,Ys=0,Ot=0,Qo=1;if(sn.e00=eo,sn.e01=Fn,sn.e02=Ns,sn.e10=Nn,sn.e11=Wo,sn.e12=kn,sn.e20=Ys,sn.e21=Ot,sn.e22=Qo,ki.sizeMat3==ki.stackMat3.length){for(var Ur=ki.sizeMat3<<1,wn=new Array(Ur),Jn=wn,fs=0,Ie=ki.sizeMat3;fs<Ie;){var Uo=fs++;Jn[Uo]=ki.stackMat3[Uo],ki.stackMat3[Uo]=null}ki.stackMat3=Jn}ki.stackMat3[ki.sizeMat3++]=sn}if(Yr!=null){var Ve=1,w_=0,Je=0,X_=0,Js=0,F_=1,N_=0,Or=0,wo=0,Xo=0,Gn=1,wi=0,Wn=0,Ro=0,to=0,J_=1;if(Yr.e00=Ve,Yr.e01=w_,Yr.e02=Je,Yr.e03=X_,Yr.e10=Js,Yr.e11=F_,Yr.e12=N_,Yr.e13=Or,Yr.e20=wo,Yr.e21=Xo,Yr.e22=Gn,Yr.e23=wi,Yr.e30=Wn,Yr.e31=Ro,Yr.e32=to,Yr.e33=J_,ki.sizeMat4==ki.stackMat4.length){for(var G_=ki.sizeMat4<<1,L_=new Array(G_),ie=L_,__=0,v_=ki.sizeMat4;__<v_;){var re=__++;ie[re]=ki.stackMat4[re],ki.stackMat4[re]=null}ki.stackMat4=ie}ki.stackMat4[ki.sizeMat4++]=Yr}if(Go!=null){var pi=0,Oo=0,ar=0,Zs=1;if(Go.x=pi,Go.y=Oo,Go.z=ar,Go.w=Zs,ki.sizeQuat==ki.stackQuat.length){for(var Ge=ki.sizeQuat<<1,hv=new Array(Ge),xs=hv,Gs=0,$n=ki.sizeQuat;Gs<$n;){var We=Gs++;xs[We]=ki.stackQuat[We],ki.stackQuat[We]=null}ki.stackQuat=xs}ki.stackQuat[ki.sizeQuat++]=Go}var Ti=this._pool,Lo=null,Tr=null,en=null;if(gi!=null){if(gi.zero(),Ti.sizeVec3==Ti.stackVec3.length){for(var ke=Ti.sizeVec3<<1,Y_=new Array(ke),Ws=Y_,jn=0,Xn=Ti.sizeVec3;jn<Xn;){var oe=jn++;Ws[oe]=Ti.stackVec3[oe],Ti.stackVec3[oe]=null}Ti.stackVec3=Ws}Ti.stackVec3[Ti.sizeVec3++]=gi}if(Lo!=null){var Bs=1,ne=0,Ue=0,l_=0,As=1,ds=0,qn=0,mi=0,uo=1;if(Lo.e00=Bs,Lo.e01=ne,Lo.e02=Ue,Lo.e10=l_,Lo.e11=As,Lo.e12=ds,Lo.e20=qn,Lo.e21=mi,Lo.e22=uo,Ti.sizeMat3==Ti.stackMat3.length){for(var Zr=Ti.sizeMat3<<1,Ho=new Array(Zr),Yo=Ho,Hr=0,Eo=Ti.sizeMat3;Hr<Eo;){var we=Hr++;Yo[we]=Ti.stackMat3[we],Ti.stackMat3[we]=null}Ti.stackMat3=Yo}Ti.stackMat3[Ti.sizeMat3++]=Lo}if(Tr!=null){var as=1,Oe=0,W_=0,ts=0,Nt=0,Kr=1,Do=0,Xe=0,kv=0,i0=0,U_=1,Ht=0,Ln=0,Qr=0,Yn=0,Z_=1;if(Tr.e00=as,Tr.e01=Oe,Tr.e02=W_,Tr.e03=ts,Tr.e10=Nt,Tr.e11=Kr,Tr.e12=Do,Tr.e13=Xe,Tr.e20=kv,Tr.e21=i0,Tr.e22=U_,Tr.e23=Ht,Tr.e30=Ln,Tr.e31=Qr,Tr.e32=Yn,Tr.e33=Z_,Ti.sizeMat4==Ti.stackMat4.length){for(var He=Ti.sizeMat4<<1,h_=new Array(He),bo=h_,se=0,ee=Ti.sizeMat4;se<ee;){var us=se++;bo[us]=Ti.stackMat4[us],Ti.stackMat4[us]=null}Ti.stackMat4=bo}Ti.stackMat4[Ti.sizeMat4++]=Tr}if(en!=null){var Zi=0,Ko=0,kr=0,Zo=1;if(en.x=Zi,en.y=Ko,en.z=kr,en.w=Zo,Ti.sizeQuat==Ti.stackQuat.length){for(var Us=Ti.sizeQuat<<1,cv=new Array(Us),zs=cv,Ke=0,wv=Ti.sizeQuat;Ke<wv;){var Os=Ke++;zs[Os]=Ti.stackQuat[Os],Ti.stackQuat[Os]=null}Ti.stackQuat=zs}Ti.stackQuat[Ti.sizeQuat++]=en}var si=this._pool,Zn=null,_n=null,vn=null;if(Ct!=null){if(Ct.zero(),si.sizeVec3==si.stackVec3.length){for(var B_=si.sizeVec3<<1,bv=new Array(B_),is=bv,Ss=0,c_=si.sizeVec3;Ss<c_;){var O_=Ss++;is[O_]=si.stackVec3[O_],si.stackVec3[O_]=null}si.stackVec3=is}si.stackVec3[si.sizeVec3++]=Ct}if(Zn!=null){var fv=1,xv=0,b_=0,Hs=0,zo=1,_e=0,ve=0,Ui=0,Mo=1;if(Zn.e00=fv,Zn.e01=xv,Zn.e02=b_,Zn.e10=Hs,Zn.e11=zo,Zn.e12=_e,Zn.e20=ve,Zn.e21=Ui,Zn.e22=Mo,si.sizeMat3==si.stackMat3.length){for(var _o=si.sizeMat3<<1,le=new Array(_o),Le=le,Ye=0,Ze=si.sizeMat3;Ye<Ze;){var A_=Ye++;Le[A_]=si.stackMat3[A_],si.stackMat3[A_]=null}si.stackMat3=Le}si.stackMat3[si.sizeMat3++]=Zn}if(_n!=null){var Ms=1,he=0,H_=0,$e=0,Un=0,ps=1,Xv=0,d_=0,$o=0,ln=0,po=1,Kt=0,$r=0,vo=0,je=0,Be=1;if(_n.e00=Ms,_n.e01=he,_n.e02=H_,_n.e03=$e,_n.e10=Un,_n.e11=ps,_n.e12=Xv,_n.e13=d_,_n.e20=$o,_n.e21=ln,_n.e22=po,_n.e23=Kt,_n.e30=$r,_n.e31=vo,_n.e32=je,_n.e33=Be,si.sizeMat4==si.stackMat4.length){for(var qe=si.sizeMat4<<1,S_=new Array(qe),jo=S_,rs=0,K_=si.sizeMat4;rs<K_;){var uv=rs++;jo[uv]=si.stackMat4[uv],si.stackMat4[uv]=null}si.stackMat4=jo}si.stackMat4[si.sizeMat4++]=_n}if(vn!=null){var Bi=0,mo=0,Rr=0,io=1;if(vn.x=Bi,vn.y=mo,vn.z=Rr,vn.w=io,si.sizeQuat==si.stackQuat.length){for(var $_=si.sizeQuat<<1,j_=new Array($_),Lv=j_,a_=0,Yv=si.sizeQuat;a_<Yv;){var q_=a_++;Lv[q_]=si.stackQuat[q_],si.stackQuat[q_]=null}si.stackQuat=Lv}si.stackQuat[si.sizeQuat++]=vn}}i=o}if(a.drawJoints)for(var Ai=this._jointList;Ai!=null;){var av=Ai._next,Ae=this._pool,de=Ae.sizeVec3==0?new u.common.Vec3:Ae.stackVec3[--Ae.sizeVec3],ce=this._pool,be=ce.sizeVec3==0?new u.common.Vec3:ce.stackVec3[--ce.sizeVec3],Se=de;Se.x=Ai._b1._transform._positionX,Se.y=Ai._b1._transform._positionY,Se.z=Ai._b1._transform._positionZ;var Zv=be;Zv.x=Ai._b2._transform._positionX,Zv.y=Ai._b2._transform._positionY,Zv.z=Ai._b2._transform._positionZ;var ms=this._pool,jr=ms.sizeVec3==0?new u.common.Vec3:ms.stackVec3[--ms.sizeVec3],t_=this._pool,yo=t_.sizeVec3==0?new u.common.Vec3:t_.stackVec3[--t_.sizeVec3],i_=this._pool,Fo=i_.sizeVec3==0?new u.common.Vec3:i_.stackVec3[--i_.sizeVec3],Pe=this._pool,qo=Pe.sizeVec3==0?new u.common.Vec3:Pe.stackVec3[--Pe.sizeVec3],ys=this._pool,ei=ys.sizeVec3==0?new u.common.Vec3:ys.stackVec3[--ys.sizeVec3],an=this._pool,_r=an.sizeVec3==0?new u.common.Vec3:an.stackVec3[--an.sizeVec3],os=this._pool,gs=os.sizeVec3==0?new u.common.Vec3:os.stackVec3[--os.sizeVec3],Bo=this._pool,Er=Bo.sizeVec3==0?new u.common.Vec3:Bo.stackVec3[--Bo.sizeVec3],Bn=jr;Bn.x=Ai._anchor1X,Bn.y=Ai._anchor1Y,Bn.z=Ai._anchor1Z;var tv=yo;tv.x=Ai._anchor2X,tv.y=Ai._anchor2Y,tv.z=Ai._anchor2Z;var r_=Fo;r_.x=Ai._basisX1X,r_.y=Ai._basisX1Y,r_.z=Ai._basisX1Z;var P_=qo;P_.x=Ai._basisY1X,P_.y=Ai._basisY1Y,P_.z=Ai._basisY1Z;var iv=ei;iv.x=Ai._basisZ1X,iv.y=Ai._basisZ1Y,iv.z=Ai._basisZ1Z;var ns=_r;ns.x=Ai._basisX2X,ns.y=Ai._basisX2Y,ns.z=Ai._basisX2Z;var An=gs;An.x=Ai._basisY2X,An.y=Ai._basisY2Y,An.z=Ai._basisY2Z;var Is=Er;if(Is.x=Ai._basisZ2X,Is.y=Ai._basisZ2Y,Is.z=Ai._basisZ2Z,a.line(de,jr,a.style.jointLineColor),a.line(be,yo,a.style.jointLineColor),a.drawJointLimits)switch(Ai._type){case 0:break;case 1:var E0=a.style.jointRotationalConstraintRadius,M0=a.style.jointLineColor,hl=Ai._lm;this._drawRotationalLimit(a,jr,qo,ei,gs,E0,hl.lowerLimit,hl.upperLimit,M0);break;case 2:var D0=Ai,hr=a.style.jointRotationalConstraintRadius,On=a.style.jointLineColor,go=D0._rotLm,fe=D0._translLm;this._drawRotationalLimit(a,yo,qo,ei,gs,hr,go.lowerLimit,go.upperLimit,On),this._drawTranslationalLimit(a,jr,Fo,fe.lowerLimit,fe.upperLimit,On);break;case 3:a.style.jointRotationalConstraintRadius;var rv=a.style.jointLineColor,zv=Ai._lm;this._drawTranslationalLimit(a,jr,Fo,zv.lowerLimit,zv.upperLimit,rv);break;case 4:var o_=Ai,Bv=a.style.jointRotationalConstraintRadius,Ce=a.style.jointLineColor,f_=o_._lm1,x_=o_._lm2;this._drawRotationalLimit(a,jr,qo,ei,qo,Bv,o_._angleX-f_.upperLimit,o_._angleX-f_.lowerLimit,Ce),this._drawRotationalLimit(a,yo,_r,gs,_r,Bv,x_.lowerLimit-o_._angleZ,x_.upperLimit-o_._angleZ,Ce);break;case 5:var di=Ai,Te=a.style.jointRotationalConstraintRadius,lo=a.style.jointLineColor,Ps=di._twistLm;this._drawRotationalLimit(a,yo,gs,Er,gs,Te,Ps.lowerLimit-di._twistAngle,Ps.upperLimit-di._twistAngle,lo),this._drawEllipseOnSphere(a,jr,Fo,qo,ei,di._maxSwingAngle1,di._maxSwingAngle2,Te,lo);var Mv=this._pool,Qe=Mv.sizeVec3==0?new u.common.Vec3:Mv.stackVec3[--Mv.sizeVec3];Qe.x=yo.x,Qe.y=yo.y,Qe.z=yo.z;var u_=Qe,ov=u_.x+_r.x*Te,r0=u_.y+_r.y*Te,o0=u_.z+_r.z*Te;u_.x=ov,u_.y=r0,u_.z=o0;var nv=u_;a.line(yo,nv,lo);var tr=this._pool,Ks=null,dn=null,xe=null;if(nv!=null){if(nv.zero(),tr.sizeVec3==tr.stackVec3.length){for(var F0=tr.sizeVec3<<1,Dv=new Array(F0),C_=Dv,p0=0,Av=tr.sizeVec3;p0<Av;){var n0=p0++;C_[n0]=tr.stackVec3[n0],tr.stackVec3[n0]=null}tr.stackVec3=C_}tr.stackVec3[tr.sizeVec3++]=nv}if(Ks!=null){var m0=1,N0=0,s0=0,e0=0,y0=1,Fv=0,cr=0,pv=0,hn=1;if(Ks.e00=m0,Ks.e01=N0,Ks.e02=s0,Ks.e10=e0,Ks.e11=y0,Ks.e12=Fv,Ks.e20=cr,Ks.e21=pv,Ks.e22=hn,tr.sizeMat3==tr.stackMat3.length){for(var Nv=tr.sizeMat3<<1,Hl=new Array(Nv),g0=Hl,I0=0,cl=tr.sizeMat3;I0<cl;){var Bl=I0++;g0[Bl]=tr.stackMat3[Bl],tr.stackMat3[Bl]=null}tr.stackMat3=g0}tr.stackMat3[tr.sizeMat3++]=Ks}if(dn!=null){var Jv=1,Kl=0,$l=0,bl=0,Al=0,dl=1,jl=0,fl=0,ql=0,xl=0,rr=1,ue=0,tn=0,mv=0,yh=0,Gv=1;if(dn.e00=Jv,dn.e01=Kl,dn.e02=$l,dn.e03=bl,dn.e10=Al,dn.e11=dl,dn.e12=jl,dn.e13=fl,dn.e20=ql,dn.e21=xl,dn.e22=rr,dn.e23=ue,dn.e30=tn,dn.e31=mv,dn.e32=yh,dn.e33=Gv,tr.sizeMat4==tr.stackMat4.length){for(var J0=tr.sizeMat4<<1,ul=new Array(J0),V0=ul,k0=0,G0=tr.sizeMat4;k0<G0;){var Mr=k0++;V0[Mr]=tr.stackMat4[Mr],tr.stackMat4[Mr]=null}tr.stackMat4=V0}tr.stackMat4[tr.sizeMat4++]=dn}if(xe!=null){var ze=0,ss=0,_0=0,Sl=1;if(xe.x=ze,xe.y=ss,xe.z=_0,xe.w=Sl,tr.sizeQuat==tr.stackQuat.length){for(var lh=tr.sizeQuat<<1,W0=new Array(lh),hh=W0,U0=0,Pl=tr.sizeQuat;U0<Pl;){var zl=U0++;hh[zl]=tr.stackQuat[zl],tr.stackQuat[zl]=null}tr.stackQuat=hh}tr.stackQuat[tr.sizeQuat++]=xe}break;case 6:var Cs=Ai,w0=a.style.jointRotationalConstraintRadius,z_=a.style.jointLineColor,Cl=Cs._translLms[0],O0=Cs._translLms[1],H0=Cs._translLms[2],Tl=Cs._rotLms[0],Ml=Cs._rotLms[1],X0=Cs._rotLms[2];this._drawTranslationalLimit3D(a,jr,Fo,qo,ei,Cl,O0,H0,z_);var v0=this._pool,M_=v0.sizeVec3==0?new u.common.Vec3:v0.stackVec3[--v0.sizeVec3],Wv=M_;Wv.x=Cs._axisYX,Wv.y=Cs._axisYY,Wv.z=Cs._axisYZ;var Uv=this._pool,sv=Uv.sizeVec3==0?new u.common.Vec3:Uv.stackVec3[--Uv.sizeVec3];sv.x=Fo.x,sv.y=Fo.y,sv.z=Fo.z;var L0=sv,dv=this._pool,l0=dv.sizeVec3==0?new u.common.Vec3:dv.stackVec3[--dv.sizeVec3];l0.x=Fo.x,l0.y=Fo.y,l0.z=Fo.z;var es=l0,h0=es.y*M_.z-es.z*M_.y,Y0=es.z*M_.x-es.x*M_.z,Re=es.x*M_.y-es.y*M_.x;es.x=h0,es.y=Y0,es.z=Re;var K0=es;this._drawRotationalLimit(a,yo,qo,ei,qo,w0,Cs._angleX-Tl.upperLimit,Cs._angleX-Tl.lowerLimit,z_),this._drawRotationalLimit(a,yo,L0,K0,L0,w0,Ml.lowerLimit-Cs._angleY,Ml.upperLimit-Cs._angleY,z_),this._drawRotationalLimit(a,yo,_r,gs,_r,w0,X0.lowerLimit-Cs._angleZ,X0.upperLimit-Cs._angleZ,z_);break}a.line(jr,yo,a.style.jointErrorColor);var yi=this._pool,cn=null,wr=null,Ov=null;if(de!=null){if(de.zero(),yi.sizeVec3==yi.stackVec3.length){for(var c0=yi.sizeVec3<<1,ch=new Array(c0),ah=ch,p_=0,$s=yi.sizeVec3;p_<$s;){var Ee=p_++;ah[Ee]=yi.stackVec3[Ee],yi.stackVec3[Ee]=null}yi.stackVec3=ah}yi.stackVec3[yi.sizeVec3++]=de}if(cn!=null){var th=1,bh=0,Ql=0,br=0,n_=1,bn=0,yv=0,$0=0,gv=1;if(cn.e00=th,cn.e01=bh,cn.e02=Ql,cn.e10=br,cn.e11=n_,cn.e12=bn,cn.e20=yv,cn.e21=$0,cn.e22=gv,yi.sizeMat3==yi.stackMat3.length){for(var pl=yi.sizeMat3<<1,ml=new Array(pl),yl=ml,T_=0,Sv=yi.sizeMat3;T_<Sv;){var Sn=T_++;yl[Sn]=yi.stackMat3[Sn],yi.stackMat3[Sn]=null}yi.stackMat3=yl}yi.stackMat3[yi.sizeMat3++]=cn}if(wr!=null){var Iv=1,Pv=0,Q_=0,_s=0,R_=0,Cv=1,Hv=0,or=0,m_=0,vs=0,Gi=1,y_=0,Pn=0,j0=0,b0=0,fh=1;if(wr.e00=Iv,wr.e01=Pv,wr.e02=Q_,wr.e03=_s,wr.e10=R_,wr.e11=Cv,wr.e12=Hv,wr.e13=or,wr.e20=m_,wr.e21=vs,wr.e22=Gi,wr.e23=y_,wr.e30=Pn,wr.e31=j0,wr.e32=b0,wr.e33=fh,yi.sizeMat4==yi.stackMat4.length){for(var q0=yi.sizeMat4<<1,al=new Array(q0),gl=al,Z0=0,xh=yi.sizeMat4;Z0<xh;){var Il=Z0++;gl[Il]=yi.stackMat4[Il],yi.stackMat4[Il]=null}yi.stackMat4=gl}yi.stackMat4[yi.sizeMat4++]=wr}if(Ov!=null){var gh=0,ih=0,Vl=0,B0=1;if(Ov.x=gh,Ov.y=ih,Ov.z=Vl,Ov.w=B0,yi.sizeQuat==yi.stackQuat.length){for(var A0=yi.sizeQuat<<1,kl=new Array(A0),rh=kl,Kv=0,Rl=yi.sizeQuat;Kv<Rl;){var $v=Kv++;rh[$v]=yi.stackQuat[$v],yi.stackQuat[$v]=null}yi.stackQuat=rh}yi.stackQuat[yi.sizeQuat++]=Ov}var nr=this._pool,g_=null,rn=null,wl=null;if(be!=null){if(be.zero(),nr.sizeVec3==nr.stackVec3.length){for(var d0=nr.sizeVec3<<1,oh=new Array(d0),El=oh,tl=0,Dl=nr.sizeVec3;tl<Dl;){var S0=tl++;El[S0]=nr.stackVec3[S0],nr.stackVec3[S0]=null}nr.stackVec3=El}nr.stackVec3[nr.sizeVec3++]=be}if(g_!=null){var nh=1,sh=0,Fl=0,Nl=0,ev=1,Tv=0,jv=0,De=0,uh=1;if(g_.e00=nh,g_.e01=sh,g_.e02=Fl,g_.e10=Nl,g_.e11=ev,g_.e12=Tv,g_.e20=jv,g_.e21=De,g_.e22=uh,nr.sizeMat3==nr.stackMat3.length){for(var f0=nr.sizeMat3<<1,Xl=new Array(f0),Qv=Xl,qv=0,Rv=nr.sizeMat3;qv<Rv;){var x0=qv++;Qv[x0]=nr.stackMat3[x0],nr.stackMat3[x0]=null}nr.stackMat3=Qv}nr.stackMat3[nr.sizeMat3++]=g_}if(rn!=null){var Zh=1,P0=0,a0=0,Jl=0,Gl=0,zh=1,Ev=0,ur=0,Vs=0,ls=0,C0=1,Wl=0,Fe=0,u0=0,Ll=0,Ul=1;if(rn.e00=Zh,rn.e01=P0,rn.e02=a0,rn.e03=Jl,rn.e10=Gl,rn.e11=zh,rn.e12=Ev,rn.e13=ur,rn.e20=Vs,rn.e21=ls,rn.e22=C0,rn.e23=Wl,rn.e30=Fe,rn.e31=u0,rn.e32=Ll,rn.e33=Ul,nr.sizeMat4==nr.stackMat4.length){for(var Ol=nr.sizeMat4<<1,Ih=new Array(Ol),_v=Ih,vv=0,T0=nr.sizeMat4;vv<T0;){var I_=vv++;_v[I_]=nr.stackMat4[I_],nr.stackMat4[I_]=null}nr.stackMat4=_v}nr.stackMat4[nr.sizeMat4++]=rn}if(wl!=null){var Yl=0,Vh=0,Bh=0,t0=1;if(wl.x=Yl,wl.y=Vh,wl.z=Bh,wl.w=t0,nr.sizeQuat==nr.stackQuat.length){for(var lv=nr.sizeQuat<<1,kh=new Array(lv),Zl=kh,wh=0,Kh=nr.sizeQuat;wh<Kh;){var eh=wh++;Zl[eh]=nr.stackQuat[eh],nr.stackQuat[eh]=null}nr.stackQuat=Zl}nr.stackQuat[nr.sizeQuat++]=wl}var Ei=this._pool,s_=null,V_=null,_h=null;if(jr!=null){if(jr.zero(),Ei.sizeVec3==Ei.stackVec3.length){for(var Ah=Ei.sizeVec3<<1,dh=new Array(Ah),Mh=dh,Vv=0,Qh=Ei.sizeVec3;Vv<Qh;){var Rh=Vv++;Mh[Rh]=Ei.stackVec3[Rh],Ei.stackVec3[Rh]=null}Ei.stackVec3=Mh}Ei.stackVec3[Ei.sizeVec3++]=jr}if(s_!=null){var $h=1,jh=0,ph=0,Sh=0,il=1,ic=0,Xh=0,E_=0,Eh=1;if(s_.e00=$h,s_.e01=jh,s_.e02=ph,s_.e10=Sh,s_.e11=il,s_.e12=ic,s_.e20=Xh,s_.e21=E_,s_.e22=Eh,Ei.sizeMat3==Ei.stackMat3.length){for(var mh=Ei.sizeMat3<<1,qh=new Array(mh),Lh=qh,ac=0,Ph=Ei.sizeMat3;ac<Ph;){var Q0=ac++;Lh[Q0]=Ei.stackMat3[Q0],Ei.stackMat3[Q0]=null}Ei.stackMat3=Lh}Ei.stackMat3[Ei.sizeMat3++]=s_}if(V_!=null){var rc=1,vh=0,Yh=0,Dh=0,Ch=0,R0=1,z0=0,nc=0,sc=0,Fh=0,oc=1,tc=0,rl=0,yc=0,gc=0,zc=1;if(V_.e00=rc,V_.e01=vh,V_.e02=Yh,V_.e03=Dh,V_.e10=Ch,V_.e11=R0,V_.e12=z0,V_.e13=nc,V_.e20=sc,V_.e21=Fh,V_.e22=oc,V_.e23=tc,V_.e30=rl,V_.e31=yc,V_.e32=gc,V_.e33=zc,Ei.sizeMat4==Ei.stackMat4.length){for(var Mc=Ei.sizeMat4<<1,Ic=new Array(Mc),ec=Ic,Th=0,Vc=Ei.sizeMat4;Th<Vc;){var xc=Th++;ec[xc]=Ei.stackMat4[xc],Ei.stackMat4[xc]=null}Ei.stackMat4=ec}Ei.stackMat4[Ei.sizeMat4++]=V_}if(_h!=null){var pc=0,mc=0,kc=0,uc=1;if(_h.x=pc,_h.y=mc,_h.z=kc,_h.w=uc,Ei.sizeQuat==Ei.stackQuat.length){for(var sf=Ei.sizeQuat<<1,ef=new Array(sf),tb=ef,ib=0,_f=Ei.sizeQuat;ib<_f;){var wc=ib++;tb[wc]=Ei.stackQuat[wc],Ei.stackQuat[wc]=null}Ei.stackQuat=tb}Ei.stackQuat[Ei.sizeQuat++]=_h}var fn=this._pool,Nh=null,ol=null,_c=null;if(yo!=null){if(yo.zero(),fn.sizeVec3==fn.stackVec3.length){for(var vf=fn.sizeVec3<<1,lf=new Array(vf),rb=lf,ob=0,hf=fn.sizeVec3;ob<hf;){var Xc=ob++;rb[Xc]=fn.stackVec3[Xc],fn.stackVec3[Xc]=null}fn.stackVec3=rb}fn.stackVec3[fn.sizeVec3++]=yo}if(Nh!=null){var cf=1,bf=0,ff=0,xf=0,uf=1,zf=0,Mf=0,pf=0,mf=1;if(Nh.e00=cf,Nh.e01=bf,Nh.e02=ff,Nh.e10=xf,Nh.e11=uf,Nh.e12=zf,Nh.e20=Mf,Nh.e21=pf,Nh.e22=mf,fn.sizeMat3==fn.stackMat3.length){for(var yf=fn.sizeMat3<<1,gf=new Array(yf),nb=gf,sb=0,If=fn.sizeMat3;sb<If;){var Lc=sb++;nb[Lc]=fn.stackMat3[Lc],fn.stackMat3[Lc]=null}fn.stackMat3=nb}fn.stackMat3[fn.sizeMat3++]=Nh}if(ol!=null){var Vf=1,kf=0,wf=0,Xf=0,Lf=0,Yf=1,Zf=0,Bf=0,Af=0,df=0,Sf=1,Pf=0,Cf=0,Tf=0,Qf=0,Rf=1;if(ol.e00=Vf,ol.e01=kf,ol.e02=wf,ol.e03=Xf,ol.e10=Lf,ol.e11=Yf,ol.e12=Zf,ol.e13=Bf,ol.e20=Af,ol.e21=df,ol.e22=Sf,ol.e23=Pf,ol.e30=Cf,ol.e31=Tf,ol.e32=Qf,ol.e33=Rf,fn.sizeMat4==fn.stackMat4.length){for(var Ef=fn.sizeMat4<<1,Df=new Array(Ef),eb=Df,_b=0,Ff=fn.sizeMat4;_b<Ff;){var Yc=_b++;eb[Yc]=fn.stackMat4[Yc],fn.stackMat4[Yc]=null}fn.stackMat4=eb}fn.stackMat4[fn.sizeMat4++]=ol}if(_c!=null){var Nf=0,Jf=0,Gf=0,Wf=1;if(_c.x=Nf,_c.y=Jf,_c.z=Gf,_c.w=Wf,fn.sizeQuat==fn.stackQuat.length){for(var Uf=fn.sizeQuat<<1,Of=new Array(Uf),vb=Of,lb=0,Hf=fn.sizeQuat;lb<Hf;){var Zc=lb++;vb[Zc]=fn.stackQuat[Zc],fn.stackQuat[Zc]=null}fn.stackQuat=vb}fn.stackQuat[fn.sizeQuat++]=_c}var xn=this._pool,Jh=null,nl=null,vc=null;if(Fo!=null){if(Fo.zero(),xn.sizeVec3==xn.stackVec3.length){for(var Kf=xn.sizeVec3<<1,$f=new Array(Kf),hb=$f,cb=0,jf=xn.sizeVec3;cb<jf;){var Bc=cb++;hb[Bc]=xn.stackVec3[Bc],xn.stackVec3[Bc]=null}xn.stackVec3=hb}xn.stackVec3[xn.sizeVec3++]=Fo}if(Jh!=null){var qf=1,ax=0,tx=0,ix=0,rx=1,ox=0,nx=0,sx=0,ex=1;if(Jh.e00=qf,Jh.e01=ax,Jh.e02=tx,Jh.e10=ix,Jh.e11=rx,Jh.e12=ox,Jh.e20=nx,Jh.e21=sx,Jh.e22=ex,xn.sizeMat3==xn.stackMat3.length){for(var _x=xn.sizeMat3<<1,vx=new Array(_x),bb=vx,fb=0,lx=xn.sizeMat3;fb<lx;){var Ac=fb++;bb[Ac]=xn.stackMat3[Ac],xn.stackMat3[Ac]=null}xn.stackMat3=bb}xn.stackMat3[xn.sizeMat3++]=Jh}if(nl!=null){var hx=1,cx=0,bx=0,fx=0,xx=0,ux=1,zx=0,Mx=0,px=0,mx=0,yx=1,gx=0,Ix=0,Vx=0,kx=0,wx=1;if(nl.e00=hx,nl.e01=cx,nl.e02=bx,nl.e03=fx,nl.e10=xx,nl.e11=ux,nl.e12=zx,nl.e13=Mx,nl.e20=px,nl.e21=mx,nl.e22=yx,nl.e23=gx,nl.e30=Ix,nl.e31=Vx,nl.e32=kx,nl.e33=wx,xn.sizeMat4==xn.stackMat4.length){for(var Xx=xn.sizeMat4<<1,Lx=new Array(Xx),xb=Lx,ub=0,Yx=xn.sizeMat4;ub<Yx;){var dc=ub++;xb[dc]=xn.stackMat4[dc],xn.stackMat4[dc]=null}xn.stackMat4=xb}xn.stackMat4[xn.sizeMat4++]=nl}if(vc!=null){var Zx=0,Bx=0,Ax=0,dx=1;if(vc.x=Zx,vc.y=Bx,vc.z=Ax,vc.w=dx,xn.sizeQuat==xn.stackQuat.length){for(var Sx=xn.sizeQuat<<1,Px=new Array(Sx),zb=Px,Mb=0,Cx=xn.sizeQuat;Mb<Cx;){var Sc=Mb++;zb[Sc]=xn.stackQuat[Sc],xn.stackQuat[Sc]=null}xn.stackQuat=zb}xn.stackQuat[xn.sizeQuat++]=vc}var un=this._pool,Gh=null,sl=null,lc=null;if(qo!=null){if(qo.zero(),un.sizeVec3==un.stackVec3.length){for(var Tx=un.sizeVec3<<1,Qx=new Array(Tx),pb=Qx,mb=0,Rx=un.sizeVec3;mb<Rx;){var Pc=mb++;pb[Pc]=un.stackVec3[Pc],un.stackVec3[Pc]=null}un.stackVec3=pb}un.stackVec3[un.sizeVec3++]=qo}if(Gh!=null){var Ex=1,Dx=0,Fx=0,Nx=0,Jx=1,Gx=0,Wx=0,Ux=0,Ox=1;if(Gh.e00=Ex,Gh.e01=Dx,Gh.e02=Fx,Gh.e10=Nx,Gh.e11=Jx,Gh.e12=Gx,Gh.e20=Wx,Gh.e21=Ux,Gh.e22=Ox,un.sizeMat3==un.stackMat3.length){for(var Hx=un.sizeMat3<<1,Kx=new Array(Hx),yb=Kx,gb=0,$x=un.sizeMat3;gb<$x;){var Cc=gb++;yb[Cc]=un.stackMat3[Cc],un.stackMat3[Cc]=null}un.stackMat3=yb}un.stackMat3[un.sizeMat3++]=Gh}if(sl!=null){var jx=1,qx=0,au=0,tu=0,iu=0,ru=1,ou=0,nu=0,su=0,eu=0,_u=1,vu=0,lu=0,hu=0,cu=0,bu=1;if(sl.e00=jx,sl.e01=qx,sl.e02=au,sl.e03=tu,sl.e10=iu,sl.e11=ru,sl.e12=ou,sl.e13=nu,sl.e20=su,sl.e21=eu,sl.e22=_u,sl.e23=vu,sl.e30=lu,sl.e31=hu,sl.e32=cu,sl.e33=bu,un.sizeMat4==un.stackMat4.length){for(var fu=un.sizeMat4<<1,xu=new Array(fu),Ib=xu,Vb=0,uu=un.sizeMat4;Vb<uu;){var Tc=Vb++;Ib[Tc]=un.stackMat4[Tc],un.stackMat4[Tc]=null}un.stackMat4=Ib}un.stackMat4[un.sizeMat4++]=sl}if(lc!=null){var zu=0,Mu=0,pu=0,mu=1;if(lc.x=zu,lc.y=Mu,lc.z=pu,lc.w=mu,un.sizeQuat==un.stackQuat.length){for(var yu=un.sizeQuat<<1,gu=new Array(yu),kb=gu,wb=0,Iu=un.sizeQuat;wb<Iu;){var Qc=wb++;kb[Qc]=un.stackQuat[Qc],un.stackQuat[Qc]=null}un.stackQuat=kb}un.stackQuat[un.sizeQuat++]=lc}var zn=this._pool,Wh=null,el=null,hc=null;if(ei!=null){if(ei.zero(),zn.sizeVec3==zn.stackVec3.length){for(var Vu=zn.sizeVec3<<1,ku=new Array(Vu),Xb=ku,Lb=0,wu=zn.sizeVec3;Lb<wu;){var Rc=Lb++;Xb[Rc]=zn.stackVec3[Rc],zn.stackVec3[Rc]=null}zn.stackVec3=Xb}zn.stackVec3[zn.sizeVec3++]=ei}if(Wh!=null){var Xu=1,Lu=0,Yu=0,Zu=0,Bu=1,Au=0,du=0,Su=0,Pu=1;if(Wh.e00=Xu,Wh.e01=Lu,Wh.e02=Yu,Wh.e10=Zu,Wh.e11=Bu,Wh.e12=Au,Wh.e20=du,Wh.e21=Su,Wh.e22=Pu,zn.sizeMat3==zn.stackMat3.length){for(var Cu=zn.sizeMat3<<1,Tu=new Array(Cu),Yb=Tu,Zb=0,Qu=zn.sizeMat3;Zb<Qu;){var Ec=Zb++;Yb[Ec]=zn.stackMat3[Ec],zn.stackMat3[Ec]=null}zn.stackMat3=Yb}zn.stackMat3[zn.sizeMat3++]=Wh}if(el!=null){var Ru=1,Eu=0,Du=0,Fu=0,Nu=0,Ju=1,Gu=0,Wu=0,Uu=0,Ou=0,Hu=1,Ku=0,$u=0,ju=0,qu=0,a2=1;if(el.e00=Ru,el.e01=Eu,el.e02=Du,el.e03=Fu,el.e10=Nu,el.e11=Ju,el.e12=Gu,el.e13=Wu,el.e20=Uu,el.e21=Ou,el.e22=Hu,el.e23=Ku,el.e30=$u,el.e31=ju,el.e32=qu,el.e33=a2,zn.sizeMat4==zn.stackMat4.length){for(var t2=zn.sizeMat4<<1,i2=new Array(t2),Bb=i2,Ab=0,r2=zn.sizeMat4;Ab<r2;){var Dc=Ab++;Bb[Dc]=zn.stackMat4[Dc],zn.stackMat4[Dc]=null}zn.stackMat4=Bb}zn.stackMat4[zn.sizeMat4++]=el}if(hc!=null){var o2=0,n2=0,s2=0,e2=1;if(hc.x=o2,hc.y=n2,hc.z=s2,hc.w=e2,zn.sizeQuat==zn.stackQuat.length){for(var _2=zn.sizeQuat<<1,v2=new Array(_2),db=v2,Sb=0,l2=zn.sizeQuat;Sb<l2;){var Fc=Sb++;db[Fc]=zn.stackQuat[Fc],zn.stackQuat[Fc]=null}zn.stackQuat=db}zn.stackQuat[zn.sizeQuat++]=hc}var Mn=this._pool,Uh=null,_l=null,cc=null;if(_r!=null){if(_r.zero(),Mn.sizeVec3==Mn.stackVec3.length){for(var h2=Mn.sizeVec3<<1,c2=new Array(h2),Pb=c2,Cb=0,b2=Mn.sizeVec3;Cb<b2;){var Nc=Cb++;Pb[Nc]=Mn.stackVec3[Nc],Mn.stackVec3[Nc]=null}Mn.stackVec3=Pb}Mn.stackVec3[Mn.sizeVec3++]=_r}if(Uh!=null){var f2=1,x2=0,u2=0,z2=0,M2=1,p2=0,m2=0,y2=0,g2=1;if(Uh.e00=f2,Uh.e01=x2,Uh.e02=u2,Uh.e10=z2,Uh.e11=M2,Uh.e12=p2,Uh.e20=m2,Uh.e21=y2,Uh.e22=g2,Mn.sizeMat3==Mn.stackMat3.length){for(var I2=Mn.sizeMat3<<1,V2=new Array(I2),Tb=V2,Qb=0,k2=Mn.sizeMat3;Qb<k2;){var Jc=Qb++;Tb[Jc]=Mn.stackMat3[Jc],Mn.stackMat3[Jc]=null}Mn.stackMat3=Tb}Mn.stackMat3[Mn.sizeMat3++]=Uh}if(_l!=null){var w2=1,X2=0,L2=0,Y2=0,Z2=0,B2=1,A2=0,d2=0,S2=0,P2=0,C2=1,T2=0,Q2=0,R2=0,E2=0,D2=1;if(_l.e00=w2,_l.e01=X2,_l.e02=L2,_l.e03=Y2,_l.e10=Z2,_l.e11=B2,_l.e12=A2,_l.e13=d2,_l.e20=S2,_l.e21=P2,_l.e22=C2,_l.e23=T2,_l.e30=Q2,_l.e31=R2,_l.e32=E2,_l.e33=D2,Mn.sizeMat4==Mn.stackMat4.length){for(var F2=Mn.sizeMat4<<1,N2=new Array(F2),Rb=N2,Eb=0,J2=Mn.sizeMat4;Eb<J2;){var Gc=Eb++;Rb[Gc]=Mn.stackMat4[Gc],Mn.stackMat4[Gc]=null}Mn.stackMat4=Rb}Mn.stackMat4[Mn.sizeMat4++]=_l}if(cc!=null){var G2=0,W2=0,U2=0,O2=1;if(cc.x=G2,cc.y=W2,cc.z=U2,cc.w=O2,Mn.sizeQuat==Mn.stackQuat.length){for(var H2=Mn.sizeQuat<<1,K2=new Array(H2),Db=K2,Fb=0,$2=Mn.sizeQuat;Fb<$2;){var Wc=Fb++;Db[Wc]=Mn.stackQuat[Wc],Mn.stackQuat[Wc]=null}Mn.stackQuat=Db}Mn.stackQuat[Mn.sizeQuat++]=cc}var pn=this._pool,Oh=null,vl=null,bc=null;if(gs!=null){if(gs.zero(),pn.sizeVec3==pn.stackVec3.length){for(var j2=pn.sizeVec3<<1,q2=new Array(j2),Nb=q2,Jb=0,az=pn.sizeVec3;Jb<az;){var Uc=Jb++;Nb[Uc]=pn.stackVec3[Uc],pn.stackVec3[Uc]=null}pn.stackVec3=Nb}pn.stackVec3[pn.sizeVec3++]=gs}if(Oh!=null){var tz=1,iz=0,rz=0,oz=0,nz=1,sz=0,ez=0,_z=0,vz=1;if(Oh.e00=tz,Oh.e01=iz,Oh.e02=rz,Oh.e10=oz,Oh.e11=nz,Oh.e12=sz,Oh.e20=ez,Oh.e21=_z,Oh.e22=vz,pn.sizeMat3==pn.stackMat3.length){for(var lz=pn.sizeMat3<<1,hz=new Array(lz),Gb=hz,Wb=0,cz=pn.sizeMat3;Wb<cz;){var Oc=Wb++;Gb[Oc]=pn.stackMat3[Oc],pn.stackMat3[Oc]=null}pn.stackMat3=Gb}pn.stackMat3[pn.sizeMat3++]=Oh}if(vl!=null){var bz=1,fz=0,xz=0,uz=0,zz=0,Mz=1,pz=0,mz=0,yz=0,gz=0,Iz=1,Vz=0,kz=0,wz=0,Xz=0,Lz=1;if(vl.e00=bz,vl.e01=fz,vl.e02=xz,vl.e03=uz,vl.e10=zz,vl.e11=Mz,vl.e12=pz,vl.e13=mz,vl.e20=yz,vl.e21=gz,vl.e22=Iz,vl.e23=Vz,vl.e30=kz,vl.e31=wz,vl.e32=Xz,vl.e33=Lz,pn.sizeMat4==pn.stackMat4.length){for(var Yz=pn.sizeMat4<<1,Zz=new Array(Yz),Ub=Zz,Ob=0,Bz=pn.sizeMat4;Ob<Bz;){var Hc=Ob++;Ub[Hc]=pn.stackMat4[Hc],pn.stackMat4[Hc]=null}pn.stackMat4=Ub}pn.stackMat4[pn.sizeMat4++]=vl}if(bc!=null){var Az=0,dz=0,Sz=0,Pz=1;if(bc.x=Az,bc.y=dz,bc.z=Sz,bc.w=Pz,pn.sizeQuat==pn.stackQuat.length){for(var Cz=pn.sizeQuat<<1,Tz=new Array(Cz),Hb=Tz,Kb=0,Qz=pn.sizeQuat;Kb<Qz;){var Kc=Kb++;Hb[Kc]=pn.stackQuat[Kc],pn.stackQuat[Kc]=null}pn.stackQuat=Hb}pn.stackQuat[pn.sizeQuat++]=bc}var mn=this._pool,Hh=null,ll=null,fc=null;if(Er!=null){if(Er.zero(),mn.sizeVec3==mn.stackVec3.length){for(var Rz=mn.sizeVec3<<1,Ez=new Array(Rz),$b=Ez,jb=0,Dz=mn.sizeVec3;jb<Dz;){var $c=jb++;$b[$c]=mn.stackVec3[$c],mn.stackVec3[$c]=null}mn.stackVec3=$b}mn.stackVec3[mn.sizeVec3++]=Er}if(Hh!=null){var Fz=1,Nz=0,Jz=0,Gz=0,Wz=1,Uz=0,Oz=0,Hz=0,Kz=1;if(Hh.e00=Fz,Hh.e01=Nz,Hh.e02=Jz,Hh.e10=Gz,Hh.e11=Wz,Hh.e12=Uz,Hh.e20=Oz,Hh.e21=Hz,Hh.e22=Kz,mn.sizeMat3==mn.stackMat3.length){for(var $z=mn.sizeMat3<<1,jz=new Array($z),qb=jz,af=0,qz=mn.sizeMat3;af<qz;){var jc=af++;qb[jc]=mn.stackMat3[jc],mn.stackMat3[jc]=null}mn.stackMat3=qb}mn.stackMat3[mn.sizeMat3++]=Hh}if(ll!=null){var aM=1,tM=0,iM=0,rM=0,oM=0,nM=1,sM=0,eM=0,_M=0,vM=0,lM=1,hM=0,cM=0,bM=0,fM=0,xM=1;if(ll.e00=aM,ll.e01=tM,ll.e02=iM,ll.e03=rM,ll.e10=oM,ll.e11=nM,ll.e12=sM,ll.e13=eM,ll.e20=_M,ll.e21=vM,ll.e22=lM,ll.e23=hM,ll.e30=cM,ll.e31=bM,ll.e32=fM,ll.e33=xM,mn.sizeMat4==mn.stackMat4.length){for(var uM=mn.sizeMat4<<1,zM=new Array(uM),tf=zM,rf=0,MM=mn.sizeMat4;rf<MM;){var qc=rf++;tf[qc]=mn.stackMat4[qc],mn.stackMat4[qc]=null}mn.stackMat4=tf}mn.stackMat4[mn.sizeMat4++]=ll}if(fc!=null){var pM=0,mM=0,yM=0,gM=1;if(fc.x=pM,fc.y=mM,fc.z=yM,fc.w=gM,mn.sizeQuat==mn.stackQuat.length){for(var IM=mn.sizeQuat<<1,VM=new Array(IM),of=VM,nf=0,kM=mn.sizeQuat;nf<kM;){var ab=nf++;of[ab]=mn.stackQuat[ab],mn.stackQuat[ab]=null}mn.stackQuat=of}mn.stackQuat[mn.sizeQuat++]=fc}Ai=av}}_drawRotationalLimit(a,t,i,o,r,e,_,h,v){if(_!=h){var s=this._pool,l=s.sizeVec3==0?new u.common.Vec3:s.stackVec3[--s.sizeVec3];l.x=t.x,l.y=t.y,l.z=t.z;var x=l,b=x.x+r.x*e,f=x.y+r.y*e,n=x.z+r.z*e;x.x=b,x.y=f,x.z=n;var c=x;a.line(t,c,v);var z=this._pool,p=null,y=null,V=null;if(c!=null){if(c.zero(),z.sizeVec3==z.stackVec3.length){for(var M=z.sizeVec3<<1,I=new Array(M),k=I,X=0,L=z.sizeVec3;X<L;){var m=X++;k[m]=z.stackVec3[m],z.stackVec3[m]=null}z.stackVec3=k}z.stackVec3[z.sizeVec3++]=c}if(p!=null){var g=1,N=0,d=0,F=0,S=1,Y=0,Q=0,C=0,B=1;if(p.e00=g,p.e01=N,p.e02=d,p.e10=F,p.e11=S,p.e12=Y,p.e20=Q,p.e21=C,p.e22=B,z.sizeMat3==z.stackMat3.length){for(var Z=z.sizeMat3<<1,$=new Array(Z),K=$,E=0,J=z.sizeMat3;E<J;){var A=E++;K[A]=z.stackMat3[A],z.stackMat3[A]=null}z.stackMat3=K}z.stackMat3[z.sizeMat3++]=p}if(y!=null){var R=1,U=0,G=0,D=0,H=0,j=1,ia=0,ea=0,W=0,q=0,na=1,oa=0,aa=0,T=0,ca=0,_a=1;if(y.e00=R,y.e01=U,y.e02=G,y.e03=D,y.e10=H,y.e11=j,y.e12=ia,y.e13=ea,y.e20=W,y.e21=q,y.e22=na,y.e23=oa,y.e30=aa,y.e31=T,y.e32=ca,y.e33=_a,z.sizeMat4==z.stackMat4.length){for(var w=z.sizeMat4<<1,ta=new Array(w),ra=ta,la=0,va=z.sizeMat4;la<va;){var ua=la++;ra[ua]=z.stackMat4[ua],z.stackMat4[ua]=null}z.stackMat4=ra}z.stackMat4[z.sizeMat4++]=y}if(V!=null){var za=0,Ma=0,Xa=0,Za=1;if(V.x=za,V.y=Ma,V.z=Xa,V.w=Za,z.sizeQuat==z.stackQuat.length){for(var fa=z.sizeQuat<<1,ba=new Array(fa),sa=ba,ha=0,ma=z.sizeQuat;ha<ma;){var ya=ha++;sa[ya]=z.stackQuat[ya],z.stackQuat[ya]=null}z.stackQuat=sa}z.stackQuat[z.sizeQuat++]=V}_>h?a.ellipse(t,i,o,e,e,v):a.arc(t,i,o,e,e,_,h,!0,v)}}_drawTranslationalLimit(a,t,i,o,r,e){if(o<r){var _=this._pool,h=_.sizeVec3==0?new u.common.Vec3:_.stackVec3[--_.sizeVec3];h.x=t.x,h.y=t.y,h.z=t.z;var v=h,s=v.x+i.x*o,l=v.y+i.y*o,x=v.z+i.z*o;v.x=s,v.y=l,v.z=x;var b=v,f=this._pool,n=f.sizeVec3==0?new u.common.Vec3:f.stackVec3[--f.sizeVec3];n.x=t.x,n.y=t.y,n.z=t.z;var c=n,z=c.x+i.x*r,p=c.y+i.y*r,y=c.z+i.z*r;c.x=z,c.y=p,c.z=y;var V=c;a.line(b,V,e);var M=this._pool,I=null,k=null,X=null;if(b!=null){if(b.zero(),M.sizeVec3==M.stackVec3.length){for(var L=M.sizeVec3<<1,m=new Array(L),g=m,N=0,d=M.sizeVec3;N<d;){var F=N++;g[F]=M.stackVec3[F],M.stackVec3[F]=null}M.stackVec3=g}M.stackVec3[M.sizeVec3++]=b}if(I!=null){var S=1,Y=0,Q=0,C=0,B=1,Z=0,$=0,K=0,E=1;if(I.e00=S,I.e01=Y,I.e02=Q,I.e10=C,I.e11=B,I.e12=Z,I.e20=$,I.e21=K,I.e22=E,M.sizeMat3==M.stackMat3.length){for(var J=M.sizeMat3<<1,A=new Array(J),R=A,U=0,G=M.sizeMat3;U<G;){var D=U++;R[D]=M.stackMat3[D],M.stackMat3[D]=null}M.stackMat3=R}M.stackMat3[M.sizeMat3++]=I}if(k!=null){var H=1,j=0,ia=0,ea=0,W=0,q=1,na=0,oa=0,aa=0,T=0,ca=1,_a=0,w=0,ta=0,ra=0,la=1;if(k.e00=H,k.e01=j,k.e02=ia,k.e03=ea,k.e10=W,k.e11=q,k.e12=na,k.e13=oa,k.e20=aa,k.e21=T,k.e22=ca,k.e23=_a,k.e30=w,k.e31=ta,k.e32=ra,k.e33=la,M.sizeMat4==M.stackMat4.length){for(var va=M.sizeMat4<<1,ua=new Array(va),za=ua,Ma=0,Xa=M.sizeMat4;Ma<Xa;){var Za=Ma++;za[Za]=M.stackMat4[Za],M.stackMat4[Za]=null}M.stackMat4=za}M.stackMat4[M.sizeMat4++]=k}if(X!=null){var fa=0,ba=0,sa=0,ha=1;if(X.x=fa,X.y=ba,X.z=sa,X.w=ha,M.sizeQuat==M.stackQuat.length){for(var ma=M.sizeQuat<<1,ya=new Array(ma),Ba=ya,pa=0,Ya=M.sizeQuat;pa<Ya;){var Ra=pa++;Ba[Ra]=M.stackQuat[Ra],M.stackQuat[Ra]=null}M.stackQuat=Ba}M.stackQuat[M.sizeQuat++]=X}var ga=this._pool,xa=null,wa=null,ka=null;if(V!=null){if(V.zero(),ga.sizeVec3==ga.stackVec3.length){for(var Pa=ga.sizeVec3<<1,zt=new Array(Pa),Oa=zt,Aa=0,nt=ga.sizeVec3;Aa<nt;){var Ea=Aa++;Oa[Ea]=ga.stackVec3[Ea],ga.stackVec3[Ea]=null}ga.stackVec3=Oa}ga.stackVec3[ga.sizeVec3++]=V}if(xa!=null){var Fa=1,da=0,ft=0,Wa=0,Ha=1,bt=0,it=0,Ka=0,_t=1;if(xa.e00=Fa,xa.e01=da,xa.e02=ft,xa.e10=Wa,xa.e11=Ha,xa.e12=bt,xa.e20=it,xa.e21=Ka,xa.e22=_t,ga.sizeMat3==ga.stackMat3.length){for(var gt=ga.sizeMat3<<1,pt=new Array(gt),Ga=pt,rt=0,xt=ga.sizeMat3;rt<xt;){var Da=rt++;Ga[Da]=ga.stackMat3[Da],ga.stackMat3[Da]=null}ga.stackMat3=Ga}ga.stackMat3[ga.sizeMat3++]=xa}if(wa!=null){var Ta=1,Na=0,Vt=0,Pt=0,st=0,Xt=1,Yt=0,Mt=0,Ia=0,O=0,Va=1,lt=0,P=0,wt=0,At=0,dt=1;if(wa.e00=Ta,wa.e01=Na,wa.e02=Vt,wa.e03=Pt,wa.e10=st,wa.e11=Xt,wa.e12=Yt,wa.e13=Mt,wa.e20=Ia,wa.e21=O,wa.e22=Va,wa.e23=lt,wa.e30=P,wa.e31=wt,wa.e32=At,wa.e33=dt,ga.sizeMat4==ga.stackMat4.length){for(var yt=ga.sizeMat4<<1,kt=new Array(yt),mt=kt,ht=0,ut=ga.sizeMat4;ht<ut;){var Qa=ht++;mt[Qa]=ga.stackMat4[Qa],ga.stackMat4[Qa]=null}ga.stackMat4=mt}ga.stackMat4[ga.sizeMat4++]=wa}if(ka!=null){var et=0,Ca=0,vt=0,qa=1;if(ka.x=et,ka.y=Ca,ka.z=vt,ka.w=qa,ga.sizeQuat==ga.stackQuat.length){for(var at=ga.sizeQuat<<1,Ua=new Array(at),tt=Ua,ct=0,Sa=ga.sizeQuat;ct<Sa;){var Ja=ct++;tt[Ja]=ga.stackQuat[Ja],ga.stackQuat[Ja]=null}ga.stackQuat=tt}ga.stackQuat[ga.sizeQuat++]=ka}}}_drawTranslationalLimit3D(a,t,i,o,r,e,_,h,v){var s=e.lowerLimit,l=e.upperLimit,x=_.lowerLimit,b=_.upperLimit,f=h.lowerLimit,n=h.upperLimit,c=this._pool;c.sizeVec3==0?new u.common.Vec3:c.stackVec3[--c.sizeVec3];var z=this._pool;z.sizeVec3==0?new u.common.Vec3:z.stackVec3[--z.sizeVec3];var p=this._pool,y=p.sizeVec3==0?new u.common.Vec3:p.stackVec3[--p.sizeVec3];y.x=t.x,y.y=t.y,y.z=t.z;var V=y,M=V.x+i.x*s,I=V.y+i.y*s,k=V.z+i.z*s;V.x=M,V.y=I,V.z=k;var X=V,L=X.x+o.x*x,m=X.y+o.y*x,g=X.z+o.z*x;X.x=L,X.y=m,X.z=g;var N=X,d=N.x+r.x*f,F=N.y+r.y*f,S=N.z+r.z*f;N.x=d,N.y=F,N.z=S;var Y=N,Q=this._pool,C=Q.sizeVec3==0?new u.common.Vec3:Q.stackVec3[--Q.sizeVec3];C.x=t.x,C.y=t.y,C.z=t.z;var B=C,Z=B.x+i.x*s,$=B.y+i.y*s,K=B.z+i.z*s;B.x=Z,B.y=$,B.z=K;var E=B,J=E.x+o.x*x,A=E.y+o.y*x,R=E.z+o.z*x;E.x=J,E.y=A,E.z=R;var U=E,G=U.x+r.x*n,D=U.y+r.y*n,H=U.z+r.z*n;U.x=G,U.y=D,U.z=H;var j=U,ia=this._pool,ea=ia.sizeVec3==0?new u.common.Vec3:ia.stackVec3[--ia.sizeVec3];ea.x=t.x,ea.y=t.y,ea.z=t.z;var W=ea,q=W.x+i.x*s,na=W.y+i.y*s,oa=W.z+i.z*s;W.x=q,W.y=na,W.z=oa;var aa=W,T=aa.x+o.x*b,ca=aa.y+o.y*b,_a=aa.z+o.z*b;aa.x=T,aa.y=ca,aa.z=_a;var w=aa,ta=w.x+r.x*f,ra=w.y+r.y*f,la=w.z+r.z*f;w.x=ta,w.y=ra,w.z=la;var va=w,ua=this._pool,za=ua.sizeVec3==0?new u.common.Vec3:ua.stackVec3[--ua.sizeVec3];za.x=t.x,za.y=t.y,za.z=t.z;var Ma=za,Xa=Ma.x+i.x*s,Za=Ma.y+i.y*s,fa=Ma.z+i.z*s;Ma.x=Xa,Ma.y=Za,Ma.z=fa;var ba=Ma,sa=ba.x+o.x*b,ha=ba.y+o.y*b,ma=ba.z+o.z*b;ba.x=sa,ba.y=ha,ba.z=ma;var ya=ba,Ba=ya.x+r.x*n,pa=ya.y+r.y*n,Ya=ya.z+r.z*n;ya.x=Ba,ya.y=pa,ya.z=Ya;var Ra=ya,ga=this._pool,xa=ga.sizeVec3==0?new u.common.Vec3:ga.stackVec3[--ga.sizeVec3];xa.x=t.x,xa.y=t.y,xa.z=t.z;var wa=xa,ka=wa.x+i.x*l,Pa=wa.y+i.y*l,zt=wa.z+i.z*l;wa.x=ka,wa.y=Pa,wa.z=zt;var Oa=wa,Aa=Oa.x+o.x*x,nt=Oa.y+o.y*x,Ea=Oa.z+o.z*x;Oa.x=Aa,Oa.y=nt,Oa.z=Ea;var Fa=Oa,da=Fa.x+r.x*f,ft=Fa.y+r.y*f,Wa=Fa.z+r.z*f;Fa.x=da,Fa.y=ft,Fa.z=Wa;var Ha=Fa,bt=this._pool,it=bt.sizeVec3==0?new u.common.Vec3:bt.stackVec3[--bt.sizeVec3];it.x=t.x,it.y=t.y,it.z=t.z;var Ka=it,_t=Ka.x+i.x*l,gt=Ka.y+i.y*l,pt=Ka.z+i.z*l;Ka.x=_t,Ka.y=gt,Ka.z=pt;var Ga=Ka,rt=Ga.x+o.x*x,xt=Ga.y+o.y*x,Da=Ga.z+o.z*x;Ga.x=rt,Ga.y=xt,Ga.z=Da;var Ta=Ga,Na=Ta.x+r.x*n,Vt=Ta.y+r.y*n,Pt=Ta.z+r.z*n;Ta.x=Na,Ta.y=Vt,Ta.z=Pt;var st=Ta,Xt=this._pool,Yt=Xt.sizeVec3==0?new u.common.Vec3:Xt.stackVec3[--Xt.sizeVec3];Yt.x=t.x,Yt.y=t.y,Yt.z=t.z;var Mt=Yt,Ia=Mt.x+i.x*l,O=Mt.y+i.y*l,Va=Mt.z+i.z*l;Mt.x=Ia,Mt.y=O,Mt.z=Va;var lt=Mt,P=lt.x+o.x*b,wt=lt.y+o.y*b,At=lt.z+o.z*b;lt.x=P,lt.y=wt,lt.z=At;var dt=lt,yt=dt.x+r.x*f,kt=dt.y+r.y*f,mt=dt.z+r.z*f;dt.x=yt,dt.y=kt,dt.z=mt;var ht=dt,ut=this._pool,Qa=ut.sizeVec3==0?new u.common.Vec3:ut.stackVec3[--ut.sizeVec3];Qa.x=t.x,Qa.y=t.y,Qa.z=t.z;var et=Qa,Ca=et.x+i.x*l,vt=et.y+i.y*l,qa=et.z+i.z*l;et.x=Ca,et.y=vt,et.z=qa;var at=et,Ua=at.x+o.x*b,tt=at.y+o.y*b,ct=at.z+o.z*b;at.x=Ua,at.y=tt,at.z=ct;var Sa=at,Ja=Sa.x+r.x*n,ja=Sa.y+r.y*n,La=Sa.z+r.z*n;Sa.x=Ja,Sa.y=ja,Sa.z=La;var ot=Sa;a.line(Y,Ha,v),a.line(va,ht,v),a.line(j,st,v),a.line(Ra,ot,v),a.line(Y,va,v),a.line(Ha,ht,v),a.line(j,Ra,v),a.line(st,ot,v),a.line(Y,j,v),a.line(Ha,st,v),a.line(va,Ra,v),a.line(ht,ot,v);var It=this._pool;if(Y!=null){if(Y.zero(),It.sizeVec3==It.stackVec3.length){for(var oi=It.sizeVec3<<1,gi=new Array(oi),ai=gi,Ct=0,_i=It.sizeVec3;Ct<_i;){var Et=Ct++;ai[Et]=It.stackVec3[Et],It.stackVec3[Et]=null}It.stackVec3=ai}It.stackVec3[It.sizeVec3++]=Y}var St=this._pool;if(j!=null){if(j.zero(),St.sizeVec3==St.stackVec3.length){for(var Jt=St.sizeVec3<<1,Ki=new Array(Jt),vi=Ki,li=0,ti=St.sizeVec3;li<ti;){var Oi=li++;vi[Oi]=St.stackVec3[Oi],St.stackVec3[Oi]=null}St.stackVec3=vi}St.stackVec3[St.sizeVec3++]=j}var Xi=this._pool;if(va!=null){if(va.zero(),Xi.sizeVec3==Xi.stackVec3.length){for(var zi=Xi.sizeVec3<<1,Zt=new Array(zi),ri=Zt,Wt=0,ni=Xi.sizeVec3;Wt<ni;){var $i=Wt++;ri[$i]=Xi.stackVec3[$i],Xi.stackVec3[$i]=null}Xi.stackVec3=ri}Xi.stackVec3[Xi.sizeVec3++]=va}var Ut=this._pool;if(Ra!=null){if(Ra.zero(),Ut.sizeVec3==Ut.stackVec3.length){for(var ji=Ut.sizeVec3<<1,Ii=new Array(ji),pr=Ii,Wi=0,Lt=Ut.sizeVec3;Wi<Lt;){var jt=Wi++;pr[jt]=Ut.stackVec3[jt],Ut.stackVec3[jt]=null}Ut.stackVec3=pr}Ut.stackVec3[Ut.sizeVec3++]=Ra}var Tt=this._pool;if(Ha!=null){if(Ha.zero(),Tt.sizeVec3==Tt.stackVec3.length){for(var bi=Tt.sizeVec3<<1,Mi=new Array(bi),vr=Mi,qt=0,fi=Tt.sizeVec3;qt<fi;){var Bt=qt++;vr[Bt]=Tt.stackVec3[Bt],Tt.stackVec3[Bt]=null}Tt.stackVec3=vr}Tt.stackVec3[Tt.sizeVec3++]=Ha}var xi=this._pool;if(st!=null){if(st.zero(),xi.sizeVec3==xi.stackVec3.length){for(var hi=xi.sizeVec3<<1,sr=new Array(hi),Xr=sr,ro=0,Gt=xi.sizeVec3;ro<Gt;){var fr=ro++;Xr[fr]=xi.stackVec3[fr],xi.stackVec3[fr]=null}xi.stackVec3=Xr}xi.stackVec3[xi.sizeVec3++]=st}var mr=this._pool;if(ht!=null){if(ht.zero(),mr.sizeVec3==mr.stackVec3.length){for(var Dt=mr.sizeVec3<<1,Br=new Array(Dt),Si=Br,Dr=0,Hn=mr.sizeVec3;Dr<Hn;){var oo=Dr++;Si[oo]=mr.stackVec3[oo],mr.stackVec3[oo]=null}mr.stackVec3=Si}mr.stackVec3[mr.sizeVec3++]=ht}var Ar=this._pool;if(ot!=null){if(ot.zero(),Ar.sizeVec3==Ar.stackVec3.length){for(var no=Ar.sizeVec3<<1,yn=new Array(no),Ao=yn,Io=0,ui=Ar.sizeVec3;Io<ui;){var qr=Io++;Ao[qr]=Ar.stackVec3[qr],Ar.stackVec3[qr]=null}Ar.stackVec3=Ao}Ar.stackVec3[Ar.sizeVec3++]=ot}}_drawEllipseOnSphere(a,t,i,o,r,e,_,h,v){for(var s=16,l=0,x=6.28318530717958/s,b=this._pool,f=b.sizeVec3==0?new u.common.Vec3:b.stackVec3[--b.sizeVec3],n=this._pool,c=n.sizeQuat==0?new u.common.Quat:n.stackQuat[--n.sizeQuat],z=this._pool,p=z.sizeMat3==0?new u.common.Mat3:z.stackMat3[--z.sizeMat3],y=this._pool,V=y.sizeVec3==0?new u.common.Vec3:y.stackVec3[--y.sizeVec3],M=0,I=s+1;M<I;){var k=M++,X=Math.cos(l)*e,L=Math.sin(l)*_,m=Math.sqrt(X*X+L*L),g=Math.sin(m*.5),N=Math.cos(m*.5),d=f.zero(),F=d.x+o.x*X,S=d.y+o.y*X,Y=d.z+o.z*X;d.x=F,d.y=S,d.z=Y;var Q=d,C=Q.x+r.x*L,B=Q.y+r.y*L,Z=Q.z+r.z*L;Q.x=C,Q.y=B,Q.z=Z;var $=1/m*g,K=f.x*$,E=f.y*$,J=f.z*$;f.x=K,f.y=E,f.z=J,c.x=f.x,c.y=f.y,c.z=f.z,c.w=N;var A=c.x,R=c.y,U=c.z,G=c.w,D=2*A,H=2*R,j=2*U,ia=A*D,ea=R*H,W=U*j,q=A*H,na=R*j,oa=A*j,aa=G*D,T=G*H,ca=G*j;p.e00=1-ea-W,p.e01=q-ca,p.e02=oa+T,p.e10=q+ca,p.e11=1-ia-W,p.e12=na-aa,p.e20=oa-T,p.e21=na+aa,p.e22=1-ia-ea;var _a=this._pool,w=_a.sizeVec3==0?new u.common.Vec3:_a.stackVec3[--_a.sizeVec3],ta=w.x+i.x*h,ra=w.y+i.y*h,la=w.z+i.z*h;w.x=ta,w.y=ra,w.z=la;var va=w,ua=va.x*p.e00+va.y*p.e01+va.z*p.e02,za=va.x*p.e10+va.y*p.e11+va.z*p.e12,Ma=va.x*p.e20+va.y*p.e21+va.z*p.e22;va.x=ua,va.y=za,va.z=Ma;var Xa=va,Za=Xa.x+t.x,fa=Xa.y+t.y,ba=Xa.z+t.z;Xa.x=Za,Xa.y=fa,Xa.z=ba,k>=1&&a.line(V,va,v);var sa=this._pool,ha=null,ma=null,ya=null;if(V!=null){if(V.zero(),sa.sizeVec3==sa.stackVec3.length){for(var Ba=sa.sizeVec3<<1,pa=new Array(Ba),Ya=pa,Ra=0,ga=sa.sizeVec3;Ra<ga;){var xa=Ra++;Ya[xa]=sa.stackVec3[xa],sa.stackVec3[xa]=null}sa.stackVec3=Ya}sa.stackVec3[sa.sizeVec3++]=V}if(ha!=null){var wa=1,ka=0,Pa=0,zt=0,Oa=1,Aa=0,nt=0,Ea=0,Fa=1;if(ha.e00=wa,ha.e01=ka,ha.e02=Pa,ha.e10=zt,ha.e11=Oa,ha.e12=Aa,ha.e20=nt,ha.e21=Ea,ha.e22=Fa,sa.sizeMat3==sa.stackMat3.length){for(var da=sa.sizeMat3<<1,ft=new Array(da),Wa=ft,Ha=0,bt=sa.sizeMat3;Ha<bt;){var it=Ha++;Wa[it]=sa.stackMat3[it],sa.stackMat3[it]=null}sa.stackMat3=Wa}sa.stackMat3[sa.sizeMat3++]=ha}if(ma!=null){var Ka=1,_t=0,gt=0,pt=0,Ga=0,rt=1,xt=0,Da=0,Ta=0,Na=0,Vt=1,Pt=0,st=0,Xt=0,Yt=0,Mt=1;if(ma.e00=Ka,ma.e01=_t,ma.e02=gt,ma.e03=pt,ma.e10=Ga,ma.e11=rt,ma.e12=xt,ma.e13=Da,ma.e20=Ta,ma.e21=Na,ma.e22=Vt,ma.e23=Pt,ma.e30=st,ma.e31=Xt,ma.e32=Yt,ma.e33=Mt,sa.sizeMat4==sa.stackMat4.length){for(var Ia=sa.sizeMat4<<1,O=new Array(Ia),Va=O,lt=0,P=sa.sizeMat4;lt<P;){var wt=lt++;Va[wt]=sa.stackMat4[wt],sa.stackMat4[wt]=null}sa.stackMat4=Va}sa.stackMat4[sa.sizeMat4++]=ma}if(ya!=null){var At=0,dt=0,yt=0,kt=1;if(ya.x=At,ya.y=dt,ya.z=yt,ya.w=kt,sa.sizeQuat==sa.stackQuat.length){for(var mt=sa.sizeQuat<<1,ht=new Array(mt),ut=ht,Qa=0,et=sa.sizeQuat;Qa<et;){var Ca=Qa++;ut[Ca]=sa.stackQuat[Ca],sa.stackQuat[Ca]=null}sa.stackQuat=ut}sa.stackQuat[sa.sizeQuat++]=ya}V=va,l+=x}var vt=this._pool;if(f!=null){if(f.zero(),vt.sizeVec3==vt.stackVec3.length){for(var qa=vt.sizeVec3<<1,at=new Array(qa),Ua=at,tt=0,ct=vt.sizeVec3;tt<ct;){var Sa=tt++;Ua[Sa]=vt.stackVec3[Sa],vt.stackVec3[Sa]=null}vt.stackVec3=Ua}vt.stackVec3[vt.sizeVec3++]=f}var Ja=this._pool;if(c!=null){var ja=0,La=0,ot=0,It=1;if(c.x=ja,c.y=La,c.z=ot,c.w=It,Ja.sizeQuat==Ja.stackQuat.length){for(var oi=Ja.sizeQuat<<1,gi=new Array(oi),ai=gi,Ct=0,_i=Ja.sizeQuat;Ct<_i;){var Et=Ct++;ai[Et]=Ja.stackQuat[Et],Ja.stackQuat[Et]=null}Ja.stackQuat=ai}Ja.stackQuat[Ja.sizeQuat++]=c}var St=this._pool;if(p!=null){var Jt=1,Ki=0,vi=0,li=0,ti=1,Oi=0,Xi=0,zi=0,Zt=1;if(p.e00=Jt,p.e01=Ki,p.e02=vi,p.e10=li,p.e11=ti,p.e12=Oi,p.e20=Xi,p.e21=zi,p.e22=Zt,St.sizeMat3==St.stackMat3.length){for(var ri=St.sizeMat3<<1,Wt=new Array(ri),ni=Wt,$i=0,Ut=St.sizeMat3;$i<Ut;){var ji=$i++;ni[ji]=St.stackMat3[ji],St.stackMat3[ji]=null}St.stackMat3=ni}St.stackMat3[St.sizeMat3++]=p}var Ii=this._pool;if(V!=null){if(V.zero(),Ii.sizeVec3==Ii.stackVec3.length){for(var pr=Ii.sizeVec3<<1,Wi=new Array(pr),Lt=Wi,jt=0,Tt=Ii.sizeVec3;jt<Tt;){var bi=jt++;Lt[bi]=Ii.stackVec3[bi],Ii.stackVec3[bi]=null}Ii.stackVec3=Lt}Ii.stackVec3[Ii.sizeVec3++]=V}}step(a){this._timeStep.dt>0&&(this._timeStep.dtRatio=a/this._timeStep.dt),this._timeStep.dt=a,this._timeStep.invDt=1/a;var t=Date.now()/1e3;this._updateContacts(),this._solveIslands();var i=Date.now()/1e3;u.dynamics.common.Performance.totalTime=(i-t)*1e3}addRigidBody(a){if(a._world!=null)throw new Error("A rigid body cannot belong to multiple worlds.");this._rigidBodyList==null?(this._rigidBodyList=a,this._rigidBodyListLast=a):(this._rigidBodyListLast._next=a,a._prev=this._rigidBodyListLast,this._rigidBodyListLast=a),a._world=this;for(var t=a._shapeList;t!=null;){var i=t._next;t._proxy=this._broadPhase.createProxy(t,t._aabb),t._id=this._shapeIdCount++,this._numShapes++,t=i}this._numRigidBodies++}removeRigidBody(a){if(a._world!=this)throw new Error("The rigid body doesn't belong to the world.");var t=a._prev,i=a._next;t!=null&&(t._next=i),i!=null&&(i._prev=t),a==this._rigidBodyList&&(this._rigidBodyList=this._rigidBodyList._next),a==this._rigidBodyListLast&&(this._rigidBodyListLast=this._rigidBodyListLast._prev),a._next=null,a._prev=null,a._world=null;for(var o=a._shapeList;o!=null;){var r=o._next;this._broadPhase.destroyProxy(o._proxy),o._proxy=null,o._id=-1;for(var e=o._rigidBody._contactLinkList;e!=null;){var _=e._next,h=e._contact;if(h._s1==o||h._s2==o){var v=e._other;v._sleeping=!1,v._sleepTime=0;var s=this._contactManager,l=h._prev,x=h._next;if(l!=null&&(l._next=x),x!=null&&(x._prev=l),h==s._contactList&&(s._contactList=s._contactList._next),h==s._contactListLast&&(s._contactListLast=s._contactListLast._prev),h._next=null,h._prev=null,h._touching){var b=h._s1._contactCallback,f=h._s2._contactCallback;b==f&&(f=null),b!=null&&b.endContact(h),f!=null&&f.endContact(h)}var n=h._link1._prev,c=h._link1._next;n!=null&&(n._next=c),c!=null&&(c._prev=n),h._link1==h._b1._contactLinkList&&(h._b1._contactLinkList=h._b1._contactLinkList._next),h._link1==h._b1._contactLinkListLast&&(h._b1._contactLinkListLast=h._b1._contactLinkListLast._prev),h._link1._next=null,h._link1._prev=null;var z=h._link2._prev,p=h._link2._next;z!=null&&(z._next=p),p!=null&&(p._prev=z),h._link2==h._b2._contactLinkList&&(h._b2._contactLinkList=h._b2._contactLinkList._next),h._link2==h._b2._contactLinkListLast&&(h._b2._contactLinkListLast=h._b2._contactLinkListLast._prev),h._link2._next=null,h._link2._prev=null,h._b1._numContactLinks--,h._b2._numContactLinks--,h._link1._other=null,h._link2._other=null,h._link1._contact=null,h._link2._contact=null,h._s1=null,h._s2=null,h._b1=null,h._b2=null,h._touching=!1,h._cachedDetectorData._clear(),h._manifold._clear(),h._detector=null;var y=h._contactConstraint;y._s1=null,y._s2=null,y._b1=null,y._b2=null,y._tf1=null,y._tf2=null,h._next=s._contactPool,s._contactPool=h,s._numContacts--}e=_}this._numShapes--,o=r}this._numRigidBodies--}addJoint(a){if(a._world!=null)throw new Error("A joint cannot belong to multiple worlds.");this._jointList==null?(this._jointList=a,this._jointListLast=a):(this._jointListLast._next=a,a._prev=this._jointListLast,this._jointListLast=a),a._world=this,a._link1._other=a._b2,a._link2._other=a._b1,a._b1._jointLinkList==null?(a._b1._jointLinkList=a._link1,a._b1._jointLinkListLast=a._link1):(a._b1._jointLinkListLast._next=a._link1,a._link1._prev=a._b1._jointLinkListLast,a._b1._jointLinkListLast=a._link1),a._b2._jointLinkList==null?(a._b2._jointLinkList=a._link2,a._b2._jointLinkListLast=a._link2):(a._b2._jointLinkListLast._next=a._link2,a._link2._prev=a._b2._jointLinkListLast,a._b2._jointLinkListLast=a._link2),a._b1._numJointLinks++,a._b2._numJointLinks++;var t=a._b1;t._sleeping=!1,t._sleepTime=0;var i=a._b2;i._sleeping=!1,i._sleepTime=0,a._syncAnchors(),this._numJoints++}removeJoint(a){if(a._world!=this)throw new Error("The joint doesn't belong to the world.");var t=a._prev,i=a._next;t!=null&&(t._next=i),i!=null&&(i._prev=t),a==this._jointList&&(this._jointList=this._jointList._next),a==this._jointListLast&&(this._jointListLast=this._jointListLast._prev),a._next=null,a._prev=null,a._world=null;var o=a._link1._prev,r=a._link1._next;o!=null&&(o._next=r),r!=null&&(r._prev=o),a._link1==a._b1._jointLinkList&&(a._b1._jointLinkList=a._b1._jointLinkList._next),a._link1==a._b1._jointLinkListLast&&(a._b1._jointLinkListLast=a._b1._jointLinkListLast._prev),a._link1._next=null,a._link1._prev=null;var e=a._link2._prev,_=a._link2._next;e!=null&&(e._next=_),_!=null&&(_._prev=e),a._link2==a._b2._jointLinkList&&(a._b2._jointLinkList=a._b2._jointLinkList._next),a._link2==a._b2._jointLinkListLast&&(a._b2._jointLinkListLast=a._b2._jointLinkListLast._prev),a._link2._next=null,a._link2._prev=null,a._link1._other=null,a._link2._other=null,a._b1._numJointLinks--,a._b2._numJointLinks--;var h=a._b1;h._sleeping=!1,h._sleepTime=0;var v=a._b2;v._sleeping=!1,v._sleepTime=0,this._numJoints--}setDebugDraw(a){this._debugDraw=a}getDebugDraw(){return this._debugDraw}debugDraw(){if(this._debugDraw!=null){if(this._broadPhase._type==2){var a=this._broadPhase;this._drawBvh(this._debugDraw,a._tree)}this._drawRigidBodies(this._debugDraw),this._drawConstraints(this._debugDraw)}}rayCast(a,t,i){var o=this._rayCastWrapper.begin;o.x=a.x,o.y=a.y,o.z=a.z;var r=this._rayCastWrapper.end;r.x=t.x,r.y=t.y,r.z=t.z,this._rayCastWrapper.callback=i,this._broadPhase.rayCast(a,t,this._rayCastWrapper)}convexCast(a,t,i,o){this._convexCastWrapper.convex=a;var r=this._convexCastWrapper.begin;r._positionX=t._positionX,r._positionY=t._positionY,r._positionZ=t._positionZ,r._rotation00=t._rotation00,r._rotation01=t._rotation01,r._rotation02=t._rotation02,r._rotation10=t._rotation10,r._rotation11=t._rotation11,r._rotation12=t._rotation12,r._rotation20=t._rotation20,r._rotation21=t._rotation21,r._rotation22=t._rotation22;var e=this._convexCastWrapper.translation;e.x=i.x,e.y=i.y,e.z=i.z,this._convexCastWrapper.callback=o,this._broadPhase.convexCast(a,t,i,this._convexCastWrapper)}aabbTest(a,t){this._aabbTestWrapper._aabb.copyFrom(a),this._aabbTestWrapper._callback=t,this._broadPhase.aabbTest(a,this._aabbTestWrapper)}getRigidBodyList(){return this._rigidBodyList}getJointList(){return this._jointList}getBroadPhase(){return this._broadPhase}getContactManager(){return this._contactManager}getNumRigidBodies(){return this._numRigidBodies}getNumJoints(){return this._numJoints}getNumShapes(){return this._numShapes}getNumIslands(){return this._numIslands}getNumVelocityIterations(){return this._numVelocityIterations}setNumVelocityIterations(a){this._numVelocityIterations=a}getNumPositionIterations(){return this._numPositionIterations}setNumPositionIterations(a){this._numPositionIterations=a}getGravity(){return this._gravity}setGravity(a){var t=this._gravity;t.x=a.x,t.y=a.y,t.z=a.z}};u.dynamics._World||(u.dynamics._World={});u.dynamics._World.RayCastWrapper=class extends u.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new u.collision.geometry.RayCastHit,this.begin=new u.common.Vec3,this.end=new u.common.Vec3,this.callback=null}process(a){var t=a.userData;t._geom.rayCast(this.begin,this.end,t._transform,this.rayCastHit)&&this.callback.process(t,this.rayCastHit)}};u.dynamics._World.ConvexCastWrapper=class extends u.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new u.collision.geometry.RayCastHit,this.begin=new u.common.Transform,this.translation=new u.common.Vec3,this.zero=new u.common.Vec3,this.callback=null,this.convex=null}process(a){var t=a.userData,i=t._geom._type;if(!(i<0||i>5)){var o=t._geom;u.collision.narrowphase.detector.gjkepa.GjkEpa.instance.convexCast(this.convex,o,this.begin,t._transform,this.translation,this.zero,this.rayCastHit)&&this.callback.process(t,this.rayCastHit)}}};u.dynamics._World.AabbTestWrapper=class extends u.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this._aabb=new u.collision.geometry.Aabb,this._callback=null}process(a){var t=a.userData,i=t._aabb;i._minX<this._aabb._maxX&&i._maxX>this._aabb._minX&&i._minY<this._aabb._maxY&&i._maxY>this._aabb._minY&&i._minZ<this._aabb._maxZ&&i._maxZ>this._aabb._minZ&&this._callback.process(t)}};u.dynamics.callback||(u.dynamics.callback={});u.dynamics.callback.AabbTestCallback=class{constructor(){}process(a){}};u.dynamics.callback.ContactCallback=class{constructor(){}beginContact(a){}preSolve(a){}postSolve(a){}endContact(a){}};u.dynamics.callback.RayCastCallback=class{constructor(){}process(a,t){}};u.dynamics.callback.RayCastClosest=class extends u.dynamics.callback.RayCastCallback{constructor(){super(),this.position=new u.common.Vec3,this.normal=new u.common.Vec3,this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}clear(){this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}process(a,t){if(t.fraction<this.fraction){this.shape=a,this.hit=!0,this.fraction=t.fraction;var i=this.position,o=t.position;i.x=o.x,i.y=o.y,i.z=o.z;var r=this.normal,e=t.normal;r.x=e.x,r.y=e.y,r.z=e.z}}};u.dynamics.common||(u.dynamics.common={});u.dynamics.common.DebugDraw=class{constructor(){this.p=new u.common.Pool,this.wireframe=!1,this.drawShapes=!0,this.drawBvh=!1,this.drawBvhMinLevel=0,this.drawBvhMaxLevel=65536,this.drawAabbs=!1,this.drawBases=!1,this.drawPairs=!1,this.drawContacts=!1,this.drawJoints=!0,this.drawJointLimits=!1;var a=4,t=3.14159265358979/a,i=8,o=6.28318530717958/i,r=new Array(a+1);this.sphereCoords=r;var e=new Array(a+1);this.tmpSphereVerts=e;var _=new Array(a+1);this.tmpSphereNorms=_;for(var h=0,v=a+1;h<v;){var s=h++,l=s==0||s==a?1:i,x=this.sphereCoords,b=new Array(l);x[s]=b;var f=this.tmpSphereVerts,n=new Array(l);f[s]=n;var c=this.tmpSphereNorms,z=new Array(l);c[s]=z;for(var p=0,y=i;p<y;){var V=p++,M=s*t,I=V*o;this.sphereCoords[s][V]=new u.common.Vec3(Math.sin(M)*Math.cos(I),Math.cos(M),-Math.sin(M)*Math.sin(I)),this.tmpSphereVerts[s][V]=new u.common.Vec3,this.tmpSphereNorms[s][V]=new u.common.Vec3}}var k=new Array(8);this.circleCoords=k;var X=new Array(8);this.circleCoordsShift=X;var L=new Array(8);this.tmpCircleVerts1=L;var m=new Array(8);this.tmpCircleVerts2=m;var g=new Array(8);this.tmpCircleNorms=g;for(var N=.7853981633974475,d=0;d<8;){var F=d++;this.circleCoords[F]=new u.common.Vec3(Math.cos(F*N),0,-Math.sin(F*N)),this.circleCoordsShift[F]=new u.common.Vec3(Math.cos((F+.5)*N),0,-Math.sin((F+.5)*N)),this.tmpCircleVerts1[F]=new u.common.Vec3,this.tmpCircleVerts2[F]=new u.common.Vec3,this.tmpCircleNorms[F]=new u.common.Vec3}this.style=new u.dynamics.common.DebugDrawStyle}aabb(a,t,i){var o=this.p,r=(o.sizeVec3==0?new u.common.Vec3:o.stackVec3[--o.sizeVec3]).init(a.x,a.y,a.z),e=this.p,_=(e.sizeVec3==0?new u.common.Vec3:e.stackVec3[--e.sizeVec3]).init(a.x,a.y,t.z),h=this.p,v=(h.sizeVec3==0?new u.common.Vec3:h.stackVec3[--h.sizeVec3]).init(a.x,t.y,a.z),s=this.p,l=(s.sizeVec3==0?new u.common.Vec3:s.stackVec3[--s.sizeVec3]).init(a.x,t.y,t.z),x=this.p,b=(x.sizeVec3==0?new u.common.Vec3:x.stackVec3[--x.sizeVec3]).init(t.x,a.y,a.z),f=this.p,n=(f.sizeVec3==0?new u.common.Vec3:f.stackVec3[--f.sizeVec3]).init(t.x,a.y,t.z),c=this.p,z=(c.sizeVec3==0?new u.common.Vec3:c.stackVec3[--c.sizeVec3]).init(t.x,t.y,a.z),p=this.p,y=(p.sizeVec3==0?new u.common.Vec3:p.stackVec3[--p.sizeVec3]).init(t.x,t.y,t.z);this.line(r,_,i),this.line(v,l,i),this.line(b,n,i),this.line(z,y,i),this.line(r,v,i),this.line(_,l,i),this.line(b,z,i),this.line(n,y,i),this.line(r,b,i),this.line(_,n,i),this.line(v,z,i),this.line(l,y,i);var V=this.p;if(r!=null){if(r.zero(),V.sizeVec3==V.stackVec3.length){for(var M=V.sizeVec3<<1,I=new Array(M),k=I,X=0,L=V.sizeVec3;X<L;){var m=X++;k[m]=V.stackVec3[m],V.stackVec3[m]=null}V.stackVec3=k}V.stackVec3[V.sizeVec3++]=r}var g=this.p;if(_!=null){if(_.zero(),g.sizeVec3==g.stackVec3.length){for(var N=g.sizeVec3<<1,d=new Array(N),F=d,S=0,Y=g.sizeVec3;S<Y;){var Q=S++;F[Q]=g.stackVec3[Q],g.stackVec3[Q]=null}g.stackVec3=F}g.stackVec3[g.sizeVec3++]=_}var C=this.p;if(v!=null){if(v.zero(),C.sizeVec3==C.stackVec3.length){for(var B=C.sizeVec3<<1,Z=new Array(B),$=Z,K=0,E=C.sizeVec3;K<E;){var J=K++;$[J]=C.stackVec3[J],C.stackVec3[J]=null}C.stackVec3=$}C.stackVec3[C.sizeVec3++]=v}var A=this.p;if(l!=null){if(l.zero(),A.sizeVec3==A.stackVec3.length){for(var R=A.sizeVec3<<1,U=new Array(R),G=U,D=0,H=A.sizeVec3;D<H;){var j=D++;G[j]=A.stackVec3[j],A.stackVec3[j]=null}A.stackVec3=G}A.stackVec3[A.sizeVec3++]=l}var ia=this.p;if(b!=null){if(b.zero(),ia.sizeVec3==ia.stackVec3.length){for(var ea=ia.sizeVec3<<1,W=new Array(ea),q=W,na=0,oa=ia.sizeVec3;na<oa;){var aa=na++;q[aa]=ia.stackVec3[aa],ia.stackVec3[aa]=null}ia.stackVec3=q}ia.stackVec3[ia.sizeVec3++]=b}var T=this.p;if(n!=null){if(n.zero(),T.sizeVec3==T.stackVec3.length){for(var ca=T.sizeVec3<<1,_a=new Array(ca),w=_a,ta=0,ra=T.sizeVec3;ta<ra;){var la=ta++;w[la]=T.stackVec3[la],T.stackVec3[la]=null}T.stackVec3=w}T.stackVec3[T.sizeVec3++]=n}var va=this.p;if(z!=null){if(z.zero(),va.sizeVec3==va.stackVec3.length){for(var ua=va.sizeVec3<<1,za=new Array(ua),Ma=za,Xa=0,Za=va.sizeVec3;Xa<Za;){var fa=Xa++;Ma[fa]=va.stackVec3[fa],va.stackVec3[fa]=null}va.stackVec3=Ma}va.stackVec3[va.sizeVec3++]=z}var ba=this.p;if(y!=null){if(y.zero(),ba.sizeVec3==ba.stackVec3.length){for(var sa=ba.sizeVec3<<1,ha=new Array(sa),ma=ha,ya=0,Ba=ba.sizeVec3;ya<Ba;){var pa=ya++;ma[pa]=ba.stackVec3[pa],ba.stackVec3[pa]=null}ba.stackVec3=ma}ba.stackVec3[ba.sizeVec3++]=y}}basis(a,t,i,o,r){var e=this.p,_=e.sizeVec3==0?new u.common.Vec3:e.stackVec3[--e.sizeVec3],h=this.p,v=h.sizeMat3==0?new u.common.Mat3:h.stackMat3[--h.sizeMat3],s=this.p,l=s.sizeVec3==0?new u.common.Vec3:s.stackVec3[--s.sizeVec3],x=this.p,b=x.sizeVec3==0?new u.common.Vec3:x.stackVec3[--x.sizeVec3],f=this.p,n=f.sizeVec3==0?new u.common.Vec3:f.stackVec3[--f.sizeVec3],c=_;c.x=a._positionX,c.y=a._positionY,c.z=a._positionZ;var z=v;z.e00=a._rotation00,z.e01=a._rotation01,z.e02=a._rotation02,z.e10=a._rotation10,z.e11=a._rotation11,z.e12=a._rotation12,z.e20=a._rotation20,z.e21=a._rotation21,z.e22=a._rotation22,l.init(v.e00,v.e10,v.e20),b.init(v.e01,v.e11,v.e21),n.init(v.e02,v.e12,v.e22);var p=l.x*t,y=l.y*t,V=l.z*t;l.x=p,l.y=y,l.z=V;var M=l,I=M.x+_.x,k=M.y+_.y,X=M.z+_.z;M.x=I,M.y=k,M.z=X;var L=b.x*t,m=b.y*t,g=b.z*t;b.x=L,b.y=m,b.z=g;var N=b,d=N.x+_.x,F=N.y+_.y,S=N.z+_.z;N.x=d,N.y=F,N.z=S;var Y=n.x*t,Q=n.y*t,C=n.z*t;n.x=Y,n.y=Q,n.z=C;var B=n,Z=B.x+_.x,$=B.y+_.y,K=B.z+_.z;B.x=Z,B.y=$,B.z=K,this.line(_,l,i),this.line(_,b,o),this.line(_,n,r);var E=this.p;if(_!=null){if(_.zero(),E.sizeVec3==E.stackVec3.length){for(var J=E.sizeVec3<<1,A=new Array(J),R=A,U=0,G=E.sizeVec3;U<G;){var D=U++;R[D]=E.stackVec3[D],E.stackVec3[D]=null}E.stackVec3=R}E.stackVec3[E.sizeVec3++]=_}var H=this.p;if(v!=null){var j=1,ia=0,ea=0,W=0,q=1,na=0,oa=0,aa=0,T=1;if(v.e00=j,v.e01=ia,v.e02=ea,v.e10=W,v.e11=q,v.e12=na,v.e20=oa,v.e21=aa,v.e22=T,H.sizeMat3==H.stackMat3.length){for(var ca=H.sizeMat3<<1,_a=new Array(ca),w=_a,ta=0,ra=H.sizeMat3;ta<ra;){var la=ta++;w[la]=H.stackMat3[la],H.stackMat3[la]=null}H.stackMat3=w}H.stackMat3[H.sizeMat3++]=v}var va=this.p;if(l!=null){if(l.zero(),va.sizeVec3==va.stackVec3.length){for(var ua=va.sizeVec3<<1,za=new Array(ua),Ma=za,Xa=0,Za=va.sizeVec3;Xa<Za;){var fa=Xa++;Ma[fa]=va.stackVec3[fa],va.stackVec3[fa]=null}va.stackVec3=Ma}va.stackVec3[va.sizeVec3++]=l}var ba=this.p;if(b!=null){if(b.zero(),ba.sizeVec3==ba.stackVec3.length){for(var sa=ba.sizeVec3<<1,ha=new Array(sa),ma=ha,ya=0,Ba=ba.sizeVec3;ya<Ba;){var pa=ya++;ma[pa]=ba.stackVec3[pa],ba.stackVec3[pa]=null}ba.stackVec3=ma}ba.stackVec3[ba.sizeVec3++]=b}var Ya=this.p;if(n!=null){if(n.zero(),Ya.sizeVec3==Ya.stackVec3.length){for(var Ra=Ya.sizeVec3<<1,ga=new Array(Ra),xa=ga,wa=0,ka=Ya.sizeVec3;wa<ka;){var Pa=wa++;xa[Pa]=Ya.stackVec3[Pa],Ya.stackVec3[Pa]=null}Ya.stackVec3=xa}Ya.stackVec3[Ya.sizeVec3++]=n}}ellipse(a,t,i,o,r,e){this.arc(a,t,i,o,r,0,6.28318530717958,!1,e)}arc(a,t,i,o,r,e,_,h,v){var s=this.p,l=s.sizeVec3==0?new u.common.Vec3:s.stackVec3[--s.sizeVec3];l.x=t.x,l.y=t.y,l.z=t.z;var x=l,b=x.x*o,f=x.y*o,n=x.z*o;x.x=b,x.y=f,x.z=n,t=x;var c=this.p,z=c.sizeVec3==0?new u.common.Vec3:c.stackVec3[--c.sizeVec3];z.x=i.x,z.y=i.y,z.z=i.z;var p=z,y=p.x*r,V=p.y*r,M=p.z*r;p.x=y,p.y=V,p.z=M,i=p;var I=.5235987755982984,k=_-e;k<0&&(k=-k);var X=k/I+.5|0;X==0&&(X=1);var L=e,m=(_-e)/X,g=this.p,N=g.sizeVec3==0?new u.common.Vec3:g.stackVec3[--g.sizeVec3];N.x=a.x,N.y=a.y,N.z=a.z;var d=N,F=Math.cos(L),S=d.x+t.x*F,Y=d.y+t.y*F,Q=d.z+t.z*F;d.x=S,d.y=Y,d.z=Q;var C=d,B=Math.sin(L),Z=C.x+i.x*B,$=C.y+i.y*B,K=C.z+i.z*B;C.x=Z,C.y=$,C.z=K;var E=C,J=E;h&&this.line(a,J,v);for(var A=0,R=X;A<R;){A++,L+=m;var U=this.p,G=U.sizeVec3==0?new u.common.Vec3:U.stackVec3[--U.sizeVec3];G.x=a.x,G.y=a.y,G.z=a.z;var D=G,H=Math.cos(L),j=D.x+t.x*H,ia=D.y+t.y*H,ea=D.z+t.z*H;D.x=j,D.y=ia,D.z=ea;var W=D,q=Math.sin(L),na=W.x+i.x*q,oa=W.y+i.y*q,aa=W.z+i.z*q;W.x=na,W.y=oa,W.z=aa;var T=W,ca=T;this.line(J,ca,v);var _a=this.p,w=null,ta=null,ra=null;if(J!=null){if(J.zero(),_a.sizeVec3==_a.stackVec3.length){for(var la=_a.sizeVec3<<1,va=new Array(la),ua=va,za=0,Ma=_a.sizeVec3;za<Ma;){var Xa=za++;ua[Xa]=_a.stackVec3[Xa],_a.stackVec3[Xa]=null}_a.stackVec3=ua}_a.stackVec3[_a.sizeVec3++]=J}if(w!=null){var Za=1,fa=0,ba=0,sa=0,ha=1,ma=0,ya=0,Ba=0,pa=1;if(w.e00=Za,w.e01=fa,w.e02=ba,w.e10=sa,w.e11=ha,w.e12=ma,w.e20=ya,w.e21=Ba,w.e22=pa,_a.sizeMat3==_a.stackMat3.length){for(var Ya=_a.sizeMat3<<1,Ra=new Array(Ya),ga=Ra,xa=0,wa=_a.sizeMat3;xa<wa;){var ka=xa++;ga[ka]=_a.stackMat3[ka],_a.stackMat3[ka]=null}_a.stackMat3=ga}_a.stackMat3[_a.sizeMat3++]=w}if(ta!=null){var Pa=1,zt=0,Oa=0,Aa=0,nt=0,Ea=1,Fa=0,da=0,ft=0,Wa=0,Ha=1,bt=0,it=0,Ka=0,_t=0,gt=1;if(ta.e00=Pa,ta.e01=zt,ta.e02=Oa,ta.e03=Aa,ta.e10=nt,ta.e11=Ea,ta.e12=Fa,ta.e13=da,ta.e20=ft,ta.e21=Wa,ta.e22=Ha,ta.e23=bt,ta.e30=it,ta.e31=Ka,ta.e32=_t,ta.e33=gt,_a.sizeMat4==_a.stackMat4.length){for(var pt=_a.sizeMat4<<1,Ga=new Array(pt),rt=Ga,xt=0,Da=_a.sizeMat4;xt<Da;){var Ta=xt++;rt[Ta]=_a.stackMat4[Ta],_a.stackMat4[Ta]=null}_a.stackMat4=rt}_a.stackMat4[_a.sizeMat4++]=ta}if(ra!=null){var Na=0,Vt=0,Pt=0,st=1;if(ra.x=Na,ra.y=Vt,ra.z=Pt,ra.w=st,_a.sizeQuat==_a.stackQuat.length){for(var Xt=_a.sizeQuat<<1,Yt=new Array(Xt),Mt=Yt,Ia=0,O=_a.sizeQuat;Ia<O;){var Va=Ia++;Mt[Va]=_a.stackQuat[Va],_a.stackQuat[Va]=null}_a.stackQuat=Mt}_a.stackQuat[_a.sizeQuat++]=ra}J=ca}h&&this.line(a,J,v);var lt=this.p;if(J!=null){if(J.zero(),lt.sizeVec3==lt.stackVec3.length){for(var P=lt.sizeVec3<<1,wt=new Array(P),At=wt,dt=0,yt=lt.sizeVec3;dt<yt;){var kt=dt++;At[kt]=lt.stackVec3[kt],lt.stackVec3[kt]=null}lt.stackVec3=At}lt.stackVec3[lt.sizeVec3++]=J}var mt=this.p;if(t!=null){if(t.zero(),mt.sizeVec3==mt.stackVec3.length){for(var ht=mt.sizeVec3<<1,ut=new Array(ht),Qa=ut,et=0,Ca=mt.sizeVec3;et<Ca;){var vt=et++;Qa[vt]=mt.stackVec3[vt],mt.stackVec3[vt]=null}mt.stackVec3=Qa}mt.stackVec3[mt.sizeVec3++]=t}var qa=this.p;if(i!=null){if(i.zero(),qa.sizeVec3==qa.stackVec3.length){for(var at=qa.sizeVec3<<1,Ua=new Array(at),tt=Ua,ct=0,Sa=qa.sizeVec3;ct<Sa;){var Ja=ct++;tt[Ja]=qa.stackVec3[Ja],qa.stackVec3[Ja]=null}qa.stackVec3=tt}qa.stackVec3[qa.sizeVec3++]=i}}cone(a,t,i,o){var r=this.p,e=r.sizeVec3==0?new u.common.Vec3:r.stackVec3[--r.sizeVec3],_=this.p,h=_.sizeVec3==0?new u.common.Vec3:_.stackVec3[--_.sizeVec3],v=this.p,s=v.sizeVec3==0?new u.common.Vec3:v.stackVec3[--v.sizeVec3],l=this.p,x=l.sizeVec3==0?new u.common.Vec3:l.stackVec3[--l.sizeVec3],b=this.p,f=b.sizeMat3==0?new u.common.Mat3:b.stackMat3[--b.sizeMat3],n=x;n.x=a._positionX,n.y=a._positionY,n.z=a._positionZ;var c=f;c.e00=a._rotation00,c.e01=a._rotation01,c.e02=a._rotation02,c.e10=a._rotation10,c.e11=a._rotation11,c.e12=a._rotation12,c.e20=a._rotation20,c.e21=a._rotation21,c.e22=a._rotation22,e.init(f.e00,f.e10,f.e20),h.init(f.e01,f.e11,f.e21),s.init(f.e02,f.e12,f.e22);var z=this.p,p=z.sizeVec3==0?new u.common.Vec3:z.stackVec3[--z.sizeVec3];p.x=x.x,p.y=x.y,p.z=x.z;var y=p,V=y.x+h.x*i,M=y.y+h.y*i,I=y.z+h.z*i;y.x=V,y.y=M,y.z=I;var k=y,X=this.p,L=X.sizeVec3==0?new u.common.Vec3:X.stackVec3[--X.sizeVec3];L.x=x.x,L.y=x.y,L.z=x.z;var m=L,g=-i,N=m.x+h.x*g,d=m.y+h.y*g,F=m.z+h.z*g;m.x=N,m.y=d,m.z=F;var S=m;if(this.wireframe){var Y=this.p,Q=Y.sizeVec3==0?new u.common.Vec3:Y.stackVec3[--Y.sizeVec3];Q.x=S.x,Q.y=S.y,Q.z=S.z;var C=Q,B=-t,Z=C.x+e.x*B,$=C.y+e.y*B,K=C.z+e.z*B;C.x=Z,C.y=$,C.z=K;var E=C,J=E.x+s.x*0,A=E.y+s.y*0,R=E.z+s.z*0;E.x=J,E.y=A,E.z=R;var U=E,G=this.p,D=G.sizeVec3==0?new u.common.Vec3:G.stackVec3[--G.sizeVec3];D.x=S.x,D.y=S.y,D.z=S.z;var H=D,j=H.x+e.x*t,ia=H.y+e.y*t,ea=H.z+e.z*t;H.x=j,H.y=ia,H.z=ea;var W=H,q=W.x+s.x*0,na=W.y+s.y*0,oa=W.z+s.z*0;W.x=q,W.y=na,W.z=oa;var aa=W,T=this.p,ca=T.sizeVec3==0?new u.common.Vec3:T.stackVec3[--T.sizeVec3];ca.x=S.x,ca.y=S.y,ca.z=S.z;var _a=ca,w=_a.x+e.x*0,ta=_a.y+e.y*0,ra=_a.z+e.z*0;_a.x=w,_a.y=ta,_a.z=ra;var la=_a,va=-t,ua=la.x+s.x*va,za=la.y+s.y*va,Ma=la.z+s.z*va;la.x=ua,la.y=za,la.z=Ma;var Xa=la,Za=this.p,fa=Za.sizeVec3==0?new u.common.Vec3:Za.stackVec3[--Za.sizeVec3];fa.x=S.x,fa.y=S.y,fa.z=S.z;var ba=fa,sa=ba.x+e.x*0,ha=ba.y+e.y*0,ma=ba.z+e.z*0;ba.x=sa,ba.y=ha,ba.z=ma;var ya=ba,Ba=ya.x+s.x*t,pa=ya.y+s.y*t,Ya=ya.z+s.z*t;ya.x=Ba,ya.y=pa,ya.z=Ya;var Ra=ya;this.ellipse(S,e,s,t,t,o),this.line(k,U,o),this.line(k,aa,o),this.line(k,Xa,o),this.line(k,Ra,o);var ga=this.p,xa=null,wa=null,ka=null;if(U!=null){if(U.zero(),ga.sizeVec3==ga.stackVec3.length){for(var Pa=ga.sizeVec3<<1,zt=new Array(Pa),Oa=zt,Aa=0,nt=ga.sizeVec3;Aa<nt;){var Ea=Aa++;Oa[Ea]=ga.stackVec3[Ea],ga.stackVec3[Ea]=null}ga.stackVec3=Oa}ga.stackVec3[ga.sizeVec3++]=U}if(xa!=null){var Fa=1,da=0,ft=0,Wa=0,Ha=1,bt=0,it=0,Ka=0,_t=1;if(xa.e00=Fa,xa.e01=da,xa.e02=ft,xa.e10=Wa,xa.e11=Ha,xa.e12=bt,xa.e20=it,xa.e21=Ka,xa.e22=_t,ga.sizeMat3==ga.stackMat3.length){for(var gt=ga.sizeMat3<<1,pt=new Array(gt),Ga=pt,rt=0,xt=ga.sizeMat3;rt<xt;){var Da=rt++;Ga[Da]=ga.stackMat3[Da],ga.stackMat3[Da]=null}ga.stackMat3=Ga}ga.stackMat3[ga.sizeMat3++]=xa}if(wa!=null){var Ta=1,Na=0,Vt=0,Pt=0,st=0,Xt=1,Yt=0,Mt=0,Ia=0,O=0,Va=1,lt=0,P=0,wt=0,At=0,dt=1;if(wa.e00=Ta,wa.e01=Na,wa.e02=Vt,wa.e03=Pt,wa.e10=st,wa.e11=Xt,wa.e12=Yt,wa.e13=Mt,wa.e20=Ia,wa.e21=O,wa.e22=Va,wa.e23=lt,wa.e30=P,wa.e31=wt,wa.e32=At,wa.e33=dt,ga.sizeMat4==ga.stackMat4.length){for(var yt=ga.sizeMat4<<1,kt=new Array(yt),mt=kt,ht=0,ut=ga.sizeMat4;ht<ut;){var Qa=ht++;mt[Qa]=ga.stackMat4[Qa],ga.stackMat4[Qa]=null}ga.stackMat4=mt}ga.stackMat4[ga.sizeMat4++]=wa}if(ka!=null){var et=0,Ca=0,vt=0,qa=1;if(ka.x=et,ka.y=Ca,ka.z=vt,ka.w=qa,ga.sizeQuat==ga.stackQuat.length){for(var at=ga.sizeQuat<<1,Ua=new Array(at),tt=Ua,ct=0,Sa=ga.sizeQuat;ct<Sa;){var Ja=ct++;tt[Ja]=ga.stackQuat[Ja],ga.stackQuat[Ja]=null}ga.stackQuat=tt}ga.stackQuat[ga.sizeQuat++]=ka}var ja=this.p,La=null,ot=null,It=null;if(aa!=null){if(aa.zero(),ja.sizeVec3==ja.stackVec3.length){for(var oi=ja.sizeVec3<<1,gi=new Array(oi),ai=gi,Ct=0,_i=ja.sizeVec3;Ct<_i;){var Et=Ct++;ai[Et]=ja.stackVec3[Et],ja.stackVec3[Et]=null}ja.stackVec3=ai}ja.stackVec3[ja.sizeVec3++]=aa}if(La!=null){var St=1,Jt=0,Ki=0,vi=0,li=1,ti=0,Oi=0,Xi=0,zi=1;if(La.e00=St,La.e01=Jt,La.e02=Ki,La.e10=vi,La.e11=li,La.e12=ti,La.e20=Oi,La.e21=Xi,La.e22=zi,ja.sizeMat3==ja.stackMat3.length){for(var Zt=ja.sizeMat3<<1,ri=new Array(Zt),Wt=ri,ni=0,$i=ja.sizeMat3;ni<$i;){var Ut=ni++;Wt[Ut]=ja.stackMat3[Ut],ja.stackMat3[Ut]=null}ja.stackMat3=Wt}ja.stackMat3[ja.sizeMat3++]=La}if(ot!=null){var ji=1,Ii=0,pr=0,Wi=0,Lt=0,jt=1,Tt=0,bi=0,Mi=0,vr=0,qt=1,fi=0,Bt=0,xi=0,hi=0,sr=1;if(ot.e00=ji,ot.e01=Ii,ot.e02=pr,ot.e03=Wi,ot.e10=Lt,ot.e11=jt,ot.e12=Tt,ot.e13=bi,ot.e20=Mi,ot.e21=vr,ot.e22=qt,ot.e23=fi,ot.e30=Bt,ot.e31=xi,ot.e32=hi,ot.e33=sr,ja.sizeMat4==ja.stackMat4.length){for(var Xr=ja.sizeMat4<<1,ro=new Array(Xr),Gt=ro,fr=0,mr=ja.sizeMat4;fr<mr;){var Dt=fr++;Gt[Dt]=ja.stackMat4[Dt],ja.stackMat4[Dt]=null}ja.stackMat4=Gt}ja.stackMat4[ja.sizeMat4++]=ot}if(It!=null){var Br=0,Si=0,Dr=0,Hn=1;if(It.x=Br,It.y=Si,It.z=Dr,It.w=Hn,ja.sizeQuat==ja.stackQuat.length){for(var oo=ja.sizeQuat<<1,Ar=new Array(oo),no=Ar,yn=0,Ao=ja.sizeQuat;yn<Ao;){var Io=yn++;no[Io]=ja.stackQuat[Io],ja.stackQuat[Io]=null}ja.stackQuat=no}ja.stackQuat[ja.sizeQuat++]=It}var ui=this.p,qr=null,dr=null,yr=null;if(Xa!=null){if(Xa.zero(),ui.sizeVec3==ui.stackVec3.length){for(var So=ui.sizeVec3<<1,Di=new Array(So),Sr=Di,gr=0,Qt=ui.sizeVec3;gr<Qt;){var Hi=gr++;Sr[Hi]=ui.stackVec3[Hi],ui.stackVec3[Hi]=null}ui.stackVec3=Sr}ui.stackVec3[ui.sizeVec3++]=Xa}if(qr!=null){var Li=1,Cn=0,Me=0,js=0,pe=1,Ts=0,qs=0,D_=0,gn=1;if(qr.e00=Li,qr.e01=Cn,qr.e02=Me,qr.e10=js,qr.e11=pe,qr.e12=Ts,qr.e20=qs,qr.e21=D_,qr.e22=gn,ui.sizeMat3==ui.stackMat3.length){for(var Pi=ui.sizeMat3<<1,No=new Array(Pi),Wr=No,ks=0,on=ui.sizeMat3;ks<on;){var Tn=ks++;Wr[Tn]=ui.stackMat3[Tn],ui.stackMat3[Tn]=null}ui.stackMat3=Wr}ui.stackMat3[ui.sizeMat3++]=qr}if(dr!=null){var Kn=1,ws=0,k_=0,Qs=0,Vi=0,Ir=1,xr=0,so=0,Qn=0,me=0,nn=1,Rn=0,ci=0,ho=0,Fr=0,En=1;if(dr.e00=Kn,dr.e01=ws,dr.e02=k_,dr.e03=Qs,dr.e10=Vi,dr.e11=Ir,dr.e12=xr,dr.e13=so,dr.e20=Qn,dr.e21=me,dr.e22=nn,dr.e23=Rn,dr.e30=ci,dr.e31=ho,dr.e32=Fr,dr.e33=En,ui.sizeMat4==ui.stackMat4.length){for(var ae=ui.sizeMat4<<1,Rs=new Array(ae),Es=Rs,Ds=0,hs=ui.sizeMat4;Ds<hs;){var ii=Ds++;Es[ii]=ui.stackMat4[ii],ui.stackMat4[ii]=null}ui.stackMat4=Es}ui.stackMat4[ui.sizeMat4++]=dr}if(yr!=null){var ir=0,Ri=0,Fi=0,fo=1;if(yr.x=ir,yr.y=Ri,yr.z=Fi,yr.w=fo,ui.sizeQuat==ui.stackQuat.length){for(var Po=ui.sizeQuat<<1,e_=new Array(Po),Fs=e_,te=0,Dn=ui.sizeQuat;te<Dn;){var co=te++;Fs[co]=ui.stackQuat[co],ui.stackQuat[co]=null}ui.stackQuat=Fs}ui.stackQuat[ui.sizeQuat++]=yr}var Ft=this.p,Ni=null,lr=null,Vo=null;if(Ra!=null){if(Ra.zero(),Ft.sizeVec3==Ft.stackVec3.length){for(var cs=Ft.sizeVec3<<1,Xs=new Array(cs),Ls=Xs,xo=0,$t=Ft.sizeVec3;xo<$t;){var Vr=xo++;Ls[Vr]=Ft.stackVec3[Vr],Ft.stackVec3[Vr]=null}Ft.stackVec3=Ls}Ft.stackVec3[Ft.sizeVec3++]=Ra}if(Ni!=null){var er=1,Jo=0,Ne=0,Co=0,ko=1,Nr=0,Pr=0,Cr=0,Lr=1;if(Ni.e00=er,Ni.e01=Jo,Ni.e02=Ne,Ni.e10=Co,Ni.e11=ko,Ni.e12=Nr,Ni.e20=Pr,Ni.e21=Cr,Ni.e22=Lr,Ft.sizeMat3==Ft.stackMat3.length){for(var Rt=Ft.sizeMat3<<1,Ji=new Array(Rt),Yi=Ji,Qi=0,zr=Ft.sizeMat3;Qi<zr;){var qi=Qi++;Yi[qi]=Ft.stackMat3[qi],Ft.stackMat3[qi]=null}Ft.stackMat3=Yi}Ft.stackMat3[Ft.sizeMat3++]=Ni}if(lr!=null){var Jr=1,Gr=0,ao=0,bs=0,ki=0,sn=1,Yr=0,Go=0,ye=0,In=0,ge=1,Vn=0,Ci=0,To=0,eo=0,Fn=1;if(lr.e00=Jr,lr.e01=Gr,lr.e02=ao,lr.e03=bs,lr.e10=ki,lr.e11=sn,lr.e12=Yr,lr.e13=Go,lr.e20=ye,lr.e21=In,lr.e22=ge,lr.e23=Vn,lr.e30=Ci,lr.e31=To,lr.e32=eo,lr.e33=Fn,Ft.sizeMat4==Ft.stackMat4.length){for(var Ns=Ft.sizeMat4<<1,Nn=new Array(Ns),Wo=Nn,kn=0,Ys=Ft.sizeMat4;kn<Ys;){var Ot=kn++;Wo[Ot]=Ft.stackMat4[Ot],Ft.stackMat4[Ot]=null}Ft.stackMat4=Wo}Ft.stackMat4[Ft.sizeMat4++]=lr}if(Vo!=null){var Qo=0,Ur=0,wn=0,Jn=1;if(Vo.x=Qo,Vo.y=Ur,Vo.z=wn,Vo.w=Jn,Ft.sizeQuat==Ft.stackQuat.length){for(var fs=Ft.sizeQuat<<1,Ie=new Array(fs),Uo=Ie,Ve=0,w_=Ft.sizeQuat;Ve<w_;){var Je=Ve++;Uo[Je]=Ft.stackQuat[Je],Ft.stackQuat[Je]=null}Ft.stackQuat=Uo}Ft.stackQuat[Ft.sizeQuat++]=Vo}}else{for(var X_=1/Math.sqrt(t*t+4*i*i),Js=2*i*X_,F_=t*X_,N_=0;N_<8;){var Or=N_++,wo=this.tmpCircleNorms[Or],Xo=this.circleCoords[Or];wo.x=Xo.x,wo.y=Xo.y,wo.z=Xo.z;var Gn=wo,wi=Gn.x*Js,Wn=Gn.y*Js,Ro=Gn.z*Js;Gn.x=wi,Gn.y=Wn,Gn.z=Ro,Gn.y+=F_;var to=this.tmpCircleNorms[Or],J_=to.x*f.e00+to.y*f.e01+to.z*f.e02,G_=to.x*f.e10+to.y*f.e11+to.z*f.e12,L_=to.x*f.e20+to.y*f.e21+to.z*f.e22;to.x=J_,to.y=G_,to.z=L_;var ie=this.tmpCircleVerts1[Or],__=this.circleCoordsShift[Or];ie.x=__.x,ie.y=__.y,ie.z=__.z;var v_=ie,re=v_.x*Js,pi=v_.y*Js,Oo=v_.z*Js;v_.x=re,v_.y=pi,v_.z=Oo,v_.y+=F_;var ar=this.tmpCircleVerts1[Or],Zs=ar.x*f.e00+ar.y*f.e01+ar.z*f.e02,Ge=ar.x*f.e10+ar.y*f.e11+ar.z*f.e12,hv=ar.x*f.e20+ar.y*f.e21+ar.z*f.e22;ar.x=Zs,ar.y=Ge,ar.z=hv;var xs=this.tmpCircleVerts2[Or],Gs=this.circleCoords[Or];xs.x=Gs.x,xs.y=Gs.y,xs.z=Gs.z;var $n=xs,We=$n.x*f.e00+$n.y*f.e01+$n.z*f.e02,Ti=$n.x*f.e10+$n.y*f.e11+$n.z*f.e12,Lo=$n.x*f.e20+$n.y*f.e21+$n.z*f.e22;$n.x=We,$n.y=Ti,$n.z=Lo;var Tr=$n,en=Tr.x*t,ke=Tr.y*t,Y_=Tr.z*t;Tr.x=en,Tr.y=ke,Tr.z=Y_;var Ws=Tr,jn=Ws.x+x.x,Xn=Ws.y+x.y,oe=Ws.z+x.z;Ws.x=jn,Ws.y=Xn,Ws.z=oe;var Bs=this.tmpCircleVerts2[Or],ne=-i,Ue=Bs.x+h.x*ne,l_=Bs.y+h.y*ne,As=Bs.z+h.z*ne;Bs.x=Ue,Bs.y=l_,Bs.z=As}for(var ds=0;ds<8;){var qn=ds++,mi=k,uo=this.tmpCircleVerts2[qn],Zr=this.tmpCircleVerts2[(qn+1)%8],Ho=this.tmpCircleVerts1[qn],Yo=this.tmpCircleNorms[qn],Hr=this.tmpCircleNorms[(qn+1)%8];this.triangle(mi,uo,Zr,Ho,Yo,Hr,o),mi=S,uo=this.tmpCircleVerts2[(qn+1)%8],Zr=this.tmpCircleVerts2[qn];var Eo=this.p,we=Eo.sizeVec3==0?new u.common.Vec3:Eo.stackVec3[--Eo.sizeVec3];we.x=h.x,we.y=h.y,we.z=h.z;var as=we,Oe=-as.x,W_=-as.y,ts=-as.z;as.x=Oe,as.y=W_,as.z=ts,Ho=as,this.triangle(mi,uo,Zr,Ho,Ho,Ho,o);var Nt=this.p,Kr=null,Do=null,Xe=null;if(Ho!=null){if(Ho.zero(),Nt.sizeVec3==Nt.stackVec3.length){for(var kv=Nt.sizeVec3<<1,i0=new Array(kv),U_=i0,Ht=0,Ln=Nt.sizeVec3;Ht<Ln;){var Qr=Ht++;U_[Qr]=Nt.stackVec3[Qr],Nt.stackVec3[Qr]=null}Nt.stackVec3=U_}Nt.stackVec3[Nt.sizeVec3++]=Ho}if(Kr!=null){var Yn=1,Z_=0,He=0,h_=0,bo=1,se=0,ee=0,us=0,Zi=1;if(Kr.e00=Yn,Kr.e01=Z_,Kr.e02=He,Kr.e10=h_,Kr.e11=bo,Kr.e12=se,Kr.e20=ee,Kr.e21=us,Kr.e22=Zi,Nt.sizeMat3==Nt.stackMat3.length){for(var Ko=Nt.sizeMat3<<1,kr=new Array(Ko),Zo=kr,Us=0,cv=Nt.sizeMat3;Us<cv;){var zs=Us++;Zo[zs]=Nt.stackMat3[zs],Nt.stackMat3[zs]=null}Nt.stackMat3=Zo}Nt.stackMat3[Nt.sizeMat3++]=Kr}if(Do!=null){var Ke=1,wv=0,Os=0,si=0,Zn=0,_n=1,vn=0,B_=0,bv=0,is=0,Ss=1,c_=0,O_=0,fv=0,xv=0,b_=1;if(Do.e00=Ke,Do.e01=wv,Do.e02=Os,Do.e03=si,Do.e10=Zn,Do.e11=_n,Do.e12=vn,Do.e13=B_,Do.e20=bv,Do.e21=is,Do.e22=Ss,Do.e23=c_,Do.e30=O_,Do.e31=fv,Do.e32=xv,Do.e33=b_,Nt.sizeMat4==Nt.stackMat4.length){for(var Hs=Nt.sizeMat4<<1,zo=new Array(Hs),_e=zo,ve=0,Ui=Nt.sizeMat4;ve<Ui;){var Mo=ve++;_e[Mo]=Nt.stackMat4[Mo],Nt.stackMat4[Mo]=null}Nt.stackMat4=_e}Nt.stackMat4[Nt.sizeMat4++]=Do}if(Xe!=null){var _o=0,le=0,Le=0,Ye=1;if(Xe.x=_o,Xe.y=le,Xe.z=Le,Xe.w=Ye,Nt.sizeQuat==Nt.stackQuat.length){for(var Ze=Nt.sizeQuat<<1,A_=new Array(Ze),Ms=A_,he=0,H_=Nt.sizeQuat;he<H_;){var $e=he++;Ms[$e]=Nt.stackQuat[$e],Nt.stackQuat[$e]=null}Nt.stackQuat=Ms}Nt.stackQuat[Nt.sizeQuat++]=Xe}}}var Un=this.p;if(k!=null){if(k.zero(),Un.sizeVec3==Un.stackVec3.length){for(var ps=Un.sizeVec3<<1,Xv=new Array(ps),d_=Xv,$o=0,ln=Un.sizeVec3;$o<ln;){var po=$o++;d_[po]=Un.stackVec3[po],Un.stackVec3[po]=null}Un.stackVec3=d_}Un.stackVec3[Un.sizeVec3++]=k}var Kt=this.p;if(S!=null){if(S.zero(),Kt.sizeVec3==Kt.stackVec3.length){for(var $r=Kt.sizeVec3<<1,vo=new Array($r),je=vo,Be=0,qe=Kt.sizeVec3;Be<qe;){var S_=Be++;je[S_]=Kt.stackVec3[S_],Kt.stackVec3[S_]=null}Kt.stackVec3=je}Kt.stackVec3[Kt.sizeVec3++]=S}var jo=this.p;if(x!=null){if(x.zero(),jo.sizeVec3==jo.stackVec3.length){for(var rs=jo.sizeVec3<<1,K_=new Array(rs),uv=K_,Bi=0,mo=jo.sizeVec3;Bi<mo;){var Rr=Bi++;uv[Rr]=jo.stackVec3[Rr],jo.stackVec3[Rr]=null}jo.stackVec3=uv}jo.stackVec3[jo.sizeVec3++]=x}var io=this.p;if(f!=null){var $_=1,j_=0,Lv=0,a_=0,Yv=1,q_=0,Ai=0,av=0,Ae=1;if(f.e00=$_,f.e01=j_,f.e02=Lv,f.e10=a_,f.e11=Yv,f.e12=q_,f.e20=Ai,f.e21=av,f.e22=Ae,io.sizeMat3==io.stackMat3.length){for(var de=io.sizeMat3<<1,ce=new Array(de),be=ce,Se=0,Zv=io.sizeMat3;Se<Zv;){var ms=Se++;be[ms]=io.stackMat3[ms],io.stackMat3[ms]=null}io.stackMat3=be}io.stackMat3[io.sizeMat3++]=f}var jr=this.p;if(e!=null){if(e.zero(),jr.sizeVec3==jr.stackVec3.length){for(var t_=jr.sizeVec3<<1,yo=new Array(t_),i_=yo,Fo=0,Pe=jr.sizeVec3;Fo<Pe;){var qo=Fo++;i_[qo]=jr.stackVec3[qo],jr.stackVec3[qo]=null}jr.stackVec3=i_}jr.stackVec3[jr.sizeVec3++]=e}var ys=this.p;if(h!=null){if(h.zero(),ys.sizeVec3==ys.stackVec3.length){for(var ei=ys.sizeVec3<<1,an=new Array(ei),_r=an,os=0,gs=ys.sizeVec3;os<gs;){var Bo=os++;_r[Bo]=ys.stackVec3[Bo],ys.stackVec3[Bo]=null}ys.stackVec3=_r}ys.stackVec3[ys.sizeVec3++]=h}var Er=this.p;if(s!=null){if(s.zero(),Er.sizeVec3==Er.stackVec3.length){for(var Bn=Er.sizeVec3<<1,tv=new Array(Bn),r_=tv,P_=0,iv=Er.sizeVec3;P_<iv;){var ns=P_++;r_[ns]=Er.stackVec3[ns],Er.stackVec3[ns]=null}Er.stackVec3=r_}Er.stackVec3[Er.sizeVec3++]=s}}cylinder(a,t,i,o){var r=this.p,e=r.sizeVec3==0?new u.common.Vec3:r.stackVec3[--r.sizeVec3],_=this.p,h=_.sizeVec3==0?new u.common.Vec3:_.stackVec3[--_.sizeVec3],v=this.p,s=v.sizeVec3==0?new u.common.Vec3:v.stackVec3[--v.sizeVec3],l=this.p,x=l.sizeVec3==0?new u.common.Vec3:l.stackVec3[--l.sizeVec3],b=this.p,f=b.sizeMat3==0?new u.common.Mat3:b.stackMat3[--b.sizeMat3],n=x;n.x=a._positionX,n.y=a._positionY,n.z=a._positionZ;var c=f;c.e00=a._rotation00,c.e01=a._rotation01,c.e02=a._rotation02,c.e10=a._rotation10,c.e11=a._rotation11,c.e12=a._rotation12,c.e20=a._rotation20,c.e21=a._rotation21,c.e22=a._rotation22,e.init(f.e00,f.e10,f.e20),h.init(f.e01,f.e11,f.e21),s.init(f.e02,f.e12,f.e22);var z=this.p,p=z.sizeVec3==0?new u.common.Vec3:z.stackVec3[--z.sizeVec3];p.x=x.x,p.y=x.y,p.z=x.z;var y=p,V=y.x+h.x*i,M=y.y+h.y*i,I=y.z+h.z*i;y.x=V,y.y=M,y.z=I;var k=y,X=this.p,L=X.sizeVec3==0?new u.common.Vec3:X.stackVec3[--X.sizeVec3];L.x=x.x,L.y=x.y,L.z=x.z;var m=L,g=-i,N=m.x+h.x*g,d=m.y+h.y*g,F=m.z+h.z*g;m.x=N,m.y=d,m.z=F;var S=m;if(this.wireframe){var Y=this.p,Q=Y.sizeVec3==0?new u.common.Vec3:Y.stackVec3[--Y.sizeVec3];Q.x=k.x,Q.y=k.y,Q.z=k.z;var C=Q,B=-t,Z=C.x+e.x*B,$=C.y+e.y*B,K=C.z+e.z*B;C.x=Z,C.y=$,C.z=K;var E=C,J=E.x+s.x*0,A=E.y+s.y*0,R=E.z+s.z*0;E.x=J,E.y=A,E.z=R;var U=E,G=this.p,D=G.sizeVec3==0?new u.common.Vec3:G.stackVec3[--G.sizeVec3];D.x=k.x,D.y=k.y,D.z=k.z;var H=D,j=H.x+e.x*t,ia=H.y+e.y*t,ea=H.z+e.z*t;H.x=j,H.y=ia,H.z=ea;var W=H,q=W.x+s.x*0,na=W.y+s.y*0,oa=W.z+s.z*0;W.x=q,W.y=na,W.z=oa;var aa=W,T=this.p,ca=T.sizeVec3==0?new u.common.Vec3:T.stackVec3[--T.sizeVec3];ca.x=k.x,ca.y=k.y,ca.z=k.z;var _a=ca,w=_a.x+e.x*0,ta=_a.y+e.y*0,ra=_a.z+e.z*0;_a.x=w,_a.y=ta,_a.z=ra;var la=_a,va=-t,ua=la.x+s.x*va,za=la.y+s.y*va,Ma=la.z+s.z*va;la.x=ua,la.y=za,la.z=Ma;var Xa=la,Za=this.p,fa=Za.sizeVec3==0?new u.common.Vec3:Za.stackVec3[--Za.sizeVec3];fa.x=k.x,fa.y=k.y,fa.z=k.z;var ba=fa,sa=ba.x+e.x*0,ha=ba.y+e.y*0,ma=ba.z+e.z*0;ba.x=sa,ba.y=ha,ba.z=ma;var ya=ba,Ba=ya.x+s.x*t,pa=ya.y+s.y*t,Ya=ya.z+s.z*t;ya.x=Ba,ya.y=pa,ya.z=Ya;var Ra=ya,ga=this.p,xa=ga.sizeVec3==0?new u.common.Vec3:ga.stackVec3[--ga.sizeVec3];xa.x=S.x,xa.y=S.y,xa.z=S.z;var wa=xa,ka=-t,Pa=wa.x+e.x*ka,zt=wa.y+e.y*ka,Oa=wa.z+e.z*ka;wa.x=Pa,wa.y=zt,wa.z=Oa;var Aa=wa,nt=Aa.x+s.x*0,Ea=Aa.y+s.y*0,Fa=Aa.z+s.z*0;Aa.x=nt,Aa.y=Ea,Aa.z=Fa;var da=Aa,ft=this.p,Wa=ft.sizeVec3==0?new u.common.Vec3:ft.stackVec3[--ft.sizeVec3];Wa.x=S.x,Wa.y=S.y,Wa.z=S.z;var Ha=Wa,bt=Ha.x+e.x*t,it=Ha.y+e.y*t,Ka=Ha.z+e.z*t;Ha.x=bt,Ha.y=it,Ha.z=Ka;var _t=Ha,gt=_t.x+s.x*0,pt=_t.y+s.y*0,Ga=_t.z+s.z*0;_t.x=gt,_t.y=pt,_t.z=Ga;var rt=_t,xt=this.p,Da=xt.sizeVec3==0?new u.common.Vec3:xt.stackVec3[--xt.sizeVec3];Da.x=S.x,Da.y=S.y,Da.z=S.z;var Ta=Da,Na=Ta.x+e.x*0,Vt=Ta.y+e.y*0,Pt=Ta.z+e.z*0;Ta.x=Na,Ta.y=Vt,Ta.z=Pt;var st=Ta,Xt=-t,Yt=st.x+s.x*Xt,Mt=st.y+s.y*Xt,Ia=st.z+s.z*Xt;st.x=Yt,st.y=Mt,st.z=Ia;var O=st,Va=this.p,lt=Va.sizeVec3==0?new u.common.Vec3:Va.stackVec3[--Va.sizeVec3];lt.x=S.x,lt.y=S.y,lt.z=S.z;var P=lt,wt=P.x+e.x*0,At=P.y+e.y*0,dt=P.z+e.z*0;P.x=wt,P.y=At,P.z=dt;var yt=P,kt=yt.x+s.x*t,mt=yt.y+s.y*t,ht=yt.z+s.z*t;yt.x=kt,yt.y=mt,yt.z=ht;var ut=yt;this.ellipse(k,e,s,t,t,o),this.ellipse(S,e,s,t,t,o),this.line(U,da,o),this.line(aa,rt,o),this.line(Xa,O,o),this.line(Ra,ut,o);var Qa=this.p,et=null,Ca=null,vt=null;if(U!=null){if(U.zero(),Qa.sizeVec3==Qa.stackVec3.length){for(var qa=Qa.sizeVec3<<1,at=new Array(qa),Ua=at,tt=0,ct=Qa.sizeVec3;tt<ct;){var Sa=tt++;Ua[Sa]=Qa.stackVec3[Sa],Qa.stackVec3[Sa]=null}Qa.stackVec3=Ua}Qa.stackVec3[Qa.sizeVec3++]=U}if(et!=null){var Ja=1,ja=0,La=0,ot=0,It=1,oi=0,gi=0,ai=0,Ct=1;if(et.e00=Ja,et.e01=ja,et.e02=La,et.e10=ot,et.e11=It,et.e12=oi,et.e20=gi,et.e21=ai,et.e22=Ct,Qa.sizeMat3==Qa.stackMat3.length){for(var _i=Qa.sizeMat3<<1,Et=new Array(_i),St=Et,Jt=0,Ki=Qa.sizeMat3;Jt<Ki;){var vi=Jt++;St[vi]=Qa.stackMat3[vi],Qa.stackMat3[vi]=null}Qa.stackMat3=St}Qa.stackMat3[Qa.sizeMat3++]=et}if(Ca!=null){var li=1,ti=0,Oi=0,Xi=0,zi=0,Zt=1,ri=0,Wt=0,ni=0,$i=0,Ut=1,ji=0,Ii=0,pr=0,Wi=0,Lt=1;if(Ca.e00=li,Ca.e01=ti,Ca.e02=Oi,Ca.e03=Xi,Ca.e10=zi,Ca.e11=Zt,Ca.e12=ri,Ca.e13=Wt,Ca.e20=ni,Ca.e21=$i,Ca.e22=Ut,Ca.e23=ji,Ca.e30=Ii,Ca.e31=pr,Ca.e32=Wi,Ca.e33=Lt,Qa.sizeMat4==Qa.stackMat4.length){for(var jt=Qa.sizeMat4<<1,Tt=new Array(jt),bi=Tt,Mi=0,vr=Qa.sizeMat4;Mi<vr;){var qt=Mi++;bi[qt]=Qa.stackMat4[qt],Qa.stackMat4[qt]=null}Qa.stackMat4=bi}Qa.stackMat4[Qa.sizeMat4++]=Ca}if(vt!=null){var fi=0,Bt=0,xi=0,hi=1;if(vt.x=fi,vt.y=Bt,vt.z=xi,vt.w=hi,Qa.sizeQuat==Qa.stackQuat.length){for(var sr=Qa.sizeQuat<<1,Xr=new Array(sr),ro=Xr,Gt=0,fr=Qa.sizeQuat;Gt<fr;){var mr=Gt++;ro[mr]=Qa.stackQuat[mr],Qa.stackQuat[mr]=null}Qa.stackQuat=ro}Qa.stackQuat[Qa.sizeQuat++]=vt}var Dt=this.p,Br=null,Si=null,Dr=null;if(aa!=null){if(aa.zero(),Dt.sizeVec3==Dt.stackVec3.length){for(var Hn=Dt.sizeVec3<<1,oo=new Array(Hn),Ar=oo,no=0,yn=Dt.sizeVec3;no<yn;){var Ao=no++;Ar[Ao]=Dt.stackVec3[Ao],Dt.stackVec3[Ao]=null}Dt.stackVec3=Ar}Dt.stackVec3[Dt.sizeVec3++]=aa}if(Br!=null){var Io=1,ui=0,qr=0,dr=0,yr=1,So=0,Di=0,Sr=0,gr=1;if(Br.e00=Io,Br.e01=ui,Br.e02=qr,Br.e10=dr,Br.e11=yr,Br.e12=So,Br.e20=Di,Br.e21=Sr,Br.e22=gr,Dt.sizeMat3==Dt.stackMat3.length){for(var Qt=Dt.sizeMat3<<1,Hi=new Array(Qt),Li=Hi,Cn=0,Me=Dt.sizeMat3;Cn<Me;){var js=Cn++;Li[js]=Dt.stackMat3[js],Dt.stackMat3[js]=null}Dt.stackMat3=Li}Dt.stackMat3[Dt.sizeMat3++]=Br}if(Si!=null){var pe=1,Ts=0,qs=0,D_=0,gn=0,Pi=1,No=0,Wr=0,ks=0,on=0,Tn=1,Kn=0,ws=0,k_=0,Qs=0,Vi=1;if(Si.e00=pe,Si.e01=Ts,Si.e02=qs,Si.e03=D_,Si.e10=gn,Si.e11=Pi,Si.e12=No,Si.e13=Wr,Si.e20=ks,Si.e21=on,Si.e22=Tn,Si.e23=Kn,Si.e30=ws,Si.e31=k_,Si.e32=Qs,Si.e33=Vi,Dt.sizeMat4==Dt.stackMat4.length){for(var Ir=Dt.sizeMat4<<1,xr=new Array(Ir),so=xr,Qn=0,me=Dt.sizeMat4;Qn<me;){var nn=Qn++;so[nn]=Dt.stackMat4[nn],Dt.stackMat4[nn]=null}Dt.stackMat4=so}Dt.stackMat4[Dt.sizeMat4++]=Si}if(Dr!=null){var Rn=0,ci=0,ho=0,Fr=1;if(Dr.x=Rn,Dr.y=ci,Dr.z=ho,Dr.w=Fr,Dt.sizeQuat==Dt.stackQuat.length){for(var En=Dt.sizeQuat<<1,ae=new Array(En),Rs=ae,Es=0,Ds=Dt.sizeQuat;Es<Ds;){var hs=Es++;Rs[hs]=Dt.stackQuat[hs],Dt.stackQuat[hs]=null}Dt.stackQuat=Rs}Dt.stackQuat[Dt.sizeQuat++]=Dr}var ii=this.p,ir=null,Ri=null,Fi=null;if(Xa!=null){if(Xa.zero(),ii.sizeVec3==ii.stackVec3.length){for(var fo=ii.sizeVec3<<1,Po=new Array(fo),e_=Po,Fs=0,te=ii.sizeVec3;Fs<te;){var Dn=Fs++;e_[Dn]=ii.stackVec3[Dn],ii.stackVec3[Dn]=null}ii.stackVec3=e_}ii.stackVec3[ii.sizeVec3++]=Xa}if(ir!=null){var co=1,Ft=0,Ni=0,lr=0,Vo=1,cs=0,Xs=0,Ls=0,xo=1;if(ir.e00=co,ir.e01=Ft,ir.e02=Ni,ir.e10=lr,ir.e11=Vo,ir.e12=cs,ir.e20=Xs,ir.e21=Ls,ir.e22=xo,ii.sizeMat3==ii.stackMat3.length){for(var $t=ii.sizeMat3<<1,Vr=new Array($t),er=Vr,Jo=0,Ne=ii.sizeMat3;Jo<Ne;){var Co=Jo++;er[Co]=ii.stackMat3[Co],ii.stackMat3[Co]=null}ii.stackMat3=er}ii.stackMat3[ii.sizeMat3++]=ir}if(Ri!=null){var ko=1,Nr=0,Pr=0,Cr=0,Lr=0,Rt=1,Ji=0,Yi=0,Qi=0,zr=0,qi=1,Jr=0,Gr=0,ao=0,bs=0,ki=1;if(Ri.e00=ko,Ri.e01=Nr,Ri.e02=Pr,Ri.e03=Cr,Ri.e10=Lr,Ri.e11=Rt,Ri.e12=Ji,Ri.e13=Yi,Ri.e20=Qi,Ri.e21=zr,Ri.e22=qi,Ri.e23=Jr,Ri.e30=Gr,Ri.e31=ao,Ri.e32=bs,Ri.e33=ki,ii.sizeMat4==ii.stackMat4.length){for(var sn=ii.sizeMat4<<1,Yr=new Array(sn),Go=Yr,ye=0,In=ii.sizeMat4;ye<In;){var ge=ye++;Go[ge]=ii.stackMat4[ge],ii.stackMat4[ge]=null}ii.stackMat4=Go}ii.stackMat4[ii.sizeMat4++]=Ri}if(Fi!=null){var Vn=0,Ci=0,To=0,eo=1;if(Fi.x=Vn,Fi.y=Ci,Fi.z=To,Fi.w=eo,ii.sizeQuat==ii.stackQuat.length){for(var Fn=ii.sizeQuat<<1,Ns=new Array(Fn),Nn=Ns,Wo=0,kn=ii.sizeQuat;Wo<kn;){var Ys=Wo++;Nn[Ys]=ii.stackQuat[Ys],ii.stackQuat[Ys]=null}ii.stackQuat=Nn}ii.stackQuat[ii.sizeQuat++]=Fi}var Ot=this.p,Qo=null,Ur=null,wn=null;if(Ra!=null){if(Ra.zero(),Ot.sizeVec3==Ot.stackVec3.length){for(var Jn=Ot.sizeVec3<<1,fs=new Array(Jn),Ie=fs,Uo=0,Ve=Ot.sizeVec3;Uo<Ve;){var w_=Uo++;Ie[w_]=Ot.stackVec3[w_],Ot.stackVec3[w_]=null}Ot.stackVec3=Ie}Ot.stackVec3[Ot.sizeVec3++]=Ra}if(Qo!=null){var Je=1,X_=0,Js=0,F_=0,N_=1,Or=0,wo=0,Xo=0,Gn=1;if(Qo.e00=Je,Qo.e01=X_,Qo.e02=Js,Qo.e10=F_,Qo.e11=N_,Qo.e12=Or,Qo.e20=wo,Qo.e21=Xo,Qo.e22=Gn,Ot.sizeMat3==Ot.stackMat3.length){for(var wi=Ot.sizeMat3<<1,Wn=new Array(wi),Ro=Wn,to=0,J_=Ot.sizeMat3;to<J_;){var G_=to++;Ro[G_]=Ot.stackMat3[G_],Ot.stackMat3[G_]=null}Ot.stackMat3=Ro}Ot.stackMat3[Ot.sizeMat3++]=Qo}if(Ur!=null){var L_=1,ie=0,__=0,v_=0,re=0,pi=1,Oo=0,ar=0,Zs=0,Ge=0,hv=1,xs=0,Gs=0,$n=0,We=0,Ti=1;if(Ur.e00=L_,Ur.e01=ie,Ur.e02=__,Ur.e03=v_,Ur.e10=re,Ur.e11=pi,Ur.e12=Oo,Ur.e13=ar,Ur.e20=Zs,Ur.e21=Ge,Ur.e22=hv,Ur.e23=xs,Ur.e30=Gs,Ur.e31=$n,Ur.e32=We,Ur.e33=Ti,Ot.sizeMat4==Ot.stackMat4.length){for(var Lo=Ot.sizeMat4<<1,Tr=new Array(Lo),en=Tr,ke=0,Y_=Ot.sizeMat4;ke<Y_;){var Ws=ke++;en[Ws]=Ot.stackMat4[Ws],Ot.stackMat4[Ws]=null}Ot.stackMat4=en}Ot.stackMat4[Ot.sizeMat4++]=Ur}if(wn!=null){var jn=0,Xn=0,oe=0,Bs=1;if(wn.x=jn,wn.y=Xn,wn.z=oe,wn.w=Bs,Ot.sizeQuat==Ot.stackQuat.length){for(var ne=Ot.sizeQuat<<1,Ue=new Array(ne),l_=Ue,As=0,ds=Ot.sizeQuat;As<ds;){var qn=As++;l_[qn]=Ot.stackQuat[qn],Ot.stackQuat[qn]=null}Ot.stackQuat=l_}Ot.stackQuat[Ot.sizeQuat++]=wn}var mi=this.p,uo=null,Zr=null,Ho=null;if(da!=null){if(da.zero(),mi.sizeVec3==mi.stackVec3.length){for(var Yo=mi.sizeVec3<<1,Hr=new Array(Yo),Eo=Hr,we=0,as=mi.sizeVec3;we<as;){var Oe=we++;Eo[Oe]=mi.stackVec3[Oe],mi.stackVec3[Oe]=null}mi.stackVec3=Eo}mi.stackVec3[mi.sizeVec3++]=da}if(uo!=null){var W_=1,ts=0,Nt=0,Kr=0,Do=1,Xe=0,kv=0,i0=0,U_=1;if(uo.e00=W_,uo.e01=ts,uo.e02=Nt,uo.e10=Kr,uo.e11=Do,uo.e12=Xe,uo.e20=kv,uo.e21=i0,uo.e22=U_,mi.sizeMat3==mi.stackMat3.length){for(var Ht=mi.sizeMat3<<1,Ln=new Array(Ht),Qr=Ln,Yn=0,Z_=mi.sizeMat3;Yn<Z_;){var He=Yn++;Qr[He]=mi.stackMat3[He],mi.stackMat3[He]=null}mi.stackMat3=Qr}mi.stackMat3[mi.sizeMat3++]=uo}if(Zr!=null){var h_=1,bo=0,se=0,ee=0,us=0,Zi=1,Ko=0,kr=0,Zo=0,Us=0,cv=1,zs=0,Ke=0,wv=0,Os=0,si=1;if(Zr.e00=h_,Zr.e01=bo,Zr.e02=se,Zr.e03=ee,Zr.e10=us,Zr.e11=Zi,Zr.e12=Ko,Zr.e13=kr,Zr.e20=Zo,Zr.e21=Us,Zr.e22=cv,Zr.e23=zs,Zr.e30=Ke,Zr.e31=wv,Zr.e32=Os,Zr.e33=si,mi.sizeMat4==mi.stackMat4.length){for(var Zn=mi.sizeMat4<<1,_n=new Array(Zn),vn=_n,B_=0,bv=mi.sizeMat4;B_<bv;){var is=B_++;vn[is]=mi.stackMat4[is],mi.stackMat4[is]=null}mi.stackMat4=vn}mi.stackMat4[mi.sizeMat4++]=Zr}if(Ho!=null){var Ss=0,c_=0,O_=0,fv=1;if(Ho.x=Ss,Ho.y=c_,Ho.z=O_,Ho.w=fv,mi.sizeQuat==mi.stackQuat.length){for(var xv=mi.sizeQuat<<1,b_=new Array(xv),Hs=b_,zo=0,_e=mi.sizeQuat;zo<_e;){var ve=zo++;Hs[ve]=mi.stackQuat[ve],mi.stackQuat[ve]=null}mi.stackQuat=Hs}mi.stackQuat[mi.sizeQuat++]=Ho}var Ui=this.p,Mo=null,_o=null,le=null;if(rt!=null){if(rt.zero(),Ui.sizeVec3==Ui.stackVec3.length){for(var Le=Ui.sizeVec3<<1,Ye=new Array(Le),Ze=Ye,A_=0,Ms=Ui.sizeVec3;A_<Ms;){var he=A_++;Ze[he]=Ui.stackVec3[he],Ui.stackVec3[he]=null}Ui.stackVec3=Ze}Ui.stackVec3[Ui.sizeVec3++]=rt}if(Mo!=null){var H_=1,$e=0,Un=0,ps=0,Xv=1,d_=0,$o=0,ln=0,po=1;if(Mo.e00=H_,Mo.e01=$e,Mo.e02=Un,Mo.e10=ps,Mo.e11=Xv,Mo.e12=d_,Mo.e20=$o,Mo.e21=ln,Mo.e22=po,Ui.sizeMat3==Ui.stackMat3.length){for(var Kt=Ui.sizeMat3<<1,$r=new Array(Kt),vo=$r,je=0,Be=Ui.sizeMat3;je<Be;){var qe=je++;vo[qe]=Ui.stackMat3[qe],Ui.stackMat3[qe]=null}Ui.stackMat3=vo}Ui.stackMat3[Ui.sizeMat3++]=Mo}if(_o!=null){var S_=1,jo=0,rs=0,K_=0,uv=0,Bi=1,mo=0,Rr=0,io=0,$_=0,j_=1,Lv=0,a_=0,Yv=0,q_=0,Ai=1;if(_o.e00=S_,_o.e01=jo,_o.e02=rs,_o.e03=K_,_o.e10=uv,_o.e11=Bi,_o.e12=mo,_o.e13=Rr,_o.e20=io,_o.e21=$_,_o.e22=j_,_o.e23=Lv,_o.e30=a_,_o.e31=Yv,_o.e32=q_,_o.e33=Ai,Ui.sizeMat4==Ui.stackMat4.length){for(var av=Ui.sizeMat4<<1,Ae=new Array(av),de=Ae,ce=0,be=Ui.sizeMat4;ce<be;){var Se=ce++;de[Se]=Ui.stackMat4[Se],Ui.stackMat4[Se]=null}Ui.stackMat4=de}Ui.stackMat4[Ui.sizeMat4++]=_o}if(le!=null){var Zv=0,ms=0,jr=0,t_=1;if(le.x=Zv,le.y=ms,le.z=jr,le.w=t_,Ui.sizeQuat==Ui.stackQuat.length){for(var yo=Ui.sizeQuat<<1,i_=new Array(yo),Fo=i_,Pe=0,qo=Ui.sizeQuat;Pe<qo;){var ys=Pe++;Fo[ys]=Ui.stackQuat[ys],Ui.stackQuat[ys]=null}Ui.stackQuat=Fo}Ui.stackQuat[Ui.sizeQuat++]=le}var ei=this.p,an=null,_r=null,os=null;if(O!=null){if(O.zero(),ei.sizeVec3==ei.stackVec3.length){for(var gs=ei.sizeVec3<<1,Bo=new Array(gs),Er=Bo,Bn=0,tv=ei.sizeVec3;Bn<tv;){var r_=Bn++;Er[r_]=ei.stackVec3[r_],ei.stackVec3[r_]=null}ei.stackVec3=Er}ei.stackVec3[ei.sizeVec3++]=O}if(an!=null){var P_=1,iv=0,ns=0,An=0,Is=1,E0=0,M0=0,hl=0,D0=1;if(an.e00=P_,an.e01=iv,an.e02=ns,an.e10=An,an.e11=Is,an.e12=E0,an.e20=M0,an.e21=hl,an.e22=D0,ei.sizeMat3==ei.stackMat3.length){for(var hr=ei.sizeMat3<<1,On=new Array(hr),go=On,fe=0,rv=ei.sizeMat3;fe<rv;){var zv=fe++;go[zv]=ei.stackMat3[zv],ei.stackMat3[zv]=null}ei.stackMat3=go}ei.stackMat3[ei.sizeMat3++]=an}if(_r!=null){var o_=1,Bv=0,Ce=0,f_=0,x_=0,di=1,Te=0,lo=0,Ps=0,Mv=0,Qe=1,u_=0,ov=0,r0=0,o0=0,nv=1;if(_r.e00=o_,_r.e01=Bv,_r.e02=Ce,_r.e03=f_,_r.e10=x_,_r.e11=di,_r.e12=Te,_r.e13=lo,_r.e20=Ps,_r.e21=Mv,_r.e22=Qe,_r.e23=u_,_r.e30=ov,_r.e31=r0,_r.e32=o0,_r.e33=nv,ei.sizeMat4==ei.stackMat4.length){for(var tr=ei.sizeMat4<<1,Ks=new Array(tr),dn=Ks,xe=0,F0=ei.sizeMat4;xe<F0;){var Dv=xe++;dn[Dv]=ei.stackMat4[Dv],ei.stackMat4[Dv]=null}ei.stackMat4=dn}ei.stackMat4[ei.sizeMat4++]=_r}if(os!=null){var C_=0,p0=0,Av=0,n0=1;if(os.x=C_,os.y=p0,os.z=Av,os.w=n0,ei.sizeQuat==ei.stackQuat.length){for(var m0=ei.sizeQuat<<1,N0=new Array(m0),s0=N0,e0=0,y0=ei.sizeQuat;e0<y0;){var Fv=e0++;s0[Fv]=ei.stackQuat[Fv],ei.stackQuat[Fv]=null}ei.stackQuat=s0}ei.stackQuat[ei.sizeQuat++]=os}var cr=this.p,pv=null,hn=null,Nv=null;if(ut!=null){if(ut.zero(),cr.sizeVec3==cr.stackVec3.length){for(var Hl=cr.sizeVec3<<1,g0=new Array(Hl),I0=g0,cl=0,Bl=cr.sizeVec3;cl<Bl;){var Jv=cl++;I0[Jv]=cr.stackVec3[Jv],cr.stackVec3[Jv]=null}cr.stackVec3=I0}cr.stackVec3[cr.sizeVec3++]=ut}if(pv!=null){var Kl=1,$l=0,bl=0,Al=0,dl=1,jl=0,fl=0,ql=0,xl=1;if(pv.e00=Kl,pv.e01=$l,pv.e02=bl,pv.e10=Al,pv.e11=dl,pv.e12=jl,pv.e20=fl,pv.e21=ql,pv.e22=xl,cr.sizeMat3==cr.stackMat3.length){for(var rr=cr.sizeMat3<<1,ue=new Array(rr),tn=ue,mv=0,yh=cr.sizeMat3;mv<yh;){var Gv=mv++;tn[Gv]=cr.stackMat3[Gv],cr.stackMat3[Gv]=null}cr.stackMat3=tn}cr.stackMat3[cr.sizeMat3++]=pv}if(hn!=null){var J0=1,ul=0,V0=0,k0=0,G0=0,Mr=1,ze=0,ss=0,_0=0,Sl=0,lh=1,W0=0,hh=0,U0=0,Pl=0,zl=1;if(hn.e00=J0,hn.e01=ul,hn.e02=V0,hn.e03=k0,hn.e10=G0,hn.e11=Mr,hn.e12=ze,hn.e13=ss,hn.e20=_0,hn.e21=Sl,hn.e22=lh,hn.e23=W0,hn.e30=hh,hn.e31=U0,hn.e32=Pl,hn.e33=zl,cr.sizeMat4==cr.stackMat4.length){for(var Cs=cr.sizeMat4<<1,w0=new Array(Cs),z_=w0,Cl=0,O0=cr.sizeMat4;Cl<O0;){var H0=Cl++;z_[H0]=cr.stackMat4[H0],cr.stackMat4[H0]=null}cr.stackMat4=z_}cr.stackMat4[cr.sizeMat4++]=hn}if(Nv!=null){var Tl=0,Ml=0,X0=0,v0=1;if(Nv.x=Tl,Nv.y=Ml,Nv.z=X0,Nv.w=v0,cr.sizeQuat==cr.stackQuat.length){for(var M_=cr.sizeQuat<<1,Wv=new Array(M_),Uv=Wv,sv=0,L0=cr.sizeQuat;sv<L0;){var dv=sv++;Uv[dv]=cr.stackQuat[dv],cr.stackQuat[dv]=null}cr.stackQuat=Uv}cr.stackQuat[cr.sizeQuat++]=Nv}}else{for(var l0=0;l0<8;){var es=l0++,h0=this.tmpCircleNorms[es],Y0=this.circleCoords[es];h0.x=Y0.x,h0.y=Y0.y,h0.z=Y0.z;var Re=h0,K0=Re.x*f.e00+Re.y*f.e01+Re.z*f.e02,yi=Re.x*f.e10+Re.y*f.e11+Re.z*f.e12,cn=Re.x*f.e20+Re.y*f.e21+Re.z*f.e22;Re.x=K0,Re.y=yi,Re.z=cn;var wr=this.tmpCircleVerts1[es],Ov=this.tmpCircleNorms[es];wr.x=Ov.x,wr.y=Ov.y,wr.z=Ov.z;var c0=wr,ch=c0.x*t,ah=c0.y*t,p_=c0.z*t;c0.x=ch,c0.y=ah,c0.z=p_;var $s=c0,Ee=$s.x+x.x,th=$s.y+x.y,bh=$s.z+x.z;$s.x=Ee,$s.y=th,$s.z=bh;var Ql=this.tmpCircleVerts2[es],br=this.tmpCircleVerts1[es];Ql.x=br.x,Ql.y=br.y,Ql.z=br.z;var n_=this.tmpCircleVerts1[es],bn=n_.x+h.x*i,yv=n_.y+h.y*i,$0=n_.z+h.z*i;n_.x=bn,n_.y=yv,n_.z=$0;var gv=this.tmpCircleVerts2[es],pl=-i,ml=gv.x+h.x*pl,yl=gv.y+h.y*pl,T_=gv.z+h.z*pl;gv.x=ml,gv.y=yl,gv.z=T_}for(var Sv=0;Sv<8;){var Sn=Sv++,Iv=k,Pv=this.tmpCircleVerts1[Sn],Q_=this.tmpCircleVerts1[(Sn+1)%8],_s=h;this.triangle(Iv,Pv,Q_,_s,_s,_s,o),Iv=S,Pv=this.tmpCircleVerts2[(Sn+1)%8],Q_=this.tmpCircleVerts2[Sn];var R_=this.p,Cv=R_.sizeVec3==0?new u.common.Vec3:R_.stackVec3[--R_.sizeVec3];Cv.x=h.x,Cv.y=h.y,Cv.z=h.z;var Hv=Cv,or=-Hv.x,m_=-Hv.y,vs=-Hv.z;Hv.x=or,Hv.y=m_,Hv.z=vs,_s=Hv,this.triangle(Iv,Pv,Q_,_s,_s,_s,o);var Gi=this.p,y_=null,Pn=null,j0=null;if(_s!=null){if(_s.zero(),Gi.sizeVec3==Gi.stackVec3.length){for(var b0=Gi.sizeVec3<<1,fh=new Array(b0),q0=fh,al=0,gl=Gi.sizeVec3;al<gl;){var Z0=al++;q0[Z0]=Gi.stackVec3[Z0],Gi.stackVec3[Z0]=null}Gi.stackVec3=q0}Gi.stackVec3[Gi.sizeVec3++]=_s}if(y_!=null){var xh=1,Il=0,gh=0,ih=0,Vl=1,B0=0,A0=0,kl=0,rh=1;if(y_.e00=xh,y_.e01=Il,y_.e02=gh,y_.e10=ih,y_.e11=Vl,y_.e12=B0,y_.e20=A0,y_.e21=kl,y_.e22=rh,Gi.sizeMat3==Gi.stackMat3.length){for(var Kv=Gi.sizeMat3<<1,Rl=new Array(Kv),$v=Rl,nr=0,g_=Gi.sizeMat3;nr<g_;){var rn=nr++;$v[rn]=Gi.stackMat3[rn],Gi.stackMat3[rn]=null}Gi.stackMat3=$v}Gi.stackMat3[Gi.sizeMat3++]=y_}if(Pn!=null){var wl=1,d0=0,oh=0,El=0,tl=0,Dl=1,S0=0,nh=0,sh=0,Fl=0,Nl=1,ev=0,Tv=0,jv=0,De=0,uh=1;if(Pn.e00=wl,Pn.e01=d0,Pn.e02=oh,Pn.e03=El,Pn.e10=tl,Pn.e11=Dl,Pn.e12=S0,Pn.e13=nh,Pn.e20=sh,Pn.e21=Fl,Pn.e22=Nl,Pn.e23=ev,Pn.e30=Tv,Pn.e31=jv,Pn.e32=De,Pn.e33=uh,Gi.sizeMat4==Gi.stackMat4.length){for(var f0=Gi.sizeMat4<<1,Xl=new Array(f0),Qv=Xl,qv=0,Rv=Gi.sizeMat4;qv<Rv;){var x0=qv++;Qv[x0]=Gi.stackMat4[x0],Gi.stackMat4[x0]=null}Gi.stackMat4=Qv}Gi.stackMat4[Gi.sizeMat4++]=Pn}if(j0!=null){var Zh=0,P0=0,a0=0,Jl=1;if(j0.x=Zh,j0.y=P0,j0.z=a0,j0.w=Jl,Gi.sizeQuat==Gi.stackQuat.length){for(var Gl=Gi.sizeQuat<<1,zh=new Array(Gl),Ev=zh,ur=0,Vs=Gi.sizeQuat;ur<Vs;){var ls=ur++;Ev[ls]=Gi.stackQuat[ls],Gi.stackQuat[ls]=null}Gi.stackQuat=Ev}Gi.stackQuat[Gi.sizeQuat++]=j0}Iv=this.tmpCircleVerts1[Sn],Pv=this.tmpCircleVerts2[Sn],Q_=this.tmpCircleVerts2[(Sn+1)%8];var C0=this.tmpCircleVerts1[(Sn+1)%8];_s=this.tmpCircleNorms[Sn];var Wl=this.tmpCircleNorms[(Sn+1)%8];this.rect(Iv,Pv,Q_,C0,_s,_s,Wl,Wl,o)}}var Fe=this.p;if(k!=null){if(k.zero(),Fe.sizeVec3==Fe.stackVec3.length){for(var u0=Fe.sizeVec3<<1,Ll=new Array(u0),Ul=Ll,Ol=0,Ih=Fe.sizeVec3;Ol<Ih;){var _v=Ol++;Ul[_v]=Fe.stackVec3[_v],Fe.stackVec3[_v]=null}Fe.stackVec3=Ul}Fe.stackVec3[Fe.sizeVec3++]=k}var vv=this.p;if(S!=null){if(S.zero(),vv.sizeVec3==vv.stackVec3.length){for(var T0=vv.sizeVec3<<1,I_=new Array(T0),Yl=I_,Vh=0,Bh=vv.sizeVec3;Vh<Bh;){var t0=Vh++;Yl[t0]=vv.stackVec3[t0],vv.stackVec3[t0]=null}vv.stackVec3=Yl}vv.stackVec3[vv.sizeVec3++]=S}var lv=this.p;if(x!=null){if(x.zero(),lv.sizeVec3==lv.stackVec3.length){for(var kh=lv.sizeVec3<<1,Zl=new Array(kh),wh=Zl,Kh=0,eh=lv.sizeVec3;Kh<eh;){var Ei=Kh++;wh[Ei]=lv.stackVec3[Ei],lv.stackVec3[Ei]=null}lv.stackVec3=wh}lv.stackVec3[lv.sizeVec3++]=x}var s_=this.p;if(f!=null){var V_=1,_h=0,Ah=0,dh=0,Mh=1,Vv=0,Qh=0,Rh=0,$h=1;if(f.e00=V_,f.e01=_h,f.e02=Ah,f.e10=dh,f.e11=Mh,f.e12=Vv,f.e20=Qh,f.e21=Rh,f.e22=$h,s_.sizeMat3==s_.stackMat3.length){for(var jh=s_.sizeMat3<<1,ph=new Array(jh),Sh=ph,il=0,ic=s_.sizeMat3;il<ic;){var Xh=il++;Sh[Xh]=s_.stackMat3[Xh],s_.stackMat3[Xh]=null}s_.stackMat3=Sh}s_.stackMat3[s_.sizeMat3++]=f}var E_=this.p;if(e!=null){if(e.zero(),E_.sizeVec3==E_.stackVec3.length){for(var Eh=E_.sizeVec3<<1,mh=new Array(Eh),qh=mh,Lh=0,ac=E_.sizeVec3;Lh<ac;){var Ph=Lh++;qh[Ph]=E_.stackVec3[Ph],E_.stackVec3[Ph]=null}E_.stackVec3=qh}E_.stackVec3[E_.sizeVec3++]=e}var Q0=this.p;if(h!=null){if(h.zero(),Q0.sizeVec3==Q0.stackVec3.length){for(var rc=Q0.sizeVec3<<1,vh=new Array(rc),Yh=vh,Dh=0,Ch=Q0.sizeVec3;Dh<Ch;){var R0=Dh++;Yh[R0]=Q0.stackVec3[R0],Q0.stackVec3[R0]=null}Q0.stackVec3=Yh}Q0.stackVec3[Q0.sizeVec3++]=h}var z0=this.p;if(s!=null){if(s.zero(),z0.sizeVec3==z0.stackVec3.length){for(var nc=z0.sizeVec3<<1,sc=new Array(nc),Fh=sc,oc=0,tc=z0.sizeVec3;oc<tc;){var rl=oc++;Fh[rl]=z0.stackVec3[rl],z0.stackVec3[rl]=null}z0.stackVec3=Fh}z0.stackVec3[z0.sizeVec3++]=s}}capsule(a,t,i,o){var r=this.p,e=r.sizeVec3==0?new u.common.Vec3:r.stackVec3[--r.sizeVec3],_=this.p,h=_.sizeVec3==0?new u.common.Vec3:_.stackVec3[--_.sizeVec3],v=this.p,s=v.sizeVec3==0?new u.common.Vec3:v.stackVec3[--v.sizeVec3],l=this.p,x=l.sizeVec3==0?new u.common.Vec3:l.stackVec3[--l.sizeVec3],b=this.p,f=b.sizeMat3==0?new u.common.Mat3:b.stackMat3[--b.sizeMat3],n=x;n.x=a._positionX,n.y=a._positionY,n.z=a._positionZ;var c=f;c.e00=a._rotation00,c.e01=a._rotation01,c.e02=a._rotation02,c.e10=a._rotation10,c.e11=a._rotation11,c.e12=a._rotation12,c.e20=a._rotation20,c.e21=a._rotation21,c.e22=a._rotation22,e.init(f.e00,f.e10,f.e20),h.init(f.e01,f.e11,f.e21),s.init(f.e02,f.e12,f.e22);for(var z=4,p=8,y=this.tmpSphereVerts,V=this.tmpSphereNorms,M=0,I=z+1;M<I;)for(var k=M++,X=this.tmpSphereVerts[k].length,L=0,m=X;L<m;){var g=L++,N=V[k][g],d=this.sphereCoords[k][g];N.x=d.x,N.y=d.y,N.z=d.z;var F=N,S=F.x*f.e00+F.y*f.e01+F.z*f.e02,Y=F.x*f.e10+F.y*f.e11+F.z*f.e12,Q=F.x*f.e20+F.y*f.e21+F.z*f.e22;F.x=S,F.y=Y,F.z=Q}for(var C=0,B=z;C<B;){var Z=C++;if(Z==0)for(var $=z>>1,K=0,E=$+1;K<E;)for(var J=K++,A=this.tmpSphereVerts[J].length,R=0,U=A;R<U;){var G=R++,D=y[J][G],H=V[J][G];D.x=H.x,D.y=H.y,D.z=H.z;var j=D,ia=j.x*t,ea=j.y*t,W=j.z*t;j.x=ia,j.y=ea,j.z=W;var q=j,na=q.x+x.x,oa=q.y+x.y,aa=q.z+x.z;q.x=na,q.y=oa,q.z=aa;var T=q,ca=T.x+h.x*i,_a=T.y+h.y*i,w=T.z+h.z*i;T.x=ca,T.y=_a,T.z=w}if(Z==z>>1)for(var ta=z>>1,ra=ta,la=z+1;ra<la;)for(var va=ra++,ua=this.tmpSphereVerts[va].length,za=0,Ma=ua;za<Ma;){var Xa=za++,Za=y[va][Xa],fa=V[va][Xa];Za.x=fa.x,Za.y=fa.y,Za.z=fa.z;var ba=Za,sa=ba.x*t,ha=ba.y*t,ma=ba.z*t;ba.x=sa,ba.y=ha,ba.z=ma;var ya=ba,Ba=ya.x+x.x,pa=ya.y+x.y,Ya=ya.z+x.z;ya.x=Ba,ya.y=pa,ya.z=Ya;var Ra=ya,ga=-i,xa=Ra.x+h.x*ga,wa=Ra.y+h.y*ga,ka=Ra.z+h.z*ga;Ra.x=xa,Ra.y=wa,Ra.z=ka}for(var Pa=0,zt=p;Pa<zt;){var Oa=Pa++,Aa,nt,Ea,Fa,da,ft,Wa,Ha;Z==0?this.wireframe?(Aa=y[0][0],nt=y[1][Oa],this.line(Aa,nt,o)):(Aa=y[0][0],nt=y[1][Oa],Ea=y[1][(Oa+1)%p],da=V[0][0],ft=V[1][Oa],Wa=V[1][(Oa+1)%p],this.triangle(Aa,nt,Ea,da,ft,Wa,o)):Z==z-1?this.wireframe?(Aa=y[z][0],nt=y[Z][(Oa+1)%p],Ea=y[Z][Oa],this.line(Aa,nt,o),this.line(nt,Ea,o)):(Aa=y[z][0],nt=y[Z][(Oa+1)%p],Ea=y[Z][Oa],da=V[z][0],ft=V[Z][(Oa+1)%p],Wa=V[Z][Oa],this.triangle(Aa,nt,Ea,da,ft,Wa,o)):this.wireframe?(Aa=y[Z][Oa],nt=y[Z][(Oa+1)%p],Ea=y[Z+1][Oa],this.line(Aa,nt,o),this.line(Aa,Ea,o)):(Aa=y[Z][Oa],nt=y[Z][(Oa+1)%p],Ea=y[Z+1][Oa],Fa=y[Z+1][(Oa+1)%p],da=V[Z][Oa],ft=V[Z][(Oa+1)%p],Wa=V[Z+1][Oa],Ha=V[Z+1][(Oa+1)%p],this.rect(Aa,Ea,Fa,nt,da,Wa,Ha,ft,o))}}var bt=this.p,it=bt.sizeVec3==0?new u.common.Vec3:bt.stackVec3[--bt.sizeVec3];it.x=x.x,it.y=x.y,it.z=x.z;var Ka=it,_t=Ka.x+h.x*i,gt=Ka.y+h.y*i,pt=Ka.z+h.z*i;Ka.x=_t,Ka.y=gt,Ka.z=pt;var Ga=Ka,rt=this.p,xt=rt.sizeVec3==0?new u.common.Vec3:rt.stackVec3[--rt.sizeVec3];xt.x=x.x,xt.y=x.y,xt.z=x.z;var Da=xt,Ta=-i,Na=Da.x+h.x*Ta,Vt=Da.y+h.y*Ta,Pt=Da.z+h.z*Ta;Da.x=Na,Da.y=Vt,Da.z=Pt;var st=Da;if(this.wireframe){var Xt=this.p,Yt=Xt.sizeVec3==0?new u.common.Vec3:Xt.stackVec3[--Xt.sizeVec3];Yt.x=Ga.x,Yt.y=Ga.y,Yt.z=Ga.z;var Mt=Yt,Ia=-t,O=Mt.x+e.x*Ia,Va=Mt.y+e.y*Ia,lt=Mt.z+e.z*Ia;Mt.x=O,Mt.y=Va,Mt.z=lt;var P=Mt,wt=P.x+s.x*0,At=P.y+s.y*0,dt=P.z+s.z*0;P.x=wt,P.y=At,P.z=dt;var yt=P,kt=this.p,mt=kt.sizeVec3==0?new u.common.Vec3:kt.stackVec3[--kt.sizeVec3];mt.x=Ga.x,mt.y=Ga.y,mt.z=Ga.z;var ht=mt,ut=ht.x+e.x*t,Qa=ht.y+e.y*t,et=ht.z+e.z*t;ht.x=ut,ht.y=Qa,ht.z=et;var Ca=ht,vt=Ca.x+s.x*0,qa=Ca.y+s.y*0,at=Ca.z+s.z*0;Ca.x=vt,Ca.y=qa,Ca.z=at;var Ua=Ca,tt=this.p,ct=tt.sizeVec3==0?new u.common.Vec3:tt.stackVec3[--tt.sizeVec3];ct.x=Ga.x,ct.y=Ga.y,ct.z=Ga.z;var Sa=ct,Ja=Sa.x+e.x*0,ja=Sa.y+e.y*0,La=Sa.z+e.z*0;Sa.x=Ja,Sa.y=ja,Sa.z=La;var ot=Sa,It=-t,oi=ot.x+s.x*It,gi=ot.y+s.y*It,ai=ot.z+s.z*It;ot.x=oi,ot.y=gi,ot.z=ai;var Ct=ot,_i=this.p,Et=_i.sizeVec3==0?new u.common.Vec3:_i.stackVec3[--_i.sizeVec3];Et.x=Ga.x,Et.y=Ga.y,Et.z=Ga.z;var St=Et,Jt=St.x+e.x*0,Ki=St.y+e.y*0,vi=St.z+e.z*0;St.x=Jt,St.y=Ki,St.z=vi;var li=St,ti=li.x+s.x*t,Oi=li.y+s.y*t,Xi=li.z+s.z*t;li.x=ti,li.y=Oi,li.z=Xi;var zi=li,Zt=this.p,ri=Zt.sizeVec3==0?new u.common.Vec3:Zt.stackVec3[--Zt.sizeVec3];ri.x=st.x,ri.y=st.y,ri.z=st.z;var Wt=ri,ni=-t,$i=Wt.x+e.x*ni,Ut=Wt.y+e.y*ni,ji=Wt.z+e.z*ni;Wt.x=$i,Wt.y=Ut,Wt.z=ji;var Ii=Wt,pr=Ii.x+s.x*0,Wi=Ii.y+s.y*0,Lt=Ii.z+s.z*0;Ii.x=pr,Ii.y=Wi,Ii.z=Lt;var jt=Ii,Tt=this.p,bi=Tt.sizeVec3==0?new u.common.Vec3:Tt.stackVec3[--Tt.sizeVec3];bi.x=st.x,bi.y=st.y,bi.z=st.z;var Mi=bi,vr=Mi.x+e.x*t,qt=Mi.y+e.y*t,fi=Mi.z+e.z*t;Mi.x=vr,Mi.y=qt,Mi.z=fi;var Bt=Mi,xi=Bt.x+s.x*0,hi=Bt.y+s.y*0,sr=Bt.z+s.z*0;Bt.x=xi,Bt.y=hi,Bt.z=sr;var Xr=Bt,ro=this.p,Gt=ro.sizeVec3==0?new u.common.Vec3:ro.stackVec3[--ro.sizeVec3];Gt.x=st.x,Gt.y=st.y,Gt.z=st.z;var fr=Gt,mr=fr.x+e.x*0,Dt=fr.y+e.y*0,Br=fr.z+e.z*0;fr.x=mr,fr.y=Dt,fr.z=Br;var Si=fr,Dr=-t,Hn=Si.x+s.x*Dr,oo=Si.y+s.y*Dr,Ar=Si.z+s.z*Dr;Si.x=Hn,Si.y=oo,Si.z=Ar;var no=Si,yn=this.p,Ao=yn.sizeVec3==0?new u.common.Vec3:yn.stackVec3[--yn.sizeVec3];Ao.x=st.x,Ao.y=st.y,Ao.z=st.z;var Io=Ao,ui=Io.x+e.x*0,qr=Io.y+e.y*0,dr=Io.z+e.z*0;Io.x=ui,Io.y=qr,Io.z=dr;var yr=Io,So=yr.x+s.x*t,Di=yr.y+s.y*t,Sr=yr.z+s.z*t;yr.x=So,yr.y=Di,yr.z=Sr;var gr=yr;this.ellipse(Ga,e,s,t,t,o),this.ellipse(st,e,s,t,t,o),this.line(yt,jt,o),this.line(Ua,Xr,o),this.line(Ct,no,o),this.line(zi,gr,o);var Qt=this.p,Hi=null,Li=null,Cn=null;if(yt!=null){if(yt.zero(),Qt.sizeVec3==Qt.stackVec3.length){for(var Me=Qt.sizeVec3<<1,js=new Array(Me),pe=js,Ts=0,qs=Qt.sizeVec3;Ts<qs;){var D_=Ts++;pe[D_]=Qt.stackVec3[D_],Qt.stackVec3[D_]=null}Qt.stackVec3=pe}Qt.stackVec3[Qt.sizeVec3++]=yt}if(Hi!=null){var gn=1,Pi=0,No=0,Wr=0,ks=1,on=0,Tn=0,Kn=0,ws=1;if(Hi.e00=gn,Hi.e01=Pi,Hi.e02=No,Hi.e10=Wr,Hi.e11=ks,Hi.e12=on,Hi.e20=Tn,Hi.e21=Kn,Hi.e22=ws,Qt.sizeMat3==Qt.stackMat3.length){for(var k_=Qt.sizeMat3<<1,Qs=new Array(k_),Vi=Qs,Ir=0,xr=Qt.sizeMat3;Ir<xr;){var so=Ir++;Vi[so]=Qt.stackMat3[so],Qt.stackMat3[so]=null}Qt.stackMat3=Vi}Qt.stackMat3[Qt.sizeMat3++]=Hi}if(Li!=null){var Qn=1,me=0,nn=0,Rn=0,ci=0,ho=1,Fr=0,En=0,ae=0,Rs=0,Es=1,Ds=0,hs=0,ii=0,ir=0,Ri=1;if(Li.e00=Qn,Li.e01=me,Li.e02=nn,Li.e03=Rn,Li.e10=ci,Li.e11=ho,Li.e12=Fr,Li.e13=En,Li.e20=ae,Li.e21=Rs,Li.e22=Es,Li.e23=Ds,Li.e30=hs,Li.e31=ii,Li.e32=ir,Li.e33=Ri,Qt.sizeMat4==Qt.stackMat4.length){for(var Fi=Qt.sizeMat4<<1,fo=new Array(Fi),Po=fo,e_=0,Fs=Qt.sizeMat4;e_<Fs;){var te=e_++;Po[te]=Qt.stackMat4[te],Qt.stackMat4[te]=null}Qt.stackMat4=Po}Qt.stackMat4[Qt.sizeMat4++]=Li}if(Cn!=null){var Dn=0,co=0,Ft=0,Ni=1;if(Cn.x=Dn,Cn.y=co,Cn.z=Ft,Cn.w=Ni,Qt.sizeQuat==Qt.stackQuat.length){for(var lr=Qt.sizeQuat<<1,Vo=new Array(lr),cs=Vo,Xs=0,Ls=Qt.sizeQuat;Xs<Ls;){var xo=Xs++;cs[xo]=Qt.stackQuat[xo],Qt.stackQuat[xo]=null}Qt.stackQuat=cs}Qt.stackQuat[Qt.sizeQuat++]=Cn}var $t=this.p,Vr=null,er=null,Jo=null;if(Ua!=null){if(Ua.zero(),$t.sizeVec3==$t.stackVec3.length){for(var Ne=$t.sizeVec3<<1,Co=new Array(Ne),ko=Co,Nr=0,Pr=$t.sizeVec3;Nr<Pr;){var Cr=Nr++;ko[Cr]=$t.stackVec3[Cr],$t.stackVec3[Cr]=null}$t.stackVec3=ko}$t.stackVec3[$t.sizeVec3++]=Ua}if(Vr!=null){var Lr=1,Rt=0,Ji=0,Yi=0,Qi=1,zr=0,qi=0,Jr=0,Gr=1;if(Vr.e00=Lr,Vr.e01=Rt,Vr.e02=Ji,Vr.e10=Yi,Vr.e11=Qi,Vr.e12=zr,Vr.e20=qi,Vr.e21=Jr,Vr.e22=Gr,$t.sizeMat3==$t.stackMat3.length){for(var ao=$t.sizeMat3<<1,bs=new Array(ao),ki=bs,sn=0,Yr=$t.sizeMat3;sn<Yr;){var Go=sn++;ki[Go]=$t.stackMat3[Go],$t.stackMat3[Go]=null}$t.stackMat3=ki}$t.stackMat3[$t.sizeMat3++]=Vr}if(er!=null){var ye=1,In=0,ge=0,Vn=0,Ci=0,To=1,eo=0,Fn=0,Ns=0,Nn=0,Wo=1,kn=0,Ys=0,Ot=0,Qo=0,Ur=1;if(er.e00=ye,er.e01=In,er.e02=ge,er.e03=Vn,er.e10=Ci,er.e11=To,er.e12=eo,er.e13=Fn,er.e20=Ns,er.e21=Nn,er.e22=Wo,er.e23=kn,er.e30=Ys,er.e31=Ot,er.e32=Qo,er.e33=Ur,$t.sizeMat4==$t.stackMat4.length){for(var wn=$t.sizeMat4<<1,Jn=new Array(wn),fs=Jn,Ie=0,Uo=$t.sizeMat4;Ie<Uo;){var Ve=Ie++;fs[Ve]=$t.stackMat4[Ve],$t.stackMat4[Ve]=null}$t.stackMat4=fs}$t.stackMat4[$t.sizeMat4++]=er}if(Jo!=null){var w_=0,Je=0,X_=0,Js=1;if(Jo.x=w_,Jo.y=Je,Jo.z=X_,Jo.w=Js,$t.sizeQuat==$t.stackQuat.length){for(var F_=$t.sizeQuat<<1,N_=new Array(F_),Or=N_,wo=0,Xo=$t.sizeQuat;wo<Xo;){var Gn=wo++;Or[Gn]=$t.stackQuat[Gn],$t.stackQuat[Gn]=null}$t.stackQuat=Or}$t.stackQuat[$t.sizeQuat++]=Jo}var wi=this.p,Wn=null,Ro=null,to=null;if(Ct!=null){if(Ct.zero(),wi.sizeVec3==wi.stackVec3.length){for(var J_=wi.sizeVec3<<1,G_=new Array(J_),L_=G_,ie=0,__=wi.sizeVec3;ie<__;){var v_=ie++;L_[v_]=wi.stackVec3[v_],wi.stackVec3[v_]=null}wi.stackVec3=L_}wi.stackVec3[wi.sizeVec3++]=Ct}if(Wn!=null){var re=1,pi=0,Oo=0,ar=0,Zs=1,Ge=0,hv=0,xs=0,Gs=1;if(Wn.e00=re,Wn.e01=pi,Wn.e02=Oo,Wn.e10=ar,Wn.e11=Zs,Wn.e12=Ge,Wn.e20=hv,Wn.e21=xs,Wn.e22=Gs,wi.sizeMat3==wi.stackMat3.length){for(var $n=wi.sizeMat3<<1,We=new Array($n),Ti=We,Lo=0,Tr=wi.sizeMat3;Lo<Tr;){var en=Lo++;Ti[en]=wi.stackMat3[en],wi.stackMat3[en]=null}wi.stackMat3=Ti}wi.stackMat3[wi.sizeMat3++]=Wn}if(Ro!=null){var ke=1,Y_=0,Ws=0,jn=0,Xn=0,oe=1,Bs=0,ne=0,Ue=0,l_=0,As=1,ds=0,qn=0,mi=0,uo=0,Zr=1;if(Ro.e00=ke,Ro.e01=Y_,Ro.e02=Ws,Ro.e03=jn,Ro.e10=Xn,Ro.e11=oe,Ro.e12=Bs,Ro.e13=ne,Ro.e20=Ue,Ro.e21=l_,Ro.e22=As,Ro.e23=ds,Ro.e30=qn,Ro.e31=mi,Ro.e32=uo,Ro.e33=Zr,wi.sizeMat4==wi.stackMat4.length){for(var Ho=wi.sizeMat4<<1,Yo=new Array(Ho),Hr=Yo,Eo=0,we=wi.sizeMat4;Eo<we;){var as=Eo++;Hr[as]=wi.stackMat4[as],wi.stackMat4[as]=null}wi.stackMat4=Hr}wi.stackMat4[wi.sizeMat4++]=Ro}if(to!=null){var Oe=0,W_=0,ts=0,Nt=1;if(to.x=Oe,to.y=W_,to.z=ts,to.w=Nt,wi.sizeQuat==wi.stackQuat.length){for(var Kr=wi.sizeQuat<<1,Do=new Array(Kr),Xe=Do,kv=0,i0=wi.sizeQuat;kv<i0;){var U_=kv++;Xe[U_]=wi.stackQuat[U_],wi.stackQuat[U_]=null}wi.stackQuat=Xe}wi.stackQuat[wi.sizeQuat++]=to}var Ht=this.p,Ln=null,Qr=null,Yn=null;if(zi!=null){if(zi.zero(),Ht.sizeVec3==Ht.stackVec3.length){for(var Z_=Ht.sizeVec3<<1,He=new Array(Z_),h_=He,bo=0,se=Ht.sizeVec3;bo<se;){var ee=bo++;h_[ee]=Ht.stackVec3[ee],Ht.stackVec3[ee]=null}Ht.stackVec3=h_}Ht.stackVec3[Ht.sizeVec3++]=zi}if(Ln!=null){var us=1,Zi=0,Ko=0,kr=0,Zo=1,Us=0,cv=0,zs=0,Ke=1;if(Ln.e00=us,Ln.e01=Zi,Ln.e02=Ko,Ln.e10=kr,Ln.e11=Zo,Ln.e12=Us,Ln.e20=cv,Ln.e21=zs,Ln.e22=Ke,Ht.sizeMat3==Ht.stackMat3.length){for(var wv=Ht.sizeMat3<<1,Os=new Array(wv),si=Os,Zn=0,_n=Ht.sizeMat3;Zn<_n;){var vn=Zn++;si[vn]=Ht.stackMat3[vn],Ht.stackMat3[vn]=null}Ht.stackMat3=si}Ht.stackMat3[Ht.sizeMat3++]=Ln}if(Qr!=null){var B_=1,bv=0,is=0,Ss=0,c_=0,O_=1,fv=0,xv=0,b_=0,Hs=0,zo=1,_e=0,ve=0,Ui=0,Mo=0,_o=1;if(Qr.e00=B_,Qr.e01=bv,Qr.e02=is,Qr.e03=Ss,Qr.e10=c_,Qr.e11=O_,Qr.e12=fv,Qr.e13=xv,Qr.e20=b_,Qr.e21=Hs,Qr.e22=zo,Qr.e23=_e,Qr.e30=ve,Qr.e31=Ui,Qr.e32=Mo,Qr.e33=_o,Ht.sizeMat4==Ht.stackMat4.length){for(var le=Ht.sizeMat4<<1,Le=new Array(le),Ye=Le,Ze=0,A_=Ht.sizeMat4;Ze<A_;){var Ms=Ze++;Ye[Ms]=Ht.stackMat4[Ms],Ht.stackMat4[Ms]=null}Ht.stackMat4=Ye}Ht.stackMat4[Ht.sizeMat4++]=Qr}if(Yn!=null){var he=0,H_=0,$e=0,Un=1;if(Yn.x=he,Yn.y=H_,Yn.z=$e,Yn.w=Un,Ht.sizeQuat==Ht.stackQuat.length){for(var ps=Ht.sizeQuat<<1,Xv=new Array(ps),d_=Xv,$o=0,ln=Ht.sizeQuat;$o<ln;){var po=$o++;d_[po]=Ht.stackQuat[po],Ht.stackQuat[po]=null}Ht.stackQuat=d_}Ht.stackQuat[Ht.sizeQuat++]=Yn}var Kt=this.p,$r=null,vo=null,je=null;if(jt!=null){if(jt.zero(),Kt.sizeVec3==Kt.stackVec3.length){for(var Be=Kt.sizeVec3<<1,qe=new Array(Be),S_=qe,jo=0,rs=Kt.sizeVec3;jo<rs;){var K_=jo++;S_[K_]=Kt.stackVec3[K_],Kt.stackVec3[K_]=null}Kt.stackVec3=S_}Kt.stackVec3[Kt.sizeVec3++]=jt}if($r!=null){var uv=1,Bi=0,mo=0,Rr=0,io=1,$_=0,j_=0,Lv=0,a_=1;if($r.e00=uv,$r.e01=Bi,$r.e02=mo,$r.e10=Rr,$r.e11=io,$r.e12=$_,$r.e20=j_,$r.e21=Lv,$r.e22=a_,Kt.sizeMat3==Kt.stackMat3.length){for(var Yv=Kt.sizeMat3<<1,q_=new Array(Yv),Ai=q_,av=0,Ae=Kt.sizeMat3;av<Ae;){var de=av++;Ai[de]=Kt.stackMat3[de],Kt.stackMat3[de]=null}Kt.stackMat3=Ai}Kt.stackMat3[Kt.sizeMat3++]=$r}if(vo!=null){var ce=1,be=0,Se=0,Zv=0,ms=0,jr=1,t_=0,yo=0,i_=0,Fo=0,Pe=1,qo=0,ys=0,ei=0,an=0,_r=1;if(vo.e00=ce,vo.e01=be,vo.e02=Se,vo.e03=Zv,vo.e10=ms,vo.e11=jr,vo.e12=t_,vo.e13=yo,vo.e20=i_,vo.e21=Fo,vo.e22=Pe,vo.e23=qo,vo.e30=ys,vo.e31=ei,vo.e32=an,vo.e33=_r,Kt.sizeMat4==Kt.stackMat4.length){for(var os=Kt.sizeMat4<<1,gs=new Array(os),Bo=gs,Er=0,Bn=Kt.sizeMat4;Er<Bn;){var tv=Er++;Bo[tv]=Kt.stackMat4[tv],Kt.stackMat4[tv]=null}Kt.stackMat4=Bo}Kt.stackMat4[Kt.sizeMat4++]=vo}if(je!=null){var r_=0,P_=0,iv=0,ns=1;if(je.x=r_,je.y=P_,je.z=iv,je.w=ns,Kt.sizeQuat==Kt.stackQuat.length){for(var An=Kt.sizeQuat<<1,Is=new Array(An),E0=Is,M0=0,hl=Kt.sizeQuat;M0<hl;){var D0=M0++;E0[D0]=Kt.stackQuat[D0],Kt.stackQuat[D0]=null}Kt.stackQuat=E0}Kt.stackQuat[Kt.sizeQuat++]=je}var hr=this.p,On=null,go=null,fe=null;if(Xr!=null){if(Xr.zero(),hr.sizeVec3==hr.stackVec3.length){for(var rv=hr.sizeVec3<<1,zv=new Array(rv),o_=zv,Bv=0,Ce=hr.sizeVec3;Bv<Ce;){var f_=Bv++;o_[f_]=hr.stackVec3[f_],hr.stackVec3[f_]=null}hr.stackVec3=o_}hr.stackVec3[hr.sizeVec3++]=Xr}if(On!=null){var x_=1,di=0,Te=0,lo=0,Ps=1,Mv=0,Qe=0,u_=0,ov=1;if(On.e00=x_,On.e01=di,On.e02=Te,On.e10=lo,On.e11=Ps,On.e12=Mv,On.e20=Qe,On.e21=u_,On.e22=ov,hr.sizeMat3==hr.stackMat3.length){for(var r0=hr.sizeMat3<<1,o0=new Array(r0),nv=o0,tr=0,Ks=hr.sizeMat3;tr<Ks;){var dn=tr++;nv[dn]=hr.stackMat3[dn],hr.stackMat3[dn]=null}hr.stackMat3=nv}hr.stackMat3[hr.sizeMat3++]=On}if(go!=null){var xe=1,F0=0,Dv=0,C_=0,p0=0,Av=1,n0=0,m0=0,N0=0,s0=0,e0=1,y0=0,Fv=0,cr=0,pv=0,hn=1;if(go.e00=xe,go.e01=F0,go.e02=Dv,go.e03=C_,go.e10=p0,go.e11=Av,go.e12=n0,go.e13=m0,go.e20=N0,go.e21=s0,go.e22=e0,go.e23=y0,go.e30=Fv,go.e31=cr,go.e32=pv,go.e33=hn,hr.sizeMat4==hr.stackMat4.length){for(var Nv=hr.sizeMat4<<1,Hl=new Array(Nv),g0=Hl,I0=0,cl=hr.sizeMat4;I0<cl;){var Bl=I0++;g0[Bl]=hr.stackMat4[Bl],hr.stackMat4[Bl]=null}hr.stackMat4=g0}hr.stackMat4[hr.sizeMat4++]=go}if(fe!=null){var Jv=0,Kl=0,$l=0,bl=1;if(fe.x=Jv,fe.y=Kl,fe.z=$l,fe.w=bl,hr.sizeQuat==hr.stackQuat.length){for(var Al=hr.sizeQuat<<1,dl=new Array(Al),jl=dl,fl=0,ql=hr.sizeQuat;fl<ql;){var xl=fl++;jl[xl]=hr.stackQuat[xl],hr.stackQuat[xl]=null}hr.stackQuat=jl}hr.stackQuat[hr.sizeQuat++]=fe}var rr=this.p,ue=null,tn=null,mv=null;if(no!=null){if(no.zero(),rr.sizeVec3==rr.stackVec3.length){for(var yh=rr.sizeVec3<<1,Gv=new Array(yh),J0=Gv,ul=0,V0=rr.sizeVec3;ul<V0;){var k0=ul++;J0[k0]=rr.stackVec3[k0],rr.stackVec3[k0]=null}rr.stackVec3=J0}rr.stackVec3[rr.sizeVec3++]=no}if(ue!=null){var G0=1,Mr=0,ze=0,ss=0,_0=1,Sl=0,lh=0,W0=0,hh=1;if(ue.e00=G0,ue.e01=Mr,ue.e02=ze,ue.e10=ss,ue.e11=_0,ue.e12=Sl,ue.e20=lh,ue.e21=W0,ue.e22=hh,rr.sizeMat3==rr.stackMat3.length){for(var U0=rr.sizeMat3<<1,Pl=new Array(U0),zl=Pl,Cs=0,w0=rr.sizeMat3;Cs<w0;){var z_=Cs++;zl[z_]=rr.stackMat3[z_],rr.stackMat3[z_]=null}rr.stackMat3=zl}rr.stackMat3[rr.sizeMat3++]=ue}if(tn!=null){var Cl=1,O0=0,H0=0,Tl=0,Ml=0,X0=1,v0=0,M_=0,Wv=0,Uv=0,sv=1,L0=0,dv=0,l0=0,es=0,h0=1;if(tn.e00=Cl,tn.e01=O0,tn.e02=H0,tn.e03=Tl,tn.e10=Ml,tn.e11=X0,tn.e12=v0,tn.e13=M_,tn.e20=Wv,tn.e21=Uv,tn.e22=sv,tn.e23=L0,tn.e30=dv,tn.e31=l0,tn.e32=es,tn.e33=h0,rr.sizeMat4==rr.stackMat4.length){for(var Y0=rr.sizeMat4<<1,Re=new Array(Y0),K0=Re,yi=0,cn=rr.sizeMat4;yi<cn;){var wr=yi++;K0[wr]=rr.stackMat4[wr],rr.stackMat4[wr]=null}rr.stackMat4=K0}rr.stackMat4[rr.sizeMat4++]=tn}if(mv!=null){var Ov=0,c0=0,ch=0,ah=1;if(mv.x=Ov,mv.y=c0,mv.z=ch,mv.w=ah,rr.sizeQuat==rr.stackQuat.length){for(var p_=rr.sizeQuat<<1,$s=new Array(p_),Ee=$s,th=0,bh=rr.sizeQuat;th<bh;){var Ql=th++;Ee[Ql]=rr.stackQuat[Ql],rr.stackQuat[Ql]=null}rr.stackQuat=Ee}rr.stackQuat[rr.sizeQuat++]=mv}var br=this.p,n_=null,bn=null,yv=null;if(gr!=null){if(gr.zero(),br.sizeVec3==br.stackVec3.length){for(var $0=br.sizeVec3<<1,gv=new Array($0),pl=gv,ml=0,yl=br.sizeVec3;ml<yl;){var T_=ml++;pl[T_]=br.stackVec3[T_],br.stackVec3[T_]=null}br.stackVec3=pl}br.stackVec3[br.sizeVec3++]=gr}if(n_!=null){var Sv=1,Sn=0,Iv=0,Pv=0,Q_=1,_s=0,R_=0,Cv=0,Hv=1;if(n_.e00=Sv,n_.e01=Sn,n_.e02=Iv,n_.e10=Pv,n_.e11=Q_,n_.e12=_s,n_.e20=R_,n_.e21=Cv,n_.e22=Hv,br.sizeMat3==br.stackMat3.length){for(var or=br.sizeMat3<<1,m_=new Array(or),vs=m_,Gi=0,y_=br.sizeMat3;Gi<y_;){var Pn=Gi++;vs[Pn]=br.stackMat3[Pn],br.stackMat3[Pn]=null}br.stackMat3=vs}br.stackMat3[br.sizeMat3++]=n_}if(bn!=null){var j0=1,b0=0,fh=0,q0=0,al=0,gl=1,Z0=0,xh=0,Il=0,gh=0,ih=1,Vl=0,B0=0,A0=0,kl=0,rh=1;if(bn.e00=j0,bn.e01=b0,bn.e02=fh,bn.e03=q0,bn.e10=al,bn.e11=gl,bn.e12=Z0,bn.e13=xh,bn.e20=Il,bn.e21=gh,bn.e22=ih,bn.e23=Vl,bn.e30=B0,bn.e31=A0,bn.e32=kl,bn.e33=rh,br.sizeMat4==br.stackMat4.length){for(var Kv=br.sizeMat4<<1,Rl=new Array(Kv),$v=Rl,nr=0,g_=br.sizeMat4;nr<g_;){var rn=nr++;$v[rn]=br.stackMat4[rn],br.stackMat4[rn]=null}br.stackMat4=$v}br.stackMat4[br.sizeMat4++]=bn}if(yv!=null){var wl=0,d0=0,oh=0,El=1;if(yv.x=wl,yv.y=d0,yv.z=oh,yv.w=El,br.sizeQuat==br.stackQuat.length){for(var tl=br.sizeQuat<<1,Dl=new Array(tl),S0=Dl,nh=0,sh=br.sizeQuat;nh<sh;){var Fl=nh++;S0[Fl]=br.stackQuat[Fl],br.stackQuat[Fl]=null}br.stackQuat=S0}br.stackQuat[br.sizeQuat++]=yv}}else{for(var Nl=0;Nl<8;){var ev=Nl++,Tv=this.tmpCircleNorms[ev],jv=this.circleCoords[ev];Tv.x=jv.x,Tv.y=jv.y,Tv.z=jv.z;var De=Tv,uh=De.x*f.e00+De.y*f.e01+De.z*f.e02,f0=De.x*f.e10+De.y*f.e11+De.z*f.e12,Xl=De.x*f.e20+De.y*f.e21+De.z*f.e22;De.x=uh,De.y=f0,De.z=Xl;var Qv=this.tmpCircleVerts1[ev],qv=this.tmpCircleNorms[ev];Qv.x=qv.x,Qv.y=qv.y,Qv.z=qv.z;var Rv=Qv,x0=Rv.x*t,Zh=Rv.y*t,P0=Rv.z*t;Rv.x=x0,Rv.y=Zh,Rv.z=P0;var a0=Rv,Jl=a0.x+x.x,Gl=a0.y+x.y,zh=a0.z+x.z;a0.x=Jl,a0.y=Gl,a0.z=zh;var Ev=this.tmpCircleVerts2[ev],ur=this.tmpCircleVerts1[ev];Ev.x=ur.x,Ev.y=ur.y,Ev.z=ur.z;var Vs=this.tmpCircleVerts1[ev],ls=Vs.x+h.x*i,C0=Vs.y+h.y*i,Wl=Vs.z+h.z*i;Vs.x=ls,Vs.y=C0,Vs.z=Wl;var Fe=this.tmpCircleVerts2[ev],u0=-i,Ll=Fe.x+h.x*u0,Ul=Fe.y+h.y*u0,Ol=Fe.z+h.z*u0;Fe.x=Ll,Fe.y=Ul,Fe.z=Ol}for(var Ih=0;Ih<8;){var _v=Ih++,vv=this.tmpCircleVerts1[_v],T0=this.tmpCircleVerts2[_v],I_=this.tmpCircleVerts2[(_v+1)%8],Yl=this.tmpCircleVerts1[(_v+1)%8],Vh=this.tmpCircleNorms[_v],Bh=this.tmpCircleNorms[(_v+1)%8];this.rect(vv,T0,I_,Yl,Vh,Vh,Bh,Bh,o)}}var t0=this.p;if(Ga!=null){if(Ga.zero(),t0.sizeVec3==t0.stackVec3.length){for(var lv=t0.sizeVec3<<1,kh=new Array(lv),Zl=kh,wh=0,Kh=t0.sizeVec3;wh<Kh;){var eh=wh++;Zl[eh]=t0.stackVec3[eh],t0.stackVec3[eh]=null}t0.stackVec3=Zl}t0.stackVec3[t0.sizeVec3++]=Ga}var Ei=this.p;if(st!=null){if(st.zero(),Ei.sizeVec3==Ei.stackVec3.length){for(var s_=Ei.sizeVec3<<1,V_=new Array(s_),_h=V_,Ah=0,dh=Ei.sizeVec3;Ah<dh;){var Mh=Ah++;_h[Mh]=Ei.stackVec3[Mh],Ei.stackVec3[Mh]=null}Ei.stackVec3=_h}Ei.stackVec3[Ei.sizeVec3++]=st}var Vv=this.p;if(x!=null){if(x.zero(),Vv.sizeVec3==Vv.stackVec3.length){for(var Qh=Vv.sizeVec3<<1,Rh=new Array(Qh),$h=Rh,jh=0,ph=Vv.sizeVec3;jh<ph;){var Sh=jh++;$h[Sh]=Vv.stackVec3[Sh],Vv.stackVec3[Sh]=null}Vv.stackVec3=$h}Vv.stackVec3[Vv.sizeVec3++]=x}var il=this.p;if(f!=null){var ic=1,Xh=0,E_=0,Eh=0,mh=1,qh=0,Lh=0,ac=0,Ph=1;if(f.e00=ic,f.e01=Xh,f.e02=E_,f.e10=Eh,f.e11=mh,f.e12=qh,f.e20=Lh,f.e21=ac,f.e22=Ph,il.sizeMat3==il.stackMat3.length){for(var Q0=il.sizeMat3<<1,rc=new Array(Q0),vh=rc,Yh=0,Dh=il.sizeMat3;Yh<Dh;){var Ch=Yh++;vh[Ch]=il.stackMat3[Ch],il.stackMat3[Ch]=null}il.stackMat3=vh}il.stackMat3[il.sizeMat3++]=f}var R0=this.p;if(e!=null){if(e.zero(),R0.sizeVec3==R0.stackVec3.length){for(var z0=R0.sizeVec3<<1,nc=new Array(z0),sc=nc,Fh=0,oc=R0.sizeVec3;Fh<oc;){var tc=Fh++;sc[tc]=R0.stackVec3[tc],R0.stackVec3[tc]=null}R0.stackVec3=sc}R0.stackVec3[R0.sizeVec3++]=e}var rl=this.p;if(h!=null){if(h.zero(),rl.sizeVec3==rl.stackVec3.length){for(var yc=rl.sizeVec3<<1,gc=new Array(yc),zc=gc,Mc=0,Ic=rl.sizeVec3;Mc<Ic;){var ec=Mc++;zc[ec]=rl.stackVec3[ec],rl.stackVec3[ec]=null}rl.stackVec3=zc}rl.stackVec3[rl.sizeVec3++]=h}var Th=this.p;if(s!=null){if(s.zero(),Th.sizeVec3==Th.stackVec3.length){for(var Vc=Th.sizeVec3<<1,xc=new Array(Vc),pc=xc,mc=0,kc=Th.sizeVec3;mc<kc;){var uc=mc++;pc[uc]=Th.stackVec3[uc],Th.stackVec3[uc]=null}Th.stackVec3=pc}Th.stackVec3[Th.sizeVec3++]=s}}sphere(a,t,i){var o=this.p,r=o.sizeVec3==0?new u.common.Vec3:o.stackVec3[--o.sizeVec3],e=this.p,_=e.sizeMat3==0?new u.common.Mat3:e.stackMat3[--e.sizeMat3],h=r;h.x=a._positionX,h.y=a._positionY,h.z=a._positionZ;var v=_;v.e00=a._rotation00,v.e01=a._rotation01,v.e02=a._rotation02,v.e10=a._rotation10,v.e11=a._rotation11,v.e12=a._rotation12,v.e20=a._rotation20,v.e21=a._rotation21,v.e22=a._rotation22;for(var s=4,l=8,x=this.tmpSphereVerts,b=this.tmpSphereNorms,f=0,n=s+1;f<n;)for(var c=f++,z=this.tmpSphereVerts[c].length,p=0,y=z;p<y;){var V=p++,M=b[c][V],I=this.sphereCoords[c][V];M.x=I.x,M.y=I.y,M.z=I.z;var k=M,X=k.x*_.e00+k.y*_.e01+k.z*_.e02,L=k.x*_.e10+k.y*_.e11+k.z*_.e12,m=k.x*_.e20+k.y*_.e21+k.z*_.e22;k.x=X,k.y=L,k.z=m;var g=x[c][V],N=b[c][V];g.x=N.x,g.y=N.y,g.z=N.z;var d=g,F=d.x*t,S=d.y*t,Y=d.z*t;d.x=F,d.y=S,d.z=Y;var Q=d,C=Q.x+r.x,B=Q.y+r.y,Z=Q.z+r.z;Q.x=C,Q.y=B,Q.z=Z}for(var $=0,K=s;$<K;)for(var E=$++,J=0,A=l;J<A;){var R=J++,U,G,D,H,j,ia,ea,W;E==0?this.wireframe?(U=x[0][0],G=x[1][R],this.line(U,G,i)):(U=x[0][0],G=x[1][R],D=x[1][(R+1)%l],j=b[0][0],ia=b[1][R],ea=b[1][(R+1)%l],this.triangle(U,G,D,j,ia,ea,i)):E==s-1?this.wireframe?(U=x[s][0],G=x[E][(R+1)%l],D=x[E][R],this.line(U,G,i),this.line(G,D,i)):(U=x[s][0],G=x[E][(R+1)%l],D=x[E][R],j=b[s][0],ia=b[E][(R+1)%l],ea=b[E][R],this.triangle(U,G,D,j,ia,ea,i)):this.wireframe?(U=x[E][R],G=x[E][(R+1)%l],D=x[E+1][R],this.line(U,G,i),this.line(U,D,i)):(U=x[E][R],G=x[E][(R+1)%l],D=x[E+1][R],H=x[E+1][(R+1)%l],j=b[E][R],ia=b[E][(R+1)%l],ea=b[E+1][R],W=b[E+1][(R+1)%l],this.rect(U,D,H,G,j,ea,W,ia,i))}var q=this.p;if(r!=null){if(r.zero(),q.sizeVec3==q.stackVec3.length){for(var na=q.sizeVec3<<1,oa=new Array(na),aa=oa,T=0,ca=q.sizeVec3;T<ca;){var _a=T++;aa[_a]=q.stackVec3[_a],q.stackVec3[_a]=null}q.stackVec3=aa}q.stackVec3[q.sizeVec3++]=r}var w=this.p;if(_!=null){var ta=1,ra=0,la=0,va=0,ua=1,za=0,Ma=0,Xa=0,Za=1;if(_.e00=ta,_.e01=ra,_.e02=la,_.e10=va,_.e11=ua,_.e12=za,_.e20=Ma,_.e21=Xa,_.e22=Za,w.sizeMat3==w.stackMat3.length){for(var fa=w.sizeMat3<<1,ba=new Array(fa),sa=ba,ha=0,ma=w.sizeMat3;ha<ma;){var ya=ha++;sa[ya]=w.stackMat3[ya],w.stackMat3[ya]=null}w.stackMat3=sa}w.stackMat3[w.sizeMat3++]=_}}box(a,t,i){var o=this.p,r=o.sizeVec3==0?new u.common.Vec3:o.stackVec3[--o.sizeVec3],e=this.p,_=e.sizeVec3==0?new u.common.Vec3:e.stackVec3[--e.sizeVec3],h=this.p,v=h.sizeVec3==0?new u.common.Vec3:h.stackVec3[--h.sizeVec3],s=this.p,l=s.sizeVec3==0?new u.common.Vec3:s.stackVec3[--s.sizeVec3],x=this.p,b=x.sizeMat3==0?new u.common.Mat3:x.stackMat3[--x.sizeMat3],f=l;f.x=a._positionX,f.y=a._positionY,f.z=a._positionZ;var n=b;n.e00=a._rotation00,n.e01=a._rotation01,n.e02=a._rotation02,n.e10=a._rotation10,n.e11=a._rotation11,n.e12=a._rotation12,n.e20=a._rotation20,n.e21=a._rotation21,n.e22=a._rotation22,r.init(b.e00,b.e10,b.e20),_.init(b.e01,b.e11,b.e21),v.init(b.e02,b.e12,b.e22);var c=t.x,z=t.y,p=t.z,y=this.p,V=y.sizeVec3==0?new u.common.Vec3:y.stackVec3[--y.sizeVec3];V.x=l.x,V.y=l.y,V.z=l.z;var M=V,I=-c,k=M.x+r.x*I,X=M.y+r.y*I,L=M.z+r.z*I;M.x=k,M.y=X,M.z=L;var m=M,g=-z,N=m.x+_.x*g,d=m.y+_.y*g,F=m.z+_.z*g;m.x=N,m.y=d,m.z=F;var S=m,Y=-p,Q=S.x+v.x*Y,C=S.y+v.y*Y,B=S.z+v.z*Y;S.x=Q,S.y=C,S.z=B;var Z=S,$=this.p,K=$.sizeVec3==0?new u.common.Vec3:$.stackVec3[--$.sizeVec3];K.x=l.x,K.y=l.y,K.z=l.z;var E=K,J=-c,A=E.x+r.x*J,R=E.y+r.y*J,U=E.z+r.z*J;E.x=A,E.y=R,E.z=U;var G=E,D=-z,H=G.x+_.x*D,j=G.y+_.y*D,ia=G.z+_.z*D;G.x=H,G.y=j,G.z=ia;var ea=G,W=ea.x+v.x*p,q=ea.y+v.y*p,na=ea.z+v.z*p;ea.x=W,ea.y=q,ea.z=na;var oa=ea,aa=this.p,T=aa.sizeVec3==0?new u.common.Vec3:aa.stackVec3[--aa.sizeVec3];T.x=l.x,T.y=l.y,T.z=l.z;var ca=T,_a=-c,w=ca.x+r.x*_a,ta=ca.y+r.y*_a,ra=ca.z+r.z*_a;ca.x=w,ca.y=ta,ca.z=ra;var la=ca,va=la.x+_.x*z,ua=la.y+_.y*z,za=la.z+_.z*z;la.x=va,la.y=ua,la.z=za;var Ma=la,Xa=-p,Za=Ma.x+v.x*Xa,fa=Ma.y+v.y*Xa,ba=Ma.z+v.z*Xa;Ma.x=Za,Ma.y=fa,Ma.z=ba;var sa=Ma,ha=this.p,ma=ha.sizeVec3==0?new u.common.Vec3:ha.stackVec3[--ha.sizeVec3];ma.x=l.x,ma.y=l.y,ma.z=l.z;var ya=ma,Ba=-c,pa=ya.x+r.x*Ba,Ya=ya.y+r.y*Ba,Ra=ya.z+r.z*Ba;ya.x=pa,ya.y=Ya,ya.z=Ra;var ga=ya,xa=ga.x+_.x*z,wa=ga.y+_.y*z,ka=ga.z+_.z*z;ga.x=xa,ga.y=wa,ga.z=ka;var Pa=ga,zt=Pa.x+v.x*p,Oa=Pa.y+v.y*p,Aa=Pa.z+v.z*p;Pa.x=zt,Pa.y=Oa,Pa.z=Aa;var nt=Pa,Ea=this.p,Fa=Ea.sizeVec3==0?new u.common.Vec3:Ea.stackVec3[--Ea.sizeVec3];Fa.x=l.x,Fa.y=l.y,Fa.z=l.z;var da=Fa,ft=da.x+r.x*c,Wa=da.y+r.y*c,Ha=da.z+r.z*c;da.x=ft,da.y=Wa,da.z=Ha;var bt=da,it=-z,Ka=bt.x+_.x*it,_t=bt.y+_.y*it,gt=bt.z+_.z*it;bt.x=Ka,bt.y=_t,bt.z=gt;var pt=bt,Ga=-p,rt=pt.x+v.x*Ga,xt=pt.y+v.y*Ga,Da=pt.z+v.z*Ga;pt.x=rt,pt.y=xt,pt.z=Da;var Ta=pt,Na=this.p,Vt=Na.sizeVec3==0?new u.common.Vec3:Na.stackVec3[--Na.sizeVec3];Vt.x=l.x,Vt.y=l.y,Vt.z=l.z;var Pt=Vt,st=Pt.x+r.x*c,Xt=Pt.y+r.y*c,Yt=Pt.z+r.z*c;Pt.x=st,Pt.y=Xt,Pt.z=Yt;var Mt=Pt,Ia=-z,O=Mt.x+_.x*Ia,Va=Mt.y+_.y*Ia,lt=Mt.z+_.z*Ia;Mt.x=O,Mt.y=Va,Mt.z=lt;var P=Mt,wt=P.x+v.x*p,At=P.y+v.y*p,dt=P.z+v.z*p;P.x=wt,P.y=At,P.z=dt;var yt=P,kt=this.p,mt=kt.sizeVec3==0?new u.common.Vec3:kt.stackVec3[--kt.sizeVec3];mt.x=l.x,mt.y=l.y,mt.z=l.z;var ht=mt,ut=ht.x+r.x*c,Qa=ht.y+r.y*c,et=ht.z+r.z*c;ht.x=ut,ht.y=Qa,ht.z=et;var Ca=ht,vt=Ca.x+_.x*z,qa=Ca.y+_.y*z,at=Ca.z+_.z*z;Ca.x=vt,Ca.y=qa,Ca.z=at;var Ua=Ca,tt=-p,ct=Ua.x+v.x*tt,Sa=Ua.y+v.y*tt,Ja=Ua.z+v.z*tt;Ua.x=ct,Ua.y=Sa,Ua.z=Ja;var ja=Ua,La=this.p,ot=La.sizeVec3==0?new u.common.Vec3:La.stackVec3[--La.sizeVec3];ot.x=l.x,ot.y=l.y,ot.z=l.z;var It=ot,oi=It.x+r.x*c,gi=It.y+r.y*c,ai=It.z+r.z*c;It.x=oi,It.y=gi,It.z=ai;var Ct=It,_i=Ct.x+_.x*z,Et=Ct.y+_.y*z,St=Ct.z+_.z*z;Ct.x=_i,Ct.y=Et,Ct.z=St;var Jt=Ct,Ki=Jt.x+v.x*p,vi=Jt.y+v.y*p,li=Jt.z+v.z*p;Jt.x=Ki,Jt.y=vi,Jt.z=li;var ti=Jt;if(this.wireframe)this.line(Z,oa,i),this.line(sa,nt,i),this.line(Ta,yt,i),this.line(ja,ti,i),this.line(Z,sa,i),this.line(oa,nt,i),this.line(Ta,ja,i),this.line(yt,ti,i),this.line(Z,Ta,i),this.line(oa,yt,i),this.line(sa,ja,i),this.line(nt,ti,i);else{var Oi=this.p,Xi=Oi.sizeVec3==0?new u.common.Vec3:Oi.stackVec3[--Oi.sizeVec3];Xi.x=r.x,Xi.y=r.y,Xi.z=r.z;var zi=Xi,Zt=-zi.x,ri=-zi.y,Wt=-zi.z;zi.x=Zt,zi.y=ri,zi.z=Wt;var ni=zi,$i=this.p,Ut=$i.sizeVec3==0?new u.common.Vec3:$i.stackVec3[--$i.sizeVec3];Ut.x=_.x,Ut.y=_.y,Ut.z=_.z;var ji=Ut,Ii=-ji.x,pr=-ji.y,Wi=-ji.z;ji.x=Ii,ji.y=pr,ji.z=Wi;var Lt=ji,jt=this.p,Tt=jt.sizeVec3==0?new u.common.Vec3:jt.stackVec3[--jt.sizeVec3];Tt.x=v.x,Tt.y=v.y,Tt.z=v.z;var bi=Tt,Mi=-bi.x,vr=-bi.y,qt=-bi.z;bi.x=Mi,bi.y=vr,bi.z=qt;var fi=bi;this.rect(Z,oa,nt,sa,ni,ni,ni,ni,i),this.rect(Ta,ja,ti,yt,r,r,r,r,i),this.rect(Z,Ta,yt,oa,Lt,Lt,Lt,Lt,i),this.rect(sa,nt,ti,ja,_,_,_,_,i),this.rect(Z,sa,ja,Ta,fi,fi,fi,fi,i),this.rect(oa,yt,ti,nt,v,v,v,v,i);var Bt=this.p,xi=null,hi=null,sr=null;if(ni!=null){if(ni.zero(),Bt.sizeVec3==Bt.stackVec3.length){for(var Xr=Bt.sizeVec3<<1,ro=new Array(Xr),Gt=ro,fr=0,mr=Bt.sizeVec3;fr<mr;){var Dt=fr++;Gt[Dt]=Bt.stackVec3[Dt],Bt.stackVec3[Dt]=null}Bt.stackVec3=Gt}Bt.stackVec3[Bt.sizeVec3++]=ni}if(xi!=null){var Br=1,Si=0,Dr=0,Hn=0,oo=1,Ar=0,no=0,yn=0,Ao=1;if(xi.e00=Br,xi.e01=Si,xi.e02=Dr,xi.e10=Hn,xi.e11=oo,xi.e12=Ar,xi.e20=no,xi.e21=yn,xi.e22=Ao,Bt.sizeMat3==Bt.stackMat3.length){for(var Io=Bt.sizeMat3<<1,ui=new Array(Io),qr=ui,dr=0,yr=Bt.sizeMat3;dr<yr;){var So=dr++;qr[So]=Bt.stackMat3[So],Bt.stackMat3[So]=null}Bt.stackMat3=qr}Bt.stackMat3[Bt.sizeMat3++]=xi}if(hi!=null){var Di=1,Sr=0,gr=0,Qt=0,Hi=0,Li=1,Cn=0,Me=0,js=0,pe=0,Ts=1,qs=0,D_=0,gn=0,Pi=0,No=1;if(hi.e00=Di,hi.e01=Sr,hi.e02=gr,hi.e03=Qt,hi.e10=Hi,hi.e11=Li,hi.e12=Cn,hi.e13=Me,hi.e20=js,hi.e21=pe,hi.e22=Ts,hi.e23=qs,hi.e30=D_,hi.e31=gn,hi.e32=Pi,hi.e33=No,Bt.sizeMat4==Bt.stackMat4.length){for(var Wr=Bt.sizeMat4<<1,ks=new Array(Wr),on=ks,Tn=0,Kn=Bt.sizeMat4;Tn<Kn;){var ws=Tn++;on[ws]=Bt.stackMat4[ws],Bt.stackMat4[ws]=null}Bt.stackMat4=on}Bt.stackMat4[Bt.sizeMat4++]=hi}if(sr!=null){var k_=0,Qs=0,Vi=0,Ir=1;if(sr.x=k_,sr.y=Qs,sr.z=Vi,sr.w=Ir,Bt.sizeQuat==Bt.stackQuat.length){for(var xr=Bt.sizeQuat<<1,so=new Array(xr),Qn=so,me=0,nn=Bt.sizeQuat;me<nn;){var Rn=me++;Qn[Rn]=Bt.stackQuat[Rn],Bt.stackQuat[Rn]=null}Bt.stackQuat=Qn}Bt.stackQuat[Bt.sizeQuat++]=sr}var ci=this.p,ho=null,Fr=null,En=null;if(Lt!=null){if(Lt.zero(),ci.sizeVec3==ci.stackVec3.length){for(var ae=ci.sizeVec3<<1,Rs=new Array(ae),Es=Rs,Ds=0,hs=ci.sizeVec3;Ds<hs;){var ii=Ds++;Es[ii]=ci.stackVec3[ii],ci.stackVec3[ii]=null}ci.stackVec3=Es}ci.stackVec3[ci.sizeVec3++]=Lt}if(ho!=null){var ir=1,Ri=0,Fi=0,fo=0,Po=1,e_=0,Fs=0,te=0,Dn=1;if(ho.e00=ir,ho.e01=Ri,ho.e02=Fi,ho.e10=fo,ho.e11=Po,ho.e12=e_,ho.e20=Fs,ho.e21=te,ho.e22=Dn,ci.sizeMat3==ci.stackMat3.length){for(var co=ci.sizeMat3<<1,Ft=new Array(co),Ni=Ft,lr=0,Vo=ci.sizeMat3;lr<Vo;){var cs=lr++;Ni[cs]=ci.stackMat3[cs],ci.stackMat3[cs]=null}ci.stackMat3=Ni}ci.stackMat3[ci.sizeMat3++]=ho}if(Fr!=null){var Xs=1,Ls=0,xo=0,$t=0,Vr=0,er=1,Jo=0,Ne=0,Co=0,ko=0,Nr=1,Pr=0,Cr=0,Lr=0,Rt=0,Ji=1;if(Fr.e00=Xs,Fr.e01=Ls,Fr.e02=xo,Fr.e03=$t,Fr.e10=Vr,Fr.e11=er,Fr.e12=Jo,Fr.e13=Ne,Fr.e20=Co,Fr.e21=ko,Fr.e22=Nr,Fr.e23=Pr,Fr.e30=Cr,Fr.e31=Lr,Fr.e32=Rt,Fr.e33=Ji,ci.sizeMat4==ci.stackMat4.length){for(var Yi=ci.sizeMat4<<1,Qi=new Array(Yi),zr=Qi,qi=0,Jr=ci.sizeMat4;qi<Jr;){var Gr=qi++;zr[Gr]=ci.stackMat4[Gr],ci.stackMat4[Gr]=null}ci.stackMat4=zr}ci.stackMat4[ci.sizeMat4++]=Fr}if(En!=null){var ao=0,bs=0,ki=0,sn=1;if(En.x=ao,En.y=bs,En.z=ki,En.w=sn,ci.sizeQuat==ci.stackQuat.length){for(var Yr=ci.sizeQuat<<1,Go=new Array(Yr),ye=Go,In=0,ge=ci.sizeQuat;In<ge;){var Vn=In++;ye[Vn]=ci.stackQuat[Vn],ci.stackQuat[Vn]=null}ci.stackQuat=ye}ci.stackQuat[ci.sizeQuat++]=En}var Ci=this.p,To=null,eo=null,Fn=null;if(fi!=null){if(fi.zero(),Ci.sizeVec3==Ci.stackVec3.length){for(var Ns=Ci.sizeVec3<<1,Nn=new Array(Ns),Wo=Nn,kn=0,Ys=Ci.sizeVec3;kn<Ys;){var Ot=kn++;Wo[Ot]=Ci.stackVec3[Ot],Ci.stackVec3[Ot]=null}Ci.stackVec3=Wo}Ci.stackVec3[Ci.sizeVec3++]=fi}if(To!=null){var Qo=1,Ur=0,wn=0,Jn=0,fs=1,Ie=0,Uo=0,Ve=0,w_=1;if(To.e00=Qo,To.e01=Ur,To.e02=wn,To.e10=Jn,To.e11=fs,To.e12=Ie,To.e20=Uo,To.e21=Ve,To.e22=w_,Ci.sizeMat3==Ci.stackMat3.length){for(var Je=Ci.sizeMat3<<1,X_=new Array(Je),Js=X_,F_=0,N_=Ci.sizeMat3;F_<N_;){var Or=F_++;Js[Or]=Ci.stackMat3[Or],Ci.stackMat3[Or]=null}Ci.stackMat3=Js}Ci.stackMat3[Ci.sizeMat3++]=To}if(eo!=null){var wo=1,Xo=0,Gn=0,wi=0,Wn=0,Ro=1,to=0,J_=0,G_=0,L_=0,ie=1,__=0,v_=0,re=0,pi=0,Oo=1;if(eo.e00=wo,eo.e01=Xo,eo.e02=Gn,eo.e03=wi,eo.e10=Wn,eo.e11=Ro,eo.e12=to,eo.e13=J_,eo.e20=G_,eo.e21=L_,eo.e22=ie,eo.e23=__,eo.e30=v_,eo.e31=re,eo.e32=pi,eo.e33=Oo,Ci.sizeMat4==Ci.stackMat4.length){for(var ar=Ci.sizeMat4<<1,Zs=new Array(ar),Ge=Zs,hv=0,xs=Ci.sizeMat4;hv<xs;){var Gs=hv++;Ge[Gs]=Ci.stackMat4[Gs],Ci.stackMat4[Gs]=null}Ci.stackMat4=Ge}Ci.stackMat4[Ci.sizeMat4++]=eo}if(Fn!=null){var $n=0,We=0,Ti=0,Lo=1;if(Fn.x=$n,Fn.y=We,Fn.z=Ti,Fn.w=Lo,Ci.sizeQuat==Ci.stackQuat.length){for(var Tr=Ci.sizeQuat<<1,en=new Array(Tr),ke=en,Y_=0,Ws=Ci.sizeQuat;Y_<Ws;){var jn=Y_++;ke[jn]=Ci.stackQuat[jn],Ci.stackQuat[jn]=null}Ci.stackQuat=ke}Ci.stackQuat[Ci.sizeQuat++]=Fn}}var Xn=this.p;if(Z!=null){if(Z.zero(),Xn.sizeVec3==Xn.stackVec3.length){for(var oe=Xn.sizeVec3<<1,Bs=new Array(oe),ne=Bs,Ue=0,l_=Xn.sizeVec3;Ue<l_;){var As=Ue++;ne[As]=Xn.stackVec3[As],Xn.stackVec3[As]=null}Xn.stackVec3=ne}Xn.stackVec3[Xn.sizeVec3++]=Z}var ds=this.p;if(oa!=null){if(oa.zero(),ds.sizeVec3==ds.stackVec3.length){for(var qn=ds.sizeVec3<<1,mi=new Array(qn),uo=mi,Zr=0,Ho=ds.sizeVec3;Zr<Ho;){var Yo=Zr++;uo[Yo]=ds.stackVec3[Yo],ds.stackVec3[Yo]=null}ds.stackVec3=uo}ds.stackVec3[ds.sizeVec3++]=oa}var Hr=this.p;if(sa!=null){if(sa.zero(),Hr.sizeVec3==Hr.stackVec3.length){for(var Eo=Hr.sizeVec3<<1,we=new Array(Eo),as=we,Oe=0,W_=Hr.sizeVec3;Oe<W_;){var ts=Oe++;as[ts]=Hr.stackVec3[ts],Hr.stackVec3[ts]=null}Hr.stackVec3=as}Hr.stackVec3[Hr.sizeVec3++]=sa}var Nt=this.p;if(nt!=null){if(nt.zero(),Nt.sizeVec3==Nt.stackVec3.length){for(var Kr=Nt.sizeVec3<<1,Do=new Array(Kr),Xe=Do,kv=0,i0=Nt.sizeVec3;kv<i0;){var U_=kv++;Xe[U_]=Nt.stackVec3[U_],Nt.stackVec3[U_]=null}Nt.stackVec3=Xe}Nt.stackVec3[Nt.sizeVec3++]=nt}var Ht=this.p;if(Ta!=null){if(Ta.zero(),Ht.sizeVec3==Ht.stackVec3.length){for(var Ln=Ht.sizeVec3<<1,Qr=new Array(Ln),Yn=Qr,Z_=0,He=Ht.sizeVec3;Z_<He;){var h_=Z_++;Yn[h_]=Ht.stackVec3[h_],Ht.stackVec3[h_]=null}Ht.stackVec3=Yn}Ht.stackVec3[Ht.sizeVec3++]=Ta}var bo=this.p;if(yt!=null){if(yt.zero(),bo.sizeVec3==bo.stackVec3.length){for(var se=bo.sizeVec3<<1,ee=new Array(se),us=ee,Zi=0,Ko=bo.sizeVec3;Zi<Ko;){var kr=Zi++;us[kr]=bo.stackVec3[kr],bo.stackVec3[kr]=null}bo.stackVec3=us}bo.stackVec3[bo.sizeVec3++]=yt}var Zo=this.p;if(ja!=null){if(ja.zero(),Zo.sizeVec3==Zo.stackVec3.length){for(var Us=Zo.sizeVec3<<1,cv=new Array(Us),zs=cv,Ke=0,wv=Zo.sizeVec3;Ke<wv;){var Os=Ke++;zs[Os]=Zo.stackVec3[Os],Zo.stackVec3[Os]=null}Zo.stackVec3=zs}Zo.stackVec3[Zo.sizeVec3++]=ja}var si=this.p;if(ti!=null){if(ti.zero(),si.sizeVec3==si.stackVec3.length){for(var Zn=si.sizeVec3<<1,_n=new Array(Zn),vn=_n,B_=0,bv=si.sizeVec3;B_<bv;){var is=B_++;vn[is]=si.stackVec3[is],si.stackVec3[is]=null}si.stackVec3=vn}si.stackVec3[si.sizeVec3++]=ti}var Ss=this.p;if(l!=null){if(l.zero(),Ss.sizeVec3==Ss.stackVec3.length){for(var c_=Ss.sizeVec3<<1,O_=new Array(c_),fv=O_,xv=0,b_=Ss.sizeVec3;xv<b_;){var Hs=xv++;fv[Hs]=Ss.stackVec3[Hs],Ss.stackVec3[Hs]=null}Ss.stackVec3=fv}Ss.stackVec3[Ss.sizeVec3++]=l}var zo=this.p;if(b!=null){var _e=1,ve=0,Ui=0,Mo=0,_o=1,le=0,Le=0,Ye=0,Ze=1;if(b.e00=_e,b.e01=ve,b.e02=Ui,b.e10=Mo,b.e11=_o,b.e12=le,b.e20=Le,b.e21=Ye,b.e22=Ze,zo.sizeMat3==zo.stackMat3.length){for(var A_=zo.sizeMat3<<1,Ms=new Array(A_),he=Ms,H_=0,$e=zo.sizeMat3;H_<$e;){var Un=H_++;he[Un]=zo.stackMat3[Un],zo.stackMat3[Un]=null}zo.stackMat3=he}zo.stackMat3[zo.sizeMat3++]=b}var ps=this.p;if(r!=null){if(r.zero(),ps.sizeVec3==ps.stackVec3.length){for(var Xv=ps.sizeVec3<<1,d_=new Array(Xv),$o=d_,ln=0,po=ps.sizeVec3;ln<po;){var Kt=ln++;$o[Kt]=ps.stackVec3[Kt],ps.stackVec3[Kt]=null}ps.stackVec3=$o}ps.stackVec3[ps.sizeVec3++]=r}var $r=this.p;if(_!=null){if(_.zero(),$r.sizeVec3==$r.stackVec3.length){for(var vo=$r.sizeVec3<<1,je=new Array(vo),Be=je,qe=0,S_=$r.sizeVec3;qe<S_;){var jo=qe++;Be[jo]=$r.stackVec3[jo],$r.stackVec3[jo]=null}$r.stackVec3=Be}$r.stackVec3[$r.sizeVec3++]=_}var rs=this.p;if(v!=null){if(v.zero(),rs.sizeVec3==rs.stackVec3.length){for(var K_=rs.sizeVec3<<1,uv=new Array(K_),Bi=uv,mo=0,Rr=rs.sizeVec3;mo<Rr;){var io=mo++;Bi[io]=rs.stackVec3[io],rs.stackVec3[io]=null}rs.stackVec3=Bi}rs.stackVec3[rs.sizeVec3++]=v}}rect(a,t,i,o,r,e,_,h,v){this.triangle(a,t,i,r,e,_,v),this.triangle(a,i,o,r,_,h,v)}point(a,t){}triangle(a,t,i,o,r,e,_){}line(a,t,i){}};u.dynamics.common.DebugDrawStyle=class{constructor(){this.basisColorZ=new u.common.Vec3(0,0,1),this.basisColorY=new u.common.Vec3(0,1,0),this.basisColorX=new u.common.Vec3(1,0,0),this.basisLength=.5,this.jointRotationalConstraintRadius=.3,this.jointErrorColor=new u.common.Vec3(1,.1,.1),this.jointLineColor=new u.common.Vec3(.8,.8,.8),this.contactBinormalLength=.5,this.contactTangentLength=.5,this.contactNormalLength=.5,this.contactBinormalColor=new u.common.Vec3(.2,.2,1),this.contactTangentColor=new u.common.Vec3(.1,.8,.1),this.contactNormalColor=new u.common.Vec3(1,.1,.1),this.disabledContactColor=new u.common.Vec3(.5,.1,.1),this.newContactColor=new u.common.Vec3(1,1,.1),this.contactColor4=new u.common.Vec3(.8,.1,1),this.contactColor3=new u.common.Vec3(.1,.8,.6),this.contactColor2=new u.common.Vec3(1,.6,.1),this.contactColor=new u.common.Vec3(1,.1,.1),this.pairColor=new u.common.Vec3(1,1,.1),this.bvhNodeColor=new u.common.Vec3(.4,.4,.4),this.aabbColor=new u.common.Vec3(1,.1,.1),this.kinematicShapeColor=new u.common.Vec3(1,.5,.1),this.staticShapeColor=new u.common.Vec3(.7,.7,.7),this.sleepingShapeColor2=new u.common.Vec3(.2,.8,.5),this.sleepingShapeColor1=new u.common.Vec3(.3,.3,.8),this.sleepyShapeColor2=new u.common.Vec3(.6,.8,.3),this.sleepyShapeColor1=new u.common.Vec3(.5,.25,.6),this.shapeColor2=new u.common.Vec3(1,.8,.1),this.shapeColor1=new u.common.Vec3(.7,.2,.4)}};u.dynamics.common.Performance=class{};u.dynamics.constraint||(u.dynamics.constraint={});u.dynamics.constraint.ConstraintSolver=class{constructor(){this._b1=null,this._b2=null,this._addedToIsland=!1}preSolveVelocity(a){}warmStart(a){}solveVelocity(){}postSolveVelocity(a){}preSolvePosition(a){}solvePositionSplitImpulse(){}solvePositionNgs(a){}postSolve(){}};u.dynamics.constraint.PositionCorrectionAlgorithm=class{};u.dynamics.constraint.contact||(u.dynamics.constraint.contact={});u.dynamics.constraint.contact.ContactConstraint=class{constructor(a){this._solver=new u.dynamics.constraint.solver.pgs.PgsContactConstraintSolver(this),this._manifold=a}_getVelocitySolverInfo(a,t){t.b1=this._b1,t.b2=this._b2;var i,o,r,e,_,h,v,s,l;i=this._manifold._normalX,o=this._manifold._normalY,r=this._manifold._normalZ,e=this._manifold._tangentX,_=this._manifold._tangentY,h=this._manifold._tangentZ,v=this._manifold._binormalX,s=this._manifold._binormalY,l=this._manifold._binormalZ;var x=Math.sqrt(this._s1._friction*this._s2._friction),b=Math.sqrt(this._s1._restitution*this._s2._restitution),f=this._manifold._numPoints;t.numRows=0,this._tf1._positionX-this._tf2._positionX,this._tf1._positionY-this._tf2._positionY,this._tf1._positionZ-this._tf2._positionZ;for(var n=0,c=f;n<c;){var z=n++,p=this._manifold._points[z];if(p._depth<0){p._disabled=!0;var y=p._impulse;y.impulseN=0,y.impulseT=0,y.impulseB=0,y.impulseP=0,y.impulseLX=0,y.impulseLY=0,y.impulseLZ=0;continue}else p._disabled=!1;var V=t.rows[t.numRows++];V.friction=x,V.cfm=0;var M=V.jacobianN;M.lin1X=i,M.lin1Y=o,M.lin1Z=r,M.lin2X=i,M.lin2Y=o,M.lin2Z=r,M.ang1X=p._relPos1Y*r-p._relPos1Z*o,M.ang1Y=p._relPos1Z*i-p._relPos1X*r,M.ang1Z=p._relPos1X*o-p._relPos1Y*i,M.ang2X=p._relPos2Y*r-p._relPos2Z*o,M.ang2Y=p._relPos2Z*i-p._relPos2X*r,M.ang2Z=p._relPos2X*o-p._relPos2Y*i,M=V.jacobianT,M.lin1X=e,M.lin1Y=_,M.lin1Z=h,M.lin2X=e,M.lin2Y=_,M.lin2Z=h,M.ang1X=p._relPos1Y*h-p._relPos1Z*_,M.ang1Y=p._relPos1Z*e-p._relPos1X*h,M.ang1Z=p._relPos1X*_-p._relPos1Y*e,M.ang2X=p._relPos2Y*h-p._relPos2Z*_,M.ang2Y=p._relPos2Z*e-p._relPos2X*h,M.ang2Z=p._relPos2X*_-p._relPos2Y*e,M=V.jacobianB,M.lin1X=v,M.lin1Y=s,M.lin1Z=l,M.lin2X=v,M.lin2Y=s,M.lin2Z=l,M.ang1X=p._relPos1Y*l-p._relPos1Z*s,M.ang1Y=p._relPos1Z*v-p._relPos1X*l,M.ang1Z=p._relPos1X*s-p._relPos1Y*v,M.ang2X=p._relPos2Y*l-p._relPos2Z*s,M.ang2Y=p._relPos2Z*v-p._relPos2X*l,M.ang2Z=p._relPos2X*s-p._relPos2Y*v,M=V.jacobianN;var I=M.lin1X*this._b1._velX+M.lin1Y*this._b1._velY+M.lin1Z*this._b1._velZ+(M.ang1X*this._b1._angVelX+M.ang1Y*this._b1._angVelY+M.ang1Z*this._b1._angVelZ)-(M.lin2X*this._b2._velX+M.lin2Y*this._b2._velY+M.lin2Z*this._b2._velZ+(M.ang2X*this._b2._angVelX+M.ang2Y*this._b2._angVelY+M.ang2Z*this._b2._angVelZ));if(I<-u.common.Setting.contactEnableBounceThreshold&&!p._warmStarted?V.rhs=-I*b:V.rhs=0,this._positionCorrectionAlgorithm==u.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE&&p._depth>u.common.Setting.linearSlop){var k=(p._depth-u.common.Setting.linearSlop)*u.common.Setting.velocityBaumgarte*a.invDt;V.rhs<k&&(V.rhs=k)}if(!p._warmStarted){var X=p._impulse;X.impulseN=0,X.impulseT=0,X.impulseB=0,X.impulseP=0,X.impulseLX=0,X.impulseLY=0,X.impulseLZ=0}V.impulse=p._impulse}}_getPositionSolverInfo(a){a.b1=this._b1,a.b2=this._b2;var t,i,o;t=this._manifold._normalX,i=this._manifold._normalY,o=this._manifold._normalZ;var r=this._manifold._numPoints;a.numRows=0;for(var e=0,_=r;e<_;){var h=e++,v=this._manifold._points[h];if(!v._disabled){var s=a.rows[a.numRows++],l=s.jacobianN;l.lin1X=t,l.lin1Y=i,l.lin1Z=o,l.lin2X=t,l.lin2Y=i,l.lin2Z=o,l.ang1X=v._relPos1Y*o-v._relPos1Z*i,l.ang1Y=v._relPos1Z*t-v._relPos1X*o,l.ang1Z=v._relPos1X*i-v._relPos1Y*t,l.ang2X=v._relPos2Y*o-v._relPos2Z*i,l.ang2Y=v._relPos2Z*t-v._relPos2X*o,l.ang2Z=v._relPos2X*i-v._relPos2Y*t,s.rhs=v._depth-u.common.Setting.linearSlop,s.rhs<0&&(s.rhs=0),s.impulse=v._impulse}}}_syncManifold(){this._manifold._updateDepthsAndPositions(this._tf1,this._tf2)}getShape1(){return this._s1}getShape2(){return this._s2}getManifold(){return this._manifold}isTouching(){for(var a=0,t=this._manifold._numPoints;a<t;){var i=a++;if(this._manifold._points[i]._depth>=0)return!0}return!1}};u.dynamics.constraint.contact.ContactImpulse=class{constructor(){this.impulseN=0,this.impulseT=0,this.impulseB=0,this.impulseP=0,this.impulseLX=0,this.impulseLY=0,this.impulseLZ=0}copyFrom(a){this.impulseN=a.impulseN,this.impulseT=a.impulseT,this.impulseB=a.impulseB,this.impulseLX=a.impulseLX,this.impulseLY=a.impulseLY,this.impulseLZ=a.impulseLZ}};u.dynamics.constraint.contact.Manifold=class{constructor(){this._normalX=0,this._normalY=0,this._normalZ=0,this._tangentX=0,this._tangentY=0,this._tangentZ=0,this._binormalX=0,this._binormalY=0,this._binormalZ=0,this._numPoints=0;var a=new Array(u.common.Setting.maxManifoldPoints);this._points=a;for(var t=0,i=u.common.Setting.maxManifoldPoints;t<i;){var o=t++;this._points[o]=new u.dynamics.constraint.contact.ManifoldPoint}}_clear(){for(var a=0,t=this._numPoints;a<t;){var i=a++,o=this._points[i];o._localPos1X=0,o._localPos1Y=0,o._localPos1Z=0,o._localPos2X=0,o._localPos2Y=0,o._localPos2Z=0,o._relPos1X=0,o._relPos1Y=0,o._relPos1Z=0,o._relPos2X=0,o._relPos2Y=0,o._relPos2Z=0,o._pos1X=0,o._pos1Y=0,o._pos1Z=0,o._pos2X=0,o._pos2Y=0,o._pos2Z=0,o._depth=0;var r=o._impulse;r.impulseN=0,r.impulseT=0,r.impulseB=0,r.impulseP=0,r.impulseLX=0,r.impulseLY=0,r.impulseLZ=0,o._warmStarted=!1,o._disabled=!1,o._id=-1}this._numPoints=0}_buildBasis(a){var t=a;this._normalX=t.x,this._normalY=t.y,this._normalZ=t.z;var i=a.x,o=a.y,r=a.z,e=i*i,_=o*o,h=r*r,v,s,l,x,b,f;if(e<_)if(e<h){var n=1/Math.sqrt(_+h);v=0,s=-r*n,l=o*n,x=o*l-r*s,b=-i*l,f=i*s}else{var c=1/Math.sqrt(e+_);v=-o*c,s=i*c,l=0,x=-r*s,b=r*v,f=i*s-o*v}else if(_<h){var z=1/Math.sqrt(e+h);v=r*z,s=0,l=-i*z,x=o*l,b=r*v-i*l,f=-o*v}else{var p=1/Math.sqrt(e+_);v=-o*p,s=i*p,l=0,x=-r*s,b=r*v,f=i*s-o*v}this._tangentX=v,this._tangentY=s,this._tangentZ=l,this._binormalX=x,this._binormalY=b,this._binormalZ=f}_updateDepthsAndPositions(a,t){for(var i=0,o=this._numPoints;i<o;){var r=i++,e=this._points[r],_,h,v;_=a._rotation00*e._localPos1X+a._rotation01*e._localPos1Y+a._rotation02*e._localPos1Z,h=a._rotation10*e._localPos1X+a._rotation11*e._localPos1Y+a._rotation12*e._localPos1Z,v=a._rotation20*e._localPos1X+a._rotation21*e._localPos1Y+a._rotation22*e._localPos1Z,e._relPos1X=_,e._relPos1Y=h,e._relPos1Z=v;var s,l,x;s=t._rotation00*e._localPos2X+t._rotation01*e._localPos2Y+t._rotation02*e._localPos2Z,l=t._rotation10*e._localPos2X+t._rotation11*e._localPos2Y+t._rotation12*e._localPos2Z,x=t._rotation20*e._localPos2X+t._rotation21*e._localPos2Y+t._rotation22*e._localPos2Z,e._relPos2X=s,e._relPos2Y=l,e._relPos2Z=x,e._pos1X=e._relPos1X+a._positionX,e._pos1Y=e._relPos1Y+a._positionY,e._pos1Z=e._relPos1Z+a._positionZ,e._pos2X=e._relPos2X+t._positionX,e._pos2Y=e._relPos2Y+t._positionY,e._pos2Z=e._relPos2Z+t._positionZ;var b,f,n;b=e._pos1X-e._pos2X,f=e._pos1Y-e._pos2Y,n=e._pos1Z-e._pos2Z;var c=b*this._normalX+f*this._normalY+n*this._normalZ;e._depth=-c}}getNormal(){var a=new u.common.Vec3,t=a;return t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ,a}getNormalTo(a){var t=a;t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ}getTangent(){var a=new u.common.Vec3,t=a;return t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ,a}getTangentTo(a){var t=a;t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ}getBinormal(){var a=new u.common.Vec3,t=a;return t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ,a}getBinormalTo(a){var t=a;t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ}getPoints(){return this._points}getNumPoints(){return this._numPoints}};u.dynamics.constraint.contact.ManifoldPoint=class{constructor(){this._localPos1X=0,this._localPos1Y=0,this._localPos1Z=0,this._localPos2X=0,this._localPos2Y=0,this._localPos2Z=0,this._relPos1X=0,this._relPos1Y=0,this._relPos1Z=0,this._relPos2X=0,this._relPos2Y=0,this._relPos2Z=0,this._pos1X=0,this._pos1Y=0,this._pos1Z=0,this._pos2X=0,this._pos2Y=0,this._pos2Z=0,this._depth=0,this._impulse=new u.dynamics.constraint.contact.ContactImpulse,this._warmStarted=!1,this._disabled=!1,this._id=-1}getPosition1(){var a=new u.common.Vec3,t=a;return t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z,a}getPosition1To(a){var t=a;t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z}getPosition2(){var a=new u.common.Vec3,t=a;return t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z,a}getPosition2To(a){var t=a;t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z}getDepth(){return this._depth}isWarmStarted(){return this._warmStarted}getNormalImpulse(){return this._impulse.impulseN}getTangentImpulse(){return this._impulse.impulseT}getBinormalImpulse(){return this._impulse.impulseB}isEnabled(){return!this._disabled}};u.dynamics.constraint.contact.ManifoldUpdater=class{constructor(a){this._manifold=a,this.numOldPoints=0;var t=new Array(u.common.Setting.maxManifoldPoints);this.oldPoints=t;for(var i=0,o=u.common.Setting.maxManifoldPoints;i<o;){var r=i++;this.oldPoints[r]=new u.dynamics.constraint.contact.ManifoldPoint}}removeOutdatedPoints(){for(var a=this._manifold._numPoints,t=a;--t>=0;){var i=this._manifold._points[t],o,r,e;o=i._pos1X-i._pos2X,r=i._pos1Y-i._pos2Y,e=i._pos1Z-i._pos2Z;var _=this._manifold._normalX*o+this._manifold._normalY*r+this._manifold._normalZ*e;if(_>u.common.Setting.contactPersistenceThreshold){this.removeManifoldPoint(t);continue}if(o+=this._manifold._normalX*-_,r+=this._manifold._normalY*-_,e+=this._manifold._normalZ*-_,o*o+r*r+e*e>u.common.Setting.contactPersistenceThreshold*u.common.Setting.contactPersistenceThreshold){this.removeManifoldPoint(t);continue}}}removeManifoldPoint(a){var t=--this._manifold._numPoints;if(a!=t){var i=this._manifold._points[a];this._manifold._points[a]=this._manifold._points[t],this._manifold._points[t]=i}var o=this._manifold._points[t];o._localPos1X=0,o._localPos1Y=0,o._localPos1Z=0,o._localPos2X=0,o._localPos2Y=0,o._localPos2Z=0,o._relPos1X=0,o._relPos1Y=0,o._relPos1Z=0,o._relPos2X=0,o._relPos2Y=0,o._relPos2Z=0,o._pos1X=0,o._pos1Y=0,o._pos1Z=0,o._pos2X=0,o._pos2Y=0,o._pos2Z=0,o._depth=0;var r=o._impulse;r.impulseN=0,r.impulseT=0,r.impulseB=0,r.impulseP=0,r.impulseLX=0,r.impulseLY=0,r.impulseLZ=0,o._warmStarted=!1,o._disabled=!1,o._id=-1}addManifoldPoint(a,t,i){var o=this._manifold._numPoints;if(o==u.common.Setting.maxManifoldPoints){var r=this.computeTargetIndex(a,t,i),e=this._manifold._points[r],_=a.position1;e._pos1X=_.x,e._pos1Y=_.y,e._pos1Z=_.z;var h=a.position2;e._pos2X=h.x,e._pos2Y=h.y,e._pos2Z=h.z,e._relPos1X=e._pos1X-t._positionX,e._relPos1Y=e._pos1Y-t._positionY,e._relPos1Z=e._pos1Z-t._positionZ,e._relPos2X=e._pos2X-i._positionX,e._relPos2Y=e._pos2Y-i._positionY,e._relPos2Z=e._pos2Z-i._positionZ;var v,s,l;v=t._rotation00*e._relPos1X+t._rotation10*e._relPos1Y+t._rotation20*e._relPos1Z,s=t._rotation01*e._relPos1X+t._rotation11*e._relPos1Y+t._rotation21*e._relPos1Z,l=t._rotation02*e._relPos1X+t._rotation12*e._relPos1Y+t._rotation22*e._relPos1Z,e._localPos1X=v,e._localPos1Y=s,e._localPos1Z=l;var x,b,f;x=i._rotation00*e._relPos2X+i._rotation10*e._relPos2Y+i._rotation20*e._relPos2Z,b=i._rotation01*e._relPos2X+i._rotation11*e._relPos2Y+i._rotation21*e._relPos2Z,f=i._rotation02*e._relPos2X+i._rotation12*e._relPos2Y+i._rotation22*e._relPos2Z,e._localPos2X=x,e._localPos2Y=b,e._localPos2Z=f,e._depth=a.depth;var n=e._impulse;n.impulseN=0,n.impulseT=0,n.impulseB=0,n.impulseP=0,n.impulseLX=0,n.impulseLY=0,n.impulseLZ=0,e._id=a.id,e._warmStarted=!1,e._disabled=!1;return}var c=this._manifold._points[o],z=a.position1;c._pos1X=z.x,c._pos1Y=z.y,c._pos1Z=z.z;var p=a.position2;c._pos2X=p.x,c._pos2Y=p.y,c._pos2Z=p.z,c._relPos1X=c._pos1X-t._positionX,c._relPos1Y=c._pos1Y-t._positionY,c._relPos1Z=c._pos1Z-t._positionZ,c._relPos2X=c._pos2X-i._positionX,c._relPos2Y=c._pos2Y-i._positionY,c._relPos2Z=c._pos2Z-i._positionZ;var y,V,M;y=t._rotation00*c._relPos1X+t._rotation10*c._relPos1Y+t._rotation20*c._relPos1Z,V=t._rotation01*c._relPos1X+t._rotation11*c._relPos1Y+t._rotation21*c._relPos1Z,M=t._rotation02*c._relPos1X+t._rotation12*c._relPos1Y+t._rotation22*c._relPos1Z,c._localPos1X=y,c._localPos1Y=V,c._localPos1Z=M;var I,k,X;I=i._rotation00*c._relPos2X+i._rotation10*c._relPos2Y+i._rotation20*c._relPos2Z,k=i._rotation01*c._relPos2X+i._rotation11*c._relPos2Y+i._rotation21*c._relPos2Z,X=i._rotation02*c._relPos2X+i._rotation12*c._relPos2Y+i._rotation22*c._relPos2Z,c._localPos2X=I,c._localPos2Y=k,c._localPos2Z=X,c._depth=a.depth;var L=c._impulse;L.impulseN=0,L.impulseT=0,L.impulseB=0,L.impulseP=0,L.impulseLX=0,L.impulseLY=0,L.impulseLZ=0,c._id=a.id,c._warmStarted=!1,c._disabled=!1,this._manifold._numPoints++}computeTargetIndex(a,t,i){var o=this._manifold._points[0],r=this._manifold._points[1],e=this._manifold._points[2],_=this._manifold._points[3],h=o._depth,v=0;r._depth>h&&(h=r._depth,v=1),e._depth>h&&(h=e._depth,v=2),_._depth>h&&(h=_._depth,v=3);var s,l,x,b=a.position1;s=b.x,l=b.y,x=b.z,s-=t._positionX,l-=t._positionY,x-=t._positionZ;var f=r._relPos1X,n=r._relPos1Y,c=r._relPos1Z,z=e._relPos1X,p=e._relPos1Y,y=e._relPos1Z,V=_._relPos1X,M=_._relPos1Y,I=_._relPos1Z,k,X,L,m,g,N,d,F,S,Y,Q,C,B,Z,$,K,E,J;k=z-f,X=p-n,L=y-c,m=s-V,g=l-M,N=x-I,d=V-f,F=M-n,S=I-c,Y=s-z,Q=l-p,C=x-y,B=s-f,Z=l-n,$=x-c,K=V-z,E=M-p,J=I-y;var A,R,U,G,D,H,j,ia,ea;A=X*N-L*g,R=L*m-k*N,U=k*g-X*m,G=F*C-S*Q,D=S*Y-d*C,H=d*Q-F*Y,j=Z*J-$*E,ia=$*K-B*J,ea=B*E-Z*K;var W=A*A+R*R+U*U,q=G*G+D*D+H*H,na=j*j+ia*ia+ea*ea,oa=W>q?W>na?W:na:q>na?q:na,aa=o._relPos1X,T=o._relPos1Y,ca=o._relPos1Z,_a=e._relPos1X,w=e._relPos1Y,ta=e._relPos1Z,ra=_._relPos1X,la=_._relPos1Y,va=_._relPos1Z,ua,za,Ma,Xa,Za,fa,ba,sa,ha,ma,ya,Ba,pa,Ya,Ra,ga,xa,wa;ua=_a-aa,za=w-T,Ma=ta-ca,Xa=s-ra,Za=l-la,fa=x-va,ba=ra-aa,sa=la-T,ha=va-ca,ma=s-_a,ya=l-w,Ba=x-ta,pa=s-aa,Ya=l-T,Ra=x-ca,ga=ra-_a,xa=la-w,wa=va-ta;var ka,Pa,zt,Oa,Aa,nt,Ea,Fa,da;ka=za*fa-Ma*Za,Pa=Ma*Xa-ua*fa,zt=ua*Za-za*Xa,Oa=sa*Ba-ha*ya,Aa=ha*ma-ba*Ba,nt=ba*ya-sa*ma,Ea=Ya*wa-Ra*xa,Fa=Ra*ga-pa*wa,da=pa*xa-Ya*ga;var ft=ka*ka+Pa*Pa+zt*zt,Wa=Oa*Oa+Aa*Aa+nt*nt,Ha=Ea*Ea+Fa*Fa+da*da,bt=ft>Wa?ft>Ha?ft:Ha:Wa>Ha?Wa:Ha,it=o._relPos1X,Ka=o._relPos1Y,_t=o._relPos1Z,gt=r._relPos1X,pt=r._relPos1Y,Ga=r._relPos1Z,rt=_._relPos1X,xt=_._relPos1Y,Da=_._relPos1Z,Ta,Na,Vt,Pt,st,Xt,Yt,Mt,Ia,O,Va,lt,P,wt,At,dt,yt,kt;Ta=gt-it,Na=pt-Ka,Vt=Ga-_t,Pt=s-rt,st=l-xt,Xt=x-Da,Yt=rt-it,Mt=xt-Ka,Ia=Da-_t,O=s-gt,Va=l-pt,lt=x-Ga,P=s-it,wt=l-Ka,At=x-_t,dt=rt-gt,yt=xt-pt,kt=Da-Ga;var mt,ht,ut,Qa,et,Ca,vt,qa,at;mt=Na*Xt-Vt*st,ht=Vt*Pt-Ta*Xt,ut=Ta*st-Na*Pt,Qa=Mt*lt-Ia*Va,et=Ia*O-Yt*lt,Ca=Yt*Va-Mt*O,vt=wt*kt-At*yt,qa=At*dt-P*kt,at=P*yt-wt*dt;var Ua=mt*mt+ht*ht+ut*ut,tt=Qa*Qa+et*et+Ca*Ca,ct=vt*vt+qa*qa+at*at,Sa=Ua>tt?Ua>ct?Ua:ct:tt>ct?tt:ct,Ja=o._relPos1X,ja=o._relPos1Y,La=o._relPos1Z,ot=r._relPos1X,It=r._relPos1Y,oi=r._relPos1Z,gi=e._relPos1X,ai=e._relPos1Y,Ct=e._relPos1Z,_i,Et,St,Jt,Ki,vi,li,ti,Oi,Xi,zi,Zt,ri,Wt,ni,$i,Ut,ji;_i=ot-Ja,Et=It-ja,St=oi-La,Jt=s-gi,Ki=l-ai,vi=x-Ct,li=gi-Ja,ti=ai-ja,Oi=Ct-La,Xi=s-ot,zi=l-It,Zt=x-oi,ri=s-Ja,Wt=l-ja,ni=x-La,$i=gi-ot,Ut=ai-It,ji=Ct-oi;var Ii,pr,Wi,Lt,jt,Tt,bi,Mi,vr;Ii=Et*vi-St*Ki,pr=St*Jt-_i*vi,Wi=_i*Ki-Et*Jt,Lt=ti*Zt-Oi*zi,jt=Oi*Xi-li*Zt,Tt=li*zi-ti*Xi,bi=Wt*ji-ni*Ut,Mi=ni*$i-ri*ji,vr=ri*Ut-Wt*$i;var qt=Ii*Ii+pr*pr+Wi*Wi,fi=Lt*Lt+jt*jt+Tt*Tt,Bt=bi*bi+Mi*Mi+vr*vr,xi=qt>fi?qt>Bt?qt:Bt:fi>Bt?fi:Bt,hi=oa,sr=0;return(bt>hi&&v!=1||v==0)&&(hi=bt,sr=1),Sa>hi&&v!=2&&(hi=Sa,sr=2),xi>hi&&v!=3&&(hi=xi,sr=3),sr}computeRelativePositions(a,t){for(var i=this._manifold._numPoints,o=0,r=i;o<r;){var e=o++,_=this._manifold._points[e],h,v,s;h=a._rotation00*_._localPos1X+a._rotation01*_._localPos1Y+a._rotation02*_._localPos1Z,v=a._rotation10*_._localPos1X+a._rotation11*_._localPos1Y+a._rotation12*_._localPos1Z,s=a._rotation20*_._localPos1X+a._rotation21*_._localPos1Y+a._rotation22*_._localPos1Z,_._relPos1X=h,_._relPos1Y=v,_._relPos1Z=s;var l,x,b;l=t._rotation00*_._localPos2X+t._rotation01*_._localPos2Y+t._rotation02*_._localPos2Z,x=t._rotation10*_._localPos2X+t._rotation11*_._localPos2Y+t._rotation12*_._localPos2Z,b=t._rotation20*_._localPos2X+t._rotation21*_._localPos2Y+t._rotation22*_._localPos2Z,_._relPos2X=l,_._relPos2Y=x,_._relPos2Z=b,_._warmStarted=!0}}findNearestContactPointIndex(a,t,i){for(var o=u.common.Setting.contactPersistenceThreshold*u.common.Setting.contactPersistenceThreshold,r=-1,e=0,_=this._manifold._numPoints;e<_;){var h=e++,v=this._manifold._points[h],s,l,x,b,f,n,c=a.position1;s=c.x,l=c.y,x=c.z;var z=a.position2;b=z.x,f=z.y,n=z.z,s-=t._positionX,l-=t._positionY,x-=t._positionZ,b-=i._positionX,f-=i._positionY,n-=i._positionZ;var p,y,V,M,I,k;p=v._relPos1X-s,y=v._relPos1Y-l,V=v._relPos1Z-x,M=v._relPos2X-b,I=v._relPos2Y-f,k=v._relPos2Z-n;var X=p*p+y*y+V*V,L=M*M+I*I+k*k,m=X<L?X:L;m<o&&(o=m,r=h)}return r}totalUpdate(a,t,i){this.numOldPoints=this._manifold._numPoints;for(var o=0,r=this.numOldPoints;o<r;){var e=o++,_=this.oldPoints[e],h=this._manifold._points[e];_._localPos1X=h._localPos1X,_._localPos1Y=h._localPos1Y,_._localPos1Z=h._localPos1Z,_._localPos2X=h._localPos2X,_._localPos2Y=h._localPos2Y,_._localPos2Z=h._localPos2Z,_._relPos1X=h._relPos1X,_._relPos1Y=h._relPos1Y,_._relPos1Z=h._relPos1Z,_._relPos2X=h._relPos2X,_._relPos2Y=h._relPos2Y,_._relPos2Z=h._relPos2Z,_._pos1X=h._pos1X,_._pos1Y=h._pos1Y,_._pos1Z=h._pos1Z,_._pos2X=h._pos2X,_._pos2Y=h._pos2Y,_._pos2Z=h._pos2Z,_._depth=h._depth,_._impulse.copyFrom(h._impulse),_._id=h._id,_._warmStarted=h._warmStarted,_._disabled=!1}var v=a.numPoints;this._manifold._numPoints=v;for(var s=0,l=v;s<l;){var x=s++,b=this._manifold._points[x],f=a.points[x],n=f.position1;b._pos1X=n.x,b._pos1Y=n.y,b._pos1Z=n.z;var c=f.position2;b._pos2X=c.x,b._pos2Y=c.y,b._pos2Z=c.z,b._relPos1X=b._pos1X-t._positionX,b._relPos1Y=b._pos1Y-t._positionY,b._relPos1Z=b._pos1Z-t._positionZ,b._relPos2X=b._pos2X-i._positionX,b._relPos2Y=b._pos2Y-i._positionY,b._relPos2Z=b._pos2Z-i._positionZ;var z,p,y;z=t._rotation00*b._relPos1X+t._rotation10*b._relPos1Y+t._rotation20*b._relPos1Z,p=t._rotation01*b._relPos1X+t._rotation11*b._relPos1Y+t._rotation21*b._relPos1Z,y=t._rotation02*b._relPos1X+t._rotation12*b._relPos1Y+t._rotation22*b._relPos1Z,b._localPos1X=z,b._localPos1Y=p,b._localPos1Z=y;var V,M,I;V=i._rotation00*b._relPos2X+i._rotation10*b._relPos2Y+i._rotation20*b._relPos2Z,M=i._rotation01*b._relPos2X+i._rotation11*b._relPos2Y+i._rotation21*b._relPos2Z,I=i._rotation02*b._relPos2X+i._rotation12*b._relPos2Y+i._rotation22*b._relPos2Z,b._localPos2X=V,b._localPos2Y=M,b._localPos2Z=I,b._depth=f.depth;var k=b._impulse;k.impulseN=0,k.impulseT=0,k.impulseB=0,k.impulseP=0,k.impulseLX=0,k.impulseLY=0,k.impulseLZ=0,b._id=f.id,b._warmStarted=!1,b._disabled=!1;for(var X=0,L=this.numOldPoints;X<L;){var m=X++,g=this.oldPoints[m];if(b._id==g._id){b._impulse.copyFrom(g._impulse),b._warmStarted=!0;break}}}}incrementalUpdate(a,t,i){this._manifold._updateDepthsAndPositions(t,i);for(var o=0,r=this._manifold._numPoints;o<r;){var e=o++;this._manifold._points[e]._warmStarted=!0}var _=a.points[0],h=this.findNearestContactPointIndex(_,t,i);if(h==-1)this.addManifoldPoint(_,t,i);else{var v=this._manifold._points[h],s=_.position1;v._pos1X=s.x,v._pos1Y=s.y,v._pos1Z=s.z;var l=_.position2;v._pos2X=l.x,v._pos2Y=l.y,v._pos2Z=l.z,v._relPos1X=v._pos1X-t._positionX,v._relPos1Y=v._pos1Y-t._positionY,v._relPos1Z=v._pos1Z-t._positionZ,v._relPos2X=v._pos2X-i._positionX,v._relPos2Y=v._pos2Y-i._positionY,v._relPos2Z=v._pos2Z-i._positionZ;var x,b,f;x=t._rotation00*v._relPos1X+t._rotation10*v._relPos1Y+t._rotation20*v._relPos1Z,b=t._rotation01*v._relPos1X+t._rotation11*v._relPos1Y+t._rotation21*v._relPos1Z,f=t._rotation02*v._relPos1X+t._rotation12*v._relPos1Y+t._rotation22*v._relPos1Z,v._localPos1X=x,v._localPos1Y=b,v._localPos1Z=f;var n,c,z;n=i._rotation00*v._relPos2X+i._rotation10*v._relPos2Y+i._rotation20*v._relPos2Z,c=i._rotation01*v._relPos2X+i._rotation11*v._relPos2Y+i._rotation21*v._relPos2Z,z=i._rotation02*v._relPos2X+i._rotation12*v._relPos2Y+i._rotation22*v._relPos2Z,v._localPos2X=n,v._localPos2Y=c,v._localPos2Z=z,v._depth=_.depth}this.removeOutdatedPoints()}};u.dynamics.constraint.info||(u.dynamics.constraint.info={});u.dynamics.constraint.info.JacobianRow=class{constructor(){this.lin1X=0,this.lin1Y=0,this.lin1Z=0,this.lin2X=0,this.lin2Y=0,this.lin2Z=0,this.ang1X=0,this.ang1Y=0,this.ang1Z=0,this.ang2X=0,this.ang2Y=0,this.ang2Z=0,this.flag=0}updateSparsity(){this.flag=0,(!(this.lin1X==0&&this.lin1Y==0&&this.lin1Z==0)||!(this.lin2X==0&&this.lin2Y==0&&this.lin2Z==0))&&(this.flag|=1),(!(this.ang1X==0&&this.ang1Y==0&&this.ang1Z==0)||!(this.ang2X==0&&this.ang2Y==0&&this.ang2Z==0))&&(this.flag|=2)}};u.dynamics.constraint.info.contact||(u.dynamics.constraint.info.contact={});u.dynamics.constraint.info.contact.ContactSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0;var a=new Array(u.common.Setting.maxManifoldPoints);this.rows=a;for(var t=0,i=this.rows.length;t<i;){var o=t++;this.rows[o]=new u.dynamics.constraint.info.contact.ContactSolverInfoRow}}};u.dynamics.constraint.info.contact.ContactSolverInfoRow=class{constructor(){this.jacobianN=new u.dynamics.constraint.info.JacobianRow,this.jacobianT=new u.dynamics.constraint.info.JacobianRow,this.jacobianB=new u.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.friction=0,this.impulse=null}};u.dynamics.constraint.info.joint||(u.dynamics.constraint.info.joint={});u.dynamics.constraint.info.joint.JointSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0;var a=new Array(u.common.Setting.maxJacobianRows);this.rows=a;for(var t=0,i=this.rows.length;t<i;){var o=t++;this.rows[o]=new u.dynamics.constraint.info.joint.JointSolverInfoRow}}};u.dynamics.constraint.info.joint.JointSolverInfoRow=class{constructor(){this.jacobian=new u.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.minImpulse=0,this.maxImpulse=0,this.motorSpeed=0,this.motorMaxImpulse=0,this.impulse=null}};u.dynamics.constraint.joint||(u.dynamics.constraint.joint={});u.dynamics.constraint.joint.BasisTracker=class{constructor(a){this.joint=a,this.xX=0,this.xY=0,this.xZ=0,this.yX=0,this.yY=0,this.yZ=0,this.zX=0,this.zY=0,this.zZ=0}};u.dynamics.constraint.joint.Joint=class{constructor(a,t){switch(this._link1=new u.dynamics.constraint.joint.JointLink(this),this._link2=new u.dynamics.constraint.joint.JointLink(this),this._positionCorrectionAlgorithm=u.common.Setting.defaultJointPositionCorrectionAlgorithm,this._type=t,this._world=null,this._b1=a.rigidBody1,this._b2=a.rigidBody2,this._allowCollision=a.allowCollision,this._breakForce=a.breakForce,this._breakTorque=a.breakTorque,a.solverType){case 0:this._solver=new u.dynamics.constraint.solver.pgs.PgsJointConstraintSolver(this);break;case 1:this._solver=new u.dynamics.constraint.solver.direct.DirectJointConstraintSolver(this);break}var i=a.localAnchor1;this._localAnchor1X=i.x,this._localAnchor1Y=i.y,this._localAnchor1Z=i.z;var o=a.localAnchor2;this._localAnchor2X=o.x,this._localAnchor2Y=o.y,this._localAnchor2Z=o.z,this._relativeAnchor1X=0,this._relativeAnchor1Y=0,this._relativeAnchor1Z=0,this._relativeAnchor2X=0,this._relativeAnchor2Y=0,this._relativeAnchor2Z=0,this._anchor1X=0,this._anchor1Y=0,this._anchor1Z=0,this._anchor2X=0,this._anchor2Y=0,this._anchor2Z=0,this._localBasisX1X=0,this._localBasisX1Y=0,this._localBasisX1Z=0,this._localBasisY1X=0,this._localBasisY1Y=0,this._localBasisY1Z=0,this._localBasisZ1X=0,this._localBasisZ1Y=0,this._localBasisZ1Z=0,this._localBasisX2X=0,this._localBasisX2Y=0,this._localBasisX2Z=0,this._localBasisY2X=0,this._localBasisY2Y=0,this._localBasisY2Z=0,this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=0;var r=new Array(u.common.Setting.maxJacobianRows);this._impulses=r;for(var e=0,_=u.common.Setting.maxJacobianRows;e<_;){var h=e++;this._impulses[h]=new u.dynamics.constraint.joint.JointImpulse}}buildLocalBasesFromX(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var a=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;a>0&&(a=1/Math.sqrt(a)),this._localBasisX1X*=a,this._localBasisX1Y*=a,this._localBasisX1Z*=a}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{var t=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX2X*=t,this._localBasisX2Y*=t,this._localBasisX2Z*=t}var i,o,r,e,_,h,v,s,l,x,b,f,n,c=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(c<-.999999999){var z,p,y,V=this._localBasisX1X,M=this._localBasisX1Y,I=this._localBasisX1Z,k=V*V,X=M*M,L=I*I,m;k<X?k<L?(m=1/Math.sqrt(X+L),z=0,p=I*m,y=-M*m):(m=1/Math.sqrt(k+X),z=M*m,p=-V*m,y=0):X<L?(m=1/Math.sqrt(L+k),z=-I*m,p=0,y=V*m):(m=1/Math.sqrt(k+X),z=M*m,p=-V*m,y=0),i=z,o=p,r=y,e=0}else{var g,N,d;g=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,N=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,d=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var F=Math.sqrt((1+c)*.5);c=.5/F,g*=c,N*=c,d*=c,i=g,o=N,r=d,e=F}var S=i,Y=o,Q=r,C=e,B=2*S,Z=2*Y,$=2*Q,K=S*B,E=Y*Z,J=Q*$,A=S*Z,R=Y*$,U=S*$,G=C*B,D=C*Z,H=C*$;_=1-E-J,h=A-H,v=U+D,s=A+H,l=1-K-J,x=R-G,b=U-D,f=R+G,n=1-K-E;var j=this._localBasisX1X,ia=this._localBasisX1Y,ea=this._localBasisX1Z,W=j*j,q=ia*ia,na=ea*ea,oa;W<q?W<na?(oa=1/Math.sqrt(q+na),this._localBasisY1X=0,this._localBasisY1Y=ea*oa,this._localBasisY1Z=-ia*oa):(oa=1/Math.sqrt(W+q),this._localBasisY1X=ia*oa,this._localBasisY1Y=-j*oa,this._localBasisY1Z=0):q<na?(oa=1/Math.sqrt(na+W),this._localBasisY1X=-ea*oa,this._localBasisY1Y=0,this._localBasisY1Z=j*oa):(oa=1/Math.sqrt(W+q),this._localBasisY1X=ia*oa,this._localBasisY1Y=-j*oa,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X;var aa,T,ca;aa=_*this._localBasisX1X+h*this._localBasisX1Y+v*this._localBasisX1Z,T=s*this._localBasisX1X+l*this._localBasisX1Y+x*this._localBasisX1Z,ca=b*this._localBasisX1X+f*this._localBasisX1Y+n*this._localBasisX1Z,this._localBasisX2X=aa,this._localBasisX2Y=T,this._localBasisX2Z=ca;var _a,w,ta;_a=_*this._localBasisY1X+h*this._localBasisY1Y+v*this._localBasisY1Z,w=s*this._localBasisY1X+l*this._localBasisY1Y+x*this._localBasisY1Z,ta=b*this._localBasisY1X+f*this._localBasisY1Y+n*this._localBasisY1Z,this._localBasisY2X=_a,this._localBasisY2Y=w,this._localBasisY2Z=ta;var ra,la,va;ra=_*this._localBasisZ1X+h*this._localBasisZ1Y+v*this._localBasisZ1Z,la=s*this._localBasisZ1X+l*this._localBasisZ1Y+x*this._localBasisZ1Z,va=b*this._localBasisZ1X+f*this._localBasisZ1Y+n*this._localBasisZ1Z,this._localBasisZ2X=ra,this._localBasisZ2Y=la,this._localBasisZ2Z=va}buildLocalBasesFromXY(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var a=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;a>0&&(a=1/Math.sqrt(a)),this._localBasisX1X*=a,this._localBasisX1Y*=a,this._localBasisX1Z*=a}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{var t=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX2X*=t,this._localBasisX2Y*=t,this._localBasisX2Z*=t}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){var i=this._localBasisX1X,o=this._localBasisX1Y,r=this._localBasisX1Z,e=i*i,_=o*o,h=r*r,v;e<_?e<h?(v=1/Math.sqrt(_+h),this._localBasisY1X=0,this._localBasisY1Y=r*v,this._localBasisY1Z=-o*v):(v=1/Math.sqrt(e+_),this._localBasisY1X=o*v,this._localBasisY1Y=-i*v,this._localBasisY1Z=0):_<h?(v=1/Math.sqrt(h+e),this._localBasisY1X=-r*v,this._localBasisY1Y=0,this._localBasisY1Z=i*v):(v=1/Math.sqrt(e+_),this._localBasisY1X=o*v,this._localBasisY1Y=-i*v,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{var s=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;s>0&&(s=1/Math.sqrt(s)),this._localBasisZ1X*=s,this._localBasisZ1Y*=s,this._localBasisZ1Z*=s,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0){var l=this._localBasisX2X,x=this._localBasisX2Y,b=this._localBasisX2Z,f=l*l,n=x*x,c=b*b,z;f<n?f<c?(z=1/Math.sqrt(n+c),this._localBasisY2X=0,this._localBasisY2Y=b*z,this._localBasisY2Z=-x*z):(z=1/Math.sqrt(f+n),this._localBasisY2X=x*z,this._localBasisY2Y=-l*z,this._localBasisY2Z=0):n<c?(z=1/Math.sqrt(c+f),this._localBasisY2X=-b*z,this._localBasisY2Y=0,this._localBasisY2Z=l*z):(z=1/Math.sqrt(f+n),this._localBasisY2X=x*z,this._localBasisY2Y=-l*z,this._localBasisY2Z=0),this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X}else{var p=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;p>0&&(p=1/Math.sqrt(p)),this._localBasisZ2X*=p,this._localBasisZ2Y*=p,this._localBasisZ2Z*=p,this._localBasisY2X=this._localBasisZ2Y*this._localBasisX2Z-this._localBasisZ2Z*this._localBasisX2Y,this._localBasisY2Y=this._localBasisZ2Z*this._localBasisX2X-this._localBasisZ2X*this._localBasisX2Z,this._localBasisY2Z=this._localBasisZ2X*this._localBasisX2Y-this._localBasisZ2Y*this._localBasisX2X}}buildLocalBasesFromX1Z2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var a=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;a>0&&(a=1/Math.sqrt(a)),this._localBasisX1X*=a,this._localBasisX1Y*=a,this._localBasisX1Z*=a}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0)this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=1;else{var t=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ2X*=t,this._localBasisZ2Y*=t,this._localBasisZ2Z*=t}var i=this._b1._transform,o=this._b2._transform,r,e,_,h,v,s,l,x,b,f,n,c,z,p,y,V,M,I;V=i._rotation00*this._localBasisX1X+i._rotation01*this._localBasisX1Y+i._rotation02*this._localBasisX1Z,M=i._rotation10*this._localBasisX1X+i._rotation11*this._localBasisX1Y+i._rotation12*this._localBasisX1Z,I=i._rotation20*this._localBasisX1X+i._rotation21*this._localBasisX1Y+i._rotation22*this._localBasisX1Z,r=V,e=M,_=I;var k,X,L;if(k=o._rotation00*this._localBasisZ2X+o._rotation01*this._localBasisZ2Y+o._rotation02*this._localBasisZ2Z,X=o._rotation10*this._localBasisZ2X+o._rotation11*this._localBasisZ2Y+o._rotation12*this._localBasisZ2Z,L=o._rotation20*this._localBasisZ2X+o._rotation21*this._localBasisZ2Y+o._rotation22*this._localBasisZ2Z,z=k,p=X,y=L,l=p*_-y*e,x=y*r-z*_,b=z*e-p*r,l*l+x*x+b*b==0){var m=r,g=e,N=_,d=m*m,F=g*g,S=N*N,Y;d<F?d<S?(Y=1/Math.sqrt(F+S),l=0,x=N*Y,b=-g*Y):(Y=1/Math.sqrt(d+F),l=g*Y,x=-m*Y,b=0):F<S?(Y=1/Math.sqrt(S+d),l=-N*Y,x=0,b=m*Y):(Y=1/Math.sqrt(d+F),l=g*Y,x=-m*Y,b=0)}h=e*b-_*x,v=_*l-r*b,s=r*x-e*l,f=x*y-b*p,n=b*z-l*y,c=l*p-x*z;var Q,C,B;Q=i._rotation00*r+i._rotation10*e+i._rotation20*_,C=i._rotation01*r+i._rotation11*e+i._rotation21*_,B=i._rotation02*r+i._rotation12*e+i._rotation22*_,this._localBasisX1X=Q,this._localBasisX1Y=C,this._localBasisX1Z=B;var Z,$,K;Z=i._rotation00*l+i._rotation10*x+i._rotation20*b,$=i._rotation01*l+i._rotation11*x+i._rotation21*b,K=i._rotation02*l+i._rotation12*x+i._rotation22*b,this._localBasisY1X=Z,this._localBasisY1Y=$,this._localBasisY1Z=K;var E,J,A;E=i._rotation00*h+i._rotation10*v+i._rotation20*s,J=i._rotation01*h+i._rotation11*v+i._rotation21*s,A=i._rotation02*h+i._rotation12*v+i._rotation22*s,this._localBasisZ1X=E,this._localBasisZ1Y=J,this._localBasisZ1Z=A;var R,U,G;R=o._rotation00*f+o._rotation10*n+o._rotation20*c,U=o._rotation01*f+o._rotation11*n+o._rotation21*c,G=o._rotation02*f+o._rotation12*n+o._rotation22*c,this._localBasisX2X=R,this._localBasisX2Y=U,this._localBasisX2Z=G;var D,H,j;D=o._rotation00*l+o._rotation10*x+o._rotation20*b,H=o._rotation01*l+o._rotation11*x+o._rotation21*b,j=o._rotation02*l+o._rotation12*x+o._rotation22*b,this._localBasisY2X=D,this._localBasisY2Y=H,this._localBasisY2Z=j;var ia,ea,W;ia=o._rotation00*z+o._rotation10*p+o._rotation20*y,ea=o._rotation01*z+o._rotation11*p+o._rotation21*y,W=o._rotation02*z+o._rotation12*p+o._rotation22*y,this._localBasisZ2X=ia,this._localBasisZ2Y=ea,this._localBasisZ2Z=W}buildLocalBasesFromXY1X2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var a=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;a>0&&(a=1/Math.sqrt(a)),this._localBasisX1X*=a,this._localBasisX1Y*=a,this._localBasisX1Z*=a}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){var t=this._localBasisX1X,i=this._localBasisX1Y,o=this._localBasisX1Z,r=t*t,e=i*i,_=o*o,h;r<e?r<_?(h=1/Math.sqrt(e+_),this._localBasisY1X=0,this._localBasisY1Y=o*h,this._localBasisY1Z=-i*h):(h=1/Math.sqrt(r+e),this._localBasisY1X=i*h,this._localBasisY1Y=-t*h,this._localBasisY1Z=0):e<_?(h=1/Math.sqrt(_+r),this._localBasisY1X=-o*h,this._localBasisY1Y=0,this._localBasisY1Z=t*h):(h=1/Math.sqrt(r+e),this._localBasisY1X=i*h,this._localBasisY1Y=-t*h,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{var v=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;v>0&&(v=1/Math.sqrt(v)),this._localBasisZ1X*=v,this._localBasisZ1Y*=v,this._localBasisZ1Z*=v,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}var s,l,x,b,f,n,c,z,p,y,V,M,I,k=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(k<-.999999999){var X,L,m,g=this._localBasisX1X,N=this._localBasisX1Y,d=this._localBasisX1Z,F=g*g,S=N*N,Y=d*d,Q;F<S?F<Y?(Q=1/Math.sqrt(S+Y),X=0,L=d*Q,m=-N*Q):(Q=1/Math.sqrt(F+S),X=N*Q,L=-g*Q,m=0):S<Y?(Q=1/Math.sqrt(Y+F),X=-d*Q,L=0,m=g*Q):(Q=1/Math.sqrt(F+S),X=N*Q,L=-g*Q,m=0),s=X,l=L,x=m,b=0}else{var C,B,Z;C=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,B=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,Z=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var $=Math.sqrt((1+k)*.5);k=.5/$,C*=k,B*=k,Z*=k,s=C,l=B,x=Z,b=$}var K=s,E=l,J=x,A=b,R=2*K,U=2*E,G=2*J,D=K*R,H=E*U,j=J*G,ia=K*U,ea=E*G,W=K*G,q=A*R,na=A*U,oa=A*G;f=1-H-j,n=ia-oa,c=W+na,z=ia+oa,p=1-D-j,y=ea-q,V=W-na,M=ea+q,I=1-D-H;var aa,T,ca;aa=f*this._localBasisX1X+n*this._localBasisX1Y+c*this._localBasisX1Z,T=z*this._localBasisX1X+p*this._localBasisX1Y+y*this._localBasisX1Z,ca=V*this._localBasisX1X+M*this._localBasisX1Y+I*this._localBasisX1Z,this._localBasisX2X=aa,this._localBasisX2Y=T,this._localBasisX2Z=ca;var _a,w,ta;_a=f*this._localBasisY1X+n*this._localBasisY1Y+c*this._localBasisY1Z,w=z*this._localBasisY1X+p*this._localBasisY1Y+y*this._localBasisY1Z,ta=V*this._localBasisY1X+M*this._localBasisY1Y+I*this._localBasisY1Z,this._localBasisY2X=_a,this._localBasisY2Y=w,this._localBasisY2Z=ta;var ra,la,va;ra=f*this._localBasisZ1X+n*this._localBasisZ1Y+c*this._localBasisZ1Z,la=z*this._localBasisZ1X+p*this._localBasisZ1Y+y*this._localBasisZ1Z,va=V*this._localBasisZ1X+M*this._localBasisZ1Y+I*this._localBasisZ1Z,this._localBasisZ2X=ra,this._localBasisZ2Y=la,this._localBasisZ2Z=va}setSolverInfoRowLinear(a,t,i,o,r,e,_){var h,v,s=u.common.Setting.linearSlop;if(_)h=0,v=1;else{if(r.frequency>0){s=0;var l=6.28318530717958*r.frequency,x=r.dampingRatio;x<u.common.Setting.minSpringDamperDampingRatio&&(x=u.common.Setting.minSpringDamperDampingRatio);var b=e.dt,f=2*x*l,n=l*l;r.useSymplecticEuler?(h=1/(b*f),v=n/f):(h=1/(b*(b*n+f)),v=n/(b*n+f))}else h=0,v=this.getErp(e,!1);i.motorForce>0?(a.motorSpeed=i.motorSpeed,a.motorMaxImpulse=i.motorForce*e.dt):(a.motorSpeed=0,a.motorMaxImpulse=0)}var c=i.lowerLimit,z=i.upperLimit,p,y,V;c>z?(p=0,y=0,V=0):c==z?(p=-1/0,y=1/0,V=t-c):t<c?(p=-1/0,y=0,V=t-c+s,V>0&&(V=0)):t>z?(p=0,y=1/0,V=t-z-s,V<0&&(V=0)):(p=0,y=0,V=0);var M=o==0?0:1/o;a.minImpulse=p,a.maxImpulse=y,a.cfm=h*M,a.rhs=V*v}setSolverInfoRowAngular(a,t,i,o,r,e,_){var h,v,s=u.common.Setting.angularSlop;if(_)h=0,v=1;else{if(r.frequency>0){s=0;var l=6.28318530717958*r.frequency,x=r.dampingRatio;x<u.common.Setting.minSpringDamperDampingRatio&&(x=u.common.Setting.minSpringDamperDampingRatio);var b=e.dt,f=2*x*l,n=l*l;r.useSymplecticEuler?(h=1/(b*f),v=n/f):(h=1/(b*(b*n+f)),v=n/(b*n+f))}else h=0,v=this.getErp(e,!1);i.motorTorque>0?(a.motorSpeed=i.motorSpeed,a.motorMaxImpulse=i.motorTorque*e.dt):(a.motorSpeed=0,a.motorMaxImpulse=0)}var c=i.lowerLimit,z=i.upperLimit,p=(c+z)*.5;t-=p,t=((t+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,t+=p;var y,V,M;c>z?(y=0,V=0,M=0):c==z?(y=-1/0,V=1/0,M=t-c):t<c?(y=-1/0,V=0,M=t-c+s,M>0&&(M=0)):t>z?(y=0,V=1/0,M=t-z-s,M<0&&(M=0)):(y=0,V=0,M=0);var I=o==0?0:1/o;a.minImpulse=y,a.maxImpulse=V,a.cfm=h*I,a.rhs=M*v}getErp(a,t){return t?1:this._positionCorrectionAlgorithm==u.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?a.invDt*u.common.Setting.velocityBaumgarte:0}computeEffectiveInertiaMoment(a,t,i){var o,r,e,_,h,v,s,l,x;s=this._b1._invInertia00*a+this._b1._invInertia01*t+this._b1._invInertia02*i,l=this._b1._invInertia10*a+this._b1._invInertia11*t+this._b1._invInertia12*i,x=this._b1._invInertia20*a+this._b1._invInertia21*t+this._b1._invInertia22*i,o=s,r=l,e=x;var b,f,n;b=this._b2._invInertia00*a+this._b2._invInertia01*t+this._b2._invInertia02*i,f=this._b2._invInertia10*a+this._b2._invInertia11*t+this._b2._invInertia12*i,n=this._b2._invInertia20*a+this._b2._invInertia21*t+this._b2._invInertia22*i,_=b,h=f,v=n;var c=o*a+r*t+e*i,z=_*a+h*t+v*i;if(c>0){var p=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,y=a*this._relativeAnchor1X+t*this._relativeAnchor1Y+i*this._relativeAnchor1Z,V=p-y*y;V>0&&(this._b1._invMass>0?c=1/(1/c+this._b1._mass*V):c=0)}if(z>0){var M=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,I=a*this._relativeAnchor2X+t*this._relativeAnchor2Y+i*this._relativeAnchor2Z,k=M-I*I;k>0&&(this._b2._invMass>0?z=1/(1/z+this._b2._mass*k):z=0)}return c+z==0?0:1/(c+z)}computeEffectiveInertiaMoment2(a,t,i,o,r,e){var _,h,v,s,l,x,b,f,n;b=this._b1._invInertia00*a+this._b1._invInertia01*t+this._b1._invInertia02*i,f=this._b1._invInertia10*a+this._b1._invInertia11*t+this._b1._invInertia12*i,n=this._b1._invInertia20*a+this._b1._invInertia21*t+this._b1._invInertia22*i,_=b,h=f,v=n;var c,z,p;c=this._b2._invInertia00*o+this._b2._invInertia01*r+this._b2._invInertia02*e,z=this._b2._invInertia10*o+this._b2._invInertia11*r+this._b2._invInertia12*e,p=this._b2._invInertia20*o+this._b2._invInertia21*r+this._b2._invInertia22*e,s=c,l=z,x=p;var y=_*a+h*t+v*i,V=s*o+l*r+x*e;if(y>0){var M=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,I=a*this._relativeAnchor1X+t*this._relativeAnchor1Y+i*this._relativeAnchor1Z,k=M*M-I*I;k>0&&(this._b1._invMass>0?y=1/(1/y+this._b1._mass*k):y=0)}if(V>0){var X=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,L=o*this._relativeAnchor2X+r*this._relativeAnchor2Y+e*this._relativeAnchor2Z,m=X*X-L*L;m>0&&(this._b2._invMass>0?V=1/(1/V+this._b2._mass*m):V=0)}return y+V==0?0:1/(y+V)}_syncAnchors(){var a=this._b1._transform,t=this._b2._transform,i,o,r;i=a._rotation00*this._localAnchor1X+a._rotation01*this._localAnchor1Y+a._rotation02*this._localAnchor1Z,o=a._rotation10*this._localAnchor1X+a._rotation11*this._localAnchor1Y+a._rotation12*this._localAnchor1Z,r=a._rotation20*this._localAnchor1X+a._rotation21*this._localAnchor1Y+a._rotation22*this._localAnchor1Z,this._relativeAnchor1X=i,this._relativeAnchor1Y=o,this._relativeAnchor1Z=r;var e,_,h;e=t._rotation00*this._localAnchor2X+t._rotation01*this._localAnchor2Y+t._rotation02*this._localAnchor2Z,_=t._rotation10*this._localAnchor2X+t._rotation11*this._localAnchor2Y+t._rotation12*this._localAnchor2Z,h=t._rotation20*this._localAnchor2X+t._rotation21*this._localAnchor2Y+t._rotation22*this._localAnchor2Z,this._relativeAnchor2X=e,this._relativeAnchor2Y=_,this._relativeAnchor2Z=h,this._anchor1X=this._relativeAnchor1X+a._positionX,this._anchor1Y=this._relativeAnchor1Y+a._positionY,this._anchor1Z=this._relativeAnchor1Z+a._positionZ,this._anchor2X=this._relativeAnchor2X+t._positionX,this._anchor2Y=this._relativeAnchor2Y+t._positionY,this._anchor2Z=this._relativeAnchor2Z+t._positionZ;var v,s,l;v=a._rotation00*this._localBasisX1X+a._rotation01*this._localBasisX1Y+a._rotation02*this._localBasisX1Z,s=a._rotation10*this._localBasisX1X+a._rotation11*this._localBasisX1Y+a._rotation12*this._localBasisX1Z,l=a._rotation20*this._localBasisX1X+a._rotation21*this._localBasisX1Y+a._rotation22*this._localBasisX1Z,this._basisX1X=v,this._basisX1Y=s,this._basisX1Z=l;var x,b,f;x=a._rotation00*this._localBasisY1X+a._rotation01*this._localBasisY1Y+a._rotation02*this._localBasisY1Z,b=a._rotation10*this._localBasisY1X+a._rotation11*this._localBasisY1Y+a._rotation12*this._localBasisY1Z,f=a._rotation20*this._localBasisY1X+a._rotation21*this._localBasisY1Y+a._rotation22*this._localBasisY1Z,this._basisY1X=x,this._basisY1Y=b,this._basisY1Z=f;var n,c,z;n=a._rotation00*this._localBasisZ1X+a._rotation01*this._localBasisZ1Y+a._rotation02*this._localBasisZ1Z,c=a._rotation10*this._localBasisZ1X+a._rotation11*this._localBasisZ1Y+a._rotation12*this._localBasisZ1Z,z=a._rotation20*this._localBasisZ1X+a._rotation21*this._localBasisZ1Y+a._rotation22*this._localBasisZ1Z,this._basisZ1X=n,this._basisZ1Y=c,this._basisZ1Z=z;var p,y,V;p=t._rotation00*this._localBasisX2X+t._rotation01*this._localBasisX2Y+t._rotation02*this._localBasisX2Z,y=t._rotation10*this._localBasisX2X+t._rotation11*this._localBasisX2Y+t._rotation12*this._localBasisX2Z,V=t._rotation20*this._localBasisX2X+t._rotation21*this._localBasisX2Y+t._rotation22*this._localBasisX2Z,this._basisX2X=p,this._basisX2Y=y,this._basisX2Z=V;var M,I,k;M=t._rotation00*this._localBasisY2X+t._rotation01*this._localBasisY2Y+t._rotation02*this._localBasisY2Z,I=t._rotation10*this._localBasisY2X+t._rotation11*this._localBasisY2Y+t._rotation12*this._localBasisY2Z,k=t._rotation20*this._localBasisY2X+t._rotation21*this._localBasisY2Y+t._rotation22*this._localBasisY2Z,this._basisY2X=M,this._basisY2Y=I,this._basisY2Z=k;var X,L,m;X=t._rotation00*this._localBasisZ2X+t._rotation01*this._localBasisZ2Y+t._rotation02*this._localBasisZ2Z,L=t._rotation10*this._localBasisZ2X+t._rotation11*this._localBasisZ2Y+t._rotation12*this._localBasisZ2Z,m=t._rotation20*this._localBasisZ2X+t._rotation21*this._localBasisZ2Y+t._rotation22*this._localBasisZ2Z,this._basisZ2X=X,this._basisZ2Y=L,this._basisZ2Z=m}_getVelocitySolverInfo(a,t){t.b1=this._b1,t.b2=this._b2,t.numRows=0}_getPositionSolverInfo(a){a.b1=this._b1,a.b2=this._b2,a.numRows=0}_checkDestruction(){var a=this._appliedForceX*this._appliedForceX+this._appliedForceY*this._appliedForceY+this._appliedForceZ*this._appliedForceZ,t=this._appliedTorqueX*this._appliedTorqueX+this._appliedTorqueY*this._appliedTorqueY+this._appliedTorqueZ*this._appliedTorqueZ;if(this._breakForce>0&&a>this._breakForce*this._breakForce){this._world.removeJoint(this);return}if(this._breakTorque>0&&t>this._breakTorque*this._breakTorque){this._world.removeJoint(this);return}}getRigidBody1(){return this._b1}getRigidBody2(){return this._b2}getType(){return this._type}getAnchor1(){var a=new u.common.Vec3,t=a;return t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z,a}getAnchor2(){var a=new u.common.Vec3,t=a;return t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z,a}getAnchor1To(a){var t=a;t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z}getAnchor2To(a){var t=a;t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z}getLocalAnchor1(){var a=new u.common.Vec3,t=a;return t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z,a}getLocalAnchor2(){var a=new u.common.Vec3,t=a;return t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z,a}getLocalAnchor1To(a){var t=a;t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z}getLocalAnchor2To(a){var t=a;t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z}getBasis1(){var a=new u.common.Mat3,t,i,o,r,e,_,h,v,s;t=this._basisX1X,i=this._basisY1X,o=this._basisZ1X,r=this._basisX1Y,e=this._basisY1Y,_=this._basisZ1Y,h=this._basisX1Z,v=this._basisY1Z,s=this._basisZ1Z;var l=a;return l.e00=t,l.e01=i,l.e02=o,l.e10=r,l.e11=e,l.e12=_,l.e20=h,l.e21=v,l.e22=s,a}getBasis2(){var a=new u.common.Mat3,t,i,o,r,e,_,h,v,s;t=this._basisX2X,i=this._basisY2X,o=this._basisZ2X,r=this._basisX2Y,e=this._basisY2Y,_=this._basisZ2Y,h=this._basisX2Z,v=this._basisY2Z,s=this._basisZ2Z;var l=a;return l.e00=t,l.e01=i,l.e02=o,l.e10=r,l.e11=e,l.e12=_,l.e20=h,l.e21=v,l.e22=s,a}getBasis1To(a){var t,i,o,r,e,_,h,v,s;t=this._basisX1X,i=this._basisY1X,o=this._basisZ1X,r=this._basisX1Y,e=this._basisY1Y,_=this._basisZ1Y,h=this._basisX1Z,v=this._basisY1Z,s=this._basisZ1Z;var l=a;l.e00=t,l.e01=i,l.e02=o,l.e10=r,l.e11=e,l.e12=_,l.e20=h,l.e21=v,l.e22=s}getBasis2To(a){var t,i,o,r,e,_,h,v,s;t=this._basisX2X,i=this._basisY2X,o=this._basisZ2X,r=this._basisX2Y,e=this._basisY2Y,_=this._basisZ2Y,h=this._basisX2Z,v=this._basisY2Z,s=this._basisZ2Z;var l=a;l.e00=t,l.e01=i,l.e02=o,l.e10=r,l.e11=e,l.e12=_,l.e20=h,l.e21=v,l.e22=s}getAllowCollision(){return this._allowCollision}setAllowCollision(a){this._allowCollision=a}getBreakForce(){return this._breakForce}setBreakForce(a){this._breakForce=a}getBreakTorque(){return this._breakTorque}setBreakTorque(a){this._breakTorque=a}getPositionCorrectionAlgorithm(){return this._positionCorrectionAlgorithm}setPositionCorrectionAlgorithm(a){switch(a){case 0:case 1:case 2:break;default:throw new Error("invalid position correction algorithm id: "+a)}this._positionCorrectionAlgorithm=a}getAppliedForce(){var a=new u.common.Vec3,t=a;return t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ,a}getAppliedForceTo(a){var t=a;t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ}getAppliedTorque(){var a=new u.common.Vec3,t=a;return t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ,a}getAppliedTorqueTo(a){var t=a;t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ}getPrev(){return this._prev}getNext(){return this._next}};u.dynamics.constraint.joint.CylindricalJoint=class extends u.dynamics.constraint.joint.Joint{constructor(a){super(a,2);var t=a.localAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var i=a.localAxis2;this._localBasisX2X=i.x,this._localBasisX2Y=i.y,this._localBasisX2Z=i.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this._basis=new u.dynamics.constraint.joint.BasisTracker(this),this._translSd=a.translationalSpringDamper.clone(),this._translLm=a.translationalLimitMotor.clone(),this._rotSd=a.rotationalSpringDamper.clone(),this._rotLm=a.rotationalLimitMotor.clone()}getInfo(a,t,i){var o=this.getErp(t,i),r=this.linearErrorY*o,e=this.linearErrorZ*o,_=this.angularErrorY*o,h=this.angularErrorZ*o,v,s,l=1/(this._b1._invMass+this._b2._invMass),x=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ);if(this._translSd.frequency<=0||!i){var b=this._impulses[0],f=a.rows[a.numRows++],n=f.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,f.rhs=0,f.cfm=0,f.minImpulse=0,f.maxImpulse=0,f.motorSpeed=0,f.motorMaxImpulse=0,f.impulse=null,f.impulse=b,v=f,this.setSolverInfoRowLinear(v,this.translation,this._translLm,l,this._translSd,t,i),s=v.jacobian,s.lin1X=this._basis.xX,s.lin1Y=this._basis.xY,s.lin1Z=this._basis.xZ,s.lin2X=this._basis.xX,s.lin2Y=this._basis.xY,s.lin2Z=this._basis.xZ,s.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,s.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,s.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,s.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,s.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,s.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}var c=this._impulses[1],z=a.rows[a.numRows++],p=z.jacobian;p.lin1X=0,p.lin1Y=0,p.lin1Z=0,p.lin2X=0,p.lin2Y=0,p.lin2Z=0,p.ang1X=0,p.ang1Y=0,p.ang1Z=0,p.ang2X=0,p.ang2Y=0,p.ang2Z=0,z.rhs=0,z.cfm=0,z.minImpulse=0,z.maxImpulse=0,z.motorSpeed=0,z.motorMaxImpulse=0,z.impulse=null,z.impulse=c,v=z,v.rhs=r,v.cfm=0,v.minImpulse=-1/0,v.maxImpulse=1/0,s=v.jacobian,s.lin1X=this._basis.yX,s.lin1Y=this._basis.yY,s.lin1Z=this._basis.yZ,s.lin2X=this._basis.yX,s.lin2Y=this._basis.yY,s.lin2Z=this._basis.yZ,s.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,s.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,s.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,s.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,s.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,s.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;var y=this._impulses[2],V=a.rows[a.numRows++],M=V.jacobian;if(M.lin1X=0,M.lin1Y=0,M.lin1Z=0,M.lin2X=0,M.lin2Y=0,M.lin2Z=0,M.ang1X=0,M.ang1Y=0,M.ang1Z=0,M.ang2X=0,M.ang2Y=0,M.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=y,v=V,v.rhs=e,v.cfm=0,v.minImpulse=-1/0,v.maxImpulse=1/0,s=v.jacobian,s.lin1X=this._basis.zX,s.lin1Y=this._basis.zY,s.lin1Z=this._basis.zZ,s.lin2X=this._basis.zX,s.lin2Y=this._basis.zY,s.lin2Z=this._basis.zZ,s.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,s.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,s.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,s.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,s.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,s.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX,this._rotSd.frequency<=0||!i){var I=this._impulses[3],k=a.rows[a.numRows++],X=k.jacobian;X.lin1X=0,X.lin1Y=0,X.lin1Z=0,X.lin2X=0,X.lin2Y=0,X.lin2Z=0,X.ang1X=0,X.ang1Y=0,X.ang1Z=0,X.ang2X=0,X.ang2Y=0,X.ang2Z=0,k.rhs=0,k.cfm=0,k.minImpulse=0,k.maxImpulse=0,k.motorSpeed=0,k.motorMaxImpulse=0,k.impulse=null,k.impulse=I,v=k,this.setSolverInfoRowAngular(v,this.angle,this._rotLm,x,this._rotSd,t,i),s=v.jacobian,s.ang1X=this._basis.xX,s.ang1Y=this._basis.xY,s.ang1Z=this._basis.xZ,s.ang2X=this._basis.xX,s.ang2Y=this._basis.xY,s.ang2Z=this._basis.xZ}var L=this._impulses[4],m=a.rows[a.numRows++],g=m.jacobian;g.lin1X=0,g.lin1Y=0,g.lin1Z=0,g.lin2X=0,g.lin2Y=0,g.lin2Z=0,g.ang1X=0,g.ang1Y=0,g.ang1Z=0,g.ang2X=0,g.ang2Y=0,g.ang2Z=0,m.rhs=0,m.cfm=0,m.minImpulse=0,m.maxImpulse=0,m.motorSpeed=0,m.motorMaxImpulse=0,m.impulse=null,m.impulse=L,v=m,v.rhs=_,v.cfm=0,v.minImpulse=-1/0,v.maxImpulse=1/0,s=v.jacobian,s.ang1X=this._basis.yX,s.ang1Y=this._basis.yY,s.ang1Z=this._basis.yZ,s.ang2X=this._basis.yX,s.ang2Y=this._basis.yY,s.ang2Z=this._basis.yZ;var N=this._impulses[5],d=a.rows[a.numRows++],F=d.jacobian;F.lin1X=0,F.lin1Y=0,F.lin1Z=0,F.lin2X=0,F.lin2Y=0,F.lin2Z=0,F.ang1X=0,F.ang1Y=0,F.ang1Z=0,F.ang2X=0,F.ang2Y=0,F.ang2Z=0,d.rhs=0,d.cfm=0,d.minImpulse=0,d.maxImpulse=0,d.motorSpeed=0,d.motorMaxImpulse=0,d.impulse=null,d.impulse=N,v=d,v.rhs=h,v.cfm=0,v.minImpulse=-1/0,v.maxImpulse=1/0,s=v.jacobian,s.ang1X=this._basis.zX,s.ang1Y=this._basis.zY,s.ang1Z=this._basis.zZ,s.ang2X=this._basis.zX,s.ang2Y=this._basis.zY,s.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();var a=this._basis,t=a.joint._b1._invMass,i=a.joint._b2._invMass,o,r,e,_,h,v,s,l,x,b,f,n,c,z,p,y,V,M,I,k,X,L,m,g,N,d,F,S,Y,Q,C,B,Z,$,K,E,J=a.joint._basisX1X*a.joint._basisX2X+a.joint._basisX1Y*a.joint._basisX2Y+a.joint._basisX1Z*a.joint._basisX2Z;if(J<-.999999999){var A,R,U,G=a.joint._basisX1X,D=a.joint._basisX1Y,H=a.joint._basisX1Z,j=G*G,ia=D*D,ea=H*H,W;j<ia?j<ea?(W=1/Math.sqrt(ia+ea),A=0,R=H*W,U=-D*W):(W=1/Math.sqrt(j+ia),A=D*W,R=-G*W,U=0):ia<ea?(W=1/Math.sqrt(ea+j),A=-H*W,R=0,U=G*W):(W=1/Math.sqrt(j+ia),A=D*W,R=-G*W,U=0),o=A,r=R,e=U,_=0}else{var q,na,oa;q=a.joint._basisX1Y*a.joint._basisX2Z-a.joint._basisX1Z*a.joint._basisX2Y,na=a.joint._basisX1Z*a.joint._basisX2X-a.joint._basisX1X*a.joint._basisX2Z,oa=a.joint._basisX1X*a.joint._basisX2Y-a.joint._basisX1Y*a.joint._basisX2X;var aa=Math.sqrt((1+J)*.5);J=.5/aa,q*=J,na*=J,oa*=J,o=q,r=na,e=oa,_=aa}h=0,v=0,s=0,l=1;var T,ca,_a,w,ta,ra,la,va;T=h,ca=v,_a=s,w=l,ta=o,ra=r,la=e,va=_;var ua=T*ta+ca*ra+_a*la+w*va;if(ua<0&&(ua=-ua,ta=-ta,ra=-ra,la=-la,va=-va),ua>.999999){var za,Ma,Xa,Za;za=ta-T,Ma=ra-ca,Xa=la-_a,Za=va-w,ta=T+za*(t/(t+i)),ra=ca+Ma*(t/(t+i)),la=_a+Xa*(t/(t+i)),va=w+Za*(t/(t+i));var fa=ta*ta+ra*ra+la*la+va*va;fa>1e-32&&(fa=1/Math.sqrt(fa)),x=ta*fa,b=ra*fa,f=la*fa,n=va*fa}else{var ba=t/(t+i)*Math.acos(ua);ta+=T*-ua,ra+=ca*-ua,la+=_a*-ua,va+=w*-ua;var sa=ta*ta+ra*ra+la*la+va*va;sa>1e-32&&(sa=1/Math.sqrt(sa)),ta*=sa,ra*=sa,la*=sa,va*=sa;var ha=Math.sin(ba),ma=Math.cos(ba);T*=ma,ca*=ma,_a*=ma,w*=ma,x=T+ta*ha,b=ca+ra*ha,f=_a+la*ha,n=w+va*ha}var ya=x,Ba=b,pa=f,Ya=n,Ra=2*ya,ga=2*Ba,xa=2*pa,wa=ya*Ra,ka=Ba*ga,Pa=pa*xa,zt=ya*ga,Oa=Ba*xa,Aa=ya*xa,nt=Ya*Ra,Ea=Ya*ga,Fa=Ya*xa;c=1-ka-Pa,z=zt-Fa,p=Aa+Ea,y=zt+Fa,V=1-wa-Pa,M=Oa-nt,I=Aa-Ea,k=Oa+nt,X=1-wa-ka;var da,ft,Wa;da=c*a.joint._basisX1X+z*a.joint._basisX1Y+p*a.joint._basisX1Z,ft=y*a.joint._basisX1X+V*a.joint._basisX1Y+M*a.joint._basisX1Z,Wa=I*a.joint._basisX1X+k*a.joint._basisX1Y+X*a.joint._basisX1Z,L=da,m=ft,g=Wa,C=a.xX,B=a.xY,Z=a.xZ,$=a.yX,K=a.yY,E=a.yZ;var Ha=C*L+B*m+Z*g;if(Ha<-.999999999){var bt,it,Ka,_t=C,gt=B,pt=Z,Ga=_t*_t,rt=gt*gt,xt=pt*pt,Da;Ga<rt?Ga<xt?(Da=1/Math.sqrt(rt+xt),bt=0,it=pt*Da,Ka=-gt*Da):(Da=1/Math.sqrt(Ga+rt),bt=gt*Da,it=-_t*Da,Ka=0):rt<xt?(Da=1/Math.sqrt(xt+Ga),bt=-pt*Da,it=0,Ka=_t*Da):(Da=1/Math.sqrt(Ga+rt),bt=gt*Da,it=-_t*Da,Ka=0),x=bt,b=it,f=Ka,n=0}else{var Ta,Na,Vt;Ta=B*g-Z*m,Na=Z*L-C*g,Vt=C*m-B*L;var Pt=Math.sqrt((1+Ha)*.5);Ha=.5/Pt,Ta*=Ha,Na*=Ha,Vt*=Ha,x=Ta,b=Na,f=Vt,n=Pt}var st=x,Xt=b,Yt=f,Mt=n,Ia=2*st,O=2*Xt,Va=2*Yt,lt=st*Ia,P=Xt*O,wt=Yt*Va,At=st*O,dt=Xt*Va,yt=st*Va,kt=Mt*Ia,mt=Mt*O,ht=Mt*Va;c=1-P-wt,z=At-ht,p=yt+mt,y=At+ht,V=1-lt-wt,M=dt-kt,I=yt-mt,k=dt+kt,X=1-lt-P;var ut,Qa,et;if(ut=c*$+z*K+p*E,Qa=y*$+V*K+M*E,et=I*$+k*K+X*E,N=ut,d=Qa,F=et,S=m*F-g*d,Y=g*N-L*F,Q=L*d-m*N,S*S+Y*Y+Q*Q>1e-6){var Ca=S*S+Y*Y+Q*Q;Ca>0&&(Ca=1/Math.sqrt(Ca)),S*=Ca,Y*=Ca,Q*=Ca}else{var vt=L,qa=m,at=g,Ua=vt*vt,tt=qa*qa,ct=at*at,Sa;Ua<tt?Ua<ct?(Sa=1/Math.sqrt(tt+ct),S=0,Y=at*Sa,Q=-qa*Sa):(Sa=1/Math.sqrt(Ua+tt),S=qa*Sa,Y=-vt*Sa,Q=0):tt<ct?(Sa=1/Math.sqrt(ct+Ua),S=-at*Sa,Y=0,Q=vt*Sa):(Sa=1/Math.sqrt(Ua+tt),S=qa*Sa,Y=-vt*Sa,Q=0)}N=Y*g-Q*m,d=Q*L-S*g,F=S*m-Y*L,a.xX=L,a.xY=m,a.xZ=g,a.yX=N,a.yY=d,a.yZ=F,a.zX=S,a.zY=Y,a.zZ=Q;var Ja,ja,La;Ja=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,ja=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,La=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;var ot=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,It=ot<=-1?3.14159265358979:ot>=1?0:Math.acos(ot),oi=Ja*Ja+ja*ja+La*La;oi>0&&(oi=1/Math.sqrt(oi)),Ja*=oi,ja*=oi,La*=oi,Ja*=It,ja*=It,La*=It,this.angularErrorY=Ja*this._basis.yX+ja*this._basis.yY+La*this._basis.yZ,this.angularErrorZ=Ja*this._basis.zX+ja*this._basis.zY+La*this._basis.zZ;var gi,ai,Ct;gi=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,ai=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,Ct=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,ot=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=ot<=-1?3.14159265358979:ot>=1?0:Math.acos(ot),gi*this._basis.xX+ai*this._basis.xY+Ct*this._basis.xZ<0&&(this.angle=-this.angle);var _i,Et,St;_i=this._anchor2X-this._anchor1X,Et=this._anchor2Y-this._anchor1Y,St=this._anchor2Z-this._anchor1Z,this.translation=_i*this._basis.xX+Et*this._basis.xY+St*this._basis.xZ,this.linearErrorY=_i*this._basis.yX+Et*this._basis.yY+St*this._basis.yZ,this.linearErrorZ=_i*this._basis.zX+Et*this._basis.zY+St*this._basis.zZ}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxis1(){var a=new u.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxis2(){var a=new u.common.Vec3,t=a;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,a}getAxis1To(a){var t=a;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(a){var t=a;t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){var a=new u.common.Vec3,t=a;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,a}getLocalAxis2(){var a=new u.common.Vec3,t=a;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,a}getLocalAxis1To(a){var t=a;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(a){var t=a;t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTranslationalSpringDamper(){return this._translSd}getRotationalSpringDamper(){return this._rotSd}getTranslationalLimitMotor(){return this._translLm}getRotationalLimitMotor(){return this._rotLm}getAngle(){return this.angle}getTranslation(){return this.translation}};u.dynamics.constraint.joint.JointConfig=class{constructor(){this.rigidBody1=null,this.rigidBody2=null,this.localAnchor1=new u.common.Vec3,this.localAnchor2=new u.common.Vec3,this.allowCollision=!1,this.solverType=u.common.Setting.defaultJointConstraintSolverType,this.positionCorrectionAlgorithm=u.common.Setting.defaultJointPositionCorrectionAlgorithm,this.breakForce=0,this.breakTorque=0}_init(a,t,i){this.rigidBody1=a,this.rigidBody2=t;var o=this.rigidBody1,r,e,_,h=i;r=h.x,e=h.y,_=h.z,r-=o._transform._positionX,e-=o._transform._positionY,_-=o._transform._positionZ;var v,s,l;v=o._transform._rotation00*r+o._transform._rotation10*e+o._transform._rotation20*_,s=o._transform._rotation01*r+o._transform._rotation11*e+o._transform._rotation21*_,l=o._transform._rotation02*r+o._transform._rotation12*e+o._transform._rotation22*_,r=v,e=s,_=l;var x=this.localAnchor1;x.x=r,x.y=e,x.z=_;var b=this.rigidBody2,f,n,c,z=i;f=z.x,n=z.y,c=z.z,f-=b._transform._positionX,n-=b._transform._positionY,c-=b._transform._positionZ;var p,y,V;p=b._transform._rotation00*f+b._transform._rotation10*n+b._transform._rotation20*c,y=b._transform._rotation01*f+b._transform._rotation11*n+b._transform._rotation21*c,V=b._transform._rotation02*f+b._transform._rotation12*n+b._transform._rotation22*c,f=p,n=y,c=V;var M=this.localAnchor2;M.x=f,M.y=n,M.z=c}};u.dynamics.constraint.joint.CylindricalJointConfig=class extends u.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new u.common.Vec3(1,0,0),this.localAxis2=new u.common.Vec3(1,0,0),this.translationalLimitMotor=new u.dynamics.constraint.joint.TranslationalLimitMotor,this.translationalSpringDamper=new u.dynamics.constraint.joint.SpringDamper,this.rotationalLimitMotor=new u.dynamics.constraint.joint.RotationalLimitMotor,this.rotationalSpringDamper=new u.dynamics.constraint.joint.SpringDamper}init(a,t,i,o){this._init(a,t,i);var r,e,_,h=o;r=h.x,e=h.y,_=h.z;var v,s,l;v=a._transform._rotation00*r+a._transform._rotation10*e+a._transform._rotation20*_,s=a._transform._rotation01*r+a._transform._rotation11*e+a._transform._rotation21*_,l=a._transform._rotation02*r+a._transform._rotation12*e+a._transform._rotation22*_,r=v,e=s,_=l;var x=this.localAxis1;x.x=r,x.y=e,x.z=_;var b,f,n,c=o;b=c.x,f=c.y,n=c.z;var z,p,y;z=t._transform._rotation00*b+t._transform._rotation10*f+t._transform._rotation20*n,p=t._transform._rotation01*b+t._transform._rotation11*f+t._transform._rotation21*n,y=t._transform._rotation02*b+t._transform._rotation12*f+t._transform._rotation22*n,b=z,f=p,n=y;var V=this.localAxis2;return V.x=b,V.y=f,V.z=n,this}};u.dynamics.constraint.joint.GenericJoint=class extends u.dynamics.constraint.joint.Joint{constructor(a){super(a,u.dynamics.constraint.joint.JointType.GENERIC);var t,i=a.localBasis1;if(i.e00*(i.e11*i.e22-i.e12*i.e21)-i.e01*(i.e10*i.e22-i.e12*i.e20)+i.e02*(i.e10*i.e21-i.e11*i.e20)<0)t=!0;else{var o=a.localBasis2;t=o.e00*(o.e11*o.e22-o.e12*o.e21)-o.e01*(o.e10*o.e22-o.e12*o.e20)+o.e02*(o.e10*o.e21-o.e11*o.e20)<0}t&&console.log("src/oimo/dynamics/constraint/joint/GenericJoint.hx:50:","[warning] joint basis must be right handed");var r,e,_,h,v,s,l,x,b,f,n,c,z,p,y,V,M,I,k=a.localBasis1;r=k.e00,e=k.e01,_=k.e02,h=k.e10,v=k.e11,s=k.e12,l=k.e20,x=k.e21,b=k.e22;var X=a.localBasis2;f=X.e00,n=X.e01,c=X.e02,z=X.e10,p=X.e11,y=X.e12,V=X.e20,M=X.e21,I=X.e22,this._localBasisX1X=r,this._localBasisX1Y=h,this._localBasisX1Z=l,this._localBasisY1X=e,this._localBasisY1Y=v,this._localBasisY1Z=x,this._localBasisZ1X=_,this._localBasisZ1Y=s,this._localBasisZ1Z=b,this._localBasisX2X=f,this._localBasisX2Y=z,this._localBasisX2Z=V,this._localBasisY2X=n,this._localBasisY2Y=p,this._localBasisY2Z=M,this._localBasisZ2X=c,this._localBasisZ2Y=y,this._localBasisZ2Z=I,this._angleX=0,this._angleY=0,this._angleZ=0,this.translationX=0,this.translationY=0,this.translationZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1;var L=new Array(3);this._translLms=L;var m=new Array(3);this._translSds=m;var g=new Array(3);this._rotLms=g;var N=new Array(3);this._rotSds=N,this._translLms[0]=a.translationalLimitMotors[0].clone(),this._translLms[1]=a.translationalLimitMotors[1].clone(),this._translLms[2]=a.translationalLimitMotors[2].clone(),this._translSds[0]=a.translationalSpringDampers[0].clone(),this._translSds[1]=a.translationalSpringDampers[1].clone(),this._translSds[2]=a.translationalSpringDampers[2].clone(),this._rotLms[0]=a.rotationalLimitMotors[0].clone(),this._rotLms[1]=a.rotationalLimitMotors[1].clone(),this._rotLms[2]=a.rotationalLimitMotors[2].clone(),this._rotSds[0]=a.rotationalSpringDampers[0].clone(),this._rotSds[1]=a.rotationalSpringDampers[1].clone(),this._rotSds[2]=a.rotationalSpringDampers[2].clone()}getInfo(a,t,i){var o,r,e=1/(this._b1._invMass+this._b2._invMass),_=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),h=this.computeEffectiveInertiaMoment(this._axisYX,this._axisYY,this._axisYZ),v=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ);if(this._translSds[0].frequency<=0||!i){var s=this._impulses[0],l=a.rows[a.numRows++],x=l.jacobian;x.lin1X=0,x.lin1Y=0,x.lin1Z=0,x.lin2X=0,x.lin2Y=0,x.lin2Z=0,x.ang1X=0,x.ang1Y=0,x.ang1Z=0,x.ang2X=0,x.ang2Y=0,x.ang2Z=0,l.rhs=0,l.cfm=0,l.minImpulse=0,l.maxImpulse=0,l.motorSpeed=0,l.motorMaxImpulse=0,l.impulse=null,l.impulse=s,o=l,this.setSolverInfoRowLinear(o,this.translationX,this._translLms[0],e,this._translSds[0],t,i),r=o.jacobian,r.lin1X=this._basisX1X,r.lin1Y=this._basisX1Y,r.lin1Z=this._basisX1Z,r.lin2X=this._basisX1X,r.lin2Y=this._basisX1Y,r.lin2Z=this._basisX1Z,r.ang1X=this._relativeAnchor1Y*this._basisX1Z-this._relativeAnchor1Z*this._basisX1Y,r.ang1Y=this._relativeAnchor1Z*this._basisX1X-this._relativeAnchor1X*this._basisX1Z,r.ang1Z=this._relativeAnchor1X*this._basisX1Y-this._relativeAnchor1Y*this._basisX1X,r.ang2X=this._relativeAnchor2Y*this._basisX1Z-this._relativeAnchor2Z*this._basisX1Y,r.ang2Y=this._relativeAnchor2Z*this._basisX1X-this._relativeAnchor2X*this._basisX1Z,r.ang2Z=this._relativeAnchor2X*this._basisX1Y-this._relativeAnchor2Y*this._basisX1X}if(this._translSds[1].frequency<=0||!i){var b=this._impulses[1],f=a.rows[a.numRows++],n=f.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,f.rhs=0,f.cfm=0,f.minImpulse=0,f.maxImpulse=0,f.motorSpeed=0,f.motorMaxImpulse=0,f.impulse=null,f.impulse=b,o=f,this.setSolverInfoRowLinear(o,this.translationY,this._translLms[1],e,this._translSds[1],t,i),r=o.jacobian,r.lin1X=this._basisY1X,r.lin1Y=this._basisY1Y,r.lin1Z=this._basisY1Z,r.lin2X=this._basisY1X,r.lin2Y=this._basisY1Y,r.lin2Z=this._basisY1Z,r.ang1X=this._relativeAnchor1Y*this._basisY1Z-this._relativeAnchor1Z*this._basisY1Y,r.ang1Y=this._relativeAnchor1Z*this._basisY1X-this._relativeAnchor1X*this._basisY1Z,r.ang1Z=this._relativeAnchor1X*this._basisY1Y-this._relativeAnchor1Y*this._basisY1X,r.ang2X=this._relativeAnchor2Y*this._basisY1Z-this._relativeAnchor2Z*this._basisY1Y,r.ang2Y=this._relativeAnchor2Z*this._basisY1X-this._relativeAnchor2X*this._basisY1Z,r.ang2Z=this._relativeAnchor2X*this._basisY1Y-this._relativeAnchor2Y*this._basisY1X}if(this._translSds[2].frequency<=0||!i){var c=this._impulses[2],z=a.rows[a.numRows++],p=z.jacobian;p.lin1X=0,p.lin1Y=0,p.lin1Z=0,p.lin2X=0,p.lin2Y=0,p.lin2Z=0,p.ang1X=0,p.ang1Y=0,p.ang1Z=0,p.ang2X=0,p.ang2Y=0,p.ang2Z=0,z.rhs=0,z.cfm=0,z.minImpulse=0,z.maxImpulse=0,z.motorSpeed=0,z.motorMaxImpulse=0,z.impulse=null,z.impulse=c,o=z,this.setSolverInfoRowLinear(o,this.translationZ,this._translLms[2],e,this._translSds[2],t,i),r=o.jacobian,r.lin1X=this._basisZ1X,r.lin1Y=this._basisZ1Y,r.lin1Z=this._basisZ1Z,r.lin2X=this._basisZ1X,r.lin2Y=this._basisZ1Y,r.lin2Z=this._basisZ1Z,r.ang1X=this._relativeAnchor1Y*this._basisZ1Z-this._relativeAnchor1Z*this._basisZ1Y,r.ang1Y=this._relativeAnchor1Z*this._basisZ1X-this._relativeAnchor1X*this._basisZ1Z,r.ang1Z=this._relativeAnchor1X*this._basisZ1Y-this._relativeAnchor1Y*this._basisZ1X,r.ang2X=this._relativeAnchor2Y*this._basisZ1Z-this._relativeAnchor2Z*this._basisZ1Y,r.ang2Y=this._relativeAnchor2Z*this._basisZ1X-this._relativeAnchor2X*this._basisZ1Z,r.ang2Z=this._relativeAnchor2X*this._basisZ1Y-this._relativeAnchor2Y*this._basisZ1X}if(!this.xSingular&&(this._rotSds[0].frequency<=0||!i)){var y=this._impulses[3],V=a.rows[a.numRows++],M=V.jacobian;M.lin1X=0,M.lin1Y=0,M.lin1Z=0,M.lin2X=0,M.lin2Y=0,M.lin2Z=0,M.ang1X=0,M.ang1Y=0,M.ang1Z=0,M.ang2X=0,M.ang2Y=0,M.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=y,o=V,this.setSolverInfoRowAngular(o,this._angleX,this._rotLms[0],_,this._rotSds[0],t,i),r=o.jacobian,r.ang1X=this._axisXX,r.ang1Y=this._axisXY,r.ang1Z=this._axisXZ,r.ang2X=this._axisXX,r.ang2Y=this._axisXY,r.ang2Z=this._axisXZ}if(!this.ySingular&&(this._rotSds[1].frequency<=0||!i)){var I=this._impulses[4],k=a.rows[a.numRows++],X=k.jacobian;X.lin1X=0,X.lin1Y=0,X.lin1Z=0,X.lin2X=0,X.lin2Y=0,X.lin2Z=0,X.ang1X=0,X.ang1Y=0,X.ang1Z=0,X.ang2X=0,X.ang2Y=0,X.ang2Z=0,k.rhs=0,k.cfm=0,k.minImpulse=0,k.maxImpulse=0,k.motorSpeed=0,k.motorMaxImpulse=0,k.impulse=null,k.impulse=I,o=k,this.setSolverInfoRowAngular(o,this._angleY,this._rotLms[1],h,this._rotSds[1],t,i),r=o.jacobian,r.ang1X=this._axisYX,r.ang1Y=this._axisYY,r.ang1Z=this._axisYZ,r.ang2X=this._axisYX,r.ang2Y=this._axisYY,r.ang2Z=this._axisYZ}if(!this.zSingular&&(this._rotSds[2].frequency<=0||!i)){var L=this._impulses[5],m=a.rows[a.numRows++],g=m.jacobian;g.lin1X=0,g.lin1Y=0,g.lin1Z=0,g.lin2X=0,g.lin2Y=0,g.lin2Z=0,g.ang1X=0,g.ang1Y=0,g.ang1Z=0,g.ang2X=0,g.ang2Y=0,g.ang2Z=0,m.rhs=0,m.cfm=0,m.minImpulse=0,m.maxImpulse=0,m.motorSpeed=0,m.motorMaxImpulse=0,m.impulse=null,m.impulse=L,o=m,this.setSolverInfoRowAngular(o,this._angleZ,this._rotLms[2],v,this._rotSds[2],t,i),r=o.jacobian,r.ang1X=this._axisZX,r.ang1Y=this._axisZY,r.ang1Z=this._axisZZ,r.ang2X=this._axisZX,r.ang2Y=this._axisZY,r.ang2Z=this._axisZZ}}_syncAnchors(){super._syncAnchors(),this._basisX1X,this._basisY1X,this._basisZ1X,this._basisX1Y,this._basisY1Y,this._basisZ1Y,this._basisX1Z,this._basisY1Z,this._basisZ1Z,this._basisX2X,this._basisY2X,this._basisZ2X,this._basisX2Y,this._basisY2Y,this._basisZ2Y,this._basisX2Z,this._basisY2Z,this._basisZ2Z;var a,t,i,o,r,e,_,h,v;a=this._basisX1X,t=this._basisX1Y,i=this._basisX1Z,_=this._basisZ2X,h=this._basisZ2Y,v=this._basisZ2Z,o=h*i-v*t,r=v*a-_*i,e=_*t-h*a,this._axisXX=r*v-e*h,this._axisXY=e*_-o*v,this._axisXZ=o*h-r*_,this._axisYX=o,this._axisYY=r,this._axisYZ=e,this._axisZX=t*e-i*r,this._axisZY=i*o-a*e,this._axisZZ=a*r-t*o;var s=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;s>0&&(s=1/Math.sqrt(s)),this._axisXX*=s,this._axisXY*=s,this._axisXZ*=s;var l=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;l>0&&(l=1/Math.sqrt(l)),this._axisYX*=l,this._axisYY*=l,this._axisYZ*=l;var x=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;x>0&&(x=1/Math.sqrt(x)),this._axisZX*=x,this._axisZY*=x,this._axisZZ*=x,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0;var b,f,n,c,z,p,y,V,M,I,k,X,L,m,g,N,d,F;b=this._basisX1X,f=this._basisY1X,n=this._basisZ1X,c=this._basisX1Y,z=this._basisY1Y,p=this._basisZ1Y,y=this._basisX1Z,V=this._basisY1Z,M=this._basisZ1Z,I=this._basisX2X,k=this._basisY2X,X=this._basisZ2X,L=this._basisX2Y,m=this._basisY2Y,g=this._basisZ2Y,N=this._basisX2Z,d=this._basisY2Z,F=this._basisZ2Z;var S,Y,Q,C,B,Z,$,K,E,J,A,R,U,G;K=b*I+c*L+y*N,E=b*k+c*m+y*d,J=b*X+c*g+y*F,A=f*k+z*m+V*d,R=f*X+z*g+V*F,U=n*k+p*m+M*d,G=n*X+p*g+M*F,S=K,Y=E,Q=J,C=A,B=R,Z=U,$=G;var D,H,j,ia=Q;if(ia<=-1){var ea=Math.atan2(Z,C);D=ea*.5,H=-1.570796326794895,j=-ea*.5}else if(ia>=1){var W=Math.atan2(Z,C);D=W*.5,H=1.570796326794895,j=W*.5}else{var q=Math.asin(ia),na=Math.atan2(-B,$),oa=Math.atan2(-Y,S);D=na,H=q,j=oa}this._angleX=D,this._angleY=H,this._angleZ=j;var aa,T,ca;aa=this._anchor2X-this._anchor1X,T=this._anchor2Y-this._anchor1Y,ca=this._anchor2Z-this._anchor1Z,this.translationX=aa*this._basisX1X+T*this._basisX1Y+ca*this._basisX1Z,this.translationY=aa*this._basisY1X+T*this._basisY1Y+ca*this._basisY1Z,this.translationZ=aa*this._basisZ1X+T*this._basisZ1Y+ca*this._basisZ1Z}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxisX(){var a=new u.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxisY(){var a=new u.common.Vec3,t=a;return t.x=this._axisYX,t.y=this._axisYY,t.z=this._axisYZ,a}getAxisZ(){var a=new u.common.Vec3,t=a;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,a}getTranslationalSpringDampers(){return this._translSds.slice(0)}getRotationalSpringDampers(){return this._translSds.slice(0)}getTranslationalLimitMotors(){return this._translLms.slice(0)}getRotationalLimitMotors(){return this._rotLms.slice(0)}getAngles(){return new u.common.Vec3(this._angleX,this._angleY,this._angleZ)}getTranslations(){return new u.common.Vec3(this.translationX,this.translationY,this.translationZ)}};u.dynamics.constraint.joint.GenericJointConfig=class extends u.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localBasis1=new u.common.Mat3,this.localBasis2=new u.common.Mat3;var a=[];a.push(new u.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),a.push(new u.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),a.push(new u.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),this.translationalLimitMotors=a;var t=[];t.push(new u.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),t.push(new u.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),t.push(new u.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),this.rotationalLimitMotors=t,this.translationalSpringDampers=[new u.dynamics.constraint.joint.SpringDamper,new u.dynamics.constraint.joint.SpringDamper,new u.dynamics.constraint.joint.SpringDamper],this.rotationalSpringDampers=[new u.dynamics.constraint.joint.SpringDamper,new u.dynamics.constraint.joint.SpringDamper,new u.dynamics.constraint.joint.SpringDamper]}init(a,t,i,o,r){this._init(a,t,i);var e=a._transform,_=t._transform,h,v,s,l,x,b,f,n,c,z,p,y,V,M,I,k,X,L,m,g,N,d,F,S,Y,Q,C,B,Z,$,K,E,J,A,R,U,G=o;h=G.e00,v=G.e01,s=G.e02,l=G.e10,x=G.e11,b=G.e12,f=G.e20,n=G.e21,c=G.e22;var D=r;z=D.e00,p=D.e01,y=D.e02,V=D.e10,M=D.e11,I=D.e12,k=D.e20,X=D.e21,L=D.e22;var H,j,ia,ea,W,q,na,oa,aa;H=e._rotation00*h+e._rotation10*l+e._rotation20*f,j=e._rotation00*v+e._rotation10*x+e._rotation20*n,ia=e._rotation00*s+e._rotation10*b+e._rotation20*c,ea=e._rotation01*h+e._rotation11*l+e._rotation21*f,W=e._rotation01*v+e._rotation11*x+e._rotation21*n,q=e._rotation01*s+e._rotation11*b+e._rotation21*c,na=e._rotation02*h+e._rotation12*l+e._rotation22*f,oa=e._rotation02*v+e._rotation12*x+e._rotation22*n,aa=e._rotation02*s+e._rotation12*b+e._rotation22*c,m=H,g=j,N=ia,d=ea,F=W,S=q,Y=na,Q=oa,C=aa;var T,ca,_a,w,ta,ra,la,va,ua;T=_._rotation00*z+_._rotation10*V+_._rotation20*k,ca=_._rotation00*p+_._rotation10*M+_._rotation20*X,_a=_._rotation00*y+_._rotation10*I+_._rotation20*L,w=_._rotation01*z+_._rotation11*V+_._rotation21*k,ta=_._rotation01*p+_._rotation11*M+_._rotation21*X,ra=_._rotation01*y+_._rotation11*I+_._rotation21*L,la=_._rotation02*z+_._rotation12*V+_._rotation22*k,va=_._rotation02*p+_._rotation12*M+_._rotation22*X,ua=_._rotation02*y+_._rotation12*I+_._rotation22*L,B=T,Z=ca,$=_a,K=w,E=ta,J=ra,A=la,R=va,U=ua;var za=this.localBasis1;za.e00=m,za.e01=g,za.e02=N,za.e10=d,za.e11=F,za.e12=S,za.e20=Y,za.e21=Q,za.e22=C;var Ma=this.localBasis2;return Ma.e00=B,Ma.e01=Z,Ma.e02=$,Ma.e10=K,Ma.e11=E,Ma.e12=J,Ma.e20=A,Ma.e21=R,Ma.e22=U,this}};u.dynamics.constraint.joint.JointImpulse=class{constructor(){this.impulse=0,this.impulseM=0,this.impulseP=0}};u.dynamics.constraint.joint.JointLink=class{constructor(a){this._joint=a}getContact(){return this._joint}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}};u.dynamics.constraint.joint.JointMacro=class{};u.dynamics.constraint.joint.JointType=class{};u.dynamics.constraint.joint.PrismaticJoint=class extends u.dynamics.constraint.joint.Joint{constructor(a){super(a,u.dynamics.constraint.joint.JointType.PRISMATIC);var t=a.localAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var i=a.localAxis2;this._localBasisX2X=i.x,this._localBasisX2Y=i.y,this._localBasisX2Z=i.z,this.buildLocalBasesFromX(),this._basis=new u.dynamics.constraint.joint.BasisTracker(this),this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this.angularErrorX=0,this.angularErrorY=0,this.angularErrorZ=0,this._sd=a.springDamper.clone(),this._lm=a.limitMotor.clone()}getInfo(a,t,i){var o=this.getErp(t,i),r=this.linearErrorY*o,e=this.linearErrorZ*o,_=this.angularErrorX*o,h=this.angularErrorY*o,v=this.angularErrorZ*o,s,l,x=1/(this._b1._invMass+this._b2._invMass);if(this._sd.frequency<=0||!i){var b=this._impulses[0],f=a.rows[a.numRows++],n=f.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,f.rhs=0,f.cfm=0,f.minImpulse=0,f.maxImpulse=0,f.motorSpeed=0,f.motorMaxImpulse=0,f.impulse=null,f.impulse=b,s=f,this.setSolverInfoRowLinear(s,this.translation,this._lm,x,this._sd,t,i),l=s.jacobian,l.lin1X=this._basis.xX,l.lin1Y=this._basis.xY,l.lin1Z=this._basis.xZ,l.lin2X=this._basis.xX,l.lin2Y=this._basis.xY,l.lin2Z=this._basis.xZ,l.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,l.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,l.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,l.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,l.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,l.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}var c=this._impulses[1],z=a.rows[a.numRows++],p=z.jacobian;p.lin1X=0,p.lin1Y=0,p.lin1Z=0,p.lin2X=0,p.lin2Y=0,p.lin2Z=0,p.ang1X=0,p.ang1Y=0,p.ang1Z=0,p.ang2X=0,p.ang2Y=0,p.ang2Z=0,z.rhs=0,z.cfm=0,z.minImpulse=0,z.maxImpulse=0,z.motorSpeed=0,z.motorMaxImpulse=0,z.impulse=null,z.impulse=c,s=z,s.rhs=r,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=1/0,l=s.jacobian,l.lin1X=this._basis.yX,l.lin1Y=this._basis.yY,l.lin1Z=this._basis.yZ,l.lin2X=this._basis.yX,l.lin2Y=this._basis.yY,l.lin2Z=this._basis.yZ,l.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,l.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,l.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,l.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,l.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,l.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;var y=this._impulses[2],V=a.rows[a.numRows++],M=V.jacobian;M.lin1X=0,M.lin1Y=0,M.lin1Z=0,M.lin2X=0,M.lin2Y=0,M.lin2Z=0,M.ang1X=0,M.ang1Y=0,M.ang1Z=0,M.ang2X=0,M.ang2Y=0,M.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=y,s=V,s.rhs=e,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=1/0,l=s.jacobian,l.lin1X=this._basis.zX,l.lin1Y=this._basis.zY,l.lin1Z=this._basis.zZ,l.lin2X=this._basis.zX,l.lin2Y=this._basis.zY,l.lin2Z=this._basis.zZ,l.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,l.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,l.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,l.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,l.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,l.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX;var I=this._impulses[3],k=a.rows[a.numRows++],X=k.jacobian;X.lin1X=0,X.lin1Y=0,X.lin1Z=0,X.lin2X=0,X.lin2Y=0,X.lin2Z=0,X.ang1X=0,X.ang1Y=0,X.ang1Z=0,X.ang2X=0,X.ang2Y=0,X.ang2Z=0,k.rhs=0,k.cfm=0,k.minImpulse=0,k.maxImpulse=0,k.motorSpeed=0,k.motorMaxImpulse=0,k.impulse=null,k.impulse=I,s=k,s.rhs=_,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=1/0,l=s.jacobian,l.ang1X=1,l.ang1Y=0,l.ang1Z=0,l.ang2X=1,l.ang2Y=0,l.ang2Z=0;var L=this._impulses[4],m=a.rows[a.numRows++],g=m.jacobian;g.lin1X=0,g.lin1Y=0,g.lin1Z=0,g.lin2X=0,g.lin2Y=0,g.lin2Z=0,g.ang1X=0,g.ang1Y=0,g.ang1Z=0,g.ang2X=0,g.ang2Y=0,g.ang2Z=0,m.rhs=0,m.cfm=0,m.minImpulse=0,m.maxImpulse=0,m.motorSpeed=0,m.motorMaxImpulse=0,m.impulse=null,m.impulse=L,s=m,s.rhs=h,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=1/0,l=s.jacobian,l.ang1X=0,l.ang1Y=1,l.ang1Z=0,l.ang2X=0,l.ang2Y=1,l.ang2Z=0;var N=this._impulses[5],d=a.rows[a.numRows++],F=d.jacobian;F.lin1X=0,F.lin1Y=0,F.lin1Z=0,F.lin2X=0,F.lin2Y=0,F.lin2Z=0,F.ang1X=0,F.ang1Y=0,F.ang1Z=0,F.ang2X=0,F.ang2Y=0,F.ang2Z=0,d.rhs=0,d.cfm=0,d.minImpulse=0,d.maxImpulse=0,d.motorSpeed=0,d.motorMaxImpulse=0,d.impulse=null,d.impulse=N,s=d,s.rhs=v,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=1/0,l=s.jacobian,l.ang1X=0,l.ang1Y=0,l.ang1Z=1,l.ang2X=0,l.ang2Y=0,l.ang2Z=1}_syncAnchors(){super._syncAnchors();var a=this._basis,t=a.joint._b1._invMass,i=a.joint._b2._invMass,o,r,e,_,h,v,s,l,x,b,f,n,c,z,p,y,V,M,I,k,X,L,m,g,N,d,F,S,Y,Q,C,B,Z,$,K,E,J=a.joint._basisX1X*a.joint._basisX2X+a.joint._basisX1Y*a.joint._basisX2Y+a.joint._basisX1Z*a.joint._basisX2Z;if(J<-.999999999){var A,R,U,G=a.joint._basisX1X,D=a.joint._basisX1Y,H=a.joint._basisX1Z,j=G*G,ia=D*D,ea=H*H,W;j<ia?j<ea?(W=1/Math.sqrt(ia+ea),A=0,R=H*W,U=-D*W):(W=1/Math.sqrt(j+ia),A=D*W,R=-G*W,U=0):ia<ea?(W=1/Math.sqrt(ea+j),A=-H*W,R=0,U=G*W):(W=1/Math.sqrt(j+ia),A=D*W,R=-G*W,U=0),o=A,r=R,e=U,_=0}else{var q,na,oa;q=a.joint._basisX1Y*a.joint._basisX2Z-a.joint._basisX1Z*a.joint._basisX2Y,na=a.joint._basisX1Z*a.joint._basisX2X-a.joint._basisX1X*a.joint._basisX2Z,oa=a.joint._basisX1X*a.joint._basisX2Y-a.joint._basisX1Y*a.joint._basisX2X;var aa=Math.sqrt((1+J)*.5);J=.5/aa,q*=J,na*=J,oa*=J,o=q,r=na,e=oa,_=aa}h=0,v=0,s=0,l=1;var T,ca,_a,w,ta,ra,la,va;T=h,ca=v,_a=s,w=l,ta=o,ra=r,la=e,va=_;var ua=T*ta+ca*ra+_a*la+w*va;if(ua<0&&(ua=-ua,ta=-ta,ra=-ra,la=-la,va=-va),ua>.999999){var za,Ma,Xa,Za;za=ta-T,Ma=ra-ca,Xa=la-_a,Za=va-w,ta=T+za*(t/(t+i)),ra=ca+Ma*(t/(t+i)),la=_a+Xa*(t/(t+i)),va=w+Za*(t/(t+i));var fa=ta*ta+ra*ra+la*la+va*va;fa>1e-32&&(fa=1/Math.sqrt(fa)),x=ta*fa,b=ra*fa,f=la*fa,n=va*fa}else{var ba=t/(t+i)*Math.acos(ua);ta+=T*-ua,ra+=ca*-ua,la+=_a*-ua,va+=w*-ua;var sa=ta*ta+ra*ra+la*la+va*va;sa>1e-32&&(sa=1/Math.sqrt(sa)),ta*=sa,ra*=sa,la*=sa,va*=sa;var ha=Math.sin(ba),ma=Math.cos(ba);T*=ma,ca*=ma,_a*=ma,w*=ma,x=T+ta*ha,b=ca+ra*ha,f=_a+la*ha,n=w+va*ha}var ya=x,Ba=b,pa=f,Ya=n,Ra=2*ya,ga=2*Ba,xa=2*pa,wa=ya*Ra,ka=Ba*ga,Pa=pa*xa,zt=ya*ga,Oa=Ba*xa,Aa=ya*xa,nt=Ya*Ra,Ea=Ya*ga,Fa=Ya*xa;c=1-ka-Pa,z=zt-Fa,p=Aa+Ea,y=zt+Fa,V=1-wa-Pa,M=Oa-nt,I=Aa-Ea,k=Oa+nt,X=1-wa-ka;var da,ft,Wa;da=c*a.joint._basisX1X+z*a.joint._basisX1Y+p*a.joint._basisX1Z,ft=y*a.joint._basisX1X+V*a.joint._basisX1Y+M*a.joint._basisX1Z,Wa=I*a.joint._basisX1X+k*a.joint._basisX1Y+X*a.joint._basisX1Z,L=da,m=ft,g=Wa,C=a.xX,B=a.xY,Z=a.xZ,$=a.yX,K=a.yY,E=a.yZ;var Ha=C*L+B*m+Z*g;if(Ha<-.999999999){var bt,it,Ka,_t=C,gt=B,pt=Z,Ga=_t*_t,rt=gt*gt,xt=pt*pt,Da;Ga<rt?Ga<xt?(Da=1/Math.sqrt(rt+xt),bt=0,it=pt*Da,Ka=-gt*Da):(Da=1/Math.sqrt(Ga+rt),bt=gt*Da,it=-_t*Da,Ka=0):rt<xt?(Da=1/Math.sqrt(xt+Ga),bt=-pt*Da,it=0,Ka=_t*Da):(Da=1/Math.sqrt(Ga+rt),bt=gt*Da,it=-_t*Da,Ka=0),x=bt,b=it,f=Ka,n=0}else{var Ta,Na,Vt;Ta=B*g-Z*m,Na=Z*L-C*g,Vt=C*m-B*L;var Pt=Math.sqrt((1+Ha)*.5);Ha=.5/Pt,Ta*=Ha,Na*=Ha,Vt*=Ha,x=Ta,b=Na,f=Vt,n=Pt}var st=x,Xt=b,Yt=f,Mt=n,Ia=2*st,O=2*Xt,Va=2*Yt,lt=st*Ia,P=Xt*O,wt=Yt*Va,At=st*O,dt=Xt*Va,yt=st*Va,kt=Mt*Ia,mt=Mt*O,ht=Mt*Va;c=1-P-wt,z=At-ht,p=yt+mt,y=At+ht,V=1-lt-wt,M=dt-kt,I=yt-mt,k=dt+kt,X=1-lt-P;var ut,Qa,et;if(ut=c*$+z*K+p*E,Qa=y*$+V*K+M*E,et=I*$+k*K+X*E,N=ut,d=Qa,F=et,S=m*F-g*d,Y=g*N-L*F,Q=L*d-m*N,S*S+Y*Y+Q*Q>1e-6){var Ca=S*S+Y*Y+Q*Q;Ca>0&&(Ca=1/Math.sqrt(Ca)),S*=Ca,Y*=Ca,Q*=Ca}else{var vt=L,qa=m,at=g,Ua=vt*vt,tt=qa*qa,ct=at*at,Sa;Ua<tt?Ua<ct?(Sa=1/Math.sqrt(tt+ct),S=0,Y=at*Sa,Q=-qa*Sa):(Sa=1/Math.sqrt(Ua+tt),S=qa*Sa,Y=-vt*Sa,Q=0):tt<ct?(Sa=1/Math.sqrt(ct+Ua),S=-at*Sa,Y=0,Q=vt*Sa):(Sa=1/Math.sqrt(Ua+tt),S=qa*Sa,Y=-vt*Sa,Q=0)}N=Y*g-Q*m,d=Q*L-S*g,F=S*m-Y*L,a.xX=L,a.xY=m,a.xZ=g,a.yX=N,a.yY=d,a.yZ=F,a.zX=S,a.zY=Y,a.zZ=Q;var Ja,ja,La,ot,It,oi,gi,ai,Ct,_i,Et,St,Jt,Ki,vi,li,ti,Oi;Ja=this._basisX1X,ja=this._basisY1X,La=this._basisZ1X,ot=this._basisX1Y,It=this._basisY1Y,oi=this._basisZ1Y,gi=this._basisX1Z,ai=this._basisY1Z,Ct=this._basisZ1Z,_i=this._basisX2X,Et=this._basisY2X,St=this._basisZ2X,Jt=this._basisX2Y,Ki=this._basisY2Y,vi=this._basisZ2Y,li=this._basisX2Z,ti=this._basisY2Z,Oi=this._basisZ2Z;var Xi,zi,Zt,ri,Wt,ni,$i,Ut,ji,Ii,pr,Wi,Lt,jt,Tt,bi,Mi,vr;Ii=_i*Ja+Et*ja+St*La,pr=_i*ot+Et*It+St*oi,Wi=_i*gi+Et*ai+St*Ct,Lt=Jt*Ja+Ki*ja+vi*La,jt=Jt*ot+Ki*It+vi*oi,Tt=Jt*gi+Ki*ai+vi*Ct,bi=li*Ja+ti*ja+Oi*La,Mi=li*ot+ti*It+Oi*oi,vr=li*gi+ti*ai+Oi*Ct,Xi=Ii,zi=pr,Zt=Wi,ri=Lt,Wt=jt,ni=Tt,$i=bi,Ut=Mi,ji=vr;var qt,fi,Bt,xi,hi=Xi,sr=Wt,Xr=ji,ro=hi+sr+Xr,Gt;ro>0?(Gt=Math.sqrt(ro+1),xi=.5*Gt,Gt=.5/Gt,qt=(Ut-ni)*Gt,fi=(Zt-$i)*Gt,Bt=(ri-zi)*Gt):hi>sr?hi>Xr?(Gt=Math.sqrt(hi-sr-Xr+1),qt=.5*Gt,Gt=.5/Gt,fi=(zi+ri)*Gt,Bt=(Zt+$i)*Gt,xi=(Ut-ni)*Gt):(Gt=Math.sqrt(Xr-hi-sr+1),Bt=.5*Gt,Gt=.5/Gt,qt=(Zt+$i)*Gt,fi=(ni+Ut)*Gt,xi=(ri-zi)*Gt):sr>Xr?(Gt=Math.sqrt(sr-Xr-hi+1),fi=.5*Gt,Gt=.5/Gt,qt=(zi+ri)*Gt,Bt=(ni+Ut)*Gt,xi=(Zt-$i)*Gt):(Gt=Math.sqrt(Xr-hi-sr+1),Bt=.5*Gt,Gt=.5/Gt,qt=(Zt+$i)*Gt,fi=(ni+Ut)*Gt,xi=(ri-zi)*Gt);var fr=xi,mr=(fr<=-1?3.14159265358979:fr>=1?0:Math.acos(fr))*2;this.angularErrorX=qt,this.angularErrorY=fi,this.angularErrorZ=Bt;var Dt=this.angularErrorX*this.angularErrorX+this.angularErrorY*this.angularErrorY+this.angularErrorZ*this.angularErrorZ;Dt>0&&(Dt=1/Math.sqrt(Dt)),this.angularErrorX*=Dt,this.angularErrorY*=Dt,this.angularErrorZ*=Dt,this.angularErrorX*=mr,this.angularErrorY*=mr,this.angularErrorZ*=mr;var Br,Si,Dr;Br=this._anchor2X-this._anchor1X,Si=this._anchor2Y-this._anchor1Y,Dr=this._anchor2Z-this._anchor1Z,this.translation=Br*this._basis.xX+Si*this._basis.xY+Dr*this._basis.xZ,this.linearErrorY=Br*this._basis.yX+Si*this._basis.yY+Dr*this._basis.yZ,this.linearErrorZ=Br*this._basis.zX+Si*this._basis.zY+Dr*this._basis.zZ}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxis1(){var a=new u.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxis2(){var a=new u.common.Vec3,t=a;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,a}getAxis1To(a){var t=a;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(a){var t=a;t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){var a=new u.common.Vec3,t=a;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,a}getLocalAxis2(){var a=new u.common.Vec3,t=a;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,a}getLocalAxis1To(a){var t=a;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(a){var t=a;t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getTranslation(){return this.translation}};u.dynamics.constraint.joint.PrismaticJointConfig=class extends u.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new u.common.Vec3(1,0,0),this.localAxis2=new u.common.Vec3(1,0,0),this.limitMotor=new u.dynamics.constraint.joint.TranslationalLimitMotor,this.springDamper=new u.dynamics.constraint.joint.SpringDamper}init(a,t,i,o){this._init(a,t,i);var r,e,_,h=o;r=h.x,e=h.y,_=h.z;var v,s,l;v=a._transform._rotation00*r+a._transform._rotation10*e+a._transform._rotation20*_,s=a._transform._rotation01*r+a._transform._rotation11*e+a._transform._rotation21*_,l=a._transform._rotation02*r+a._transform._rotation12*e+a._transform._rotation22*_,r=v,e=s,_=l;var x=this.localAxis1;x.x=r,x.y=e,x.z=_;var b,f,n,c=o;b=c.x,f=c.y,n=c.z;var z,p,y;z=t._transform._rotation00*b+t._transform._rotation10*f+t._transform._rotation20*n,p=t._transform._rotation01*b+t._transform._rotation11*f+t._transform._rotation21*n,y=t._transform._rotation02*b+t._transform._rotation12*f+t._transform._rotation22*n,b=z,f=p,n=y;var V=this.localAxis2;return V.x=b,V.y=f,V.z=n,this}};u.dynamics.constraint.joint.RagdollJoint=class extends u.dynamics.constraint.joint.Joint{constructor(a){super(a,u.dynamics.constraint.joint.JointType.RAGDOLL);var t=a.localTwistAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var i=a.localSwingAxis1;this._localBasisY1X=i.x,this._localBasisY1Y=i.y,this._localBasisY1Z=i.z;var o=a.localTwistAxis2;this._localBasisX2X=o.x,this._localBasisX2Y=o.y,this._localBasisX2Z=o.z,this.buildLocalBasesFromXY1X2(),this._twistSd=a.twistSpringDamper.clone(),this._twistLm=a.twistLimitMotor.clone(),this._swingSd=a.swingSpringDamper.clone(),this._maxSwingAngle1=a.maxSwingAngle1,this._maxSwingAngle2=a.maxSwingAngle2,this._maxSwingAngle1<u.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle1=u.common.Setting.minRagdollMaxSwingAngle),this._maxSwingAngle2<u.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle2=u.common.Setting.minRagdollMaxSwingAngle),this.dummySwingLm=new u.dynamics.constraint.joint.RotationalLimitMotor,this.dummySwingLm.lowerLimit=-1,this.dummySwingLm.upperLimit=0,this._swingAngle=0,this._twistAngle=0,this.swingError=0,this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.twistAxisX=0,this.twistAxisY=0,this.twistAxisZ=0}getInfo(a,t,i){var o=this.getErp(t,i),r,e,_;r=this.linearErrorX*o,e=this.linearErrorY*o,_=this.linearErrorZ*o;var h=r,v=e,s=_,l,x,b,f,n,c,z,p,y,V,M,I,k,X,L,m,g,N;l=0,x=-this._relativeAnchor1Z,b=this._relativeAnchor1Y,f=this._relativeAnchor1Z,n=0,c=-this._relativeAnchor1X,z=-this._relativeAnchor1Y,p=this._relativeAnchor1X,y=0,V=0,M=-this._relativeAnchor2Z,I=this._relativeAnchor2Y,k=this._relativeAnchor2Z,X=0,L=-this._relativeAnchor2X,m=-this._relativeAnchor2Y,g=this._relativeAnchor2X,N=0,l=-l,x=-x,b=-b,f=-f,n=-n,c=-c,z=-z,p=-p,y=-y,V=-V,M=-M,I=-I,k=-k,X=-X,L=-L,m=-m,g=-g,N=-N;var d=this.computeEffectiveInertiaMoment(this.swingAxisX,this.swingAxisY,this.swingAxisZ),F=this.computeEffectiveInertiaMoment(this._basisX2X,this._basisX2Y,this._basisX2Z),S=this._impulses[0],Y=a.rows[a.numRows++],Q=Y.jacobian;Q.lin1X=0,Q.lin1Y=0,Q.lin1Z=0,Q.lin2X=0,Q.lin2Y=0,Q.lin2Z=0,Q.ang1X=0,Q.ang1Y=0,Q.ang1Z=0,Q.ang2X=0,Q.ang2Y=0,Q.ang2Z=0,Y.rhs=0,Y.cfm=0,Y.minImpulse=0,Y.maxImpulse=0,Y.motorSpeed=0,Y.motorMaxImpulse=0,Y.impulse=null,Y.impulse=S;var C=Y;C.rhs=h,C.cfm=0,C.minImpulse=-1/0,C.maxImpulse=1/0;var B=C.jacobian;B.lin1X=1,B.lin1Y=0,B.lin1Z=0,B.lin2X=1,B.lin2Y=0,B.lin2Z=0,B.ang1X=l,B.ang1Y=x,B.ang1Z=b,B.ang2X=V,B.ang2Y=M,B.ang2Z=I;var Z=this._impulses[1],$=a.rows[a.numRows++],K=$.jacobian;K.lin1X=0,K.lin1Y=0,K.lin1Z=0,K.lin2X=0,K.lin2Y=0,K.lin2Z=0,K.ang1X=0,K.ang1Y=0,K.ang1Z=0,K.ang2X=0,K.ang2Y=0,K.ang2Z=0,$.rhs=0,$.cfm=0,$.minImpulse=0,$.maxImpulse=0,$.motorSpeed=0,$.motorMaxImpulse=0,$.impulse=null,$.impulse=Z,C=$,C.rhs=v,C.cfm=0,C.minImpulse=-1/0,C.maxImpulse=1/0,B=C.jacobian,B.lin1X=0,B.lin1Y=1,B.lin1Z=0,B.lin2X=0,B.lin2Y=1,B.lin2Z=0,B.ang1X=f,B.ang1Y=n,B.ang1Z=c,B.ang2X=k,B.ang2Y=X,B.ang2Z=L;var E=this._impulses[2],J=a.rows[a.numRows++],A=J.jacobian;if(A.lin1X=0,A.lin1Y=0,A.lin1Z=0,A.lin2X=0,A.lin2Y=0,A.lin2Z=0,A.ang1X=0,A.ang1Y=0,A.ang1Z=0,A.ang2X=0,A.ang2Y=0,A.ang2Z=0,J.rhs=0,J.cfm=0,J.minImpulse=0,J.maxImpulse=0,J.motorSpeed=0,J.motorMaxImpulse=0,J.impulse=null,J.impulse=E,C=J,C.rhs=s,C.cfm=0,C.minImpulse=-1/0,C.maxImpulse=1/0,B=C.jacobian,B.lin1X=0,B.lin1Y=0,B.lin1Z=1,B.lin2X=0,B.lin2Y=0,B.lin2Z=1,B.ang1X=z,B.ang1Y=p,B.ang1Z=y,B.ang2X=m,B.ang2Y=g,B.ang2Z=N,this.swingError>0&&(this._swingSd.frequency<=0||!i)){var R=this._impulses[3],U=a.rows[a.numRows++],G=U.jacobian;G.lin1X=0,G.lin1Y=0,G.lin1Z=0,G.lin2X=0,G.lin2Y=0,G.lin2Z=0,G.ang1X=0,G.ang1Y=0,G.ang1Z=0,G.ang2X=0,G.ang2Y=0,G.ang2Z=0,U.rhs=0,U.cfm=0,U.minImpulse=0,U.maxImpulse=0,U.motorSpeed=0,U.motorMaxImpulse=0,U.impulse=null,U.impulse=R,C=U,this.setSolverInfoRowAngular(C,this.swingError,this.dummySwingLm,d,this._swingSd,t,i),B=C.jacobian,B.ang1X=this.swingAxisX,B.ang1Y=this.swingAxisY,B.ang1Z=this.swingAxisZ,B.ang2X=this.swingAxisX,B.ang2Y=this.swingAxisY,B.ang2Z=this.swingAxisZ}if(this._twistSd.frequency<=0||!i){var D=this._impulses[4],H=a.rows[a.numRows++],j=H.jacobian;j.lin1X=0,j.lin1Y=0,j.lin1Z=0,j.lin2X=0,j.lin2Y=0,j.lin2Z=0,j.ang1X=0,j.ang1Y=0,j.ang1Z=0,j.ang2X=0,j.ang2Y=0,j.ang2Z=0,H.rhs=0,H.cfm=0,H.minImpulse=0,H.maxImpulse=0,H.motorSpeed=0,H.motorMaxImpulse=0,H.impulse=null,H.impulse=D,C=H,this.setSolverInfoRowAngular(C,this._twistAngle,this._twistLm,F,this._twistSd,t,i),B=C.jacobian,B.ang1X=this.twistAxisX,B.ang1Y=this.twistAxisY,B.ang1Z=this.twistAxisZ,B.ang2X=this.twistAxisX,B.ang2Y=this.twistAxisY,B.ang2Z=this.twistAxisZ}}_syncAnchors(){super._syncAnchors(),this._b1._transform,this._b2._transform;var a,t,i,o,r,e;a=this._basisX1X,t=this._basisX1Y,i=this._basisX1Z,o=this._basisX2X,r=this._basisX2Y,e=this._basisX2Z;var _,h,v,s,l,x,b,f,n;_=this._basisX1X,h=this._basisY1X,v=this._basisZ1X,s=this._basisX1Y,l=this._basisY1Y,x=this._basisZ1Y,b=this._basisX1Z,f=this._basisY1Z,n=this._basisZ1Z,this._basisX2X,this._basisY2X,this._basisZ2X,this._basisX2Y,this._basisY2Y,this._basisZ2Y,this._basisX2Z,this._basisY2Z,this._basisZ2Z;var c,z,p,y,V,M,I,k,X,L,m,g,N,d,F,S,Y=a*o+t*r+i*e;if(Y<-.999999999){var Q,C,B,Z=a,$=t,K=i,E=Z*Z,J=$*$,A=K*K,R;E<J?E<A?(R=1/Math.sqrt(J+A),Q=0,C=K*R,B=-$*R):(R=1/Math.sqrt(E+J),Q=$*R,C=-Z*R,B=0):J<A?(R=1/Math.sqrt(A+E),Q=-K*R,C=0,B=Z*R):(R=1/Math.sqrt(E+J),Q=$*R,C=-Z*R,B=0),c=Q,z=C,p=B,y=0}else{var U,G,D;U=t*e-i*r,G=i*o-a*e,D=a*r-t*o;var H=Math.sqrt((1+Y)*.5);Y=.5/H,U*=Y,G*=Y,D*=Y,c=U,z=G,p=D,y=H}var j=c,ia=z,ea=p,W=y,q=2*j,na=2*ia,oa=2*ea,aa=j*q,T=ia*na,ca=ea*oa,_a=j*na,w=ia*oa,ta=j*oa,ra=W*q,la=W*na,va=W*oa;V=1-T-ca,M=_a-va,I=ta+la,k=_a+va,X=1-aa-ca,L=w-ra,m=ta-la,g=w+ra,N=1-aa-T,this._swingAngle=(y<=-1?3.14159265358979:y>=1?0:Math.acos(y))*2,d=c,F=z,S=p;var ua,za,Ma,Xa,Za,fa;Xa=V*this._basisY2X+k*this._basisY2Y+m*this._basisY2Z,Za=M*this._basisY2X+X*this._basisY2Y+g*this._basisY2Z,fa=I*this._basisY2X+L*this._basisY2Y+N*this._basisY2Z,ua=Xa,za=Za,Ma=fa;var ba=this._basisY1X*ua+this._basisY1Y*za+this._basisY1Z*Ma,sa=this._basisZ1X*ua+this._basisZ1Y*za+this._basisZ1Z*Ma;this._twistAngle=Math.atan2(sa,ba),this.twistAxisX=this._basisX1X+this._basisX2X,this.twistAxisY=this._basisX1Y+this._basisX2Y,this.twistAxisZ=this._basisX1Z+this._basisX2Z;var ha=this.twistAxisX*this.twistAxisX+this.twistAxisY*this.twistAxisY+this.twistAxisZ*this.twistAxisZ;ha>0&&(ha=1/Math.sqrt(ha)),this.twistAxisX*=ha,this.twistAxisY*=ha,this.twistAxisZ*=ha;var ma=Math.sqrt(d*d+F*F+S*S);ma>0&&(ma=1/ma),d*=ma*this._swingAngle,F*=ma*this._swingAngle,S*=ma*this._swingAngle;var ya,Ba,pa;ya=_*d+s*F+b*S,Ba=h*d+l*F+f*S,pa=v*d+x*F+n*S,d=ya,F=Ba,S=pa;var Ya=F,Ra=S,ga=this._maxSwingAngle1,xa=this._maxSwingAngle2,wa=1/(ga*ga),ka=1/(xa*xa),Pa=Ya*Ya*wa+Ra*Ra*ka;if(Pa==0)this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.swingError=0;else{var zt=Math.sqrt(1/Pa),Oa=Ya*zt,Aa=Ra*zt,nt=Oa*wa,Ea=Aa*ka;ma=1/Math.sqrt(nt*nt+Ea*Ea),nt*=ma,Ea*=ma;var Fa=(Ya-Oa)*nt+(Ra-Aa)*Ea;if(Fa>0){this.swingError=Fa,this.swingAxisX=0,this.swingAxisY=nt,this.swingAxisZ=Ea;var da,ft,Wa;da=_*this.swingAxisX+h*this.swingAxisY+v*this.swingAxisZ,ft=s*this.swingAxisX+l*this.swingAxisY+x*this.swingAxisZ,Wa=b*this.swingAxisX+f*this.swingAxisY+n*this.swingAxisZ,this.swingAxisX=da,this.swingAxisY=ft,this.swingAxisZ=Wa;var Ha,bt,it;Ha=V*this.swingAxisX+M*this.swingAxisY+I*this.swingAxisZ,bt=k*this.swingAxisX+X*this.swingAxisY+L*this.swingAxisZ,it=m*this.swingAxisX+g*this.swingAxisY+N*this.swingAxisZ,this.swingAxisX=Ha,this.swingAxisY=bt,this.swingAxisZ=it}else this.swingError=0}this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxis1(){var a=new u.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxis2(){var a=new u.common.Vec3,t=a;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,a}getAxis1To(a){var t=a;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(a){var t=a;t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){var a=new u.common.Vec3,t=a;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,a}getLocalAxis2(){var a=new u.common.Vec3,t=a;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,a}getLocalAxis1To(a){var t=a;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(a){var t=a;t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTwistSpringDamper(){return this._twistSd}getTwistLimitMotor(){return this._twistLm}getSwingSpringDamper(){return this._swingSd}getSwingAxis(){var a=new u.common.Vec3,t=a;return t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ,a}getSwingAxisTo(a){var t=a;t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ}getSwingAngle(){return this._swingAngle}getTwistAngle(){return this._twistAngle}};u.dynamics.constraint.joint.RagdollJointConfig=class extends u.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localTwistAxis1=new u.common.Vec3(1,0,0),this.localTwistAxis2=new u.common.Vec3(1,0,0),this.localSwingAxis1=new u.common.Vec3(0,1,0),this.twistSpringDamper=new u.dynamics.constraint.joint.SpringDamper,this.swingSpringDamper=new u.dynamics.constraint.joint.SpringDamper,this.twistLimitMotor=new u.dynamics.constraint.joint.RotationalLimitMotor,this.maxSwingAngle1=3.14159265358979,this.maxSwingAngle2=3.14159265358979}init(a,t,i,o,r){this._init(a,t,i);var e,_,h,v=o;e=v.x,_=v.y,h=v.z;var s,l,x;s=a._transform._rotation00*e+a._transform._rotation10*_+a._transform._rotation20*h,l=a._transform._rotation01*e+a._transform._rotation11*_+a._transform._rotation21*h,x=a._transform._rotation02*e+a._transform._rotation12*_+a._transform._rotation22*h,e=s,_=l,h=x;var b=this.localTwistAxis1;b.x=e,b.y=_,b.z=h;var f,n,c,z=o;f=z.x,n=z.y,c=z.z;var p,y,V;p=t._transform._rotation00*f+t._transform._rotation10*n+t._transform._rotation20*c,y=t._transform._rotation01*f+t._transform._rotation11*n+t._transform._rotation21*c,V=t._transform._rotation02*f+t._transform._rotation12*n+t._transform._rotation22*c,f=p,n=y,c=V;var M=this.localTwistAxis2;M.x=f,M.y=n,M.z=c;var I,k,X,L=r;I=L.x,k=L.y,X=L.z;var m,g,N;m=a._transform._rotation00*I+a._transform._rotation10*k+a._transform._rotation20*X,g=a._transform._rotation01*I+a._transform._rotation11*k+a._transform._rotation21*X,N=a._transform._rotation02*I+a._transform._rotation12*k+a._transform._rotation22*X,I=m,k=g,X=N;var d=this.localSwingAxis1;return d.x=I,d.y=k,d.z=X,this}};u.dynamics.constraint.joint.RevoluteJoint=class extends u.dynamics.constraint.joint.Joint{constructor(a){super(a,1);var t=a.localAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var i=a.localAxis2;this._localBasisX2X=i.x,this._localBasisX2Y=i.y,this._localBasisX2Z=i.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this._basis=new u.dynamics.constraint.joint.BasisTracker(this),this._sd=a.springDamper.clone(),this._lm=a.limitMotor.clone()}getInfo(a,t,i){var o=this.getErp(t,i),r,e,_;r=this.linearErrorX*o,e=this.linearErrorY*o,_=this.linearErrorZ*o;var h=r,v=e,s=_,l=this.angularErrorY*o,x=this.angularErrorZ*o,b,f,n,c,z,p,y,V,M,I,k,X,L,m,g,N,d,F;b=0,f=-this._relativeAnchor1Z,n=this._relativeAnchor1Y,c=this._relativeAnchor1Z,z=0,p=-this._relativeAnchor1X,y=-this._relativeAnchor1Y,V=this._relativeAnchor1X,M=0,I=0,k=-this._relativeAnchor2Z,X=this._relativeAnchor2Y,L=this._relativeAnchor2Z,m=0,g=-this._relativeAnchor2X,N=-this._relativeAnchor2Y,d=this._relativeAnchor2X,F=0,b=-b,f=-f,n=-n,c=-c,z=-z,p=-p,y=-y,V=-V,M=-M,I=-I,k=-k,X=-X,L=-L,m=-m,g=-g,N=-N,d=-d,F=-F;var S=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ),Y=this._impulses[0],Q=a.rows[a.numRows++],C=Q.jacobian;C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,Q.rhs=0,Q.cfm=0,Q.minImpulse=0,Q.maxImpulse=0,Q.motorSpeed=0,Q.motorMaxImpulse=0,Q.impulse=null,Q.impulse=Y;var B=Q;B.rhs=h,B.cfm=0,B.minImpulse=-1/0,B.maxImpulse=1/0;var Z=B.jacobian;Z.lin1X=1,Z.lin1Y=0,Z.lin1Z=0,Z.lin2X=1,Z.lin2Y=0,Z.lin2Z=0,Z.ang1X=b,Z.ang1Y=f,Z.ang1Z=n,Z.ang2X=I,Z.ang2Y=k,Z.ang2Z=X;var $=this._impulses[1],K=a.rows[a.numRows++],E=K.jacobian;E.lin1X=0,E.lin1Y=0,E.lin1Z=0,E.lin2X=0,E.lin2Y=0,E.lin2Z=0,E.ang1X=0,E.ang1Y=0,E.ang1Z=0,E.ang2X=0,E.ang2Y=0,E.ang2Z=0,K.rhs=0,K.cfm=0,K.minImpulse=0,K.maxImpulse=0,K.motorSpeed=0,K.motorMaxImpulse=0,K.impulse=null,K.impulse=$,B=K,B.rhs=v,B.cfm=0,B.minImpulse=-1/0,B.maxImpulse=1/0,Z=B.jacobian,Z.lin1X=0,Z.lin1Y=1,Z.lin1Z=0,Z.lin2X=0,Z.lin2Y=1,Z.lin2Z=0,Z.ang1X=c,Z.ang1Y=z,Z.ang1Z=p,Z.ang2X=L,Z.ang2Y=m,Z.ang2Z=g;var J=this._impulses[2],A=a.rows[a.numRows++],R=A.jacobian;if(R.lin1X=0,R.lin1Y=0,R.lin1Z=0,R.lin2X=0,R.lin2Y=0,R.lin2Z=0,R.ang1X=0,R.ang1Y=0,R.ang1Z=0,R.ang2X=0,R.ang2Y=0,R.ang2Z=0,A.rhs=0,A.cfm=0,A.minImpulse=0,A.maxImpulse=0,A.motorSpeed=0,A.motorMaxImpulse=0,A.impulse=null,A.impulse=J,B=A,B.rhs=s,B.cfm=0,B.minImpulse=-1/0,B.maxImpulse=1/0,Z=B.jacobian,Z.lin1X=0,Z.lin1Y=0,Z.lin1Z=1,Z.lin2X=0,Z.lin2Y=0,Z.lin2Z=1,Z.ang1X=y,Z.ang1Y=V,Z.ang1Z=M,Z.ang2X=N,Z.ang2Y=d,Z.ang2Z=F,this._sd.frequency<=0||!i){var U=this._impulses[3],G=a.rows[a.numRows++],D=G.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,G.rhs=0,G.cfm=0,G.minImpulse=0,G.maxImpulse=0,G.motorSpeed=0,G.motorMaxImpulse=0,G.impulse=null,G.impulse=U,B=G,this.setSolverInfoRowAngular(B,this.angle,this._lm,S,this._sd,t,i),Z=B.jacobian,Z.ang1X=this._basis.xX,Z.ang1Y=this._basis.xY,Z.ang1Z=this._basis.xZ,Z.ang2X=this._basis.xX,Z.ang2Y=this._basis.xY,Z.ang2Z=this._basis.xZ}var H=this._impulses[4],j=a.rows[a.numRows++],ia=j.jacobian;ia.lin1X=0,ia.lin1Y=0,ia.lin1Z=0,ia.lin2X=0,ia.lin2Y=0,ia.lin2Z=0,ia.ang1X=0,ia.ang1Y=0,ia.ang1Z=0,ia.ang2X=0,ia.ang2Y=0,ia.ang2Z=0,j.rhs=0,j.cfm=0,j.minImpulse=0,j.maxImpulse=0,j.motorSpeed=0,j.motorMaxImpulse=0,j.impulse=null,j.impulse=H,B=j,B.rhs=l,B.cfm=0,B.minImpulse=-1/0,B.maxImpulse=1/0,Z=B.jacobian,Z.ang1X=this._basis.yX,Z.ang1Y=this._basis.yY,Z.ang1Z=this._basis.yZ,Z.ang2X=this._basis.yX,Z.ang2Y=this._basis.yY,Z.ang2Z=this._basis.yZ;var ea=this._impulses[5],W=a.rows[a.numRows++],q=W.jacobian;q.lin1X=0,q.lin1Y=0,q.lin1Z=0,q.lin2X=0,q.lin2Y=0,q.lin2Z=0,q.ang1X=0,q.ang1Y=0,q.ang1Z=0,q.ang2X=0,q.ang2Y=0,q.ang2Z=0,W.rhs=0,W.cfm=0,W.minImpulse=0,W.maxImpulse=0,W.motorSpeed=0,W.motorMaxImpulse=0,W.impulse=null,W.impulse=ea,B=W,B.rhs=x,B.cfm=0,B.minImpulse=-1/0,B.maxImpulse=1/0,Z=B.jacobian,Z.ang1X=this._basis.zX,Z.ang1Y=this._basis.zY,Z.ang1Z=this._basis.zZ,Z.ang2X=this._basis.zX,Z.ang2Y=this._basis.zY,Z.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();var a=this._basis,t=a.joint._b1._invMass,i=a.joint._b2._invMass,o,r,e,_,h,v,s,l,x,b,f,n,c,z,p,y,V,M,I,k,X,L,m,g,N,d,F,S,Y,Q,C,B,Z,$,K,E,J=a.joint._basisX1X*a.joint._basisX2X+a.joint._basisX1Y*a.joint._basisX2Y+a.joint._basisX1Z*a.joint._basisX2Z;if(J<-.999999999){var A,R,U,G=a.joint._basisX1X,D=a.joint._basisX1Y,H=a.joint._basisX1Z,j=G*G,ia=D*D,ea=H*H,W;j<ia?j<ea?(W=1/Math.sqrt(ia+ea),A=0,R=H*W,U=-D*W):(W=1/Math.sqrt(j+ia),A=D*W,R=-G*W,U=0):ia<ea?(W=1/Math.sqrt(ea+j),A=-H*W,R=0,U=G*W):(W=1/Math.sqrt(j+ia),A=D*W,R=-G*W,U=0),o=A,r=R,e=U,_=0}else{var q,na,oa;q=a.joint._basisX1Y*a.joint._basisX2Z-a.joint._basisX1Z*a.joint._basisX2Y,na=a.joint._basisX1Z*a.joint._basisX2X-a.joint._basisX1X*a.joint._basisX2Z,oa=a.joint._basisX1X*a.joint._basisX2Y-a.joint._basisX1Y*a.joint._basisX2X;var aa=Math.sqrt((1+J)*.5);J=.5/aa,q*=J,na*=J,oa*=J,o=q,r=na,e=oa,_=aa}h=0,v=0,s=0,l=1;var T,ca,_a,w,ta,ra,la,va;T=h,ca=v,_a=s,w=l,ta=o,ra=r,la=e,va=_;var ua=T*ta+ca*ra+_a*la+w*va;if(ua<0&&(ua=-ua,ta=-ta,ra=-ra,la=-la,va=-va),ua>.999999){var za,Ma,Xa,Za;za=ta-T,Ma=ra-ca,Xa=la-_a,Za=va-w,ta=T+za*(t/(t+i)),ra=ca+Ma*(t/(t+i)),la=_a+Xa*(t/(t+i)),va=w+Za*(t/(t+i));var fa=ta*ta+ra*ra+la*la+va*va;fa>1e-32&&(fa=1/Math.sqrt(fa)),x=ta*fa,b=ra*fa,f=la*fa,n=va*fa}else{var ba=t/(t+i)*Math.acos(ua);ta+=T*-ua,ra+=ca*-ua,la+=_a*-ua,va+=w*-ua;var sa=ta*ta+ra*ra+la*la+va*va;sa>1e-32&&(sa=1/Math.sqrt(sa)),ta*=sa,ra*=sa,la*=sa,va*=sa;var ha=Math.sin(ba),ma=Math.cos(ba);T*=ma,ca*=ma,_a*=ma,w*=ma,x=T+ta*ha,b=ca+ra*ha,f=_a+la*ha,n=w+va*ha}var ya=x,Ba=b,pa=f,Ya=n,Ra=2*ya,ga=2*Ba,xa=2*pa,wa=ya*Ra,ka=Ba*ga,Pa=pa*xa,zt=ya*ga,Oa=Ba*xa,Aa=ya*xa,nt=Ya*Ra,Ea=Ya*ga,Fa=Ya*xa;c=1-ka-Pa,z=zt-Fa,p=Aa+Ea,y=zt+Fa,V=1-wa-Pa,M=Oa-nt,I=Aa-Ea,k=Oa+nt,X=1-wa-ka;var da,ft,Wa;da=c*a.joint._basisX1X+z*a.joint._basisX1Y+p*a.joint._basisX1Z,ft=y*a.joint._basisX1X+V*a.joint._basisX1Y+M*a.joint._basisX1Z,Wa=I*a.joint._basisX1X+k*a.joint._basisX1Y+X*a.joint._basisX1Z,L=da,m=ft,g=Wa,C=a.xX,B=a.xY,Z=a.xZ,$=a.yX,K=a.yY,E=a.yZ;var Ha=C*L+B*m+Z*g;if(Ha<-.999999999){var bt,it,Ka,_t=C,gt=B,pt=Z,Ga=_t*_t,rt=gt*gt,xt=pt*pt,Da;Ga<rt?Ga<xt?(Da=1/Math.sqrt(rt+xt),bt=0,it=pt*Da,Ka=-gt*Da):(Da=1/Math.sqrt(Ga+rt),bt=gt*Da,it=-_t*Da,Ka=0):rt<xt?(Da=1/Math.sqrt(xt+Ga),bt=-pt*Da,it=0,Ka=_t*Da):(Da=1/Math.sqrt(Ga+rt),bt=gt*Da,it=-_t*Da,Ka=0),x=bt,b=it,f=Ka,n=0}else{var Ta,Na,Vt;Ta=B*g-Z*m,Na=Z*L-C*g,Vt=C*m-B*L;var Pt=Math.sqrt((1+Ha)*.5);Ha=.5/Pt,Ta*=Ha,Na*=Ha,Vt*=Ha,x=Ta,b=Na,f=Vt,n=Pt}var st=x,Xt=b,Yt=f,Mt=n,Ia=2*st,O=2*Xt,Va=2*Yt,lt=st*Ia,P=Xt*O,wt=Yt*Va,At=st*O,dt=Xt*Va,yt=st*Va,kt=Mt*Ia,mt=Mt*O,ht=Mt*Va;c=1-P-wt,z=At-ht,p=yt+mt,y=At+ht,V=1-lt-wt,M=dt-kt,I=yt-mt,k=dt+kt,X=1-lt-P;var ut,Qa,et;if(ut=c*$+z*K+p*E,Qa=y*$+V*K+M*E,et=I*$+k*K+X*E,N=ut,d=Qa,F=et,S=m*F-g*d,Y=g*N-L*F,Q=L*d-m*N,S*S+Y*Y+Q*Q>1e-6){var Ca=S*S+Y*Y+Q*Q;Ca>0&&(Ca=1/Math.sqrt(Ca)),S*=Ca,Y*=Ca,Q*=Ca}else{var vt=L,qa=m,at=g,Ua=vt*vt,tt=qa*qa,ct=at*at,Sa;Ua<tt?Ua<ct?(Sa=1/Math.sqrt(tt+ct),S=0,Y=at*Sa,Q=-qa*Sa):(Sa=1/Math.sqrt(Ua+tt),S=qa*Sa,Y=-vt*Sa,Q=0):tt<ct?(Sa=1/Math.sqrt(ct+Ua),S=-at*Sa,Y=0,Q=vt*Sa):(Sa=1/Math.sqrt(Ua+tt),S=qa*Sa,Y=-vt*Sa,Q=0)}N=Y*g-Q*m,d=Q*L-S*g,F=S*m-Y*L,a.xX=L,a.xY=m,a.xZ=g,a.yX=N,a.yY=d,a.yZ=F,a.zX=S,a.zY=Y,a.zZ=Q;var Ja,ja,La;Ja=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,ja=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,La=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;var ot=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,It=ot<=-1?3.14159265358979:ot>=1?0:Math.acos(ot),oi=Ja*Ja+ja*ja+La*La;oi>0&&(oi=1/Math.sqrt(oi)),Ja*=oi,ja*=oi,La*=oi,Ja*=It,ja*=It,La*=It,this.angularErrorY=Ja*this._basis.yX+ja*this._basis.yY+La*this._basis.yZ,this.angularErrorZ=Ja*this._basis.zX+ja*this._basis.zY+La*this._basis.zZ;var gi,ai,Ct;gi=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,ai=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,Ct=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,ot=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=ot<=-1?3.14159265358979:ot>=1?0:Math.acos(ot),gi*this._basis.xX+ai*this._basis.xY+Ct*this._basis.xZ<0&&(this.angle=-this.angle),this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxis1(){var a=new u.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxis2(){var a=new u.common.Vec3,t=a;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,a}getAxis1To(a){var t=a;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(a){var t=a;t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){var a=new u.common.Vec3,t=a;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,a}getLocalAxis2(){var a=new u.common.Vec3,t=a;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,a}getLocalAxis1To(a){var t=a;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(a){var t=a;t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getAngle(){return this.angle}};u.dynamics.constraint.joint.RevoluteJointConfig=class extends u.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new u.common.Vec3(1,0,0),this.localAxis2=new u.common.Vec3(1,0,0),this.springDamper=new u.dynamics.constraint.joint.SpringDamper,this.limitMotor=new u.dynamics.constraint.joint.RotationalLimitMotor}init(a,t,i,o){this._init(a,t,i);var r,e,_,h=o;r=h.x,e=h.y,_=h.z;var v,s,l;v=a._transform._rotation00*r+a._transform._rotation10*e+a._transform._rotation20*_,s=a._transform._rotation01*r+a._transform._rotation11*e+a._transform._rotation21*_,l=a._transform._rotation02*r+a._transform._rotation12*e+a._transform._rotation22*_,r=v,e=s,_=l;var x=this.localAxis1;x.x=r,x.y=e,x.z=_;var b,f,n,c=o;b=c.x,f=c.y,n=c.z;var z,p,y;z=t._transform._rotation00*b+t._transform._rotation10*f+t._transform._rotation20*n,p=t._transform._rotation01*b+t._transform._rotation11*f+t._transform._rotation21*n,y=t._transform._rotation02*b+t._transform._rotation12*f+t._transform._rotation22*n,b=z,f=p,n=y;var V=this.localAxis2;return V.x=b,V.y=f,V.z=n,this}};u.dynamics.constraint.joint.RotationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorTorque=0}setLimits(a,t){return this.lowerLimit=a,this.upperLimit=t,this}setMotor(a,t){return this.motorSpeed=a,this.motorTorque=t,this}clone(){var a=new u.dynamics.constraint.joint.RotationalLimitMotor;return a.lowerLimit=this.lowerLimit,a.upperLimit=this.upperLimit,a.motorSpeed=this.motorSpeed,a.motorTorque=this.motorTorque,a}};u.dynamics.constraint.joint.SphericalJoint=class extends u.dynamics.constraint.joint.Joint{constructor(a){super(a,0),this._sd=a.springDamper.clone()}getInfo(a,t,i){if(!(this._sd.frequency>0&&i)){var o,r,e;o=this._anchor2X-this._anchor1X,r=this._anchor2Y-this._anchor1Y,e=this._anchor2Z-this._anchor1Z;var _,h;if(this._sd.frequency>0){var v=6.28318530717958*this._sd.frequency,s=this._sd.dampingRatio;s<u.common.Setting.minSpringDamperDampingRatio&&(s=u.common.Setting.minSpringDamperDampingRatio);var l=t.dt,x=2*s*v,b=v*v;this._sd.useSymplecticEuler?(_=1/(l*x),h=b/x):(_=1/(l*(l*b+x)),h=b/(l*b+x)),_*=this._b1._invMass+this._b2._invMass}else _=0,h=this.getErp(t,i);var f,n,c;f=o*h,n=r*h,c=e*h;var z=f,p=n,y=c,V,M,I,k,X,L,m,g,N,d,F,S,Y,Q,C,B,Z,$;V=0,M=-this._relativeAnchor1Z,I=this._relativeAnchor1Y,k=this._relativeAnchor1Z,X=0,L=-this._relativeAnchor1X,m=-this._relativeAnchor1Y,g=this._relativeAnchor1X,N=0,d=0,F=-this._relativeAnchor2Z,S=this._relativeAnchor2Y,Y=this._relativeAnchor2Z,Q=0,C=-this._relativeAnchor2X,B=-this._relativeAnchor2Y,Z=this._relativeAnchor2X,$=0,V=-V,M=-M,I=-I,k=-k,X=-X,L=-L,m=-m,g=-g,N=-N,d=-d,F=-F,S=-S,Y=-Y,Q=-Q,C=-C,B=-B,Z=-Z,$=-$;var K=this._impulses[0],E=a.rows[a.numRows++],J=E.jacobian;J.lin1X=0,J.lin1Y=0,J.lin1Z=0,J.lin2X=0,J.lin2Y=0,J.lin2Z=0,J.ang1X=0,J.ang1Y=0,J.ang1Z=0,J.ang2X=0,J.ang2Y=0,J.ang2Z=0,E.rhs=0,E.cfm=0,E.minImpulse=0,E.maxImpulse=0,E.motorSpeed=0,E.motorMaxImpulse=0,E.impulse=null,E.impulse=K;var A=E;A.rhs=z,A.cfm=_,A.minImpulse=-1/0,A.maxImpulse=1/0;var R=A.jacobian;R.lin1X=1,R.lin1Y=0,R.lin1Z=0,R.lin2X=1,R.lin2Y=0,R.lin2Z=0,R.ang1X=V,R.ang1Y=M,R.ang1Z=I,R.ang2X=d,R.ang2Y=F,R.ang2Z=S;var U=this._impulses[1],G=a.rows[a.numRows++],D=G.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,G.rhs=0,G.cfm=0,G.minImpulse=0,G.maxImpulse=0,G.motorSpeed=0,G.motorMaxImpulse=0,G.impulse=null,G.impulse=U,A=G,A.rhs=p,A.cfm=_,A.minImpulse=-1/0,A.maxImpulse=1/0,R=A.jacobian,R.lin1X=0,R.lin1Y=1,R.lin1Z=0,R.lin2X=0,R.lin2Y=1,R.lin2Z=0,R.ang1X=k,R.ang1Y=X,R.ang1Z=L,R.ang2X=Y,R.ang2Y=Q,R.ang2Z=C;var H=this._impulses[2],j=a.rows[a.numRows++],ia=j.jacobian;ia.lin1X=0,ia.lin1Y=0,ia.lin1Z=0,ia.lin2X=0,ia.lin2Y=0,ia.lin2Z=0,ia.ang1X=0,ia.ang1Y=0,ia.ang1Z=0,ia.ang2X=0,ia.ang2Y=0,ia.ang2Z=0,j.rhs=0,j.cfm=0,j.minImpulse=0,j.maxImpulse=0,j.motorSpeed=0,j.motorMaxImpulse=0,j.impulse=null,j.impulse=H,A=j,A.rhs=y,A.cfm=_,A.minImpulse=-1/0,A.maxImpulse=1/0,R=A.jacobian,R.lin1X=0,R.lin1Y=0,R.lin1Z=1,R.lin2X=0,R.lin2Y=0,R.lin2Z=1,R.ang1X=m,R.ang1Y=g,R.ang1Z=N,R.ang2X=B,R.ang2Y=Z,R.ang2Z=$}}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getSpringDamper(){return this._sd}};u.dynamics.constraint.joint.SphericalJointConfig=class extends u.dynamics.constraint.joint.JointConfig{constructor(){super(),this.springDamper=new u.dynamics.constraint.joint.SpringDamper}init(a,t,i){return this._init(a,t,i),this}};u.dynamics.constraint.joint.SpringDamper=class{constructor(){this.frequency=0,this.dampingRatio=0,this.useSymplecticEuler=!1}setSpring(a,t){return this.frequency=a,this.dampingRatio=t,this}setSymplecticEuler(a){return this.useSymplecticEuler=a,this}clone(){var a=new u.dynamics.constraint.joint.SpringDamper;return a.frequency=this.frequency,a.dampingRatio=this.dampingRatio,a.useSymplecticEuler=this.useSymplecticEuler,a}};u.dynamics.constraint.joint.TranslationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorForce=0}setLimits(a,t){return this.lowerLimit=a,this.upperLimit=t,this}setMotor(a,t){return this.motorSpeed=a,this.motorForce=t,this}clone(){var a=new u.dynamics.constraint.joint.TranslationalLimitMotor;return a.lowerLimit=this.lowerLimit,a.upperLimit=this.upperLimit,a.motorSpeed=this.motorSpeed,a.motorForce=this.motorForce,a}};u.dynamics.constraint.joint.UniversalJoint=class extends u.dynamics.constraint.joint.Joint{constructor(a){super(a,u.dynamics.constraint.joint.JointType.UNIVERSAL);var t=a.localAxis1;this._localBasisX1X=t.x,this._localBasisX1Y=t.y,this._localBasisX1Z=t.z;var i=a.localAxis2;this._localBasisZ2X=i.x,this._localBasisZ2Y=i.y,this._localBasisZ2Z=i.z,this.buildLocalBasesFromX1Z2(),this._angleX=0,this._angleY=0,this._angleZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._sd1=a.springDamper1.clone(),this._sd2=a.springDamper2.clone(),this._lm1=a.limitMotor1.clone(),this._lm2=a.limitMotor2.clone()}getInfo(a,t,i){var o=this.getErp(t,i),r,e,_;r=this.linearErrorX*o,e=this.linearErrorY*o,_=this.linearErrorZ*o;var h=r,v=e,s=_,l=this._angleY*o,x,b,f,n,c,z,p,y,V,M,I,k,X,L,m,g,N,d;x=0,b=-this._relativeAnchor1Z,f=this._relativeAnchor1Y,n=this._relativeAnchor1Z,c=0,z=-this._relativeAnchor1X,p=-this._relativeAnchor1Y,y=this._relativeAnchor1X,V=0,M=0,I=-this._relativeAnchor2Z,k=this._relativeAnchor2Y,X=this._relativeAnchor2Z,L=0,m=-this._relativeAnchor2X,g=-this._relativeAnchor2Y,N=this._relativeAnchor2X,d=0,x=-x,b=-b,f=-f,n=-n,c=-c,z=-z,p=-p,y=-y,V=-V,M=-M,I=-I,k=-k,X=-X,L=-L,m=-m,g=-g,N=-N,d=-d;var F=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),S=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ),Y=this._impulses[0],Q=a.rows[a.numRows++],C=Q.jacobian;C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,Q.rhs=0,Q.cfm=0,Q.minImpulse=0,Q.maxImpulse=0,Q.motorSpeed=0,Q.motorMaxImpulse=0,Q.impulse=null,Q.impulse=Y;var B=Q;B.rhs=h,B.cfm=0,B.minImpulse=-1/0,B.maxImpulse=1/0;var Z=B.jacobian;Z.lin1X=1,Z.lin1Y=0,Z.lin1Z=0,Z.lin2X=1,Z.lin2Y=0,Z.lin2Z=0,Z.ang1X=x,Z.ang1Y=b,Z.ang1Z=f,Z.ang2X=M,Z.ang2Y=I,Z.ang2Z=k;var $=this._impulses[1],K=a.rows[a.numRows++],E=K.jacobian;E.lin1X=0,E.lin1Y=0,E.lin1Z=0,E.lin2X=0,E.lin2Y=0,E.lin2Z=0,E.ang1X=0,E.ang1Y=0,E.ang1Z=0,E.ang2X=0,E.ang2Y=0,E.ang2Z=0,K.rhs=0,K.cfm=0,K.minImpulse=0,K.maxImpulse=0,K.motorSpeed=0,K.motorMaxImpulse=0,K.impulse=null,K.impulse=$,B=K,B.rhs=v,B.cfm=0,B.minImpulse=-1/0,B.maxImpulse=1/0,Z=B.jacobian,Z.lin1X=0,Z.lin1Y=1,Z.lin1Z=0,Z.lin2X=0,Z.lin2Y=1,Z.lin2Z=0,Z.ang1X=n,Z.ang1Y=c,Z.ang1Z=z,Z.ang2X=X,Z.ang2Y=L,Z.ang2Z=m;var J=this._impulses[2],A=a.rows[a.numRows++],R=A.jacobian;if(R.lin1X=0,R.lin1Y=0,R.lin1Z=0,R.lin2X=0,R.lin2Y=0,R.lin2Z=0,R.ang1X=0,R.ang1Y=0,R.ang1Z=0,R.ang2X=0,R.ang2Y=0,R.ang2Z=0,A.rhs=0,A.cfm=0,A.minImpulse=0,A.maxImpulse=0,A.motorSpeed=0,A.motorMaxImpulse=0,A.impulse=null,A.impulse=J,B=A,B.rhs=s,B.cfm=0,B.minImpulse=-1/0,B.maxImpulse=1/0,Z=B.jacobian,Z.lin1X=0,Z.lin1Y=0,Z.lin1Z=1,Z.lin2X=0,Z.lin2Y=0,Z.lin2Z=1,Z.ang1X=p,Z.ang1Y=y,Z.ang1Z=V,Z.ang2X=g,Z.ang2Y=N,Z.ang2Z=d,!this.xSingular&&(this._sd1.frequency<=0||!i)){var U=this._impulses[3],G=a.rows[a.numRows++],D=G.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,G.rhs=0,G.cfm=0,G.minImpulse=0,G.maxImpulse=0,G.motorSpeed=0,G.motorMaxImpulse=0,G.impulse=null,G.impulse=U,B=G,this.setSolverInfoRowAngular(B,this._angleX,this._lm1,F,this._sd1,t,i),Z=B.jacobian,Z.ang1X=this._axisXX,Z.ang1Y=this._axisXY,Z.ang1Z=this._axisXZ,Z.ang2X=this._axisXX,Z.ang2Y=this._axisXY,Z.ang2Z=this._axisXZ}if(!this.ySingular){var H=this._impulses[4],j=a.rows[a.numRows++],ia=j.jacobian;ia.lin1X=0,ia.lin1Y=0,ia.lin1Z=0,ia.lin2X=0,ia.lin2Y=0,ia.lin2Z=0,ia.ang1X=0,ia.ang1Y=0,ia.ang1Z=0,ia.ang2X=0,ia.ang2Y=0,ia.ang2Z=0,j.rhs=0,j.cfm=0,j.minImpulse=0,j.maxImpulse=0,j.motorSpeed=0,j.motorMaxImpulse=0,j.impulse=null,j.impulse=H,B=j,B.rhs=l,B.cfm=0,B.minImpulse=-1/0,B.maxImpulse=1/0,Z=B.jacobian,Z.ang1X=this._axisYX,Z.ang1Y=this._axisYY,Z.ang1Z=this._axisYZ,Z.ang2X=this._axisYX,Z.ang2Y=this._axisYY,Z.ang2Z=this._axisYZ}if(!this.zSingular&&(this._sd2.frequency<=0||!i)){var ea=this._impulses[5],W=a.rows[a.numRows++],q=W.jacobian;q.lin1X=0,q.lin1Y=0,q.lin1Z=0,q.lin2X=0,q.lin2Y=0,q.lin2Z=0,q.ang1X=0,q.ang1Y=0,q.ang1Z=0,q.ang2X=0,q.ang2Y=0,q.ang2Z=0,W.rhs=0,W.cfm=0,W.minImpulse=0,W.maxImpulse=0,W.motorSpeed=0,W.motorMaxImpulse=0,W.impulse=null,W.impulse=ea,B=W,this.setSolverInfoRowAngular(B,this._angleZ,this._lm2,S,this._sd2,t,i),Z=B.jacobian,Z.ang1X=this._axisZX,Z.ang1Y=this._axisZY,Z.ang1Z=this._axisZZ,Z.ang2X=this._axisZX,Z.ang2Y=this._axisZY,Z.ang2Z=this._axisZZ}}_syncAnchors(){super._syncAnchors(),this._basisX1X,this._basisY1X,this._basisZ1X,this._basisX1Y,this._basisY1Y,this._basisZ1Y,this._basisX1Z,this._basisY1Z,this._basisZ1Z,this._basisX2X,this._basisY2X,this._basisZ2X,this._basisX2Y,this._basisY2Y,this._basisZ2Y,this._basisX2Z,this._basisY2Z,this._basisZ2Z;var a,t,i,o,r,e,_,h,v;a=this._basisX1X,t=this._basisX1Y,i=this._basisX1Z,_=this._basisZ2X,h=this._basisZ2Y,v=this._basisZ2Z,o=h*i-v*t,r=v*a-_*i,e=_*t-h*a,this._axisXX=r*v-e*h,this._axisXY=e*_-o*v,this._axisXZ=o*h-r*_,this._axisYX=o,this._axisYY=r,this._axisYZ=e,this._axisZX=t*e-i*r,this._axisZY=i*o-a*e,this._axisZZ=a*r-t*o;var s=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;s>0&&(s=1/Math.sqrt(s)),this._axisXX*=s,this._axisXY*=s,this._axisXZ*=s;var l=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;l>0&&(l=1/Math.sqrt(l)),this._axisYX*=l,this._axisYY*=l,this._axisYZ*=l;var x=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;x>0&&(x=1/Math.sqrt(x)),this._axisZX*=x,this._axisZY*=x,this._axisZZ*=x,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0;var b,f,n,c,z,p,y,V,M,I,k,X,L,m,g,N,d,F;b=this._basisX1X,f=this._basisY1X,n=this._basisZ1X,c=this._basisX1Y,z=this._basisY1Y,p=this._basisZ1Y,y=this._basisX1Z,V=this._basisY1Z,M=this._basisZ1Z,I=this._basisX2X,k=this._basisY2X,X=this._basisZ2X,L=this._basisX2Y,m=this._basisY2Y,g=this._basisZ2Y,N=this._basisX2Z,d=this._basisY2Z,F=this._basisZ2Z;var S,Y,Q,C,B,Z,$,K,E,J,A,R,U,G;K=b*I+c*L+y*N,E=b*k+c*m+y*d,J=b*X+c*g+y*F,A=f*k+z*m+V*d,R=f*X+z*g+V*F,U=n*k+p*m+M*d,G=n*X+p*g+M*F,S=K,Y=E,Q=J,C=A,B=R,Z=U,$=G;var D,H,j,ia=Q;if(ia<=-1){var ea=Math.atan2(Z,C);D=ea*.5,H=-1.570796326794895,j=-ea*.5}else if(ia>=1){var W=Math.atan2(Z,C);D=W*.5,H=1.570796326794895,j=W*.5}else{var q=Math.asin(ia),na=Math.atan2(-B,$),oa=Math.atan2(-Y,S);D=na,H=q,j=oa}this._angleX=D,this._angleY=H,this._angleZ=j,this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(a,t){super._getVelocitySolverInfo(a,t),this.getInfo(t,a,!1)}_getPositionSolverInfo(a){super._getPositionSolverInfo(a),this.getInfo(a,null,!0)}getAxis1(){var a=new u.common.Vec3,t=a;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,a}getAxis2(){var a=new u.common.Vec3,t=a;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,a}getAxis1To(a){var t=a;t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(a){var t=a;t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z}getLocalAxis1(){var a=new u.common.Vec3,t=a;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,a}getLocalAxis2(){var a=new u.common.Vec3,t=a;return t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z,a}getLocalAxis1To(a){var t=a;t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(a){var t=a;t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z}getSpringDamper1(){return this._sd1}getSpringDamper2(){return this._sd2}getLimitMotor1(){return this._lm1}getLimitMotor2(){return this._lm2}getAngle1(){return this._angleX}getAngle2(){return this._angleZ}};u.dynamics.constraint.joint.UniversalJointConfig=class extends u.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new u.common.Vec3(1,0,0),this.localAxis2=new u.common.Vec3(1,0,0),this.springDamper1=new u.dynamics.constraint.joint.SpringDamper,this.springDamper2=new u.dynamics.constraint.joint.SpringDamper,this.limitMotor1=new u.dynamics.constraint.joint.RotationalLimitMotor,this.limitMotor2=new u.dynamics.constraint.joint.RotationalLimitMotor}init(a,t,i,o,r){this._init(a,t,i);var e,_,h,v=o;e=v.x,_=v.y,h=v.z;var s,l,x;s=a._transform._rotation00*e+a._transform._rotation10*_+a._transform._rotation20*h,l=a._transform._rotation01*e+a._transform._rotation11*_+a._transform._rotation21*h,x=a._transform._rotation02*e+a._transform._rotation12*_+a._transform._rotation22*h,e=s,_=l,h=x;var b=this.localAxis1;b.x=e,b.y=_,b.z=h;var f,n,c,z=r;f=z.x,n=z.y,c=z.z;var p,y,V;p=t._transform._rotation00*f+t._transform._rotation10*n+t._transform._rotation20*c,y=t._transform._rotation01*f+t._transform._rotation11*n+t._transform._rotation21*c,V=t._transform._rotation02*f+t._transform._rotation12*n+t._transform._rotation22*c,f=p,n=y,c=V;var M=this.localAxis2;return M.x=f,M.y=n,M.z=c,this}};u.dynamics.constraint.solver||(u.dynamics.constraint.solver={});u.dynamics.constraint.solver.ConstraintSolverType=class{};u.dynamics.constraint.solver.common||(u.dynamics.constraint.solver.common={});u.dynamics.constraint.solver.common.ContactSolverMassDataRow=class{constructor(){this.invMLinN1X=0,this.invMLinN1Y=0,this.invMLinN1Z=0,this.invMLinN2X=0,this.invMLinN2Y=0,this.invMLinN2Z=0,this.invMAngN1X=0,this.invMAngN1Y=0,this.invMAngN1Z=0,this.invMAngN2X=0,this.invMAngN2Y=0,this.invMAngN2Z=0,this.invMLinT1X=0,this.invMLinT1Y=0,this.invMLinT1Z=0,this.invMLinT2X=0,this.invMLinT2Y=0,this.invMLinT2Z=0,this.invMAngT1X=0,this.invMAngT1Y=0,this.invMAngT1Z=0,this.invMAngT2X=0,this.invMAngT2Y=0,this.invMAngT2Z=0,this.invMLinB1X=0,this.invMLinB1Y=0,this.invMLinB1Z=0,this.invMLinB2X=0,this.invMLinB2Y=0,this.invMLinB2Z=0,this.invMAngB1X=0,this.invMAngB1Y=0,this.invMAngB1Z=0,this.invMAngB2X=0,this.invMAngB2Y=0,this.invMAngB2Z=0,this.massN=0,this.massTB00=0,this.massTB01=0,this.massTB10=0,this.massTB11=0}};u.dynamics.constraint.solver.common.JointSolverMassDataRow=class{constructor(){this.invMLin1X=0,this.invMLin1Y=0,this.invMLin1Z=0,this.invMLin2X=0,this.invMLin2Y=0,this.invMLin2Z=0,this.invMAng1X=0,this.invMAng1Y=0,this.invMAng1Z=0,this.invMAng2X=0,this.invMAng2Y=0,this.invMAng2Z=0,this.mass=0,this.massWithoutCfm=0}};u.dynamics.constraint.solver.direct||(u.dynamics.constraint.solver.direct={});u.dynamics.constraint.solver.direct.Boundary=class{constructor(a){var t=new Array(a);this.iBounded=t;var i=new Array(a);this.iUnbounded=i;var o=new Array(a);this.signs=o;var r=new Array(a);this.b=r,this.numBounded=0,this.numUnbounded=0,this.matrixId=0}init(a){this.numBounded=a.numBounded;for(var t=0,i=this.numBounded;t<i;){var o=t++;this.iBounded[o]=a.iBounded[o],this.signs[o]=a.signs[o]}this.numUnbounded=a.numUnbounded,this.matrixId=0;for(var r=0,e=this.numUnbounded;r<e;){var _=r++,h=a.iUnbounded[_];this.iUnbounded[_]=h,this.matrixId|=1<<h}}computeImpulses(a,t,i,o,r,e,_){for(var h=0,v=this.numUnbounded;h<v;){var s=h++,l=this.iUnbounded[s],x=a.rows[l],b=i[l];this.b[l]=x.rhs*e-b-x.cfm*o[l]}for(var f=t._invMassWithoutCfm,n=0,c=this.numBounded;n<c;){var z=n++,p=this.iBounded[z],y=this.signs[z],V=a.rows[p],M=o[p],I=y<0?V.minImpulse:y>0?V.maxImpulse:0,k=I-M;if(r[p]=k,k!=0)for(var X=0,L=this.numUnbounded;X<L;){var m=X++,g=this.iUnbounded[m],N=f[p][g]*k,d=g,F=this.b;F[d]=F[d]-N}}for(var S=this.iUnbounded,Y=this.numUnbounded,Q=0,C=0,B=Y;C<B;){var Z=C++;Q|=1<<S[Z]}var $;t._cacheComputed[Q]||(t.computeSubmatrix(Q,S,Y),t._cacheComputed[Q]=!0),$=t._cachedSubmatrices[Q];for(var K=!0,E=0,J=this.numUnbounded;E<J;){for(var A=E++,R=this.iUnbounded[A],U=a.rows[R],G=o[R],D=G,H=0,j=this.numUnbounded;H<j;){var ia=H++,ea=this.iUnbounded[ia];D+=this.b[ea]*$[A][ia]}if(D<U.minImpulse-u.common.Setting.directMlcpSolverEps||D>U.maxImpulse+u.common.Setting.directMlcpSolverEps){K=!1;break}r[R]=D-G}if(_)return!0;if(!K)return!1;for(var W=0,q=this.numBounded;W<q;){for(var na=W++,oa=this.iBounded[na],aa=a.rows[oa],T=this.signs[na],ca=0,_a=o[oa]+r[oa],w=i[oa],ta=0,ra=a.numRows;ta<ra;){var la=ta++;w+=f[oa][la]*r[la]}if(ca=aa.rhs*e-w-aa.cfm*_a,T<0&&ca>u.common.Setting.directMlcpSolverEps||T>0&&ca<-u.common.Setting.directMlcpSolverEps){K=!1;break}}return K}};u.dynamics.constraint.solver.direct.BoundaryBuildInfo=class{constructor(a){this.size=a,this.numBounded=0;var t=new Array(a);this.iBounded=t;var i=new Array(a);this.signs=i,this.numUnbounded=0;var o=new Array(a);this.iUnbounded=o}};u.dynamics.constraint.solver.direct.BoundaryBuilder=class{constructor(a){this.maxRows=a,this.numBoundaries=0;var t=new Array(1<<a);this.boundaries=t,this.bbInfo=new u.dynamics.constraint.solver.direct.BoundaryBuildInfo(a)}buildBoundariesRecursive(a,t){if(t==a.numRows){this.boundaries[this.numBoundaries]==null&&(this.boundaries[this.numBoundaries]=new u.dynamics.constraint.solver.direct.Boundary(this.maxRows)),this.boundaries[this.numBoundaries++].init(this.bbInfo);return}var i=a.rows[t],o=i.minImpulse>-1/0,r=i.maxImpulse<1/0,e=i.minImpulse==0&&i.maxImpulse==0;if(e){var _=this.bbInfo;_.iBounded[_.numBounded]=t,_.signs[_.numBounded]=0,_.numBounded++,this.buildBoundariesRecursive(a,t+1),this.bbInfo.numBounded--;return}var h=this.bbInfo;if(h.iUnbounded[h.numUnbounded]=t,h.numUnbounded++,this.buildBoundariesRecursive(a,t+1),this.bbInfo.numUnbounded--,o){var v=this.bbInfo;v.iBounded[v.numBounded]=t,v.signs[v.numBounded]=-1,v.numBounded++,this.buildBoundariesRecursive(a,t+1),this.bbInfo.numBounded--}if(r){var s=this.bbInfo;s.iBounded[s.numBounded]=t,s.signs[s.numBounded]=1,s.numBounded++,this.buildBoundariesRecursive(a,t+1),this.bbInfo.numBounded--}}buildBoundaries(a){this.numBoundaries=0;var t=this.bbInfo;t.numBounded=0,t.numUnbounded=0,this.buildBoundariesRecursive(a,0)}};u.dynamics.constraint.solver.direct.BoundarySelector=class{constructor(a){this.n=a;var t=new Array(a);this.indices=t;var i=new Array(a);this.tmpIndices=i;for(var o=0,r=a;o<r;){var e=o++;this.indices[e]=e}}getIndex(a){return this.indices[a]}select(a){for(var t=0;this.indices[t]!=a;)++t;for(;t>0;){var i=this.indices[t];this.indices[t]=this.indices[t-1],this.indices[t-1]=i,--t}}setSize(a){for(var t=0,i=0,o=0,r=this.n;o<r;){var e=o++,_=this.indices[e];_<a?(this.tmpIndices[t]=_,++t):(this.tmpIndices[a+i]=_,++i)}var h=this.indices;this.indices=this.tmpIndices,this.tmpIndices=h}};u.dynamics.constraint.solver.direct.DirectJointConstraintSolver=class extends u.dynamics.constraint.ConstraintSolver{constructor(a){super(),this.joint=a,this.info=new u.dynamics.constraint.info.joint.JointSolverInfo;var t=u.common.Setting.maxJacobianRows;this.massMatrix=new u.dynamics.constraint.solver.direct.MassMatrix(t),this.boundaryBuilder=new u.dynamics.constraint.solver.direct.BoundaryBuilder(t);var i=new Array(t);this.massData=i;for(var o=0,r=this.massData.length;o<r;){var e=o++;this.massData[e]=new u.dynamics.constraint.solver.common.JointSolverMassDataRow}var _=this.boundaryBuilder.boundaries.length;this.velBoundarySelector=new u.dynamics.constraint.solver.direct.BoundarySelector(_),this.posBoundarySelector=new u.dynamics.constraint.solver.direct.BoundarySelector(_);var h=new Array(t);this.relVels=h;var v=new Array(t);this.impulses=v;var s=new Array(t);this.dImpulses=s;var l=new Array(t);this.dTotalImpulses=l;for(var x=0,b=t;x<b;){var f=x++;this.relVels[f]=0,this.impulses[f]=0,this.dImpulses[f]=0,this.dTotalImpulses[f]=0}}preSolveVelocity(a){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(a,this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var t=this.boundaryBuilder;t.numBoundaries=0;var i=t.bbInfo;i.numBounded=0,i.numUnbounded=0,t.buildBoundariesRecursive(this.info,0);for(var o=this.velBoundarySelector,r=this.boundaryBuilder.numBoundaries,e=0,_=0,h=0,v=o.n;h<v;){var s=h++,l=o.indices[s];l<r?(o.tmpIndices[e]=l,++e):(o.tmpIndices[r+_]=l,++_)}var x=o.indices;o.indices=o.tmpIndices,o.tmpIndices=x}warmStart(a){var t=this.joint._positionCorrectionAlgorithm==u.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?u.common.Setting.jointWarmStartingFactorForBaungarte:u.common.Setting.jointWarmStartingFactor;if(t*=a.dtRatio,t<=0){for(var i=0,o=this.info.numRows;i<o;){var r=i++,e=this.info.rows[r],_=e.impulse;_.impulse=0,_.impulseM=0,_.impulseP=0}return}for(var h=0,v=this.info.numRows;h<v;){var s=h++,l=this.info.rows[s],x=l.impulse,b=x.impulse*t;if(b<l.minImpulse?b=l.minImpulse:b>l.maxImpulse&&(b=l.maxImpulse),x.impulse=b,l.motorMaxImpulse>0){var f=x.impulseM*t,n=l.motorMaxImpulse;f<-n?f=-n:f>n&&(f=n),x.impulseM=f}else x.impulseM=0;this.dImpulses[s]=x.impulse+x.impulseM}var c=this.dImpulses,z=!1,p=!1,y,V,M,I,k,X,L,m,g,N,d,F;y=this._b1._velX,V=this._b1._velY,M=this._b1._velZ,I=this._b2._velX,k=this._b2._velY,X=this._b2._velZ,L=this._b1._angVelX,m=this._b1._angVelY,g=this._b1._angVelZ,N=this._b2._angVelX,d=this._b2._angVelY,F=this._b2._angVelZ;for(var S=0,Y=this.info.numRows;S<Y;){var Q=S++,C=this.info.rows[Q],B=C.jacobian,Z=this.massData[Q],$=c[Q];B.flag&1&&(y+=Z.invMLin1X*$,V+=Z.invMLin1Y*$,M+=Z.invMLin1Z*$,I+=Z.invMLin2X*-$,k+=Z.invMLin2Y*-$,X+=Z.invMLin2Z*-$,z=!0),B.flag&2&&(L+=Z.invMAng1X*$,m+=Z.invMAng1Y*$,g+=Z.invMAng1Z*$,N+=Z.invMAng2X*-$,d+=Z.invMAng2Y*-$,F+=Z.invMAng2Z*-$,p=!0)}z&&(this._b1._velX=y,this._b1._velY=V,this._b1._velZ=M,this._b2._velX=I,this._b2._velY=k,this._b2._velZ=X),p&&(this._b1._angVelX=L,this._b1._angVelY=m,this._b1._angVelZ=g,this._b2._angVelX=N,this._b2._angVelY=d,this._b2._angVelZ=F)}solveVelocity(){var a=this.info.numRows,t,i,o,r,e,_,h,v,s,l,x,b;t=this._b1._velX,i=this._b1._velY,o=this._b1._velZ,r=this._b2._velX,e=this._b2._velY,_=this._b2._velZ,h=this._b1._angVelX,v=this._b1._angVelY,s=this._b1._angVelZ,l=this._b2._angVelX,x=this._b2._angVelY,b=this._b2._angVelZ;for(var f=0,n=a;f<n;){var c=f++,z=this.info.rows[c],p=z.impulse,y=z.jacobian,V=0;V+=t*y.lin1X+i*y.lin1Y+o*y.lin1Z,V-=r*y.lin2X+e*y.lin2Y+_*y.lin2Z,V+=h*y.ang1X+v*y.ang1Y+s*y.ang1Z,V-=l*y.ang2X+x*y.ang2Y+b*y.ang2Z,this.relVels[c]=V,this.impulses[c]=p.impulse,this.dTotalImpulses[c]=0}for(var M=this.massMatrix._invMassWithoutCfm,I=0,k=a;I<k;){var X=I++,L=this.info.rows[X],m=L.impulse,g=this.massData[X];if(L.motorMaxImpulse>0){var N=m.impulseM,d=N+g.massWithoutCfm*(-L.motorSpeed-this.relVels[X]),F=L.motorMaxImpulse;d<-F?d=-F:d>F&&(d=F),m.impulseM=d;var S=d-N;this.dTotalImpulses[X]=S;for(var Y=0,Q=a;Y<Q;){var C=Y++,B=C,Z=this.relVels;Z[B]=Z[B]+S*M[X][C]}}}for(var $=!1,K=0,E=this.boundaryBuilder.numBoundaries;K<E;){var J=K++,A=this.velBoundarySelector.indices[J],R=this.boundaryBuilder.boundaries[A];if(R.computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,1,!1)){for(var U=0,G=a;U<G;){var D=U++,H=this.info.rows[D],j=H.impulse,ia=this.dImpulses[D];j.impulse+=ia;var ea=D,W=this.dTotalImpulses;W[ea]=W[ea]+ia}var q=this.dTotalImpulses,na=!1,oa=!1,aa,T,ca,_a,w,ta,ra,la,va,ua,za,Ma;aa=this._b1._velX,T=this._b1._velY,ca=this._b1._velZ,_a=this._b2._velX,w=this._b2._velY,ta=this._b2._velZ,ra=this._b1._angVelX,la=this._b1._angVelY,va=this._b1._angVelZ,ua=this._b2._angVelX,za=this._b2._angVelY,Ma=this._b2._angVelZ;for(var Xa=0,Za=this.info.numRows;Xa<Za;){var fa=Xa++,ba=this.info.rows[fa],sa=ba.jacobian,ha=this.massData[fa],ma=q[fa];sa.flag&1&&(aa+=ha.invMLin1X*ma,T+=ha.invMLin1Y*ma,ca+=ha.invMLin1Z*ma,_a+=ha.invMLin2X*-ma,w+=ha.invMLin2Y*-ma,ta+=ha.invMLin2Z*-ma,na=!0),sa.flag&2&&(ra+=ha.invMAng1X*ma,la+=ha.invMAng1Y*ma,va+=ha.invMAng1Z*ma,ua+=ha.invMAng2X*-ma,za+=ha.invMAng2Y*-ma,Ma+=ha.invMAng2Z*-ma,oa=!0)}na&&(this._b1._velX=aa,this._b1._velY=T,this._b1._velZ=ca,this._b2._velX=_a,this._b2._velY=w,this._b2._velZ=ta),oa&&(this._b1._angVelX=ra,this._b1._angVelY=la,this._b1._angVelZ=va,this._b2._angVelX=ua,this._b2._angVelY=za,this._b2._angVelZ=Ma);for(var ya=this.velBoundarySelector,Ba=0;ya.indices[Ba]!=A;)++Ba;for(;Ba>0;){var pa=ya.indices[Ba];ya.indices[Ba]=ya.indices[Ba-1],ya.indices[Ba-1]=pa,--Ba}$=!0;break}}if(!$){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:335:","could not find solution. (velocity)");return}}postSolveVelocity(a){var t,i,o,r,e,_;t=0,i=0,o=0,r=0,e=0,_=0;for(var h=0,v=this.info.numRows;h<v;){var s=h++,l=this.info.rows[s],x=l.impulse,b=l.jacobian;b.flag&1?(t+=b.lin1X*x.impulse,i+=b.lin1Y*x.impulse,o+=b.lin1Z*x.impulse):b.flag&2&&(r+=b.ang1X*x.impulse,e+=b.ang1Y*x.impulse,_+=b.ang1Z*x.impulse)}this.joint._appliedForceX=t*a.invDt,this.joint._appliedForceY=i*a.invDt,this.joint._appliedForceZ=o*a.invDt,this.joint._appliedTorqueX=r*a.invDt,this.joint._appliedTorqueY=e*a.invDt,this.joint._appliedTorqueZ=_*a.invDt}preSolvePosition(a){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var t=this.boundaryBuilder;t.numBoundaries=0;var i=t.bbInfo;i.numBounded=0,i.numUnbounded=0,t.buildBoundariesRecursive(this.info,0);for(var o=this.posBoundarySelector,r=this.boundaryBuilder.numBoundaries,e=0,_=0,h=0,v=o.n;h<v;){var s=h++,l=o.indices[s];l<r?(o.tmpIndices[e]=l,++e):(o.tmpIndices[r+_]=l,++_)}var x=o.indices;o.indices=o.tmpIndices,o.tmpIndices=x;for(var b=0,f=this.info.numRows;b<f;){var n=b++;this.info.rows[n].impulse.impulseP=0}}solvePositionSplitImpulse(){var a=this.info.numRows,t,i,o,r,e,_,h,v,s,l,x,b;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,o=this._b1._pseudoVelZ,r=this._b2._pseudoVelX,e=this._b2._pseudoVelY,_=this._b2._pseudoVelZ,h=this._b1._angPseudoVelX,v=this._b1._angPseudoVelY,s=this._b1._angPseudoVelZ,l=this._b2._angPseudoVelX,x=this._b2._angPseudoVelY,b=this._b2._angPseudoVelZ;for(var f=0,n=a;f<n;){var c=f++,z=this.info.rows[c],p=z.impulse,y=z.jacobian,V=0;V+=t*y.lin1X+i*y.lin1Y+o*y.lin1Z,V-=r*y.lin2X+e*y.lin2Y+_*y.lin2Z,V+=h*y.ang1X+v*y.ang1Y+s*y.ang1Z,V-=l*y.ang2X+x*y.ang2Y+b*y.ang2Z,this.relVels[c]=V,this.impulses[c]=p.impulseP}for(var M=!1,I=0,k=this.boundaryBuilder.numBoundaries;I<k;){var X=I++,L=this.posBoundarySelector.indices[X],m=this.boundaryBuilder.boundaries[L];if(m.computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,u.common.Setting.positionSplitImpulseBaumgarte,!1)){for(var g=0,N=a;g<N;){var d=g++,F=this.info.rows[d],S=F.impulse,Y=this.dImpulses[d];S.impulseP+=Y}var Q=this.dImpulses,C=!1,B=!1,Z,$,K,E,J,A,R,U,G,D,H,j;Z=this._b1._pseudoVelX,$=this._b1._pseudoVelY,K=this._b1._pseudoVelZ,E=this._b2._pseudoVelX,J=this._b2._pseudoVelY,A=this._b2._pseudoVelZ,R=this._b1._angPseudoVelX,U=this._b1._angPseudoVelY,G=this._b1._angPseudoVelZ,D=this._b2._angPseudoVelX,H=this._b2._angPseudoVelY,j=this._b2._angPseudoVelZ;for(var ia=0,ea=this.info.numRows;ia<ea;){var W=ia++,q=this.info.rows[W],na=q.jacobian,oa=this.massData[W],aa=Q[W];na.flag&1&&(Z+=oa.invMLin1X*aa,$+=oa.invMLin1Y*aa,K+=oa.invMLin1Z*aa,E+=oa.invMLin2X*-aa,J+=oa.invMLin2Y*-aa,A+=oa.invMLin2Z*-aa,C=!0),na.flag&2&&(R+=oa.invMAng1X*aa,U+=oa.invMAng1Y*aa,G+=oa.invMAng1Z*aa,D+=oa.invMAng2X*-aa,H+=oa.invMAng2Y*-aa,j+=oa.invMAng2Z*-aa,B=!0)}C&&(this._b1._pseudoVelX=Z,this._b1._pseudoVelY=$,this._b1._pseudoVelZ=K,this._b2._pseudoVelX=E,this._b2._pseudoVelY=J,this._b2._pseudoVelZ=A),B&&(this._b1._angPseudoVelX=R,this._b1._angPseudoVelY=U,this._b1._angPseudoVelZ=G,this._b2._angPseudoVelX=D,this._b2._angPseudoVelY=H,this._b2._angPseudoVelZ=j);for(var T=this.posBoundarySelector,ca=0;T.indices[ca]!=L;)++ca;for(;ca>0;){var _a=T.indices[ca];T.indices[ca]=T.indices[ca-1],T.indices[ca-1]=_a,--ca}M=!0;break}}if(!M){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:450:","could not find solution. (split impulse)");return}}solvePositionNgs(a){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var t=this.boundaryBuilder;t.numBoundaries=0;var i=t.bbInfo;i.numBounded=0,i.numUnbounded=0,t.buildBoundariesRecursive(this.info,0);for(var o=this.posBoundarySelector,r=this.boundaryBuilder.numBoundaries,e=0,_=0,h=0,v=o.n;h<v;){var s=h++,l=o.indices[s];l<r?(o.tmpIndices[e]=l,++e):(o.tmpIndices[r+_]=l,++_)}var x=o.indices;o.indices=o.tmpIndices,o.tmpIndices=x;for(var b=this.info.numRows,f=0,n=b;f<n;){var c=f++,z=this.info.rows[c],p=z.impulse;z.jacobian,this.relVels[c]=0,this.impulses[c]=p.impulseP}for(var y=!1,V=0,M=this.boundaryBuilder.numBoundaries;V<M;){var I=V++,k=this.posBoundarySelector.indices[I],X=this.boundaryBuilder.boundaries[k];if(X.computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,u.common.Setting.positionNgsBaumgarte,!1)){for(var L=0,m=b;L<m;){var g=L++,N=this.info.rows[g],d=N.impulse,F=this.dImpulses[g];d.impulseP+=F}var S=this.dImpulses,Y=!1,Q=!1,C,B,Z,$,K,E,J,A,R,U,G,D;C=0,B=0,Z=0,$=0,K=0,E=0,J=0,A=0,R=0,U=0,G=0,D=0;for(var H=0,j=this.info.numRows;H<j;){var ia=H++,ea=this.info.rows[ia],W=ea.jacobian,q=this.massData[ia],na=S[ia];W.flag&1&&(C+=q.invMLin1X*na,B+=q.invMLin1Y*na,Z+=q.invMLin1Z*na,$+=q.invMLin2X*-na,K+=q.invMLin2Y*-na,E+=q.invMLin2Z*-na,Y=!0),W.flag&2&&(J+=q.invMAng1X*na,A+=q.invMAng1Y*na,R+=q.invMAng1Z*na,U+=q.invMAng2X*-na,G+=q.invMAng2Y*-na,D+=q.invMAng2Z*-na,Q=!0)}if(Y){var oa=this._b1;oa._transform._positionX+=C,oa._transform._positionY+=B,oa._transform._positionZ+=Z;var aa=this._b2;aa._transform._positionX+=$,aa._transform._positionY+=K,aa._transform._positionZ+=E}if(Q){var T=this._b1,ca=Math.sqrt(J*J+A*A+R*R),_a=ca*.5,w,ta;if(_a<.5){var ra=_a*_a;w=.5*(1-ra*.16666666666666666+ra*ra*.008333333333333333),ta=1-ra*.5+ra*ra*.041666666666666664}else w=Math.sin(_a)/ca,ta=Math.cos(_a);var la,va,ua;la=J*w,va=A*w,ua=R*w;var za,Ma,Xa,Za;za=la,Ma=va,Xa=ua,Za=ta;var fa,ba,sa,ha,ma=T._transform._rotation00,ya=T._transform._rotation11,Ba=T._transform._rotation22,pa=ma+ya+Ba,Ya;pa>0?(Ya=Math.sqrt(pa+1),ha=.5*Ya,Ya=.5/Ya,fa=(T._transform._rotation21-T._transform._rotation12)*Ya,ba=(T._transform._rotation02-T._transform._rotation20)*Ya,sa=(T._transform._rotation10-T._transform._rotation01)*Ya):ma>ya?ma>Ba?(Ya=Math.sqrt(ma-ya-Ba+1),fa=.5*Ya,Ya=.5/Ya,ba=(T._transform._rotation01+T._transform._rotation10)*Ya,sa=(T._transform._rotation02+T._transform._rotation20)*Ya,ha=(T._transform._rotation21-T._transform._rotation12)*Ya):(Ya=Math.sqrt(Ba-ma-ya+1),sa=.5*Ya,Ya=.5/Ya,fa=(T._transform._rotation02+T._transform._rotation20)*Ya,ba=(T._transform._rotation12+T._transform._rotation21)*Ya,ha=(T._transform._rotation10-T._transform._rotation01)*Ya):ya>Ba?(Ya=Math.sqrt(ya-Ba-ma+1),ba=.5*Ya,Ya=.5/Ya,fa=(T._transform._rotation01+T._transform._rotation10)*Ya,sa=(T._transform._rotation12+T._transform._rotation21)*Ya,ha=(T._transform._rotation02-T._transform._rotation20)*Ya):(Ya=Math.sqrt(Ba-ma-ya+1),sa=.5*Ya,Ya=.5/Ya,fa=(T._transform._rotation02+T._transform._rotation20)*Ya,ba=(T._transform._rotation12+T._transform._rotation21)*Ya,ha=(T._transform._rotation10-T._transform._rotation01)*Ya),fa=Za*fa+za*ha+Ma*sa-Xa*ba,ba=Za*ba-za*sa+Ma*ha+Xa*fa,sa=Za*sa+za*ba-Ma*fa+Xa*ha,ha=Za*ha-za*fa-Ma*ba-Xa*sa;var Ra=fa*fa+ba*ba+sa*sa+ha*ha;Ra>1e-32&&(Ra=1/Math.sqrt(Ra)),fa*=Ra,ba*=Ra,sa*=Ra,ha*=Ra;var ga=fa,xa=ba,wa=sa,ka=ha,Pa=2*ga,zt=2*xa,Oa=2*wa,Aa=ga*Pa,nt=xa*zt,Ea=wa*Oa,Fa=ga*zt,da=xa*Oa,ft=ga*Oa,Wa=ka*Pa,Ha=ka*zt,bt=ka*Oa;T._transform._rotation00=1-nt-Ea,T._transform._rotation01=Fa-bt,T._transform._rotation02=ft+Ha,T._transform._rotation10=Fa+bt,T._transform._rotation11=1-Aa-Ea,T._transform._rotation12=da-Wa,T._transform._rotation20=ft-Ha,T._transform._rotation21=da+Wa,T._transform._rotation22=1-Aa-nt;var it,Ka,_t,gt,pt,Ga,rt,xt,Da;it=T._transform._rotation00*T._invLocalInertia00+T._transform._rotation01*T._invLocalInertia10+T._transform._rotation02*T._invLocalInertia20,Ka=T._transform._rotation00*T._invLocalInertia01+T._transform._rotation01*T._invLocalInertia11+T._transform._rotation02*T._invLocalInertia21,_t=T._transform._rotation00*T._invLocalInertia02+T._transform._rotation01*T._invLocalInertia12+T._transform._rotation02*T._invLocalInertia22,gt=T._transform._rotation10*T._invLocalInertia00+T._transform._rotation11*T._invLocalInertia10+T._transform._rotation12*T._invLocalInertia20,pt=T._transform._rotation10*T._invLocalInertia01+T._transform._rotation11*T._invLocalInertia11+T._transform._rotation12*T._invLocalInertia21,Ga=T._transform._rotation10*T._invLocalInertia02+T._transform._rotation11*T._invLocalInertia12+T._transform._rotation12*T._invLocalInertia22,rt=T._transform._rotation20*T._invLocalInertia00+T._transform._rotation21*T._invLocalInertia10+T._transform._rotation22*T._invLocalInertia20,xt=T._transform._rotation20*T._invLocalInertia01+T._transform._rotation21*T._invLocalInertia11+T._transform._rotation22*T._invLocalInertia21,Da=T._transform._rotation20*T._invLocalInertia02+T._transform._rotation21*T._invLocalInertia12+T._transform._rotation22*T._invLocalInertia22,T._invInertia00=it,T._invInertia01=Ka,T._invInertia02=_t,T._invInertia10=gt,T._invInertia11=pt,T._invInertia12=Ga,T._invInertia20=rt,T._invInertia21=xt,T._invInertia22=Da;var Ta,Na,Vt,Pt,st,Xt,Yt,Mt,Ia;Ta=T._invInertia00*T._transform._rotation00+T._invInertia01*T._transform._rotation01+T._invInertia02*T._transform._rotation02,Na=T._invInertia00*T._transform._rotation10+T._invInertia01*T._transform._rotation11+T._invInertia02*T._transform._rotation12,Vt=T._invInertia00*T._transform._rotation20+T._invInertia01*T._transform._rotation21+T._invInertia02*T._transform._rotation22,Pt=T._invInertia10*T._transform._rotation00+T._invInertia11*T._transform._rotation01+T._invInertia12*T._transform._rotation02,st=T._invInertia10*T._transform._rotation10+T._invInertia11*T._transform._rotation11+T._invInertia12*T._transform._rotation12,Xt=T._invInertia10*T._transform._rotation20+T._invInertia11*T._transform._rotation21+T._invInertia12*T._transform._rotation22,Yt=T._invInertia20*T._transform._rotation00+T._invInertia21*T._transform._rotation01+T._invInertia22*T._transform._rotation02,Mt=T._invInertia20*T._transform._rotation10+T._invInertia21*T._transform._rotation11+T._invInertia22*T._transform._rotation12,Ia=T._invInertia20*T._transform._rotation20+T._invInertia21*T._transform._rotation21+T._invInertia22*T._transform._rotation22,T._invInertia00=Ta,T._invInertia01=Na,T._invInertia02=Vt,T._invInertia10=Pt,T._invInertia11=st,T._invInertia12=Xt,T._invInertia20=Yt,T._invInertia21=Mt,T._invInertia22=Ia,T._invInertia00*=T._rotFactor.x,T._invInertia01*=T._rotFactor.x,T._invInertia02*=T._rotFactor.x,T._invInertia10*=T._rotFactor.y,T._invInertia11*=T._rotFactor.y,T._invInertia12*=T._rotFactor.y,T._invInertia20*=T._rotFactor.z,T._invInertia21*=T._rotFactor.z,T._invInertia22*=T._rotFactor.z;var O=this._b2,Va=Math.sqrt(U*U+G*G+D*D),lt=Va*.5,P,wt;if(lt<.5){var At=lt*lt;P=.5*(1-At*.16666666666666666+At*At*.008333333333333333),wt=1-At*.5+At*At*.041666666666666664}else P=Math.sin(lt)/Va,wt=Math.cos(lt);var dt,yt,kt;dt=U*P,yt=G*P,kt=D*P;var mt,ht,ut,Qa;mt=dt,ht=yt,ut=kt,Qa=wt;var et,Ca,vt,qa,at=O._transform._rotation00,Ua=O._transform._rotation11,tt=O._transform._rotation22,ct=at+Ua+tt,Sa;ct>0?(Sa=Math.sqrt(ct+1),qa=.5*Sa,Sa=.5/Sa,et=(O._transform._rotation21-O._transform._rotation12)*Sa,Ca=(O._transform._rotation02-O._transform._rotation20)*Sa,vt=(O._transform._rotation10-O._transform._rotation01)*Sa):at>Ua?at>tt?(Sa=Math.sqrt(at-Ua-tt+1),et=.5*Sa,Sa=.5/Sa,Ca=(O._transform._rotation01+O._transform._rotation10)*Sa,vt=(O._transform._rotation02+O._transform._rotation20)*Sa,qa=(O._transform._rotation21-O._transform._rotation12)*Sa):(Sa=Math.sqrt(tt-at-Ua+1),vt=.5*Sa,Sa=.5/Sa,et=(O._transform._rotation02+O._transform._rotation20)*Sa,Ca=(O._transform._rotation12+O._transform._rotation21)*Sa,qa=(O._transform._rotation10-O._transform._rotation01)*Sa):Ua>tt?(Sa=Math.sqrt(Ua-tt-at+1),Ca=.5*Sa,Sa=.5/Sa,et=(O._transform._rotation01+O._transform._rotation10)*Sa,vt=(O._transform._rotation12+O._transform._rotation21)*Sa,qa=(O._transform._rotation02-O._transform._rotation20)*Sa):(Sa=Math.sqrt(tt-at-Ua+1),vt=.5*Sa,Sa=.5/Sa,et=(O._transform._rotation02+O._transform._rotation20)*Sa,Ca=(O._transform._rotation12+O._transform._rotation21)*Sa,qa=(O._transform._rotation10-O._transform._rotation01)*Sa),et=Qa*et+mt*qa+ht*vt-ut*Ca,Ca=Qa*Ca-mt*vt+ht*qa+ut*et,vt=Qa*vt+mt*Ca-ht*et+ut*qa,qa=Qa*qa-mt*et-ht*Ca-ut*vt;var Ja=et*et+Ca*Ca+vt*vt+qa*qa;Ja>1e-32&&(Ja=1/Math.sqrt(Ja)),et*=Ja,Ca*=Ja,vt*=Ja,qa*=Ja;var ja=et,La=Ca,ot=vt,It=qa,oi=2*ja,gi=2*La,ai=2*ot,Ct=ja*oi,_i=La*gi,Et=ot*ai,St=ja*gi,Jt=La*ai,Ki=ja*ai,vi=It*oi,li=It*gi,ti=It*ai;O._transform._rotation00=1-_i-Et,O._transform._rotation01=St-ti,O._transform._rotation02=Ki+li,O._transform._rotation10=St+ti,O._transform._rotation11=1-Ct-Et,O._transform._rotation12=Jt-vi,O._transform._rotation20=Ki-li,O._transform._rotation21=Jt+vi,O._transform._rotation22=1-Ct-_i;var Oi,Xi,zi,Zt,ri,Wt,ni,$i,Ut;Oi=O._transform._rotation00*O._invLocalInertia00+O._transform._rotation01*O._invLocalInertia10+O._transform._rotation02*O._invLocalInertia20,Xi=O._transform._rotation00*O._invLocalInertia01+O._transform._rotation01*O._invLocalInertia11+O._transform._rotation02*O._invLocalInertia21,zi=O._transform._rotation00*O._invLocalInertia02+O._transform._rotation01*O._invLocalInertia12+O._transform._rotation02*O._invLocalInertia22,Zt=O._transform._rotation10*O._invLocalInertia00+O._transform._rotation11*O._invLocalInertia10+O._transform._rotation12*O._invLocalInertia20,ri=O._transform._rotation10*O._invLocalInertia01+O._transform._rotation11*O._invLocalInertia11+O._transform._rotation12*O._invLocalInertia21,Wt=O._transform._rotation10*O._invLocalInertia02+O._transform._rotation11*O._invLocalInertia12+O._transform._rotation12*O._invLocalInertia22,ni=O._transform._rotation20*O._invLocalInertia00+O._transform._rotation21*O._invLocalInertia10+O._transform._rotation22*O._invLocalInertia20,$i=O._transform._rotation20*O._invLocalInertia01+O._transform._rotation21*O._invLocalInertia11+O._transform._rotation22*O._invLocalInertia21,Ut=O._transform._rotation20*O._invLocalInertia02+O._transform._rotation21*O._invLocalInertia12+O._transform._rotation22*O._invLocalInertia22,O._invInertia00=Oi,O._invInertia01=Xi,O._invInertia02=zi,O._invInertia10=Zt,O._invInertia11=ri,O._invInertia12=Wt,O._invInertia20=ni,O._invInertia21=$i,O._invInertia22=Ut;var ji,Ii,pr,Wi,Lt,jt,Tt,bi,Mi;ji=O._invInertia00*O._transform._rotation00+O._invInertia01*O._transform._rotation01+O._invInertia02*O._transform._rotation02,Ii=O._invInertia00*O._transform._rotation10+O._invInertia01*O._transform._rotation11+O._invInertia02*O._transform._rotation12,pr=O._invInertia00*O._transform._rotation20+O._invInertia01*O._transform._rotation21+O._invInertia02*O._transform._rotation22,Wi=O._invInertia10*O._transform._rotation00+O._invInertia11*O._transform._rotation01+O._invInertia12*O._transform._rotation02,Lt=O._invInertia10*O._transform._rotation10+O._invInertia11*O._transform._rotation11+O._invInertia12*O._transform._rotation12,jt=O._invInertia10*O._transform._rotation20+O._invInertia11*O._transform._rotation21+O._invInertia12*O._transform._rotation22,Tt=O._invInertia20*O._transform._rotation00+O._invInertia21*O._transform._rotation01+O._invInertia22*O._transform._rotation02,bi=O._invInertia20*O._transform._rotation10+O._invInertia21*O._transform._rotation11+O._invInertia22*O._transform._rotation12,Mi=O._invInertia20*O._transform._rotation20+O._invInertia21*O._transform._rotation21+O._invInertia22*O._transform._rotation22,O._invInertia00=ji,O._invInertia01=Ii,O._invInertia02=pr,O._invInertia10=Wi,O._invInertia11=Lt,O._invInertia12=jt,O._invInertia20=Tt,O._invInertia21=bi,O._invInertia22=Mi,O._invInertia00*=O._rotFactor.x,O._invInertia01*=O._rotFactor.x,O._invInertia02*=O._rotFactor.x,O._invInertia10*=O._rotFactor.y,O._invInertia11*=O._rotFactor.y,O._invInertia12*=O._rotFactor.y,O._invInertia20*=O._rotFactor.z,O._invInertia21*=O._rotFactor.z,O._invInertia22*=O._rotFactor.z}for(var vr=this.posBoundarySelector,qt=0;vr.indices[qt]!=k;)++qt;for(;qt>0;){var fi=vr.indices[qt];vr.indices[qt]=vr.indices[qt-1],vr.indices[qt-1]=fi,--qt}y=!0;break}}if(!y){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:502:","could not find solution. (NGS)");return}}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}};u.dynamics.constraint.solver.direct.MassMatrix=class{constructor(a){this._size=a;var t=new Array(this._size);this.tmpMatrix=t;var i=new Array(this._size);this._invMass=i;var o=new Array(this._size);this._invMassWithoutCfm=o;for(var r=0,e=this._size;r<e;){var _=r++,h=this.tmpMatrix,v=new Array(this._size);h[_]=v;var s=this._invMass,l=new Array(this._size);s[_]=l;var x=this._invMassWithoutCfm,b=new Array(this._size);x[_]=b;for(var f=0,n=this._size;f<n;){var c=f++;this.tmpMatrix[_][c]=0,this._invMass[_][c]=0,this._invMassWithoutCfm[_][c]=0}}this._maxSubmatrixId=1<<this._size;var z=new Array(this._maxSubmatrixId);this._cacheComputed=z;var p=new Array(this._maxSubmatrixId);this._cachedSubmatrices=p;for(var y=0,V=this._maxSubmatrixId;y<V;){var M=y++,I=M;I=(I&85)+(I>>1&85),I=(I&51)+(I>>2&51),I=(I&15)+(I>>4&15);for(var k=I,X=new Array(k),L=X,m=0,g=k;m<g;){var N=m++,d=new Array(k);L[N]=d;for(var F=0,S=k;F<S;){var Y=F++;L[N][Y]=0}}this._cacheComputed[M]=!1,this._cachedSubmatrices[M]=L}}computeSubmatrix(a,t,i){for(var o=0,r=i;o<r;)for(var e=o++,_=t[e],h=0,v=i;h<v;){var s=h++;this.tmpMatrix[e][s]=this._invMass[_][t[s]]}var l=this.tmpMatrix,x=this._cachedSubmatrices[a],b,f,n,c,z;switch(i){case 4:b=l[0],f=x[0],z=1/b[0],f[0]=z,b[1]=b[1]*z,b[2]=b[2]*z,b[3]=b[3]*z,n=l[1],c=x[1],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n=l[2],c=x[2],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n=l[3],c=x[3],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],b=l[1],f=x[1],z=1/b[1],f[1]=z,f[0]=f[0]*z,b[2]=b[2]*z,b[3]=b[3]*z,n=l[0],c=x[0],c[0]=c[0]-f[0]*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n=l[2],c=x[2],c[0]=c[0]-f[0]*n[1],c[1]=-z*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n=l[3],c=x[3],c[0]=c[0]-f[0]*n[1],c[1]=-z*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],b=l[2],f=x[2],z=1/b[2],f[2]=z,f[0]=f[0]*z,f[1]=f[1]*z,b[3]=b[3]*z,n=l[0],c=x[0],c[0]=c[0]-f[0]*n[2],n[3]=n[3]-b[3]*n[2],n=l[1],c=x[1],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],n[3]=n[3]-b[3]*n[2],n=l[3],c=x[3],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-z*n[2],n[3]=n[3]-b[3]*n[2],b=l[3],f=x[3],z=1/b[3],f[3]=z,f[0]=f[0]*z,f[1]=f[1]*z,f[2]=f[2]*z,n=l[0],c=x[0],c[0]=c[0]-f[0]*n[3],n=l[1],c=x[1],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],n=l[2],c=x[2],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],f=x[1],x[0][1]=f[0],f=x[2],x[0][2]=f[0],x[1][2]=f[1],f=x[3],x[0][3]=f[0],x[1][3]=f[1],x[2][3]=f[2];break;case 5:b=l[0],f=x[0],z=1/b[0],f[0]=z,b[1]=b[1]*z,b[2]=b[2]*z,b[3]=b[3]*z,b[4]=b[4]*z,n=l[1],c=x[1],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n=l[2],c=x[2],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n=l[3],c=x[3],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n=l[4],c=x[4],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],b=l[1],f=x[1],z=1/b[1],f[1]=z,f[0]=f[0]*z,b[2]=b[2]*z,b[3]=b[3]*z,b[4]=b[4]*z,n=l[0],c=x[0],c[0]=c[0]-f[0]*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n=l[2],c=x[2],c[0]=c[0]-f[0]*n[1],c[1]=-z*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n=l[3],c=x[3],c[0]=c[0]-f[0]*n[1],c[1]=-z*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n=l[4],c=x[4],c[0]=c[0]-f[0]*n[1],c[1]=-z*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],b=l[2],f=x[2],z=1/b[2],f[2]=z,f[0]=f[0]*z,f[1]=f[1]*z,b[3]=b[3]*z,b[4]=b[4]*z,n=l[0],c=x[0],c[0]=c[0]-f[0]*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n=l[1],c=x[1],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n=l[3],c=x[3],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-z*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n=l[4],c=x[4],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-z*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],b=l[3],f=x[3],z=1/b[3],f[3]=z,f[0]=f[0]*z,f[1]=f[1]*z,f[2]=f[2]*z,b[4]=b[4]*z,n=l[0],c=x[0],c[0]=c[0]-f[0]*n[3],n[4]=n[4]-b[4]*n[3],n=l[1],c=x[1],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],n[4]=n[4]-b[4]*n[3],n=l[2],c=x[2],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],n[4]=n[4]-b[4]*n[3],n=l[4],c=x[4],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],c[3]=-z*n[3],n[4]=n[4]-b[4]*n[3],b=l[4],f=x[4],z=1/b[4],f[4]=z,f[0]=f[0]*z,f[1]=f[1]*z,f[2]=f[2]*z,f[3]=f[3]*z,n=l[0],c=x[0],c[0]=c[0]-f[0]*n[4],n=l[1],c=x[1],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],n=l[2],c=x[2],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],c[2]=c[2]-f[2]*n[4],n=l[3],c=x[3],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],c[2]=c[2]-f[2]*n[4],c[3]=c[3]-f[3]*n[4],f=x[1],x[0][1]=f[0],f=x[2],x[0][2]=f[0],x[1][2]=f[1],f=x[3],x[0][3]=f[0],x[1][3]=f[1],x[2][3]=f[2],f=x[4],x[0][4]=f[0],x[1][4]=f[1],x[2][4]=f[2],x[3][4]=f[3];break;case 6:b=l[0],f=x[0],z=1/b[0],f[0]=z,b[1]=b[1]*z,b[2]=b[2]*z,b[3]=b[3]*z,b[4]=b[4]*z,b[5]=b[5]*z,n=l[1],c=x[1],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n[5]=n[5]-b[5]*n[0],n=l[2],c=x[2],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n[5]=n[5]-b[5]*n[0],n=l[3],c=x[3],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n[5]=n[5]-b[5]*n[0],n=l[4],c=x[4],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n[5]=n[5]-b[5]*n[0],n=l[5],c=x[5],c[0]=-z*n[0],n[1]=n[1]-b[1]*n[0],n[2]=n[2]-b[2]*n[0],n[3]=n[3]-b[3]*n[0],n[4]=n[4]-b[4]*n[0],n[5]=n[5]-b[5]*n[0],b=l[1],f=x[1],z=1/b[1],f[1]=z,f[0]=f[0]*z,b[2]=b[2]*z,b[3]=b[3]*z,b[4]=b[4]*z,b[5]=b[5]*z,n=l[0],c=x[0],c[0]=c[0]-f[0]*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n[5]=n[5]-b[5]*n[1],n=l[2],c=x[2],c[0]=c[0]-f[0]*n[1],c[1]=-z*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n[5]=n[5]-b[5]*n[1],n=l[3],c=x[3],c[0]=c[0]-f[0]*n[1],c[1]=-z*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n[5]=n[5]-b[5]*n[1],n=l[4],c=x[4],c[0]=c[0]-f[0]*n[1],c[1]=-z*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n[5]=n[5]-b[5]*n[1],n=l[5],c=x[5],c[0]=c[0]-f[0]*n[1],c[1]=-z*n[1],n[2]=n[2]-b[2]*n[1],n[3]=n[3]-b[3]*n[1],n[4]=n[4]-b[4]*n[1],n[5]=n[5]-b[5]*n[1],b=l[2],f=x[2],z=1/b[2],f[2]=z,f[0]=f[0]*z,f[1]=f[1]*z,b[3]=b[3]*z,b[4]=b[4]*z,b[5]=b[5]*z,n=l[0],c=x[0],c[0]=c[0]-f[0]*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n[5]=n[5]-b[5]*n[2],n=l[1],c=x[1],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n[5]=n[5]-b[5]*n[2],n=l[3],c=x[3],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-z*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n[5]=n[5]-b[5]*n[2],n=l[4],c=x[4],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-z*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n[5]=n[5]-b[5]*n[2],n=l[5],c=x[5],c[0]=c[0]-f[0]*n[2],c[1]=c[1]-f[1]*n[2],c[2]=-z*n[2],n[3]=n[3]-b[3]*n[2],n[4]=n[4]-b[4]*n[2],n[5]=n[5]-b[5]*n[2],b=l[3],f=x[3],z=1/b[3],f[3]=z,f[0]=f[0]*z,f[1]=f[1]*z,f[2]=f[2]*z,b[4]=b[4]*z,b[5]=b[5]*z,n=l[0],c=x[0],c[0]=c[0]-f[0]*n[3],n[4]=n[4]-b[4]*n[3],n[5]=n[5]-b[5]*n[3],n=l[1],c=x[1],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],n[4]=n[4]-b[4]*n[3],n[5]=n[5]-b[5]*n[3],n=l[2],c=x[2],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],n[4]=n[4]-b[4]*n[3],n[5]=n[5]-b[5]*n[3],n=l[4],c=x[4],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],c[3]=-z*n[3],n[4]=n[4]-b[4]*n[3],n[5]=n[5]-b[5]*n[3],n=l[5],c=x[5],c[0]=c[0]-f[0]*n[3],c[1]=c[1]-f[1]*n[3],c[2]=c[2]-f[2]*n[3],c[3]=-z*n[3],n[4]=n[4]-b[4]*n[3],n[5]=n[5]-b[5]*n[3],b=l[4],f=x[4],z=1/b[4],f[4]=z,f[0]=f[0]*z,f[1]=f[1]*z,f[2]=f[2]*z,f[3]=f[3]*z,b[5]=b[5]*z,n=l[0],c=x[0],c[0]=c[0]-f[0]*n[4],n[5]=n[5]-b[5]*n[4],n=l[1],c=x[1],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],n[5]=n[5]-b[5]*n[4],n=l[2],c=x[2],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],c[2]=c[2]-f[2]*n[4],n[5]=n[5]-b[5]*n[4],n=l[3],c=x[3],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],c[2]=c[2]-f[2]*n[4],c[3]=c[3]-f[3]*n[4],n[5]=n[5]-b[5]*n[4],n=l[5],c=x[5],c[0]=c[0]-f[0]*n[4],c[1]=c[1]-f[1]*n[4],c[2]=c[2]-f[2]*n[4],c[3]=c[3]-f[3]*n[4],c[4]=-z*n[4],n[5]=n[5]-b[5]*n[4],b=l[5],f=x[5],z=1/b[5],f[5]=z,f[0]=f[0]*z,f[1]=f[1]*z,f[2]=f[2]*z,f[3]=f[3]*z,f[4]=f[4]*z,n=l[0],c=x[0],c[0]=c[0]-f[0]*n[5],n=l[1],c=x[1],c[0]=c[0]-f[0]*n[5],c[1]=c[1]-f[1]*n[5],n=l[2],c=x[2],c[0]=c[0]-f[0]*n[5],c[1]=c[1]-f[1]*n[5],c[2]=c[2]-f[2]*n[5],n=l[3],c=x[3],c[0]=c[0]-f[0]*n[5],c[1]=c[1]-f[1]*n[5],c[2]=c[2]-f[2]*n[5],c[3]=c[3]-f[3]*n[5],n=l[4],c=x[4],c[0]=c[0]-f[0]*n[5],c[1]=c[1]-f[1]*n[5],c[2]=c[2]-f[2]*n[5],c[3]=c[3]-f[3]*n[5],c[4]=c[4]-f[4]*n[5],f=x[1],x[0][1]=f[0],f=x[2],x[0][2]=f[0],x[1][2]=f[1],f=x[3],x[0][3]=f[0],x[1][3]=f[1],x[2][3]=f[2],f=x[4],x[0][4]=f[0],x[1][4]=f[1],x[2][4]=f[2],x[3][4]=f[3],f=x[5],x[0][5]=f[0],x[1][5]=f[1],x[2][5]=f[2],x[3][5]=f[3],x[4][5]=f[4];break;default:for(var p=0,y=i;p<y;){var V=p++;b=l[V],f=x[V];var M=1/b[V];f[V]=M;for(var I=0,k=V;I<k;){var X=I++;f[X]=f[X]*M}for(var L=V+1,m=i;L<m;){var g=L++;b[g]=b[g]*M}for(var N=0,d=V;N<d;){var F=N++;n=l[F],c=x[F];for(var S=0,Y=F+1;S<Y;){var Q=S++;c[Q]=c[Q]-f[Q]*n[V]}for(var C=V+1,B=i;C<B;){var Z=C++;n[Z]=n[Z]-b[Z]*n[V]}}for(var $=V+1,K=i;$<K;){var E=$++;n=l[E],c=x[E];for(var J=0,A=V;J<A;){var R=J++;c[R]=c[R]-f[R]*n[V]}c[V]=-M*n[V];for(var U=V+1,G=i;U<G;){var D=U++;n[D]=n[D]-b[D]*n[V]}}}for(var H=1,j=i;H<j;){var ia=H++;f=x[ia];for(var ea=0,W=ia;ea<W;){var q=ea++;x[q][ia]=f[q]}}}}computeInvMass(a,t){var i=this._invMass,o=this._invMassWithoutCfm,r=a.numRows,e=a.b1,_=a.b2,h=e._invMass,v=_._invMass,s,l,x,b,f,n,c,z,p,y,V,M,I,k,X,L,m,g;s=e._invInertia00,l=e._invInertia01,x=e._invInertia02,b=e._invInertia10,f=e._invInertia11,n=e._invInertia12,c=e._invInertia20,z=e._invInertia21,p=e._invInertia22,y=_._invInertia00,V=_._invInertia01,M=_._invInertia02,I=_._invInertia10,k=_._invInertia11,X=_._invInertia12,L=_._invInertia20,m=_._invInertia21,g=_._invInertia22;for(var N=0,d=r;N<d;){var F=N++,S=a.rows[F].jacobian,Y=t[F];if(S.updateSparsity(),S.flag&1?(Y.invMLin1X=S.lin1X*h,Y.invMLin1Y=S.lin1Y*h,Y.invMLin1Z=S.lin1Z*h,Y.invMLin2X=S.lin2X*v,Y.invMLin2Y=S.lin2Y*v,Y.invMLin2Z=S.lin2Z*v):(Y.invMLin1X=0,Y.invMLin1Y=0,Y.invMLin1Z=0,Y.invMLin2X=0,Y.invMLin2Y=0,Y.invMLin2Z=0),S.flag&2){var Q,C,B;Q=s*S.ang1X+l*S.ang1Y+x*S.ang1Z,C=b*S.ang1X+f*S.ang1Y+n*S.ang1Z,B=c*S.ang1X+z*S.ang1Y+p*S.ang1Z,Y.invMAng1X=Q,Y.invMAng1Y=C,Y.invMAng1Z=B;var Z,$,K;Z=y*S.ang2X+V*S.ang2Y+M*S.ang2Z,$=I*S.ang2X+k*S.ang2Y+X*S.ang2Z,K=L*S.ang2X+m*S.ang2Y+g*S.ang2Z,Y.invMAng2X=Z,Y.invMAng2Y=$,Y.invMAng2Z=K}else Y.invMAng1X=0,Y.invMAng1Y=0,Y.invMAng1Z=0,Y.invMAng2X=0,Y.invMAng2Y=0,Y.invMAng2Z=0}for(var E=0,J=r;E<J;)for(var A=E++,R=a.rows[A].jacobian,U=A,G=r;U<G;){var D=U++;a.rows[D].jacobian;var H=t[D],j=R.lin1X*H.invMLin1X+R.lin1Y*H.invMLin1Y+R.lin1Z*H.invMLin1Z+(R.ang1X*H.invMAng1X+R.ang1Y*H.invMAng1Y+R.ang1Z*H.invMAng1Z)+(R.lin2X*H.invMLin2X+R.lin2Y*H.invMLin2Y+R.lin2Z*H.invMLin2Z)+(R.ang2X*H.invMAng2X+R.ang2Y*H.invMAng2Y+R.ang2Z*H.invMAng2Z);A==D?(i[A][D]=j+a.rows[A].cfm,o[A][D]=j,H.mass=j+a.rows[A].cfm,H.massWithoutCfm=j,H.mass!=0&&(H.mass=1/H.mass),H.massWithoutCfm!=0&&(H.massWithoutCfm=1/H.massWithoutCfm)):(i[A][D]=j,i[D][A]=j,o[A][D]=j,o[D][A]=j)}for(var ia=0,ea=this._maxSubmatrixId;ia<ea;){var W=ia++;this._cacheComputed[W]=!1}}};u.dynamics.constraint.solver.pgs||(u.dynamics.constraint.solver.pgs={});u.dynamics.constraint.solver.pgs.PgsContactConstraintSolver=class extends u.dynamics.constraint.ConstraintSolver{constructor(a){super(),this.constraint=a,this.info=new u.dynamics.constraint.info.contact.ContactSolverInfo;var t=new Array(u.common.Setting.maxManifoldPoints);this.massData=t;for(var i=0,o=this.massData.length;i<o;){var r=i++;this.massData[r]=new u.dynamics.constraint.solver.common.ContactSolverMassDataRow}}preSolveVelocity(a){this.constraint._getVelocitySolverInfo(a,this.info),this._b1=this.info.b1,this._b2=this.info.b2;var t=this._b1._invMass,i=this._b2._invMass,o,r,e,_,h,v,s,l,x,b,f,n,c,z,p,y,V,M;o=this._b1._invInertia00,r=this._b1._invInertia01,e=this._b1._invInertia02,_=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,s=this._b1._invInertia20,l=this._b1._invInertia21,x=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,z=this._b2._invInertia11,p=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,M=this._b2._invInertia22;for(var I=0,k=this.info.numRows;I<k;){var X=I++,L=this.info.rows[X],m=this.massData[X],g=L.jacobianN;m.invMLinN1X=g.lin1X*t,m.invMLinN1Y=g.lin1Y*t,m.invMLinN1Z=g.lin1Z*t,m.invMLinN2X=g.lin2X*i,m.invMLinN2Y=g.lin2Y*i,m.invMLinN2Z=g.lin2Z*i;var N,d,F;N=o*g.ang1X+r*g.ang1Y+e*g.ang1Z,d=_*g.ang1X+h*g.ang1Y+v*g.ang1Z,F=s*g.ang1X+l*g.ang1Y+x*g.ang1Z,m.invMAngN1X=N,m.invMAngN1Y=d,m.invMAngN1Z=F;var S,Y,Q;S=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+z*g.ang2Y+p*g.ang2Z,Q=y*g.ang2X+V*g.ang2Y+M*g.ang2Z,m.invMAngN2X=S,m.invMAngN2Y=Y,m.invMAngN2Z=Q,m.massN=t+i+(m.invMAngN1X*g.ang1X+m.invMAngN1Y*g.ang1Y+m.invMAngN1Z*g.ang1Z)+(m.invMAngN2X*g.ang2X+m.invMAngN2Y*g.ang2Y+m.invMAngN2Z*g.ang2Z),m.massN!=0&&(m.massN=1/m.massN);var C=L.jacobianT,B=L.jacobianB;m.invMLinT1X=C.lin1X*t,m.invMLinT1Y=C.lin1Y*t,m.invMLinT1Z=C.lin1Z*t,m.invMLinT2X=C.lin2X*i,m.invMLinT2Y=C.lin2Y*i,m.invMLinT2Z=C.lin2Z*i,m.invMLinB1X=B.lin1X*t,m.invMLinB1Y=B.lin1Y*t,m.invMLinB1Z=B.lin1Z*t,m.invMLinB2X=B.lin2X*i,m.invMLinB2Y=B.lin2Y*i,m.invMLinB2Z=B.lin2Z*i;var Z,$,K;Z=o*C.ang1X+r*C.ang1Y+e*C.ang1Z,$=_*C.ang1X+h*C.ang1Y+v*C.ang1Z,K=s*C.ang1X+l*C.ang1Y+x*C.ang1Z,m.invMAngT1X=Z,m.invMAngT1Y=$,m.invMAngT1Z=K;var E,J,A;E=b*C.ang2X+f*C.ang2Y+n*C.ang2Z,J=c*C.ang2X+z*C.ang2Y+p*C.ang2Z,A=y*C.ang2X+V*C.ang2Y+M*C.ang2Z,m.invMAngT2X=E,m.invMAngT2Y=J,m.invMAngT2Z=A;var R,U,G;R=o*B.ang1X+r*B.ang1Y+e*B.ang1Z,U=_*B.ang1X+h*B.ang1Y+v*B.ang1Z,G=s*B.ang1X+l*B.ang1Y+x*B.ang1Z,m.invMAngB1X=R,m.invMAngB1Y=U,m.invMAngB1Z=G;var D,H,j;D=b*B.ang2X+f*B.ang2Y+n*B.ang2Z,H=c*B.ang2X+z*B.ang2Y+p*B.ang2Z,j=y*B.ang2X+V*B.ang2Y+M*B.ang2Z,m.invMAngB2X=D,m.invMAngB2Y=H,m.invMAngB2Z=j;var ia=t+i+(m.invMAngT1X*C.ang1X+m.invMAngT1Y*C.ang1Y+m.invMAngT1Z*C.ang1Z)+(m.invMAngT2X*C.ang2X+m.invMAngT2Y*C.ang2Y+m.invMAngT2Z*C.ang2Z),ea=m.invMAngT1X*B.ang1X+m.invMAngT1Y*B.ang1Y+m.invMAngT1Z*B.ang1Z+(m.invMAngT2X*B.ang2X+m.invMAngT2Y*B.ang2Y+m.invMAngT2Z*B.ang2Z),W=ea,q=t+i+(m.invMAngB1X*B.ang1X+m.invMAngB1Y*B.ang1Y+m.invMAngB1Z*B.ang1Z)+(m.invMAngB2X*B.ang2X+m.invMAngB2Y*B.ang2Y+m.invMAngB2Z*B.ang2Z),na=ia*q-ea*W;na!=0&&(na=1/na),m.massTB00=q*na,m.massTB01=-ea*na,m.massTB10=-W*na,m.massTB11=ia*na}}warmStart(a){var t,i,o,r,e,_,h,v,s,l,x,b;t=this._b1._velX,i=this._b1._velY,o=this._b1._velZ,r=this._b2._velX,e=this._b2._velY,_=this._b2._velZ,h=this._b1._angVelX,v=this._b1._angVelY,s=this._b1._angVelZ,l=this._b2._angVelX,x=this._b2._angVelY,b=this._b2._angVelZ;for(var f=0,n=this.info.numRows;f<n;){var c=f++,z=this.info.rows[c],p=z.impulse,y=this.massData[c],V=z.jacobianT,M=z.jacobianB,I=p.impulseN,k=p.impulseLX*V.lin1X+p.impulseLY*V.lin1Y+p.impulseLZ*V.lin1Z,X=p.impulseLX*M.lin1X+p.impulseLY*M.lin1Y+p.impulseLZ*M.lin1Z;p.impulseT=k,p.impulseB=X,p.impulseN*=a.dtRatio,p.impulseT*=a.dtRatio,p.impulseB*=a.dtRatio,t+=y.invMLinN1X*I,i+=y.invMLinN1Y*I,o+=y.invMLinN1Z*I,t+=y.invMLinT1X*k,i+=y.invMLinT1Y*k,o+=y.invMLinT1Z*k,t+=y.invMLinB1X*X,i+=y.invMLinB1Y*X,o+=y.invMLinB1Z*X,r+=y.invMLinN2X*-I,e+=y.invMLinN2Y*-I,_+=y.invMLinN2Z*-I,r+=y.invMLinT2X*-k,e+=y.invMLinT2Y*-k,_+=y.invMLinT2Z*-k,r+=y.invMLinB2X*-X,e+=y.invMLinB2Y*-X,_+=y.invMLinB2Z*-X,h+=y.invMAngN1X*I,v+=y.invMAngN1Y*I,s+=y.invMAngN1Z*I,h+=y.invMAngT1X*k,v+=y.invMAngT1Y*k,s+=y.invMAngT1Z*k,h+=y.invMAngB1X*X,v+=y.invMAngB1Y*X,s+=y.invMAngB1Z*X,l+=y.invMAngN2X*-I,x+=y.invMAngN2Y*-I,b+=y.invMAngN2Z*-I,l+=y.invMAngT2X*-k,x+=y.invMAngT2Y*-k,b+=y.invMAngT2Z*-k,l+=y.invMAngB2X*-X,x+=y.invMAngB2Y*-X,b+=y.invMAngB2Z*-X}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=o,this._b2._velX=r,this._b2._velY=e,this._b2._velZ=_,this._b1._angVelX=h,this._b1._angVelY=v,this._b1._angVelZ=s,this._b2._angVelX=l,this._b2._angVelY=x,this._b2._angVelZ=b}solveVelocity(){var a,t,i,o,r,e,_,h,v,s,l,x;a=this._b1._velX,t=this._b1._velY,i=this._b1._velZ,o=this._b2._velX,r=this._b2._velY,e=this._b2._velZ,_=this._b1._angVelX,h=this._b1._angVelY,v=this._b1._angVelZ,s=this._b2._angVelX,l=this._b2._angVelY,x=this._b2._angVelZ;for(var b=0,f=this.info.numRows;b<f;){var n=b++,c=this.info.rows[n],z=this.massData[n],p=c.impulse,y=0,V=c.jacobianT;y+=a*V.lin1X+t*V.lin1Y+i*V.lin1Z,y-=o*V.lin2X+r*V.lin2Y+e*V.lin2Z,y+=_*V.ang1X+h*V.ang1Y+v*V.ang1Z,y-=s*V.ang2X+l*V.ang2Y+x*V.ang2Z;var M=0;V=c.jacobianB,M+=a*V.lin1X+t*V.lin1Y+i*V.lin1Z,M-=o*V.lin2X+r*V.lin2Y+e*V.lin2Z,M+=_*V.ang1X+h*V.ang1Y+v*V.ang1Z,M-=s*V.ang2X+l*V.ang2Y+x*V.ang2Z;var I=-(y*z.massTB00+M*z.massTB01),k=-(y*z.massTB10+M*z.massTB11),X=p.impulseT,L=p.impulseB;p.impulseT+=I,p.impulseB+=k;var m=c.friction*p.impulseN;if(m==0)p.impulseT=0,p.impulseB=0;else{var g=p.impulseT*p.impulseT+p.impulseB*p.impulseB;if(g>m*m){var N=m/Math.sqrt(g);p.impulseT*=N,p.impulseB*=N}}I=p.impulseT-X,k=p.impulseB-L,a+=z.invMLinT1X*I,t+=z.invMLinT1Y*I,i+=z.invMLinT1Z*I,a+=z.invMLinB1X*k,t+=z.invMLinB1Y*k,i+=z.invMLinB1Z*k,o+=z.invMLinT2X*-I,r+=z.invMLinT2Y*-I,e+=z.invMLinT2Z*-I,o+=z.invMLinB2X*-k,r+=z.invMLinB2Y*-k,e+=z.invMLinB2Z*-k,_+=z.invMAngT1X*I,h+=z.invMAngT1Y*I,v+=z.invMAngT1Z*I,_+=z.invMAngB1X*k,h+=z.invMAngB1Y*k,v+=z.invMAngB1Z*k,s+=z.invMAngT2X*-I,l+=z.invMAngT2Y*-I,x+=z.invMAngT2Z*-I,s+=z.invMAngB2X*-k,l+=z.invMAngB2Y*-k,x+=z.invMAngB2Z*-k}for(var d=0,F=this.info.numRows;d<F;){var S=d++,Y=this.info.rows[S],Q=this.massData[S],C=Y.impulse,B=0,Z=Y.jacobianN;B+=a*Z.lin1X+t*Z.lin1Y+i*Z.lin1Z,B-=o*Z.lin2X+r*Z.lin2Y+e*Z.lin2Z,B+=_*Z.ang1X+h*Z.ang1Y+v*Z.ang1Z,B-=s*Z.ang2X+l*Z.ang2Y+x*Z.ang2Z;var $=(Y.rhs-B)*Q.massN,K=C.impulseN;C.impulseN+=$,C.impulseN<0&&(C.impulseN=0),$=C.impulseN-K,a+=Q.invMLinN1X*$,t+=Q.invMLinN1Y*$,i+=Q.invMLinN1Z*$,o+=Q.invMLinN2X*-$,r+=Q.invMLinN2Y*-$,e+=Q.invMLinN2Z*-$,_+=Q.invMAngN1X*$,h+=Q.invMAngN1Y*$,v+=Q.invMAngN1Z*$,s+=Q.invMAngN2X*-$,l+=Q.invMAngN2Y*-$,x+=Q.invMAngN2Z*-$}this._b1._velX=a,this._b1._velY=t,this._b1._velZ=i,this._b2._velX=o,this._b2._velY=r,this._b2._velZ=e,this._b1._angVelX=_,this._b1._angVelY=h,this._b1._angVelZ=v,this._b2._angVelX=s,this._b2._angVelY=l,this._b2._angVelZ=x}preSolvePosition(a){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);var t=this._b1._invMass,i=this._b2._invMass,o,r,e,_,h,v,s,l,x,b,f,n,c,z,p,y,V,M;o=this._b1._invInertia00,r=this._b1._invInertia01,e=this._b1._invInertia02,_=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,s=this._b1._invInertia20,l=this._b1._invInertia21,x=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,z=this._b2._invInertia11,p=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,M=this._b2._invInertia22;for(var I=0,k=this.info.numRows;I<k;){var X=I++,L=this.info.rows[X],m=this.massData[X],g=L.jacobianN;m.invMLinN1X=g.lin1X*t,m.invMLinN1Y=g.lin1Y*t,m.invMLinN1Z=g.lin1Z*t,m.invMLinN2X=g.lin2X*i,m.invMLinN2Y=g.lin2Y*i,m.invMLinN2Z=g.lin2Z*i;var N,d,F;N=o*g.ang1X+r*g.ang1Y+e*g.ang1Z,d=_*g.ang1X+h*g.ang1Y+v*g.ang1Z,F=s*g.ang1X+l*g.ang1Y+x*g.ang1Z,m.invMAngN1X=N,m.invMAngN1Y=d,m.invMAngN1Z=F;var S,Y,Q;S=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+z*g.ang2Y+p*g.ang2Z,Q=y*g.ang2X+V*g.ang2Y+M*g.ang2Z,m.invMAngN2X=S,m.invMAngN2Y=Y,m.invMAngN2Z=Q,m.massN=t+i+(m.invMAngN1X*g.ang1X+m.invMAngN1Y*g.ang1Y+m.invMAngN1Z*g.ang1Z)+(m.invMAngN2X*g.ang2X+m.invMAngN2Y*g.ang2Y+m.invMAngN2Z*g.ang2Z),m.massN!=0&&(m.massN=1/m.massN)}for(var C=0,B=this.info.numRows;C<B;){var Z=C++;this.info.rows[Z].impulse.impulseP=0}}solvePositionSplitImpulse(){var a,t,i,o,r,e,_,h,v,s,l,x;a=this._b1._pseudoVelX,t=this._b1._pseudoVelY,i=this._b1._pseudoVelZ,o=this._b2._pseudoVelX,r=this._b2._pseudoVelY,e=this._b2._pseudoVelZ,_=this._b1._angPseudoVelX,h=this._b1._angPseudoVelY,v=this._b1._angPseudoVelZ,s=this._b2._angPseudoVelX,l=this._b2._angPseudoVelY,x=this._b2._angPseudoVelZ;for(var b=0,f=this.info.numRows;b<f;){var n=b++,c=this.info.rows[n],z=this.massData[n],p=c.impulse,y=c.jacobianN,V=0;V+=a*y.lin1X+t*y.lin1Y+i*y.lin1Z,V-=o*y.lin2X+r*y.lin2Y+e*y.lin2Z,V+=_*y.ang1X+h*y.ang1Y+v*y.ang1Z,V-=s*y.ang2X+l*y.ang2Y+x*y.ang2Z;var M=(c.rhs-V)*z.massN*u.common.Setting.positionSplitImpulseBaumgarte,I=p.impulseP;p.impulseP+=M,p.impulseP<0&&(p.impulseP=0),M=p.impulseP-I,a+=z.invMLinN1X*M,t+=z.invMLinN1Y*M,i+=z.invMLinN1Z*M,o+=z.invMLinN2X*-M,r+=z.invMLinN2Y*-M,e+=z.invMLinN2Z*-M,_+=z.invMAngN1X*M,h+=z.invMAngN1Y*M,v+=z.invMAngN1Z*M,s+=z.invMAngN2X*-M,l+=z.invMAngN2Y*-M,x+=z.invMAngN2Z*-M}this._b1._pseudoVelX=a,this._b1._pseudoVelY=t,this._b1._pseudoVelZ=i,this._b2._pseudoVelX=o,this._b2._pseudoVelY=r,this._b2._pseudoVelZ=e,this._b1._angPseudoVelX=_,this._b1._angPseudoVelY=h,this._b1._angPseudoVelZ=v,this._b2._angPseudoVelX=s,this._b2._angPseudoVelY=l,this._b2._angPseudoVelZ=x}solvePositionNgs(a){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);var t=this._b1._invMass,i=this._b2._invMass,o,r,e,_,h,v,s,l,x,b,f,n,c,z,p,y,V,M;o=this._b1._invInertia00,r=this._b1._invInertia01,e=this._b1._invInertia02,_=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,s=this._b1._invInertia20,l=this._b1._invInertia21,x=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,z=this._b2._invInertia11,p=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,M=this._b2._invInertia22;for(var I=0,k=this.info.numRows;I<k;){var X=I++,L=this.info.rows[X],m=this.massData[X],g=L.jacobianN;m.invMLinN1X=g.lin1X*t,m.invMLinN1Y=g.lin1Y*t,m.invMLinN1Z=g.lin1Z*t,m.invMLinN2X=g.lin2X*i,m.invMLinN2Y=g.lin2Y*i,m.invMLinN2Z=g.lin2Z*i;var N,d,F;N=o*g.ang1X+r*g.ang1Y+e*g.ang1Z,d=_*g.ang1X+h*g.ang1Y+v*g.ang1Z,F=s*g.ang1X+l*g.ang1Y+x*g.ang1Z,m.invMAngN1X=N,m.invMAngN1Y=d,m.invMAngN1Z=F;var S,Y,Q;S=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+z*g.ang2Y+p*g.ang2Z,Q=y*g.ang2X+V*g.ang2Y+M*g.ang2Z,m.invMAngN2X=S,m.invMAngN2Y=Y,m.invMAngN2Z=Q,m.massN=t+i+(m.invMAngN1X*g.ang1X+m.invMAngN1Y*g.ang1Y+m.invMAngN1Z*g.ang1Z)+(m.invMAngN2X*g.ang2X+m.invMAngN2Y*g.ang2Y+m.invMAngN2Z*g.ang2Z),m.massN!=0&&(m.massN=1/m.massN)}var C,B,Z,$,K,E,J,A,R,U,G,D;C=0,B=0,Z=0,$=0,K=0,E=0,J=0,A=0,R=0,U=0,G=0,D=0;for(var H=0,j=this.info.numRows;H<j;){var ia=H++,ea=this.info.rows[ia],W=this.massData[ia],q=ea.impulse,na=ea.jacobianN,oa=0;oa+=C*na.lin1X+B*na.lin1Y+Z*na.lin1Z,oa-=$*na.lin2X+K*na.lin2Y+E*na.lin2Z,oa+=J*na.ang1X+A*na.ang1Y+R*na.ang1Z,oa-=U*na.ang2X+G*na.ang2Y+D*na.ang2Z;var aa=(ea.rhs-oa)*W.massN*u.common.Setting.positionNgsBaumgarte,T=q.impulseP;q.impulseP+=aa,q.impulseP<0&&(q.impulseP=0),aa=q.impulseP-T,C+=W.invMLinN1X*aa,B+=W.invMLinN1Y*aa,Z+=W.invMLinN1Z*aa,$+=W.invMLinN2X*-aa,K+=W.invMLinN2Y*-aa,E+=W.invMLinN2Z*-aa,J+=W.invMAngN1X*aa,A+=W.invMAngN1Y*aa,R+=W.invMAngN1Z*aa,U+=W.invMAngN2X*-aa,G+=W.invMAngN2Y*-aa,D+=W.invMAngN2Z*-aa}var ca=this._b1;ca._transform._positionX+=C,ca._transform._positionY+=B,ca._transform._positionZ+=Z;var _a=this._b2;_a._transform._positionX+=$,_a._transform._positionY+=K,_a._transform._positionZ+=E;var w=this._b1,ta=Math.sqrt(J*J+A*A+R*R),ra=ta*.5,la,va;if(ra<.5){var ua=ra*ra;la=.5*(1-ua*.16666666666666666+ua*ua*.008333333333333333),va=1-ua*.5+ua*ua*.041666666666666664}else la=Math.sin(ra)/ta,va=Math.cos(ra);var za,Ma,Xa;za=J*la,Ma=A*la,Xa=R*la;var Za,fa,ba,sa;Za=za,fa=Ma,ba=Xa,sa=va;var ha,ma,ya,Ba,pa=w._transform._rotation00,Ya=w._transform._rotation11,Ra=w._transform._rotation22,ga=pa+Ya+Ra,xa;ga>0?(xa=Math.sqrt(ga+1),Ba=.5*xa,xa=.5/xa,ha=(w._transform._rotation21-w._transform._rotation12)*xa,ma=(w._transform._rotation02-w._transform._rotation20)*xa,ya=(w._transform._rotation10-w._transform._rotation01)*xa):pa>Ya?pa>Ra?(xa=Math.sqrt(pa-Ya-Ra+1),ha=.5*xa,xa=.5/xa,ma=(w._transform._rotation01+w._transform._rotation10)*xa,ya=(w._transform._rotation02+w._transform._rotation20)*xa,Ba=(w._transform._rotation21-w._transform._rotation12)*xa):(xa=Math.sqrt(Ra-pa-Ya+1),ya=.5*xa,xa=.5/xa,ha=(w._transform._rotation02+w._transform._rotation20)*xa,ma=(w._transform._rotation12+w._transform._rotation21)*xa,Ba=(w._transform._rotation10-w._transform._rotation01)*xa):Ya>Ra?(xa=Math.sqrt(Ya-Ra-pa+1),ma=.5*xa,xa=.5/xa,ha=(w._transform._rotation01+w._transform._rotation10)*xa,ya=(w._transform._rotation12+w._transform._rotation21)*xa,Ba=(w._transform._rotation02-w._transform._rotation20)*xa):(xa=Math.sqrt(Ra-pa-Ya+1),ya=.5*xa,xa=.5/xa,ha=(w._transform._rotation02+w._transform._rotation20)*xa,ma=(w._transform._rotation12+w._transform._rotation21)*xa,Ba=(w._transform._rotation10-w._transform._rotation01)*xa),ha=sa*ha+Za*Ba+fa*ya-ba*ma,ma=sa*ma-Za*ya+fa*Ba+ba*ha,ya=sa*ya+Za*ma-fa*ha+ba*Ba,Ba=sa*Ba-Za*ha-fa*ma-ba*ya;var wa=ha*ha+ma*ma+ya*ya+Ba*Ba;wa>1e-32&&(wa=1/Math.sqrt(wa)),ha*=wa,ma*=wa,ya*=wa,Ba*=wa;var ka=ha,Pa=ma,zt=ya,Oa=Ba,Aa=2*ka,nt=2*Pa,Ea=2*zt,Fa=ka*Aa,da=Pa*nt,ft=zt*Ea,Wa=ka*nt,Ha=Pa*Ea,bt=ka*Ea,it=Oa*Aa,Ka=Oa*nt,_t=Oa*Ea;w._transform._rotation00=1-da-ft,w._transform._rotation01=Wa-_t,w._transform._rotation02=bt+Ka,w._transform._rotation10=Wa+_t,w._transform._rotation11=1-Fa-ft,w._transform._rotation12=Ha-it,w._transform._rotation20=bt-Ka,w._transform._rotation21=Ha+it,w._transform._rotation22=1-Fa-da;var gt,pt,Ga,rt,xt,Da,Ta,Na,Vt;gt=w._transform._rotation00*w._invLocalInertia00+w._transform._rotation01*w._invLocalInertia10+w._transform._rotation02*w._invLocalInertia20,pt=w._transform._rotation00*w._invLocalInertia01+w._transform._rotation01*w._invLocalInertia11+w._transform._rotation02*w._invLocalInertia21,Ga=w._transform._rotation00*w._invLocalInertia02+w._transform._rotation01*w._invLocalInertia12+w._transform._rotation02*w._invLocalInertia22,rt=w._transform._rotation10*w._invLocalInertia00+w._transform._rotation11*w._invLocalInertia10+w._transform._rotation12*w._invLocalInertia20,xt=w._transform._rotation10*w._invLocalInertia01+w._transform._rotation11*w._invLocalInertia11+w._transform._rotation12*w._invLocalInertia21,Da=w._transform._rotation10*w._invLocalInertia02+w._transform._rotation11*w._invLocalInertia12+w._transform._rotation12*w._invLocalInertia22,Ta=w._transform._rotation20*w._invLocalInertia00+w._transform._rotation21*w._invLocalInertia10+w._transform._rotation22*w._invLocalInertia20,Na=w._transform._rotation20*w._invLocalInertia01+w._transform._rotation21*w._invLocalInertia11+w._transform._rotation22*w._invLocalInertia21,Vt=w._transform._rotation20*w._invLocalInertia02+w._transform._rotation21*w._invLocalInertia12+w._transform._rotation22*w._invLocalInertia22,w._invInertia00=gt,w._invInertia01=pt,w._invInertia02=Ga,w._invInertia10=rt,w._invInertia11=xt,w._invInertia12=Da,w._invInertia20=Ta,w._invInertia21=Na,w._invInertia22=Vt;var Pt,st,Xt,Yt,Mt,Ia,O,Va,lt;Pt=w._invInertia00*w._transform._rotation00+w._invInertia01*w._transform._rotation01+w._invInertia02*w._transform._rotation02,st=w._invInertia00*w._transform._rotation10+w._invInertia01*w._transform._rotation11+w._invInertia02*w._transform._rotation12,Xt=w._invInertia00*w._transform._rotation20+w._invInertia01*w._transform._rotation21+w._invInertia02*w._transform._rotation22,Yt=w._invInertia10*w._transform._rotation00+w._invInertia11*w._transform._rotation01+w._invInertia12*w._transform._rotation02,Mt=w._invInertia10*w._transform._rotation10+w._invInertia11*w._transform._rotation11+w._invInertia12*w._transform._rotation12,Ia=w._invInertia10*w._transform._rotation20+w._invInertia11*w._transform._rotation21+w._invInertia12*w._transform._rotation22,O=w._invInertia20*w._transform._rotation00+w._invInertia21*w._transform._rotation01+w._invInertia22*w._transform._rotation02,Va=w._invInertia20*w._transform._rotation10+w._invInertia21*w._transform._rotation11+w._invInertia22*w._transform._rotation12,lt=w._invInertia20*w._transform._rotation20+w._invInertia21*w._transform._rotation21+w._invInertia22*w._transform._rotation22,w._invInertia00=Pt,w._invInertia01=st,w._invInertia02=Xt,w._invInertia10=Yt,w._invInertia11=Mt,w._invInertia12=Ia,w._invInertia20=O,w._invInertia21=Va,w._invInertia22=lt,w._invInertia00*=w._rotFactor.x,w._invInertia01*=w._rotFactor.x,w._invInertia02*=w._rotFactor.x,w._invInertia10*=w._rotFactor.y,w._invInertia11*=w._rotFactor.y,w._invInertia12*=w._rotFactor.y,w._invInertia20*=w._rotFactor.z,w._invInertia21*=w._rotFactor.z,w._invInertia22*=w._rotFactor.z;var P=this._b2,wt=Math.sqrt(U*U+G*G+D*D),At=wt*.5,dt,yt;if(At<.5){var kt=At*At;dt=.5*(1-kt*.16666666666666666+kt*kt*.008333333333333333),yt=1-kt*.5+kt*kt*.041666666666666664}else dt=Math.sin(At)/wt,yt=Math.cos(At);var mt,ht,ut;mt=U*dt,ht=G*dt,ut=D*dt;var Qa,et,Ca,vt;Qa=mt,et=ht,Ca=ut,vt=yt;var qa,at,Ua,tt,ct=P._transform._rotation00,Sa=P._transform._rotation11,Ja=P._transform._rotation22,ja=ct+Sa+Ja,La;ja>0?(La=Math.sqrt(ja+1),tt=.5*La,La=.5/La,qa=(P._transform._rotation21-P._transform._rotation12)*La,at=(P._transform._rotation02-P._transform._rotation20)*La,Ua=(P._transform._rotation10-P._transform._rotation01)*La):ct>Sa?ct>Ja?(La=Math.sqrt(ct-Sa-Ja+1),qa=.5*La,La=.5/La,at=(P._transform._rotation01+P._transform._rotation10)*La,Ua=(P._transform._rotation02+P._transform._rotation20)*La,tt=(P._transform._rotation21-P._transform._rotation12)*La):(La=Math.sqrt(Ja-ct-Sa+1),Ua=.5*La,La=.5/La,qa=(P._transform._rotation02+P._transform._rotation20)*La,at=(P._transform._rotation12+P._transform._rotation21)*La,tt=(P._transform._rotation10-P._transform._rotation01)*La):Sa>Ja?(La=Math.sqrt(Sa-Ja-ct+1),at=.5*La,La=.5/La,qa=(P._transform._rotation01+P._transform._rotation10)*La,Ua=(P._transform._rotation12+P._transform._rotation21)*La,tt=(P._transform._rotation02-P._transform._rotation20)*La):(La=Math.sqrt(Ja-ct-Sa+1),Ua=.5*La,La=.5/La,qa=(P._transform._rotation02+P._transform._rotation20)*La,at=(P._transform._rotation12+P._transform._rotation21)*La,tt=(P._transform._rotation10-P._transform._rotation01)*La),qa=vt*qa+Qa*tt+et*Ua-Ca*at,at=vt*at-Qa*Ua+et*tt+Ca*qa,Ua=vt*Ua+Qa*at-et*qa+Ca*tt,tt=vt*tt-Qa*qa-et*at-Ca*Ua;var ot=qa*qa+at*at+Ua*Ua+tt*tt;ot>1e-32&&(ot=1/Math.sqrt(ot)),qa*=ot,at*=ot,Ua*=ot,tt*=ot;var It=qa,oi=at,gi=Ua,ai=tt,Ct=2*It,_i=2*oi,Et=2*gi,St=It*Ct,Jt=oi*_i,Ki=gi*Et,vi=It*_i,li=oi*Et,ti=It*Et,Oi=ai*Ct,Xi=ai*_i,zi=ai*Et;P._transform._rotation00=1-Jt-Ki,P._transform._rotation01=vi-zi,P._transform._rotation02=ti+Xi,P._transform._rotation10=vi+zi,P._transform._rotation11=1-St-Ki,P._transform._rotation12=li-Oi,P._transform._rotation20=ti-Xi,P._transform._rotation21=li+Oi,P._transform._rotation22=1-St-Jt;var Zt,ri,Wt,ni,$i,Ut,ji,Ii,pr;Zt=P._transform._rotation00*P._invLocalInertia00+P._transform._rotation01*P._invLocalInertia10+P._transform._rotation02*P._invLocalInertia20,ri=P._transform._rotation00*P._invLocalInertia01+P._transform._rotation01*P._invLocalInertia11+P._transform._rotation02*P._invLocalInertia21,Wt=P._transform._rotation00*P._invLocalInertia02+P._transform._rotation01*P._invLocalInertia12+P._transform._rotation02*P._invLocalInertia22,ni=P._transform._rotation10*P._invLocalInertia00+P._transform._rotation11*P._invLocalInertia10+P._transform._rotation12*P._invLocalInertia20,$i=P._transform._rotation10*P._invLocalInertia01+P._transform._rotation11*P._invLocalInertia11+P._transform._rotation12*P._invLocalInertia21,Ut=P._transform._rotation10*P._invLocalInertia02+P._transform._rotation11*P._invLocalInertia12+P._transform._rotation12*P._invLocalInertia22,ji=P._transform._rotation20*P._invLocalInertia00+P._transform._rotation21*P._invLocalInertia10+P._transform._rotation22*P._invLocalInertia20,Ii=P._transform._rotation20*P._invLocalInertia01+P._transform._rotation21*P._invLocalInertia11+P._transform._rotation22*P._invLocalInertia21,pr=P._transform._rotation20*P._invLocalInertia02+P._transform._rotation21*P._invLocalInertia12+P._transform._rotation22*P._invLocalInertia22,P._invInertia00=Zt,P._invInertia01=ri,P._invInertia02=Wt,P._invInertia10=ni,P._invInertia11=$i,P._invInertia12=Ut,P._invInertia20=ji,P._invInertia21=Ii,P._invInertia22=pr;var Wi,Lt,jt,Tt,bi,Mi,vr,qt,fi;Wi=P._invInertia00*P._transform._rotation00+P._invInertia01*P._transform._rotation01+P._invInertia02*P._transform._rotation02,Lt=P._invInertia00*P._transform._rotation10+P._invInertia01*P._transform._rotation11+P._invInertia02*P._transform._rotation12,jt=P._invInertia00*P._transform._rotation20+P._invInertia01*P._transform._rotation21+P._invInertia02*P._transform._rotation22,Tt=P._invInertia10*P._transform._rotation00+P._invInertia11*P._transform._rotation01+P._invInertia12*P._transform._rotation02,bi=P._invInertia10*P._transform._rotation10+P._invInertia11*P._transform._rotation11+P._invInertia12*P._transform._rotation12,Mi=P._invInertia10*P._transform._rotation20+P._invInertia11*P._transform._rotation21+P._invInertia12*P._transform._rotation22,vr=P._invInertia20*P._transform._rotation00+P._invInertia21*P._transform._rotation01+P._invInertia22*P._transform._rotation02,qt=P._invInertia20*P._transform._rotation10+P._invInertia21*P._transform._rotation11+P._invInertia22*P._transform._rotation12,fi=P._invInertia20*P._transform._rotation20+P._invInertia21*P._transform._rotation21+P._invInertia22*P._transform._rotation22,P._invInertia00=Wi,P._invInertia01=Lt,P._invInertia02=jt,P._invInertia10=Tt,P._invInertia11=bi,P._invInertia12=Mi,P._invInertia20=vr,P._invInertia21=qt,P._invInertia22=fi,P._invInertia00*=P._rotFactor.x,P._invInertia01*=P._rotFactor.x,P._invInertia02*=P._rotFactor.x,P._invInertia10*=P._rotFactor.y,P._invInertia11*=P._rotFactor.y,P._invInertia12*=P._rotFactor.y,P._invInertia20*=P._rotFactor.z,P._invInertia21*=P._rotFactor.z,P._invInertia22*=P._rotFactor.z}postSolve(){var a,t,i,o,r,e,_,h,v;a=0,t=0,i=0,o=0,r=0,e=0,_=0,h=0,v=0;for(var s=0,l=this.info.numRows;s<l;){var x=s++,b=this.info.rows[x],f=b.impulse,n=b.jacobianN,c=b.jacobianT,z=b.jacobianB,p=f.impulseN,y=f.impulseT,V=f.impulseB,M,I,k;M=0,I=0,k=0,M+=c.lin1X*y,I+=c.lin1Y*y,k+=c.lin1Z*y,M+=z.lin1X*V,I+=z.lin1Y*V,k+=z.lin1Z*V,f.impulseLX=M,f.impulseLY=I,f.impulseLZ=k,a+=n.lin1X*p,t+=n.lin1Y*p,i+=n.lin1Z*p,o+=n.ang1X*p,r+=n.ang1Y*p,e+=n.ang1Z*p,_+=n.ang2X*p,h+=n.ang2Y*p,v+=n.ang2Z*p,a+=c.lin1X*y,t+=c.lin1Y*y,i+=c.lin1Z*y,o+=c.ang1X*y,r+=c.ang1Y*y,e+=c.ang1Z*y,_+=c.ang2X*y,h+=c.ang2Y*y,v+=c.ang2Z*y,a+=z.lin1X*V,t+=z.lin1Y*V,i+=z.lin1Z*V,o+=z.ang1X*V,r+=z.ang1Y*V,e+=z.ang1Z*V,_+=z.ang2X*V,h+=z.ang2Y*V,v+=z.ang2Z*V}this._b1._linearContactImpulseX+=a,this._b1._linearContactImpulseY+=t,this._b1._linearContactImpulseZ+=i,this._b1._angularContactImpulseX+=o,this._b1._angularContactImpulseY+=r,this._b1._angularContactImpulseZ+=e,this._b2._linearContactImpulseX-=a,this._b2._linearContactImpulseY-=t,this._b2._linearContactImpulseZ-=i,this._b2._angularContactImpulseX-=_,this._b2._angularContactImpulseY-=h,this._b2._angularContactImpulseZ-=v,this.constraint._syncManifold()}};u.dynamics.constraint.solver.pgs.PgsJointConstraintSolver=class extends u.dynamics.constraint.ConstraintSolver{constructor(a){super(),this.joint=a,this.info=new u.dynamics.constraint.info.joint.JointSolverInfo;var t=new Array(u.common.Setting.maxJacobianRows);this.massData=t;for(var i=0,o=this.massData.length;i<o;){var r=i++;this.massData[r]=new u.dynamics.constraint.solver.common.JointSolverMassDataRow}}preSolveVelocity(a){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(a,this.info),this._b1=this.info.b1,this._b2=this.info.b2;var t=this._b1._invMass,i=this._b2._invMass,o,r,e,_,h,v,s,l,x,b,f,n,c,z,p,y,V,M;o=this._b1._invInertia00,r=this._b1._invInertia01,e=this._b1._invInertia02,_=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,s=this._b1._invInertia20,l=this._b1._invInertia21,x=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,z=this._b2._invInertia11,p=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,M=this._b2._invInertia22;for(var I=0,k=this.info.numRows;I<k;){var X=I++,L=this.info.rows[X],m=this.massData[X],g=L.jacobian;if(g.updateSparsity(),g.flag&1?(m.invMLin1X=g.lin1X*t,m.invMLin1Y=g.lin1Y*t,m.invMLin1Z=g.lin1Z*t,m.invMLin2X=g.lin2X*i,m.invMLin2Y=g.lin2Y*i,m.invMLin2Z=g.lin2Z*i):(m.invMLin1X=0,m.invMLin1Y=0,m.invMLin1Z=0,m.invMLin2X=0,m.invMLin2Y=0,m.invMLin2Z=0),g.flag&2){var N,d,F;N=o*g.ang1X+r*g.ang1Y+e*g.ang1Z,d=_*g.ang1X+h*g.ang1Y+v*g.ang1Z,F=s*g.ang1X+l*g.ang1Y+x*g.ang1Z,m.invMAng1X=N,m.invMAng1Y=d,m.invMAng1Z=F;var S,Y,Q;S=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+z*g.ang2Y+p*g.ang2Z,Q=y*g.ang2X+V*g.ang2Y+M*g.ang2Z,m.invMAng2X=S,m.invMAng2Y=Y,m.invMAng2Z=Q}else m.invMAng1X=0,m.invMAng1Y=0,m.invMAng1Z=0,m.invMAng2X=0,m.invMAng2Y=0,m.invMAng2Z=0;m.massWithoutCfm=m.invMLin1X*g.lin1X+m.invMLin1Y*g.lin1Y+m.invMLin1Z*g.lin1Z+(m.invMLin2X*g.lin2X+m.invMLin2Y*g.lin2Y+m.invMLin2Z*g.lin2Z)+(m.invMAng1X*g.ang1X+m.invMAng1Y*g.ang1Y+m.invMAng1Z*g.ang1Z)+(m.invMAng2X*g.ang2X+m.invMAng2Y*g.ang2Y+m.invMAng2Z*g.ang2Z),m.mass=m.massWithoutCfm+L.cfm,m.massWithoutCfm!=0&&(m.massWithoutCfm=1/m.massWithoutCfm),m.mass!=0&&(m.mass=1/m.mass)}}warmStart(a){var t=this.joint._positionCorrectionAlgorithm==u.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?u.common.Setting.jointWarmStartingFactorForBaungarte:u.common.Setting.jointWarmStartingFactor;if(t*=a.dtRatio,t<=0){for(var i=0,o=this.info.numRows;i<o;){var r=i++,e=this.info.rows[r],_=e.impulse;_.impulse=0,_.impulseM=0,_.impulseP=0}return}var h,v,s,l,x,b,f,n,c,z,p,y;h=this._b1._velX,v=this._b1._velY,s=this._b1._velZ,l=this._b2._velX,x=this._b2._velY,b=this._b2._velZ,f=this._b1._angVelX,n=this._b1._angVelY,c=this._b1._angVelZ,z=this._b2._angVelX,p=this._b2._angVelY,y=this._b2._angVelZ;for(var V=0,M=this.info.numRows;V<M;){var I=V++,k=this.info.rows[I],X=this.massData[I],L=k.impulse;k.jacobian,L.impulse*=t,L.impulseM*=t;var m=L.impulse+L.impulseM;h+=X.invMLin1X*m,v+=X.invMLin1Y*m,s+=X.invMLin1Z*m,l+=X.invMLin2X*-m,x+=X.invMLin2Y*-m,b+=X.invMLin2Z*-m,f+=X.invMAng1X*m,n+=X.invMAng1Y*m,c+=X.invMAng1Z*m,z+=X.invMAng2X*-m,p+=X.invMAng2Y*-m,y+=X.invMAng2Z*-m}this._b1._velX=h,this._b1._velY=v,this._b1._velZ=s,this._b2._velX=l,this._b2._velY=x,this._b2._velZ=b,this._b1._angVelX=f,this._b1._angVelY=n,this._b1._angVelZ=c,this._b2._angVelX=z,this._b2._angVelY=p,this._b2._angVelZ=y}solveVelocity(){var a,t,i,o,r,e,_,h,v,s,l,x;a=this._b1._velX,t=this._b1._velY,i=this._b1._velZ,o=this._b2._velX,r=this._b2._velY,e=this._b2._velZ,_=this._b1._angVelX,h=this._b1._angVelY,v=this._b1._angVelZ,s=this._b2._angVelX,l=this._b2._angVelY,x=this._b2._angVelZ;for(var b=0,f=this.info.numRows;b<f;){var n=b++,c=this.info.rows[n],z=this.massData[n],p=c.impulse,y=c.jacobian;if(c.motorMaxImpulse!=0){var V=0;V+=a*y.lin1X+t*y.lin1Y+i*y.lin1Z,V-=o*y.lin2X+r*y.lin2Y+e*y.lin2Z,V+=_*y.ang1X+h*y.ang1Y+v*y.ang1Z,V-=s*y.ang2X+l*y.ang2Y+x*y.ang2Z;var M=(-c.motorSpeed-V)*z.massWithoutCfm,I=p.impulseM;p.impulseM+=M,p.impulseM<-c.motorMaxImpulse?p.impulseM=-c.motorMaxImpulse:p.impulseM>c.motorMaxImpulse&&(p.impulseM=c.motorMaxImpulse),M=p.impulseM-I,y.flag&1&&(a+=z.invMLin1X*M,t+=z.invMLin1Y*M,i+=z.invMLin1Z*M,o+=z.invMLin2X*-M,r+=z.invMLin2Y*-M,e+=z.invMLin2Z*-M),y.flag&2&&(_+=z.invMAng1X*M,h+=z.invMAng1Y*M,v+=z.invMAng1Z*M,s+=z.invMAng2X*-M,l+=z.invMAng2Y*-M,x+=z.invMAng2Z*-M)}}for(var k=0,X=this.info.numRows;k<X;){var L=k++,m=this.info.rows[L],g=this.massData[L],N=m.impulse,d=m.jacobian,F=0;F+=a*d.lin1X+t*d.lin1Y+i*d.lin1Z,F-=o*d.lin2X+r*d.lin2Y+e*d.lin2Z,F+=_*d.ang1X+h*d.ang1Y+v*d.ang1Z,F-=s*d.ang2X+l*d.ang2Y+x*d.ang2Z;var S=(m.rhs-F-N.impulse*m.cfm)*g.mass,Y=N.impulse;N.impulse+=S,N.impulse<m.minImpulse?N.impulse=m.minImpulse:N.impulse>m.maxImpulse&&(N.impulse=m.maxImpulse),S=N.impulse-Y,d.flag&1&&(a+=g.invMLin1X*S,t+=g.invMLin1Y*S,i+=g.invMLin1Z*S,o+=g.invMLin2X*-S,r+=g.invMLin2Y*-S,e+=g.invMLin2Z*-S),d.flag&2&&(_+=g.invMAng1X*S,h+=g.invMAng1Y*S,v+=g.invMAng1Z*S,s+=g.invMAng2X*-S,l+=g.invMAng2Y*-S,x+=g.invMAng2Z*-S)}this._b1._velX=a,this._b1._velY=t,this._b1._velZ=i,this._b2._velX=o,this._b2._velY=r,this._b2._velZ=e,this._b1._angVelX=_,this._b1._angVelY=h,this._b1._angVelZ=v,this._b2._angVelX=s,this._b2._angVelY=l,this._b2._angVelZ=x}postSolveVelocity(a){var t,i,o,r,e,_;t=0,i=0,o=0,r=0,e=0,_=0;for(var h=0,v=this.info.numRows;h<v;){var s=h++,l=this.info.rows[s],x=l.impulse,b=l.jacobian;b.flag&1?(t+=b.lin1X*x.impulse,i+=b.lin1Y*x.impulse,o+=b.lin1Z*x.impulse):b.flag&2&&(r+=b.ang1X*x.impulse,e+=b.ang1Y*x.impulse,_+=b.ang1Z*x.impulse)}this.joint._appliedForceX=t*a.invDt,this.joint._appliedForceY=i*a.invDt,this.joint._appliedForceZ=o*a.invDt,this.joint._appliedTorqueX=r*a.invDt,this.joint._appliedTorqueY=e*a.invDt,this.joint._appliedTorqueZ=_*a.invDt}preSolvePosition(a){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;var t=this._b1._invMass,i=this._b2._invMass,o,r,e,_,h,v,s,l,x,b,f,n,c,z,p,y,V,M;o=this._b1._invInertia00,r=this._b1._invInertia01,e=this._b1._invInertia02,_=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,s=this._b1._invInertia20,l=this._b1._invInertia21,x=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,z=this._b2._invInertia11,p=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,M=this._b2._invInertia22;for(var I=0,k=this.info.numRows;I<k;){var X=I++,L=this.info.rows[X],m=this.massData[X];L.impulse;var g=L.jacobian;m.invMLin1X=g.lin1X*t,m.invMLin1Y=g.lin1Y*t,m.invMLin1Z=g.lin1Z*t,m.invMLin2X=g.lin2X*i,m.invMLin2Y=g.lin2Y*i,m.invMLin2Z=g.lin2Z*i;var N,d,F;N=o*g.ang1X+r*g.ang1Y+e*g.ang1Z,d=_*g.ang1X+h*g.ang1Y+v*g.ang1Z,F=s*g.ang1X+l*g.ang1Y+x*g.ang1Z,m.invMAng1X=N,m.invMAng1Y=d,m.invMAng1Z=F;var S,Y,Q;S=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+z*g.ang2Y+p*g.ang2Z,Q=y*g.ang2X+V*g.ang2Y+M*g.ang2Z,m.invMAng2X=S,m.invMAng2Y=Y,m.invMAng2Z=Q,m.mass=m.invMLin1X*g.lin1X+m.invMLin1Y*g.lin1Y+m.invMLin1Z*g.lin1Z+(m.invMLin2X*g.lin2X+m.invMLin2Y*g.lin2Y+m.invMLin2Z*g.lin2Z)+(m.invMAng1X*g.ang1X+m.invMAng1Y*g.ang1Y+m.invMAng1Z*g.ang1Z)+(m.invMAng2X*g.ang2X+m.invMAng2Y*g.ang2Y+m.invMAng2Z*g.ang2Z),m.mass!=0&&(m.mass=1/m.mass)}for(var C=0,B=this.info.numRows;C<B;){var Z=C++;this.info.rows[Z].impulse.impulseP=0}}solvePositionSplitImpulse(){var a,t,i,o,r,e,_,h,v,s,l,x;a=this._b1._pseudoVelX,t=this._b1._pseudoVelY,i=this._b1._pseudoVelZ,o=this._b2._pseudoVelX,r=this._b2._pseudoVelY,e=this._b2._pseudoVelZ,_=this._b1._angPseudoVelX,h=this._b1._angPseudoVelY,v=this._b1._angPseudoVelZ,s=this._b2._angPseudoVelX,l=this._b2._angPseudoVelY,x=this._b2._angPseudoVelZ;for(var b=0,f=this.info.numRows;b<f;){var n=b++,c=this.info.rows[n],z=this.massData[n],p=c.impulse,y=c.jacobian,V=0;V+=a*y.lin1X+t*y.lin1Y+i*y.lin1Z,V-=o*y.lin2X+r*y.lin2Y+e*y.lin2Z,V+=_*y.ang1X+h*y.ang1Y+v*y.ang1Z,V-=s*y.ang2X+l*y.ang2Y+x*y.ang2Z;var M=(c.rhs*u.common.Setting.positionSplitImpulseBaumgarte-V)*z.mass,I=p.impulseP;p.impulseP+=M,p.impulseP<c.minImpulse?p.impulseP=c.minImpulse:p.impulseP>c.maxImpulse&&(p.impulseP=c.maxImpulse),M=p.impulseP-I,a+=z.invMLin1X*M,t+=z.invMLin1Y*M,i+=z.invMLin1Z*M,o+=z.invMLin2X*-M,r+=z.invMLin2Y*-M,e+=z.invMLin2Z*-M,_+=z.invMAng1X*M,h+=z.invMAng1Y*M,v+=z.invMAng1Z*M,s+=z.invMAng2X*-M,l+=z.invMAng2Y*-M,x+=z.invMAng2Z*-M}this._b1._pseudoVelX=a,this._b1._pseudoVelY=t,this._b1._pseudoVelZ=i,this._b2._pseudoVelX=o,this._b2._pseudoVelY=r,this._b2._pseudoVelZ=e,this._b1._angPseudoVelX=_,this._b1._angPseudoVelY=h,this._b1._angPseudoVelZ=v,this._b2._angPseudoVelX=s,this._b2._angPseudoVelY=l,this._b2._angPseudoVelZ=x}solvePositionNgs(a){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;var t=this._b1._invMass,i=this._b2._invMass,o,r,e,_,h,v,s,l,x,b,f,n,c,z,p,y,V,M;o=this._b1._invInertia00,r=this._b1._invInertia01,e=this._b1._invInertia02,_=this._b1._invInertia10,h=this._b1._invInertia11,v=this._b1._invInertia12,s=this._b1._invInertia20,l=this._b1._invInertia21,x=this._b1._invInertia22,b=this._b2._invInertia00,f=this._b2._invInertia01,n=this._b2._invInertia02,c=this._b2._invInertia10,z=this._b2._invInertia11,p=this._b2._invInertia12,y=this._b2._invInertia20,V=this._b2._invInertia21,M=this._b2._invInertia22;for(var I=0,k=this.info.numRows;I<k;){var X=I++,L=this.info.rows[X],m=this.massData[X];L.impulse;var g=L.jacobian;m.invMLin1X=g.lin1X*t,m.invMLin1Y=g.lin1Y*t,m.invMLin1Z=g.lin1Z*t,m.invMLin2X=g.lin2X*i,m.invMLin2Y=g.lin2Y*i,m.invMLin2Z=g.lin2Z*i;var N,d,F;N=o*g.ang1X+r*g.ang1Y+e*g.ang1Z,d=_*g.ang1X+h*g.ang1Y+v*g.ang1Z,F=s*g.ang1X+l*g.ang1Y+x*g.ang1Z,m.invMAng1X=N,m.invMAng1Y=d,m.invMAng1Z=F;var S,Y,Q;S=b*g.ang2X+f*g.ang2Y+n*g.ang2Z,Y=c*g.ang2X+z*g.ang2Y+p*g.ang2Z,Q=y*g.ang2X+V*g.ang2Y+M*g.ang2Z,m.invMAng2X=S,m.invMAng2Y=Y,m.invMAng2Z=Q,m.mass=m.invMLin1X*g.lin1X+m.invMLin1Y*g.lin1Y+m.invMLin1Z*g.lin1Z+(m.invMLin2X*g.lin2X+m.invMLin2Y*g.lin2Y+m.invMLin2Z*g.lin2Z)+(m.invMAng1X*g.ang1X+m.invMAng1Y*g.ang1Y+m.invMAng1Z*g.ang1Z)+(m.invMAng2X*g.ang2X+m.invMAng2Y*g.ang2Y+m.invMAng2Z*g.ang2Z),m.mass!=0&&(m.mass=1/m.mass)}var C,B,Z,$,K,E,J,A,R,U,G,D;C=0,B=0,Z=0,$=0,K=0,E=0,J=0,A=0,R=0,U=0,G=0,D=0;for(var H=0,j=this.info.numRows;H<j;){var ia=H++,ea=this.info.rows[ia],W=this.massData[ia],q=ea.impulse,na=ea.jacobian,oa=0;oa+=C*na.lin1X+B*na.lin1Y+Z*na.lin1Z,oa-=$*na.lin2X+K*na.lin2Y+E*na.lin2Z,oa+=J*na.ang1X+A*na.ang1Y+R*na.ang1Z,oa-=U*na.ang2X+G*na.ang2Y+D*na.ang2Z;var aa=(ea.rhs*u.common.Setting.positionNgsBaumgarte-oa)*W.mass,T=q.impulseP;q.impulseP+=aa,q.impulseP<ea.minImpulse?q.impulseP=ea.minImpulse:q.impulseP>ea.maxImpulse&&(q.impulseP=ea.maxImpulse),aa=q.impulseP-T,C+=W.invMLin1X*aa,B+=W.invMLin1Y*aa,Z+=W.invMLin1Z*aa,$+=W.invMLin2X*-aa,K+=W.invMLin2Y*-aa,E+=W.invMLin2Z*-aa,J+=W.invMAng1X*aa,A+=W.invMAng1Y*aa,R+=W.invMAng1Z*aa,U+=W.invMAng2X*-aa,G+=W.invMAng2Y*-aa,D+=W.invMAng2Z*-aa}var ca=this._b1;ca._transform._positionX+=C,ca._transform._positionY+=B,ca._transform._positionZ+=Z;var _a=this._b2;_a._transform._positionX+=$,_a._transform._positionY+=K,_a._transform._positionZ+=E;var w=this._b1,ta=Math.sqrt(J*J+A*A+R*R),ra=ta*.5,la,va;if(ra<.5){var ua=ra*ra;la=.5*(1-ua*.16666666666666666+ua*ua*.008333333333333333),va=1-ua*.5+ua*ua*.041666666666666664}else la=Math.sin(ra)/ta,va=Math.cos(ra);var za,Ma,Xa;za=J*la,Ma=A*la,Xa=R*la;var Za,fa,ba,sa;Za=za,fa=Ma,ba=Xa,sa=va;var ha,ma,ya,Ba,pa=w._transform._rotation00,Ya=w._transform._rotation11,Ra=w._transform._rotation22,ga=pa+Ya+Ra,xa;ga>0?(xa=Math.sqrt(ga+1),Ba=.5*xa,xa=.5/xa,ha=(w._transform._rotation21-w._transform._rotation12)*xa,ma=(w._transform._rotation02-w._transform._rotation20)*xa,ya=(w._transform._rotation10-w._transform._rotation01)*xa):pa>Ya?pa>Ra?(xa=Math.sqrt(pa-Ya-Ra+1),ha=.5*xa,xa=.5/xa,ma=(w._transform._rotation01+w._transform._rotation10)*xa,ya=(w._transform._rotation02+w._transform._rotation20)*xa,Ba=(w._transform._rotation21-w._transform._rotation12)*xa):(xa=Math.sqrt(Ra-pa-Ya+1),ya=.5*xa,xa=.5/xa,ha=(w._transform._rotation02+w._transform._rotation20)*xa,ma=(w._transform._rotation12+w._transform._rotation21)*xa,Ba=(w._transform._rotation10-w._transform._rotation01)*xa):Ya>Ra?(xa=Math.sqrt(Ya-Ra-pa+1),ma=.5*xa,xa=.5/xa,ha=(w._transform._rotation01+w._transform._rotation10)*xa,ya=(w._transform._rotation12+w._transform._rotation21)*xa,Ba=(w._transform._rotation02-w._transform._rotation20)*xa):(xa=Math.sqrt(Ra-pa-Ya+1),ya=.5*xa,xa=.5/xa,ha=(w._transform._rotation02+w._transform._rotation20)*xa,ma=(w._transform._rotation12+w._transform._rotation21)*xa,Ba=(w._transform._rotation10-w._transform._rotation01)*xa),ha=sa*ha+Za*Ba+fa*ya-ba*ma,ma=sa*ma-Za*ya+fa*Ba+ba*ha,ya=sa*ya+Za*ma-fa*ha+ba*Ba,Ba=sa*Ba-Za*ha-fa*ma-ba*ya;var wa=ha*ha+ma*ma+ya*ya+Ba*Ba;wa>1e-32&&(wa=1/Math.sqrt(wa)),ha*=wa,ma*=wa,ya*=wa,Ba*=wa;var ka=ha,Pa=ma,zt=ya,Oa=Ba,Aa=2*ka,nt=2*Pa,Ea=2*zt,Fa=ka*Aa,da=Pa*nt,ft=zt*Ea,Wa=ka*nt,Ha=Pa*Ea,bt=ka*Ea,it=Oa*Aa,Ka=Oa*nt,_t=Oa*Ea;w._transform._rotation00=1-da-ft,w._transform._rotation01=Wa-_t,w._transform._rotation02=bt+Ka,w._transform._rotation10=Wa+_t,w._transform._rotation11=1-Fa-ft,w._transform._rotation12=Ha-it,w._transform._rotation20=bt-Ka,w._transform._rotation21=Ha+it,w._transform._rotation22=1-Fa-da;var gt,pt,Ga,rt,xt,Da,Ta,Na,Vt;gt=w._transform._rotation00*w._invLocalInertia00+w._transform._rotation01*w._invLocalInertia10+w._transform._rotation02*w._invLocalInertia20,pt=w._transform._rotation00*w._invLocalInertia01+w._transform._rotation01*w._invLocalInertia11+w._transform._rotation02*w._invLocalInertia21,Ga=w._transform._rotation00*w._invLocalInertia02+w._transform._rotation01*w._invLocalInertia12+w._transform._rotation02*w._invLocalInertia22,rt=w._transform._rotation10*w._invLocalInertia00+w._transform._rotation11*w._invLocalInertia10+w._transform._rotation12*w._invLocalInertia20,xt=w._transform._rotation10*w._invLocalInertia01+w._transform._rotation11*w._invLocalInertia11+w._transform._rotation12*w._invLocalInertia21,Da=w._transform._rotation10*w._invLocalInertia02+w._transform._rotation11*w._invLocalInertia12+w._transform._rotation12*w._invLocalInertia22,Ta=w._transform._rotation20*w._invLocalInertia00+w._transform._rotation21*w._invLocalInertia10+w._transform._rotation22*w._invLocalInertia20,Na=w._transform._rotation20*w._invLocalInertia01+w._transform._rotation21*w._invLocalInertia11+w._transform._rotation22*w._invLocalInertia21,Vt=w._transform._rotation20*w._invLocalInertia02+w._transform._rotation21*w._invLocalInertia12+w._transform._rotation22*w._invLocalInertia22,w._invInertia00=gt,w._invInertia01=pt,w._invInertia02=Ga,w._invInertia10=rt,w._invInertia11=xt,w._invInertia12=Da,w._invInertia20=Ta,w._invInertia21=Na,w._invInertia22=Vt;var Pt,st,Xt,Yt,Mt,Ia,O,Va,lt;Pt=w._invInertia00*w._transform._rotation00+w._invInertia01*w._transform._rotation01+w._invInertia02*w._transform._rotation02,st=w._invInertia00*w._transform._rotation10+w._invInertia01*w._transform._rotation11+w._invInertia02*w._transform._rotation12,Xt=w._invInertia00*w._transform._rotation20+w._invInertia01*w._transform._rotation21+w._invInertia02*w._transform._rotation22,Yt=w._invInertia10*w._transform._rotation00+w._invInertia11*w._transform._rotation01+w._invInertia12*w._transform._rotation02,Mt=w._invInertia10*w._transform._rotation10+w._invInertia11*w._transform._rotation11+w._invInertia12*w._transform._rotation12,Ia=w._invInertia10*w._transform._rotation20+w._invInertia11*w._transform._rotation21+w._invInertia12*w._transform._rotation22,O=w._invInertia20*w._transform._rotation00+w._invInertia21*w._transform._rotation01+w._invInertia22*w._transform._rotation02,Va=w._invInertia20*w._transform._rotation10+w._invInertia21*w._transform._rotation11+w._invInertia22*w._transform._rotation12,lt=w._invInertia20*w._transform._rotation20+w._invInertia21*w._transform._rotation21+w._invInertia22*w._transform._rotation22,w._invInertia00=Pt,w._invInertia01=st,w._invInertia02=Xt,w._invInertia10=Yt,w._invInertia11=Mt,w._invInertia12=Ia,w._invInertia20=O,w._invInertia21=Va,w._invInertia22=lt,w._invInertia00*=w._rotFactor.x,w._invInertia01*=w._rotFactor.x,w._invInertia02*=w._rotFactor.x,w._invInertia10*=w._rotFactor.y,w._invInertia11*=w._rotFactor.y,w._invInertia12*=w._rotFactor.y,w._invInertia20*=w._rotFactor.z,w._invInertia21*=w._rotFactor.z,w._invInertia22*=w._rotFactor.z;var P=this._b2,wt=Math.sqrt(U*U+G*G+D*D),At=wt*.5,dt,yt;if(At<.5){var kt=At*At;dt=.5*(1-kt*.16666666666666666+kt*kt*.008333333333333333),yt=1-kt*.5+kt*kt*.041666666666666664}else dt=Math.sin(At)/wt,yt=Math.cos(At);var mt,ht,ut;mt=U*dt,ht=G*dt,ut=D*dt;var Qa,et,Ca,vt;Qa=mt,et=ht,Ca=ut,vt=yt;var qa,at,Ua,tt,ct=P._transform._rotation00,Sa=P._transform._rotation11,Ja=P._transform._rotation22,ja=ct+Sa+Ja,La;ja>0?(La=Math.sqrt(ja+1),tt=.5*La,La=.5/La,qa=(P._transform._rotation21-P._transform._rotation12)*La,at=(P._transform._rotation02-P._transform._rotation20)*La,Ua=(P._transform._rotation10-P._transform._rotation01)*La):ct>Sa?ct>Ja?(La=Math.sqrt(ct-Sa-Ja+1),qa=.5*La,La=.5/La,at=(P._transform._rotation01+P._transform._rotation10)*La,Ua=(P._transform._rotation02+P._transform._rotation20)*La,tt=(P._transform._rotation21-P._transform._rotation12)*La):(La=Math.sqrt(Ja-ct-Sa+1),Ua=.5*La,La=.5/La,qa=(P._transform._rotation02+P._transform._rotation20)*La,at=(P._transform._rotation12+P._transform._rotation21)*La,tt=(P._transform._rotation10-P._transform._rotation01)*La):Sa>Ja?(La=Math.sqrt(Sa-Ja-ct+1),at=.5*La,La=.5/La,qa=(P._transform._rotation01+P._transform._rotation10)*La,Ua=(P._transform._rotation12+P._transform._rotation21)*La,tt=(P._transform._rotation02-P._transform._rotation20)*La):(La=Math.sqrt(Ja-ct-Sa+1),Ua=.5*La,La=.5/La,qa=(P._transform._rotation02+P._transform._rotation20)*La,at=(P._transform._rotation12+P._transform._rotation21)*La,tt=(P._transform._rotation10-P._transform._rotation01)*La),qa=vt*qa+Qa*tt+et*Ua-Ca*at,at=vt*at-Qa*Ua+et*tt+Ca*qa,Ua=vt*Ua+Qa*at-et*qa+Ca*tt,tt=vt*tt-Qa*qa-et*at-Ca*Ua;var ot=qa*qa+at*at+Ua*Ua+tt*tt;ot>1e-32&&(ot=1/Math.sqrt(ot)),qa*=ot,at*=ot,Ua*=ot,tt*=ot;var It=qa,oi=at,gi=Ua,ai=tt,Ct=2*It,_i=2*oi,Et=2*gi,St=It*Ct,Jt=oi*_i,Ki=gi*Et,vi=It*_i,li=oi*Et,ti=It*Et,Oi=ai*Ct,Xi=ai*_i,zi=ai*Et;P._transform._rotation00=1-Jt-Ki,P._transform._rotation01=vi-zi,P._transform._rotation02=ti+Xi,P._transform._rotation10=vi+zi,P._transform._rotation11=1-St-Ki,P._transform._rotation12=li-Oi,P._transform._rotation20=ti-Xi,P._transform._rotation21=li+Oi,P._transform._rotation22=1-St-Jt;var Zt,ri,Wt,ni,$i,Ut,ji,Ii,pr;Zt=P._transform._rotation00*P._invLocalInertia00+P._transform._rotation01*P._invLocalInertia10+P._transform._rotation02*P._invLocalInertia20,ri=P._transform._rotation00*P._invLocalInertia01+P._transform._rotation01*P._invLocalInertia11+P._transform._rotation02*P._invLocalInertia21,Wt=P._transform._rotation00*P._invLocalInertia02+P._transform._rotation01*P._invLocalInertia12+P._transform._rotation02*P._invLocalInertia22,ni=P._transform._rotation10*P._invLocalInertia00+P._transform._rotation11*P._invLocalInertia10+P._transform._rotation12*P._invLocalInertia20,$i=P._transform._rotation10*P._invLocalInertia01+P._transform._rotation11*P._invLocalInertia11+P._transform._rotation12*P._invLocalInertia21,Ut=P._transform._rotation10*P._invLocalInertia02+P._transform._rotation11*P._invLocalInertia12+P._transform._rotation12*P._invLocalInertia22,ji=P._transform._rotation20*P._invLocalInertia00+P._transform._rotation21*P._invLocalInertia10+P._transform._rotation22*P._invLocalInertia20,Ii=P._transform._rotation20*P._invLocalInertia01+P._transform._rotation21*P._invLocalInertia11+P._transform._rotation22*P._invLocalInertia21,pr=P._transform._rotation20*P._invLocalInertia02+P._transform._rotation21*P._invLocalInertia12+P._transform._rotation22*P._invLocalInertia22,P._invInertia00=Zt,P._invInertia01=ri,P._invInertia02=Wt,P._invInertia10=ni,P._invInertia11=$i,P._invInertia12=Ut,P._invInertia20=ji,P._invInertia21=Ii,P._invInertia22=pr;var Wi,Lt,jt,Tt,bi,Mi,vr,qt,fi;Wi=P._invInertia00*P._transform._rotation00+P._invInertia01*P._transform._rotation01+P._invInertia02*P._transform._rotation02,Lt=P._invInertia00*P._transform._rotation10+P._invInertia01*P._transform._rotation11+P._invInertia02*P._transform._rotation12,jt=P._invInertia00*P._transform._rotation20+P._invInertia01*P._transform._rotation21+P._invInertia02*P._transform._rotation22,Tt=P._invInertia10*P._transform._rotation00+P._invInertia11*P._transform._rotation01+P._invInertia12*P._transform._rotation02,bi=P._invInertia10*P._transform._rotation10+P._invInertia11*P._transform._rotation11+P._invInertia12*P._transform._rotation12,Mi=P._invInertia10*P._transform._rotation20+P._invInertia11*P._transform._rotation21+P._invInertia12*P._transform._rotation22,vr=P._invInertia20*P._transform._rotation00+P._invInertia21*P._transform._rotation01+P._invInertia22*P._transform._rotation02,qt=P._invInertia20*P._transform._rotation10+P._invInertia21*P._transform._rotation11+P._invInertia22*P._transform._rotation12,fi=P._invInertia20*P._transform._rotation20+P._invInertia21*P._transform._rotation21+P._invInertia22*P._transform._rotation22,P._invInertia00=Wi,P._invInertia01=Lt,P._invInertia02=jt,P._invInertia10=Tt,P._invInertia11=bi,P._invInertia12=Mi,P._invInertia20=vr,P._invInertia21=qt,P._invInertia22=fi,P._invInertia00*=P._rotFactor.x,P._invInertia01*=P._rotFactor.x,P._invInertia02*=P._rotFactor.x,P._invInertia10*=P._rotFactor.y,P._invInertia11*=P._rotFactor.y,P._invInertia12*=P._rotFactor.y,P._invInertia20*=P._rotFactor.z,P._invInertia21*=P._rotFactor.z,P._invInertia22*=P._rotFactor.z}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}};u.dynamics.rigidbody||(u.dynamics.rigidbody={});u.dynamics.rigidbody.MassData=class{constructor(){this.mass=0,this.localInertia=new u.common.Mat3}};u.dynamics.rigidbody.RigidBody=class{constructor(a){this._next=null,this._prev=null,this._shapeList=null,this._shapeListLast=null,this._numShapes=0,this._contactLinkList=null,this._contactLinkListLast=null,this._numContactLinks=0,this._jointLinkList=null,this._jointLinkListLast=null,this._numJointLinks=0;var t=a.linearVelocity;this._velX=t.x,this._velY=t.y,this._velZ=t.z;var i=a.angularVelocity;this._angVelX=i.x,this._angVelY=i.y,this._angVelZ=i.z,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._ptransform=new u.common.Transform,this._transform=new u.common.Transform;var o=a.position;this._ptransform._positionX=o.x,this._ptransform._positionY=o.y,this._ptransform._positionZ=o.z;var r=a.rotation;this._ptransform._rotation00=r.e00,this._ptransform._rotation01=r.e01,this._ptransform._rotation02=r.e02,this._ptransform._rotation10=r.e10,this._ptransform._rotation11=r.e11,this._ptransform._rotation12=r.e12,this._ptransform._rotation20=r.e20,this._ptransform._rotation21=r.e21,this._ptransform._rotation22=r.e22;var e=this._transform,_=this._ptransform;e._positionX=_._positionX,e._positionY=_._positionY,e._positionZ=_._positionZ,e._rotation00=_._rotation00,e._rotation01=_._rotation01,e._rotation02=_._rotation02,e._rotation10=_._rotation10,e._rotation11=_._rotation11,e._rotation12=_._rotation12,e._rotation20=_._rotation20,e._rotation21=_._rotation21,e._rotation22=_._rotation22,this._type=a.type,this._sleepTime=0,this._sleeping=!1,this._autoSleep=a.autoSleep,this._mass=0,this._invMass=0,this._localInertia00=0,this._localInertia01=0,this._localInertia02=0,this._localInertia10=0,this._localInertia11=0,this._localInertia12=0,this._localInertia20=0,this._localInertia21=0,this._localInertia22=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._invInertia00=0,this._invInertia01=0,this._invInertia02=0,this._invInertia10=0,this._invInertia11=0,this._invInertia12=0,this._invInertia20=0,this._invInertia21=0,this._invInertia22=0,this._linearDamping=a.linearDamping,this._angularDamping=a.angularDamping,this._forceX=0,this._forceY=0,this._forceZ=0,this._torqueX=0,this._torqueY=0,this._torqueZ=0,this._linearContactImpulseX=0,this._linearContactImpulseY=0,this._linearContactImpulseZ=0,this._angularContactImpulseX=0,this._angularContactImpulseY=0,this._angularContactImpulseZ=0,this._rotFactor=new u.common.Vec3(1,1,1),this._addedToIsland=!1,this._gravityScale=1,this._world=null}_integrate(a){switch(this._type){case 1:this._velX=0,this._velY=0,this._velZ=0,this._angVelX=0,this._angVelY=0,this._angVelZ=0,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:var t,i,o,r,e,_;t=this._velX*a,i=this._velY*a,o=this._velZ*a,r=this._angVelX*a,e=this._angVelY*a,_=this._angVelZ*a;var h=t*t+i*i+o*o,v=r*r+e*e+_*_;if(h==0&&v==0)return;if(h>u.common.Setting.maxTranslationPerStep*u.common.Setting.maxTranslationPerStep){var s=u.common.Setting.maxTranslationPerStep/Math.sqrt(h);this._velX*=s,this._velY*=s,this._velZ*=s,t*=s,i*=s,o*=s}if(v>u.common.Setting.maxRotationPerStep*u.common.Setting.maxRotationPerStep){var l=u.common.Setting.maxRotationPerStep/Math.sqrt(v);this._angVelX*=l,this._angVelY*=l,this._angVelZ*=l,r*=l,e*=l,_*=l}this._transform._positionX+=t,this._transform._positionY+=i,this._transform._positionZ+=o;var x=Math.sqrt(r*r+e*e+_*_),b=x*.5,f,n;if(b<.5){var c=b*b;f=.5*(1-c*.16666666666666666+c*c*.008333333333333333),n=1-c*.5+c*c*.041666666666666664}else f=Math.sin(b)/x,n=Math.cos(b);var z,p,y;z=r*f,p=e*f,y=_*f;var V,M,I,k;V=z,M=p,I=y,k=n;var X,L,m,g,N=this._transform._rotation00,d=this._transform._rotation11,F=this._transform._rotation22,S=N+d+F,Y;S>0?(Y=Math.sqrt(S+1),g=.5*Y,Y=.5/Y,X=(this._transform._rotation21-this._transform._rotation12)*Y,L=(this._transform._rotation02-this._transform._rotation20)*Y,m=(this._transform._rotation10-this._transform._rotation01)*Y):N>d?N>F?(Y=Math.sqrt(N-d-F+1),X=.5*Y,Y=.5/Y,L=(this._transform._rotation01+this._transform._rotation10)*Y,m=(this._transform._rotation02+this._transform._rotation20)*Y,g=(this._transform._rotation21-this._transform._rotation12)*Y):(Y=Math.sqrt(F-N-d+1),m=.5*Y,Y=.5/Y,X=(this._transform._rotation02+this._transform._rotation20)*Y,L=(this._transform._rotation12+this._transform._rotation21)*Y,g=(this._transform._rotation10-this._transform._rotation01)*Y):d>F?(Y=Math.sqrt(d-F-N+1),L=.5*Y,Y=.5/Y,X=(this._transform._rotation01+this._transform._rotation10)*Y,m=(this._transform._rotation12+this._transform._rotation21)*Y,g=(this._transform._rotation02-this._transform._rotation20)*Y):(Y=Math.sqrt(F-N-d+1),m=.5*Y,Y=.5/Y,X=(this._transform._rotation02+this._transform._rotation20)*Y,L=(this._transform._rotation12+this._transform._rotation21)*Y,g=(this._transform._rotation10-this._transform._rotation01)*Y),X=k*X+V*g+M*m-I*L,L=k*L-V*m+M*g+I*X,m=k*m+V*L-M*X+I*g,g=k*g-V*X-M*L-I*m;var Q=X*X+L*L+m*m+g*g;Q>1e-32&&(Q=1/Math.sqrt(Q)),X*=Q,L*=Q,m*=Q,g*=Q;var C=X,B=L,Z=m,$=g,K=2*C,E=2*B,J=2*Z,A=C*K,R=B*E,U=Z*J,G=C*E,D=B*J,H=C*J,j=$*K,ia=$*E,ea=$*J;this._transform._rotation00=1-R-U,this._transform._rotation01=G-ea,this._transform._rotation02=H+ia,this._transform._rotation10=G+ea,this._transform._rotation11=1-A-U,this._transform._rotation12=D-j,this._transform._rotation20=H-ia,this._transform._rotation21=D+j,this._transform._rotation22=1-A-R;var W,q,na,oa,aa,T,ca,_a,w;W=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,q=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,na=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,oa=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,aa=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,T=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,ca=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_a=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,w=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=W,this._invInertia01=q,this._invInertia02=na,this._invInertia10=oa,this._invInertia11=aa,this._invInertia12=T,this._invInertia20=ca,this._invInertia21=_a,this._invInertia22=w;var ta,ra,la,va,ua,za,Ma,Xa,Za;ta=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,ra=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,la=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,va=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,ua=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,za=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,Ma=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,Xa=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Za=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=ta,this._invInertia01=ra,this._invInertia02=la,this._invInertia10=va,this._invInertia11=ua,this._invInertia12=za,this._invInertia20=Ma,this._invInertia21=Xa,this._invInertia22=Za,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;break}}_integratePseudoVelocity(){var a=this._pseudoVelX*this._pseudoVelX+this._pseudoVelY*this._pseudoVelY+this._pseudoVelZ*this._pseudoVelZ,t=this._angPseudoVelX*this._angPseudoVelX+this._angPseudoVelY*this._angPseudoVelY+this._angPseudoVelZ*this._angPseudoVelZ;if(!(a==0&&t==0))switch(this._type){case 1:this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:var i,o,r,e,_,h;i=this._pseudoVelX,o=this._pseudoVelY,r=this._pseudoVelZ,e=this._angPseudoVelX,_=this._angPseudoVelY,h=this._angPseudoVelZ,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._transform._positionX+=i,this._transform._positionY+=o,this._transform._positionZ+=r;var v=Math.sqrt(e*e+_*_+h*h),s=v*.5,l,x;if(s<.5){var b=s*s;l=.5*(1-b*.16666666666666666+b*b*.008333333333333333),x=1-b*.5+b*b*.041666666666666664}else l=Math.sin(s)/v,x=Math.cos(s);var f,n,c;f=e*l,n=_*l,c=h*l;var z,p,y,V;z=f,p=n,y=c,V=x;var M,I,k,X,L=this._transform._rotation00,m=this._transform._rotation11,g=this._transform._rotation22,N=L+m+g,d;N>0?(d=Math.sqrt(N+1),X=.5*d,d=.5/d,M=(this._transform._rotation21-this._transform._rotation12)*d,I=(this._transform._rotation02-this._transform._rotation20)*d,k=(this._transform._rotation10-this._transform._rotation01)*d):L>m?L>g?(d=Math.sqrt(L-m-g+1),M=.5*d,d=.5/d,I=(this._transform._rotation01+this._transform._rotation10)*d,k=(this._transform._rotation02+this._transform._rotation20)*d,X=(this._transform._rotation21-this._transform._rotation12)*d):(d=Math.sqrt(g-L-m+1),k=.5*d,d=.5/d,M=(this._transform._rotation02+this._transform._rotation20)*d,I=(this._transform._rotation12+this._transform._rotation21)*d,X=(this._transform._rotation10-this._transform._rotation01)*d):m>g?(d=Math.sqrt(m-g-L+1),I=.5*d,d=.5/d,M=(this._transform._rotation01+this._transform._rotation10)*d,k=(this._transform._rotation12+this._transform._rotation21)*d,X=(this._transform._rotation02-this._transform._rotation20)*d):(d=Math.sqrt(g-L-m+1),k=.5*d,d=.5/d,M=(this._transform._rotation02+this._transform._rotation20)*d,I=(this._transform._rotation12+this._transform._rotation21)*d,X=(this._transform._rotation10-this._transform._rotation01)*d),M=V*M+z*X+p*k-y*I,I=V*I-z*k+p*X+y*M,k=V*k+z*I-p*M+y*X,X=V*X-z*M-p*I-y*k;var F=M*M+I*I+k*k+X*X;F>1e-32&&(F=1/Math.sqrt(F)),M*=F,I*=F,k*=F,X*=F;var S=M,Y=I,Q=k,C=X,B=2*S,Z=2*Y,$=2*Q,K=S*B,E=Y*Z,J=Q*$,A=S*Z,R=Y*$,U=S*$,G=C*B,D=C*Z,H=C*$;this._transform._rotation00=1-E-J,this._transform._rotation01=A-H,this._transform._rotation02=U+D,this._transform._rotation10=A+H,this._transform._rotation11=1-K-J,this._transform._rotation12=R-G,this._transform._rotation20=U-D,this._transform._rotation21=R+G,this._transform._rotation22=1-K-E;var j,ia,ea,W,q,na,oa,aa,T;j=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,ia=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,ea=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,W=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,q=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,na=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,oa=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,aa=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,T=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=j,this._invInertia01=ia,this._invInertia02=ea,this._invInertia10=W,this._invInertia11=q,this._invInertia12=na,this._invInertia20=oa,this._invInertia21=aa,this._invInertia22=T;var ca,_a,w,ta,ra,la,va,ua,za;ca=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,_a=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,w=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,ta=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,ra=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,la=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,va=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,ua=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,za=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=ca,this._invInertia01=_a,this._invInertia02=w,this._invInertia10=ta,this._invInertia11=ra,this._invInertia12=la,this._invInertia20=va,this._invInertia21=ua,this._invInertia22=za,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;break}}updateMass(){var a,t,i,o,r,e,_,h,v;a=0,t=0,i=0,o=0,r=0,e=0,_=0,h=0,v=0;for(var s=0,l=this._shapeList;l!=null;){var x=l._next,b=l._geom;b._updateMass();var f=l._density*b._volume,n,c,z,p,y,V,M,I,k,X,L,m,g,N,d,F,S,Y;X=l._localTransform._rotation00*b._inertiaCoeff00+l._localTransform._rotation01*b._inertiaCoeff10+l._localTransform._rotation02*b._inertiaCoeff20,L=l._localTransform._rotation00*b._inertiaCoeff01+l._localTransform._rotation01*b._inertiaCoeff11+l._localTransform._rotation02*b._inertiaCoeff21,m=l._localTransform._rotation00*b._inertiaCoeff02+l._localTransform._rotation01*b._inertiaCoeff12+l._localTransform._rotation02*b._inertiaCoeff22,g=l._localTransform._rotation10*b._inertiaCoeff00+l._localTransform._rotation11*b._inertiaCoeff10+l._localTransform._rotation12*b._inertiaCoeff20,N=l._localTransform._rotation10*b._inertiaCoeff01+l._localTransform._rotation11*b._inertiaCoeff11+l._localTransform._rotation12*b._inertiaCoeff21,d=l._localTransform._rotation10*b._inertiaCoeff02+l._localTransform._rotation11*b._inertiaCoeff12+l._localTransform._rotation12*b._inertiaCoeff22,F=l._localTransform._rotation20*b._inertiaCoeff00+l._localTransform._rotation21*b._inertiaCoeff10+l._localTransform._rotation22*b._inertiaCoeff20,S=l._localTransform._rotation20*b._inertiaCoeff01+l._localTransform._rotation21*b._inertiaCoeff11+l._localTransform._rotation22*b._inertiaCoeff21,Y=l._localTransform._rotation20*b._inertiaCoeff02+l._localTransform._rotation21*b._inertiaCoeff12+l._localTransform._rotation22*b._inertiaCoeff22,n=X,c=L,z=m,p=g,y=N,V=d,M=F,I=S,k=Y;var Q,C,B,Z,$,K,E,J,A;Q=n*l._localTransform._rotation00+c*l._localTransform._rotation01+z*l._localTransform._rotation02,C=n*l._localTransform._rotation10+c*l._localTransform._rotation11+z*l._localTransform._rotation12,B=n*l._localTransform._rotation20+c*l._localTransform._rotation21+z*l._localTransform._rotation22,Z=p*l._localTransform._rotation00+y*l._localTransform._rotation01+V*l._localTransform._rotation02,$=p*l._localTransform._rotation10+y*l._localTransform._rotation11+V*l._localTransform._rotation12,K=p*l._localTransform._rotation20+y*l._localTransform._rotation21+V*l._localTransform._rotation22,E=M*l._localTransform._rotation00+I*l._localTransform._rotation01+k*l._localTransform._rotation02,J=M*l._localTransform._rotation10+I*l._localTransform._rotation11+k*l._localTransform._rotation12,A=M*l._localTransform._rotation20+I*l._localTransform._rotation21+k*l._localTransform._rotation22,n=Q,c=C,z=B,p=Z,y=$,V=K,M=E,I=J,k=A,n*=f,c*=f,z*=f,p*=f,y*=f,V*=f,M*=f,I*=f,k*=f;var R,U,G,D,H,j,ia,ea,W,q=l._localTransform._positionX*l._localTransform._positionX,na=l._localTransform._positionY*l._localTransform._positionY,oa=l._localTransform._positionZ*l._localTransform._positionZ,aa=-l._localTransform._positionX*l._localTransform._positionY,T=-l._localTransform._positionY*l._localTransform._positionZ,ca=-l._localTransform._positionZ*l._localTransform._positionX;R=na+oa,U=aa,G=ca,D=aa,H=q+oa,j=T,ia=ca,ea=T,W=q+na,n+=R*f,c+=U*f,z+=G*f,p+=D*f,y+=H*f,V+=j*f,M+=ia*f,I+=ea*f,k+=W*f,s+=f,a+=n,t+=c,i+=z,o+=p,r+=y,e+=V,_+=M,h+=I,v+=k,l=x}this._mass=s,this._localInertia00=a,this._localInertia01=t,this._localInertia02=i,this._localInertia10=o,this._localInertia11=r,this._localInertia12=e,this._localInertia20=_,this._localInertia21=h,this._localInertia22=v;var _a=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,w=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,ta=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,ra=this._localInertia00*_a-this._localInertia01*w+this._localInertia02*ta;if(this._mass>0&&ra>0&&this._type==0){this._invMass=1/this._mass;var la=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,va=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,ua=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,za=this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21,Ma=this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20,Xa=this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20,Za=this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11,fa=this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10,ba=this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10,sa=this._localInertia00*la-this._localInertia01*va+this._localInertia02*ua;(sa<-1e-32||sa>1e-32)&&(sa=1/sa),this._invLocalInertia00=la*sa,this._invLocalInertia01=-za*sa,this._invLocalInertia02=Za*sa,this._invLocalInertia10=-va*sa,this._invLocalInertia11=Ma*sa,this._invLocalInertia12=-fa*sa,this._invLocalInertia20=ua*sa,this._invLocalInertia21=-Xa*sa,this._invLocalInertia22=ba*sa,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._type==0&&(this._type=1);var ha,ma,ya,Ba,pa,Ya,Ra,ga,xa;ha=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,ma=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,ya=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,Ba=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,pa=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,Ya=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,Ra=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,ga=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,xa=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=ha,this._invInertia01=ma,this._invInertia02=ya,this._invInertia10=Ba,this._invInertia11=pa,this._invInertia12=Ya,this._invInertia20=Ra,this._invInertia21=ga,this._invInertia22=xa;var wa,ka,Pa,zt,Oa,Aa,nt,Ea,Fa;wa=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,ka=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,Pa=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,zt=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,Oa=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,Aa=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,nt=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,Ea=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Fa=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=wa,this._invInertia01=ka,this._invInertia02=Pa,this._invInertia10=zt,this._invInertia11=Oa,this._invInertia12=Aa,this._invInertia20=nt,this._invInertia21=Ea,this._invInertia22=Fa,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getPosition(){var a=new u.common.Vec3,t=a;return t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ,a}getPositionTo(a){var t=a;t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ}setPosition(a){var t=a;this._transform._positionX=t.x,this._transform._positionY=t.y,this._transform._positionZ=t.z;var i=this._ptransform,o=this._transform;i._positionX=o._positionX,i._positionY=o._positionY,i._positionZ=o._positionZ,i._rotation00=o._rotation00,i._rotation01=o._rotation01,i._rotation02=o._rotation02,i._rotation10=o._rotation10,i._rotation11=o._rotation11,i._rotation12=o._rotation12,i._rotation20=o._rotation20,i._rotation21=o._rotation21,i._rotation22=o._rotation22;for(var r=this._shapeList;r!=null;){var e=r._next,_=r._ptransform,h=r._localTransform,v=this._ptransform,s,l,x,b,f,n,c,z,p;s=v._rotation00*h._rotation00+v._rotation01*h._rotation10+v._rotation02*h._rotation20,l=v._rotation00*h._rotation01+v._rotation01*h._rotation11+v._rotation02*h._rotation21,x=v._rotation00*h._rotation02+v._rotation01*h._rotation12+v._rotation02*h._rotation22,b=v._rotation10*h._rotation00+v._rotation11*h._rotation10+v._rotation12*h._rotation20,f=v._rotation10*h._rotation01+v._rotation11*h._rotation11+v._rotation12*h._rotation21,n=v._rotation10*h._rotation02+v._rotation11*h._rotation12+v._rotation12*h._rotation22,c=v._rotation20*h._rotation00+v._rotation21*h._rotation10+v._rotation22*h._rotation20,z=v._rotation20*h._rotation01+v._rotation21*h._rotation11+v._rotation22*h._rotation21,p=v._rotation20*h._rotation02+v._rotation21*h._rotation12+v._rotation22*h._rotation22,_._rotation00=s,_._rotation01=l,_._rotation02=x,_._rotation10=b,_._rotation11=f,_._rotation12=n,_._rotation20=c,_._rotation21=z,_._rotation22=p;var y,V,M;y=v._rotation00*h._positionX+v._rotation01*h._positionY+v._rotation02*h._positionZ,V=v._rotation10*h._positionX+v._rotation11*h._positionY+v._rotation12*h._positionZ,M=v._rotation20*h._positionX+v._rotation21*h._positionY+v._rotation22*h._positionZ,_._positionX=y,_._positionY=V,_._positionZ=M,_._positionX+=v._positionX,_._positionY+=v._positionY,_._positionZ+=v._positionZ;var I=r._transform,k=r._localTransform,X=this._transform,L,m,g,N,d,F,S,Y,Q;L=X._rotation00*k._rotation00+X._rotation01*k._rotation10+X._rotation02*k._rotation20,m=X._rotation00*k._rotation01+X._rotation01*k._rotation11+X._rotation02*k._rotation21,g=X._rotation00*k._rotation02+X._rotation01*k._rotation12+X._rotation02*k._rotation22,N=X._rotation10*k._rotation00+X._rotation11*k._rotation10+X._rotation12*k._rotation20,d=X._rotation10*k._rotation01+X._rotation11*k._rotation11+X._rotation12*k._rotation21,F=X._rotation10*k._rotation02+X._rotation11*k._rotation12+X._rotation12*k._rotation22,S=X._rotation20*k._rotation00+X._rotation21*k._rotation10+X._rotation22*k._rotation20,Y=X._rotation20*k._rotation01+X._rotation21*k._rotation11+X._rotation22*k._rotation21,Q=X._rotation20*k._rotation02+X._rotation21*k._rotation12+X._rotation22*k._rotation22,I._rotation00=L,I._rotation01=m,I._rotation02=g,I._rotation10=N,I._rotation11=d,I._rotation12=F,I._rotation20=S,I._rotation21=Y,I._rotation22=Q;var C,B,Z;C=X._rotation00*k._positionX+X._rotation01*k._positionY+X._rotation02*k._positionZ,B=X._rotation10*k._positionX+X._rotation11*k._positionY+X._rotation12*k._positionZ,Z=X._rotation20*k._positionX+X._rotation21*k._positionY+X._rotation22*k._positionZ,I._positionX=C,I._positionY=B,I._positionZ=Z,I._positionX+=X._positionX,I._positionY+=X._positionY,I._positionZ+=X._positionZ;var $,K,E,J,A,R;if(r._geom._computeAabb(r._aabb,r._ptransform),$=r._aabb._minX,K=r._aabb._minY,E=r._aabb._minZ,J=r._aabb._maxX,A=r._aabb._maxY,R=r._aabb._maxZ,r._geom._computeAabb(r._aabb,r._transform),r._aabb._minX=$<r._aabb._minX?$:r._aabb._minX,r._aabb._minY=K<r._aabb._minY?K:r._aabb._minY,r._aabb._minZ=E<r._aabb._minZ?E:r._aabb._minZ,r._aabb._maxX=J>r._aabb._maxX?J:r._aabb._maxX,r._aabb._maxY=A>r._aabb._maxY?A:r._aabb._maxY,r._aabb._maxZ=R>r._aabb._maxZ?R:r._aabb._maxZ,r._proxy!=null){var U,G,D;U=r._transform._positionX-r._ptransform._positionX,G=r._transform._positionY-r._ptransform._positionY,D=r._transform._positionZ-r._ptransform._positionZ;var H=r.displacement;H.x=U,H.y=G,H.z=D,r._rigidBody._world._broadPhase.moveProxy(r._proxy,r._aabb,r.displacement)}r=e}this._sleeping=!1,this._sleepTime=0}translate(a){var t,i,o,r=a;t=r.x,i=r.y,o=r.z,this._transform._positionX+=t,this._transform._positionY+=i,this._transform._positionZ+=o;var e=this._ptransform,_=this._transform;e._positionX=_._positionX,e._positionY=_._positionY,e._positionZ=_._positionZ,e._rotation00=_._rotation00,e._rotation01=_._rotation01,e._rotation02=_._rotation02,e._rotation10=_._rotation10,e._rotation11=_._rotation11,e._rotation12=_._rotation12,e._rotation20=_._rotation20,e._rotation21=_._rotation21,e._rotation22=_._rotation22;for(var h=this._shapeList;h!=null;){var v=h._next,s=h._ptransform,l=h._localTransform,x=this._ptransform,b,f,n,c,z,p,y,V,M;b=x._rotation00*l._rotation00+x._rotation01*l._rotation10+x._rotation02*l._rotation20,f=x._rotation00*l._rotation01+x._rotation01*l._rotation11+x._rotation02*l._rotation21,n=x._rotation00*l._rotation02+x._rotation01*l._rotation12+x._rotation02*l._rotation22,c=x._rotation10*l._rotation00+x._rotation11*l._rotation10+x._rotation12*l._rotation20,z=x._rotation10*l._rotation01+x._rotation11*l._rotation11+x._rotation12*l._rotation21,p=x._rotation10*l._rotation02+x._rotation11*l._rotation12+x._rotation12*l._rotation22,y=x._rotation20*l._rotation00+x._rotation21*l._rotation10+x._rotation22*l._rotation20,V=x._rotation20*l._rotation01+x._rotation21*l._rotation11+x._rotation22*l._rotation21,M=x._rotation20*l._rotation02+x._rotation21*l._rotation12+x._rotation22*l._rotation22,s._rotation00=b,s._rotation01=f,s._rotation02=n,s._rotation10=c,s._rotation11=z,s._rotation12=p,s._rotation20=y,s._rotation21=V,s._rotation22=M;var I,k,X;I=x._rotation00*l._positionX+x._rotation01*l._positionY+x._rotation02*l._positionZ,k=x._rotation10*l._positionX+x._rotation11*l._positionY+x._rotation12*l._positionZ,X=x._rotation20*l._positionX+x._rotation21*l._positionY+x._rotation22*l._positionZ,s._positionX=I,s._positionY=k,s._positionZ=X,s._positionX+=x._positionX,s._positionY+=x._positionY,s._positionZ+=x._positionZ;var L=h._transform,m=h._localTransform,g=this._transform,N,d,F,S,Y,Q,C,B,Z;N=g._rotation00*m._rotation00+g._rotation01*m._rotation10+g._rotation02*m._rotation20,d=g._rotation00*m._rotation01+g._rotation01*m._rotation11+g._rotation02*m._rotation21,F=g._rotation00*m._rotation02+g._rotation01*m._rotation12+g._rotation02*m._rotation22,S=g._rotation10*m._rotation00+g._rotation11*m._rotation10+g._rotation12*m._rotation20,Y=g._rotation10*m._rotation01+g._rotation11*m._rotation11+g._rotation12*m._rotation21,Q=g._rotation10*m._rotation02+g._rotation11*m._rotation12+g._rotation12*m._rotation22,C=g._rotation20*m._rotation00+g._rotation21*m._rotation10+g._rotation22*m._rotation20,B=g._rotation20*m._rotation01+g._rotation21*m._rotation11+g._rotation22*m._rotation21,Z=g._rotation20*m._rotation02+g._rotation21*m._rotation12+g._rotation22*m._rotation22,L._rotation00=N,L._rotation01=d,L._rotation02=F,L._rotation10=S,L._rotation11=Y,L._rotation12=Q,L._rotation20=C,L._rotation21=B,L._rotation22=Z;var $,K,E;$=g._rotation00*m._positionX+g._rotation01*m._positionY+g._rotation02*m._positionZ,K=g._rotation10*m._positionX+g._rotation11*m._positionY+g._rotation12*m._positionZ,E=g._rotation20*m._positionX+g._rotation21*m._positionY+g._rotation22*m._positionZ,L._positionX=$,L._positionY=K,L._positionZ=E,L._positionX+=g._positionX,L._positionY+=g._positionY,L._positionZ+=g._positionZ;var J,A,R,U,G,D;if(h._geom._computeAabb(h._aabb,h._ptransform),J=h._aabb._minX,A=h._aabb._minY,R=h._aabb._minZ,U=h._aabb._maxX,G=h._aabb._maxY,D=h._aabb._maxZ,h._geom._computeAabb(h._aabb,h._transform),h._aabb._minX=J<h._aabb._minX?J:h._aabb._minX,h._aabb._minY=A<h._aabb._minY?A:h._aabb._minY,h._aabb._minZ=R<h._aabb._minZ?R:h._aabb._minZ,h._aabb._maxX=U>h._aabb._maxX?U:h._aabb._maxX,h._aabb._maxY=G>h._aabb._maxY?G:h._aabb._maxY,h._aabb._maxZ=D>h._aabb._maxZ?D:h._aabb._maxZ,h._proxy!=null){var H,j,ia;H=h._transform._positionX-h._ptransform._positionX,j=h._transform._positionY-h._ptransform._positionY,ia=h._transform._positionZ-h._ptransform._positionZ;var ea=h.displacement;ea.x=H,ea.y=j,ea.z=ia,h._rigidBody._world._broadPhase.moveProxy(h._proxy,h._aabb,h.displacement)}h=v}this._sleeping=!1,this._sleepTime=0}getRotation(){var a=new u.common.Mat3,t=a;return t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22,a}getRotationTo(a){var t=a;t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22}setRotation(a){var t=a;this._transform._rotation00=t.e00,this._transform._rotation01=t.e01,this._transform._rotation02=t.e02,this._transform._rotation10=t.e10,this._transform._rotation11=t.e11,this._transform._rotation12=t.e12,this._transform._rotation20=t.e20,this._transform._rotation21=t.e21,this._transform._rotation22=t.e22;var i,o,r,e,_,h,v,s,l;i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,o=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,r=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,e=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,_=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,h=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,v=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,s=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=o,this._invInertia02=r,this._invInertia10=e,this._invInertia11=_,this._invInertia12=h,this._invInertia20=v,this._invInertia21=s,this._invInertia22=l;var x,b,f,n,c,z,p,y,V;x=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,b=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,f=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,n=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,c=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,z=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,p=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,y=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,V=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=x,this._invInertia01=b,this._invInertia02=f,this._invInertia10=n,this._invInertia11=c,this._invInertia12=z,this._invInertia20=p,this._invInertia21=y,this._invInertia22=V,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var M=this._ptransform,I=this._transform;M._positionX=I._positionX,M._positionY=I._positionY,M._positionZ=I._positionZ,M._rotation00=I._rotation00,M._rotation01=I._rotation01,M._rotation02=I._rotation02,M._rotation10=I._rotation10,M._rotation11=I._rotation11,M._rotation12=I._rotation12,M._rotation20=I._rotation20,M._rotation21=I._rotation21,M._rotation22=I._rotation22;for(var k=this._shapeList;k!=null;){var X=k._next,L=k._ptransform,m=k._localTransform,g=this._ptransform,N,d,F,S,Y,Q,C,B,Z;N=g._rotation00*m._rotation00+g._rotation01*m._rotation10+g._rotation02*m._rotation20,d=g._rotation00*m._rotation01+g._rotation01*m._rotation11+g._rotation02*m._rotation21,F=g._rotation00*m._rotation02+g._rotation01*m._rotation12+g._rotation02*m._rotation22,S=g._rotation10*m._rotation00+g._rotation11*m._rotation10+g._rotation12*m._rotation20,Y=g._rotation10*m._rotation01+g._rotation11*m._rotation11+g._rotation12*m._rotation21,Q=g._rotation10*m._rotation02+g._rotation11*m._rotation12+g._rotation12*m._rotation22,C=g._rotation20*m._rotation00+g._rotation21*m._rotation10+g._rotation22*m._rotation20,B=g._rotation20*m._rotation01+g._rotation21*m._rotation11+g._rotation22*m._rotation21,Z=g._rotation20*m._rotation02+g._rotation21*m._rotation12+g._rotation22*m._rotation22,L._rotation00=N,L._rotation01=d,L._rotation02=F,L._rotation10=S,L._rotation11=Y,L._rotation12=Q,L._rotation20=C,L._rotation21=B,L._rotation22=Z;var $,K,E;$=g._rotation00*m._positionX+g._rotation01*m._positionY+g._rotation02*m._positionZ,K=g._rotation10*m._positionX+g._rotation11*m._positionY+g._rotation12*m._positionZ,E=g._rotation20*m._positionX+g._rotation21*m._positionY+g._rotation22*m._positionZ,L._positionX=$,L._positionY=K,L._positionZ=E,L._positionX+=g._positionX,L._positionY+=g._positionY,L._positionZ+=g._positionZ;var J=k._transform,A=k._localTransform,R=this._transform,U,G,D,H,j,ia,ea,W,q;U=R._rotation00*A._rotation00+R._rotation01*A._rotation10+R._rotation02*A._rotation20,G=R._rotation00*A._rotation01+R._rotation01*A._rotation11+R._rotation02*A._rotation21,D=R._rotation00*A._rotation02+R._rotation01*A._rotation12+R._rotation02*A._rotation22,H=R._rotation10*A._rotation00+R._rotation11*A._rotation10+R._rotation12*A._rotation20,j=R._rotation10*A._rotation01+R._rotation11*A._rotation11+R._rotation12*A._rotation21,ia=R._rotation10*A._rotation02+R._rotation11*A._rotation12+R._rotation12*A._rotation22,ea=R._rotation20*A._rotation00+R._rotation21*A._rotation10+R._rotation22*A._rotation20,W=R._rotation20*A._rotation01+R._rotation21*A._rotation11+R._rotation22*A._rotation21,q=R._rotation20*A._rotation02+R._rotation21*A._rotation12+R._rotation22*A._rotation22,J._rotation00=U,J._rotation01=G,J._rotation02=D,J._rotation10=H,J._rotation11=j,J._rotation12=ia,J._rotation20=ea,J._rotation21=W,J._rotation22=q;var na,oa,aa;na=R._rotation00*A._positionX+R._rotation01*A._positionY+R._rotation02*A._positionZ,oa=R._rotation10*A._positionX+R._rotation11*A._positionY+R._rotation12*A._positionZ,aa=R._rotation20*A._positionX+R._rotation21*A._positionY+R._rotation22*A._positionZ,J._positionX=na,J._positionY=oa,J._positionZ=aa,J._positionX+=R._positionX,J._positionY+=R._positionY,J._positionZ+=R._positionZ;var T,ca,_a,w,ta,ra;if(k._geom._computeAabb(k._aabb,k._ptransform),T=k._aabb._minX,ca=k._aabb._minY,_a=k._aabb._minZ,w=k._aabb._maxX,ta=k._aabb._maxY,ra=k._aabb._maxZ,k._geom._computeAabb(k._aabb,k._transform),k._aabb._minX=T<k._aabb._minX?T:k._aabb._minX,k._aabb._minY=ca<k._aabb._minY?ca:k._aabb._minY,k._aabb._minZ=_a<k._aabb._minZ?_a:k._aabb._minZ,k._aabb._maxX=w>k._aabb._maxX?w:k._aabb._maxX,k._aabb._maxY=ta>k._aabb._maxY?ta:k._aabb._maxY,k._aabb._maxZ=ra>k._aabb._maxZ?ra:k._aabb._maxZ,k._proxy!=null){var la,va,ua;la=k._transform._positionX-k._ptransform._positionX,va=k._transform._positionY-k._ptransform._positionY,ua=k._transform._positionZ-k._ptransform._positionZ;var za=k.displacement;za.x=la,za.y=va,za.z=ua,k._rigidBody._world._broadPhase.moveProxy(k._proxy,k._aabb,k.displacement)}k=X}this._sleeping=!1,this._sleepTime=0}setRotationXyz(a){var t,i,o,r=a;t=r.x,i=r.y,o=r.z;var e=Math.sin(t),_=Math.sin(i),h=Math.sin(o),v=Math.cos(t),s=Math.cos(i),l=Math.cos(o);this._transform._rotation00=s*l,this._transform._rotation01=-s*h,this._transform._rotation02=_,this._transform._rotation10=v*h+l*e*_,this._transform._rotation11=v*l-e*_*h,this._transform._rotation12=-s*e,this._transform._rotation20=e*h-v*l*_,this._transform._rotation21=l*e+v*_*h,this._transform._rotation22=v*s;var x,b,f,n,c,z,p,y,V;x=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,b=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,f=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,n=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,c=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,z=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,p=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,y=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,V=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=x,this._invInertia01=b,this._invInertia02=f,this._invInertia10=n,this._invInertia11=c,this._invInertia12=z,this._invInertia20=p,this._invInertia21=y,this._invInertia22=V;var M,I,k,X,L,m,g,N,d;M=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,I=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,k=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,X=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,L=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,m=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,g=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,N=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,d=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=M,this._invInertia01=I,this._invInertia02=k,this._invInertia10=X,this._invInertia11=L,this._invInertia12=m,this._invInertia20=g,this._invInertia21=N,this._invInertia22=d,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var F=this._ptransform,S=this._transform;F._positionX=S._positionX,F._positionY=S._positionY,F._positionZ=S._positionZ,F._rotation00=S._rotation00,F._rotation01=S._rotation01,F._rotation02=S._rotation02,F._rotation10=S._rotation10,F._rotation11=S._rotation11,F._rotation12=S._rotation12,F._rotation20=S._rotation20,F._rotation21=S._rotation21,F._rotation22=S._rotation22;for(var Y=this._shapeList;Y!=null;){var Q=Y._next,C=Y._ptransform,B=Y._localTransform,Z=this._ptransform,$,K,E,J,A,R,U,G,D;$=Z._rotation00*B._rotation00+Z._rotation01*B._rotation10+Z._rotation02*B._rotation20,K=Z._rotation00*B._rotation01+Z._rotation01*B._rotation11+Z._rotation02*B._rotation21,E=Z._rotation00*B._rotation02+Z._rotation01*B._rotation12+Z._rotation02*B._rotation22,J=Z._rotation10*B._rotation00+Z._rotation11*B._rotation10+Z._rotation12*B._rotation20,A=Z._rotation10*B._rotation01+Z._rotation11*B._rotation11+Z._rotation12*B._rotation21,R=Z._rotation10*B._rotation02+Z._rotation11*B._rotation12+Z._rotation12*B._rotation22,U=Z._rotation20*B._rotation00+Z._rotation21*B._rotation10+Z._rotation22*B._rotation20,G=Z._rotation20*B._rotation01+Z._rotation21*B._rotation11+Z._rotation22*B._rotation21,D=Z._rotation20*B._rotation02+Z._rotation21*B._rotation12+Z._rotation22*B._rotation22,C._rotation00=$,C._rotation01=K,C._rotation02=E,C._rotation10=J,C._rotation11=A,C._rotation12=R,C._rotation20=U,C._rotation21=G,C._rotation22=D;var H,j,ia;H=Z._rotation00*B._positionX+Z._rotation01*B._positionY+Z._rotation02*B._positionZ,j=Z._rotation10*B._positionX+Z._rotation11*B._positionY+Z._rotation12*B._positionZ,ia=Z._rotation20*B._positionX+Z._rotation21*B._positionY+Z._rotation22*B._positionZ,C._positionX=H,C._positionY=j,C._positionZ=ia,C._positionX+=Z._positionX,C._positionY+=Z._positionY,C._positionZ+=Z._positionZ;var ea=Y._transform,W=Y._localTransform,q=this._transform,na,oa,aa,T,ca,_a,w,ta,ra;na=q._rotation00*W._rotation00+q._rotation01*W._rotation10+q._rotation02*W._rotation20,oa=q._rotation00*W._rotation01+q._rotation01*W._rotation11+q._rotation02*W._rotation21,aa=q._rotation00*W._rotation02+q._rotation01*W._rotation12+q._rotation02*W._rotation22,T=q._rotation10*W._rotation00+q._rotation11*W._rotation10+q._rotation12*W._rotation20,ca=q._rotation10*W._rotation01+q._rotation11*W._rotation11+q._rotation12*W._rotation21,_a=q._rotation10*W._rotation02+q._rotation11*W._rotation12+q._rotation12*W._rotation22,w=q._rotation20*W._rotation00+q._rotation21*W._rotation10+q._rotation22*W._rotation20,ta=q._rotation20*W._rotation01+q._rotation21*W._rotation11+q._rotation22*W._rotation21,ra=q._rotation20*W._rotation02+q._rotation21*W._rotation12+q._rotation22*W._rotation22,ea._rotation00=na,ea._rotation01=oa,ea._rotation02=aa,ea._rotation10=T,ea._rotation11=ca,ea._rotation12=_a,ea._rotation20=w,ea._rotation21=ta,ea._rotation22=ra;var la,va,ua;la=q._rotation00*W._positionX+q._rotation01*W._positionY+q._rotation02*W._positionZ,va=q._rotation10*W._positionX+q._rotation11*W._positionY+q._rotation12*W._positionZ,ua=q._rotation20*W._positionX+q._rotation21*W._positionY+q._rotation22*W._positionZ,ea._positionX=la,ea._positionY=va,ea._positionZ=ua,ea._positionX+=q._positionX,ea._positionY+=q._positionY,ea._positionZ+=q._positionZ;var za,Ma,Xa,Za,fa,ba;if(Y._geom._computeAabb(Y._aabb,Y._ptransform),za=Y._aabb._minX,Ma=Y._aabb._minY,Xa=Y._aabb._minZ,Za=Y._aabb._maxX,fa=Y._aabb._maxY,ba=Y._aabb._maxZ,Y._geom._computeAabb(Y._aabb,Y._transform),Y._aabb._minX=za<Y._aabb._minX?za:Y._aabb._minX,Y._aabb._minY=Ma<Y._aabb._minY?Ma:Y._aabb._minY,Y._aabb._minZ=Xa<Y._aabb._minZ?Xa:Y._aabb._minZ,Y._aabb._maxX=Za>Y._aabb._maxX?Za:Y._aabb._maxX,Y._aabb._maxY=fa>Y._aabb._maxY?fa:Y._aabb._maxY,Y._aabb._maxZ=ba>Y._aabb._maxZ?ba:Y._aabb._maxZ,Y._proxy!=null){var sa,ha,ma;sa=Y._transform._positionX-Y._ptransform._positionX,ha=Y._transform._positionY-Y._ptransform._positionY,ma=Y._transform._positionZ-Y._ptransform._positionZ;var ya=Y.displacement;ya.x=sa,ya.y=ha,ya.z=ma,Y._rigidBody._world._broadPhase.moveProxy(Y._proxy,Y._aabb,Y.displacement)}Y=Q}this._sleeping=!1,this._sleepTime=0}rotate(a){var t,i,o,r,e,_,h,v,s,l=a;t=l.e00,i=l.e01,o=l.e02,r=l.e10,e=l.e11,_=l.e12,h=l.e20,v=l.e21,s=l.e22;var x,b,f,n,c,z,p,y,V;x=t*this._transform._rotation00+i*this._transform._rotation10+o*this._transform._rotation20,b=t*this._transform._rotation01+i*this._transform._rotation11+o*this._transform._rotation21,f=t*this._transform._rotation02+i*this._transform._rotation12+o*this._transform._rotation22,n=r*this._transform._rotation00+e*this._transform._rotation10+_*this._transform._rotation20,c=r*this._transform._rotation01+e*this._transform._rotation11+_*this._transform._rotation21,z=r*this._transform._rotation02+e*this._transform._rotation12+_*this._transform._rotation22,p=h*this._transform._rotation00+v*this._transform._rotation10+s*this._transform._rotation20,y=h*this._transform._rotation01+v*this._transform._rotation11+s*this._transform._rotation21,V=h*this._transform._rotation02+v*this._transform._rotation12+s*this._transform._rotation22,this._transform._rotation00=x,this._transform._rotation01=b,this._transform._rotation02=f,this._transform._rotation10=n,this._transform._rotation11=c,this._transform._rotation12=z,this._transform._rotation20=p,this._transform._rotation21=y,this._transform._rotation22=V;var M,I,k,X,L,m,g,N,d;M=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,I=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,k=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,X=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,L=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,m=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,g=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,N=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,d=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=M,this._invInertia01=I,this._invInertia02=k,this._invInertia10=X,this._invInertia11=L,this._invInertia12=m,this._invInertia20=g,this._invInertia21=N,this._invInertia22=d;var F,S,Y,Q,C,B,Z,$,K;F=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,S=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,Y=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,Q=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,C=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,B=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,Z=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,$=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,K=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=F,this._invInertia01=S,this._invInertia02=Y,this._invInertia10=Q,this._invInertia11=C,this._invInertia12=B,this._invInertia20=Z,this._invInertia21=$,this._invInertia22=K,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var E=this._ptransform,J=this._transform;E._positionX=J._positionX,E._positionY=J._positionY,E._positionZ=J._positionZ,E._rotation00=J._rotation00,E._rotation01=J._rotation01,E._rotation02=J._rotation02,E._rotation10=J._rotation10,E._rotation11=J._rotation11,E._rotation12=J._rotation12,E._rotation20=J._rotation20,E._rotation21=J._rotation21,E._rotation22=J._rotation22;for(var A=this._shapeList;A!=null;){var R=A._next,U=A._ptransform,G=A._localTransform,D=this._ptransform,H,j,ia,ea,W,q,na,oa,aa;H=D._rotation00*G._rotation00+D._rotation01*G._rotation10+D._rotation02*G._rotation20,j=D._rotation00*G._rotation01+D._rotation01*G._rotation11+D._rotation02*G._rotation21,ia=D._rotation00*G._rotation02+D._rotation01*G._rotation12+D._rotation02*G._rotation22,ea=D._rotation10*G._rotation00+D._rotation11*G._rotation10+D._rotation12*G._rotation20,W=D._rotation10*G._rotation01+D._rotation11*G._rotation11+D._rotation12*G._rotation21,q=D._rotation10*G._rotation02+D._rotation11*G._rotation12+D._rotation12*G._rotation22,na=D._rotation20*G._rotation00+D._rotation21*G._rotation10+D._rotation22*G._rotation20,oa=D._rotation20*G._rotation01+D._rotation21*G._rotation11+D._rotation22*G._rotation21,aa=D._rotation20*G._rotation02+D._rotation21*G._rotation12+D._rotation22*G._rotation22,U._rotation00=H,U._rotation01=j,U._rotation02=ia,U._rotation10=ea,U._rotation11=W,U._rotation12=q,U._rotation20=na,U._rotation21=oa,U._rotation22=aa;var T,ca,_a;T=D._rotation00*G._positionX+D._rotation01*G._positionY+D._rotation02*G._positionZ,ca=D._rotation10*G._positionX+D._rotation11*G._positionY+D._rotation12*G._positionZ,_a=D._rotation20*G._positionX+D._rotation21*G._positionY+D._rotation22*G._positionZ,U._positionX=T,U._positionY=ca,U._positionZ=_a,U._positionX+=D._positionX,U._positionY+=D._positionY,U._positionZ+=D._positionZ;var w=A._transform,ta=A._localTransform,ra=this._transform,la,va,ua,za,Ma,Xa,Za,fa,ba;la=ra._rotation00*ta._rotation00+ra._rotation01*ta._rotation10+ra._rotation02*ta._rotation20,va=ra._rotation00*ta._rotation01+ra._rotation01*ta._rotation11+ra._rotation02*ta._rotation21,ua=ra._rotation00*ta._rotation02+ra._rotation01*ta._rotation12+ra._rotation02*ta._rotation22,za=ra._rotation10*ta._rotation00+ra._rotation11*ta._rotation10+ra._rotation12*ta._rotation20,Ma=ra._rotation10*ta._rotation01+ra._rotation11*ta._rotation11+ra._rotation12*ta._rotation21,Xa=ra._rotation10*ta._rotation02+ra._rotation11*ta._rotation12+ra._rotation12*ta._rotation22,Za=ra._rotation20*ta._rotation00+ra._rotation21*ta._rotation10+ra._rotation22*ta._rotation20,fa=ra._rotation20*ta._rotation01+ra._rotation21*ta._rotation11+ra._rotation22*ta._rotation21,ba=ra._rotation20*ta._rotation02+ra._rotation21*ta._rotation12+ra._rotation22*ta._rotation22,w._rotation00=la,w._rotation01=va,w._rotation02=ua,w._rotation10=za,w._rotation11=Ma,w._rotation12=Xa,w._rotation20=Za,w._rotation21=fa,w._rotation22=ba;var sa,ha,ma;sa=ra._rotation00*ta._positionX+ra._rotation01*ta._positionY+ra._rotation02*ta._positionZ,ha=ra._rotation10*ta._positionX+ra._rotation11*ta._positionY+ra._rotation12*ta._positionZ,ma=ra._rotation20*ta._positionX+ra._rotation21*ta._positionY+ra._rotation22*ta._positionZ,w._positionX=sa,w._positionY=ha,w._positionZ=ma,w._positionX+=ra._positionX,w._positionY+=ra._positionY,w._positionZ+=ra._positionZ;var ya,Ba,pa,Ya,Ra,ga;if(A._geom._computeAabb(A._aabb,A._ptransform),ya=A._aabb._minX,Ba=A._aabb._minY,pa=A._aabb._minZ,Ya=A._aabb._maxX,Ra=A._aabb._maxY,ga=A._aabb._maxZ,A._geom._computeAabb(A._aabb,A._transform),A._aabb._minX=ya<A._aabb._minX?ya:A._aabb._minX,A._aabb._minY=Ba<A._aabb._minY?Ba:A._aabb._minY,A._aabb._minZ=pa<A._aabb._minZ?pa:A._aabb._minZ,A._aabb._maxX=Ya>A._aabb._maxX?Ya:A._aabb._maxX,A._aabb._maxY=Ra>A._aabb._maxY?Ra:A._aabb._maxY,A._aabb._maxZ=ga>A._aabb._maxZ?ga:A._aabb._maxZ,A._proxy!=null){var xa,wa,ka;xa=A._transform._positionX-A._ptransform._positionX,wa=A._transform._positionY-A._ptransform._positionY,ka=A._transform._positionZ-A._ptransform._positionZ;var Pa=A.displacement;Pa.x=xa,Pa.y=wa,Pa.z=ka,A._rigidBody._world._broadPhase.moveProxy(A._proxy,A._aabb,A.displacement)}A=R}this._sleeping=!1,this._sleepTime=0}rotateXyz(a){var t,i,o,r,e,_,h,v,s,l,x,b,f=a;t=f.x,i=f.y,o=f.z;var n=Math.sin(t),c=Math.sin(i),z=Math.sin(o),p=Math.cos(t),y=Math.cos(i),V=Math.cos(o);r=y*V,e=-y*z,_=c,h=p*z+V*n*c,v=p*V-n*c*z,s=-y*n,l=n*z-p*V*c,x=V*n+p*c*z,b=p*y;var M,I,k,X,L,m,g,N,d;M=r*this._transform._rotation00+e*this._transform._rotation10+_*this._transform._rotation20,I=r*this._transform._rotation01+e*this._transform._rotation11+_*this._transform._rotation21,k=r*this._transform._rotation02+e*this._transform._rotation12+_*this._transform._rotation22,X=h*this._transform._rotation00+v*this._transform._rotation10+s*this._transform._rotation20,L=h*this._transform._rotation01+v*this._transform._rotation11+s*this._transform._rotation21,m=h*this._transform._rotation02+v*this._transform._rotation12+s*this._transform._rotation22,g=l*this._transform._rotation00+x*this._transform._rotation10+b*this._transform._rotation20,N=l*this._transform._rotation01+x*this._transform._rotation11+b*this._transform._rotation21,d=l*this._transform._rotation02+x*this._transform._rotation12+b*this._transform._rotation22,this._transform._rotation00=M,this._transform._rotation01=I,this._transform._rotation02=k,this._transform._rotation10=X,this._transform._rotation11=L,this._transform._rotation12=m,this._transform._rotation20=g,this._transform._rotation21=N,this._transform._rotation22=d;var F,S,Y,Q,C,B,Z,$,K;F=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,S=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,Y=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,Q=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,C=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,B=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,Z=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,$=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,K=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=F,this._invInertia01=S,this._invInertia02=Y,this._invInertia10=Q,this._invInertia11=C,this._invInertia12=B,this._invInertia20=Z,this._invInertia21=$,this._invInertia22=K;var E,J,A,R,U,G,D,H,j;E=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,J=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,A=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,R=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,U=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,G=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,D=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,H=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,j=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=E,this._invInertia01=J,this._invInertia02=A,this._invInertia10=R,this._invInertia11=U,this._invInertia12=G,this._invInertia20=D,this._invInertia21=H,this._invInertia22=j,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var ia=this._ptransform,ea=this._transform;ia._positionX=ea._positionX,ia._positionY=ea._positionY,ia._positionZ=ea._positionZ,ia._rotation00=ea._rotation00,ia._rotation01=ea._rotation01,ia._rotation02=ea._rotation02,ia._rotation10=ea._rotation10,ia._rotation11=ea._rotation11,ia._rotation12=ea._rotation12,ia._rotation20=ea._rotation20,ia._rotation21=ea._rotation21,ia._rotation22=ea._rotation22;for(var W=this._shapeList;W!=null;){var q=W._next,na=W._ptransform,oa=W._localTransform,aa=this._ptransform,T,ca,_a,w,ta,ra,la,va,ua;T=aa._rotation00*oa._rotation00+aa._rotation01*oa._rotation10+aa._rotation02*oa._rotation20,ca=aa._rotation00*oa._rotation01+aa._rotation01*oa._rotation11+aa._rotation02*oa._rotation21,_a=aa._rotation00*oa._rotation02+aa._rotation01*oa._rotation12+aa._rotation02*oa._rotation22,w=aa._rotation10*oa._rotation00+aa._rotation11*oa._rotation10+aa._rotation12*oa._rotation20,ta=aa._rotation10*oa._rotation01+aa._rotation11*oa._rotation11+aa._rotation12*oa._rotation21,ra=aa._rotation10*oa._rotation02+aa._rotation11*oa._rotation12+aa._rotation12*oa._rotation22,la=aa._rotation20*oa._rotation00+aa._rotation21*oa._rotation10+aa._rotation22*oa._rotation20,va=aa._rotation20*oa._rotation01+aa._rotation21*oa._rotation11+aa._rotation22*oa._rotation21,ua=aa._rotation20*oa._rotation02+aa._rotation21*oa._rotation12+aa._rotation22*oa._rotation22,na._rotation00=T,na._rotation01=ca,na._rotation02=_a,na._rotation10=w,na._rotation11=ta,na._rotation12=ra,na._rotation20=la,na._rotation21=va,na._rotation22=ua;var za,Ma,Xa;za=aa._rotation00*oa._positionX+aa._rotation01*oa._positionY+aa._rotation02*oa._positionZ,Ma=aa._rotation10*oa._positionX+aa._rotation11*oa._positionY+aa._rotation12*oa._positionZ,Xa=aa._rotation20*oa._positionX+aa._rotation21*oa._positionY+aa._rotation22*oa._positionZ,na._positionX=za,na._positionY=Ma,na._positionZ=Xa,na._positionX+=aa._positionX,na._positionY+=aa._positionY,na._positionZ+=aa._positionZ;var Za=W._transform,fa=W._localTransform,ba=this._transform,sa,ha,ma,ya,Ba,pa,Ya,Ra,ga;sa=ba._rotation00*fa._rotation00+ba._rotation01*fa._rotation10+ba._rotation02*fa._rotation20,ha=ba._rotation00*fa._rotation01+ba._rotation01*fa._rotation11+ba._rotation02*fa._rotation21,ma=ba._rotation00*fa._rotation02+ba._rotation01*fa._rotation12+ba._rotation02*fa._rotation22,ya=ba._rotation10*fa._rotation00+ba._rotation11*fa._rotation10+ba._rotation12*fa._rotation20,Ba=ba._rotation10*fa._rotation01+ba._rotation11*fa._rotation11+ba._rotation12*fa._rotation21,pa=ba._rotation10*fa._rotation02+ba._rotation11*fa._rotation12+ba._rotation12*fa._rotation22,Ya=ba._rotation20*fa._rotation00+ba._rotation21*fa._rotation10+ba._rotation22*fa._rotation20,Ra=ba._rotation20*fa._rotation01+ba._rotation21*fa._rotation11+ba._rotation22*fa._rotation21,ga=ba._rotation20*fa._rotation02+ba._rotation21*fa._rotation12+ba._rotation22*fa._rotation22,Za._rotation00=sa,Za._rotation01=ha,Za._rotation02=ma,Za._rotation10=ya,Za._rotation11=Ba,Za._rotation12=pa,Za._rotation20=Ya,Za._rotation21=Ra,Za._rotation22=ga;var xa,wa,ka;xa=ba._rotation00*fa._positionX+ba._rotation01*fa._positionY+ba._rotation02*fa._positionZ,wa=ba._rotation10*fa._positionX+ba._rotation11*fa._positionY+ba._rotation12*fa._positionZ,ka=ba._rotation20*fa._positionX+ba._rotation21*fa._positionY+ba._rotation22*fa._positionZ,Za._positionX=xa,Za._positionY=wa,Za._positionZ=ka,Za._positionX+=ba._positionX,Za._positionY+=ba._positionY,Za._positionZ+=ba._positionZ;var Pa,zt,Oa,Aa,nt,Ea;if(W._geom._computeAabb(W._aabb,W._ptransform),Pa=W._aabb._minX,zt=W._aabb._minY,Oa=W._aabb._minZ,Aa=W._aabb._maxX,nt=W._aabb._maxY,Ea=W._aabb._maxZ,W._geom._computeAabb(W._aabb,W._transform),W._aabb._minX=Pa<W._aabb._minX?Pa:W._aabb._minX,W._aabb._minY=zt<W._aabb._minY?zt:W._aabb._minY,W._aabb._minZ=Oa<W._aabb._minZ?Oa:W._aabb._minZ,W._aabb._maxX=Aa>W._aabb._maxX?Aa:W._aabb._maxX,W._aabb._maxY=nt>W._aabb._maxY?nt:W._aabb._maxY,W._aabb._maxZ=Ea>W._aabb._maxZ?Ea:W._aabb._maxZ,W._proxy!=null){var Fa,da,ft;Fa=W._transform._positionX-W._ptransform._positionX,da=W._transform._positionY-W._ptransform._positionY,ft=W._transform._positionZ-W._ptransform._positionZ;var Wa=W.displacement;Wa.x=Fa,Wa.y=da,Wa.z=ft,W._rigidBody._world._broadPhase.moveProxy(W._proxy,W._aabb,W.displacement)}W=q}this._sleeping=!1,this._sleepTime=0}getOrientation(){var a=new u.common.Quat,t,i,o,r,e=this._transform._rotation00,_=this._transform._rotation11,h=this._transform._rotation22,v=e+_+h,s;v>0?(s=Math.sqrt(v+1),r=.5*s,s=.5/s,t=(this._transform._rotation21-this._transform._rotation12)*s,i=(this._transform._rotation02-this._transform._rotation20)*s,o=(this._transform._rotation10-this._transform._rotation01)*s):e>_?e>h?(s=Math.sqrt(e-_-h+1),t=.5*s,s=.5/s,i=(this._transform._rotation01+this._transform._rotation10)*s,o=(this._transform._rotation02+this._transform._rotation20)*s,r=(this._transform._rotation21-this._transform._rotation12)*s):(s=Math.sqrt(h-e-_+1),o=.5*s,s=.5/s,t=(this._transform._rotation02+this._transform._rotation20)*s,i=(this._transform._rotation12+this._transform._rotation21)*s,r=(this._transform._rotation10-this._transform._rotation01)*s):_>h?(s=Math.sqrt(_-h-e+1),i=.5*s,s=.5/s,t=(this._transform._rotation01+this._transform._rotation10)*s,o=(this._transform._rotation12+this._transform._rotation21)*s,r=(this._transform._rotation02-this._transform._rotation20)*s):(s=Math.sqrt(h-e-_+1),o=.5*s,s=.5/s,t=(this._transform._rotation02+this._transform._rotation20)*s,i=(this._transform._rotation12+this._transform._rotation21)*s,r=(this._transform._rotation10-this._transform._rotation01)*s);var l=a;return l.x=t,l.y=i,l.z=o,l.w=r,a}getOrientationTo(a){var t,i,o,r,e=this._transform._rotation00,_=this._transform._rotation11,h=this._transform._rotation22,v=e+_+h,s;v>0?(s=Math.sqrt(v+1),r=.5*s,s=.5/s,t=(this._transform._rotation21-this._transform._rotation12)*s,i=(this._transform._rotation02-this._transform._rotation20)*s,o=(this._transform._rotation10-this._transform._rotation01)*s):e>_?e>h?(s=Math.sqrt(e-_-h+1),t=.5*s,s=.5/s,i=(this._transform._rotation01+this._transform._rotation10)*s,o=(this._transform._rotation02+this._transform._rotation20)*s,r=(this._transform._rotation21-this._transform._rotation12)*s):(s=Math.sqrt(h-e-_+1),o=.5*s,s=.5/s,t=(this._transform._rotation02+this._transform._rotation20)*s,i=(this._transform._rotation12+this._transform._rotation21)*s,r=(this._transform._rotation10-this._transform._rotation01)*s):_>h?(s=Math.sqrt(_-h-e+1),i=.5*s,s=.5/s,t=(this._transform._rotation01+this._transform._rotation10)*s,o=(this._transform._rotation12+this._transform._rotation21)*s,r=(this._transform._rotation02-this._transform._rotation20)*s):(s=Math.sqrt(h-e-_+1),o=.5*s,s=.5/s,t=(this._transform._rotation02+this._transform._rotation20)*s,i=(this._transform._rotation12+this._transform._rotation21)*s,r=(this._transform._rotation10-this._transform._rotation01)*s);var l=a;l.x=t,l.y=i,l.z=o,l.w=r}setOrientation(a){var t,i,o,r,e=a;t=e.x,i=e.y,o=e.z,r=e.w;var _=t,h=i,v=o,s=r,l=2*_,x=2*h,b=2*v,f=_*l,n=h*x,c=v*b,z=_*x,p=h*b,y=_*b,V=s*l,M=s*x,I=s*b;this._transform._rotation00=1-n-c,this._transform._rotation01=z-I,this._transform._rotation02=y+M,this._transform._rotation10=z+I,this._transform._rotation11=1-f-c,this._transform._rotation12=p-V,this._transform._rotation20=y-M,this._transform._rotation21=p+V,this._transform._rotation22=1-f-n;var k,X,L,m,g,N,d,F,S;k=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,X=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,L=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,m=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,g=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,N=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,d=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,F=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,S=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=k,this._invInertia01=X,this._invInertia02=L,this._invInertia10=m,this._invInertia11=g,this._invInertia12=N,this._invInertia20=d,this._invInertia21=F,this._invInertia22=S;var Y,Q,C,B,Z,$,K,E,J;Y=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,Q=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,C=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,B=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,Z=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,$=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,K=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,E=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,J=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=Y,this._invInertia01=Q,this._invInertia02=C,this._invInertia10=B,this._invInertia11=Z,this._invInertia12=$,this._invInertia20=K,this._invInertia21=E,this._invInertia22=J,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var A=this._ptransform,R=this._transform;A._positionX=R._positionX,A._positionY=R._positionY,A._positionZ=R._positionZ,A._rotation00=R._rotation00,A._rotation01=R._rotation01,A._rotation02=R._rotation02,A._rotation10=R._rotation10,A._rotation11=R._rotation11,A._rotation12=R._rotation12,A._rotation20=R._rotation20,A._rotation21=R._rotation21,A._rotation22=R._rotation22;for(var U=this._shapeList;U!=null;){var G=U._next,D=U._ptransform,H=U._localTransform,j=this._ptransform,ia,ea,W,q,na,oa,aa,T,ca;ia=j._rotation00*H._rotation00+j._rotation01*H._rotation10+j._rotation02*H._rotation20,ea=j._rotation00*H._rotation01+j._rotation01*H._rotation11+j._rotation02*H._rotation21,W=j._rotation00*H._rotation02+j._rotation01*H._rotation12+j._rotation02*H._rotation22,q=j._rotation10*H._rotation00+j._rotation11*H._rotation10+j._rotation12*H._rotation20,na=j._rotation10*H._rotation01+j._rotation11*H._rotation11+j._rotation12*H._rotation21,oa=j._rotation10*H._rotation02+j._rotation11*H._rotation12+j._rotation12*H._rotation22,aa=j._rotation20*H._rotation00+j._rotation21*H._rotation10+j._rotation22*H._rotation20,T=j._rotation20*H._rotation01+j._rotation21*H._rotation11+j._rotation22*H._rotation21,ca=j._rotation20*H._rotation02+j._rotation21*H._rotation12+j._rotation22*H._rotation22,D._rotation00=ia,D._rotation01=ea,D._rotation02=W,D._rotation10=q,D._rotation11=na,D._rotation12=oa,D._rotation20=aa,D._rotation21=T,D._rotation22=ca;var _a,w,ta;_a=j._rotation00*H._positionX+j._rotation01*H._positionY+j._rotation02*H._positionZ,w=j._rotation10*H._positionX+j._rotation11*H._positionY+j._rotation12*H._positionZ,ta=j._rotation20*H._positionX+j._rotation21*H._positionY+j._rotation22*H._positionZ,D._positionX=_a,D._positionY=w,D._positionZ=ta,D._positionX+=j._positionX,D._positionY+=j._positionY,D._positionZ+=j._positionZ;var ra=U._transform,la=U._localTransform,va=this._transform,ua,za,Ma,Xa,Za,fa,ba,sa,ha;ua=va._rotation00*la._rotation00+va._rotation01*la._rotation10+va._rotation02*la._rotation20,za=va._rotation00*la._rotation01+va._rotation01*la._rotation11+va._rotation02*la._rotation21,Ma=va._rotation00*la._rotation02+va._rotation01*la._rotation12+va._rotation02*la._rotation22,Xa=va._rotation10*la._rotation00+va._rotation11*la._rotation10+va._rotation12*la._rotation20,Za=va._rotation10*la._rotation01+va._rotation11*la._rotation11+va._rotation12*la._rotation21,fa=va._rotation10*la._rotation02+va._rotation11*la._rotation12+va._rotation12*la._rotation22,ba=va._rotation20*la._rotation00+va._rotation21*la._rotation10+va._rotation22*la._rotation20,sa=va._rotation20*la._rotation01+va._rotation21*la._rotation11+va._rotation22*la._rotation21,ha=va._rotation20*la._rotation02+va._rotation21*la._rotation12+va._rotation22*la._rotation22,ra._rotation00=ua,ra._rotation01=za,ra._rotation02=Ma,ra._rotation10=Xa,ra._rotation11=Za,ra._rotation12=fa,ra._rotation20=ba,ra._rotation21=sa,ra._rotation22=ha;var ma,ya,Ba;ma=va._rotation00*la._positionX+va._rotation01*la._positionY+va._rotation02*la._positionZ,ya=va._rotation10*la._positionX+va._rotation11*la._positionY+va._rotation12*la._positionZ,Ba=va._rotation20*la._positionX+va._rotation21*la._positionY+va._rotation22*la._positionZ,ra._positionX=ma,ra._positionY=ya,ra._positionZ=Ba,ra._positionX+=va._positionX,ra._positionY+=va._positionY,ra._positionZ+=va._positionZ;var pa,Ya,Ra,ga,xa,wa;if(U._geom._computeAabb(U._aabb,U._ptransform),pa=U._aabb._minX,Ya=U._aabb._minY,Ra=U._aabb._minZ,ga=U._aabb._maxX,xa=U._aabb._maxY,wa=U._aabb._maxZ,U._geom._computeAabb(U._aabb,U._transform),U._aabb._minX=pa<U._aabb._minX?pa:U._aabb._minX,U._aabb._minY=Ya<U._aabb._minY?Ya:U._aabb._minY,U._aabb._minZ=Ra<U._aabb._minZ?Ra:U._aabb._minZ,U._aabb._maxX=ga>U._aabb._maxX?ga:U._aabb._maxX,U._aabb._maxY=xa>U._aabb._maxY?xa:U._aabb._maxY,U._aabb._maxZ=wa>U._aabb._maxZ?wa:U._aabb._maxZ,U._proxy!=null){var ka,Pa,zt;ka=U._transform._positionX-U._ptransform._positionX,Pa=U._transform._positionY-U._ptransform._positionY,zt=U._transform._positionZ-U._ptransform._positionZ;var Oa=U.displacement;Oa.x=ka,Oa.y=Pa,Oa.z=zt,U._rigidBody._world._broadPhase.moveProxy(U._proxy,U._aabb,U.displacement)}U=G}this._sleeping=!1,this._sleepTime=0}getTransform(){var a=this._transform,t=new u.common.Transform;return t._positionX=a._positionX,t._positionY=a._positionY,t._positionZ=a._positionZ,t._rotation00=a._rotation00,t._rotation01=a._rotation01,t._rotation02=a._rotation02,t._rotation10=a._rotation10,t._rotation11=a._rotation11,t._rotation12=a._rotation12,t._rotation20=a._rotation20,t._rotation21=a._rotation21,t._rotation22=a._rotation22,t}getTransformTo(a){var t=this._transform;a._positionX=t._positionX,a._positionY=t._positionY,a._positionZ=t._positionZ,a._rotation00=t._rotation00,a._rotation01=t._rotation01,a._rotation02=t._rotation02,a._rotation10=t._rotation10,a._rotation11=t._rotation11,a._rotation12=t._rotation12,a._rotation20=t._rotation20,a._rotation21=t._rotation21,a._rotation22=t._rotation22}setTransform(a){this._transform._positionX=a._positionX,this._transform._positionY=a._positionY,this._transform._positionZ=a._positionZ,this._transform._rotation00=a._rotation00,this._transform._rotation01=a._rotation01,this._transform._rotation02=a._rotation02,this._transform._rotation10=a._rotation10,this._transform._rotation11=a._rotation11,this._transform._rotation12=a._rotation12,this._transform._rotation20=a._rotation20,this._transform._rotation21=a._rotation21,this._transform._rotation22=a._rotation22;var t,i,o,r,e,_,h,v,s;t=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,i=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,o=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,r=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,e=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,_=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,h=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,v=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,s=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=t,this._invInertia01=i,this._invInertia02=o,this._invInertia10=r,this._invInertia11=e,this._invInertia12=_,this._invInertia20=h,this._invInertia21=v,this._invInertia22=s;var l,x,b,f,n,c,z,p,y;l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,x=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,b=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,f=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,n=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,c=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,z=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,p=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,y=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=x,this._invInertia02=b,this._invInertia10=f,this._invInertia11=n,this._invInertia12=c,this._invInertia20=z,this._invInertia21=p,this._invInertia22=y,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var V=this._ptransform,M=this._transform;V._positionX=M._positionX,V._positionY=M._positionY,V._positionZ=M._positionZ,V._rotation00=M._rotation00,V._rotation01=M._rotation01,V._rotation02=M._rotation02,V._rotation10=M._rotation10,V._rotation11=M._rotation11,V._rotation12=M._rotation12,V._rotation20=M._rotation20,V._rotation21=M._rotation21,V._rotation22=M._rotation22;for(var I=this._shapeList;I!=null;){var k=I._next,X=I._ptransform,L=I._localTransform,m=this._ptransform,g,N,d,F,S,Y,Q,C,B;g=m._rotation00*L._rotation00+m._rotation01*L._rotation10+m._rotation02*L._rotation20,N=m._rotation00*L._rotation01+m._rotation01*L._rotation11+m._rotation02*L._rotation21,d=m._rotation00*L._rotation02+m._rotation01*L._rotation12+m._rotation02*L._rotation22,F=m._rotation10*L._rotation00+m._rotation11*L._rotation10+m._rotation12*L._rotation20,S=m._rotation10*L._rotation01+m._rotation11*L._rotation11+m._rotation12*L._rotation21,Y=m._rotation10*L._rotation02+m._rotation11*L._rotation12+m._rotation12*L._rotation22,Q=m._rotation20*L._rotation00+m._rotation21*L._rotation10+m._rotation22*L._rotation20,C=m._rotation20*L._rotation01+m._rotation21*L._rotation11+m._rotation22*L._rotation21,B=m._rotation20*L._rotation02+m._rotation21*L._rotation12+m._rotation22*L._rotation22,X._rotation00=g,X._rotation01=N,X._rotation02=d,X._rotation10=F,X._rotation11=S,X._rotation12=Y,X._rotation20=Q,X._rotation21=C,X._rotation22=B;var Z,$,K;Z=m._rotation00*L._positionX+m._rotation01*L._positionY+m._rotation02*L._positionZ,$=m._rotation10*L._positionX+m._rotation11*L._positionY+m._rotation12*L._positionZ,K=m._rotation20*L._positionX+m._rotation21*L._positionY+m._rotation22*L._positionZ,X._positionX=Z,X._positionY=$,X._positionZ=K,X._positionX+=m._positionX,X._positionY+=m._positionY,X._positionZ+=m._positionZ;var E=I._transform,J=I._localTransform,A=this._transform,R,U,G,D,H,j,ia,ea,W;R=A._rotation00*J._rotation00+A._rotation01*J._rotation10+A._rotation02*J._rotation20,U=A._rotation00*J._rotation01+A._rotation01*J._rotation11+A._rotation02*J._rotation21,G=A._rotation00*J._rotation02+A._rotation01*J._rotation12+A._rotation02*J._rotation22,D=A._rotation10*J._rotation00+A._rotation11*J._rotation10+A._rotation12*J._rotation20,H=A._rotation10*J._rotation01+A._rotation11*J._rotation11+A._rotation12*J._rotation21,j=A._rotation10*J._rotation02+A._rotation11*J._rotation12+A._rotation12*J._rotation22,ia=A._rotation20*J._rotation00+A._rotation21*J._rotation10+A._rotation22*J._rotation20,ea=A._rotation20*J._rotation01+A._rotation21*J._rotation11+A._rotation22*J._rotation21,W=A._rotation20*J._rotation02+A._rotation21*J._rotation12+A._rotation22*J._rotation22,E._rotation00=R,E._rotation01=U,E._rotation02=G,E._rotation10=D,E._rotation11=H,E._rotation12=j,E._rotation20=ia,E._rotation21=ea,E._rotation22=W;var q,na,oa;q=A._rotation00*J._positionX+A._rotation01*J._positionY+A._rotation02*J._positionZ,na=A._rotation10*J._positionX+A._rotation11*J._positionY+A._rotation12*J._positionZ,oa=A._rotation20*J._positionX+A._rotation21*J._positionY+A._rotation22*J._positionZ,E._positionX=q,E._positionY=na,E._positionZ=oa,E._positionX+=A._positionX,E._positionY+=A._positionY,E._positionZ+=A._positionZ;var aa,T,ca,_a,w,ta;if(I._geom._computeAabb(I._aabb,I._ptransform),aa=I._aabb._minX,T=I._aabb._minY,ca=I._aabb._minZ,_a=I._aabb._maxX,w=I._aabb._maxY,ta=I._aabb._maxZ,I._geom._computeAabb(I._aabb,I._transform),I._aabb._minX=aa<I._aabb._minX?aa:I._aabb._minX,I._aabb._minY=T<I._aabb._minY?T:I._aabb._minY,I._aabb._minZ=ca<I._aabb._minZ?ca:I._aabb._minZ,I._aabb._maxX=_a>I._aabb._maxX?_a:I._aabb._maxX,I._aabb._maxY=w>I._aabb._maxY?w:I._aabb._maxY,I._aabb._maxZ=ta>I._aabb._maxZ?ta:I._aabb._maxZ,I._proxy!=null){var ra,la,va;ra=I._transform._positionX-I._ptransform._positionX,la=I._transform._positionY-I._ptransform._positionY,va=I._transform._positionZ-I._ptransform._positionZ;var ua=I.displacement;ua.x=ra,ua.y=la,ua.z=va,I._rigidBody._world._broadPhase.moveProxy(I._proxy,I._aabb,I.displacement)}I=k}this._sleeping=!1,this._sleepTime=0}getMass(){return this._mass}getLocalInertia(){var a=new u.common.Mat3,t=a;return t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22,a}getLocalInertiaTo(a){var t=a;t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22}getMassData(){var a=new u.dynamics.rigidbody.MassData;a.mass=this._mass;var t=a.localInertia;return t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22,a}getMassDataTo(a){a.mass=this._mass;var t=a.localInertia;t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22}setMassData(a){this._mass=a.mass;var t=a.localInertia;this._localInertia00=t.e00,this._localInertia01=t.e01,this._localInertia02=t.e02,this._localInertia10=t.e10,this._localInertia11=t.e11,this._localInertia12=t.e12,this._localInertia20=t.e20,this._localInertia21=t.e21,this._localInertia22=t.e22;var i=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,o=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,r=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,e=this._localInertia00*i-this._localInertia01*o+this._localInertia02*r;if(this._mass>0&&e>0&&this._type==0){this._invMass=1/this._mass;var _=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,h=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,v=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,s=this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21,l=this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20,x=this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20,b=this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11,f=this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10,n=this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10,c=this._localInertia00*_-this._localInertia01*h+this._localInertia02*v;(c<-1e-32||c>1e-32)&&(c=1/c),this._invLocalInertia00=_*c,this._invLocalInertia01=-s*c,this._invLocalInertia02=b*c,this._invLocalInertia10=-h*c,this._invLocalInertia11=l*c,this._invLocalInertia12=-f*c,this._invLocalInertia20=v*c,this._invLocalInertia21=-x*c,this._invLocalInertia22=n*c,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._type==0&&(this._type=1);var z,p,y,V,M,I,k,X,L;z=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,p=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,y=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,V=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,M=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,I=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,k=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,X=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,L=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=z,this._invInertia01=p,this._invInertia02=y,this._invInertia10=V,this._invInertia11=M,this._invInertia12=I,this._invInertia20=k,this._invInertia21=X,this._invInertia22=L;var m,g,N,d,F,S,Y,Q,C;m=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,g=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,N=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,d=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,F=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,S=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,Y=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,Q=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,C=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=m,this._invInertia01=g,this._invInertia02=N,this._invInertia10=d,this._invInertia11=F,this._invInertia12=S,this._invInertia20=Y,this._invInertia21=Q,this._invInertia22=C,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getRotationFactor(){var a=this._rotFactor;return new u.common.Vec3(a.x,a.y,a.z)}setRotationFactor(a){var t=this._rotFactor;t.x=a.x,t.y=a.y,t.z=a.z;var i,o,r,e,_,h,v,s,l;i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,o=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,r=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,e=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,_=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,h=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,v=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,s=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=o,this._invInertia02=r,this._invInertia10=e,this._invInertia11=_,this._invInertia12=h,this._invInertia20=v,this._invInertia21=s,this._invInertia22=l;var x,b,f,n,c,z,p,y,V;x=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,b=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,f=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,n=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,c=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,z=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,p=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,y=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,V=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=x,this._invInertia01=b,this._invInertia02=f,this._invInertia10=n,this._invInertia11=c,this._invInertia12=z,this._invInertia20=p,this._invInertia21=y,this._invInertia22=V,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getLinearVelocity(){var a=new u.common.Vec3,t=a;return t.x=this._velX,t.y=this._velY,t.z=this._velZ,a}getLinearVelocityTo(a){var t=a;t.x=this._velX,t.y=this._velY,t.z=this._velZ}setLinearVelocity(a){if(this._type==1)this._velX=0,this._velY=0,this._velZ=0;else{var t=a;this._velX=t.x,this._velY=t.y,this._velZ=t.z}this._sleeping=!1,this._sleepTime=0}getAngularVelocity(){var a=new u.common.Vec3,t=a;return t.x=this._angVelX,t.y=this._angVelY,t.z=this._angVelZ,a}getAngularVelocityTo(a){var t=a;t.x=this._velX,t.y=this._velY,t.z=this._velZ}setAngularVelocity(a){if(this._type==1)this._angVelX=0,this._angVelY=0,this._angVelZ=0;else{var t=a;this._angVelX=t.x,this._angVelY=t.y,this._angVelZ=t.z}this._sleeping=!1,this._sleepTime=0}addLinearVelocity(a){if(this._type!=1){var t,i,o,r=a;t=r.x,i=r.y,o=r.z,this._velX+=t,this._velY+=i,this._velZ+=o}this._sleeping=!1,this._sleepTime=0}addAngularVelocity(a){if(this._type!=1){var t,i,o,r=a;t=r.x,i=r.y,o=r.z,this._angVelX+=t,this._angVelY+=i,this._angVelZ+=o}this._sleeping=!1,this._sleepTime=0}applyImpulse(a,t){var i,o,r,e=a;i=e.x,o=e.y,r=e.z,this._velX+=i*this._invMass,this._velY+=o*this._invMass,this._velZ+=r*this._invMass;var _,h,v,s,l,x,b=t;s=b.x,l=b.y,x=b.z,s-=this._transform._positionX,l-=this._transform._positionY,x-=this._transform._positionZ,_=l*r-x*o,h=x*i-s*r,v=s*o-l*i;var f,n,c;f=this._invInertia00*_+this._invInertia01*h+this._invInertia02*v,n=this._invInertia10*_+this._invInertia11*h+this._invInertia12*v,c=this._invInertia20*_+this._invInertia21*h+this._invInertia22*v,_=f,h=n,v=c,this._angVelX+=_,this._angVelY+=h,this._angVelZ+=v,this._sleeping=!1,this._sleepTime=0}applyLinearImpulse(a){var t,i,o,r=a;t=r.x,i=r.y,o=r.z,this._velX+=t*this._invMass,this._velY+=i*this._invMass,this._velZ+=o*this._invMass,this._sleeping=!1,this._sleepTime=0}applyAngularImpulse(a){var t,i,o,r=a;t=r.x,i=r.y,o=r.z;var e,_,h;e=this._invInertia00*t+this._invInertia01*i+this._invInertia02*o,_=this._invInertia10*t+this._invInertia11*i+this._invInertia12*o,h=this._invInertia20*t+this._invInertia21*i+this._invInertia22*o,t=e,i=_,o=h,this._angVelX+=t,this._angVelY+=i,this._angVelZ+=o,this._sleeping=!1,this._sleepTime=0}applyForce(a,t){var i,o,r,e=a;i=e.x,o=e.y,r=e.z,this._forceX+=i,this._forceY+=o,this._forceZ+=r;var _,h,v,s,l,x,b=t;s=b.x,l=b.y,x=b.z,s-=this._transform._positionX,l-=this._transform._positionY,x-=this._transform._positionZ,_=l*r-x*o,h=x*i-s*r,v=s*o-l*i,this._torqueX+=_,this._torqueY+=h,this._torqueZ+=v,this._sleeping=!1,this._sleepTime=0}applyForceToCenter(a){var t,i,o,r=a;t=r.x,i=r.y,o=r.z,this._forceX+=t,this._forceY+=i,this._forceZ+=o,this._sleeping=!1,this._sleepTime=0}applyTorque(a){var t,i,o,r=a;t=r.x,i=r.y,o=r.z,this._torqueX+=t,this._torqueY+=i,this._torqueZ+=o,this._sleeping=!1,this._sleepTime=0}getLinearContactImpulse(){var a=new u.common.Vec3,t=a;return t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ,a}getLinearContactImpulseTo(a){var t=a;t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ}getAngularContactImpulse(){var a=new u.common.Vec3,t=a;return t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ,a}getAngularContactImpulseTo(a){var t=a;t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ}getGravityScale(){return this._gravityScale}setGravityScale(a){this._gravityScale=a,this._sleeping=!1,this._sleepTime=0}getLocalPoint(a){var t,i,o,r=a;t=r.x,i=r.y,o=r.z,t-=this._transform._positionX,i-=this._transform._positionY,o-=this._transform._positionZ;var e,_,h;e=this._transform._rotation00*t+this._transform._rotation10*i+this._transform._rotation20*o,_=this._transform._rotation01*t+this._transform._rotation11*i+this._transform._rotation21*o,h=this._transform._rotation02*t+this._transform._rotation12*i+this._transform._rotation22*o,t=e,i=_,o=h;var v=new u.common.Vec3,s=v;return s.x=t,s.y=i,s.z=o,v}getLocalPointTo(a,t){var i,o,r,e=a;i=e.x,o=e.y,r=e.z,i-=this._transform._positionX,o-=this._transform._positionY,r-=this._transform._positionZ;var _,h,v;_=this._transform._rotation00*i+this._transform._rotation10*o+this._transform._rotation20*r,h=this._transform._rotation01*i+this._transform._rotation11*o+this._transform._rotation21*r,v=this._transform._rotation02*i+this._transform._rotation12*o+this._transform._rotation22*r,i=_,o=h,r=v;var s=t;s.x=i,s.y=o,s.z=r}getLocalVector(a){var t,i,o,r=a;t=r.x,i=r.y,o=r.z;var e,_,h;e=this._transform._rotation00*t+this._transform._rotation10*i+this._transform._rotation20*o,_=this._transform._rotation01*t+this._transform._rotation11*i+this._transform._rotation21*o,h=this._transform._rotation02*t+this._transform._rotation12*i+this._transform._rotation22*o,t=e,i=_,o=h;var v=new u.common.Vec3,s=v;return s.x=t,s.y=i,s.z=o,v}getLocalVectorTo(a,t){var i,o,r,e=a;i=e.x,o=e.y,r=e.z;var _,h,v;_=this._transform._rotation00*i+this._transform._rotation10*o+this._transform._rotation20*r,h=this._transform._rotation01*i+this._transform._rotation11*o+this._transform._rotation21*r,v=this._transform._rotation02*i+this._transform._rotation12*o+this._transform._rotation22*r,i=_,o=h,r=v;var s=t;s.x=i,s.y=o,s.z=r}getWorldPoint(a){var t,i,o,r=a;t=r.x,i=r.y,o=r.z;var e,_,h;e=this._transform._rotation00*t+this._transform._rotation01*i+this._transform._rotation02*o,_=this._transform._rotation10*t+this._transform._rotation11*i+this._transform._rotation12*o,h=this._transform._rotation20*t+this._transform._rotation21*i+this._transform._rotation22*o,t=e,i=_,o=h,t+=this._transform._positionX,i+=this._transform._positionY,o+=this._transform._positionZ;var v=new u.common.Vec3,s=v;return s.x=t,s.y=i,s.z=o,v}getWorldPointTo(a,t){var i,o,r,e=a;i=e.x,o=e.y,r=e.z;var _,h,v;_=this._transform._rotation00*i+this._transform._rotation01*o+this._transform._rotation02*r,h=this._transform._rotation10*i+this._transform._rotation11*o+this._transform._rotation12*r,v=this._transform._rotation20*i+this._transform._rotation21*o+this._transform._rotation22*r,i=_,o=h,r=v,i+=this._transform._positionX,o+=this._transform._positionY,r+=this._transform._positionZ;var s=t;s.x=i,s.y=o,s.z=r}getWorldVector(a){var t,i,o,r=a;t=r.x,i=r.y,o=r.z;var e,_,h;e=this._transform._rotation00*t+this._transform._rotation01*i+this._transform._rotation02*o,_=this._transform._rotation10*t+this._transform._rotation11*i+this._transform._rotation12*o,h=this._transform._rotation20*t+this._transform._rotation21*i+this._transform._rotation22*o,t=e,i=_,o=h;var v=new u.common.Vec3,s=v;return s.x=t,s.y=i,s.z=o,v}getWorldVectorTo(a,t){var i,o,r,e=a;i=e.x,o=e.y,r=e.z;var _,h,v;_=this._transform._rotation00*i+this._transform._rotation01*o+this._transform._rotation02*r,h=this._transform._rotation10*i+this._transform._rotation11*o+this._transform._rotation12*r,v=this._transform._rotation20*i+this._transform._rotation21*o+this._transform._rotation22*r,i=_,o=h,r=v;var s=t;s.x=i,s.y=o,s.z=r}getNumShapes(){return this._numShapes}getShapeList(){return this._shapeList}getNumContectLinks(){return this._numContactLinks}getContactLinkList(){return this._contactLinkList}getNumJointLinks(){return this._numJointLinks}getJointLinkList(){return this._jointLinkList}addShape(a){if(this._shapeList==null?(this._shapeList=a,this._shapeListLast=a):(this._shapeListLast._next=a,a._prev=this._shapeListLast,this._shapeListLast=a),this._numShapes++,a._rigidBody=this,this._world!=null){var t=this._world;a._proxy=t._broadPhase.createProxy(a,a._aabb),a._id=t._shapeIdCount++,t._numShapes++}this.updateMass();for(var i=this._shapeList;i!=null;){var o=i._next,r=i._ptransform,e=i._localTransform,_=this._ptransform,h,v,s,l,x,b,f,n,c;h=_._rotation00*e._rotation00+_._rotation01*e._rotation10+_._rotation02*e._rotation20,v=_._rotation00*e._rotation01+_._rotation01*e._rotation11+_._rotation02*e._rotation21,s=_._rotation00*e._rotation02+_._rotation01*e._rotation12+_._rotation02*e._rotation22,l=_._rotation10*e._rotation00+_._rotation11*e._rotation10+_._rotation12*e._rotation20,x=_._rotation10*e._rotation01+_._rotation11*e._rotation11+_._rotation12*e._rotation21,b=_._rotation10*e._rotation02+_._rotation11*e._rotation12+_._rotation12*e._rotation22,f=_._rotation20*e._rotation00+_._rotation21*e._rotation10+_._rotation22*e._rotation20,n=_._rotation20*e._rotation01+_._rotation21*e._rotation11+_._rotation22*e._rotation21,c=_._rotation20*e._rotation02+_._rotation21*e._rotation12+_._rotation22*e._rotation22,r._rotation00=h,r._rotation01=v,r._rotation02=s,r._rotation10=l,r._rotation11=x,r._rotation12=b,r._rotation20=f,r._rotation21=n,r._rotation22=c;var z,p,y;z=_._rotation00*e._positionX+_._rotation01*e._positionY+_._rotation02*e._positionZ,p=_._rotation10*e._positionX+_._rotation11*e._positionY+_._rotation12*e._positionZ,y=_._rotation20*e._positionX+_._rotation21*e._positionY+_._rotation22*e._positionZ,r._positionX=z,r._positionY=p,r._positionZ=y,r._positionX+=_._positionX,r._positionY+=_._positionY,r._positionZ+=_._positionZ;var V=i._transform,M=i._localTransform,I=this._transform,k,X,L,m,g,N,d,F,S;k=I._rotation00*M._rotation00+I._rotation01*M._rotation10+I._rotation02*M._rotation20,X=I._rotation00*M._rotation01+I._rotation01*M._rotation11+I._rotation02*M._rotation21,L=I._rotation00*M._rotation02+I._rotation01*M._rotation12+I._rotation02*M._rotation22,m=I._rotation10*M._rotation00+I._rotation11*M._rotation10+I._rotation12*M._rotation20,g=I._rotation10*M._rotation01+I._rotation11*M._rotation11+I._rotation12*M._rotation21,N=I._rotation10*M._rotation02+I._rotation11*M._rotation12+I._rotation12*M._rotation22,d=I._rotation20*M._rotation00+I._rotation21*M._rotation10+I._rotation22*M._rotation20,F=I._rotation20*M._rotation01+I._rotation21*M._rotation11+I._rotation22*M._rotation21,S=I._rotation20*M._rotation02+I._rotation21*M._rotation12+I._rotation22*M._rotation22,V._rotation00=k,V._rotation01=X,V._rotation02=L,V._rotation10=m,V._rotation11=g,V._rotation12=N,V._rotation20=d,V._rotation21=F,V._rotation22=S;var Y,Q,C;Y=I._rotation00*M._positionX+I._rotation01*M._positionY+I._rotation02*M._positionZ,Q=I._rotation10*M._positionX+I._rotation11*M._positionY+I._rotation12*M._positionZ,C=I._rotation20*M._positionX+I._rotation21*M._positionY+I._rotation22*M._positionZ,V._positionX=Y,V._positionY=Q,V._positionZ=C,V._positionX+=I._positionX,V._positionY+=I._positionY,V._positionZ+=I._positionZ;var B,Z,$,K,E,J;if(i._geom._computeAabb(i._aabb,i._ptransform),B=i._aabb._minX,Z=i._aabb._minY,$=i._aabb._minZ,K=i._aabb._maxX,E=i._aabb._maxY,J=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=B<i._aabb._minX?B:i._aabb._minX,i._aabb._minY=Z<i._aabb._minY?Z:i._aabb._minY,i._aabb._minZ=$<i._aabb._minZ?$:i._aabb._minZ,i._aabb._maxX=K>i._aabb._maxX?K:i._aabb._maxX,i._aabb._maxY=E>i._aabb._maxY?E:i._aabb._maxY,i._aabb._maxZ=J>i._aabb._maxZ?J:i._aabb._maxZ,i._proxy!=null){var A,R,U;A=i._transform._positionX-i._ptransform._positionX,R=i._transform._positionY-i._ptransform._positionY,U=i._transform._positionZ-i._ptransform._positionZ;var G=i.displacement;G.x=A,G.y=R,G.z=U,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=o}}removeShape(a){var t=a._prev,i=a._next;if(t!=null&&(t._next=i),i!=null&&(i._prev=t),a==this._shapeList&&(this._shapeList=this._shapeList._next),a==this._shapeListLast&&(this._shapeListLast=this._shapeListLast._prev),a._next=null,a._prev=null,this._numShapes--,a._rigidBody=null,this._world!=null){var o=this._world;o._broadPhase.destroyProxy(a._proxy),a._proxy=null,a._id=-1;for(var r=a._rigidBody._contactLinkList;r!=null;){var e=r._next,_=r._contact;if(_._s1==a||_._s2==a){var h=r._other;h._sleeping=!1,h._sleepTime=0;var v=o._contactManager,s=_._prev,l=_._next;if(s!=null&&(s._next=l),l!=null&&(l._prev=s),_==v._contactList&&(v._contactList=v._contactList._next),_==v._contactListLast&&(v._contactListLast=v._contactListLast._prev),_._next=null,_._prev=null,_._touching){var x=_._s1._contactCallback,b=_._s2._contactCallback;x==b&&(b=null),x!=null&&x.endContact(_),b!=null&&b.endContact(_)}var f=_._link1._prev,n=_._link1._next;f!=null&&(f._next=n),n!=null&&(n._prev=f),_._link1==_._b1._contactLinkList&&(_._b1._contactLinkList=_._b1._contactLinkList._next),_._link1==_._b1._contactLinkListLast&&(_._b1._contactLinkListLast=_._b1._contactLinkListLast._prev),_._link1._next=null,_._link1._prev=null;var c=_._link2._prev,z=_._link2._next;c!=null&&(c._next=z),z!=null&&(z._prev=c),_._link2==_._b2._contactLinkList&&(_._b2._contactLinkList=_._b2._contactLinkList._next),_._link2==_._b2._contactLinkListLast&&(_._b2._contactLinkListLast=_._b2._contactLinkListLast._prev),_._link2._next=null,_._link2._prev=null,_._b1._numContactLinks--,_._b2._numContactLinks--,_._link1._other=null,_._link2._other=null,_._link1._contact=null,_._link2._contact=null,_._s1=null,_._s2=null,_._b1=null,_._b2=null,_._touching=!1,_._cachedDetectorData._clear(),_._manifold._clear(),_._detector=null;var p=_._contactConstraint;p._s1=null,p._s2=null,p._b1=null,p._b2=null,p._tf1=null,p._tf2=null,_._next=v._contactPool,v._contactPool=_,v._numContacts--}r=e}o._numShapes--}this.updateMass();for(var y=this._shapeList;y!=null;){var V=y._next,M=y._ptransform,I=y._localTransform,k=this._ptransform,X,L,m,g,N,d,F,S,Y;X=k._rotation00*I._rotation00+k._rotation01*I._rotation10+k._rotation02*I._rotation20,L=k._rotation00*I._rotation01+k._rotation01*I._rotation11+k._rotation02*I._rotation21,m=k._rotation00*I._rotation02+k._rotation01*I._rotation12+k._rotation02*I._rotation22,g=k._rotation10*I._rotation00+k._rotation11*I._rotation10+k._rotation12*I._rotation20,N=k._rotation10*I._rotation01+k._rotation11*I._rotation11+k._rotation12*I._rotation21,d=k._rotation10*I._rotation02+k._rotation11*I._rotation12+k._rotation12*I._rotation22,F=k._rotation20*I._rotation00+k._rotation21*I._rotation10+k._rotation22*I._rotation20,S=k._rotation20*I._rotation01+k._rotation21*I._rotation11+k._rotation22*I._rotation21,Y=k._rotation20*I._rotation02+k._rotation21*I._rotation12+k._rotation22*I._rotation22,M._rotation00=X,M._rotation01=L,M._rotation02=m,M._rotation10=g,M._rotation11=N,M._rotation12=d,M._rotation20=F,M._rotation21=S,M._rotation22=Y;var Q,C,B;Q=k._rotation00*I._positionX+k._rotation01*I._positionY+k._rotation02*I._positionZ,C=k._rotation10*I._positionX+k._rotation11*I._positionY+k._rotation12*I._positionZ,B=k._rotation20*I._positionX+k._rotation21*I._positionY+k._rotation22*I._positionZ,M._positionX=Q,M._positionY=C,M._positionZ=B,M._positionX+=k._positionX,M._positionY+=k._positionY,M._positionZ+=k._positionZ;var Z=y._transform,$=y._localTransform,K=this._transform,E,J,A,R,U,G,D,H,j;E=K._rotation00*$._rotation00+K._rotation01*$._rotation10+K._rotation02*$._rotation20,J=K._rotation00*$._rotation01+K._rotation01*$._rotation11+K._rotation02*$._rotation21,A=K._rotation00*$._rotation02+K._rotation01*$._rotation12+K._rotation02*$._rotation22,R=K._rotation10*$._rotation00+K._rotation11*$._rotation10+K._rotation12*$._rotation20,U=K._rotation10*$._rotation01+K._rotation11*$._rotation11+K._rotation12*$._rotation21,G=K._rotation10*$._rotation02+K._rotation11*$._rotation12+K._rotation12*$._rotation22,D=K._rotation20*$._rotation00+K._rotation21*$._rotation10+K._rotation22*$._rotation20,H=K._rotation20*$._rotation01+K._rotation21*$._rotation11+K._rotation22*$._rotation21,j=K._rotation20*$._rotation02+K._rotation21*$._rotation12+K._rotation22*$._rotation22,Z._rotation00=E,Z._rotation01=J,Z._rotation02=A,Z._rotation10=R,Z._rotation11=U,Z._rotation12=G,Z._rotation20=D,Z._rotation21=H,Z._rotation22=j;var ia,ea,W;ia=K._rotation00*$._positionX+K._rotation01*$._positionY+K._rotation02*$._positionZ,ea=K._rotation10*$._positionX+K._rotation11*$._positionY+K._rotation12*$._positionZ,W=K._rotation20*$._positionX+K._rotation21*$._positionY+K._rotation22*$._positionZ,Z._positionX=ia,Z._positionY=ea,Z._positionZ=W,Z._positionX+=K._positionX,Z._positionY+=K._positionY,Z._positionZ+=K._positionZ;var q,na,oa,aa,T,ca;if(y._geom._computeAabb(y._aabb,y._ptransform),q=y._aabb._minX,na=y._aabb._minY,oa=y._aabb._minZ,aa=y._aabb._maxX,T=y._aabb._maxY,ca=y._aabb._maxZ,y._geom._computeAabb(y._aabb,y._transform),y._aabb._minX=q<y._aabb._minX?q:y._aabb._minX,y._aabb._minY=na<y._aabb._minY?na:y._aabb._minY,y._aabb._minZ=oa<y._aabb._minZ?oa:y._aabb._minZ,y._aabb._maxX=aa>y._aabb._maxX?aa:y._aabb._maxX,y._aabb._maxY=T>y._aabb._maxY?T:y._aabb._maxY,y._aabb._maxZ=ca>y._aabb._maxZ?ca:y._aabb._maxZ,y._proxy!=null){var _a,w,ta;_a=y._transform._positionX-y._ptransform._positionX,w=y._transform._positionY-y._ptransform._positionY,ta=y._transform._positionZ-y._ptransform._positionZ;var ra=y.displacement;ra.x=_a,ra.y=w,ra.z=ta,y._rigidBody._world._broadPhase.moveProxy(y._proxy,y._aabb,y.displacement)}y=V}}getType(){return this._type}setType(a){this._type=a,this.updateMass()}wakeUp(){this._sleeping=!1,this._sleepTime=0}sleep(){this._sleeping=!0,this._sleepTime=0}isSleeping(){return this._sleeping}getSleepTime(){return this._sleepTime}setAutoSleep(a){this._autoSleep=a,this._sleeping=!1,this._sleepTime=0}getLinearDamping(){return this._linearDamping}setLinearDamping(a){this._linearDamping=a}getAngularDamping(){return this._angularDamping}setAngularDamping(a){this._angularDamping=a}getPrev(){return this._prev}getNext(){return this._next}};u.dynamics.rigidbody.RigidBodyConfig=class{constructor(){this.position=new u.common.Vec3,this.rotation=new u.common.Mat3,this.linearVelocity=new u.common.Vec3,this.angularVelocity=new u.common.Vec3,this.type=0,this.autoSleep=!0,this.linearDamping=0,this.angularDamping=0}};u.dynamics.rigidbody.RigidBodyType=class{};u.dynamics.rigidbody.Shape=class{constructor(a){this._id=-1,this._localTransform=new u.common.Transform,this._ptransform=new u.common.Transform,this._transform=new u.common.Transform;var t=a.position;this._localTransform._positionX=t.x,this._localTransform._positionY=t.y,this._localTransform._positionZ=t.z;var i=a.rotation;this._localTransform._rotation00=i.e00,this._localTransform._rotation01=i.e01,this._localTransform._rotation02=i.e02,this._localTransform._rotation10=i.e10,this._localTransform._rotation11=i.e11,this._localTransform._rotation12=i.e12,this._localTransform._rotation20=i.e20,this._localTransform._rotation21=i.e21,this._localTransform._rotation22=i.e22;var o=this._ptransform,r=this._localTransform;o._positionX=r._positionX,o._positionY=r._positionY,o._positionZ=r._positionZ,o._rotation00=r._rotation00,o._rotation01=r._rotation01,o._rotation02=r._rotation02,o._rotation10=r._rotation10,o._rotation11=r._rotation11,o._rotation12=r._rotation12,o._rotation20=r._rotation20,o._rotation21=r._rotation21,o._rotation22=r._rotation22;var e=this._transform,_=this._localTransform;e._positionX=_._positionX,e._positionY=_._positionY,e._positionZ=_._positionZ,e._rotation00=_._rotation00,e._rotation01=_._rotation01,e._rotation02=_._rotation02,e._rotation10=_._rotation10,e._rotation11=_._rotation11,e._rotation12=_._rotation12,e._rotation20=_._rotation20,e._rotation21=_._rotation21,e._rotation22=_._rotation22,this._restitution=a.restitution,this._friction=a.friction,this._density=a.density,this._geom=a.geometry,this._collisionGroup=a.collisionGroup,this._collisionMask=a.collisionMask,this._contactCallback=a.contactCallback,this._aabb=new u.collision.geometry.Aabb,this._proxy=null,this.displacement=new u.common.Vec3}getFriction(){return this._friction}setFriction(a){this._friction=a}getRestitution(){return this._restitution}setRestitution(a){this._restitution=a}getLocalTransform(){var a=this._localTransform,t=new u.common.Transform;return t._positionX=a._positionX,t._positionY=a._positionY,t._positionZ=a._positionZ,t._rotation00=a._rotation00,t._rotation01=a._rotation01,t._rotation02=a._rotation02,t._rotation10=a._rotation10,t._rotation11=a._rotation11,t._rotation12=a._rotation12,t._rotation20=a._rotation20,t._rotation21=a._rotation21,t._rotation22=a._rotation22,t}getLocalTransformTo(a){var t=this._localTransform;a._positionX=t._positionX,a._positionY=t._positionY,a._positionZ=t._positionZ,a._rotation00=t._rotation00,a._rotation01=t._rotation01,a._rotation02=t._rotation02,a._rotation10=t._rotation10,a._rotation11=t._rotation11,a._rotation12=t._rotation12,a._rotation20=t._rotation20,a._rotation21=t._rotation21,a._rotation22=t._rotation22}getTransform(){var a=this._transform,t=new u.common.Transform;return t._positionX=a._positionX,t._positionY=a._positionY,t._positionZ=a._positionZ,t._rotation00=a._rotation00,t._rotation01=a._rotation01,t._rotation02=a._rotation02,t._rotation10=a._rotation10,t._rotation11=a._rotation11,t._rotation12=a._rotation12,t._rotation20=a._rotation20,t._rotation21=a._rotation21,t._rotation22=a._rotation22,t}getTransformTo(a){var t=this._transform;a._positionX=t._positionX,a._positionY=t._positionY,a._positionZ=t._positionZ,a._rotation00=t._rotation00,a._rotation01=t._rotation01,a._rotation02=t._rotation02,a._rotation10=t._rotation10,a._rotation11=t._rotation11,a._rotation12=t._rotation12,a._rotation20=t._rotation20,a._rotation21=t._rotation21,a._rotation22=t._rotation22}setLocalTransform(a){var t=this._localTransform;if(t._positionX=a._positionX,t._positionY=a._positionY,t._positionZ=a._positionZ,t._rotation00=a._rotation00,t._rotation01=a._rotation01,t._rotation02=a._rotation02,t._rotation10=a._rotation10,t._rotation11=a._rotation11,t._rotation12=a._rotation12,t._rotation20=a._rotation20,t._rotation21=a._rotation21,t._rotation22=a._rotation22,this._rigidBody!=null){var i=this._rigidBody;i.updateMass();for(var o=i._shapeList;o!=null;){var r=o._next,e=o._ptransform,_=o._localTransform,h=i._ptransform,v,s,l,x,b,f,n,c,z;v=h._rotation00*_._rotation00+h._rotation01*_._rotation10+h._rotation02*_._rotation20,s=h._rotation00*_._rotation01+h._rotation01*_._rotation11+h._rotation02*_._rotation21,l=h._rotation00*_._rotation02+h._rotation01*_._rotation12+h._rotation02*_._rotation22,x=h._rotation10*_._rotation00+h._rotation11*_._rotation10+h._rotation12*_._rotation20,b=h._rotation10*_._rotation01+h._rotation11*_._rotation11+h._rotation12*_._rotation21,f=h._rotation10*_._rotation02+h._rotation11*_._rotation12+h._rotation12*_._rotation22,n=h._rotation20*_._rotation00+h._rotation21*_._rotation10+h._rotation22*_._rotation20,c=h._rotation20*_._rotation01+h._rotation21*_._rotation11+h._rotation22*_._rotation21,z=h._rotation20*_._rotation02+h._rotation21*_._rotation12+h._rotation22*_._rotation22,e._rotation00=v,e._rotation01=s,e._rotation02=l,e._rotation10=x,e._rotation11=b,e._rotation12=f,e._rotation20=n,e._rotation21=c,e._rotation22=z;var p,y,V;p=h._rotation00*_._positionX+h._rotation01*_._positionY+h._rotation02*_._positionZ,y=h._rotation10*_._positionX+h._rotation11*_._positionY+h._rotation12*_._positionZ,V=h._rotation20*_._positionX+h._rotation21*_._positionY+h._rotation22*_._positionZ,e._positionX=p,e._positionY=y,e._positionZ=V,e._positionX+=h._positionX,e._positionY+=h._positionY,e._positionZ+=h._positionZ;var M=o._transform,I=o._localTransform,k=i._transform,X,L,m,g,N,d,F,S,Y;X=k._rotation00*I._rotation00+k._rotation01*I._rotation10+k._rotation02*I._rotation20,L=k._rotation00*I._rotation01+k._rotation01*I._rotation11+k._rotation02*I._rotation21,m=k._rotation00*I._rotation02+k._rotation01*I._rotation12+k._rotation02*I._rotation22,g=k._rotation10*I._rotation00+k._rotation11*I._rotation10+k._rotation12*I._rotation20,N=k._rotation10*I._rotation01+k._rotation11*I._rotation11+k._rotation12*I._rotation21,d=k._rotation10*I._rotation02+k._rotation11*I._rotation12+k._rotation12*I._rotation22,F=k._rotation20*I._rotation00+k._rotation21*I._rotation10+k._rotation22*I._rotation20,S=k._rotation20*I._rotation01+k._rotation21*I._rotation11+k._rotation22*I._rotation21,Y=k._rotation20*I._rotation02+k._rotation21*I._rotation12+k._rotation22*I._rotation22,M._rotation00=X,M._rotation01=L,M._rotation02=m,M._rotation10=g,M._rotation11=N,M._rotation12=d,M._rotation20=F,M._rotation21=S,M._rotation22=Y;var Q,C,B;Q=k._rotation00*I._positionX+k._rotation01*I._positionY+k._rotation02*I._positionZ,C=k._rotation10*I._positionX+k._rotation11*I._positionY+k._rotation12*I._positionZ,B=k._rotation20*I._positionX+k._rotation21*I._positionY+k._rotation22*I._positionZ,M._positionX=Q,M._positionY=C,M._positionZ=B,M._positionX+=k._positionX,M._positionY+=k._positionY,M._positionZ+=k._positionZ;var Z,$,K,E,J,A;if(o._geom._computeAabb(o._aabb,o._ptransform),Z=o._aabb._minX,$=o._aabb._minY,K=o._aabb._minZ,E=o._aabb._maxX,J=o._aabb._maxY,A=o._aabb._maxZ,o._geom._computeAabb(o._aabb,o._transform),o._aabb._minX=Z<o._aabb._minX?Z:o._aabb._minX,o._aabb._minY=$<o._aabb._minY?$:o._aabb._minY,o._aabb._minZ=K<o._aabb._minZ?K:o._aabb._minZ,o._aabb._maxX=E>o._aabb._maxX?E:o._aabb._maxX,o._aabb._maxY=J>o._aabb._maxY?J:o._aabb._maxY,o._aabb._maxZ=A>o._aabb._maxZ?A:o._aabb._maxZ,o._proxy!=null){var R,U,G;R=o._transform._positionX-o._ptransform._positionX,U=o._transform._positionY-o._ptransform._positionY,G=o._transform._positionZ-o._ptransform._positionZ;var D=o.displacement;D.x=R,D.y=U,D.z=G,o._rigidBody._world._broadPhase.moveProxy(o._proxy,o._aabb,o.displacement)}o=r}}}getDensity(){return this._density}setDensity(a){if(this._density=a,this._rigidBody!=null){var t=this._rigidBody;t.updateMass();for(var i=t._shapeList;i!=null;){var o=i._next,r=i._ptransform,e=i._localTransform,_=t._ptransform,h,v,s,l,x,b,f,n,c;h=_._rotation00*e._rotation00+_._rotation01*e._rotation10+_._rotation02*e._rotation20,v=_._rotation00*e._rotation01+_._rotation01*e._rotation11+_._rotation02*e._rotation21,s=_._rotation00*e._rotation02+_._rotation01*e._rotation12+_._rotation02*e._rotation22,l=_._rotation10*e._rotation00+_._rotation11*e._rotation10+_._rotation12*e._rotation20,x=_._rotation10*e._rotation01+_._rotation11*e._rotation11+_._rotation12*e._rotation21,b=_._rotation10*e._rotation02+_._rotation11*e._rotation12+_._rotation12*e._rotation22,f=_._rotation20*e._rotation00+_._rotation21*e._rotation10+_._rotation22*e._rotation20,n=_._rotation20*e._rotation01+_._rotation21*e._rotation11+_._rotation22*e._rotation21,c=_._rotation20*e._rotation02+_._rotation21*e._rotation12+_._rotation22*e._rotation22,r._rotation00=h,r._rotation01=v,r._rotation02=s,r._rotation10=l,r._rotation11=x,r._rotation12=b,r._rotation20=f,r._rotation21=n,r._rotation22=c;var z,p,y;z=_._rotation00*e._positionX+_._rotation01*e._positionY+_._rotation02*e._positionZ,p=_._rotation10*e._positionX+_._rotation11*e._positionY+_._rotation12*e._positionZ,y=_._rotation20*e._positionX+_._rotation21*e._positionY+_._rotation22*e._positionZ,r._positionX=z,r._positionY=p,r._positionZ=y,r._positionX+=_._positionX,r._positionY+=_._positionY,r._positionZ+=_._positionZ;var V=i._transform,M=i._localTransform,I=t._transform,k,X,L,m,g,N,d,F,S;k=I._rotation00*M._rotation00+I._rotation01*M._rotation10+I._rotation02*M._rotation20,X=I._rotation00*M._rotation01+I._rotation01*M._rotation11+I._rotation02*M._rotation21,L=I._rotation00*M._rotation02+I._rotation01*M._rotation12+I._rotation02*M._rotation22,m=I._rotation10*M._rotation00+I._rotation11*M._rotation10+I._rotation12*M._rotation20,g=I._rotation10*M._rotation01+I._rotation11*M._rotation11+I._rotation12*M._rotation21,N=I._rotation10*M._rotation02+I._rotation11*M._rotation12+I._rotation12*M._rotation22,d=I._rotation20*M._rotation00+I._rotation21*M._rotation10+I._rotation22*M._rotation20,F=I._rotation20*M._rotation01+I._rotation21*M._rotation11+I._rotation22*M._rotation21,S=I._rotation20*M._rotation02+I._rotation21*M._rotation12+I._rotation22*M._rotation22,V._rotation00=k,V._rotation01=X,V._rotation02=L,V._rotation10=m,V._rotation11=g,V._rotation12=N,V._rotation20=d,V._rotation21=F,V._rotation22=S;var Y,Q,C;Y=I._rotation00*M._positionX+I._rotation01*M._positionY+I._rotation02*M._positionZ,Q=I._rotation10*M._positionX+I._rotation11*M._positionY+I._rotation12*M._positionZ,C=I._rotation20*M._positionX+I._rotation21*M._positionY+I._rotation22*M._positionZ,V._positionX=Y,V._positionY=Q,V._positionZ=C,V._positionX+=I._positionX,V._positionY+=I._positionY,V._positionZ+=I._positionZ;var B,Z,$,K,E,J;if(i._geom._computeAabb(i._aabb,i._ptransform),B=i._aabb._minX,Z=i._aabb._minY,$=i._aabb._minZ,K=i._aabb._maxX,E=i._aabb._maxY,J=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=B<i._aabb._minX?B:i._aabb._minX,i._aabb._minY=Z<i._aabb._minY?Z:i._aabb._minY,i._aabb._minZ=$<i._aabb._minZ?$:i._aabb._minZ,i._aabb._maxX=K>i._aabb._maxX?K:i._aabb._maxX,i._aabb._maxY=E>i._aabb._maxY?E:i._aabb._maxY,i._aabb._maxZ=J>i._aabb._maxZ?J:i._aabb._maxZ,i._proxy!=null){var A,R,U;A=i._transform._positionX-i._ptransform._positionX,R=i._transform._positionY-i._ptransform._positionY,U=i._transform._positionZ-i._ptransform._positionZ;var G=i.displacement;G.x=A,G.y=R,G.z=U,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=o}}}getAabb(){return this._aabb.clone()}getAabbTo(a){a.copyFrom(this._aabb)}getGeometry(){return this._geom}getRigidBody(){return this._rigidBody}getCollisionGroup(){return this._collisionGroup}setCollisionGroup(a){this._collisionGroup=a}getCollisionMask(){return this._collisionMask}setCollisionMask(a){this._collisionMask=a}getContactCallback(){return this._contactCallback}setContactCallback(a){this._contactCallback=a}getPrev(){return this._prev}getNext(){return this._next}};u.dynamics.rigidbody.ShapeConfig=class{constructor(){this.position=new u.common.Vec3,this.rotation=new u.common.Mat3,this.friction=u.common.Setting.defaultFriction,this.restitution=u.common.Setting.defaultRestitution,this.density=u.common.Setting.defaultDensity,this.collisionGroup=u.common.Setting.defaultCollisionGroup,this.collisionMask=u.common.Setting.defaultCollisionMask,this.geometry=null,this.contactCallback=null}};u.m||(u.m={});u.m.M=class{};u.collision.broadphase.BroadPhaseType._BRUTE_FORCE=1;u.collision.broadphase.BroadPhaseType._BVH=2;u.collision.broadphase.BroadPhaseType.BRUTE_FORCE=1;u.collision.broadphase.BroadPhaseType.BVH=2;u.collision.broadphase.bvh.BvhInsertionStrategy.SIMPLE=0;u.collision.broadphase.bvh.BvhInsertionStrategy.MINIMIZE_SURFACE_AREA=1;u.collision.geometry.GeometryType._SPHERE=0;u.collision.geometry.GeometryType._BOX=1;u.collision.geometry.GeometryType._CYLINDER=2;u.collision.geometry.GeometryType._CONE=3;u.collision.geometry.GeometryType._CAPSULE=4;u.collision.geometry.GeometryType._CONVEX_HULL=5;u.collision.geometry.GeometryType._CONVEX_MIN=0;u.collision.geometry.GeometryType._CONVEX_MAX=5;u.collision.geometry.GeometryType.SPHERE=0;u.collision.geometry.GeometryType.BOX=1;u.collision.geometry.GeometryType.CYLINDER=2;u.collision.geometry.GeometryType.CONE=3;u.collision.geometry.GeometryType.CAPSULE=4;u.collision.geometry.GeometryType.CONVEX_HULL=5;u.collision.narrowphase.detector.BoxBoxDetector.EDGE_BIAS_MULT=1;u.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.OK=0;u.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.INVALID_TRIANGLE=1;u.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_PAIR_INDEX=2;u.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_TRIANGLE=3;u.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.EDGE_LOOP_BROKEN=4;u.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_OUTER_TRIANGLE=5;u.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.TRIANGLE_INVISIBLE=6;u.collision.narrowphase.detector.gjkepa.EpaTriangle.count=0;u.common.Vec3.numCreations=0;u.common.Setting.defaultFriction=.2;u.common.Setting.defaultRestitution=.2;u.common.Setting.defaultDensity=1;u.common.Setting.defaultCollisionGroup=1;u.common.Setting.defaultCollisionMask=1;u.common.Setting.maxTranslationPerStep=20;u.common.Setting.maxRotationPerStep=3.14159265358979;u.common.Setting.bvhProxyPadding=.1;u.common.Setting.bvhIncrementalCollisionThreshold=.45;u.common.Setting.defaultGJKMargin=.05;u.common.Setting.enableGJKCaching=!0;u.common.Setting.maxEPAVertices=128;u.common.Setting.maxEPAPolyhedronFaces=128;u.common.Setting.contactEnableBounceThreshold=.5;u.common.Setting.velocityBaumgarte=.2;u.common.Setting.positionSplitImpulseBaumgarte=.4;u.common.Setting.positionNgsBaumgarte=1;u.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold=.05;u.common.Setting.defaultContactPositionCorrectionAlgorithm=0;u.common.Setting.alternativeContactPositionCorrectionAlgorithm=1;u.common.Setting.contactPersistenceThreshold=.05;u.common.Setting.maxManifoldPoints=4;u.common.Setting.defaultJointConstraintSolverType=0;u.common.Setting.defaultJointPositionCorrectionAlgorithm=0;u.common.Setting.jointWarmStartingFactorForBaungarte=.8;u.common.Setting.jointWarmStartingFactor=.95;u.common.Setting.minSpringDamperDampingRatio=1e-6;u.common.Setting.minRagdollMaxSwingAngle=1e-6;u.common.Setting.maxJacobianRows=6;u.common.Setting.directMlcpSolverEps=1e-9;u.common.Setting.islandInitialRigidBodyArraySize=128;u.common.Setting.islandInitialConstraintArraySize=128;u.common.Setting.sleepingVelocityThreshold=.2;u.common.Setting.sleepingAngularVelocityThreshold=.5;u.common.Setting.sleepingTimeThreshold=1;u.common.Setting.disableSleeping=!1;u.common.Setting.linearSlop=.005;u.common.Setting.angularSlop=.017453292519943278;u.collision.narrowphase.detector.gjkepa.GjkEpa.instance=new u.collision.narrowphase.detector.gjkepa.GjkEpa;u.collision.narrowphase.detector.gjkepa.GjkEpaResultState._SUCCEEDED=0;u.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_FAILED_TO_MAKE_TETRAHEDRON=1;u.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_DID_NOT_CONVERGE=2;u.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_INIT=257;u.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_ADD_VERTEX=258;u.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_DID_NOT_CONVERGE=259;u.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED=0;u.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_FAILED_TO_MAKE_TETRAHEDRON=1;u.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_DID_NOT_CONVERGE=2;u.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT=257;u.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX=258;u.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE=259;u.common.Mat3.numCreations=0;u.common.Mat4.numCreations=0;u.common.MathUtil.POSITIVE_INFINITY=1/0;u.common.MathUtil.NEGATIVE_INFINITY=-1/0;u.common.MathUtil.PI=3.14159265358979;u.common.MathUtil.TWO_PI=6.28318530717958;u.common.MathUtil.HALF_PI=1.570796326794895;u.common.MathUtil.TO_RADIANS=.017453292519943278;u.common.MathUtil.TO_DEGREES=57.29577951308238;u.common.Quat.numCreations=0;u.dynamics.common.DebugDraw.SPHERE_PHI_DIVISION=8;u.dynamics.common.DebugDraw.SPHERE_THETA_DIVISION=4;u.dynamics.common.DebugDraw.CIRCLE_THETA_DIVISION=8;u.dynamics.common.Performance.broadPhaseCollisionTime=0;u.dynamics.common.Performance.narrowPhaseCollisionTime=0;u.dynamics.common.Performance.dynamicsTime=0;u.dynamics.common.Performance.totalTime=0;u.dynamics.constraint.PositionCorrectionAlgorithm._BAUMGARTE=0;u.dynamics.constraint.PositionCorrectionAlgorithm._SPLIT_IMPULSE=1;u.dynamics.constraint.PositionCorrectionAlgorithm._NGS=2;u.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE=0;u.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE=1;u.dynamics.constraint.PositionCorrectionAlgorithm.NGS=2;u.dynamics.constraint.info.JacobianRow.BIT_LINEAR_SET=1;u.dynamics.constraint.info.JacobianRow.BIT_ANGULAR_SET=2;u.dynamics.constraint.joint.JointType._SPHERICAL=0;u.dynamics.constraint.joint.JointType._REVOLUTE=1;u.dynamics.constraint.joint.JointType._CYLINDRICAL=2;u.dynamics.constraint.joint.JointType._PRISMATIC=3;u.dynamics.constraint.joint.JointType._UNIVERSAL=4;u.dynamics.constraint.joint.JointType._RAGDOLL=5;u.dynamics.constraint.joint.JointType._GENERIC=6;u.dynamics.constraint.joint.JointType.SPHERICAL=0;u.dynamics.constraint.joint.JointType.REVOLUTE=1;u.dynamics.constraint.joint.JointType.CYLINDRICAL=2;u.dynamics.constraint.joint.JointType.PRISMATIC=3;u.dynamics.constraint.joint.JointType.UNIVERSAL=4;u.dynamics.constraint.joint.JointType.RAGDOLL=5;u.dynamics.constraint.joint.JointType.GENERIC=6;u.dynamics.constraint.solver.ConstraintSolverType._ITERATIVE=0;u.dynamics.constraint.solver.ConstraintSolverType._DIRECT=1;u.dynamics.constraint.solver.ConstraintSolverType.ITERATIVE=0;u.dynamics.constraint.solver.ConstraintSolverType.DIRECT=1;u.dynamics.rigidbody.RigidBodyType._DYNAMIC=0;u.dynamics.rigidbody.RigidBodyType._STATIC=1;u.dynamics.rigidbody.RigidBodyType._KINEMATIC=2;u.dynamics.rigidbody.RigidBodyType.DYNAMIC=0;u.dynamics.rigidbody.RigidBodyType.STATIC=1;u.dynamics.rigidbody.RigidBodyType.KINEMATIC=2;u.dynamics.World;u.dynamics.rigidbody.RigidBodyType;u.dynamics.rigidbody.RigidBodyConfig;u.dynamics.rigidbody.RigidBody;u.dynamics.rigidbody.ShapeConfig;u.dynamics.rigidbody.Shape;u.dynamics.constraint.joint.SphericalJointConfig;u.dynamics.constraint.joint.SphericalJoint;u.dynamics.constraint.joint.RevoluteJointConfig;u.dynamics.constraint.joint.RevoluteJoint;u.dynamics.constraint.joint.CylindricalJointConfig;u.dynamics.constraint.joint.CylindricalJoint;u.dynamics.constraint.joint.PrismaticJointConfig;u.dynamics.constraint.joint.PrismaticJoint;u.dynamics.constraint.joint.UniversalJointConfig;u.dynamics.constraint.joint.UniversalJoint;u.dynamics.constraint.joint.RagdollJointConfig;u.dynamics.constraint.joint.RagdollJoint;u.dynamics.constraint.joint.GenericJointConfig;u.dynamics.constraint.joint.GenericJoint;u.dynamics.constraint.joint.JointConfig;u.dynamics.constraint.joint.Joint;u.dynamics.constraint.joint.SpringDamper;u.dynamics.constraint.joint.TranslationalLimitMotor;u.dynamics.constraint.joint.RotationalLimitMotor;u.common.Vec3;u.common.Quat;u.common.Mat3;u.common.MathUtil;u.common.Transform;const wM=u.common.Setting;u.collision.geometry.BoxGeometry;u.collision.geometry.SphereGeometry;u.collision.geometry.ConeGeometry;u.collision.geometry.CylinderGeometry;u.collision.geometry.CapsuleGeometry;u.collision.geometry.ConvexHullGeometry;u.collision.geometry.Geometry;u.dynamics.callback.RayCastClosest;u.dynamics.callback.ContactCallback;wM.defaultGJKMargin=1e-4;u.dynamics.World;u.dynamics.rigidbody.RigidBodyType;u.dynamics.rigidbody.RigidBodyConfig;u.dynamics.rigidbody.RigidBody;u.dynamics.rigidbody.ShapeConfig;u.dynamics.rigidbody.Shape;u.dynamics.constraint.joint.SphericalJointConfig;u.dynamics.constraint.joint.SphericalJoint;u.dynamics.constraint.joint.RevoluteJointConfig;u.dynamics.constraint.joint.RevoluteJoint;u.dynamics.constraint.joint.CylindricalJointConfig;u.dynamics.constraint.joint.CylindricalJoint;u.dynamics.constraint.joint.PrismaticJointConfig;u.dynamics.constraint.joint.PrismaticJoint;u.dynamics.constraint.joint.UniversalJointConfig;u.dynamics.constraint.joint.UniversalJoint;u.dynamics.constraint.joint.RagdollJointConfig;u.dynamics.constraint.joint.RagdollJoint;u.dynamics.constraint.joint.GenericJointConfig;u.dynamics.constraint.joint.GenericJoint;u.dynamics.constraint.joint.Joint;u.common.Vec3;u.common.Quat;const XM=u.common.Setting;u.collision.geometry.BoxGeometry;u.collision.geometry.SphereGeometry;u.collision.geometry.ConeGeometry;u.collision.geometry.CylinderGeometry;u.collision.geometry.CapsuleGeometry;u.collision.geometry.ConvexHullGeometry;u.dynamics.callback.ContactCallback;XM.defaultGJKMargin=1e-4;
