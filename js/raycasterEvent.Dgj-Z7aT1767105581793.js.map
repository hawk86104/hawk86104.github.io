{"version":3,"file":"raycasterEvent.Dgj-Z7aT1767105581793.js","sources":["../../src/plugins/simpleGIS/components/raycasterEvent.vue"],"sourcesContent":["<template>\n\t<div class=\"lonLatDiv\">\n\t\tlon:{{ lonLat[0] }} lat:{{ lonLat[1] }}\n\t</div>\n</template>\n<script lang=\"ts\" setup>\nimport { ref, defineProps, withDefaults, watch } from 'vue'\nimport { webMercatorToLonLat, utmToLonLat, UTM } from '../lib/threeSatelliteMap/index'\nimport * as THREE from 'three'\n\nconst props = withDefaults(defineProps<{\n\ttileMapRef: any\n}>(), {\n})\n\nconst lonLat = ref([0, 0])\nwatch(() => props.tileMapRef, (newVal, oldVal) => {\n\tif (!oldVal && newVal) {\n\t\tconsole.log('raycasterEvent:', newVal)\n\t\tvar raycaster = new THREE.Raycaster()\n\t\tvar mouse = new THREE.Vector2()\n\n\t\tdocument.addEventListener('mousemove', onMouseMove, false)\n\n\t\tfunction onMouseMove(event: any) {\n\t\t\t// 计算鼠标的归一化设备坐标\n\t\t\tmouse.x = (event.clientX / window.innerWidth) * 2 - 1\n\t\t\tmouse.y = - (event.clientY / window.innerHeight) * 2 + 1\n\n\t\t\t// 更新射线投射器的起点\n\t\t\traycaster.setFromCamera(mouse, newVal.camera)\n\n\t\t\t// 计算射线投射器与物体的相交情况\n\t\t\tvar intersects = raycaster.intersectObjects(newVal.map.children)\n\n\t\t\tif (intersects.length > 0) {\n\t\t\t\t// 获取第一个相交物体的坐标\n\t\t\t\tvar intersection = intersects[0];\n\t\t\t\t// console.log('全局坐标:', intersection.point)\n\n\t\t\t\tif (newVal.map.provider.geometryProvider.coordType === UTM) {\n\t\t\t\t\tlonLat.value = utmToLonLat(intersection.point.x, -intersection.point.z)\n\t\t\t\t} else {\n\t\t\t\t\tlonLat.value = webMercatorToLonLat(intersection.point.x, -intersection.point.z)\n\t\t\t\t}\n\n\t\t\t\tlonLat.value[0] = lonLat.value[0].toFixed(4) as any\n\t\t\t\tlonLat.value[1] = lonLat.value[1].toFixed(4) as any\n\t\t\t\t// console.log('lonLat:', lonLat.value)\n\n\t\t\t\t// 将全局坐标转换为局部坐标\n\t\t\t\t// var localIntersection = cube.worldToLocal(intersection.point.clone())\n\t\t\t\t// console.log('局部坐标:', localIntersection)\n\t\t\t}\n\t\t}\n\t}\n})\n\n</script>\n<style lang=\"less\" scoped>\n.lonLatDiv {\n\tposition: absolute;\n\tbottom: 6px;\n\tcolor: white;\n\tleft: calc(50% - 6.5em);\n\tfont-size: 10px;\n\tbackground-color: #0000008c;\n\tpadding: 2px 4px;\n}\n</style>"],"names":[],"mappings":"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"}