import{F as e,_ as t}from"./@tresjs.hGs-POUu1762392119014.js";import{A as a}from"./3d-tiles-renderer.CtCItAbp1762392119014.js";import{a as o,b as r}from"./utils.Dm6dbdZA1762392119014.js";import{B as i}from"./three-custom-shader-material.6xXo1noH1762392119014.js";import{b as s,a as l}from"./buildingsShaderMaterial.CQxYsEgR1762392119014.js";import{cZ as n,a6 as d,k as u,c1 as p,ap as m,da as f,db as c}from"./three.CDsL_76W1762392119014.js";import{d as h,w as v,G as g,o as w,I as C,u as y}from"./@vue.DQUdVfVE1762392119014.js";const b=["rotation-x"],R=["object"],j=h({__name:"tilesCom",props:{tilesUrl:{default:"./plugins/geokit/tiles/tileset.json"},isRotation:{type:Boolean,default:!0},isRranslation:{type:Boolean,default:!0},bulidingsColor:{default:"#e523ff"},topColor:{default:"#ffff00"},lightColor:{default:"#ffffff"},borderWidth:{default:5},opacity:{default:.8},gradient:{type:Boolean,default:!0},speed:{default:1},lineOpacity:{default:1},linewidth:{default:1},lineColor:{default:"#000000"}},setup(h){const j=h,x={value:0},B=new n({color:j.lineColor,linewidth:j.linewidth,opacity:j.lineOpacity,transparent:!0,depthWrite:!1,depthTest:!0});B.resolution.set(window.innerWidth,window.innerHeight);const M=({scene:e})=>{e.traverse(e=>{e.isMesh&&e.material&&((e=>{e.userData.builds=!0;const{geometry:t}=e;t.computeBoundingBox(),t.computeBoundingSphere();const{max:a,min:o}=t.boundingBox,r=new i({baseMaterial:new p,vertexShader:l,fragmentShader:s,silent:!0,uniforms:{uMax:{value:a},uMin:{value:o},uBorderWidth:{value:j.borderWidth},uCircleTime:{value:5},uColor:{value:new u(j.bulidingsColor)},uOpacity:{value:j.opacity},uLightColor:{value:new u(j.lightColor)},uTopColor:{value:new u(j.topColor)},uTime:x,uGradient:{value:j.gradient}},depthWrite:!0,depthTest:!0,transparent:!0,side:d});e.material.dispose(),e.material=r})(e),(e=>{const t=new m(e.geometry.clone());let a=(new f).fromEdgesGeometry(t);const o=new c(a,B);o.userData.lines=!0,o.applyMatrix4(e.matrix.clone()),e.parent.add(o)})(e))})},{camera:W,renderer:T,sizes:D}=e(),L=(e,t,a)=>{e.setCamera(t),e.setResolutionFromRenderer(t,a)},O=()=>{let e=new a(j.tilesUrl);return e.fetchOptions.mode="cors",e.errorTarget=12,e.addEventListener("load-model",M),e.addEventListener("load-tile-set",()=>{r(e,j.isRotation,j.isRranslation)}),e.addEventListener("dispose-model",({scene:e})=>{e.traverse(e=>{e.material&&e.material.dispose(),e.userData&&e.userData.lines&&(e.geometry.dispose(),e.material.dispose())})}),L(e,W.value,T),e};let U=O();v(W,()=>{W.value&&L(U,W.value,T)},{immediate:!0});const{onBeforeRender:G}=t();return G(({delta:e})=>{W.value&&D.width.value&&U.update&&(W.value.updateMatrixWorld(),U.update(),x.value+=e*j.speed)}),v(()=>[j.bulidingsColor,j.topColor,j.lightColor,j.borderWidth,j.opacity,j.gradient],([e,t,a,o,r])=>{U.group.traverse(i=>{i.isMesh&&i.userData&&i.userData.builds&&(i.material.uniforms.uColor.value.set(e),i.material.uniforms.uTopColor.value.set(t),i.material.uniforms.uLightColor.value.set(a),i.material.uniforms.uBorderWidth.value=o,i.material.uniforms.uOpacity.value=r,i.material.uniforms.uGradient.value=j.gradient,i.material.needsUpdate=!0)})}),v(()=>[j.lineColor,j.linewidth,j.lineOpacity],([e,t,a])=>{B.color.set(e),B.linewidth=t,B.opacity=a,B.needsUpdate=!0}),v(()=>j.tilesUrl,e=>{e!==U.rootURL&&(U.dispose(),U=O())}),v(()=>[j.isRotation,j.isRranslation],()=>{U.group&&o(U.group,j.isRotation,j.isRranslation)}),(e,t)=>(w(),g("TresGroup",{"rotation-x":e.isRotation?-Math.PI/2:0},[C("primitive",{object:y(U).group},null,8,R)],8,b))}});export{j as _};
