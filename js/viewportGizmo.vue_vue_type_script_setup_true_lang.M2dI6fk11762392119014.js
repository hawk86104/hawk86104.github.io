import{F as t,_ as e}from"./@tresjs.hGs-POUu1762392119014.js";import{V as s,dM as i,d as o,m as n,k as r,cH as a,aE as c,A as l,i as h,j as p,bm as d,bl as u,o as m,y as _,bj as g,a4 as f,cL as y,cY as w,cZ as b,c_ as v,a2 as S,H as E,C as x,Q as M,O as k,g as L,M as C,a as z}from"./three.CDsL_76W1762392119014.js";import{d as P,af as A,ad as O,w as q}from"./@vue.DQUdVfVE1762392119014.js";const T=(t,e)=>{const[s,i]=e.split("-");return Object.assign(t.style,{left:"left"===i?"0":"center"===i?"50%":"",right:"right"===i?"0":"",top:"top"===s?"0":"bottom"===s?"":"50%",bottom:"bottom"===s?"0":"",transform:`${"center"===i?"translateX(-50%)":""} ${"center"===s?"translateY(-50%)":""}`}),e},D=[["x",0,3],["y",1,4],["z",2,5]],j=new s;function $({isSphere:t},e,s){t&&(j.set(0,0,1).applyQuaternion(s.quaternion),D.forEach(([t,s,o])=>{const n=j[t];let r=e[s],a=r.userData.opacity;r.material.opacity=i(n>=0?a:a/2,0,1),r=e[o],a=r.userData.opacity,r.material.opacity=i(n>=0?a/2:a,0,1)}))}const R=new n,F=new o,V=(t,e,s,i)=>{F.set((t.clientX-e.left)/e.width*2-1,-(t.clientY-e.top)/e.height*2+1),R.setFromCamera(F,s);const o=R.intersectObjects(i,!1),n=o.length?o[0]:null;return n&&n.object.visible?n:null},H=1e-6,Y=2*Math.PI,I=["x","y","z"],Q=[...I,"nx","ny","nz"],X=["right","top","front","left","bottom","back"],B=(t,e=!0)=>{const{material:s,userData:i}=t,{color:o,opacity:n}=e?i.hover:i;s.color.set(o),s.opacity=n},N=t=>JSON.parse(JSON.stringify(t));function U(t,...e){if(t instanceof HTMLElement||"object"!=typeof t||null===t)return t;for(const s of e)for(const e in s)"container"!==e&&e in s&&(void 0===t[e]?t[e]=s[e]:"object"!=typeof s[e]||Array.isArray(s[e])||(t[e]=U(t[e]||{},s[e])));return t}const W=(t,e=2)=>{const s=new r,i=2*e,{isSphere:o,resolution:n,radius:h,font:p,corners:d,edges:u}=t,m=Q.map(e=>({...t[e],radius:h}));o&&d.enabled&&m.push(d),o&&u.enabled&&m.push(u);const _=document.createElement("canvas"),g=_.getContext("2d");_.width=2*n+2*i,_.height=n*m.length+i*m.length;const[f,y]=function(t,e,s){const i=[...t].sort((t,e)=>(t.label?.length||0)-(e.label?.length||0)).pop().label,{family:n,weight:r}=s,a=o?Math.sqrt(Math.pow(.7*e,2)/2):e;let c=a,l=0,h=0;do{g.font=`${r} ${c}px ${n}`;const t=g.measureText(i);l=t.width,h=t.fontBoundingBoxDescent,c--}while(l>a&&c>0);const p=a/h,d=Math.min(a/l,p),u=Math.floor(c*d);return[`${r} ${u}px ${n}`,p]}(m,n,p);m.forEach(({radius:t,label:s,color:o,labelColor:r,border:a,hover:{color:c,labelColor:l,border:h}},p)=>{const d=n*p+p*i+e;x(e,d,e,n,t,s,a,o,r),x(n+3*e,d,e,n,t,s,h??a,c??o,l??r)});const w=m.length,b=e/(2*n),v=e/(6*n),S=1/w,E=new a(_);return E.repeat.set(.5-2*b,S-2*v),E.offset.set(b,1-v),Object.assign(E,{colorSpace:l,wrapS:c,wrapT:c,userData:{offsetX:b,offsetY:v,cellHeight:S}}),E;function x(t,e,i,n,r,a,c,l,h){if(r*=n/2,null!=l&&""!==l&&(p(),g.fillStyle=s.set(l).getStyle(),g.fill()),c&&c.size){const i=c.size*n/2;t+=i,e+=i,n-=c.size*n,r=Math.max(0,r-i),p(),g.strokeStyle=s.set(c.color).getStyle(),g.lineWidth=c.size*n,g.stroke()}function p(){g.beginPath(),g.moveTo(t+r,e),g.lineTo(t+n-r,e),g.arcTo(t+n,e,t+n,e+r,r),g.lineTo(t+n,e+n-r),g.arcTo(t+n,e+n,t+n-r,e+n,r),g.lineTo(t+r,e+n),g.arcTo(t,e+n,t,e+n-r,r),g.lineTo(t,e+r),g.arcTo(t,e,t+r,e,r),g.closePath()}a&&function(t,e,s,i,n){t.font=f,t.textAlign="center",t.textBaseline="middle",t.fillStyle=n,t.fillText(i,e,s+(o?y:0))}(g,t+n/2,e+(n+i)/2,a,s.set(h).getStyle())}},J=(t,e)=>{const{offset:s,userData:{offsetY:i,cellHeight:o}}=t;s.y=1-(e+1)*o+i};function G(t,e,s=2,i=2){const o=s/2-t,n=i/2-t,r=t/s,a=(s-t)/s,c=t/i,l=(i-t)/i,d=[o,n,0,-o,n,0,-o,-n,0,o,-n,0],u=[a,l,r,l,r,c,a,c],m=[3*(e+1)+3,3*(e+1)+4,e+4,e+5,2*(e+1)+4,2,1,2*(e+1)+3,3,4*(e+1)+3,4,0],_=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11].map(t=>m[t]);let g,f,y,w,b,v,S,E;for(let h=0;h<4;h++){w=h<1||h>2?o:-o,b=h<2?n:-n,v=h<1||h>2?a:r,S=h<2?l:c;for(let s=0;s<=e;s++)g=Math.PI/2*(h+s/e),f=Math.cos(g),y=Math.sin(g),d.push(w+t*f,b+t*y,0),u.push(v+r*f,S+c*y),s<e&&(E=(e+1)*h+s+4,_.push(h,E,E+1))}return(new h).setIndex(new p(new Uint32Array(_),1)).setAttribute("position",new p(new Float32Array(d),3)).setAttribute("uv",new p(new Float32Array(u),2))}const Z=t=>{const{corners:e,edges:i}=t,n=[],a=W(t),c=((t,e)=>{const i=new s,{isSphere:o,radius:n,smoothness:r}=t,a=G(n,r);return Q.map((s,n)=>{const r=n<3,c=Q[n],l=n?e.clone():e;J(l,n);const{enabled:h,scale:p,opacity:g,hover:f}=t[c],y={map:l,opacity:g,transparent:!0},w=o?new d(new u(y)):new m(a,new _(y)),b=r?c:c[1];return w.position[b]=(r?1:-1)*(o?1.3:1),o||w.lookAt(i.copy(w.position).multiplyScalar(1.7)),w.scale.setScalar(p),w.renderOrder=1,w.visible=h,w.userData={scale:p,opacity:g,hover:f},w})})(t,a);n.push(...c),e.enabled&&n.push(...((t,e)=>{const{isSphere:i,corners:o}=t;if(!o.enabled)return[];const{color:n,opacity:r,scale:a,radius:c,smoothness:l,hover:h}=o,p=i?null:G(c,l),g={transparent:!0,opacity:r},f=[1,1,1,-1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,-1,-1,-1,-1,-1].map(t=>.85*t),y=new s;return Array(f.length/3).fill(0).map((t,s)=>{if(i){const t=e.clone();J(t,6),g.map=t}else g.color=n;const o=i?new d(new u(g)):new m(p,new _(g)),c=3*s;return o.position.set(f[c],f[c+1],f[c+2]),i&&o.position.normalize().multiplyScalar(1.7),o.scale.setScalar(a),o.lookAt(y.copy(o.position).multiplyScalar(2)),o.renderOrder=1,o.userData={color:n,opacity:r,scale:a,hover:h},o})})(t,a)),i.enabled&&n.push(...((t,e,i)=>{const{isSphere:o,edges:n}=t;if(!n.enabled)return[];const{color:r,opacity:a,scale:c,hover:l,radius:h,smoothness:p}=n,g=o?null:G(h,p,1.2,.25),f={transparent:!0,opacity:a},y=[0,1,1,0,-1,1,1,0,1,-1,0,1,0,1,-1,0,-1,-1,1,0,-1,-1,0,-1,1,1,0,1,-1,0,-1,1,0,-1,-1,0].map(t=>.925*t),w=new s;return Array(y.length/3).fill(0).map((t,s)=>{if(o){const t=e.clone();J(t,i),f.map=t}else f.color=r;const n=o?new d(new u(f)):new m(g,new _(f)),h=3*s;return n.position.set(y[h],y[h+1],y[h+2]),o&&n.position.normalize().multiplyScalar(1.7),n.scale.setScalar(c),n.lookAt(w.copy(n.position).multiplyScalar(2)),o||n.position.y||(n.rotation.z=Math.PI/2),n.renderOrder=1,n.userData={color:r,opacity:a,scale:c,hover:l},n})})(t,a,e.enabled?7:6));const l=((t,e)=>{const{isSphere:s,background:{enabled:i,color:o,opacity:n,hover:r}}=e;let a;const c=new _({color:o,side:g,opacity:n,transparent:!0,depthWrite:!1});if(!i)return null;if(s)a=new m(new f(1.8,64,64),c);else{let e;t.forEach(t=>{const s=t.scale.x;t.scale.setScalar(.9),t.updateMatrix();const i=t.geometry.clone();i.applyMatrix4(t.matrix),e=e?y([e,i]):i,t.scale.setScalar(s)}),a=new m(e,c)}return a.userData={color:o,opacity:n,hover:r},a})(c,t),h=(t=>{const e=new r,s=[],i=[],{isSphere:n}=t;if(Q.forEach((o,r)=>{const{enabled:a,line:c,scale:l,color:h}=t[o];if(!a||!c)return;const p=(n?1.3-l/2:.975)*(r<3?1:-1);s.push(o.includes("x")?p:0,o.includes("y")?p:0,o.includes("z")?p:0,0,0,0);const d=e.set(h).toArray();i.push(...d,...d)}),!s.length)return null;const a=(new w).setPositions(s).setColors(i),c=new b({linewidth:t.lineWidth,vertexColors:!0,resolution:new o(window.innerWidth,window.innerHeight)});return new v(a,c).computeLineDistances()})(t);return[n,l,h]},K=(t,e=!0)=>{const{material:s,userData:i}=t,{opacity:o,color:n,scale:r}=e?i.hover:i;var a,c;t.scale.setScalar(r),s.opacity=o,s.map?(a=s.map,c=e,a.offset.x=(c?.5:0)+a.userData.offsetX):s.color.set(n)},tt=new C,et=new z,st=new s,it=new o;class ot extends S{constructor(t,e,i={}){super(),this.type="ViewportGizmo",this.enabled=!0,this.target=new s,this.animated=!0,this.speed=1,this.animating=!1,this._background=null,this._viewport=new E,this._originalViewport=new E,this._originalScissor=new E,this._dragging=!1,this._distance=0,this._clock=new x,this._targetPosition=new s,this._targetQuaternion=new M,this._quaternionStart=new M,this._quaternionEnd=new M,this._pointerStart=new o,this._focus=null,this.camera=t,this.renderer=e,this.set(i)}get placement(){return this._placement}set placement(t){this._placement=T(this._domElement,t),this.domUpdate()}set(t={}){this.dispose(),this.options=t,this._options=(t=>{const e=t.type||"sphere",s="sphere"===e,i=t.resolution||s?64:128,{container:o}=t;t.container=void 0,(t=JSON.parse(JSON.stringify(t))).container=o,X.forEach((e,s)=>{t[e]&&(t[Q[s]]=t[e])});const n={enabled:!0,color:16777215,opacity:1,scale:.7,labelColor:2236962,line:!1,border:{size:0,color:14540253},hover:{color:s?16777215:9688043,labelColor:2236962,opacity:1,scale:.7,border:{size:0,color:14540253}}},r={line:!1,scale:s?.45:.7,hover:{scale:s?.5:.7}},a={type:e,container:document.body,size:128,placement:"top-right",resolution:i,lineWidth:20,radius:s?1:.2,smoothness:18,animated:!0,speed:1,background:{enabled:!0,color:s?16777215:14739180,opacity:s?0:1,hover:{color:s?16777215:14739180,opacity:s?.2:1}},font:{family:"sans-serif",weight:900},offset:{top:10,left:10,bottom:10,right:10},corners:{enabled:!s,color:s?15915362:16777215,opacity:1,scale:s?.15:.2,radius:1,smoothness:18,hover:{color:s?16777215:9688043,opacity:1,scale:s?.2:.225}},edges:{enabled:!s,color:s?15915362:16777215,opacity:s?1:0,radius:s?1:.125,smoothness:18,scale:s?.15:1,hover:{color:s?16777215:9688043,opacity:1,scale:s?.2:1}},x:{...N(n),...s?{label:"X",color:16725587,line:!0}:{label:"Right"}},y:{...N(n),...s?{label:"Y",color:9100032,line:!0}:{label:"Top"}},z:{...N(n),...s?{label:"Z",color:2920447,line:!0}:{label:"Front"}},nx:{...N(r),label:s?"":"Left"},ny:{...N(r),label:s?"":"Bottom"},nz:{...N(r),label:s?"":"Back"}};return U(t,a),I.forEach(e=>U(t[`n${e}`],N(t[e]))),{...t,isSphere:s}})(t),this._camera=this._options.isSphere?new k(-1.8,1.8,1.8,-1.8,5,10):new L(26,1,5,10),this._camera.position.set(0,0,7);const[e,s,i]=Z(this._options);s&&this.add(s),i&&this.add(i),this.add(...e),this._background=s,this._intersections=e;const{container:o,animated:n,speed:r}=this._options;return this.animated=n,this.speed=r,this._container=o?(t=>{const e="string"==typeof t?document.querySelector(t):t;if(!e)throw Error("Invalid DOM element");return e})(o):document.body,this._domElement=(({placement:t,size:e,offset:s,id:i,className:o})=>{const n=document.createElement("div"),{top:r,left:a,right:c,bottom:l}=s;return Object.assign(n.style,{id:i,position:"absolute",zIndex:"1000",height:`${e}px`,width:`${e}px`,margin:`${r}px ${c}px ${l}px ${a}px`,borderRadius:"100%"}),T(n,t),i&&(n.id=i),o&&(n.className=o),n})(this._options),this._domElement.onpointerdown=t=>this._onPointerDown(t),this._domElement.onpointermove=t=>this._onPointerMove(t),this._domElement.onpointerleave=()=>this._onPointerLeave(),this._container.appendChild(this._domElement),this._controls&&this.attachControls(this._controls),this.update(),this}render(){this.animating&&this._animate();const{renderer:t,_viewport:e}=this,s=t.getScissorTest(),i=t.autoClear;return t.autoClear=!1,t.setViewport(e),s&&t.setScissor(e),t.clear(!1,!0,!1),t.render(this,this._camera),t.setViewport(this._originalViewport),s&&t.setScissor(this._originalScissor),t.autoClear=i,this}domUpdate(){this._domRect=this._domElement.getBoundingClientRect();const t=this.renderer,e=this._domRect,s=t.domElement.getBoundingClientRect();return this._viewport.set(e.left-s.left,t.domElement.clientHeight-(e.top-s.top+e.height),e.width,e.height),t.getViewport(this._originalViewport),t.getScissorTest()&&t.getScissor(this._originalScissor),this}cameraUpdate(){return this._updateOrientation(),this}update(t=!0){return t&&this._controls&&this._controls.update(),this.domUpdate().cameraUpdate()}attachControls(t){return this.detachControls(),this.target=t.target,this._controlsListeners={start:()=>t.enabled=!1,end:()=>t.enabled=!0,change:()=>this.update(!1)},this.addEventListener("start",this._controlsListeners.start),this.addEventListener("end",this._controlsListeners.end),t.addEventListener("change",this._controlsListeners.change),this._controls=t,this}detachControls(){if(this._controlsListeners&&this._controls)return this.target=(new s).copy(this._controls.target),this.removeEventListener("start",this._controlsListeners.start),this.removeEventListener("end",this._controlsListeners.end),this._controls.removeEventListener("change",this._controlsListeners.change),this._controlsListeners=void 0,this._controls=void 0,this}dispose(){this.detachControls(),this.children.forEach(t=>{this.remove(t);const e=t;e.material?.dispose(),e.material?.map?.dispose(),e.geometry?.dispose()}),this._domElement?.remove()}_updateOrientation(t=!0){t&&(this.quaternion.copy(this.camera.quaternion).invert(),this.updateMatrixWorld()),$(this._options,this._intersections,this.camera)}_animate(){const{position:t,quaternion:e}=this.camera;if(t.set(0,0,1),!this.animated)return t.applyQuaternion(this._quaternionEnd).multiplyScalar(this._distance).add(this.target),e.copy(this._targetQuaternion),this._updateOrientation(),this.animating=!1,this.dispatchEvent({type:"change"}),void this.dispatchEvent({type:"end"});const s=this._clock.getDelta()*Y*this.speed;this._quaternionStart.rotateTowards(this._quaternionEnd,s),t.applyQuaternion(this._quaternionStart).multiplyScalar(this._distance).add(this.target),e.rotateTowards(this._targetQuaternion,s),this._updateOrientation(),requestAnimationFrame(()=>this.dispatchEvent({type:"change"})),this._quaternionStart.angleTo(this._quaternionEnd)<H&&(this.animating=!1,this.dispatchEvent({type:"end"}))}_setOrientation(t){const e=this.camera,s=this.target;this._targetPosition.copy(t).multiplyScalar(this._distance),tt.setPosition(this._targetPosition).lookAt(this._targetPosition,this.position,this.up),this._targetQuaternion.setFromRotationMatrix(tt),this._targetPosition.add(s),tt.lookAt(this._targetPosition,s,this.up),this._quaternionEnd.setFromRotationMatrix(tt),tt.setPosition(e.position).lookAt(e.position,s,this.up),this._quaternionStart.setFromRotationMatrix(tt),this.animating=!0,this._clock.start(),this.dispatchEvent({type:"start"})}_onPointerDown(t){if(!this.enabled)return;const e=t=>{if(!this._dragging){if(((t,e,s=10)=>Math.abs(t.clientX-e.x)<s&&Math.abs(t.clientY-e.y)<s)(t,this._pointerStart))return;this._dragging=!0}const e=it.set(t.clientX,t.clientY).sub(this._pointerStart).multiplyScalar(1/this._domRect.width*Math.PI),s=et.setFromVector3(st.subVectors(this.camera.position,this.target));s.theta=n-e.x,s.phi=i(r-e.y,H,Math.PI-H),this.camera.position.setFromSpherical(s).add(this.target),this.camera.lookAt(this.target),this.quaternion.copy(this.camera.quaternion).invert(),this._updateOrientation(!1),this.dispatchEvent({type:"change"})},s=()=>{if(document.removeEventListener("pointermove",e,!1),document.removeEventListener("pointerup",s,!1),!this._dragging)return this._handleClick(t);this._focus&&(K(this._focus,!1),this._focus=null),this._dragging=!1,this.dispatchEvent({type:"end"})};if(this.animating)return;t.preventDefault(),this._pointerStart.set(t.clientX,t.clientY);const o=(new z).setFromVector3(st.subVectors(this.camera.position,this.target)),n=o.theta,r=o.phi;this._distance=o.radius,document.addEventListener("pointermove",e,!1),document.addEventListener("pointerup",s,!1),this.dispatchEvent({type:"start"})}_onPointerMove(t){this.enabled&&!this._dragging&&(this._background&&B(this._background,!0),this._handleHover(t))}_onPointerLeave(){this.enabled&&!this._dragging&&(this._background&&B(this._background,!1),this._focus&&K(this._focus,!1),this._domElement.style.cursor="")}_handleClick(t){const e=V(t,this._domRect,this._camera,this._intersections);this._focus&&(K(this._focus,!1),this._focus=null),e&&(this._setOrientation(e.object.position),this.dispatchEvent({type:"change"}))}_handleHover(t){const e=V(t,this._domRect,this._camera,this._intersections),s=e?.object||null;this._focus!==s&&(this._domElement.style.cursor=s?"pointer":"",this._focus&&K(this._focus,!1),(this._focus=s)?K(s,!0):$(this._options,this._intersections,this.camera))}}const nt=P({__name:"viewportGizmo",setup(s){const{camera:i,controls:o,renderer:n,sizes:r}=t(),a=A(),c={...O(a)},l=new ot(O(i.value),O(n),c);q(()=>o.value,t=>{t&&(l.attachControls(O(t)),console.log("gizmo attached to controls"))},{immediate:!0}),q([r.width,r.height],()=>{l.update()},{immediate:!0});const{onRender:h}=e();return h(()=>{l.render()},1),(t,e)=>null}});export{nt as _};
