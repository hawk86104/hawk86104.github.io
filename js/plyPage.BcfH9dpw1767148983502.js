import{importShared as _}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{ol as U,Kk as $}from"./index.DTe2qqjO1767148983502.js";import{useLoader as D}from"./customShaderMaterial.vue_vue_type_script_setup_true_lang.B7dQ_CiZ1767148983502.js";import"./index.vue_vue_type_script_setup_true_lang.CjsHShHS1767148983502.js";const{BufferGeometry:H,FileLoader:Y,Float32BufferAttribute:y,Loader:F,Color:X,SRGBColorSpace:z}=await _("three"),f=new X;class Z extends F{constructor(c){super(c),this.propertyNameMapping={},this.customPropertyMapping={}}load(c,h,p,C){const g=this,x=new Y(this.manager);x.setPath(this.path),x.setResponseType("arraybuffer"),x.setRequestHeader(this.requestHeader),x.setWithCredentials(this.withCredentials),x.load(c,function(B){try{h(g.parse(B))}catch(v){C?C(v):console.error(v),g.manager.itemError(c)}},p,C)}setPropertyNameMapping(c){this.propertyNameMapping=c}setCustomPropertyNameMapping(c){this.customPropertyMapping=c}parse(c){function h(e,s=0){const r=/^ply([\s\S]*)end_header(\r\n|\r|\n)/;let t="";const n=r.exec(e);n!==null&&(t=n[1]);const o={comments:[],elements:[],headerLength:s,objInfo:""},i=t.split(/\r\n|\r|\n/);let a;function d(u,m){const l={type:u[0]};return l.type==="list"?(l.name=u[3],l.countType=u[1],l.itemType=u[2]):l.name=u[1],l.name in m&&(l.name=m[l.name]),l}for(let u=0;u<i.length;u++){let m=i[u];if(m=m.trim(),m==="")continue;const l=m.split(/\s+/),N=l.shift();switch(m=l.join(" "),N){case"format":o.format=l[0],o.version=l[1];break;case"comment":o.comments.push(m);break;case"element":a!==void 0&&o.elements.push(a),a={},a.name=l[0],a.count=parseInt(l[1]),a.properties=[];break;case"property":a.properties.push(d(l,w.propertyNameMapping));break;case"obj_info":o.objInfo=m;break;default:console.log("unhandled",N,l)}}return a!==void 0&&o.elements.push(a),o}function p(e,s){switch(s){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function C(e,s){const r={};for(let t=0;t<e.length;t++){if(s.empty())return null;if(e[t].type==="list"){const n=[],o=p(s.next(),e[t].countType);for(let i=0;i<o;i++){if(s.empty())return null;n.push(p(s.next(),e[t].itemType))}r[e[t].name]=n}else r[e[t].name]=p(s.next(),e[t].type)}return r}function g(){const e={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[],faceVertexColors:[]};for(const s of Object.keys(w.customPropertyMapping))e[s]=[];return e}function x(e){const s=e.map(t=>t.name);function r(t){for(let n=0,o=t.length;n<o;n++){const i=t[n];if(s.includes(i))return i}return null}return{attrX:r(["x","px","posx"])||"x",attrY:r(["y","py","posy"])||"y",attrZ:r(["z","pz","posz"])||"z",attrNX:r(["nx","normalx"]),attrNY:r(["ny","normaly"]),attrNZ:r(["nz","normalz"]),attrS:r(["s","u","texture_u","tx"]),attrT:r(["t","v","texture_v","ty"]),attrR:r(["red","diffuse_red","r","diffuse_r"]),attrG:r(["green","diffuse_green","g","diffuse_g"]),attrB:r(["blue","diffuse_blue","b","diffuse_b"])}}function B(e,s){const r=g(),t=/end_header\s+(\S[\s\S]*\S|\S)\s*$/;let n,o;(o=t.exec(e))!==null?n=o[1].split(/\s+/):n=[];const i=new O(n);e:for(let a=0;a<s.elements.length;a++){const d=s.elements[a],u=x(d.properties);for(let m=0;m<d.count;m++){const l=C(d.properties,i);if(!l)break e;R(r,d.name,l,u)}}return v(r)}function v(e){let s=new H;e.indices.length>0&&s.setIndex(e.indices),s.setAttribute("position",new y(e.vertices,3)),e.normals.length>0&&s.setAttribute("normal",new y(e.normals,3)),e.uvs.length>0&&s.setAttribute("uv",new y(e.uvs,2)),e.colors.length>0&&s.setAttribute("color",new y(e.colors,3)),(e.faceVertexUvs.length>0||e.faceVertexColors.length>0)&&(s=s.toNonIndexed(),e.faceVertexUvs.length>0&&s.setAttribute("uv",new y(e.faceVertexUvs,2)),e.faceVertexColors.length>0&&s.setAttribute("color",new y(e.faceVertexColors,3)));for(const r of Object.keys(w.customPropertyMapping))e[r].length>0&&s.setAttribute(r,new y(e[r],w.customPropertyMapping[r].length));return s.computeBoundingSphere(),s}function R(e,s,r,t){if(s==="vertex"){e.vertices.push(r[t.attrX],r[t.attrY],r[t.attrZ]),t.attrNX!==null&&t.attrNY!==null&&t.attrNZ!==null&&e.normals.push(r[t.attrNX],r[t.attrNY],r[t.attrNZ]),t.attrS!==null&&t.attrT!==null&&e.uvs.push(r[t.attrS],r[t.attrT]),t.attrR!==null&&t.attrG!==null&&t.attrB!==null&&(f.setRGB(r[t.attrR]/255,r[t.attrG]/255,r[t.attrB]/255,z),e.colors.push(f.r,f.g,f.b));for(const n of Object.keys(w.customPropertyMapping))for(const o of w.customPropertyMapping[n])e[n].push(r[o])}else if(s==="face"){const n=r.vertex_indices||r.vertex_index,o=r.texcoord;n.length===3?(e.indices.push(n[0],n[1],n[2]),o&&o.length===6&&(e.faceVertexUvs.push(o[0],o[1]),e.faceVertexUvs.push(o[2],o[3]),e.faceVertexUvs.push(o[4],o[5]))):n.length===4&&(e.indices.push(n[0],n[1],n[3]),e.indices.push(n[1],n[2],n[3])),t.attrR!==null&&t.attrG!==null&&t.attrB!==null&&(f.setRGB(r[t.attrR]/255,r[t.attrG]/255,r[t.attrB]/255,z),e.faceVertexColors.push(f.r,f.g,f.b),e.faceVertexColors.push(f.r,f.g,f.b),e.faceVertexColors.push(f.r,f.g,f.b))}}function L(e,s){const r={};let t=0;for(let n=0;n<s.length;n++){const o=s[n],i=o.valueReader;if(o.type==="list"){const a=[],d=o.countReader.read(e+t);t+=o.countReader.size;for(let u=0;u<d;u++)a.push(i.read(e+t)),t+=i.size;r[o.name]=a}else r[o.name]=i.read(e+t),t+=i.size}return[r,t]}function b(e,s,r){function t(n,o,i){switch(o){case"int8":case"char":return{read:a=>n.getInt8(a),size:1};case"uint8":case"uchar":return{read:a=>n.getUint8(a),size:1};case"int16":case"short":return{read:a=>n.getInt16(a,i),size:2};case"uint16":case"ushort":return{read:a=>n.getUint16(a,i),size:2};case"int32":case"int":return{read:a=>n.getInt32(a,i),size:4};case"uint32":case"uint":return{read:a=>n.getUint32(a,i),size:4};case"float32":case"float":return{read:a=>n.getFloat32(a,i),size:4};case"float64":case"double":return{read:a=>n.getFloat64(a,i),size:8}}}for(let n=0,o=e.length;n<o;n++){const i=e[n];i.type==="list"?(i.countReader=t(s,i.countType,r),i.valueReader=t(s,i.itemType,r)):i.valueReader=t(s,i.type,r)}}function G(e,s){const r=g(),t=s.format==="binary_little_endian",n=new DataView(e,s.headerLength);let o,i=0;for(let a=0;a<s.elements.length;a++){const d=s.elements[a],u=d.properties,m=x(u);b(u,n,t);for(let l=0;l<d.count;l++){o=L(i,u),i+=o[1];const N=o[0];R(r,d.name,N,m)}}return v(r)}function j(e){let s=0,r=!0,t="";const n=[],o=new TextDecoder().decode(e.subarray(0,5)),i=/^ply\r\n/.test(o);do{const a=String.fromCharCode(e[s++]);a!==`
`&&a!=="\r"?t+=a:(t==="end_header"&&(r=!1),t!==""&&(n.push(t),t=""))}while(r&&s<e.length);return i===!0&&s++,{headerText:n.join("\r")+"\r",headerLength:s}}let S;const w=this;if(c instanceof ArrayBuffer){const e=new Uint8Array(c),{headerText:s,headerLength:r}=j(e),t=h(s,r);if(t.format==="ascii"){const n=new TextDecoder().decode(e);S=B(n,t)}else S=G(c,t)}else S=B(c,h(c));return S}}class O{constructor(c){this.arr=c,this.i=0}empty(){return this.i>=this.arr.length}next(){return this.arr[this.i++]}}const{withAsyncContext:q,defineComponent:K}=await _("vue"),{unref:W,createElementVNode:J,openBlock:Q,createElementBlock:E}=await _("vue"),ee=["geometry"],te=K({__name:"ply",async setup(P){let c,h;const p=([c,h]=q(()=>D(Z,"./plugins/gaussianSplatting/model/luigi.ply")),c=await c,h(),c);return p.computeVertexNormals(),(C,g)=>(Q(),E("TresPoints",{geometry:W(p)},[...g[0]||(g[0]=[J("TresPointsMaterial",{size:.01,color:"#0000ff"},null,-1)])],8,ee))}}),{defineComponent:re}=await _("vue"),{createElementVNode:T,unref:A,createVNode:V,Suspense:ne,withCtx:M,openBlock:k,createBlock:I,mergeProps:se}=await _("vue"),{SRGBColorSpace:oe,BasicShadowMap:ae,NoToneMapping:ie}=await _("three"),{reactive:le}=await _("vue"),fe=re({__name:"plyPage",setup(P){const c=le({clearColor:"#ffffff",alpha:!1,shadowMapType:ae,outputColorSpace:oe,toneMapping:ie});return(h,p)=>(k(),I(A(U),se(c,{"window-size":""}),{default:M(()=>[p[0]||(p[0]=T("TresPerspectiveCamera",{position:[3,3,3],fov:45,near:.1,far:1e3,"look-at":[0,0,0]},null,-1)),V(A($)),p[1]||(p[1]=T("TresAmbientLight",{intensity:3},null,-1)),(k(),I(ne,null,{default:M(()=>[V(te,{position:[0,.7,0]})]),_:1})),p[2]||(p[2]=T("TresDirectionalLight",{position:[6,2,4],intensity:2},null,-1)),p[3]||(p[3]=T("TresGridHelper",null,null,-1))]),_:1},16))}});export{fe as default};
