import{i as e}from"./3d-tiles-renderer.CbgZh8zU1767066396612.js";import{h as t,j as a}from"./generalFont.vue_vue_type_script_setup_true_lang.Z5LxGLZ21767066396612.js";import"./default.vue_vue_type_script_setup_true_lang.VHSeCGYE1767066396612.js";import"./three-mesh-ui.module.dA3oDDhS1767066396612.js";import"./domPanel.vue_vue_type_style_index_0_lang.D11M9pLL1767066396612.js";import{P as r}from"./tweakpane.CqZAnw7f1767066396612.js";import{Y as n,m as o,f as i,U as l,E as s}from"./three.BD1hRFgo1767066396612.js";import{N as u,_ as c,F as m}from"./@tresjs.B1f7s3pS1767066396612.js";import{l as p}from"./util.Bz2eiElJ1767066396612.js";import{_ as v}from"./@fesjs.BK66sTPr1767066396612.js";const d=await e("three"),f=e=>{let t=e.attributes.position.count,a=Math.ceil(Math.sqrt(t)),r=Math.ceil(t/a),n=new Float32Array(a*r*4);!function(e){for(let t=Math.floor(e.length/3)-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));for(let r=0;r<3;r++){let n=e[3*t+r];e[3*t+r]=e[3*a+r],e[3*a+r]=n}}}(e.attributes.position.array);for(let i=0;i<t;i++){const t=e.attributes.position.array[3*i+0],a=e.attributes.position.array[3*i+1],r=e.attributes.position.array[3*i+2],o=0;n[4*i+0]=t,n[4*i+1]=a,n[4*i+2]=r,n[4*i+3]=o}let o=new d.DataTexture(n,a,r,d.RGBAFormat,d.FloatType);return o.needsUpdate=!0,o},g=()=>{const e=new d.ShaderMaterial({uniforms:{uTextureA:{value:null},uTextureB:{value:null},uTime:{value:0},uScroll:{value:0}},vertexShader:"varying vec2 vUv;\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  vUv = uv;\n}",fragmentShader:"uniform sampler2D uTextureA;\nuniform sampler2D uTextureB;\nprecision mediump float; \nuniform float uTime;\nuniform float uScroll;\nvarying vec2 vUv;\n\nmat3 rotationMatrix3(vec3 axis, float angle) {\n  axis = normalize(axis);\n  float s = sin(angle);\n  float c = cos(angle);\n  float oc = 1. - c;\n\n  return mat3(oc * axis.x * axis.x + c, oc * axis.x * axis.y - axis.z * s,\n              oc * axis.z * axis.x + axis.y * s,\n              oc * axis.x * axis.y + axis.z * s, oc * axis.y * axis.y + c,\n              oc * axis.y * axis.z - axis.x * s,\n              oc * axis.z * axis.x - axis.y * s,\n              oc * axis.y * axis.z + axis.x * s, oc * axis.z * axis.z + c);\n}\n\nvoid main() {\n  vec3 textureA = rotationMatrix3(vec3(10., 6., 3.), sin(uTime) * .1) *\n                  texture2D(uTextureA, vUv).xyz;\n  \n\n  vec3 textureB = rotationMatrix3(vec3(10., 6., 3.), sin(uTime) * .1) *\n                  texture2D(uTextureB, vUv).xyz;\n  \n\n  float t = uScroll;\n  vec3 pos = mix(textureA, textureB, t);\n\n  gl_FragColor = vec4(pos, 1.);\n}"}),t=new d.BufferGeometry;return t.setAttribute("position",new d.BufferAttribute(new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]),3)),t.setAttribute("uv",new d.BufferAttribute(new Float32Array([0,1,1,1,1,0,0,1,1,0,0,0]),2)),new d.Mesh(t,e)};const{defineComponent:x}=await e("vue"),{unref:h,openBlock:w,createElementBlock:y}=await e("vue"),_=["object"],P=await e("three"),B=x({__name:"particalMesh",props:{progress:{default:0},width:{default:256},height:{default:256}},setup(e,{expose:t}){const a=e;let r=((e,t)=>{const a=e*t;let r=new Float32Array(3*a);for(let o=0;o<a;o++){let a=3*o;r[a+0]=o%e/e,r[a+1]=o/e/t}const n=new P.BufferGeometry;return n.setAttribute("position",new P.BufferAttribute(r,3)),new P.Points(n,new P.ShaderMaterial({uniforms:{uPositions:{value:null},uSize:{value:12},uPixelRatio:{value:Math.min(window.devicePixelRatio,2)},uColor:{value:new P.Color("#ffaa00")}},vertexShader:"uniform sampler2D\n    uPositions; \nuniform float uSize;\nuniform float uPixelRatio;\nvarying vec3 vPos;\nvarying vec2 vUv;\nvoid main() {\n  vec3 pos = texture2D(uPositions, position.xy).xyz;\n\n  float customSize = uSize;\n\n  vec4 modelPosition = modelMatrix * vec4(pos, 1.0);\n  vec4 viewPosition = viewMatrix * modelPosition;\n  vec4 projectionPosition = projectionMatrix * viewPosition;\n\n  gl_Position = projectionPosition;\n  gl_PointSize = customSize * uPixelRatio;\n  gl_PointSize *= (1.0 / -viewPosition.z);\n\n  vPos = pos;\n}",fragmentShader:"precision mediump float;\nvarying vec3 vPos;\nuniform vec3 uColor; \nvoid main() {\n\n  float distanceToCenter = distance(gl_PointCoord, vec2(0.5));\n  float strength = 0.05 / distanceToCenter - 0.1;\n\n  \n\n  gl_FragColor = vec4(uColor, strength * length(vPos));\n}",transparent:!0,depthWrite:!1,blending:P.AdditiveBlending}))})(a.width,a.height);return t({particles:r}),(e,t)=>(w(),y("primitive",{object:h(r)},null,8,_))}}),{withAsyncContext:M,defineComponent:S}=await e("vue"),{openBlock:b,createBlock:C}=await e("vue"),T=await e("three"),{ref:A,watch:z}=await e("vue"),F=S({__name:"particalFBO",props:{progress:{default:0},width:{default:256},height:{default:256},color:{default:"#ffaa00"}},async setup(e){let t,a;const r=e,i=A(null),l=new T.WebGLRenderTarget(r.width,r.height,{minFilter:T.NearestFilter,magFilter:T.NearestFilter,generateMipmaps:!1,colorSpace:T.SRGBColorSpace,depthBuffer:!1,stencilBuffer:!1,format:T.RGBAFormat,type:T.FloatType}),s=e=>{const t=[];return e.traverse(e=>{e instanceof T.Mesh&&(e.geometry.deleteAttribute("uv"),e.geometry.deleteAttribute("normal"),e.geometry.deleteAttribute("tangent"),t.push(e.geometry))}),o(t)},v="https://opensource.cdn.icegl.cn",d=v+"/model/medical/brainparts.OBJ",x=new n,h=([t,a]=M(()=>p(d,x)),t=await t,a(),t),w=s(h);w.scale(.01,.01,.01);const y=f(w),_=A(null),P=A(null),S=v+"/model/eCommerce/guanYu.glb",{state:F,nodes:j,materials:R,animations:G}=u(S,{draco:!0,decoderPath:"./draco/"});z(()=>F.value,e=>{if(e?.scene)try{const t=e.scene||e?.scene||e.scene,a=t.children?.[0]??t,r=s(a);r.rotateX(Math.PI/2),r.translate(0,-.9,0),_.value=f(r)}catch(t){console.warn("guanyu merge error",t)}},{immediate:!0});const k=v+"/model/industry4/modelDraco.glb",{state:U,nodes:D,materials:L,animations:E}=u(k,{draco:!0,decoderPath:"./draco/"});z(()=>U.value,e=>{if(e?.scene)try{const t=e.scene||e,a=t.children?.[0]??t,r=s(a);r.rotateX(-Math.PI/2),r.rotateY(Math.PI/3),r.translate(0,0,0),P.value=f(r)}catch(t){console.warn("plane merge error",t)}},{immediate:!0});const N=g(),V=new T.Scene,I=new T.OrthographicCamera(-1,1,1,-1,1/Math.pow(2,53),1);V.add(N);const{onBeforeRender:Y}=c(),{camera:O,renderer:W}=m();return Y(({elapsed:e})=>{if(W&&O.value&&i.value){W.setRenderTarget(l),W.clear(),W.render(V,I),W.setRenderTarget(null);const t=_.value||null,a=y||null,n=P.value||null,o=T.MathUtils.clamp(-r.progress/2,0,1);if(o<.5?(N.material.uniforms.uTextureA.value=t??a,N.material.uniforms.uTextureB.value=a,N.material.uniforms.uScroll.value=2*o):(N.material.uniforms.uTextureA.value=a,N.material.uniforms.uTextureB.value=n??a,N.material.uniforms.uScroll.value=2*(o-.5)),N.material.uniforms.uTime.value=e,i.value?.particles?.material?.uniforms){i.value.particles.material.uniforms.uPositions.value=l.texture;const e=i.value.particles.material.uniforms.uColor;e&&e.value.setStyle(r.color)}}}),(e,t)=>(b(),C(B,{ref_key:"pMesh",ref:i,progress:e.progress},null,8,["progress"]))}}),{defineComponent:j}=await e("vue"),{watchEffect:R}=await e("vue"),G=await e("three"),k=j({__name:"particalPass",props:{use:{type:Boolean,default:!0}},setup(e){const t=e,{camera:a,renderer:r,scene:n,sizes:o}=m(),u=0,p=.472,v=1.61;let d=null;R(()=>{o.width.value&&((e,t,a,r,n)=>{const o=new i(e,t),c=new l(new G.Vector2(r,n),p,v,u),m=new G.WebGLRenderTarget(r,n,{generateMipmaps:!1,minFilter:G.LinearFilter,magFilter:G.LinearFilter,format:G.RGBAFormat,colorSpace:G.SRGBColorSpace,samples:0});d=new s(a,m),d.addPass(o),d.addPass(c)})(n.value,a.value,r,o.width.value,o.height.value)});const{onRender:f}=c();return f(()=>{t.use?d&&d.render():r&&a.value&&r.render(n.value,a.value)}),(e,t)=>null}}),{defineComponent:U}=await e("vue"),{unref:D,createVNode:L,createElementVNode:E,Suspense:N,withCtx:V,openBlock:I,createBlock:Y,resolveComponent:O,normalizeProps:W,guardReactiveProps:X,Fragment:q,createElementBlock:J}=await e("vue"),{ref:K,watchEffect:H,reactive:Q}=await e("vue"),Z=await e("three"),$=v(U({__name:"scrollPartical",setup(e){const n=K(0);H(()=>{console.log("jaime ~ progress:",n.value)});const o={clearColor:"#000",outputColorSpace:Z.LinearSRGBColorSpace,toneMapping:Z.NoToneMapping,toneMappingExposure:1,windowSize:!0,renderMode:"manual",powerPreference:"high-performance",antialias:!0,alpha:!1,useLegacyLights:!1,physicallyCorrectLights:!0},i=Q({pass:!0,color:"#6aff00"}),l=new r({title:"参数",expanded:!0});return l.addBinding(i,"pass",{label:"后处理"}),l.addBinding(i,"color",{label:"颜色"}),(e,r)=>{const l=O("TresCanvas");return I(),J(q,null,[L(D(t),{styleNum:4}),L(l,W(X(o)),{default:V(()=>[r[1]||(r[1]=E("TresPerspectiveCamera",{position:[0,0,-4],fov:45,near:.1,far:1e3,"look-at":[0,0,0]},null,-1)),L(k,{use:i.pass},null,8,["use"]),L(a,{modelValue:n.value,"onUpdate:modelValue":r[0]||(r[0]=e=>n.value=e),distance:10,"smooth-scroll":.1,htmlScroll:""},{default:V(()=>[(I(),Y(N,null,{default:V(()=>[L(F,{progress:n.value,color:i.color},null,8,["progress","color"])]),_:1}))]),_:1},8,["modelValue"])]),_:1},16),r[2]||(r[2]=E("main",null,[E("section",null,[E("h1",null,"关羽 - GuanYu")]),E("section",null,[E("h1",{style:{"margin-left":"-11em","margin-bottom":"-10em"}},"大脑 - Brain")]),E("section",null,[E("h1",{style:{"margin-left":"11em","margin-bottom":"-10em"}},"设备 - Device")])],-1))],64)}}}),[["__scopeId","data-v-9439621a"]]);export{$ as default};
