import{importShared as l}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{loading$1 as j}from"./generalFont.vue_vue_type_script_setup_true_lang.Cx7Vff0m1767148983502.js";import"./default.vue_vue_type_script_setup_true_lang.Bjy6WD1C1767148983502.js";import"./three-mesh-ui.module.Cv5lk1vQ1767148983502.js";import"./domPanel.vue_vue_type_style_index_0_lang.DqrQKbSz1767148983502.js";import{loadJweixin as G,loadWebView as W}from"./initScript.DrJLCDfE1767148983502.js";import{useTexture$1 as O,_sfc_main as U,_sfc_main$1 as a}from"./customShaderMaterial.vue_vue_type_script_setup_true_lang.B7dQ_CiZ1767148983502.js";import"./index.vue_vue_type_script_setup_true_lang.CjsHShHS1767148983502.js";import{useGLTF as H}from"./index.Bk2zy1aS1767148983502.js";import{_l as L,Kk as A}from"./index.DTe2qqjO1767148983502.js";import"./reflectorDiffuse.vue_vue_type_script_setup_true_lang.Cxj_Ip691767148983502.js";import{_sfc_main as J}from"./reflectorDUDV.vue_vue_type_script_setup_true_lang.DYMkkQ781767148983502.js";import"./reflectorShaderMesh.vue_vue_type_script_setup_true_lang.T7UkXoyg1767148983502.js";import"./dynamicRotatingBase.vue_vue_type_script_setup_true_lang.BVQWYa0i1767148983502.js";import"./whiteFloorMesh.vue_vue_type_script_setup_true_lang.BCd7Uxt-1767148983502.js";import"./gridPlusCom.vue_vue_type_script_setup_true_lang.x_N2tft71767148983502.js";import"./videoFloor.vue_vue_type_script_setup_true_lang.Xg1Eqw4f1767148983502.js";import"./digitalGround.vue_vue_type_script_setup_true_lang.DBVFezcY1767148983502.js";import"./imgFloor.vue_vue_type_script_setup_true_lang.BPVumalx1767148983502.js";import"./reflectorRoundedBox.vue_vue_type_script_setup_true_lang.BOdU7iQo1767148983502.js";import"./particleBase.vue_vue_type_script_setup_true_lang.CIf_5jma1767148983502.js";import"./rippleFloor.vue_vue_type_script_setup_true_lang.BmWDhTNl1767148983502.js";import{_sfc_main as z}from"./lamboEffect.vue_vue_type_script_setup_true_lang.CRR-Y-kD1767148983502.js";import{FMessage as M}from"./index.DhptwYx91767148983502.js";const{withAsyncContext:E}=await l("vue"),{unref:K,openBlock:q,createElementBlock:Q}=await l("vue"),X=["object","rotation"],{toRaw:Y}=await l("vue"),u=await l("three"),Z={__name:"dissolveEffectCar",props:{edgeColor:{default:1118481},edgeWidth:{default:.03},dissolveSpeed:{default:.003},funRef:{appear:null,disappear:null}},async setup(C,{expose:g}){let e,m;const n=C,{scene:w,nodes:p,materials:t}=([e,m]=E(()=>H("https://opensource.cdn.icegl.cn/model/industry4/lambo.glb")),e=await e,m(),e);Object.values(p).forEach(o=>{o.isMesh&&(o.name.startsWith("glass")&&o.geometry.computeVertexNormals(),o.name==="silver_001_BreakDiscs_0"&&(o.material=t.BreakDiscs.clone(),o.material.color=new u.Color("#ddd")))}),p.glass_003.scale.setScalar(2.7),t.FrameBlack.color=new u.Color("black"),t.FrameBlack.roughness=0,t.FrameBlack.metalness=.75,t.Chrome.color=new u.Color("#333"),t.Chrome.metalness=1,t.Chrome.roughness=0,t.BreakDiscs.color=new u.Color("#555"),t.BreakDiscs.metalness=.2,t.BreakDiscs.roughness=.2,t.TiresGum.color=new u.Color("#181818"),t.TiresGum.metalness=0,t.TiresGum.roughness=.4,t.GreyElements.color=new u.Color("#292929"),t.GreyElements.metalness=0,p.yellow_WhiteCar_0.material=new u.MeshPhysicalMaterial({roughness:.3,metalness:.05,color:"#111",envMapIntensity:.75,clearcoatRoughness:0,clearcoat:1});const _=([e,m]=E(()=>O(["./plugins/digitalCity/image/smokeparticle.png","./plugins/industry4/image/dissolve.jpg"])),e=await e,m(),e),v=[];let d=!1;const y={dissolveProgress:1,noiseTexture:_[0],edgeColorTexture:_[1]};let h=n.dissolveSpeed;const T=()=>{if(!d){d=!0,h=n.dissolveSpeed;for(const o of v)o.uniforms.dissolveSpeed={value:h},o.uniforms.dissolveProgress={value:0}}},B=()=>{if(!d){d=!0,h=-n.dissolveSpeed;for(const o of v)o.uniforms.dissolveSpeed={value:h},o.uniforms.dissolveProgress={value:1}}};n.funRef.appear=T,n.funRef.disappear=B,g({appear:T,disappear:B}),Object.values(p).forEach(o=>{if(o.isMesh){o.frustumCulled=!1;const f=o.material;f.transparent=!0,f.onBeforeCompile=r=>{v.push(r),r.uniforms.edgeColor={value:new u.Color(n.edgeColor)},r.uniforms.edgeWidth={value:n.edgeWidth},r.uniforms.dissolveSpeed={value:n.dissolveSpeed},r.uniforms.dissolveProgress={value:y.dissolveProgress},r.uniforms.noiseTexture={value:y.noiseTexture},r.uniforms.edgeColorTexture={value:y.edgeColorTexture},r.vertexShader=r.vertexShader.replace("#include <common>",["varying vec2 xUv;","#include <common>"].join(`
`)),r.vertexShader=r.vertexShader.replace("#include <uv_vertex>",["xUv = uv;","#include <uv_vertex>"].join(`
`)),r.fragmentShader=r.fragmentShader.replace("#include <common>",`#include <common>
					 uniform float dissolveProgress;
					 uniform float edgeWidth;
					 uniform vec3 edgeColor;
					 uniform sampler2D noiseTexture;
					 uniform sampler2D edgeColorTexture;
					 varying vec2 xUv;
					`),r.fragmentShader=r.fragmentShader.replace("#include <dithering_fragment>",`#include <dithering_fragment>
							float noiseValue = texture2D(noiseTexture, xUv).r;
							vec4 finalColor = texture2D(edgeColorTexture, xUv);

							vec3 mixedColor = mix(finalColor.rgb, edgeColor, 0.5);
							finalColor.rgb = mixedColor;

							// vec4 finalColor = linearToOutputTexel( vec4(edgeColor, gl_FragColor.a) );
							float alpha = step(noiseValue - edgeWidth, dissolveProgress);
							gl_FragColor.a = alpha;
							float useOrigin = step(noiseValue, dissolveProgress);
							gl_FragColor.rgb = mix(finalColor.rgb, gl_FragColor.rgb, useOrigin);`)}}});const{onBeforeRender:N}=L();return N(()=>{if(d)for(const o of v){const{dissolveProgress:f,dissolveSpeed:r}=o.uniforms;f.value+=r.value,f.value<0&&(d=!1,n.funRef.aEnd()),f.value>1&&(d=!1,n.funRef.aEnd())}}),(o,f)=>(q(),Q("primitive",{object:Y(K(w)),scale:.015,rotation:[0,Math.PI/1.5,0]},null,8,X))}},{createElementVNode:c,unref:i,createVNode:s,Suspense:P,withCtx:k,openBlock:S,createBlock:$,Fragment:ee,createElementBlock:oe}=await l("vue"),te=["rotation"],re=["side"],se=["rotation"],ne=["side"],b=await l("three"),ie={__name:"otherObject",setup(C){return(g,e)=>(S(),oe(ee,null,[e[2]||(e[2]=c("TresPerspectiveCamera",{position:[0,10,15],fov:25,near:.1,far:1e4},null,-1)),s(i(A),{autoRotate:""}),e[3]||(e[3]=c("TresHemisphereLight",{intensity:.5},null,-1)),(S(),$(P,null,{default:k(()=>[s(i(J),{position:[0,-1.562,0],reflectivity:2.6,showGridHelper:!1,scale:1.5})]),_:1})),c("TresMesh",{scale:4,position:[3,-1.161,-1.5],rotation:[-Math.PI/2,0,Math.PI/2.5]},[e[0]||(e[0]=c("TresRingGeometry",{args:[.9,1,4,1]},null,-1)),c("TresMeshStandardMaterial",{color:"white",roughness:.75,side:b.DoubleSide},null,8,re)],8,te),c("TresMesh",{scale:4,position:[-3,-1.161,-1],rotation:[-Math.PI/2,0,Math.PI/2.5]},[e[1]||(e[1]=c("TresRingGeometry",{args:[.9,1,3,1]},null,-1)),c("TresMeshStandardMaterial",{color:"white",roughness:.75,side:b.DoubleSide},null,8,ne)],8,se),(S(),$(P,null,{default:k(()=>[s(i(U),{resolution:512},{default:k(()=>[s(i(a),{intensity:2,position:[0,1,3],scale:[10,1,1]}),s(i(a),{intensity:2,"rotation-x":Math.PI/2,position:[0,4,-6],scale:[10,1,1]},null,8,["rotation-x"]),s(i(a),{intensity:2,"rotation-x":Math.PI/2,position:[0,4,-3],scale:[10,1,1]},null,8,["rotation-x"]),s(i(a),{intensity:2,"rotation-x":Math.PI/2,position:[0,4,0],scale:[10,1,1]},null,8,["rotation-x"]),s(i(a),{intensity:2,"rotation-x":Math.PI/2,position:[0,4,3],scale:[10,1,1]},null,8,["rotation-x"]),s(i(a),{intensity:2,"rotation-x":Math.PI/2,position:[0,4,6],scale:[10,1,1]},null,8,["rotation-x"]),s(i(a),{intensity:2,"rotation-x":Math.PI/2,position:[0,4,9],scale:[10,1,1]},null,8,["rotation-x"]),s(i(a),{intensity:2,"rotation-y":Math.PI/2,position:[-50,2,0],scale:[100,2,1]},null,8,["rotation-y"]),s(i(a),{intensity:2,"rotation-y":-Math.PI/2,position:[50,2,0],scale:[100,2,1]},null,8,["rotation-y"]),s(i(a),{form:"ring",color:"red",intensity:10,scale:2,position:[10,5,10]})]),_:1})]),_:1})),s(z)],64))}},{defineComponent:ae}=await l("vue"),{unref:le,createVNode:x,mergeProps:R,Suspense:ue,withCtx:D,openBlock:I,createBlock:ce,resolveComponent:me,createElementVNode:pe,Fragment:de,createElementBlock:fe}=await l("vue"),{reactive:F,onMounted:ge,ref:V}=await l("vue"),We=ae({__name:"threedemo",setup(C){const g=V(!1);ge(async()=>{console.log("onMounted"),await G(),await W(),g.value=!0,uni.getEnv?uni.getEnv(p=>{M.success(`当前环境：${JSON.stringify(p)}`)}):M.error("当前web浏览器访问无效，请使用小程序或者app访问该页面")});const e=F({clearColor:"#15151a",antialias:!1,logarithmicDepthBuffer:!0,renderMode:"manual"}),m=F({edgeColor:"#111111",edgeWidth:.03,dissolveSpeed:.003,funRef:{appear:null,disappear:null,aEnd:()=>{}}}),n=V(null),w=()=>{if(g.value){if(console.log("clickMesh"),!uni.postMessage){M.error("当前web浏览器访问无效，请使用小程序或者app访问该页面");return}n.value.funRef.disappear(),uni.postMessage({data:{action:"三维页面发送了消息"}})}};return m.funRef.aEnd=()=>{console.log("aEnd"),uni.navigateBack()},(p,t)=>{const _=me("TresCanvas");return I(),fe(de,null,[x(le(j)),x(_,R(e,{"window-size":""}),{default:D(()=>[(I(),ce(ue,null,{default:D(()=>[x(Z,R(m,{ref_key:"dissolveEffectModelRef",ref:n,onClick:w}),null,16)]),_:1})),x(ie)]),_:1},16),t[0]||(t[0]=pe("h2",{class:"text-center text-white w-full absolute"},"双击车辆消失后回传信息且跳转",-1))],64)}}});export{We as default};
