import{importShared as e}from"./3d-tiles-renderer.BWkWgmMi1767151797345.js";const{shallowRef:t,watchEffect:n,readonly:i,watch:r,customRef:s,getCurrentScope:o,onScopeDispose:a,effectScope:l,getCurrentInstance:c,hasInjectionContext:u,inject:h,provide:d,ref:p,isRef:m,unref:f,toValue:g,computed:_,reactive:v,toRefs:y,toRef:b,shallowReadonly:w,onBeforeMount:T,nextTick:x,onBeforeUnmount:E,onMounted:P,onUnmounted:A,isReactive:M}=await e("vue");function S(e){return!!o()&&(a(e),!0)}function C(){const e=new Set,t=t=>{e.delete(t)};return{on:n=>{e.add(n);const i=()=>t(n);return S(i),{off:i}},off:t,trigger:(...t)=>Promise.all(Array.from(e).map(e=>e(...t))),clear:()=>{e.clear()}}}const R=new WeakMap,O=(...e)=>{var t;const n=e[0],i=null==(t=c())?void 0:t.proxy;if(null==i&&!u())throw new Error("injectLocal must be called in setup");return i&&R.has(i)&&n in R.get(i)?R.get(i)[n]:h(...e)};const k="undefined"!=typeof window&&"undefined"!=typeof document;"undefined"!=typeof WorkerGlobalScope&&(globalThis,WorkerGlobalScope);const L=Object.prototype.toString,I=()=>{};function D(e,t=!1,n="Timeout"){return new Promise((i,r)=>{t?setTimeout(()=>r(n),e):setTimeout(i,e)})}function F(e){return e.endsWith("rem")?16*Number.parseFloat(e):Number.parseFloat(e)}function U(e){return Array.isArray(e)?e:[e]}function N(e,t=200,n={}){return function(e,t){return function(...n){return new Promise((i,r)=>{Promise.resolve(e(()=>t.apply(this,n),{fn:t,thisArg:this,args:n})).then(i).catch(r)})}}(function(e,t={}){let n,i,r=I;const s=e=>{clearTimeout(e),r(),r=I};let o;return a=>{const l=g(e),c=g(t.maxWait);return n&&s(n),l<=0||void 0!==c&&c<=0?(i&&(s(i),i=void 0),Promise.resolve(a())):new Promise((e,u)=>{r=t.rejectOnCancel?u:e,o=a,c&&!i&&(i=setTimeout(()=>{n&&s(n),i=void 0,e(o())},c)),n=setTimeout(()=>{i&&s(i),i=void 0,e(a())},l)})}}(t,n),e)}function j(e,t=200,n={}){const i=p(g(e)),s=N(()=>{i.value=e.value},t,n);return r(e,()=>s()),w(i)}function z(e,t=!0,n){c()?P(e,n):t?e():x(e)}function B(e,t=!1){function n(n,{flush:i="sync",deep:s=!1,timeout:o,throwOnTimeout:a}={}){let l=null;const c=[new Promise(o=>{l=r(e,e=>{n(e)!==t&&(l?l():x(()=>null==l?void 0:l()),o(e))},{flush:i,deep:s,immediate:!0})})];return null!=o&&c.push(D(o,a).then(()=>g(e)).finally(()=>null==l?void 0:l())),Promise.race(c)}function i(i,s){if(!m(i))return n(e=>e===i,s);const{flush:o="sync",deep:a=!1,timeout:l,throwOnTimeout:c}=null!=s?s:{};let u=null;const h=[new Promise(n=>{u=r([e,i],([e,i])=>{t!==(e===i)&&(u?u():x(()=>null==u?void 0:u()),n(e))},{flush:o,deep:a,immediate:!0})})];return null!=l&&h.push(D(l,c).then(()=>g(e)).finally(()=>(null==u||u(),g(e)))),Promise.race(h)}function s(e){return o(1,e)}function o(e=1,t){let i=-1;return n(()=>(i+=1,i>=e),t)}if(Array.isArray(g(e))){return{toMatch:n,toContains:function(e,t){return n(t=>{const n=Array.from(t);return n.includes(e)||n.includes(g(e))},t)},changed:s,changedTimes:o,get not(){return B(e,!t)}}}return{toMatch:n,toBe:i,toBeTruthy:function(e){return n(e=>Boolean(e),e)},toBeNull:function(e){return i(null,e)},toBeNaN:function(e){return n(Number.isNaN,e)},toBeUndefined:function(e){return i(void 0,e)},changed:s,changedTimes:o,get not(){return B(e,!t)}}}function V(e){return B(e)}function H(e=1e3,n={}){const{controls:i=!1,callback:r}=n,s=function(e,n,i={}){const{immediate:r=!0,immediateCallback:s=!1}=i,o=t(!1);let a;function l(){a&&(clearTimeout(a),a=void 0)}function c(){o.value=!1,l()}function u(...t){s&&e(),l(),o.value=!0,a=setTimeout(()=>{o.value=!1,a=void 0,e(...t)},g(n))}return r&&(o.value=!0,k&&u()),S(c),{isPending:w(o),start:u,stop:c}}(null!=r?r:I,e,n),o=_(()=>!s.isPending.value);return i?{ready:o,...s}:o}function G(e,t,n){return r(e,t,{...n,immediate:!0})}const{isRef:W,shallowRef:K,ref:X,watchEffect:q,computed:Y,inject:$,defineComponent:Z,h:Q,TransitionGroup:J,Fragment:ee,shallowReactive:te,toValue:ne,unref:ie,getCurrentInstance:re,onMounted:se,watch:oe,customRef:ae,onUpdated:le,readonly:ce,reactive:ue,hasInjectionContext:he,toRaw:de,shallowReadonly:pe,nextTick:me,markRaw:fe,getCurrentScope:ge,isReadonly:_e,onBeforeUpdate:ve}=await e("vue"),ye=k?window:void 0;function be(e){var t;const n=ne(e);return null!=(t=null==n?void 0:n.$el)?t:n}function we(...e){const t=[],n=()=>{t.forEach(e=>e()),t.length=0},i=Y(()=>{const t=U(ne(e[0])).filter(e=>null!=e);return t.every(e=>"string"!=typeof e)?t:void 0}),r=G(()=>{var t,n;return[null!=(n=null==(t=i.value)?void 0:t.map(e=>be(e)))?n:[ye].filter(e=>null!=e),U(ne(i.value?e[1]:e[0])),U(ie(i.value?e[2]:e[1])),ne(i.value?e[3]:e[2])]},([e,i,r,s])=>{if(n(),!(null==e?void 0:e.length)||!(null==i?void 0:i.length)||!(null==r?void 0:r.length))return;const o=(a=s,"[object Object]"===L.call(a)?{...s}:s);var a;t.push(...e.flatMap(e=>i.flatMap(t=>r.map(n=>((e,t,n,i)=>(e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)))(e,t,n,o)))))},{flush:"post"});return S(n),()=>{r(),n()}}function Te(){const e=K(!1),t=re();return t&&se(()=>{e.value=!0},t),e}function xe(e){const t=Te();return Y(()=>(t.value,Boolean(e())))}function Ee(e,t={}){const{immediate:n=!0,fpsLimit:i,window:r=ye,once:s=!1}=t,o=K(!1),a=Y(()=>i?1e3/ne(i):null);let l=0,c=null;function u(t){if(!o.value||!r)return;l||(l=t);const n=t-l;if(a.value&&n<a.value)c=r.requestAnimationFrame(u);else{if(l=t,e({delta:n,timestamp:t}),s)return o.value=!1,void(c=null);c=r.requestAnimationFrame(u)}}function h(){!o.value&&r&&(o.value=!0,l=0,c=r.requestAnimationFrame(u))}function d(){o.value=!1,null!=c&&r&&(r.cancelAnimationFrame(c),c=null)}return n&&h(),S(d),{isActive:ce(o),pause:d,resume:h}}function Pe(e,t,n){var i;const{immediate:r=!0,delay:s=0,onError:o=(null!=(i=globalThis.reportError)?i:I),onSuccess:a=I,resetOnExecute:l=!0,shallow:c=!0,throwError:u}=null!=n?n:{},h=c?K(t):X(t),d=K(!1),p=K(!1),m=K(void 0);async function f(n=0,...i){l&&(h.value=ne(t)),m.value=void 0,d.value=!1,p.value=!0,n>0&&await D(n);const r="function"==typeof e?e(...i):e;try{const e=await r;h.value=e,d.value=!0,a(e)}catch(Pi){if(m.value=Pi,o(Pi),u)throw Pi}finally{p.value=!1}return h.value}r&&f(s);const g={state:h,isReady:d,isLoading:p,error:m,execute:f,executeImmediate:(...e)=>f(0,...e)};return{...g,then:(e,t)=>new Promise((e,t)=>{V(p).toBe(!1).then(()=>e(g)).catch(t)}).then(e,t)}}const Ae=Symbol("vueuse-ssr-width");function Me(){const e=he()?O(Ae,null):null;return"number"==typeof e?e:void 0}function Se(e,t={}){const{window:n=ye,ssrWidth:i=Me()}=t,r=xe(()=>n&&"matchMedia"in n&&"function"==typeof n.matchMedia),s=K("number"==typeof i),o=K(),a=K(!1);return q(()=>{if(s.value){s.value=!r.value;const t=ne(e).split(",");return void(a.value=t.some(e=>{const t=e.includes("not all"),n=e.match(/\(\s*min-width:\s*(-?\d+(?:\.\d*)?[a-z]+\s*)\)/),r=e.match(/\(\s*max-width:\s*(-?\d+(?:\.\d*)?[a-z]+\s*)\)/);let s=Boolean(n||r);return n&&s&&(s=i>=F(n[1])),r&&s&&(s=i<=F(r[1])),t?!s:s}))}r.value&&(o.value=n.matchMedia(ne(e)),a.value=o.value.matches)}),we(o,"change",e=>{a.value=e.matches},{passive:!0}),Y(()=>a.value)}function Ce(e,t={width:0,height:0},n={}){const{window:i=ye,box:r="content-box"}=n,s=Y(()=>{var t,n;return null==(n=null==(t=be(e))?void 0:t.namespaceURI)?void 0:n.includes("svg")}),o=K(t.width),a=K(t.height),{stop:l}=function(e,t,n={}){const{window:i=ye,...r}=n;let s;const o=xe(()=>i&&"ResizeObserver"in i),a=()=>{s&&(s.disconnect(),s=void 0)},l=Y(()=>{const t=ne(e);return Array.isArray(t)?t.map(e=>be(e)):[be(t)]}),c=oe(l,e=>{if(a(),o.value&&i){s=new ResizeObserver(t);for(const t of e)t&&s.observe(t,r)}},{immediate:!0,flush:"post"}),u=()=>{a(),c()};return S(u),{isSupported:o,stop:u}}(e,([t])=>{const n="border-box"===r?t.borderBoxSize:"content-box"===r?t.contentBoxSize:t.devicePixelContentBoxSize;if(i&&s.value){const t=be(e);if(t){const e=t.getBoundingClientRect();o.value=e.width,a.value=e.height}}else if(n){const e=U(n);o.value=e.reduce((e,{inlineSize:t})=>e+t,0),a.value=e.reduce((e,{blockSize:t})=>e+t,0)}else o.value=t.contentRect.width,a.value=t.contentRect.height},n);z(()=>{const n=be(e);n&&(o.value="offsetWidth"in n?n.offsetWidth:t.width,a.value="offsetHeight"in n?n.offsetHeight:t.height)});const c=oe(()=>be(e),e=>{o.value=e?t.width:0,a.value=e?t.height:0});return{width:o,height:a,stop:function(){l(),c()}}}function Re(e={}){const n=X(),i=xe(()=>"undefined"!=typeof performance&&"memory"in performance);if(i.value){const{interval:i=1e3}=e;!function(e,n=1e3,i={}){const{immediate:s=!0,immediateCallback:o=!1}=i;let a=null;const l=t(!1);function c(){a&&(clearInterval(a),a=null)}function u(){l.value=!1,c()}function h(){const t=g(n);t<=0||(l.value=!0,o&&e(),c(),l.value&&(a=setInterval(e,t)))}s&&k&&h(),(m(n)||"function"==typeof n)&&S(r(n,()=>{l.value&&k&&h()}));S(u),w(l)}(()=>{n.value=performance.memory},i,{immediate:e.immediate,immediateCallback:e.immediateCallback})}return{isSupported:i,memory:n}}const{reactive:Oe,toValue:ke,watch:Le,onUnmounted:Ie,defineComponent:De,renderSlot:Fe,unref:Ue,ref:Ne,computed:je,watchEffect:ze,readonly:Be,shallowRef:Ve,isRef:He,useSlots:Ge,getCurrentInstance:We,onMounted:Ke,createElementBlock:Xe,openBlock:qe,normalizeStyle:Ye,normalizeClass:$e,createRenderer:Ze,h:Qe,provide:Je,Fragment:et}=await e("vue"),tt=await e("three"),{Layers:nt,Scene:it,MathUtils:rt,Clock:st,WebGLRenderer:ot,Mesh:at,Material:lt,Vector3:ct,Vector2:ut,Ray:ht,SphereGeometry:dt,Object3D:pt,Matrix4:mt,BufferAttribute:ft,Triangle:gt,Line3:_t,Plane:vt,Raycaster:yt,Quaternion:bt,Sphere:wt,MeshBasicMaterial:Tt,DoubleSide:xt,Color:Et,PCFSoftShadowMap:Pt,ACESFilmicToneMapping:At,PerspectiveCamera:Mt,ArrowHelper:St,Line:Ct,BufferGeometry:Rt,Float32BufferAttribute:Ot,LineBasicMaterial:kt,BackSide:Lt,HemisphereLightHelper:It,SpotLightHelper:Dt,PointLightHelper:Ft,DirectionalLightHelper:Ut}=await e("three"),Nt={name:"@tresjs/core",type:"module",version:"5.0.2",packageManager:"pnpm@10.17.0",description:"Declarative ThreeJS using Vue Components",author:"Alvaro Saburido <hola@alvarosaburido.dev> (https://github.com/alvarosabu/)",license:"MIT",repository:{type:"git",url:"git+https://github.com/Tresjs/tres.git"},keywords:["vue","3d","threejs","three","threejs-vue"],sideEffects:!1,exports:{".":{types:"./dist/index.d.ts",import:"./dist/tres.js",default:"./dist/tres.js"},"./components":{types:"./dist/src/components/index.d.ts"},"./composables":{types:"./dist/src/composables/index.d.ts"},"./types":{types:"./dist/src/types/index.d.ts"},"./utils":{types:"./dist/src/utils/index.d.ts"},"./*":"./*"},module:"./dist/tres.js",types:"./dist/index.d.ts",files:["*.d.ts","dist"],publishConfig:{access:"public"},scripts:{dev:"pnpm --filter='./playground/vue' dev","dev:nuxt":"pnpm --filter='./playground/nuxt' dev",build:"vite build",test:"vitest","test:ci":"vitest run","test:ui":"vitest --ui --coverage.enabled=true",release:"release-it",coverage:"vitest run --coverage",lint:"eslint .","lint:fix":"eslint . --fix",typecheck:"vue-tsc --noEmit","docs:dev":"pnpm --filter='./docs' dev","docs:generate":"pnpm --filter='./docs' generate","docs:prepare":"pnpm --filter='./docs' prepare","docs:lint":"pnpm --filter='./docs' lint","docs:typecheck":"pnpm --filter='./docs' typecheck"},peerDependencies:{three:">=0.133",vue:">=3.4"},dependencies:{"@pmndrs/pointer-events":"^6.6.17","@vue/devtools-api":"^7.7.2","@vueuse/core":"^13.9.0",radashi:"^12.6.2"},devDependencies:{"@release-it/conventional-changelog":"^10.0.0","@stackblitz/sdk":"^1.11.0","@tresjs/cientos":"5.0.0-alpha.1","@tresjs/eslint-config":"^1.4.0","@tresjs/leches":"1.0.0-next.0","@types/three":"^0.180.0","@typescript-eslint/eslint-plugin":"^8.42.0","@typescript-eslint/parser":"^8.42.0","@vitejs/plugin-vue":"^6.0.1","@vitest/coverage-c8":"^0.33.0","@vitest/coverage-v8":"^3.2.4","@vitest/ui":"^3.2.4","@vue/test-utils":"^2.4.6",eslint:"^9.34.0","eslint-plugin-vue":"^10.4.0",esno:"^4.8.0",gsap:"^3.13.0",jsdom:"^27.0.0",kolorist:"^1.8.0",ohmyfetch:"^0.4.21",pathe:"^2.0.3","release-it":"^19.0.4","rollup-plugin-analyzer":"^4.0.0","rollup-plugin-copy":"^3.5.0","rollup-plugin-visualizer":"^6.0.3",sponsorkit:"^17.0.0",three:"^0.180.0",unocss:"^65.5.0",unplugin:"^2.3.10","unplugin-vue-components":"^29.0.0",vite:"^7.1.6","vite-plugin-banner":"^0.8.1","vite-plugin-dts":"4.5.4","vite-plugin-inspect":"^11.3.3","vite-plugin-require-transform":"^1.0.21","vite-svg-loader":"^5.1.0",vitepress:"1.6.4",vitest:"3.2.4",vue:"3.5.21","vue-demi":"^0.14.10","vue-tsc":"^3.0.6"},pnpm:{onlyBuiltDependencies:["better-sqlite3"],ignoredBuiltDependencies:["vue-demi"],overrides:{ipx:"^3.0.3",vue:"^3.5.21","vue-router":"^4.5.1"}},resolutions:{unimport:"4.1.1"}};
/*! #__NO_SIDE_EFFECTS__ */
function jt(e){const t=Object.create(null);for(const n of e.split(","))t[n]=1;return e=>e in t}const zt=jt("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,hgroup,h1,h2,h3,h4,h5,h6,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,summary,template,blockquote,iframe,tfoot");function Bt(e){var t;const n=(null==(t=e?.replace(/([A-Z])+/g,Vt))?void 0:t.split(/(?=[A-Z])|[\.\-\s_]/).map(e=>e.toLowerCase()))??[];return 0===n.length?"":1===n.length?n[0]:n.reduce((e,t)=>`${e}${t.charAt(0).toUpperCase()}${t.slice(1)}`)}function Vt(e){if(!e||0===e.length)return"";const t=e.toLowerCase();return t.substring(0,1).toUpperCase()+t.substring(1,t.length)}function Ht(e,t){if(Object.is(e,t))return!0;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(e instanceof RegExp&&t instanceof RegExp)return e.toString()===t.toString();if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const n=Reflect.ownKeys(e),i=Reflect.ownKeys(t);if(n.length!==i.length)return!1;for(let r=0;r<n.length;r++)if(!Reflect.has(t,n[r])||!Ht(e[n[r]],t[n[r]]))return!1;return!0}function Gt(e){return"function"==typeof e}function Wt(e){return"number"==typeof e&&!Number.isNaN(e)}function Kt(e){return function(e,t){return Object.prototype.toString.call(e)===t}(e,"[object Object]")}function Xt(e){return"string"==typeof e}function qt(e){return typeof e>"u"}const Yt=e=>t=>Kt(t)&&e in t&&!!t[e],$t=Yt("isObject3D"),Zt=Yt("isMesh"),Qt=Yt("isCamera"),Jt=Yt("isOrthographicCamera"),en=Yt("isPerspectiveCamera"),tn=Yt("isColor"),nn=e=>e instanceof nt,rn=Yt("isBufferGeometry"),sn=Yt("isMaterial"),on=Yt("isLight"),an=Yt("isFog"),ln=Yt("isScene"),cn=e=>null!==e&&"object"==typeof e&&"set"in e&&"function"==typeof e.set,un=e=>Qt(e)||Jt(e)||en(e),hn=Yt("isPrimitive"),dn=e=>(e=>$t(e)||rn(e)||sn(e)||an(e))(e)&&"__tres"in e,pn="[TresJS ▲ ■ ●] ";function mn(...e){"string"==typeof e[0]?e[0]=pn+e[0]:e.unshift(pn),console.error(...e)}function fn(e){var t;"map"in(t=e)&&!!t.map&&e.map.dispose(),e.dispose()}function gn(e){if(e.parent&&e.removeFromParent?.(),delete e.__tres,[...e.children].forEach(e=>gn(e)),!(e instanceof it)){const t=e;e&&e.dispose?.(),t.geometry&&t.geometry.dispose(),Array.isArray(t.material)?t.material.forEach(e=>fn(e)):t.material&&fn(t.material)}}function _n(e,t){let n=e;if(t.includes("-")){const e=t.split("-");let i=e.shift();for(;n&&e.length;)i in n?(n=n[i],i=e.shift()):i=vn(i,e.shift());return{target:n,key:vn(i,...e)}}return{target:n,key:t}}function vn(...e){return e.map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")}function yn(e,t,n){const i=e;return i.__tres={type:"unknown",root:n,memoizedProps:{},objects:[],parent:null,previousAttach:null,...t},i.__tres.attach||(sn(i)?i.__tres.attach="material":rn(i)?i.__tres.attach="geometry":an(i)&&(i.__tres.attach="fog")),i}function bn(e){const t=e?.__tres?.root;t?.renderer&&t.renderer.canBeInvalidated.value&&t.renderer.invalidate()}function wn(e){if(hn(e)){const t=e;return t.object.__tres=t.__tres,t.object}return e}function Tn(e,t){const n=e.__tres?.parent||t.scene.value;e.__tres&&(e.__tres.parent=null),n&&n.__tres&&"objects"in n.__tres&&((e,t)=>{let n=0;for(let i=0;i<e.length;i++)t(e[i],i)&&(e[n]=e[i],n++);e.length=n})(n.__tres.objects,t=>t!==e),e.__tres?.attach?function(e,t,n){if(Xt(n)){const{target:i,key:r}=_n(e,n),s=t.__tres.previousAttach;void 0===s?delete i[r]:i[r]=s,"__tresDetach"in i&&i.__tresDetach()}else t.__tres?.previousAttach?.(e,t);delete t.__tres?.previousAttach}(n,e,e.__tres.attach):(e.parent?.remove?.(wn(e)),e.parent=null)}function xn(e,t){e.traverse?.(e=>{un(e)&&t.camera.deregisterCamera(e)}),un(e)&&t.camera.deregisterCamera(e),bn(e)}function En(){const e=new Map,t=new Set;let n=0,i=!1;const r=n=>{e.delete(n),t.delete(n)};return{on:(t,s=0)=>{e.set(t,{priority:s,addI:n++});const o=()=>r(t);return S(o),i=!0,{off:o}},off:r,trigger:(...n)=>(i&&((()=>{const n=Array.from(e.entries()).sort((e,t)=>{const n=e[1].priority-t[1].priority;return 0===n?e[1].addI-t[1].addI:n});t.clear(),n.forEach(e=>t.add(e[0]))})(),i=!1),Promise.all(Array.from(t).map(e=>e(...n)))),dispose:()=>{e.clear(),t.clear()},get count(){return e.size}}}const Pn=Ne({}),An=e=>Object.assign(Pn.value,e);function Mn({scene:e,canvas:t,options:n,contextParts:{sizes:i,camera:r}}){const s=Gt(n.renderer)?n.renderer({sizes:i,scene:e,camera:r,canvas:t}):new ot({...n,canvas:be(t)}),o=Ne("manual"===ke(n.renderMode)?0:1),a=je(()=>"on-demand"===ke(n.renderMode)&&0===o.value),l=()=>e.value.traverse(e=>{e instanceof at&&e.material instanceof lt&&(e.material.needsUpdate=!0)}),c=(e=1)=>{a.value&&(o.value=Math.min(60,o.value+e))},u=()=>{if("manual"!==ke(n.renderMode))throw new Error("advance can only be called in manual render mode.");o.value=1},h=je(()=>"always"===ke(n.renderMode)),d=C();let p=!1;(e=>Kt(e)&&"isRenderer"in e&&!!e.isRenderer)(s)&&(s.init(),d.trigger(s));const m=C(),f=()=>{o.value=h.value?1:Math.max(0,o.value-1),m.trigger(s)};let g=t=>{r.activeCamera.value&&(s.render(e.value,r.activeCamera.value),t())};const _=(e=>{const t=new st,n={before:C(),after:C()},{pause:i,resume:r,isActive:s}=Ee(()=>{const i=()=>({delta:t.getDelta(),elapsed:t.elapsedTime});n.before.trigger(i()),e(),n.after.trigger(i())},{immediate:!1});return{start:()=>{t.start(),r()},stop:()=>{t.stop(),i()},isActive:s,onBeforeLoop:n.before.on,onLoop:n.after.on}})(()=>{o.value&&g(f)});d.on(_.start),Le([i.width,i.height],()=>{s.setSize(i.width.value,i.height.value),!p&&s.domElement.width&&s.domElement.height&&(d.trigger(s),p=!0),"on-demand"===ke(n.renderMode)&&c()},{immediate:!0});const{pixelRatio:v}=function(e={}){const{window:t=ye}=e,n=K(1),i=Se(()=>`(resolution: ${n.value}dppx)`,e);let r=I;return t&&(r=G(i,()=>n.value=t.devicePixelRatio)),{pixelRatio:ce(n),stop:r}}();ze(()=>{((e,t,n)=>{if(!Gt(e.setPixelRatio))return;let i=0;if(n&&Array.isArray(n)&&n.length>=2){const[e,r]=n;i=rt.clamp(t,e,r)}else i=Wt(n)?n:t;i!==e.getPixelRatio?.()&&e.setPixelRatio(i)})(s,v.value,ke(n.dpr))}),"on-demand"===ke(n.renderMode)&&c(),"manual"===ke(n.renderMode)&&H(100,{callback:u});const y=je(()=>{const e=ke(n.clearColor),t=ke(n.clearAlpha),i="string"==typeof e&&9===e.length&&e.startsWith("#");return i&&void 0!==t&&function(...e){"string"==typeof e[0]?e[0]=pn+e[0]:e.unshift(pn),console.warn(...e)}(`clearColor with alpha (e.g. ${e}) and clearAlpha cannot both be set, using clearColor as source of truth`),i?{alpha:Number.parseInt(e.slice(7,9),16)/255,color:e.slice(0,7)}:{alpha:t,color:e}});return ze(()=>{const e=y.value;void 0===e.color||void 0===e.alpha||s.setClearColor(e.color,e.alpha)}),ze(()=>{const e=n.toneMapping;e&&(s.toneMapping=e)}),ze(()=>{const e=n.toneMappingExposure;e&&(s.toneMappingExposure=e)}),ze(()=>{const e=n.outputColorSpace;e&&(s.outputColorSpace=e)}),ze(()=>{const e=n.shadows;void 0!==e&&(s.shadowMap.enabled=e,l())}),ze(()=>{const e=n.shadowMapType;void 0!==e&&(s.shadowMap.type=e,l())}),Ie(()=>{s.dispose(),"forceContextLoss"in s&&s.forceContextLoss()}),{loop:_,instance:s,advance:u,onReady:d.on,onRender:m.on,invalidate:c,canBeInvalidated:a,mode:ke(n.renderMode),replaceRenderFunction:e=>{g=e}}}function Sn(e,t,n=10){const i=ke(e)?function(e={}){const{window:t=ye,initialWidth:n=Number.POSITIVE_INFINITY,initialHeight:i=Number.POSITIVE_INFINITY,listenOrientation:r=!0,includeScrollbar:s=!0,type:o="inner"}=e,a=K(n),l=K(i),c=()=>{if(t)if("outer"===o)a.value=t.outerWidth,l.value=t.outerHeight;else if("visual"===o&&t.visualViewport){const{width:e,height:n,scale:i}=t.visualViewport;a.value=Math.round(e*i),l.value=Math.round(n*i)}else s?(a.value=t.innerWidth,l.value=t.innerHeight):(a.value=t.document.documentElement.clientWidth,l.value=t.document.documentElement.clientHeight)};c(),z(c);const u={passive:!0};if(we("resize",c,u),t&&"visual"===o&&t.visualViewport&&we(t.visualViewport,"resize",c,u),r){const e=Se("(orientation: portrait)");oe(e,()=>c())}return{width:a,height:l}}():Ce(je(()=>ke(t).parentElement)),r=Be(j(i.width,n)),s=Be(j(i.height,n)),o=je(()=>r.value/s.value);return{height:s,width:r,aspectRatio:o}}let Cn=class{nativeEvent;NONE=0;CAPTURING_PHASE=1;AT_TARGET=2;BUBBLING_PHASE=3;relatedTarget=null;get altKey(){return this.getFromNative("altKey",!1)}get button(){return this.getFromNative("button",0)}get buttons(){return this.getFromNative("buttons",0)}get clientX(){return this.getFromNative("clientX",0)}get clientY(){return this.getFromNative("clientY",0)}get ctrlKey(){return this.getFromNative("ctrlKey",!1)}get layerX(){return this.getFromNative("layerX",0)}get layerY(){return this.getFromNative("layerY",0)}get metaKey(){return this.getFromNative("metaKey",!1)}get movementX(){return this.getFromNative("movementX",0)}get movementY(){return this.getFromNative("movementY",0)}get offsetX(){return this.getFromNative("offsetX",0)}get offsetY(){return this.getFromNative("offsetY",0)}get pageX(){return this.getFromNative("pageX",0)}get pageY(){return this.getFromNative("pageY",0)}get screenX(){return this.getFromNative("screenX",0)}get screenY(){return this.getFromNative("screenY",0)}get shiftKey(){return this.getFromNative("shiftKey",!1)}get x(){return this.getFromNative("x",0)}get y(){return this.getFromNative("y",0)}get detail(){return this.getFromNative("detail",0)}get view(){return this.getFromNative("view",null)}get which(){return this.getFromNative("which",0)}get cancelBubble(){return this.getFromNative("cancelBubble",!1)}get composed(){return this.getFromNative("composed",!1)}get eventPhase(){return this.getFromNative("eventPhase",0)}get isTrusted(){return this.getFromNative("isTrusted",!1)}get returnValue(){return this.getFromNative("returnValue",!1)}get timeStamp(){return this.getFromNative("timeStamp",0)}get cancelable(){return this.getFromNative("cancelable",!1)}get defaultPrevented(){return this.getFromNative("defaultPrevented",!1)}constructor(e){this.nativeEvent=e}getFromNative(e,t){return e in this.nativeEvent?this.nativeEvent[e]:t}};const Rn=new ct;class On extends Cn{type;bubbles;internalPointer;intersection;camera;currentObject;object;propagationState;get pointerId(){return this.internalPointer.id}get pointerType(){return this.internalPointer.type}get pointerState(){return this.internalPointer.state}get distance(){return this.intersection.distance}get distanceToRay(){return this.intersection.distanceToRay}get point(){return this.intersection.point}get index(){return this.intersection.index}get face(){return this.intersection.face}get faceIndex(){return this.intersection.faceIndex}get uv(){return this.intersection.uv}get uv1(){return this.intersection.uv1}get normal(){return this.intersection.normal}get instanceId(){return this.intersection.instanceId}get pointOnLine(){return this.intersection.pointOnLine}get batchId(){return this.intersection.batchId}get pointerPosition(){return this.intersection.pointerPosition}get pointerQuaternion(){return this.intersection.pointerQuaternion}get pointOnFace(){return this.intersection.pointOnFace}get localPoint(){return this.intersection.localPoint}get details(){return this.intersection.details}get target(){return this.object}get currentTarget(){return this.currentObject}get eventObject(){return this.currentObject}get srcElement(){return this.currentObject}_pointer;get pointer(){return null==this._pointer&&(Rn.copy(this.intersection.point).project(this.camera),this._pointer=new ut(Rn.x,Rn.y)),this._pointer}_ray;get ray(){if(null!=this._ray)return this._ray;switch(this.intersection.details.type){case"screen-ray":case"ray":case"sphere":return this._ray=new ht(this.intersection.pointerPosition,new ct(0,0,-1).applyQuaternion(this.intersection.pointerQuaternion));case"lines":return this._ray=new ht(this.intersection.details.line.start,this.intersection.details.line.end.clone().sub(this.intersection.details.line.start).normalize())}}_intersections=[];get intersections(){return null==this._intersections&&(this._intersections=[{...this.intersection,eventObject:this.currentObject}]),this._intersections}_unprojectedPoint;get unprojectedPoint(){if(null==this._unprojectedPoint){const e=this.pointer;this._unprojectedPoint=new ct(e.x,e.y,0).unproject(this.camera)}return this._unprojectedPoint}get stopped(){return this.propagationState.stoppedImmediate||this.propagationState.stopped}get stoppedImmediate(){return this.propagationState.stoppedImmediate}get delta(){throw new Error("not supported")}constructor(e,t,n,i,r,s,o=r.object,a=o,l={stopped:!t,stoppedImmediate:!1}){super(n),this.type=e,this.bubbles=t,this.internalPointer=i,this.intersection=r,this.camera=s,this.currentObject=o,this.object=a,this.propagationState=l}stopPropagation(){this.propagationState.stopped=!0}stopImmediatePropagation(){this.propagationState.stoppedImmediate=!0}retarget(e){return new On(this.type,this.bubbles,this.nativeEvent,this.internalPointer,this.intersection,this.camera,e,this.target,this.propagationState)}}let kn=class e extends On{get deltaX(){return this.nativeEvent.deltaX}get deltaY(){return this.nativeEvent.deltaY}get deltaZ(){return this.nativeEvent.deltaZ}constructor(e,t,n,i,r,s){super("wheel",!0,e,t,n,i,r,s)}retarget(t){return new e(this.nativeEvent,this.internalPointer,this.intersection,this.camera,t,this.target)}};function Ln(e){In(e,e.currentObject)}function In(e,t){if(null==t)return;const n=function(e,t){if(null!=e._listeners&&t in e._listeners)return e._listeners[t];let n;if(e.isVoidObject&&"click"===t&&null!=e.parent?.__r3f&&(n=e.parent.__r3f.root.getState().onPointerMissed),null!=e.__r3f&&(n=e.__r3f.handlers[Dn[t]]),null!=n)return[n]}(t,e.type);if(null!=n&&n.length>0){const i=e.retarget(t),r=n.length;for(let e=0;e<r&&!i.stoppedImmediate;e++)n[e](i)}e.stopped||In(e,t.parent)}const Dn={click:"onClick",contextmenu:"onContextMenu",dblclick:"onDoubleClick",pointercancel:"onPointerCancel",pointerdown:"onPointerDown",pointerenter:"onPointerEnter",pointerleave:"onPointerLeave",pointermove:"onPointerMove",pointerout:"onPointerOut",pointerover:"onPointerOver",pointerup:"onPointerUp",wheel:"onWheel"},Fn=Object.keys(Dn);const Un=new dt(1e10),Nn=new Map;function jn(e){let t=Nn.get(e);return null==t&&(t=new at(Un),t.isVoidObject=!0,t.parent=e,t.pointerEventsOrder=-1/0,Nn.set(e,t)),t}function zn(e,t){return t?!e:e}function Bn(e,t,n,i=!1,r,s,o){const a=i||function(e,t){if(t.ancestorsHaveListeners||"pointer"===e&&t.ancestorsHavePointerListeners||"wheel"===e&&t.ancestorsHaveWheelListeners||null!=t.__r3f&&t.__r3f?.eventCount>0&&("wheel"===e&&null!=t.__r3f.handlers.onWheel||"pointer"===e&&Object.keys(t.__r3f.handlers).some(e=>"onWheel"!=e)))return!0;if(null==t._listeners)return!1;if("wheel"===e){const e=t._listeners.wheel;return null!=e&&e.length>0}const n=Object.entries(t._listeners),i=n.length;for(let r=0;r<i;r++){const e=n[r];if("wheel"!==e[0]&&Fn.includes(e[0])&&null!=e[1]&&e[1].length>0)return!0}return!1}(e,t),l=t.pointerEvents??r,c=l??t.defaultPointerEvents??"listener",u=t.pointerEventsType??s??"all",h=t.pointerEventsOrder??o??0,d=function(e,t,n){if("none"===t||"listener"===t&&!e)return!1;if("all"===n)return!0;if("function"==typeof n)return({id:e,type:t,state:i})=>n(e,t,i);let i,r;return"deny"in n?(r=!0,i=n.deny):(r=!1,i=n.allow),Array.isArray(i)?e=>zn(i.includes(e.type),r):e=>zn(i===e.type,r)}(a,c,u),p=n.length;if(1===p)(!0===d||"function"==typeof d&&d(n[0]))&&Vn(n[0],t,c,u,h);else if(!0===d)for(let g=0;g<p;g++)Vn(n[g],t,c,u,h);else if("function"==typeof d)for(let g=0;g<p;g++){const e=n[g];d(e)&&Vn(e,t,c,u,h)}if(0===t.children.length||!1===t.intersectChildren)return;const m=t.interactableDescendants??t.children,f=m.length;for(let g=0;g<f;g++)Bn(e,m[g],n,a,l,u,h)}function Vn({intersector:e,options:t},n,i,r,s){!1!==t.filter?.(n,i,r,s)&&e.executeIntersection(n,s)}function Hn(e,t=0,n,i=0){return t!=i?i-t:e.distance-n.distance}const Gn=1e7;const Wn=Symbol("buttonsDownTime"),Kn=Symbol("buttonsClickTime");function Xn(e){return globalThis.pointerEventspointerMap?.get(e)}globalThis.pointerEventspointerMap??=new Map,pt.prototype.setPointerCapture=function(e){Xn(e)?.setCapture(this)},pt.prototype.releasePointerCapture=function(e){const t=Xn(e);null==t||!t.hasCaptured(this)||t.setCapture(void 0)},pt.prototype.hasPointerCapture=function(e){return Xn(e)?.hasCaptured(this)??!1};let qn=class{id;type;state;intersector;getCamera;onMoveCommited;parentSetPointerCapture;parentReleasePointerCapture;options;prevIntersection;intersection;prevEnabled=!0;enabled=!0;wheelIntersection;pointerEntered=[];pointerEnteredHelper=[];pointerCapture;buttonsDownTime=new Map;buttonsDown=new Set;wasMoved=!1;onFirstMove=[];constructor(e,t,n,i,r,s,o,a,l={}){this.id=e,this.type=t,this.state=n,this.intersector=i,this.getCamera=r,this.onMoveCommited=s,this.parentSetPointerCapture=o,this.parentReleasePointerCapture=a,this.options=l,globalThis.pointerEventspointerMap?.set(e,this)}getPointerCapture(){return this.pointerCapture}hasCaptured(e){return this.pointerCapture?.object===e}setCapture(e){this.pointerCapture?.object!==e&&(null!=this.pointerCapture&&(this.parentReleasePointerCapture?.(),this.pointerCapture=void 0),null!=e&&null!=this.intersection&&(this.pointerCapture={object:e,intersection:this.intersection},this.parentSetPointerCapture?.()))}getButtonsDown(){return this.buttonsDown}getIntersection(){return this.intersection}getEnabled(){return this.enabled}setEnabled(e,t,n=!0){this.enabled!==e&&(!e&&null!=this.pointerCapture&&(this.parentReleasePointerCapture?.(),this.pointerCapture=void 0),this.enabled=e,n&&this.commit(t,!1))}computeIntersection(e,t,n){return null!=this.pointerCapture?this.intersector.intersectPointerCapture(this.pointerCapture,n):(this.intersector.startIntersection(n),Bn(e,t,[this]),this.intersector.finalizeIntersection(t))}setIntersection(e){this.intersection=e}commit(e,t){const n=this.getCamera(),i=this.prevEnabled?this.prevIntersection:void 0,r=this.enabled?this.intersection:void 0;null!=i&&i.object!=r?.object&&Ln(new On("pointerout",!0,e,this,i,n));const s=this.pointerEntered;this.pointerEntered=[],this.pointerEnteredHelper.length=0,Yn(r?.object,this.pointerEntered,s,this.pointerEnteredHelper);const o=s.length;for(let a=0;a<o;a++){const t=s[a];Ln(new On("pointerleave",!1,e,this,i,n,t))}null!=r&&i?.object!=r.object&&Ln(new On("pointerover",!0,e,this,r,n));for(let a=this.pointerEnteredHelper.length-1;a>=0;a--){const t=this.pointerEnteredHelper[a];Ln(new On("pointerenter",!1,e,this,r,n,t))}if(t&&null!=r&&Ln(new On("pointermove",!0,e,this,r,n)),this.prevIntersection=this.intersection,this.prevEnabled=this.enabled,!this.wasMoved&&this.intersector.isReady()){this.wasMoved=!0;const e=this.onFirstMove.length;for(let t=0;t<e;t++)this.onFirstMove[t](n);this.onFirstMove.length=0}this.onMoveCommited?.(this)}move(e,t){this.intersection=this.computeIntersection("pointer",e,t),this.commit(t,!0)}emitMove(e){null!=this.intersection&&Ln(new On("pointermove",!0,e,this,this.intersection,this.getCamera()))}down(e){if(this.buttonsDown.add(e.button),!this.enabled)return;if(!this.wasMoved)return void this.onFirstMove.push(this.down.bind(this,e));if(null==this.intersection)return;Ln(new On("pointerdown",!0,e,this,this.intersection,this.getCamera()));const{object:t}=this.intersection;t[Wn]??=new Map,t[Wn].set(e.button,e.timeStamp),this.buttonsDownTime.set(e.button,e.timeStamp)}up(e){if(this.buttonsDown.delete(e.button),!this.enabled)return;if(!this.wasMoved)return void this.onFirstMove.push(this.up.bind(this,e));if(null==this.intersection)return;const{clickThesholdMs:t,contextMenuButton:n=2,dblClickThresholdMs:i=500,clickThresholdMs:r=t??300}=this.options;this.pointerCapture=void 0;const s=function(e,t,n,i,r){if(null==t)return!1;const s=t.get(n);return!(null==s||i-s>r||s!=e.get(n))}(this.buttonsDownTime,this.intersection.object[Wn],e.button,e.timeStamp,r),o=this.getCamera();if(s&&e.button===n&&Ln(new On("contextmenu",!0,e,this,this.intersection,o)),Ln(new On("pointerup",!0,e,this,this.intersection,o)),!s||e.button===n)return;Ln(new On("click",!0,e,this,this.intersection,o));const{object:a}=this.intersection,l=a[Kn]??=new Map,c=l.get(e.button);null==c||e.timeStamp-c>i?l.set(e.button,e.timeStamp):(Ln(new On("dblclick",!0,e,this,this.intersection,o)),l.delete(e.button))}cancel(e){if(this.enabled){if(!this.wasMoved)return void this.onFirstMove.push(this.cancel.bind(this,e));null!=this.intersection&&Ln(new On("pointercancel",!0,e,this,this.intersection,this.getCamera()))}}wheel(e,t,n=!1){if(!this.enabled)return;if(!this.wasMoved&&n)return void this.onFirstMove.push(this.wheel.bind(this,e,t,n));n||(this.wheelIntersection=this.computeIntersection("wheel",e,t));const i=n?this.intersection:this.wheelIntersection;null!=i&&Ln(new kn(t,this,i,this.getCamera()))}emitWheel(e,t=!1){if(!this.enabled)return;if(!this.wasMoved&&t)return void this.onFirstMove.push(this.emitWheel.bind(this,e,t));const n=t?this.intersection:this.wheelIntersection;null!=n&&Ln(new kn(e,this,n,this.getCamera()))}exit(e){this.wasMoved&&(null!=this.pointerCapture&&(this.parentReleasePointerCapture?.(),this.pointerCapture=void 0),this.intersection=void 0,this.commit(e,!1)),this.onFirstMove.length=0,this.wasMoved=!1}};function Yn(e,t,n,i){if(null==e)return;const r=n.indexOf(e);-1!=r?n.splice(r,1):i.push(e),t.push(e),Yn(e.parent,t,n,i)}const $n=new gt,Zn=new gt,Qn=new ut,Jn=new ut,ei=new ut,ti=new ct,ni=new mt,ii=new ct;function ri(e,t,n){ii.copy(t).applyMatrix4(ni.copy(n.matrixWorld).invert());const i=n.geometry.attributes.uv;if(null==i||!(i instanceof ft))return!1;let r;return function(e,t){const n=e.geometry.drawRange;if(null!=e.geometry.index){const i=e.geometry.index,r=Math.max(0,n.start),s=Math.min(i.count,n.start+n.count);for(let e=r;e<s;e+=3)t(i.getX(e),i.getX(e+1),i.getX(e+2));return}const i=e.geometry.attributes.position;if(null==i)return;const r=Math.max(0,n.start),s=Math.min(i.count,n.start+n.count);for(let o=r;o<s;o+=3)t(o,o+1,o+2)}(n,(e,t,s)=>{n.getVertexPosition(e,$n.a),n.getVertexPosition(t,$n.b),n.getVertexPosition(s,$n.c);const o=$n.closestPointToPoint(ii,ti).distanceTo(ii);null!=r&&o>=r||(r=o,Zn.copy($n),Qn.fromBufferAttribute(i,e),Jn.fromBufferAttribute(i,t),ei.fromBufferAttribute(i,s))}),null!=r&&(Zn.closestPointToPoint(ii,ti),Zn.getInterpolation(ti,Qn,Jn,ei,e),!0)}new mt,new _t,new ct,new vt,new ht,new ut,new ct(0,0,0),new ct(0,0,1);const si=new mt,oi=new ct;new ct(0,0,-1),new vt;const ai=new ut,li=new ct;let ci=class{prepareTransformation;options;raycaster=new yt;cameraQuaternion=new bt;fromPosition=new ct;fromQuaternion=new bt;coords=new ut;viewPlane=new vt;intersects=[];pointerEventsOrders=[];constructor(e,t){this.prepareTransformation=e,this.options=t}isReady(){return!0}intersectPointerCapture({intersection:e,object:t},n){const i=e.details;if("screen-ray"!=i.type)throw new Error(`unable to process a pointer capture of type "${e.details.type}" with a camera ray intersector`);if(!this.startIntersection(n))return e;this.viewPlane.constant-=i.distanceViewPlane;const r=this.raycaster.ray.intersectPlane(this.viewPlane,new ct);if(null==r)return e;e.object.updateWorldMatrix(!0,!1),function(e,t,n){const i=t.normal??t.face?.normal;null!=i&&(e.setFromNormalAndCoplanarPoint(i,t.localPoint),e.applyMatrix4(n))}(this.viewPlane,e,e.object.matrixWorld);let s=e.uv;return e.object instanceof at&&ri(ai,r,e.object)&&(s=ai.clone()),{...e,details:{...i,direction:this.raycaster.ray.direction.clone(),screenPoint:this.coords.clone()},uv:s,object:t,point:r,pointOnFace:r,pointerPosition:this.raycaster.ray.origin.clone(),pointerQuaternion:this.cameraQuaternion.clone()}}startIntersection(e){const t=this.prepareTransformation(e,this.coords);return null!=t&&(t.updateWorldMatrix(!0,!1),t.matrixWorld.decompose(this.fromPosition,this.fromQuaternion,oi),this.raycaster.setFromCamera(this.coords,t),this.viewPlane.setFromNormalAndCoplanarPoint(t.getWorldDirection(li),this.raycaster.ray.origin),!0)}executeIntersection(e,t){const n=this.intersects.length;e.raycast(this.raycaster,this.intersects),function(e,t,n){for(;n>0;)e.push(t),--n}(this.pointerEventsOrders,t,this.intersects.length-n)}finalizeIntersection(e){const t=this.fromPosition.clone(),n=this.cameraQuaternion.clone(),i=this.raycaster.ray.direction.clone(),r=function(e,t,{customSort:n=Hn}={}){let i,r,s;const o=e.length;for(let a=0;a<o;a++){const o=e[a],l=t?.[a];(null==i||n(o,l,i,r)<0)&&(s=a,i=o,r=l)}return s}(this.intersects,this.pointerEventsOrders,this.options),s=null==r?void 0:this.intersects[r];return this.intersects.length=0,this.pointerEventsOrders.length=0,null==s?function(e,t,n,i,r,s=0){const o=t.direction.clone().multiplyScalar(Gn),a=Gn;return{distance:a+s,object:jn(e),point:o,normal:t.origin.clone().sub(o).normalize(),details:n(o,a),pointerPosition:i,pointerQuaternion:r,pointOnFace:o,localPoint:o}}(e,this.raycaster.ray,(e,t)=>({type:"screen-ray",distanceViewPlane:t,screenPoint:this.coords.clone(),direction:i}),t,n):(s.object.updateWorldMatrix(!0,!1),si.copy(s.object.matrixWorld).invert(),Object.assign(s,{details:{type:"screen-ray",distanceViewPlane:this.viewPlane.distanceToPoint(s.point),screenPoint:this.coords.clone(),direction:i},pointOnFace:s.point,pointerPosition:t,pointerQuaternion:n,localPoint:s.point.clone().applyMatrix4(si)}))}};new ct,new ut,new mt,new ct,new bt,new vt,new wt,new ct,new ct,new ct,new ct(1e-4,1e-4,1e-4),new mt;let ui=23412;function hi(e,t,n){if(!(t instanceof globalThis.MouseEvent))return n.set(0,0);const{width:i,height:r,top:s,left:o}=e.getBoundingClientRect(),a=t.clientX-o,l=t.clientY-s;return n.set(a/i*2-1,-l/r*2+1)}function di(e,t,n,i){return function(e,t,n,i,r,s,o={}){const a=o?.forwardPointerCapture??!0,l=new Map,c=o.pointerTypePrefix??"forward-",u=(e,u)=>{let h=l.get(e.pointerId);return null!=h||(h=new qn(ui++,`${c}${e.pointerType}`,e.pointerState,new ci((e,n)=>(i(e,n),t()),o),t,void 0,a?r.bind(null,e.pointerId):void 0,a?s.bind(null,e.pointerId):void 0,o),"move"!=u&&"wheel"!=u&&(h.setIntersection(h.computeIntersection("pointer",n,e)),h.commit(e,!1)),l.set(e.pointerId,h)),h},h=new Map,d=new Map,p=[],m=[],f=(e,t,i)=>{switch(e){case"move":return void i.move(n,t);case"wheel":return void i.wheel(n,t);case"cancel":return void i.cancel(t);case"down":if(!pi(t))return;return void i.down(t);case"up":if(!pi(t))return;return void i.up(t);case"exit":return d.delete(i),h.delete(i),void i.exit(t)}},g=(e,t)=>{const n=u(t,e);"move"===e&&d.set(n,t),"wheel"===e&&h.set(n,t),o.batchEvents??1?m.push({type:e,event:t}):f(e,t,n)},_=g.bind(null,"move"),v=g.bind(null,"cancel"),y=g.bind(null,"down"),b=g.bind(null,"up"),w=g.bind(null,"wheel"),T=g.bind(null,"exit");return e.addEventListener("pointermove",_),e.addEventListener("pointercancel",v),e.addEventListener("pointerdown",y),e.addEventListener("pointerup",b),e.addEventListener("wheel",w),e.addEventListener("pointerleave",T),{destroy(){e.removeEventListener("pointermove",_),e.removeEventListener("pointercancel",v),e.removeEventListener("pointerdown",y),e.removeEventListener("pointerup",b),e.removeEventListener("wheel",w),e.removeEventListener("pointerleave",T),d.clear(),h.clear()},update(){const e=m.length;for(let t=0;t<e;t++){const{type:e,event:n}=m[t],i=u(n,e);"move"!==e||(p.push(i),d.get(i)==n)?"wheel"!==e||h.get(i)==n?f(e,n,i):i.emitWheel(n):i.emitMove(n)}if(m.length=0,o.intersectEveryFrame)for(const[t,i]of d.entries())p.includes(t)||t.move(n,i);p.length=0}}}(e,"function"==typeof t?t:()=>t,n,hi.bind(null,e),e.setPointerCapture.bind(e),t=>{e.hasPointerCapture(t)&&e.releasePointerCapture(t)},{pointerTypePrefix:"screen-",...i})}function pi(e){return null!=e.button}const[mi,fi]=function(e,t){const n=(null==t?void 0:t.injectionKey)||Symbol(e.name||"InjectionState"),i=null==t?void 0:t.defaultValue;return[(...t)=>{const i=e(...t);return function(e,t){var n;const i=null==(n=c())?void 0:n.proxy;if(null==i)throw new Error("provideLocal must be called in setup");R.has(i)||R.set(i,Object.create(null)),R.get(i)[e]=t,d(e,t)}(n,i),i},()=>O(n,i)]}(({scene:e,canvas:t,windowSize:n,rendererOptions:i})=>{const r=Ve(e),s=Sn(n,t),o=(({sizes:e})=>{const t=Ne([]),n=je(()=>t.value[0]),i=e=>{const n=Qt(e)?e:t.value.find(t=>t.uuid===e);if(!n)return;const i=t.value.filter(({uuid:e})=>e!==n.uuid);t.value=[n,...i]};return ze(()=>{e.aspectRatio.value&&t.value.forEach(t=>{en(t)&&(t.aspect=e.aspectRatio.value,t.updateProjectionMatrix())})}),{activeCamera:n,cameras:t,registerCamera:(e,n=!1)=>{t.value.some(({uuid:t})=>t===e.uuid)||(t.value.push(e),n&&i(e.uuid))},deregisterCamera:e=>{t.value=t.value.filter(({uuid:t})=>t!==e.uuid)},setActiveCamera:i}})({sizes:s}),a=Mn({scene:r,canvas:t,options:i,contextParts:{sizes:s,camera:o}}),l=function({canvas:e,contextParts:{scene:t,camera:n,renderer:i}}){const{update:r,destroy:s}=di(ke(e),()=>ke(n.activeCamera),t.value),{off:o}=i.loop.onLoop(r);Ie(s),Ie(o);const a=jn(t.value),l=C();return a.addEventListener("click",l.trigger),{onPointerMissed:l.on}}({canvas:t,contextParts:{scene:r,camera:o,renderer:a}}),c={sizes:s,scene:r,camera:o,renderer:a,controls:Ne(null),extend:An,events:l};return c.scene.value.__tres={root:c},c},{injectionKey:"useTres"}),gi=()=>{const e=fi();if(!e)throw new Error("useTresContext must be used together with useTresContextProvider.\n You probably tried to use it above or on the same level as a TresCanvas component.\n It should be used in child components of a TresCanvas instance.");return e};function _i(){const{scene:e,renderer:t,camera:n,sizes:i,controls:r,extend:s,events:o}=gi();return{scene:e,renderer:t.instance,camera:n.activeCamera,sizes:i,controls:r,extend:s,events:o,invalidate:t.invalidate,advance:t.advance}}const vi=()=>{const e=_i(),{renderer:t}=gi(),n=En(),i=En();t.loop.onBeforeLoop(t=>{n.trigger({...e,...t})}),t.loop.onLoop(t=>{i.trigger({...e,...t})});const r=t.replaceRenderFunction;return{stop:t.loop.stop,start:t.loop.start,isActive:t.loop.isActive,onBeforeRender:n.on,onRender:i.on,render:r}};const yi=["onClick","onContextmenu","onPointermove","onPointerenter","onPointerleave","onPointerover","onPointerout","onDblclick","onPointerdown","onPointerup","onPointercancel","onLostpointercapture","onWheel"],bi={onClick:"click",onContextmenu:"contextmenu",onPointermove:"pointermove",onPointerenter:"pointerenter",onPointerleave:"pointerleave",onPointerover:"pointerover",onPointerout:"pointerout",onDblclick:"dblclick",onPointerdown:"pointerdown",onPointerup:"pointerup",onPointercancel:"pointercancel",onLostpointercapture:"lostpointercapture",onWheel:"wheel"},wi=e=>yi.includes(e),Ti=e=>{const t=e.scene.value;function n(n,i){if(!n)return;i=i||t;const r=n.__tres?n:yn(n,{},e),s=i.__tres?i:yn(i,{},e);n=wn(r),i=wn(s),un(n)&&e.camera?.registerCamera(n),r.__tres.attach?function(e,t,n){const i=/-\d+$/;if(Xt(n)){if(i.test(n)){const t=n.replace(i,""),{target:r,key:s}=_n(e,t);if(!Array.isArray(r[s])){const e=r[s],t=[];t.__tresDetach=()=>{t.every(e=>qt(e))&&(r[s]=e)},r[s]=t}}const{target:r,key:s}=_n(e,n);t.__tres.previousAttach=r[s],r[s]=wn(t)}else t.__tres.previousAttach=n(e,t)}(s,r,r.__tres.attach):$t(n)&&$t(s)&&(s.add(n),n.dispatchEvent({type:"added"})),r.__tres.parent=s,s.__tres.objects&&!s.__tres.objects.includes(r)&&s.__tres.objects.push(r)}function i(t,n){if(!t)return;n=qt(n)?"default":n;const r=t.__tres?.dispose;qt(r)||(n=null!==r&&r);const s=t.__tres?.primitive,o="default"===n?!s:!!n;if(t.__tres&&"objects"in t.__tres&&[...t.__tres.objects].forEach(e=>i(e,n)),o&&t.children&&[...t.children].forEach(e=>i(e,n)),Tn(t,e),xn(t,e),o&&!ln(t))if(Gt(n))n(t);else if(Gt(t.dispose))try{t.dispose()}catch{}"__tres"in t&&delete t.__tres}function r(t,r,s,o){if(!t)return;let a=t;const l=r;if(t.__tres&&(t.__tres.memoizedProps[r]=o),"attach"===r){const r=t.__tres?.parent||t.parent;return i(t),yn(t,{attach:o},e),void(r&&n(t,r))}if("dispose"===r)return t.__tres||(t=yn(t,{},e)),void(t.__tres.dispose=o);wi(r)&&Gt(o)&&t.addEventListener(bi[r],o);let c=Bt(l),u=a?.[c];if("args"===l){const e=t,n=s??[],i=o??[],r=t.__tres?.type||t.type;if(r&&n.length&&!Ht(n,i)){const t=new Pn.value[r](...o),n=Object.getOwnPropertyDescriptors(t);Object.entries(n).forEach(([n,i])=>{if((i.writable||i.set)&&n in e)try{e[n]=t[n]}catch(s){console.warn(`Could not set property ${n} on ${r}:`,s)}}),a=e}return}if("BufferGeometry"===a.type){if("args"===l)return;return void a.setAttribute(Bt(l),new ft(...o))}if(l.includes("-")&&void 0===u){const e=_n(a,l);if(u=e.target,a=e.target,c=e.key,u&&c)return u[c]=o,un(t)&&t.updateProjectionMatrix(),void bn(t)}let h=o;if(""===h&&(h=!0),Gt(u))return wi(r)||(Array.isArray(h)?t[c](...h):t[c](h)),void(c.startsWith("on")&&Gt(h)&&(a[c]=h));nn(u)&&nn(h)?u.mask=h.mask:tn(u)&&(e=>Xt(e)||Wt(e)||tn(e))(h)?u.set(h):(e=>cn(e)&&"copy"in e&&"function"==typeof e.copy)(u)&&(e=>!!e?.constructor)(h)&&u.constructor===h.constructor?u.copy(h):cn(u)&&Array.isArray(h)?"fromArray"in u&&"function"==typeof u.fromArray?u.fromArray(h):u.set(...h):cn(u)&&"number"==typeof h?"setScalar"in u&&"function"==typeof u.setScalar?u.setScalar(h):u.set(h):a[c]=h,un(t)&&t.updateProjectionMatrix(),bn(t)}function s(e){return e?.__tres?.parent||null}const o=()=>{};return{insert:n,remove:i,createElement:function(t,s,o,a){if(a||(a={}),a.args||(a.args=[]),zt(t))return null;let l,c=t.replace("Tres","");if("primitive"===t){(!Kt(a.object)||He(a.object))&&mn("Tres primitives need an 'object' prop, whose value is an object or shallowRef<object>"),c=a.object.type;const t={};l=function(e,t={},n={}){let i=e;const r=e=>{i=e};let s=new Proxy({},{});return s=new Proxy({},{has:(e,n)=>n in t||n in i,get:(e,n,r)=>n in t?t[n](i):i[n],set:(e,t,o)=>(n[t]?n[t](o,i,s,r):i[t]=o,!0)}),s}(a.object,{object:e=>e,isPrimitive:()=>!0,__tres:()=>t},{object:(t,s,o,a)=>{!function(e,t,n,i,r){const s=[...t.__tres.objects],o=wn(t);if(o===(e=wn(e)))return!0;const a=yn(e,t.__tres??{},r),l=t.parent??t.__tres.parent??null,c={...t.__tres.memoizedProps};delete c.object;for(const u of s)Tn(u,r),xn(u,r);o.__tres.objects=[],i.remove(t);for(const[u,h]of Object.entries(c))i.patchProp(a,u,a[u],h);n(e),i.insert(t,l);for(const u of s)i.insert(u,t)}(t,o,a,{patchProp:r,remove:i,insert:n},e)},__tres:e=>{Object.assign(t,e)}})}else{const e=Pn.value[c];e||mn(`${c} is not defined on the THREE namespace. Use extend to add it to the catalog.`),l=new e(...a.args)}return l?(un(l)&&(a?.position||l.position.set(3,3,3),a?.lookAt||l.lookAt(0,0,0)),l=yn(l,{...dn(l)?l.__tres:{},type:c,memoizedProps:a,primitive:"primitive"===t,attach:a.attach},e),l):null},patchProp:r,parentNode:s,createText:o,createComment:function(t){const n=yn(new pt,{type:"Comment"},e);return n.name=t,n},setText:o,setElementText:o,nextSibling:function(e){const t=s(e)?.__tres?.objects||[],n=t.indexOf(e);return n<0||n>=t.length-1?null:t[n+1]},querySelector:o,setScopeId:o,cloneNode:o,insertStaticContent:o}},xi=["asset-load"];let Ei=class{subscribers=new Set;messageQueue=[];maxQueueSize=100;send(e,t){const n={type:e,data:t,timestamp:Date.now()};this.subscribers.size>0?this.subscribers.forEach(e=>e(n)):xi.includes(e)&&this.queueMessage(n)}queueMessage(e){this.messageQueue.push(e),this.messageQueue.length>this.maxQueueSize&&this.messageQueue.shift()}flushQueue(){0===this.messageQueue.length||0===this.subscribers.size||(this.messageQueue.forEach(e=>{this.subscribers.forEach(t=>t(e))}),this.messageQueue=[])}subscribe(e){return this.subscribers.add(e),this.flushQueue(),()=>{this.subscribers.delete(e)}}get hasSubscribers(){return this.subscribers.size>0}get queueSize(){return this.messageQueue.length}clearQueue(){this.messageQueue=[]}};var Pi,Ai,Mi=Object.create,Si=Object.defineProperty,Ci=Object.getOwnPropertyDescriptor,Ri=Object.getOwnPropertyNames,Oi=Object.getPrototypeOf,ki=Object.prototype.hasOwnProperty,Li=(Pi={"../../node_modules/.pnpm/tsup@8.4.0_@microsoft+api-extractor@7.51.1_@types+node@22.13.14__jiti@2.4.2_postcss@8.5_96eb05a9d65343021e53791dd83f3773/node_modules/tsup/assets/esm_shims.js"(){}},function(){return Pi&&(Ai=(0,Pi[Ri(Pi)[0]])(Pi=0)),Ai}),Ii=((e,t)=>function(){return t||(0,e[Ri(e)[0]])((t={exports:{}}).exports,t),t.exports})({"../../node_modules/.pnpm/rfdc@1.4.1/node_modules/rfdc/index.js"(e,t){function n(e){return e instanceof Buffer?Buffer.from(e):new e.constructor(e.buffer.slice(),e.byteOffset,e.length)}Li(),t.exports=function(e){if((e=e||{}).circles)return function(e){const t=[],i=[],r=new Map;if(r.set(Date,e=>new Date(e)),r.set(Map,(e,t)=>new Map(o(Array.from(e),t))),r.set(Set,(e,t)=>new Set(o(Array.from(e),t))),e.constructorHandlers)for(const n of e.constructorHandlers)r.set(n[0],n[1]);let s=null;return e.proto?l:a;function o(e,o){const a=Object.keys(e),l=new Array(a.length);for(let c=0;c<a.length;c++){const u=a[c],h=e[u];if("object"!=typeof h||null===h)l[u]=h;else if(h.constructor!==Object&&(s=r.get(h.constructor)))l[u]=s(h,o);else if(ArrayBuffer.isView(h))l[u]=n(h);else{const e=t.indexOf(h);l[u]=-1!==e?i[e]:o(h)}}return l}function a(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return o(e,a);if(e.constructor!==Object&&(s=r.get(e.constructor)))return s(e,a);const l={};t.push(e),i.push(l);for(const o in e){if(!1===Object.hasOwnProperty.call(e,o))continue;const c=e[o];if("object"!=typeof c||null===c)l[o]=c;else if(c.constructor!==Object&&(s=r.get(c.constructor)))l[o]=s(c,a);else if(ArrayBuffer.isView(c))l[o]=n(c);else{const e=t.indexOf(c);l[o]=-1!==e?i[e]:a(c)}}return t.pop(),i.pop(),l}function l(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return o(e,l);if(e.constructor!==Object&&(s=r.get(e.constructor)))return s(e,l);const a={};t.push(e),i.push(a);for(const o in e){const c=e[o];if("object"!=typeof c||null===c)a[o]=c;else if(c.constructor!==Object&&(s=r.get(c.constructor)))a[o]=s(c,l);else if(ArrayBuffer.isView(c))a[o]=n(c);else{const e=t.indexOf(c);a[o]=-1!==e?i[e]:l(c)}}return t.pop(),i.pop(),a}}(e);const t=new Map;if(t.set(Date,e=>new Date(e)),t.set(Map,(e,t)=>new Map(r(Array.from(e),t))),t.set(Set,(e,t)=>new Set(r(Array.from(e),t))),e.constructorHandlers)for(const n of e.constructorHandlers)t.set(n[0],n[1]);let i=null;return e.proto?function e(s){if("object"!=typeof s||null===s)return s;if(Array.isArray(s))return r(s,e);if(s.constructor!==Object&&(i=t.get(s.constructor)))return i(s,e);const o={};for(const r in s){const a=s[r];"object"!=typeof a||null===a?o[r]=a:a.constructor!==Object&&(i=t.get(a.constructor))?o[r]=i(a,e):ArrayBuffer.isView(a)?o[r]=n(a):o[r]=e(a)}return o}:function e(s){if("object"!=typeof s||null===s)return s;if(Array.isArray(s))return r(s,e);if(s.constructor!==Object&&(i=t.get(s.constructor)))return i(s,e);const o={};for(const r in s){if(!1===Object.hasOwnProperty.call(s,r))continue;const a=s[r];"object"!=typeof a||null===a?o[r]=a:a.constructor!==Object&&(i=t.get(a.constructor))?o[r]=i(a,e):ArrayBuffer.isView(a)?o[r]=n(a):o[r]=e(a)}return o};function r(e,r){const s=Object.keys(e),o=new Array(s.length);for(let a=0;a<s.length;a++){const l=s[a],c=e[l];"object"!=typeof c||null===c?o[l]=c:c.constructor!==Object&&(i=t.get(c.constructor))?o[l]=i(c,r):ArrayBuffer.isView(c)?o[l]=n(c):o[l]=r(c)}return o}}}});Li(),Li(),Li();var Di,Fi=typeof navigator<"u",Ui=typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof global<"u"?global:{};typeof Ui.chrome<"u"&&Ui.chrome.devtools,Fi&&(Ui.self,Ui.top),typeof navigator<"u"&&(null==(Di=navigator.userAgent)||Di.toLowerCase().includes("electron")),Li();var Ni=((e,t,n)=>(n=null!=e?Mi(Oi(e)):{},((e,t,n,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of Ri(t))!ki.call(e,r)&&r!==n&&Si(e,r,{get:()=>t[r],enumerable:!(i=Ci(t,r))||i.enumerable});return e})(Si(n,"default",{value:e,enumerable:!0}),e)))(Ii()),ji=/(?:^|[-_/])(\w)/g;function zi(e,t){return t?t.toUpperCase():""}var Bi=(0,Ni.default)({circles:!0});const Vi={trailing:!0};function Hi(e,t=25,n={}){if(n={...Vi,...n},!Number.isFinite(t))throw new TypeError("Expected `wait` to be a finite number");let i,r,s,o,a=[];const l=(t,i)=>(s=async function(e,t,n){return await e.apply(t,n)}(e,t,i),s.finally(()=>{if(s=null,n.trailing&&o&&!r){const e=l(t,o);return o=null,e}}),s);return function(...e){return s?(n.trailing&&(o=e),s):new Promise(s=>{const o=!r&&n.leading;clearTimeout(r),r=setTimeout(()=>{r=null;const t=n.leading?i:l(this,e);for(const e of a)e(t);a=[]},t),o?(i=l(this,e),s(i)):a.push(s)})}}function Gi(e,t={},n){for(const i in e){const r=e[i],s=n?`${n}:${i}`:i;"object"==typeof r&&null!==r?Gi(r,t,s):"function"==typeof r&&(t[s]=r)}return t}const Wi={run:e=>e()},Ki=typeof console.createTask<"u"?console.createTask:()=>Wi;function Xi(e,t){const n=t.shift(),i=Ki(n);return e.reduce((e,n)=>e.then(()=>i.run(()=>n(...t))),Promise.resolve())}function qi(e,t){const n=t.shift(),i=Ki(n);return Promise.all(e.map(e=>i.run(()=>e(...t))))}function Yi(e,t){for(const n of[...e])n(t)}let $i=class{constructor(){this._hooks={},this._before=void 0,this._after=void 0,this._deprecatedMessages=void 0,this._deprecatedHooks={},this.hook=this.hook.bind(this),this.callHook=this.callHook.bind(this),this.callHookWith=this.callHookWith.bind(this)}hook(e,t,n={}){if(!e||"function"!=typeof t)return()=>{};const i=e;let r;for(;this._deprecatedHooks[e];)r=this._deprecatedHooks[e],e=r.to;if(r&&!n.allowDeprecated){let e=r.message;e||(e=`${i} hook has been deprecated`+(r.to?`, please use ${r.to}`:"")),this._deprecatedMessages||(this._deprecatedMessages=new Set),this._deprecatedMessages.has(e)||(console.warn(e),this._deprecatedMessages.add(e))}if(!t.name)try{Object.defineProperty(t,"name",{get:()=>"_"+e.replace(/\W+/g,"_")+"_hook_cb",configurable:!0})}catch{}return this._hooks[e]=this._hooks[e]||[],this._hooks[e].push(t),()=>{t&&(this.removeHook(e,t),t=void 0)}}hookOnce(e,t){let n,i=(...e)=>("function"==typeof n&&n(),n=void 0,i=void 0,t(...e));return n=this.hook(e,i),n}removeHook(e,t){if(this._hooks[e]){const n=this._hooks[e].indexOf(t);-1!==n&&this._hooks[e].splice(n,1),0===this._hooks[e].length&&delete this._hooks[e]}}deprecateHook(e,t){this._deprecatedHooks[e]="string"==typeof t?{to:t}:t;const n=this._hooks[e]||[];delete this._hooks[e];for(const i of n)this.hook(e,i)}deprecateHooks(e){Object.assign(this._deprecatedHooks,e);for(const t in e)this.deprecateHook(t,e[t])}addHooks(e){const t=Gi(e),n=Object.keys(t).map(e=>this.hook(e,t[e]));return()=>{for(const e of n.splice(0,n.length))e()}}removeHooks(e){const t=Gi(e);for(const n in t)this.removeHook(n,t[n])}removeAllHooks(){for(const e in this._hooks)delete this._hooks[e]}callHook(e,...t){return t.unshift(e),this.callHookWith(Xi,e,...t)}callHookParallel(e,...t){return t.unshift(e),this.callHookWith(qi,e,...t)}callHookWith(e,t,...n){const i=this._before||this._after?{name:t,args:n,context:{}}:void 0;this._before&&Yi(this._before,i);const r=e(t in this._hooks?[...this._hooks[t]]:[],n);return r instanceof Promise?r.finally(()=>{this._after&&i&&Yi(this._after,i)}):(this._after&&i&&Yi(this._after,i),r)}beforeEach(e){return this._before=this._before||[],this._before.push(e),()=>{if(void 0!==this._before){const t=this._before.indexOf(e);-1!==t&&this._before.splice(t,1)}}}afterEach(e){return this._after=this._after||[],this._after.push(e),()=>{if(void 0!==this._after){const t=this._after.indexOf(e);-1!==t&&this._after.splice(t,1)}}}};function Zi(){return new $i}var Qi,Ji=Object.create,er=Object.defineProperty,tr=Object.getOwnPropertyDescriptor,nr=Object.getOwnPropertyNames,ir=Object.getPrototypeOf,rr=Object.prototype.hasOwnProperty,sr=(e,t)=>function(){return t||(0,e[nr(e)[0]])((t={exports:{}}).exports,t),t.exports},or=((e,t)=>function(){return e&&(t=(0,e[nr(e)[0]])(e=0)),t})({"../../node_modules/.pnpm/tsup@8.4.0_@microsoft+api-extractor@7.51.1_@types+node@22.13.14__jiti@2.4.2_postcss@8.5_96eb05a9d65343021e53791dd83f3773/node_modules/tsup/assets/esm_shims.js"(){}}),ar=sr({"../../node_modules/.pnpm/speakingurl@14.0.1/node_modules/speakingurl/lib/speakingurl.js"(e,t){or(),function(e){var n={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"Ae","Å":"A","Æ":"AE","Ç":"C","È":"E","É":"E","Ê":"E","Ë":"E","Ì":"I","Í":"I","Î":"I","Ï":"I","Ð":"D","Ñ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"Oe","Ő":"O","Ø":"O","Ù":"U","Ú":"U","Û":"U","Ü":"Ue","Ű":"U","Ý":"Y","Þ":"TH","ß":"ss","à":"a","á":"a","â":"a","ã":"a","ä":"ae","å":"a","æ":"ae","ç":"c","è":"e","é":"e","ê":"e","ë":"e","ì":"i","í":"i","î":"i","ï":"i","ð":"d","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"oe","ő":"o","ø":"o","ù":"u","ú":"u","û":"u","ü":"ue","ű":"u","ý":"y","þ":"th","ÿ":"y","ẞ":"SS","ا":"a","أ":"a","إ":"i","آ":"aa","ؤ":"u","ئ":"e","ء":"a","ب":"b","ت":"t","ث":"th","ج":"j","ح":"h","خ":"kh","د":"d","ذ":"th","ر":"r","ز":"z","س":"s","ش":"sh","ص":"s","ض":"dh","ط":"t","ظ":"z","ع":"a","غ":"gh","ف":"f","ق":"q","ك":"k","ل":"l","م":"m","ن":"n","ه":"h","و":"w","ي":"y","ى":"a","ة":"h","ﻻ":"la","ﻷ":"laa","ﻹ":"lai","ﻵ":"laa","گ":"g","چ":"ch","پ":"p","ژ":"zh","ک":"k","ی":"y","َ":"a","ً":"an","ِ":"e","ٍ":"en","ُ":"u","ٌ":"on","ْ":"","٠":"0","١":"1","٢":"2","٣":"3","٤":"4","٥":"5","٦":"6","٧":"7","٨":"8","٩":"9","۰":"0","۱":"1","۲":"2","۳":"3","۴":"4","۵":"5","۶":"6","۷":"7","۸":"8","۹":"9","က":"k","ခ":"kh","ဂ":"g","ဃ":"ga","င":"ng","စ":"s","ဆ":"sa","ဇ":"z","စျ":"za","ည":"ny","ဋ":"t","ဌ":"ta","ဍ":"d","ဎ":"da","ဏ":"na","တ":"t","ထ":"ta","ဒ":"d","ဓ":"da","န":"n","ပ":"p","ဖ":"pa","ဗ":"b","ဘ":"ba","မ":"m","ယ":"y","ရ":"ya","လ":"l","ဝ":"w","သ":"th","ဟ":"h","ဠ":"la","အ":"a","ြ":"y","ျ":"ya","ွ":"w","ြွ":"yw","ျွ":"ywa","ှ":"h","ဧ":"e","၏":"-e","ဣ":"i","ဤ":"-i","ဉ":"u","ဦ":"-u","ဩ":"aw","သြော":"aw","ဪ":"aw","၀":"0","၁":"1","၂":"2","၃":"3","၄":"4","၅":"5","၆":"6","၇":"7","၈":"8","၉":"9","္":"","့":"","း":"","č":"c","ď":"d","ě":"e","ň":"n","ř":"r","š":"s","ť":"t","ů":"u","ž":"z","Č":"C","Ď":"D","Ě":"E","Ň":"N","Ř":"R","Š":"S","Ť":"T","Ů":"U","Ž":"Z","ހ":"h","ށ":"sh","ނ":"n","ރ":"r","ބ":"b","ޅ":"lh","ކ":"k","އ":"a","ވ":"v","މ":"m","ފ":"f","ދ":"dh","ތ":"th","ލ":"l","ގ":"g","ޏ":"gn","ސ":"s","ޑ":"d","ޒ":"z","ޓ":"t","ޔ":"y","ޕ":"p","ޖ":"j","ޗ":"ch","ޘ":"tt","ޙ":"hh","ޚ":"kh","ޛ":"th","ޜ":"z","ޝ":"sh","ޞ":"s","ޟ":"d","ޠ":"t","ޡ":"z","ޢ":"a","ޣ":"gh","ޤ":"q","ޥ":"w","ަ":"a","ާ":"aa","ި":"i","ީ":"ee","ު":"u","ޫ":"oo","ެ":"e","ޭ":"ey","ޮ":"o","ޯ":"oa","ް":"","ა":"a","ბ":"b","გ":"g","დ":"d","ე":"e","ვ":"v","ზ":"z","თ":"t","ი":"i","კ":"k","ლ":"l","მ":"m","ნ":"n","ო":"o","პ":"p","ჟ":"zh","რ":"r","ს":"s","ტ":"t","უ":"u","ფ":"p","ქ":"k","ღ":"gh","ყ":"q","შ":"sh","ჩ":"ch","ც":"ts","ძ":"dz","წ":"ts","ჭ":"ch","ხ":"kh","ჯ":"j","ჰ":"h","α":"a","β":"v","γ":"g","δ":"d","ε":"e","ζ":"z","η":"i","θ":"th","ι":"i","κ":"k","λ":"l","μ":"m","ν":"n","ξ":"ks","ο":"o","π":"p","ρ":"r","σ":"s","τ":"t","υ":"y","φ":"f","χ":"x","ψ":"ps","ω":"o","ά":"a","έ":"e","ί":"i","ό":"o","ύ":"y","ή":"i","ώ":"o","ς":"s","ϊ":"i","ΰ":"y","ϋ":"y","ΐ":"i","Α":"A","Β":"B","Γ":"G","Δ":"D","Ε":"E","Ζ":"Z","Η":"I","Θ":"TH","Ι":"I","Κ":"K","Λ":"L","Μ":"M","Ν":"N","Ξ":"KS","Ο":"O","Π":"P","Ρ":"R","Σ":"S","Τ":"T","Υ":"Y","Φ":"F","Χ":"X","Ψ":"PS","Ω":"O","Ά":"A","Έ":"E","Ί":"I","Ό":"O","Ύ":"Y","Ή":"I","Ώ":"O","Ϊ":"I","Ϋ":"Y","ā":"a","ē":"e","ģ":"g","ī":"i","ķ":"k","ļ":"l","ņ":"n","ū":"u","Ā":"A","Ē":"E","Ģ":"G","Ī":"I","Ķ":"k","Ļ":"L","Ņ":"N","Ū":"U","Ќ":"Kj","ќ":"kj","Љ":"Lj","љ":"lj","Њ":"Nj","њ":"nj","Тс":"Ts","тс":"ts","ą":"a","ć":"c","ę":"e","ł":"l","ń":"n","ś":"s","ź":"z","ż":"z","Ą":"A","Ć":"C","Ę":"E","Ł":"L","Ń":"N","Ś":"S","Ź":"Z","Ż":"Z","Є":"Ye","І":"I","Ї":"Yi","Ґ":"G","є":"ye","і":"i","ї":"yi","ґ":"g","ă":"a","Ă":"A","ș":"s","Ș":"S","ț":"t","Ț":"T","ţ":"t","Ţ":"T","а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"yo","ж":"zh","з":"z","и":"i","й":"i","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"kh","ц":"c","ч":"ch","ш":"sh","щ":"sh","ъ":"","ы":"y","ь":"","э":"e","ю":"yu","я":"ya","А":"A","Б":"B","В":"V","Г":"G","Д":"D","Е":"E","Ё":"Yo","Ж":"Zh","З":"Z","И":"I","Й":"I","К":"K","Л":"L","М":"M","Н":"N","О":"O","П":"P","Р":"R","С":"S","Т":"T","У":"U","Ф":"F","Х":"Kh","Ц":"C","Ч":"Ch","Ш":"Sh","Щ":"Sh","Ъ":"","Ы":"Y","Ь":"","Э":"E","Ю":"Yu","Я":"Ya","ђ":"dj","ј":"j","ћ":"c","џ":"dz","Ђ":"Dj","Ј":"j","Ћ":"C","Џ":"Dz","ľ":"l","ĺ":"l","ŕ":"r","Ľ":"L","Ĺ":"L","Ŕ":"R","ş":"s","Ş":"S","ı":"i","İ":"I","ğ":"g","Ğ":"G","ả":"a","Ả":"A","ẳ":"a","Ẳ":"A","ẩ":"a","Ẩ":"A","đ":"d","Đ":"D","ẹ":"e","Ẹ":"E","ẽ":"e","Ẽ":"E","ẻ":"e","Ẻ":"E","ế":"e","Ế":"E","ề":"e","Ề":"E","ệ":"e","Ệ":"E","ễ":"e","Ễ":"E","ể":"e","Ể":"E","ỏ":"o","ọ":"o","Ọ":"o","ố":"o","Ố":"O","ồ":"o","Ồ":"O","ổ":"o","Ổ":"O","ộ":"o","Ộ":"O","ỗ":"o","Ỗ":"O","ơ":"o","Ơ":"O","ớ":"o","Ớ":"O","ờ":"o","Ờ":"O","ợ":"o","Ợ":"O","ỡ":"o","Ỡ":"O","Ở":"o","ở":"o","ị":"i","Ị":"I","ĩ":"i","Ĩ":"I","ỉ":"i","Ỉ":"i","ủ":"u","Ủ":"U","ụ":"u","Ụ":"U","ũ":"u","Ũ":"U","ư":"u","Ư":"U","ứ":"u","Ứ":"U","ừ":"u","Ừ":"U","ự":"u","Ự":"U","ữ":"u","Ữ":"U","ử":"u","Ử":"ư","ỷ":"y","Ỷ":"y","ỳ":"y","Ỳ":"Y","ỵ":"y","Ỵ":"Y","ỹ":"y","Ỹ":"Y","ạ":"a","Ạ":"A","ấ":"a","Ấ":"A","ầ":"a","Ầ":"A","ậ":"a","Ậ":"A","ẫ":"a","Ẫ":"A","ắ":"a","Ắ":"A","ằ":"a","Ằ":"A","ặ":"a","Ặ":"A","ẵ":"a","Ẵ":"A","⓪":"0","①":"1","②":"2","③":"3","④":"4","⑤":"5","⑥":"6","⑦":"7","⑧":"8","⑨":"9","⑩":"10","⑪":"11","⑫":"12","⑬":"13","⑭":"14","⑮":"15","⑯":"16","⑰":"17","⑱":"18","⑲":"18","⑳":"18","⓵":"1","⓶":"2","⓷":"3","⓸":"4","⓹":"5","⓺":"6","⓻":"7","⓼":"8","⓽":"9","⓾":"10","⓿":"0","⓫":"11","⓬":"12","⓭":"13","⓮":"14","⓯":"15","⓰":"16","⓱":"17","⓲":"18","⓳":"19","⓴":"20","Ⓐ":"A","Ⓑ":"B","Ⓒ":"C","Ⓓ":"D","Ⓔ":"E","Ⓕ":"F","Ⓖ":"G","Ⓗ":"H","Ⓘ":"I","Ⓙ":"J","Ⓚ":"K","Ⓛ":"L","Ⓜ":"M","Ⓝ":"N","Ⓞ":"O","Ⓟ":"P","Ⓠ":"Q","Ⓡ":"R","Ⓢ":"S","Ⓣ":"T","Ⓤ":"U","Ⓥ":"V","Ⓦ":"W","Ⓧ":"X","Ⓨ":"Y","Ⓩ":"Z","ⓐ":"a","ⓑ":"b","ⓒ":"c","ⓓ":"d","ⓔ":"e","ⓕ":"f","ⓖ":"g","ⓗ":"h","ⓘ":"i","ⓙ":"j","ⓚ":"k","ⓛ":"l","ⓜ":"m","ⓝ":"n","ⓞ":"o","ⓟ":"p","ⓠ":"q","ⓡ":"r","ⓢ":"s","ⓣ":"t","ⓤ":"u","ⓦ":"v","ⓥ":"w","ⓧ":"x","ⓨ":"y","ⓩ":"z","“":'"',"”":'"',"‘":"'","’":"'","∂":"d","ƒ":"f","™":"(TM)","©":"(C)","œ":"oe","Œ":"OE","®":"(R)","†":"+","℠":"(SM)","…":"...","˚":"o","º":"o","ª":"a","•":"*","၊":",","။":".",$:"USD","€":"EUR","₢":"BRN","₣":"FRF","£":"GBP","₤":"ITL","₦":"NGN","₧":"ESP","₩":"KRW","₪":"ILS","₫":"VND","₭":"LAK","₮":"MNT","₯":"GRD","₱":"ARS","₲":"PYG","₳":"ARA","₴":"UAH","₵":"GHS","¢":"cent","¥":"CNY","元":"CNY","円":"YEN","﷼":"IRR","₠":"EWE","฿":"THB","₨":"INR","₹":"INR","₰":"PF","₺":"TRY","؋":"AFN","₼":"AZN","лв":"BGN","៛":"KHR","₡":"CRC","₸":"KZT","ден":"MKD","zł":"PLN","₽":"RUB","₾":"GEL"},i=["်","ް"],r={"ာ":"a","ါ":"a","ေ":"e","ဲ":"e","ိ":"i","ီ":"i","ို":"o","ု":"u","ူ":"u","ေါင်":"aung","ော":"aw","ော်":"aw","ေါ":"aw","ေါ်":"aw","်":"်","က်":"et","ိုက်":"aik","ောက်":"auk","င်":"in","ိုင်":"aing","ောင်":"aung","စ်":"it","ည်":"i","တ်":"at","ိတ်":"eik","ုတ်":"ok","ွတ်":"ut","ေတ်":"it","ဒ်":"d","ိုဒ်":"ok","ုဒ်":"ait","န်":"an","ာန်":"an","ိန်":"ein","ုန်":"on","ွန်":"un","ပ်":"at","ိပ်":"eik","ုပ်":"ok","ွပ်":"ut","န်ုပ်":"nub","မ်":"an","ိမ်":"ein","ုမ်":"on","ွမ်":"un","ယ်":"e","ိုလ်":"ol","ဉ်":"in","ံ":"an","ိံ":"ein","ုံ":"on","ައް":"ah","ަށް":"ah"},s={en:{},az:{"ç":"c","ə":"e","ğ":"g","ı":"i","ö":"o","ş":"s","ü":"u","Ç":"C","Ə":"E","Ğ":"G","İ":"I","Ö":"O","Ş":"S","Ü":"U"},cs:{"č":"c","ď":"d","ě":"e","ň":"n","ř":"r","š":"s","ť":"t","ů":"u","ž":"z","Č":"C","Ď":"D","Ě":"E","Ň":"N","Ř":"R","Š":"S","Ť":"T","Ů":"U","Ž":"Z"},fi:{"ä":"a","Ä":"A","ö":"o","Ö":"O"},hu:{"ä":"a","Ä":"A","ö":"o","Ö":"O","ü":"u","Ü":"U","ű":"u","Ű":"U"},lt:{"ą":"a","č":"c","ę":"e","ė":"e","į":"i","š":"s","ų":"u","ū":"u","ž":"z","Ą":"A","Č":"C","Ę":"E","Ė":"E","Į":"I","Š":"S","Ų":"U","Ū":"U"},lv:{"ā":"a","č":"c","ē":"e","ģ":"g","ī":"i","ķ":"k","ļ":"l","ņ":"n","š":"s","ū":"u","ž":"z","Ā":"A","Č":"C","Ē":"E","Ģ":"G","Ī":"i","Ķ":"k","Ļ":"L","Ņ":"N","Š":"S","Ū":"u","Ž":"Z"},pl:{"ą":"a","ć":"c","ę":"e","ł":"l","ń":"n","ó":"o","ś":"s","ź":"z","ż":"z","Ą":"A","Ć":"C","Ę":"e","Ł":"L","Ń":"N","Ó":"O","Ś":"S","Ź":"Z","Ż":"Z"},sv:{"ä":"a","Ä":"A","ö":"o","Ö":"O"},sk:{"ä":"a","Ä":"A"},sr:{"љ":"lj","њ":"nj","Љ":"Lj","Њ":"Nj","đ":"dj","Đ":"Dj"},tr:{"Ü":"U","Ö":"O","ü":"u","ö":"o"}},o={ar:{"∆":"delta","∞":"la-nihaya","♥":"hob","&":"wa","|":"aw","<":"aqal-men",">":"akbar-men","∑":"majmou","¤":"omla"},az:{},ca:{"∆":"delta","∞":"infinit","♥":"amor","&":"i","|":"o","<":"menys que",">":"mes que","∑":"suma dels","¤":"moneda"},cs:{"∆":"delta","∞":"nekonecno","♥":"laska","&":"a","|":"nebo","<":"mensi nez",">":"vetsi nez","∑":"soucet","¤":"mena"},de:{"∆":"delta","∞":"unendlich","♥":"Liebe","&":"und","|":"oder","<":"kleiner als",">":"groesser als","∑":"Summe von","¤":"Waehrung"},dv:{"∆":"delta","∞":"kolunulaa","♥":"loabi","&":"aai","|":"noonee","<":"ah vure kuda",">":"ah vure bodu","∑":"jumula","¤":"faisaa"},en:{"∆":"delta","∞":"infinity","♥":"love","&":"and","|":"or","<":"less than",">":"greater than","∑":"sum","¤":"currency"},es:{"∆":"delta","∞":"infinito","♥":"amor","&":"y","|":"u","<":"menos que",">":"mas que","∑":"suma de los","¤":"moneda"},fa:{"∆":"delta","∞":"bi-nahayat","♥":"eshgh","&":"va","|":"ya","<":"kamtar-az",">":"bishtar-az","∑":"majmooe","¤":"vahed"},fi:{"∆":"delta","∞":"aarettomyys","♥":"rakkaus","&":"ja","|":"tai","<":"pienempi kuin",">":"suurempi kuin","∑":"summa","¤":"valuutta"},fr:{"∆":"delta","∞":"infiniment","♥":"Amour","&":"et","|":"ou","<":"moins que",">":"superieure a","∑":"somme des","¤":"monnaie"},ge:{"∆":"delta","∞":"usasruloba","♥":"siqvaruli","&":"da","|":"an","<":"naklebi",">":"meti","∑":"jami","¤":"valuta"},gr:{},hu:{"∆":"delta","∞":"vegtelen","♥":"szerelem","&":"es","|":"vagy","<":"kisebb mint",">":"nagyobb mint","∑":"szumma","¤":"penznem"},it:{"∆":"delta","∞":"infinito","♥":"amore","&":"e","|":"o","<":"minore di",">":"maggiore di","∑":"somma","¤":"moneta"},lt:{"∆":"delta","∞":"begalybe","♥":"meile","&":"ir","|":"ar","<":"maziau nei",">":"daugiau nei","∑":"suma","¤":"valiuta"},lv:{"∆":"delta","∞":"bezgaliba","♥":"milestiba","&":"un","|":"vai","<":"mazak neka",">":"lielaks neka","∑":"summa","¤":"valuta"},my:{"∆":"kwahkhyaet","∞":"asaonasme","♥":"akhyait","&":"nhin","|":"tho","<":"ngethaw",">":"kyithaw","∑":"paungld","¤":"ngwekye"},mk:{},nl:{"∆":"delta","∞":"oneindig","♥":"liefde","&":"en","|":"of","<":"kleiner dan",">":"groter dan","∑":"som","¤":"valuta"},pl:{"∆":"delta","∞":"nieskonczonosc","♥":"milosc","&":"i","|":"lub","<":"mniejsze niz",">":"wieksze niz","∑":"suma","¤":"waluta"},pt:{"∆":"delta","∞":"infinito","♥":"amor","&":"e","|":"ou","<":"menor que",">":"maior que","∑":"soma","¤":"moeda"},ro:{"∆":"delta","∞":"infinit","♥":"dragoste","&":"si","|":"sau","<":"mai mic ca",">":"mai mare ca","∑":"suma","¤":"valuta"},ru:{"∆":"delta","∞":"beskonechno","♥":"lubov","&":"i","|":"ili","<":"menshe",">":"bolshe","∑":"summa","¤":"valjuta"},sk:{"∆":"delta","∞":"nekonecno","♥":"laska","&":"a","|":"alebo","<":"menej ako",">":"viac ako","∑":"sucet","¤":"mena"},sr:{},tr:{"∆":"delta","∞":"sonsuzluk","♥":"ask","&":"ve","|":"veya","<":"kucuktur",">":"buyuktur","∑":"toplam","¤":"para birimi"},uk:{"∆":"delta","∞":"bezkinechnist","♥":"lubov","&":"i","|":"abo","<":"menshe",">":"bilshe","∑":"suma","¤":"valjuta"},vn:{"∆":"delta","∞":"vo cuc","♥":"yeu","&":"va","|":"hoac","<":"nho hon",">":"lon hon","∑":"tong","¤":"tien te"}},a=[";","?",":","@","&","=","+","$",",","/"].join(""),l=[";","?",":","@","&","=","+","$",","].join(""),c=[".","!","~","*","'","(",")"].join(""),u=function(e,t){var u,h,m,f,g,_,v,y,b,w,T,x,E,P,A="-",M="",S="",C=!0,R={},O="";if("string"!=typeof e)return"";if("string"==typeof t&&(A=t),v=o.en,y=s.en,"object"==typeof t)for(T in u=t.maintainCase||!1,R=t.custom&&"object"==typeof t.custom?t.custom:R,m=+t.truncate>1&&t.truncate||!1,f=t.uric||!1,g=t.uricNoSlash||!1,_=t.mark||!1,C=!(!1===t.symbols||!1===t.lang),A=t.separator||A,f&&(O+=a),g&&(O+=l),_&&(O+=c),v=t.lang&&o[t.lang]&&C?o[t.lang]:C?o.en:{},y=t.lang&&s[t.lang]?s[t.lang]:!1===t.lang||!0===t.lang?{}:s.en,t.titleCase&&"number"==typeof t.titleCase.length&&Array.prototype.toString.call(t.titleCase)?(t.titleCase.forEach(function(e){R[e+""]=e+""}),h=!0):h=!!t.titleCase,t.custom&&"number"==typeof t.custom.length&&Array.prototype.toString.call(t.custom)&&t.custom.forEach(function(e){R[e+""]=e+""}),Object.keys(R).forEach(function(t){var n;n=t.length>1?new RegExp("\\b"+d(t)+"\\b","gi"):new RegExp(d(t),"gi"),e=e.replace(n,R[t])}),R)O+=T;for(O=d(O+=A),E=!1,P=!1,w=0,x=(e=e.replace(/(^\s+|\s+$)/g,"")).length;w<x;w++)T=e[w],p(T,R)?E=!1:y[T]?(T=E&&y[T].match(/[A-Za-z0-9]/)?" "+y[T]:y[T],E=!1):T in n?(w+1<x&&i.indexOf(e[w+1])>=0?(S+=T,T=""):!0===P?(T=r[S]+n[T],S=""):T=E&&n[T].match(/[A-Za-z0-9]/)?" "+n[T]:n[T],E=!1,P=!1):T in r?(S+=T,T="",w===x-1&&(T=r[S]),P=!0):!v[T]||f&&-1!==a.indexOf(T)||g&&-1!==l.indexOf(T)?(!0===P?(T=r[S]+T,S="",P=!1):E&&(/[A-Za-z0-9]/.test(T)||M.substr(-1).match(/A-Za-z0-9]/))&&(T=" "+T),E=!1):(T=E||M.substr(-1).match(/[A-Za-z0-9]/)?A+v[T]:v[T],T+=void 0!==e[w+1]&&e[w+1].match(/[A-Za-z0-9]/)?A:"",E=!0),M+=T.replace(new RegExp("[^\\w\\s"+O+"_-]","g"),A);return h&&(M=M.replace(/(\w)(\S*)/g,function(e,t,n){var i=t.toUpperCase()+(null!==n?n:"");return Object.keys(R).indexOf(i.toLowerCase())<0?i:i.toLowerCase()})),M=M.replace(/\s+/g,A).replace(new RegExp("\\"+A+"+","g"),A).replace(new RegExp("(^\\"+A+"+|\\"+A+"+$)","g"),""),m&&M.length>m&&(b=M.charAt(m)===A,M=M.slice(0,m),b||(M=M.slice(0,M.lastIndexOf(A)))),!u&&!h&&(M=M.toLowerCase()),M},h=function(e){return function(t){return u(t,e)}},d=function(e){return e.replace(/[-\\^$*+?.()|[\]{}\/]/g,"\\$&")},p=function(e,t){for(var n in t)if(t[n]===e)return!0};if(typeof t<"u"&&t.exports)t.exports=u,t.exports.createSlug=h;else if(typeof define<"u"&&define.amd)define([],function(){return u});else try{if(e.getSlug||e.createSlug)throw"speakingurl: globals exists /(getSlug|createSlug)/";e.getSlug=u,e.createSlug=h}catch{}}(e)}}),lr=sr({"../../node_modules/.pnpm/speakingurl@14.0.1/node_modules/speakingurl/index.js"(e,t){or(),t.exports=ar()}});function cr(e){const t=e.__file;if(t)return function(e){return e&&`${e}`.replace(ji,zi)}(function(e,t){let n=e.replace(/^[a-z]:/i,"").replace(/\\/g,"/");n.endsWith(`index${t}`)&&(n=n.replace(`/index${t}`,t));const i=n.lastIndexOf("/"),r=n.substring(i+1);{const e=r.lastIndexOf(t);return r.substring(0,e)}}(t,".vue"))}function ur(e,t){return e.type.__VUE_DEVTOOLS_COMPONENT_GUSSED_NAME__=t,t}function hr(e){return e.__VUE_DEVTOOLS_NEXT_APP_RECORD__?e.__VUE_DEVTOOLS_NEXT_APP_RECORD__:e.root?e.appContext.app.__VUE_DEVTOOLS_NEXT_APP_RECORD__:void 0}function dr(e){var t,n;const i=null==(t=e.subTree)?void 0:t.type,r=hr(e);return!!r&&(null==(n=r?.types)?void 0:n.Fragment)===i}function pr(e){var t,n,i;const r=function(e){var t;const n=e.name||e._componentTag||e.__VUE_DEVTOOLS_COMPONENT_GUSSED_NAME__||e.__name;return"index"===n&&null!=(t=e.__file)&&t.endsWith("index.vue")?"":n}(e?.type||{});if(r)return r;if(e?.root===e)return"Root";for(const s in null==(n=null==(t=e.parent)?void 0:t.type)?void 0:n.components)if(e.parent.type.components[s]===e?.type)return ur(e,s);for(const s in null==(i=e.appContext)?void 0:i.components)if(e.appContext.components[s]===e?.type)return ur(e,s);return cr(e?.type||{})||"Anonymous Component"}function mr(e,t){return t=t||`${e.id}:root`,e.instanceMap.get(t)||e.instanceMap.get(":root")}function fr(e){return Qi||(Qi=document.createRange()),Qi.selectNode(e),Qi.getBoundingClientRect()}function gr(e,t){return(!e.top||t.top<e.top)&&(e.top=t.top),(!e.bottom||t.bottom>e.bottom)&&(e.bottom=t.bottom),(!e.left||t.left<e.left)&&(e.left=t.left),(!e.right||t.right>e.right)&&(e.right=t.right),e}or(),or(),or(),or(),or(),or(),or(),or();var _r={top:0,left:0,right:0,bottom:0,width:0,height:0};function vr(e){const t=e.subTree.el;return typeof window>"u"?_r:dr(e)?function(e){const t=function(){const e={top:0,bottom:0,left:0,right:0,get width(){return e.right-e.left},get height(){return e.bottom-e.top}};return e}();if(!e.children)return t;for(let n=0,i=e.children.length;n<i;n++){const i=e.children[n];let r;if(i.component)r=vr(i.component);else if(i.el){const e=i.el;1===e.nodeType||e.getBoundingClientRect?r=e.getBoundingClientRect():3===e.nodeType&&e.data.trim()&&(r=fr(e))}r&&gr(t,r)}return t}(e.subTree):1===t?.nodeType?t?.getBoundingClientRect():e.subTree.component?vr(e.subTree.component):_r}function yr(e){return dr(e)?function(e){if(!e.children)return[];const t=[];return e.children.forEach(e=>{e.component?t.push(...yr(e.component)):e?.el&&t.push(e.el)}),t}(e.subTree):e.subTree?[e.subTree.el]:[]}or();var br="__vue-devtools-component-inspector__",wr="__vue-devtools-component-inspector__card__",Tr="__vue-devtools-component-inspector__name__",xr="__vue-devtools-component-inspector__indicator__",Er={display:"block",zIndex:2147483640,position:"fixed",backgroundColor:"#42b88325",border:"1px solid #42b88350",borderRadius:"5px",transition:"all 0.1s ease-in",pointerEvents:"none"},Pr={fontFamily:"Arial, Helvetica, sans-serif",padding:"5px 8px",borderRadius:"4px",textAlign:"left",position:"absolute",left:0,color:"#e9e9e9",fontSize:"14px",fontWeight:600,lineHeight:"24px",backgroundColor:"#42b883",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1)"},Ar={display:"inline-block",fontWeight:400,fontStyle:"normal",fontSize:"12px",opacity:.7};function Mr(){return document.getElementById(br)}function Sr(e){return{left:Math.round(100*e.left)/100+"px",top:Math.round(100*e.top)/100+"px",width:Math.round(100*e.width)/100+"px",height:Math.round(100*e.height)/100+"px"}}function Cr(e){var t;const n=document.createElement("div");n.id=null!=(t=e.elementId)?t:br,Object.assign(n.style,{...Er,...Sr(e.bounds),...e.style});const i=document.createElement("span");i.id=wr,Object.assign(i.style,{...Pr,top:e.bounds.top<35?0:"-35px"});const r=document.createElement("span");r.id=Tr,r.innerHTML=`&lt;${e.name}&gt;&nbsp;&nbsp;`;const s=document.createElement("i");return s.id=xr,s.innerHTML=`${Math.round(100*e.bounds.width)/100} x ${Math.round(100*e.bounds.height)/100}`,Object.assign(s.style,Ar),i.appendChild(r),i.appendChild(s),n.appendChild(i),document.body.appendChild(n),n}function Rr(e){const t=Mr(),n=document.getElementById(wr),i=document.getElementById(Tr),r=document.getElementById(xr);t&&(Object.assign(t.style,{...Er,...Sr(e.bounds)}),Object.assign(n.style,{top:e.bounds.top<35?0:"-35px"}),i.innerHTML=`&lt;${e.name}&gt;&nbsp;&nbsp;`,r.innerHTML=`${Math.round(100*e.bounds.width)/100} x ${Math.round(100*e.bounds.height)/100}`)}function Or(){const e=Mr();e&&(e.style.display="none")}var kr=null;function Lr(e){const t=e.target;if(t){const e=t.__vueParentComponent;if(e&&(kr=e,e.vnode.el)){const t=vr(e),n=pr(e);Mr()?Rr({bounds:t,name:n}):Cr({bounds:t,name:n})}}}var Ir,Dr=null;function Fr(){return window.addEventListener("mouseover",Lr),new Promise(e=>{function t(n){n.preventDefault(),n.stopPropagation(),function(e,t){if(e.preventDefault(),e.stopPropagation(),kr){const e=function(e){var t,n,i;return`${null!=(i=null==(n=null==(t=e?.appContext)?void 0:t.app)?void 0:n.__VUE_DEVTOOLS_NEXT_APP_RECORD_ID__)?i:0}:${e===e?.root?"root":e.uid}`}(kr);t(e)}}(n,n=>{window.removeEventListener("click",t,!0),Dr=null,window.removeEventListener("mouseover",Lr);const i=Mr();i&&(i.style.display="none"),e(JSON.stringify({id:n}))})}Dr=t,window.addEventListener("click",t,!0)})}function Ur(){return new Promise(e=>{function t(){(function(){const e=Ui.__VUE_INSPECTOR__,t=e.openInEditor;e.openInEditor=async(...n)=>{e.disable(),t(...n)}})(),e(Ui.__VUE_INSPECTOR__)}Ui.__VUE_INSPECTOR__?t():function(e){let t=0;const n=setInterval(()=>{Ui.__VUE_INSPECTOR__&&(clearInterval(n),t+=30,e()),t>=5e3&&clearInterval(n)},30)}(()=>{t()})})}function Nr(e){return function(e){return!(!e||!e.__v_isReadonly)}(e)?Nr(e.__v_raw):!(!e||!e.__v_isReactive)}function jr(e){return!(!e||!0!==e.__v_isRef)}function zr(e){const t=e&&e.__v_raw;return t?zr(t):e}or(),null!=(Ir=Ui).__VUE_DEVTOOLS_COMPONENT_INSPECTOR_ENABLED__||(Ir.__VUE_DEVTOOLS_COMPONENT_INSPECTOR_ENABLED__=!0),or(),or();var Br=class{constructor(){this.refEditor=new Vr}set(e,t,n,i){const r=Array.isArray(t)?t:t.split(".");for(;r.length>1;){const t=r.shift();e=e instanceof Map?e.get(t):e instanceof Set?Array.from(e.values())[t]:e[t],this.refEditor.isRef(e)&&(e=this.refEditor.get(e))}const s=r[0],o=this.refEditor.get(e)[s];i?i(e,s,n):this.refEditor.isRef(o)?this.refEditor.set(o,n):e[s]=n}get(e,t){const n=Array.isArray(t)?t:t.split(".");for(let i=0;i<n.length;i++)if(e=e instanceof Map?e.get(n[i]):e[n[i]],this.refEditor.isRef(e)&&(e=this.refEditor.get(e)),!e)return;return e}has(e,t,n=!1){if(typeof e>"u")return!1;const i=Array.isArray(t)?t.slice():t.split("."),r=n?2:1;for(;e&&i.length>r;){e=e[i.shift()],this.refEditor.isRef(e)&&(e=this.refEditor.get(e))}return null!=e&&Object.prototype.hasOwnProperty.call(e,i[0])}createDefaultSetCallback(e){return(t,n,i)=>{if((e.remove||e.newKey)&&(Array.isArray(t)?t.splice(n,1):zr(t)instanceof Map?t.delete(n):zr(t)instanceof Set?t.delete(Array.from(t.values())[n]):Reflect.deleteProperty(t,n)),!e.remove){const r=t[e.newKey||n];this.refEditor.isRef(r)?this.refEditor.set(r,i):zr(t)instanceof Map?t.set(e.newKey||n,i):zr(t)instanceof Set?t.add(i):t[e.newKey||n]=i}}}},Vr=class{set(e,t){if(jr(e))e.value=t;else{if(e instanceof Set&&Array.isArray(t))return e.clear(),void t.forEach(t=>e.add(t));const n=Object.keys(t);if(e instanceof Map){const i=new Set(e.keys());return n.forEach(n=>{e.set(n,Reflect.get(t,n)),i.delete(n)}),void i.forEach(t=>e.delete(t))}const i=new Set(Object.keys(e));n.forEach(n=>{Reflect.set(e,n,Reflect.get(t,n)),i.delete(n)}),i.forEach(t=>Reflect.deleteProperty(e,t))}}get(e){return jr(e)?e.value:e}isRef(e){return jr(e)||Nr(e)}};or(),or(),or();var Hr;function Gr(){if(!Fi||typeof localStorage>"u"||null===localStorage)return{recordingState:!1,mouseEventEnabled:!1,keyboardEventEnabled:!1,componentEventEnabled:!1,performanceEventEnabled:!1,selected:""};const e=localStorage.getItem("__VUE_DEVTOOLS_KIT_TIMELINE_LAYERS_STATE__");return e?JSON.parse(e):{recordingState:!1,mouseEventEnabled:!1,keyboardEventEnabled:!1,componentEventEnabled:!1,performanceEventEnabled:!1,selected:""}}or(),or(),or(),null!=(Hr=Ui).__VUE_DEVTOOLS_KIT_TIMELINE_LAYERS||(Hr.__VUE_DEVTOOLS_KIT_TIMELINE_LAYERS=[]);var Wr,Kr=new Proxy(Ui.__VUE_DEVTOOLS_KIT_TIMELINE_LAYERS,{get:(e,t,n)=>Reflect.get(e,t,n)});null!=(Wr=Ui).__VUE_DEVTOOLS_KIT_INSPECTOR__||(Wr.__VUE_DEVTOOLS_KIT_INSPECTOR__=[]);var Xr,qr,Yr,$r,Zr,Qr=new Proxy(Ui.__VUE_DEVTOOLS_KIT_INSPECTOR__,{get:(e,t,n)=>Reflect.get(e,t,n)}),Jr=Hi(()=>{zs.hooks.callHook("sendInspectorToClient",es())});function es(){return Qr.filter(e=>e.descriptor.app===os.value.app).filter(e=>"components"!==e.descriptor.id).map(e=>{var t;const n=e.descriptor,i=e.options;return{id:i.id,label:i.label,logo:n.logo,icon:`custom-ic-baseline-${null==(t=i?.icon)?void 0:t.replace(/_/g,"-")}`,packageName:n.packageName,homepage:n.homepage,pluginId:n.id}})}function ts(e,t){return Qr.find(n=>n.options.id===e&&(!t||n.descriptor.app===t))}null!=(Xr=Ui).__VUE_DEVTOOLS_KIT_APP_RECORDS__||(Xr.__VUE_DEVTOOLS_KIT_APP_RECORDS__=[]),null!=(qr=Ui).__VUE_DEVTOOLS_KIT_ACTIVE_APP_RECORD__||(qr.__VUE_DEVTOOLS_KIT_ACTIVE_APP_RECORD__={}),null!=(Yr=Ui).__VUE_DEVTOOLS_KIT_ACTIVE_APP_RECORD_ID__||(Yr.__VUE_DEVTOOLS_KIT_ACTIVE_APP_RECORD_ID__=""),null!=($r=Ui).__VUE_DEVTOOLS_KIT_CUSTOM_TABS__||($r.__VUE_DEVTOOLS_KIT_CUSTOM_TABS__=[]),null!=(Zr=Ui).__VUE_DEVTOOLS_KIT_CUSTOM_COMMANDS__||(Zr.__VUE_DEVTOOLS_KIT_CUSTOM_COMMANDS__=[]);var ns,is="__VUE_DEVTOOLS_KIT_GLOBAL_STATE__";null!=(ns=Ui)[is]||(ns[is]={connected:!1,clientConnected:!1,vitePluginDetected:!0,appRecords:[],activeAppRecordId:"",tabs:[],commands:[],highPerfModeEnabled:!0,devtoolsClientDetected:{},perfUniqueGroupId:0,timelineLayersState:Gr()});var rs=Hi(e=>{zs.hooks.callHook("devtoolsStateUpdated",{state:e})});Hi((e,t)=>{zs.hooks.callHook("devtoolsConnectedUpdated",{state:e,oldState:t})});var ss=new Proxy(Ui.__VUE_DEVTOOLS_KIT_APP_RECORDS__,{get:(e,t,n)=>"value"===t?Ui.__VUE_DEVTOOLS_KIT_APP_RECORDS__:Ui.__VUE_DEVTOOLS_KIT_APP_RECORDS__[t]}),os=new Proxy(Ui.__VUE_DEVTOOLS_KIT_ACTIVE_APP_RECORD__,{get:(e,t,n)=>"value"===t?Ui.__VUE_DEVTOOLS_KIT_ACTIVE_APP_RECORD__:"id"===t?Ui.__VUE_DEVTOOLS_KIT_ACTIVE_APP_RECORD_ID__:Ui.__VUE_DEVTOOLS_KIT_ACTIVE_APP_RECORD__[t]});function as(){rs({...Ui[is],appRecords:ss.value,activeAppRecordId:os.id,tabs:Ui.__VUE_DEVTOOLS_KIT_CUSTOM_TABS__,commands:Ui.__VUE_DEVTOOLS_KIT_CUSTOM_COMMANDS__})}var ls,cs=new Proxy(Ui[is],{get:(e,t)=>"appRecords"===t?ss:"activeAppRecordId"===t?os.id:"tabs"===t?Ui.__VUE_DEVTOOLS_KIT_CUSTOM_TABS__:"commands"===t?Ui.__VUE_DEVTOOLS_KIT_CUSTOM_COMMANDS__:Ui[is][t],deleteProperty:(e,t)=>(delete e[t],!0),set:(e,t,n)=>(Ui[is],e[t]=n,Ui[is][t]=n,!0)});function us(e={}){var t,n,i;const{file:r,host:s,baseUrl:o=window.location.origin,line:a=0,column:l=0}=e;if(r)if("chrome-extension"===s){const e=r.replace(/\\/g,"\\\\"),i=null!=(n=null==(t=window.VUE_DEVTOOLS_CONFIG)?void 0:t.openInEditorHost)?n:"/";fetch(`${i}__open-in-editor?file=${encodeURI(r)}`).then(t=>{if(!t.ok){const t=`Opening component ${e} failed`;console.log(`%c${t}`,"color:red")}})}else if(cs.vitePluginDetected){const e=null!=(i=Ui.__VUE_DEVTOOLS_OPEN_IN_EDITOR_BASE_URL__)?i:o;Ui.__VUE_INSPECTOR__.openInEditor(e,r,a,l)}}or(),or(),or(),or(),or(),null!=(ls=Ui).__VUE_DEVTOOLS_KIT_PLUGIN_BUFFER__||(ls.__VUE_DEVTOOLS_KIT_PLUGIN_BUFFER__=[]);var hs=new Proxy(Ui.__VUE_DEVTOOLS_KIT_PLUGIN_BUFFER__,{get:(e,t,n)=>Reflect.get(e,t,n)});function ds(e){const t={};return Object.keys(e).forEach(n=>{t[n]=e[n].defaultValue}),t}function ps(e){return`__VUE_DEVTOOLS_NEXT_PLUGIN_SETTINGS__${e}__`}function ms(e){var t,n,i;const r=null!=(n=null==(t=hs.find(t=>{var n;return t[0].id===e&&!(null==(n=t[0])||!n.settings)}))?void 0:t[0])?n:null;return null!=(i=r?.settings)?i:null}function fs(e,t){var n,i,r;const s=ps(e);if(s){const e=localStorage.getItem(s);if(e)return JSON.parse(e)}if(e){const t=null!=(i=null==(n=hs.find(t=>t[0].id===e))?void 0:n[0])?i:null;return ds(null!=(r=t?.settings)?r:{})}return ds(t)}or(),or(),or(),or(),or(),or(),or(),or(),or(),or(),or();var gs,_s,vs=null!=(_s=(gs=Ui).__VUE_DEVTOOLS_HOOK)?_s:gs.__VUE_DEVTOOLS_HOOK=Zi(),ys={vueAppInit(e){vs.hook("app:init",e)},vueAppUnmount(e){vs.hook("app:unmount",e)},vueAppConnected(e){vs.hook("app:connected",e)},componentAdded:e=>vs.hook("component:added",e),componentEmit:e=>vs.hook("component:emit",e),componentUpdated:e=>vs.hook("component:updated",e),componentRemoved:e=>vs.hook("component:removed",e),setupDevtoolsPlugin(e){vs.hook("devtools-plugin:setup",e)},perfStart:e=>vs.hook("perf:start",e),perfEnd:e=>vs.hook("perf:end",e)},bs={on:ys,setupDevToolsPlugin:(e,t)=>vs.callHook("devtools-plugin:setup",e,t)},ws=class{constructor({plugin:e,ctx:t}){this.hooks=t.hooks,this.plugin=e}get on(){return{visitComponentTree:e=>{this.hooks.hook("visitComponentTree",e)},inspectComponent:e=>{this.hooks.hook("inspectComponent",e)},editComponentState:e=>{this.hooks.hook("editComponentState",e)},getInspectorTree:e=>{this.hooks.hook("getInspectorTree",e)},getInspectorState:e=>{this.hooks.hook("getInspectorState",e)},editInspectorState:e=>{this.hooks.hook("editInspectorState",e)},inspectTimelineEvent:e=>{this.hooks.hook("inspectTimelineEvent",e)},timelineCleared:e=>{this.hooks.hook("timelineCleared",e)},setPluginSettings:e=>{this.hooks.hook("setPluginSettings",e)}}}notifyComponentUpdate(e){var t;if(cs.highPerfModeEnabled)return;const n=es().find(e=>e.packageName===this.plugin.descriptor.packageName);if(n?.id){if(e){const n=[e.appContext.app,e.uid,null==(t=e.parent)?void 0:t.uid,e];vs.callHook("component:updated",...n)}else vs.callHook("component:updated");this.hooks.callHook("sendInspectorState",{inspectorId:n.id,plugin:this.plugin})}}addInspector(e){this.hooks.callHook("addInspector",{inspector:e,plugin:this.plugin}),this.plugin.descriptor.settings&&function(e,t){const n=ps(e);localStorage.getItem(n)||localStorage.setItem(n,JSON.stringify(ds(t)))}(e.id,this.plugin.descriptor.settings)}sendInspectorTree(e){cs.highPerfModeEnabled||this.hooks.callHook("sendInspectorTree",{inspectorId:e,plugin:this.plugin})}sendInspectorState(e){cs.highPerfModeEnabled||this.hooks.callHook("sendInspectorState",{inspectorId:e,plugin:this.plugin})}selectInspectorNode(e,t){this.hooks.callHook("customInspectorSelectNode",{inspectorId:e,nodeId:t,plugin:this.plugin})}visitComponentTree(e){return this.hooks.callHook("visitComponentTree",e)}now(){return cs.highPerfModeEnabled?0:Date.now()}addTimelineLayer(e){this.hooks.callHook("timelineLayerAdded",{options:e,plugin:this.plugin})}addTimelineEvent(e){cs.highPerfModeEnabled||this.hooks.callHook("timelineEventAdded",{options:e,plugin:this.plugin})}getSettings(e){return fs(e??this.plugin.descriptor.id,this.plugin.descriptor.settings)}getComponentInstances(e){return this.hooks.callHook("getComponentInstances",{app:e})}getComponentBounds(e){return this.hooks.callHook("getComponentBounds",{instance:e})}getComponentName(e){return this.hooks.callHook("getComponentName",{instance:e})}highlightElement(e){const t=e.__VUE_DEVTOOLS_NEXT_UID__;return this.hooks.callHook("componentHighlight",{uid:t})}unhighlightElement(){return this.hooks.callHook("componentUnhighlight")}};or(),or(),or(),or();var Ts="__vue_devtool_undefined__",xs="__vue_devtool_infinity__",Es="__vue_devtool_negative_infinity__",Ps="__vue_devtool_nan__";or(),or();var As,Ms={[Ts]:"undefined",[Ps]:"NaN",[xs]:"Infinity",[Es]:"-Infinity"};function Ss(e,t){Ui.__VUE_DEVTOOLS_KIT__REGISTERED_PLUGIN_APPS__.has(e)||cs.highPerfModeEnabled&&!t?.inspectingComponent||(Ui.__VUE_DEVTOOLS_KIT__REGISTERED_PLUGIN_APPS__.add(e),hs.forEach(t=>{!function(e,t){const[n,i]=e;if(n.app!==t)return;const r=new ws({plugin:{setupFn:i,descriptor:n},ctx:zs});"vuex"===n.packageName&&r.on.editInspectorState(e=>{r.sendInspectorState(e.inspectorId)}),i(r)}(t,e)}))}Object.entries(Ms).reduce((e,[t,n])=>(e[n]=t,e),{}),or(),or(),or(),or(),or(),null!=(As=Ui).__VUE_DEVTOOLS_KIT__REGISTERED_PLUGIN_APPS__||(As.__VUE_DEVTOOLS_KIT__REGISTERED_PLUGIN_APPS__=new Set),or(),or();var Cs,Rs,Os,ks="__VUE_DEVTOOLS_ROUTER__",Ls="__VUE_DEVTOOLS_ROUTER_INFO__";function Is(e){return e.map(e=>{let{path:t,name:n,children:i,meta:r}=e;return i?.length&&(i=Is(i)),{path:t,name:n,children:i,meta:r}})}function Ds(e,t){function n(){var t;const n=null==(t=e.app)?void 0:t.config.globalProperties.$router,i=function(e){if(e){const{fullPath:t,hash:n,href:i,path:r,name:s,matched:o,params:a,query:l}=e;return{fullPath:t,hash:n,href:i,path:r,name:s,params:a,query:l,matched:Is(o)}}return e}(n?.currentRoute.value),r=Is(function(e){const t=new Map;return(e?.getRoutes()||[]).filter(e=>!t.has(e.path)&&t.set(e.path,1))}(n)),s=console.warn;console.warn=()=>{},Ui[Ls]={currentRoute:i?Bi(i):{},routes:Bi(r)},Ui[ks]=n,console.warn=s}n(),bs.on.componentUpdated(Hi(()=>{var i;(null==(i=t.value)?void 0:i.app)===e.app&&(n(),!cs.highPerfModeEnabled&&zs.hooks.callHook("routerInfoUpdated",{state:Ui[Ls]}))},200))}null!=(Cs=Ui)[Ls]||(Cs[Ls]={currentRoute:null,routes:[]}),null!=(Rs=Ui)[ks]||(Rs[ks]={}),new Proxy(Ui[Ls],{get:(e,t)=>Ui[Ls][t]}),new Proxy(Ui[ks],{get(e,t){if("value"===t)return Ui[ks]}}),or(),null!=(Os=Ui).__VUE_DEVTOOLS_ENV__||(Os.__VUE_DEVTOOLS_ENV__={vitePluginDetected:!1});var Fs,Us=function(){const e=Zi();e.hook("addInspector",({inspector:e,plugin:t})=>{!function(e,t){var n,i;Qr.push({options:e,descriptor:t,treeFilterPlaceholder:null!=(n=e.treeFilterPlaceholder)?n:"Search tree...",stateFilterPlaceholder:null!=(i=e.stateFilterPlaceholder)?i:"Search state...",treeFilter:"",selectedNodeId:"",appRecord:hr(t.app)}),Jr()}(e,t.descriptor)});const t=Hi(async({inspectorId:t,plugin:n})=>{var i;if(!t||null==(i=n?.descriptor)||!i.app||cs.highPerfModeEnabled)return;const r=ts(t,n.descriptor.app),s={app:n.descriptor.app,inspectorId:t,filter:r?.treeFilter||"",rootNodes:[]};await new Promise(t=>{e.callHookWith(async e=>{await Promise.all(e.map(e=>e(s))),t()},"getInspectorTree")}),e.callHookWith(async e=>{await Promise.all(e.map(e=>e({inspectorId:t,rootNodes:s.rootNodes})))},"sendInspectorTreeToClient")},120);e.hook("sendInspectorTree",t);const n=Hi(async({inspectorId:t,plugin:n})=>{var i;if(!t||null==(i=n?.descriptor)||!i.app||cs.highPerfModeEnabled)return;const r=ts(t,n.descriptor.app),s={app:n.descriptor.app,inspectorId:t,nodeId:r?.selectedNodeId||"",state:null},o={currentTab:`custom-inspector:${t}`};s.nodeId&&await new Promise(t=>{e.callHookWith(async e=>{await Promise.all(e.map(e=>e(s,o))),t()},"getInspectorState")}),e.callHookWith(async e=>{await Promise.all(e.map(e=>e({inspectorId:t,nodeId:s.nodeId,state:s.state})))},"sendInspectorStateToClient")},120);return e.hook("sendInspectorState",n),e.hook("customInspectorSelectNode",({inspectorId:e,nodeId:t,plugin:n})=>{const i=ts(e,n.descriptor.app);i&&(i.selectedNodeId=t)}),e.hook("timelineLayerAdded",({options:e,plugin:t})=>{!function(e,t){cs.timelineLayersState[t.id]=!1,Kr.push({...e,descriptorId:t.id,appRecord:hr(t.app)})}(e,t.descriptor)}),e.hook("timelineEventAdded",({options:t,plugin:n})=>{var i;cs.highPerfModeEnabled||(null==(i=cs.timelineLayersState)||!i[n.descriptor.id])&&!["performance","component-event","keyboard","mouse"].includes(t.layerId)||e.callHookWith(async e=>{await Promise.all(e.map(e=>e(t)))},"sendTimelineEventToClient")}),e.hook("getComponentInstances",async({app:e})=>{const t=e.__VUE_DEVTOOLS_NEXT_APP_RECORD__;if(!t)return null;const n=t.id.toString();return[...t.instanceMap].filter(([e])=>e.split(":")[0]===n).map(([,e])=>e)}),e.hook("getComponentBounds",async({instance:e})=>vr(e)),e.hook("getComponentName",({instance:e})=>pr(e)),e.hook("componentHighlight",({uid:e})=>{const t=os.value.instanceMap.get(e);t&&function(e){const t=vr(e);if(!t.width&&!t.height)return;const n=pr(e);Mr()?Rr({bounds:t,name:n}):Cr({bounds:t,name:n})}(t)}),e.hook("componentUnhighlight",()=>{Or()}),e}();null!=(Fs=Ui).__VUE_DEVTOOLS_KIT_CONTEXT__||(Fs.__VUE_DEVTOOLS_KIT_CONTEXT__={hooks:Us,get state(){return{...cs,activeAppRecordId:os.id,activeAppRecord:os.value,appRecords:ss.value}},api:function(e){return{async getInspectorTree(t){const n={...t,app:os.value.app,rootNodes:[]};return await new Promise(t=>{e.callHookWith(async e=>{await Promise.all(e.map(e=>e(n))),t()},"getInspectorTree")}),n.rootNodes},async getInspectorState(t){const n={...t,app:os.value.app,state:null},i={currentTab:`custom-inspector:${t.inspectorId}`};return await new Promise(t=>{e.callHookWith(async e=>{await Promise.all(e.map(e=>e(n,i))),t()},"getInspectorState")}),n.state},editInspectorState(t){const n=new Br,i={...t,app:os.value.app,set:(e,i=t.path,r=t.state.value,s)=>{n.set(e,i,r,s||n.createDefaultSetCallback(t.state))}};e.callHookWith(e=>{e.forEach(e=>e(i))},"editInspectorState")},sendInspectorState(t){const n=ts(t);e.callHook("sendInspectorState",{inspectorId:t,plugin:{descriptor:n.descriptor,setupFn:()=>({})}})},inspectComponentInspector:()=>Fr(),cancelInspectComponentInspector:()=>(Or(),window.removeEventListener("mouseover",Lr),window.removeEventListener("click",Dr,!0),void(Dr=null)),getComponentRenderCode(e){const t=mr(os.value,e);if(t)return"function"!=typeof t?.type?t.render.toString():t.type.toString()},scrollToComponent:e=>function(e){const t=mr(os.value,e.id);if(t){const[n]=yr(t);if("function"==typeof n.scrollIntoView)n.scrollIntoView({behavior:"smooth"});else{const e=vr(t),n=document.createElement("div"),i={...Sr(e),position:"absolute"};Object.assign(n.style,i),document.body.appendChild(n),n.scrollIntoView({behavior:"smooth"}),setTimeout(()=>{document.body.removeChild(n)},2e3)}setTimeout(()=>{const n=vr(t);if(n.width||n.height){const i=pr(t),r=Mr();r?Rr({...e,name:i,bounds:n}):Cr({...e,name:i,bounds:n}),setTimeout(()=>{r&&(r.style.display="none")},1500)}},1200)}}({id:e}),openInEditor:us,getVueInspector:Ur,toggleApp(e,t){const n=ss.value.find(t=>t.id===e);n&&(function(e){Ui.__VUE_DEVTOOLS_KIT_ACTIVE_APP_RECORD_ID__=e,as()}(e),function(e){Ui.__VUE_DEVTOOLS_KIT_ACTIVE_APP_RECORD__=e,as()}(n),Ds(n,os),Jr(),Ss(n.app,t))},inspectDOM(e){const t=mr(os.value,e);if(t){const[e]=yr(t);e&&(Ui.__VUE_DEVTOOLS_INSPECT_DOM_TARGET__=e)}},updatePluginSettings(e,t,n){!function(e,t,n){const i=ps(e),r=localStorage.getItem(i),s=JSON.parse(r||"{}"),o={...s,[t]:n};localStorage.setItem(i,JSON.stringify(o)),zs.hooks.callHookWith(i=>{i.forEach(i=>i({pluginId:e,key:t,oldValue:s[t],newValue:n,settings:o}))},"setPluginSettings")}(e,t,n)},getPluginSettings:e=>({options:ms(e),values:fs(e)})}}(Us)});var Ns,js,zs=Ui.__VUE_DEVTOOLS_KIT_CONTEXT__;or(),((e,t,n)=>{n=null!=e?Ji(ir(e)):{},((e,t,n,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of nr(t))!rr.call(e,r)&&r!==n&&er(e,r,{get:()=>t[r],enumerable:!(i=tr(t,r))||i.enumerable})})(er(n,"default",{value:e,enumerable:!0}),e)})(lr()),null!=(Ns=Ui).__VUE_DEVTOOLS_NEXT_APP_RECORD_INFO__||(Ns.__VUE_DEVTOOLS_NEXT_APP_RECORD_INFO__={id:0,appIds:new Set}),or(),or(),or(),or(),or(),null!=(js=Ui).__VUE_DEVTOOLS_UPDATE_CLIENT_DETECTED__||(js.__VUE_DEVTOOLS_UPDATE_CLIENT_DETECTED__=function(e){cs.devtoolsClientDetected={...cs.devtoolsClientDetected,...e},function(e){cs.highPerfModeEnabled=e??!cs.highPerfModeEnabled,!e&&os.value&&Ss(os.value.app)}(!Object.values(cs.devtoolsClientDetected).some(Boolean))}),or(),or(),or(),or(),or(),or(),or();var Bs=class{constructor(){this.keyToValue=new Map,this.valueToKey=new Map}set(e,t){this.keyToValue.set(e,t),this.valueToKey.set(t,e)}getByKey(e){return this.keyToValue.get(e)}getByValue(e){return this.valueToKey.get(e)}clear(){this.keyToValue.clear(),this.valueToKey.clear()}},Vs=class{constructor(e){this.generateIdentifier=e,this.kv=new Bs}register(e,t){this.kv.getByValue(e)||(t||(t=this.generateIdentifier(e)),this.kv.set(t,e))}clear(){this.kv.clear()}getIdentifier(e){return this.kv.getByValue(e)}getValue(e){return this.kv.getByKey(e)}},Hs=class extends Vs{constructor(){super(e=>e.name),this.classToAllowedProps=new Map}register(e,t){"object"==typeof t?(t.allowProps&&this.classToAllowedProps.set(e,t.allowProps),super.register(e,t.identifier)):super.register(e,t)}getAllowedProps(e){return this.classToAllowedProps.get(e)}};function Gs(e,t){const n=function(e){if("values"in Object)return Object.values(e);const t=[];for(const n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}(e);if("find"in n)return n.find(t);const i=n;for(let r=0;r<i.length;r++){const e=i[r];if(t(e))return e}}function Ws(e,t){Object.entries(e).forEach(([e,n])=>t(n,e))}function Ks(e,t){return-1!==e.indexOf(t)}function Xs(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(t(i))return i}}or(),or();var qs=class{constructor(){this.transfomers={}}register(e){this.transfomers[e.name]=e}findApplicable(e){return Gs(this.transfomers,t=>t.isApplicable(e))}findByName(e){return this.transfomers[e]}};or(),or();var Ys=e=>typeof e>"u",$s=e=>"object"==typeof e&&null!==e&&e!==Object.prototype&&(null===Object.getPrototypeOf(e)||Object.getPrototypeOf(e)===Object.prototype),Zs=e=>$s(e)&&0===Object.keys(e).length,Qs=e=>Array.isArray(e),Js=e=>e instanceof Map,eo=e=>e instanceof Set,to=e=>"Symbol"===(e=>Object.prototype.toString.call(e).slice(8,-1))(e),no=e=>"number"==typeof e&&isNaN(e),io=e=>(e=>"boolean"==typeof e)(e)||(e=>null===e)(e)||Ys(e)||(e=>"number"==typeof e&&!isNaN(e))(e)||(e=>"string"==typeof e)(e)||to(e);or();var ro=e=>e.replace(/\./g,"\\."),so=e=>e.map(String).map(ro).join("."),oo=e=>{const t=[];let n="";for(let r=0;r<e.length;r++){let i=e.charAt(r);"\\"!==i||"."!==e.charAt(r+1)?"."!==i?n+=i:(t.push(n),n=""):(n+=".",r++)}const i=n;return t.push(i),t};function ao(e,t,n,i){return{isApplicable:e,annotation:t,transform:n,untransform:i}}or();var lo=[ao(Ys,"undefined",()=>null,()=>{}),ao(e=>"bigint"==typeof e,"bigint",e=>e.toString(),e=>typeof BigInt<"u"?BigInt(e):(console.error("Please add a BigInt polyfill."),e)),ao(e=>e instanceof Date&&!isNaN(e.valueOf()),"Date",e=>e.toISOString(),e=>new Date(e)),ao(e=>e instanceof Error,"Error",(e,t)=>{const n={name:e.name,message:e.message};return t.allowedErrorProps.forEach(t=>{n[t]=e[t]}),n},(e,t)=>{const n=new Error(e.message);return n.name=e.name,n.stack=e.stack,t.allowedErrorProps.forEach(t=>{n[t]=e[t]}),n}),ao(e=>e instanceof RegExp,"regexp",e=>""+e,e=>{const t=e.slice(1,e.lastIndexOf("/")),n=e.slice(e.lastIndexOf("/")+1);return new RegExp(t,n)}),ao(eo,"set",e=>[...e.values()],e=>new Set(e)),ao(Js,"map",e=>[...e.entries()],e=>new Map(e)),ao(e=>no(e)||(e=>e===1/0||e===-1/0)(e),"number",e=>no(e)?"NaN":e>0?"Infinity":"-Infinity",Number),ao(e=>0===e&&1/e==-1/0,"number",()=>"-0",Number),ao(e=>e instanceof URL,"URL",e=>e.toString(),e=>new URL(e))];function co(e,t,n,i){return{isApplicable:e,annotation:t,transform:n,untransform:i}}var uo=co((e,t)=>!!to(e)&&!!t.symbolRegistry.getIdentifier(e),(e,t)=>["symbol",t.symbolRegistry.getIdentifier(e)],e=>e.description,(e,t,n)=>{const i=n.symbolRegistry.getValue(t[1]);if(!i)throw new Error("Trying to deserialize unknown symbol");return i}),ho=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,Uint8ClampedArray].reduce((e,t)=>(e[t.name]=t,e),{}),po=co(e=>ArrayBuffer.isView(e)&&!(e instanceof DataView),e=>["typed-array",e.constructor.name],e=>[...e],(e,t)=>{const n=ho[t[1]];if(!n)throw new Error("Trying to deserialize unknown typed array");return new n(e)});function mo(e,t){return!!e?.constructor&&!!t.classRegistry.getIdentifier(e.constructor)}var fo=co(mo,(e,t)=>["class",t.classRegistry.getIdentifier(e.constructor)],(e,t)=>{const n=t.classRegistry.getAllowedProps(e.constructor);if(!n)return{...e};const i={};return n.forEach(t=>{i[t]=e[t]}),i},(e,t,n)=>{const i=n.classRegistry.getValue(t[1]);if(!i)throw new Error(`Trying to deserialize unknown class '${t[1]}' - check https://github.com/blitz-js/superjson/issues/116#issuecomment-773996564`);return Object.assign(Object.create(i.prototype),e)}),go=co((e,t)=>!!t.customTransformerRegistry.findApplicable(e),(e,t)=>["custom",t.customTransformerRegistry.findApplicable(e).name],(e,t)=>t.customTransformerRegistry.findApplicable(e).serialize(e),(e,t,n)=>{const i=n.customTransformerRegistry.findByName(t[1]);if(!i)throw new Error("Trying to deserialize unknown custom value");return i.deserialize(e)}),_o=[fo,uo,go,po],vo=(e,t)=>{const n=Xs(_o,n=>n.isApplicable(e,t));if(n)return{value:n.transform(e,t),type:n.annotation(e,t)};const i=Xs(lo,n=>n.isApplicable(e,t));return i?{value:i.transform(e,t),type:i.annotation}:void 0},yo={};lo.forEach(e=>{yo[e.annotation]=e});or();var bo=(e,t)=>{if(t>e.size)throw new Error("index out of bounds");const n=e.keys();for(;t>0;)n.next(),t--;return n.next().value};function wo(e){if(Ks(e,"__proto__"))throw new Error("__proto__ is not allowed as a property");if(Ks(e,"prototype"))throw new Error("prototype is not allowed as a property");if(Ks(e,"constructor"))throw new Error("constructor is not allowed as a property")}var To=(e,t,n)=>{if(wo(t),0===t.length)return n(e);let i=e;for(let s=0;s<t.length-1;s++){const e=t[s];if(Qs(i)){i=i[+e]}else if($s(i))i=i[e];else if(eo(i)){i=bo(i,+e)}else if(Js(i)){if(s===t.length-2)break;const n=+e,r=0==+t[++s]?"key":"value",o=bo(i,n);switch(r){case"key":i=o;break;case"value":i=i.get(o)}}}const r=t[t.length-1];if(Qs(i)?i[+r]=n(i[+r]):$s(i)&&(i[r]=n(i[r])),eo(i)){const e=bo(i,+r),t=n(e);e!==t&&(i.delete(e),i.add(t))}if(Js(i)){const e=+t[t.length-2],s=bo(i,e);switch(0==+r?"key":"value"){case"key":{const e=n(s);i.set(e,i.get(s)),e!==s&&i.delete(s);break}case"value":i.set(s,n(i.get(s)))}}return e};function xo(e,t,n=[]){if(!e)return;if(!Qs(e))return void Ws(e,(e,i)=>xo(e,t,[...n,...oo(i)]));const[i,r]=e;r&&Ws(r,(e,i)=>{xo(e,t,[...n,...oo(i)])}),t(i,n)}function Eo(e,t,n){return xo(t,(t,i)=>{e=To(e,i,e=>((e,t,n)=>{if(!Qs(t)){const i=yo[t];if(!i)throw new Error("Unknown transformation: "+t);return i.untransform(e,n)}switch(t[0]){case"symbol":return uo.untransform(e,t,n);case"class":return fo.untransform(e,t,n);case"custom":return go.untransform(e,t,n);case"typed-array":return po.untransform(e,t,n);default:throw new Error("Unknown transformation: "+t)}})(e,t,n))}),e}function Po(e,t){function n(t,n){const i=((e,t)=>{wo(t);for(let n=0;n<t.length;n++){const i=t[n];if(eo(e))e=bo(e,+i);else if(Js(e)){const r=+i,s=0==+t[++n]?"key":"value",o=bo(e,r);switch(s){case"key":e=o;break;case"value":e=e.get(o)}}else e=e[i]}return e})(e,oo(n));t.map(oo).forEach(t=>{e=To(e,t,()=>i)})}if(Qs(t)){const[i,r]=t;i.forEach(t=>{e=To(e,oo(t),()=>e)}),r&&Ws(r,n)}else Ws(t,n);return e}var Ao=(e,t,n,i,r=[],s=[],o=new Map)=>{var a;const l=io(e);if(!l){!function(e,t,n){const i=n.get(e);i?i.push(t):n.set(e,[t])}(e,r,t);const n=o.get(e);if(n)return i?{transformedValue:null}:n}if(!((e,t)=>$s(e)||Qs(e)||Js(e)||eo(e)||mo(e,t))(e,n)){const t=vo(e,n),i=t?{transformedValue:t.value,annotations:[t.type]}:{transformedValue:e};return l||o.set(e,i),i}if(Ks(s,e))return{transformedValue:null};const c=vo(e,n),u=null!=(a=c?.value)?a:e,h=Qs(u)?[]:{},d={};Ws(u,(a,l)=>{if("__proto__"===l||"constructor"===l||"prototype"===l)throw new Error(`Detected property ${l}. This is a prototype pollution risk, please remove it from your object.`);const c=Ao(a,t,n,i,[...r,l],[...s,e],o);h[l]=c.transformedValue,Qs(c.annotations)?d[l]=c.annotations:$s(c.annotations)&&Ws(c.annotations,(e,t)=>{d[ro(l)+"."+t]=e})});const p=Zs(d)?{transformedValue:h,annotations:c?[c.type]:void 0}:{transformedValue:h,annotations:c?[c.type,d]:d};return l||o.set(e,p),p};function Mo(e){return Object.prototype.toString.call(e).slice(8,-1)}function So(e){return"Array"===Mo(e)}function Co(e,t={}){if(So(e))return e.map(e=>Co(e,t));if(!function(e){if("Object"!==Mo(e))return!1;const t=Object.getPrototypeOf(e);return!!t&&t.constructor===Object&&t===Object.prototype}(e))return e;return[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)].reduce((n,i)=>{if(So(t.props)&&!t.props.includes(i))return n;return function(e,t,n,i,r){const s={}.propertyIsEnumerable.call(i,t)?"enumerable":"nonenumerable";"enumerable"===s&&(e[t]=n),r&&"nonenumerable"===s&&Object.defineProperty(e,t,{value:n,enumerable:!1,writable:!0,configurable:!0})}(n,i,Co(e[i],t),e,t.nonenumerable),n},{})}or(),or();var Ro,Oo,ko,Lo,Io,Do,Fo=class{constructor({dedupe:e=!1}={}){this.classRegistry=new Hs,this.symbolRegistry=new Vs(e=>{var t;return null!=(t=e.description)?t:""}),this.customTransformerRegistry=new qs,this.allowedErrorProps=[],this.dedupe=e}serialize(e){const t=new Map,n=Ao(e,t,this,this.dedupe),i={json:n.transformedValue};n.annotations&&(i.meta={...i.meta,values:n.annotations});const r=function(e,t){const n={};let i;return e.forEach(e=>{if(e.length<=1)return;t||(e=e.map(e=>e.map(String)).sort((e,t)=>e.length-t.length));const[r,...s]=e;0===r.length?i=s.map(so):n[so(r)]=s.map(so)}),i?Zs(n)?[i]:[i,n]:Zs(n)?void 0:n}(t,this.dedupe);return r&&(i.meta={...i.meta,referentialEqualities:r}),i}deserialize(e){const{json:t,meta:n}=e;let i=Co(t);return n?.values&&(i=Eo(i,n.values,this)),n?.referentialEqualities&&(i=Po(i,n.referentialEqualities)),i}stringify(e){return JSON.stringify(this.serialize(e))}parse(e){return this.deserialize(JSON.parse(e))}registerClass(e,t){this.classRegistry.register(e,t)}registerSymbol(e,t){this.symbolRegistry.register(e,t)}registerCustom(e,t){this.customTransformerRegistry.register({name:t,...e})}allowErrorProps(...e){this.allowedErrorProps.push(...e)}};function Uo(e,t){throw new Error(e+t)}function No(e){let t=0;return e.traverse(e=>{if(Zt(e)&&"HightlightMesh"!==e.type){const n=e.geometry,i=3*n.attributes.position.count*Float32Array.BYTES_PER_ELEMENT,r=n.index?n.index.count*Uint32Array.BYTES_PER_ELEMENT:0,s=n.attributes.normal?3*n.attributes.normal.count*Float32Array.BYTES_PER_ELEMENT:0,o=n.attributes.uv?2*n.attributes.uv.count*Float32Array.BYTES_PER_ELEMENT:0;t+=i+r+s+o}}),t}function jo(e,t,n){e.push(t),e.length>n&&e.shift()}function zo(e){return(e/1024).toFixed(2)}function Bo(e){if(!e)return;typeof window<"u"&&!window.__TRES__DEVTOOLS__&&(window.__TRES__DEVTOOLS__=new Ei);const t={maxFrames:160,fps:{value:0,accumulator:[]},memory:{currentMem:0,allocatedMem:0,accumulator:[]}},n=function(e){var t;const n=K(0);if("undefined"==typeof performance)return n;const i=null!=(t=null==e?void 0:e.every)?t:10;let r=performance.now(),s=0;return Ee(()=>{if(s+=1,s>=i){const e=performance.now(),t=e-r;n.value=Math.round(1e3/(t/s)),r=e,s=0}}),n}({every:100}),{isSupported:i,memory:r}=Re({interval:100});let s=performance.now(),o=0;const{pause:a}=Ee(({delta:a})=>{window.__TRES__DEVTOOLS__&&((({timestamp:o})=>{e.scene.value&&(t.memory.allocatedMem=No(e.scene.value)),o-s>=100&&(s=o,jo(t.fps.accumulator,n.value,160),t.fps.value=n.value,i.value&&r.value?.usedJSHeapSize&&(jo(t.memory.accumulator,r.value.usedJSHeapSize/1024/1024,160),t.memory.accumulator.length>0&&(t.memory.currentMem=t.memory.accumulator.reduce((e,t)=>e+t,0)/t.memory.accumulator.length)))})({timestamp:performance.now()}),o+=a,o>=1&&(window.__TRES__DEVTOOLS__.send("context",e),window.__TRES__DEVTOOLS__.send("performance",t),o=0))},{immediate:!0});Ie(()=>{a()})}Fo.defaultInstance=new Fo,Fo.serialize=Fo.defaultInstance.serialize.bind(Fo.defaultInstance),Fo.deserialize=Fo.defaultInstance.deserialize.bind(Fo.defaultInstance),Fo.stringify=Fo.defaultInstance.stringify.bind(Fo.defaultInstance),Fo.parse=Fo.defaultInstance.parse.bind(Fo.defaultInstance),Fo.registerClass=Fo.defaultInstance.registerClass.bind(Fo.defaultInstance),Fo.registerSymbol=Fo.defaultInstance.registerSymbol.bind(Fo.defaultInstance),Fo.registerCustom=Fo.defaultInstance.registerCustom.bind(Fo.defaultInstance),Fo.allowErrorProps=Fo.defaultInstance.allowErrorProps.bind(Fo.defaultInstance),or(),or(),or(),or(),or(),or(),or(),or(),or(),or(),or(),or(),or(),or(),or(),or(),or(),or(),or(),or(),or(),or(),or(),null!=(Ro=Ui).__VUE_DEVTOOLS_KIT_MESSAGE_CHANNELS__||(Ro.__VUE_DEVTOOLS_KIT_MESSAGE_CHANNELS__=[]),null!=(Oo=Ui).__VUE_DEVTOOLS_KIT_RPC_CLIENT__||(Oo.__VUE_DEVTOOLS_KIT_RPC_CLIENT__=null),null!=(ko=Ui).__VUE_DEVTOOLS_KIT_RPC_SERVER__||(ko.__VUE_DEVTOOLS_KIT_RPC_SERVER__=null),null!=(Lo=Ui).__VUE_DEVTOOLS_KIT_VITE_RPC_CLIENT__||(Lo.__VUE_DEVTOOLS_KIT_VITE_RPC_CLIENT__=null),null!=(Io=Ui).__VUE_DEVTOOLS_KIT_VITE_RPC_SERVER__||(Io.__VUE_DEVTOOLS_KIT_VITE_RPC_SERVER__=null),null!=(Do=Ui).__VUE_DEVTOOLS_KIT_BROADCAST_RPC_SERVER__||(Do.__VUE_DEVTOOLS_KIT_BROADCAST_RPC_SERVER__=null),or(),or(),or(),or(),or(),or(),or();const Vo=(e,t)=>{if(e.uuid===t)return e;for(const n of e.children){const e=Vo(n,t);if(e)return e}};let Ho=class extends tt.Mesh{type="HightlightMesh";createTime;constructor(...e){super(...e),this.createTime=Date.now()}onBeforeRender(){const e=(Date.now()-this.createTime)/1e3,t=1+.07*Math.sin(2.5*e);this.scale.set(t,t,t)}};const Go=e=>{const t={id:`scene-${e.uuid}`,label:e.type,children:[],tags:[]};""!==e.name&&t.tags.push({label:e.name,textColor:5750629,backgroundColor:15793395});const n=No(e);return n>0&&t.tags.push({label:`${zo(n)} KB`,textColor:15707189,backgroundColor:16775644,tooltip:"Memory usage"}),e.type.includes("Light")&&(on(e)&&t.tags.push({label:`${e.intensity}`,textColor:9738662,backgroundColor:16316922,tooltip:"Intensity"}),t.tags.push({label:`#${new Et(e.color).getHexString()}`,textColor:9738662,backgroundColor:16316922,tooltip:"Color"})),e.type.includes("Camera")&&(t.tags.push({label:`${e.fov}°`,textColor:9738662,backgroundColor:16316922,tooltip:"Field of view"}),t.tags.push({label:`x: ${Math.round(e.position.x)} y: ${Math.round(e.position.y)} z: ${Math.round(e.position.z)}`,textColor:9738662,backgroundColor:16316922,tooltip:"Position"})),t};function Wo(e,t,n=""){e.children.forEach(e=>{if("HightlightMesh"===e.type||n&&!e.type.includes(n)&&!e.name.includes(n))return;const i=Go(e);t.children.push(i),Wo(e,i,n)})}function Ko(e,t,n=new WeakSet,i=0,r=4,s,o=""){if(i>=r||!e||n.has(e))return;const a=0===i?e?.scene?.value?.uuid||Math.random().toString(36).slice(2,11):s;n.add(e),Object.entries(e).forEach(([e,s])=>{if(e.startsWith("_")||"function"==typeof s)return;const l=o?`${o}.${e}`:e,c=function(e,t,n=""){return{id:`context-${t}-${n?`${n}.${e}`:e}`,label:e,children:[],tags:[]}}(e,a,o);"scene"!==e&&(He(s)?(c.tags.push({label:`Ref<${typeof s.value}>`,textColor:4372611,backgroundColor:15793395}),s.value&&"object"==typeof s.value?Ko(s.value,c,n,i+1,r,a,l):c.label=`${e}: ${JSON.stringify(s.value)}`):s&&"object"==typeof s&&!Array.isArray(s)?Object.keys(s).length>0?n.has(s)?c.tags.push({label:"Circular",textColor:16711680,backgroundColor:16773360}):Ko(s,c,n,i+1,r,a,l):c.label=`${e}: {}`:Array.isArray(s)?(c.label=`${e}: Array(${s.length})`,c.tags.push({label:`length: ${s.length}`,textColor:9738662,backgroundColor:16316922})):c.label=`${e}: ${JSON.stringify(s)}`,t.children.push(c))})}const Xo=e=>t=>{if(t.inspectorId===Yo){const n=Go(e.scene.value);Wo(e.scene.value,n,t.filter);const i={id:"context-root",label:"Context",children:[],tags:[]};Ko(e,i),t.rootNodes=[n,i]}},qo=e=>t=>{if(t.inspectorId===Yo&&t.nodeId.includes("scene")){const n=t.nodeId.match(/^scene-(.+)$/),i=n?n[1]:null;if(!i)return;((e,t,n,i)=>{const r=Vo(e,t);if(!r)return void console.warn("Object with UUID not found in the scene.");let s=r;for(let a=0;a<n.length-1;a++){if(void 0===s[n[a]])return void console.warn(`Property path is not valid: ${n.join(".")}`);s=s[n[a]]}const o=n[n.length-1];void 0!==s[o]?s[o]=i:console.warn(`Property path is not valid: ${n.join(".")}`)})(e.scene.value,i,t.path,t.state.value)}},Yo="tres:inspector";function $o(e,t){const n={id:"dev.esm.tres",label:"TresJS 🪐",logo:"https://raw.githubusercontent.com/Tresjs/tres/main/public/favicon.svg",packageName:"tresjs",homepage:"https://docs.tresjs.org",app:e};Bo(t),function(e,t){bs.setupDevToolsPlugin(e,t)}(n,e=>{"function"!=typeof e.now&&function(e,t){const n=`▲ ■ ●${e}`;Uo(n,t)}("You seem to be using an outdated version of Vue Devtools. Are you still using the Beta release instead of the stable one? You can find the links at https://devtools.vuejs.org/guide/installation.html."),e.addInspector({id:Yo,label:"TresJS 🪐",icon:"account_tree",treeFilterPlaceholder:"Search instances"}),setInterval(()=>{e.sendInspectorTree(Yo)},1e3),setInterval(()=>{e.notifyComponentUpdate()},5e3),e.on.getInspectorTree(Xo(t)),e.on.getInspectorState(((e,{highlightMesh:t,prevInstance:n})=>i=>{if(i.inspectorId!==Yo)return;const r=new Tt({color:11003607,transparent:!0,opacity:.2,depthTest:!1,side:xt});if(i.nodeId.includes("scene")){const s=i.nodeId.match(/^scene-(.+)$/),o=s?s[1]:null;if(!o)return;const[a]=e.scene.value.getObjectsByProperty("uuid",o);if(!a)return;if(n&&t&&t.parent&&n.remove(t),Zt(a)){const e=new Ho(a.geometry.clone(),r);a.add(e),t=e,n=a}if(i.state={object:Object.entries(a).map(([e,t])=>"children"===e?{key:e,value:t.filter(e=>"HightlightMesh"!==e.type)}:{key:e,value:t,editable:!0}).filter(({key:e})=>"parent"!==e)},ln(a)){const t={...i.state,state:[{key:"Scene Info",value:{objects:a.children.length,memory:No(a),calls:e.renderer.instance.info.render.calls,triangles:e.renderer.instance.info.render.triangles,points:e.renderer.instance.info.render.points,lines:e.renderer.instance.info.render.lines}}]};"programs"in e.renderer.instance.info&&t.state.push({key:"Programs",value:e.renderer.instance.info.programs?.map(e=>({...e,programName:e.name}))}),i.state=t}}else if(i.nodeId.includes("context")){const t=i.nodeId.match(/^context-([^-]+(?:-[^-]+)*)-(.+)$/),n=t?t[2]:"context";if(!n||"context"===n)return void(i.state={object:Object.entries(e).filter(([e])=>!e.startsWith("_")&&"parent"!==e).map(([e,t])=>({key:e,value:He(t)?t.value:t,editable:!1}))});const r=n.split(".");let s=e;for(const e of r){if(!s||"object"!=typeof s)break;s=He(s[e])?s[e].value:s[e]}void 0!==s&&(i.state={object:Object.entries(s).filter(([e])=>!e.startsWith("_")&&"parent"!==e).map(([e,t])=>He(t)?{key:e,value:t.value,editable:!1}:"function"==typeof t?{key:e,value:"ƒ()",editable:!1}:t&&"object"==typeof t?{key:e,value:Array.isArray(t)?`Array(${t.length})`:"Object",editable:!1}:{key:e,value:t,editable:!1})})}})(t,{highlightMesh:null,prevInstance:null})),e.on.editInspectorState(qo(t))})}const Zo=["data-scene","data-tres"],Qo=De({__name:"TresCanvas",props:{camera:{},windowSize:{type:Boolean,default:void 0},enableProvideBridge:{type:Boolean,default:!0},antialias:{type:Boolean,default:!0},stencil:{type:Boolean,default:void 0},depth:{type:Boolean,default:void 0},precision:{},logarithmicDepthBuffer:{type:Boolean,default:void 0},preserveDrawingBuffer:{type:Boolean,default:void 0},powerPreference:{},alpha:{type:Boolean,default:void 0},premultipliedAlpha:{type:Boolean},failIfMajorPerformanceCaveat:{type:Boolean,default:void 0},clearColor:{default:"#000000"},clearAlpha:{default:1},shadows:{type:Boolean,default:void 0},toneMapping:{default:At},shadowMapType:{default:Pt},useLegacyLights:{type:Boolean,default:void 0},outputColorSpace:{},toneMappingExposure:{},renderMode:{default:"always"},dpr:{},renderer:{}},emits:["ready","pointermissed","render","beforeLoop","loop","click","contextmenu","pointermove","pointerenter","pointerleave","pointerover","pointerout","dblclick","pointerdown","pointerup","pointercancel","lostpointercapture","wheel"],setup(e,{expose:t,emit:n}){const i=e,r=n,s=Ge(),o=Ne(),a=Ve(new it),l=We();An(tt);const c=(e,t=!1)=>{const n=((e,t=!1)=>De({setup(){const n=We()?.appContext;n&&(n.app=l?.appContext.app);const r={};return l?.parent&&i.enableProvideBridge&&(function e(t){t&&(t.parent&&e(t.parent),t.provides&&Object.assign(r,t.provides))}(l.parent),Reflect.ownKeys(r).forEach(e=>{Je(e,r[e])})),Je("useTres",e),Je("extend",An),typeof window<"u"&&n?.app&&$o(n?.app,e),()=>Qe(et,null,t?[]:s.default())}}))(e,t),{render:r}=Ze(Ti(e));r(Qe(n),a.value)},u=(e,t=!1)=>{gn(e.scene.value),t&&(e.renderer.instance.dispose(),e.renderer.instance instanceof ot&&(e.renderer.instance.renderLists.dispose(),e.renderer.instance.forceContextLoss())),a.value.__tres={root:e}},h=Ve(null);t({context:h,dispose:()=>u(h.value,!0)});return Ke(()=>{const e=o;h.value=mi({scene:a.value,canvas:e,windowSize:i.windowSize??!1,rendererOptions:i});const{camera:t,renderer:n}=h.value,{registerCamera:s,cameras:l,activeCamera:u,deregisterCamera:d}=t;c(h.value);h.value.events.onPointerMissed(e=>{r("pointermissed",e)}),Le(()=>i.camera,(e,t)=>{e&&s(ke(e),!0),t&&(ke(t).removeFromParent(),d(ke(t)))},{immediate:!0}),u.value||(()=>{const e=new Mt(45,window.innerWidth/window.innerHeight,.1,1e3);e.position.set(3,3,3),e.lookAt(0,0,0),s(e);const t=ze(()=>{l.value.length>=2&&(e.removeFromParent(),d(e),t?.())})})(),n.onRender(()=>{h.value&&r("render",h.value)}),n.loop.onLoop(e=>{h.value&&r("loop",{...h.value,...e})}),n.loop.onBeforeLoop(e=>{h.value&&r("beforeLoop",{...h.value,...e})}),n.onReady(()=>{r("ready",h.value)})}),Ke(async()=>{await D(3e3),h.value&&(!h.value.sizes.width||!h.value.sizes.height.value)&&console.warn("TresCanvas: The canvas has no area, so nothing can be rendered. Set it manually on the parent element or use the prop windowSize.")}),Ie(()=>{u(h.value),c(h.value,!0)}),(e,t)=>(qe(),Xe("canvas",{ref_key:"canvasRef",ref:o,"data-scene":a.value.uuid,class:$e(e.$attrs.class),"data-tres":`tresjs ${Ue(Nt).version}`,style:Ye({display:"block",width:"100%",height:"100%",position:e.windowSize?"fixed":"relative",top:0,left:0,pointerEvents:"auto",touchAction:"none",...e.$attrs.style})},null,14,Zo))}}),{defineComponent:Jo,useSlots:ea,watch:ta,onMounted:na,onUnmounted:ia,createElementBlock:ra,openBlock:sa,unref:oa,render:aa,watchEffect:la,createBlock:ca,withCtx:ua,createElementVNode:ha,shallowRef:da,ref:pa,createCommentVNode:ma,inject:fa,renderSlot:ga,provide:_a,computed:va,Fragment:ya,markRaw:ba,onBeforeUnmount:wa,mergeProps:Ta,createVNode:xa,normalizeProps:Ea,guardReactiveProps:Pa,mergeModels:Aa,useModel:Ma,reactive:Sa}=await e("vue"),Ca=await e("three"),{Object3D:Ra,Vector2:Oa,Vector3:ka,Matrix4:La,MathUtils:Ia,Quaternion:Da,Ray:Fa,Group:Ua,PointsMaterial:Na,TextureLoader:ja,BufferGeometry:za,Float32BufferAttribute:Ba,Points:Va,Color:Ha,LineBasicMaterial:Ga,Line:Wa,CurvePath:Ka,LineCurve3:Xa,TubeGeometry:qa,MeshBasicMaterial:Ya,DoubleSide:$a,Mesh:Za,BufferAttribute:Qa,Euler:Ja,TrianglesDrawMode:el,TriangleFanDrawMode:tl,TriangleStripDrawMode:nl,Loader:il,LoaderUtils:rl,FileLoader:sl,MeshPhysicalMaterial:ol,LinearSRGBColorSpace:al,SRGBColorSpace:ll,SpotLight:cl,PointLight:ul,DirectionalLight:hl,InstancedMesh:dl,InstancedBufferAttribute:pl,ImageBitmapLoader:ml,InterleavedBuffer:fl,InterleavedBufferAttribute:gl,LinearMipmapLinearFilter:_l,NearestMipmapLinearFilter:vl,LinearMipmapNearestFilter:yl,NearestMipmapNearestFilter:bl,LinearFilter:wl,NearestFilter:Tl,RepeatWrapping:xl,MirroredRepeatWrapping:El,ClampToEdgeWrapping:Pl,Material:Al,MeshStandardMaterial:Ml,PropertyBinding:Sl,SkinnedMesh:Cl,LineSegments:Rl,LineLoop:Ol,PerspectiveCamera:kl,OrthographicCamera:Ll,Skeleton:Il,AnimationClip:Dl,Bone:Fl,InterpolateDiscrete:Ul,InterpolateLinear:Nl,Texture:jl,VectorKeyframeTrack:zl,NumberKeyframeTrack:Bl,QuaternionKeyframeTrack:Vl,ColorManagement:Hl,FrontSide:Gl,Interpolant:Wl,Box3:Kl,Sphere:Xl,DefaultLoadingManager:ql,Spherical:Yl,Plane:$l,Frustum:Zl,Matrix3:Ql,LoadingManager:Jl,EventDispatcher:ec,PlaneGeometry:tc,ShaderMaterial:nc,Raycaster:ic,Clock:rc,RGFormat:sc,UnsignedByteType:oc,DataTexture:ac,EdgesGeometry:lc,BoxGeometry:cc,Box3Helper:uc,REVISION:hc,Controls:dc,MOUSE:pc,TOUCH:mc}=await e("three");class fc extends Ra{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Oa(.5,.5),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof e.element.ownerDocument.defaultView.Element&&null!==e.element.parentNode&&e.element.remove()})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const gc=new ka,_c=new La,vc=new La,yc=new ka,bc=new ka;class wc{constructor(e={}){const t=this;let n,i,r,s;const o={objects:new WeakMap},a=void 0!==e.element?e.element:document.createElement("div");function l(e){e.isCSS2DObject&&(e.element.style.display="none");for(let t=0,n=e.children.length;t<n;t++)l(e.children[t])}function c(e,n,i){if(!1!==e.visible){if(e.isCSS2DObject){gc.setFromMatrixPosition(e.matrixWorld),gc.applyMatrix4(vc);const l=gc.z>=-1&&gc.z<=1&&!0===e.layers.test(i.layers),c=e.element;c.style.display=!0===l?"":"none",!0===l&&(e.onBeforeRender(t,n,i),c.style.transform="translate("+-100*e.center.x+"%,"+-100*e.center.y+"%)translate("+(gc.x*r+r)+"px,"+(-gc.y*s+s)+"px)",c.parentNode!==a&&a.appendChild(c),e.onAfterRender(t,n,i));const h={distanceToCameraSquared:u(i,e)};o.objects.set(e,h)}for(let t=0,r=e.children.length;t<r;t++)c(e.children[t],n,i)}else l(e)}function u(e,t){return yc.setFromMatrixPosition(e.matrixWorld),bc.setFromMatrixPosition(t.matrixWorld),yc.distanceToSquared(bc)}a.style.overflow="hidden",this.domElement=a,this.getSize=function(){return{width:n,height:i}},this.render=function(e,t){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),_c.copy(t.matrixWorldInverse),vc.multiplyMatrices(t.projectionMatrix,_c),c(e,e,t),function(e){const t=function(e){const t=[];return e.traverseVisible(function(e){e.isCSS2DObject&&t.push(e)}),t}(e).sort(function(e,t){if(e.renderOrder!==t.renderOrder)return t.renderOrder-e.renderOrder;return o.objects.get(e).distanceToCameraSquared-o.objects.get(t).distanceToCameraSquared}),n=t.length;for(let i=0,r=t.length;i<r;i++)t[i].element.style.zIndex=n-i}(e)},this.setSize=function(e,t){n=e,i=t,r=n/2,s=i/2,a.style.width=e+"px",a.style.height=t+"px"}}}function Tc(e,t){if(!e)throw new Error("Invariant failed")}const xc=new ka;function Ec(e,t,n=new ka,i){const{x:r,y:s,z:o}=e,a=t.x,l=t.y,c=t.z,u=r*r*a,h=s*s*l,d=o*o*c,p=u+h+d,m=Math.sqrt(1/p);if(!Number.isFinite(m))return;const f=xc.copy(e).multiplyScalar(m);if(p<(i?.centerTolerance??.1))return n.copy(f);const g=f.multiply(t).multiplyScalar(2);let _,v,y,b,w=(1-m)*e.length()/(g.length()/2),T=0;do{w-=T,_=1/(1+w*a),v=1/(1+w*l),y=1/(1+w*c);const e=_*_,t=v*v,n=y*y;b=u*e+h*t+d*n-1,T=b/(-2*(u*(e*_)*a+h*(t*v)*l+d*(n*y)*c))}while(Math.abs(b)>1e-12);return n.set(r*_,s*v,o*y)}const Pc=new ka,Ac=new ka,Mc=new ka;let Sc=class e{static WGS84=new e(6378137,6378137,6356752.314245179);radii;constructor(e,t,n){this.radii=new ka(e,t,n)}get minimumRadius(){return Math.min(this.radii.x,this.radii.y,this.radii.z)}get maximumRadius(){return Math.max(this.radii.x,this.radii.y,this.radii.z)}reciprocalRadii(e=new ka){const{x:t,y:n,z:i}=this.radii;return e.set(1/t,1/n,1/i)}reciprocalRadiiSquared(e=new ka){const{x:t,y:n,z:i}=this.radii;return e.set(1/t**2,1/n**2,1/i**2)}projectOnSurface(e,t=new ka,n){return Ec(e,this.reciprocalRadiiSquared(),t,n)}getSurfaceNormal(e,t=new ka){return t.multiplyVectors(this.reciprocalRadiiSquared(Pc),e).normalize()}getEastNorthUpVectors(e,t=new ka,n=new ka,i=new ka){this.getSurfaceNormal(e,i),t.set(-e.y,e.x,0).normalize(),n.crossVectors(i,t).normalize()}getEastNorthUpFrame(e,t=new La){const n=Pc,i=Ac,r=Mc;return this.getEastNorthUpVectors(e,n,i,r),t.makeBasis(n,i,r).setPosition(e)}getIntersection(e,t=new ka){const n=this.reciprocalRadii(Pc),i=Ac.copy(n).multiply(e.origin),r=Mc.copy(n).multiply(e.direction),s=i.lengthSq(),o=r.lengthSq(),a=i.dot(r),l=a**2-o*(s-1);if(1===s)return t.copy(e.origin);if(s>1){if(a>=0||l<0)return;const n=Math.sqrt(l),i=(-a-n)/o,r=(-a+n)/o;return e.at(Math.min(i,r),t)}if(s<1){const n=a**2-o*(s-1),i=(-a+Math.sqrt(n))/o;return e.at(i,t)}return a<0?e.at(-a/o,t):void 0}getOsculatingSphereCenter(e,t,n=new ka){Tc(this.radii.x===this.radii.y);const i=this.radii.x**2,r=this.radii.z**2,s=Pc.set(e.x/i,e.y/i,e.z/r).normalize();return n.copy(s.multiplyScalar(-t).add(e))}getNormalAtHorizon(e,t,n=new ka){Tc(this.radii.x===this.radii.y);const i=this.radii.x**2,r=this.radii.z**2,s=e,o=t;let a=(s.x*o.x+s.y*o.y)/i+s.z*o.z/r;a/=(s.x**2+s.y**2)/i+s.z**2/r;const l=Pc.copy(o).multiplyScalar(-a).add(e);return n.set(l.x/i,l.y/i,l.z/r).normalize()}};const Cc=new ka,Rc=new ka;class Oc{constructor(e=0,t=0,n=0){this.longitude=e,this.latitude=t,this.height=n}static MIN_LONGITUDE=-Math.PI;static MAX_LONGITUDE=Math.PI;static MIN_LATITUDE=-Math.PI/2;static MAX_LATITUDE=Math.PI/2;set(e,t,n){return this.longitude=e,this.latitude=t,null!=n&&(this.height=n),this}clone(){return new Oc(this.longitude,this.latitude,this.height)}copy(e){return this.longitude=e.longitude,this.latitude=e.latitude,this.height=e.height,this}equals(e){return e.longitude===this.longitude&&e.latitude===this.latitude&&e.height===this.height}setLongitude(e){return this.longitude=e,this}setLatitude(e){return this.latitude=e,this}setHeight(e){return this.height=e,this}normalize(){return this.longitude<Oc.MIN_LONGITUDE&&(this.longitude+=2*Math.PI),this}setFromECEF(e,t){const n=(t?.ellipsoid??Sc.WGS84).reciprocalRadiiSquared(Cc),i=Ec(e,n,Rc,t);if(null==i)throw new Error(`Could not project position to ellipsoid surface: ${e.toArray()}`);const r=Cc.multiplyVectors(i,n).normalize();this.longitude=Math.atan2(r.y,r.x),this.latitude=Math.asin(r.z);const s=Cc.subVectors(e,i);return this.height=Math.sign(s.dot(e))*s.length(),this}toECEF(e=new ka,t){const n=t?.ellipsoid??Sc.WGS84,i=Cc.multiplyVectors(n.radii,n.radii),r=Math.cos(this.latitude),s=Rc.set(r*Math.cos(this.longitude),r*Math.sin(this.longitude),Math.sin(this.latitude)).normalize();return e.multiplyVectors(i,s),e.divideScalar(Math.sqrt(s.dot(e))).add(s.multiplyScalar(this.height))}fromArray(e,t=0){return this.longitude=e[t],this.latitude=e[t+1],this.height=e[t+2],this}toArray(e=[],t=0){return e[t]=this.longitude,e[t+1]=this.latitude,e[t+2]=this.height,e}*[Symbol.iterator](){yield this.longitude,yield this.latitude,yield this.height}}const kc=1e-6,Lc=new ka,Ic=new ka,Dc=new ka,Fc=new ka,Uc=new ka,Nc=new ka,jc=new La,zc=new Da,Bc=new Fa;class Vc{_distance;heading;_pitch;roll;constructor(e=0,t=0,n=0,i=0){this.distance=e,this.heading=t,this.pitch=n,this.roll=i}get distance(){return this._distance}set distance(e){this._distance=Math.max(e,kc)}get pitch(){return this._pitch}set pitch(e){this._pitch=Ia.clamp(e,-Math.PI/2+kc,Math.PI/2-kc)}set(e,t,n,i){return this.distance=e,this.heading=t,this.pitch=n,null!=i&&(this.roll=i),this}clone(){return new Vc(this.distance,this.heading,this.pitch,this.roll)}copy(e){return this.distance=e.distance,this.heading=e.heading,this.pitch=e.pitch,this.roll=e.roll,this}equals(e){return e.distance===this.distance&&e.heading===this.heading&&e.pitch===this.pitch&&e.roll===this.roll}decompose(e,t,n,i,r=Sc.WGS84){r.getEastNorthUpVectors(e,Lc,Ic,Dc),i?.copy(Dc);const s=Fc.copy(Lc).multiplyScalar(Math.cos(this.heading)).add(Uc.copy(Ic).multiplyScalar(Math.sin(this.heading))).multiplyScalar(Math.cos(this.pitch)).add(Uc.copy(Dc).multiplyScalar(Math.sin(this.pitch))).normalize().multiplyScalar(this.distance);if(t.copy(e).sub(s),0!==this.roll){const n=Fc.copy(e).sub(t).normalize();Dc.applyQuaternion(zc.setFromAxisAngle(n,this.roll))}n.setFromRotationMatrix(jc.lookAt(t,e,Dc))}setFromCamera(e,t=Sc.WGS84){const n=Fc.setFromMatrixPosition(e.matrixWorld),i=Uc.set(0,0,.5).unproject(e).sub(n).normalize(),r=t.getIntersection(Bc.set(n,i));if(null==r)return;this.distance=n.distanceTo(r),t.getEastNorthUpVectors(r,Lc,Ic,Dc),this.heading=Math.atan2(Ic.dot(i),Lc.dot(i)),this.pitch=Math.asin(Dc.dot(i));const s=Fc.copy(e.up).applyQuaternion(e.quaternion),o=Nc.copy(i).multiplyScalar(-s.dot(i)).add(s).normalize(),a=Fc.copy(i).multiplyScalar(-Dc.dot(i)).add(Dc).normalize(),l=a.dot(o),c=i.dot(a.cross(o));return this.roll=Math.atan2(c,l),this}}const Hc=Ia.degToRad,Gc=Ia.radToDeg,Wc=(e,t,n)=>new Oc(Hc(e),Hc(t),n).toECEF(),Kc=new Vc,Xc=new Oc,qc=new ka,Yc=new ka,$c=new Fa,Zc=Sc.WGS84;function Qc(e,t,n){const i=n=>i=>{const r=[{...i,index:0},t,0];e(n,...r)};return{click:i("click"),doubleclick:i("doubleclick"),contextmenu:i("contextmenu"),pointerenter:i("pointerenter"),pointerleave:i("pointerleave"),pointerover:i("pointerover"),pointerdown:i("pointerdown"),pointerup:i("pointerup"),wheel:i("wheel")}}function Jc(e,t){e.removeEventListener("click",t.click),e.removeEventListener("dblclick",t.doubleclick),e.removeEventListener("contextmenu",t.contextmenu),e.removeEventListener("pointerenter",t.pointerenter),e.removeEventListener("pointerleave",t.pointerleave),e.removeEventListener("pointerover",t.pointerover),e.removeEventListener("pointerdown",t.pointerdown),e.removeEventListener("pointerup",t.pointerup),e.removeEventListener("wheel",t.wheel)}const eu=["object"],tu=Jo({__name:"GeoCSS2D",props:{point:{},renderOrder:{default:1},id:{}},emits:["click","doubleclick","contextmenu","pointerenter","pointerleave","pointerover","pointerdown","pointerup","wheel"],setup(e,{expose:t,emit:n}){const i=document.createElement("div"),r=e,s=ea(),o=n,a=()=>{aa(s.default()[0],i)},l=new fc(i),c=new Ua;c.layers.enableAll(),c.add(l),l.layers.set(1),l.renderOrder=r.renderOrder;const u=()=>{const e=Wc(r.point.lon,r.point.lat,r.point.height);l.position.copy(e)},h=Qc(o,r);return ta([()=>r.point.lon,()=>r.point.lat,()=>r.point.height],()=>{u()}),na(()=>{u(),a(),i.addEventListener("click",h.click),i.addEventListener("dblclick",h.doubleclick),i.addEventListener("contextmenu",h.contextmenu),i.addEventListener("pointerenter",h.pointerenter),i.addEventListener("pointerleave",h.pointerleave),i.addEventListener("pointerover",h.pointerover),i.addEventListener("pointerdown",h.pointerdown),i.addEventListener("pointerup",h.pointerup),i.addEventListener("wheel",h.wheel)}),ia(()=>{Jc(i,h),c.clear()}),t({update:a}),(e,t)=>(sa(),ra("primitive",{object:oa(c)},null,8,eu))}}),nu=["object"],iu=Jo({__name:"GeoText",props:{point:{},fontSize:{default:16},color:{default:"#333"},text:{},renderOrder:{default:1},align:{default:"left"},id:{}},emits:["click","doubleclick","contextmenu","pointerenter","pointerleave","pointerover","pointerdown","pointerup","wheel"],setup(e,{emit:t}){const n=document.createElement("div"),i=e,r=t,s=()=>{switch(n.innerText=i.text,n.style.fontSize=i.fontSize+"px",n.style.color=i.color,n.style.pointerEvents="auto",n.style.userSelect="none",i.align){case"center":n.style.transform="translateX(-50%)",n.style.textAlign="center";break;case"right":n.style.transform="translateX(-100%)",n.style.textAlign="right";break;default:n.style.transform="translateX(0)",n.style.textAlign="left"}},o=new fc(n);o.renderOrder=i.renderOrder;const a=Qc(r,i);return na(()=>{s(),n.addEventListener("click",a.click),n.addEventListener("dblclick",a.doubleclick),n.addEventListener("contextmenu",a.contextmenu),n.addEventListener("pointerenter",a.pointerenter),n.addEventListener("pointerleave",a.pointerleave),n.addEventListener("pointerover",a.pointerover),n.addEventListener("pointerdown",a.pointerdown),n.addEventListener("pointerup",a.pointerup),n.addEventListener("wheel",a.wheel)}),la(()=>{s()}),ia(()=>{Jc(n,a),n.remove()}),(e,t)=>(sa(),ca(oa(yh),{point:i.point},{default:ua(()=>[ha("primitive",{object:oa(o)},null,8,nu)]),_:1},8,["point"]))}}),ru=["object"],su=Jo({__name:"GeoIcon",props:{point:{},size:{},icon:{},renderOrder:{default:1},id:{}},emits:["click","doubleclick","contextmenu","pointerenter","pointerleave","pointerover","pointerdown","pointerup","wheel"],setup(e,{emit:t}){const n=document.createElement("img"),i=e,r=t,s=()=>{n.src=i.icon,n.style.width=i.size+"px",n.style.height=i.size+"px",n.style.left="0",n.style.top="0",n.style.pointerEvents="all"},o=new fc(n);o.renderOrder=i.renderOrder;const a=Qc(r,i);return na(()=>{s(),n.addEventListener("click",a.click),n.addEventListener("dblclick",a.doubleclick),n.addEventListener("contextmenu",a.contextmenu),n.addEventListener("pointerenter",a.pointerenter),n.addEventListener("pointerleave",a.pointerleave),n.addEventListener("pointerover",a.pointerover),n.addEventListener("pointerdown",a.pointerdown),n.addEventListener("pointerup",a.pointerup),n.addEventListener("wheel",a.wheel)}),la(()=>{s()}),ia(()=>{Jc(n,a),n.remove()}),(e,t)=>(sa(),ca(oa(yh),{point:i.point},{default:ua(()=>[ha("primitive",{object:oa(o)},null,8,ru)]),_:1},8,["point"]))}}),ou=["object"],au=Jo({__name:"GeoParticle",props:{points:{},size:{},icon:{},color:{},renderOrder:{default:1},raycastActive:{type:Boolean},raycastMultiplier:{default:1},sizeAttenuation:{type:Boolean,default:!0}},emits:["click","doubleclick","contextmenu","pointerenter","pointerleave","pointerover","pointerdown","pointerup","wheel"],setup(e,{emit:t}){const n=e,i=t,r=da(),s=pa([]),o=pa(new ka),a=e=>{const t=e.raycast;e.raycast=function(e,i){const r=e.params.Points?.threshold||1;e.params.Points?e.params.Points.threshold=r*n.raycastMultiplier:e.params.Points={threshold:r*n.raycastMultiplier};const s=t.call(this,e,i);return e.params.Points.threshold=r,s}},l=()=>{if(r.value){const e=r.value.geometry,t=e.getAttribute("position"),i=e.getAttribute("color");s.value=n.points.map(e=>Wc(e.lon,e.lat,e.height||0)),o.value=(e=>{if(0===e.length)return new ka;const t=new ka;return e.forEach(e=>t.add(e)),t.divideScalar(e.length),t})(s.value),((e,t)=>e.map(e=>e.clone().sub(t)))(s.value,o.value).forEach((e,r)=>{t.setXYZ(r,e.x,e.y,e.z);const s=n.points[r].color||n.color||"#ffffff",o=new Ha(s);i.setXYZ(r,o.r,o.g,o.b)}),t.needsUpdate=!0,i.needsUpdate=!0,r.value.position.copy(o.value)}};ta(()=>n.points,()=>{l()},{immediate:!0}),ta(()=>n.size,()=>{r.value&&(r.value.material.size=n.size||32,r.value.material.needsUpdate=!0)}),ta(()=>n.raycastMultiplier,e=>{r.value&&a(r.value)});const c=e=>t=>{if(r.value&&n.raycastActive&&void 0!==t.index&&t.index<n.points.length){const r=n.points[t.index];i(e,t,r,t.index)}},u=c("click"),h=c("doubleclick"),d=c("contextmenu"),p=c("pointerenter"),m=c("pointerleave"),f=c("pointerover"),g=c("pointerdown"),_=c("pointerup"),v=c("wheel");return na(()=>{(()=>{const e=new Na({size:n.size||32,transparent:!0,sizeAttenuation:n.sizeAttenuation,vertexColors:!0});if(n.icon){const t=(new ja).load(n.icon);e.map=t,e.needsUpdate=!0}const t=new za,i=new Float32Array(3*n.points.length),s=new Float32Array(3*n.points.length);t.setAttribute("position",new Ba(i,3)),t.setAttribute("color",new Ba(s,3)),r.value=new Va(t,e),r.value.renderOrder=n.renderOrder,a(r.value)})(),l()}),ia(()=>{if(r.value){r.value.geometry.dispose();const e=r.value.material;e.map?.dispose(),e.dispose()}}),(e,t)=>r.value?(sa(),ra("primitive",{key:0,object:r.value,onClick:t[0]||(t[0]=(...e)=>oa(u)&&oa(u)(...e)),onDoubleclick:t[1]||(t[1]=(...e)=>oa(h)&&oa(h)(...e)),onContextmenu:t[2]||(t[2]=(...e)=>oa(d)&&oa(d)(...e)),onPointerenter:t[3]||(t[3]=(...e)=>oa(p)&&oa(p)(...e)),onPointerleave:t[4]||(t[4]=(...e)=>oa(m)&&oa(m)(...e)),onPointerover:t[5]||(t[5]=(...e)=>oa(f)&&oa(f)(...e)),onPointerdown:t[6]||(t[6]=(...e)=>oa(g)&&oa(g)(...e)),onPointerup:t[7]||(t[7]=(...e)=>oa(_)&&oa(_)(...e)),onWheel:t[8]||(t[8]=(...e)=>oa(v)&&oa(v)(...e))},null,40,ou)):ma("",!0)}}),lu=["object"],cu=Jo({__name:"GeoPoint",props:{point:{},color:{},size:{},icon:{},renderOrder:{default:1},raycastActive:{type:Boolean},raycastMultiplier:{default:1},sizeAttenuation:{type:Boolean,default:!0},id:{}},emits:["click","doubleclick","contextmenu","pointerenter","pointerleave","pointerover","pointerdown","pointerup","wheel"],setup(e,{emit:t}){const n=e,i=t,r=da(),s=e=>{const t=e.raycast;e.raycast=function(e,i){const r=e.params.Points?.threshold||1;e.params.Points?e.params.Points.threshold=r*n.raycastMultiplier:e.params.Points={threshold:r*n.raycastMultiplier};const s=t.call(this,e,i);return e.params.Points.threshold=r,s}};ta(()=>n.size,e=>{r.value&&(r.value.material.size=e||32,r.value.material.needsUpdate=!0)});const o=e=>t=>{!r.value||!n.raycastActive||void 0!==t.index&&i(e,t,n,0)},a=o("click"),l=o("doubleclick"),c=o("contextmenu"),u=o("pointerenter"),h=o("pointerleave"),d=o("pointerover"),p=o("pointerdown"),m=o("pointerup"),f=o("wheel");return na(()=>{const e=new za;e.setAttribute("position",new Ba([0,0,0],3));const t=new Na({size:n.size||32,transparent:!0,sizeAttenuation:n.sizeAttenuation,color:n.color||"#ffffff"});if(n.icon){const e=new ja;t.map=e.load(n.icon),t.needsUpdate=!0}r.value=new Va(e,t),r.value.renderOrder=n.renderOrder,s(r.value)}),ia(()=>{if(r.value){r.value.geometry.dispose();const e=r.value.material;e.map?.dispose(),e.dispose()}}),(e,t)=>(sa(),ca(oa(yh),{point:n.point},{default:ua(()=>[r.value?(sa(),ra("primitive",{key:0,object:r.value,onClick:t[0]||(t[0]=(...e)=>oa(a)&&oa(a)(...e)),onDoubleclick:t[1]||(t[1]=(...e)=>oa(l)&&oa(l)(...e)),onContextmenu:t[2]||(t[2]=(...e)=>oa(c)&&oa(c)(...e)),onPointerenter:t[3]||(t[3]=(...e)=>oa(u)&&oa(u)(...e)),onPointerleave:t[4]||(t[4]=(...e)=>oa(h)&&oa(h)(...e)),onPointerover:t[5]||(t[5]=(...e)=>oa(d)&&oa(d)(...e)),onPointerdown:t[6]||(t[6]=(...e)=>oa(p)&&oa(p)(...e)),onPointerup:t[7]||(t[7]=(...e)=>oa(m)&&oa(m)(...e)),onWheel:t[8]||(t[8]=(...e)=>oa(f)&&oa(f)(...e))},null,40,lu)):ma("",!0)]),_:1},8,["point"]))}}),uu=e=>{if(0===e.length)return new ka;const t=new ka;return e.forEach(e=>t.add(e)),t.divideScalar(e.length),t},hu=(e,t)=>e.map(e=>e.clone().sub(t)),du=e=>e.map(e=>Wc(e.lon,e.lat,e.height||0)),pu=(e,t,n=!0,i)=>{const r=i=>r=>{if(!n)return;const s=void 0!==r.index?r.index:0;e(i,r,t,s)};return{handleClick:r("click"),handleDoubleClick:r("doubleclick"),handleContextMenu:r("contextmenu"),handlePointerEnter:r("pointerenter"),handlePointerLeave:r("pointerleave"),handlePointerOver:r("pointerover"),handlePointerDown:r("pointerdown"),handlePointerUp:r("pointerup"),handleWheel:r("wheel")}},mu=(e,t=1)=>{if(!e||!e.raycast)return;const n=e.raycast;e.raycast=function(i,r){const s=i.params.Points?.threshold||1;i.params.Points?i.params.Points.threshold=s*t:"Points"===e.type&&(i.params.Points={threshold:s*t});const o=n.call(this,i,r);return i.params.Points&&(i.params.Points.threshold=s),o}},fu=["object"],gu=Jo({__name:"GeoTubeline",props:{points:{},color:{},width:{},tubularSegments:{},map:{},renderOrder:{default:1},opacity:{default:1},repeat:{default:()=>[1,1]},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","doubleclick","contextmenu","pointerenter","pointerleave","pointerover","pointerdown","pointerup","wheel"],setup(e,{emit:t}){const n=e,i=t,r=da(),s=da(),o=pa([]),a=pa(new ka),l=pu(i,n,n.raycastActive),c=fa("registerAnimationTarget"),u=fa("unregisterAnimationTarget"),h=()=>.3*(n.width||2),d=()=>{if(s.value){s.value.geometry.dispose(),o.value=du(n.points),a.value=uu(o.value);const e=hu(o.value,a.value),t=new Ka;for(let n=0;n<e.length-1;n++){const i=new Xa(e[n],e[n+1]);t.add(i)}const i=new qa(t,n.tubularSegments||64,h(),8,!1);s.value.geometry=i,r.value.position.copy(a.value)}};return ta(()=>n.points,()=>{d()},{immediate:!0}),ta(()=>n.color,e=>{s.value&&(s.value.material.color.set(e||"#ffffff"),s.value.material.needsUpdate=!0)}),ta(()=>n.opacity,e=>{s.value&&(s.value.material.opacity=void 0!==e?e:1,s.value.material.needsUpdate=!0)}),ta(()=>n.repeat,e=>{s.value&&s.value.material.map&&e&&e.length>=2&&(s.value.material.map.repeat.set(e[0],e[1]),s.value.material.map.needsUpdate=!0)},{deep:!0}),ta(()=>[n.width,n.tubularSegments],()=>{d()}),ta(()=>n.map,e=>{s.value&&(e?(s.value.material.map=e,n.repeat&&n.repeat.length>=2&&(e.repeat.set(n.repeat[0],n.repeat[1]),e.needsUpdate=!0),s.value.material.needsUpdate=!0,c&&c(s.value,"texture",e)):(s.value.material.map=null,s.value.material.needsUpdate=!0,c&&c(s.value,"texture",void 0)))}),na(()=>{(()=>{r.value=new Ua,o.value=du(n.points),a.value=uu(o.value);const e=hu(o.value,a.value),t=new Ka;for(let n=0;n<e.length-1;n++){const i=new Xa(e[n],e[n+1]);t.add(i)}const i=new qa(t,n.tubularSegments||64,h(),8,!1),l={color:n.color||"#ffffff",transparent:!0,side:$a,opacity:void 0!==n.opacity?n.opacity:1};n.map&&(l.map=n.map,n.repeat&&n.repeat.length>=2&&(n.map.repeat.set(n.repeat[0],n.repeat[1]),n.map.needsUpdate=!0));const u=new Ya(l);s.value=new Za(i,u),s.value.renderOrder=n.renderOrder,n.raycastActive&&mu(s.value,n.raycastMultiplier),r.value.add(s.value),r.value.position.copy(a.value),c&&c(s.value,"texture",n.map)})()}),ia(()=>{s.value&&(u&&u(s.value),s.value.geometry.dispose(),s.value.material.dispose()),r.value&&r.value.clear()}),(e,t)=>r.value?(sa(),ra("primitive",{key:0,object:r.value,onClick:t[0]||(t[0]=(...e)=>oa(l).handleClick&&oa(l).handleClick(...e)),onDoubleclick:t[1]||(t[1]=(...e)=>oa(l).handleDoubleClick&&oa(l).handleDoubleClick(...e)),onContextmenu:t[2]||(t[2]=(...e)=>oa(l).handleContextMenu&&oa(l).handleContextMenu(...e)),onPointerenter:t[3]||(t[3]=(...e)=>oa(l).handlePointerEnter&&oa(l).handlePointerEnter(...e)),onPointerleave:t[4]||(t[4]=(...e)=>oa(l).handlePointerLeave&&oa(l).handlePointerLeave(...e)),onPointerover:t[5]||(t[5]=(...e)=>oa(l).handlePointerOver&&oa(l).handlePointerOver(...e)),onPointerdown:t[6]||(t[6]=(...e)=>oa(l).handlePointerDown&&oa(l).handlePointerDown(...e)),onPointerup:t[7]||(t[7]=(...e)=>oa(l).handlePointerUp&&oa(l).handlePointerUp(...e)),onWheel:t[8]||(t[8]=(...e)=>oa(l).handleWheel&&oa(l).handleWheel(...e))},null,40,fu)):ma("",!0)}});class _u extends Ca.BufferGeometry{constructor(){super(),this.isMeshLine=!0,this.type="MeshLine",this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this._points=[],this._geom=null,this.widthCallback=null,this.matrixWorld=new Ca.Matrix4,Object.defineProperties(this,{geometry:{enumerable:!0,get:function(){return this}},geom:{enumerable:!0,get:function(){return this._geom},set:function(e){this.setGeometry(e,this.widthCallback)}},points:{enumerable:!0,get:function(){return this._points},set:function(e){this.setPoints(e,this.widthCallback)}}})}}function vu(e,t,n,i,r){var s;if(e=e.subarray||e.slice?e:e.buffer,n=n.subarray||n.slice?n:n.buffer,e=t?e.subarray?e.subarray(t,r&&t+r):e.slice(t,r&&t+r):e,n.set)n.set(e,i);else for(s=0;s<e.length;s++)n[s+i]=e[s];return n}_u.prototype.setMatrixWorld=function(e){this.matrixWorld=e},_u.prototype.setGeometry=function(e,t){this._geometry=e,this.setPoints(e.getAttribute("position").array,t)},_u.prototype.setPoints=function(e,t){if(e instanceof Float32Array||e instanceof Array){if(this._points=e,this.widthCallback=t,this.positions=[],this.counters=[],e.length&&e[0]instanceof Ca.Vector3)for(var n=0;n<e.length;n++){var i=e[n],r=n/e.length;this.positions.push(i.x,i.y,i.z),this.positions.push(i.x,i.y,i.z),this.counters.push(r),this.counters.push(r)}else for(n=0;n<e.length;n+=3){r=n/e.length;this.positions.push(e[n],e[n+1],e[n+2]),this.positions.push(e[n],e[n+1],e[n+2]),this.counters.push(r),this.counters.push(r)}this.process()}else console.error("ERROR: The BufferArray of points is not instancied correctly.")},_u.prototype.raycast=function(e,t){var n=new Ca.Matrix4,i=new Ca.Ray,r=new Ca.Sphere,s=new Ca.Vector3,o=this.geometry;if(o.boundingSphere||o.computeBoundingSphere(),r.copy(o.boundingSphere),r.applyMatrix4(this.matrixWorld),!1!==e.ray.intersectSphere(r,s)){n.copy(this.matrixWorld).invert(),i.copy(e.ray).applyMatrix4(n);var a=new Ca.Vector3,l=new Ca.Vector3,c=new Ca.Vector3,u=this instanceof Ca.LineSegments?2:1,h=o.index,d=o.attributes;if(null!==h)for(var p=h.array,m=d.position.array,f=d.width.array,g=0,_=p.length-1;g<_;g+=u){var v=p[g],y=p[g+1];a.fromArray(m,3*v),l.fromArray(m,3*y);var b=void 0!==f[Math.floor(g/3)]?f[Math.floor(g/3)]:1,w=e.params.Line.threshold+this.material.lineWidth*b/2,T=w*w;if(!(i.distanceSqToSegment(a,l,s,c)>T)){s.applyMatrix4(this.matrixWorld);var x=e.ray.origin.distanceTo(s);x<e.near||x>e.far||(t.push({distance:x,point:c.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}),g=_)}}}},_u.prototype.compareV3=function(e,t){var n=6*e,i=6*t;return this.positions[n]===this.positions[i]&&this.positions[n+1]===this.positions[i+1]&&this.positions[n+2]===this.positions[i+2]},_u.prototype.copyV3=function(e){var t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]},_u.prototype.process=function(){var e,t,n=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],t=this.compareV3(0,n-1)?this.copyV3(n-2):this.copyV3(0),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);for(var i=0;i<n;i++){if(this.side.push(1),this.side.push(-1),e=this.widthCallback?this.widthCallback(i/(n-1)):1,this.width.push(e),this.width.push(e),this.uvs.push(i/(n-1),0),this.uvs.push(i/(n-1),1),i<n-1){t=this.copyV3(i),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);var r=2*i;this.indices_array.push(r,r+1,r+2),this.indices_array.push(r+2,r+1,r+3)}i>0&&(t=this.copyV3(i),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]))}t=this.compareV3(n-1,0)?this.copyV3(1):this.copyV3(n-1),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]),this._attributes&&this._attributes.position.count===this.positions.length?(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0):this._attributes={position:new Ca.BufferAttribute(new Float32Array(this.positions),3),previous:new Ca.BufferAttribute(new Float32Array(this.previous),3),next:new Ca.BufferAttribute(new Float32Array(this.next),3),side:new Ca.BufferAttribute(new Float32Array(this.side),1),width:new Ca.BufferAttribute(new Float32Array(this.width),1),uv:new Ca.BufferAttribute(new Float32Array(this.uvs),2),index:new Ca.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new Ca.BufferAttribute(new Float32Array(this.counters),1)},this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox(),this._geometry.attributes=this.attributes,this._geometry.index=this.index,this._geometry.computeBoundingSphere(),this._geometry.computeBoundingBox()},_u.prototype.advance=function(e){var t=this._attributes.position.array,n=this._attributes.previous.array,i=this._attributes.next.array,r=t.length;vu(t,0,n,0,r),vu(t,6,t,0,r-6),t[r-6]=e.x,t[r-5]=e.y,t[r-4]=e.z,t[r-3]=e.x,t[r-2]=e.y,t[r-1]=e.z,vu(t,6,i,0,r-6),i[r-6]=e.x,i[r-5]=e.y,i[r-4]=e.z,i[r-3]=e.x,i[r-2]=e.y,i[r-1]=e.z,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0},Ca.ShaderChunk.meshline_vert=["",Ca.ShaderChunk.logdepthbuf_pars_vertex,Ca.ShaderChunk.fog_pars_vertex,"","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute float counters;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float near;","uniform float far;","uniform float sizeAttenuation;","uniform vec2 offset;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","\t vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","    float pixelWidthRatio = 1. / (resolution.x * projectionMatrix[0][0]);","","    vColor = vec4( color, opacity );","    vUV = uv + offset;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float pixelWidth = finalPosition.w * pixelWidthRatio;","    float w = 1.8 * pixelWidth * lineWidth * width;","","    if( sizeAttenuation == 1. ) {","        w = 1.8 * lineWidth * width;","    }","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec2 normal = vec2( -dir.y, dir.x );","    normal.x /= aspect;","    normal *= .5 * w;","","    vec4 offset = vec4( normal * side, 0.0, 1.0 );","    finalPosition.xy += offset.xy;","","    gl_Position = finalPosition;","",Ca.ShaderChunk.logdepthbuf_vertex,Ca.ShaderChunk.fog_vertex&&"    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",Ca.ShaderChunk.fog_vertex,"}"].join("\r\n"),Ca.ShaderChunk.meshline_frag=["",Ca.ShaderChunk.fog_pars_fragment,Ca.ShaderChunk.logdepthbuf_pars_fragment,"","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform float dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","void main() {","",Ca.ShaderChunk.logdepthbuf_fragment,"","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","    if( c.a < alphaTest ) discard;","    if( useDash == 1. ){","        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));","    }","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","",Ca.ShaderChunk.fog_fragment,"}"].join("\r\n");class yu extends Ca.ShaderMaterial{constructor(e){super({uniforms:Object.assign({},Ca.UniformsLib.fog,{lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new Ca.Color(16777215)},opacity:{value:1},resolution:{value:new Ca.Vector2(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new Ca.Vector2(1,1)},offset:{value:new Ca.Vector2(1,1)}}),depthWrite:void 0===e.depthWrite||e.depthWrite,depthTest:void 0===e.depthTest||e.depthTest,transparent:void 0===e.transparent||e.transparent,vertexShader:Ca.ShaderChunk.meshline_vert,fragmentShader:Ca.ShaderChunk.meshline_frag}),this.isMeshLineMaterial=!0,this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(e){this.uniforms.lineWidth.value=e}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(e){this.uniforms.map.value=e}},useMap:{enumerable:!0,get:function(){return this.uniforms.useMap.value},set:function(e){this.uniforms.useMap.value=e}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(e){this.uniforms.alphaMap.value=e}},useAlphaMap:{enumerable:!0,get:function(){return this.uniforms.useAlphaMap.value},set:function(e){this.uniforms.useAlphaMap.value=e}},color:{enumerable:!0,get:function(){return this.uniforms.color.value},set:function(e){this.uniforms.color.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(e){this.uniforms.sizeAttenuation.value=e}},dashArray:{enumerable:!0,get:function(){return this.uniforms.dashArray.value},set:function(e){this.uniforms.dashArray.value=e,this.useDash=0!==e?1:0}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},dashRatio:{enumerable:!0,get:function(){return this.uniforms.dashRatio.value},set:function(e){this.uniforms.dashRatio.value=e}},useDash:{enumerable:!0,get:function(){return this.uniforms.useDash.value},set:function(e){this.uniforms.useDash.value=e}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(e){this.uniforms.visibility.value=e}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(e){this.uniforms.alphaTest.value=e}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(e){this.uniforms.repeat.value.copy(e)}},offset:{enumerable:!0,get:function(){return this.uniforms.offset.value},set:function(e){this.uniforms.offset.value.copy(e)}}}),this.setValues(e)}}yu.prototype.copy=function(e){return Ca.ShaderMaterial.prototype.copy.call(this,e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.dashArray.copy(e.dashArray),this.dashOffset.copy(e.dashOffset),this.dashRatio.copy(e.dashRatio),this.useDash=e.useDash,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this};const bu=["object"],wu=Jo({__name:"GeoMeshline",props:{points:{},color:{},width:{},sizeAttenuation:{type:Boolean,default:!0},dashArray:{},dashRatio:{},dashOffset:{},map:{},renderOrder:{default:1},opacity:{default:1},repeat:{default:()=>[1,1]},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","doubleclick","contextmenu","pointerenter","pointerleave","pointerover","pointerdown","pointerup","wheel"],setup(e,{emit:t}){const n=e,i=t,r=da(),s=da(),o=da(),a=pa([]),l=pa(new ka),c=pu(i,n,n.raycastActive),u=fa("registerAnimationTarget"),h=fa("unregisterAnimationTarget"),d=e=>{const t=new za,n=new Float32Array(3*e.length);return e.forEach((e,t)=>{n[3*t]=e.x,n[3*t+1]=e.y,n[3*t+2]=e.z}),t.setAttribute("position",new Qa(n,3)),t};ta(()=>n.repeat,e=>{if(o.value&&o.value.material){const t=o.value.material;t.uniforms.repeat.value.set(e[0],e[1]),t.needsUpdate=!0}},{immediate:!0}),ta(()=>n.opacity,e=>{if(o.value&&o.value.material){const t=o.value.material;t.opacity=void 0!==e?e:1,t.needsUpdate=!0}},{immediate:!0});return ta(()=>n.points,()=>{n.points.length>=2&&(()=>{if(!s.value||!o.value||n.points.length<2)return;a.value=du(n.points),l.value=uu(a.value);const e=hu(a.value,l.value),t=d(e);s.value.setGeometry(t),r.value.position.copy(l.value)})()},{deep:!0}),ta(()=>[n.color,n.width],()=>{if(o.value){const e=o.value.material;e.uniforms&&(e.uniforms.color&&e.uniforms.color.value.set(n.color||"#ffffff"),e.uniforms.lineWidth&&(e.uniforms.lineWidth.value=n.width||1),e.uniforms.useDash&&(e.uniforms.useDash.value=0),e.uniforms.dashArray&&(e.uniforms.dashArray.value=0))}}),ta(()=>n.map,e=>{if(o.value){const t=o.value.material;e?(t.uniforms&&(t.uniforms.map.value=e,t.uniforms.useMap.value=1),u&&u(o.value,"meshline",e)):(t.uniforms&&(t.uniforms.map.value=null,t.uniforms.useMap.value=0),u&&u(o.value,"meshline",void 0))}}),na(()=>{(()=>{if(n.points.length<2)return;r.value=new Ua,a.value=du(n.points),l.value=uu(a.value);const e=hu(a.value,l.value),t=d(e);s.value=new _u,s.value.setGeometry(t);const i={color:n.color||"#ffffff",lineWidth:n.width||1,dashArray:0,dashRatio:0,dashOffset:0,useDash:0,sizeAttenuation:n.sizeAttenuation?1:0,transparent:!0,depthTest:!1,depthWrite:!1,repeat:new Oa(...n.repeat)};n.map&&(i.map=n.map,i.useMap=1);const c=new yu(i);o.value=new Za(s.value.geometry,c),o.value.renderOrder=n.renderOrder,n.raycastActive&&mu(o.value,n.raycastMultiplier),r.value.add(o.value),r.value.position.copy(l.value),u&&u(o.value,"meshline",n.map)})()}),ia(()=>{if(o.value&&(h&&h(o.value),o.value.geometry&&o.value.geometry.dispose(),o.value.material)){const e=o.value.material;e.dispose&&e.dispose()}r.value&&r.value.clear()}),(e,t)=>r.value?(sa(),ra("primitive",{key:0,object:r.value,onClick:t[0]||(t[0]=(...e)=>oa(c).handleClick&&oa(c).handleClick(...e)),onDoubleclick:t[1]||(t[1]=(...e)=>oa(c).handleDoubleClick&&oa(c).handleDoubleClick(...e)),onContextmenu:t[2]||(t[2]=(...e)=>oa(c).handleContextMenu&&oa(c).handleContextMenu(...e)),onPointerenter:t[3]||(t[3]=(...e)=>oa(c).handlePointerEnter&&oa(c).handlePointerEnter(...e)),onPointerleave:t[4]||(t[4]=(...e)=>oa(c).handlePointerLeave&&oa(c).handlePointerLeave(...e)),onPointerover:t[5]||(t[5]=(...e)=>oa(c).handlePointerOver&&oa(c).handlePointerOver(...e)),onPointerdown:t[6]||(t[6]=(...e)=>oa(c).handlePointerDown&&oa(c).handlePointerDown(...e)),onPointerup:t[7]||(t[7]=(...e)=>oa(c).handlePointerUp&&oa(c).handlePointerUp(...e)),onWheel:t[8]||(t[8]=(...e)=>oa(c).handleWheel&&oa(c).handleWheel(...e))},[ga(e.$slots,"default")],40,bu)):ma("",!0)}}),Tu=Jo({__name:"GeoLineAnimation",props:{texture:{},autoStart:{type:Boolean,default:!0},duration:{default:1e3},reverse:{type:Boolean,default:!1},speed:{default:1}},setup(e,{expose:t}){const n=e,i=pa({startTime:0,isAnimating:!1}),r=pa([]),{onRender:s}=vi();_a("registerAnimationTarget",(e,t,n)=>{const i=r.value.findIndex(t=>t.target===e);i>=0?r.value[i]={target:e,type:t,texture:n}:r.value.push({target:e,type:t,texture:n})}),_a("unregisterAnimationTarget",e=>{const t=r.value.findIndex(t=>t.target===e);t>=0&&r.value.splice(t,1)}),s(({elapsed:e})=>{!n.autoStart||!n.duration||!i.value.isAnimating||0!==r.value.length&&r.value.forEach(({target:t,type:r,texture:s})=>{if(t)if("meshline"===r)((e,t,n,i,r=!1,s=1)=>{0===i.startTime&&(i.startTime=t);let o=(t-i.startTime)*Math.max(0,s)%n/n;r&&(o=1-o),e.uniforms&&e.uniforms.offset&&(e.uniforms.offset.value.x=-o)})(t.material,1e3*e,n.duration,i.value,n.reverse,n.speed);else if("texture"===r){const t=s||n.texture;t&&((e,t,n,i,r=!1,s=1)=>{0===i.startTime&&(i.startTime=t);let o=(t-i.startTime)*Math.max(0,s)%n/n;r&&(o=1-o),e.offset.x=-o,e.needsUpdate=!0})(t,1e3*e,n.duration,i.value,n.reverse,n.speed)}})});const o=()=>{n.duration&&(e=>{e.startTime=0,e.isAnimating=!0})(i.value)},a=()=>{(e=>{e.isAnimating=!1})(i.value)};return ta(()=>n.duration,e=>{e&&n.autoStart&&r.value.length>0?o():a()}),ta(()=>n.texture,e=>{e&&n.duration&&n.autoStart&&r.value.length>0?o():a()}),ta(()=>n.reverse,()=>{n.autoStart&&n.duration&&r.value.length>0&&(a(),setTimeout(()=>{o()},10))}),na(()=>{n.autoStart&&n.duration&&setTimeout(()=>{r.value.length>0&&o()},100)}),ia(()=>{a()}),t({start:o,stop:a,isAnimating:()=>i.value.isAnimating,getAnimationTargets:()=>r.value,getTargetCount:()=>r.value.length}),(e,t)=>ga(e.$slots,"default")}}),xu=Jo({__name:"GeoFlyline",props:{start:{},end:{},type:{default:"mesh"},color:{default:"#ffffff"},width:{default:1},map:{},autoStart:{type:Boolean,default:!0},arcHeight:{default:0},segments:{default:20},tubularSegments:{},renderOrder:{default:1},duration:{default:2e3},reverse:{type:Boolean,default:!1},opacity:{default:1},repeat:{default:()=>[1,1]},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","doubleclick","contextmenu","pointerenter","pointerleave","pointerover","pointerdown","pointerup","wheel"],setup(e,{expose:t,emit:n}){const i=e,r=n,s=pa([]),o=pa(),a=fa("registerAnimationTarget",null),l=va(()=>null!==a),c=()=>{const{start:e,end:t,arcHeight:n,segments:r}=i,o=[],a=((e,t)=>{const n=t.lon-e.lon,i=t.lat-e.lat;return Math.sqrt(n*n+i*i)})(e,t),l=n||.2*a,c=e.height||0,u=t.height||0;for(let i=0;i<=r;i++){const n=i/r,s=e.lon+(t.lon-e.lon)*n,a=e.lat+(t.lat-e.lat)*n,h=c+(u-c)*n,d=4*l*n*(1-n);o.push({lon:s,lat:a,height:h+d})}s.value=o};return ta(()=>[i.start,i.end,i.arcHeight,i.segments],()=>{c()},{deep:!0,immediate:!0}),na(()=>{c()}),t({startAnimation:()=>{if(!l.value)return o.value?.start();console.warn("GeoFlyline is wrapped by GeoLineAnimation, please control animation through parent component")},stopAnimation:()=>{if(!l.value)return o.value?.stop();console.warn("GeoFlyline is wrapped by GeoLineAnimation, please control animation through parent component")},isAnimating:()=>!l.value&&(o.value?.isAnimating()||!1)}),(e,t)=>l.value?(sa(),ra(ya,{key:1},["tube"===i.type?(sa(),ca(gu,{key:0,points:s.value,color:i.color,width:i.width,map:i.map,tubularSegments:i.tubularSegments,renderOrder:i.renderOrder,opacity:i.opacity,repeat:i.repeat,id:i.id,raycastActive:i.raycastActive,raycastMultiplier:i.raycastMultiplier,onClick:t[18]||(t[18]=(...e)=>r("click",...e)),onDoubleclick:t[19]||(t[19]=(...e)=>r("doubleclick",...e)),onContextmenu:t[20]||(t[20]=(...e)=>r("contextmenu",...e)),onPointerenter:t[21]||(t[21]=(...e)=>r("pointerenter",...e)),onPointerleave:t[22]||(t[22]=(...e)=>r("pointerleave",...e)),onPointerover:t[23]||(t[23]=(...e)=>r("pointerover",...e)),onPointerdown:t[24]||(t[24]=(...e)=>r("pointerdown",...e)),onPointerup:t[25]||(t[25]=(...e)=>r("pointerup",...e)),onWheel:t[26]||(t[26]=(...e)=>r("wheel",...e))},null,8,["points","color","width","map","tubularSegments","renderOrder","opacity","repeat","id","raycastActive","raycastMultiplier"])):(sa(),ca(wu,{key:1,points:s.value,color:i.color,width:i.width,map:i.map,renderOrder:i.renderOrder,opacity:i.opacity,repeat:i.repeat,id:i.id,raycastActive:i.raycastActive,raycastMultiplier:i.raycastMultiplier,onClick:t[27]||(t[27]=(...e)=>r("click",...e)),onDoubleclick:t[28]||(t[28]=(...e)=>r("doubleclick",...e)),onContextmenu:t[29]||(t[29]=(...e)=>r("contextmenu",...e)),onPointerenter:t[30]||(t[30]=(...e)=>r("pointerenter",...e)),onPointerleave:t[31]||(t[31]=(...e)=>r("pointerleave",...e)),onPointerover:t[32]||(t[32]=(...e)=>r("pointerover",...e)),onPointerdown:t[33]||(t[33]=(...e)=>r("pointerdown",...e)),onPointerup:t[34]||(t[34]=(...e)=>r("pointerup",...e)),onWheel:t[35]||(t[35]=(...e)=>r("wheel",...e))},null,8,["points","color","width","map","renderOrder","opacity","repeat","id","raycastActive","raycastMultiplier"]))],64)):(sa(),ca(Tu,{key:0,ref_key:"animationRef",ref:o,texture:i.map,autoStart:i.autoStart,duration:i.duration,reverse:i.reverse},{default:ua(()=>["tube"===i.type?(sa(),ca(gu,{key:0,points:s.value,color:i.color,width:i.width,map:i.map,tubularSegments:i.tubularSegments,renderOrder:i.renderOrder,opacity:i.opacity,repeat:i.repeat,id:i.id,raycastActive:i.raycastActive,raycastMultiplier:i.raycastMultiplier,onClick:t[0]||(t[0]=(...e)=>r("click",...e)),onDoubleclick:t[1]||(t[1]=(...e)=>r("doubleclick",...e)),onContextmenu:t[2]||(t[2]=(...e)=>r("contextmenu",...e)),onPointerenter:t[3]||(t[3]=(...e)=>r("pointerenter",...e)),onPointerleave:t[4]||(t[4]=(...e)=>r("pointerleave",...e)),onPointerover:t[5]||(t[5]=(...e)=>r("pointerover",...e)),onPointerdown:t[6]||(t[6]=(...e)=>r("pointerdown",...e)),onPointerup:t[7]||(t[7]=(...e)=>r("pointerup",...e)),onWheel:t[8]||(t[8]=(...e)=>r("wheel",...e))},null,8,["points","color","width","map","tubularSegments","renderOrder","opacity","repeat","id","raycastActive","raycastMultiplier"])):(sa(),ca(wu,{key:1,points:s.value,color:i.color,width:i.width,map:i.map,renderOrder:i.renderOrder,opacity:i.opacity,repeat:i.repeat,id:i.id,raycastActive:i.raycastActive,raycastMultiplier:i.raycastMultiplier,onClick:t[9]||(t[9]=(...e)=>r("click",...e)),onDoubleclick:t[10]||(t[10]=(...e)=>r("doubleclick",...e)),onContextmenu:t[11]||(t[11]=(...e)=>r("contextmenu",...e)),onPointerenter:t[12]||(t[12]=(...e)=>r("pointerenter",...e)),onPointerleave:t[13]||(t[13]=(...e)=>r("pointerleave",...e)),onPointerover:t[14]||(t[14]=(...e)=>r("pointerover",...e)),onPointerdown:t[15]||(t[15]=(...e)=>r("pointerdown",...e)),onPointerup:t[16]||(t[16]=(...e)=>r("pointerup",...e)),onWheel:t[17]||(t[17]=(...e)=>r("wheel",...e))},null,8,["points","color","width","map","renderOrder","opacity","repeat","id","raycastActive","raycastMultiplier"]))]),_:1},8,["texture","autoStart","duration","reverse"]))}}),Eu=11102230246251565e-32,Pu=134217729,Au=(3+8*Eu)*Eu;function Mu(e,t,n,i,r){let s,o,a,l,c=t[0],u=i[0],h=0,d=0;u>c==u>-c?(s=c,c=t[++h]):(s=u,u=i[++d]);let p=0;if(h<e&&d<n)for(u>c==u>-c?(o=c+s,a=s-(o-c),c=t[++h]):(o=u+s,a=s-(o-u),u=i[++d]),s=o,0!==a&&(r[p++]=a);h<e&&d<n;)u>c==u>-c?(o=s+c,l=o-s,a=s-(o-l)+(c-l),c=t[++h]):(o=s+u,l=o-s,a=s-(o-l)+(u-l),u=i[++d]),s=o,0!==a&&(r[p++]=a);for(;h<e;)o=s+c,l=o-s,a=s-(o-l)+(c-l),c=t[++h],s=o,0!==a&&(r[p++]=a);for(;d<n;)o=s+u,l=o-s,a=s-(o-l)+(u-l),u=i[++d],s=o,0!==a&&(r[p++]=a);return(0!==s||0===p)&&(r[p++]=s),p}function Su(e){return new Float64Array(e)}const Cu=(3+16*Eu)*Eu,Ru=(2+12*Eu)*Eu,Ou=(9+64*Eu)*Eu*Eu,ku=Su(4),Lu=Su(8),Iu=Su(12),Du=Su(16),Fu=Su(4);function Uu(e,t,n,i,r,s){const o=(t-s)*(n-r),a=(e-r)*(i-s),l=o-a,c=Math.abs(o+a);return Math.abs(l)>=Cu*c?l:-function(e,t,n,i,r,s,o){let a,l,c,u,h,d,p,m,f,g,_,v,y,b,w,T,x,E;const P=e-r,A=n-r,M=t-s,S=i-s;b=P*S,d=Pu*P,p=d-(d-P),m=P-p,d=Pu*S,f=d-(d-S),g=S-f,w=m*g-(b-p*f-m*f-p*g),T=M*A,d=Pu*M,p=d-(d-M),m=M-p,d=Pu*A,f=d-(d-A),g=A-f,x=m*g-(T-p*f-m*f-p*g),_=w-x,h=w-_,ku[0]=w-(_+h)+(h-x),v=b+_,h=v-b,y=b-(v-h)+(_-h),_=y-T,h=y-_,ku[1]=y-(_+h)+(h-T),E=v+_,h=E-v,ku[2]=v-(E-h)+(_-h),ku[3]=E;let C=function(e,t){let n=t[0];for(let i=1;i<e;i++)n+=t[i];return n}(4,ku),R=Ru*o;if(C>=R||-C>=R||(h=e-P,a=e-(P+h)+(h-r),h=n-A,c=n-(A+h)+(h-r),h=t-M,l=t-(M+h)+(h-s),h=i-S,u=i-(S+h)+(h-s),0===a&&0===l&&0===c&&0===u)||(R=Ou*o+Au*Math.abs(C),C+=P*u+S*a-(M*c+A*l),C>=R||-C>=R))return C;b=a*S,d=Pu*a,p=d-(d-a),m=a-p,d=Pu*S,f=d-(d-S),g=S-f,w=m*g-(b-p*f-m*f-p*g),T=l*A,d=Pu*l,p=d-(d-l),m=l-p,d=Pu*A,f=d-(d-A),g=A-f,x=m*g-(T-p*f-m*f-p*g),_=w-x,h=w-_,Fu[0]=w-(_+h)+(h-x),v=b+_,h=v-b,y=b-(v-h)+(_-h),_=y-T,h=y-_,Fu[1]=y-(_+h)+(h-T),E=v+_,h=E-v,Fu[2]=v-(E-h)+(_-h),Fu[3]=E;const O=Mu(4,ku,4,Fu,Lu);b=P*u,d=Pu*P,p=d-(d-P),m=P-p,d=Pu*u,f=d-(d-u),g=u-f,w=m*g-(b-p*f-m*f-p*g),T=M*c,d=Pu*M,p=d-(d-M),m=M-p,d=Pu*c,f=d-(d-c),g=c-f,x=m*g-(T-p*f-m*f-p*g),_=w-x,h=w-_,Fu[0]=w-(_+h)+(h-x),v=b+_,h=v-b,y=b-(v-h)+(_-h),_=y-T,h=y-_,Fu[1]=y-(_+h)+(h-T),E=v+_,h=E-v,Fu[2]=v-(E-h)+(_-h),Fu[3]=E;const k=Mu(O,Lu,4,Fu,Iu);b=a*u,d=Pu*a,p=d-(d-a),m=a-p,d=Pu*u,f=d-(d-u),g=u-f,w=m*g-(b-p*f-m*f-p*g),T=l*c,d=Pu*l,p=d-(d-l),m=l-p,d=Pu*c,f=d-(d-c),g=c-f,x=m*g-(T-p*f-m*f-p*g),_=w-x,h=w-_,Fu[0]=w-(_+h)+(h-x),v=b+_,h=v-b,y=b-(v-h)+(_-h),_=y-T,h=y-_,Fu[1]=y-(_+h)+(h-T),E=v+_,h=E-v,Fu[2]=v-(E-h)+(_-h),Fu[3]=E;const L=Mu(k,Iu,4,Fu,Du);return Du[L-1]}(e,t,n,i,r,s,c)}const Nu=Math.pow(2,-52),ju=new Uint32Array(512);class zu{static from(e,t=Ku,n=Xu){const i=e.length,r=new Float64Array(2*i);for(let s=0;s<i;s++){const i=e[s];r[2*s]=t(i),r[2*s+1]=n(i)}return new zu(r)}constructor(e){const t=e.length>>1;if(t>0&&"number"!=typeof e[0])throw new Error("Expected coords to contain numbers.");this.coords=e;const n=Math.max(2*t-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:n,_hullTri:i,_hullHash:r}=this,s=e.length>>1;let o=1/0,a=1/0,l=-1/0,c=-1/0;for(let E=0;E<s;E++){const t=e[2*E],n=e[2*E+1];t<o&&(o=t),n<a&&(a=n),t>l&&(l=t),n>c&&(c=n),this._ids[E]=E}const u=(o+l)/2,h=(a+c)/2;let d,p,m;for(let E=0,P=1/0;E<s;E++){const t=Bu(u,h,e[2*E],e[2*E+1]);t<P&&(d=E,P=t)}const f=e[2*d],g=e[2*d+1];for(let E=0,P=1/0;E<s;E++){if(E===d)continue;const t=Bu(f,g,e[2*E],e[2*E+1]);t<P&&t>0&&(p=E,P=t)}let _=e[2*p],v=e[2*p+1],y=1/0;for(let E=0;E<s;E++){if(E===d||E===p)continue;const t=Hu(f,g,_,v,e[2*E],e[2*E+1]);t<y&&(m=E,y=t)}let b=e[2*m],w=e[2*m+1];if(y===1/0){for(let i=0;i<s;i++)this._dists[i]=e[2*i]-e[0]||e[2*i+1]-e[1];Gu(this._ids,this._dists,0,s-1);const t=new Uint32Array(s);let n=0;for(let e=0,i=-1/0;e<s;e++){const r=this._ids[e],s=this._dists[r];s>i&&(t[n++]=r,i=s)}return this.hull=t.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(Uu(f,g,_,v,b,w)<0){const e=p,t=_,n=v;p=m,_=b,v=w,m=e,b=t,w=n}const T=function(e,t,n,i,r,s){const o=n-e,a=i-t,l=r-e,c=s-t,u=o*o+a*a,h=l*l+c*c,d=.5/(o*c-a*l),p=e+(c*u-a*h)*d,m=t+(o*h-l*u)*d;return{x:p,y:m}}(f,g,_,v,b,w);this._cx=T.x,this._cy=T.y;for(let E=0;E<s;E++)this._dists[E]=Bu(e[2*E],e[2*E+1],T.x,T.y);Gu(this._ids,this._dists,0,s-1),this._hullStart=d;let x=3;n[d]=t[m]=p,n[p]=t[d]=m,n[m]=t[p]=d,i[d]=0,i[p]=1,i[m]=2,r.fill(-1),r[this._hashKey(f,g)]=d,r[this._hashKey(_,v)]=p,r[this._hashKey(b,w)]=m,this.trianglesLen=0,this._addTriangle(d,p,m,-1,-1,-1);for(let E,P,A=0;A<this._ids.length;A++){const s=this._ids[A],o=e[2*s],a=e[2*s+1];if(A>0&&Math.abs(o-E)<=Nu&&Math.abs(a-P)<=Nu||(E=o,P=a,s===d||s===p||s===m))continue;let l=0;for(let e=0,t=this._hashKey(o,a);e<this._hashSize&&(l=r[(t+e)%this._hashSize],-1===l||l===n[l]);e++);l=t[l];let c,u=l;for(;c=n[u],Uu(o,a,e[2*u],e[2*u+1],e[2*c],e[2*c+1])>=0;)if(u=c,u===l){u=-1;break}if(-1===u)continue;let h=this._addTriangle(u,s,n[u],-1,-1,i[u]);i[s]=this._legalize(h+2),i[u]=h,x++;let f=n[u];for(;c=n[f],Uu(o,a,e[2*f],e[2*f+1],e[2*c],e[2*c+1])<0;)h=this._addTriangle(f,s,c,i[s],-1,i[f]),i[s]=this._legalize(h+2),n[f]=f,x--,f=c;if(u===l)for(;c=t[u],Uu(o,a,e[2*c],e[2*c+1],e[2*u],e[2*u+1])<0;)h=this._addTriangle(c,s,u,-1,i[u],i[c]),this._legalize(h+2),i[c]=h,n[u]=u,x--,u=c;this._hullStart=t[s]=u,n[u]=t[f]=s,n[s]=f,r[this._hashKey(o,a)]=s,r[this._hashKey(e[2*u],e[2*u+1])]=u}this.hull=new Uint32Array(x);for(let E=0,P=this._hullStart;E<x;E++)this.hull[E]=P,P=n[P];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(function(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:n,coords:i}=this;let r=0,s=0;for(;;){const o=n[e],a=e-e%3;if(s=a+(e+2)%3,-1===o){if(0===r)break;e=ju[--r];continue}const l=o-o%3,c=a+(e+1)%3,u=l+(o+2)%3,h=t[s],d=t[e],p=t[c],m=t[u];if(Vu(i[2*h],i[2*h+1],i[2*d],i[2*d+1],i[2*p],i[2*p+1],i[2*m],i[2*m+1])){t[e]=m,t[o]=h;const i=n[u];if(-1===i){let t=this._hullStart;do{if(this._hullTri[t]===u){this._hullTri[t]=e;break}t=this._hullPrev[t]}while(t!==this._hullStart)}this._link(e,i),this._link(o,n[s]),this._link(s,u);const a=l+(o+1)%3;r<ju.length&&(ju[r++]=a)}else{if(0===r)break;e=ju[--r]}}return s}_link(e,t){this._halfedges[e]=t,-1!==t&&(this._halfedges[t]=e)}_addTriangle(e,t,n,i,r,s){const o=this.trianglesLen;return this._triangles[o]=e,this._triangles[o+1]=t,this._triangles[o+2]=n,this._link(o,i),this._link(o+1,r),this._link(o+2,s),this.trianglesLen+=3,o}}function Bu(e,t,n,i){const r=e-n,s=t-i;return r*r+s*s}function Vu(e,t,n,i,r,s,o,a){const l=e-o,c=t-a,u=n-o,h=i-a,d=r-o,p=s-a,m=u*u+h*h,f=d*d+p*p;return l*(h*f-m*p)-c*(u*f-m*d)+(l*l+c*c)*(u*p-h*d)<0}function Hu(e,t,n,i,r,s){const o=n-e,a=i-t,l=r-e,c=s-t,u=o*o+a*a,h=l*l+c*c,d=.5/(o*c-a*l),p=(c*u-a*h)*d,m=(o*h-l*u)*d;return p*p+m*m}function Gu(e,t,n,i){if(i-n<=20)for(let r=n+1;r<=i;r++){const i=e[r],s=t[i];let o=r-1;for(;o>=n&&t[e[o]]>s;)e[o+1]=e[o--];e[o+1]=i}else{let r=n+1,s=i;Wu(e,n+i>>1,r),t[e[n]]>t[e[i]]&&Wu(e,n,i),t[e[r]]>t[e[i]]&&Wu(e,r,i),t[e[n]]>t[e[r]]&&Wu(e,n,r);const o=e[r],a=t[o];for(;;){do{r++}while(t[e[r]]<a);do{s--}while(t[e[s]]>a);if(s<r)break;Wu(e,r,s)}e[n+1]=e[s],e[s]=o,i-r+1>=s-n?(Gu(e,t,r,i),Gu(e,t,n,s-1)):(Gu(e,t,n,s-1),Gu(e,t,r,i))}}function Wu(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function Ku(e){return e[0]}function Xu(e){return e[1]}const qu=(e,t)=>{let n=!1;const i=e[0],r=e[1];let s=t.length-1;for(let o=0;o<t.length;o++){const e=t[o][0],a=t[o][1],l=t[s][0],c=t[s][1];a>r!=c>r&&i<(l-e)*(r-a)/(c-a)+e&&(n=!n),s=o}return n},Yu=(e,t)=>{for(const n of t)if(qu(e,n))return!0;return!1},$u=e=>{let t=0;for(let n=0,i=e.length;n<i;n++){const r=(n+1)%i;t+=e[n][0]*e[r][1],t-=e[r][0]*e[n][1]}return t<0},Zu=e=>{let t=e[0];for(let n=1;n<=e.length;n++){const i=n%e.length,r=e[i],s=r[0]-t[0],o=r[1]-t[1],a=s*s+o*o,l=Math.max(Math.abs(r[0]),Math.abs(r[1]),Math.abs(t[0]),Math.abs(t[1]));a<=1.0000000000000001e-20*l*l?(e.splice(i,1),n--):t=r}},Qu=(e,t)=>{if(t<=1)return[...e];const n=[];let i=0;for(let s=0;s<e.length;s++){const t=e[s],n=e[(s+1)%e.length],r=n[0]-t[0],o=n[1]-t[1];i+=Math.sqrt(r*r+o*o)}const r=i/(50*t);for(let s=0;s<e.length;s++){const t=e[s],i=e[(s+1)%e.length];n.push(t);const o=i[0]-t[0],a=i[1]-t[1],l=Math.sqrt(o*o+a*a),c=Math.max(1,Math.ceil(l/r));for(let e=1;e<c;e++){const i=e/c,r=[t[0]+i*o,t[1]+i*a];n.push(r)}}return n},Ju=(e,t,n=1e-10)=>{const[i,r]=e;for(let s=0;s<t.length;s++){const e=(s+1)%t.length,[o,a]=t[s],[l,c]=t[e],u=(r-a)*(l-o)-(i-o)*(c-a);if(Math.abs(u)<n){const e=(i-o)*(l-o)+(r-a)*(c-a);if(e>=0&&e<=(l-o)*(l-o)+(c-a)*(c-a))return!0}}return!1},eh=(e,t,n,i)=>{const r=e[0],s=e[1],o=t[0],a=t[1],l=n[0],c=n[1],u=i[0],h=i[1],d=(r-o)*(c-h)-(s-a)*(l-u);if(Math.abs(d)<1e-10)return!1;const p=((r-l)*(c-h)-(s-c)*(l-u))/d,m=-((r-o)*(s-c)-(s-a)*(r-l))/d;return p>=0&&p<=1&&m>=0&&m<=1},th=(e,t,n)=>{for(let i=0;i<n.length;i++){const r=(i+1)%n.length,s=n[i],o=n[r],a=Math.abs(e[0]-s[0])<1e-10&&Math.abs(e[1]-s[1])<1e-10,l=Math.abs(e[0]-o[0])<1e-10&&Math.abs(e[1]-o[1])<1e-10,c=Math.abs(t[0]-s[0])<1e-10&&Math.abs(t[1]-s[1])<1e-10,u=Math.abs(t[0]-o[0])<1e-10&&Math.abs(t[1]-o[1])<1e-10;if(!(a||l||c||u)&&eh(e,t,s,o))return!0}return!1},nh=(e,t,n,i,r)=>{const s=[(e[0]+t[0]+n[0])/3,(e[1]+t[1]+n[1])/3];if(!qu(s,i)||Yu(s,r))return!1;const o=[[e,t],[t,n],[n,e]];for(const l of r)for(const e of o)if(th(e[0],e[1],l))return!1;const a=[e,t,n];for(const l of a)if(!qu(l,i)||Yu(l,r)){let e=!1;for(const t of r)if(Ju(l,t)){e=!0;break}if(!e&&!Ju(l,i))return!1}return!r.some(e=>a.every(t=>qu(t,e)))},ih=(e,t,n)=>{const i=[...e];for(const o of t)i.push(...o);i.push(...n);const r=zu.from(i).triangles,s=[];for(let o=0;o<r.length;o+=3){const n=i[r[o]],a=i[r[o+1]],l=i[r[o+2]];nh(n,a,l,e,t)&&s.push(n,a,l)}return s},rh=(e,t,n)=>{const i=[];if(n<=1)return i;const r=e.map(e=>e[0]),s=e.map(e=>e[1]),o=Math.min.apply(null,r),a=Math.max.apply(null,r),l=Math.min.apply(null,s),c=Math.max.apply(null,s),u=(a-o)/(10*n),h=(c-l)/(10*n);for(let d=o+u;d<a;d+=u)for(let n=l+h;n<c;n+=h){const r=[d,n];qu(r,e)&&!Yu(r,t)&&i.push(r)}return i},sh=["position"],oh=["object"],ah=Jo({__name:"GeoPolygon",props:{geometry:{},subdivisions:{default:2},height:{default:30},renderOrder:{default:1},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","doubleclick","contextmenu","pointerenter","pointerleave","pointerover","pointerdown","pointerup","wheel"],setup(e,{emit:t}){const n=e,i=t,r=da(),s=pa(new ka),o=pu(i,n,n.raycastActive),a=e=>e.map(([e,t,i=n.height])=>({lon:e,lat:t,height:i})),l=e=>{let t;if("Polygon"===e.type)t=[e.coordinates];else{if("MultiPolygon"!==e.type)throw new Error("不支持的几何类型，仅支持Polygon和MultiPolygon");t=e.coordinates}const n=[],i=[];return t.forEach(e=>{if(0===e.length)return;const t=a(e[0]);n.push(t);const r=[];for(let n=1;n<e.length;n++){const t=a(e[n]);r.push(t)}i.push(r)}),{contours:n,holes:i}},c=e=>{const{contours:t,holes:i}=l(n.geometry);if(0===t.length)throw new Error("没有有效的多边形轮廓");const r=[],s=[];t.forEach((t,o)=>{if(t.length<3)return void console.warn(`多边形${o}的顶点数少于3，跳过`);const a=i[o]||[];let l=t.map(e=>[e.lon,e.lat]),c=a.map(e=>e.map(e=>[e.lon,e.lat]));!$u(l)&&l.reverse();for(let e=0;e<c.length;e++){const t=c[e];$u(t)&&(c[e]=t.reverse())}Zu(l),c.forEach(e=>Zu(e));const u=Math.max(1,n.subdivisions);l=Qu(l,u),c=c.map(e=>Qu(e,u));const h=rh(l,c,u),d=ih(l,c,h),p=n.height??0,m=d.map(e=>e[0]),f=d.map(e=>e[1]),g=Math.min.apply(null,m),_=Math.max.apply(null,m),v=Math.min.apply(null,f),y=Math.max.apply(null,f),b=_-g,w=y-v;d.forEach(([t,n])=>{const i=Wc(t,n,p);r.push(i.x-e.x,i.y-e.y,i.z-e.z);const o=b>0?(t-g)/b:0,a=w>0?1-(n-v)/w:0;s.push(o,a)})});const o=new za;return o.setAttribute("position",new Ba(r,3)),o.setAttribute("uv",new Ba(s,2)),o.computeVertexNormals(),o},u=()=>{if(r.value)try{const{contours:e}=l(n.geometry);if(0===e.length||e[0].length<3)return;const t=r.value.geometry,i=h(n.geometry);s.value=i;const o=c(i);r.value.geometry=o,t.dispose()}catch(e){console.error("更新几何体失败:",e)}};ta(()=>n.geometry,()=>{u()},{deep:!0}),ta(()=>n.subdivisions,()=>{u()}),ta(()=>n.height,()=>{u()});const h=e=>{const{contours:t}=l(e);if(0===t.length)return new ka;let i=0,r=0,s=0;if(t.forEach(e=>{e.forEach(e=>{i+=e.lon,r+=e.lat,s++})}),0===s)return new ka;const o=i/s,a=r/s,c=n.height??0;return new ka(...Wc(o,a,c))};return na(()=>{(()=>{try{const{contours:e}=l(n.geometry);if(0===e.length||e[0].length<3)return void console.warn("多边形至少需要3个点");const t=h(n.geometry);s.value=t;const i=c(t);r.value=new Za(i),r.value.renderOrder=n.renderOrder,n.raycastActive&&mu(r.value,n.raycastMultiplier)}catch(e){console.error("创建多边形失败:",e)}})()}),ia(()=>{r.value&&r.value.geometry?.dispose?.()}),(e,t)=>r.value?(sa(),ra("TresGroup",{key:0,position:s.value},[ha("primitive",{object:r.value,onClick:t[0]||(t[0]=(...e)=>oa(o).handleClick&&oa(o).handleClick(...e)),onDoubleclick:t[1]||(t[1]=(...e)=>oa(o).handleDoubleClick&&oa(o).handleDoubleClick(...e)),onContextmenu:t[2]||(t[2]=(...e)=>oa(o).handleContextMenu&&oa(o).handleContextMenu(...e)),onPointerenter:t[3]||(t[3]=(...e)=>oa(o).handlePointerEnter&&oa(o).handlePointerEnter(...e)),onPointerleave:t[4]||(t[4]=(...e)=>oa(o).handlePointerLeave&&oa(o).handlePointerLeave(...e)),onPointerover:t[5]||(t[5]=(...e)=>oa(o).handlePointerOver&&oa(o).handlePointerOver(...e)),onPointerdown:t[6]||(t[6]=(...e)=>oa(o).handlePointerDown&&oa(o).handlePointerDown(...e)),onPointerup:t[7]||(t[7]=(...e)=>oa(o).handlePointerUp&&oa(o).handlePointerUp(...e)),onWheel:t[8]||(t[8]=(...e)=>oa(o).handleWheel&&oa(o).handleWheel(...e))},[ga(e.$slots,"default")],40,oh)],8,sh)):ma("",!0)}}),lh=["position"],ch=["object"],uh=Jo({__name:"GeoWall",props:{geometry:{},height:{default:100},baseHeight:{default:0},renderOrder:{default:1},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","doubleclick","contextmenu","pointerenter","pointerleave","pointerover","pointerdown","pointerup","wheel"],setup(e,{emit:t}){const n=e,i=t,r=da(),s=pa(new ka),o=pu(i,n,n.raycastActive),a=e=>e.map(([e,t,n=0])=>({lon:e,lat:t,height:n})),l=e=>{const t=[];switch(e.type){case"LineString":t.push(a(e.coordinates));break;case"MultiLineString":case"Polygon":e.coordinates.forEach(e=>{t.push(a(e))});break;case"MultiPolygon":e.coordinates.forEach(e=>{e.forEach(e=>{t.push(a(e))})});break;default:throw new Error(`不支持的几何类型: ${e.type}`)}return t},c=(e,t)=>{if(0===e.length)throw new Error("没有有效的线段数据");const i=[],r=[],s=[];let o=0;e.forEach(e=>{if(e.length<2)return void console.warn("线段至少需要2个点，跳过");const a=[...e],l=[],c=[];a.forEach(e=>{const i=Wc(e.lon,e.lat,n.baseHeight);l.push(new ka(i.x-t.x,i.y-t.y,i.z-t.z));const r=Wc(e.lon,e.lat,n.baseHeight+n.height);c.push(new ka(r.x-t.x,r.y-t.y,r.z-t.z))});const u=[0];let h=0;for(let t=1;t<l.length;t++){const e=l[t-1].distanceTo(l[t]);h+=e,u.push(h)}l.forEach((e,t)=>{i.push(e.x,e.y,e.z);const n=h>0?u[t]/h:0;s.push(n,0)}),c.forEach((e,t)=>{i.push(e.x,e.y,e.z);const n=h>0?u[t]/h:0;s.push(n,1)});const d=l.length;for(let t=0;t<d-1;t++){const e=o+t,n=o+t+1,i=o+t+d,s=o+t+1+d;r.push(e,n,i),r.push(n,s,i)}o+=2*d});const a=new za;return a.setAttribute("position",new Ba(i,3)),a.setAttribute("uv",new Ba(s,2)),a.setIndex(r),a.computeVertexNormals(),a},u=()=>{if(r.value)try{const e=l(n.geometry);if(0===e.length)return void console.warn("没有有效的线段数据");const t=r.value.geometry,i=h(n.geometry);s.value=i;const o=c(e,i);r.value.geometry=o,t.dispose()}catch(e){console.error("更新几何体失败:",e)}};ta(()=>n.geometry,()=>{u()},{deep:!0}),ta(()=>n.height,()=>{u()}),ta(()=>n.baseHeight,()=>{u()});const h=e=>{const t=l(e);if(0===t.length)return new ka;let i=0,r=0,s=0;if(t.forEach(e=>{e.forEach(e=>{i+=e.lon,r+=e.lat,s++})}),0===s)return new ka;const o=i/s,a=r/s,c=n.baseHeight+n.height/2;return new ka(...Wc(o,a,c))};return na(()=>{(()=>{try{const e=l(n.geometry);if(0===e.length)return void console.warn("没有有效的线段数据");const t=h(n.geometry);s.value=t;const i=c(e,t);r.value=new Za(i),r.value.renderOrder=n.renderOrder,n.raycastActive&&mu(r.value,n.raycastMultiplier)}catch(e){console.error("创建墙体失败:",e)}})()}),ia(()=>{r.value&&r.value.geometry.dispose()}),(e,t)=>r.value?(sa(),ra("TresGroup",{key:0,position:s.value},[ha("primitive",{object:r.value,onClick:t[0]||(t[0]=(...e)=>oa(o).handleClick&&oa(o).handleClick(...e)),onDoubleclick:t[1]||(t[1]=(...e)=>oa(o).handleDoubleClick&&oa(o).handleDoubleClick(...e)),onContextmenu:t[2]||(t[2]=(...e)=>oa(o).handleContextMenu&&oa(o).handleContextMenu(...e)),onPointerenter:t[3]||(t[3]=(...e)=>oa(o).handlePointerEnter&&oa(o).handlePointerEnter(...e)),onPointerleave:t[4]||(t[4]=(...e)=>oa(o).handlePointerLeave&&oa(o).handlePointerLeave(...e)),onPointerover:t[5]||(t[5]=(...e)=>oa(o).handlePointerOver&&oa(o).handlePointerOver(...e)),onPointerdown:t[6]||(t[6]=(...e)=>oa(o).handlePointerDown&&oa(o).handlePointerDown(...e)),onPointerup:t[7]||(t[7]=(...e)=>oa(o).handlePointerUp&&oa(o).handlePointerUp(...e)),onWheel:t[8]||(t[8]=(...e)=>oa(o).handleWheel&&oa(o).handleWheel(...e))},[ga(e.$slots,"default")],40,ch)],8,lh)):ma("",!0)}}),hh=["position"],dh=["object"],ph=["object"],mh=["object"],fh=Jo({__name:"GeoBuilding",props:{geometry:{},subdivisions:{default:2},height:{default:100},baseHeight:{default:0},showTop:{type:Boolean,default:!0},showBottom:{type:Boolean,default:!1},showWalls:{type:Boolean,default:!0},renderOrder:{default:1},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","doubleclick","contextmenu","pointerenter","pointerleave","pointerover","pointerdown","pointerup","wheel"],setup(e,{emit:t}){const n=e,i=t,r=da(),s=da(),o=da(),a=pa(new ka),l=pu(i,n,n.raycastActive),c=e=>e.map(([e,t,i=n.baseHeight])=>({lon:e,lat:t,height:i})),u=e=>{let t;if("Polygon"===e.type)t=[e.coordinates];else{if("MultiPolygon"!==e.type)throw new Error("GeoBuilding 只支持 Polygon 和 MultiPolygon 类型");t=e.coordinates}const n=[],i=[];return t.forEach(e=>{if(0===e.length)return;const t=c(e[0]);n.push(t);const r=[];for(let n=1;n<e.length;n++){const t=c(e[n]);r.push(t)}i.push(r)}),{contours:n,holes:i}},h=(e,t)=>{const{contours:i,holes:r}=u(n.geometry);if(0===i.length)throw new Error("没有有效的多边形轮廓");const s=[],o=[];i.forEach((i,a)=>{if(i.length<3)return void console.warn(`多边形${a}的顶点数少于3，跳过`);const l=r[a]||[];let c=i.map(e=>[e.lon,e.lat]),u=l.map(e=>e.map(e=>[e.lon,e.lat]));!$u(c)&&c.reverse();for(let e=0;e<u.length;e++){const t=u[e];$u(t)&&(u[e]=t.reverse())}Zu(c),u.forEach(e=>Zu(e));const h=Math.min(Math.max(1,n.subdivisions),5);c=Qu(c,h),u=u.map(e=>Qu(e,h));const d=rh(c,u,h),p=ih(c,u,d);p.length>1e4&&console.warn(`多边形${a}顶点数过多(${p.length})，建议减少subdivisions`);const m=p.map(e=>e[0]),f=p.map(e=>e[1]),g=Math.min.apply(null,m),_=Math.max.apply(null,m),v=Math.min.apply(null,f),y=Math.max.apply(null,f),b=_-g,w=y-v;p.forEach(([i,r])=>{const a=Wc(i,r,n.baseHeight+e);s.push(a.x-t.x,a.y-t.y,a.z-t.z);const l=b>0?(i-g)/b:0,c=w>0?1-(r-v)/w:0;o.push(l,c)})});const a=new za;return a.setAttribute("position",new Ba(s,3)),a.setAttribute("uv",new Ba(o,2)),a.computeVertexNormals(),a},d=()=>{try{const{contours:e}=u(n.geometry);if(0===e.length||e[0].length<3)return void console.warn("多边形至少需要3个点");const t=m(n.geometry);if(a.value=t,n.showBottom){const e=h(0,t);s.value=new Za(e),s.value.renderOrder=n.renderOrder,n.raycastActive&&mu(s.value,n.raycastMultiplier)}if(n.showTop){const e=h(n.height,t);r.value=new Za(e),r.value.renderOrder=n.renderOrder,n.raycastActive&&mu(r.value,n.raycastMultiplier)}if(n.showWalls){const e=(e=>{const{contours:t,holes:i}=u(n.geometry);if(0===t.length)throw new Error("没有有效的多边形轮廓");const r=[],s=[],o=[];let a=0;t.forEach((t,l)=>{const c=i[l]||[],u=t=>{if(t.length<3)return;const i=[],l=[];t.forEach(t=>{const r=Wc(t.lon,t.lat,n.baseHeight);i.push(new ka(r.x-e.x,r.y-e.y,r.z-e.z));const s=Wc(t.lon,t.lat,n.baseHeight+n.height);l.push(new ka(s.x-e.x,s.y-e.y,s.z-e.z))});const c=[0];let u=0;for(let e=1;e<i.length;e++){const t=i[e-1].distanceTo(i[e]);u+=t,c.push(u)}i.forEach((e,t)=>{r.push(e.x,e.y,e.z);const n=u>0?c[t]/u:0;o.push(n,0)}),l.forEach((e,t)=>{r.push(e.x,e.y,e.z);const n=u>0?c[t]/u:0;o.push(n,1)});const h=i.length;for(let e=0;e<h-1;e++){const t=a+e,n=a+e+1,i=a+e+h,r=a+e+1+h;s.push(t,n,i),s.push(n,r,i)}a+=2*h};u(t),c.forEach(e=>{u(e)})});const l=new za;return l.setAttribute("position",new Ba(r,3)),l.setAttribute("uv",new Ba(o,2)),l.setIndex(s),l.computeVertexNormals(),l})(t);o.value=new Za(e),o.value.renderOrder=n.renderOrder,n.raycastActive&&mu(o.value,n.raycastMultiplier)}}catch(e){console.error("创建建筑失败:",e)}},p=()=>{r.value&&r.value.geometry.dispose(),s.value&&s.value.geometry.dispose(),o.value&&o.value.geometry.dispose(),d()};ta(()=>n.geometry,()=>{p()},{deep:!0}),ta(()=>[n.subdivisions,n.height,n.baseHeight,n.showTop,n.showBottom,n.showWalls],()=>{p()});const m=e=>{const{contours:t}=u(e);if(0===t.length)return new ka;let i=0,r=0,s=0;if(t.forEach(e=>{e.forEach(e=>{i+=e.lon,r+=e.lat,s++})}),0===s)return new ka;const o=i/s,a=r/s,l=n.baseHeight+n.height/2;return new ka(...Wc(o,a,l))};return na(()=>{d()}),ia(()=>{r.value&&r.value.geometry.dispose(),s.value&&s.value.geometry.dispose(),o.value&&o.value.geometry.dispose()}),(e,t)=>s.value||r.value||o.value?(sa(),ra("TresGroup",{key:0,position:a.value,onClick:t[0]||(t[0]=(...e)=>oa(l).handleClick&&oa(l).handleClick(...e)),onDoubleclick:t[1]||(t[1]=(...e)=>oa(l).handleDoubleClick&&oa(l).handleDoubleClick(...e)),onContextmenu:t[2]||(t[2]=(...e)=>oa(l).handleContextMenu&&oa(l).handleContextMenu(...e)),onPointerenter:t[3]||(t[3]=(...e)=>oa(l).handlePointerEnter&&oa(l).handlePointerEnter(...e)),onPointerleave:t[4]||(t[4]=(...e)=>oa(l).handlePointerLeave&&oa(l).handlePointerLeave(...e)),onPointerover:t[5]||(t[5]=(...e)=>oa(l).handlePointerOver&&oa(l).handlePointerOver(...e)),onPointerdown:t[6]||(t[6]=(...e)=>oa(l).handlePointerDown&&oa(l).handlePointerDown(...e)),onPointerup:t[7]||(t[7]=(...e)=>oa(l).handlePointerUp&&oa(l).handlePointerUp(...e)),onWheel:t[8]||(t[8]=(...e)=>oa(l).handleWheel&&oa(l).handleWheel(...e))},[e.showBottom?(sa(),ra("primitive",{key:0,object:s.value},[ga(e.$slots,"bottom")],8,dh)):ma("",!0),e.showTop?(sa(),ra("primitive",{key:1,object:r.value},[ga(e.$slots,"top")],8,ph)):ma("",!0),e.showWalls?(sa(),ra("primitive",{key:2,object:o.value},[ga(e.$slots,"walls")],8,mh)):ma("",!0)],40,hh)):ma("",!0)}}),gh=["rotation-y"],_h=Jo({__name:"GeoRotate",props:{rotate:{default:0}},setup(e){const t=e,n=va(()=>t.rotate?t.rotate*(Math.PI/180):0);return(e,t)=>(sa(),ra("TresGroup",{"rotation-y":n.value},[ga(e.$slots,"default")],8,gh))}}),vh=["position","rotation"],yh=Jo({__name:"GeoPosition",props:{point:{}},setup(e){const t=e,n=da(new ka),i=da(new Ja),r=()=>{const e=Wc(t.point?.lon,t.point?.lat,t.point?.height||0);n.value=e;const r=e.clone().normalize(),s=new ka(0,0,1),o=s.clone().sub(r.clone().multiplyScalar(s.dot(r))).normalize(),a=o.clone().cross(r).normalize();o.copy(r.clone().cross(a)).normalize();const l=new La;l.makeBasis(a,r,o);const c=new Ra;c.matrix.copy(l),c.matrix.decompose(c.position,c.quaternion,c.scale),i.value.setFromQuaternion(c.quaternion),i.value=i.value.clone()};return ta([()=>t.point?.lon,()=>t.point?.lat,()=>t.point?.height],()=>{r()}),na(()=>{r()}),(e,t)=>(sa(),ra("TresGroup",{position:n.value,rotation:i.value},[ga(e.$slots,"default")],8,vh))}}),bh=Jo({__name:"GeoTextureProps",props:{texture:{},center:{},rotation:{},scale:{},repeat:{},offset:{},wrapS:{},wrapT:{},magFilter:{},minFilter:{},flipY:{type:Boolean},format:{},type:{},colorSpace:{},generateMipmaps:{type:Boolean},premultiplyAlpha:{type:Boolean},unpackAlignment:{},anisotropy:{},encoding:{},matrixAutoUpdate:{type:Boolean},userData:{},name:{}},setup(e){const t=e;function n(e,t,n){void 0!==t&&e!==t&&n(t)}function i(e,t){t&&!function(e,t){return e.x===t[0]&&e.y===t[1]}(e,t)&&(e.x=t[0],e.y=t[1])}return ta(()=>t.texture,e=>{e&&t.texture&&(t.center&&(t.texture.center.x=t.center[0],t.texture.center.y=t.center[1]),void 0!==t.rotation&&(t.texture.rotation=t.rotation),t.scale&&(t.texture.repeat.x=t.scale[0],t.texture.repeat.y=t.scale[1]),t.repeat&&(t.texture.repeat.x=t.repeat[0],t.texture.repeat.y=t.repeat[1]),t.offset&&(t.texture.offset.x=t.offset[0],t.texture.offset.y=t.offset[1]),void 0!==t.wrapS&&(t.texture.wrapS=t.wrapS),void 0!==t.wrapT&&(t.texture.wrapT=t.wrapT),void 0!==t.magFilter&&(t.texture.magFilter=t.magFilter),void 0!==t.minFilter&&(t.texture.minFilter=t.minFilter),void 0!==t.flipY&&(t.texture.flipY=t.flipY),void 0!==t.format&&(t.texture.format=t.format),void 0!==t.type&&(t.texture.type=t.type),void 0!==t.colorSpace&&(t.texture.colorSpace=t.colorSpace),void 0!==t.generateMipmaps&&(t.texture.generateMipmaps=t.generateMipmaps),void 0!==t.premultiplyAlpha&&(t.texture.premultiplyAlpha=t.premultiplyAlpha),void 0!==t.unpackAlignment&&(t.texture.unpackAlignment=t.unpackAlignment),void 0!==t.anisotropy&&(t.texture.anisotropy=t.anisotropy),void 0!==t.encoding&&(t.texture.encoding=t.encoding),void 0!==t.userData&&(t.texture.userData=t.userData),void 0!==t.name&&(t.texture.name=t.name))},{immediate:!0}),ta(()=>t.center,e=>{t.texture&&e&&i(t.texture.center,e)},{deep:!0}),ta(()=>t.rotation,e=>{t.texture&&n(t.texture.rotation,e,e=>{t.texture.rotation=e})}),ta(()=>t.scale,e=>{t.texture&&e&&i(t.texture.repeat,e)},{deep:!0}),ta(()=>t.repeat,e=>{t.texture&&e&&i(t.texture.repeat,e)},{deep:!0}),ta(()=>t.offset,e=>{t.texture&&e&&i(t.texture.offset,e)},{deep:!0}),ta(()=>t.wrapS,e=>{t.texture&&n(t.texture.wrapS,e,e=>{t.texture.wrapS=e})}),ta(()=>t.wrapT,e=>{t.texture&&n(t.texture.wrapT,e,e=>{t.texture.wrapT=e})}),ta(()=>t.magFilter,e=>{t.texture&&n(t.texture.magFilter,e,e=>{t.texture.magFilter=e})}),ta(()=>t.minFilter,e=>{t.texture&&n(t.texture.minFilter,e,e=>{t.texture.minFilter=e})}),ta(()=>t.flipY,e=>{t.texture&&n(t.texture.flipY,e,e=>{t.texture.flipY=e})}),ta(()=>t.format,e=>{t.texture&&n(t.texture.format,e,e=>{t.texture.format=e})}),ta(()=>t.type,e=>{t.texture&&n(t.texture.type,e,e=>{t.texture.type=e})}),ta(()=>t.colorSpace,e=>{t.texture&&n(t.texture.colorSpace,e,e=>{t.texture.colorSpace=e})}),ta(()=>t.generateMipmaps,e=>{t.texture&&n(t.texture.generateMipmaps,e,e=>{t.texture.generateMipmaps=e})}),ta(()=>t.premultiplyAlpha,e=>{t.texture&&n(t.texture.premultiplyAlpha,e,e=>{t.texture.premultiplyAlpha=e})}),ta(()=>t.unpackAlignment,e=>{t.texture&&n(t.texture.unpackAlignment,e,e=>{t.texture.unpackAlignment=e})}),ta(()=>t.anisotropy,e=>{t.texture&&n(t.texture.anisotropy,e,e=>{t.texture.anisotropy=e})}),ta(()=>t.encoding,e=>{t.texture&&n(t.texture.encoding,e,e=>{t.texture.encoding=e})}),ta(()=>t.matrixAutoUpdate,e=>{t.texture&&n(t.texture.matrixAutoUpdate,e,e=>{t.texture.matrixAutoUpdate=e})}),ta(()=>t.userData,e=>{t.texture&&n(t.texture.userData,e,e=>{t.texture.userData=e})},{deep:!0}),ta(()=>t.name,e=>{t.texture&&n(t.texture.name,e,e=>{t.texture.name=e})}),(e,t)=>null}});function wh(e){if(!e)return null;const t=e.replace(/[a-z]+:\/\/[^/]+/i,"").replace(/\?.*$/i,"").replace(/.*\//g,""),n=t.lastIndexOf(".");return-1===n?null:t.substring(n+1)||null}const Th=2**30;class xh{get unloadPriorityCallback(){return this._unloadPriorityCallback}set unloadPriorityCallback(e){1===e.length?(console.warn('LRUCache: "unloadPriorityCallback" function has been changed to take two arguments.'),this._unloadPriorityCallback=(t,n)=>{const i=e(t),r=e(n);return i<r?-1:i>r?1:0}):this._unloadPriorityCallback=e}constructor(){this.minSize=6e3,this.maxSize=8e3,this.minBytesSize=.3*Th,this.maxBytesSize=.4*Th,this.unloadPercent=.05,this.autoMarkUnused=!0,this.itemSet=new Map,this.itemList=[],this.usedSet=new Set,this.callbacks=new Map,this.unloadingHandle=-1,this.cachedBytes=0,this.bytesMap=new Map,this.loadedSet=new Set,this._unloadPriorityCallback=null,this.computeMemoryUsageCallback=()=>null;const e=this.itemSet;this.defaultPriorityCallback=t=>e.get(t)}isFull(){return this.itemSet.size>=this.maxSize||this.cachedBytes>=this.maxBytesSize}getMemoryUsage(e){return this.bytesMap.get(e)??null}add(e,t){const n=this.itemSet;if(n.has(e)||this.isFull())return!1;const i=this.usedSet,r=this.itemList,s=this.callbacks,o=this.bytesMap;r.push(e),i.add(e),n.set(e,Date.now()),s.set(e,t);const a=this.computeMemoryUsageCallback(e);return this.cachedBytes+=a||0,o.set(e,a),!0}has(e){return this.itemSet.has(e)}remove(e){const t=this.usedSet,n=this.itemSet,i=this.itemList,r=this.bytesMap,s=this.callbacks,o=this.loadedSet;if(n.has(e)){this.cachedBytes-=r.get(e)||0,r.delete(e),s.get(e)(e);const a=i.indexOf(e);return i.splice(a,1),t.delete(e),n.delete(e),s.delete(e),o.delete(e),!0}return!1}setLoaded(e,t){const{itemSet:n,loadedSet:i}=this;n.has(e)&&(!0===t?i.add(e):i.delete(e))}updateMemoryUsage(e){const t=this.itemSet,n=this.bytesMap;if(!t.has(e))return;this.cachedBytes-=n.get(e)||0;const i=this.computeMemoryUsageCallback(e);n.set(e,i),this.cachedBytes+=i}markUsed(e){const t=this.itemSet,n=this.usedSet;t.has(e)&&!n.has(e)&&(t.set(e,Date.now()),n.add(e))}markUnused(e){this.usedSet.delete(e)}markAllUnused(){this.usedSet.clear()}unloadUnusedContent(){const{unloadPercent:e,minSize:t,maxSize:n,itemList:i,itemSet:r,usedSet:s,loadedSet:o,callbacks:a,bytesMap:l,minBytesSize:c,maxBytesSize:u}=this,h=i.length-s.size,d=i.length-o.size,p=Math.max(Math.min(i.length-t,h),0),m=this.cachedBytes-c,f=this.unloadPriorityCallback||this.defaultPriorityCallback;let g=!1;const _=p>0&&h>0||d&&i.length>n;if(h&&this.cachedBytes>c||d&&this.cachedBytes>u||_){i.sort((e,t)=>{const n=s.has(e);if(n===s.has(t)){const n=o.has(e);return n===o.has(t)?-f(e,t):n?1:-1}return n?1:-1});const d=Math.max(t*e,p*e),_=Math.ceil(Math.min(d,h,p)),v=Math.max(e*m,e*c),y=Math.min(v,m);let b=0,w=0;for(;this.cachedBytes-w>u||i.length-b>n;){const e=i[b],t=l.get(e)||0;if(s.has(e)&&o.has(e)||this.cachedBytes-w-t<u&&i.length-b<=n)break;w+=t,b++}for(;w<y||b<_;){const e=i[b],t=l.get(e)||0;if(s.has(e)||this.cachedBytes-w-t<c&&b>=_)break;w+=t,b++}i.splice(0,b).forEach(e=>{this.cachedBytes-=l.get(e)||0,a.get(e)(e),l.delete(e),r.delete(e),a.delete(e),o.delete(e),s.delete(e)}),g=b<p||w<m&&b<h,g=g&&b>0}g&&(this.unloadingHandle=requestAnimationFrame(()=>this.scheduleUnload()))}scheduleUnload(){cancelAnimationFrame(this.unloadingHandle),this.scheduled||(this.scheduled=!0,queueMicrotask(()=>{this.scheduled=!1,this.unloadUnusedContent()}))}}class Eh{get running(){return 0!==this.items.length||0!==this.currJobs}constructor(){this.maxJobs=6,this.items=[],this.callbacks=new Map,this.currJobs=0,this.scheduled=!1,this.autoUpdate=!0,this.priorityCallback=()=>{throw new Error("PriorityQueue: PriorityCallback function not defined.")},this.schedulingCallback=e=>{requestAnimationFrame(e)},this._runjobs=()=>{this.scheduled=!1,this.tryRunJobs()}}sort(){const e=this.priorityCallback;this.items.sort(e)}has(e){return this.callbacks.has(e)}add(e,t){const n={callback:t,reject:null,resolve:null,promise:null};return n.promise=new Promise((t,i)=>{const r=this.items,s=this.callbacks;n.resolve=t,n.reject=i,r.push(e),s.set(e,n),this.autoUpdate&&this.scheduleJobRun()}),n.promise}remove(e){const t=this.items,n=this.callbacks,i=t.indexOf(e);if(-1!==i){const r=n.get(e);r.promise.catch(()=>{}),r.reject(new Error("PriorityQueue: Item removed.")),t.splice(i,1),n.delete(e)}}removeByFilter(e){const{items:t}=this;for(let n=0;n<t.length;n++){const i=t[n];e(i)&&this.remove(i)}}tryRunJobs(){this.sort();const e=this.items,t=this.callbacks,n=this.maxJobs;let i=0;const r=()=>{this.currJobs--,this.autoUpdate&&this.scheduleJobRun()};for(;n>this.currJobs&&e.length>0&&i<n;){this.currJobs++,i++;const n=e.pop(),{callback:s,resolve:o,reject:a}=t.get(n);let l;t.delete(n);try{l=s(n)}catch(Q){a(Q),r()}l instanceof Promise?l.then(o).catch(a).finally(r):(o(l),r())}}scheduleJobRun(){this.scheduled||(this.schedulingCallback(this._runjobs),this.scheduled=!0)}}const Ph=-1,Ah=6378137,Mh={inView:!1,error:1/0,distanceFromCamera:1/0};function Sh(e){return 3===e||e===Ph}function Ch(e,t){return e.__lastFrameVisited===t&&e.__used}function Rh(e){return e.__childrenProcessed===e.children.length}function Oh(e,t){e.__lastFrameVisited!==t.frameCount&&(e.__lastFrameVisited=t.frameCount,e.__used=!1,e.__inFrustum=!1,e.__isLeaf=!1,e.__visible=!1,e.__active=!1,e.__error=1/0,e.__distanceFromCamera=1/0,e.__childrenWereVisible=!1,e.__allChildrenLoaded=!1,t.calculateTileViewError(e,Mh),e.__inFrustum=Mh.inView,e.__error=Mh.error,e.__distanceFromCamera=Mh.distanceFromCamera)}function kh(e,t){if(t.ensureChildrenArePreprocessed(e),Oh(e,t),Ih(e,t),!e.__hasRenderableContent&&Rh(e)){const n=e.children;for(let e=0,i=n.length;e<i;e++)kh(n[e],t)}}function Lh(e,t){if(t.ensureChildrenArePreprocessed(e),Ch(e,t.frameCount)&&(e.__hasContent&&0===e.__loadingState&&!t.lruCache.isFull()&&t.queueTileForDownload(e),Rh(e))){const n=e.children;for(let e=0,i=n.length;e<i;e++)Lh(n[e],t)}}function Ih(e,t){e.__used||(e.__used=!0,t.markTileUsed(e),t.stats.used++,!0===e.__inFrustum&&t.stats.inFrustum++)}function Dh(e,t=null,n=null){const i=[];for(i.push(e),i.push(null),i.push(0);i.length>0;){const e=i.pop(),r=i.pop(),s=i.pop();if(t&&t(s,r,e))return void(n&&n(s,r,e));const o=s.children;if(o)for(let t=o.length-1;t>=0;t--)i.push(o[t]),i.push(s),i.push(e+1);n&&n(s,r,e)}}function Fh(e,t){if(t.ensureChildrenArePreprocessed(e),Oh(e,t),!e.__inFrustum)return;if(!function(e,t){return!(e.__error<=t.errorTarget||t.maxDepth>0&&e.__depth+1>=t.maxDepth||!Rh(e))}(e,t))return void Ih(e,t);let n=!1,i=!1;const r=e.children;for(let s=0,o=r.length;s<o;s++){const e=r[s];Fh(e,t),n=n||Ch(e,t.frameCount),i=i||e.__inFrustum}if(Ih(e,t),n&&"REPLACE"===e.refine)for(let s=0,o=r.length;s<o;s++){kh(r[s],t)}}function Uh(e,t){const n=t.frameCount;if(!Ch(e,n))return;const i=e.children;let r=!1;for(let s=0,o=i.length;s<o;s++){const e=i[s];r=r||Ch(e,n)}if(r){let r=!1,s=!0;for(let e=0,o=i.length;e<o;e++){const o=i[e];if(Uh(o,t),r=r||o.__wasSetVisible||o.__childrenWereVisible,Ch(o,n)){const e=o.__allChildrenLoaded||o.__hasRenderableContent&&Sh(o.__loadingState)||!o.__hasContent&&0===o.children.length||o.__hasUnrenderableContent&&o.__loadingState===Ph;s=s&&e}}e.__childrenWereVisible=r,e.__allChildrenLoaded=s}else e.__isLeaf=!0}function Nh(e,t){const n=t.stats;if(!Ch(e,t.frameCount))return;const i=t.lruCache;if(e.__isLeaf)return void(3===e.__loadingState?(e.__inFrustum&&(e.__visible=!0,n.visible++),e.__active=!0,n.active++):!i.isFull()&&e.__hasContent&&t.queueTileForDownload(e));const r=e.children,s=e.__hasContent,o=Sh(e.__loadingState)&&s,a=(t.errorTarget+1)*t.errorThreshold,l=e.__error<=a,c=e.__childrenWereVisible,u=e.__allChildrenLoaded;if((l||"ADD"===e.refine)&&!o&&!i.isFull()&&s&&t.queueTileForDownload(e),(l&&!u&&!c&&o||"ADD"===e.refine&&o)&&(e.__inFrustum&&(e.__visible=!0,n.visible++),e.__active=!0,n.active++),"REPLACE"===e.refine&&l&&!u)for(let h=0,d=r.length;h<d;h++){const e=r[h];Ch(e,t.frameCount)&&Lh(e,t)}else for(let h=0,d=r.length;h<d;h++)Nh(r[h],t)}function jh(e,t){const n=Ch(e,t.frameCount);if(n||e.__usedLastFrame){let i=!1,r=!1;n?(i=e.__active,r=t.displayActiveTiles&&e.__active||e.__visible):Oh(e,t),e.__hasRenderableContent&&3===e.__loadingState&&(e.__wasSetActive!==i&&t.invokeOnePlugin(t=>t.setTileActive&&t.setTileActive(e,i)),e.__wasSetVisible!==r&&t.invokeOnePlugin(t=>t.setTileVisible&&t.setTileVisible(e,r))),e.__wasSetActive=i,e.__wasSetVisible=r,e.__usedLastFrame=n;const s=e.children;for(let e=0,n=s.length;e<n;e++){jh(s[e],t)}}}const zh=Symbol("PLUGIN_REGISTERED"),Bh=(e,t)=>e.__depthFromRenderedParent!==t.__depthFromRenderedParent?e.__depthFromRenderedParent>t.__depthFromRenderedParent?-1:1:e.__inFrustum!==t.__inFrustum?e.__inFrustum?1:-1:e.__used!==t.__used?e.__used?1:-1:e.__error!==t.__error?e.__error>t.__error?1:-1:e.__distanceFromCamera!==t.__distanceFromCamera?e.__distanceFromCamera>t.__distanceFromCamera?-1:1:0,Vh=(e,t)=>e.__depthFromRenderedParent!==t.__depthFromRenderedParent?e.__depthFromRenderedParent>t.__depthFromRenderedParent?1:-1:e.__loadingState!==t.__loadingState?e.__loadingState>t.__loadingState?-1:1:e.__lastFrameVisited!==t.__lastFrameVisited?e.__lastFrameVisited>t.__lastFrameVisited?-1:1:e.__hasUnrenderableContent!==t.__hasUnrenderableContent?e.__hasUnrenderableContent?-1:1:e.__error!==t.__error?e.__error>t.__error?-1:1:0;class Hh{get root(){const e=this.rootTileSet;return e?e.root:null}get loadProgress(){const{stats:e,isLoading:t}=this,n=e.downloading+e.parsing,i=e.inCacheSinceLoad+(t?1:0);return 0===i?1:1-n/i}get errorThreshold(){return this._errorThreshold}set errorThreshold(e){console.warn('TilesRenderer: The "errorThreshold" option has been deprecated.'),this._errorThreshold=e}constructor(e=null){this.rootLoadingState=0,this.rootTileSet=null,this.rootURL=e,this.fetchOptions={},this.plugins=[],this.queuedTiles=[],this.cachedSinceLoadComplete=new Set,this.isLoading=!1;const t=new xh;t.unloadPriorityCallback=Vh;const n=new Eh;n.maxJobs=10,n.priorityCallback=Bh;const i=new Eh;i.maxJobs=1,i.priorityCallback=Bh;const r=new Eh;r.maxJobs=25,r.priorityCallback=Bh,r.log=!0,this.visibleTiles=new Set,this.activeTiles=new Set,this.usedSet=new Set,this.lruCache=t,this.downloadQueue=n,this.parseQueue=i,this.processNodeQueue=r,this.stats={inCacheSinceLoad:0,inCache:0,parsing:0,downloading:0,failed:0,inFrustum:0,used:0,active:0,visible:0},this.frameCount=0,this._dispatchNeedsUpdateEvent=function(e){let t=null;return()=>{null===t&&(t=requestAnimationFrame(()=>{t=null,e()}))}}(()=>{this.dispatchEvent({type:"needs-update"})}),this.errorTarget=16,this._errorThreshold=1/0,this.displayActiveTiles=!1,this.maxDepth=1/0}registerPlugin(e){if(!0===e[zh])throw new Error("TilesRendererBase: A plugin can only be registered to a single tile set");const t=this.plugins,n=e.priority||0;let i=t.length;for(let r=0;r<t.length;r++)if((t[r].priority||0)>n){i=r;break}t.splice(i,0,e),e[zh]=!0,e.init&&e.init(this)}unregisterPlugin(e){const t=this.plugins;if("string"==typeof e&&(e=this.getPluginByName(name)),t.includes(e)){const n=t.indexOf(e);return t.splice(n,1),e.dispose&&e.dispose(),!0}return!1}getPluginByName(e){return this.plugins.find(t=>t.name===e)||null}traverse(e,t,n=!0){this.root&&Dh(this.root,(t,...i)=>(n&&this.ensureChildrenArePreprocessed(t,!0),!!e&&e(t,...i)),t)}queueTileForDownload(e){0===e.__loadingState&&this.queuedTiles.push(e)}markTileUsed(e){this.usedSet.add(e),this.lruCache.markUsed(e)}update(){const{lruCache:e,usedSet:t,stats:n,root:i,downloadQueue:r,parseQueue:s,processNodeQueue:o}=this;if(0===this.rootLoadingState&&(this.rootLoadingState=1,this.invokeOnePlugin(e=>e.loadRootTileSet&&e.loadRootTileSet()).then(e=>{let t=this.rootURL;null!==t&&this.invokeAllPlugins(e=>t=e.preprocessURL?e.preprocessURL(t,null):t),this.rootLoadingState=3,this.rootTileSet=e,this.dispatchEvent({type:"needs-update"}),this.dispatchEvent({type:"load-content"}),this.dispatchEvent({type:"load-tile-set",tileSet:e,url:t})}).catch(e=>{this.rootLoadingState=Ph,console.error(e),this.rootTileSet=null,this.dispatchEvent({type:"load-error",tile:null,error:e,url:this.rootURL})})),!i)return;n.inFrustum=0,n.used=0,n.active=0,n.visible=0,this.frameCount++,t.forEach(t=>e.markUnused(t)),t.clear(),Fh(i,this),Uh(i,this),Nh(i,this),jh(i,this);const a=this.queuedTiles;a.sort(e.unloadPriorityCallback);for(let l=0,c=a.length;l<c&&!e.isFull();l++)this.requestTileContents(a[l]);a.length=0,e.scheduleUnload(),!1===(r.running||s.running||o.running)&&!0===this.isLoading&&(this.cachedSinceLoadComplete.clear(),n.inCacheSinceLoad=0,this.dispatchEvent({type:"tiles-load-end"}),this.isLoading=!1)}resetFailedTiles(){this.rootLoadingState===Ph&&(this.rootLoadingState=0);const e=this.stats;0!==e.failed&&(this.traverse(e=>{e.__loadingState===Ph&&(e.__loadingState=0)},null,!1),e.failed=0)}dispose(){[...this.plugins].forEach(e=>{this.unregisterPlugin(e)});const e=this.lruCache,t=[];this.traverse(e=>(t.push(e),!1),null,!1);for(let n=0,i=t.length;n<i;n++)e.remove(t[n]);this.stats={parsing:0,downloading:0,failed:0,inFrustum:0,used:0,active:0,visible:0},this.frameCount=0}dispatchEvent(e){}fetchData(e,t){return fetch(e,t)}parseTile(e,t,n){return null}disposeTile(e){e.__visible&&(this.invokeOnePlugin(t=>t.setTileVisible&&t.setTileVisible(e,!1)),e.__visible=!1),e.__active&&(this.invokeOnePlugin(t=>t.setTileActive&&t.setTileActive(e,!1)),e.__active=!1)}preprocessNode(e,t,n=null){if(e.content&&(!("uri"in e.content)&&"url"in e.content&&(e.content.uri=e.content.url,delete e.content.url),e.content.boundingVolume&&!("box"in e.content.boundingVolume||"sphere"in e.content.boundingVolume||"region"in e.content.boundingVolume)&&delete e.content.boundingVolume),e.parent=n,e.children=e.children||[],e.content?.uri){const t=wh(e.content.uri);e.__hasContent=!0,e.__hasUnrenderableContent=!(!t||!/json$/.test(t)),e.__hasRenderableContent=!e.__hasUnrenderableContent}else e.__hasContent=!1,e.__hasUnrenderableContent=!1,e.__hasRenderableContent=!1;e.__childrenProcessed=0,n&&n.__childrenProcessed++,e.__distanceFromCamera=1/0,e.__error=1/0,e.__inFrustum=!1,e.__isLeaf=!1,e.__usedLastFrame=!1,e.__used=!1,e.__wasSetVisible=!1,e.__visible=!1,e.__childrenWereVisible=!1,e.__allChildrenLoaded=!1,e.__wasSetActive=!1,e.__active=!1,e.__loadingState=0,null===n?(e.__depth=0,e.__depthFromRenderedParent=e.__hasRenderableContent?1:0,e.refine=e.refine||"REPLACE"):(e.__depth=n.__depth+1,e.__depthFromRenderedParent=n.__depthFromRenderedParent+(e.__hasRenderableContent?1:0),e.refine=e.refine||n.refine),e.__basePath=t,e.__lastFrameVisited=-1,this.invokeAllPlugins(i=>{i!==this&&i.preprocessNode&&i.preprocessNode(e,t,n)})}setTileActive(e,t){t?this.activeTiles.add(e):this.activeTiles.delete(e)}setTileVisible(e,t){t?this.visibleTiles.add(e):this.visibleTiles.delete(e)}calculateTileViewError(e,t){}ensureChildrenArePreprocessed(e,t=!1){const n=e.children;for(let i=0,r=n.length;i<r;i++){const r=n[i];if("__depth"in r)break;t?(this.processNodeQueue.remove(r),this.preprocessNode(r,e.__basePath,e)):this.processNodeQueue.has(r)||this.processNodeQueue.add(r,t=>{this.preprocessNode(t,e.__basePath,e),this._dispatchNeedsUpdateEvent()})}}preprocessTileSet(e,t,n=null){const i=e.asset.version,[r,s]=i.split(".").map(e=>parseInt(e));console.assert(r<=1,"TilesRenderer: asset.version is expected to be a 1.x or a compatible version."),1===r&&s>0&&console.warn("TilesRenderer: tiles versions at 1.1 or higher have limited support. Some new extensions and features may not be supported.");let o=t.replace(/\/[^/]*$/,"");o=new URL(o,window.location.href).toString(),this.preprocessNode(e.root,o,n)}loadRootTileSet(){let e=this.rootURL;return this.invokeAllPlugins(t=>e=t.preprocessURL?t.preprocessURL(e,null):e),this.invokeOnePlugin(t=>t.fetchData&&t.fetchData(e,this.fetchOptions)).then(t=>{if(t instanceof Response){if(t.ok)return t.json();throw new Error(`TilesRenderer: Failed to load tileset "${e}" with status ${t.status} : ${t.statusText}`)}return t}).then(t=>(this.preprocessTileSet(t,e),t))}requestTileContents(e){if(0!==e.__loadingState)return;let t=!1,n=null,i=new URL(e.content.uri,e.__basePath+"/").toString();this.invokeAllPlugins(t=>i=t.preprocessURL?t.preprocessURL(i,e):i);const r=this.stats,s=this.lruCache,o=this.downloadQueue,a=this.parseQueue,l=wh(i),c=new AbortController,u=c.signal;return s.add(e,n=>{c.abort(),t?(n.children.length=0,n.__childrenProcessed=0):this.invokeAllPlugins(e=>{e.disposeTile&&e.disposeTile(n)}),r.inCache--,this.cachedSinceLoadComplete.has(e)&&(this.cachedSinceLoadComplete.delete(e),r.inCacheSinceLoad--),1===n.__loadingState?r.downloading--:2===n.__loadingState&&r.parsing--,n.__loadingState=0,a.remove(n),o.remove(n)})?(this.isLoading||(this.isLoading=!0,this.dispatchEvent({type:"tiles-load-start"})),this.cachedSinceLoadComplete.add(e),r.inCacheSinceLoad++,r.inCache++,r.downloading++,e.__loadingState=1,o.add(e,t=>{if(u.aborted)return Promise.resolve();const n=this.invokeOnePlugin(e=>e.fetchData&&e.fetchData(i,{...this.fetchOptions,signal:u}));return this.dispatchEvent({type:"tile-download-start",tile:e}),n}).then(e=>{if(!u.aborted){if(e instanceof Response){if(e.ok)return"json"===l?e.json():e.arrayBuffer();throw new Error(`Failed to load model with error code ${e.status}`)}return e}}).then(s=>{if(!u.aborted)return r.downloading--,r.parsing++,e.__loadingState=2,a.add(e,r=>u.aborted?Promise.resolve():"json"===l&&s.root?(this.preprocessTileSet(s,i,e),e.children.push(s.root),n=s,t=!0,Promise.resolve()):this.invokeOnePlugin(e=>e.parseTile&&e.parseTile(s,r,l,i,u)))}).then(()=>{u.aborted||(r.parsing--,e.__loadingState=3,s.setLoaded(e,!0),null===s.getMemoryUsage(e)&&(s.isFull()&&s.computeMemoryUsageCallback(e)>0?s.remove(e):s.updateMemoryUsage(e)),this.dispatchEvent({type:"needs-update"}),this.dispatchEvent({type:"load-content"}),t&&this.dispatchEvent({type:"load-tile-set",tileSet:n,url:i}),e.cached.scene&&this.dispatchEvent({type:"load-model",scene:e.cached.scene,tile:e}))}).catch(t=>{u.aborted||("AbortError"!==t.name?(a.remove(e),o.remove(e),2===e.__loadingState?r.parsing--:1===e.__loadingState&&r.downloading--,r.failed++,console.error(`TilesRenderer : Failed to load tile at url "${e.content.uri}".`),console.error(t),e.__loadingState=Ph,s.setLoaded(e,!0),this.dispatchEvent({type:"load-error",tile:e,error:t,url:i})):s.remove(e))})):void 0}getAttributions(e=[]){return this.invokeAllPlugins(t=>t!==this&&t.getAttributions&&t.getAttributions(e)),e}invokeOnePlugin(e){const t=[...this.plugins,this];for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}invokeAllPlugins(e){const t=[...this.plugins,this],n=[];for(let i=0;i<t.length;i++){const r=e(t[i]);r&&n.push(r)}return 0===n.length?null:Promise.all(n)}}const Gh=new TextDecoder;function Wh(e){return Gh.decode(e)}function Kh(e,t,n,i,r,s){let o,a;switch(i){case"SCALAR":o=1;break;case"VEC2":o=2;break;case"VEC3":o=3;break;case"VEC4":o=4;break;default:throw new Error(`FeatureTable : Feature type not provided for "${s}".`)}const l=n*o;switch(r){case"BYTE":a=new Int8Array(e,t,l);break;case"UNSIGNED_BYTE":a=new Uint8Array(e,t,l);break;case"SHORT":a=new Int16Array(e,t,l);break;case"UNSIGNED_SHORT":a=new Uint16Array(e,t,l);break;case"INT":a=new Int32Array(e,t,l);break;case"UNSIGNED_INT":a=new Uint32Array(e,t,l);break;case"FLOAT":a=new Float32Array(e,t,l);break;case"DOUBLE":a=new Float64Array(e,t,l);break;default:throw new Error(`FeatureTable : Feature component type not provided for "${s}".`)}return a}class Xh{constructor(e,t,n,i){this.buffer=e,this.binOffset=t+n,this.binLength=i;let r=null;if(0!==n){const i=new Uint8Array(e,t,n);r=JSON.parse(Wh(i))}else r={};this.header=r}getKeys(){return Object.keys(this.header)}getData(e,t,n=null,i=null){const r=this.header;if(!(e in r))return null;const s=r[e];if(s instanceof Object){if(Array.isArray(s))return s;{const{buffer:r,binOffset:o,binLength:a}=this,l=s.byteOffset||0,c=s.type||i,u=s.componentType||n;if("type"in s&&i&&s.type!==i)throw new Error("FeatureTable: Specified type does not match expected type.");const h=o+l,d=Kh(r,h,t,c,u,e);if(h+d.byteLength>o+a)throw new Error("FeatureTable: Feature data read outside binary body length.");return d}}return s}getBuffer(e,t){const{buffer:n,binOffset:i}=this;return n.slice(i+e,i+e+t)}}class qh{constructor(e){this.batchTable=e;const t=e.header.extensions["3DTILES_batch_table_hierarchy"];this.classes=t.classes;for(const i of this.classes){const e=i.instances;for(const t in e)i.instances[t]=this._parseProperty(e[t],i.length,t)}if(this.instancesLength=t.instancesLength,this.classIds=this._parseProperty(t.classIds,this.instancesLength,"classIds"),t.parentCounts?this.parentCounts=this._parseProperty(t.parentCounts,this.instancesLength,"parentCounts"):this.parentCounts=new Array(this.instancesLength).fill(1),t.parentIds){const e=this.parentCounts.reduce((e,t)=>e+t,0);this.parentIds=this._parseProperty(t.parentIds,e,"parentIds")}else this.parentIds=null;this.instancesIds=[];const n={};for(const i of this.classIds)n[i]=n[i]??0,this.instancesIds.push(n[i]),n[i]++}_parseProperty(e,t,n){if(Array.isArray(e))return e;{const{buffer:i,binOffset:r}=this.batchTable;return Kh(i,r+e.byteOffset,t,"SCALAR",e.componentType||"UNSIGNED_SHORT",n)}}getDataFromId(e,t={}){const n=this.parentCounts[e];if(this.parentIds&&n>0){let i=0;for(let t=0;t<e;t++)i+=this.parentCounts[t];for(let r=0;r<n;r++){const n=this.parentIds[i+r];n!==e&&this.getDataFromId(n,t)}}const i=this.classIds[e],r=this.classes[i].instances,s=this.classes[i].name,o=this.instancesIds[e];for(const a in r)t[s]=t[s]||{},t[s][a]=r[a][o];return t}}class Yh extends Xh{get batchSize(){return console.warn("BatchTable.batchSize has been deprecated and replaced with BatchTable.count."),this.count}constructor(e,t,n,i,r){super(e,n,i,r),this.count=t,this.extensions={};const s=this.header.extensions;s&&s["3DTILES_batch_table_hierarchy"]&&(this.extensions["3DTILES_batch_table_hierarchy"]=new qh(this))}getData(e,t=null,n=null){return console.warn("BatchTable: BatchTable.getData is deprecated. Use BatchTable.getDataFromId to get allproperties for an id or BatchTable.getPropertyArray for getting an array of value for a property."),super.getData(e,this.count,t,n)}getDataFromId(e,t={}){if(e<0||e>=this.count)throw new Error(`BatchTable: id value "${e}" out of bounds for "${this.count}" features number.`);for(const n of this.getKeys())"extensions"!==n&&(t[n]=super.getData(n,this.count)[e]);for(const n in this.extensions){const i=this.extensions[n];i.getDataFromId instanceof Function&&(t[n]=t[n]||{},i.getDataFromId(e,t[n]))}return t}getPropertyArray(e){return super.getData(e,this.count)}}class $h{constructor(){this.fetchOptions={},this.workingPath=""}load(...e){return console.warn('Loader: "load" function has been deprecated in favor of "loadAsync".'),this.loadAsync(...e)}loadAsync(e){return fetch(e,this.fetchOptions).then(t=>{if(!t.ok)throw new Error(`Failed to load file "${e}" with status ${t.status} : ${t.statusText}`);return t.arrayBuffer()}).then(t=>(""===this.workingPath&&(this.workingPath=this.workingPathForURL(e)),this.parse(t)))}resolveExternalURL(e){return/^[^\\/]/.test(e)&&!/^http/.test(e)?this.workingPath+"/"+e:e}workingPathForURL(e){const t=e.split(/[\\/]/g);return t.pop(),t.join("/")+"/"}parse(e){throw new Error("LoaderBase: Parse not implemented.")}}function Zh(e){if(null===e||e.byteLength<4)return"";let t;if(t=e instanceof DataView?e:new DataView(e),"{"===String.fromCharCode(t.getUint8(0)))return null;let n="";for(let i=0;i<4;i++)n+=String.fromCharCode(t.getUint8(i));return n}class Qh extends $h{parse(e){const t=new DataView(e),n=Zh(t);console.assert("b3dm"===n);const i=t.getUint32(4,!0);console.assert(1===i);const r=t.getUint32(8,!0);console.assert(r===e.byteLength);const s=t.getUint32(12,!0),o=t.getUint32(16,!0),a=t.getUint32(20,!0),l=t.getUint32(24,!0),c=e.slice(28,28+s+o),u=new Xh(c,0,s,o),h=28+s+o,d=e.slice(h,h+a+l),p=new Yh(d,u.getData("BATCH_LENGTH"),0,a,l),m=h+a+l;return{version:i,featureTable:u,batchTable:p,glbBytes:new Uint8Array(e,m,r-m)}}}function Jh(e,t){if(t===el)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===tl||t===nl){let n=e.getIndex();if(null===n){const t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const i=n.count-2,r=[];if(t===tl)for(let e=1;e<=i;e++)r.push(n.getX(0)),r.push(n.getX(e)),r.push(n.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(r.push(n.getX(e)),r.push(n.getX(e+1)),r.push(n.getX(e+2))):(r.push(n.getX(e+2)),r.push(n.getX(e+1)),r.push(n.getX(e)));r.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=e.clone();return s.setIndex(r),s.clearGroups(),s}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}let ed=class extends il{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new od(e)}),this.register(function(e){return new ad(e)}),this.register(function(e){return new gd(e)}),this.register(function(e){return new _d(e)}),this.register(function(e){return new vd(e)}),this.register(function(e){return new cd(e)}),this.register(function(e){return new ud(e)}),this.register(function(e){return new hd(e)}),this.register(function(e){return new dd(e)}),this.register(function(e){return new sd(e)}),this.register(function(e){return new pd(e)}),this.register(function(e){return new ld(e)}),this.register(function(e){return new fd(e)}),this.register(function(e){return new md(e)}),this.register(function(e){return new id(e)}),this.register(function(e){return new yd(e)}),this.register(function(e){return new bd(e)})}load(e,t,n,i){const r=this;let s;if(""!==this.resourcePath)s=this.resourcePath;else if(""!==this.path){const t=rl.extractUrlBase(e);s=rl.resolveURL(t,this.path)}else s=rl.extractUrlBase(e);this.manager.itemStart(e);const o=function(t){i?i(t):console.error(t),r.manager.itemError(e),r.manager.itemEnd(e)},a=new sl(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(n){try{r.parse(n,s,function(n){t(n),r.manager.itemEnd(e)},o)}catch(i){o(i)}},n,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let r;const s={},o={},a=new TextDecoder;if("string"==typeof e)r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(a.decode(new Uint8Array(e,0,4))===wd){try{s[nd.KHR_BINARY_GLTF]=new Ed(e)}catch(Q){return void(i&&i(Q))}r=JSON.parse(s[nd.KHR_BINARY_GLTF].content)}else r=JSON.parse(a.decode(e));else r=e;if(void 0===r.asset||r.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new $d(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const e=this.pluginCallbacks[c](l);e.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[e.name]=e,s[e.name]=!0}if(r.extensionsUsed)for(let c=0;c<r.extensionsUsed.length;++c){const e=r.extensionsUsed[c],t=r.extensionsRequired||[];switch(e){case nd.KHR_MATERIALS_UNLIT:s[e]=new rd;break;case nd.KHR_DRACO_MESH_COMPRESSION:s[e]=new Pd(r,this.dracoLoader);break;case nd.KHR_TEXTURE_TRANSFORM:s[e]=new Ad;break;case nd.KHR_MESH_QUANTIZATION:s[e]=new Md;break;default:t.indexOf(e)>=0&&void 0===o[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}l.setExtensions(s),l.setPlugins(o),l.parse(n,i)}parseAsync(e,t){const n=this;return new Promise(function(i,r){n.parse(e,t,i,r)})}};function td(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const nd={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};let id=class{constructor(e){this.parser=e,this.name=nd.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const i=t[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const r=t.json,s=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let o;const a=new Ha(16777215);void 0!==s.color&&a.setRGB(s.color[0],s.color[1],s.color[2],al);const l=void 0!==s.range?s.range:0;switch(s.type){case"directional":o=new hl(a),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new ul(a),o.distance=l;break;case"spot":o=new cl(a),o.distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,o.angle=s.spot.outerConeAngle,o.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return o.position.set(0,0,0),Gd(o,s),void 0!==s.intensity&&(o.intensity=s.intensity),o.name=t.createUniqueName(s.name||"light_"+e),i=Promise.resolve(o),t.cache.add(n,i),i}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,i=n.json.nodes[e],r=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then(function(e){return n._getNodeRef(t.cache,r,e)})}},rd=class{constructor(){this.name=nd.KHR_MATERIALS_UNLIT}getMaterialType(){return Ya}extendParams(e,t,n){const i=[];e.color=new Ha(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const t=r.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],al),e.opacity=t[3]}void 0!==r.baseColorTexture&&i.push(n.assignTexture(e,"map",r.baseColorTexture,ll))}return Promise.all(i)}},sd=class{constructor(e){this.parser=e,this.name=nd.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return void 0!==i&&(t.emissiveIntensity=i),Promise.resolve()}},od=class{constructor(e){this.parser=e,this.name=nd.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ol:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];if(void 0!==s.clearcoatFactor&&(t.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&r.push(n.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(r.push(n.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){const e=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Oa(e,e)}return Promise.all(r)}},ad=class{constructor(e){this.parser=e,this.name=nd.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ol:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.dispersion=void 0!==i.dispersion?i.dispersion:0,Promise.resolve()}},ld=class{constructor(e){this.parser=e,this.name=nd.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ol:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.iridescenceFactor&&(t.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&r.push(n.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(t.iridescenceIOR=s.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&r.push(n.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(r)}},cd=class{constructor(e){this.parser=e,this.name=nd.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ol:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new Ha(0,0,0),t.sheenRoughness=0,t.sheen=1;const s=i.extensions[this.name];if(void 0!==s.sheenColorFactor){const e=s.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],al)}return void 0!==s.sheenRoughnessFactor&&(t.sheenRoughness=s.sheenRoughnessFactor),void 0!==s.sheenColorTexture&&r.push(n.assignTexture(t,"sheenColorMap",s.sheenColorTexture,ll)),void 0!==s.sheenRoughnessTexture&&r.push(n.assignTexture(t,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(r)}},ud=class{constructor(e){this.parser=e,this.name=nd.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ol:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&r.push(n.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(r)}},hd=class{constructor(e){this.parser=e,this.name=nd.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ol:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];t.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&r.push(n.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||1/0;const o=s.attenuationColor||[1,1,1];return t.attenuationColor=(new Ha).setRGB(o[0],o[1],o[2],al),Promise.all(r)}},dd=class{constructor(e){this.parser=e,this.name=nd.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ol:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}},pd=class{constructor(e){this.parser=e,this.name=nd.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ol:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];t.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&r.push(n.assignTexture(t,"specularIntensityMap",s.specularTexture));const o=s.specularColorFactor||[1,1,1];return t.specularColor=(new Ha).setRGB(o[0],o[1],o[2],al),void 0!==s.specularColorTexture&&r.push(n.assignTexture(t,"specularColorMap",s.specularColorTexture,ll)),Promise.all(r)}},md=class{constructor(e){this.parser=e,this.name=nd.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ol:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return t.bumpScale=void 0!==s.bumpFactor?s.bumpFactor:1,void 0!==s.bumpTexture&&r.push(n.assignTexture(t,"bumpMap",s.bumpTexture)),Promise.all(r)}},fd=class{constructor(e){this.parser=e,this.name=nd.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ol:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.anisotropyStrength&&(t.anisotropy=s.anisotropyStrength),void 0!==s.anisotropyRotation&&(t.anisotropyRotation=s.anisotropyRotation),void 0!==s.anisotropyTexture&&r.push(n.assignTexture(t,"anisotropyMap",s.anisotropyTexture)),Promise.all(r)}},gd=class{constructor(e){this.parser=e,this.name=nd.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const r=i.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,s)}},_d=class{constructor(e){this.parser=e,this.name=nd.EXT_TEXTURE_WEBP}loadTexture(e){const t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;const s=r.extensions[t],o=i.images[s.source];let a=n.textureLoader;if(o.uri){const e=n.options.manager.getHandler(o.uri);null!==e&&(a=e)}return n.loadTextureImage(e,s.source,a)}},vd=class{constructor(e){this.parser=e,this.name=nd.EXT_TEXTURE_AVIF}loadTexture(e){const t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;const s=r.extensions[t],o=i.images[s.source];let a=n.textureLoader;if(o.uri){const e=n.options.manager.getHandler(o.uri);null!==e&&(a=e)}return n.loadTextureImage(e,s.source,a)}},yd=class{constructor(e){this.name=nd.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],i=this.parser.getDependency("buffer",e.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(t){const n=e.byteOffset||0,i=e.byteLength||0,s=e.count,o=e.byteStride,a=new Uint8Array(t,n,i);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(s,o,a,e.mode,e.filter).then(function(e){return e.buffer}):r.ready.then(function(){const t=new ArrayBuffer(s*o);return r.decodeGltfBuffer(new Uint8Array(t),s,o,a,e.mode,e.filter),t})})}return null}},bd=class{constructor(e){this.name=nd.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;const i=t.meshes[n.mesh];for(const a of i.primitives)if(a.mode!==Od.TRIANGLES&&a.mode!==Od.TRIANGLE_STRIP&&a.mode!==Od.TRIANGLE_FAN&&void 0!==a.mode)return null;const r=n.extensions[this.name].attributes,s=[],o={};for(const a in r)s.push(this.parser.getDependency("accessor",r[a]).then(e=>(o[a]=e,o[a])));return s.length<1?null:(s.push(this.parser.createNodeMesh(e)),Promise.all(s).then(e=>{const t=e.pop(),n=t.isGroup?t.children:[t],i=e[0].count,r=[];for(const s of n){const e=new La,t=new ka,n=new Da,a=new ka(1,1,1),l=new dl(s.geometry,s.material,i);for(let r=0;r<i;r++)o.TRANSLATION&&t.fromBufferAttribute(o.TRANSLATION,r),o.ROTATION&&n.fromBufferAttribute(o.ROTATION,r),o.SCALE&&a.fromBufferAttribute(o.SCALE,r),l.setMatrixAt(r,e.compose(t,n,a));for(const i in o)if("_COLOR_0"===i){const e=o[i];l.instanceColor=new pl(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==i&&"ROTATION"!==i&&"SCALE"!==i&&s.geometry.setAttribute(i,o[i]);Ra.prototype.copy.call(l,s),this.parser.assignFinalMaterial(l),r.push(l)}return t.isGroup?(t.clear(),t.add(...r),t):r[0]}))}};const wd="glTF",Td=1313821514,xd=5130562;let Ed=class{constructor(e){this.name=nd.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==wd)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-12,r=new DataView(e,12);let s=0;for(;s<i;){const t=r.getUint32(s,!0);s+=4;const i=r.getUint32(s,!0);if(s+=4,i===Td){const i=new Uint8Array(e,12+s,t);this.content=n.decode(i)}else if(i===xd){const n=12+s;this.body=e.slice(n,n+t)}s+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}},Pd=class{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=nd.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,o={},a={},l={};for(const c in s){const e=Fd[c]||c.toLowerCase();o[e]=s[c]}for(const c in e.attributes){const t=Fd[c]||c.toLowerCase();if(void 0!==s[c]){const i=n.accessors[e.attributes[c]],r=kd[i.componentType];l[t]=r.name,a[t]=!0===i.normalized}}return t.getDependency("bufferView",r).then(function(e){return new Promise(function(t,n){i.decodeDracoFile(e,function(e){for(const t in e.attributes){const n=e.attributes[t],i=a[t];void 0!==i&&(n.normalized=i)}t(e)},o,l,al,n)})})}},Ad=class{constructor(){this.name=nd.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(void 0===t.texCoord||t.texCoord===e.channel)&&void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}},Md=class{constructor(){this.name=nd.KHR_MESH_QUANTIZATION}},Sd=class extends Wl{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i*3+i;for(let s=0;s!==i;s++)t[s]=n[r+s];return t}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,c=i-t,u=(n-t)/c,h=u*u,d=h*u,p=e*l,m=p-l,f=-2*d+3*h,g=d-h,_=1-f,v=g-h+u;for(let y=0;y!==o;y++){const e=s[m+y+o],t=s[m+y+a]*c,n=s[p+y+o],i=s[p+y]*c;r[y]=_*e+v*t+f*n+g*i}return r}};const Cd=new Da;let Rd=class extends Sd{interpolate_(e,t,n,i){const r=super.interpolate_(e,t,n,i);return Cd.fromArray(r).normalize().toArray(r),r}};const Od={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},kd={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ld={9728:Tl,9729:wl,9984:bl,9985:yl,9986:vl,9987:_l},Id={33071:Pl,33648:El,10497:xl},Dd={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Fd={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ud={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Nd={CUBICSPLINE:void 0,LINEAR:Nl,STEP:Ul},jd="OPAQUE",zd="MASK",Bd="BLEND";function Vd(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new Ml({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Gl})),e.DefaultMaterial}function Hd(e,t,n){for(const i in n.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=n.extensions[i])}function Gd(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Wd(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,i=t.weights.length;n<i;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,i=n.length;t<i;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Kd(e){let t;const n=e.extensions&&e.extensions[nd.KHR_DRACO_MESH_COMPRESSION];if(t=n?"draco:"+n.bufferView+":"+n.indices+":"+Xd(n.attributes):e.indices+":"+Xd(e.attributes)+":"+e.mode,void 0!==e.targets)for(let i=0,r=e.targets.length;i<r;i++)t+=":"+Xd(e.targets[i]);return t}function Xd(e){let t="";const n=Object.keys(e).sort();for(let i=0,r=n.length;i<r;i++)t+=n[i]+":"+e[n[i]]+";";return t}function qd(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const Yd=new La;let $d=class{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new td,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,i=-1,r=!1,s=-1;if(typeof navigator<"u"){const e=navigator.userAgent;n=!0===/^((?!chrome|android).)*safari/i.test(e);const t=e.match(/Version\/(\d+)/);i=n&&t?parseInt(t[1],10):-1,r=e.indexOf("Firefox")>-1,s=r?e.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||n&&i<17||r&&s<98?this.textureLoader=new ja(this.options.manager):this.textureLoader=new ml(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new sl(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(t){const s={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:n,userData:{}};return Hd(r,s,i),Gd(s,i),Promise.all(n._invokeAll(function(e){return e.afterRoot&&e.afterRoot(s)})).then(function(){for(const e of s.scenes)e.updateMatrixWorld();e(s)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let i=0,r=t.length;i<r;i++){const n=t[i].joints;for(let t=0,i=n.length;t<i;t++)e[n[t]].isBone=!0}for(let i=0,r=e.length;i<r;i++){const t=e[i];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(n[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),r=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[i,s]of e.children.entries())r(s,t.children[i])};return r(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const r=e(t[i]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(e){return e.loadNode&&e.loadNode(t)});break;case"mesh":i=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map(function(t,i){return n.getDependency(e,i)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[nd.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(e,r){n.load(rl.resolveURL(t.uri,i.path),e,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){const n=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+n)})}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse){const e=Dd[i.type],t=kd[i.componentType],n=!0===i.normalized,r=new t(i.count*e);return Promise.resolve(new Qa(r,e,n))}const r=[];return void 0!==i.bufferView?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),void 0!==i.sparse&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then(function(e){const r=e[0],s=Dd[i.type],o=kd[i.componentType],a=o.BYTES_PER_ELEMENT,l=a*s,c=i.byteOffset||0,u=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,h=!0===i.normalized;let d,p;if(u&&u!==l){const e=Math.floor(c/u),n="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count;let l=t.cache.get(n);l||(d=new o(r,e*u,i.count*u/a),l=new fl(d,u/a),t.cache.add(n,l)),p=new gl(l,s,c%u/a,h)}else d=null===r?new o(i.count*s):new o(r,c,i.count*s),p=new Qa(d,s,h);if(void 0!==i.sparse){const t=Dd.SCALAR,n=kd[i.sparse.indices.componentType],a=i.sparse.indices.byteOffset||0,l=i.sparse.values.byteOffset||0,c=new n(e[1],a,i.sparse.count*t),u=new o(e[2],l,i.sparse.count*s);null!==r&&(p=new Qa(p.array.slice(),p.itemSize,p.normalized)),p.normalized=!1;for(let e=0,i=c.length;e<i;e++){const t=c[e];if(p.setX(t,u[e*s]),s>=2&&p.setY(t,u[e*s+1]),s>=3&&p.setZ(t,u[e*s+2]),s>=4&&p.setW(t,u[e*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}p.normalized=h}return p})}loadTexture(e){const t=this.json,n=this.options,i=t.textures[e].source,r=t.images[i];let s=this.textureLoader;if(r.uri){const e=n.manager.getHandler(r.uri);null!==e&&(s=e)}return this.loadTextureImage(e,i,s)}loadTextureImage(e,t,n){const i=this,r=this.json,s=r.textures[e],o=r.images[t],a=(o.uri||o.bufferView)+":"+s.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(t,n).then(function(t){t.flipY=!1,t.name=s.name||o.name||"",""===t.name&&"string"==typeof o.uri&&!1===o.uri.startsWith("data:image/")&&(t.name=o.uri);const n=(r.samplers||{})[s.sampler]||{};return t.magFilter=Ld[n.magFilter]||wl,t.minFilter=Ld[n.minFilter]||_l,t.wrapS=Id[n.wrapS]||xl,t.wrapT=Id[n.wrapT]||xl,t.generateMipmaps=!t.isCompressedTexture&&t.minFilter!==Tl&&t.minFilter!==wl,i.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[a]=l,l}loadImageSource(e,t){const n=this.json,i=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());const r=n.images[e],s=self.URL||self.webkitURL;let o=r.uri||"",a=!1;if(void 0!==r.bufferView)o=this.getDependency("bufferView",r.bufferView).then(function(e){a=!0;const t=new Blob([e],{type:r.mimeType});return o=s.createObjectURL(t),o});else if(void 0===r.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const l=Promise.resolve(o).then(function(e){return new Promise(function(n,r){let s=n;!0===t.isImageBitmapLoader&&(s=function(e){const t=new jl(e);t.needsUpdate=!0,n(t)}),t.load(rl.resolveURL(e,i.path),s,void 0,r)})}).then(function(e){return!0===a&&s.revokeObjectURL(o),Gd(e,r),e.userData.mimeType=r.mimeType||((t=r.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":t.search(/\.ktx2($|\?)/i)>0||0===t.search(/^data\:image\/ktx2/)?"image/ktx2":"image/png"),e;var t}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),e});return this.sourceCache[e]=l,l}assignTexture(e,t,n,i){const r=this;return this.getDependency("texture",n.index).then(function(s){if(!s)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((s=s.clone()).channel=n.texCoord),r.extensions[nd.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[nd.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=r.associations.get(s);s=r.extensions[nd.KHR_TEXTURE_TRANSFORM].extendTexture(s,e),r.associations.set(s,t)}}return void 0!==i&&(s.colorSpace=i),e[t]=s,s})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=void 0===t.attributes.tangent,r=void 0!==t.attributes.color,s=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new Na,Al.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new Ga,Al.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,this.cache.add(e,t)),n=t}if(i||r||s){let e="ClonedMaterial:"+n.uuid+":";i&&(e+="derivative-tangents:"),r&&(e+="vertex-colors:"),s&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),r&&(t.vertexColors=!0),s&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}e.material=n}getMaterialType(){return Ml}loadMaterial(e){const t=this,n=this.json,i=this.extensions,r=n.materials[e];let s;const o={},a=[];if((r.extensions||{})[nd.KHR_MATERIALS_UNLIT]){const e=i[nd.KHR_MATERIALS_UNLIT];s=e.getMaterialType(),a.push(e.extendParams(o,r,t))}else{const n=r.pbrMetallicRoughness||{};if(o.color=new Ha(1,1,1),o.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;o.color.setRGB(e[0],e[1],e[2],al),o.opacity=e[3]}void 0!==n.baseColorTexture&&a.push(t.assignTexture(o,"map",n.baseColorTexture,ll)),o.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,o.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(a.push(t.assignTexture(o,"metalnessMap",n.metallicRoughnessTexture)),a.push(t.assignTexture(o,"roughnessMap",n.metallicRoughnessTexture))),s=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),a.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,o)})))}!0===r.doubleSided&&(o.side=$a);const l=r.alphaMode||jd;if(l===Bd?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,l===zd&&(o.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&s!==Ya&&(a.push(t.assignTexture(o,"normalMap",r.normalTexture)),o.normalScale=new Oa(1,1),void 0!==r.normalTexture.scale)){const e=r.normalTexture.scale;o.normalScale.set(e,e)}if(void 0!==r.occlusionTexture&&s!==Ya&&(a.push(t.assignTexture(o,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(o.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&s!==Ya){const e=r.emissiveFactor;o.emissive=(new Ha).setRGB(e[0],e[1],e[2],al)}return void 0!==r.emissiveTexture&&s!==Ya&&a.push(t.assignTexture(o,"emissiveMap",r.emissiveTexture,ll)),Promise.all(a).then(function(){const n=new s(o);return r.name&&(n.name=r.name),Gd(n,r),t.associations.set(n,{materials:e}),r.extensions&&Hd(i,n,r),n})}createUniqueName(e){const t=Sl.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,i=this.primitiveCache;function r(e){return n[nd.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(n){return Zd(n,e,t)})}const s=[];for(let o=0,a=e.length;o<a;o++){const n=e[o],a=Kd(n),l=i[a];if(l)s.push(l.promise);else{let e;e=n.extensions&&n.extensions[nd.KHR_DRACO_MESH_COMPRESSION]?r(n):Zd(new za,n,t),i[a]={primitive:n,promise:e},s.push(e)}}return Promise.all(s)}loadMesh(e){const t=this,n=this.json,i=this.extensions,r=n.meshes[e],s=r.primitives,o=[];for(let a=0,l=s.length;a<l;a++){const e=void 0===s[a].material?Vd(this.cache):this.getDependency("material",s[a].material);o.push(e)}return o.push(t.loadGeometries(s)),Promise.all(o).then(function(n){const o=n.slice(0,n.length-1),a=n[n.length-1],l=[];for(let u=0,h=a.length;u<h;u++){const n=a[u],c=s[u];let h;const d=o[u];if(c.mode===Od.TRIANGLES||c.mode===Od.TRIANGLE_STRIP||c.mode===Od.TRIANGLE_FAN||void 0===c.mode)h=!0===r.isSkinnedMesh?new Cl(n,d):new Za(n,d),!0===h.isSkinnedMesh&&h.normalizeSkinWeights(),c.mode===Od.TRIANGLE_STRIP?h.geometry=Jh(h.geometry,nl):c.mode===Od.TRIANGLE_FAN&&(h.geometry=Jh(h.geometry,tl));else if(c.mode===Od.LINES)h=new Rl(n,d);else if(c.mode===Od.LINE_STRIP)h=new Wa(n,d);else if(c.mode===Od.LINE_LOOP)h=new Ol(n,d);else{if(c.mode!==Od.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);h=new Va(n,d)}Object.keys(h.geometry.morphAttributes).length>0&&Wd(h,r),h.name=t.createUniqueName(r.name||"mesh_"+e),Gd(h,r),c.extensions&&Hd(i,h,c),t.assignFinalMaterial(h),l.push(h)}for(let i=0,r=l.length;i<r;i++)t.associations.set(l[i],{meshes:e,primitives:i});if(1===l.length)return r.extensions&&Hd(i,l[0],r),l[0];const c=new Ua;r.extensions&&Hd(i,c,r),t.associations.set(c,{meshes:e});for(let e=0,t=l.length;e<t;e++)c.add(l[e]);return c})}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(i)return"perspective"===n.type?t=new kl(Ia.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(t=new Ll(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Gd(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n=[];for(let i=0,r=t.joints.length;i<r;i++)n.push(this._loadNodeShallow(t.joints[i]));return void 0!==t.inverseBindMatrices?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(e){const n=e.pop(),i=e,r=[],s=[];for(let o=0,a=i.length;o<a;o++){const e=i[o];if(e){r.push(e);const t=new La;null!==n&&t.fromArray(n.array,16*o),s.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}return new Il(r,s)})}loadAnimation(e){const t=this.json,n=this,i=t.animations[e],r=i.name?i.name:"animation_"+e,s=[],o=[],a=[],l=[],c=[];for(let u=0,h=i.channels.length;u<h;u++){const e=i.channels[u],t=i.samplers[e.sampler],n=e.target,r=n.node,h=void 0!==i.parameters?i.parameters[t.input]:t.input,d=void 0!==i.parameters?i.parameters[t.output]:t.output;void 0!==n.node&&(s.push(this.getDependency("node",r)),o.push(this.getDependency("accessor",h)),a.push(this.getDependency("accessor",d)),l.push(t),c.push(n))}return Promise.all([Promise.all(s),Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c)]).then(function(e){const t=e[0],s=e[1],o=e[2],a=e[3],l=e[4],c=[];for(let i=0,r=t.length;i<r;i++){const e=t[i],r=s[i],u=o[i],h=a[i],d=l[i];if(void 0===e)continue;e.updateMatrix&&e.updateMatrix();const p=n._createAnimationTracks(e,r,u,h,d);if(p)for(let t=0;t<p.length;t++)c.push(p[t])}const u=new Dl(r,void 0,c);return Gd(u,i),u})}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then(function(e){const t=n._getNodeRef(n.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,n=i.weights.length;t<n;t++)e.morphTargetInfluences[t]=i.weights[t]}),t})}loadNode(e){const t=this,n=this.json.nodes[e],i=t._loadNodeShallow(e),r=[],s=n.children||[];for(let a=0,l=s.length;a<l;a++)r.push(t.getDependency("node",s[a]));const o=void 0===n.skin?Promise.resolve(null):t.getDependency("skin",n.skin);return Promise.all([i,Promise.all(r),o]).then(function(e){const t=e[0],n=e[1],i=e[2];null!==i&&t.traverse(function(e){e.isSkinnedMesh&&e.bind(i,Yd)});for(let r=0,s=n.length;r<s;r++)t.add(n[r]);return t})}_loadNodeShallow(e){const t=this.json,n=this.extensions,i=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const r=t.nodes[e],s=r.name?i.createUniqueName(r.name):"",o=[],a=i._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return a&&o.push(a),void 0!==r.camera&&o.push(i.getDependency("camera",r.camera).then(function(e){return i._getNodeRef(i.cameraCache,r.camera,e)})),i._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){o.push(e)}),this.nodeCache[e]=Promise.all(o).then(function(t){let o;if(o=!0===r.isBone?new Fl:t.length>1?new Ua:1===t.length?t[0]:new Ra,o!==t[0])for(let e=0,n=t.length;e<n;e++)o.add(t[e]);if(r.name&&(o.userData.name=r.name,o.name=s),Gd(o,r),r.extensions&&Hd(n,o,r),void 0!==r.matrix){const e=new La;e.fromArray(r.matrix),o.applyMatrix4(e)}else void 0!==r.translation&&o.position.fromArray(r.translation),void 0!==r.rotation&&o.quaternion.fromArray(r.rotation),void 0!==r.scale&&o.scale.fromArray(r.scale);if(i.associations.has(o)){if(void 0!==r.mesh&&i.meshCache.refs[r.mesh]>1){const e=i.associations.get(o);i.associations.set(o,{...e})}}else i.associations.set(o,{});return i.associations.get(o).nodes=e,o}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],i=this,r=new Ua;n.name&&(r.name=i.createUniqueName(n.name)),Gd(r,n),n.extensions&&Hd(t,r,n);const s=n.nodes||[],o=[];for(let a=0,l=s.length;a<l;a++)o.push(i.getDependency("node",s[a]));return Promise.all(o).then(function(e){for(let t=0,n=e.length;t<n;t++)r.add(e[t]);return i.associations=(e=>{const t=new Map;for(const[n,r]of i.associations)(n instanceof Al||n instanceof jl)&&t.set(n,r);return e.traverse(e=>{const n=i.associations.get(e);null!=n&&t.set(e,n)}),t})(r),r})}_createAnimationTracks(e,t,n,i,r){const s=[],o=e.name?e.name:e.uuid,a=[];let l;switch(Ud[r.path]===Ud.weights?e.traverse(function(e){e.morphTargetInfluences&&a.push(e.name?e.name:e.uuid)}):a.push(o),Ud[r.path]){case Ud.weights:l=Bl;break;case Ud.rotation:l=Vl;break;case Ud.translation:case Ud.scale:l=zl;break;default:if(1===n.itemSize)l=Bl;else l=zl}const c=void 0!==i.interpolation?Nd[i.interpolation]:Nl,u=this._getArrayFromAccessor(n);for(let h=0,d=a.length;h<d;h++){const e=new l(a[h]+"."+Ud[r.path],t.array,u,c);"CUBICSPLINE"===i.interpolation&&this._createCubicSplineTrackInterpolant(e),s.push(e)}return s}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=qd(t.constructor),n=new Float32Array(t.length);for(let i=0,r=t.length;i<r;i++)n[i]=t[i]*e;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof Vl?Rd:Sd)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}};function Zd(e,t,n){const i=t.attributes,r=[];function s(t,i){return n.getDependency("accessor",t).then(function(t){e.setAttribute(i,t)})}for(const o in i){const t=Fd[o]||o.toLowerCase();t in e.attributes||r.push(s(i[o],t))}if(void 0!==t.indices&&!e.index){const i=n.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});r.push(i)}return Hl.workingColorSpace!==al&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Hl.workingColorSpace}" not supported.`),Gd(e,t),function(e,t,n){const i=t.attributes,r=new Kl;if(void 0===i.POSITION)return;{const e=n.json.accessors[i.POSITION],t=e.min,s=e.max;if(void 0===t||void 0===s)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new ka(t[0],t[1],t[2]),new ka(s[0],s[1],s[2])),e.normalized){const t=qd(kd[e.componentType]);r.min.multiplyScalar(t),r.max.multiplyScalar(t)}}const s=t.targets;if(void 0!==s){const e=new ka,t=new ka;for(let i=0,r=s.length;i<r;i++){const r=s[i];if(void 0!==r.POSITION){const i=n.json.accessors[r.POSITION],s=i.min,o=i.max;if(void 0!==s&&void 0!==o){if(t.setX(Math.max(Math.abs(s[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(s[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(s[2]),Math.abs(o[2]))),i.normalized){const e=qd(kd[i.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(e)}e.boundingBox=r;const o=new Xl;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,e.boundingSphere=o}(e,t,n),Promise.all(r).then(function(){return void 0!==t.targets?function(e,t,n){let i=!1,r=!1,s=!1;for(let c=0,u=t.length;c<u;c++){const e=t[c];if(void 0!==e.POSITION&&(i=!0),void 0!==e.NORMAL&&(r=!0),void 0!==e.COLOR_0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(e);const o=[],a=[],l=[];for(let c=0,u=t.length;c<u;c++){const u=t[c];if(i){const t=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):e.attributes.position;o.push(t)}if(r){const t=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):e.attributes.normal;a.push(t)}if(s){const t=void 0!==u.COLOR_0?n.getDependency("accessor",u.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(t){const n=t[0],o=t[1],a=t[2];return i&&(e.morphAttributes.position=n),r&&(e.morphAttributes.normal=o),s&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e})}(e,t.targets,n):e})}class Qd extends Qh{constructor(e=ql){super(),this.manager=e,this.adjustmentTransform=new La}parse(e){const t=super.parse(e),n=t.glbBytes.slice().buffer;return new Promise((e,i)=>{const r=this.manager,s=this.fetchOptions,o=r.getHandler("path.gltf")||new ed(r);"include"===s.credentials&&"cors"===s.mode&&o.setCrossOrigin("use-credentials"),"credentials"in s&&o.setWithCredentials("include"===s.credentials),s.headers&&o.setRequestHeader(s.headers);let a=this.workingPath;!/[\\/]$/.test(a)&&a.length&&(a+="/");const l=this.adjustmentTransform;o.parse(n,a,n=>{const{batchTable:i,featureTable:r}=t,{scene:s}=n,o=r.getData("RTC_CENTER",1,"FLOAT","VEC3");o&&(s.position.x+=o[0],s.position.y+=o[1],s.position.z+=o[2]),n.scene.updateMatrix(),n.scene.matrix.multiply(l),n.scene.matrix.decompose(n.scene.position,n.scene.quaternion,n.scene.scale),n.batchTable=i,n.featureTable=r,s.batchTable=i,s.featureTable=r,e(n)},i)})}}class Jd extends $h{parse(e){const t=new DataView(e),n=Zh(t);console.assert("pnts"===n);const i=t.getUint32(4,!0);console.assert(1===i);const r=t.getUint32(8,!0);console.assert(r===e.byteLength);const s=t.getUint32(12,!0),o=t.getUint32(16,!0),a=t.getUint32(20,!0),l=t.getUint32(24,!0),c=e.slice(28,28+s+o),u=new Xh(c,0,s,o),h=28+s+o,d=e.slice(h,h+a+l),p=new Yh(d,u.getData("BATCH_LENGTH")||u.getData("POINTS_LENGTH"),0,a,l);return Promise.resolve({version:i,featureTable:u,batchTable:p})}}function ep(e){const t=e>>11,n=e>>5&63,i=31&e;return[Math.round(t/31*255),Math.round(n/63*255),Math.round(i/31*255)]}const tp=new Oa;function np(e,t,n=new ka){tp.set(e,t).divideScalar(256).multiplyScalar(2).subScalar(1),n.set(tp.x,tp.y,1-Math.abs(tp.x)-Math.abs(tp.y));const i=Ia.clamp(-n.z,0,1);return n.x>=0?n.setX(n.x-i):n.setX(n.x+i),n.y>=0?n.setY(n.y-i):n.setY(n.y+i),n.normalize(),n}const ip={RGB:"color",POSITION:"position"};class rp extends Jd{constructor(e=ql){super(),this.manager=e}parse(e){return super.parse(e).then(async e=>{const{featureTable:t,batchTable:n}=e,i=new Na,r=t.header.extensions,s=new ka;let o;if(r&&r["3DTILES_draco_point_compression"]){const{byteOffset:e,byteLength:n,properties:s}=r["3DTILES_draco_point_compression"],a=this.manager.getHandler("draco.drc");if(null==a)throw new Error("PNTSLoader: dracoLoader not available.");const l={};for(const t in s)if(t in ip&&t in s){l[ip[t]]=s[t]}const c={attributeIDs:l,attributeTypes:{position:"Float32Array",color:"Uint8Array"},useUniqueIDs:!0},u=t.getBuffer(e,n);o=await a.decodeGeometry(u,c),o.attributes.color&&(i.vertexColors=!0)}else{const e=t.getData("POINTS_LENGTH"),n=t.getData("POSITION",e,"FLOAT","VEC3"),r=t.getData("NORMAL",e,"FLOAT","VEC3"),a=t.getData("NORMAL",e,"UNSIGNED_BYTE","VEC2"),l=t.getData("RGB",e,"UNSIGNED_BYTE","VEC3"),c=t.getData("RGBA",e,"UNSIGNED_BYTE","VEC4"),u=t.getData("RGB565",e,"UNSIGNED_SHORT","SCALAR"),h=t.getData("CONSTANT_RGBA",e,"UNSIGNED_BYTE","VEC4"),d=t.getData("POSITION_QUANTIZED",e,"UNSIGNED_SHORT","VEC3"),p=t.getData("QUANTIZED_VOLUME_SCALE",e,"FLOAT","VEC3"),m=t.getData("QUANTIZED_VOLUME_OFFSET",e,"FLOAT","VEC3");if(o=new za,d){const t=new Float32Array(3*e);for(let n=0;n<e;n++)for(let e=0;e<3;e++){const i=3*n+e;t[i]=d[i]/65535*p[e]}s.x=m[0],s.y=m[1],s.z=m[2],o.setAttribute("position",new Qa(t,3,!1))}else o.setAttribute("position",new Qa(n,3,!1));if(null!==r)o.setAttribute("normal",new Qa(r,3,!1));else if(null!==a){const t=new Float32Array(3*e),n=new ka;for(let i=0;i<e;i++){const e=np(a[2*i],a[2*i+1],n);t[3*i]=e.x,t[3*i+1]=e.y,t[3*i+2]=e.z}o.setAttribute("normal",new Qa(t,3,!1))}if(null!==c)o.setAttribute("color",new Qa(c,4,!0)),i.vertexColors=!0,i.transparent=!0,i.depthWrite=!1;else if(null!==l)o.setAttribute("color",new Qa(l,3,!0)),i.vertexColors=!0;else if(null!==u){const t=new Uint8Array(3*e);for(let n=0;n<e;n++){const e=ep(u[n]);for(let i=0;i<3;i++){t[3*n+i]=e[i]}}o.setAttribute("color",new Qa(t,3,!0)),i.vertexColors=!0}else if(null!==h){const e=new Ha(h[0],h[1],h[2]);i.color=e;const t=h[3]/255;t<1&&(i.opacity=t,i.transparent=!0,i.depthWrite=!1)}}const a=new Va(o,i);a.position.copy(s),e.scene=a,e.scene.featureTable=t,e.scene.batchTable=n;const l=t.getData("RTC_CENTER",1,"FLOAT","VEC3");return l&&(e.scene.position.x+=l[0],e.scene.position.y+=l[1],e.scene.position.z+=l[2]),e})}}class sp extends $h{parse(e){const t=new DataView(e),n=Zh(t);console.assert("i3dm"===n);const i=t.getUint32(4,!0);console.assert(1===i);const r=t.getUint32(8,!0);console.assert(r===e.byteLength);const s=t.getUint32(12,!0),o=t.getUint32(16,!0),a=t.getUint32(20,!0),l=t.getUint32(24,!0),c=t.getUint32(28,!0),u=e.slice(32,32+s+o),h=new Xh(u,0,s,o),d=32+s+o,p=e.slice(d,d+a+l),m=new Yh(p,h.getData("INSTANCES_LENGTH"),0,a,l),f=d+a+l,g=new Uint8Array(e,f,r-f);let _=null,v=null,y=null;if(c)_=g,v=Promise.resolve();else{const e=this.resolveExternalURL(Wh(g)),t=e.split(/[\\/]/g);t.pop(),y=t.join("/"),v=fetch(e,this.fetchOptions).then(t=>{if(!t.ok)throw new Error(`I3DMLoaderBase : Failed to load file "${e}" with status ${t.status} : ${t.statusText}`);return t.arrayBuffer()}).then(e=>{_=new Uint8Array(e)})}return v.then(()=>({version:i,featureTable:h,batchTable:m,glbBytes:_,gltfWorkingPath:y}))}}new Yl,new ka;const op=new Yl,ap=new ka,lp=new ka,cp=new ka,up=new La,hp=new La,dp=new La,pp=new Xl,mp=new Ja,fp=new ka,gp=new ka,_p=new ka,vp=new ka,yp=new Fa;class bp{constructor(e=1,t=1,n=1){this.name="",this.radius=new ka(e,t,n)}intersectRay(e,t){return up.makeScale(...this.radius).invert(),pp.center.set(0,0,0),pp.radius=1,yp.copy(e).applyMatrix4(up),yp.intersectSphere(pp,t)?(up.makeScale(...this.radius),t.applyMatrix4(up),t):null}getEastNorthUpFrame(e,t,n,i){return n.isMatrix4&&(i=n,n=0,console.warn('Ellipsoid: The signature for "getEastNorthUpFrame" has changed.')),this.getEastNorthUpAxes(e,t,fp,gp,_p),this.getCartographicToPosition(e,t,n,vp),i.makeBasis(fp,gp,_p).setPosition(vp)}getOrientedEastNorthUpFrame(e,t,n,i,r,s,o){return this.getObjectFrame(e,t,n,i,r,s,o,0)}getObjectFrame(e,t,n,i,r,s,o,a=2){return this.getEastNorthUpFrame(e,t,n,up),mp.set(r,s,-i,"ZXY"),o.makeRotationFromEuler(mp).premultiply(up),1===a?(mp.set(Math.PI/2,0,0,"XYZ"),hp.makeRotationFromEuler(mp),o.multiply(hp)):2===a&&(mp.set(-Math.PI/2,0,Math.PI,"XYZ"),hp.makeRotationFromEuler(mp),o.multiply(hp)),o}getCartographicFromObjectFrame(e,t,n=2){return 1===n?(mp.set(-Math.PI/2,0,0,"XYZ"),hp.makeRotationFromEuler(mp).premultiply(e)):2===n?(mp.set(-Math.PI/2,0,Math.PI,"XYZ"),hp.makeRotationFromEuler(mp).premultiply(e)):hp.copy(e),vp.setFromMatrixPosition(hp),this.getPositionToCartographic(vp,t),this.getEastNorthUpFrame(t.lat,t.lon,0,up).invert(),hp.premultiply(up),mp.setFromRotationMatrix(hp,"ZXY"),t.azimuth=-mp.z,t.elevation=mp.x,t.roll=mp.y,t}getEastNorthUpAxes(e,t,n,i,r,s=vp){this.getCartographicToPosition(e,t,0,s),this.getCartographicToNormal(e,t,r),n.set(-s.y,s.x,0).normalize(),i.crossVectors(r,n).normalize()}getAzElRollFromRotationMatrix(e,t,n,i,r=0){return console.warn('Ellipsoid: "getAzElRollFromRotationMatrix" is deprecated. Use "getCartographicFromObjectFrame", instead.'),this.getCartographicToPosition(e,t,0,vp),dp.copy(n).setPosition(vp),this.getCartographicFromObjectFrame(dp,i,r),delete i.height,delete i.lat,delete i.lon,i}getRotationMatrixFromAzElRoll(e,t,n,i,r,s,o=0){return console.warn('Ellipsoid: "getRotationMatrixFromAzElRoll" function has been deprecated. Use "getObjectFrame", instead.'),this.getObjectFrame(e,t,0,n,i,r,s,o),s.setPosition(0,0,0),s}getFrame(e,t,n,i,r,s,o,a=0){return console.warn('Ellipsoid: "getFrame" function has been deprecated. Use "getObjectFrame", instead.'),this.getObjectFrame(e,t,s,n,i,r,o,a)}getCartographicToPosition(e,t,n,i){this.getCartographicToNormal(e,t,ap);const r=this.radius;lp.copy(ap),lp.x*=r.x**2,lp.y*=r.y**2,lp.z*=r.z**2;const s=Math.sqrt(ap.dot(lp));return lp.divideScalar(s),i.copy(lp).addScaledVector(ap,n)}getPositionToCartographic(e,t){this.getPositionToSurfacePoint(e,lp),this.getPositionToNormal(e,ap);const n=cp.subVectors(e,lp);return t.lon=Math.atan2(ap.y,ap.x),t.lat=Math.asin(ap.z),t.height=Math.sign(n.dot(e))*n.length(),t}getCartographicToNormal(e,t,n){return op.set(1,-e+Math.PI/2,t),n.setFromSpherical(op).normalize(),function(e){const{x:t,y:n,z:i}=e;e.x=i,e.y=t,e.z=n}(n),n}getPositionToNormal(e,t){const n=this.radius;return t.copy(e),t.x/=n.x**2,t.y/=n.y**2,t.z/=n.z**2,t.normalize(),t}getPositionToSurfacePoint(e,t){const n=this.radius,i=1/n.x**2,r=1/n.y**2,s=1/n.z**2,o=e.x*e.x*i,a=e.y*e.y*r,l=e.z*e.z*s,c=o+a+l,u=Math.sqrt(1/c),h=lp.copy(e).multiplyScalar(u);if(c<.1)return isFinite(u)?t.copy(h):null;const d=cp.set(h.x*i*2,h.y*r*2,h.z*s*2);let p,m,f,g,_,v,y,b,w,T,x,E=(1-u)*e.length()/(.5*d.length()),P=0;do{E-=P,f=1/(1+E*i),g=1/(1+E*r),_=1/(1+E*s),v=f*f,y=g*g,b=_*_,w=v*f,T=y*g,x=b*_,p=o*v+a*y+l*b-1,m=o*w*i+a*T*r+l*x*s;P=p/(-2*m)}while(Math.abs(p)>1e-12);return t.set(e.x*f,e.y*g,e.z*_)}calculateHorizonDistance(e,t){const n=this.calculateEffectiveRadius(e);return Math.sqrt(2*n*t+t**2)}calculateEffectiveRadius(e){const t=this.radius.x,n=1-this.radius.z**2/t**2,i=e*Ia.DEG2RAD,r=Math.sin(i)**2;return t/Math.sqrt(1-n*r)}getPositionElevation(e){this.getPositionToSurfacePoint(e,lp);const t=cp.subVectors(e,lp);return Math.sign(t.dot(e))*t.length()}copy(e){return this.radius.copy(e.radius),this}clone(){return(new this.constructor).copy(this)}}const wp=new bp(Ah,Ah,6356752.314245179);wp.name="WGS84 Earth";const Tp=new ka,xp=new ka,Ep=new ka,Pp=new ka,Ap=new Da,Mp=new ka,Sp=new La,Cp=new La,Rp=new ka,Op=new La,kp=new Da,Lp={};class Ip extends sp{constructor(e=ql){super(),this.manager=e,this.adjustmentTransform=new La,this.ellipsoid=wp.clone()}resolveExternalURL(e){return this.manager.resolveURL(super.resolveExternalURL(e))}parse(e){return super.parse(e).then(e=>{const{featureTable:t,batchTable:n}=e,i=e.glbBytes.slice().buffer;return new Promise((r,s)=>{const o=this.fetchOptions,a=this.manager,l=a.getHandler("path.gltf")||new ed(a);"include"===o.credentials&&"cors"===o.mode&&l.setCrossOrigin("use-credentials"),"credentials"in o&&l.setWithCredentials("include"===o.credentials),o.headers&&l.setRequestHeader(o.headers);let c=e.gltfWorkingPath??this.workingPath;/[\\/]$/.test(c)||(c+="/");const u=this.adjustmentTransform;l.parse(i,c,e=>{const i=t.getData("INSTANCES_LENGTH"),s=t.getData("POSITION",i,"FLOAT","VEC3"),o=t.getData("NORMAL_UP",i,"FLOAT","VEC3"),a=t.getData("NORMAL_RIGHT",i,"FLOAT","VEC3"),l=t.getData("SCALE_NON_UNIFORM",i,"FLOAT","VEC3"),c=t.getData("SCALE",i,"FLOAT","SCALAR"),h=t.getData("RTC_CENTER",1,"FLOAT","VEC3"),d=t.getData("EAST_NORTH_UP");["QUANTIZED_VOLUME_OFFSET","QUANTIZED_VOLUME_SCALE","POSITION_QUANTIZED","NORMAL_UP_OCT32P","NORMAL_RIGHT_OCT32P"].forEach(e=>{e in t.header&&console.warn(`I3DMLoader: Unsupported FeatureTable feature "${e}" detected.`)});const p=new ka;for(let t=0;t<i;t++)p.x+=s[3*t+0]/i,p.y+=s[3*t+1]/i,p.z+=s[3*t+2]/i;const m=[],f=[];e.scene.updateMatrixWorld(),e.scene.traverse(e=>{if(e.isMesh){f.push(e);const{geometry:t,material:n}=e,r=new dl(t,n,i);r.position.copy(p),h&&(r.position.x+=h[0],r.position.y+=h[1],r.position.z+=h[2]),m.push(r)}});for(let t=0;t<i;t++){Pp.set(s[3*t+0]-p.x,s[3*t+1]-p.y,s[3*t+2]-p.z),Ap.identity(),o&&(xp.set(o[3*t+0],o[3*t+1],o[3*t+2]),Ep.set(a[3*t+0],a[3*t+1],a[3*t+2]),Tp.crossVectors(Ep,xp).normalize(),Sp.makeBasis(Ep,xp,Tp),Ap.setFromRotationMatrix(Sp)),Mp.set(1,1,1),l&&Mp.set(l[3*t+0],l[3*t+1],l[3*t+2]),c&&Mp.multiplyScalar(c[t]);for(let e=0,n=m.length;e<n;e++){const n=m[e];kp.copy(Ap),d&&(n.updateMatrixWorld(),Rp.copy(Pp).applyMatrix4(n.matrixWorld),this.ellipsoid.getPositionToCartographic(Rp,Lp),this.ellipsoid.getEastNorthUpFrame(Lp.lat,Lp.lon,Op),kp.setFromRotationMatrix(Op)),Sp.compose(Pp,kp,Mp).multiply(u);const i=f[e];Cp.multiplyMatrices(Sp,i.matrixWorld),n.setMatrixAt(t,Cp)}}e.scene.clear(),e.scene.add(...m),e.batchTable=n,e.featureTable=t,e.scene.batchTable=n,e.scene.featureTable=t,r(e)},s)})})}}class Dp extends $h{parse(e){const t=new DataView(e),n=Zh(t);console.assert("cmpt"===n,'CMPTLoader: The magic bytes equal "cmpt".');const i=t.getUint32(4,!0);console.assert(1===i,'CMPTLoader: The version listed in the header is "1".');const r=t.getUint32(8,!0);console.assert(r===e.byteLength,"CMPTLoader: The contents buffer length listed in the header matches the file.");const s=t.getUint32(12,!0),o=[];let a=16;for(let l=0;l<s;l++){const t=new DataView(e,a,12),n=Zh(t),i=t.getUint32(4,!0),r=t.getUint32(8,!0),s=new Uint8Array(e,a,r);o.push({type:n,buffer:s,version:i}),a+=r}return{version:i,tiles:o}}}class Fp extends Dp{constructor(e=ql){super(),this.manager=e,this.adjustmentTransform=new La,this.ellipsoid=wp.clone()}parse(e){const t=super.parse(e),{manager:n,ellipsoid:i,adjustmentTransform:r}=this,s=[];for(const o in t.tiles){const{type:e,buffer:a}=t.tiles[o];switch(e){case"b3dm":{const e=a.slice(),t=new Qd(n);t.workingPath=this.workingPath,t.fetchOptions=this.fetchOptions,t.adjustmentTransform.copy(r);const i=t.parse(e.buffer);s.push(i);break}case"pnts":{const e=a.slice(),t=new rp(n);t.workingPath=this.workingPath,t.fetchOptions=this.fetchOptions;const i=t.parse(e.buffer);s.push(i);break}case"i3dm":{const e=a.slice(),t=new Ip(n);t.workingPath=this.workingPath,t.fetchOptions=this.fetchOptions,t.ellipsoid.copy(i),t.adjustmentTransform.copy(r);const o=t.parse(e.buffer);s.push(o);break}}}return Promise.all(s).then(e=>{const t=new Ua;return e.forEach(e=>{t.add(e.scene)}),{tiles:e,scene:t}})}}const Up=new La;class Np extends Ua{constructor(e){super(),this.isTilesGroup=!0,this.name="TilesRenderer.TilesGroup",this.tilesRenderer=e,this.matrixWorldInverse=new La}raycast(e,t){return!this.tilesRenderer.optimizeRaycast||(this.tilesRenderer.raycast(e,t),!1)}updateMatrixWorld(e){if(this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldNeedsUpdate||e){null===this.parent?Up.copy(this.matrix):Up.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1;const e=Up.elements,t=this.matrixWorld.elements;let n=!1;for(let i=0;i<16;i++){const r=e[i],s=t[i];if(Math.abs(r-s)>Number.EPSILON){n=!0;break}}if(n){this.matrixWorld.copy(Up),this.matrixWorldInverse.copy(Up).invert();const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateMatrixWorld()}}}updateWorldMatrix(e,t){this.parent&&e&&this.parent.updateWorldMatrix(e,!1),this.updateMatrixWorld(!0)}}const jp=new Fa,zp=new ka,Bp=[];function Vp(e,t){return e.distance-t.distance}function Hp(e,t,n,i){const{scene:r}=e.cached;n.invokeOnePlugin(n=>n.raycastTile&&n.raycastTile(e,r,t,i))||t.intersectObject(r,!0,i)}function Gp(e){return"__used"in e}function Wp(e,t,n,i=null){const{group:r,activeTiles:s}=e;null===i&&(i=jp).copy(n.ray).applyMatrix4(r.matrixWorldInverse);const o=[],a=t.children;for(let u=0,h=a.length;u<h;u++){const e=a[u];Gp(e)&&e.__used&&(null!==e.cached.boundingVolume.intersectRay(i,zp)&&(zp.applyMatrix4(r.matrixWorld),o.push({distance:zp.distanceToSquared(n.ray.origin),tile:e})))}o.sort(Vp);let l=null,c=1/0;if(s.has(t)){const i=function(e,t,n){Hp(e,t,n,Bp),Bp.sort(Vp);const i=Bp[0]||null;return Bp.length=0,i}(t,n,e);i&&(l=i,c=i.distance*i.distance)}for(let u=0,h=o.length;u<h;u++){const t=o[u],r=t.distance,s=t.tile;if(r>c)break;const a=Wp(e,s,n,i);if(a){const e=a.distance*a.distance;e<c&&(l=a,c=e)}}return l}function Kp(e,t,n,i,r=null){if(!Gp(t))return;const{group:s,activeTiles:o}=e,{boundingVolume:a}=t.cached;if(null===r&&(r=jp).copy(n.ray).applyMatrix4(s.matrixWorldInverse),!t.__used||!a.intersectsRay(r))return;o.has(t)&&Hp(t,n,e,i);const l=t.children;for(let c=0,u=l.length;c<u;c++)Kp(e,l[c],n,i,r)}const Xp=new ka,qp=new ka,Yp=new ka,$p=new Fa;class Zp{constructor(e=new Kl,t=new La){this.box=e.clone(),this.transform=t.clone(),this.inverseTransform=new La,this.points=new Array(8).fill().map(()=>new ka),this.planes=new Array(6).fill().map(()=>new $l)}copy(e){return this.box.copy(e.box),this.transform.copy(e.transform),this.update(),this}clone(){return(new this.constructor).copy(this)}clampPoint(e,t){return t.copy(e).applyMatrix4(this.inverseTransform).clamp(this.box.min,this.box.max).applyMatrix4(this.transform)}distanceToPoint(e){return this.clampPoint(e,Yp).distanceTo(e)}containsPoint(e){return Yp.copy(e).applyMatrix4(this.inverseTransform),this.box.containsPoint(Yp)}intersectsRay(e){return $p.copy(e).applyMatrix4(this.inverseTransform),$p.intersectsBox(this.box)}intersectRay(e,t){return $p.copy(e).applyMatrix4(this.inverseTransform),$p.intersectBox(this.box,t)?(t.applyMatrix4(this.transform),t):null}update(){const{points:e,inverseTransform:t,transform:n,box:i}=this;t.copy(n).invert();const{min:r,max:s}=i;let o=0;for(let a=-1;a<=1;a+=2)for(let t=-1;t<=1;t+=2)for(let i=-1;i<=1;i+=2)e[o].set(a<0?r.x:s.x,t<0?r.y:s.y,i<0?r.z:s.z).applyMatrix4(n),o++;this.updatePlanes()}updatePlanes(){Xp.copy(this.box.min).applyMatrix4(this.transform),qp.copy(this.box.max).applyMatrix4(this.transform),Yp.set(0,0,1).transformDirection(this.transform),this.planes[0].setFromNormalAndCoplanarPoint(Yp,Xp),this.planes[1].setFromNormalAndCoplanarPoint(Yp,qp).negate(),Yp.set(0,1,0).transformDirection(this.transform),this.planes[2].setFromNormalAndCoplanarPoint(Yp,Xp),this.planes[3].setFromNormalAndCoplanarPoint(Yp,qp).negate(),Yp.set(1,0,0).transformDirection(this.transform),this.planes[4].setFromNormalAndCoplanarPoint(Yp,Xp),this.planes[5].setFromNormalAndCoplanarPoint(Yp,qp).negate()}intersectsSphere(e){return this.clampPoint(e.center,Yp),Yp.distanceToSquared(e.center)<=e.radius*e.radius}intersectsFrustum(e){return this._intersectsPlaneShape(e.planes,e.points)}intersectsOBB(e){return this._intersectsPlaneShape(e.planes,e.points)}_intersectsPlaneShape(e,t){const n=this.points,i=this.planes;for(let r=0;r<6;r++){const t=e[r];let i=-1/0;for(let e=0;e<8;e++){const r=n[e],s=t.distanceToPoint(r);i=i<s?s:i}if(i<0)return!1}for(let r=0;r<6;r++){const e=i[r];let n=-1/0;for(let i=0;i<8;i++){const r=t[i],s=e.distanceToPoint(r);n=n<s?s:n}if(n<0)return!1}return!0}}const Qp=Math.PI,Jp=Qp/2,em=new ka,tm=new ka,nm=new ka,im=new La;let rm=0;const sm=[];function om(e=!1){return e?(sm[rm]||(sm[rm]=new ka),rm++,sm[rm-1]):new ka}function am(){rm=0}class lm extends bp{constructor(e,t,n,i=-Jp,r=Jp,s=0,o=2*Qp,a=0,l=0){super(e,t,n),this.latStart=i,this.latEnd=r,this.lonStart=s,this.lonEnd=o,this.heightStart=a,this.heightEnd=l}_getPoints(e=!1){const{latStart:t,latEnd:n,lonStart:i,lonEnd:r,heightStart:s,heightEnd:o}=this,a=Ia.mapLinear(.5,0,1,t,n),l=Ia.mapLinear(.5,0,1,i,r),c=Math.floor(i/Jp)*Jp,u=[[-Qp/2,0],[Qp/2,0],[0,c],[0,c+Qp/2],[0,c+Qp],[0,c+3*Qp/2],[t,r],[n,r],[t,i],[n,i],[0,i],[0,r],[a,l],[t,l],[n,l],[a,i],[a,r]],h=[],d=u.length;for(let p=0;p<=1;p++){const a=Ia.mapLinear(p,0,1,s,o);for(let s=0,o=d;s<o;s++){const[o,l]=u[s];if(o>=t&&o<=n&&l>=i&&l<=r){const t=om(e);h.push(t),this.getCartographicToPosition(o,l,a,t)}}}return h}getBoundingBox(e,t){am();const{latStart:n,latEnd:i,lonStart:r,lonEnd:s}=this;if(i-n<Qp/2){const e=Ia.mapLinear(.5,0,1,n,i),o=Ia.mapLinear(.5,0,1,r,s);this.getCartographicToNormal(e,o,nm),tm.set(0,0,1),em.crossVectors(tm,nm),tm.crossVectors(em,nm),t.makeBasis(em,tm,nm)}else em.set(1,0,0),tm.set(0,1,0),nm.set(0,0,1),t.makeBasis(em,tm,nm);im.copy(t).invert();const o=this._getPoints(!0);for(let a=0,l=o.length;a<l;a++)o[a].applyMatrix4(im);e.makeEmpty(),e.setFromPoints(o)}getBoundingSphere(e,t){am();const n=this._getPoints(!0);e.makeEmpty(),e.setFromPoints(n,t)}}const cm=new ka,um=new ka,hm=new ka,dm=new ka,pm=new ka;class mm{constructor(){this.sphere=null,this.obb=null,this.region=null,this.regionObb=null}intersectsRay(e){const t=this.sphere,n=this.obb||this.regionObb;return!(t&&!e.intersectsSphere(t)||n&&!n.intersectsRay(e))}intersectRay(e,t=null){const n=this.sphere,i=this.obb||this.regionObb;let r=-1/0,s=-1/0;n&&e.intersectSphere(n,dm)&&(r=n.containsPoint(e.origin)?0:e.origin.distanceToSquared(dm)),i&&i.intersectRay(e,pm)&&(s=i.containsPoint(e.origin)?0:e.origin.distanceToSquared(pm));const o=Math.max(r,s);return o===-1/0?null:(e.at(Math.sqrt(o),t),t)}distanceToPoint(e){const t=this.sphere,n=this.obb||this.regionObb;let i=-1/0,r=-1/0;return t&&(i=Math.max(t.distanceToPoint(e),0)),n&&(r=n.distanceToPoint(e)),i>r?i:r}intersectsFrustum(e){const t=this.obb||this.regionObb,n=this.sphere;return!(n&&!e.intersectsSphere(n)||t&&!t.intersectsFrustum(e))&&!(!n&&!t)}intersectsSphere(e){const t=this.obb||this.regionObb,n=this.sphere;return!(n&&!n.intersectsSphere(e)||t&&!t.intersectsSphere(e))&&!(!n&&!t)}intersectsOBB(e){const t=this.obb||this.regionObb,n=this.sphere;return!(n&&!e.intersectsSphere(n)||t&&!t.intersectsOBB(e))&&!(!n&&!t)}getOBB(e,t){const n=this.obb||this.regionObb;n?(e.copy(n.box),t.copy(n.transform)):(this.getAABB(e),t.identity())}getAABB(e){if(this.sphere)this.sphere.getBoundingBox(e);else{const t=this.obb||this.regionObb;e.copy(t.box).applyMatrix4(t.transform)}}getSphere(e){if(this.sphere)e.copy(this.sphere);else if(this.region)this.region.getBoundingSphere(e);else{const t=this.obb||this.regionObb;t.box.getBoundingSphere(e),e.applyMatrix4(t.transform)}}setObbData(e,t){const n=new Zp;cm.set(e[3],e[4],e[5]),um.set(e[6],e[7],e[8]),hm.set(e[9],e[10],e[11]);const i=cm.length(),r=um.length(),s=hm.length();cm.normalize(),um.normalize(),hm.normalize(),0===i&&cm.crossVectors(um,hm),0===r&&um.crossVectors(cm,hm),0===s&&hm.crossVectors(cm,um),n.transform.set(cm.x,um.x,hm.x,e[0],cm.y,um.y,hm.y,e[1],cm.z,um.z,hm.z,e[2],0,0,0,1).premultiply(t),n.box.min.set(-i,-r,-s),n.box.max.set(i,r,s),n.update(),this.obb=n}setSphereData(e,t,n,i,r){const s=new Xl;s.center.set(e,t,n),s.radius=i,s.applyMatrix4(r),this.sphere=s}setRegionData(e,t,n,i,r,s,o){const a=new lm(...e.radius,n,r,t,i,s,o),l=new Zp;a.getBoundingBox(l.box,l.transform),l.update(),this.region=a,this.regionObb=l}}const fm=new Ql;class gm extends Zl{constructor(){super(),this.points=Array(8).fill().map(()=>new ka)}setFromProjectionMatrix(e,t){return super.setFromProjectionMatrix(e,t),this.calculateFrustumPoints(),this}calculateFrustumPoints(){const{planes:e,points:t}=this;[[e[0],e[3],e[4]],[e[1],e[3],e[4]],[e[0],e[2],e[4]],[e[1],e[2],e[4]],[e[0],e[3],e[5]],[e[1],e[3],e[5]],[e[0],e[2],e[5]],[e[1],e[2],e[5]]].forEach((e,n)=>{!function(e,t,n,i){const r=fm.set(e.normal.x,e.normal.y,e.normal.z,t.normal.x,t.normal.y,t.normal.z,n.normal.x,n.normal.y,n.normal.z);i.set(-e.constant,-t.constant,-n.constant),i.applyMatrix3(r.invert())}(e[0],e[1],e[2],t[n])})}}const _m=new La,vm=new Ja,ym=Symbol("INITIAL_FRUSTUM_CULLED"),bm=new La,wm=new ka,Tm=new Oa,xm={inView:!1,error:1/0},Em=new ka(1,0,0),Pm=new ka(0,1,0);function Am(e,t){e.traverse(e=>{e.frustumCulled=e[ym]&&t})}class Mm extends Hh{get autoDisableRendererCulling(){return this._autoDisableRendererCulling}set autoDisableRendererCulling(e){this._autoDisableRendererCulling!==e&&(super._autoDisableRendererCulling=e,this.forEachLoadedModel(t=>{Am(t,!e)}))}get optimizeRaycast(){return this._optimizeRaycast}set optimizeRaycast(e){console.warn('TilesRenderer: The "optimizeRaycast" option has been deprecated.'),this._optimizeRaycast=e}constructor(...e){super(...e),this.group=new Np(this),this.ellipsoid=wp.clone(),this.cameras=[],this.cameraMap=new Map,this.cameraInfo=[],this._optimizeRaycast=!0,this._upRotationMatrix=new La,this.lruCache.computeMemoryUsageCallback=e=>e.cached.bytesUsed??null,this._autoDisableRendererCulling=!0;const t=new Jl;t.setURLModifier(e=>this.preprocessURL?this.preprocessURL(e):e),this.manager=t,this._listeners={}}addEventListener(...e){ec.prototype.addEventListener.call(this,...e)}hasEventListener(...e){ec.prototype.hasEventListener.call(this,...e)}removeEventListener(...e){ec.prototype.removeEventListener.call(this,...e)}dispatchEvent(...e){ec.prototype.dispatchEvent.call(this,...e)}getBoundingBox(e){if(!this.root)return!1;const t=this.root.cached.boundingVolume;return!!t&&(t.getAABB(e),!0)}getOrientedBoundingBox(e,t){if(!this.root)return!1;const n=this.root.cached.boundingVolume;return!!n&&(n.getOBB(e,t),!0)}getBoundingSphere(e){if(!this.root)return!1;const t=this.root.cached.boundingVolume;return!!t&&(t.getSphere(e),!0)}forEachLoadedModel(e){this.traverse(t=>{const n=t.cached&&t.cached.scene;n&&e(n,t)},null,!1)}raycast(e,t){if(this.root)if(e.firstHitOnly){const n=Wp(this,this.root,e);n&&t.push(n)}else Kp(this,this.root,e,t)}hasCamera(e){return this.cameraMap.has(e)}setCamera(e){const t=this.cameras,n=this.cameraMap;return!n.has(e)&&(n.set(e,new Oa),t.push(e),this.dispatchEvent({type:"add-camera",camera:e}),!0)}setResolution(e,t,n){const i=this.cameraMap;if(!i.has(e))return!1;const r=t.isVector2?t.x:t,s=t.isVector2?t.y:n,o=i.get(e);return(o.width!==r||o.height!==s)&&(o.set(r,s),this.dispatchEvent({type:"camera-resolution-change"})),!0}setResolutionFromRenderer(e,t){return t.getSize(Tm),this.setResolution(e,Tm.x,Tm.y)}deleteCamera(e){const t=this.cameras,n=this.cameraMap;if(n.has(e)){const i=t.indexOf(e);return t.splice(i,1),n.delete(e),this.dispatchEvent({type:"delete-camera",camera:e}),!0}return!1}loadRootTileSet(...e){return super.loadRootTileSet(...e).then(e=>{const{asset:t,extensions:n={}}=e;switch((t&&t.gltfUpAxis||"y").toLowerCase()){case"x":this._upRotationMatrix.makeRotationAxis(Pm,-Math.PI/2);break;case"y":this._upRotationMatrix.makeRotationAxis(Em,Math.PI/2)}if("3DTILES_ellipsoid"in n){const e=n["3DTILES_ellipsoid"],{ellipsoid:t}=this;t.name=e.body,e.radii?t.radius.set(...e.radii):t.radius.set(1,1,1)}return e})}update(){let e=null;if(this.invokeAllPlugins(t=>{if(t.doTilesNeedUpdate){const n=t.doTilesNeedUpdate();e=null===e?n:!(!e&&!n)}}),!1===e)return this.dispatchEvent({type:"update-before"}),void this.dispatchEvent({type:"update-after"});this.dispatchEvent({type:"update-before"});const t=this.group,n=this.cameras,i=this.cameraMap,r=this.cameraInfo;for(;r.length>n.length;)r.pop();for(;r.length<n.length;)r.push({frustum:new gm,isOrthographic:!1,sseDenominator:-1,position:new ka,invScale:-1,pixelSize:0});wm.setFromMatrixScale(t.matrixWorldInverse),Math.abs(Math.max(wm.x-wm.y,wm.x-wm.z))>1e-6&&console.warn("ThreeTilesRenderer : Non uniform scale used for tile which may cause issues when calculating screen space error.");for(let s=0,o=r.length;s<o;s++){const e=n[s],o=r[s],a=o.frustum,l=o.position,c=i.get(e);(0===c.width||0===c.height)&&console.warn("TilesRenderer: resolution for camera error calculation is not set.");const u=e.projectionMatrix.elements;if(o.isOrthographic=1===u[15],o.isOrthographic){const e=2/u[0],t=2/u[5];o.pixelSize=Math.max(t/c.height,e/c.width)}else o.sseDenominator=2/u[5]/c.height;bm.copy(t.matrixWorld),bm.premultiply(e.matrixWorldInverse),bm.premultiply(e.projectionMatrix),a.setFromProjectionMatrix(bm),l.set(0,0,0),l.applyMatrix4(e.matrixWorld),l.applyMatrix4(t.matrixWorldInverse)}if(super.update(),this.dispatchEvent({type:"update-after"}),0===n.length&&this.root){let e=!1;this.invokeAllPlugins(t=>e=e||!(t===this||!t.calculateTileViewError)),!1===e&&console.warn("TilesRenderer: no cameras defined. Cannot update 3d tiles.")}}preprocessNode(e,t,n=null){super.preprocessNode(e,t,n);const i=new La;if(e.transform){const t=e.transform;for(let e=0;e<16;e++)i.elements[e]=t[e]}n&&i.premultiply(n.cached.transform);const r=(new La).copy(i).invert(),s=new mm;"sphere"in e.boundingVolume&&s.setSphereData(...e.boundingVolume.sphere,i),"box"in e.boundingVolume&&s.setObbData(e.boundingVolume.box,i),"region"in e.boundingVolume&&s.setRegionData(this.ellipsoid,...e.boundingVolume.region),e.cached={transform:i,transformInverse:r,active:!1,boundingVolume:s,metadata:null,scene:null,geometry:null,materials:null,textures:null}}async parseTile(e,t,n,i,r){const s=t.cached,o=i.split(/[\\/]/g);o.pop();const a=o.join("/"),l=this.fetchOptions,c=this.manager;let u=null;const h=s.transform,d=this._upRotationMatrix,p=(Zh(e)||n).toLowerCase();switch(p){case"b3dm":{const t=new Qd(c);t.workingPath=a,t.fetchOptions=l,t.adjustmentTransform.copy(d),u=t.parse(e);break}case"pnts":{const t=new rp(c);t.workingPath=a,t.fetchOptions=l,u=t.parse(e);break}case"i3dm":{const t=new Ip(c);t.workingPath=a,t.fetchOptions=l,t.adjustmentTransform.copy(d),t.ellipsoid.copy(this.ellipsoid),u=t.parse(e);break}case"cmpt":{const t=new Fp(c);t.workingPath=a,t.fetchOptions=l,t.adjustmentTransform.copy(d),t.ellipsoid.copy(this.ellipsoid),u=t.parse(e).then(e=>e.scene);break}case"gltf":case"glb":{const t=c.getHandler("path.gltf")||c.getHandler("path.glb")||new ed(c);t.setWithCredentials("include"===l.credentials),t.setRequestHeader(l.headers||{}),"include"===l.credentials&&"cors"===l.mode&&t.setCrossOrigin("use-credentials");let n=t.resourcePath||t.path||a;!/[\\/]$/.test(n)&&n.length&&(n+="/"),u=t.parseAsync(e,n).then(e=>{e.scene=e.scene||new Ua;const{scene:t}=e;return t.updateMatrix(),t.matrix.multiply(d).decompose(t.position,t.quaternion,t.scale),e});break}default:u=this.invokeOnePlugin(s=>s.parseToMesh&&s.parseToMesh(e,t,n,i,r))}const m=await u;if(null===m)throw new Error(`TilesRenderer: Content type "${p}" not supported.`);let f,g;m.isObject3D?(f=m,g=null):(f=m.scene,g=m),await this.invokeAllPlugins(e=>e.processTileModel&&e.processTileModel(f,t)),f.updateMatrix(),f.matrix.premultiply(h),f.matrix.decompose(f.position,f.quaternion,f.scale),f.traverse(e=>{e[ym]=e.frustumCulled}),Am(f,!this.autoDisableRendererCulling);const _=[],v=[],y=[];if(f.traverse(e=>{if(e.geometry&&v.push(e.geometry),e.material){const t=e.material;_.push(e.material);for(const e in t){const n=t[e];n&&n.isTexture&&y.push(n)}}}),r.aborted)for(let b=0,w=y.length;b<w;b++){const e=y[b];e.image instanceof ImageBitmap&&e.image.close(),e.dispose()}else s.materials=_,s.geometry=v,s.textures=y,s.scene=f,s.metadata=g,s.bytesUsed=function(e){const{TextureUtils:t}=Ca;if(!t)return 0;const n=new Set;let i=0;return e.traverse(e=>{if(e.geometry&&!n.has(e.geometry)&&(i+=function(e){let t=0;for(const i in e.attributes){const n=e.getAttribute(i);t+=n.count*n.itemSize*n.array.BYTES_PER_ELEMENT}const n=e.getIndex();return t+=n?n.count*n.itemSize*n.array.BYTES_PER_ELEMENT:0,t}(e.geometry),n.add(e.geometry)),e.material){const r=e.material;for(const e in r){const s=r[e];if(s&&s.isTexture&&!n.has(s)){const{format:e,type:r,image:o}=s,{width:a,height:l}=o,c=t.getByteLength(a,l,e,r);i+=s.generateMipmaps?4*c/3:c,n.add(s)}}}}),i}(f)}disposeTile(e){super.disposeTile(e);const t=e.cached;if(t.scene){const n=t.materials,i=t.geometry,r=t.textures,s=t.scene.parent;t.scene.traverse(e=>{e.userData.meshFeatures&&e.userData.meshFeatures.dispose(),e.userData.structuralMetadata&&e.userData.structuralMetadata.dispose()});for(let e=0,t=i.length;e<t;e++)i[e].dispose();for(let e=0,t=n.length;e<t;e++)n[e].dispose();for(let e=0,t=r.length;e<t;e++){const t=r[e];t.image instanceof ImageBitmap&&t.image.close(),t.dispose()}s&&s.remove(t.scene),this.dispatchEvent({type:"dispose-model",scene:t.scene,tile:e}),t.scene=null,t.materials=null,t.textures=null,t.geometry=null,t.metadata=null}}setTileVisible(e,t){const n=e.cached.scene,i=this.group;t?n&&(i.add(n),n.updateMatrixWorld(!0)):n&&i.remove(n),super.setTileVisible(e,t),this.dispatchEvent({type:"tile-visibility-change",scene:n,tile:e,visible:t})}calculateTileViewError(e,t){const n=e.cached,i=this.cameras,r=this.cameraInfo,s=n.boundingVolume;let o=!1,a=-1/0,l=1/0,c=-1/0,u=1/0;for(let h=0,d=i.length;h<d;h++){const t=r[h];let n,i;if(t.isOrthographic){const r=t.pixelSize;n=e.geometricError/r,i=1/0}else{const r=t.sseDenominator;i=s.distanceToPoint(t.position),n=e.geometricError/(i*r)}const d=r[h].frustum;s.intersectsFrustum(d)&&(o=!0,a=Math.max(a,n),l=Math.min(l,i)),c=Math.max(c,n),u=Math.min(u,i)}this.invokeAllPlugins(t=>{t!==this&&t.calculateTileViewError&&(t.calculateTileViewError(e,xm),xm.inView&&(o=!0,a=Math.max(a,xm.error)),c=Math.max(c,xm.error))}),o?(t.inView=!0,t.error=a,t.distanceFromCamera=l):(t.inView=!1,t.error=c,t.distanceFromCamera=u)}setLatLonToYUp(e,t){console.warn("TilesRenderer: setLatLonToYUp is deprecated. Use the ReorientationPlugin, instead.");const{ellipsoid:n,group:i}=this;vm.set(Math.PI/2,Math.PI/2,0),_m.makeRotationFromEuler(vm),n.getEastNorthUpFrame(e,t,0,i.matrix).multiply(_m).invert().decompose(i.position,i.quaternion,i.scale),i.updateMatrixWorld(!0)}dispose(){super.dispose(),this.group.removeFromParent()}}class Sm extends Za{constructor(){super(new tc(0,0),new Cm),this.renderOrder=1/0}onBeforeRender(e){const t=this.material.uniforms;e.getSize(t.resolution.value)}updateMatrixWorld(){this.matrixWorld.makeTranslation(this.position)}dispose(){this.geometry.dispose(),this.material.dispose()}}class Cm extends nc{constructor(){super({depthWrite:!1,depthTest:!1,transparent:!0,uniforms:{resolution:{value:new Oa},size:{value:15},thickness:{value:2},opacity:{value:1}},vertexShader:"\n\n\t\t\t\tuniform float pixelRatio;\n\t\t\t\tuniform float size;\n\t\t\t\tuniform float thickness;\n\t\t\t\tuniform vec2 resolution;\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvUv = uv;\n\n\t\t\t\t\tfloat aspect = resolution.x / resolution.y;\n\t\t\t\t\tvec2 offset = uv * 2.0 - vec2( 1.0 );\n\t\t\t\t\toffset.y *= aspect;\n\n\t\t\t\t\tvec4 screenPoint = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t\tscreenPoint.xy += offset * ( size + thickness ) * screenPoint.w / resolution.x;\n\n\t\t\t\t\tgl_Position = screenPoint;\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform float size;\n\t\t\t\tuniform float thickness;\n\t\t\t\tuniform float opacity;\n\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tfloat ht = 0.5 * thickness;\n\t\t\t\t\tfloat planeDim = size + thickness;\n\t\t\t\t\tfloat offset = ( planeDim - ht - 2.0 ) / planeDim;\n\t\t\t\t\tfloat texelThickness = ht / planeDim;\n\n\t\t\t\t\tvec2 vec = vUv * 2.0 - vec2( 1.0 );\n\t\t\t\t\tfloat dist = abs( length( vec ) - offset );\n\t\t\t\t\tfloat fw = fwidth( dist ) * 0.5;\n\t\t\t\t\tfloat a = smoothstep( texelThickness - fw, texelThickness + fw, dist );\n\n\t\t\t\t\tgl_FragColor = vec4( 1, 1, 1, opacity * ( 1.0 - a ) );\n\n\t\t\t\t}\n\t\t\t"})}}const Rm=new Oa,Om=new Oa;class km{constructor(){this.domElement=null,this.buttons=0,this.pointerType=null,this.pointerOrder=[],this.previousPositions={},this.pointerPositions={},this.startPositions={},this.pointerSetThisFrame={},this.hoverPosition=new Oa,this.hoverSet=!1}reset(){this.buttons=0,this.pointerType=null,this.pointerOrder=[],this.previousPositions={},this.pointerPositions={},this.startPositions={},this.pointerSetThisFrame={},this.hoverPosition=new Oa,this.hoverSet=!1}updateFrame(){const{previousPositions:e,pointerPositions:t}=this;for(const n in t)e[n].copy(t[n])}setHoverEvent(e){("mouse"===e.pointerType||"wheel"===e.type)&&(this.getAdjustedPointer(e,this.hoverPosition),this.hoverSet=!0)}getLatestPoint(e){return null!==this.pointerType?(this.getCenterPoint(e),e):this.hoverSet?(e.copy(this.hoverPosition),e):null}getAdjustedPointer(e,t){const n=(this.domElement?this.domElement:e.target).getBoundingClientRect(),i=e.clientX-n.left,r=e.clientY-n.top;t.set(i,r)}addPointer(e){const t=e.pointerId,n=new Oa;this.getAdjustedPointer(e,n),this.pointerOrder.push(t),this.pointerPositions[t]=n,this.previousPositions[t]=n.clone(),this.startPositions[t]=n.clone(),1===this.getPointerCount()&&(this.pointerType=e.pointerType,this.buttons=e.buttons)}updatePointer(e){const t=e.pointerId;return t in this.pointerPositions&&(this.getAdjustedPointer(e,this.pointerPositions[t]),!0)}deletePointer(e){const t=e.pointerId,n=this.pointerOrder;n.splice(n.indexOf(t),1),delete this.pointerPositions[t],delete this.previousPositions[t],delete this.startPositions[t],0===this.getPointerCount.length&&(this.buttons=0,this.pointerType=null)}getPointerCount(){return this.pointerOrder.length}getCenterPoint(e,t=this.pointerPositions){const n=this.pointerOrder;if(1===this.getPointerCount()||"mouse"===this.getPointerType()){const i=n[0];return e.copy(t[i]),e}if(2===this.getPointerCount()){const n=this.pointerOrder[0],i=this.pointerOrder[1],r=t[n],s=t[i];return e.addVectors(r,s).multiplyScalar(.5),e}return null}getPreviousCenterPoint(e){return this.getCenterPoint(e,this.previousPositions)}getStartCenterPoint(e){return this.getCenterPoint(e,this.startPositions)}getMoveDistance(){return this.getCenterPoint(Rm),this.getPreviousCenterPoint(Om),Rm.sub(Om).length()}getTouchPointerDistance(e=this.pointerPositions){if(this.getPointerCount()<=1||"mouse"===this.getPointerType())return 0;const{pointerOrder:t}=this,n=t[0],i=t[1],r=e[n],s=e[i];return r.distanceTo(s)}getPreviousTouchPointerDistance(){return this.getTouchPointerDistance(this.previousPositions)}getStartTouchPointerDistance(){return this.getTouchPointerDistance(this.startPositions)}getPointerType(){return this.pointerType}isPointerTouch(){return"touch"===this.getPointerType()}getPointerButtons(){return this.buttons}isLeftClicked(){return!!(1&this.buttons)}isRightClicked(){return!!(2&this.buttons)}}const Lm=new La,Im=new Fa,Dm=new ka;function Fm(e,t,n){return n.makeTranslation(-e.x,-e.y,-e.z),Lm.makeRotationFromQuaternion(t),n.premultiply(Lm),Lm.makeTranslation(e.x,e.y,e.z),n.premultiply(Lm),n}function Um(e,t,n,i){i.x=(e-n.offsetLeft)/n.clientWidth*2-1,i.y=-(t-n.offsetTop)/n.clientHeight*2+1,i.isVector3&&(i.z=0)}function Nm(e,t,n){return t.intersectRay(e,n)?n:(Lm.makeScale(...t.radius).invert(),Im.copy(e).applyMatrix4(Lm),Dm.set(0,0,0),Im.closestPointToPoint(Dm,n).normalize(),Lm.makeScale(...t.radius),n.applyMatrix4(Lm))}function jm(e,t,n){const i=e instanceof Fa?e:e.ray,{origin:r,direction:s}=i;r.set(t.x,t.y,-1).unproject(n),s.set(t.x,t.y,1).unproject(n).sub(r),e.isRay||(e.near=0,e.far=s.length(),e.camera=n),s.normalize()}const zm=.05,Bm=.025,Vm=new La,Hm=new La,Gm=new ka,Wm=new ka,Km=new ka,Xm=new ka,qm=new ka,Ym=new ka,$m=new ka,Zm=new ka,Qm=new Da,Jm=new $l,ef=new ka,tf=new ka,nf=new ka,rf=new Da,sf=new Fa,of=new Oa,af=new Oa,lf=new Oa,cf=new Oa,uf=new Oa,hf=new Oa,df={type:"change"},pf={type:"start"},mf={type:"end"};class ff extends ec{get enabled(){return this._enabled}set enabled(e){e!==this.enabled&&(this._enabled=e,this.resetState(),this.pointerTracker.reset(),this.enabled||(this.dragInertia.set(0,0,0),this.rotationInertia.set(0,0)))}constructor(e=null,t=null,n=null,i=null){super(),this.isEnvironmentControls=!0,this.domElement=null,this.camera=null,this.scene=null,this.tilesRenderer=null,this._enabled=!0,this.cameraRadius=5,this.rotationSpeed=1,this.minAltitude=0,this.maxAltitude=.45*Math.PI,this.minDistance=10,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.zoomSpeed=1,this.adjustHeight=!0,this.enableDamping=!1,this.dampingFactor=.15,this.fallbackPlane=new $l(new ka(0,1,0),0),this.useFallbackPlane=!0,this.scaleZoomOrientationAtEdges=!1,this.autoAdjustCameraRotation=!0,this.state=0,this.pointerTracker=new km,this.needsUpdate=!1,this.actionHeightOffset=0,this.pivotPoint=new ka,this.zoomDirectionSet=!1,this.zoomPointSet=!1,this.zoomDirection=new ka,this.zoomPoint=new ka,this.zoomDelta=0,this.rotationInertiaPivot=new ka,this.rotationInertia=new Oa,this.dragInertia=new ka,this.inertiaTargetDistance=1/0,this.inertiaStableFrames=0,this.pivotMesh=new Sm,this.pivotMesh.raycast=()=>{},this.pivotMesh.scale.setScalar(.25),this.raycaster=new ic,this.raycaster.firstHitOnly=!0,this.up=new ka(0,1,0),this.clock=new rc,this._detachCallback=null,this._upInitialized=!1,this._lastUsedState=0,this._zoomPointWasSet=!1,this._tilesOnChangeCallback=()=>this.zoomPointSet=!1,n&&this.attach(n),t&&this.setCamera(t),e&&this.setScene(e),i&&this.setTilesRenderer(i)}setScene(e){this.scene=e}setCamera(e){this.camera=e,this._upInitialized=!1,this.zoomDirectionSet=!1,this.zoomPointSet=!1,this.needsUpdate=!0,this.raycaster.camera=e,this.resetState()}setTilesRenderer(e){console.warn('EnvironmentControls: "setTilesRenderer" has been deprecated. Use "setScene" and "setEllipsoid", instead.'),this.tilesRenderer=e,null!==this.tilesRenderer&&this.setScene(this.tilesRenderer.group)}attach(e){if(this.domElement)throw new Error("EnvironmentControls: Controls already attached to element");this.domElement=e,this.pointerTracker.domElement=e,e.style.touchAction="none";const t=e=>{this.enabled&&e.preventDefault()},n=e=>{if(!this.enabled)return;e.preventDefault();const{camera:t,raycaster:n,domElement:i,up:r,pivotMesh:s,pointerTracker:o,scene:a,pivotPoint:l,enabled:c}=this;if(o.addPointer(e),this.needsUpdate=!0,o.isPointerTouch())if(s.visible=!1,0===o.getPointerCount())i.setPointerCapture(e.pointerId);else if(o.getPointerCount()>2)return void this.resetState();o.getCenterPoint(af),Um(af.x,af.y,i,af),jm(n,af,t);const u=Math.abs(n.ray.direction.dot(r));if(u<zm||u<Bm)return;const h=this._raycast(n);h&&(2===o.getPointerCount()||o.isRightClicked()||o.isLeftClicked()&&e.shiftKey?(this.setState(o.isPointerTouch()?4:2),l.copy(h.point),s.position.copy(h.point),s.visible=!o.isPointerTouch()&&c,s.updateMatrixWorld(),a.add(s)):o.isLeftClicked()&&(this.setState(1),l.copy(h.point),s.position.copy(h.point),s.updateMatrixWorld(),a.add(s)))};let i=!1;const r=e=>{if(!this.enabled)return;e.preventDefault();const{pivotMesh:t,enabled:n}=this;this.zoomDirectionSet=!1,this.zoomPointSet=!1,0!==this.state&&(this.needsUpdate=!0);const{pointerTracker:r}=this;r.setHoverEvent(e),r.updatePointer(e)&&(r.isPointerTouch()&&2===r.getPointerCount()&&(i||(i=!0,queueMicrotask(()=>{i=!1,r.getCenterPoint(uf);const e=r.getStartTouchPointerDistance(),s=r.getTouchPointerDistance(),o=s-e;if(0===this.state||4===this.state){r.getCenterPoint(uf),r.getStartCenterPoint(hf);const e=2*window.devicePixelRatio,t=uf.distanceTo(hf);(Math.abs(o)>e||t>e)&&(Math.abs(o)>t?(this.setState(3),this.zoomDirectionSet=!1):this.setState(2))}if(3===this.state){const e=r.getPreviousTouchPointerDistance();this.zoomDelta+=s-e,t.visible=!1}else 2===this.state&&(t.visible=n)}))),this.dispatchEvent(df))},s=t=>{if(!this.enabled)return;const{pointerTracker:n}=this;n.deletePointer(t),"touch"===n.getPointerType()&&0===n.getPointerCount()&&e.releasePointerCapture(t.pointerId),this.resetState(),this.needsUpdate=!0},o=e=>{if(!this.enabled)return;e.preventDefault();const{pointerTracker:t}=this;let n;switch(t.setHoverEvent(e),t.updatePointer(e),this.dispatchEvent(pf),e.deltaMode){case 2:n=800*e.deltaY;break;case 1:n=40*e.deltaY;break;case 0:n=e.deltaY}const i=Math.sign(n),r=Math.abs(n);this.zoomDelta-=.25*i*r,this.needsUpdate=!0,this._lastUsedState=3,this.dispatchEvent(mf)},a=e=>{if(!this.enabled)return;const{pointerTracker:t}=this;e.buttons!==t.getPointerButtons()&&(t.deletePointer(e),this.resetState())};e.addEventListener("contextmenu",t),e.addEventListener("pointerdown",n),e.addEventListener("pointermove",r),e.addEventListener("pointerup",s),e.addEventListener("wheel",o,{passive:!1}),e.addEventListener("pointerenter",a),this._detachCallback=()=>{e.removeEventListener("contextmenu",t),e.removeEventListener("pointerdown",n),e.removeEventListener("pointermove",r),e.removeEventListener("pointerup",s),e.removeEventListener("wheel",o),e.removeEventListener("pointerenter",a)}}detach(){this.domElement=null,this._detachCallback&&(this._detachCallback(),this._detachCallback=null,this.pointerTracker.reset())}getUpDirection(e,t){t.copy(this.up)}getCameraUpDirection(e){this.getUpDirection(this.camera.position,e)}getPivotPoint(e){let t=null;3===this._lastUsedState?this._zoomPointWasSet&&(t=e.copy(this.zoomPoint)):(2===this._lastUsedState||1===this._lastUsedState)&&(t=e.copy(this.pivotPoint));const{camera:n,raycaster:i}=this;null!==t&&(Wm.copy(t).project(n),(Wm.x<-1||Wm.x>1||Wm.y<-1||Wm.y>1)&&(t=null)),jm(i,{x:0,y:0},n);const r=this._raycast(i);return r&&(null===t||r.distance<t.distanceTo(i.ray.origin))&&(t=e.copy(r.point)),t}resetState(){0!==this.state&&this.dispatchEvent(mf),this.state=0,this.pivotMesh.removeFromParent(),this.pivotMesh.visible=this.enabled,this.actionHeightOffset=0}setState(e=this.state,t=!0){this.state!==e&&(0===this.state&&t&&this.dispatchEvent(pf),this.pivotMesh.visible=this.enabled,this.dragInertia.set(0,0,0),this.rotationInertia.set(0,0),this.inertiaStableFrames=0,this.state=e,0!==e&&4!==e&&(this._lastUsedState=e))}update(e=Math.min(this.clock.getDelta(),.064)){if(!this.enabled||!this.camera||0===e)return;const{camera:t,cameraRadius:n,pivotPoint:i,up:r,state:s,adjustHeight:o,autoAdjustCameraRotation:a}=this;t.updateMatrixWorld(),this.getCameraUpDirection(ef),this._upInitialized||(this._upInitialized=!0,this.up.copy(ef)),this.zoomPointSet=!1;const l=this._inertiaNeedsUpdate(),c=this.needsUpdate||l;if(this.needsUpdate||l){const n=this.zoomDelta;this._updateZoom(),this._updatePosition(e),this._updateRotation(e),1===s||2===s?(qm.set(0,0,-1).transformDirection(t.matrixWorld),this.inertiaTargetDistance=Wm.copy(i).sub(t.position).dot(qm)):0===s&&this._updateInertia(e),(0!==s||0!==n||l)&&this.dispatchEvent(df),this.needsUpdate=!1}const u=t.isOrthographicCamera?null:o&&this._getPointBelowCamera()||null;if(this.getCameraUpDirection(ef),this._setFrame(ef),(1===this.state||2===this.state)&&0!==this.actionHeightOffset){const{actionHeightOffset:e}=this;t.position.addScaledVector(r,-e),i.addScaledVector(r,-e),u&&(u.distance-=e)}if(this.actionHeightOffset=0,u){const e=u.distance;if(e<n){const s=n-e;t.position.addScaledVector(r,s),i.addScaledVector(r,s),this.actionHeightOffset=s}}this.pointerTracker.updateFrame(),c&&a&&(this.getCameraUpDirection(ef),this._alignCameraUp(ef,1),this.getCameraUpDirection(ef),this._clampRotation(ef))}adjustCamera(e){const{adjustHeight:t,cameraRadius:n}=this;if(e.isPerspectiveCamera){this.getUpDirection(e.position,ef);const i=t&&this._getPointBelowCamera(e.position,ef)||null;if(i){const t=i.distance;t<n&&e.position.addScaledVector(ef,n-t)}}}dispose(){this.detach()}_updateInertia(e){const{rotationInertia:t,pivotPoint:n,dragInertia:i,enableDamping:r,dampingFactor:s,camera:o,cameraRadius:a,minDistance:l,inertiaTargetDistance:c}=this;if(!this.enableDamping||this.inertiaStableFrames>1)return i.set(0,0,0),void t.set(0,0,0);const u=Math.pow(2,-e/s),h=Math.max(o.near,a,l,c),d=25e-5;if(t.lengthSq()>0){jm(sf,Wm.set(0,0,-1),o),sf.applyMatrix4(o.matrixWorldInverse),sf.direction.normalize(),sf.recast(-sf.direction.dot(sf.origin)).at(h/sf.direction.z,Wm),Wm.applyMatrix4(o.matrixWorld),jm(sf,Gm.set(d,d,-1),o),sf.applyMatrix4(o.matrixWorldInverse),sf.direction.normalize(),sf.recast(-sf.direction.dot(sf.origin)).at(h/sf.direction.z,Gm),Gm.applyMatrix4(o.matrixWorld),Wm.sub(n).normalize(),Gm.sub(n).normalize();const i=Wm.angleTo(Gm)/e;t.multiplyScalar(u),(t.lengthSq()<i**2||!r)&&t.set(0,0)}if(i.lengthSq()>0){jm(sf,Wm.set(0,0,-1),o),sf.applyMatrix4(o.matrixWorldInverse),sf.direction.normalize(),sf.recast(-sf.direction.dot(sf.origin)).at(h/sf.direction.z,Wm),Wm.applyMatrix4(o.matrixWorld),jm(sf,Gm.set(d,d,-1),o),sf.applyMatrix4(o.matrixWorldInverse),sf.direction.normalize(),sf.recast(-sf.direction.dot(sf.origin)).at(h/sf.direction.z,Gm),Gm.applyMatrix4(o.matrixWorld);const t=Wm.distanceTo(Gm)/e;i.multiplyScalar(u),(i.lengthSq()<t**2||!r)&&i.set(0,0,0)}t.lengthSq()>0&&this._applyRotation(t.x*e,t.y*e,n),i.lengthSq()>0&&(o.position.addScaledVector(i,e),o.updateMatrixWorld())}_inertiaNeedsUpdate(){const{rotationInertia:e,dragInertia:t}=this;return 0!==e.lengthSq()||0!==t.lengthSq()}_updateZoom(){const{zoomPoint:e,zoomDirection:t,camera:n,minDistance:i,maxDistance:r,pointerTracker:s,domElement:o,minZoom:a,maxZoom:l,zoomSpeed:c,state:u}=this;let h=this.zoomDelta;if(this.zoomDelta=0,s.getLatestPoint(af)&&(0!==h||3===u))if(this.rotationInertia.set(0,0),this.dragInertia.set(0,0,0),n.isOrthographicCamera){this._updateZoomDirection();const e=this.zoomPointSet||this._updateZoomPoint();tf.unproject(n);const t=Math.pow(.95,Math.abs(.05*h));let i=h>0?1/Math.abs(t):t;i*=c,i>1?l<n.zoom*i&&(i=1):a>n.zoom*i&&(i=1),n.zoom*=i,n.updateProjectionMatrix(),e&&(Um(af.x,af.y,o,nf),nf.unproject(n),n.position.sub(nf).add(tf),n.updateMatrixWorld())}else{this._updateZoomDirection();const s=Wm.copy(t);if(this.zoomPointSet||this._updateZoomPoint()){const s=e.distanceTo(n.position);if(h<0){const e=Math.min(0,s-r);h=h*s*c*.0025,h=Math.max(h,e)}else{const e=Math.max(0,s-i);h=h*Math.max(s-i,0)*c*.0025,h=Math.min(h,e)}n.position.addScaledVector(t,h),n.updateMatrixWorld()}else{const e=this._getPointBelowCamera();if(e){const t=e.distance;s.set(0,0,-1).transformDirection(n.matrixWorld),n.position.addScaledVector(s,h*t*.01),n.updateMatrixWorld()}}}}_updateZoomDirection(){if(this.zoomDirectionSet)return;const{domElement:e,raycaster:t,camera:n,zoomDirection:i,pointerTracker:r}=this;r.getLatestPoint(af),Um(af.x,af.y,e,tf),jm(t,tf,n),i.copy(t.ray.direction).normalize(),this.zoomDirectionSet=!0}_updateZoomPoint(){const{camera:e,zoomDirectionSet:t,zoomDirection:n,raycaster:i,zoomPoint:r,pointerTracker:s,domElement:o}=this;if(this._zoomPointWasSet=!1,!t)return!1;e.isOrthographicCamera&&s.getLatestPoint(of)?(Um(of.x,of.y,o,of),jm(i,of,e)):(i.ray.origin.copy(e.position),i.ray.direction.copy(n),i.near=0,i.far=1/0);const a=this._raycast(i);return!!a&&(r.copy(a.point),this.zoomPointSet=!0,this._zoomPointWasSet=!0,!0)}_getPointBelowCamera(e=this.camera.position,t=this.up){const{raycaster:n}=this;n.ray.direction.copy(t).multiplyScalar(-1),n.ray.origin.copy(e).addScaledVector(t,1e5),n.near=0,n.far=1/0;const i=this._raycast(n);return i&&(i.distance-=1e5),i}_updatePosition(e){const{raycaster:t,camera:n,pivotPoint:i,up:r,pointerTracker:s,domElement:o,state:a,dragInertia:l}=this;if(1===a){if(s.getCenterPoint(af),Um(af.x,af.y,o,af),Jm.setFromNormalAndCoplanarPoint(r,i),jm(t,af,n),Math.abs(t.ray.direction.dot(r))<zm){const e=Math.acos(zm);Zm.crossVectors(t.ray.direction,r).normalize(),t.ray.direction.copy(r).applyAxisAngle(Zm,e).multiplyScalar(-1)}if(this.getUpDirection(i,ef),Math.abs(t.ray.direction.dot(ef))<Bm){const e=Math.acos(Bm);Zm.crossVectors(t.ray.direction,ef).normalize(),t.ray.direction.copy(ef).applyAxisAngle(Zm,e).multiplyScalar(-1)}t.ray.intersectPlane(Jm,Wm)&&(Gm.subVectors(i,Wm),n.position.add(Gm),n.updateMatrixWorld(),Gm.multiplyScalar(1/e),s.getMoveDistance()/e<2*window.devicePixelRatio?this.inertiaStableFrames++:(l.copy(Gm),this.inertiaStableFrames=0))}}_updateRotation(e){const{pivotPoint:t,pointerTracker:n,domElement:i,state:r,rotationInertia:s}=this;2===r&&(n.getCenterPoint(af),n.getPreviousCenterPoint(lf),cf.subVectors(af,lf).multiplyScalar(2*Math.PI/i.clientHeight),this._applyRotation(cf.x,cf.y,t),cf.multiplyScalar(1/e),n.getMoveDistance()/e<2*window.devicePixelRatio?this.inertiaStableFrames++:(s.copy(cf),this.inertiaStableFrames=0))}_applyRotation(e,t,n){if(0===e&&0===t)return;const{camera:i,minAltitude:r,maxAltitude:s,rotationSpeed:o}=this,a=-e*o;let l,c=t*o;qm.set(0,0,1).transformDirection(i.matrixWorld),Ym.set(1,0,0).transformDirection(i.matrixWorld),this.getUpDirection(n,ef),ef.dot(qm)>1-1e-10?l=0:(Wm.crossVectors(ef,qm).normalize(),l=Math.sign(Wm.dot(Ym))*ef.angleTo(qm)),c>0?(c=Math.min(l-r,c),c=Math.max(0,c)):(c=Math.max(l-s,c),c=Math.min(0,c)),Qm.setFromAxisAngle(ef,a),Fm(n,Qm,Vm),i.matrixWorld.premultiply(Vm),Ym.set(1,0,0).transformDirection(i.matrixWorld),Qm.setFromAxisAngle(Ym,-c),Fm(n,Qm,Vm),i.matrixWorld.premultiply(Vm),i.matrixWorld.decompose(i.position,i.quaternion,Wm)}_setFrame(e){const{up:t,camera:n,zoomPoint:i,zoomDirectionSet:r,zoomPointSet:s,scaleZoomOrientationAtEdges:o}=this;if(r&&(s||this._updateZoomPoint())){if(Qm.setFromUnitVectors(t,e),o){this.getUpDirection(i,Wm);let e=Math.max(Wm.dot(t)-.6,0)/.4;e=Ia.mapLinear(e,0,.5,0,1),e=Math.min(e,1),n.isOrthographicCamera&&(e*=.1),Qm.slerp(rf,1-e)}Fm(i,Qm,Vm),n.updateMatrixWorld(),n.matrixWorld.premultiply(Vm),n.matrixWorld.decompose(n.position,n.quaternion,Wm),this.zoomDirectionSet=!1,this._updateZoomDirection()}t.copy(e),n.updateMatrixWorld()}_raycast(e){const{scene:t,useFallbackPlane:n,fallbackPlane:i}=this,r=e.intersectObject(t)[0]||null;if(r)return r;if(n){const t=i;if(e.ray.intersectPlane(t,Wm))return{point:Wm.clone(),distance:e.ray.origin.distanceTo(Wm)}}return null}_alignCameraUp(e,t=1){const{camera:n,state:i,pivotPoint:r,zoomPoint:s,zoomPointSet:o}=this;n.updateMatrixWorld(),qm.set(0,0,-1).transformDirection(n.matrixWorld),Ym.set(-1,0,0).transformDirection(n.matrixWorld);let a=Ia.mapLinear(1-Math.abs(qm.dot(e)),0,.2,0,1);a=Ia.clamp(a,0,1),t*=a,$m.crossVectors(e,qm),$m.lerp(Ym,1-t).normalize(),Qm.setFromUnitVectors(Ym,$m),n.quaternion.premultiply(Qm);let l=null;1===i||2===i?l=Km.copy(r):o&&(l=Km.copy(s)),l&&(Hm.copy(n.matrixWorld).invert(),Wm.copy(l).applyMatrix4(Hm),n.updateMatrixWorld(),Wm.applyMatrix4(n.matrixWorld),Xm.subVectors(l,Wm),n.position.add(Xm)),n.updateMatrixWorld()}_clampRotation(e){const{camera:t,minAltitude:n,maxAltitude:i,state:r,pivotPoint:s,zoomPoint:o,zoomPointSet:a}=this;let l,c;if(t.updateMatrixWorld(),qm.set(0,0,1).transformDirection(t.matrixWorld),Ym.set(1,0,0).transformDirection(t.matrixWorld),e.dot(qm)>1-1e-10?l=0:(Wm.crossVectors(e,qm),l=Math.sign(Wm.dot(Ym))*e.angleTo(qm)),l>i)c=i;else{if(!(l<n))return;c=n}qm.copy(e),Qm.setFromAxisAngle(Ym,c),qm.applyQuaternion(Qm).normalize(),Wm.crossVectors(qm,Ym).normalize(),Vm.makeBasis(Ym,Wm,qm),t.quaternion.setFromRotationMatrix(Vm);let u=null;1===r||2===r?u=Km.copy(s):a&&(u=Km.copy(o)),u&&(Hm.copy(t.matrixWorld).invert(),Wm.copy(u).applyMatrix4(Hm),t.updateMatrixWorld(),Wm.applyMatrix4(t.matrixWorld),Xm.subVectors(u,Wm),t.position.add(Xm)),t.updateMatrixWorld()}}const gf=new La,_f=new La,vf=new ka,yf=new ka,bf=new ka,wf=new ka,Tf=new ka,xf=new ka,Ef=new Da,Pf=new ka,Af=new ka,Mf=new Fa,Sf=new bp,Cf=new Oa,Rf={};class Of extends ff{get tilesGroup(){return console.warn('GlobeControls: "tilesGroup" has been deprecated. Use "ellipsoidGroup", instead.'),this.ellipsoidFrame}get ellipsoidFrame(){return this.ellipsoidGroup.matrixWorld}get ellipsoidFrameInverse(){const{ellipsoidGroup:e,ellipsoidFrame:t,_ellipsoidFrameInverse:n}=this;return e.matrixWorldInverse?e.matrixWorldInverse:n.copy(t).invert()}constructor(e=null,t=null,n=null,i=null){super(e,t,n),this.isGlobeControls=!0,this._dragMode=0,this._rotationMode=0,this.maxZoom=.01,this.nearMargin=.25,this.farMargin=0,this.useFallbackPlane=!1,this.autoAdjustCameraRotation=!1,this.globeInertia=new Da,this.globeInertiaFactor=0,this.ellipsoid=wp.clone(),this.ellipsoidGroup=new Ua,this._ellipsoidFrameInverse=new La,null!==i&&this.setTilesRenderer(i)}setTilesRenderer(e){super.setTilesRenderer(e),null!==e&&this.setEllipsoid(e.ellipsoid,e.group)}setEllipsoid(e,t){this.ellipsoid=e||wp.clone(),this.ellipsoidGroup=t||new Ua}getPivotPoint(e){const{camera:t,ellipsoidFrame:n,ellipsoidFrameInverse:i,ellipsoid:r}=this;return wf.set(0,0,-1).transformDirection(t.matrixWorld),Mf.origin.copy(t.position),Mf.direction.copy(wf),Mf.applyMatrix4(i),Nm(Mf,r,yf),yf.applyMatrix4(n),(null===super.getPivotPoint(e)||vf.subVectors(e,Mf.origin).dot(Mf.direction)>vf.subVectors(yf,Mf.origin).dot(Mf.direction))&&e.copy(yf),e}getVectorToCenter(e){const{ellipsoidFrame:t,camera:n}=this;return e.setFromMatrixPosition(t).sub(n.position)}getDistanceToCenter(){return this.getVectorToCenter(yf).length()}getUpDirection(e,t){const{ellipsoidFrame:n,ellipsoidFrameInverse:i,ellipsoid:r}=this;yf.copy(e).applyMatrix4(i),r.getPositionToNormal(yf,t),t.transformDirection(n)}getCameraUpDirection(e){const{ellipsoidFrame:t,ellipsoidFrameInverse:n,ellipsoid:i,camera:r}=this;r.isOrthographicCamera?(this._getVirtualOrthoCameraPosition(yf),yf.applyMatrix4(n),i.getPositionToNormal(yf,e),e.transformDirection(t)):this.getUpDirection(r.position,e)}update(e=Math.min(this.clock.getDelta(),.064)){if(!this.enabled||!this.camera||0===e)return;const{camera:t,pivotMesh:n}=this;this._isNearControls()?this.scaleZoomOrientationAtEdges=this.zoomDelta<0:(0!==this.state&&1!==this._dragMode&&1!==this._rotationMode&&(n.visible=!1),this.scaleZoomOrientationAtEdges=!1);const i=this.needsUpdate||this._inertiaNeedsUpdate();super.update(e),this.adjustCamera(t),i&&this._isNearControls()&&(this.getCameraUpDirection(xf),this._alignCameraUp(xf,1),this.getCameraUpDirection(xf),this._clampRotation(xf))}adjustCamera(e){super.adjustCamera(e);const{ellipsoidFrame:t,ellipsoidFrameInverse:n,ellipsoid:i,nearMargin:r,farMargin:s}=this,o=Math.max(...i.radius);if(e.isPerspectiveCamera){const a=yf.setFromMatrixPosition(t).sub(e.position).length(),l=r*o,c=Ia.clamp((a-o)/l,0,1),u=Ia.lerp(1,1e3,c);e.near=Math.max(u,a-o-l),vf.copy(e.position).applyMatrix4(n),i.getPositionToCartographic(vf,Rf);const h=Math.max(i.getPositionElevation(vf),2550),d=i.calculateHorizonDistance(Rf.lat,h);e.far=d+.1+o*s,e.updateProjectionMatrix()}else{this._getVirtualOrthoCameraPosition(e.position,e),e.updateMatrixWorld(),gf.copy(e.matrixWorld).invert(),yf.setFromMatrixPosition(t).applyMatrix4(gf);const n=-yf.z;e.near=n-o*(1+r),e.far=n+.1+o*s,e.position.addScaledVector(wf,e.near),e.far-=e.near,e.near=0,e.updateProjectionMatrix(),e.updateMatrixWorld()}}resetState(){super.resetState(),this._dragMode=0,this._rotationMode=0}_updateInertia(e){super._updateInertia(e);const{globeInertia:t,enableDamping:n,dampingFactor:i,camera:r,cameraRadius:s,minDistance:o,inertiaTargetDistance:a,ellipsoidFrame:l}=this;if(!this.enableDamping||this.inertiaStableFrames>1)return this.globeInertiaFactor=0,void this.globeInertia.identity();const c=Math.pow(2,-e/i),u=Math.max(r.near,s,o,a),h=25e-5;if(bf.setFromMatrixPosition(l),0!==this.globeInertiaFactor){jm(Mf,yf.set(0,0,-1),r),Mf.applyMatrix4(r.matrixWorldInverse),Mf.direction.normalize(),Mf.recast(-Mf.direction.dot(Mf.origin)).at(u/Mf.direction.z,yf),yf.applyMatrix4(r.matrixWorld),jm(Mf,vf.set(h,h,-1),r),Mf.applyMatrix4(r.matrixWorldInverse),Mf.direction.normalize(),Mf.recast(-Mf.direction.dot(Mf.origin)).at(u/Mf.direction.z,vf),vf.applyMatrix4(r.matrixWorld),yf.sub(bf).normalize(),vf.sub(bf).normalize(),this.globeInertiaFactor*=c;const i=yf.angleTo(vf)/e;(2*Math.acos(t.w)*this.globeInertiaFactor<i||!n)&&(this.globeInertiaFactor=0,t.identity())}0!==this.globeInertiaFactor&&(1===t.w&&(0!==t.x||0!==t.y||0!==t.z)&&(t.w=Math.min(t.w,1-1e-9)),bf.setFromMatrixPosition(l),Ef.identity().slerp(t,this.globeInertiaFactor*e),Fm(bf,Ef,_f),r.matrixWorld.premultiply(_f),r.matrixWorld.decompose(r.position,r.quaternion,yf))}_inertiaNeedsUpdate(){return super._inertiaNeedsUpdate()||0!==this.globeInertiaFactor}_updatePosition(e){if(1===this.state){0===this._dragMode&&(this._dragMode=this._isNearControls()?1:-1);const{raycaster:t,camera:n,pivotPoint:i,pointerTracker:r,domElement:s,ellipsoidFrame:o,ellipsoidFrameInverse:a}=this,l=vf,c=Tf;r.getCenterPoint(Cf),Um(Cf.x,Cf.y,s,Cf),jm(t,Cf,n),t.ray.applyMatrix4(a);const u=yf.copy(i).applyMatrix4(a).length();Sf.radius.setScalar(u),n.isPerspectiveCamera?Sf.intersectRay(t.ray,yf)||function(e,t,n){const i=e.origin.length(),r=Math.acos(t/i);n.copy(e.origin).multiplyScalar(-1).normalize();const s=Dm.crossVectors(n,e.direction).normalize();n.multiplyScalar(-1).applyAxisAngle(s,-r).normalize().multiplyScalar(t)}(t.ray,u,yf):Nm(t.ray,Sf,yf),yf.applyMatrix4(o),bf.setFromMatrixPosition(o),l.subVectors(i,bf).normalize(),c.subVectors(yf,bf).normalize(),Ef.setFromUnitVectors(c,l),Fm(bf,Ef,_f),n.matrixWorld.premultiply(_f),n.matrixWorld.decompose(n.position,n.quaternion,yf),r.getMoveDistance()/e<2*window.devicePixelRatio?this.inertiaStableFrames++:(this.globeInertia.copy(Ef),this.globeInertiaFactor=1/e,this.inertiaStableFrames=0)}}_updateRotation(...e){1===this._rotationMode||this._isNearControls()?(this._rotationMode=1,super._updateRotation(...e)):(this.pivotMesh.visible=!1,this._rotationMode=-1)}_updateZoom(){const{zoomDelta:e,ellipsoid:t,zoomSpeed:n,zoomPoint:i,camera:r,maxZoom:s,state:o}=this;if(3!==o&&0===e)return;this.rotationInertia.set(0,0),this.dragInertia.set(0,0,0),this.globeInertia.identity(),this.globeInertiaFactor=0;const a=Ia.clamp(Ia.mapLinear(Math.abs(e),0,20,0,1),0,1);if(this._isNearControls()||e>0){if(this._updateZoomDirection(),e<0&&(this.zoomPointSet||this._updateZoomPoint())){wf.set(0,0,-1).transformDirection(r.matrixWorld).normalize(),Af.copy(this.up).multiplyScalar(-1),this.getUpDirection(i,Pf);const e=Ia.clamp(Ia.mapLinear(-Pf.dot(Af),1,.95,0,1),0,1),t=1-wf.dot(Af),n=r.isOrthographicCamera?.05:1,s=Ia.clamp(3*a,0,1),o=Math.min(e*t*n*s,.1);Af.lerpVectors(wf,Af,o).normalize(),Ef.setFromUnitVectors(wf,Af),Fm(i,Ef,_f),r.matrixWorld.premultiply(_f),r.matrixWorld.decompose(r.position,r.quaternion,Af),this.zoomDirection.subVectors(i,r.position).normalize()}super._updateZoom()}else if(r.isPerspectiveCamera){const i=this._getPerspectiveTransitionDistance(),r=this._getMaxPerspectiveDistance(),s=Ia.mapLinear(this.getDistanceToCenter(),i,r,0,1);this._tiltTowardsCenter(Ia.lerp(0,.4,s*a)),this._alignCameraUpToNorth(Ia.lerp(0,.2,s*a));const o=e*(this.getDistanceToCenter()-t.radius.x)*n*.0025,l=Math.max(o,Math.min(this.getDistanceToCenter()-r,0));this.getVectorToCenter(yf).normalize(),this.camera.position.addScaledVector(yf,l),this.camera.updateMatrixWorld(),this.zoomDelta=0}else{const e=this._getOrthographicTransitionZoom(),t=this._getMinOrthographicZoom(),i=Ia.mapLinear(r.zoom,e,t,0,1);this._tiltTowardsCenter(Ia.lerp(0,.4,i*a)),this._alignCameraUpToNorth(Ia.lerp(0,.2,i*a));const o=this.zoomDelta,l=Math.pow(.95,Math.abs(.05*o)),c=o>0?1/Math.abs(l):l,u=t/r.zoom,h=Math.max(c*n,Math.min(u,1));r.zoom=Math.min(s,r.zoom*h),r.updateProjectionMatrix(),this.zoomDelta=0,this.zoomDirectionSet=!1}}_alignCameraUpToNorth(e){const{ellipsoidFrame:t}=this;xf.set(0,0,1).transformDirection(t),this._alignCameraUp(xf,e)}_tiltTowardsCenter(e){const{camera:t,ellipsoidFrame:n}=this;wf.set(0,0,-1).transformDirection(t.matrixWorld).normalize(),yf.setFromMatrixPosition(n).sub(t.position).normalize(),yf.lerp(wf,1-e).normalize(),Ef.setFromUnitVectors(wf,yf),t.quaternion.premultiply(Ef),t.updateMatrixWorld()}_getPerspectiveTransitionDistance(){const{camera:e,ellipsoid:t}=this;if(!e.isPerspectiveCamera)throw new Error;const n=Math.max(...t.radius),i=2*Math.atan(Math.tan(Ia.DEG2RAD*e.fov*.5)*e.aspect),r=n/Math.tan(Ia.DEG2RAD*e.fov*.5),s=n/Math.tan(.5*i);return Math.max(r,s)}_getMaxPerspectiveDistance(){const{camera:e,ellipsoid:t}=this;if(!e.isPerspectiveCamera)throw new Error;const n=Math.max(...t.radius),i=2*Math.atan(Math.tan(Ia.DEG2RAD*e.fov*.5)*e.aspect),r=n/Math.tan(Ia.DEG2RAD*e.fov*.5),s=n/Math.tan(.5*i);return 2*Math.max(r,s)}_getOrthographicTransitionZoom(){const{camera:e,ellipsoid:t}=this;if(!e.isOrthographicCamera)throw new Error;const n=e.top-e.bottom,i=e.right-e.left;return 2*Math.max(n,i)/(2*Math.max(...t.radius))}_getMinOrthographicZoom(){const{camera:e,ellipsoid:t}=this;if(!e.isOrthographicCamera)throw new Error;const n=e.top-e.bottom,i=e.right-e.left;return.7*Math.min(n,i)/(2*Math.max(...t.radius))}_getVirtualOrthoCameraPosition(e,t=this.camera){const{ellipsoidFrame:n,ellipsoidFrameInverse:i,ellipsoid:r}=this;if(!t.isOrthographicCamera)throw new Error;Mf.origin.copy(t.position),Mf.direction.set(0,0,-1).transformDirection(t.matrixWorld),Mf.applyMatrix4(i),Nm(Mf,r,vf),vf.applyMatrix4(n);const s=t.top-t.bottom,o=t.right-t.left,a=Math.max(s,o)/t.zoom;wf.set(0,0,-1).transformDirection(t.matrixWorld);const l=vf.sub(t.position).dot(wf);e.copy(t.position).addScaledVector(wf,l-4*a)}_isNearControls(){const{camera:e}=this;return e.isPerspectiveCamera?this.getDistanceToCenter()<this._getPerspectiveTransitionDistance():e.zoom>this._getOrthographicTransitionZoom()}_raycast(e){const t=super._raycast(e);if(null===t){const{ellipsoid:t,ellipsoidFrame:n,ellipsoidFrameInverse:i}=this;Mf.copy(e.ray).applyMatrix4(i);const r=t.intersectRay(Mf,yf);return null!==r?{point:r.clone().applyMatrix4(n)}:null}return t}}const kf=Symbol("TILE_X"),Lf=Symbol("TILE_Y"),If=Symbol("TILE_LEVEL");class Df{get tiling(){return this.imageSource.tiling}constructor(e={}){const{pixelSize:t=.01,center:n=!1,useRecommendedSettings:i=!0,imageSource:r=null}=e;this.priority=-10,this.tiles=null,this.imageSource=r,this.pixelSize=t,this.center=n,this.useRecommendedSettings=i}init(e){this.useRecommendedSettings&&(e.errorTarget=1),this.tiles=e,this.imageSource.fetchOptions=e.fetchOptions,this.imageSource.fetchData=(t,n)=>(e.invokeAllPlugins(e=>t=e.preprocessURL?e.preprocessURL(t,null):t),e.invokeOnePlugin(e=>e!==this&&e.fetchData&&e.fetchData(t,n)))}async loadRootTileSet(){const{tiles:e,imageSource:t}=this;let n=e.rootURL;return e.invokeAllPlugins(e=>n=e.preprocessURL?e.preprocessURL(n,null):n),await t.init(n),this.getTileset(n)}async parseToMesh(e,t,n,i,r){if(r.aborted)return null;const s=t[kf],o=t[Lf],a=t[If],l=await this.imageSource.processBufferToTexture(e);this.imageSource.setData(s,o,a,l);let c=1,u=1,h=0,d=0,p=0;const m=t.boundingVolume.box;m&&([h,d,p]=m,c=m[3],u=m[7]);const f=new Za(new tc(2*c,2*u),new Ya({map:l,transparent:!0}));return f.position.set(h,d,p),f}preprocessNode(e){const{tiling:t}=this,n=t.maxLevel;e[If]<n&&null!==e.parent&&this.expandChildren(e)}disposeTile(e){const t=e[kf],n=e[Lf],i=e[If],{imageSource:r}=this;r.has(t,n,i)&&r.release(t,n,i)}getTileset(e){const{tiling:t,tiles:n}=this,i=t.minLevel,{tileCountX:r,tileCountY:s}=t.getLevel(i),o=[];for(let l=0;l<r;l++)for(let e=0;e<s;e++){const t=this.createChild(l,e,i);null!==t&&o.push(t)}const a={asset:{version:"1.1"},geometricError:1e5,root:{refine:"REPLACE",geometricError:1e5,boundingVolume:this.createBoundingVolume(0,0,-1),children:o,[If]:-1,[kf]:0,[Lf]:0}};return n.preprocessTileSet(a,e),a}getUrl(e,t,n){return this.imageSource.getUrl(e,t,n)}createBoundingVolume(e,t,n){const{center:i,pixelSize:r,tiling:s}=this,{pixelWidth:o,pixelHeight:a}=s.getLevel(s.maxLevel),[l,c,u,h]=-1===n?s.getFullBounds(!0):s.getTileBounds(e,t,n,!0);let d=(u-l)/2,p=(h-c)/2,m=l+d,f=c+p;return i&&(m-=.5,f-=.5),m*=o*r,d*=o*r,f*=a*r,p*=a*r,{box:[m,f,0,d,0,0,0,p,0,0,0,0]}}createChild(e,t,n){const{pixelSize:i,tiling:r}=this;if(!r.getTileExists(e,t,n))return null;const{pixelWidth:s,pixelHeight:o}=r.getLevel(r.maxLevel),{pixelWidth:a,pixelHeight:l}=r.getLevel(n);return{refine:"REPLACE",geometricError:i*(Math.max(s/a,o/l)-1),boundingVolume:this.createBoundingVolume(e,t,n),content:{uri:this.getUrl(e,t,n)},children:[],[kf]:e,[Lf]:t,[If]:n}}expandChildren(e){const t=e[If],n=e[kf],i=e[Lf];for(let r=0;r<2;r++)for(let s=0;s<2;s++){const o=this.createChild(2*n+r,2*i+s,t+1);o&&e.children.push(o)}}}const Ff=new ka,Uf=new ka;const Nf=new ka,jf=new ka,zf=new Oa,Bf=new Xl;class Vf extends Df{get projection(){return this.tiling.projection}constructor(e={}){const{shape:t="planar",endCaps:n=!0,...i}=e;super(i),this.shape=t,this.endCaps=n}async parseToMesh(e,t,...n){const i=await super.parseToMesh(e,t,...n),{shape:r,projection:s,tiles:o,tiling:a}=this;if("ellipsoid"===r){const e=o.ellipsoid,n=t[If],r=t[kf],l=t[Lf],[c,u,h,d]=a.getTileBounds(r,l,n,!0),[p,m,f,g]=t.boundingVolume.region,_=Math.ceil((g-m)*Ia.RAD2DEG*.25),v=Math.ceil((f-p)*Ia.RAD2DEG*.25),y=Math.max(15,_),b=Math.max(30,v),w=new tc(1,1,b,y),{position:T,normal:x,uv:E}=w.attributes,P=T.count;t.cached.boundingVolume.getSphere(Bf);for(let t=0;t<P;t++){Nf.fromBufferAttribute(T,t),jf.fromBufferAttribute(x,t),zf.fromBufferAttribute(E,t);const n=Ia.mapLinear(zf.x,0,1,p,f);let i=Ia.mapLinear(zf.y,0,1,m,g);if(s.isMercator&&0!==zf.y&&1!==zf.y){const e=s.convertProjectionToLatitude(1),t=1/y,n=Ia.mapLinear(zf.y-t,0,1,m,g),r=Ia.mapLinear(zf.y+t,0,1,m,g);i>e&&n<e&&(i=e),i<-e&&r>-e&&(i=-e)}e.getCartographicToPosition(i,n,0,Nf).sub(Bf.center),e.getCartographicToNormal(i,n,jf);const r=Ia.mapLinear(s.convertLongitudeToProjection(n),c,h,0,1),o=Ia.mapLinear(s.convertLatitudeToProjection(i),u,d,0,1);E.setXY(t,r,o),T.setXYZ(t,...Nf),x.setXYZ(t,...jf)}i.geometry=w,i.position.copy(Bf.center)}return i}createBoundingVolume(e,t,n){if("ellipsoid"===this.shape){const{tiling:i,endCaps:r}=this,s=-1===n,o=s?i.getFullBounds(!0):i.getTileBounds(e,t,n,!0),a=s?i.getFullBounds():i.getTileBounds(e,t,n);return r&&(1===o[3]&&(a[3]=Math.PI/2),0===o[1]&&(a[1]=-Math.PI/2)),{region:[...a,-1,1]}}return super.createBoundingVolume(e,t,n)}preprocessNode(e,...t){super.preprocessNode(e,t);const{shape:n,projection:i,tiling:r}=this;if("ellipsoid"===n){const t=e[If],n=e[kf],s=e[Lf];if(-1===t)return e.geometricError=1e50,parent;const[o,a,l,c]=r.getTileBounds(n,s,t,!0),{tilePixelWidth:u,tilePixelHeight:h}=r.getLevel(t),{pixelWidth:d,pixelHeight:p}=r.getLevel(r.maxLevel),m=(l-o)/u,f=(c-a)/h,g=1/d,_=1/p,[,v,y,b]=r.getTileBounds(n,s,t),w=v>0!=b>0?0:Math.min(Math.abs(v),Math.abs(b)),T=i.convertLatitudeToProjection(w),x=i.getLongitudeDerivativeAtProjection(o),E=i.getLatitudeDerivativeAtProjection(T),[P,A]=function(e,t,n){const i=n+1e-5;let r=t+1e-5;Math.abs(r)>Math.PI/2&&(r-=1e-5),e.getCartographicToPosition(t,n,0,Ff),e.getCartographicToPosition(r,n,0,Uf);const s=Ff.distanceTo(Uf)/1e-5;return e.getCartographicToPosition(t,i,0,Uf),[Ff.distanceTo(Uf)/1e-5,s]}(this.tiles.ellipsoid,w,y),M=Math.max(m*x*P,f*E*A),S=Math.max(g*x*P,_*E*A);e.geometricError=M-S,null===e.parent&&(e.geometricError=1e50)}return e}}class Hf{get isMercator(){return"EPSG:3857"===this.scheme}constructor(e="EPSG:4326"){this.scheme=e,this.tileCountX=1,this.tileCountY=1,this.setScheme(e)}setScheme(e){switch(this.scheme=e,e){case"EPSG:4326":this.tileCountX=2,this.tileCountY=1;break;case"EPSG:3857":this.tileCountX=1,this.tileCountY=1;break;default:throw new Error}}convertProjectionToLatitude(e){if(this.isMercator){const t=Ia.mapLinear(e,0,1,-1,1);return 2*Math.atan(Math.exp(t*Math.PI))-Math.PI/2}return Ia.mapLinear(e,0,1,-Math.PI/2,Math.PI/2)}convertProjectionToLongitude(e){return Ia.mapLinear(e,0,1,-Math.PI,Math.PI)}convertLatitudeToProjection(e){if(this.isMercator){return.5+1*Math.log(Math.tan(Math.PI/4+e/2))/(2*Math.PI)}return Ia.mapLinear(e,-Math.PI/2,Math.PI/2,0,1)}convertLongitudeToProjection(e){return(e+Math.PI)/(2*Math.PI)}getLongitudeDerivativeAtProjection(e){return 2*Math.PI}getLatitudeDerivativeAtProjection(e){let t=e-1e-5;return t<0&&(t=e+1e-5),this.isMercator?Math.abs(this.convertProjectionToLatitude(e)-this.convertProjectionToLatitude(t))/1e-5:Math.PI}getBounds(){return[this.convertProjectionToLongitude(0),this.convertProjectionToLatitude(0),this.convertProjectionToLongitude(1),this.convertProjectionToLatitude(1)]}}function Gf(...e){return e.join("_")}class Wf{constructor(){this.cache={},this.count=0,this.cachedBytes=0}fetchItem(){}disposeItem(){}getMemoryUsage(e){return 0}setData(...e){const{cache:t}=this,n=e.pop(),i=Gf(...e);if(i in t)throw new Error(`DataCache: "${i}" is already present.`);return this.cache[i]={abortController:new AbortController,result:n,count:1,bytes:this.getMemoryUsage(n)},this.count++,this.cachedBytes+=this.cache[i].bytes,n}lock(...e){const{cache:t}=this,n=Gf(...e);if(n in t)t[n].count++;else{const t=new AbortController,i={abortController:t,result:null,count:1,bytes:0};i.result=this.fetchItem(...e,t.signal),i.result instanceof Promise?i.result.then(e=>(i.result=e,i.bytes=this.getMemoryUsage(e),this.cachedBytes+=i.bytes,e)):(i.bytes=this.getMemoryUsage(i.result),this.cachedBytes+=i.bytes),this.cache[n]=i,this.count++}return t[n].result}release(...e){const t=Gf(...e);this.releaseViaFullKey(t)}get(...e){const{cache:t}=this,n=Gf(...e);return n in t&&t[n].count>0?t[n].result:null}has(...e){const{cache:t}=this;return Gf(...e)in t}dispose(){const{cache:e}=this;for(const t in e){const{abortController:n}=e[t];n.abort(),this.releaseViaFullKey(t,!0)}this.cache={}}releaseViaFullKey(e,t=!1){const{cache:n}=this;if(e in n&&n[e].count>0){const i=n[e];if(i.count--,0===i.count||t){const r=()=>{if(n[e]!==i)return;const{result:t,abortController:r}=i;r.abort(),t instanceof Promise?t.then(e=>this.disposeItem(e)).catch(()=>{}):this.disposeItem(t),delete n[e],this.count--,this.cachedBytes-=i.bytes};t?r():queueMicrotask(()=>{0===i.count&&r()})}return!0}throw new Error("DataCache: Attempting to release key that does not exist")}}function Kf(e,t,n){return Math.min(Math.max(e,t),n)}class Xf{get levelCount(){return this._levels.length}get maxLevel(){return this.levelCount-1}get minLevel(){const e=this._levels;for(let t=0;t<e.length;t++)if(null!==e[t])return t;return-1}get rootBounds(){return this._rootBounds??this.projection?.getBounds()??[0,0,1,1]}get rootOrigin(){const e=this.rootBounds;return this._rootOrigin??[e[0],e[1]]}get aspect(){const{pixelWidth:e,pixelHeight:t}=this.getLevel(this.maxLevel);return e/t}constructor(){this.flipY=!1,this.pixelOverlap=0,this._rootBounds=null,this._rootOrigin=null,this.projection=null,this._levels=[]}setLevel(e,t={}){const n=this._levels;for(;n.length<e;)n.push(null);const{tilePixelWidth:i=256,tilePixelHeight:r=256,tileCountX:s=2**e,tileCountY:o=2**e}=t,{pixelWidth:a=i*s,pixelHeight:l=r*o}=t;n[e]={tilePixelWidth:i,tilePixelHeight:r,pixelWidth:a,pixelHeight:l,tileCountX:s,tileCountY:o}}generateLevels(e,t,n,i={}){const{minLevel:r=0,tilePixelWidth:s=256,tilePixelHeight:o=256}=i,a=e-1,{pixelWidth:l=s*t*2**a,pixelHeight:c=o*n*2**a}=i;for(let u=r;u<e;u++){const t=e-u-1,n=Math.ceil(l*2**-t),i=Math.ceil(c*2**-t),r=Math.ceil(n/s),a=Math.ceil(i/o);this.setLevel(u,{tilePixelWidth:s,tilePixelHeight:o,pixelWidth:n,pixelHeight:i,tileCountX:r,tileCountY:a})}}getLevel(e){return this._levels[e]}setOrigin(e,t){this._rootOrigin=[e,t]}setBounds(e,t,n,i){this._rootBounds=[e,t,n,i]}setProjection(e){this.projection=e}getTileAtPoint(e,t,n,i=!1){const{projection:r,flipY:s}=this,{tileCountX:o,tileCountY:a}=this.getLevel(n),l=1/o,c=1/a;r&&!i&&(e=r.convertLongitudeToProjection(e),t=r.convertLatitudeToProjection(t));const u=Math.floor(e/l);let h=Math.floor(t/c);return s&&(h=a-1-h),[u,h]}getTilesInRange(e,t,n,i,r,s=!1){const o=this.getTileAtPoint(e,t,r,s,!1),a=this.getTileAtPoint(n,i,r,s,!1);this.flipY&&([o[1],a[1]]=[a[1],o[1]]);const{tileCountX:l,tileCountY:c}=this.getLevel(r),[u,h]=o,[d,p]=a;return d<0||p<0||u>=l||h>=c?[0,0,-1,-1]:[Kf(u,0,l-1),Kf(h,0,c-1),Kf(d,0,l-1),Kf(p,0,c-1)]}getTileExists(e,t,n){const[i,r,s,o]=this.rootBounds,[a,l,c,u]=this.getTileBounds(e,t,n);return!(a>=c||l>=u)&&a<=s&&l<=o&&c>=i&&u>=r}getFullBounds(e=!1){const{projection:t}=this,n=[...this.rootBounds];return t&&e&&(n[0]=t.convertLongitudeToProjection(n[0]),n[1]=t.convertLatitudeToProjection(n[1]),n[2]=t.convertLongitudeToProjection(n[2]),n[3]=t.convertLatitudeToProjection(n[3])),n}getTileBounds(e,t,n,i=!1){const{flipY:r,pixelOverlap:s,projection:o}=this,{tilePixelWidth:a,tilePixelHeight:l,pixelWidth:c,pixelHeight:u}=this.getLevel(n);let h=a*e-s,d=l*t-s,p=h+a+2*s,m=d+l+2*s;if(h=Math.max(h,0),d=Math.max(d,0),p=Math.min(p,c),m=Math.min(m,u),h/=c,p/=c,d/=u,m/=u,r){const e=(m-d)/2,t=1-(d+m)/2;d=t-e,m=t+e}const f=[h,d,p,m];return o&&!i&&(f[0]=o.convertProjectionToLongitude(f[0]),f[1]=o.convertProjectionToLatitude(f[1]),f[2]=o.convertProjectionToLongitude(f[2]),f[3]=o.convertProjectionToLatitude(f[3])),f}toNormalizedPoint(e,t){const{projection:n}=this,i=[e,t];return this.projection&&(i[0]=n.convertLongitudeToProjection(i[0]),i[1]=n.convertLatitudeToProjection(i[1])),i}toNormalizedRange(e){return[...this.toNormalizedPoint(e[0],e[1]),...this.toNormalizedPoint(e[2],e[3])]}clampToBounds(e,t=!1){const n=[...e],{projection:i}=this;if(t||!i)n[0]=Kf(n[0],0,1),n[1]=Kf(n[1],0,1),n[2]=Kf(n[2],0,1),n[3]=Kf(n[3],0,1);else{const[e,t,r,s]=i.getBounds();n[0]=Kf(n[0],e,r),n[1]=Kf(n[1],t,s),n[2]=Kf(n[2],e,r),n[3]=Kf(n[3],t,s)}return n}}class qf extends Wf{constructor(){super(),this.tiling=new Xf,this.fetchOptions={},this.fetchData=(...e)=>fetch(...e)}init(e){}async processBufferToTexture(e){const t=new Blob([e]),n=await createImageBitmap(t,{premultiplyAlpha:"none",colorSpaceConversion:"none",imageOrientation:"flipY"}),i=new jl(n);return i.generateMipmaps=!1,i.colorSpace=ll,i.needsUpdate=!0,i}getMemoryUsage(e){const{TextureUtils:t}=Ca;if(!t)return 0;const{format:n,type:i,image:r,generateMipmaps:s}=e,{width:o,height:a}=r,l=t.getByteLength(o,a,n,i);return s?4*l/3:l}fetchItem(...e){const t=this.getUrl(...e);return this.fetchData(t,this.fetchOptions).then(e=>e.arrayBuffer()).then(e=>this.processBufferToTexture(e))}disposeItem(e){e.dispose(),e.image instanceof ImageBitmap&&e.image.close()}getUrl(...e){}}class Yf extends qf{constructor(e={}){super();const{levels:t=20,tileDimension:n=256}=e;this.tileDimension=n,this.levels=t,this.url=null}getUrl(e,t,n){return this.url.replace("{z}",n).replace("{x}",e).replace("{y}",t)}init(e){const{tiling:t,tileDimension:n,levels:i}=this;return t.flipY=!0,t.setProjection(new Hf("EPSG:3857")),t.generateLevels(i,1,1,{tilePixelWidth:n,tilePixelHeight:n}),this.url=e,Promise.resolve()}}class $f extends Vf{constructor(e={}){const{levels:t=20,tileDimension:n=256,pixelSize:i=1e-5,...r}=e;super({pixelSize:i,...r}),this.name="XYZ_TILES_PLUGIN",this.imageSource=new Yf({levels:t,tileDimension:n})}}const Zf=new La;class Qf{constructor(){this.name="UPDATE_ON_CHANGE_PLUGIN",this.tiles=null,this.needsUpdate=!1,this.cameraMatrices=new Map}init(e){this.tiles=e,this._needsUpdateCallback=()=>{this.needsUpdate=!0},this._onCameraAdd=({camera:e})=>{this.needsUpdate=!0,this.cameraMatrices.set(e,new La)},this._onCameraDelete=({camera:e})=>{this.needsUpdate=!0,this.cameraMatrices.delete(e)},e.addEventListener("needs-update",this._needsUpdateCallback),e.addEventListener("add-camera",this._onCameraAdd),e.addEventListener("delete-camera",this._onCameraDelete),e.addEventListener("camera-resolution-change",this._needsUpdateCallback),e.cameras.forEach(e=>{this._onCameraAdd({camera:e})})}doTilesNeedUpdate(){const e=this.tiles;let t=!1;this.cameraMatrices.forEach((n,i)=>{Zf.copy(e.group.matrixWorld).premultiply(i.matrixWorldInverse).premultiply(i.projectionMatrixInverse),t=t||!Zf.equals(n),n.copy(Zf)});const n=this.needsUpdate;return this.needsUpdate=!1,n||t}preprocessNode(){this.needsUpdate=!0}dispose(){const e=this.tiles;e.removeEventListener("camera-resolution-change",this._needsUpdateCallback),e.removeEventListener("load-content",this._needsUpdateCallback),e.removeEventListener("camera-add",this._onCameraAdd),e.removeEventListener("camera-delete",this._onCameraDelete)}}const{clamp:Jf}=Ia;class eg{constructor(){this.duration=250,this.fadeCount=0,this._lastTick=-1,this._fadeState=new Map,this.onFadeComplete=null,this.onFadeStart=null,this.onFadeSetComplete=null,this.onFadeSetStart=null}deleteObject(e){e&&this.completeFade(e)}guaranteeState(e){const t=this._fadeState;if(t.has(e))return!1;return t.set(e,{fadeInTarget:0,fadeOutTarget:0,fadeIn:0,fadeOut:0}),!0}completeFade(e){const t=this._fadeState;if(!t.has(e))return;const n=0===t.get(e).fadeOutTarget;t.delete(e),this.fadeCount--,this.onFadeComplete&&this.onFadeComplete(e,n),0===this.fadeCount&&this.onFadeSetComplete&&this.onFadeSetComplete()}completeAllFades(){this._fadeState.forEach((e,t)=>{this.completeFade(t)})}forEachObject(e){this._fadeState.forEach((t,n)=>{e(n,t)})}fadeIn(e){const t=this.guaranteeState(e),n=this._fadeState.get(e);n.fadeInTarget=1,n.fadeOutTarget=0,n.fadeOut=0,t&&(this.fadeCount++,1===this.fadeCount&&this.onFadeSetStart&&this.onFadeSetStart(),this.onFadeStart&&this.onFadeStart(e))}fadeOut(e){const t=this.guaranteeState(e),n=this._fadeState.get(e);n.fadeOutTarget=1,t&&(n.fadeInTarget=1,n.fadeIn=1,this.fadeCount++,1===this.fadeCount&&this.onFadeSetStart&&this.onFadeSetStart(),this.onFadeStart&&this.onFadeStart(e))}isFading(e){return this._fadeState.has(e)}isFadingOut(e){const t=this._fadeState.get(e);return t&&1===t.fadeOutTarget}update(){const e=window.performance.now();-1===this._lastTick&&(this._lastTick=e);const t=Jf((e-this._lastTick)/this.duration,0,1);this._lastTick=e,this._fadeState.forEach((e,n)=>{const{fadeOutTarget:i,fadeInTarget:r}=e;let{fadeOut:s,fadeIn:o}=e;const a=Math.sign(r-o);o=Jf(o+a*t,0,1);const l=Math.sign(i-s);s=Jf(s+l*t,0,1),e.fadeIn=o,e.fadeOut=s,((1===s||0===s)&&(1===o||0===o)||s>=o)&&this.completeFade(n)})}}const tg=Symbol("FADE_PARAMS");function ng(e,t){if(e[tg])return e[tg];const n={fadeIn:{value:0},fadeOut:{value:0},fadeTexture:{value:null}};return e[tg]=n,e.defines={...e.defines||{},FEATURE_FADE:0},e.onBeforeCompile=e=>{t&&t(e),e.uniforms={...e.uniforms,...n},e.vertexShader=e.vertexShader.replace(/void\s+main\(\)\s+{/,e=>`\n\t\t\t\t\t#ifdef USE_BATCHING_FRAG\n\n\t\t\t\t\tvarying float vBatchId;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\t${e}\n\n\t\t\t\t\t\t#ifdef USE_BATCHING_FRAG\n\n\t\t\t\t\t\t// add 0.5 to the value to avoid floating error that may cause flickering\n\t\t\t\t\t\tvBatchId = getIndirectIndex( gl_DrawID ) + 0.5;\n\n\t\t\t\t\t\t#endif\n\t\t\t\t`),e.fragmentShader=e.fragmentShader.replace(/void main\(/,e=>`\n\t\t\t\t#if FEATURE_FADE\n\n\t\t\t\t// adapted from https://www.shadertoy.com/view/Mlt3z8\n\t\t\t\tfloat bayerDither2x2( vec2 v ) {\n\n\t\t\t\t\treturn mod( 3.0 * v.y + 2.0 * v.x, 4.0 );\n\n\t\t\t\t}\n\n\t\t\t\tfloat bayerDither4x4( vec2 v ) {\n\n\t\t\t\t\tvec2 P1 = mod( v, 2.0 );\n\t\t\t\t\tvec2 P2 = floor( 0.5 * mod( v, 4.0 ) );\n\t\t\t\t\treturn 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );\n\n\t\t\t\t}\n\n\t\t\t\t// the USE_BATCHING define is not available in fragment shaders\n\t\t\t\t#ifdef USE_BATCHING_FRAG\n\n\t\t\t\t// functions for reading the fade state of a given batch id\n\t\t\t\tuniform sampler2D fadeTexture;\n\t\t\t\tvarying float vBatchId;\n\t\t\t\tvec2 getFadeValues( const in float i ) {\n\n\t\t\t\t\tint size = textureSize( fadeTexture, 0 ).x;\n\t\t\t\t\tint j = int( i );\n\t\t\t\t\tint x = j % size;\n\t\t\t\t\tint y = j / size;\n\t\t\t\t\treturn texelFetch( fadeTexture, ivec2( x, y ), 0 ).rg;\n\n\t\t\t\t}\n\n\t\t\t\t#else\n\n\t\t\t\tuniform float fadeIn;\n\t\t\t\tuniform float fadeOut;\n\n\t\t\t\t#endif\n\n\t\t\t\t#endif\n\n\t\t\t\t${e}\n\t\t\t`).replace(/#include <dithering_fragment>/,e=>`\n\n\t\t\t\t${e}\n\n\t\t\t\t#if FEATURE_FADE\n\n\t\t\t\t#ifdef USE_BATCHING_FRAG\n\n\t\t\t\tvec2 fadeValues = getFadeValues( vBatchId );\n\t\t\t\tfloat fadeIn = fadeValues.r;\n\t\t\t\tfloat fadeOut = fadeValues.g;\n\n\t\t\t\t#endif\n\n\t\t\t\tfloat bayerValue = bayerDither4x4( floor( mod( gl_FragCoord.xy, 4.0 ) ) );\n\t\t\t\tfloat bayerBins = 16.0;\n\t\t\t\tfloat dither = ( 0.5 + bayerValue ) / bayerBins;\n\t\t\t\tif ( dither >= fadeIn ) {\n\n\t\t\t\t\tdiscard;\n\n\t\t\t\t}\n\n\t\t\t\tif ( dither < fadeOut ) {\n\n\t\t\t\t\tdiscard;\n\n\t\t\t\t}\n\n\t\t\t\t#endif\n\n\t\t\t`)},n}class ig{constructor(){this._fadeParams=new WeakMap,this.fading=0}setFade(e,t,n){if(!e)return;const i=this._fadeParams;e.traverse(e=>{const r=e.material;if(r){const e=i.get(r);e.fadeIn.value=t,e.fadeOut.value=n;const s=+(!(0===t||1===t)||!(0===n||1===n));r.defines.FEATURE_FADE!==s&&(this.fading+=1===s?1:-1,r.defines.FEATURE_FADE=s,r.needsUpdate=!0)}})}prepareScene(e){e.traverse(e=>{e.material&&this.prepareMaterial(e.material)})}deleteScene(e){if(!e)return;this.setFade(e,1,0);const t=this._fadeParams;e.traverse(e=>{const n=e.material;n&&t.delete(n)})}prepareMaterial(e){const t=this._fadeParams;t.has(e)||t.set(e,ng(e,e.onBeforeCompile))}}class rg{constructor(e,t=new Ya){this.other=e,this.material=t,this.visible=!0,this.parent=null,this._instanceInfo=[],this._visibilityChanged=!0;const n=new Proxy(this,{get(t,i){if(i in t)return t[i];{const r=e[i];return r instanceof Function?(...e)=>(t.syncInstances(),r.call(n,...e)):e[i]}},set:(t,n,i)=>(n in t?t[n]=i:e[n]=i,!0),deleteProperty:(t,n)=>n in t?delete t[n]:delete e[n]});return n}syncInstances(){const e=this._instanceInfo,t=this.other._instanceInfo;for(;t.length>e.length;){const n=e.length;e.push(new Proxy({visible:!1},{get:(e,i)=>i in e?e[i]:t[n][i],set:(e,i,r)=>(i in e?e[i]=r:t[n][i]=r,!0)}))}}}class sg extends rg{constructor(...e){super(...e);const t=this.material,n=ng(t,t.onBeforeCompile);t.defines.FEATURE_FADE=1,t.defines.USE_BATCHING_FRAG=1,t.needsUpdate=!0,this.fadeTexture=null,this._fadeParams=n}setFadeAt(e,t,n){this._initFadeTexture(),this.fadeTexture.setValueAt(e,255*t,255*n)}_initFadeTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=e*e*2,n=this.fadeTexture;if(!n||n.image.data.length!==t){const i=new Uint8Array(t),r=new og(i,e,e,sc,oc);if(n){n.dispose();const e=n.image.data,t=this.fadeTexture.image.data,i=Math.min(e.length,t.length);t.set(new e.constructor(e.buffer,0,i))}this.fadeTexture=r,this._fadeParams.fadeTexture.value=r,r.needsUpdate=!0}}dispose(){this.fadeTexture&&this.fadeTexture.dispose()}}class og extends ac{setValueAt(e,...t){const{data:n,width:i,height:r}=this.image,s=Math.floor(n.length/(i*r));let o=!1;for(let a=0;a<s;a++){const i=e*s+a,r=n[i],l=t[a]||0;r!==l&&(n[i]=l,o=!0)}o&&(this.needsUpdate=!0)}}const ag=Symbol("HAS_POPPED_IN"),lg=new ka,cg=new ka,ug=new Da,hg=new Da,dg=new ka;function pg(){const e=this._fadeManager,t=this.tiles;this._fadingBefore=e.fadeCount,this._displayActiveTiles=t.displayActiveTiles,t.displayActiveTiles=!0}function mg(){const e=this._fadeManager,t=this._fadeMaterialManager,n=this._displayActiveTiles,i=this._fadingBefore,r=this._prevCameraTransforms,{tiles:s,maximumFadeOutTiles:o,batchedMesh:a}=this,{cameras:l}=s;s.displayActiveTiles=n,e.update();const c=e.fadeCount;if(0!==i&&0!==c&&(s.dispatchEvent({type:"fade-change"}),s.dispatchEvent({type:"needs-render"})),n||s.visibleTiles.forEach(e=>{const t=e.cached.scene;t&&(t.visible=e.__inFrustum),this.forEachBatchIds(e,(t,n,i)=>{n.setVisibleAt(t,e.__inFrustum),i.batchedMesh.setVisibleAt(t,e.__inFrustum)})}),o<this._fadingOutCount){let t=!0;l.forEach(e=>{if(!r.has(e))return;const n=e.matrixWorld,i=r.get(e);n.decompose(cg,hg,dg),i.decompose(lg,ug,dg);const s=hg.angleTo(ug),o=cg.distanceTo(lg);t=t&&(s>.25||o>.1)}),t&&e.completeAllFades()}if(l.forEach(e=>{r.get(e).copy(e.matrixWorld)}),e.forEachObject((n,{fadeIn:i,fadeOut:r})=>{const o=n.cached.scene,a=e.isFadingOut(n);s.markTileUsed(n),o&&(t.setFade(o,i,r),a&&(o.visible=!0)),this.forEachBatchIds(n,(e,t,n)=>{t.setFadeAt(e,i,r),t.setVisibleAt(e,!0),n.batchedMesh.setVisibleAt(e,!1)})}),a){const e=s.getPluginByName("BATCHED_TILES_PLUGIN").batchedMesh.material;a.material.map=e.map}}class fg{get fadeDuration(){return this._fadeManager.duration}set fadeDuration(e){this._fadeManager.duration=Number(e)}get fadingTiles(){return this._fadeManager.fadeCount}constructor(e){e={maximumFadeOutTiles:50,fadeRootTiles:!1,fadeDuration:250,...e},this.name="FADE_TILES_PLUGIN",this.priority=-2,this.tiles=null,this.batchedMesh=null,this._fadeManager=new eg,this._fadeMaterialManager=new ig,this._prevCameraTransforms=null,this._fadingOutCount=0,this.maximumFadeOutTiles=e.maximumFadeOutTiles,this.fadeRootTiles=e.fadeRootTiles,this.fadeDuration=e.fadeDuration}init(e){this._onLoadModel=({scene:e})=>{this._fadeMaterialManager.prepareScene(e)},this._onDisposeModel=({tile:e,scene:t})=>{this._fadeManager.deleteObject(e),this._fadeMaterialManager.deleteScene(t)},this._onAddCamera=({camera:e})=>{this._prevCameraTransforms.set(e,new La)},this._onDeleteCamera=({camera:e})=>{this._prevCameraTransforms.delete(e)},this._onTileVisibilityChange=({tile:e,visible:t})=>{const n=e.cached.scene;n&&(n.visible=!0),this.forEachBatchIds(e,(e,t,n)=>{t.setFadeAt(e,0,0),t.setVisibleAt(e,!1),n.batchedMesh.setVisibleAt(e,!1)})},this._onUpdateBefore=()=>{pg.call(this)},this._onUpdateAfter=()=>{mg.call(this)},e.addEventListener("load-model",this._onLoadModel),e.addEventListener("dispose-model",this._onDisposeModel),e.addEventListener("add-camera",this._onAddCamera),e.addEventListener("delete-camera",this._onDeleteCamera),e.addEventListener("update-before",this._onUpdateBefore),e.addEventListener("update-after",this._onUpdateAfter),e.addEventListener("tile-visibility-change",this._onTileVisibilityChange);const t=this._fadeManager;t.onFadeSetStart=()=>{e.dispatchEvent({type:"fade-start"}),e.dispatchEvent({type:"needs-render"})},t.onFadeSetComplete=()=>{e.dispatchEvent({type:"fade-end"}),e.dispatchEvent({type:"needs-render"})},t.onFadeComplete=(t,n)=>{this._fadeMaterialManager.setFade(t.cached.scene,0,0),this.forEachBatchIds(t,(e,t,i)=>{t.setFadeAt(e,0,0),t.setVisibleAt(e,!1),i.batchedMesh.setVisibleAt(e,n)}),n||(e.invokeOnePlugin(e=>e!==this&&e.setTileVisible&&e.setTileVisible(t,!1)),this._fadingOutCount--)};const n=new Map;e.cameras.forEach(e=>{n.set(e,new La)}),e.forEachLoadedModel((e,t)=>{this._onLoadModel({scene:e})}),this.tiles=e,this._fadeManager=t,this._prevCameraTransforms=n}initBatchedMesh(){const e=this.tiles.getPluginByName("BATCHED_TILES_PLUGIN")?.batchedMesh;if(e){if(null===this.batchedMesh){this._onBatchedMeshDispose=()=>{this.batchedMesh.dispose(),this.batchedMesh.removeFromParent(),this.batchedMesh=null,e.removeEventListener("dispose",this._onBatchedMeshDispose)};const t=e.material.clone();t.onBeforeCompile=e.material.onBeforeCompile,this.batchedMesh=new sg(e,t),this.tiles.group.add(this.batchedMesh)}}else null!==this.batchedMesh&&(this._onBatchedMeshDispose(),this._onBatchedMeshDispose=null)}setTileVisible(e,t){const n=this._fadeManager,i=n.isFading(e);if(n.isFadingOut(e)&&this._fadingOutCount--,t?1===e.__depthFromRenderedParent?((e[ag]||this.fadeRootTiles)&&this._fadeManager.fadeIn(e),e[ag]=!0):this._fadeManager.fadeIn(e):(this._fadingOutCount++,n.fadeOut(e)),i)return!0;const r=this._fadeManager.isFading(e);return!(t||!r)}dispose(){const e=this.tiles;this._fadeManager.completeAllFades(),null!==this.batchedMesh&&this._onBatchedMeshDispose(),e.removeEventListener("load-model",this._onLoadModel),e.removeEventListener("dispose-model",this._onDisposeModel),e.removeEventListener("add-camera",this._onAddCamera),e.removeEventListener("delete-camera",this._onDeleteCamera),e.removeEventListener("update-before",this._onUpdateBefore),e.removeEventListener("update-after",this._onUpdateAfter),e.removeEventListener("tile-visibility-change",this._onTileVisibilityChange),e.forEachLoadedModel((e,t)=>{this._fadeManager.deleteObject(t),e&&(e.visible=!0)})}forEachBatchIds(e,t){if(this.initBatchedMesh(),this.batchedMesh){const n=this.tiles.getPluginByName("BATCHED_TILES_PLUGIN"),i=n.getTileBatchIds(e);i&&i.forEach(e=>{t(e,this.batchedMesh,n)})}}}const gg=new ka,_g=["x","y","z"];class vg extends Rl{constructor(e,t=16776960,n=40){const i=new za,r=[];for(let s=0;s<3;s++){const e=_g[s],t=_g[(s+1)%3];gg.set(0,0,0);for(let i=0;i<n;i++){let s;s=2*Math.PI*i/(n-1),gg[e]=Math.sin(s),gg[t]=Math.cos(s),r.push(gg.x,gg.y,gg.z),s=2*Math.PI*(i+1)/(n-1),gg[e]=Math.sin(s),gg[t]=Math.cos(s),r.push(gg.x,gg.y,gg.z)}}i.setAttribute("position",new Qa(new Float32Array(r),3)),i.computeBoundingSphere(),super(i,new Ga({color:t,toneMapped:!1})),this.sphere=e,this.type="SphereHelper"}updateMatrixWorld(e){const t=this.sphere;this.position.copy(t.center),this.scale.setScalar(t.radius),super.updateMatrixWorld(e)}}const yg=new ka,bg=new ka,wg=new ka;new ka,new ka;class Tg extends Rl{constructor(e=new lm,t=16776960){super(),this.ellipsoidRegion=e,this.material.color.set(t),this.update()}update(){const e=function(e,{computeNormals:t=!1}={}){const{latStart:n=-Math.PI/2,latEnd:i=Math.PI/2,lonStart:r=0,lonEnd:s=2*Math.PI,heightStart:o=0,heightEnd:a=0}=e,l=new cc(1,1,1,32,32),{normal:c,position:u}=l.attributes,h=u.clone();for(let d=0,p=u.count;d<p;d++){wg.fromBufferAttribute(u,d);const t=Ia.mapLinear(wg.x,-.5,.5,n,i),l=Ia.mapLinear(wg.y,-.5,.5,r,s);let c=o;e.getCartographicToNormal(t,l,yg),wg.z<0&&(c=a),e.getCartographicToPosition(t,l,c,wg),u.setXYZ(d,...wg)}t&&l.computeVertexNormals();for(let d=0,p=h.count;d<p;d++){wg.fromBufferAttribute(h,d);const t=Ia.mapLinear(wg.x,-.5,.5,n,i),o=Ia.mapLinear(wg.y,-.5,.5,r,s);yg.fromBufferAttribute(c,d),e.getCartographicToNormal(t,o,bg),Math.abs(yg.dot(bg))>.1&&(wg.z>0&&bg.multiplyScalar(-1),c.setXYZ(d,...bg))}return l}(this.ellipsoidRegion);this.geometry.dispose(),this.geometry=new lc(e,80)}dispose(){this.geometry.dispose(),this.material.dispose()}}const xg=Symbol("ORIGINAL_MATERIAL"),Eg=Symbol("HAS_RANDOM_COLOR"),Pg=Symbol("HAS_RANDOM_NODE_COLOR"),Ag=Symbol("LOAD_TIME"),Mg=Symbol("PARENT_BOUND_REF_COUNT"),Sg=new Xl,Cg=()=>{},Rg={};function Og(e){if(!Rg[e]){const t=Math.random(),n=.5+.5*Math.random(),i=.375+.25*Math.random();Rg[e]=(new Ha).setHSL(t,n,i)}return Rg[e]}const kg=Object.freeze({NONE:0,SCREEN_ERROR:1,GEOMETRIC_ERROR:2,DISTANCE:3,DEPTH:4,RELATIVE_DEPTH:5,IS_LEAF:6,RANDOM_COLOR:7,RANDOM_NODE_COLOR:8,CUSTOM_COLOR:9,LOAD_ORDER:10});class Lg{static get ColorModes(){return kg}get unlit(){return this._unlit}set unlit(e){e!==this._unlit&&(this._unlit=e,this.materialsNeedUpdate=!0)}get colorMode(){return this._colorMode}set colorMode(e){e!==this._colorMode&&(this._colorMode=e,this.materialsNeedUpdate=!0)}constructor(e){e={displayParentBounds:!1,displayBoxBounds:!1,displaySphereBounds:!1,displayRegionBounds:!1,colorMode:0,maxDebugDepth:-1,maxDebugDistance:-1,maxDebugError:-1,customColorCallback:null,unlit:!1,enabled:!0,...e},this.name="DEBUG_TILES_PLUGIN",this.tiles=null,this._colorMode=null,this._unlit=null,this.materialsNeedUpdate=!1,this.extremeDebugDepth=-1,this.extremeDebugError=-1,this.boxGroup=null,this.sphereGroup=null,this.regionGroup=null,this._enabled=e.enabled,this._displayParentBounds=e.displayParentBounds,this.displayBoxBounds=e.displayBoxBounds,this.displaySphereBounds=e.displaySphereBounds,this.displayRegionBounds=e.displayRegionBounds,this.colorMode=e.colorMode,this.maxDebugDepth=e.maxDebugDepth,this.maxDebugDistance=e.maxDebugDistance,this.maxDebugError=e.maxDebugError,this.customColorCallback=e.customColorCallback,this.unlit=e.unlit,this.getDebugColor=(e,t)=>{t.setRGB(e,e,e)}}get enabled(){return this._enabled}set enabled(e){e!==this._enabled&&null!==this.tiles&&(e?this.init(this.tiles):this.dispose()),this._enabled=e}get displayParentBounds(){return this._displayParentBounds}set displayParentBounds(e){this._displayParentBounds!==e&&(this._displayParentBounds=e,e?this.tiles.traverse(e=>{e.__visible&&this._onTileVisibilityChange(e,!0)}):Dh(this.tiles.root,null,e=>{e[Mg]=null,this._onTileVisibilityChange(e,e.__visible)}))}init(e){if(this.tiles=e,!this.enabled)return;const t=e.group;this.boxGroup=new Ua,this.boxGroup.name="DebugTilesRenderer.boxGroup",t.add(this.boxGroup),this.boxGroup.updateMatrixWorld(),this.sphereGroup=new Ua,this.sphereGroup.name="DebugTilesRenderer.sphereGroup",t.add(this.sphereGroup),this.sphereGroup.updateMatrixWorld(),this.regionGroup=new Ua,this.regionGroup.name="DebugTilesRenderer.regionGroup",t.add(this.regionGroup),this.regionGroup.updateMatrixWorld(),this._onLoadTileSetCB=()=>{this._initExtremes()},this._onLoadModelCB=({scene:e,tile:t})=>{this._onLoadModel(e,t)},this._onDisposeModelCB=({tile:e})=>{this._onDisposeModel(e)},this._onUpdateAfterCB=()=>{this._onUpdateAfter()},this._onTileVisibilityChangeCB=({scene:e,tile:t,visible:n})=>{this._onTileVisibilityChange(t,n)},e.addEventListener("load-tile-set",this._onLoadTileSetCB),e.addEventListener("load-model",this._onLoadModelCB),e.addEventListener("dispose-model",this._onDisposeModelCB),e.addEventListener("update-after",this._onUpdateAfterCB),e.addEventListener("tile-visibility-change",this._onTileVisibilityChangeCB),this._initExtremes(),e.traverse(e=>{e.cached.scene&&this._onLoadModel(e.cached.scene,e)}),e.visibleTiles.forEach(e=>{this._onTileVisibilityChange(e,!0)})}getTileInformationFromActiveObject(e){let t=null;return this.tiles.activeTiles.forEach(n=>{if(t)return!0;const i=n.cached.scene;i&&i.traverse(i=>{i===e&&(t=n)})}),t?{distanceToCamera:t.__distanceFromCamera,geometricError:t.geometricError,screenSpaceError:t.__error,depth:t.__depth,isLeaf:t.__isLeaf}:null}_initExtremes(){if(!this.tiles||!this.tiles.root)return;let e=-1,t=-1;Dh(this.tiles.root,null,(n,i,r)=>{e=Math.max(e,r),t=Math.max(t,n.geometricError)}),this.extremeDebugDepth=e,this.extremeDebugError=t}_onUpdateAfter(){const{tiles:e,colorMode:t}=this;if(!e.root)return;this.materialsNeedUpdate&&(e.forEachLoadedModel(e=>{this._updateMaterial(e)}),this.materialsNeedUpdate=!1),this.boxGroup.visible=this.displayBoxBounds,this.sphereGroup.visible=this.displaySphereBounds,this.regionGroup.visible=this.displayRegionBounds;let n=-1;n=-1===this.maxDebugDepth?this.extremeDebugDepth:this.maxDebugDepth;let i=-1;i=-1===this.maxDebugError?this.extremeDebugError:this.maxDebugError;let r=-1;-1===this.maxDebugDistance?(e.getBoundingSphere(Sg),r=Sg.radius):r=this.maxDebugDistance;const{errorTarget:s,visibleTiles:o}=e;let a;10===t&&(a=Array.from(o).sort((e,t)=>e[Ag]-t[Ag])),o.forEach(e=>{const o=e.cached.scene;let l,c,u;7===t&&(l=Math.random(),c=.5+.5*Math.random(),u=.375+.25*Math.random()),o.traverse(o=>{if(8===t&&(l=Math.random(),c=.5+.5*Math.random(),u=.375+.25*Math.random()),o.material)switch(7!==t&&delete o.material[Eg],8!==t&&delete o.material[Pg],t){case 4:{const t=e.__depth/n;this.getDebugColor(t,o.material.color);break}case 5:{const t=e.__depthFromRenderedParent/n;this.getDebugColor(t,o.material.color);break}case 1:{const t=e.__error/s;t>1?o.material.color.setRGB(1,0,0):this.getDebugColor(t,o.material.color);break}case 2:{const t=Math.min(e.geometricError/i,1);this.getDebugColor(t,o.material.color);break}case 3:{const t=Math.min(e.__distanceFromCamera/r,1);this.getDebugColor(t,o.material.color);break}case 6:e.children&&0!==e.children.length?this.getDebugColor(0,o.material.color):this.getDebugColor(1,o.material.color);break;case 8:o.material[Pg]||(o.material.color.setHSL(l,c,u),o.material[Pg]=!0);break;case 7:o.material[Eg]||(o.material.color.setHSL(l,c,u),o.material[Eg]=!0);break;case 9:this.customColorCallback?this.customColorCallback(e,o):console.warn("DebugTilesRenderer: customColorCallback not defined");break;case 10:{const t=a.indexOf(e);this.getDebugColor(t/(a.length-1),o.material.color);break}}})})}_onTileVisibilityChange(e,t){this.displayParentBounds?function(e,t=null){let n=e;for(;n;){const e=n.__depth,i=n.parent;t&&t(n,i,e),n=i}}(e,n=>{null==n[Mg]&&(n[Mg]=0),t?n[Mg]++:n[Mg]>0&&n[Mg]--;const i=n===e&&t||this.displayParentBounds&&n[Mg]>0;this._updateBoundHelper(n,i)}):this._updateBoundHelper(e,t)}_createBoundHelper(e){const t=this.tiles,n=e.cached,{sphere:i,obb:r,region:s}=n.boundingVolume;if(r){const i=new Ua;i.name="DebugTilesRenderer.boxHelperGroup",i.matrix.copy(r.transform),i.matrixAutoUpdate=!1;const s=new uc(r.box,Og(e.__depth));s.raycast=Cg,i.add(s),n.boxHelperGroup=i,t.visibleTiles.has(e)&&this.displayBoxBounds&&(this.boxGroup.add(i),i.updateMatrixWorld(!0))}if(i){const r=new vg(i,Og(e.__depth));r.raycast=Cg,n.sphereHelper=r,t.visibleTiles.has(e)&&this.displaySphereBounds&&(this.sphereGroup.add(r),r.updateMatrixWorld(!0))}if(s){const i=new Tg(s,Og(e.__depth));i.raycast=Cg;const r=new Xl;s.getBoundingSphere(r),i.position.copy(r.center),r.center.multiplyScalar(-1),i.geometry.translate(...r.center),n.regionHelper=i,t.visibleTiles.has(e)&&this.displayRegionBounds&&(this.regionGroup.add(i),i.updateMatrixWorld(!0))}}_updateHelperMaterial(e,t){e.__visible||!this.displayParentBounds?t.opacity=1:t.opacity=.2;const n=t.transparent;t.transparent=t.opacity<1,t.transparent!==n&&(t.needsUpdate=!0)}_updateBoundHelper(e,t){const n=e.cached;if(!n)return;const i=this.sphereGroup,r=this.boxGroup,s=this.regionGroup;t&&null==n.boxHelperGroup&&null==n.sphereHelper&&null==n.regionHelper&&this._createBoundHelper(e);const o=n.boxHelperGroup,a=n.sphereHelper,l=n.regionHelper;t?(o&&(r.add(o),o.updateMatrixWorld(!0),this._updateHelperMaterial(e,o.children[0].material)),a&&(i.add(a),a.updateMatrixWorld(!0),this._updateHelperMaterial(e,a.material)),l&&(s.add(l),l.updateMatrixWorld(!0),this._updateHelperMaterial(e,l.material))):(o&&r.remove(o),a&&i.remove(a),l&&s.remove(l))}_updateMaterial(e){const{colorMode:t,unlit:n}=this;e.traverse(e=>{if(!e.material)return;const i=e.material,r=e[xg];if(i!==r&&i.dispose(),0!==t||n){if(e.isPoints){const t=new Na;t.size=r.size,t.sizeAttenuation=r.sizeAttenuation,e.material=t}else n?e.material=new Ya:(e.material=new Ml,e.material.flatShading=!0);0===t&&(e.material.map=r.map,e.material.color.set(r.color))}else e.material=r})}_onLoadModel(e,t){t[Ag]=performance.now(),e.traverse(e=>{const t=e.material;t&&(e[xg]=t)}),this._updateMaterial(e)}_onDisposeModel(e){const t=e.cached;t.boxHelperGroup&&(t.boxHelperGroup.children[0].geometry.dispose(),delete t.boxHelperGroup),t.sphereHelper&&(t.sphereHelper.geometry.dispose(),delete t.sphereHelper),t.regionHelper&&(t.regionHelper.geometry.dispose(),delete t.regionHelper)}dispose(){if(!this.enabled)return;const e=this.tiles;e.removeEventListener("load-tile-set",this._onLoadTileSetCB),e.removeEventListener("load-model",this._onLoadModelCB),e.removeEventListener("dispose-model",this._onDisposeModelCB),e.removeEventListener("update-after",this._onUpdateAfterCB),e.removeEventListener("tile-visibility-change",this._onTileVisibilityChangeCB),this.colorMode=0,this.unlit=!1,e.forEachLoadedModel(e=>{this._updateMaterial(e)}),e.traverse(e=>{this._onDisposeModel(e)}),this.boxGroup?.removeFromParent(),this.sphereGroup?.removeFromParent(),this.regionGroup?.removeFromParent()}}const Ig=["object"],Dg=Jo({__name:"XYZTiles",props:{url:{},lruCacheMinSize:{default:900},lruCacheMaxSize:{default:1300},parseQueueMaxJobs:{default:10},errorTarget:{default:10},displayActiveTiles:{type:Boolean,default:!0},autoDisableRendererCulling:{type:Boolean,default:!0},tilesPlugins:{default:()=>({fadePlugin:{maximumFadeOutTiles:200},xyzPlugin:{center:!0,shape:"ellipsoid"}})}},setup(e){const{camera:t,renderer:n}=_i(),i=e;let r=ba(new Mm(i.url));function s(){r&&r.dispose(),r=ba(new Mm(i.url)),r.registerPlugin(new fg(i.tilesPlugins.fadePlugin)),r.registerPlugin(new Qf),r.registerPlugin(new $f(i.tilesPlugins.xyzPlugin)),r.lruCache.minSize=i.lruCacheMinSize,r.lruCache.maxSize=i.lruCacheMaxSize,r.parseQueue.maxJobs=i.parseQueueMaxJobs,r.setCamera(t.value),r.setResolutionFromRenderer(t.value,n),r.errorTarget=i.errorTarget,r.displayActiveTiles=i.displayActiveTiles,r.autoDisableRendererCulling=i.autoDisableRendererCulling}s(),ta(()=>i.url,(e,t)=>{e!==t&&s()}),ta(()=>i,()=>{s()},{deep:!0});const{onBeforeRender:o}=vi();return o(()=>{r&&(r.setResolutionFromRenderer(t.value,n),r.update())}),ia(()=>{r&&r.dispose()}),(e,t)=>oa(r)?(sa(),ra("primitive",{key:0,object:oa(r).group},null,8,Ig)):ma("",!0)}}),Fg=Jo({__name:"TDTTiles",props:{url:{default:"https://t0.tianditu.gov.cn"},service:{default:"WMTS"},request:{default:"GetTile"},version:{default:"1.0.0"},layer:{default:"vec"},tileStyle:{default:"default"},tileMatrixSet:{default:"w"},format:{default:"tiles"},tk:{default:"您的密钥"}},setup(e){const t=e,n=va(()=>`${t.url}/${t.layer}_${t.tileMatrixSet}/${t.service.toLowerCase()}?SERVICE=${t.service.toUpperCase()}&REQUEST=${t.request}&VERSION=${t.version}&LAYER=${t.layer}&STYLE=${t.tileStyle}&TILEMATRIXSET=${t.tileMatrixSet}&FORMAT=${t.format}&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=${t.tk}`);return(e,t)=>(sa(),ca(Dg,{url:n.value},null,8,["url"]))}});function Ug(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ng(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t
/*!
 * GSAP 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/}var jg,zg,Bg,Vg,Hg,Gg,Wg,Kg,Xg,qg,Yg,$g={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Zg={duration:.5,overwrite:!1,delay:0},Qg=1e8,Jg=1e-8,e_=2*Math.PI,t_=e_/4,n_=0,i_=Math.sqrt,r_=Math.cos,s_=Math.sin,o_=function(e){return"string"==typeof e},a_=function(e){return"function"==typeof e},l_=function(e){return"number"==typeof e},c_=function(e){return typeof e>"u"},u_=function(e){return"object"==typeof e},h_=function(e){return!1!==e},d_=function(){return typeof window<"u"},p_=function(e){return a_(e)||o_(e)},m_="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},f_=Array.isArray,g_=/(?:-?\.?\d|\.)+/gi,__=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,v_=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,y_=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,b_=/[+-]=-?[.\d]+/,w_=/[^,'"\[\]\s]+/gi,T_=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,x_={},E_={},P_=function(e){return(E_=tv(e,x_))&&tb},A_=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},M_=function(e,t){return!t&&console.warn(e)},S_=function(e,t){return e&&(x_[e]=t)&&E_&&(E_[e]=t)||x_},C_=function(){return 0},R_={suppressEvents:!0,isStart:!0,kill:!1},O_={suppressEvents:!0,kill:!1},k_={suppressEvents:!0},L_={},I_=[],D_={},F_={},U_={},N_=30,j_=[],z_="",B_=function(e){var t,n,i=e[0];if(u_(i)||a_(i)||(e=[e]),!(t=(i._gsap||{}).harness)){for(n=j_.length;n--&&!j_[n].targetTest(i););t=j_[n]}for(n=e.length;n--;)e[n]&&(e[n]._gsap||(e[n]._gsap=new fy(e[n],t)))||e.splice(n,1);return e},V_=function(e){return e._gsap||B_(kv(e))[0]._gsap},H_=function(e,t,n){return(n=e[t])&&a_(n)?e[t]():c_(n)&&e.getAttribute&&e.getAttribute(t)||n},G_=function(e,t){return(e=e.split(",")).forEach(t)||e},W_=function(e){return Math.round(1e5*e)/1e5||0},K_=function(e){return Math.round(1e7*e)/1e7||0},X_=function(e,t){var n=t.charAt(0),i=parseFloat(t.substr(2));return e=parseFloat(e),"+"===n?e+i:"-"===n?e-i:"*"===n?e*i:e/i},q_=function(e,t){for(var n=t.length,i=0;e.indexOf(t[i])<0&&++i<n;);return i<n},Y_=function(){var e,t,n=I_.length,i=I_.slice(0);for(D_={},I_.length=0,e=0;e<n;e++)(t=i[e])&&t._lazy&&(t.render(t._lazy[0],t._lazy[1],!0)._lazy=0)},$_=function(e){return!!(e._initted||e._startAt||e.add)},Z_=function(e,t,n,i){I_.length&&!zg&&Y_(),e.render(t,n,!!(zg&&t<0&&$_(e))),I_.length&&!zg&&Y_()},Q_=function(e){var t=parseFloat(e);return(t||0===t)&&(e+"").match(w_).length<2?t:o_(e)?e.trim():e},J_=function(e){return e},ev=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},tv=function(e,t){for(var n in t)e[n]=t[n];return e},nv=function e(t,n){for(var i in n)"__proto__"!==i&&"constructor"!==i&&"prototype"!==i&&(t[i]=u_(n[i])?e(t[i]||(t[i]={}),n[i]):n[i]);return t},iv=function(e,t){var n,i={};for(n in e)n in t||(i[n]=e[n]);return i},rv=function(e){var t=e.parent||Vg,n=e.keyframes?function(e){return function(t,n){for(var i in n)i in t||"duration"===i&&e||"ease"===i||(t[i]=n[i])}}(f_(e.keyframes)):ev;if(h_(e.inherit))for(;t;)n(e,t.vars.defaults),t=t.parent||t._dp;return e},sv=function(e,t,n,i,r){var s,o=e[i];if(r)for(s=t[r];o&&o[r]>s;)o=o._prev;return o?(t._next=o._next,o._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[i]=t,t._prev=o,t.parent=t._dp=e,t},ov=function(e,t,n,i){void 0===n&&(n="_first"),void 0===i&&(i="_last");var r=t._prev,s=t._next;r?r._next=s:e[n]===t&&(e[n]=s),s?s._prev=r:e[i]===t&&(e[i]=r),t._next=t._prev=t.parent=null},av=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},lv=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},cv=function(e,t,n,i){return e._startAt&&(zg?e._startAt.revert(O_):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,i))},uv=function e(t){return!t||t._ts&&e(t.parent)},hv=function(e){return e._repeat?dv(e._tTime,e=e.duration()+e._rDelay)*e:0},dv=function(e,t){var n=Math.floor(e=K_(e/t));return e&&n===e?n-1:n},pv=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},mv=function(e){return e._end=K_(e._start+(e._tDur/Math.abs(e._ts||e._rts||Jg)||0))},fv=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=K_(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),mv(e),n._dirty||lv(n,e)),e},gv=function(e,t){var n;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(n=pv(e.rawTime(),t),(!t._dur||Sv(0,t.totalDuration(),n)-t._tTime>Jg)&&t.render(n,!0)),lv(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-Jg}},_v=function(e,t,n,i){return t.parent&&av(t),t._start=K_((l_(n)?n:n||e!==Vg?Pv(e,n,t):e._time)+t._delay),t._end=K_(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),sv(e,t,"_first","_last",e._sort?"_start":0),wv(t)||(e._recent=t),i||gv(e,t),e._ts<0&&fv(e,e._tTime),e},vv=function(e,t){return(x_.ScrollTrigger||A_("scrollTrigger",t))&&x_.ScrollTrigger.create(t,e)},yv=function(e,t,n,i,r){return xy(e,t,r),e._initted?!n&&e._pt&&!zg&&(e._dur&&!1!==e.vars.lazy||!e._dur&&e.vars.lazy)&&Xg!==ny.frame?(I_.push(e),e._lazy=[r,i],1):void 0:1},bv=function e(t){var n=t.parent;return n&&n._ts&&n._initted&&!n._lock&&(n.rawTime()<0||e(n))},wv=function(e){var t=e.data;return"isFromStart"===t||"isStart"===t},Tv=function(e,t,n,i){var r=e._repeat,s=K_(t)||0,o=e._tTime/e._tDur;return o&&!i&&(e._time*=s/e._dur),e._dur=s,e._tDur=r?r<0?1e10:K_(s*(r+1)+e._rDelay*r):s,o>0&&!i&&fv(e,e._tTime=e._tDur*o),e.parent&&mv(e),n||lv(e.parent,e),e},xv=function(e){return e instanceof _y?lv(e):Tv(e,e._dur)},Ev={_start:0,endTime:C_,totalDuration:C_},Pv=function e(t,n,i){var r,s,o,a=t.labels,l=t._recent||Ev,c=t.duration()>=Qg?l.endTime(!1):t._dur;return o_(n)&&(isNaN(n)||n in a)?(s=n.charAt(0),o="%"===n.substr(-1),r=n.indexOf("="),"<"===s||">"===s?(r>=0&&(n=n.replace(/=/,"")),("<"===s?l._start:l.endTime(l._repeat>=0))+(parseFloat(n.substr(1))||0)*(o?(r<0?l:i).totalDuration()/100:1)):r<0?(n in a||(a[n]=c),a[n]):(s=parseFloat(n.charAt(r-1)+n.substr(r+1)),o&&i&&(s=s/100*(f_(i)?i[0]:i).totalDuration()),r>1?e(t,n.substr(0,r-1),i)+s:c+s)):null==n?c:+n},Av=function(e,t,n){var i,r,s=l_(t[1]),o=(s?2:1)+(e<2?0:1),a=t[o];if(s&&(a.duration=t[1]),a.parent=n,e){for(i=a,r=n;r&&!("immediateRender"in i);)i=r.vars.defaults||{},r=h_(r.vars.inherit)&&r.parent;a.immediateRender=h_(i.immediateRender),e<2?a.runBackwards=1:a.startAt=t[o-1]}return new Sy(t[0],a,t[o+1])},Mv=function(e,t){return e||0===e?t(e):t},Sv=function(e,t,n){return n<e?e:n>t?t:n},Cv=function(e,t){return o_(e)&&(t=T_.exec(e))?t[1]:""},Rv=[].slice,Ov=function(e,t){return e&&u_(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&u_(e[0]))&&!e.nodeType&&e!==Hg},kv=function(e,t,n){return Bg&&!t&&Bg.selector?Bg.selector(e):!o_(e)||n||!Gg&&iy()?f_(e)?function(e,t,n){return void 0===n&&(n=[]),e.forEach(function(e){var i;return o_(e)&&!t||Ov(e,1)?(i=n).push.apply(i,kv(e)):n.push(e)})||n}(e,n):Ov(e)?Rv.call(e,0):e?[e]:[]:Rv.call((t||Wg).querySelectorAll(e),0)},Lv=function(e){return e=kv(e)[0]||M_("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return kv(t,n.querySelectorAll?n:n===e?M_("Invalid scope")||Wg.createElement("div"):e)}},Iv=function(e){return e.sort(function(){return.5-Math.random()})},Dv=function(e){if(a_(e))return e;var t=u_(e)?e:{each:e},n=uy(t.ease),i=t.from||0,r=parseFloat(t.base)||0,s={},o=i>0&&i<1,a=isNaN(i)||o,l=t.axis,c=i,u=i;return o_(i)?c=u={center:.5,edges:.5,end:1}[i]||0:!o&&a&&(c=i[0],u=i[1]),function(e,o,h){var d,p,m,f,g,_,v,y,b,w=(h||t).length,T=s[w];if(!T){if(!(b="auto"===t.grid?0:(t.grid||[1,Qg])[1])){for(v=-Qg;v<(v=h[b++].getBoundingClientRect().left)&&b<w;);b<w&&b--}for(T=s[w]=[],d=a?Math.min(b,w)*c-.5:i%b,p=b===Qg?0:a?w*u/b-.5:i/b|0,v=0,y=Qg,_=0;_<w;_++)m=_%b-d,f=p-(_/b|0),T[_]=g=l?Math.abs("y"===l?f:m):i_(m*m+f*f),g>v&&(v=g),g<y&&(y=g);"random"===i&&Iv(T),T.max=v-y,T.min=y,T.v=w=(parseFloat(t.amount)||parseFloat(t.each)*(b>w?w-1:l?"y"===l?w/b:b:Math.max(b,w/b))||0)*("edges"===i?-1:1),T.b=w<0?r-w:r,T.u=Cv(t.amount||t.each)||0,n=n&&w<0?ly(n):n}return w=(T[e]-T.min)/T.max||0,K_(T.b+(n?n(w):w)*T.v)+T.u}},Fv=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(n){var i=K_(Math.round(parseFloat(n)/e)*e*t);return(i-i%1)/t+(l_(n)?0:Cv(n))}},Uv=function(e,t){var n,i,r=f_(e);return!r&&u_(e)&&(n=r=e.radius||Qg,e.values?(e=kv(e.values),(i=!l_(e[0]))&&(n*=n)):e=Fv(e.increment)),Mv(t,r?a_(e)?function(t){return i=e(t),Math.abs(i-t)<=n?i:t}:function(t){for(var r,s,o=parseFloat(i?t.x:t),a=parseFloat(i?t.y:0),l=Qg,c=0,u=e.length;u--;)i?r=(r=e[u].x-o)*r+(s=e[u].y-a)*s:r=Math.abs(e[u]-o),r<l&&(l=r,c=u);return c=!n||l<=n?e[c]:t,i||c===t||l_(t)?c:c+Cv(t)}:Fv(e))},Nv=function(e,t,n,i){return Mv(f_(e)?!t:!0===n?!!(n=0):!i,function(){return f_(e)?e[~~(Math.random()*e.length)]:(n=n||1e-5)&&(i=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+.99*n))/n)*n*i)/i})},jv=function(e,t,n){return Mv(n,function(n){return e[~~t(n)]})},zv=function(e){for(var t,n,i,r,s=0,o="";~(t=e.indexOf("random(",s));)i=e.indexOf(")",t),r="["===e.charAt(t+7),n=e.substr(t+7,i-t-7).match(r?w_:g_),o+=e.substr(s,t-s)+Nv(r?n:+n[0],r?0:+n[1],+n[2]||1e-5),s=i+1;return o+e.substr(s,e.length-s)},Bv=function(e,t,n,i,r){var s=t-e,o=i-n;return Mv(r,function(t){return n+((t-e)/s*o||0)})},Vv=function(e,t,n){var i,r,s,o=e.labels,a=Qg;for(i in o)(r=o[i]-t)<0==!!n&&r&&a>(r=Math.abs(r))&&(s=i,a=r);return s},Hv=function(e,t,n){var i,r,s,o=e.vars,a=o[t],l=Bg,c=e._ctx;if(a)return i=o[t+"Params"],r=o.callbackScope||e,n&&I_.length&&Y_(),c&&(Bg=c),s=i?a.apply(r,i):a.call(r),Bg=l,s},Gv=function(e){return av(e),e.scrollTrigger&&e.scrollTrigger.kill(!!zg),e.progress()<1&&Hv(e,"onInterrupt"),e},Wv=[],Kv=function(e){if(e)if(e=!e.name&&e.default||e,d_()||e.headless){var t=e.name,n=a_(e),i=t&&!n&&e.init?function(){this._props=[]}:e,r={init:C_,render:Uy,add:wy,kill:jy,modifier:Ny,rawVars:0},s={targetTest:0,get:0,getSetter:Ly,aliases:{},register:0};if(iy(),e!==i){if(F_[t])return;ev(i,ev(iv(e,r),s)),tv(i.prototype,tv(r,iv(e,s))),F_[i.prop=t]=i,e.targetTest&&(j_.push(i),L_[t]=1),t=("css"===t?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}S_(t,i),e.register&&e.register(tb,i,Vy)}else Wv.push(e)},Xv=255,qv={aqua:[0,Xv,Xv],lime:[0,Xv,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Xv],navy:[0,0,128],white:[Xv,Xv,Xv],olive:[128,128,0],yellow:[Xv,Xv,0],orange:[Xv,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Xv,0,0],pink:[Xv,192,203],cyan:[0,Xv,Xv],transparent:[Xv,Xv,Xv,0]},Yv=function(e,t,n){return(6*(e+=e<0?1:e>1?-1:0)<1?t+(n-t)*e*6:e<.5?n:3*e<2?t+(n-t)*(2/3-e)*6:t)*Xv+.5|0},$v=function(e,t,n){var i,r,s,o,a,l,c,u,h,d,p=e?l_(e)?[e>>16,e>>8&Xv,e&Xv]:0:qv.black;if(!p){if(","===e.substr(-1)&&(e=e.substr(0,e.length-1)),qv[e])p=qv[e];else if("#"===e.charAt(0)){if(e.length<6&&(i=e.charAt(1),r=e.charAt(2),s=e.charAt(3),e="#"+i+i+r+r+s+s+(5===e.length?e.charAt(4)+e.charAt(4):"")),9===e.length)return[(p=parseInt(e.substr(1,6),16))>>16,p>>8&Xv,p&Xv,parseInt(e.substr(7),16)/255];p=[(e=parseInt(e.substr(1),16))>>16,e>>8&Xv,e&Xv]}else if("hsl"===e.substr(0,3))if(p=d=e.match(g_),t){if(~e.indexOf("="))return p=e.match(__),n&&p.length<4&&(p[3]=1),p}else o=+p[0]%360/360,a=+p[1]/100,i=2*(l=+p[2]/100)-(r=l<=.5?l*(a+1):l+a-l*a),p.length>3&&(p[3]*=1),p[0]=Yv(o+1/3,i,r),p[1]=Yv(o,i,r),p[2]=Yv(o-1/3,i,r);else p=e.match(g_)||qv.transparent;p=p.map(Number)}return t&&!d&&(i=p[0]/Xv,r=p[1]/Xv,s=p[2]/Xv,l=((c=Math.max(i,r,s))+(u=Math.min(i,r,s)))/2,c===u?o=a=0:(h=c-u,a=l>.5?h/(2-c-u):h/(c+u),o=c===i?(r-s)/h+(r<s?6:0):c===r?(s-i)/h+2:(i-r)/h+4,o*=60),p[0]=~~(o+.5),p[1]=~~(100*a+.5),p[2]=~~(100*l+.5)),n&&p.length<4&&(p[3]=1),p},Zv=function(e){var t=[],n=[],i=-1;return e.split(Jv).forEach(function(e){var r=e.match(v_)||[];t.push.apply(t,r),n.push(i+=r.length+1)}),t.c=n,t},Qv=function(e,t,n){var i,r,s,o,a="",l=(e+a).match(Jv),c=t?"hsla(":"rgba(",u=0;if(!l)return e;if(l=l.map(function(e){return(e=$v(e,t,1))&&c+(t?e[0]+","+e[1]+"%,"+e[2]+"%,"+e[3]:e.join(","))+")"}),n&&(s=Zv(e),(i=n.c).join(a)!==s.c.join(a)))for(o=(r=e.replace(Jv,"1").split(v_)).length-1;u<o;u++)a+=r[u]+(~i.indexOf(u)?l.shift()||c+"0,0,0,0)":(s.length?s:l.length?l:n).shift());if(!r)for(o=(r=e.split(Jv)).length-1;u<o;u++)a+=r[u]+l[u];return a+r[o]},Jv=function(){var e,t="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(e in qv)t+="|"+e+"\\b";return new RegExp(t+")","gi")}(),ey=/hsl[a]?\(/,ty=function(e){var t,n=e.join(" ");if(Jv.lastIndex=0,Jv.test(n))return t=ey.test(n),e[1]=Qv(e[1],t),e[0]=Qv(e[0],t,Zv(e[1])),!0},ny=function(){var e,t,n,i,r,s,o=Date.now,a=500,l=33,c=o(),u=c,h=1e3/240,d=h,p=[],m=function n(m){var f,g,_,v,y=o()-u,b=!0===m;if((y>a||y<0)&&(c+=y-l),((f=(_=(u+=y)-c)-d)>0||b)&&(v=++i.frame,r=_-1e3*i.time,i.time=_/=1e3,d+=f+(f>=h?4:h-f),g=1),b||(e=t(n)),g)for(s=0;s<p.length;s++)p[s](_,r,v,m)};return i={time:0,frame:0,tick:function(){m(!0)},deltaRatio:function(e){return r/(1e3/(e||60))},wake:function(){Kg&&(!Gg&&d_()&&(Hg=Gg=window,Wg=Hg.document||{},x_.gsap=tb,(Hg.gsapVersions||(Hg.gsapVersions=[])).push(tb.version),P_(E_||Hg.GreenSockGlobals||!Hg.gsap&&Hg||{}),Wv.forEach(Kv)),n=typeof requestAnimationFrame<"u"&&requestAnimationFrame,e&&i.sleep(),t=n||function(e){return setTimeout(e,d-1e3*i.time+1|0)},Yg=1,m(2))},sleep:function(){(n?cancelAnimationFrame:clearTimeout)(e),Yg=0,t=C_},lagSmoothing:function(e,t){a=e||1/0,l=Math.min(t||33,a)},fps:function(e){h=1e3/(e||240),d=1e3*i.time+h},add:function(e,t,n){var r=t?function(t,n,s,o){e(t,n,s,o),i.remove(r)}:e;return i.remove(e),p[n?"unshift":"push"](r),iy(),r},remove:function(e,t){~(t=p.indexOf(e))&&p.splice(t,1)&&s>=t&&s--},_listeners:p},i}(),iy=function(){return!Yg&&ny.wake()},ry={},sy=/^[\d.\-M][\d.\-,\s]/,oy=/["']/g,ay=function(e){for(var t,n,i,r={},s=e.substr(1,e.length-3).split(":"),o=s[0],a=1,l=s.length;a<l;a++)n=s[a],t=a!==l-1?n.lastIndexOf(","):n.length,i=n.substr(0,t),r[o]=isNaN(i)?i.replace(oy,"").trim():+i,o=n.substr(t+1).trim();return r},ly=function(e){return function(t){return 1-e(1-t)}},cy=function e(t,n){for(var i,r=t._first;r;)r instanceof _y?e(r,n):r.vars.yoyoEase&&(!r._yoyo||!r._repeat)&&r._yoyo!==n&&(r.timeline?e(r.timeline,n):(i=r._ease,r._ease=r._yEase,r._yEase=i,r._yoyo=n)),r=r._next},uy=function(e,t){return e&&(a_(e)?e:ry[e]||function(e){var t=(e+"").split("("),n=ry[t[0]];return n&&t.length>1&&n.config?n.config.apply(null,~e.indexOf("{")?[ay(t[1])]:function(e){var t=e.indexOf("(")+1,n=e.indexOf(")"),i=e.indexOf("(",t);return e.substring(t,~i&&i<n?e.indexOf(")",n+1):n)}(e).split(",").map(Q_)):ry._CE&&sy.test(e)?ry._CE("",e):n}(e))||t},hy=function(e,t,n,i){void 0===n&&(n=function(e){return 1-t(1-e)}),void 0===i&&(i=function(e){return e<.5?t(2*e)/2:1-t(2*(1-e))/2});var r,s={easeIn:t,easeOut:n,easeInOut:i};return G_(e,function(e){for(var t in ry[e]=x_[e]=s,ry[r=e.toLowerCase()]=n,s)ry[r+("easeIn"===t?".in":"easeOut"===t?".out":".inOut")]=ry[e+"."+t]=s[t]}),s},dy=function(e){return function(t){return t<.5?(1-e(1-2*t))/2:.5+e(2*(t-.5))/2}},py=function e(t,n,i){var r=n>=1?n:1,s=(i||(t?.3:.45))/(n<1?n:1),o=s/e_*(Math.asin(1/r)||0),a=function(e){return 1===e?1:r*Math.pow(2,-10*e)*s_((e-o)*s)+1},l="out"===t?a:"in"===t?function(e){return 1-a(1-e)}:dy(a);return s=e_/s,l.config=function(n,i){return e(t,n,i)},l},my=function e(t,n){void 0===n&&(n=1.70158);var i=function(e){return e?--e*e*((n+1)*e+n)+1:0},r="out"===t?i:"in"===t?function(e){return 1-i(1-e)}:dy(i);return r.config=function(n){return e(t,n)},r};G_("Linear,Quad,Cubic,Quart,Quint,Strong",function(e,t){var n=t<5?t+1:t;hy(e+",Power"+(n-1),t?function(e){return Math.pow(e,n)}:function(e){return e},function(e){return 1-Math.pow(1-e,n)},function(e){return e<.5?Math.pow(2*e,n)/2:1-Math.pow(2*(1-e),n)/2})}),ry.Linear.easeNone=ry.none=ry.Linear.easeIn,hy("Elastic",py("in"),py("out"),py()),function(e,t){var n=1/t,i=2*n,r=2.5*n,s=function(s){return s<n?e*s*s:s<i?e*Math.pow(s-1.5/t,2)+.75:s<r?e*(s-=2.25/t)*s+.9375:e*Math.pow(s-2.625/t,2)+.984375};hy("Bounce",function(e){return 1-s(1-e)},s)}(7.5625,2.75),hy("Expo",function(e){return Math.pow(2,10*(e-1))*e+e*e*e*e*e*e*(1-e)}),hy("Circ",function(e){return-(i_(1-e*e)-1)}),hy("Sine",function(e){return 1===e?1:1-r_(e*t_)}),hy("Back",my("in"),my("out"),my()),ry.SteppedEase=ry.steps=x_.SteppedEase={config:function(e,t){void 0===e&&(e=1);var n=1/e,i=e+(t?0:1),r=t?1:0,s=1-Jg;return function(e){return((i*Sv(0,s,e)|0)+r)*n}}},Zg.ease=ry["quad.out"],G_("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(e){return z_+=e+","+e+"Params,"});var fy=function(e,t){this.id=n_++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:H_,this.set=t?t.getSetter:Ly},gy=function(){function e(e){this.vars=e,this._delay=+e.delay||0,(this._repeat=e.repeat===1/0?-2:e.repeat||0)&&(this._rDelay=e.repeatDelay||0,this._yoyo=!!e.yoyo||!!e.yoyoEase),this._ts=1,Tv(this,+e.duration,1,1),this.data=e.data,Bg&&(this._ctx=Bg,Bg.data.push(this)),Yg||ny.wake()}var t=e.prototype;return t.delay=function(e){return e||0===e?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+e-this._delay),this._delay=e,this):this._delay},t.duration=function(e){return arguments.length?this.totalDuration(this._repeat>0?e+(e+this._rDelay)*this._repeat:e):this.totalDuration()&&this._dur},t.totalDuration=function(e){return arguments.length?(this._dirty=0,Tv(this,this._repeat<0?e:(e-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},t.totalTime=function(e,t){if(iy(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(fv(this,e),!n._dp||n.parent||gv(n,this);n&&n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&e<this._tDur||this._ts<0&&e>0||!this._tDur&&!e)&&_v(this._dp,this,this._start-this._delay)}return(this._tTime!==e||!this._dur&&!t||this._initted&&Math.abs(this._zTime)===Jg||!e&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=e),Z_(this,e,t)),this},t.time=function(e,t){return arguments.length?this.totalTime(Math.min(this.totalDuration(),e+hv(this))%(this._dur+this._rDelay)||(e?this._dur:0),t):this._time},t.totalProgress=function(e,t){return arguments.length?this.totalTime(this.totalDuration()*e,t):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},t.progress=function(e,t){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?e:1-e)+hv(this),t):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},t.iteration=function(e,t){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(e-1)*n,t):this._repeat?dv(this._tTime,n)+1:1},t.timeScale=function(e,t){if(!arguments.length)return this._rts===-Jg?0:this._rts;if(this._rts===e)return this;var n=this.parent&&this._ts?pv(this.parent._time,this):this._tTime;return this._rts=+e||0,this._ts=this._ps||e===-Jg?0:this._rts,this.totalTime(Sv(-Math.abs(this._delay),this.totalDuration(),n),!1!==t),mv(this),function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e}(this)},t.paused=function(e){return arguments.length?(this._ps!==e&&(this._ps=e,e?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(iy(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==Jg&&(this._tTime-=Jg)))),this):this._ps},t.startTime=function(e){if(arguments.length){this._start=e;var t=this.parent||this._dp;return t&&(t._sort||!this.parent)&&_v(t,this,e-this._delay),this}return this._start},t.endTime=function(e){return this._start+(h_(e)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},t.rawTime=function(e){var t=this.parent||this._dp;return t?e&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?pv(t.rawTime(e),this):this._tTime:this._tTime},t.revert=function(e){void 0===e&&(e=k_);var t=zg;return zg=e,$_(this)&&(this.timeline&&this.timeline.revert(e),this.totalTime(-.01,e.suppressEvents)),"nested"!==this.data&&!1!==e.kill&&this.kill(),zg=t,this},t.globalTime=function(e){for(var t=this,n=arguments.length?e:t.rawTime();t;)n=t._start+n/(Math.abs(t._ts)||1),t=t._dp;return!this.parent&&this._sat?this._sat.globalTime(e):n},t.repeat=function(e){return arguments.length?(this._repeat=e===1/0?-2:e,xv(this)):-2===this._repeat?1/0:this._repeat},t.repeatDelay=function(e){if(arguments.length){var t=this._time;return this._rDelay=e,xv(this),t?this.time(t):this}return this._rDelay},t.yoyo=function(e){return arguments.length?(this._yoyo=e,this):this._yoyo},t.seek=function(e,t){return this.totalTime(Pv(this,e),h_(t))},t.restart=function(e,t){return this.play().totalTime(e?-this._delay:0,h_(t)),this._dur||(this._zTime=-Jg),this},t.play=function(e,t){return null!=e&&this.seek(e,t),this.reversed(!1).paused(!1)},t.reverse=function(e,t){return null!=e&&this.seek(e||this.totalDuration(),t),this.reversed(!0).paused(!1)},t.pause=function(e,t){return null!=e&&this.seek(e,t),this.paused(!0)},t.resume=function(){return this.paused(!1)},t.reversed=function(e){return arguments.length?(!!e!==this.reversed()&&this.timeScale(-this._rts||(e?-Jg:0)),this):this._rts<0},t.invalidate=function(){return this._initted=this._act=0,this._zTime=-Jg,this},t.isActive=function(){var e,t=this.parent||this._dp,n=this._start;return!(t&&!(this._ts&&this._initted&&t.isActive()&&(e=t.rawTime(!0))>=n&&e<this.endTime(!0)-Jg))},t.eventCallback=function(e,t,n){var i=this.vars;return arguments.length>1?(t?(i[e]=t,n&&(i[e+"Params"]=n),"onUpdate"===e&&(this._onUpdate=t)):delete i[e],this):i[e]},t.then=function(e){var t=this;return new Promise(function(n){var i=a_(e)?e:J_,r=function(){var e=t.then;t.then=null,a_(i)&&(i=i(t))&&(i.then||i===t)&&(t.then=e),n(i),t.then=e};t._initted&&1===t.totalProgress()&&t._ts>=0||!t._tTime&&t._ts<0?r():t._prom=r})},t.kill=function(){Gv(this)},e}();ev(gy.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-Jg,_prom:0,_ps:!1,_rts:1});var _y=function(e){function t(t,n){var i;return void 0===t&&(t={}),(i=e.call(this,t)||this).labels={},i.smoothChildTiming=!!t.smoothChildTiming,i.autoRemoveChildren=!!t.autoRemoveChildren,i._sort=h_(t.sortChildren),Vg&&_v(t.parent||Vg,Ug(i),n),t.reversed&&i.reverse(),t.paused&&i.paused(!0),t.scrollTrigger&&vv(Ug(i),t.scrollTrigger),i}Ng(t,e);var n=t.prototype;return n.to=function(e,t,n){return Av(0,arguments,this),this},n.from=function(e,t,n){return Av(1,arguments,this),this},n.fromTo=function(e,t,n,i){return Av(2,arguments,this),this},n.set=function(e,t,n){return t.duration=0,t.parent=this,rv(t).repeatDelay||(t.repeat=0),t.immediateRender=!!t.immediateRender,new Sy(e,t,Pv(this,n),1),this},n.call=function(e,t,n){return _v(this,Sy.delayedCall(0,e,t),n)},n.staggerTo=function(e,t,n,i,r,s,o){return n.duration=t,n.stagger=n.stagger||i,n.onComplete=s,n.onCompleteParams=o,n.parent=this,new Sy(e,n,Pv(this,r)),this},n.staggerFrom=function(e,t,n,i,r,s,o){return n.runBackwards=1,rv(n).immediateRender=h_(n.immediateRender),this.staggerTo(e,t,n,i,r,s,o)},n.staggerFromTo=function(e,t,n,i,r,s,o,a){return i.startAt=n,rv(i).immediateRender=h_(i.immediateRender),this.staggerTo(e,t,i,r,s,o,a)},n.render=function(e,t,n){var i,r,s,o,a,l,c,u,h,d,p,m,f=this._time,g=this._dirty?this.totalDuration():this._tDur,_=this._dur,v=e<=0?0:K_(e),y=this._zTime<0!=e<0&&(this._initted||!_);if(this!==Vg&&v>g&&e>=0&&(v=g),v!==this._tTime||n||y){if(f!==this._time&&_&&(v+=this._time-f,e+=this._time-f),i=v,h=this._start,l=!(u=this._ts),y&&(_||(f=this._zTime),(e||!t)&&(this._zTime=e)),this._repeat){if(p=this._yoyo,a=_+this._rDelay,this._repeat<-1&&e<0)return this.totalTime(100*a+e,t,n);if(i=K_(v%a),v===g?(o=this._repeat,i=_):((o=~~(d=K_(v/a)))&&o===d&&(i=_,o--),i>_&&(i=_)),d=dv(this._tTime,a),!f&&this._tTime&&d!==o&&this._tTime-d*a-this._dur<=0&&(d=o),p&&1&o&&(i=_-i,m=1),o!==d&&!this._lock){var b=p&&1&d,w=b===(p&&1&o);if(o<d&&(b=!b),f=b?0:v%_?_:v,this._lock=1,this.render(f||(m?0:K_(o*a)),t,!_)._lock=0,this._tTime=v,!t&&this.parent&&Hv(this,"onRepeat"),this.vars.repeatRefresh&&!m&&(this.invalidate()._lock=1),f&&f!==this._time||l!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(_=this._dur,g=this._tDur,w&&(this._lock=2,f=b?_:-1e-4,this.render(f,!0),this.vars.repeatRefresh&&!m&&this.invalidate()),this._lock=0,!this._ts&&!l)return this;cy(this,m)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(c=function(e,t,n){var i;if(n>t)for(i=e._first;i&&i._start<=n;){if("isPause"===i.data&&i._start>t)return i;i=i._next}else for(i=e._last;i&&i._start>=n;){if("isPause"===i.data&&i._start<t)return i;i=i._prev}}(this,K_(f),K_(i)),c&&(v-=i-(i=c._start))),this._tTime=v,this._time=i,this._act=!u,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=e,f=0),!f&&v&&!t&&!d&&(Hv(this,"onStart"),this._tTime!==v))return this;if(i>=f&&e>=0)for(r=this._first;r;){if(s=r._next,(r._act||i>=r._start)&&r._ts&&c!==r){if(r.parent!==this)return this.render(e,t,n);if(r.render(r._ts>0?(i-r._start)*r._ts:(r._dirty?r.totalDuration():r._tDur)+(i-r._start)*r._ts,t,n),i!==this._time||!this._ts&&!l){c=0,s&&(v+=this._zTime=-Jg);break}}r=s}else{r=this._last;for(var T=e<0?e:i;r;){if(s=r._prev,(r._act||T<=r._end)&&r._ts&&c!==r){if(r.parent!==this)return this.render(e,t,n);if(r.render(r._ts>0?(T-r._start)*r._ts:(r._dirty?r.totalDuration():r._tDur)+(T-r._start)*r._ts,t,n||zg&&$_(r)),i!==this._time||!this._ts&&!l){c=0,s&&(v+=this._zTime=T?-Jg:Jg);break}}r=s}}if(c&&!t&&(this.pause(),c.render(i>=f?0:-Jg)._zTime=i>=f?1:-1,this._ts))return this._start=h,mv(this),this.render(e,t,n);this._onUpdate&&!t&&Hv(this,"onUpdate",!0),(v===g&&this._tTime>=this.totalDuration()||!v&&f)&&(h===this._start||Math.abs(u)!==Math.abs(this._ts))&&(this._lock||((e||!_)&&(v===g&&this._ts>0||!v&&this._ts<0)&&av(this,1),!t&&(!(e<0)||f)&&(v||f||!g)&&(Hv(this,v===g&&e>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(v<g&&this.timeScale()>0)&&this._prom())))}return this},n.add=function(e,t){var n=this;if(l_(t)||(t=Pv(this,t,e)),!(e instanceof gy)){if(f_(e))return e.forEach(function(e){return n.add(e,t)}),this;if(o_(e))return this.addLabel(e,t);if(!a_(e))return this;e=Sy.delayedCall(0,e)}return this!==e?_v(this,e,t):this},n.getChildren=function(e,t,n,i){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===n&&(n=!0),void 0===i&&(i=-Qg);for(var r=[],s=this._first;s;)s._start>=i&&(s instanceof Sy?t&&r.push(s):(n&&r.push(s),e&&r.push.apply(r,s.getChildren(!0,t,n)))),s=s._next;return r},n.getById=function(e){for(var t=this.getChildren(1,1,1),n=t.length;n--;)if(t[n].vars.id===e)return t[n]},n.remove=function(e){return o_(e)?this.removeLabel(e):a_(e)?this.killTweensOf(e):(e.parent===this&&ov(this,e),e===this._recent&&(this._recent=this._last),lv(this))},n.totalTime=function(t,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=K_(ny.time-(this._ts>0?t/this._ts:(this.totalDuration()-t)/-this._ts))),e.prototype.totalTime.call(this,t,n),this._forcing=0,this):this._tTime},n.addLabel=function(e,t){return this.labels[e]=Pv(this,t),this},n.removeLabel=function(e){return delete this.labels[e],this},n.addPause=function(e,t,n){var i=Sy.delayedCall(0,t||C_,n);return i.data="isPause",this._hasPause=1,_v(this,i,Pv(this,e))},n.removePause=function(e){var t=this._first;for(e=Pv(this,e);t;)t._start===e&&"isPause"===t.data&&av(t),t=t._next},n.killTweensOf=function(e,t,n){for(var i=this.getTweensOf(e,n),r=i.length;r--;)vy!==i[r]&&i[r].kill(e,t);return this},n.getTweensOf=function(e,t){for(var n,i=[],r=kv(e),s=this._first,o=l_(t);s;)s instanceof Sy?q_(s._targets,r)&&(o?(!vy||s._initted&&s._ts)&&s.globalTime(0)<=t&&s.globalTime(s.totalDuration())>t:!t||s.isActive())&&i.push(s):(n=s.getTweensOf(r,t)).length&&i.push.apply(i,n),s=s._next;return i},n.tweenTo=function(e,t){t=t||{};var n,i=this,r=Pv(i,e),s=t,o=s.startAt,a=s.onStart,l=s.onStartParams,c=s.immediateRender,u=Sy.to(i,ev({ease:t.ease||"none",lazy:!1,immediateRender:!1,time:r,overwrite:"auto",duration:t.duration||Math.abs((r-(o&&"time"in o?o.time:i._time))/i.timeScale())||Jg,onStart:function(){if(i.pause(),!n){var e=t.duration||Math.abs((r-(o&&"time"in o?o.time:i._time))/i.timeScale());u._dur!==e&&Tv(u,e,0,1).render(u._time,!0,!0),n=1}a&&a.apply(u,l||[])}},t));return c?u.render(0):u},n.tweenFromTo=function(e,t,n){return this.tweenTo(t,ev({startAt:{time:Pv(this,e)}},n))},n.recent=function(){return this._recent},n.nextLabel=function(e){return void 0===e&&(e=this._time),Vv(this,Pv(this,e))},n.previousLabel=function(e){return void 0===e&&(e=this._time),Vv(this,Pv(this,e),1)},n.currentLabel=function(e){return arguments.length?this.seek(e,!0):this.previousLabel(this._time+Jg)},n.shiftChildren=function(e,t,n){void 0===n&&(n=0);for(var i,r=this._first,s=this.labels;r;)r._start>=n&&(r._start+=e,r._end+=e),r=r._next;if(t)for(i in s)s[i]>=n&&(s[i]+=e);return lv(this)},n.invalidate=function(t){var n=this._first;for(this._lock=0;n;)n.invalidate(t),n=n._next;return e.prototype.invalidate.call(this,t)},n.clear=function(e){void 0===e&&(e=!0);for(var t,n=this._first;n;)t=n._next,this.remove(n),n=t;return this._dp&&(this._time=this._tTime=this._pTime=0),e&&(this.labels={}),lv(this)},n.totalDuration=function(e){var t,n,i,r=0,s=this,o=s._last,a=Qg;if(arguments.length)return s.timeScale((s._repeat<0?s.duration():s.totalDuration())/(s.reversed()?-e:e));if(s._dirty){for(i=s.parent;o;)t=o._prev,o._dirty&&o.totalDuration(),(n=o._start)>a&&s._sort&&o._ts&&!s._lock?(s._lock=1,_v(s,o,n-o._delay,1)._lock=0):a=n,n<0&&o._ts&&(r-=n,(!i&&!s._dp||i&&i.smoothChildTiming)&&(s._start+=n/s._ts,s._time-=n,s._tTime-=n),s.shiftChildren(-n,!1,-1/0),a=0),o._end>r&&o._ts&&(r=o._end),o=t;Tv(s,s===Vg&&s._time>r?s._time:r,1,1),s._dirty=0}return s._tDur},t.updateRoot=function(e){if(Vg._ts&&(Z_(Vg,pv(e,Vg)),Xg=ny.frame),ny.frame>=N_){N_+=$g.autoSleep||120;var t=Vg._first;if((!t||!t._ts)&&$g.autoSleep&&ny._listeners.length<2){for(;t&&!t._ts;)t=t._next;t||ny.sleep()}}},t}(gy);ev(_y.prototype,{_lock:0,_hasPause:0,_forcing:0});var vy,yy,by=function(e,t,n,i,r,s,o){var a,l,c,u,h,d,p,m,f=new Vy(this._pt,e,t,0,1,Fy,null,r),g=0,_=0;for(f.b=n,f.e=i,n+="",(p=~(i+="").indexOf("random("))&&(i=zv(i)),s&&(s(m=[n,i],e,t),n=m[0],i=m[1]),l=n.match(y_)||[];a=y_.exec(i);)u=a[0],h=i.substring(g,a.index),c?c=(c+1)%5:"rgba("===h.substr(-5)&&(c=1),u!==l[_++]&&(d=parseFloat(l[_-1])||0,f._pt={_next:f._pt,p:h||1===_?h:",",s:d,c:"="===u.charAt(1)?X_(d,u)-d:parseFloat(u)-d,m:c&&c<4?Math.round:0},g=y_.lastIndex);return f.c=g<i.length?i.substring(g,i.length):"",f.fp=o,(b_.test(i)||p)&&(f.e=0),this._pt=f,f},wy=function(e,t,n,i,r,s,o,a,l,c){a_(i)&&(i=i(r||0,e,s));var u,h=e[t],d="get"!==n?n:a_(h)?l?e[t.indexOf("set")||!a_(e["get"+t.substr(3)])?t:"get"+t.substr(3)](l):e[t]():h,p=a_(h)?l?Oy:Ry:Cy;if(o_(i)&&(~i.indexOf("random(")&&(i=zv(i)),"="===i.charAt(1)&&(((u=X_(d,i)+(Cv(d)||0))||0===u)&&(i=u))),!c||d!==i||yy)return isNaN(d*i)||""===i?(!h&&!(t in e)&&A_(t,i),by.call(this,e,t,d,i,p,a||$g.stringFilter,l)):(u=new Vy(this._pt,e,t,+d||0,i-(d||0),"boolean"==typeof h?Dy:Iy,0,p),l&&(u.fp=l),o&&u.modifier(o,this,e),this._pt=u)},Ty=function(e,t,n,i,r,s){var o,a,l,c;if(F_[e]&&!1!==(o=new F_[e]).init(r,o.rawVars?t[e]:function(e,t,n,i,r){if(a_(e)&&(e=Py(e,r,t,n,i)),!u_(e)||e.style&&e.nodeType||f_(e)||m_(e))return o_(e)?Py(e,r,t,n,i):e;var s,o={};for(s in e)o[s]=Py(e[s],r,t,n,i);return o}(t[e],i,r,s,n),n,i,s)&&(n._pt=a=new Vy(n._pt,r,e,0,1,o.render,o,0,o.priority),n!==qg))for(l=n._ptLookup[n._targets.indexOf(r)],c=o._props.length;c--;)l[o._props[c]]=a;return o},xy=function e(t,n,i){var r,s,o,a,l,c,u,h,d,p,m,f,g,_=t.vars,v=_.ease,y=_.startAt,b=_.immediateRender,w=_.lazy,T=_.onUpdate,x=_.runBackwards,E=_.yoyoEase,P=_.keyframes,A=_.autoRevert,M=t._dur,S=t._startAt,C=t._targets,R=t.parent,O=R&&"nested"===R.data?R.vars.targets:C,k="auto"===t._overwrite&&!jg,L=t.timeline;if(L&&(!P||!v)&&(v="none"),t._ease=uy(v,Zg.ease),t._yEase=E?ly(uy(!0===E?v:E,Zg.ease)):0,E&&t._yoyo&&!t._repeat&&(E=t._yEase,t._yEase=t._ease,t._ease=E),t._from=!L&&!!_.runBackwards,!L||P&&!_.stagger){if(f=(h=C[0]?V_(C[0]).harness:0)&&_[h.prop],r=iv(_,L_),S&&(S._zTime<0&&S.progress(1),n<0&&x&&b&&!A?S.render(-1,!0):S.revert(x&&M?O_:R_),S._lazy=0),y){if(av(t._startAt=Sy.set(C,ev({data:"isStart",overwrite:!1,parent:R,immediateRender:!0,lazy:!S&&h_(w),startAt:null,delay:0,onUpdate:T&&function(){return Hv(t,"onUpdate")},stagger:0},y))),t._startAt._dp=0,t._startAt._sat=t,n<0&&(zg||!b&&!A)&&t._startAt.revert(O_),b&&M&&n<=0&&i<=0)return void(n&&(t._zTime=n))}else if(x&&M&&!S)if(n&&(b=!1),o=ev({overwrite:!1,data:"isFromStart",lazy:b&&!S&&h_(w),immediateRender:b,stagger:0,parent:R},r),f&&(o[h.prop]=f),av(t._startAt=Sy.set(C,o)),t._startAt._dp=0,t._startAt._sat=t,n<0&&(zg?t._startAt.revert(O_):t._startAt.render(-1,!0)),t._zTime=n,b){if(!n)return}else e(t._startAt,Jg,Jg);for(t._pt=t._ptCache=0,w=M&&h_(w)||w&&!M,s=0;s<C.length;s++){if(u=(l=C[s])._gsap||B_(C)[s]._gsap,t._ptLookup[s]=p={},D_[u.id]&&I_.length&&Y_(),m=O===C?s:O.indexOf(l),h&&!1!==(d=new h).init(l,f||r,t,m,O)&&(t._pt=a=new Vy(t._pt,l,d.name,0,1,d.render,d,0,d.priority),d._props.forEach(function(e){p[e]=a}),d.priority&&(c=1)),!h||f)for(o in r)F_[o]&&(d=Ty(o,r,t,m,l,O))?d.priority&&(c=1):p[o]=a=wy.call(t,l,o,"get",r[o],m,O,0,_.stringFilter);t._op&&t._op[s]&&t.kill(l,t._op[s]),k&&t._pt&&(vy=t,Vg.killTweensOf(l,p,t.globalTime(n)),g=!t.parent,vy=0),t._pt&&w&&(D_[u.id]=1)}c&&By(t),t._onInit&&t._onInit(t)}t._onUpdate=T,t._initted=(!t._op||t._pt)&&!g,P&&n<=0&&L.render(Qg,!0,!0)},Ey=function(e,t,n,i){var r,s,o=t.ease||i||"power1.inOut";if(f_(t))s=n[e]||(n[e]=[]),t.forEach(function(e,n){return s.push({t:n/(t.length-1)*100,v:e,e:o})});else for(r in t)s=n[r]||(n[r]=[]),"ease"===r||s.push({t:parseFloat(e),v:t[r],e:o})},Py=function(e,t,n,i,r){return a_(e)?e.call(t,n,i,r):o_(e)&&~e.indexOf("random(")?zv(e):e},Ay=z_+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",My={};G_(Ay+",id,stagger,delay,duration,paused,scrollTrigger",function(e){return My[e]=1});var Sy=function(e){function t(t,n,i,r){var s;"number"==typeof n&&(i.duration=n,n=i,i=null);var o,a,l,c,u,h,d,p,m=(s=e.call(this,r?n:rv(n))||this).vars,f=m.duration,g=m.delay,_=m.immediateRender,v=m.stagger,y=m.overwrite,b=m.keyframes,w=m.defaults,T=m.scrollTrigger,x=m.yoyoEase,E=n.parent||Vg,P=(f_(t)||m_(t)?l_(t[0]):"length"in n)?[t]:kv(t);if(s._targets=P.length?B_(P):M_("GSAP target "+t+" not found. https://gsap.com",!$g.nullTargetWarn)||[],s._ptLookup=[],s._overwrite=y,b||v||p_(f)||p_(g)){if(n=s.vars,(o=s.timeline=new _y({data:"nested",defaults:w||{},targets:E&&"nested"===E.data?E.vars.targets:P})).kill(),o.parent=o._dp=Ug(s),o._start=0,v||p_(f)||p_(g)){if(c=P.length,d=v&&Dv(v),u_(v))for(u in v)~Ay.indexOf(u)&&(p||(p={}),p[u]=v[u]);for(a=0;a<c;a++)(l=iv(n,My)).stagger=0,x&&(l.yoyoEase=x),p&&tv(l,p),h=P[a],l.duration=+Py(f,Ug(s),a,h,P),l.delay=(+Py(g,Ug(s),a,h,P)||0)-s._delay,!v&&1===c&&l.delay&&(s._delay=g=l.delay,s._start+=g,l.delay=0),o.to(h,l,d?d(a,h,P):0),o._ease=ry.none;o.duration()?f=g=0:s.timeline=0}else if(b){rv(ev(o.vars.defaults,{ease:"none"})),o._ease=uy(b.ease||n.ease||"none");var A,M,S,C=0;if(f_(b))b.forEach(function(e){return o.to(P,e,">")}),o.duration();else{for(u in l={},b)"ease"===u||"easeEach"===u||Ey(u,b[u],l,b.easeEach);for(u in l)for(A=l[u].sort(function(e,t){return e.t-t.t}),C=0,a=0;a<A.length;a++)(S={ease:(M=A[a]).e,duration:(M.t-(a?A[a-1].t:0))/100*f})[u]=M.v,o.to(P,S,C),C+=S.duration;o.duration()<f&&o.to({},{duration:f-o.duration()})}}f||s.duration(f=o.duration())}else s.timeline=0;return!0===y&&!jg&&(vy=Ug(s),Vg.killTweensOf(P),vy=0),_v(E,Ug(s),i),n.reversed&&s.reverse(),n.paused&&s.paused(!0),(_||!f&&!b&&s._start===K_(E._time)&&h_(_)&&uv(Ug(s))&&"nested"!==E.data)&&(s._tTime=-Jg,s.render(Math.max(0,-g)||0)),T&&vv(Ug(s),T),s}Ng(t,e);var n=t.prototype;return n.render=function(e,t,n){var i,r,s,o,a,l,c,u,h,d=this._time,p=this._tDur,m=this._dur,f=e<0,g=e>p-Jg&&!f?p:e<Jg?0:e;if(m){if(g!==this._tTime||!e||n||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==f||this._lazy){if(i=g,u=this.timeline,this._repeat){if(o=m+this._rDelay,this._repeat<-1&&f)return this.totalTime(100*o+e,t,n);if(i=K_(g%o),g===p?(s=this._repeat,i=m):(s=~~(a=K_(g/o)))&&s===a?(i=m,s--):i>m&&(i=m),(l=this._yoyo&&1&s)&&(h=this._yEase,i=m-i),a=dv(this._tTime,o),i===d&&!n&&this._initted&&s===a)return this._tTime=g,this;s!==a&&(u&&this._yEase&&cy(u,l),this.vars.repeatRefresh&&!l&&!this._lock&&i!==o&&this._initted&&(this._lock=n=1,this.render(K_(o*s),!0).invalidate()._lock=0))}if(!this._initted){if(yv(this,f?e:i,n,t,g))return this._tTime=0,this;if(!(d===this._time||n&&this.vars.repeatRefresh&&s!==a))return this;if(m!==this._dur)return this.render(e,t,n)}if(this._tTime=g,this._time=i,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=c=(h||this._ease)(i/m),this._from&&(this.ratio=c=1-c),!d&&g&&!t&&!a&&(Hv(this,"onStart"),this._tTime!==g))return this;for(r=this._pt;r;)r.r(c,r.d),r=r._next;u&&u.render(e<0?e:u._dur*u._ease(i/this._dur),t,n)||this._startAt&&(this._zTime=e),this._onUpdate&&!t&&(f&&cv(this,e,0,n),Hv(this,"onUpdate")),this._repeat&&s!==a&&this.vars.onRepeat&&!t&&this.parent&&Hv(this,"onRepeat"),(g===this._tDur||!g)&&this._tTime===g&&(f&&!this._onUpdate&&cv(this,e,0,!0),(e||!m)&&(g===this._tDur&&this._ts>0||!g&&this._ts<0)&&av(this,1),!t&&(!f||d)&&(g||d||l)&&(Hv(this,g===p?"onComplete":"onReverseComplete",!0),this._prom&&!(g<p&&this.timeScale()>0)&&this._prom()))}}else!function(e,t,n,i){var r,s,o,a=e.ratio,l=t<0||!t&&(!e._start&&bv(e)&&(e._initted||!wv(e))||(e._ts<0||e._dp._ts<0)&&!wv(e))?0:1,c=e._rDelay,u=0;if(c&&e._repeat&&(u=Sv(0,e._tDur,t),s=dv(u,c),e._yoyo&&1&s&&(l=1-l),s!==dv(e._tTime,c)&&(a=1-l,e.vars.repeatRefresh&&e._initted&&e.invalidate())),l!==a||zg||i||e._zTime===Jg||!t&&e._zTime){if(!e._initted&&yv(e,t,i,n,u))return;for(o=e._zTime,e._zTime=t||(n?Jg:0),n||(n=t&&!o),e.ratio=l,e._from&&(l=1-l),e._time=0,e._tTime=u,r=e._pt;r;)r.r(l,r.d),r=r._next;t<0&&cv(e,t,0,!0),e._onUpdate&&!n&&Hv(e,"onUpdate"),u&&e._repeat&&!n&&e.parent&&Hv(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===l&&(l&&av(e,1),!n&&!zg&&(Hv(e,l?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)}(this,e,t,n);return this},n.targets=function(){return this._targets},n.invalidate=function(t){return(!t||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(t),e.prototype.invalidate.call(this,t)},n.resetTo=function(e,t,n,i,r){Yg||ny.wake(),this._ts||this.play();var s=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||xy(this,s),function(e,t,n,i,r,s,o,a){var l,c,u,h,d=(e._pt&&e._ptCache||(e._ptCache={}))[t];if(!d)for(d=e._ptCache[t]=[],u=e._ptLookup,h=e._targets.length;h--;){if((l=u[h][t])&&l.d&&l.d._pt)for(l=l.d._pt;l&&l.p!==t&&l.fp!==t;)l=l._next;if(!l)return yy=1,e.vars[t]="+=0",xy(e,o),yy=0,a?M_(t+" not eligible for reset"):1;d.push(l)}for(h=d.length;h--;)(l=(c=d[h])._pt||c).s=!i&&0!==i||r?l.s+(i||0)+s*l.c:i,l.c=n-l.s,c.e&&(c.e=W_(n)+Cv(c.e)),c.b&&(c.b=l.s+Cv(c.b))}(this,e,t,n,i,this._ease(s/this._dur),s,r)?this.resetTo(e,t,n,i,1):(fv(this,0),this.parent||sv(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},n.kill=function(e,t){if(void 0===t&&(t="all"),!(e||t&&"all"!==t))return this._lazy=this._pt=0,this.parent?Gv(this):this.scrollTrigger&&this.scrollTrigger.kill(!!zg),this;if(this.timeline){var n=this.timeline.totalDuration();return this.timeline.killTweensOf(e,t,vy&&!0!==vy.vars.overwrite)._first||Gv(this),this.parent&&n!==this.timeline.totalDuration()&&Tv(this,this._dur*this.timeline._tDur/n,0,1),this}var i,r,s,o,a,l,c,u=this._targets,h=e?kv(e):u,d=this._ptLookup,p=this._pt;if((!t||"all"===t)&&function(e,t){for(var n=e.length,i=n===t.length;i&&n--&&e[n]===t[n];);return n<0}(u,h))return"all"===t&&(this._pt=0),Gv(this);for(i=this._op=this._op||[],"all"!==t&&(o_(t)&&(a={},G_(t,function(e){return a[e]=1}),t=a),t=function(e,t){var n,i,r,s,o=e[0]?V_(e[0]).harness:0,a=o&&o.aliases;if(!a)return t;for(i in n=tv({},t),a)if(i in n)for(r=(s=a[i].split(",")).length;r--;)n[s[r]]=n[i];return n}(u,t)),c=u.length;c--;)if(~h.indexOf(u[c]))for(a in r=d[c],"all"===t?(i[c]=t,o=r,s={}):(s=i[c]=i[c]||{},o=t),o)(l=r&&r[a])&&((!("kill"in l.d)||!0===l.d.kill(a))&&ov(this,l,"_pt"),delete r[a]),"all"!==s&&(s[a]=1);return this._initted&&!this._pt&&p&&Gv(this),this},t.to=function(e,n){return new t(e,n,arguments[2])},t.from=function(e,t){return Av(1,arguments)},t.delayedCall=function(e,n,i,r){return new t(n,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:e,onComplete:n,onReverseComplete:n,onCompleteParams:i,onReverseCompleteParams:i,callbackScope:r})},t.fromTo=function(e,t,n){return Av(2,arguments)},t.set=function(e,n){return n.duration=0,n.repeatDelay||(n.repeat=0),new t(e,n)},t.killTweensOf=function(e,t,n){return Vg.killTweensOf(e,t,n)},t}(gy);ev(Sy.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),G_("staggerTo,staggerFrom,staggerFromTo",function(e){Sy[e]=function(){var t=new _y,n=Rv.call(arguments,0);return n.splice("staggerFromTo"===e?5:4,0,0),t[e].apply(t,n)}});var Cy=function(e,t,n){return e[t]=n},Ry=function(e,t,n){return e[t](n)},Oy=function(e,t,n,i){return e[t](i.fp,n)},ky=function(e,t,n){return e.setAttribute(t,n)},Ly=function(e,t){return a_(e[t])?Ry:c_(e[t])&&e.setAttribute?ky:Cy},Iy=function(e,t){return t.set(t.t,t.p,Math.round(1e6*(t.s+t.c*e))/1e6,t)},Dy=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},Fy=function(e,t){var n=t._pt,i="";if(!e&&t.b)i=t.b;else if(1===e&&t.e)i=t.e;else{for(;n;)i=n.p+(n.m?n.m(n.s+n.c*e):Math.round(1e4*(n.s+n.c*e))/1e4)+i,n=n._next;i+=t.c}t.set(t.t,t.p,i,t)},Uy=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},Ny=function(e,t,n,i){for(var r,s=this._pt;s;)r=s._next,s.p===i&&s.modifier(e,t,n),s=r},jy=function(e){for(var t,n,i=this._pt;i;)n=i._next,i.p===e&&!i.op||i.op===e?ov(this,i,"_pt"):i.dep||(t=1),i=n;return!t},zy=function(e,t,n,i){i.mSet(e,t,i.m.call(i.tween,n,i.mt),i)},By=function(e){for(var t,n,i,r,s=e._pt;s;){for(t=s._next,n=i;n&&n.pr>s.pr;)n=n._next;(s._prev=n?n._prev:r)?s._prev._next=s:i=s,(s._next=n)?n._prev=s:r=s,s=t}e._pt=i},Vy=function(){function e(e,t,n,i,r,s,o,a,l){this.t=t,this.s=i,this.c=r,this.p=n,this.r=s||Iy,this.d=o||this,this.set=a||Cy,this.pr=l||0,this._next=e,e&&(e._prev=this)}return e.prototype.modifier=function(e,t,n){this.mSet=this.mSet||this.set,this.set=zy,this.m=e,this.mt=n,this.tween=t},e}();G_(z_+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(e){return L_[e]=1}),x_.TweenMax=x_.TweenLite=Sy,x_.TimelineLite=x_.TimelineMax=_y,Vg=new _y({sortChildren:!1,defaults:Zg,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),$g.stringFilter=ty;var Hy=[],Gy={},Wy=[],Ky=0,Xy=0,qy=function(e){return(Gy[e]||Wy).map(function(e){return e()})},Yy=function(){var e=Date.now(),t=[];e-Ky>2&&(qy("matchMediaInit"),Hy.forEach(function(e){var n,i,r,s,o=e.queries,a=e.conditions;for(i in o)(n=Hg.matchMedia(o[i]).matches)&&(r=1),n!==a[i]&&(a[i]=n,s=1);s&&(e.revert(),r&&t.push(e))}),qy("matchMediaRevert"),t.forEach(function(e){return e.onMatch(e,function(t){return e.add(null,t)})}),Ky=e,qy("matchMedia"))},$y=function(){function e(e,t){this.selector=t&&Lv(t),this.data=[],this._r=[],this.isReverted=!1,this.id=Xy++,e&&this.add(e)}var t=e.prototype;return t.add=function(e,t,n){a_(e)&&(n=t,t=e,e=a_);var i=this,r=function(){var e,r=Bg,s=i.selector;return r&&r!==i&&r.data.push(i),n&&(i.selector=Lv(n)),Bg=i,e=t.apply(i,arguments),a_(e)&&i._r.push(e),Bg=r,i.selector=s,i.isReverted=!1,e};return i.last=r,e===a_?r(i,function(e){return i.add(null,e)}):e?i[e]=r:r},t.ignore=function(e){var t=Bg;Bg=null,e(this),Bg=t},t.getTweens=function(){var t=[];return this.data.forEach(function(n){return n instanceof e?t.push.apply(t,n.getTweens()):n instanceof Sy&&!(n.parent&&"nested"===n.parent.data)&&t.push(n)}),t},t.clear=function(){this._r.length=this.data.length=0},t.kill=function(e,t){var n=this;if(e?function(){for(var t,i=n.getTweens(),r=n.data.length;r--;)"isFlip"===(t=n.data[r]).data&&(t.revert(),t.getChildren(!0,!0,!1).forEach(function(e){return i.splice(i.indexOf(e),1)}));for(i.map(function(e){return{g:e._dur||e._delay||e._sat&&!e._sat.vars.immediateRender?e.globalTime(0):-1/0,t:e}}).sort(function(e,t){return t.g-e.g||-1/0}).forEach(function(t){return t.t.revert(e)}),r=n.data.length;r--;)(t=n.data[r])instanceof _y?"nested"!==t.data&&(t.scrollTrigger&&t.scrollTrigger.revert(),t.kill()):!(t instanceof Sy)&&t.revert&&t.revert(e);n._r.forEach(function(t){return t(e,n)}),n.isReverted=!0}():this.data.forEach(function(e){return e.kill&&e.kill()}),this.clear(),t)for(var i=Hy.length;i--;)Hy[i].id===this.id&&Hy.splice(i,1)},t.revert=function(e){this.kill(e||{})},e}(),Zy=function(){function e(e){this.contexts=[],this.scope=e,Bg&&Bg.data.push(this)}var t=e.prototype;return t.add=function(e,t,n){u_(e)||(e={matches:e});var i,r,s,o=new $y(0,n||this.scope),a=o.conditions={};for(r in Bg&&!o.selector&&(o.selector=Bg.selector),this.contexts.push(o),t=o.add("onMatch",t),o.queries=e,e)"all"===r?s=1:(i=Hg.matchMedia(e[r]))&&(Hy.indexOf(o)<0&&Hy.push(o),(a[r]=i.matches)&&(s=1),i.addListener?i.addListener(Yy):i.addEventListener("change",Yy));return s&&t(o,function(e){return o.add(null,e)}),this},t.revert=function(e){this.kill(e||{})},t.kill=function(e){this.contexts.forEach(function(t){return t.kill(e,!0)})},e}(),Qy={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(e){return Kv(e)})},timeline:function(e){return new _y(e)},getTweensOf:function(e,t){return Vg.getTweensOf(e,t)},getProperty:function(e,t,n,i){o_(e)&&(e=kv(e)[0]);var r=V_(e||{}).get,s=n?J_:Q_;return"native"===n&&(n=""),e&&(t?s((F_[t]&&F_[t].get||r)(e,t,n,i)):function(t,n,i){return s((F_[t]&&F_[t].get||r)(e,t,n,i))})},quickSetter:function(e,t,n){if((e=kv(e)).length>1){var i=e.map(function(e){return tb.quickSetter(e,t,n)}),r=i.length;return function(e){for(var t=r;t--;)i[t](e)}}e=e[0]||{};var s=F_[t],o=V_(e),a=o.harness&&(o.harness.aliases||{})[t]||t,l=s?function(t){var i=new s;qg._pt=0,i.init(e,n?t+n:t,qg,0,[e]),i.render(1,i),qg._pt&&Uy(1,qg)}:o.set(e,a);return s?l:function(t){return l(e,a,n?t+n:t,o,1)}},quickTo:function(e,t,n){var i,r=tb.to(e,ev(((i={})[t]="+=0.1",i.paused=!0,i.stagger=0,i),n||{})),s=function(e,n,i){return r.resetTo(t,e,n,i)};return s.tween=r,s},isTweening:function(e){return Vg.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=uy(e.ease,Zg.ease)),nv(Zg,e||{})},config:function(e){return nv($g,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,i=e.plugins,r=e.defaults,s=e.extendTimeline;(i||"").split(",").forEach(function(e){return e&&!F_[e]&&!x_[e]&&M_(t+" effect requires "+e+" plugin.")}),U_[t]=function(e,t,i){return n(kv(e),ev(t||{},r),i)},s&&(_y.prototype[t]=function(e,n,i){return this.add(U_[t](e,u_(n)?n:(i=n)&&{},this),i)})},registerEase:function(e,t){ry[e]=uy(t)},parseEase:function(e,t){return arguments.length?uy(e,t):ry},getById:function(e){return Vg.getById(e)},exportRoot:function(e,t){void 0===e&&(e={});var n,i,r=new _y(e);for(r.smoothChildTiming=h_(e.smoothChildTiming),Vg.remove(r),r._dp=0,r._time=r._tTime=Vg._time,n=Vg._first;n;)i=n._next,(t||!(!n._dur&&n instanceof Sy&&n.vars.onComplete===n._targets[0]))&&_v(r,n,n._start-n._delay),n=i;return _v(Vg,r,0),r},context:function(e,t){return e?new $y(e,t):Bg},matchMedia:function(e){return new Zy(e)},matchMediaRefresh:function(){return Hy.forEach(function(e){var t,n,i=e.conditions;for(n in i)i[n]&&(i[n]=!1,t=1);t&&e.revert()})||Yy()},addEventListener:function(e,t){var n=Gy[e]||(Gy[e]=[]);~n.indexOf(t)||n.push(t)},removeEventListener:function(e,t){var n=Gy[e],i=n&&n.indexOf(t);i>=0&&n.splice(i,1)},utils:{wrap:function e(t,n,i){var r=n-t;return f_(t)?jv(t,e(0,t.length),n):Mv(i,function(e){return(r+(e-t)%r)%r+t})},wrapYoyo:function e(t,n,i){var r=n-t,s=2*r;return f_(t)?jv(t,e(0,t.length-1),n):Mv(i,function(e){return t+((e=(s+(e-t)%s)%s||0)>r?s-e:e)})},distribute:Dv,random:Nv,snap:Uv,normalize:function(e,t,n){return Bv(e,t,0,1,n)},getUnit:Cv,clamp:function(e,t,n){return Mv(n,function(n){return Sv(e,t,n)})},splitColor:$v,toArray:kv,selector:Lv,mapRange:Bv,pipe:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduce(function(e,t){return t(e)},e)}},unitize:function(e,t){return function(n){return e(parseFloat(n))+(t||Cv(n))}},interpolate:function e(t,n,i,r){var s=isNaN(t+n)?0:function(e){return(1-e)*t+e*n};if(!s){var o,a,l,c,u,h=o_(t),d={};if(!0===i&&(r=1)&&(i=null),h)t={p:t},n={p:n};else if(f_(t)&&!f_(n)){for(l=[],c=t.length,u=c-2,a=1;a<c;a++)l.push(e(t[a-1],t[a]));c--,s=function(e){e*=c;var t=Math.min(u,~~e);return l[t](e-t)},i=n}else r||(t=tv(f_(t)?[]:{},t));if(!l){for(o in n)wy.call(d,t,o,"get",n[o]);s=function(e){return Uy(e,d)||(h?t.p:t)}}}return Mv(i,s)},shuffle:Iv},install:P_,effects:U_,ticker:ny,updateRoot:_y.updateRoot,plugins:F_,globalTimeline:Vg,core:{PropTween:Vy,globals:S_,Tween:Sy,Timeline:_y,Animation:gy,getCache:V_,_removeLinkedListItem:ov,reverting:function(){return zg},context:function(e){return e&&Bg&&(Bg.data.push(e),e._ctx=Bg),Bg},suppressOverwrites:function(e){return jg=e}}};G_("to,from,fromTo,delayedCall,set,killTweensOf",function(e){return Qy[e]=Sy[e]}),ny.add(_y.updateRoot),qg=Qy.to({},{duration:0});var Jy=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},eb=function(e,t){return{name:e,headless:1,rawVars:1,init:function(e,n,i){i._onInit=function(e){var i,r;if(o_(n)&&(i={},G_(n,function(e){return i[e]=1}),n=i),t){for(r in i={},n)i[r]=t(n[r]);n=i}!function(e,t){var n,i,r,s=e._targets;for(n in t)for(i=s.length;i--;)(r=e._ptLookup[i][n])&&(r=r.d)&&(r._pt&&(r=Jy(r,n)),r&&r.modifier&&r.modifier(t[n],e,s[i],n))}(e,n)}}}},tb=Qy.registerPlugin({name:"attr",init:function(e,t,n,i,r){var s,o,a;for(s in this.tween=n,t)a=e.getAttribute(s)||"",(o=this.add(e,"setAttribute",(a||0)+"",t[s],i,r,0,0,s)).op=s,o.b=a,this._props.push(s)},render:function(e,t){for(var n=t._pt;n;)zg?n.set(n.t,n.p,n.b,n):n.r(e,n.d),n=n._next}},{name:"endArray",headless:1,init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n],0,0,0,0,0,1)}},eb("roundProps",Fv),eb("modifiers"),eb("snap",Uv))||Qy;Sy.version=_y.version=tb.version="3.13.0",Kg=1,d_()&&iy(),ry.Power0,ry.Power1,ry.Power2,ry.Power3,ry.Power4,ry.Linear,ry.Quad,ry.Cubic,ry.Quart,ry.Quint,ry.Strong,ry.Elastic,ry.Back,ry.SteppedEase,ry.Bounce,ry.Sine,ry.Expo,ry.Circ;
/*!
 * CSSPlugin 3.13.0
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/
var nb,ib,rb,sb,ob,ab,lb,cb,ub={},hb=180/Math.PI,db=Math.PI/180,pb=Math.atan2,mb=1e8,fb=/([A-Z])/g,gb=/(left|right|width|margin|padding|x)/i,_b=/[\s,\(]\S/,vb={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},yb=function(e,t){return t.set(t.t,t.p,Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},bb=function(e,t){return t.set(t.t,t.p,1===e?t.e:Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},wb=function(e,t){return t.set(t.t,t.p,e?Math.round(1e4*(t.s+t.c*e))/1e4+t.u:t.b,t)},Tb=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},xb=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},Eb=function(e,t){return t.set(t.t,t.p,1!==e?t.b:t.e,t)},Pb=function(e,t,n){return e.style[t]=n},Ab=function(e,t,n){return e.style.setProperty(t,n)},Mb=function(e,t,n){return e._gsap[t]=n},Sb=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},Cb=function(e,t,n,i,r){var s=e._gsap;s.scaleX=s.scaleY=n,s.renderTransform(r,s)},Rb=function(e,t,n,i,r){var s=e._gsap;s[t]=n,s.renderTransform(r,s)},Ob="transform",kb=Ob+"Origin",Lb=function e(t,n){var i=this,r=this.target,s=r.style,o=r._gsap;if(t in ub&&s){if(this.tfm=this.tfm||{},"transform"===t)return vb.transform.split(",").forEach(function(t){return e.call(i,t,n)});if(~(t=vb[t]||t).indexOf(",")?t.split(",").forEach(function(e){return i.tfm[e]=Zb(r,e)}):this.tfm[t]=o.x?o[t]:Zb(r,t),t===kb&&(this.tfm.zOrigin=o.zOrigin),this.props.indexOf(Ob)>=0)return;o.svg&&(this.svgo=r.getAttribute("data-svg-origin"),this.props.push(kb,n,"")),t=Ob}(s||n)&&this.props.push(t,n,s[t])},Ib=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},Db=function(){var e,t,n=this.props,i=this.target,r=i.style,s=i._gsap;for(e=0;e<n.length;e+=3)n[e+1]?2===n[e+1]?i[n[e]](n[e+2]):i[n[e]]=n[e+2]:n[e+2]?r[n[e]]=n[e+2]:r.removeProperty("--"===n[e].substr(0,2)?n[e]:n[e].replace(fb,"-$1").toLowerCase());if(this.tfm){for(t in this.tfm)s[t]=this.tfm[t];s.svg&&(s.renderTransform(),i.setAttribute("data-svg-origin",this.svgo||"")),(!(e=lb())||!e.isStart)&&!r[Ob]&&(Ib(r),s.zOrigin&&r[kb]&&(r[kb]+=" "+s.zOrigin+"px",s.zOrigin=0,s.renderTransform()),s.uncache=1)}},Fb=function(e,t){var n={target:e,props:[],revert:Db,save:Lb};return e._gsap||tb.core.getCache(e),t&&e.style&&e.nodeType&&t.split(",").forEach(function(e){return n.save(e)}),n},Ub=function(e,t){var n=ib.createElementNS?ib.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):ib.createElement(e);return n&&n.style?n:ib.createElement(e)},Nb=function e(t,n,i){var r=getComputedStyle(t);return r[n]||r.getPropertyValue(n.replace(fb,"-$1").toLowerCase())||r.getPropertyValue(n)||!i&&e(t,zb(n)||n,1)||""},jb="O,Moz,ms,Ms,Webkit".split(","),zb=function(e,t,n){var i=(t||ob).style,r=5;if(e in i&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);r--&&!(jb[r]+e in i););return r<0?null:(3===r?"ms":r>=0?jb[r]:"")+e},Bb=function(){typeof window<"u"&&window.document&&(nb=window,ib=nb.document,rb=ib.documentElement,ob=Ub("div")||{style:{}},Ub("div"),Ob=zb(Ob),kb=Ob+"Origin",ob.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",cb=!!zb("perspective"),lb=tb.core.reverting,sb=1)},Vb=function(e){var t,n=e.ownerSVGElement,i=Ub("svg",n&&n.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),r=e.cloneNode(!0);r.style.display="block",i.appendChild(r),rb.appendChild(i);try{t=r.getBBox()}catch{}return i.removeChild(r),rb.removeChild(i),t},Hb=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},Gb=function(e){var t,n;try{t=e.getBBox()}catch{t=Vb(e),n=1}return t&&(t.width||t.height)||n||(t=Vb(e)),!t||t.width||t.x||t.y?t:{x:+Hb(e,["x","cx","x1"])||0,y:+Hb(e,["y","cy","y1"])||0,width:0,height:0}},Wb=function(e){return!(!e.getCTM||e.parentNode&&!e.ownerSVGElement||!Gb(e))},Kb=function(e,t){if(t){var n,i=e.style;t in ub&&t!==kb&&(t=Ob),i.removeProperty?(("ms"===(n=t.substr(0,2))||"webkit"===t.substr(0,6))&&(t="-"+t),i.removeProperty("--"===n?t:t.replace(fb,"-$1").toLowerCase())):i.removeAttribute(t)}},Xb=function(e,t,n,i,r,s){var o=new Vy(e._pt,t,n,0,1,s?Eb:xb);return e._pt=o,o.b=i,o.e=r,e._props.push(n),o},qb={deg:1,rad:1,turn:1},Yb={grid:1,flex:1},$b=function e(t,n,i,r){var s,o,a,l,c=parseFloat(i)||0,u=(i+"").trim().substr((c+"").length)||"px",h=ob.style,d=gb.test(n),p="svg"===t.tagName.toLowerCase(),m=(p?"client":"offset")+(d?"Width":"Height"),f=100,g="px"===r,_="%"===r;if(r===u||!c||qb[r]||qb[u])return c;if("px"!==u&&!g&&(c=e(t,n,i,"px")),l=t.getCTM&&Wb(t),(_||"%"===u)&&(ub[n]||~n.indexOf("adius")))return s=l?t.getBBox()[d?"width":"height"]:t[m],W_(_?c/s*f:c/100*s);if(h[d?"width":"height"]=f+(g?u:r),o="rem"!==r&&~n.indexOf("adius")||"em"===r&&t.appendChild&&!p?t:t.parentNode,l&&(o=(t.ownerSVGElement||{}).parentNode),(!o||o===ib||!o.appendChild)&&(o=ib.body),(a=o._gsap)&&_&&a.width&&d&&a.time===ny.time&&!a.uncache)return W_(c/a.width*f);if(!_||"height"!==n&&"width"!==n)(_||"%"===u)&&!Yb[Nb(o,"display")]&&(h.position=Nb(t,"position")),o===t&&(h.position="static"),o.appendChild(ob),s=ob[m],o.removeChild(ob),h.position="absolute";else{var v=t.style[n];t.style[n]=f+r,s=t[m],v?t.style[n]=v:Kb(t,n)}return d&&_&&((a=V_(o)).time=ny.time,a.width=o[m]),W_(g?s*c/f:s&&c?f/s*c:0)},Zb=function(e,t,n,i){var r;return sb||Bb(),t in vb&&"transform"!==t&&(~(t=vb[t]).indexOf(",")&&(t=t.split(",")[0])),ub[t]&&"transform"!==t?(r=cw(e,i),r="transformOrigin"!==t?r[t]:r.svg?r.origin:uw(Nb(e,kb))+" "+r.zOrigin+"px"):(!(r=e.style[t])||"auto"===r||i||~(r+"").indexOf("calc("))&&(r=nw[t]&&nw[t](e,t,n)||Nb(e,t)||H_(e,t)||("opacity"===t?1:0)),n&&!~(r+"").trim().indexOf(" ")?$b(e,t,r,n)+n:r},Qb=function(e,t,n,i){if(!n||"none"===n){var r=zb(t,e,1),s=r&&Nb(e,r,1);s&&s!==n?(t=r,n=s):"borderColor"===t&&(n=Nb(e,"borderTopColor"))}var o,a,l,c,u,h,d,p,m,f,g,_=new Vy(this._pt,e.style,t,0,1,Fy),v=0,y=0;if(_.b=n,_.e=i,n+="","var(--"===(i+="").substring(0,6)&&(i=Nb(e,i.substring(4,i.indexOf(")")))),"auto"===i&&(h=e.style[t],e.style[t]=i,i=Nb(e,t)||i,h?e.style[t]=h:Kb(e,t)),ty(o=[n,i]),i=o[1],l=(n=o[0]).match(v_)||[],(i.match(v_)||[]).length){for(;a=v_.exec(i);)d=a[0],m=i.substring(v,a.index),u?u=(u+1)%5:("rgba("===m.substr(-5)||"hsla("===m.substr(-5))&&(u=1),d!==(h=l[y++]||"")&&(c=parseFloat(h)||0,g=h.substr((c+"").length),"="===d.charAt(1)&&(d=X_(c,d)+g),p=parseFloat(d),f=d.substr((p+"").length),v=v_.lastIndex-f.length,f||(f=f||$g.units[t]||g,v===i.length&&(i+=f,_.e+=f)),g!==f&&(c=$b(e,t,h,f)||0),_._pt={_next:_._pt,p:m||1===y?m:",",s:c,c:p-c,m:u&&u<4||"zIndex"===t?Math.round:0});_.c=v<i.length?i.substring(v,i.length):""}else _.r="display"===t&&"none"===i?Eb:xb;return b_.test(i)&&(_.e=0),this._pt=_,_},Jb={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},ew=function(e){var t=e.split(" "),n=t[0],i=t[1]||"50%";return("top"===n||"bottom"===n||"left"===i||"right"===i)&&(e=n,n=i,i=e),t[0]=Jb[n]||n,t[1]=Jb[i]||i,t.join(" ")},tw=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n,i,r,s=t.t,o=s.style,a=t.u,l=s._gsap;if("all"===a||!0===a)o.cssText="",i=1;else for(r=(a=a.split(",")).length;--r>-1;)n=a[r],ub[n]&&(i=1,n="transformOrigin"===n?kb:Ob),Kb(s,n);i&&(Kb(s,Ob),l&&(l.svg&&s.removeAttribute("transform"),o.scale=o.rotate=o.translate="none",cw(s,1),l.uncache=1,Ib(o)))}},nw={clearProps:function(e,t,n,i,r){if("isFromStart"!==r.data){var s=e._pt=new Vy(e._pt,t,n,0,0,tw);return s.u=i,s.pr=-10,s.tween=r,e._props.push(n),1}}},iw=[1,0,0,1,0,0],rw={},sw=function(e){return"matrix(1, 0, 0, 1, 0, 0)"===e||"none"===e||!e},ow=function(e){var t=Nb(e,Ob);return sw(t)?iw:t.substr(7).match(__).map(W_)},aw=function(e,t){var n,i,r,s,o=e._gsap||V_(e),a=e.style,l=ow(e);return o.svg&&e.getAttribute("transform")?"1,0,0,1,0,0"===(l=[(r=e.transform.baseVal.consolidate().matrix).a,r.b,r.c,r.d,r.e,r.f]).join(",")?iw:l:(l===iw&&!e.offsetParent&&e!==rb&&!o.svg&&(r=a.display,a.display="block",(!(n=e.parentNode)||!e.offsetParent&&!e.getBoundingClientRect().width)&&(s=1,i=e.nextElementSibling,rb.appendChild(e)),l=ow(e),r?a.display=r:Kb(e,"display"),s&&(i?n.insertBefore(e,i):n?n.appendChild(e):rb.removeChild(e))),t&&l.length>6?[l[0],l[1],l[4],l[5],l[12],l[13]]:l)},lw=function(e,t,n,i,r,s){var o,a,l,c=e._gsap,u=r||aw(e,!0),h=c.xOrigin||0,d=c.yOrigin||0,p=c.xOffset||0,m=c.yOffset||0,f=u[0],g=u[1],_=u[2],v=u[3],y=u[4],b=u[5],w=t.split(" "),T=parseFloat(w[0])||0,x=parseFloat(w[1])||0;n?u!==iw&&(a=f*v-g*_)&&(l=T*(-g/a)+x*(f/a)-(f*b-g*y)/a,T=T*(v/a)+x*(-_/a)+(_*b-v*y)/a,x=l):(T=(o=Gb(e)).x+(~w[0].indexOf("%")?T/100*o.width:T),x=o.y+(~(w[1]||w[0]).indexOf("%")?x/100*o.height:x)),i||!1!==i&&c.smooth?(y=T-h,b=x-d,c.xOffset=p+(y*f+b*_)-y,c.yOffset=m+(y*g+b*v)-b):c.xOffset=c.yOffset=0,c.xOrigin=T,c.yOrigin=x,c.smooth=!!i,c.origin=t,c.originIsAbsolute=!!n,e.style[kb]="0px 0px",s&&(Xb(s,c,"xOrigin",h,T),Xb(s,c,"yOrigin",d,x),Xb(s,c,"xOffset",p,c.xOffset),Xb(s,c,"yOffset",m,c.yOffset)),e.setAttribute("data-svg-origin",T+" "+x)},cw=function(e,t){var n=e._gsap||new fy(e);if("x"in n&&!t&&!n.uncache)return n;var i,r,s,o,a,l,c,u,h,d,p,m,f,g,_,v,y,b,w,T,x,E,P,A,M,S,C,R,O,k,L,I,D=e.style,F=n.scaleX<0,U="px",N="deg",j=getComputedStyle(e),z=Nb(e,kb)||"0";return i=r=s=l=c=u=h=d=p=0,o=a=1,n.svg=!(!e.getCTM||!Wb(e)),j.translate&&(("none"!==j.translate||"none"!==j.scale||"none"!==j.rotate)&&(D[Ob]=("none"!==j.translate?"translate3d("+(j.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+("none"!==j.rotate?"rotate("+j.rotate+") ":"")+("none"!==j.scale?"scale("+j.scale.split(" ").join(",")+") ":"")+("none"!==j[Ob]?j[Ob]:"")),D.scale=D.rotate=D.translate="none"),g=aw(e,n.svg),n.svg&&(n.uncache?(M=e.getBBox(),z=n.xOrigin-M.x+"px "+(n.yOrigin-M.y)+"px",A=""):A=!t&&e.getAttribute("data-svg-origin"),lw(e,A||z,!!A||n.originIsAbsolute,!1!==n.smooth,g)),m=n.xOrigin||0,f=n.yOrigin||0,g!==iw&&(b=g[0],w=g[1],T=g[2],x=g[3],i=E=g[4],r=P=g[5],6===g.length?(o=Math.sqrt(b*b+w*w),a=Math.sqrt(x*x+T*T),l=b||w?pb(w,b)*hb:0,(h=T||x?pb(T,x)*hb+l:0)&&(a*=Math.abs(Math.cos(h*db))),n.svg&&(i-=m-(m*b+f*T),r-=f-(m*w+f*x))):(I=g[6],k=g[7],C=g[8],R=g[9],O=g[10],L=g[11],i=g[12],r=g[13],s=g[14],c=(_=pb(I,O))*hb,_&&(A=E*(v=Math.cos(-_))+C*(y=Math.sin(-_)),M=P*v+R*y,S=I*v+O*y,C=E*-y+C*v,R=P*-y+R*v,O=I*-y+O*v,L=k*-y+L*v,E=A,P=M,I=S),u=(_=pb(-T,O))*hb,_&&(v=Math.cos(-_),L=x*(y=Math.sin(-_))+L*v,b=A=b*v-C*y,w=M=w*v-R*y,T=S=T*v-O*y),l=(_=pb(w,b))*hb,_&&(A=b*(v=Math.cos(_))+w*(y=Math.sin(_)),M=E*v+P*y,w=w*v-b*y,P=P*v-E*y,b=A,E=M),c&&Math.abs(c)+Math.abs(l)>359.9&&(c=l=0,u=180-u),o=W_(Math.sqrt(b*b+w*w+T*T)),a=W_(Math.sqrt(P*P+I*I)),_=pb(E,P),h=Math.abs(_)>2e-4?_*hb:0,p=L?1/(L<0?-L:L):0),n.svg&&(A=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!sw(Nb(e,Ob)),A&&e.setAttribute("transform",A))),Math.abs(h)>90&&Math.abs(h)<270&&(F?(o*=-1,h+=l<=0?180:-180,l+=l<=0?180:-180):(a*=-1,h+=h<=0?180:-180)),t=t||n.uncache,n.x=i-((n.xPercent=i&&(!t&&n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-i)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+U,n.y=r-((n.yPercent=r&&(!t&&n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-r)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+U,n.z=s+U,n.scaleX=W_(o),n.scaleY=W_(a),n.rotation=W_(l)+N,n.rotationX=W_(c)+N,n.rotationY=W_(u)+N,n.skewX=h+N,n.skewY=d+N,n.transformPerspective=p+U,(n.zOrigin=parseFloat(z.split(" ")[2])||!t&&n.zOrigin||0)&&(D[kb]=uw(z)),n.xOffset=n.yOffset=0,n.force3D=$g.force3D,n.renderTransform=n.svg?_w:cb?gw:dw,n.uncache=0,n},uw=function(e){return(e=e.split(" "))[0]+" "+e[1]},hw=function(e,t,n){var i=Cv(t);return W_(parseFloat(t)+parseFloat($b(e,"x",n+"px",i)))+i},dw=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,gw(e,t)},pw="0deg",mw="0px",fw=") ",gw=function(e,t){var n=t||this,i=n.xPercent,r=n.yPercent,s=n.x,o=n.y,a=n.z,l=n.rotation,c=n.rotationY,u=n.rotationX,h=n.skewX,d=n.skewY,p=n.scaleX,m=n.scaleY,f=n.transformPerspective,g=n.force3D,_=n.target,v=n.zOrigin,y="",b="auto"===g&&e&&1!==e||!0===g;if(v&&(u!==pw||c!==pw)){var w,T=parseFloat(c)*db,x=Math.sin(T),E=Math.cos(T);T=parseFloat(u)*db,w=Math.cos(T),s=hw(_,s,x*w*-v),o=hw(_,o,-Math.sin(T)*-v),a=hw(_,a,E*w*-v+v)}f!==mw&&(y+="perspective("+f+fw),(i||r)&&(y+="translate("+i+"%, "+r+"%) "),(b||s!==mw||o!==mw||a!==mw)&&(y+=a!==mw||b?"translate3d("+s+", "+o+", "+a+") ":"translate("+s+", "+o+fw),l!==pw&&(y+="rotate("+l+fw),c!==pw&&(y+="rotateY("+c+fw),u!==pw&&(y+="rotateX("+u+fw),(h!==pw||d!==pw)&&(y+="skew("+h+", "+d+fw),(1!==p||1!==m)&&(y+="scale("+p+", "+m+fw),_.style[Ob]=y||"translate(0, 0)"},_w=function(e,t){var n,i,r,s,o,a=t||this,l=a.xPercent,c=a.yPercent,u=a.x,h=a.y,d=a.rotation,p=a.skewX,m=a.skewY,f=a.scaleX,g=a.scaleY,_=a.target,v=a.xOrigin,y=a.yOrigin,b=a.xOffset,w=a.yOffset,T=a.forceCSS,x=parseFloat(u),E=parseFloat(h);d=parseFloat(d),p=parseFloat(p),(m=parseFloat(m))&&(p+=m=parseFloat(m),d+=m),d||p?(d*=db,p*=db,n=Math.cos(d)*f,i=Math.sin(d)*f,r=Math.sin(d-p)*-g,s=Math.cos(d-p)*g,p&&(m*=db,o=Math.tan(p-m),r*=o=Math.sqrt(1+o*o),s*=o,m&&(o=Math.tan(m),n*=o=Math.sqrt(1+o*o),i*=o)),n=W_(n),i=W_(i),r=W_(r),s=W_(s)):(n=f,s=g,i=r=0),(x&&!~(u+"").indexOf("px")||E&&!~(h+"").indexOf("px"))&&(x=$b(_,"x",u,"px"),E=$b(_,"y",h,"px")),(v||y||b||w)&&(x=W_(x+v-(v*n+y*r)+b),E=W_(E+y-(v*i+y*s)+w)),(l||c)&&(o=_.getBBox(),x=W_(x+l/100*o.width),E=W_(E+c/100*o.height)),o="matrix("+n+","+i+","+r+","+s+","+x+","+E+")",_.setAttribute("transform",o),T&&(_.style[Ob]=o)},vw=function(e,t,n,i,r){var s,o,a=360,l=o_(r),c=parseFloat(r)*(l&&~r.indexOf("rad")?hb:1)-i,u=i+c+"deg";return l&&("short"===(s=r.split("_")[1])&&((c%=a)!==c%180&&(c+=c<0?a:-a)),"cw"===s&&c<0?c=(c+a*mb)%a-~~(c/a)*a:"ccw"===s&&c>0&&(c=(c-a*mb)%a-~~(c/a)*a)),e._pt=o=new Vy(e._pt,t,n,i,c,bb),o.e=u,o.u="deg",e._props.push(n),o},yw=function(e,t){for(var n in t)e[n]=t[n];return e},bw=function(e,t,n){var i,r,s,o,a,l,c,u=yw({},n._gsap),h=n.style;for(r in u.svg?(s=n.getAttribute("transform"),n.setAttribute("transform",""),h[Ob]=t,i=cw(n,1),Kb(n,Ob),n.setAttribute("transform",s)):(s=getComputedStyle(n)[Ob],h[Ob]=t,i=cw(n,1),h[Ob]=s),ub)(s=u[r])!==(o=i[r])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(r)<0&&(a=Cv(s)!==(c=Cv(o))?$b(n,r,s,c):parseFloat(s),l=parseFloat(o),e._pt=new Vy(e._pt,i,r,a,l-a,yb),e._pt.u=c||0,e._props.push(r));yw(i,u)};G_("padding,margin,Width,Radius",function(e,t){var n="Top",i="Right",r="Bottom",s="Left",o=(t<3?[n,i,r,s]:[n+s,n+i,r+i,r+s]).map(function(n){return t<2?e+n:"border"+n+e});nw[t>1?"border"+e:e]=function(e,t,n,i,r){var s,a;if(arguments.length<4)return s=o.map(function(t){return Zb(e,t,n)}),5===(a=s.join(" ")).split(s[0]).length?s[0]:a;s=(i+"").split(" "),a={},o.forEach(function(e,t){return a[e]=s[t]=s[t]||s[(t-1)/2|0]}),e.init(t,a,r)}});var ww={name:"css",register:Bb,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,i,r){var s,o,a,l,c,u,h,d,p,m,f,g,_,v,y,b,w=this._props,T=e.style,x=n.vars.startAt;for(h in sb||Bb(),this.styles=this.styles||Fb(e),b=this.styles.props,this.tween=n,t)if("autoRound"!==h&&(o=t[h],!F_[h]||!Ty(h,t,n,i,e,r)))if(c=typeof o,u=nw[h],"function"===c&&(c=typeof(o=o.call(n,i,e,r))),"string"===c&&~o.indexOf("random(")&&(o=zv(o)),u)u(this,e,h,o,n)&&(y=1);else if("--"===h.substr(0,2))s=(getComputedStyle(e).getPropertyValue(h)+"").trim(),o+="",Jv.lastIndex=0,Jv.test(s)||(d=Cv(s),p=Cv(o)),p?d!==p&&(s=$b(e,h,s,p)+p):d&&(o+=d),this.add(T,"setProperty",s,o,i,r,0,0,h),w.push(h),b.push(h,0,T[h]);else if("undefined"!==c){if(x&&h in x?(s="function"==typeof x[h]?x[h].call(n,i,e,r):x[h],o_(s)&&~s.indexOf("random(")&&(s=zv(s)),Cv(s+"")||"auto"===s||(s+=$g.units[h]||Cv(Zb(e,h))||""),"="===(s+"").charAt(1)&&(s=Zb(e,h))):s=Zb(e,h),l=parseFloat(s),(m="string"===c&&"="===o.charAt(1)&&o.substr(0,2))&&(o=o.substr(2)),a=parseFloat(o),h in vb&&("autoAlpha"===h&&(1===l&&"hidden"===Zb(e,"visibility")&&a&&(l=0),b.push("visibility",0,T.visibility),Xb(this,T,"visibility",l?"inherit":"hidden",a?"inherit":"hidden",!a)),"scale"!==h&&"transform"!==h&&(~(h=vb[h]).indexOf(",")&&(h=h.split(",")[0]))),f=h in ub)if(this.styles.save(h),"string"===c&&"var(--"===o.substring(0,6)&&(o=Nb(e,o.substring(4,o.indexOf(")"))),a=parseFloat(o)),g||((_=e._gsap).renderTransform&&!t.parseTransform||cw(e,t.parseTransform),v=!1!==t.smoothOrigin&&_.smooth,(g=this._pt=new Vy(this._pt,T,Ob,0,1,_.renderTransform,_,0,-1)).dep=1),"scale"===h)this._pt=new Vy(this._pt,_,"scaleY",_.scaleY,(m?X_(_.scaleY,m+a):a)-_.scaleY||0,yb),this._pt.u=0,w.push("scaleY",h),h+="X";else{if("transformOrigin"===h){b.push(kb,0,T[kb]),o=ew(o),_.svg?lw(e,o,0,v,0,this):((p=parseFloat(o.split(" ")[2])||0)!==_.zOrigin&&Xb(this,_,"zOrigin",_.zOrigin,p),Xb(this,T,h,uw(s),uw(o)));continue}if("svgOrigin"===h){lw(e,o,1,v,0,this);continue}if(h in rw){vw(this,_,h,l,m?X_(l,m+o):o);continue}if("smoothOrigin"===h){Xb(this,_,"smooth",_.smooth,o);continue}if("force3D"===h){_[h]=o;continue}if("transform"===h){bw(this,o,e);continue}}else h in T||(h=zb(h)||h);if(f||(a||0===a)&&(l||0===l)&&!_b.test(o)&&h in T)a||(a=0),(d=(s+"").substr((l+"").length))!==(p=Cv(o)||(h in $g.units?$g.units[h]:d))&&(l=$b(e,h,s,p)),this._pt=new Vy(this._pt,f?_:T,h,l,(m?X_(l,m+a):a)-l,f||"px"!==p&&"zIndex"!==h||!1===t.autoRound?yb:Tb),this._pt.u=p||0,d!==p&&"%"!==p&&(this._pt.b=s,this._pt.r=wb);else if(h in T)Qb.call(this,e,h,s,m?m+o:o);else if(h in e)this.add(e,h,s||e[h],m?m+o:o,i,r);else if("parseTransform"!==h){A_(h,o);continue}f||(h in T?b.push(h,0,T[h]):"function"==typeof e[h]?b.push(h,2,e[h]()):b.push(h,1,s||e[h])),w.push(h)}y&&By(this)},render:function(e,t){if(t.tween._time||!lb())for(var n=t._pt;n;)n.r(e,n.d),n=n._next;else t.styles.revert()},get:Zb,aliases:vb,getSetter:function(e,t,n){var i=vb[t];return i&&i.indexOf(",")<0&&(t=i),t in ub&&t!==kb&&(e._gsap.x||Zb(e,"x"))?n&&ab===n?"scale"===t?Sb:Mb:(ab=n||{})&&("scale"===t?Cb:Rb):e.style&&!c_(e.style[t])?Pb:~t.indexOf("-")?Ab:Ly(e,t)},core:{_removeProperty:Kb,_getMatrix:aw}};tb.utils.checkPrefix=zb,tb.core.getStyleSaver=Fb,function(e,t){var n=G_(e+","+t+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",function(e){ub[e]=1});G_(t,function(e){$g.units[e]="deg",rw[e]=1}),vb[n[13]]=e+","+t,G_("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",function(e){var t=e.split(":");vb[t[1]]=n[t[0]]})}("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY"),G_("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(e){$g.units[e]="px"}),tb.registerPlugin(ww);var Tw=tb.registerPlugin(ww)||tb;Tw.core.Tween;const xw={linear:"none",easeInQuad:"power2.in",easeOutQuad:"power2.out"};class Ew{constructor(e,t,n={}){this.target=e,this.toVars=t,this.config=n}tween=null;start(){return new Promise(e=>{this.tween&&this.tween.kill();const{duration:t=.5,easing:n=xw.linear,delay:i=0,repeat:r=0,yoyo:s=!1,onStart:o,onUpdate:a,onComplete:l,onPause:c,onResume:u}=this.config;this.tween=Tw.to(this.target.scale,{...this.toVars,duration:t,ease:n,delay:i,repeat:r,yoyo:s,onStart:()=>{o?.()},onUpdate:()=>{this.target.updateMatrixWorld(!0);const e=this.tween?.progress()||0;a?.(e,this.target)},onComplete:()=>{l?.(),e()},onPause:()=>{c?.()},onResume:()=>{u?.()}})})}stop(){this.tween&&(this.tween.kill(),this.tween=null)}isRunning(){return!!this.tween&&this.tween.isActive()}pause(){this.tween&&this.tween.pause()}resume(){this.tween&&this.tween.resume()}progress(e){return this.tween?void 0!==e?(this.tween.progress(e),e):this.tween.progress():0}}function Pw(e,t,n,i={}){return function(e,t,n,i={}){return e.scale.copy(t),new Ew(e,{x:n.x,y:n.y,z:n.z},i)}(e,new Ca.Vector3(1,t,1),new Ca.Vector3(1,n,1),i)}class Aw{animations=new Map;timeline=null;constructor(){this.timeline=Tw.timeline()}async startAnimation(e,t,n=!0){n&&this.animations.has(e)&&this.stopAnimation(e),this.animations.set(e,t);try{await t.start()}finally{this.animations.delete(e)}}stopAnimation(e){const t=this.animations.get(e);t&&(t.stop(),this.animations.delete(e))}pauseAnimation(e){const t=this.animations.get(e);t&&t.pause()}resumeAnimation(e){const t=this.animations.get(e);t&&t.resume()}setAnimationProgress(e,t){const n=this.animations.get(e);n&&n.progress(t)}stopAllAnimations(){this.animations.forEach(e=>e.stop()),this.animations.clear()}pauseAllAnimations(){this.animations.forEach(e=>e.pause())}resumeAllAnimations(){this.animations.forEach(e=>e.resume())}isAnimationRunning(e){const t=this.animations.get(e);return!!t&&t.isRunning()}getRunningAnimationsCount(){return Array.from(this.animations.values()).filter(e=>e.isRunning()).length}getAnimationKeys(){return Array.from(this.animations.keys())}cleanup(){this.stopAllAnimations(),this.timeline&&(this.timeline.kill(),this.timeline=null)}}new Aw;const Mw={easing:xw.easeOutQuad,duration:.3},Sw={easing:xw.easeInQuad,duration:.2},Cw=["object"],Rw=Jo({__name:"Tileset",props:{url:{}},setup(e,{expose:t}){const n=e,{camera:i,renderer:r}=_i();let s=ba(new Mm(n.url));s.fetchOptions.mode="cors",s.lruCache.minSize=900,s.lruCache.maxSize=1300,s.errorTarget=12,s.registerPlugin(new Lg),s.getPluginByName("DEBUG_TILES_PLUGIN").displayBoxBounds=!0;const o=new Aw;function a(e){return`tile_${e.uuid}`}ta(i,()=>{i.value&&(s.setCamera(i.value),s.setResolutionFromRenderer(i.value,r))},{immediate:!0}),s.addEventListener("load-model",({scene:e})=>{e.traverse(e=>{if(e.material){const t=e;Array.isArray(t.material)?t.material.forEach(e=>{e.side=Ca.DoubleSide}):t.material.side=Ca.DoubleSide}})}),((e,t)=>{e.addEventListener("tile-visibility-change",({tile:e,visible:n})=>{const i=e.cached.scene;n&&t(i,e)})})(s,async(e,t)=>{if(e){const t=e.children[0],n=a(t),i=Pw(t,0,1,{...Mw,duration:.2});await o.startAnimation(n,i,!0)}}),((e,t)=>{e.addEventListener("tile-visibility-change",({tile:n,visible:i})=>{const r=n.cached.scene,s=e.group;i||(r&&(s.add(r),r.updateMatrixWorld(!0)),t(r,n).then(()=>{r&&s.remove(r)}))})})(s,async(e,t)=>{if(e){const t=e.children[0],n=a(t),i=Pw(t,1,0,{...Sw,duration:.2});await o.startAnimation(n,i,!0)}});const{onBeforeRender:l}=vi();return l(()=>{s.update()}),ia(()=>{console.log("清理动画管理器"),o.cleanup()}),t({animationManager:o,pauseAllAnimations:()=>o.pauseAllAnimations(),resumeAllAnimations:()=>o.resumeAllAnimations(),stopAllAnimations:()=>o.stopAllAnimations(),getRunningAnimationsCount:()=>o.getRunningAnimationsCount(),getAnimationKeys:()=>o.getAnimationKeys()}),(e,t)=>oa(s)?(sa(),ra("primitive",{key:0,object:oa(s)?.group},null,8,Cw)):ma("",!0)}}),Ow=parseInt(hc.replace(/\D+/g,""));function kw(e,t){if(t===el)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===tl||t===nl){let n=e.getIndex();if(null===n){const t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const i=n.count-2,r=[];if(n)if(t===tl)for(let e=1;e<=i;e++)r.push(n.getX(0)),r.push(n.getX(e)),r.push(n.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(r.push(n.getX(e)),r.push(n.getX(e+1)),r.push(n.getX(e+2))):(r.push(n.getX(e+2)),r.push(n.getX(e+1)),r.push(n.getX(e)));r.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=e.clone();return s.setIndex(r),s.clearGroups(),s}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}function Lw(e){if(typeof TextDecoder<"u")return(new TextDecoder).decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}}const Iw="srgb",Dw="srgb-linear";class Fw extends il{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new Vw(e)}),this.register(function(e){return new Hw(e)}),this.register(function(e){return new Qw(e)}),this.register(function(e){return new Jw(e)}),this.register(function(e){return new eT(e)}),this.register(function(e){return new Ww(e)}),this.register(function(e){return new Kw(e)}),this.register(function(e){return new Xw(e)}),this.register(function(e){return new qw(e)}),this.register(function(e){return new Bw(e)}),this.register(function(e){return new Yw(e)}),this.register(function(e){return new Gw(e)}),this.register(function(e){return new Zw(e)}),this.register(function(e){return new $w(e)}),this.register(function(e){return new jw(e)}),this.register(function(e){return new tT(e)}),this.register(function(e){return new nT(e)})}load(e,t,n,i){const r=this;let s;if(""!==this.resourcePath)s=this.resourcePath;else if(""!==this.path){const t=rl.extractUrlBase(e);s=rl.resolveURL(t,this.path)}else s=rl.extractUrlBase(e);this.manager.itemStart(e);const o=function(t){i?i(t):console.error(t),r.manager.itemError(e),r.manager.itemEnd(e)},a=new sl(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(n){try{r.parse(n,s,function(n){t(n),r.manager.itemEnd(e)},o)}catch(i){o(i)}},n,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let r;const s={},o={};if("string"==typeof e)r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(Lw(new Uint8Array(e.slice(0,4)))===iT){try{s[Nw.KHR_BINARY_GLTF]=new oT(e)}catch(l){return void(i&&i(l))}r=JSON.parse(s[Nw.KHR_BINARY_GLTF].content)}else r=JSON.parse(Lw(new Uint8Array(e)));else r=e;if(void 0===r.asset||r.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const a=new kT(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});a.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const e=this.pluginCallbacks[c](a);e.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[e.name]=e,s[e.name]=!0}if(r.extensionsUsed)for(let c=0;c<r.extensionsUsed.length;++c){const e=r.extensionsUsed[c],t=r.extensionsRequired||[];switch(e){case Nw.KHR_MATERIALS_UNLIT:s[e]=new zw;break;case Nw.KHR_DRACO_MESH_COMPRESSION:s[e]=new aT(r,this.dracoLoader);break;case Nw.KHR_TEXTURE_TRANSFORM:s[e]=new lT;break;case Nw.KHR_MESH_QUANTIZATION:s[e]=new cT;break;default:t.indexOf(e)>=0&&void 0===o[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}a.setExtensions(s),a.setPlugins(o),a.parse(n,i)}parseAsync(e,t){const n=this;return new Promise(function(i,r){n.parse(e,t,i,r)})}}function Uw(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const Nw={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class jw{constructor(e){this.parser=e,this.name=Nw.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const i=t[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const r=t.json,s=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let o;const a=new Ha(16777215);void 0!==s.color&&a.setRGB(s.color[0],s.color[1],s.color[2],Dw);const l=void 0!==s.range?s.range:0;switch(s.type){case"directional":o=new hl(a),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new ul(a),o.distance=l;break;case"spot":o=new cl(a),o.distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,o.angle=s.spot.outerConeAngle,o.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return o.position.set(0,0,0),o.decay=2,AT(o,s),void 0!==s.intensity&&(o.intensity=s.intensity),o.name=t.createUniqueName(s.name||"light_"+e),i=Promise.resolve(o),t.cache.add(n,i),i}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,i=n.json.nodes[e],r=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then(function(e){return n._getNodeRef(t.cache,r,e)})}}class zw{constructor(){this.name=Nw.KHR_MATERIALS_UNLIT}getMaterialType(){return Ya}extendParams(e,t,n){const i=[];e.color=new Ha(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const t=r.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],Dw),e.opacity=t[3]}void 0!==r.baseColorTexture&&i.push(n.assignTexture(e,"map",r.baseColorTexture,Iw))}return Promise.all(i)}}class Bw{constructor(e){this.parser=e,this.name=Nw.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return void 0!==i&&(t.emissiveIntensity=i),Promise.resolve()}}class Vw{constructor(e){this.parser=e,this.name=Nw.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ol:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];if(void 0!==s.clearcoatFactor&&(t.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&r.push(n.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(r.push(n.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){const e=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Oa(e,e)}return Promise.all(r)}}class Hw{constructor(e){this.parser=e,this.name=Nw.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ol:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.dispersion=void 0!==i.dispersion?i.dispersion:0,Promise.resolve()}}class Gw{constructor(e){this.parser=e,this.name=Nw.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ol:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.iridescenceFactor&&(t.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&r.push(n.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(t.iridescenceIOR=s.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&r.push(n.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(r)}}class Ww{constructor(e){this.parser=e,this.name=Nw.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ol:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new Ha(0,0,0),t.sheenRoughness=0,t.sheen=1;const s=i.extensions[this.name];if(void 0!==s.sheenColorFactor){const e=s.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],Dw)}return void 0!==s.sheenRoughnessFactor&&(t.sheenRoughness=s.sheenRoughnessFactor),void 0!==s.sheenColorTexture&&r.push(n.assignTexture(t,"sheenColorMap",s.sheenColorTexture,Iw)),void 0!==s.sheenRoughnessTexture&&r.push(n.assignTexture(t,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(r)}}class Kw{constructor(e){this.parser=e,this.name=Nw.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ol:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&r.push(n.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(r)}}class Xw{constructor(e){this.parser=e,this.name=Nw.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ol:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];t.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&r.push(n.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||1/0;const o=s.attenuationColor||[1,1,1];return t.attenuationColor=(new Ha).setRGB(o[0],o[1],o[2],Dw),Promise.all(r)}}class qw{constructor(e){this.parser=e,this.name=Nw.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ol:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}class Yw{constructor(e){this.parser=e,this.name=Nw.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ol:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];t.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&r.push(n.assignTexture(t,"specularIntensityMap",s.specularTexture));const o=s.specularColorFactor||[1,1,1];return t.specularColor=(new Ha).setRGB(o[0],o[1],o[2],Dw),void 0!==s.specularColorTexture&&r.push(n.assignTexture(t,"specularColorMap",s.specularColorTexture,Iw)),Promise.all(r)}}class $w{constructor(e){this.parser=e,this.name=Nw.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ol:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return t.bumpScale=void 0!==s.bumpFactor?s.bumpFactor:1,void 0!==s.bumpTexture&&r.push(n.assignTexture(t,"bumpMap",s.bumpTexture)),Promise.all(r)}}class Zw{constructor(e){this.parser=e,this.name=Nw.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ol:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.anisotropyStrength&&(t.anisotropy=s.anisotropyStrength),void 0!==s.anisotropyRotation&&(t.anisotropyRotation=s.anisotropyRotation),void 0!==s.anisotropyTexture&&r.push(n.assignTexture(t,"anisotropyMap",s.anisotropyTexture)),Promise.all(r)}}class Qw{constructor(e){this.parser=e,this.name=Nw.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const r=i.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,s)}}class Jw{constructor(e){this.parser=e,this.name=Nw.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;const s=r.extensions[t],o=i.images[s.source];let a=n.textureLoader;if(o.uri){const e=n.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then(function(r){if(r)return n.loadTextureImage(e,s.source,a);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class eT{constructor(e){this.parser=e,this.name=Nw.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;const s=r.extensions[t],o=i.images[s.source];let a=n.textureLoader;if(o.uri){const e=n.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then(function(r){if(r)return n.loadTextureImage(e,s.source,a);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class tT{constructor(e){this.name=Nw.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],i=this.parser.getDependency("buffer",e.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(t){const n=e.byteOffset||0,i=e.byteLength||0,s=e.count,o=e.byteStride,a=new Uint8Array(t,n,i);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(s,o,a,e.mode,e.filter).then(function(e){return e.buffer}):r.ready.then(function(){const t=new ArrayBuffer(s*o);return r.decodeGltfBuffer(new Uint8Array(t),s,o,a,e.mode,e.filter),t})})}return null}}class nT{constructor(e){this.name=Nw.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;const i=t.meshes[n.mesh];for(const a of i.primitives)if(a.mode!==pT.TRIANGLES&&a.mode!==pT.TRIANGLE_STRIP&&a.mode!==pT.TRIANGLE_FAN&&void 0!==a.mode)return null;const r=n.extensions[this.name].attributes,s=[],o={};for(const a in r)s.push(this.parser.getDependency("accessor",r[a]).then(e=>(o[a]=e,o[a])));return s.length<1?null:(s.push(this.parser.createNodeMesh(e)),Promise.all(s).then(e=>{const t=e.pop(),n=t.isGroup?t.children:[t],i=e[0].count,r=[];for(const s of n){const e=new La,t=new ka,n=new Da,a=new ka(1,1,1),l=new dl(s.geometry,s.material,i);for(let r=0;r<i;r++)o.TRANSLATION&&t.fromBufferAttribute(o.TRANSLATION,r),o.ROTATION&&n.fromBufferAttribute(o.ROTATION,r),o.SCALE&&a.fromBufferAttribute(o.SCALE,r),l.setMatrixAt(r,e.compose(t,n,a));for(const i in o)if("_COLOR_0"===i){const e=o[i];l.instanceColor=new pl(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==i&&"ROTATION"!==i&&"SCALE"!==i&&s.geometry.setAttribute(i,o[i]);Ra.prototype.copy.call(l,s),this.parser.assignFinalMaterial(l),r.push(l)}return t.isGroup?(t.clear(),t.add(...r),t):r[0]}))}}const iT="glTF",rT=1313821514,sT=5130562;class oT{constructor(e){this.name=Nw.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:Lw(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==iT)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,i=new DataView(e,12);let r=0;for(;r<n;){const t=i.getUint32(r,!0);r+=4;const n=i.getUint32(r,!0);if(r+=4,n===rT){const n=new Uint8Array(e,12+r,t);this.content=Lw(n)}else if(n===sT){const n=12+r;this.body=e.slice(n,n+t)}r+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class aT{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Nw.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,o={},a={},l={};for(const c in s){const e=vT[c]||c.toLowerCase();o[e]=s[c]}for(const c in e.attributes){const t=vT[c]||c.toLowerCase();if(void 0!==s[c]){const i=n.accessors[e.attributes[c]],r=mT[i.componentType];l[t]=r.name,a[t]=!0===i.normalized}}return t.getDependency("bufferView",r).then(function(e){return new Promise(function(t,n){i.decodeDracoFile(e,function(e){for(const t in e.attributes){const n=e.attributes[t],i=a[t];void 0!==i&&(n.normalized=i)}t(e)},o,l,Dw,n)})})}}class lT{constructor(){this.name=Nw.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(void 0===t.texCoord||t.texCoord===e.channel)&&void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class cT{constructor(){this.name=Nw.KHR_MESH_QUANTIZATION}}class uT extends Wl{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i*3+i;for(let s=0;s!==i;s++)t[s]=n[r+s];return t}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,c=i-t,u=(n-t)/c,h=u*u,d=h*u,p=e*l,m=p-l,f=-2*d+3*h,g=d-h,_=1-f,v=g-h+u;for(let y=0;y!==o;y++){const e=s[m+y+o],t=s[m+y+a]*c,n=s[p+y+o],i=s[p+y]*c;r[y]=_*e+v*t+f*n+g*i}return r}}const hT=new Da;class dT extends uT{interpolate_(e,t,n,i){const r=super.interpolate_(e,t,n,i);return hT.fromArray(r).normalize().toArray(r),r}}const pT={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},mT={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},fT={9728:Tl,9729:wl,9984:bl,9985:yl,9986:vl,9987:_l},gT={33071:Pl,33648:El,10497:xl},_T={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},vT={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...Ow>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},yT={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},bT={CUBICSPLINE:void 0,LINEAR:Nl,STEP:Ul},wT="OPAQUE",TT="MASK",xT="BLEND";function ET(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new Ml({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Gl})),e.DefaultMaterial}function PT(e,t,n){for(const i in n.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=n.extensions[i])}function AT(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function MT(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,i=t.weights.length;n<i;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,i=n.length;t<i;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ST(e){let t;const n=e.extensions&&e.extensions[Nw.KHR_DRACO_MESH_COMPRESSION];if(t=n?"draco:"+n.bufferView+":"+n.indices+":"+CT(n.attributes):e.indices+":"+CT(e.attributes)+":"+e.mode,void 0!==e.targets)for(let i=0,r=e.targets.length;i<r;i++)t+=":"+CT(e.targets[i]);return t}function CT(e){let t="";const n=Object.keys(e).sort();for(let i=0,r=n.length;i<r;i++)t+=n[i]+":"+e[n[i]]+";";return t}function RT(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const OT=new La;class kT{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Uw,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,i=!1,r=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(n=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),i=navigator.userAgent.indexOf("Firefox")>-1,r=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||i&&r<98?this.textureLoader=new ja(this.options.manager):this.textureLoader=new ml(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new sl(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(t){const s={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:n,userData:{}};return PT(r,s,i),AT(s,i),Promise.all(n._invokeAll(function(e){return e.afterRoot&&e.afterRoot(s)})).then(function(){for(const e of s.scenes)e.updateMatrixWorld();e(s)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let i=0,r=t.length;i<r;i++){const n=t[i].joints;for(let t=0,i=n.length;t<i;t++)e[n[t]].isBone=!0}for(let i=0,r=e.length;i<r;i++){const t=e[i];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(n[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),r=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[i,s]of e.children.entries())r(s,t.children[i])};return r(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const r=e(t[i]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(e){return e.loadNode&&e.loadNode(t)});break;case"mesh":i=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map(function(t,i){return n.getDependency(e,i)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[Nw.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(e,r){n.load(rl.resolveURL(t.uri,i.path),e,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){const n=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+n)})}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse){const e=_T[i.type],t=mT[i.componentType],n=!0===i.normalized,r=new t(i.count*e);return Promise.resolve(new Qa(r,e,n))}const r=[];return void 0!==i.bufferView?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),void 0!==i.sparse&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then(function(e){const r=e[0],s=_T[i.type],o=mT[i.componentType],a=o.BYTES_PER_ELEMENT,l=a*s,c=i.byteOffset||0,u=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,h=!0===i.normalized;let d,p;if(u&&u!==l){const e=Math.floor(c/u),n="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count;let l=t.cache.get(n);l||(d=new o(r,e*u,i.count*u/a),l=new fl(d,u/a),t.cache.add(n,l)),p=new gl(l,s,c%u/a,h)}else d=null===r?new o(i.count*s):new o(r,c,i.count*s),p=new Qa(d,s,h);if(void 0!==i.sparse){const t=_T.SCALAR,n=mT[i.sparse.indices.componentType],a=i.sparse.indices.byteOffset||0,l=i.sparse.values.byteOffset||0,c=new n(e[1],a,i.sparse.count*t),u=new o(e[2],l,i.sparse.count*s);null!==r&&(p=new Qa(p.array.slice(),p.itemSize,p.normalized));for(let e=0,i=c.length;e<i;e++){const t=c[e];if(p.setX(t,u[e*s]),s>=2&&p.setY(t,u[e*s+1]),s>=3&&p.setZ(t,u[e*s+2]),s>=4&&p.setW(t,u[e*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p})}loadTexture(e){const t=this.json,n=this.options,i=t.textures[e].source,r=t.images[i];let s=this.textureLoader;if(r.uri){const e=n.manager.getHandler(r.uri);null!==e&&(s=e)}return this.loadTextureImage(e,i,s)}loadTextureImage(e,t,n){const i=this,r=this.json,s=r.textures[e],o=r.images[t],a=(o.uri||o.bufferView)+":"+s.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(t,n).then(function(t){t.flipY=!1,t.name=s.name||o.name||"",""===t.name&&"string"==typeof o.uri&&!1===o.uri.startsWith("data:image/")&&(t.name=o.uri);const n=(r.samplers||{})[s.sampler]||{};return t.magFilter=fT[n.magFilter]||wl,t.minFilter=fT[n.minFilter]||_l,t.wrapS=gT[n.wrapS]||xl,t.wrapT=gT[n.wrapT]||xl,i.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[a]=l,l}loadImageSource(e,t){const n=this.json,i=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());const r=n.images[e],s=self.URL||self.webkitURL;let o=r.uri||"",a=!1;if(void 0!==r.bufferView)o=this.getDependency("bufferView",r.bufferView).then(function(e){a=!0;const t=new Blob([e],{type:r.mimeType});return o=s.createObjectURL(t),o});else if(void 0===r.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const l=Promise.resolve(o).then(function(e){return new Promise(function(n,r){let s=n;!0===t.isImageBitmapLoader&&(s=function(e){const t=new jl(e);t.needsUpdate=!0,n(t)}),t.load(rl.resolveURL(e,i.path),s,void 0,r)})}).then(function(e){return!0===a&&s.revokeObjectURL(o),AT(e,r),e.userData.mimeType=r.mimeType||((t=r.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e;var t}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),e});return this.sourceCache[e]=l,l}assignTexture(e,t,n,i){const r=this;return this.getDependency("texture",n.index).then(function(s){if(!s)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((s=s.clone()).channel=n.texCoord),r.extensions[Nw.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[Nw.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=r.associations.get(s);s=r.extensions[Nw.KHR_TEXTURE_TRANSFORM].extendTexture(s,e),r.associations.set(s,t)}}return void 0!==i&&("number"==typeof i&&(i=3001===i?Iw:Dw),"colorSpace"in s?s.colorSpace=i:s.encoding=i===Iw?3001:3e3),e[t]=s,s})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=void 0===t.attributes.tangent,r=void 0!==t.attributes.color,s=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new Na,Al.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new Ga,Al.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,this.cache.add(e,t)),n=t}if(i||r||s){let e="ClonedMaterial:"+n.uuid+":";i&&(e+="derivative-tangents:"),r&&(e+="vertex-colors:"),s&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),r&&(t.vertexColors=!0),s&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}e.material=n}getMaterialType(){return Ml}loadMaterial(e){const t=this,n=this.json,i=this.extensions,r=n.materials[e];let s;const o={},a=[];if((r.extensions||{})[Nw.KHR_MATERIALS_UNLIT]){const e=i[Nw.KHR_MATERIALS_UNLIT];s=e.getMaterialType(),a.push(e.extendParams(o,r,t))}else{const n=r.pbrMetallicRoughness||{};if(o.color=new Ha(1,1,1),o.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;o.color.setRGB(e[0],e[1],e[2],Dw),o.opacity=e[3]}void 0!==n.baseColorTexture&&a.push(t.assignTexture(o,"map",n.baseColorTexture,Iw)),o.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,o.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(a.push(t.assignTexture(o,"metalnessMap",n.metallicRoughnessTexture)),a.push(t.assignTexture(o,"roughnessMap",n.metallicRoughnessTexture))),s=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),a.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,o)})))}!0===r.doubleSided&&(o.side=$a);const l=r.alphaMode||wT;if(l===xT?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,l===TT&&(o.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&s!==Ya&&(a.push(t.assignTexture(o,"normalMap",r.normalTexture)),o.normalScale=new Oa(1,1),void 0!==r.normalTexture.scale)){const e=r.normalTexture.scale;o.normalScale.set(e,e)}if(void 0!==r.occlusionTexture&&s!==Ya&&(a.push(t.assignTexture(o,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(o.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&s!==Ya){const e=r.emissiveFactor;o.emissive=(new Ha).setRGB(e[0],e[1],e[2],Dw)}return void 0!==r.emissiveTexture&&s!==Ya&&a.push(t.assignTexture(o,"emissiveMap",r.emissiveTexture,Iw)),Promise.all(a).then(function(){const n=new s(o);return r.name&&(n.name=r.name),AT(n,r),t.associations.set(n,{materials:e}),r.extensions&&PT(i,n,r),n})}createUniqueName(e){const t=Sl.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,i=this.primitiveCache;function r(e){return n[Nw.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(n){return LT(n,e,t)})}const s=[];for(let o=0,a=e.length;o<a;o++){const n=e[o],a=ST(n),l=i[a];if(l)s.push(l.promise);else{let e;e=n.extensions&&n.extensions[Nw.KHR_DRACO_MESH_COMPRESSION]?r(n):LT(new za,n,t),i[a]={primitive:n,promise:e},s.push(e)}}return Promise.all(s)}loadMesh(e){const t=this,n=this.json,i=this.extensions,r=n.meshes[e],s=r.primitives,o=[];for(let a=0,l=s.length;a<l;a++){const e=void 0===s[a].material?ET(this.cache):this.getDependency("material",s[a].material);o.push(e)}return o.push(t.loadGeometries(s)),Promise.all(o).then(function(n){const o=n.slice(0,n.length-1),a=n[n.length-1],l=[];for(let u=0,h=a.length;u<h;u++){const n=a[u],c=s[u];let h;const d=o[u];if(c.mode===pT.TRIANGLES||c.mode===pT.TRIANGLE_STRIP||c.mode===pT.TRIANGLE_FAN||void 0===c.mode)h=!0===r.isSkinnedMesh?new Cl(n,d):new Za(n,d),!0===h.isSkinnedMesh&&h.normalizeSkinWeights(),c.mode===pT.TRIANGLE_STRIP?h.geometry=kw(h.geometry,nl):c.mode===pT.TRIANGLE_FAN&&(h.geometry=kw(h.geometry,tl));else if(c.mode===pT.LINES)h=new Rl(n,d);else if(c.mode===pT.LINE_STRIP)h=new Wa(n,d);else if(c.mode===pT.LINE_LOOP)h=new Ol(n,d);else{if(c.mode!==pT.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);h=new Va(n,d)}Object.keys(h.geometry.morphAttributes).length>0&&MT(h,r),h.name=t.createUniqueName(r.name||"mesh_"+e),AT(h,r),c.extensions&&PT(i,h,c),t.assignFinalMaterial(h),l.push(h)}for(let i=0,r=l.length;i<r;i++)t.associations.set(l[i],{meshes:e,primitives:i});if(1===l.length)return r.extensions&&PT(i,l[0],r),l[0];const c=new Ua;r.extensions&&PT(i,c,r),t.associations.set(c,{meshes:e});for(let e=0,t=l.length;e<t;e++)c.add(l[e]);return c})}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(i)return"perspective"===n.type?t=new kl(Ia.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(t=new Ll(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),AT(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n=[];for(let i=0,r=t.joints.length;i<r;i++)n.push(this._loadNodeShallow(t.joints[i]));return void 0!==t.inverseBindMatrices?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(e){const n=e.pop(),i=e,r=[],s=[];for(let o=0,a=i.length;o<a;o++){const e=i[o];if(e){r.push(e);const t=new La;null!==n&&t.fromArray(n.array,16*o),s.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}return new Il(r,s)})}loadAnimation(e){const t=this.json,n=this,i=t.animations[e],r=i.name?i.name:"animation_"+e,s=[],o=[],a=[],l=[],c=[];for(let u=0,h=i.channels.length;u<h;u++){const e=i.channels[u],t=i.samplers[e.sampler],n=e.target,r=n.node,h=void 0!==i.parameters?i.parameters[t.input]:t.input,d=void 0!==i.parameters?i.parameters[t.output]:t.output;void 0!==n.node&&(s.push(this.getDependency("node",r)),o.push(this.getDependency("accessor",h)),a.push(this.getDependency("accessor",d)),l.push(t),c.push(n))}return Promise.all([Promise.all(s),Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c)]).then(function(e){const t=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=[];for(let r=0,c=t.length;r<c;r++){const e=t[r],c=i[r],u=s[r],h=o[r],d=a[r];if(void 0===e)continue;e.updateMatrix&&e.updateMatrix();const p=n._createAnimationTracks(e,c,u,h,d);if(p)for(let t=0;t<p.length;t++)l.push(p[t])}return new Dl(r,void 0,l)})}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then(function(e){const t=n._getNodeRef(n.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,n=i.weights.length;t<n;t++)e.morphTargetInfluences[t]=i.weights[t]}),t})}loadNode(e){const t=this,n=this.json.nodes[e],i=t._loadNodeShallow(e),r=[],s=n.children||[];for(let a=0,l=s.length;a<l;a++)r.push(t.getDependency("node",s[a]));const o=void 0===n.skin?Promise.resolve(null):t.getDependency("skin",n.skin);return Promise.all([i,Promise.all(r),o]).then(function(e){const t=e[0],n=e[1],i=e[2];null!==i&&t.traverse(function(e){e.isSkinnedMesh&&e.bind(i,OT)});for(let r=0,s=n.length;r<s;r++)t.add(n[r]);return t})}_loadNodeShallow(e){const t=this.json,n=this.extensions,i=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const r=t.nodes[e],s=r.name?i.createUniqueName(r.name):"",o=[],a=i._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return a&&o.push(a),void 0!==r.camera&&o.push(i.getDependency("camera",r.camera).then(function(e){return i._getNodeRef(i.cameraCache,r.camera,e)})),i._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){o.push(e)}),this.nodeCache[e]=Promise.all(o).then(function(t){let o;if(o=!0===r.isBone?new Fl:t.length>1?new Ua:1===t.length?t[0]:new Ra,o!==t[0])for(let e=0,n=t.length;e<n;e++)o.add(t[e]);if(r.name&&(o.userData.name=r.name,o.name=s),AT(o,r),r.extensions&&PT(n,o,r),void 0!==r.matrix){const e=new La;e.fromArray(r.matrix),o.applyMatrix4(e)}else void 0!==r.translation&&o.position.fromArray(r.translation),void 0!==r.rotation&&o.quaternion.fromArray(r.rotation),void 0!==r.scale&&o.scale.fromArray(r.scale);return i.associations.has(o)||i.associations.set(o,{}),i.associations.get(o).nodes=e,o}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],i=this,r=new Ua;n.name&&(r.name=i.createUniqueName(n.name)),AT(r,n),n.extensions&&PT(t,r,n);const s=n.nodes||[],o=[];for(let a=0,l=s.length;a<l;a++)o.push(i.getDependency("node",s[a]));return Promise.all(o).then(function(e){for(let t=0,n=e.length;t<n;t++)r.add(e[t]);return i.associations=(e=>{const t=new Map;for(const[n,r]of i.associations)(n instanceof Al||n instanceof jl)&&t.set(n,r);return e.traverse(e=>{const n=i.associations.get(e);null!=n&&t.set(e,n)}),t})(r),r})}_createAnimationTracks(e,t,n,i,r){const s=[],o=e.name?e.name:e.uuid,a=[];let l;switch(yT[r.path]===yT.weights?e.traverse(function(e){e.morphTargetInfluences&&a.push(e.name?e.name:e.uuid)}):a.push(o),yT[r.path]){case yT.weights:l=Bl;break;case yT.rotation:l=Vl;break;case yT.position:case yT.scale:l=zl;break;default:if(1===n.itemSize)l=Bl;else l=zl}const c=void 0!==i.interpolation?bT[i.interpolation]:Nl,u=this._getArrayFromAccessor(n);for(let h=0,d=a.length;h<d;h++){const e=new l(a[h]+"."+yT[r.path],t.array,u,c);"CUBICSPLINE"===i.interpolation&&this._createCubicSplineTrackInterpolant(e),s.push(e)}return s}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=RT(t.constructor),n=new Float32Array(t.length);for(let i=0,r=t.length;i<r;i++)n[i]=t[i]*e;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof Vl?dT:uT)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function LT(e,t,n){const i=t.attributes,r=[];function s(t,i){return n.getDependency("accessor",t).then(function(t){e.setAttribute(i,t)})}for(const o in i){const t=vT[o]||o.toLowerCase();t in e.attributes||r.push(s(i[o],t))}if(void 0!==t.indices&&!e.index){const i=n.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});r.push(i)}return AT(e,t),function(e,t,n){const i=t.attributes,r=new Kl;if(void 0===i.POSITION)return;{const e=n.json.accessors[i.POSITION],t=e.min,s=e.max;if(void 0===t||void 0===s)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new ka(t[0],t[1],t[2]),new ka(s[0],s[1],s[2])),e.normalized){const t=RT(mT[e.componentType]);r.min.multiplyScalar(t),r.max.multiplyScalar(t)}}const s=t.targets;if(void 0!==s){const e=new ka,t=new ka;for(let i=0,r=s.length;i<r;i++){const r=s[i];if(void 0!==r.POSITION){const i=n.json.accessors[r.POSITION],s=i.min,o=i.max;if(void 0!==s&&void 0!==o){if(t.setX(Math.max(Math.abs(s[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(s[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(s[2]),Math.abs(o[2]))),i.normalized){const e=RT(mT[i.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(e)}e.boundingBox=r;const o=new Xl;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,e.boundingSphere=o}(e,t,n),Promise.all(r).then(function(){return void 0!==t.targets?function(e,t,n){let i=!1,r=!1,s=!1;for(let c=0,u=t.length;c<u;c++){const e=t[c];if(void 0!==e.POSITION&&(i=!0),void 0!==e.NORMAL&&(r=!0),void 0!==e.COLOR_0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(e);const o=[],a=[],l=[];for(let c=0,u=t.length;c<u;c++){const u=t[c];if(i){const t=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):e.attributes.position;o.push(t)}if(r){const t=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):e.attributes.normal;a.push(t)}if(s){const t=void 0!==u.COLOR_0?n.getDependency("accessor",u.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(t){const n=t[0],o=t[1],a=t[2];return i&&(e.morphAttributes.position=n),r&&(e.morphAttributes.normal=o),s&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e})}(e,t.targets,n):e})}const IT=new WeakMap;class DT extends il{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,i){const r=new sl(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,e=>{const n={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,n).then(t).catch(i)},n,i)}decodeDracoFile(e,t,n,i){const r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,r).then(t)}decodeGeometry(e,t){for(const a in t.attributeTypes){const e=t.attributeTypes[a];void 0!==e.BYTES_PER_ELEMENT&&(t.attributeTypes[a]=e.name)}const n=JSON.stringify(t);if(IT.has(e)){const t=IT.get(e);if(t.key===n)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const r=this.workerNextTaskID++,s=e.byteLength,o=this._getWorker(r,s).then(n=>(i=n,new Promise((n,s)=>{i._callbacks[r]={resolve:n,reject:s},i.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(e=>this._createGeometry(e.geometry));return o.catch(()=>!0).then(()=>{i&&r&&this._releaseTask(i,r)}),IT.set(e,{key:n,promise:o}),o}_createGeometry(e){const t=new za;e.index&&t.setIndex(new Qa(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n],r=i.name,s=i.array,o=i.itemSize;t.setAttribute(r,new Qa(s,o))}return t}_loadLibrary(e,t){const n=new sl(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((t,i)=>{n.load(e,t,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(t=>{const n=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const i=FT.toString(),r=["/* draco decoder */",n,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const n=t.data;switch(n.type){case"decode":e._callbacks[n.id].resolve(n);break;case"error":e._callbacks[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function FT(){let e,t;function n(e,t,n,i,r,s){const o=s.num_components(),a=n.num_points()*o,l=a*r.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,r),u=e._malloc(l);t.GetAttributeDataArrayForAllPoints(n,s,c,l,u);const h=new r(e.HEAPF32.buffer,u,a).slice();return e._free(u),{name:i,array:h,itemSize:o}}onmessage=function(i){const r=i.data;switch(r.type){case"init":e=r.decoderConfig,t=new Promise(function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)});break;case"decode":const i=r.buffer,s=r.taskConfig;t.then(e=>{const t=e.draco,o=new t.Decoder,a=new t.DecoderBuffer;a.Init(new Int8Array(i),i.byteLength);try{const e=function(e,t,i,r){const s=r.attributeIDs,o=r.attributeTypes;let a,l;const c=t.GetEncodedGeometryType(i);if(c===e.TRIANGULAR_MESH)a=new e.Mesh,l=t.DecodeBufferToMesh(i,a);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new e.PointCloud,l=t.DecodeBufferToPointCloud(i,a)}if(!l.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const u={index:null,attributes:[]};for(const h in s){const i=self[o[h]];let l,c;if(r.useUniqueIDs)c=s[h],l=t.GetAttributeByUniqueId(a,c);else{if(c=t.GetAttributeId(a,e[s[h]]),-1===c)continue;l=t.GetAttribute(a,c)}u.attributes.push(n(e,t,a,h,i,l))}return c===e.TRIANGULAR_MESH&&(u.index=function(e,t,n){const i=3*n.num_faces(),r=4*i,s=e._malloc(r);t.GetTrianglesUInt32Array(n,r,s);const o=new Uint32Array(e.HEAPF32.buffer,s,i).slice();return e._free(s),{array:o,itemSize:1}}(e,t,a)),e.destroy(a),u}(t,o,a,s),i=e.attributes.map(e=>e.array.buffer);e.index&&i.push(e.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:e},i)}catch(or){console.error(or),self.postMessage({type:"error",id:r.id,error:or.message})}finally{t.destroy(a),t.destroy(o)}})}}}const UT=class extends il{gltfLoader;constructor(e){super(e),this.gltfLoader=new Fw(e)}load(e,t,n,i){const r=Array.isArray(e)?e[0]:e;this.gltfLoader.load(r,t,n,i)}async loadAsync(e){const t=Array.isArray(e)?e[0]:e;return this.gltfLoader.loadAsync(t)}setDRACOLoader(e){return this.gltfLoader.setDRACOLoader(e)}};async function NT(e,t={draco:!1},n){const{loaderExtension:i,dracoLoader:r}=function(e){let t=null;return{loaderExtension:n=>{e.draco&&(t||(t=new DT),t.setDecoderPath(e.decoderPath||"https://www.gstatic.com/draco/versioned/decoders/1.4.3/"),n.setDRACOLoader&&n.setDRACOLoader(t))},dracoLoader:()=>t}}(t),s=await function(e,t,n){const i=new e(n?.manager),r=Oe({loaded:0,total:0,percentage:0});n?.extensions&&n.extensions(i);const s=ke(t),o=Pe(e=>new Promise((t,n)=>{const o=e||s||"";i.load(o,e=>{t(e)},e=>{r.loaded=e.loaded,r.total=e.total,r.percentage=r.loaded/r.total*100},e=>{n(e)})}),n?.initialValue??null,{...n?.asyncOptions,immediate:n?.asyncOptions?.immediate??!0}),a=Le(()=>ke(t),e=>{if(e){const t=o.state.value;t&&"object"==typeof t&&"scene"in t&&t.scene&&gn(t.scene),o.execute(0,e)}});return Ie(()=>{a();const e=o.state.value;e&&"object"==typeof e&&"scene"in e&&e.scene&&gn(e.scene)}),{...o,load:e=>{o.execute(0,e)},progress:r}}(UT,e,{extensions:i}),o=r();return o&&o.dispose(),s}const jT=["object"],zT=Jo({__name:"GeoGLTF",props:{url:{},draco:{type:Boolean,default:!1},decoderPath:{default:"./draco/"},renderOrder:{default:1}},setup(e){const t=e,n=da();return na(async()=>{const{scene:e}=await NT(t.url,{draco:t.draco,decoderPath:t.draco?t.decoderPath:void 0});n.value=e,n.value.userData.tiles=[],n.value.renderOrder=t.renderOrder}),(e,t)=>n.value?(sa(),ra("primitive",{key:0,object:n.value,scale:1,position:[0,0,0]},null,8,jT)):ma("",!0)}}),BT=Jo({__name:"GeoCSS2DRenderer",setup(e){const{camera:t,renderer:n}=_i(),i=da(),r=()=>{i.value?.setSize(window.innerWidth,window.innerHeight)};return na(()=>{t.value&&t.value.layers.enableAll(),i.value=new wc,i.value.setSize(window.innerWidth,window.innerHeight),i.value.domElement.style.position="fixed",i.value.domElement.style.top="0",i.value.domElement.style.left="0",i.value.domElement.style.pointerEvents="none",n.domElement?.parentElement?.appendChild(i.value.domElement);const{onRender:e}=vi();e(({scene:e,camera:t})=>{i.value?.render(e.value,t.value)}),window.addEventListener("resize",r)}),wa(()=>{window.removeEventListener("resize",r),n.domElement?.parentElement?.removeChild(i.value.domElement)}),()=>{}}}),VT=Jo({__name:"GeoCanvas",props:{canvasConfig:{default:()=>({windowSize:!0,alpha:!0,antialias:!0,shadows:!1,autoClear:!0,disableRender:!0,outputColorSpace:Ca.SRGBColorSpace,toneMapping:Ca.NoToneMapping,pixelRatio:1})},cameraConfig:{default:()=>({fov:29,aspect:window.innerWidth/window.innerHeight,near:1,far:1e4,position:[0,0,175e5],lookAt:[0,0,0]})}},setup(e){const t=e,{canvasConfig:n,cameraConfig:i}=t,r=pa(null);return na(()=>{const e=r.value?.context?.renderer?.instance;e&&(window.devicePixelRatio=n.pixelRatio,e.setPixelRatio(window.devicePixelRatio))}),(e,t)=>(sa(),ca(oa(Qo),Ta({clearColor:"#fff"},oa(n),{ref_key:"canvasRef",ref:r}),{default:ua(()=>[ha("TresPerspectiveCamera",Ea(Pa(oa(i))),null,16),xa(BT),ga(e.$slots,"default")]),_:3},16))}}),HT={type:"change"},GT={type:"start"},WT={type:"end"},KT=new Fa,XT=new $l,qT=Math.cos(70*Ia.DEG2RAD),YT=new ka,$T=2*Math.PI,ZT=-1,QT=0,JT=1,ex=2,tx=3,nx=4,ix=5,rx=6,sx=1e-6;class ox extends dc{constructor(e,t=null){super(e,t),this.state=ZT,this.target=new ka,this.cursor=new ka,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:pc.ROTATE,MIDDLE:pc.DOLLY,RIGHT:pc.PAN},this.touches={ONE:mc.ROTATE,TWO:mc.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new ka,this._lastQuaternion=new Da,this._lastTargetPosition=new ka,this._quat=(new Da).setFromUnitVectors(e.up,new ka(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Yl,this._sphericalDelta=new Yl,this._scale=1,this._panOffset=new ka,this._rotateStart=new Oa,this._rotateEnd=new Oa,this._rotateDelta=new Oa,this._panStart=new Oa,this._panEnd=new Oa,this._panDelta=new Oa,this._dollyStart=new Oa,this._dollyEnd=new Oa,this._dollyDelta=new Oa,this._dollyDirection=new ka,this._mouse=new Oa,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=lx.bind(this),this._onPointerDown=ax.bind(this),this._onPointerUp=cx.bind(this),this._onContextMenu=gx.bind(this),this._onMouseWheel=dx.bind(this),this._onKeyDown=px.bind(this),this._onTouchStart=mx.bind(this),this._onTouchMove=fx.bind(this),this._onMouseDown=ux.bind(this),this._onMouseMove=hx.bind(this),this._interceptControlDown=_x.bind(this),this._interceptControlUp=vx.bind(this),null!==this.domElement&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){null!==this._domElementKeyEvents&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(HT),this.update(),this.state=ZT}update(e=null){const t=this.object.position;YT.copy(t).sub(this.target),YT.applyQuaternion(this._quat),this._spherical.setFromVector3(YT),this.autoRotate&&this.state===ZT&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,i=this.maxAzimuthAngle;isFinite(n)&&isFinite(i)&&(n<-Math.PI?n+=$T:n>Math.PI&&(n-=$T),i<-Math.PI?i+=$T:i>Math.PI&&(i-=$T),this._spherical.theta=n<=i?Math.max(n,Math.min(i,this._spherical.theta)):this._spherical.theta>(n+i)/2?Math.max(n,this._spherical.theta):Math.min(i,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),!0===this.enableDamping?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let r=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const e=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),r=e!=this._spherical.radius}if(YT.setFromSpherical(this._spherical),YT.applyQuaternion(this._quatInverse),t.copy(this.target).add(YT),this.object.lookAt(this.target),!0===this.enableDamping?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let e=null;if(this.object.isPerspectiveCamera){const t=YT.length();e=this._clampDistance(t*this._scale);const n=t-e;this.object.position.addScaledVector(this._dollyDirection,n),this.object.updateMatrixWorld(),r=!!n}else if(this.object.isOrthographicCamera){const t=new ka(this._mouse.x,this._mouse.y,0);t.unproject(this.object);const n=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),r=n!==this.object.zoom;const i=new ka(this._mouse.x,this._mouse.y,0);i.unproject(this.object),this.object.position.sub(i).add(t),this.object.updateMatrixWorld(),e=YT.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;null!==e&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(e).add(this.object.position):(KT.origin.copy(this.object.position),KT.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(KT.direction))<qT?this.object.lookAt(this.target):(XT.setFromNormalAndCoplanarPoint(this.object.up,this.target),KT.intersectPlane(XT,this.target))))}else if(this.object.isOrthographicCamera){const e=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),e!==this.object.zoom&&(this.object.updateProjectionMatrix(),r=!0)}return this._scale=1,this._performCursorZoom=!1,!!(r||this._lastPosition.distanceToSquared(this.object.position)>sx||8*(1-this._lastQuaternion.dot(this.object.quaternion))>sx||this._lastTargetPosition.distanceToSquared(this.target)>sx)&&(this.dispatchEvent(HT),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0)}_getAutoRotationAngle(e){return null!==e?$T/60*this.autoRotateSpeed*e:$T/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(.01*e);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){YT.setFromMatrixColumn(t,0),YT.multiplyScalar(-e),this._panOffset.add(YT)}_panUp(e,t){!0===this.screenSpacePanning?YT.setFromMatrixColumn(t,1):(YT.setFromMatrixColumn(t,0),YT.crossVectors(this.object.up,YT)),YT.multiplyScalar(e),this._panOffset.add(YT)}_pan(e,t){const n=this.domElement;if(this.object.isPerspectiveCamera){const i=this.object.position;YT.copy(i).sub(this.target);let r=YT.length();r*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*r/n.clientHeight,this.object.matrix),this._panUp(2*t*r/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),i=e-n.left,r=t-n.top,s=n.width,o=n.height;this._mouse.x=i/s*2-1,this._mouse.y=-r/o*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft($T*this._rotateDelta.x/t.clientHeight),this._rotateUp($T*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp($T*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-$T*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft($T*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-$T*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(1===this._pointers.length)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._rotateStart.set(n,i)}}_handleTouchStartPan(e){if(1===this._pointers.length)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panStart.set(n,i)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,i=e.pageY-t.y,r=Math.sqrt(n*n+i*i);this._dollyStart.set(0,r)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(1==this._pointers.length)this._rotateEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._rotateEnd.set(n,i)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft($T*this._rotateDelta.x/t.clientHeight),this._rotateUp($T*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(1===this._pointers.length)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panEnd.set(n,i)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,i=e.pageY-t.y,r=Math.sqrt(n*n+i*i);this._dollyEnd.set(0,r),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const s=.5*(e.pageX+t.x),o=.5*(e.pageY+t.y);this._updateZoomParameters(s,o)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return void this._pointers.splice(t,1)}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];void 0===t&&(t=new Oa,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function ax(e){!1!==this.enabled&&(0===this._pointers.length&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(e)&&(this._addPointer(e),"touch"===e.pointerType?this._onTouchStart(e):this._onMouseDown(e)))}function lx(e){!1!==this.enabled&&("touch"===e.pointerType?this._onTouchMove(e):this._onMouseMove(e))}function cx(e){switch(this._removePointer(e),this._pointers.length){case 0:this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(WT),this.state=ZT;break;case 1:const t=this._pointers[0],n=this._pointerPositions[t];this._onTouchStart({pointerId:t,pageX:n.x,pageY:n.y})}}function ux(e){let t;switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case pc.DOLLY:if(!1===this.enableZoom)return;this._handleMouseDownDolly(e),this.state=JT;break;case pc.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===this.enablePan)return;this._handleMouseDownPan(e),this.state=ex}else{if(!1===this.enableRotate)return;this._handleMouseDownRotate(e),this.state=QT}break;case pc.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===this.enableRotate)return;this._handleMouseDownRotate(e),this.state=QT}else{if(!1===this.enablePan)return;this._handleMouseDownPan(e),this.state=ex}break;default:this.state=ZT}this.state!==ZT&&this.dispatchEvent(GT)}function hx(e){switch(this.state){case QT:if(!1===this.enableRotate)return;this._handleMouseMoveRotate(e);break;case JT:if(!1===this.enableZoom)return;this._handleMouseMoveDolly(e);break;case ex:if(!1===this.enablePan)return;this._handleMouseMovePan(e)}}function dx(e){!1===this.enabled||!1===this.enableZoom||this.state!==ZT||(e.preventDefault(),this.dispatchEvent(GT),this._handleMouseWheel(this._customWheelEvent(e)),this.dispatchEvent(WT))}function px(e){!1!==this.enabled&&this._handleKeyDown(e)}function mx(e){switch(this._trackPointer(e),this._pointers.length){case 1:switch(this.touches.ONE){case mc.ROTATE:if(!1===this.enableRotate)return;this._handleTouchStartRotate(e),this.state=tx;break;case mc.PAN:if(!1===this.enablePan)return;this._handleTouchStartPan(e),this.state=nx;break;default:this.state=ZT}break;case 2:switch(this.touches.TWO){case mc.DOLLY_PAN:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchStartDollyPan(e),this.state=ix;break;case mc.DOLLY_ROTATE:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchStartDollyRotate(e),this.state=rx;break;default:this.state=ZT}break;default:this.state=ZT}this.state!==ZT&&this.dispatchEvent(GT)}function fx(e){switch(this._trackPointer(e),this.state){case tx:if(!1===this.enableRotate)return;this._handleTouchMoveRotate(e),this.update();break;case nx:if(!1===this.enablePan)return;this._handleTouchMovePan(e),this.update();break;case ix:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchMoveDollyPan(e),this.update();break;case rx:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchMoveDollyRotate(e),this.update();break;default:this.state=ZT}}function gx(e){!1!==this.enabled&&e.preventDefault()}function _x(e){"Control"===e.key&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function vx(e){"Control"===e.key&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}class yx extends ox{constructor(e,t){super(e,t),this.screenSpacePanning=!1,this.mouseButtons={LEFT:pc.PAN,MIDDLE:pc.DOLLY,RIGHT:pc.ROTATE},this.touches={ONE:mc.PAN,TWO:mc.DOLLY_ROTATE}}}const bx={type:"change"},wx=new Fa,Tx=new $l,xx=new ka,Ex=new Za(new cc(10,10,10),new Ya({color:16711680})),Px=Math.cos(70*Ia.DEG2RAD),Ax=2*Math.PI,Mx=-1,Sx=1e-6,Cx=Wc(0,89.99999,0).normalize();console.log(Cx);class Rx extends yx{_persistentPanOffset=new ka(0,0,0);resetPanOffset(){this._persistentPanOffset.set(0,0,0)}constructor(e,t,n=!1){super(e,t),n&&e.parent?.add(Ex)}targetUp=new ka(0,1,0);_panUp(e,t){xx.setFromMatrixColumn(t,0),xx.crossVectors(this.targetUp,xx),xx.multiplyScalar(e),this._panOffset.add(xx)}_panLeft(e,t){xx.setFromMatrixColumn(t,0),xx.projectOnPlane(this.targetUp),xx.normalize(),xx.multiplyScalar(-e),this._panOffset.add(xx)}targetPosition={heading:0,pitch:0,distance:0,x:0,y:0};_calculatePersistentPanOffset(e=0,t=0){const n=new ka,i=this.object.matrix;return 0!==e&&(xx.setFromMatrixColumn(i,0),xx.projectOnPlane(this.targetUp),xx.normalize(),xx.multiplyScalar(-e),n.add(xx)),0!==t&&(xx.setFromMatrixColumn(i,0),xx.crossVectors(this.targetUp,xx),xx.multiplyScalar(t),n.add(xx)),n}getTarget(){return this._persistentPanOffset?this.target.clone().add(this._persistentPanOffset):this.target}lookAt(){this.object.lookAt(this.getTarget())}invertCameraHPD(){const e=this.object.position,t=this.getTarget(),n=e.distanceTo(t),i=new ka,r=new ka,s=new ka;Sc.WGS84.getEastNorthUpVectors(this.target,i,r,s);const o=(new ka).subVectors(t,e).normalize(),a=(new ka).copy(o);a.projectOnPlane(s).normalize();const l=Math.atan2(a.dot(r),a.dot(i)),c=Ia.radToDeg(l),u=Math.asin(-o.dot(s)),h=Ia.radToDeg(u);let d=0,p=0;if(this._persistentPanOffset.lengthSq()>0){const e=this.object.matrix;xx.setFromMatrixColumn(e,0),xx.projectOnPlane(this.targetUp),xx.normalize(),d=-this._persistentPanOffset.dot(xx),xx.setFromMatrixColumn(e,0),xx.crossVectors(this.targetUp,xx),xx.normalize(),p=this._persistentPanOffset.dot(xx)}return{heading:c,pitch:h,distance:n,x:d,y:p}}setCameraPosition(e){this.targetPosition=e;const{heading:t,pitch:n,distance:i,x:r=0,y:s=0}=e;this._persistentPanOffset.copy(this._calculatePersistentPanOffset(r,s));const o=this.getTarget(),a=new ka,l=new ka,c=new ka;Sc.WGS84.getEastNorthUpVectors(this.target,a,l,c);const u=Ia.degToRad(t),h=Ia.degToRad(n),d=(new ka).copy(a).multiplyScalar(Math.cos(u)).add(l.clone().multiplyScalar(Math.sin(u))),p=(new ka).copy(d).multiplyScalar(Math.cos(h)).add(c.clone().multiplyScalar(Math.sin(-h))).normalize().multiplyScalar(i);this.object.position.copy(o).sub(p),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),Ex.position.copy(this.getTarget())}updateUp(e){this.targetUp.copy(e),this._quat=(new Da).setFromUnitVectors(e,new ka(0,1,0)),this._quatInverse=this._quat.clone().invert(),this.object?.up.copy(this.targetUp),this.setCameraPosition(this.targetPosition)}update(e){if(!this._persistentPanOffset)return!1;let t;const n=this.object.position;let i=this.getTarget();xx.copy(n).sub(i),xx.applyQuaternion(this._quat),this._spherical.setFromVector3(xx),this.autoRotate&&this.state===Mx&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let r=this.minAzimuthAngle,s=this.maxAzimuthAngle;isFinite(r)&&isFinite(s)&&(r<-Math.PI?r+=Ax:r>Math.PI&&(r-=Ax),s<-Math.PI?s+=Ax:s>Math.PI&&(s-=Ax),this._spherical.theta=r<=s?Math.max(r,Math.min(s,this._spherical.theta)):this._spherical.theta>(r+s)/2?Math.max(r,this._spherical.theta):Math.min(s,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),!0===this.enableDamping?this._persistentPanOffset.addScaledVector(this._panOffset,this.dampingFactor):this._persistentPanOffset.add(this._panOffset),this._persistentPanOffset.sub(this.cursor),this._persistentPanOffset.clampLength(this.minTargetRadius,this.maxTargetRadius),this._persistentPanOffset.add(this.cursor),i.copy(this.getTarget());let o=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const e=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),o=e!=this._spherical.radius}if(xx.setFromSpherical(this._spherical),xx.applyQuaternion(this._quatInverse),n.copy(i).add(xx),this.object.lookAt(i),Ex.position.copy(this.getTarget()),!0===this.enableDamping?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let e=null;if(this.object.isPerspectiveCamera){const t=xx.length();e=this._clampDistance(t*this._scale);const n=t-e;this.object.position.addScaledVector(this._dollyDirection,n),this.object.updateMatrixWorld(),o=!!n}else if(this.object.isOrthographicCamera){const t=new ka(this._mouse.x,this._mouse.y,0);t.unproject(this.object);const n=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),o=n!==this.object.zoom;const i=new ka(this._mouse.x,this._mouse.y,0);i.unproject(this.object),this.object.position.sub(i).add(t),this.object.updateMatrixWorld(),e=xx.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;null!==e&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(e).add(this.object.position):(wx.origin.copy(this.object.position),wx.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(wx.direction))<Px?this.object.lookAt(i):(Tx.setFromNormalAndCoplanarPoint(this.object.up,this.target),wx.intersectPlane(Tx,this.target))))}else if(this.object.isOrthographicCamera){const e=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),e!==this.object.zoom&&(this.object.updateProjectionMatrix(),o=!0)}return this._scale=1,this._performCursorZoom=!1,(o||this._lastPosition.distanceToSquared(this.object.position)>Sx||8*(1-this._lastQuaternion.dot(this.object.quaternion))>Sx||this._lastTargetPosition.distanceToSquared(this.target)>Sx)&&(this.dispatchEvent(bx),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),t=!0,this.targetPosition=this.invertCameraHPD(),this.dispatchEvent({type:"target-change"})),t=!1,t}}const Ox=new ka,kx=new ka,Lx=new La,Ix={},Dx=new ka;class Fx extends Of{isWorldPosition=!1;adjustCamera(e,t){super.adjustCamera(e);const{ellipsoidFrame:n,ellipsoidFrameInverse:i,ellipsoid:r,nearMargin:s,farMargin:o}=this,a=Math.max(...r.radius);if("isPerspectiveCamera"in e){const l=new ka;this.isWorldPosition?e.getWorldPosition(l):l.copy(e.position);const c=Ox.setFromMatrixPosition(n).sub(l).length(),u=s*a,h=Ia.clamp((c-a)/u,0,1),d=Ia.lerp(1,1e3,h);this.isWorldPosition?t&&(e.near=.05*e.position.distanceTo(t)):e.near=Math.max(d,c-a-u),kx.copy(l).applyMatrix4(i),r.getPositionToCartographic(kx,Ix);const p=Math.max(r.getPositionElevation(kx),2550),m=r.calculateHorizonDistance(Ix.lat,p);e.far=m+.1+a*o,e.updateProjectionMatrix()}else{this._getVirtualOrthoCameraPosition(e.position,e),e.updateMatrixWorld(),Lx.copy(e.matrixWorld).invert(),Ox.setFromMatrixPosition(n).applyMatrix4(Lx);const t=-Ox.z;e.near=t-a*(1+s),e.far=t+.1+a*o,e.position.addScaledVector(Dx,e.near),e.far-=e.near,e.near=0,e.updateProjectionMatrix(),e.updateMatrixWorld()}}}const Ux=Jo({__name:"GeoControls",props:Aa({enableDamping:{type:Boolean,default:!0},adjustHeight:{type:Boolean,default:!1},minDistance:{default:150},target:{default:null}},{position:{required:!0},positionModifiers:{},"target-position":{required:!1},"target-positionModifiers":{}}),emits:["update:position","update:target-position"],setup(e){const{scene:t,camera:n,renderer:i}=_i(),r=Ma(e,"position"),s=Ma(e,"target-position"),o=(e,t,n)=>{let i;const r=()=>{i=ta(e,t,n)};return r(),e=>{i(),e().then(()=>{r()})}},a=e,{onRender:l}=vi();let c=null,u=da(null);const h=()=>{if(a.target){const e=Wc(a.target.lon,a.target.lat,a.target.height||0);u.value?.target.copy(e),u.value?.updateUp((e=>{const t=new ka;return Sc.WGS84.getSurfaceNormal(e,t),t})(e))}},d=o([s],()=>{s.value&&u.value&&u.value.setCameraPosition(s.value)});ta([u],()=>{s.value&&u.value&&u.value.setCameraPosition(s.value)},{immediate:!0});const p=()=>{a.target?(c&&(c.isWorldPosition=!0,c.enabled=!1),!u.value&&n.value&&i&&(u.value=new Rx(n.value,i.domElement),u.value.enableDamping=a.enableDamping,u.value.minDistance=a.minDistance,u.value.addEventListener("target-change",()=>{d(async()=>{s.value=u.value?.targetPosition||s.value})})),u.value&&(u.value.enabled=!0,u.value.resetPanOffset(),h(),u.value)):(c&&(c.isWorldPosition=!1),u.value&&(u.value.enabled=!1),c&&(c.enabled=!0,n.value?.up.set(0,1,0)))};na(()=>{n.value&&i&&t.value&&(c=new Fx(t.value,n.value,i.domElement),c.setTilesRenderer({group:t.value}),c.enableDamping=a.enableDamping,c.adjustHeight=a.adjustHeight,c.minDistance=a.minDistance,p())});const m=()=>{n.value&&!a.target&&((e,t,n,i,r,s)=>{new Vc(t,Hc(n),Hc(i)).decompose(new Oc(Hc(r),Hc(s)).toECEF(),e.position,e.quaternion,e.up),e.updateMatrixWorld()})(n.value,r.value.distance,r.value.heading,r.value.pitch,r.value.longitude,r.value.latitude)};ta(()=>a.target,()=>{p(),a.target||m()},{immediate:!0,deep:!0});const f=o([r,n],()=>{m()});return l(()=>{if(a.target&&u.value?.enabled?(u.value.update(),n.value&&c?.adjustCamera(n.value,u.value.target)):a.target||c?.update(),n.value&&!a.target){const e=(e=>{Kc.setFromCamera(e);const t=qc.setFromMatrixPosition(e.matrixWorld),n=Yc.set(0,0,.5).unproject(e).sub(t).normalize(),i=Zc.getIntersection($c.set(t,n));return i?(Xc.setFromECEF(i),{distance:Kc.distance,heading:Gc(Kc.heading),pitch:Gc(Kc.pitch),longitude:Gc(Xc.longitude),latitude:Gc(Xc.latitude)}):null})(n.value);e&&f(async()=>{r.value=e})}}),ia(()=>{c?.dispose(),u.value?.dispose()}),(e,t)=>null}}),Nx=["color","intensity"],jx=["color","intensity","position"],zx=Jo({__name:"GeoScene",props:{sceneConfig:{default:()=>({ambientLight:{color:"#fff",intensity:1},directionalLight:{color:"#fff",intensity:2,position:[-1500,500,500]},background:"/farm_field_puresky_2k.jpg"})}},setup(e){const t=e,{sceneConfig:n}=t,i=Sa(n.ambientLight),r=Sa(n.directionalLight),s=pa(null),o=pa(null),{scene:a}=_i();return na(()=>{const e=new Ca.TextureLoader;if(n.background){const t=e.load(n.background);t.mapping=Ca.EquirectangularReflectionMapping,t.colorSpace=Ca.SRGBColorSpace,a.value.background=t}}),(e,t)=>(sa(),ra("TresGroup",null,[ga(e.$slots,"default"),ha("TresAmbientLight",{ref_key:"ambientLightRef",ref:s,color:i.color,intensity:i.intensity},null,8,Nx),ha("TresDirectionalLight",{ref_key:"directionalLightRef",ref:o,color:r.color,intensity:r.intensity,position:r.position},null,8,jx)]))}}),{defineComponent:Bx}=await e("vue"),{unref:Vx,openBlock:Hx,createBlock:Gx}=await e("vue"),Wx=Bx({__name:"DevTDTTiles",props:{layer:{type:String,default:"vec"}},setup:e=>(t,n)=>(Hx(),Gx(Vx(Fg),{layer:e.layer,url:Vx("https://t0.tianditu.gov.cn"),tk:"890a908c5d3f6c77232b60964d74f180"},null,8,["layer","url"]))});export{Tu as $d,zT as By,Ux as Gy,zx as Hy,su as J_,iu as Q_,BT as T_,Rw as Uy,tu as Z_,yh as _a,Wx as _sfc_main,fh as ay,bh as cy,au as ey,xu as iy,_h as ly,wu as ol,uh as oy,gu as rl,ah as ry,cu as ty,VT as zy};
