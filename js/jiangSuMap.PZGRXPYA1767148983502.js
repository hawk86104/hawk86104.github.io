import{importShared as c}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{Fs as te,_l as oe,gz as ne,Kk as re}from"./index.DTe2qqjO1767148983502.js";import{loadGeojson as se}from"./utils.DURg_k-q1767148983502.js";import{useTexture as ie}from"./customShaderMaterial.vue_vue_type_script_setup_true_lang.B7dQ_CiZ1767148983502.js";import"./index.vue_vue_type_script_setup_true_lang.CjsHShHS1767148983502.js";import{flyTo as ae}from"./utils.Dy5vlvhc1767148983502.js";import{mercator as pe}from"./mercator.uGAj1T4a1767148983502.js";import{computeBoundsTree as le,disposeBoundsTree as ce,acceleratedRaycast as ue}from"./ExtensionUtilities.2O-yyDsQ1767148983502.js";const{withAsyncContext:G}=await c("vue"),{renderList:de,Fragment:k,openBlock:p,createElementBlock:d,toDisplayString:fe,createElementVNode:s,unref:V,mergeProps:me,withCtx:_e,createBlock:ye,createCommentVNode:w}=await c("vue"),he=["position"],ge=["blending","map"],Te=["name","renderOrder","pCenter"],we=["args"],Ce=["color","side"],ve=["renderOrder","position-z"],Be=["position"],xe=["renderOrder"],ke=["position"],{watchEffect:Se,ref:Me}=await c("vue"),i=await c("three"),Pe={__name:"jiangSuMapMesh",async setup(A){let r,u;(()=>{i.BufferGeometry.prototype.computeBoundsTree=le,i.BufferGeometry.prototype.disposeBoundsTree=ce,i.Mesh.prototype.raycast=ue})();const o=([r,u]=G(()=>se("./plugins/simpleGIS/json/320000_full.json","features")),r=await r,u(),r),C=([r,u]=G(()=>ie("./plugins/simpleGIS/image/icon.png")),r=await r,u(),r),H=o[0].properties.centroid,f=pe();f.center(H).translate([0,0]);const m=[];(()=>{o.forEach(t=>{const n=new i.Color(`hsl( 16, ${Math.random()*30+55}%, ${Math.random()*30+55}%)`).getHex(),e=Math.random()*.3+.3,{centroid:a,oneCenter:W,center:Z,name:M}=t.properties,{coordinates:ee,type:P}=t.geometry,E=a||W||Z||[0,0],h=f(E);h[1]=-h[1],h[2]=e,m.push({type:"Html",position:h,name:M});const _=f(E);_[1]=-_[1]+.2,_[2]=e+.22,m.push({type:"Sprite",position:_}),ee.forEach(L=>{function b(g){const v=new i.Shape;g.forEach((B,x)=>{const[T,$]=f(B);x===0?v.moveTo(T,-$):v.lineTo(T,-$)}),m.push({type:"Shape",shape:v,name:M,color:n,depth:e,pCenter:_});const z=[];g.forEach(B=>{const[x,T]=f(B);z.push(x,-T,0)}),m.push({type:"Line",points:new Float32Array(z),depth:e})}P==="MultiPolygon"&&L.forEach(g=>b(g)),P==="Polygon"&&b(L)})})})();const I=t=>{t.rotation.x=-Math.PI/2;const e=new i.Box3().setFromObject(t).getCenter(new i.Vector3),a=[0,0];t.position.x=t.position.x-e.x-a[0],t.position.z=t.position.z-e.z-a[1]},y=Me();Se(()=>{y.value&&(I(y.value),y.value.children.forEach(t=>{t.type==="Mesh"&&t.geometry.computeBoundsTree()}))});const J=t=>{t.object.material.opacity=.4},K=t=>{t.eventObject.material.opacity=1},{camera:X,controls:Y}=te();let S=null;const q=t=>{const n=new i.Vector3;n.x=t.point.x,n.y=t.point.y+10,n.z=t.point.z,S=ae(X,n,Y)},{onBeforeRender:Q}=oe();Q(()=>{S?.update()});const U={wrapperClass:"wrapper",as:"div",center:!0,sprite:!0,prepend:!0,transform:!0};return(t,n)=>(p(),d("TresGroup",{ref_key:"tgRef",ref:y},[(p(),d(k,null,de(m,(e,a)=>(p(),d(k,{key:`${a}`},[e.type==="Html"?(p(),ye(V(ne),me({key:0,ref_for:!0},U,{position:e.position}),{default:_e(()=>[s("span",null,fe(e.name),1)]),_:2},1040,["position"])):w("",!0),e.type==="Sprite"?(p(),d("TresSprite",{key:1,position:e.position,scale:.3,renderOrder:1e3},[s("TresSpriteMaterial",{color:16711680,blending:i.NormalBlending,map:V(C)},null,8,ge)],8,he)):w("",!0),e.type==="Shape"?(p(),d("TresMesh",{key:2,name:e.name,renderOrder:a,pCenter:e.pCenter,onPointerenter:J,onPointerleave:K,onClick:q},[s("TresExtrudeGeometry",{args:[e.shape,{depth:e.depth,bevelEnabled:!1}]},null,8,we),s("TresMeshStandardMaterial",{color:e.color,emissive:0,roughness:.45,metalness:.8,transparent:!0,side:i.DoubleSide},null,8,Ce)],40,Te)):w("",!0),e.type==="Line"?(p(),d(k,{key:3},[s("TresLine",{renderOrder:a,"position-z":e.depth+1e-4},[s("TresBufferGeometry",{position:[e.points,3]},null,8,Be),n[0]||(n[0]=s("TresLineBasicMaterial",{color:16777215,linewidth:.5},null,-1))],8,ve),s("TresLine",{renderOrder:a,"position-z":-1e-4},[s("TresBufferGeometry",{position:[e.points,3]},null,8,ke),n[1]||(n[1]=s("TresLineBasicMaterial",{color:0,linewidth:.5},null,-1))],8,xe)],64)):w("",!0)],64))),64))],512))}},{defineComponent:Ee}=await c("vue"),{createElementVNode:l,unref:Le,normalizeProps:be,guardReactiveProps:ze,createVNode:D,Suspense:$e,withCtx:N,openBlock:O,createBlock:j,resolveComponent:Ge,mergeProps:Ve}=await c("vue"),{reactive:R}=await c("vue"),Je=Ee({__name:"jiangSuMap",setup(A){const r=R({clearColor:"#ffdbd1",alpha:!0,antialias:!0}),u=R({enableDamping:!0,dampingFactor:.05,makeDefault:!0});return(F,o)=>{const C=Ge("TresCanvas");return O(),j(C,Ve(r,{"window-size":""}),{default:N(()=>[o[0]||(o[0]=l("TresPerspectiveCamera",{position:[0,12,0],fov:75,near:.1,far:1e3,up:[0,0,-1]},null,-1)),D(Le(re),be(ze(u)),null,16),o[1]||(o[1]=l("TresAmbientLight",{intensity:8.8},null,-1)),o[2]||(o[2]=l("TresDirectionalLight",{position:[0,10,5],intensity:.2},null,-1)),o[3]||(o[3]=l("TresDirectionalLight",{position:[0,10,-5],intensity:.2},null,-1)),o[4]||(o[4]=l("TresDirectionalLight",{position:[5,10,0],intensity:.2},null,-1)),o[5]||(o[5]=l("TresDirectionalLight",{position:[-5,10,0],intensity:.2},null,-1)),o[6]||(o[6]=l("TresGridHelper",{args:[20,10]},null,-1)),(O(),j($e,null,{default:N(()=>[D(Pe)]),_:1}))]),_:1},16)}}});export{Je as default};
