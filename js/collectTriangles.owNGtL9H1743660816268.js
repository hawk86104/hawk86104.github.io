import{j as t,m as e,e as n,o as s,J as o}from"./@tresjs.zc7faK4J1743660816268.js";import"./index.T-vY6kZg1743660816268.js";import{T as r,aT as a,c as i,a8 as l,V as u,M as c,e as p,b as f,B as m,l as g,cb as d}from"./three.2wx8FU0g1743660816268.js";import{P as v}from"./tweakpane.ivGeiIdz1743660816268.js";import{c as h,d as y,a as j,I as b,C as w,N as _}from"./three-mesh-bvh.HGLjHqG91743660816268.js";import{d as x,a4 as T,b as M,a2 as I,o as L,H as k,N as A,u as B,F as C,r as O,e as S,j as z,g as R,m as F,f as H,al as P}from"./@vue.B5PFBfKs1743660816268.js";import{_ as X}from"./randomLoading.vue_vue_type_script_setup_true_lang.HuXlgv2z1743660816268.js";import"./postprocessing.ApTwx-211743660816268.js";import"./@vueuse.jtbb8I7w1743660816268.js";import"./utils.J8F9Jo-01743660816268.js";import"./@fesjs.9AUNBPBQ1743660816268.js";import"./vue-router.K4ys0Z-O1743660816268.js";import"./lodash-es.IJc9G_SW1743660816268.js";import"./@qlin.o0hjOMCg1743660816268.js";import"./pinia.0dYyFDku1743660816268.js";import"./@floating-ui.HzHndBae1743660816268.js";import"./@juggle.4EyLec-41743660816268.js";import"./three-mesh-ui.module._G62nyeC1743660816268.js";import"./starLoading.cJyZWFHa1743660816268.js";import"./cssLoaders.bhHKUWvv1743660816268.js";import"./bubbleLoading.rC3bW8Z-1743660816268.js";import"./yangyangLoading.yRjR1R_U1743660816268.js";!function(t,e){const n=N,s=J();for(;;)try{if(621095===-parseInt(n(221))/1*(-parseInt(n(238))/2)+parseInt(n(220))/3+parseInt(n(215))/4+parseInt(n(219))/5*(parseInt(n(209))/6)+parseInt(n(223))/7*(parseInt(n(199))/8)+-parseInt(n(233))/9+-parseInt(n(229))/10)break;s.push(s.shift())}catch(o){s.push(s.shift())}}();const Z=function(){let t=!0;return function(e,n){const s=t?function(){if(n){const t=n[N(222)](e,arguments);return n=null,t}}:function(){};return t=!1,s}}();!function(){Z(this,(function(){const t=N,e=new RegExp(t(210)),n=new RegExp("\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","i"),s=E(t(195));e.test(s+t(217))&&n[t(200)](s+t(193))?E():s("0")}))()}();const Y=function(){let t=!0;return function(e,n){const s=t?function(){if(n){const t=n.apply(e,arguments);return n=null,t}}:function(){};return t=!1,s}}();function N(t,e){const n=J();return N=function(t,e){return n[t-=189]},N(t,e)}Y(void 0,(function(){const t=N;let e;try{e=Function(t(224)+t(225)+");")()}catch(o){e=window}const n=e.console=e[t(226)]||{},s=[t(230),"warn","info",t(189),"exception",t(196),t(239)];for(let r=0;r<s[t(198)];r++){const e=Y.constructor[t(203)].bind(Y),o=s[r],a=n[o]||e;e[t(231)]=Y[t(202)](Y),e[t(228)]=a[t(228)][t(202)](a),n[o]=e}}))();function E(t){function e(t){const n=N;if("string"==typeof t)return function(t){}[n(234)](n(211))[n(222)](n(212));1!==(""+t/t)[n(198)]||t%20==0?function(){return!0}[n(234)](n(235)+n(205))[n(208)](n(237)):function(){return!1}[n(234)](n(235)+n(205)).apply(n(227)),e(++t)}try{if(t)return e;e(0)}catch(n){}}function J(){const t=["table","pointerdown","length","688HMSrPB","test","pointermove","bind","prototype","clientX","gger","innerWidth","Raycaster","call","192rrmBMF","function *\\( *\\)","while (true) {}","counter","setFromCamera","value","700596jjvWKO","innerHeight","chain","addEventListener","174410brMLpG","496623wQnvlz","201dPwxNC","apply","19936JSIQKG","return (function() ",'{}.constructor("return this")( )',"console","stateObject","toString","15127000hRRZxA","log","__proto__","pointerType","5624145NgtQNH","constructor","debu","pointerup","action","10516sPJkFO","trace","error","touch","button","clientY","input","firstHitOnly","init"];return(J=function(){return t})()}const Q=["geometry","material"],U=["geometry"],G=x({__name:"model",props:{controls:{}},async setup(s){let o,x;const O=s;m.prototype.computeBoundsTree=h,m.prototype.disposeBoundsTree=y,g.prototype.raycast=j;const S=([o,x]=T((()=>t(d,"./plugins/industry4/model/TR12J_OCC.stl"))),o=await o,x(),o),z=new a({color:16777215,roughness:.2,metalness:1,vertexColors:!0}),R=new Uint8Array(3*S.attributes.position.count);R.fill(255);const F=new i(R,3,!0);F.setUsage(l),S.setAttribute("color",F);const H=M(null),P=M(null),X=M(!1),Z=M(-1),Y=M(.2),E=new u,{camera:J,raycaster:G}=e(),W=15/255,K=78/255,V=85/255;let $=null;I((()=>{H.value&&(console.log("targetMesh.value init",H.value),H.value.geometry.computeBoundsTree(),$=S.boundsTree,((t,e,n,s,o,a)=>{const i=N;window[i(218)](i(201),(n=>{const s=i;t.x=n[s(204)]/window[s(206)]*2-1,t.y=-n[s(192)]/window[s(216)]*2+1,e[s(214)]=!0})),window.addEventListener(i(197),(l=>{const u=i;t.x=l.clientX/window[u(206)]*2-1,t.y=-l.clientY/window.innerHeight*2+1,s[u(214)]=l[u(191)];const c=new(r[u(207)]);c[u(213)](t,n[u(214)]),c[u(194)]=!0;const p=c.intersectObject(o[u(214)],!0);e.value=!0,a.enabled=0===p.length}),!0),window[i(218)](i(236),(t=>{const n=i;s[n(214)]=-1,t[n(232)]===n(190)&&(e[n(214)]=!1)}),!0)})(E,X,J,Z,H,O.controls.instance))}));const{onLoop:q}=n();q((()=>{const t=S.index;if(P.value)if(O.controls.instance.active||!X.value)P.value.visible=!1;else{P.value.scale.setScalar(Y.value),G.value.setFromCamera(E,J.value),G.value.firstHitOnly=!0;const e=G.value.intersectObject(H.value,!0);if(e.length){P.value.position.copy(e[0].point),O.controls.instance.enabled=!1,P.value.visible=!0;const n=new c;n.copy(H.value.matrixWorld).invert();const s=new p;s.center.copy(P.value.position).applyMatrix4(n),s.radius=100*Y.value;const o=[],r=new f;if($?.shapecast({intersectsBounds:t=>{const e=s.intersectsBox(t),{min:n,max:o}=t;if(e){for(let t=0;t<=1;t++)for(let e=0;e<=1;e++)for(let a=0;a<=1;a++)if(r.set(0===t?n.x:o.x,0===e?n.y:o.y,0===a?n.z:o.z),!s.containsPoint(r))return b;return w}return e?b:_},intersectsTriangle:(t,e,n)=>{if(n||t.intersectsSphere(s)){const t=3*e;o.push(t,t+1,t+2)}return!1}}),0===Z.value||2===Z.value){let e=1,n=1,s=1;0===Z.value&&(e=W,n=K,s=V);for(let r=0,a=o.length;r<a;r++){const a=t.getX(o[r]);F.setX(a,e),F.setY(a,n),F.setZ(a,s)}F.needsUpdate=!0}}else P.value.visible=!1,O.controls.instance.enabled=!0}}));const D=(new v).addButton({title:"点击按钮",label:"生成模型"}),tt=new m;return D.on("click",(()=>{const t=[],e=[];for(let s=0;s<F.count;s++)F.getX(s)===W&&F.getY(s)===K&&F.getZ(s)===V&&(t.push(S.attributes.position.getX(s),S.attributes.position.getY(s),S.attributes.position.getZ(s)),e.push(S.attributes.normal.getX(s),S.attributes.normal.getY(s),S.attributes.normal.getZ(s)));const n=new Float32Array(t);tt.setAttribute("position",new i(n,3)),tt.setAttribute("normal",new i(n,3))})),(t,e)=>(L(),k(C,null,[A("TresMesh",{ref_key:"targetMesh",ref:H,geometry:B(S),scale:.005,material:B(z)},null,8,Q),A("TresMesh",{ref_key:"brushMesh",ref:P,visible:!1},e[0]||(e[0]=[A("TresSphereGeometry",{args:[1,40,40]},null,-1),A("TresMeshStandardMaterial",{color:15483002,roughness:.75,metalness:0,transparent:!0,opacity:.5,premultipliedAlpha:!0,emissive:15483002,emissiveIntensity:.5},null,-1)]),512),A("TresMesh",{geometry:B(tt),position:[-2,-2,2],scale:.005},e[1]||(e[1]=[A("TresMeshStandardMaterial",{color:"#023249",roughness:.2,metalness:0,envMapIntensity:.2},null,-1)]),8,U)],64))}}),W=x({__name:"collectTriangles",setup(t){const e=O({clearColor:"#999999",antialias:!0}),n=O({autoRotate:!1}),r=M(null);return(t,a)=>{const i=S("TresCanvas");return L(),k(C,null,[z(B(X)),z(i,F(e,{"window-size":""}),{default:R((()=>[a[0]||(a[0]=A("TresPerspectiveCamera",{position:[5,1,15],fov:30,near:.1,far:1e3},null,-1)),z(B(s),F({ref_key:"controlsRef",ref:r},n),null,16),a[1]||(a[1]=A("TresAmbientLight",{intensity:1},null,-1)),(L(),H(P,null,{default:R((()=>[z(G,{controls:r.value},null,8,["controls"])])),_:1})),(L(),H(P,null,{default:R((()=>[z(B(o),{background:!1,files:["pos-x.jpg","neg-x.jpg","pos-y.jpg","neg-y.jpg","pos-z.jpg","neg-z.jpg"],path:"https://opensource.cdn.icegl.cn/images/skyBox/6jpg/"},null,8,["path"])])),_:1}))])),_:1},16)],64)}}});export{W as default};
