import{importShared as e}from"./3d-tiles-renderer.BWkWgmMi1767151797345.js";import{useTexture as t}from"./index.DdZsEhdb1767151797345.js";const r=await e("three"),{defineComponent:o}=await e("vue"),{createElementVNode:a,normalizeProps:n,guardReactiveProps:l,openBlock:u,createElementBlock:d}=await e("vue"),h=["rotation-x"],i=["args"],s=await e("three"),{watch:m,ref:v}=await e("vue"),p=o({__name:"whiteFloorMesh",props:{size:{default:[20,20]},color:{default:"#990"},shadowColor:{default:"#999"},edge:{default:.35}},setup(e){const o=e,p=v(),{state:f}=t("./plugins/floor/image/whiteFloor.jpg"),g={uniforms:s.UniformsUtils.merge([s.UniformsLib.lights,{uColor:{value:new s.Color(o.color)},uShadowColor:{value:new s.Color(o.shadowColor)},fEdge:{value:o.edge},uTexture:{value:null}}]),side:s.DoubleSide,vertexShader:`\n       varying vec2 vUv;\n\t\t\t \t${r.ShaderChunk.common}\n      \t${r.ShaderChunk.bsdfs}\n      \t${r.ShaderChunk.shadowmap_pars_vertex}\n       void main() {\n\t\t\t\t\t${r.ShaderChunk.beginnormal_vertex}\n          ${r.ShaderChunk.defaultnormal_vertex}\n          ${r.ShaderChunk.begin_vertex}\n          ${r.ShaderChunk.project_vertex}\n          ${r.ShaderChunk.worldpos_vertex}\n          ${r.ShaderChunk.shadowmap_vertex}\n\n           gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);    \n           vUv = uv;\n       }`,fragmentShader:`\n\tvarying vec2 vUv;\n\tuniform sampler2D uTexture;\n\tuniform vec3 uShadowColor;\n\tuniform vec3 uColor;\n\tuniform float fEdge;\n\t// ShaderMaterial 下的 纹理参数重复无效 要在着色器中增加\n\tfloat repeatTime = 100.0;\n\n\tfloat smoothsteps(float t) {\n\t\t\treturn t * t * (3.0 - 2.0 * t);\n\t}\n\n\t ${r.ShaderChunk.common}\n\t ${r.ShaderChunk.packing}\n\t ${r.ShaderChunk.bsdfs}\n\t ${r.ShaderChunk.lights_pars_begin}\n\t ${r.ShaderChunk.shadowmap_pars_fragment}\n\t ${r.ShaderChunk.shadowmask_pars_fragment}\n\n\tvoid main() {\n\t\t\tvec4 col = texture2D(uTexture, vUv * repeatTime);\n\t\t\tcol.rgb = mix( uColor , col.rgb ,0.5);\n\t\t\t\n\t\t\tfloat alpha = 1.0;\n\t\t\tfloat d = length(vUv - vec2(0.5));\n\t\t\tif(d > 0.35) {\n\t\t\t\t\talpha = 1.0 - smoothsteps( clamp( (d - 0.35) / (fEdge-0.2), 0.0, 1.0) );\n\t\t\t}\n\n\t\t vec3 addShadow = mix( uShadowColor , col.rgb ,getShadowMask());\n\n\t\t\tgl_FragColor = vec4(addShadow, alpha);  \n\t}`,lights:!0,transparent:!0};return m(f,e=>{e&&(e.wrapS=s.RepeatWrapping,e.wrapT=s.RepeatWrapping,e.repeat.set(6,3),p.value.material.uniforms.uTexture.value=e)}),m(()=>o.edge,e=>{g.uniforms.fEdge.value=e}),m(()=>o.color,e=>{g.uniforms.uColor.value=new s.Color(o.color)}),m(()=>o.shadowColor,e=>{g.uniforms.uShadowColor.value=new s.Color(o.shadowColor)}),(e,t)=>(u(),d("TresMesh",{ref_key:"tmRef",ref:p,"rotation-x":-Math.PI/2},[a("TresPlaneGeometry",{args:o.size},null,8,i),a("TresShaderMaterial",n(l(g)),null,16)],8,h))}});export{p as _sfc_main};
