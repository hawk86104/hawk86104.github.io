import{m as n,e as t,o as e}from"./@tresjs.W3PFJhMo1741658416045.js";import{_ as r,b as o}from"./three.FyUEtfsR1741658416045.js";import{P as a}from"./tweakpane.yDiyAAkA1741658416045.js";import{d as i,b as c,r as l,w as u,q as s,o as p,H as m,N as v,u as f,e as _,z as g,j as d,g as x,aj as h,ak as y,f as b,al as w,m as S,F as z}from"./@vue.NRI7TcgI1741658416045.js";import{_ as j}from"./@fesjs.hAnhKQG-1741658416045.js";import"./postprocessing.llR5x4wQ1741658416045.js";import"./@vueuse.5uFvLf9q1741658416045.js";import"./vue-router.qhodDV9M1741658416045.js";import"./lodash-es.pklfUAS51741658416045.js";import"./@qlin.yHhFDldE1741658416045.js";import"./pinia.Iw2DqQac1741658416045.js";import"./@floating-ui.BPbuo5Gx1741658416045.js";import"./@juggle.7yjBMqoW1741658416045.js";const k=F;!function(n,t){const e=F,r=P();for(;;)try{if(574948===parseInt(e(252))/1+parseInt(e(277))/2+-parseInt(e(236))/3+-parseInt(e(232))/4*(-parseInt(e(214))/5)+parseInt(e(276))/6+parseInt(e(257))/7+-parseInt(e(234))/8*(parseInt(e(283))/9))break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const I=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[F(246)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();!function(){I(this,(function(){const n=F,t=new RegExp(n(265)),e=new RegExp(n(226),"i"),r=R(n(248));t[n(288)](r+n(230))&&e[n(288)](r+n(244))?R():r("0")}))()}();const D=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e.apply(t,arguments);return e=null,n}}:function(){};return n=!1,r}}();D(void 0,(function(){const n=F,t=function(){const n=F;let t;try{t=Function(n(269)+n(240)+");")()}catch(e){t=window}return t}(),e=t.console=t[n(271)]||{},r=[n(218),n(250),n(222),"error",n(260),n(259),n(279)];for(let o=0;o<r[n(273)];o++){const t=D[n(239)][n(251)].bind(D),a=r[o],i=e[a]||t;t[n(212)]=D.bind(D),t[n(237)]=i[n(237)].bind(i),e[a]=t}}))();const V=["rotation-x"],O=["uniforms",k(278),k(233)];function P(){const n=["then","RepeatWrapping","addBinding","4572750keVzYU","string","table","exception","TresSphereGeometry","Display Settings","alphaVal","catch","function *\\( *\\)","u_volume","RedFormat","addFolder","return (function() ","Data3DTexture","console","TresShaderMaterial","length","gger","needsUpdate","4687140OFaXrV","1587856KBaZEt","vertexShader","trace","TresMesh","error","basicVolumeRendering","1084032emAgnO","minFilter","Error fetching volume data:","magFilter","counter","test","__proto__","isoValue","15WggJPt","LinearFilter","position","start","log","stateObject","Cross Section Settings","getElapsedTime","info","meshRef","action","expanded","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","Clock","u_alphaVal","color","chain","debu","976268rrtUCY","fragmentShader","192KQjVZo","u_dt","858966UEsAOA","toString","innerWidth","constructor",'{}.constructor("return this")( )',"Vector3","u_isoValue","innerHeight","input","Algorithm Settings","apply","arrayBuffer","init","u_color","warn","prototype","791453GvlmoC","value"];return(P=function(){return n})()}const M=41;function F(n,t){const e=P();return(F=function(n,t){return e[n-=212]})(n,t)}const A=i({__name:k(282),setup(e){var i;const _=k,g=window[_(238)],d=window[_(243)],x=c(null),h=c(null),y=new(r[_(227)]);y[_(217)]();const b=(new a)[_(268)]({title:_(262)}),w=b[_(268)]({title:_(220)}),S=new(r[_(241)])(.5,.5,.5);w[_(256)](S,"x",{label:"X",min:.02,max:.5,step:.02}),w[_(256)](S,"y",{label:"Y",min:.02,max:.5,step:.02}),w.addBinding(S,"z",{label:"Z",min:.02,max:.5,step:.02}),w[_(225)]=!0;const{camera:z}=n(),j=l({u_camera:{value:null==(i=z.value)?void 0:i[_(216)]},u_resolution:{value:new o(g,d,1)},u_dt:{value:.004},u_time:{value:0},u_crossSectionSize:{value:S},u_color:{value:1},u_volume:{value:null},u_isoValue:{value:.2},u_alphaVal:{value:.2}}),I=b[_(268)]({title:_(245)});I.addBinding(j[_(235)],_(253),{label:"dt",min:4e-4,max:.016,step:2e-4}),I[_(256)](j[_(249)],_(253),{label:_(229),min:1,max:3,step:1}),I[_(256)](j[_(228)],_(253),{label:_(263),min:.01,max:1,step:.01}),I.addBinding(j[_(242)],"value",{label:_(213),min:0,max:1,step:.04}),u(h,(n=>{const t=_;if(n){const e=new(r[t(270)])(n,M,M,M);e.format=r[t(267)],e[t(284)]=r[t(215)],e[t(286)]=r[t(215)],e.wrapT=r[t(255)],e[t(275)]=!0,j[t(266)][t(253)]=e}}));const{onLoop:D}=t();return D((()=>{const n=_;j.u_time[n(253)]=y[n(221)]()})),s((()=>{(()=>{const n=_;fetch("/plugins/volumeRendering/image/nucleon_41x41x41_uint8.raw")[n(254)]((t=>t[n(247)]()))[n(254)]((t=>{const e=n,r=new Uint8Array(t),o=new Uint8Array(68921);for(let n=0;n<r[e(273)];n++)o[n]=r[n];h[e(253)]=o}))[n(264)]((t=>{const e=n;console[e(281)](e(285),t)}))})()})),(n,t)=>{const e=_;return p(),m(e(280),{ref_key:e(223),ref:x,"rotation-x":Math.PI/-2},[t[0]||(t[0]=v(e(261),{args:[1,16,16]},null,-1)),v(e(272),{uniforms:j,vertexShader:f("precision mediump float;\n\nuniform vec3 u_camera;\nuniform vec3 u_resolution;\nuniform float u_time;\n\nvarying vec3 v_hitPos;\nvarying vec3 v_hitPosWorldSpace;\nvarying vec3 v_cameraObjectSpace;\n\nvoid main() {\n  vec3 pos = position;\n\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\n\n  v_hitPos = position.xyz;\n\n  v_hitPosWorldSpace = (modelMatrix * vec4(position, 1.0)).xyz;\n\n  v_cameraObjectSpace = (inverse(modelMatrix) * vec4(u_camera, 1.0)).xyz;\n}"),fragmentShader:f("precision mediump int;\nprecision mediump float;\n\nuniform vec3 u_camera;\nuniform vec3 u_resolution;\nuniform mediump sampler3D u_volume;\nuniform vec3 u_crossSectionSize;\nuniform float u_dt;\nuniform float u_time;\nuniform float u_color;\nuniform float u_isoValue;\nuniform float u_alphaVal;\n\nvec3 palette(in float t) {\n  vec3 a = vec3(0.5, 0.5, 0.5);\n  vec3 b = vec3(0.5, 0.5, 0.5);\n  vec3 c = vec3(1.0, 1.0, 1.0);\n  vec3 d = vec3(0.00, 0.33, 0.67);\n\n  return a + b * cos(6.28318 * (c * t + d));\n}\n\nvarying vec3 v_hitPos;\nvarying vec3 v_hitPosWorldSpace;\nvarying vec3 v_cameraObjectSpace;\n\nvec2 intersect_box(vec3 orig, vec3 dir) {\n\n  vec3 box_min = vec3(-u_crossSectionSize);\n  vec3 box_max = vec3(u_crossSectionSize);\n  vec3 inv_dir = 1.0 / dir;\n  vec3 tmin_tmp = (box_min - orig) * inv_dir;\n  vec3 tmax_tmp = (box_max - orig) * inv_dir;\n  vec3 tmin = min(tmin_tmp, tmax_tmp);\n  vec3 tmax = max(tmin_tmp, tmax_tmp);\n  float t0 = max(tmin.x, max(tmin.y, tmin.z));\n  float t1 = min(tmax.x, min(tmax.y, tmax.z));\n  return vec2(t0, t1);\n}\n\nvoid main() {\n  vec3 rayOrigin = vec3(0.0, 0.0, -3.0);\n  rayOrigin = v_cameraObjectSpace;\n\n  vec2 uv = 2.0 * gl_FragCoord.xy / u_resolution.xy - 1.0;\n  vec3 rayDir = normalize(vec3(uv, 1.0));\n  rayDir = normalize(v_hitPos - rayOrigin);\n\n  vec2 t_hit = intersect_box(rayOrigin, rayDir);\n  if (t_hit.x > t_hit.y) {\n    discard;\n  }\n\n  t_hit.x = max(t_hit.x, 0.0);\n\n  float dt = u_dt;\n\n  vec4 color = vec4(0.0);\n\n  vec3 p = rayOrigin + t_hit.x * rayDir + 0.5;\n  for (float t = t_hit.x; t < t_hit.y; t += dt) {\n\n    float textureVal = texture(u_volume, p).r;\n\n    vec4 val_color = vec4(0.0);\n    float val_color_alpha = textureVal * 0.1;\n\n    val_color_alpha = smoothstep(0.0, u_alphaVal, val_color_alpha);\n\n    vec3 red = vec3(1.0, 0.0, 0.0);\n    vec3 white = vec3(1.0);\n    if (abs(u_color - 1.0) <= 0.01) {\n      val_color = vec4(white, val_color_alpha);\n    } else if (abs(u_color - 2.0) <= 0.01) {\n      val_color = vec4(mix(red, white, val_color_alpha), val_color_alpha);\n    } else {\n      val_color = vec4(palette(textureVal), val_color_alpha);\n    }\n\n    color.rgb += (1.0 - color.a) * val_color.a * val_color.rgb;\n    color.a += (1.0 - color.a) * val_color.a;\n\n    if (textureVal > u_isoValue) {\n      float gxLess = texture(u_volume, vec3(p.x - rayDir.x * u_dt, p.y, p.z)).r;\n      float gxMore = texture(u_volume, vec3(p.x + rayDir.x * u_dt, p.y, p.z)).r;\n      float dgx = gxMore - gxLess;\n\n      float gyLess = texture(u_volume, vec3(p.x, p.y - rayDir.y * u_dt, p.z)).r;\n      float gyMore = texture(u_volume, vec3(p.x, p.y + rayDir.y * u_dt, p.z)).r;\n      float dgy = gyMore - gyLess;\n\n      float gzLess = texture(u_volume, vec3(p.x, p.y, p.z - rayDir.z * u_dt)).r;\n      float gzMore = texture(u_volume, vec3(p.x, p.y, p.z + rayDir.z * u_dt)).r;\n      float dgz = gzMore - gzLess;\n      vec3 n = normalize(vec3(dgx, dgy, dgz));\n\n      vec3 lightSource = vec3(1.0);\n      vec3 lightDir = normalize(lightSource);\n      float diffuseStrength = max(dot(n, lightDir), 0.0);\n\n      vec3 viewSource = normalize(rayOrigin);\n      vec3 reflectSource = normalize(reflect(-lightSource, n));\n      float specularStrength = max(0.0, dot(viewSource, reflectSource));\n      specularStrength = pow(specularStrength, 64.0);\n\n      color.rgb = diffuseStrength * val_color.rgb + specularStrength * val_color.rgb;\n      color.rgb *= val_color.rgb;\n      color.a = 0.95;\n      break;\n    }\n\n    if (color.a >= 0.95) {\n      break;\n    }\n\n    p += rayDir * dt;\n  }\n\n  gl_FragColor = color;\n}")},null,8,O)],8,V)}}});function R(n){function t(n){const e=F;if(typeof n===e(258))return function(n){}[e(239)]("while (true) {}")[e(246)](e(287));1!==(""+n/n).length||n%20==0?function(){return!0}[e(239)](e(231)+e(274)).call(e(224)):function(){return!1}[e(239)](e(231)+e(274))[e(246)](e(219)),t(++n)}try{if(n)return t;t(0)}catch(e){}}const C=W;!function(n,t){const e=W,r=T();for(;;)try{if(208361===-parseInt(e(363))/1+-parseInt(e(361))/2*(parseInt(e(346))/3)+parseInt(e(377))/4*(parseInt(e(379))/5)+parseInt(e(343))/6+parseInt(e(352))/7*(-parseInt(e(362))/8)+parseInt(e(369))/9+parseInt(e(365))/10*(-parseInt(e(364))/11))break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const E=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[W(348)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();!function(){E(this,(function(){const n=W,t=new RegExp(n(332)),e=new RegExp(n(368),"i"),r=Z(n(355));t[n(334)](r+n(356))&&e[n(334)](r+n(371))?Z():r("0")}))()}();const L=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[W(348)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();function T(){const n=["info","2PdabWR","32wBsNZk","22234QMWwOD","1133077iljPfJ","30jkYGyg","constructor","length","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","3434049dFBFWA","gger","input","console","TresCanvas",'{}.constructor("return this")( )',"div","table","1658728QHuPgx","#201919","5GYDNwY","function *\\( *\\)","while (true) {}","test","debu","__proto__","error","https://klacansky.com/open-scivis-datasets/skull/skull_256x256x256_uint8.raw"," https://klacansky.com/open-scivis-datasets/skull/skull_256x256x256_uint8.raw ","toString","prototype","basicVolume","944310ELjNQA","log","string","719340MgFQGk","warn","apply","bind","trace","exception","304906KQlsEW","_blank","counter","init","chain","call","return (function() ","TresGridHelper"];return(T=function(){return n})()}function W(n,t){const e=T();return(W=function(n,t){return e[n-=332]})(n,t)}L(void 0,(function(){const n=W,t=function(){const n=W;let t;try{t=Function(n(358)+n(374)+");")()}catch(e){t=window}return t}(),e=t.console=t[n(372)]||{},r=[n(344),n(347),"info",n(337),n(351),n(376),n(350)];for(let o=0;o<r[n(367)];o++){const t=L[n(366)][n(341)].bind(L),a=r[o],i=e[a]||t;t[n(336)]=L[n(349)](L),t.toString=i[n(340)][n(349)](i),e[a]=t}}))();function Z(n){function t(n){const e=W;if(typeof n===e(345))return function(n){}[e(366)](e(333))[e(348)](e(354));1!==(""+n/n).length||n%20==0?function(){return!0}[e(366)](e(335)+e(370))[e(357)]("action"):function(){return!1}[e(366)](e(335)+e(370))[e(348)]("stateObject"),t(++n)}try{if(n)return t;t(0)}catch(e){}}const B=j(i({__name:C(342),setup(n){const t=l({windowSize:!0,alpha:!0,antialias:!0,autoClear:!1,disableRender:!0}),r=l({enableDamping:!0,enableZoom:!0,enablePan:!0,enableRotate:!0,makeDefault:!0});return(n,o)=>{const a=W,i=_(a(373));return p(),m(z,null,[o[3]||(o[3]=v(a(375),{class:a(360)},[v("a",{href:a(338),target:a(353)},a(339)),v("br"),g(" 请自行下载数据集, 复制到 /plugins/volumeRendering/image/skull_256x256x256_uint8.raw 并更改文件请求指向和 dim 大小 ")],-1)),d(i,S({clearColor:a(378)},t),{default:x((()=>[o[0]||(o[0]=v("TresPerspectiveCamera",{fov:75,near:.001,far:1e3,position:[-1,.4,-1],"look-at":[0,0,0],up:[0,1,0]},null,-1)),o[1]||(o[1]=v("TresAmbientLight",{intensity:2},null,-1)),d(f(e),h(y(r)),null,16),(p(),b(w,null,{default:x((()=>[d(A,{position:[0,0,0]})])),_:1})),o[2]||(o[2]=v(a(359),{args:[50,50],position:[0,-5,0]},null,-1))])),_:1},16)],64)}}}),[["__scopeId","data-v-925b4c37"]]);export{B as default};
