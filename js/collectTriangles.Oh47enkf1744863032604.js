import{m as t,e,D as n,a as s,t as o}from"./@tresjs.DDZ0vesk1744863032604.js";import"./index.CLfAe2tm1744863032604.js";import{o as r,aI as a,c as i,a8 as l,a as u,M as c,S as p,V as f,B as m,l as g,ce as d}from"./three.B0XaFSnH1744863032604.js";import{P as h}from"./tweakpane.C0HtAJSg1744863032604.js";import{I as v,C as y,N as b,c as w,d as j,a as _}from"./three-mesh-bvh.CQMVAHAP1744863032604.js";import{d as x,a5 as T,b as I,a3 as M,H as A,o as k,F as C,J as z,u as B,r as S,h as X,j as L,f as Y,e as E,m as F,am as O}from"./@vue.DK6ok9LJ1744863032604.js";import{_ as Z}from"./randomLoading.vue_vue_type_script_setup_true_lang.uqzlj05I1744863032604.js";import"./postprocessing.DMK_Mhe01744863032604.js";import"./@vueuse.aRlY5CPe1744863032604.js";import"./utils.CppDyFGn1744863032604.js";import"./@fesjs.1a7Lul6Z1744863032604.js";import"./vue-router.CdrpVSr11744863032604.js";import"./lodash-es.BOsRjQhS1744863032604.js";import"./@qlin.q6OWdsQV1744863032604.js";import"./pinia.vfLI9vPt1744863032604.js";import"./@babel.BPq7uOAK1744863032604.js";import"./@floating-ui.BFjFSAYt1744863032604.js";import"./@juggle.CcBCnTIR1744863032604.js";import"./three-mesh-ui.module.skm2U1Jq1744863032604.js";import"./starLoading.BNOcuR8r1744863032604.js";import"./cssLoaders.DLMPsUpw1744863032604.js";import"./bubbleLoading.C7RD5z421744863032604.js";import"./yangyangLoading.Cpj0z4AE1744863032604.js";!function(){const t=H,e=D();for(;;)try{if(945800===parseInt(t(155))/1*(-parseInt(t(139))/2)+-parseInt(t(164))/3+parseInt(t(163))/4+parseInt(t(129))/5*(-parseInt(t(143))/6)+-parseInt(t(158))/7*(parseInt(t(148))/8)+parseInt(t(159))/9*(parseInt(t(140))/10)+parseInt(t(147))/11*(parseInt(t(141))/12))break;e.push(e.shift())}catch(n){e.push(e.shift())}}();const R=function(){let t=!0;return function(e,n){const s=t?function(){if(n){const t=n[H(132)](e,arguments);return n=null,t}}:function(){};return t=!1,s}}();!function(){R(this,(function(){const t=H,e=new RegExp("function *\\( *\\)"),n=new RegExp("\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","i"),s=P("init");e.test(s+t(166))&&n[t(169)](s+t(150))?P():s("0")}))()}();const U=function(){let t=!0;return function(e,n){const s=t?function(){if(n){const t=n[H(132)](e,arguments);return n=null,t}}:function(){};return t=!1,s}}();function H(t,e){const n=D();return H=function(t,e){return n[t-=127]},H(t,e)}function D(){const t=["innerHeight","154soAXnN","116001SDYFVB","while (true) {}","setFromCamera","console","332472tsPiEs","3051939ufJEwp","button","chain","string","action","test","pointerdown","exception","firstHitOnly","1605tiatMi","enabled","toString","apply","gger","clientY","addEventListener","info","intersectObject","constructor","2GzesEa","500bpFRDh","58206648awncAk","length","30684uUpElQ","touch","prototype","log","11XzUOwr","114224yCKsWA","pointerType","input","bind","clientX","table","debu","1659299AxboGD","value"];return(D=function(){return t})()}U(void 0,(function(){const t=H;let e;try{e=Function('return (function() {}.constructor("return this")( ));')()}catch(o){e=window}const n=e.console=e[t(162)]||{},s=[t(146),"warn",t(136),"error",t(127),t(153),"trace"];for(let r=0;r<s[t(142)];r++){const e=U[t(138)][t(145)][t(151)](U),o=s[r],a=n[o]||e;e.__proto__=U[t(151)](U),e[t(131)]=a.toString.bind(a),n[o]=e}}))();function P(t){function e(t){const n=H;if(typeof t===n(167))return function(t){}[n(138)](n(160))[n(132)]("counter");1!==(""+t/t).length||t%20==0?function(){return!0}.constructor(n(154)+n(133)).call(n(168)):function(){return!1}[n(138)](n(154)+n(133))[n(132)]("stateObject"),e(++t)}try{if(t)return e;e(0)}catch(n){}}const W=["geometry","material"],G=["geometry"],J=x({__name:"model",props:{controls:{}},async setup(s){let o,x;const S=s;m.prototype.computeBoundsTree=w,m.prototype.disposeBoundsTree=j,g.prototype.raycast=_;const X=([o,x]=T((()=>n(d,"./plugins/industry4/model/TR12J_OCC.stl"))),o=await o,x(),o),L=new a({color:16777215,roughness:.2,metalness:1,vertexColors:!0}),Y=new Uint8Array(3*X.attributes.position.count);Y.fill(255);const E=new i(Y,3,!0);E.setUsage(l),X.setAttribute("color",E);const F=I(null),O=I(null),Z=I(!1),R=I(-1),U=I(.2),D=new u,{camera:P,raycaster:J}=t(),V=15/255,N=78/255,Q=85/255;let $=null;M((()=>{F.value&&(console.log("targetMesh.value init",F.value),F.value.geometry.computeBoundsTree(),$=X.boundsTree,((t,e,n,s,o,a)=>{const i=H;window[i(135)]("pointermove",(n=>{const s=i;t.x=n[s(152)]/window.innerWidth*2-1,t.y=-n[s(134)]/window.innerHeight*2+1,e[s(156)]=!0})),window[i(135)](i(170),(l=>{const u=i;t.x=l[u(152)]/window.innerWidth*2-1,t.y=-l.clientY/window[u(157)]*2+1,s[u(156)]=l[u(165)];const c=new r;c[u(161)](t,n.value),c[u(128)]=!0;const p=c[u(137)](o[u(156)],!0);e[u(156)]=!0,a[u(130)]=0===p[u(142)]}),!0),window[i(135)]("pointerup",(t=>{const n=i;s[n(156)]=-1,t[n(149)]===n(144)&&(e.value=!1)}),!0)})(D,Z,P,R,F,S.controls.instance))}));const{onLoop:q}=e();q((()=>{const t=X.index;if(O.value)if(S.controls.instance.active||!Z.value)O.value.visible=!1;else{O.value.scale.setScalar(U.value),J.value.setFromCamera(D,P.value),J.value.firstHitOnly=!0;const e=J.value.intersectObject(F.value,!0);if(e.length){O.value.position.copy(e[0].point),S.controls.instance.enabled=!1,O.value.visible=!0;const n=new c;n.copy(F.value.matrixWorld).invert();const s=new p;s.center.copy(O.value.position).applyMatrix4(n),s.radius=100*U.value;const o=[],r=new f;if($?.shapecast({intersectsBounds:t=>{const e=s.intersectsBox(t),{min:n,max:o}=t;if(e){for(let t=0;t<=1;t++)for(let e=0;e<=1;e++)for(let a=0;a<=1;a++)if(r.set(0===t?n.x:o.x,0===e?n.y:o.y,0===a?n.z:o.z),!s.containsPoint(r))return v;return y}return e?v:b},intersectsTriangle:(t,e,n)=>{if(n||t.intersectsSphere(s)){const t=3*e;o.push(t,t+1,t+2)}return!1}}),0===R.value||2===R.value){let e=1,n=1,s=1;0===R.value&&(e=V,n=N,s=Q);for(let r=0,a=o.length;r<a;r++){const a=t.getX(o[r]);E.setX(a,e),E.setY(a,n),E.setZ(a,s)}E.needsUpdate=!0}}else O.value.visible=!1,S.controls.instance.enabled=!0}}));const K=(new h).addButton({title:"点击按钮",label:"生成模型"}),tt=new m;return K.on("click",(()=>{const t=[],e=[];for(let s=0;s<E.count;s++)E.getX(s)===V&&E.getY(s)===N&&E.getZ(s)===Q&&(t.push(X.attributes.position.getX(s),X.attributes.position.getY(s),X.attributes.position.getZ(s)),e.push(X.attributes.normal.getX(s),X.attributes.normal.getY(s),X.attributes.normal.getZ(s)));const n=new Float32Array(t);tt.setAttribute("position",new i(n,3)),tt.setAttribute("normal",new i(n,3))})),(t,e)=>(k(),A(C,null,[z("TresMesh",{ref_key:"targetMesh",ref:F,geometry:B(X),scale:.005,material:B(L)},null,8,W),z("TresMesh",{ref_key:"brushMesh",ref:O,visible:!1},e[0]||(e[0]=[z("TresSphereGeometry",{args:[1,40,40]},null,-1),z("TresMeshStandardMaterial",{color:15483002,roughness:.75,metalness:0,transparent:!0,opacity:.5,premultipliedAlpha:!0,emissive:15483002,emissiveIntensity:.5},null,-1)]),512),z("TresMesh",{geometry:B(tt),position:[-2,-2,2],scale:.005},e[1]||(e[1]=[z("TresMeshStandardMaterial",{color:"#023249",roughness:.2,metalness:0,envMapIntensity:.2},null,-1)]),8,G)],64))}}),V=x({__name:"collectTriangles",setup(t){const e=S({clearColor:"#999999",antialias:!0}),n=S({autoRotate:!1}),r=I(null);return(t,a)=>{const i=X("TresCanvas");return k(),A(C,null,[L(B(Z)),L(i,F(e,{"window-size":""}),{default:Y((()=>[a[0]||(a[0]=z("TresPerspectiveCamera",{position:[5,1,15],fov:30,near:.1,far:1e3},null,-1)),L(B(s),F({ref_key:"controlsRef",ref:r},n),null,16),a[1]||(a[1]=z("TresAmbientLight",{intensity:1},null,-1)),(k(),E(O,null,{default:Y((()=>[L(J,{controls:r.value},null,8,["controls"])])),_:1})),(k(),E(O,null,{default:Y((()=>[L(B(o),{background:!1,files:["pos-x.jpg","neg-x.jpg","pos-y.jpg","neg-y.jpg","pos-z.jpg","neg-z.jpg"],path:"https://opensource.cdn.icegl.cn/images/skyBox/6jpg/"},null,8,["path"])])),_:1}))])),_:1},16)],64)}}});export{V as default};
