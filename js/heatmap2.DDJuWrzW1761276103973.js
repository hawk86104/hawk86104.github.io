import{P as t}from"./tweakpane.CqZAnw7f1761276103973.js";import{a as e,b as a,l as o}from"./pagesShow.vue_vue_type_script_setup_true_lang.CD6zj33S1761276103973.js";import{h as s}from"./heatmap.js-fix.DoJI9SL91761276103973.js";import{b as i,z as r,cs as n,M as p,o as l,i as m,q as u,a6 as c}from"./three.Bhn4-0ry1761276103973.js";import{r as d}from"./utils.CI7v9zAv1761276103973.js";import{d as v}from"./pinia.C8YT0eOZ1761276103973.js";import{a as h,d as y,a3 as g,G as j,o as f,F as b,I as w,u as x,q as _,V as M,O as D,Q as I,M as P,N as T,ac as S,r as B,h as O,e as U,m as q}from"./@vue.CKlgtJke1761276103973.js";import{c as z,d as C,a as E}from"./three-mesh-bvh.BX5J_Zhe1761276103973.js";import{_ as R}from"./@fesjs.DnM7nINA1761276103973.js";import"./@tresjs.B_KjVy0E1761276103973.js";import"./postprocessing.CeTFUAN_1761276103973.js";import"./@vueuse.wtfleElW1761276103973.js";import"./Resource.CSaxGSPI1761276103973.js";import"./three-custom-shader-material.DSmV-ApW1761276103973.js";import"./buildingsCustomShaderMaterial.DyBo--wu1761276103973.js";import"./@amap.fjyZdsU91761276103973.js";import"./vanilla.esm.5.5.0.CRlEbOMK1761276103973.js";import"./object-hash.1qNYTrnD1761276103973.js";import"./jszip.y_yjJ09m1761276103973.js";import"./useTexture.B3KXI5F11761276103973.js";import"./vue-router.BFHj2xRz1761276103973.js";import"./lodash-es.DWe8oqPO1761276103973.js";import"./@qlin.y-0Z8WnK1761276103973.js";import"./@babel.BPq7uOAK1761276103973.js";import"./@floating-ui.Bhq4ibgf1761276103973.js";import"./@juggle.Vc7cP4_P1761276103973.js";const V=(t,e)=>t.getValueAt(e)+-10,k=v("buildingsHeatmap",()=>{const t=h(!1),e=h(0);return{showDiv:t,temperature:e,setShowDiv:function(e){t.value=e},setTemperature:function(t){e.value=t}}}),F=["object","rotation-x"],G=["object"],H=y({__name:"buildingsHeatmap",props:{model:{},opacity:{default:1}},setup(t){m.prototype.computeBoundsTree=z,m.prototype.disposeBoundsTree=C,l.prototype.raycast=E;const e=t,a=((t=250,e=250,a=!0)=>{const o=document.createElement("heatmap-canvas");return o.style.position="absolute",a||(o.style.display="none"),o.style.top="0",o.style.left="0",document.body.appendChild(o),s.create({container:o,width:t,height:e,blur:".8",radius:10,gradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"}})})();((t,e)=>{if(!e){let a=0;for(e=[];a<1e3;)e.push({x:i.randInt(1,t._config.width),y:i.randInt(1,t._config.height),value:i.randInt(-10,36)}),a++}t.setData({max:36,min:-10,data:e})})(a);const o=new r(a._renderer.canvas);o.needsUpdate=!0;const v=e.model.city.clone();delete v.geometry.attributes.normal,delete v.geometry.attributes.uv;const h=v.geometry.clone().applyMatrix4(v.matrix),y=e.model.land.clone();delete y.geometry.attributes.normal;const _=y.geometry.clone().applyMatrix4(y.matrix),M=n([h,_]);M.applyMatrix4((new p).makeRotationX(Math.PI/2)),d(M),M.computeBoundsTree();const D=(I=o,new u({vertexShader:"\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t\t\tvUv = uv;\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform sampler2D heightMap;\n\t\tuniform float uOpacity;\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tgl_FragColor = vec4(texture2D(heightMap, vUv.xy).rgb, uOpacity);\n    }\n\t\t",uniforms:{uOpacity:{value:e.opacity},heightMap:{type:"t",value:I}},depthWrite:!0,depthTest:!0,transparent:!0,side:c}));var I;const P=new l(M,D);g(()=>{e.opacity&&(D.uniforms.uOpacity.value=e.opacity)});const T=k(),S=t=>{if(t){const e={x:t.uv.x*a._config.width,y:(1-t.uv.y)*a._config.height};console.log("数值：",t),console.log("数值———：",V(a,e)),T.setTemperature(V(a,e))}},B=t=>{t&&T.$patch({showDiv:!0})},O=t=>{t&&T.setShowDiv(!1)};return(t,a)=>(f(),j(b,null,[w("primitive",{object:x(P),"rotation-x":-Math.PI/2,onPointermove:S,onPointerenter:B,onPointerleave:O},null,40,F),w("primitive",{object:e.model.model.children[0].clone()},null,8,G)],64))}}),L=R({__name:"dataDiv",setup(t){const e=k(),a=h({top:0,left:0});function o(t){a.value.left=t.clientX+5+"px",a.value.top=t.clientY-20+"px"}return _(()=>{window.addEventListener("mousemove",o)}),M(()=>{window.removeEventListener("mousemove",o)}),(t,o)=>D((f(),j("div",{class:"title",style:T(a.value)},"温度："+P(x(e).temperature)+"℃ ",5)),[[I,x(e).showDiv]])}},[["__scopeId","data-v-fac3e7fd"]]),X=y({__name:"heatmap2",async setup(s){let i,r;const n=h(!1),p=([i,r]=S(()=>o()),i=await i,r(),i);n.value=!0;const l=B({width:1,color:"#000",opacity:1,show:!0}),m=B({opacity:.9});return new t({title:"参数",expanded:!0}).addBinding(m,"opacity",{label:"透明度",min:0,max:1,step:.1}),(t,o)=>(f(),j(b,null,[O(a,{showBuildings:!1,autoRotate:!1},{ability:U(()=>[O(H,q({model:x(p)},m),null,16,["model"]),O(e,q(l,{builds:x(p).city}),null,16,["builds"])]),_:1}),O(L)],64))}});export{X as default};
