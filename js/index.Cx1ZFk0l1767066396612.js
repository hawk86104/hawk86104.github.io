import{i as e}from"./3d-tiles-renderer.CbgZh8zU1767066396612.js";import{M as l}from"./mqttTvt.DdS3HDCr1767066396612.js";import{_ as a}from"./@fesjs.BK66sTPr1767066396612.js";import{u as t,b as u,c as n,d as o,e as s,a as r,f as d,g as v,B as i,h as c,i as f,j as p}from"./naive-ui.CmwCmbKm1767066396612.js";const{createTextVNode:m,unref:_,withCtx:b,createVNode:w,renderList:h,Fragment:g,openBlock:y,createElementBlock:k,toDisplayString:T,createBlock:x}=await e("vue"),U={class:"w-full",style:{"background-color":"#ffffff"}},{ref:j,reactive:M,onUnmounted:C}=await e("vue"),q=a({__name:"MqttTesterUI",setup(e){const a=t(),p=M({host:"a5183db3.ala.asia-southeast1.emqxsl.com",port:8084,protocol:"wss",clientId:`tvt-test-client-${Math.random().toString(16).slice(2,8)}`,username:"tvt.js",password:"test",topic:"tvtDevices/#"}),q=j("tvtDevices/uiDemo"),B=j('{ "hello": "world" }'),I=j(null),N=j(!1),S=j([]),$=j(!1);function D(){I.value&&(I.value.removeAllListeners(),I.value.disconnect(),I.value=null,N.value=!1)}function Q(){D(),$.value=!0,I.value=new l(p),I.value.on("connected",()=>{N.value=!0,$.value=!1,a.success("MQTT 连接成功")}),I.value.on("close",()=>{N.value=!1,$.value=!1,a.warning("MQTT 连接关闭")}),I.value.on("error",e=>{$.value=!1,console.error(e),a.error(`MQTT 错误: ${e.message}`)}),I.value.on("message",(e,l)=>{S.value.push(`[${e}] ${JSON.stringify(l)}`),S.value.length>100&&S.value.shift()}),I.value.connect()}const J=j(new Set);function O(){if(I.value)for(const e of J.value)I.value.unsubscribe(e);J.value.clear(),D(),a.success("已断开连接")}function V(){if(!I.value||!N.value)return void a.warning("尚未连接 MQTT");const e=p.topic?.trim();e?J.value.has(e)?a.info(`已订阅该主题：${e}`):(I.value.subscribe(e),J.value.add(e),a.success(`订阅成功：${e}`)):a.warning("请输入订阅主题")}function A(){try{const e=JSON.parse(B.value);I.value.publish(q.value,e),a.info("已发送消息")}catch(e){a.error("JSON 格式错误")}}return C(()=>{O()}),(e,l)=>(y(),k("div",U,[w(_(u),{title:"MQTT 调试面板",class:"max-w-4xl mx-auto"},{default:b(()=>[w(_(n),{model:p,"label-width":"100"},{default:b(()=>[w(_(o),{label:"注意："},{default:b(()=>[w(_(s),{style:{"margin-left":"10px"},type:"warning"},{default:b(()=>[...l[8]||(l[8]=[m("免费服务每月流量/次数有限，若连接失败请自行更换自己的mqtt服务",-1)])]),_:1})]),_:1}),w(_(o),{label:"地址"},{default:b(()=>[w(_(r),{value:p.host,"onUpdate:value":l[0]||(l[0]=e=>p.host=e),placeholder:"例如: broker.hivemq.com"},null,8,["value"])]),_:1}),w(_(o),{label:"端口"},{default:b(()=>[w(_(d),{value:p.port,"onUpdate:value":l[1]||(l[1]=e=>p.port=e),min:1},null,8,["value"]),w(_(s),{style:{"margin-left":"10px"},type:"info"},{default:b(()=>[...l[9]||(l[9]=[m("浏览器端只支持：wws方式 的 mqtt",-1)])]),_:1})]),_:1}),w(_(o),{label:"Client ID"},{default:b(()=>[w(_(r),{value:p.clientId,"onUpdate:value":l[2]||(l[2]=e=>p.clientId=e),placeholder:"随机生成也可"},null,8,["value"])]),_:1}),w(_(o),{label:"用户名"},{default:b(()=>[w(_(r),{value:p.username,"onUpdate:value":l[3]||(l[3]=e=>p.username=e)},null,8,["value"])]),_:1}),w(_(o),{label:"密码"},{default:b(()=>[w(_(r),{value:p.password,"onUpdate:value":l[4]||(l[4]=e=>p.password=e)},null,8,["value"])]),_:1}),w(_(o),{label:"订阅主题"},{default:b(()=>[w(_(r),{value:p.topic,"onUpdate:value":l[5]||(l[5]=e=>p.topic=e),placeholder:"例如: tvt/demo"},null,8,["value"])]),_:1}),w(_(v),null,{default:b(()=>[w(_(i),{type:"primary",disabled:N.value||$.value,loading:$.value,onClick:Q},{default:b(()=>[...l[10]||(l[10]=[m("连接",-1)])]),_:1},8,["disabled","loading"]),w(_(i),{type:"warning",disabled:!N.value,onClick:O},{default:b(()=>[...l[11]||(l[11]=[m("断开",-1)])]),_:1},8,["disabled"]),w(_(i),{type:"success",disabled:!N.value,onClick:V},{default:b(()=>[...l[12]||(l[12]=[m("订阅",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"]),w(_(c),null,{default:b(()=>[...l[13]||(l[13]=[m("已订阅主题",-1)])]),_:1}),w(_(v),null,{default:b(()=>[(y(!0),k(g,null,h(Array.from(J.value),e=>(y(),x(_(s),{key:e,type:"info",round:""},{default:b(()=>[m(T(e),1)]),_:2},1024))),128))]),_:1}),w(_(c),null,{default:b(()=>[...l[14]||(l[14]=[m("发送消息 [主题/json消息]",-1)])]),_:1}),w(_(r),{value:q.value,"onUpdate:value":l[6]||(l[6]=e=>q.value=e),placeholder:"主题",class:"mb-2"},null,8,["value"]),w(_(r),{value:B.value,"onUpdate:value":l[7]||(l[7]=e=>B.value=e),type:"textarea",placeholder:'{ "key": "value" }',rows:4},null,8,["value"]),w(_(i),{type:"info",class:"mt-2",disabled:!N.value,onClick:A},{default:b(()=>[...l[15]||(l[15]=[m("发送",-1)])]),_:1},8,["disabled"]),w(_(c),null,{default:b(()=>[...l[16]||(l[16]=[m("收到的消息",-1)])]),_:1}),w(_(f),{log:S.value.join("\n"),rows:12},null,8,["log"])]),_:1})]))}},[["__scopeId","data-v-e8d1d438"]]),{createVNode:B,unref:I,withCtx:N,openBlock:S,createBlock:$}=await e("vue"),D={__name:"index",setup:e=>(e,l)=>(S(),$(I(p),null,{default:N(()=>[B(q)]),_:1}))};export{D as default};
