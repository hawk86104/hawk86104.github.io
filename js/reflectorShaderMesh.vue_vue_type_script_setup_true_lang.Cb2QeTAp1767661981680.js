import{importShared as e}from"./3d-tiles-renderer.COLnOnaF1767661981680.js";import{useTres as r,useTextures as o}from"./index.DJAV0vsW1767661981680.js";import{Reflector as t,ReflectorMaterial as i}from"./OimoPhysicsController.4F8LG_UT1767661981680.js";import{fixSpritesForMirror as l}from"./utils.BJ1fGVNw1767661981680.js";const{defineComponent:n}=await e("vue"),{unref:a,createElementVNode:f,openBlock:m,createElementBlock:c,createCommentVNode:s}=await e("vue"),u={key:0},p=["object"],d=["object"],{Vector2:w,PlaneGeometry:h,Mesh:v,RepeatWrapping:g,Color:x,GridHelper:y}=await e("three"),{watchEffect:S,watch:j}=await e("vue"),b=n({__name:"reflectorShaderMesh",props:{reflectivity:{default:.2},mirror:{default:.1},mixStrength:{default:9},showGridHelper:{type:Boolean,default:!0},color:{default:"#ffffff"}},setup(e){const n=e,{scene:b}=r(),{textures:M,isLoading:_}=o(["./plugins/floor/image/concrete_wet_floor_basecolor.jpg","./plugins/floor/image/concrete_wet_floor_normal.jpg"]);let C=null,G=null,k=null;return j([M,_],([e,r])=>{if(e&&2===e.length&&!r){e[0].wrapS=g,e[0].wrapT=g,e[1].wrapS=g,e[1].wrapT=g;const r=new t;C=new i({reflectivity:n.reflectivity,mirror:n.mirror,mixStrength:n.mixStrength,color:new x(n.color),map:e[0],normalMap:e[1],normalScale:new w(5,5),fog:b.value.fog,dithering:!0}),C.uniforms.tReflect=r.renderTargetUniform,C.uniforms.uMatrix=r.textureMatrixUniform;const o=new h(10,10);G=new v(o,C),G.name="reflectorShaderMesh",G.position.y=-.01,G.rotation.x=-Math.PI/2,G.add(r),G.onBeforeRender=(e,o,t)=>{G.visible=!1,l(o),r.update(e,o,t),l(o,!1),G.visible=!0},k=new y(9.5,10),k.visible=n.showGridHelper}}),S(()=>{n.reflectivity&&C&&(C.uniforms.uReflectivity.value=n.reflectivity),n.mirror&&C&&(C.uniforms.uMirror.value=n.mirror),n.mixStrength&&C&&(C.uniforms.uMixStrength.value=n.mixStrength),n.color&&C&&(C.uniforms.uColor.value=new x(n.color))}),j(()=>n.showGridHelper,e=>{k.visible=e}),(e,r)=>a(_)?s("",!0):(m(),c("TresGroup",u,[f("primitive",{object:a(G)},null,8,p),f("primitive",{object:a(k),position:[0,.01,0]},null,8,d)]))}});export{b as _sfc_main};
