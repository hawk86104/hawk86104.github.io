import"./index.DmevrT681749111073271.js";import{J as e,br as t,Y as a,B as o,c as l,l as s,n,d as r,bt as i,C as u,u as c,as as m,b0 as d,c9 as p,_ as v,O as f,ca as h,cb as g,cc as x,a as y,r as w,cd as b}from"./three.B8H7tP0r1749111073271.js";import{P}from"./tweakpane.C0HtAJSg1749111073271.js";import{Q as z,m as j,Z as S,e as _,k as M}from"./@tresjs.D5XVXE0C1749111073271.js";import{q as C,s as T,d as B}from"./@vueuse.BjDsO4x01749111073271.js";import{d as A,w as F,v as E,b as U,G as V,o as k,L as D,u as L,a3 as R,e as I,a2 as Y,r as N,h as X,j as q,I as G,f as O,am as W,ak as J,al as H,F as Z}from"./@vue.Mugdq9o81749111073271.js";import{l as $}from"./util.Db4laAsM1749111073271.js";import{l as K}from"./bubbleLoading.ca2CytEY1749111073271.js";import{_ as Q}from"./@fesjs.HpbjsMAs1749111073271.js";import"./utils.dcsI_f_N1749111073271.js";import"./three-mesh-ui.module.BsNNPLXV1749111073271.js";import"./postprocessing.CFk4752N1749111073271.js";import"./vue-router.ttOgDZer1749111073271.js";import"./lodash-es.C7pWAXPe1749111073271.js";import"./@qlin.q6OWdsQV1749111073271.js";import"./pinia.pLtK9Sf_1749111073271.js";import"./@babel.BPq7uOAK1749111073271.js";import"./@floating-ui.BFjFSAYt1749111073271.js";import"./@juggle.CcBCnTIR1749111073271.js";const ee=A({__name:"ScrollControls",props:{pages:{default:4},distance:{default:4},smoothScroll:{default:.1},horizontal:{type:Boolean,default:!1},htmlScroll:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{expose:t,emit:a}){const o=e,l=a,{logWarning:s}=z();o.smoothScroll<0&&s("SmoothControl must be greater than zero"),o.pages<0&&s("Pages must be greater than zero");const{camera:n,controls:r,renderer:i,invalidate:u}=j();F(o,(()=>{u()}));const c=E(),m=document.createElement("div"),{y:d}=C(),{x:p,y:v,isScrolling:f}=T(m),{height:h,width:g}=B();let x=0;const y=U(!1),w=U(0),b=U(0),P=U(0),_=o.horizontal?"x":"y",M=F(n,(e=>{y.value?M():(x=o.horizontal?e?.position.x||0:e?.position.y||0,y.value=!0)}),{immediate:!0});F(f,(e=>{r.value&&(r.value.enabled=!e)}),{immediate:!0}),F(d,(e=>{(f.value||o.htmlScroll)&&(b.value=e/h.value/(P.value/h.value-1),w.value=-1*b.value,l("update:modelValue",b.value))})),F(v,(e=>{b.value=e/h.value/(P.value/h.value),w.value=-1*b.value,l("update:modelValue",b.value)})),F(p,(e=>{b.value=e/g.value/(P.value/g.value-1),w.value=+b.value,l("update:modelValue",b.value)})),F(i,(e=>{const t=e?.domElement;if(o.htmlScroll&&e?.domElement)t?.style.width&&t?.style.position&&t?.style.top&&t?.style.left&&(t.style.width="100%",t.style.position="fixed",t.style.top="0",t.style.left="0"),P.value=document.body.scrollHeight;else{const a=document.createElement("div"),l=document.createElement("div");m.style[o.horizontal?"overflowX":"overflowY"]="auto",m.style[o.horizontal?"overflowY":"overflowX"]="hidden",m.style.position="absolute",m.style.width="100%",m.style.height=" 100%",m.style.top="0",m.style.left="0",m.classList.add("scrollContainer"),a.style.position="sticky",a.style.top="0px",a.style.left="0px",a.style.width="100%",a.style.height="100%",a.style.overflow="hidden",m.appendChild(a),l.style.height=o.horizontal?"100%":h.value*o.pages+"px",l.style.width=o.horizontal?g.value*o.pages+"px":"100vw",l.style.pointerEvents="none",t.style.position="fixed",t.style.zIndex="0",t?.style.width&&(t.style.width="100%"),m.appendChild(l),e?.domElement.parentNode&&(e.domElement.parentNode.style.position="relative"),e?.domElement?.parentNode?.appendChild(m),P.value=o.horizontal?g.value*o.pages:h.value*o.pages}}),{immediate:!0});const{onBeforeRender:A}=S();return A((({invalidate:e})=>{if(n.value?.position){const t=(w.value*o.distance-n.value.position[_]+x)*o.smoothScroll;n.value.position[_]+=t,c.value.children.length>0&&(c.value.position[_]+=t),e()}})),t({instance:c}),(e,t)=>(k(),V("TresGroup",{ref_key:"wrapperRef",ref:c},[D(e.$slots,"default")],512))}});const te=o=>{let l=o.attributes.position.count,s=Math.ceil(Math.sqrt(l)),n=Math.ceil(l/s),r=new Float32Array(s*n*4);!function(e){for(let t=Math.floor(e.length/3)-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));for(let o=0;o<3;o++){let l=e[3*t+o];e[3*t+o]=e[3*a+o],e[3*a+o]=l}}}(o.attributes.position.array);for(let e=0;e<l;e++){const t=o.attributes.position.array[3*e+0],a=o.attributes.position.array[3*e+1],l=o.attributes.position.array[3*e+2],s=0;r[4*e+0]=t,r[4*e+1]=a,r[4*e+2]=l,r[4*e+3]=s}let i=new e(r,s,n,t,a);return i.needsUpdate=!0,i},ae=()=>{const e=new n({uniforms:{uTextureA:{value:null},uTextureB:{value:null},uTime:{value:0},uScroll:{value:0}},vertexShader:"varying vec2 vUv;\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  vUv = uv;\n}",fragmentShader:"uniform sampler2D uTextureA;\nuniform sampler2D uTextureB;\nprecision mediump float; \nuniform float uTime;\nuniform float uScroll;\nvarying vec2 vUv;\n\nmat3 rotationMatrix3(vec3 axis, float angle) {\n  axis = normalize(axis);\n  float s = sin(angle);\n  float c = cos(angle);\n  float oc = 1. - c;\n\n  return mat3(oc * axis.x * axis.x + c, oc * axis.x * axis.y - axis.z * s,\n              oc * axis.z * axis.x + axis.y * s,\n              oc * axis.x * axis.y + axis.z * s, oc * axis.y * axis.y + c,\n              oc * axis.y * axis.z - axis.x * s,\n              oc * axis.z * axis.x - axis.y * s,\n              oc * axis.y * axis.z + axis.x * s, oc * axis.z * axis.z + c);\n}\n\nvoid main() {\n  vec3 textureA = rotationMatrix3(vec3(10., 6., 3.), sin(uTime) * .1) *\n                  texture2D(uTextureA, vUv).xyz;\n  \n\n  vec3 textureB = rotationMatrix3(vec3(10., 6., 3.), sin(uTime) * .1) *\n                  texture2D(uTextureB, vUv).xyz;\n  \n\n  float t = uScroll;\n  vec3 pos = mix(textureA, textureB, t);\n\n  gl_FragColor = vec4(pos, 1.);\n}"}),t=new o;return t.setAttribute("position",new l(new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]),3)),t.setAttribute("uv",new l(new Float32Array([0,1,1,1,1,0,0,1,1,0,0,0]),2)),new s(t,e)};const oe=["object"],le=A({__name:"particalMesh",props:{progress:{default:0},width:{default:256},height:{default:256}},setup(e,{expose:t}){const a=e;let s=((e,t)=>{const a=e*t;let s=new Float32Array(3*a);for(let o=0;o<a;o++){let a=3*o;s[a+0]=o%e/e,s[a+1]=o/e/t}const c=new o;return c.setAttribute("position",new l(s,3)),new r(c,new n({uniforms:{uPositions:{value:null},uSize:{value:12},uPixelRatio:{value:Math.min(window.devicePixelRatio,2)},uColor:{value:new u("#ffaa00")}},vertexShader:"uniform sampler2D\n    uPositions; \nuniform float uSize;\nuniform float uPixelRatio;\nvarying vec3 vPos;\nvarying vec2 vUv;\nvoid main() {\n  vec3 pos = texture2D(uPositions, position.xy).xyz;\n\n  float customSize = uSize;\n\n  vec4 modelPosition = modelMatrix * vec4(pos, 1.0);\n  vec4 viewPosition = viewMatrix * modelPosition;\n  vec4 projectionPosition = projectionMatrix * viewPosition;\n\n  gl_Position = projectionPosition;\n  gl_PointSize = customSize * uPixelRatio;\n  gl_PointSize *= (1.0 / -viewPosition.z);\n\n  vPos = pos;\n}",fragmentShader:"precision mediump float;\nvarying vec3 vPos;\nuniform vec3 uColor; \nvoid main() {\n\n  float distanceToCenter = distance(gl_PointCoord, vec2(0.5));\n  float strength = 0.05 / distanceToCenter - 0.1;\n\n  \n\n  gl_FragColor = vec4(uColor, strength * length(vPos));\n}",transparent:!0,depthWrite:!1,blending:i}))})(a.width,a.height);return t({particles:s}),(e,t)=>(k(),V("primitive",{object:L(s)},null,8,oe))}}),se=A({__name:"particalFBO",props:{progress:{default:0},width:{default:256},height:{default:256},color:{default:"#ffaa00"}},async setup(e){let o,l;const n=e,r=U(),i=new c(n.width,n.height,{minFilter:d,magFilter:d,generateMipmaps:!1,colorSpace:m,depthBuffer:!1,stencilBuffer:!1,format:t,type:a}),u=e=>{const t=[];return e.traverse((e=>{e instanceof s&&(e.geometry.deleteAttribute("uv"),e.geometry.deleteAttribute("normal"),e.geometry.deleteAttribute("tangent"),t.push(e.geometry))})),h(t)},g=new p,x=u(([o,l]=R((()=>$("./plugins/medical/model/brainparts.OBJ",g))),o=await o,l(),o));x.scale(.01,.01,.01);const y=te(x),w=u(([o,l]=R((()=>M("https://opensource.cdn.icegl.cn/model/eCommerce/guanYu.glb",{draco:!0,decoderPath:"./draco/"}))),o=await o,l(),o).scene.children[0]);w.rotateX(Math.PI/2),w.translate(0,-.9,0);const b=te(w),P=u(([o,l]=R((()=>M("./plugins/industry4/model/modelDraco.glb",{draco:!0,decoderPath:"./draco/"}))),o=await o,l(),o).scene.children[0]);P.rotateX(-Math.PI/2),P.rotateY(Math.PI/3),P.translate(0,0,0);const z=te(P),S=ae(),C=new v,T=new f(-1,1,1,-1,1/Math.pow(2,53),1);C.add(S);const{onBeforeLoop:B}=_(),{camera:A,renderer:F}=j();return B((({elapsed:e})=>{F.value&&A.value&&r.value&&(F.value.setRenderTarget(i),F.value.clear(),F.value.render(C,T),F.value.setRenderTarget(null),n.progress<.5?(S.material.uniforms.uTextureA.value=b,S.material.uniforms.uTextureB.value=y,S.material.uniforms.uScroll.value=2*n.progress):(S.material.uniforms.uTextureA.value=y,S.material.uniforms.uTextureB.value=z,S.material.uniforms.uScroll.value=2*(n.progress-.5)),S.material.uniforms.uTime.value=e,r.value.particles.material.uniforms.uPositions.value=i.texture,r.value.particles.material.uniforms.uColor.value.setStyle(n.color))})),(e,t)=>(k(),I(le,{ref_key:"pMesh",ref:r,progress:e.progress},null,8,["progress"]))}}),ne=A({__name:"particalPass",props:{use:{type:Boolean,default:!0}},setup(e){const a=e,{camera:o,renderer:l,scene:s,sizes:n}=j(),r=0,i=.472,u=1.61;let d=null;Y((()=>{n.width.value&&((e,a,o,l,s)=>{const n=new g(e,a),p=new x(new y(l,s),i,u,r),v=new c(l,s,{generateMipmaps:!1,minFilter:w,magFilter:w,format:t,colorSpace:m,samples:0});d=new b(o,v),d.addPass(n),d.addPass(p)})(s.value,o.value,l.value,n.width.value,n.height.value)}));const{onLoop:p}=_();return p((()=>{a.use?d&&d.render():l.value&&o.value&&l.value.render(s.value,o.value)})),(e,t)=>null}}),re=Q(A({__name:"scrollPartical",setup(e){const t=U(0);Y((()=>{console.log("jaime ~ progress:",t.value)}));const a={clearColor:"#000",outputColorSpace:m,windowSize:!0,renderMode:"manual",powerPreference:"high-performance",antialias:!1,alpha:!1,useLegacyLights:!1,physicallyCorrectLights:!0},o=N({pass:!1,color:"#ffaa00"}),l=new P({title:"参数",expanded:!0});return l.addBinding(o,"pass",{label:"后处理"}),l.addBinding(o,"color",{label:"颜色"}),(e,l)=>{const s=X("TresCanvas");return k(),V(Z,null,[q(L(K),{styleNum:4}),q(s,J(H(a)),{default:O((()=>[l[1]||(l[1]=G("TresPerspectiveCamera",{position:[0,0,-4],fov:45,near:.1,far:1e3,"look-at":[0,0,0]},null,-1)),q(ne,{use:o.pass},null,8,["use"]),q(ee,{modelValue:t.value,"onUpdate:modelValue":l[0]||(l[0]=e=>t.value=e),distance:10,"smooth-scroll":.1,htmlScroll:""},{default:O((()=>[(k(),I(W,null,{default:O((()=>[q(se,{progress:t.value,color:o.color},null,8,["progress","color"])])),_:1}))])),_:1},8,["modelValue"])])),_:1},16),l[2]||(l[2]=G("main",null,[G("section",null,[G("h1",null,"关羽 - GuanYu")]),G("section",null,[G("h1",{style:{"margin-left":"-11em","margin-bottom":"-10em"}},"大脑 - Brain")]),G("section",null,[G("h1",{style:{"margin-left":"11em","margin-bottom":"-10em"}},"设备 - Device")])],-1))],64)}}}),[["__scopeId","data-v-18b1351b"]]);export{re as default};
