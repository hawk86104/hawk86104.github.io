import{i as e}from"./3d-tiles-renderer.CbgZh8zU1767066396612.js";import{a,K as t,y as l,L as o}from"./@tresjs.B1f7s3pS1767066396612.js";import{d as r}from"./pinia.CiNhMlOJ1767066396612.js";import{G as n,Q as i}from"./three.BD1hRFgo1767066396612.js";import{P as s}from"./tweakpane.CqZAnw7f1767066396612.js";import{_ as c}from"./@fesjs.BK66sTPr1767066396612.js";import{u,t as m,v as d,b as p,g as f,B as v,w as y,x as h,a as g,y as w,z as b,A as k,j as x}from"./naive-ui.CmwCmbKm1767066396612.js";const{ref:S}=await e("vue"),_=r("materialDiyStore",()=>{const e=S("MeshBasicMaterial");return{curState:S({}),curType:e,curModelArrayBuffer:S(null)}}),{defineComponent:C}=await e("vue"),{unref:B,resolveDynamicComponent:M,mergeProps:j,openBlock:T,createBlock:P}=await e("vue"),{computed:A}=await e("vue"),L=C({__name:"materialDiy",setup(e){const a=_(),t=A(()=>`Tres${a.curType}`);return(e,l)=>(T(),P(M(t.value),j(B(a).curState,{transparent:"",flatShading:""}),null,16))}});const{defineComponent:N}=await e("vue"),{createVNode:z,createElementVNode:D,openBlock:E,createElementBlock:O,createCommentVNode:R}=await e("vue"),V={key:0,scale:.5},U=["position","rotation","scale","geometry"],{ref:F,watch:G}=await e("vue"),I=N({__name:"model",setup(e){const a=F(null),t=_();return G(()=>t.curModelArrayBuffer,async e=>{if(e){const t=await async function(e){const a=new n,t=new i;return t.setDecoderPath("./draco/"),a.setDRACOLoader(t),new Promise((t,l)=>{a.parse(e,"",e=>{t(e)},e=>{console.error("GLB 加载失败:",e),l(e)})})}(e);a.value=t.scene.children[0].children[0]}else a.value=null},{immediate:!0}),(e,t)=>a.value?(E(),O("TresGroup",V,[D("TresMesh",{position:a.value.position,rotation:a.value.rotation,scale:a.value.scale,geometry:a.value.geometry,"cast-shadow":""},[z(L)],8,U)])):R("",!0)}}),J={MeshBasicMaterial:{default:{color:"#161cff",wireframe:!1,opacity:1},config:{color:{name:"颜色",com:"ColorPicker"},wireframe:{name:"线框",com:"Switch"},opacity:{name:"透明度",com:"Slider",min:0,max:1,step:.01}}},MeshLambertMaterial:{default:{color:"#3ef561",wireframe:!1,opacity:1},config:{color:{name:"颜色",com:"ColorPicker"},wireframe:{name:"线框",com:"Switch"},opacity:{name:"透明度",com:"Slider",min:0,max:1,step:.01}}},MeshPhysicalMaterial:{default:{color:"#e75ff5",metalness:.45,roughness:.36,transmission:.33,reflectivity:.5,ior:1.5,opacity:1},config:{color:{name:"颜色",com:"ColorPicker"},metalness:{name:"金属度",com:"Slider",min:0,max:1,step:.01},roughness:{name:"粗糙度",com:"Slider",min:0,max:1,step:.01},reflectivity:{name:"反射率",com:"Slider",min:0,max:1,step:.01},ior:{name:"折射率",com:"Slider",min:1,max:2.33,step:.01},transmission:{name:"透光率",com:"Slider",min:0,max:1,step:.01},opacity:{name:"透明度",com:"Slider",min:0,max:1,step:.01}}}},{defineComponent:K}=await e("vue"),$=K({__name:"setupUI",setup(e){const a=_(),t=new s({title:"参数",expanded:!0}),l=Object.keys(J),o=[];l.forEach(e=>{o.push({text:e,value:e})}),t.addBlade({view:"list",label:"材质类型",options:o,value:l[2]}).on("change",e=>{n(e.value)});let r=null;const n=e=>{const l=J[e];a.curType=e,a.curState=JSON.parse(JSON.stringify(l.default)),r&&r.dispose(),r=t.addFolder({title:"材质属性"}),Object.keys(l.config).forEach(e=>{"ColorPicker"===l.config[e].com||"Switch"===l.config[e].com?r.addBinding(a.curState,e,{label:l.config[e].name}):"Slider"===l.config[e].com&&r.addBinding(a.curState,e,{label:l.config[e].name,min:l.config[e].min,max:l.config[e].max,step:l.config[e].step})})};return n(l[2]),(e,a)=>null}}),{withAsyncContext:H}=await e("vue"),{unref:Q,createVNode:q,createElementVNode:W,openBlock:X,createElementBlock:Y,createCommentVNode:Z,toDisplayString:ee,createTextVNode:ae,withCtx:te,Fragment:le}=await e("vue"),oe={key:0,class:"upload-mask"},re={class:"upload-mask-content"},ne={class:"image-uploader-panel"},ie={style:{"margin-bottom":"6px","padding-bottom":"6px","border-bottom":"2px solid #5f5f5f","word-break":"break-all"}},se={key:0},ce={key:1},ue={style:{"margin-top":"10px"}},me={key:2},de={style:{"margin-top":"10px"}},pe={style:{"margin-left":"30px","margin-top":"10px"}},{ref:fe,h:ve}=await e("vue"),ye=c({__name:"leftImg",async setup(e){let a,t;const l=_();l.curModelArrayBuffer=([a,t]=H(()=>async function(e){try{const a=await fetch(e);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return await a.arrayBuffer()}catch(a){return console.error("读取失败:",a),null}}("./plugins/hunyuan3D/model/icegl-bm.glb")),a=await a,t(),a);const o=u(),r=fe(null),n=fe("https://cdn.index.icegl.cn/uploads/20221122/9ed6756107c4e0c031ae26d54cb46c0d.png"),i=fe(!0),s=fe(!1),c=m(),k=fe("http://localhost:8081/generate");function x({file:e}){r.value=e.file,n.value=URL.createObjectURL(e.file)}async function S(){if(r.value){s.value=!0;try{const a={image:await(e=r.value,new Promise((a,t)=>{const l=new FileReader;l.readAsDataURL(e),l.onload=()=>{const e=l.result.split(",")[1];a(e)},l.onerror=t}))},t=await fetch(k.value,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});l.curModelArrayBuffer=await t.arrayBuffer(),i.value=!0,o.success("传递接口成功，模型已生成")}catch(a){console.error(a),o.error("传递接口失败")}finally{s.value=!1}var e}}function C(){if(!l.curModelArrayBuffer)return void o.error("没有可下载的模型");const e=new Blob([l.curModelArrayBuffer],{type:"model/gltf-binary"}),a=URL.createObjectURL(e);b(a,"generated-model.glb"),URL.revokeObjectURL(a)}function B(){r.value=null,n.value="",i.value=!1,l.curModelArrayBuffer=null}const M=()=>{const e=fe(""),a=fe(k.value);c.create({title:"请输入混元3D服务地址:",content:()=>ve("div",{},[ve(g,{value:a.value,placeholder:"服务说明详见'说明'按钮",onInput:t=>{a.value=t,e.value=""}}),e.value&&ve(w,{type:"error",style:"margin-top: 8px"},{default:()=>e.value})]),positiveText:"确认",negativeText:"取消",maskClosable:!1,onPositiveClick:()=>a.value.trim()?(k.value=a.value.trim(),!0):(e.value="配置不能为空",!1)})},j=()=>{window.open("https://icegl.cn/ask/article/22765.html","_blank")};return(e,a)=>(X(),Y(le,null,[s.value?(X(),Y("div",oe,[W("div",re,[q(Q(d),{size:"large"}),a[0]||(a[0]=W("div",{class:"upload-text"},"模型生成中，请稍候...",-1))])])):Z("",!0),W("div",ne,[q(Q(p),{title:"参考图片生产3D",size:"small",class:"panel-card","header-style":{textAlign:"center"},style:{backgroundColor:"#1a1a1a",color:"#ffffff",border:"1px solid #444"}},{default:te(()=>[W("div",ie,[a[3]||(a[3]=W("span",null,"混元3D服务：",-1)),a[4]||(a[4]=W("br",null,null,-1)),W("span",null,ee(k.value?k.value:"未配置"),1),q(Q(f),{justify:"end"},{default:te(()=>[q(Q(v),{type:"primary",size:"tiny",onClick:M},{default:te(()=>[...a[1]||(a[1]=[ae(" 设置 ",-1)])]),_:1}),q(Q(v),{type:"info",size:"tiny",style:{"margin-right":"6px"},onClick:j},{default:te(()=>[...a[2]||(a[2]=[ae(" 说明 ",-1)])]),_:1})]),_:1})]),s.value||i.value?Z("",!0):(X(),Y("div",se,[q(Q(y),{"default-upload":!1,"show-file-list":!1,accept:"image/*",onChange:x},{default:te(()=>[q(Q(v),{type:"primary",size:"small"},{default:te(()=>[...a[5]||(a[5]=[ae("选择图片",-1)])]),_:1})]),_:1})])),r.value&&!i.value?(X(),Y("div",ce,[q(Q(h),{src:n.value,width:"100",height:"100","object-fit":"cover",style:{"margin-top":"10px"}},null,8,["src"]),W("div",ue,[q(Q(v),{type:"success",size:"small",loading:s.value,onClick:S},{default:te(()=>[...a[6]||(a[6]=[ae(" 提交 ",-1)])]),_:1},8,["loading"])])])):Z("",!0),i.value?(X(),Y("div",me,[a[9]||(a[9]=W("span",null,"参考图片：",-1)),a[10]||(a[10]=W("br",null,null,-1)),q(Q(h),{src:n.value,width:"100",height:"100","object-fit":"cover",style:{"margin-top":"10px"}},null,8,["src"]),q(Q(f),null,{default:te(()=>[W("div",de,[q(Q(v),{type:"info",size:"small",onClick:B},{default:te(()=>[...a[7]||(a[7]=[ae("重新生产",-1)])]),_:1})]),W("div",pe,[q(Q(v),{type:"success",size:"small",onClick:C},{default:te(()=>[...a[8]||(a[8]=[ae("下载模型",-1)])]),_:1})])]),_:1})])):Z("",!0)]),_:1})])],64))}},[["__scopeId","data-v-75b74eb7"]]),{defineComponent:he}=await e("vue"),{createElementVNode:ge,unref:we,createVNode:be,withCtx:ke,mergeProps:xe,Fragment:Se,openBlock:_e,createElementBlock:Ce}=await e("vue"),{SRGBColorSpace:Be,BasicShadowMap:Me,NoToneMapping:je}=await e("three"),{reactive:Te,ref:Pe,watchEffect:Ae}=await e("vue"),Le=he({__name:"index",setup(e){const r=Te({clearColor:"#201919",shadows:!0,alpha:!1,shadowMapType:Me,outputColorSpace:Be,toneMapping:je}),n=Pe(null);return Ae(()=>{n.value&&(n.value.shadow.mapSize.width=1024,n.value.shadow.mapSize.height=1024,n.value.shadow.camera.near=.1,n.value.shadow.camera.far=10,n.value.shadow.camera.left=-1,n.value.shadow.camera.right=1,n.value.shadow.camera.top=1,n.value.shadow.camera.bottom=-1,n.value.shadow.bias=-1e-4)}),(e,i)=>(_e(),Ce(Se,null,[be(we(a),xe(r,{"window-size":""}),{default:ke(()=>[i[1]||(i[1]=ge("TresPerspectiveCamera",{position:[0,1,2],fov:45,near:.1,far:1e3},null,-1)),be(we(t)),i[2]||(i[2]=ge("TresAmbientLight",{intensity:2},null,-1)),be(we(l),null,{default:ke(()=>[be(I)]),_:1}),be(we(o),{floor:1,segments:20,position:[-.1,-.8,-.5],scale:[4,2,2],"receive-shadow":""},{default:ke(()=>[...i[0]||(i[0]=[ge("TresMeshPhysicalMaterial",{color:"orange",roughness:1,receiveShadow:""},null,-1)])]),_:1}),ge("TresDirectionalLight",{position:[1,1,2],intensity:6,"cast-shadow":"",ref_key:"tdl",ref:n},null,512)]),_:1},16),be($),be(we(k),null,{default:ke(()=>[be(we(x),null,{default:ke(()=>[be(ye)]),_:1})]),_:1})],64))}});export{Le as default};
