import{i as e}from"./3d-tiles-renderer.CbgZh8zU1767066396612.js";import{n as t}from"./@tresjs.B1f7s3pS1767066396612.js";import{R as i,b as r}from"./OimoPhysicsController.DV_wbu041767066396612.js";import{q as l}from"./vite-plugin-qiankun.B06WoCqG1767066396612.js";import{f as a}from"./utils.CNife3_q1767066396612.js";const{defineComponent:o}=await e("vue"),{unref:s,createElementVNode:n,openBlock:u,createElementBlock:c,createCommentVNode:v}=await e("vue"),p=["scale"],f=["object"],_=["object"],m=await e("three"),{Mesh:d,PlaneGeometry:w,RepeatWrapping:b,GridHelper:h}=await e("three"),{watchEffect:j,watch:B,ref:E,toRaw:g}=await e("vue"),N=o({__name:"reflectorDUDV",props:{reflectivity:{default:.8},showGridHelper:{type:Boolean,default:!0},scale:{default:1},ignoreObjects:{default:()=>[]},size:{default:()=>[10,10]},mapUrl:{default:"./plugins/floor/image/waterdudv.jpg"}},setup(e,{expose:o}){const N=e,U=new i,y=new h(N.size[0]-.5,N.size[1]);y.visible=N.showGridHelper;let I=N.mapUrl;l.__POWERED_BY_QIANKUN__&&(I=l.__INJECTED_PUBLIC_PATH_BY_QIANKUN__+I,console.log("qiankunWindow.__INJECTED_PUBLIC_PATH_BY_QIANKUN__",l.__INJECTED_PUBLIC_PATH_BY_QIANKUN__),console.log("process.env.BASE_URL","./"));let C=null,P=E(null);const{state:R,isLoading:T}=t(I);return B(()=>R.value,e=>{e&&(e.wrapS=b,e.wrapT=b,e.colorSpace=m.SRGBColorSpace,e.repeat.set(6,3),C=new r({map:e,reflectivity:N.reflectivity}),C.uniforms.tReflect={value:U.renderTarget.texture},C.uniforms.tReflectBlur=U.renderTargetUniform,C.uniforms.uMatrix=U.textureMatrixUniform,P.value=new d(new w(N.size[0],N.size[1]),void 0),P.value.material=C,P.value.rotation.x=-Math.PI/2,P.value.add(U),P.value.onBeforeRender=(e,t,i)=>{P.value.visible=!1,N.ignoreObjects.forEach(e=>{e.isMesh&&(e.visible=!1),e.value&&e.value.isMesh&&(e.value.visible=!1)}),a(t),U.update(e,t,i),a(t,!1),N.ignoreObjects.forEach(e=>{e.isMesh&&(e.visible=!0),e.value&&e.value.isMesh&&(e.value.visible=!0)}),P.value.visible=!0})}),j(()=>{N.reflectivity&&C&&(C.uniforms.uReflectivity.value=N.reflectivity)}),B(()=>N.showGridHelper,e=>{y.visible=e}),o({reflector:U}),(e,t)=>s(T)?v("",!0):(u(),c("TresGroup",{key:0,scale:[e.scale,1,e.scale]},[n("primitive",{object:g(s(P)),"position-y":-.01},null,8,f),n("primitive",{object:s(y)},null,8,_)],8,p))}});export{N as _};
