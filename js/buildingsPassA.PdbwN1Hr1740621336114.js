import{b as n}from"./pagesShow.vue_vue_type_script_setup_true_lang.8rpFpTwf1740621336114.js";import{c5 as t,_ as e,c3 as o,cg as r,C as i,cr as u}from"./three.sXv6UbbL1740621336114.js";import{m as a,e as s}from"./@tresjs.Td0X-dew1740621336114.js";import{d as c,a2 as l,r as p,o as f,f as d,g as v,j as m,aj as h,ak as w}from"./@vue.NRI7TcgI1740621336114.js";import{P as x}from"./tweakpane.yDiyAAkA1740621336114.js";import"./three-custom-shader-material.zFJQzgaY1740621336114.js";import"./buildingsCustomShaderMaterial.hq-IAd4G1740621336114.js";import"./@vueuse.cgJUSr_21740621336114.js";const P=S;function S(n,t){const e=I();return(S=function(n,t){return e[n-=434]})(n,t)}!function(n,t){const e=S,o=I();for(;;)try{if(958e3===parseInt(e(484))/1*(parseInt(e(462))/2)+-parseInt(e(469))/3*(parseInt(e(452))/4)+parseInt(e(465))/5*(parseInt(e(471))/6)+parseInt(e(476))/7*(parseInt(e(487))/8)+-parseInt(e(459))/9+-parseInt(e(494))/10+-parseInt(e(446))/11*(-parseInt(e(493))/12))break;o.push(o.shift())}catch(r){o.push(o.shift())}}();const g=function(){let n=!0;return function(t,e){const o=n?function(){if(e){const n=e.apply(t,arguments);return e=null,n}}:function(){};return n=!1,o}}();!function(){g(this,(function(){const n=S,t=new RegExp(n(495)),e=new RegExp("\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","i"),o=_(n(434));t[n(489)](o+"chain")&&e[n(489)](o+n(478))?_():o("0")}))()}();const y=function(){let n=!0;return function(t,e){const o=n?function(){if(e){const n=e.apply(t,arguments);return e=null,n}}:function(){};return n=!1,o}}();function I(){const n=["time","string","debu","action","while (true) {}","4AjxQKs","uScalenum","call","return (function() ","uniforms","depthTexture","readBuffer","14668695jrihSU","uColor","console","2WqfwkV","#FFF","uScaleone","10whFTWw","ShaderMaterial","uPosition","speed","3729477uhYaMa","matrixWorld","736920XOHVBQ","addPass","Vector2","set","apply","25193nWhqOS","material","input","color","value","bind",'{}.constructor("return this")( )',"error","661183hfVIpo","depthBuffer","log","856keOlYC","uWidth","test","length","constructor","projectionMatrixInverse","7188dBAVaV","6068500uILGEp","function *\\( *\\)","Color","init","DepthTexture","counter","info","toString","stateObject","exception","table","width","warn","render","gger","57772cXDovN"];return(I=function(){return n})()}y(void 0,(function(){const n=S;let t;try{t=Function(n(455)+n(482)+");")()}catch(r){t=window}const e=t.console=t[n(461)]||{},o=[n(486),n(443),n(437),n(483),n(440),n(441),"trace"];for(let i=0;i<o[n(490)];i++){const t=y[n(491)].prototype[n(481)](y),r=o[i],u=e[r]||t;t.__proto__=y[n(481)](y),t[n(438)]=u[n(438)][n(481)](u),e[r]=t}}))();const b=c({__name:"buildingsPassA",props:{color:{default:P(463)},uScalenum:{default:150},uScaleone:{default:24},uWidth:{default:1},speed:{default:1},uPosition:{default:{x:0,y:0}}},setup(n){const c=n,{renderer:p,scene:f,camera:d,sizes:v}=a();let m,h=0,w=null,x=null;l((()=>{const n=S;v.width[n(480)]&&(m=v[n(442)].value,h=v.height[n(480)],(()=>{const n=S;w=new t(p[n(480)]);const a=new(e[n(435)])(m,h);w[n(458)][n(485)]=!0,w[n(458)][n(457)]=a;const s=new o(f.value,d[n(480)]);w[n(472)](s),x=new r(new(e[n(466)])({uniforms:{time:{value:0},tDiffuse:{value:null},depthTexture:{value:a},uProjectionInverse:{value:d.value[n(492)]},uMatrixWorld:{value:d[n(480)][n(470)]},uColor:{value:new i(c[n(479)])},uScalenum:{value:c.uScalenum},uScaleone:{value:c[n(464)]},uWidth:{value:c[n(488)]},uPosition:{value:new(e[n(473)])(c[n(467)].x,c.uPosition.y)}},vertexShader:"varying vec2 vUv;\nvarying vec3 vPosition;\n\nvoid main(){\n\tvUv=uv;\n\tvPosition=position;\n\tgl_Position=vec4(position,1.);\n}\n",fragmentShader:"varying vec2 vUv;\nvarying vec3 vPosition;\nuniform sampler2D tDiffuse;\nuniform sampler2D depthTexture;\n\nuniform mat4 uProjectionInverse;\nuniform mat4 uMatrixWorld;\n\nuniform float time;\nuniform vec3 uColor;\nuniform float uScalenum;//最大范围\nuniform float uScaleone;//单条圈间距\nuniform float uWidth;//单条厚度\nuniform vec2 uPosition;//位置\n\nvec3 WorldPosFromDepth(float depth){\n\tfloat z=(depth-.5)*2.;\n\tvec4 clipSpacePosition=vec4(vPosition.xy,z,1.);\n\tvec4 viewSpacePosition=uProjectionInverse*clipSpacePosition;\n\tviewSpacePosition/=viewSpacePosition.w;\n\tvec4 worldSpacePosition=uMatrixWorld*viewSpacePosition;\n\treturn worldSpacePosition.xyz;\n}\nvec3 WorldPosFromDepth2(float depth){\n\t// 规范化设备坐标系 ndc (Normalized Device Coordinates)\n\tvec4 ndc=vec4(vPosition.x,vPosition.y,((depth-.5)*2.),1.);\n\t// 根据视图中的位置和深度逆向MVP (ModelViewProjectionMatrix) 以获取真实渲染的位置\n\tvec4 worldSpacePosition=uMatrixWorld*uProjectionInverse*ndc;\n\t// 由于透视相机视图区域是一个截锥体 在乘以矩阵后，结果不在同一个射影空间上（这意味着 w 分量不是每个顶点的 1）\n\t// 为了完成转换，我们需要将向量的每个分量除以 w 分量本身\n\t// 这一步正常渲染时在GPU中做 我们复原需要手动处理\n\tworldSpacePosition/=worldSpacePosition.w;\n\treturn worldSpacePosition.xyz;\n}\n\nvoid main(){\n\tvec4 base=texture2D(tDiffuse,vUv);//之前的纹理\n\tfloat depth=texture2D(depthTexture,vUv).r;\n\t\n\t// vec3 pos=WorldPosFromDepth(depth);\n\tvec3 pos=WorldPosFromDepth2(depth);\n\tpos.x=pos.x+uPosition.x;\n\tpos.z=pos.z+uPosition.y;\n\tfloat dis=distance(pos.xz,vec2(0,0));\n\tvec3 color=vec3(base);\n\tif(pos.y<=0.){\n\t\tdiscard;\n\t}\n\tif(dis<uScalenum){\n\t\tvec3 scanT=uColor;\n\t\tfloat wave=fract((dis-time*10.)/uScaleone);\n\t\tif(wave<uWidth){\n\t\t\tfloat p=wave/uWidth;\n\t\t\tcolor=mix(color,scanT+.1,p*(1.-(dis/uScalenum)));\n\t\t}\n\t}\n\tgl_FragColor=vec4(color,1.);\n}\n"})),w.addPass(x);const l=new r(u);w[n(472)](l)})())}));const{onLoop:P}=s();return P((({elapsed:n})=>{const t=S;w&&(w[t(444)](),x[t(456)][t(447)].value+=c[t(468)]/60)})),l((()=>{const n=S;x&&(c.color&&(x.material[n(456)][n(460)][n(480)]=new(e[n(496)])(c[n(479)])),c[n(453)]&&(x[n(477)][n(456)][n(453)].value=c[n(453)]),c[n(464)]&&(x[n(477)][n(456)][n(464)][n(480)]=c.uScaleone),c.uWidth&&(x.material.uniforms[n(488)][n(480)]=c[n(488)]),c[n(467)]&&x.material[n(456)].uPosition[n(480)][n(474)](c[n(467)].x,c[n(467)].y))})),(n,t)=>null}});function _(n){function t(n){const e=S;if(typeof n===e(448))return function(n){}.constructor(e(451))[e(475)](e(436));1!==(""+n/n)[e(490)]||n%20==0?function(){return!0}[e(491)](e(449)+e(445))[e(454)](e(450)):function(){return!1}[e(491)](e(449)+e(445))[e(475)](e(439)),t(++n)}try{if(n)return t;t(0)}catch(e){}}const j=C;function W(){const n=["单条圈宽度","exception","20097Opmkvf","buildingsPassA","action","apply","trace","warn","string","uWidth","最大范围","9395180yStzam","uScaleone","10789438kHOgGJ","圈颜色","length","toString","231394uxOmJm","debu","830uGpVna","chain","inline","addBinding","error","counter","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","bind","4936hVyJNo","stateObject","input","table","11821516nrXemj","615xOaNjU","color","test","info","constructor","6tmHCok","uPosition","log","单条圈间距","13326hwkYCo","gger","708JLILyJ"];return(W=function(){return n})()}!function(n,t){const e=C,o=W();for(;;)try{if(856962===parseInt(e(450))/1*(-parseInt(e(430))/2)+-parseInt(e(445))/3*(-parseInt(e(412))/4)+-parseInt(e(432))/5*(-parseInt(e(454))/6)+parseInt(e(444))/7+parseInt(e(440))/8*(parseInt(e(415))/9)+-parseInt(e(424))/10+-parseInt(e(426))/11)break;o.push(o.shift())}catch(r){o.push(o.shift())}}();const z=function(){let n=!0;return function(t,e){const o=n?function(){if(e){const n=e[C(418)](t,arguments);return e=null,n}}:function(){};return n=!1,o}}();!function(){z(this,(function(){const n=C,t=new RegExp("function *\\( *\\)"),e=new RegExp(n(438),"i"),o=F("init");t[n(447)](o+n(433))&&e[n(447)](o+n(442))?F():o("0")}))()}();const D=function(){let n=!0;return function(t,e){const o=n?function(){if(e){const n=e[C(418)](t,arguments);return e=null,n}}:function(){};return n=!1,o}}();function C(n,t){const e=W();return(C=function(n,t){return e[n-=411]})(n,t)}D(void 0,(function(){const n=C,t=function(){let n;try{n=Function('return (function() {}.constructor("return this")( ));')()}catch(t){n=window}return n}(),e=t.console=t.console||{},o=[n(452),n(420),n(448),n(436),n(414),n(443),n(419)];for(let r=0;r<o[n(428)];r++){const t=D[n(449)].prototype[n(439)](D),i=o[r],u=e[i]||t;t.__proto__=D[n(439)](D),t[n(429)]=u[n(429)][n(439)](u),e[i]=t}}))();const k=c({__name:j(416),setup(t){const e=j,o=p({color:"#00b4fb",uScalenum:250,uScaleone:82,uWidth:.2,speed:10,uPosition:{x:0,y:0}}),r=new x({title:"后期效果",expanded:!0});return r[e(435)](o,e(446),{label:e(427)}),r[e(435)](o,"uScalenum",{label:e(423),min:1,max:500,step:10}),r[e(435)](o,e(425),{label:e(453),min:1,max:100,step:1}),r.addBinding(o,e(422),{label:e(413),min:0,max:1,step:.01}),r[e(435)](o,"speed",{label:"速度",min:1,max:20,step:1}),r.addBinding(o,e(451),{picker:e(434),label:"位置",expanded:!0,x:{min:-1e3,max:1e3,step:10},y:{min:-1e3,max:1e3,step:10}}),(t,e)=>(f(),d(n,{disableRender:!0,showAxesHelper:!1},{ability:v((()=>[m(b,h(w(o)),null,16)])),_:1}))}});function F(n){function t(n){const e=C;if(typeof n===e(421))return function(n){}.constructor("while (true) {}").apply(e(437));1!==(""+n/n)[e(428)]||n%20==0?function(){return!0}.constructor(e(431)+e(411)).call(e(417)):function(){return!1}.constructor("debugger")[e(418)](e(441)),t(++n)}try{if(n)return t;t(0)}catch(e){}}export{k as default};
