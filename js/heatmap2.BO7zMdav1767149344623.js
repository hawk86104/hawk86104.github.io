import{importShared as e,mergeGeometries as t}from"./3d-tiles-renderer.de6b_qgz1767149344623.js";import{Pane as o}from"./tweakpane.BbuIEN141767149344623.js";import{loadCityFBX as a,_sfc_main as n,_sfc_main$2 as i}from"./pagesShow.vue_vue_type_script_setup_true_lang.CrL9_aV81767149344623.js";import{h337 as r}from"./heatmap.BEIXqjKA1767149344623.js";import{resetUV as l}from"./utils.CDk3Ydqj1767149344623.js";import{defineStore as s,_export_sfc as u}from"./index.Btae5S5d1767149344623.js";import{computeBoundsTree as c,disposeBoundsTree as p,acceleratedRaycast as m}from"./ExtensionUtilities.CsZ72cLy1767149344623.js";const{MathUtils:d}=await e("three"),v=(e,t)=>e.getValueAt(t)+-10,{ref:h}=await e("vue"),y=s("buildingsHeatmap",()=>{const e=h(!1),t=h(0);return{showDiv:e,temperature:t,setShowDiv:function(t){e.value=t},setTemperature:function(e){t.value=e}}}),{defineComponent:f}=await e("vue"),{unref:w,createElementVNode:g,Fragment:x,openBlock:_,createElementBlock:b}=await e("vue"),M=["object","rotation-x"],j=["object"],{watchEffect:B}=await e("vue"),D=await e("three"),S=f({__name:"buildingsHeatmap",props:{model:{},opacity:{default:1}},setup(e){D.BufferGeometry.prototype.computeBoundsTree=c,D.BufferGeometry.prototype.disposeBoundsTree=p,D.Mesh.prototype.raycast=m;const o=e,a=((e=250,t=250,o=!0)=>{const a=document.createElement("heatmap-canvas");return a.style.position="absolute",o||(a.style.display="none"),a.style.top="0",a.style.left="0",document.body.appendChild(a),r.create({container:a,width:e,height:t,blur:".8",radius:10,gradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"}})})();((e,t)=>{if(!t){let o=0;for(t=[];o<1e3;)t.push({x:d.randInt(1,e._config.width),y:d.randInt(1,e._config.height),value:d.randInt(-10,36)}),o++}e.setData({max:36,min:-10,data:t})})(a);const n=new D.Texture(a._renderer.canvas);n.needsUpdate=!0;const i=o.model.city.clone();delete i.geometry.attributes.normal,delete i.geometry.attributes.uv;const s=i.geometry.clone().applyMatrix4(i.matrix),u=o.model.land.clone();delete u.geometry.attributes.normal;const h=u.geometry.clone().applyMatrix4(u.matrix),f=t([s,h]);f.applyMatrix4((new D.Matrix4).makeRotationX(Math.PI/2)),l(f),f.computeBoundsTree();const S=(E=n,new D.ShaderMaterial({vertexShader:"\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t\t\tvUv = uv;\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform sampler2D heightMap;\n\t\tuniform float uOpacity;\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tgl_FragColor = vec4(texture2D(heightMap, vUv.xy).rgb, uOpacity);\n    }\n\t\t",uniforms:{uOpacity:{value:o.opacity},heightMap:{type:"t",value:E}},depthWrite:!0,depthTest:!0,transparent:!0,side:D.DoubleSide}));var E;const k=new D.Mesh(f,S);B(()=>{o.opacity&&(S.uniforms.uOpacity.value=o.opacity)});const T=y(),U=e=>{if(e){const t={x:e.uv.x*a._config.width,y:(1-e.uv.y)*a._config.height};console.log("数值：",e),console.log("数值———：",v(a,t)),T.setTemperature(v(a,t))}},P=e=>{e&&T.$patch({showDiv:!0})},C=e=>{e&&T.setShowDiv(!1)};return(e,t)=>(_(),b(x,null,[g("primitive",{object:w(k),"rotation-x":-Math.PI/2,onPointermove:U,onPointerenter:P,onPointerleave:C},null,40,M),g("primitive",{object:o.model.model.children[0].clone()},null,8,j)],64))}}),{unref:E,toDisplayString:k,vShow:T,normalizeStyle:U,withDirectives:P,openBlock:C,createElementBlock:I}=await e("vue"),{ref:O,onMounted:V,onUnmounted:A}=await e("vue"),F=u({__name:"dataDiv",setup(e){const t=y(),o=O({top:0,left:0});function a(e){o.value.left=e.clientX+5+"px",o.value.top=e.clientY-20+"px"}return V(()=>{window.addEventListener("mousemove",a)}),A(()=>{window.removeEventListener("mousemove",a)}),(e,a)=>P((C(),I("div",{class:"title",style:U(o.value)},"温度："+k(E(t).temperature)+"℃ ",5)),[[T,E(t).showDiv]])}},[["__scopeId","data-v-fac3e7fd"]]),{withAsyncContext:G,defineComponent:H}=await e("vue"),{unref:L,mergeProps:N,createVNode:R,withCtx:X,Fragment:$,openBlock:z,createElementBlock:W}=await e("vue"),{reactive:Y,ref:q}=await e("vue"),J=H({__name:"heatmap2",async setup(e){let t,r;const l=q(!1),s=([t,r]=G(()=>a()),t=await t,r(),t);l.value=!0;const u=Y({width:1,color:"#000",opacity:1,show:!0}),c=Y({opacity:.9});return new o({title:"参数",expanded:!0}).addBinding(c,"opacity",{label:"透明度",min:0,max:1,step:.1}),(e,t)=>(z(),W($,null,[R(n,{showBuildings:!1,autoRotate:!1},{ability:X(()=>[R(S,N({model:L(s)},c),null,16,["model"]),R(i,N(u,{builds:L(s).city}),null,16,["builds"])]),_:1}),R(F)],64))}});export{J as default};
