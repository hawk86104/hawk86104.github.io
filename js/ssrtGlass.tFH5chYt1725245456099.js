import{_ as t}from"./index.s6tbElDP1725245456099.js";import{a6 as e,k as n,j as r,q as o,bf as i,V as a,C as c,al as l}from"./three.KG2-8r0_1725245456099.js";import{p as s,$ as u,N as f,a as p,d as v}from"./@tresjs.j5vdYITq1725245456099.js";import{_ as d}from"./whiteFloorMesh.vue_vue_type_script_setup_true_lang.2Ls4HXo91725245456099.js";import{_ as m}from"./skyBoxAmesh.vue_vue_type_script_setup_true_lang.rQvgIypy1725245456099.js";import{P as h}from"./tweakpane.yHWGBmom1725245456099.js";import{d as x,a4 as g,a1 as y,w,o as b,D as S,u as C,r as _,e as P,j as F,g as I,f as z,al as j,aj as D,ak as k,m as N,F as T,J as M}from"./@vue.Q1VpS3901725245456099.js";import"./index.vXkb3Zi31725245456099.js";import"./@fesjs.Ns9rHvZ61725245456099.js";import"./vue-router.tVftT0SA1725245456099.js";import"./lodash-es.nFpJXAf-1725245456099.js";import"./@vueuse.whMtq_7M1725245456099.js";import"./@qlin.yHhFDldE1725245456099.js";import"./pinia.-1zGxVQz1725245456099.js";import"./@floating-ui.BPbuo5Gx1725245456099.js";import"./@juggle.7yjBMqoW1725245456099.js";import"./chalk.sAH7iSuz1725245456099.js";/* empty css                                 */import"./iconify-icon.l-H2-fnN1725245456099.js";import"./@iconify.9PoCakEb1725245456099.js";import"./utils.PqoJfvrT1725245456099.js";import"./default.vue_vue_type_script_setup_true_lang.97mmcBzv1725245456099.js";import"./three-mesh-ui.module.Od_ClJXE1725245456099.js";function B(t,e){var n=E();return(B=function(t,e){return n[t-=149]})(t,e)}function E(){var t=["add","renderer","warn","\n                uniform sampler2D uTexture;\n\n                varying vec2 vUv;\n\n                void main() {\n                    ","setRenderTarget","bind","__proto__","blit","value","10079046ClPFZv","gger","toString","scene","7706605cQyieu","Mesh","function *\\( *\\)","debu","gl_FragColor = texture2D(uTexture, vUv);","return (function() ","while (true) {}","action","2064588AMjisr","uTexture","98zxfXfJ","Scene","render",'{}.constructor("return this")( )',"log","material","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","4pIXbtk","apply","stateObject","777880rJAiMZ","innerHeight","call","constructor","trace","input","28950700MKtQMm","mesh","chain","uniforms","prototype","149103pTIxcE","counter","console","string","PerspectiveCamera","innerWidth","\n                varying vec2 vUv;\n\n                void main() {\n                    vUv = uv;\n                    gl_Position = vec4(position.xy, 0.0, 1.0);    \n                }","15jJbuGc","877872ZggBYU","length","ShaderMaterial","exception","test","PlaneGeometry","error","camera","table"];return(E=function(){return t})()}var R=B;!function(t,e){for(var n=B,r=E();;)try{if(843673===parseInt(n(163))/1*(-parseInt(n(149))/2)+-parseInt(n(170))/3*(parseInt(n(152))/4)+-parseInt(n(193))/5+parseInt(n(201))/6+parseInt(n(203))/7*(parseInt(n(171))/8)+-parseInt(n(189))/9+parseInt(n(158))/10)break;r.push(r.shift())}catch(o){r.push(r.shift())}}();var W=function(){var t=!0;return function(e,n){var r=t?function(){if(n){var t=n[B(150)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();!function(){W(this,(function(){var t=B,e=new RegExp(t(195)),n=new RegExp(t(209),"i"),r=H("init");e[t(175)](r+t(160))&&n[t(175)](r+t(157))?H():r("0")}))()}();var V=function(){var t=!0;return function(e,n){var r=t?function(){if(n){var t=n.apply(e,arguments);return n=null,t}}:function(){};return t=!1,r}}();V(void 0,(function(){var t,e=B;try{t=Function(e(198)+e(206)+");")()}catch(l){t=window}for(var n=t[e(165)]=t[e(165)]||{},r=[e(207),e(182),"info",e(177),e(174),e(179),e(156)],o=0;o<r[e(172)];o++){var i=V[e(155)][e(162)][e(185)](V),a=r[o],c=n[a]||i;i[e(186)]=V.bind(V),i[e(191)]=c.toString[e(185)](c),n[a]=i}}))();class A{constructor(t,n){var r=B;this[r(208)]=new(e[r(173)])({uniforms:{uTexture:{type:"t",value:null}},vertexShader:r(169),fragmentShader:r(183)+(n||r(197))+"  \n                }",depthTest:!1,depthWrite:!1}),this[r(159)]=new(e[r(194)])(new(e[r(176)])(2,2),this[r(208)]),this[r(178)]=new(e[r(167)])(45,window[r(168)]/window[r(153)],1,1e3),this[r(181)]=t,this[r(192)]=new(e[r(204)]),this[r(192)][r(180)](this[r(159)])}[R(187)](t,e){var n=R;this[n(181)][n(184)](e),this[n(208)][n(161)][n(202)][n(188)]=t,this[n(181)][n(205)](this[n(192)],this[n(178)]),this[n(181)].setRenderTarget(null)}}function H(t){function e(t){var n=B;if(typeof t===n(166))return function(t){}[n(155)](n(199))[n(150)](n(164));1!==(""+t/t)[n(172)]||t%20==0?function(){return!0}[n(155)](n(196)+n(190))[n(154)](n(200)):function(){return!1}[n(155)](n(196)+"gger").apply(n(151)),e(++t)}try{if(t)return e;e(0)}catch(n){}}const U=O;!function(t,e){const n=O,r=G();for(;;)try{if(692984===parseInt(n(418))/1*(-parseInt(n(364))/2)+-parseInt(n(390))/3+-parseInt(n(380))/4*(-parseInt(n(406))/5)+parseInt(n(379))/6+-parseInt(n(413))/7*(parseInt(n(369))/8)+parseInt(n(366))/9*(parseInt(n(370))/10)+parseInt(n(398))/11)break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const X=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[O(387)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();!function(){X(this,(function(){const t=O,e=new RegExp(t(386)),n=new RegExp("\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","i"),r=$(t(397));e[t(371)](r+"chain")&&n[t(371)](r+t(365))?$():r("0")}))()}();const Z=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n.apply(e,arguments);return n=null,t}}:function(){};return t=!1,r}}();function O(t,e){const n=G();return(O=function(t,e){return n[t-=358]})(t,e)}Z(void 0,(function(){const t=O;let e;try{e=Function("return (function() "+t(394)+");")()}catch(o){e=window}const n=e[t(420)]=e.console||{},r=["log","warn",t(416),t(368),t(383),"table","trace"];for(let i=0;i<r.length;i++){const e=Z.constructor[t(400)][t(414)](Z),o=r[i],a=n[o]||e;e[t(402)]=Z[t(414)](Z),e[t(419)]=a[t(419)][t(414)](a),n[o]=e}}))();class L{constructor(t,o,i){const a=O;this[a(361)]=t[a(367)](),this[a(410)]=o,this.renderer=i,this[a(393)]=new(e[a(396)]),this.scene[a(375)](this[a(361)]),this[a(423)]=new A(this[a(403)]),this[a(404)]=new(e[a(378)])(innerWidth,innerHeight,{type:e[a(411)],depthBuffer:!1,stencilBuffer:!1}),this[a(399)]=new(e[a(378)])(innerWidth,innerHeight,{type:e[a(411)],depthBuffer:!1,stencilBuffer:!1}),this.frontFaceRT=new(e[a(378)])(innerWidth,innerHeight,{type:e[a(411)]}),this[a(376)]=new n({uniforms:{uCameraFarInverse:{value:1/this[a(410)][a(358)]}},vertexShader:a(412),fragmentShader:a(422),depthTest:!0,depthWrite:!0,side:e[a(395)]}),this[a(360)]=new(e[a(373)])({uniforms:{uScreenSize:{value:new r(innerWidth,innerHeight)},uPrevDepth:{type:"t",value:this[a(404)].texture},uCameraFarInverse:{value:1/this[a(410)][a(358)]},uSample:{value:0}},vertexShader:a(417),fragmentShader:"\n                uniform sampler2D uPrevDepth;\n                uniform float uCameraFarInverse;\n                uniform float uSample;\n                uniform vec2  uScreenSize;\n\n                varying vec3 vWorldSpaceNormal;\n                varying vec3 vCameraSpacePos;\n\n                void main() {\n\n                    vec2 uv = gl_FragCoord.xy / uScreenSize;\n                    float prevRegisteredDepth = texture2D(uPrevDepth, uv).w;\n                    float currentDepth        = abs(vCameraSpacePos.z) * uCameraFarInverse;\n\n                    if(currentDepth <= prevRegisteredDepth) {\n                        discard;\n                    }\n\n                    gl_FragColor = vec4(vWorldSpaceNormal, currentDepth);    \n                }",depthTest:!1,depthWrite:!1,side:e[a(415)]}),this[a(361)].traverse((t=>{const n=a;t instanceof e[n(392)]&&(t.material=this[n(360)])}))}compute(t){const n=O;this[n(403)].setRenderTarget(this[n(404)]),this[n(403)][n(389)](),this.renderer[n(388)](this[n(399)]),this[n(403)][n(389)](),this.mesh[n(381)]((t=>{const e=n;t instanceof o&&(t[e(360)]=this[e(360)])})),this.material[n(385)][n(408)].value=1/this.camera[n(358)];for(let e=0;e<t;e++){let t=e%2==0?this[n(404)]:this[n(399)],r=e%2==0?this.pong:this.ping;this[n(360)][n(385)][n(374)].value=t.texture,this[n(360)][n(385)].uSample.value=e,this[n(403)][n(384)]=!1,this[n(403)][n(388)](r),this[n(403)][n(401)](this[n(393)],this[n(410)]),this[n(403)][n(384)]=!0,this.blitProgram[n(372)](r[n(362)],t)}t%2==0?this.resultBuffer=this.ping:this[n(407)]=this.pong,this.mesh[n(381)]((t=>{const r=n;t instanceof e[r(392)]&&(t[r(360)]=this[r(376)])})),this[n(403)][n(388)](this[n(409)]),this[n(403)][n(401)](this.scene,this[n(410)])}getBackFaceTexture(){return this[O(407)].texture}[U(382)](){const t=U;return this[t(409)][t(362)]}}function G(){const t=['{}.constructor("return this")( )',"FrontSide","Scene","init","14137189Nsmpem","pong","prototype","render","__proto__","renderer","ping","constructor","1145NOAbvE","resultBuffer","uCameraFarInverse","frontFaceRT","camera","FloatType","\n                varying vec3 vCameraSpacePos;\n                varying vec3 vWorldSpaceNormal;\n\n                void main() {\n                    vCameraSpacePos = (modelViewMatrix * vec4(position, 1.0)).xyz;\n                    vWorldSpaceNormal = normal;\n\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);    \n                }","49sOiCZE","bind","DoubleSide","info","\n                varying vec3 vCameraSpacePos;\n                varying vec3 vWorldSpaceNormal;\n\n                void main() {\n                    vCameraSpacePos = (modelViewMatrix * vec4(position, 1.0)).xyz;\n                    vWorldSpaceNormal = normalize((modelMatrix * vec4(normal, 0.0)).xyz);\n\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);    \n                }","562484ValUIu","toString","console","action","\n                uniform float uCameraFarInverse;\n\n                varying vec3 vWorldSpaceNormal;\n                varying vec3 vCameraSpacePos;\n\n                void main() {\n                    float currentDepth = abs(vCameraSpacePos.z) * uCameraFarInverse;\n                    gl_FragColor = vec4(vWorldSpaceNormal, currentDepth);    \n                }","blitProgram","far","counter","material","mesh","texture","gger","2umCDbf","input","5409zLtbdP","clone","error","962952dmFoXE","17070vAnGJU","test","blit","ShaderMaterial","uPrevDepth","add","frontFaceMaterial","while (true) {}","WebGLRenderTarget","4614714sSQkIg","2328VMKdPw","traverse","getFrontFaceTexture","exception","autoClear","uniforms","function *\\( *\\)","apply","setRenderTarget","clear","3346356wwpafU","debu","Mesh","scene"];return(G=function(){return t})()}function $(t){function e(t){const n=O;if("string"==typeof t)return function(t){}.constructor(n(377))[n(387)](n(359));1!==(""+t/t).length||t%20==0?function(){return!0}[n(405)](n(391)+n(363)).call(n(421)):function(){return!1}[n(405)](n(391)+"gger")[n(387)]("stateObject"),e(++t)}try{if(t)return e;e(0)}catch(n){}}const q=Y;!function(t,e){const n=Y,r=tt();for(;;)try{if(868770===-parseInt(n(381))/1*(parseInt(n(382))/2)+-parseInt(n(374))/3*(parseInt(n(326))/4)+parseInt(n(397))/5*(-parseInt(n(342))/6)+parseInt(n(402))/7+parseInt(n(327))/8+parseInt(n(383))/9+parseInt(n(346))/10)break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const J=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[Y(357)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();!function(){J(this,(function(){const t=Y,e=new RegExp(t(370)),n=new RegExp(t(340),"i"),r=nt(t(361));e.test(r+"chain")&&n[t(338)](r+t(393))?nt():r("0")}))()}();const Q=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[Y(357)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();function Y(t,e){const n=tt();return(Y=function(t,e){return n[t-=323]})(t,e)}Q(void 0,(function(){const t=Y;let e;try{e=Function(t(389)+'{}.constructor("return this")( ));')()}catch(o){e=window}const n=e[t(387)]=e[t(387)]||{},r=[t(364),"warn",t(401),t(398),"exception",t(354),t(358)];for(let i=0;i<r[t(335)];i++){const e=Q[t(351)][t(400)][t(350)](Q),o=r[i],a=n[o]||e;e.__proto__=Q[t(350)](Q),e[t(355)]=a[t(355)][t(350)](a),n[o]=e}}))();const K=[q(399)];function tt(){const t=["ShaderMaterial","Mesh","gger","4ZjbWzz","3612736DfxrTQ","uExtintionFactor","compute","extintionColor2","extintionCol1Random","extintionCol2Random","innerHeight","rgb(26, 166, 192)","length","Color","reflectionFactor","test","minFilter","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","uniforms","222EwcCXv","Scene","string","side","27144660cnfFpl","getBackFaceTexture","extintionColor1","extintionFactor","bind","constructor","modelName","clone","table","toString","uReflectionFactor","apply","trace","far","primitive","init","material","#fff","log","uExtintionColor2","uExtintionColor1","uTime","magFilter","wrapT","function *\\( *\\)","skyBoxTexture","sub","convertLinearToSRGB","2194239LoBfHG","uBackFaceBuffer","Vector2","call","modelPath","rgb(192,123,25)","ssrtGlassMesh","31iMzSbT","53192otDUvP","774846DyphNx","wrapS","exposure","setRenderTarget","console","uExtinctionFX1","return (function() ","debu","getFrontFaceTexture","value","input","stateObject","FrontSide","LinearMipmapLinearFilter","198995mBWqzN","error","object","prototype","info","4515490OXTDkz","action"];return(tt=function(){return t})()}const et=x({__name:q(380),props:{skyBoxTexture:{},modelPath:{},modelName:{},extintionFactor:{default:5},reflectionFactor:{default:1},exposure:{default:0},extintionColor1:{default:q(379)},extintionColor2:{default:q(334)},extintionCol1Random:{type:Boolean,default:!1},extintionCol2Random:{type:Boolean,default:!1}},async setup(t){const n=q;let r,o;const v=t,{map:d}=([r,o]=g((()=>f({map:v[n(371)]}))),r=await r,o(),r);d[n(384)]=i,d[n(369)]=i,d[n(368)]=e[n(396)],d[n(339)]=e[n(396)];const{camera:m,renderer:h,scene:x}=s(),_=new(e[n(323)])({uniforms:{uSkybox:{type:"t",value:d},uBackFaceBuffer:{type:"t",value:null},uFrontFaceBuffer:{type:"t",value:null},uCameraFarInverse:{value:1/m.value[n(359)]},uScreenSizeInv:{value:new(e[n(376)])(1/window.innerWidth,1/window[n(333)])},uCameraPos:{value:new a(0,0,0)},uTime:{value:0},uExtintionColor1:{value:new(e[n(336)])(n(363))[n(372)](new c(v.extintionColor1).convertLinearToSRGB())},uExtintionColor2:{value:new c("#fff")[n(372)](new(e[n(336)])(v.extintionColor2)[n(373)]())},uExtintionFactor:{value:v[n(349)]},uExposure:{value:v.exposure},uReflectionFactor:{value:v[n(337)]},uExtinctionFX1:{value:new l(v.extintionCol1Random?1:0,v[n(332)]?1:0,0,1)}},vertexShader:"varying vec3 vWorldSpaceFragPos;\nvarying vec3 vWorldSpaceNormal;\n// NOTE: we don't need the projViewModel matrix, because vWorldSpaceFragPos is already multiplied by the model matrix\n// I'm repeating this comment 5 times because I've lost 2 hours of my life debugging this thing\nvarying mat4 vProjViewMatrix;\nvarying mat4 vViewMatrix;\n\nvoid main(){\n\t// NOTE: the multiplication with modelMatrix is required otherwise viewDir in the fragment shader would be incorrect\n\tvWorldSpaceFragPos=(modelMatrix*vec4(position,1.)).xyz;\n\tvWorldSpaceNormal=normalize((modelMatrix*vec4(normal,0.)).xyz);\n\t\n\tgl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);\n\tvProjViewMatrix=projectionMatrix*viewMatrix;\n\tvViewMatrix=viewMatrix;\n}",fragmentShader:"uniform sampler2D uSkybox;\nuniform sampler2D uBackFaceBuffer;\nuniform sampler2D uFrontFaceBuffer;\n\nuniform vec3 uExtintionColor1;\nuniform vec3 uExtintionColor2;\nuniform float uExtintionFactor;\nuniform float uExposure;\nuniform float uReflectionFactor;\nuniform vec4 uExtinctionFX1;\n\nuniform float uTime;\n\nuniform vec3 uCameraPos;\nuniform vec2 uScreenSizeInv;\nuniform float uCameraFarInverse;\n\nvarying vec3 vWorldSpaceFragPos;\nvarying vec3 vWorldSpaceNormal;\nvarying mat4 vProjViewMatrix;\nvarying mat4 vViewMatrix;\n\nconst float PI=3.14159265359;\nconst float e=2.7182818284590;\n\nconst float planeSize=3.;\nconst vec3 planeColor=pow(vec3(202./255.,205./255.,185./255.),vec3(3.));\n\nfloat mod289(float x){return x-floor(x*(1./289.))*289.;}\nvec4 mod289(vec4 x){return x-floor(x*(1./289.))*289.;}\nvec4 perm(vec4 x){return mod289(((x*34.)+1.)*x);}\n\nfloat noise(vec3 p){\n\tvec3 a=floor(p);\n\tvec3 d=p-a;\n\td=d*d*(3.-2.*d);\n\t\n\tvec4 b=a.xxyy+vec4(0.,1.,0.,1.);\n\tvec4 k1=perm(b.xyxy);\n\tvec4 k2=perm(k1.xyxy+b.zzww);\n\t\n\tvec4 c=k2+a.zzzz;\n\tvec4 k3=perm(c);\n\tvec4 k4=perm(c+1.);\n\t\n\tvec4 o1=fract(k3*(1./41.));\n\tvec4 o2=fract(k4*(1./41.));\n\t\n\tvec4 o3=o2*d.z+o1*(1.-d.z);\n\tvec2 o4=o3.yw*d.x+o3.xz*(1.-d.x);\n\t\n\treturn o4.y*d.y+o4.x*(1.-d.y);\n}\n\nvec3 acesFilm(const vec3 x){\n\tconst float a=2.51;\n\tconst float b=.03;\n\tconst float c=2.43;\n\tconst float d=.59;\n\tconst float e=.14;\n\treturn clamp((x*(a*x+b))/(x*(c*x+d)+e),0.,1.);\n}\n\n// gets the skybox color from a given view direction\nvec3 getSkyboxColor(vec3 viewDir){\n\t// skybox coordinates\n\tvec2 skyboxUV=vec2(\n\t\t(atan(viewDir.x,viewDir.z)+PI)/(PI*2.),\n\t\t(asin(viewDir.y)+PI*.5)/(PI)\n\t);\n\t\n\tvec3 col=texture2D(uSkybox,skyboxUV).xyz;\n\tcol=pow(col,vec3(2.2));\n\treturn col;\n}\n\nbool refract2(vec3 v,vec3 n,float ni_over_nt,inout vec3 refracted){\n\tvec3 uv=normalize(v);\n\tfloat dt=dot(uv,n);\n\tfloat discriminant=1.-ni_over_nt*ni_over_nt*(1.-dt*dt);\n\tif(discriminant>0.){\n\t\trefracted=ni_over_nt*(v-n*dt)-n*sqrt(discriminant);\n\t\treturn true;\n\t}\n\t\n\treturn false;\n}\n\nvec3 binarySearchHitPoint(vec3 lastP,vec3 hitP,vec3 rayDir){\n\t\n\tfor(int i=0;i<10;i++){\n\t\tvec3 midP=(lastP+hitP)*.5;\n\t\t\n\t\t// project midP in uv space\n\t\tvec4 projCoord=vProjViewMatrix*vec4(midP,1.);\n\t\tprojCoord.xyz/=projCoord.w;\n\t\t\n\t\tvec2 midpNDC=projCoord.xy;\n\t\tvec2 midpUV=midpNDC*.5+.5;\n\t\t\n\t\t// get depth at point\n\t\tvec4 backBuffer=texture2D(uBackFaceBuffer,midpUV);\n\t\tfloat depth=backBuffer.w;\n\t\t\n\t\tfloat midpDepth=abs((vViewMatrix*vec4(midP,1.)).z)*uCameraFarInverse;\n\t\tif(midpDepth>depth){\n\t\t\thitP=midP;\n\t\t}else{\n\t\t\tlastP=midP;\n\t\t}\n\t}\n\t\n\treturn hitP;\n}\n\nvec3 getRefractedColor(vec3 refractionDir,vec3 hitPoint,float refractionIndex){\n\t// move the hitpoint inside the mesh with epsilon\n\thitPoint+=refractionDir*.0001;\n\t\n\t// raymarch!\n\tfloat stepSize=.02;\n\tfloat stepMult=1.5;\n\t\n\tvec3 lastP=hitPoint;\n\tvec3 p=hitPoint;\n\tvec3 hitPNormal;\n\tfloat currStepSize=stepSize;\n\tfloat transmissionDistance=0.;\n\tfor(int i=0;i<20;i++){\n\t\tp+=currStepSize*refractionDir;\n\t\t\n\t\t// project p in uv space\n\t\tvec4 projCoord=vProjViewMatrix*vec4(p,1.);\n\t\tprojCoord.xyz/=projCoord.w;\n\t\t\n\t\tvec2 pNDC=projCoord.xy;\n\t\tvec2 pUV=pNDC*.5+.5;\n\t\t\n\t\t// get depth at point\n\t\tvec4 backBuffer=texture2D(uBackFaceBuffer,pUV);\n\t\tfloat depth=backBuffer.w;\n\t\tvec3 norm=backBuffer.xyz;\n\t\t\n\t\t// get p depth\n\t\tfloat pDepth=abs((vViewMatrix*vec4(p,1.)).z)*uCameraFarInverse;\n\t\t\n\t\tif(pDepth>depth){\n\t\t\t\n\t\t\tvec3 hitp=binarySearchHitPoint(lastP,p,refractionDir);\n\t\t\tp=hitp;\n\t\t\t\n\t\t\t// ************ get the hitpoint normal\n\t\t\tvec4 projCoord=vProjViewMatrix*vec4(p,1.);\n\t\t\tprojCoord.xyz/=projCoord.w;\n\t\t\t\n\t\t\tvec2 pNDC=projCoord.xy;\n\t\t\tvec2 pUV=pNDC*.5+.5;\n\t\t\t\n\t\t\t// get depth at point\n\t\t\thitPNormal=texture2D(uBackFaceBuffer,pUV).xyz;\n\t\t\t// ************ get the hitpoint normal - END\n\t\t\t\n\t\t\tbreak;\n\t\t}\n\t\t\n\t\tlastP=p;\n\t\tcurrStepSize*=stepMult;\n\t}\n\t\n\ttransmissionDistance=length(hitPoint-p);\n\t\n\t// ******************** recalc directions\n\tvec3 outward_normal;\n\tvec3 reflected=reflect(refractionDir,hitPNormal);\n\tfloat ni_over_nt;\n\tvec3 refr;\n\t// vec3 refracted;\n\tfloat reflect_prob;\n\tfloat cosine;\n\t\n\tif(dot(refractionDir,hitPNormal)>0.){\n\t\toutward_normal=-hitPNormal;\n\t\tni_over_nt=refractionIndex;\n\t\tcosine=refractionIndex*dot(refractionDir,hitPNormal);\n\t}else{\n\t\toutward_normal=hitPNormal;\n\t\tni_over_nt=1./refractionIndex;\n\t\tcosine=-dot(refractionDir,hitPNormal);\n\t}\n\t\n\t// if (refract2(refractionDir, outward_normal, ni_over_nt, refracted)) {\n\t\tif(refract2(refractionDir,outward_normal,ni_over_nt,refr)){\n\t\t\tfloat r0=(1.-refractionIndex)/(1.+refractionIndex);\n\t\t\tr0*=r0;\n\t\t\treflect_prob=r0+(1.-r0)*pow((1.-cosine),5.);\n\t\t}else{\n\t\t\treflect_prob=1.;\n\t\t}\n\t\t// ******************** recalc directions - END\n\t\t\n\t\t// ******************** get colors\n\t\tvec3 col;\n\t\tvec3 colrefl;\n\t\tvec3 colrefr;\n\t\t// if(refracted.y < 0.0) {\n\t\t\tif(refr.y<0.){\n\t\t\t\t// float t = p.y / abs(refracted.y);\n\t\t\t\t// vec3 planeHitP = p + refracted * t;\n\t\t\t\tfloat t=p.y/abs(refr.y);\n\t\t\t\tvec3 planeHitP=p+refr*t;\n\t\t\t\tif(abs(planeHitP.x)<planeSize&&abs(planeHitP.z)<planeSize){\n\t\t\t\t\tcolrefr=planeColor;\n\t\t\t\t}else{\n\t\t\t\t\t// colrefr = getSkyboxColor(refracted);\n\t\t\t\t\tcolrefr=getSkyboxColor(refr);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\t// colrefr = getSkyboxColor(refracted);\n\t\t\t\tcolrefr=getSkyboxColor(refr);\n\t\t\t}\n\t\t\t\n\t\t\tif(reflected.y<0.){\n\t\t\t\tfloat t=p.y/abs(reflected.y);\n\t\t\t\tvec3 planeHitP=p+reflected*t;\n\t\t\t\tif(abs(planeHitP.x)<planeSize&&abs(planeHitP.z)<planeSize){\n\t\t\t\t\tcolrefl=planeColor;\n\t\t\t\t}else{\n\t\t\t\t\tcolrefl=getSkyboxColor(reflected);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tcolrefl=getSkyboxColor(reflected);\n\t\t\t}\n\t\t\t\n\t\t\tcol=colrefl*(reflect_prob*uReflectionFactor)+colrefr*(1.-reflect_prob);\n\t\t\t// ******************** get colors\n\t\t\t\n\t\t\tvec3 transm=vec3(1.);\n\t\t\t// const int steps = 8;\n\t\t\tconst int steps=15;\n\t\t\tfloat step=transmissionDistance/float(steps);\n\t\t\tfloat fc=uExtintionFactor*.07;\n\t\t\t\n\t\t\t// raymarching transmission color\n\t\t\t\n\t\t\t// float noiseStrength = 0.8;\n\t\t\tfloat noiseSpeed=.5;\n\t\t\tfloat noiseTimeSpeed=.5;\n\t\t\t\n\t\t\tfor(int i=0;i<steps;i++){\n\t\t\t\tvec3 np=hitPoint+refractionDir*float(i)*step;\n\t\t\t\t\n\t\t\t\tvec3 nnp=np;\n\t\t\t\tvec3 w=normalize(np-vec3(.75,1.5,0.));\n\t\t\t\tvec3 u=vec3(0.,0.,1.);\n\t\t\t\t// vec3 timeOffset = uTime * normalize(np - vec3(0.75, 1.5, 0.0));\n\t\t\t\tvec3 timeOffset=cos(uTime)*w+sin(uTime)*u;\n\t\t\t\tfloat colorNoiseX=noise(np*noiseSpeed+timeOffset*noiseTimeSpeed);\n\t\t\t\tfloat colorNoiseY=noise(np*noiseSpeed+timeOffset*noiseTimeSpeed+vec3(15.3278,125.19879,0.));\n\t\t\t\tfloat colorNoiseZ=noise(np*noiseSpeed+timeOffset*noiseTimeSpeed+vec3(2.6008,78.19879,543.12993));\n\t\t\t\t\n\t\t\t\tfloat targ=length(nnp*.8*uExtinctionFX1.w-vec3(.75,1.5,0.));\n\t\t\t\tfloat targAperture=.25;\n\t\t\t\t\n\t\t\t\t// wave raymarch\n\t\t\t\tif(uExtinctionFX1.z>.5){\n\t\t\t\t\tnnp=np+sin(np.x*2.5+uTime*1.5)*.3;\n\t\t\t\t\ttarg=nnp.y-.85*uExtinctionFX1.w;\n\t\t\t\t}else{\n\t\t\t\t\tnnp=np+vec3(colorNoiseX,colorNoiseY,colorNoiseZ)*1.05;\n\t\t\t\t\tvec3 diff=nnp-vec3(3.3,4.5,0.);\n\t\t\t\t\tfloat angle=(atan(diff.x,diff.y)+PI)/(PI*2.);\n\t\t\t\t\ttarg=length(diff)+sin(angle*32.*PI+uTime*1.5)*.4;\n\t\t\t\t\ttarg*=.475;\n\t\t\t\t\ttargAperture=.5+colorNoiseX*.75;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// what's the color at np?\n\t\t\t\tvec3 col1=uExtintionColor1;\n\t\t\t\tvec3 col2=uExtintionColor2;\n\t\t\t\tif(uExtinctionFX1.x>.5){\n\t\t\t\t\tcol1=vec3(colorNoiseX,colorNoiseY,colorNoiseZ)*.85;\n\t\t\t\t}\n\t\t\t\tif(uExtinctionFX1.y>.5){\n\t\t\t\t\tcol2=vec3(colorNoiseX,colorNoiseY,colorNoiseZ)*.85;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(targ<1.){\n\t\t\t\t\t\n\t\t\t\t\ttransm*=exp(-step*col2*fc);\n\t\t\t\t\t\n\t\t\t\t}else if(targ>1.&&targ<1.+targAperture){\n\t\t\t\t\tfloat t=(targ-1.)/targAperture;\n\t\t\t\t\t\n\t\t\t\t\ttransm*=exp(-step*(col1*t+col2*(1.-t))*fc);\n\t\t\t\t\t\n\t\t\t\t}else if(targ<(1.+targAperture)*1.85){\n\t\t\t\t\ttransm*=exp(-step*col1*fc);\n\t\t\t\t\t\n\t\t\t\t}else{\n\t\t\t\t\t// transm = (col1) * targAperture;\n\t\t\t\t\t// transm *= exp(-step * col1 * uExtintionFactor);\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// return col * uExtintionColor2 * transm;\n\t\t\tcol*=transm;\n\t\t\t\n\t\t\treturn col;\n\t\t}\n\t\t\n\t\tvoid main(){\n\t\t\tvec2 screenUV=gl_FragCoord.xy*uScreenSizeInv;\n\t\t\t\n\t\t\tvec3 viewDir=normalize(vWorldSpaceFragPos-uCameraPos);\n\t\t\tvec3 normal=vWorldSpaceNormal;\n\t\t\tfloat refractionIndex=1.5;\n\t\t\t\n\t\t\tvec3 outward_normal;\n\t\t\tvec3 reflected=reflect(viewDir,normal);\n\t\t\tfloat ni_over_nt;\n\t\t\tvec3 refracted;\n\t\t\tfloat reflect_prob;\n\t\t\tfloat cosine;\n\t\t\t\n\t\t\tif(dot(viewDir,normal)>0.){\n\t\t\t\toutward_normal=-normal;\n\t\t\t\tni_over_nt=refractionIndex;\n\t\t\t\tcosine=refractionIndex*dot(viewDir,normal);\n\t\t\t}else{\n\t\t\t\toutward_normal=normal;\n\t\t\t\tni_over_nt=1./refractionIndex;\n\t\t\t\tcosine=-dot(viewDir,normal);\n\t\t\t}\n\t\t\t\n\t\t\tif(refract2(viewDir,outward_normal,ni_over_nt,refracted)){\n\t\t\t\tfloat r0=(1.-refractionIndex)/(1.+refractionIndex);\n\t\t\t\tr0*=r0;\n\t\t\t\treflect_prob=r0+(1.-r0)*pow((1.-cosine),5.);\n\t\t\t}else{\n\t\t\t\treflect_prob=1.;\n\t\t\t}\n\t\t\t\n\t\t\tvec3 reflectedCol;\n\t\t\tif(reflected.y<0.){\n\t\t\t\tfloat t=vWorldSpaceFragPos.y/abs(reflected.y);\n\t\t\t\tvec3 planeHitP=vWorldSpaceFragPos+reflected*t;\n\t\t\t\tif(abs(planeHitP.x)<planeSize&&abs(planeHitP.z)<planeSize){\n\t\t\t\t\treflectedCol=planeColor;\n\t\t\t\t}else{\n\t\t\t\t\treflectedCol=getSkyboxColor(reflected);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\treflectedCol=getSkyboxColor(reflected);\n\t\t\t}\n\t\t\t\n\t\t\tvec3 col=reflectedCol*reflect_prob*uReflectionFactor+getRefractedColor(refracted,vWorldSpaceFragPos,refractionIndex)*(1.-reflect_prob);\n\t\t\t// getRefractedColor(normalize(refracted + vec3(0.0, 0.0, 0.0)), vWorldSpaceFragPos) * (1.0 - reflect_prob) * 0.333 +\n\t\t\t// getRefractedColor(normalize(refracted + vec3(0.0, 0.15, 0.0)), vWorldSpaceFragPos) * (1.0 - reflect_prob) * 0.333 +\n\t\t\t// getRefractedColor(normalize(refracted + vec3(0.0, 0.35, 0.0)), vWorldSpaceFragPos) * (1.0 - reflect_prob) * 0.333;\n\t\t\t\n\t\t\t// col = getRefractedColor(refracted, vWorldSpaceFragPos) * (1.0 - reflect_prob);\n\t\t\t// vec3 col = getRefractedColor(refracted, vWorldSpaceFragPos);\n\t\t\t// col = getSkyboxColor(reflected) * reflect_prob * 1.0;\n\t\t\t\n\t\t\t// vec3 col = viewDir;\n\t\t\t// gl_FragColor = vec4(col, 1.0);\n\t\t\t// return;\n\t\t\t\n\t\t\tcol*=pow(2.,uExposure);\n\t\t\tcol=acesFilm(col);\n\t\t\tcol=pow(col,vec3(1./2.2));\n\t\t\t\n\t\t\tgl_FragColor=vec4(col,1.);\n\t\t\t// gl_FragColor = vec4(getSkyboxColor(viewDir), 1.0) * 0.5 + vec4(viewDir * 0.5 + 0.5, 1.0);\n\t\t}"}),{nodes:P}=([r,o]=g((()=>p(v[n(378)],{draco:!0,decoderPath:"./draco/"}))),r=await r,o(),r),F=P[n(343)].getObjectByName(v[n(352)]),I=new L(F,m.value,h.value),z=null==F?void 0:F.clone();null==z||z.traverse((t=>{const r=n;t instanceof e[r(324)]&&(t.material=_,t[r(362)][r(345)]=e[r(395)])}));const{onAfterLoop:j}=u();return j((({elapsed:t})=>{const e=n;F&&_&&(_.uniforms.uCameraPos[e(392)]=m.value.position[e(353)](),_[e(341)][e(367)][e(392)]=t,I[e(329)](6),_.uniforms[e(375)][e(392)]=I[e(347)](),_[e(341)].uFrontFaceBuffer[e(392)]=I[e(391)](),h[e(392)][e(386)](null),h[e(392)].autoClear=!1)})),y((()=>{const t=n;v[t(349)]&&(_[t(341)][t(328)][t(392)]=v.extintionFactor),v.reflectionFactor&&(_[t(341)][t(356)][t(392)]=v[t(337)]),v[t(385)]&&(_[t(341)].uExposure[t(392)]=v[t(385)]),v[t(348)]&&(_[t(341)][t(366)][t(392)]=new c(t(363))[t(372)](new c(v[t(348)]).convertLinearToSRGB())),v[t(330)]&&(_[t(341)][t(365)][t(392)]=new(e[t(336)])(t(363))[t(372)](new(e[t(336)])(v[t(330)])[t(373)]())),v[t(331)]&&(_[t(341)].uExposure[t(392)]=v[t(385)])})),w((()=>v.extintionCol1Random),(t=>{const e=n;_[e(341)][e(388)][e(392)].x=t?1:0}),{immediate:!0}),w((()=>v[n(332)]),(t=>{const e=n;_[e(341)][e(388)][e(392)].y=t?1:0}),{immediate:!0}),(t,e)=>{const r=n;return b(),S(r(360),{object:C(z)},null,8,K)}}});function nt(t){function e(t){const n=Y;if(typeof t===n(344))return function(t){}[n(351)]("while (true) {}").apply("counter");1!==(""+t/t)[n(335)]||t%20==0?function(){return!0}[n(351)](n(390)+n(325))[n(377)](n(403)):function(){return!1}[n(351)]("debu"+n(325))[n(357)](n(394)),e(++t)}try{if(t)return e;e(0)}catch(n){}}const rt=st;!function(t,e){const n=st,r=lt();for(;;)try{if(527589===parseInt(n(317))/1+-parseInt(n(301))/2+-parseInt(n(322))/3+parseInt(n(309))/4+-parseInt(n(285))/5+-parseInt(n(283))/6*(-parseInt(n(266))/7)+parseInt(n(308))/8)break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const ot=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n.apply(e,arguments);return n=null,t}}:function(){};return t=!1,r}}();!function(){ot(this,(function(){const t=st,e=new RegExp(t(289)),n=new RegExp(t(288),"i"),r=ft(t(321));e[t(307)](r+t(272))&&n[t(307)](r+t(318))?ft():r("0")}))()}();const it=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[st(267)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();it(void 0,(function(){const t=st,e=function(){const t=st;let e;try{e=Function(t(290)+t(323)+");")()}catch(n){e=window}return e}(),n=e[t(296)]=e[t(296)]||{},r=[t(297),t(295),t(278),t(284),t(312),t(281),t(299)];for(let o=0;o<r.length;o++){const e=it[t(313)][t(310)][t(319)](it),i=r[o],a=n[i]||e;e[t(302)]=it[t(319)](it),e[t(282)]=a.toString[t(319)](a),n[i]=e}}))();const at=M("TresPerspectiveCamera",{position:[0,8,-13],fov:45,near:.1,far:1e3,"look-at":[0,0,0]},null,-1),ct=M(rt(273),{intensity:10},null,-1);function lt(){const t=["length","info","gger","addBinding","table","toString","5759472NFwpyt","error","2948040apcHJn","消光颜色一","stateObject","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","function *\\( *\\)","return (function() ","statue","debu","https://opensource-1314935952.cos.ap-nanjing.myqcloud.com/model/eCommerce/guanYu.glb","https://opensource-1314935952.cos.ap-nanjing.myqcloud.com/images/skyBox/workshop_blur.jpg","warn","console","log","反射系数","trace","#b8b59e","1846200iHyloS","__proto__","extintionColor1","TresCanvas","counter","消光系数","test","4557840LutnkS","1039788wjojlk","prototype","ssrtGlass","exception","constructor","ACESFilmicToneMapping","rgb(192,123,25)","string","807647WnAQzH","input","bind","while (true) {}","init","1670817jQrdFd",'{}.constructor("return this")( )',"exposure","extintionCol2Random","7VlDUen","apply","reflectionFactor","extintionFactor","call","随机色1","chain","TresAmbientLight","extintionCol1Random","extintionColor2","随机色2"];return(lt=function(){return t})()}function st(t,e){const n=lt();return(st=function(t,e){return n[t-=266]})(t,e)}const ut=x({__name:rt(311),setup(n){const r=rt,o={clearColor:"#201919",windowSize:!0,toneMapping:e[r(314)],toneMappingExposure:.8},i=_({size:[20,20],color:"#cbcb96",shadowColor:r(300),edge:.35}),a=_({extintionFactor:5,reflectionFactor:1,exposure:0,extintionColor1:r(315),extintionColor2:"rgb(26, 166, 192)",extintionCol1Random:!1,extintionCol2Random:!1}),c=new h({title:"参数"});return c[r(280)](a,r(269),{label:r(306),min:0,max:10,step:.1}),c.addBinding(a,r(268),{label:r(298),min:0,max:2,step:.1}),c.addBinding(a,r(324),{label:"曝光系数",min:-1,max:1,step:.1}),c[r(280)](a,r(303),{label:r(286)}),c[r(280)](a,r(275),{label:"消光颜色二"}),c[r(280)](a,r(274),{label:r(271)}),c[r(280)](a,r(325),{label:r(276)}),(e,n)=>{const c=r,l=P(c(304));return b(),S(T,null,[F(C(t)),F(l,D(k(o)),{default:I((()=>[at,F(C(v),{enableDamping:""}),ct,(b(),z(j,null,{default:I((()=>[F(d,D(k(i)),null,16)])),_:1})),(b(),z(j,null,{default:I((()=>[F(et,N({scale:2},a,{modelPath:c(293),modelName:c(291),skyBoxTexture:c(294)}),null,16)])),_:1})),(b(),z(j,null,{default:I((()=>[F(m,{texture:"https://opensource-1314935952.cos.ap-nanjing.myqcloud.com/images/skyBox/workshop_blur.jpg"})])),_:1}))])),_:1},16)],64)}}});function ft(t){function e(t){const n=st;if(typeof t===n(316))return function(t){}[n(313)](n(320))[n(267)](n(305));1!==(""+t/t)[n(277)]||t%20==0?function(){return!0}[n(313)](n(292)+n(279))[n(270)]("action"):function(){return!1}[n(313)]("debu"+n(279))[n(267)](n(287)),e(++t)}try{if(t)return e;e(0)}catch(n){}}export{ut as default};
