import{importShared as t}from"./3d-tiles-renderer.qyEDeaaW1769484739493.js";import{_sfc_main as i}from"./pagesShow.vue_vue_type_script_setup_true_lang.C91EoZ8t1769484739493.js";import{useLoop as e}from"./index.CuW8EyFk1769484739493.js";import{createNoise4D as r}from"./simplex-noise.BtmiN6j11769484739493.js";import"./reflectorDiffuse.vue_vue_type_script_setup_true_lang.7h6xwqAI1769484739493.js";import"./reflectorDUDV.vue_vue_type_script_setup_true_lang.DmxGyZFT1769484739493.js";import"./reflectorShaderMesh.vue_vue_type_script_setup_true_lang.dy_wnXRa1769484739493.js";import"./dynamicRotatingBase.vue_vue_type_script_setup_true_lang.c3X8j2-d1769484739493.js";import"./whiteFloorMesh.vue_vue_type_script_setup_true_lang.B5-yGyrH1769484739493.js";import{_sfc_main as s}from"./gridPlusCom.vue_vue_type_script_setup_true_lang.D2zgXaXJ1769484739493.js";import"./videoFloor.vue_vue_type_script_setup_true_lang.BKmCUAo71769484739493.js";import"./digitalGround.vue_vue_type_script_setup_true_lang.CLwhxevp1769484739493.js";import"./imgFloor.vue_vue_type_script_setup_true_lang.BbFd-IMm1769484739493.js";import"./reflectorRoundedBox.vue_vue_type_script_setup_true_lang.CpYS2fPU1769484739493.js";import"./particleBase.vue_vue_type_script_setup_true_lang.D0-2YHi41769484739493.js";import"./rippleFloor.vue_vue_type_script_setup_true_lang.qvKohRiU1769484739493.js";import{It as a,Kt as n}from"./tresleches.SXglsrto1769484739493.js";const{BufferGeometry:o,DynamicDrawUsage:h,Float32BufferAttribute:u,MathUtils:c,Uint32BufferAttribute:m,Vector3:d}=await t("three");class l extends o{constructor(t={}){super(),this.isLightningStrike=!0,this.type="LightningStrike",this.init(l.copyParameters(t,t)),this.createMesh()}static createRandomGenerator(){const t=2053,i=[];for(let r=0;r<t;r++)i.push(Math.random());const e={currentSeed:0,random:function(){const r=i[e.currentSeed];return e.currentSeed=(e.currentSeed+1)%t,r},getSeed:function(){return e.currentSeed/t},setSeed:function(i){e.currentSeed=Math.floor(i*t)%t}};return e}static copyParameters(t={},i={}){const e=function(e){return i===t?e:e.clone()};return t.sourceOffset=void 0!==i.sourceOffset?e(i.sourceOffset):new d(0,100,0),t.destOffset=void 0!==i.destOffset?e(i.destOffset):new d(0,0,0),t.timeScale=void 0!==i.timeScale?i.timeScale:1,t.roughness=void 0!==i.roughness?i.roughness:.9,t.straightness=void 0!==i.straightness?i.straightness:.7,t.up0=void 0!==i.up0?e(i.up0):new d(0,0,1),t.up1=void 0!==i.up1?e(i.up1):new d(0,0,1),t.radius0=void 0!==i.radius0?i.radius0:1,t.radius1=void 0!==i.radius1?i.radius1:1,t.radius0Factor=void 0!==i.radius0Factor?i.radius0Factor:.5,t.radius1Factor=void 0!==i.radius1Factor?i.radius1Factor:.2,t.minRadius=void 0!==i.minRadius?i.minRadius:.2,t.isEternal=void 0!==i.isEternal?i.isEternal:void 0===i.birthTime||void 0===i.deathTime,t.birthTime=i.birthTime,t.deathTime=i.deathTime,t.propagationTimeFactor=void 0!==i.propagationTimeFactor?i.propagationTimeFactor:.1,t.vanishingTimeFactor=void 0!==i.vanishingTimeFactor?i.vanishingTimeFactor:.9,t.subrayPeriod=void 0!==i.subrayPeriod?i.subrayPeriod:4,t.subrayDutyCycle=void 0!==i.subrayDutyCycle?i.subrayDutyCycle:.6,t.maxIterations=void 0!==i.maxIterations?i.maxIterations:9,t.isStatic=void 0!==i.isStatic&&i.isStatic,t.ramification=void 0!==i.ramification?i.ramification:5,t.maxSubrayRecursion=void 0!==i.maxSubrayRecursion?i.maxSubrayRecursion:3,t.recursionProbability=void 0!==i.recursionProbability?i.recursionProbability:.6,t.generateUVs=void 0!==i.generateUVs&&i.generateUVs,t.randomGenerator=i.randomGenerator,t.noiseSeed=i.noiseSeed,t.onDecideSubrayCreation=i.onDecideSubrayCreation,t.onSubrayCreation=i.onSubrayCreation,t}update(t){this.isStatic||(this.rayParameters.isEternal||this.rayParameters.birthTime<=t&&t<=this.rayParameters.deathTime?(this.updateMesh(t),t<this.subrays[0].endPropagationTime?this.state=l.RAY_PROPAGATING:t>this.subrays[0].beginVanishingTime?this.state=l.RAY_VANISHING:this.state=l.RAY_STEADY,this.visible=!0):(this.visible=!1,t<this.rayParameters.birthTime?this.state=l.RAY_UNBORN:this.state=l.RAY_EXTINGUISHED))}init(t){this.rayParameters=t,this.maxIterations=void 0!==t.maxIterations?Math.floor(t.maxIterations):9,t.maxIterations=this.maxIterations,this.isStatic=void 0!==t.isStatic&&t.isStatic,t.isStatic=this.isStatic,this.ramification=void 0!==t.ramification?Math.floor(t.ramification):5,t.ramification=this.ramification,this.maxSubrayRecursion=void 0!==t.maxSubrayRecursion?Math.floor(t.maxSubrayRecursion):3,t.maxSubrayRecursion=this.maxSubrayRecursion,this.recursionProbability=void 0!==t.recursionProbability?t.recursionProbability:.6,t.recursionProbability=this.recursionProbability,this.generateUVs=void 0!==t.generateUVs&&t.generateUVs,t.generateUVs=this.generateUVs,void 0!==t.randomGenerator?(this.randomGenerator=t.randomGenerator,this.seedGenerator=t.randomGenerator,void 0!==t.noiseSeed&&this.seedGenerator.setSeed(t.noiseSeed)):(this.randomGenerator=l.createRandomGenerator(),this.seedGenerator=Math),void 0!==t.onDecideSubrayCreation?this.onDecideSubrayCreation=t.onDecideSubrayCreation:(this.createDefaultSubrayCreationCallbacks(),void 0!==t.onSubrayCreation&&(this.onSubrayCreation=t.onSubrayCreation)),this.state=l.RAY_INITIALIZED,this.maxSubrays=Math.ceil(1+Math.pow(this.ramification,Math.max(0,this.maxSubrayRecursion-1))),t.maxSubrays=this.maxSubrays,this.maxRaySegments=2*(1<<this.maxIterations),this.subrays=[];for(let i=0;i<this.maxSubrays;i++)this.subrays.push(this.createSubray());this.raySegments=[];for(let i=0;i<this.maxRaySegments;i++)this.raySegments.push(this.createSegment());this.time=0,this.timeFraction=0,this.currentSegmentCallback=null,this.currentCreateTriangleVertices=this.generateUVs?this.createTriangleVerticesWithUVs:this.createTriangleVerticesWithoutUVs,this.numSubrays=0,this.currentSubray=null,this.currentSegmentIndex=0,this.isInitialSegment=!1,this.subrayProbability=0,this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.vertices=null,this.uvs=null,this.indices=null,this.positionAttribute=null,this.uvsAttribute=null,this.simplexX=r(this.seedGenerator.random),this.simplexY=r(this.seedGenerator.random),this.simplexZ=r(this.seedGenerator.random),this.forwards=new d,this.forwardsFill=new d,this.side=new d,this.down=new d,this.middlePos=new d,this.middleLinPos=new d,this.newPos=new d,this.vPos=new d,this.cross1=new d}createMesh(){const t=1<<this.maxIterations,i=3*(t+1)*this.maxSubrays,e=18*t*this.maxSubrays;this.vertices=new Float32Array(3*i),this.indices=new Uint32Array(e),this.generateUVs&&(this.uvs=new Float32Array(2*i)),this.fillMesh(0),this.setIndex(new m(this.indices,1)),this.positionAttribute=new u(this.vertices,3),this.setAttribute("position",this.positionAttribute),this.generateUVs&&(this.uvsAttribute=new u(new Float32Array(this.uvs),2),this.setAttribute("uv",this.uvsAttribute)),this.isStatic||(this.index.usage=h,this.positionAttribute.usage=h,this.generateUVs&&(this.uvsAttribute.usage=h)),this.vertices=this.positionAttribute.array,this.indices=this.index.array,this.generateUVs&&(this.uvs=this.uvsAttribute.array)}updateMesh(t){this.fillMesh(t),this.drawRange.count=this.currentIndex,this.index.needsUpdate=!0,this.positionAttribute.needsUpdate=!0,this.generateUVs&&(this.uvsAttribute.needsUpdate=!0)}fillMesh(t){const i=this;this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.fractalRay(t,function(e){const r=i.currentSubray;t<r.birthTime||(this.rayParameters.isEternal&&0==i.currentSubray.recursion?(i.createPrism(e),i.onDecideSubrayCreation(e,i)):t<r.endPropagationTime?i.timeFraction>=e.fraction0*r.propagationTimeFactor&&(i.createPrism(e),i.onDecideSubrayCreation(e,i)):t<r.beginVanishingTime?(i.createPrism(e),i.onDecideSubrayCreation(e,i)):(i.timeFraction<=r.vanishingTimeFactor+e.fraction1*(1-r.vanishingTimeFactor)&&i.createPrism(e),i.onDecideSubrayCreation(e,i)))})}addNewSubray(){return this.subrays[this.numSubrays++]}initSubray(t,i){t.pos0.copy(i.sourceOffset),t.pos1.copy(i.destOffset),t.up0.copy(i.up0),t.up1.copy(i.up1),t.radius0=i.radius0,t.radius1=i.radius1,t.birthTime=i.birthTime,t.deathTime=i.deathTime,t.timeScale=i.timeScale,t.roughness=i.roughness,t.straightness=i.straightness,t.propagationTimeFactor=i.propagationTimeFactor,t.vanishingTimeFactor=i.vanishingTimeFactor,t.maxIterations=this.maxIterations,t.seed=void 0!==i.noiseSeed?i.noiseSeed:0,t.recursion=0}fractalRay(t,i){this.time=t,this.currentSegmentCallback=i,this.numSubrays=0,this.initSubray(this.addNewSubray(),this.rayParameters);for(let e=0;e<this.numSubrays;e++){const i=this.subrays[e];this.currentSubray=i,this.randomGenerator.setSeed(i.seed),i.endPropagationTime=c.lerp(i.birthTime,i.deathTime,i.propagationTimeFactor),i.beginVanishingTime=c.lerp(i.deathTime,i.birthTime,1-i.vanishingTimeFactor);const r=this.randomGenerator.random;i.linPos0.set(r(),r(),r()).multiplyScalar(1e3),i.linPos1.set(r(),r(),r()).multiplyScalar(1e3),this.timeFraction=(t-i.birthTime)/(i.deathTime-i.birthTime),this.currentSegmentIndex=0,this.isInitialSegment=!0;const s=this.getNewSegment();s.iteration=0,s.pos0.copy(i.pos0),s.pos1.copy(i.pos1),s.linPos0.copy(i.linPos0),s.linPos1.copy(i.linPos1),s.up0.copy(i.up0),s.up1.copy(i.up1),s.radius0=i.radius0,s.radius1=i.radius1,s.fraction0=0,s.fraction1=1,s.positionVariationFactor=1-i.straightness,this.subrayProbability=this.ramification*Math.pow(this.recursionProbability,i.recursion)/(1<<i.maxIterations),this.fractalRayRecursive(s)}this.currentSegmentCallback=null,this.currentSubray=null}fractalRayRecursive(t){if(t.iteration>=this.currentSubray.maxIterations)return void this.currentSegmentCallback(t);this.forwards.subVectors(t.pos1,t.pos0);let i=this.forwards.length();i<1e-6&&(this.forwards.set(0,0,.01),i=this.forwards.length());const e=.5*(t.radius0+t.radius1),r=.5*(t.fraction0+t.fraction1),s=this.time*this.currentSubray.timeScale*Math.pow(2,t.iteration);this.middlePos.lerpVectors(t.pos0,t.pos1,.5),this.middleLinPos.lerpVectors(t.linPos0,t.linPos1,.5);const a=this.middleLinPos;this.newPos.set(this.simplexX(a.x,a.y,a.z,s),this.simplexY(a.x,a.y,a.z,s),this.simplexZ(a.x,a.y,a.z,s)),this.newPos.multiplyScalar(t.positionVariationFactor*i),this.newPos.add(this.middlePos);const n=this.getNewSegment();n.pos0.copy(t.pos0),n.pos1.copy(this.newPos),n.linPos0.copy(t.linPos0),n.linPos1.copy(this.middleLinPos),n.up0.copy(t.up0),n.up1.copy(t.up1),n.radius0=t.radius0,n.radius1=e,n.fraction0=t.fraction0,n.fraction1=r,n.positionVariationFactor=t.positionVariationFactor*this.currentSubray.roughness,n.iteration=t.iteration+1;const o=this.getNewSegment();o.pos0.copy(this.newPos),o.pos1.copy(t.pos1),o.linPos0.copy(this.middleLinPos),o.linPos1.copy(t.linPos1),this.cross1.crossVectors(t.up0,this.forwards.normalize()),o.up0.crossVectors(this.forwards,this.cross1).normalize(),o.up1.copy(t.up1),o.radius0=e,o.radius1=t.radius1,o.fraction0=r,o.fraction1=t.fraction1,o.positionVariationFactor=t.positionVariationFactor*this.currentSubray.roughness,o.iteration=t.iteration+1,this.fractalRayRecursive(n),this.fractalRayRecursive(o)}createPrism(t){this.forwardsFill.subVectors(t.pos1,t.pos0).normalize(),this.isInitialSegment&&(this.currentCreateTriangleVertices(t.pos0,t.up0,this.forwardsFill,t.radius0,0),this.isInitialSegment=!1),this.currentCreateTriangleVertices(t.pos1,t.up0,this.forwardsFill,t.radius1,t.fraction1),this.createPrismFaces()}createTriangleVerticesWithoutUVs(t,i,e,r){this.side.crossVectors(i,e).multiplyScalar(r*l.COS30DEG),this.down.copy(i).multiplyScalar(-r*l.SIN30DEG);const s=this.vPos,a=this.vertices;s.copy(t).sub(this.side).add(this.down),a[this.currentCoordinate++]=s.x,a[this.currentCoordinate++]=s.y,a[this.currentCoordinate++]=s.z,s.copy(t).add(this.side).add(this.down),a[this.currentCoordinate++]=s.x,a[this.currentCoordinate++]=s.y,a[this.currentCoordinate++]=s.z,s.copy(i).multiplyScalar(r).add(t),a[this.currentCoordinate++]=s.x,a[this.currentCoordinate++]=s.y,a[this.currentCoordinate++]=s.z,this.currentVertex+=3}createTriangleVerticesWithUVs(t,i,e,r,s){this.side.crossVectors(i,e).multiplyScalar(r*l.COS30DEG),this.down.copy(i).multiplyScalar(-r*l.SIN30DEG);const a=this.vPos,n=this.vertices,o=this.uvs;a.copy(t).sub(this.side).add(this.down),n[this.currentCoordinate++]=a.x,n[this.currentCoordinate++]=a.y,n[this.currentCoordinate++]=a.z,o[this.currentUVCoordinate++]=s,o[this.currentUVCoordinate++]=0,a.copy(t).add(this.side).add(this.down),n[this.currentCoordinate++]=a.x,n[this.currentCoordinate++]=a.y,n[this.currentCoordinate++]=a.z,o[this.currentUVCoordinate++]=s,o[this.currentUVCoordinate++]=.5,a.copy(i).multiplyScalar(r).add(t),n[this.currentCoordinate++]=a.x,n[this.currentCoordinate++]=a.y,n[this.currentCoordinate++]=a.z,o[this.currentUVCoordinate++]=s,o[this.currentUVCoordinate++]=1,this.currentVertex+=3}createPrismFaces(t){const i=this.indices;t=this.currentVertex-6,i[this.currentIndex++]=t+1,i[this.currentIndex++]=t+2,i[this.currentIndex++]=t+5,i[this.currentIndex++]=t+1,i[this.currentIndex++]=t+5,i[this.currentIndex++]=t+4,i[this.currentIndex++]=t+0,i[this.currentIndex++]=t+1,i[this.currentIndex++]=t+4,i[this.currentIndex++]=t+0,i[this.currentIndex++]=t+4,i[this.currentIndex++]=t+3,i[this.currentIndex++]=t+2,i[this.currentIndex++]=t+0,i[this.currentIndex++]=t+3,i[this.currentIndex++]=t+2,i[this.currentIndex++]=t+3,i[this.currentIndex++]=t+5}createDefaultSubrayCreationCallbacks(){const t=this.randomGenerator.random;this.onDecideSubrayCreation=function(i,e){const r=e.currentSubray,s=e.rayParameters.subrayPeriod,a=e.rayParameters.subrayDutyCycle,n=e.rayParameters.isEternal&&0==r.recursion?-t()*s:c.lerp(r.birthTime,r.endPropagationTime,i.fraction0)-t()*s,o=e.time-n,h=Math.floor(o/s),u=t()*(h+1);let m=0;if(o%s<=a*s&&(m=e.subrayProbability),r.recursion<e.maxSubrayRecursion&&e.numSubrays<e.maxSubrays&&t()<m){const o=e.addNewSubray(),c=e.randomGenerator.getSeed();o.seed=u,e.randomGenerator.setSeed(u),o.recursion=r.recursion+1,o.maxIterations=Math.max(1,r.maxIterations-1),o.linPos0.set(t(),t(),t()).multiplyScalar(1e3),o.linPos1.set(t(),t(),t()).multiplyScalar(1e3),o.up0.copy(r.up0),o.up1.copy(r.up1),o.radius0=i.radius0*e.rayParameters.radius0Factor,o.radius1=Math.min(e.rayParameters.minRadius,i.radius1*e.rayParameters.radius1Factor),o.birthTime=n+h*s,o.deathTime=o.birthTime+s*a,e.rayParameters.isEternal||0!=r.recursion||(o.birthTime=Math.max(o.birthTime,r.birthTime),o.deathTime=Math.min(o.deathTime,r.deathTime)),o.timeScale=2*r.timeScale,o.roughness=r.roughness,o.straightness=r.straightness,o.propagationTimeFactor=r.propagationTimeFactor,o.vanishingTimeFactor=r.vanishingTimeFactor,e.onSubrayCreation(i,r,o,e),e.randomGenerator.setSeed(c)}};const i=new d,e=new d,r=new d,s=new d;this.onSubrayCreation=function(t,i,e,r){r.subrayCylinderPosition(t,i,e,.5,.6,.2)},this.subrayConePosition=function(a,n,o,h,u,c){o.pos0.copy(a.pos0),i.subVectors(n.pos1,n.pos0),e.copy(i).normalize(),i.multiplyScalar(a.fraction0+(1-a.fraction0)*(t()*h));const m=i.length();r.crossVectors(n.up0,e);const d=2*Math.PI*t();r.multiplyScalar(Math.cos(d)),s.copy(n.up0).multiplyScalar(Math.sin(d)),o.pos1.copy(r).add(s).multiplyScalar(m*u*(c+t()*(1-c))).add(i).add(n.pos0)},this.subrayCylinderPosition=function(a,n,o,h,u,c){o.pos0.copy(a.pos0),i.subVectors(n.pos1,n.pos0),e.copy(i).normalize(),i.multiplyScalar(a.fraction0+(1-a.fraction0)*((2*t()-1)*h));const m=i.length();r.crossVectors(n.up0,e);const d=2*Math.PI*t();r.multiplyScalar(Math.cos(d)),s.copy(n.up0).multiplyScalar(Math.sin(d)),o.pos1.copy(r).add(s).multiplyScalar(m*u*(c+t()*(1-c))).add(i).add(n.pos0)}}createSubray(){return{seed:0,maxIterations:0,recursion:0,pos0:new d,pos1:new d,linPos0:new d,linPos1:new d,up0:new d,up1:new d,radius0:0,radius1:0,birthTime:0,deathTime:0,timeScale:0,roughness:0,straightness:0,propagationTimeFactor:0,vanishingTimeFactor:0,endPropagationTime:0,beginVanishingTime:0}}createSegment(){return{iteration:0,pos0:new d,pos1:new d,linPos0:new d,linPos1:new d,up0:new d,up1:new d,radius0:0,radius1:0,fraction0:0,fraction1:0,positionVariationFactor:0}}getNewSegment(){return this.raySegments[this.currentSegmentIndex++]}copy(t){return super.copy(t),this.init(l.copyParameters({},t.rayParameters)),this}clone(){return new this.constructor(l.copyParameters({},this.rayParameters))}}l.RAY_INITIALIZED=0,l.RAY_UNBORN=1,l.RAY_PROPAGATING=2,l.RAY_STEADY=3,l.RAY_VANISHING=4,l.RAY_EXTINGUISHED=5,l.COS30DEG=Math.cos(30*Math.PI/180),l.SIN30DEG=Math.sin(30*Math.PI/180);const{MathUtils:g,Mesh:p,MeshBasicMaterial:y,Object3D:S}=await t("three");class b extends S{constructor(t={}){super(),this.isLightningStorm=!0,this.stormParams=t,t.size=void 0!==t.size?t.size:1e3,t.minHeight=void 0!==t.minHeight?t.minHeight:80,t.maxHeight=void 0!==t.maxHeight?t.maxHeight:100,t.maxSlope=void 0!==t.maxSlope?t.maxSlope:1.1,t.maxLightnings=void 0!==t.maxLightnings?t.maxLightnings:3,t.lightningMinPeriod=void 0!==t.lightningMinPeriod?t.lightningMinPeriod:3,t.lightningMaxPeriod=void 0!==t.lightningMaxPeriod?t.lightningMaxPeriod:7,t.lightningMinDuration=void 0!==t.lightningMinDuration?t.lightningMinDuration:1,t.lightningMaxDuration=void 0!==t.lightningMaxDuration?t.lightningMaxDuration:2.5,this.lightningParameters=l.copyParameters(t.lightningParameters,t.lightningParameters),this.lightningParameters.isEternal=!1,this.lightningMaterial=void 0!==t.lightningMaterial?t.lightningMaterial:new y({color:11599871}),void 0!==t.onRayPosition?this.onRayPosition=t.onRayPosition:this.onRayPosition=function(i,e){e.set((Math.random()-.5)*t.size,0,(Math.random()-.5)*t.size);const r=g.lerp(t.minHeight,t.maxHeight,Math.random());i.set(t.maxSlope*(2*Math.random()-1),1,t.maxSlope*(2*Math.random()-1)).multiplyScalar(r).add(e)},this.onLightningDown=t.onLightningDown,this.inited=!1,this.nextLightningTime=0,this.lightningsMeshes=[],this.deadLightningsMeshes=[];for(let i=0;i<this.stormParams.maxLightnings;i++){const t=new l(l.copyParameters({},this.lightningParameters)),i=new p(t,this.lightningMaterial);this.deadLightningsMeshes.push(i)}}update(t){if(this.inited||(this.nextLightningTime=this.getNextLightningTime(t)*Math.random(),this.inited=!0),t>=this.nextLightningTime){const i=this.deadLightningsMeshes.pop();if(i){const e=l.copyParameters(i.geometry.rayParameters,this.lightningParameters);e.birthTime=t,e.deathTime=t+g.lerp(this.stormParams.lightningMinDuration,this.stormParams.lightningMaxDuration,Math.random()),this.onRayPosition(e.sourceOffset,e.destOffset),e.noiseSeed=Math.random(),this.add(i),this.lightningsMeshes.push(i)}this.nextLightningTime=this.getNextLightningTime(t)}let i=0,e=this.lightningsMeshes.length;for(;i<e;){const r=this.lightningsMeshes[i],s=r.geometry,a=s.state;s.update(t),a===l.RAY_PROPAGATING&&s.state>a&&this.onLightningDown&&this.onLightningDown(s),s.state===l.RAY_EXTINGUISHED?(this.lightningsMeshes.splice(this.lightningsMeshes.indexOf(r),1),this.deadLightningsMeshes.push(r),this.remove(r),e--):i++}}getNextLightningTime(t){return t+g.lerp(this.stormParams.lightningMinPeriod,this.stormParams.lightningMaxPeriod,Math.random())/(this.stormParams.maxLightnings+1)}copy(t,i){return super.copy(t,i),this.stormParams.size=t.stormParams.size,this.stormParams.minHeight=t.stormParams.minHeight,this.stormParams.maxHeight=t.stormParams.maxHeight,this.stormParams.maxSlope=t.stormParams.maxSlope,this.stormParams.maxLightnings=t.stormParams.maxLightnings,this.stormParams.lightningMinPeriod=t.stormParams.lightningMinPeriod,this.stormParams.lightningMaxPeriod=t.stormParams.lightningMaxPeriod,this.stormParams.lightningMinDuration=t.stormParams.lightningMinDuration,this.stormParams.lightningMaxDuration=t.stormParams.lightningMaxDuration,this.lightningParameters=l.copyParameters({},t.lightningParameters),this.lightningMaterial=t.stormParams.lightningMaterial,this.onLightningDown=t.onLightningDown,this}clone(){return new this.constructor(this.stormParams).copy(this)}}const{defineComponent:P}=await t("vue"),{unref:f,openBlock:x,createElementBlock:v}=await t("vue"),w=["object"],_=await t("three"),{watchEffect:T}=await t("vue"),M=P({__name:"lightStorm",props:{color:{default:"#b0ffff"},size:{default:2e3},minHeight:{default:100},maxHeight:{default:500},maxLightnings:{default:18},roughness:{default:.85},straightness:{default:.65},radius0:{default:1},radius1:{default:.5},timeScale:{default:.15},subrayPeriod:{default:4},subrayDutyCycle:{default:.6}},setup(t){const i=t,r=new _.Color(i.color),s=new _.MeshBasicMaterial({color:r}),a=new _.Vector3(0,-1,0);let n=0;const o=new _.Vector3,h=new _.Vector3,u={roughness:i.roughness,straightness:i.straightness,radius0:i.radius0,radius1:i.radius1,timeScale:i.timeScale,subrayPeriod:i.subrayPeriod,subrayDutyCycle:i.subrayDutyCycle,minRadius:.3,maxIterations:7,propagationTimeFactor:.2,vanishingTimeFactor:.9,maxSubrayRecursion:3,ramification:3,recursionProbability:.4,onSubrayCreation:function(t,i,e,r){r.subrayConePosition(t,i,e,.6,.6,.5),n=r.rayParameters.sourceOffset.y,o.subVectors(e.pos1,r.rayParameters.sourceOffset);const s=a.dot(o);h.copy(a).multiplyScalar(s),o.sub(h);const u=s/n>.5?n/s:1;h.multiplyScalar(u),o.add(h),e.pos1.addVectors(o,r.rayParameters.sourceOffset)}},c=new b({size:i.size,minHeight:i.minHeight,maxHeight:i.maxHeight,maxSlope:.6,maxLightnings:i.maxLightnings,lightningParameters:u,lightningMaterial:s});T(()=>{const t=c.stormParams;t.size=i.size,t.minHeight=i.minHeight,t.maxHeight=i.maxHeight,s.color.set(i.color),u.roughness=i.roughness,u.straightness=i.straightness,u.radius0=i.radius0,u.radius1=i.radius1,u.timeScale=i.timeScale});const{onBeforeRender:m}=e();return m(({elapsed:t})=>{c.update(t)}),(t,i)=>(x(),v("primitive",{object:f(c),renderOrder:9999},null,8,w))}}),{defineComponent:C}=await t("vue"),{unref:I,createVNode:V,mergeProps:D,withCtx:F,Fragment:R,openBlock:A,createElementBlock:G}=await t("vue"),{reactive:U}=await t("vue"),H=C({__name:"lightningStorm",setup(t){const e=U({cellSize:60,cellThickness:1,cellColor:"#6f6f6f",sectionColor:"#92399e",sectionSize:330,sectionThickness:1.5,fadeDistance:3600,fadeStrength:1,followCamera:!1,infiniteGrid:!0}),{minHeight:r,maxHeight:o,color:h,roughness:u,straightness:c,radius0:m,radius1:d,timeScale:l}=a({minHeight:{label:"最低",value:100,min:10,max:500,step:10},maxHeight:{label:"最高",value:1e3,min:50,max:2e3,step:10},color:"#ffbde7",roughness:{label:"粗糙度",value:.85,min:0,max:1,step:.01},straightness:{label:"直度度",value:.65,min:0,max:1,step:.01},radius0:{label:"端部半径",value:1,min:.1,max:10,step:.01},radius1:{label:"未部半径",value:.5,min:.1,max:10,step:.01},timeScale:{label:"时间缩放",value:.15,min:.01,max:1,step:.01}});return(t,a)=>(A(),G(R,null,[V(i,{showAxesHelper:!1,showGridHelper:!1},{ability:F(()=>[V(M,{minHeight:I(r).value,maxHeight:I(o).value,color:I(h).value,roughness:I(u).value,straightness:I(c).value,radius0:I(m).value,radius1:I(d).value,timeScale:I(l).value},null,8,["minHeight","maxHeight","color","roughness","straightness","radius0","radius1","timeScale"]),V(I(s),D({args:[100,100]},e,{position:[0,-50,0]}),null,16)]),_:1}),V(I(n))],64))}});export{H as default};
