import{importShared as i}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{_export_sfc as I,Kk as L}from"./index.DTe2qqjO1767148983502.js";import{__federation_method_setRemote as F,__federation_method_getRemote as x,__federation_method_unwrapDefault as D}from"./_virtual___federation__.D_UB9o2p1767148983502.js";import{Button as j}from"./Button.DslW6U6X1767148983502.js";import{useMessage as U,NMessageProvider as G}from"./use-message.BBJznJob1767148983502.js";import{NSpace as M}from"./Space.ugCFVeji1767148983502.js";import{NInput as H}from"./Input.FhrARThI1767148983502.js";import{NDescriptions as K,NDescriptionsItem as C,NList as W,NListItem as q,NThing as J}from"./Thing.DAm6oPs-1767148983502.js";import{NTag as R}from"./Tag.B40cK7ZV1767148983502.js";import{Pane as Q}from"./tweakpane.BQRZXf8M1767148983502.js";class X{constructor(e){this.path="",this.resPath="",this.config=null,this.loading=null,this.remoteName=e}setPath(e){this.path===e&&this.config||(this.path=e,this.config=null,this.loading=null,F(this.remoteName,{url:()=>Promise.resolve(e),format:"esm",from:"vite"}))}setResPath(e){this.resPath=e,window.__REMOTE_ASSET_MAP__??={}}async loadConfig(){return this.config?this.config:this.loading?this.loading:(this.loading=x(this.remoteName,"./config").then(e=>D(e)).then(e=>(this.validateConfig(e),this.config=e,window.__REMOTE_ASSET_MAP__[e.name]=this.resPath,e)).catch(e=>{throw this.config=null,console.error(`[Remote ${this.remoteName}] load config failed:`,e),e}).finally(()=>{this.loading=null}),this.loading)}async loadComponentModule(e){if(!this.config)throw new Error(`[Remote ${this.remoteName}] config not loaded`);return x(this.remoteName,e).then(o=>D(o))}getConfig(){return this.config}async reload(){return this.config=null,this.loading=null,this.loadConfig()}validateConfig(e){if(!e?.name||!Array.isArray(e.components))throw new Error(`[Remote ${this.remoteName}] config schema invalid`)}}class B{constructor(){this.remotes=new Map}static getInstance(){return this.instance||(this.instance=new B),this.instance}registerRemote(e,o,r){let t=this.remotes.get(e);return t||(t=new X(e),this.remotes.set(e,t)),t.setResPath(o),t.setPath(r),t}getRemote(e){return this.remotes.get(e)}async loadRemoteConfig(e){const o=this.remotes.get(e);if(!o)throw new Error(`Remote "${e}" not registered`);return o.loadConfig()}getRemoteConfig(e){return this.remotes.get(e)?.getConfig()}async loadAll(){return Promise.all([...this.remotes.values()].map(e=>e.loadConfig()))}}const $=B.getInstance(),{defineComponent:Y}=await i("vue"),{unref:w,createVNode:S,createTextVNode:Z,withCtx:P,openBlock:ee,createBlock:te}=await i("vue"),{ref:T}=await i("vue"),oe=Y({__name:"ServiceLoader",emits:["loaded"],setup(m,{emit:e}){const o=e,r=U(),t=T("http://dcser.icegl.cn"),n=T(!1),a=async()=>{if(!t.value){r.warning("请输入服务地址");return}n.value=!0;try{$.registerRemote("base",t.value+"/",t.value+"/assets/remoteEntry.js");const s=await $.loadRemoteConfig("base");o("loaded",s),r.success("服务加载成功")}catch{r.error("服务加载失败")}finally{n.value=!1}};return(s,p)=>(ee(),te(w(M),{vertical:"",size:"large"},{default:P(()=>[S(w(H),{value:t.value,"onUpdate:value":p[0]||(p[0]=l=>t.value=l),placeholder:"请输入服务地址",clearable:""},null,8,["value"]),S(w(j),{type:"primary",block:"",loading:n.value,onClick:a},{default:P(()=>[...p[1]||(p[1]=[Z(" 应用服务 ",-1)])]),_:1},8,["loading"])]),_:1}))}}),{defineComponent:ne}=await i("vue"),{toDisplayString:y,createTextVNode:f,unref:c,withCtx:u,createVNode:d,renderList:ae,Fragment:re,openBlock:N,createElementBlock:le,normalizeClass:se,createBlock:E}=await i("vue"),ie=ne({__name:"ServiceViewer",props:{data:{},selectedType:{}},emits:["select","reset"],setup(m,{emit:e}){const o=m,r=e,t=n=>{r("select",n)};return(n,a)=>(N(),E(c(M),{vertical:"",size:"large"},{default:u(()=>[d(c(K),{bordered:"",size:"small"},{default:u(()=>[d(c(C),{label:"名称"},{default:u(()=>[f(y(o.data.name),1)]),_:1}),d(c(C),{label:"版本"},{default:u(()=>[d(c(R),{type:"info"},{default:u(()=>[f(y(o.data.version),1)]),_:1})]),_:1}),d(c(C),{label:"描述"},{default:u(()=>[f(y(o.data.description),1)]),_:1})]),_:1}),d(c(W),{bordered:"",hoverable:"",clickable:""},{default:u(()=>[(N(!0),le(re,null,ae(o.data.components,s=>(N(),E(c(q),{class:se({"n-list-item--active":n.selectedType&&s.type===n.selectedType}),key:s.type,onClick:p=>t(s)},{default:u(()=>[d(c(J),{title:s.name,description:s.type},{"header-extra":u(()=>[d(c(R),{size:"small"},{default:u(()=>[...a[1]||(a[1]=[f("点击载入调试",-1)])]),_:1})]),_:1},8,["title","description"])]),_:2},1032,["class","onClick"]))),128))]),_:1}),d(c(j),{type:"warning",block:"",onClick:a[0]||(a[0]=s=>r("reset"))},{default:u(()=>[...a[2]||(a[2]=[f(" 删除当前服务 / 重新加载 ",-1)])]),_:1})]),_:1}))}}),ce=I(ie,[["__scopeId","data-v-e8a20270"]]);function ue(m,e,o){const r=new Q({container:m,title:"配置"});return Object.entries(e).forEach(([t,n])=>{switch(n.com){case"Select":r.addBinding(o,t,{label:n.name,options:n.options?.reduce((a,s)=>(a[s.label]=s.value,a),{})}).on("change",a=>{o[t]=a.value});break;case"ColorPicker":r.addBinding(o,t,{label:n.name,picker:"inline"}).on("change",a=>{o[t]=a.value});break;case"Switch":r.addBinding(o,t,{label:n.name}).on("change",a=>{o[t]=a.value});break;case"Slider":r.addBinding(o,t,{label:n.name,min:n.min,max:n.max,step:n.step}).on("change",a=>{o[t]=a.value});break;default:console.warn(`未知组件类型：${n.com}`)}}),r}const{withAsyncContext:de,defineComponent:me}=await i("vue"),{resolveDynamicComponent:pe,normalizeProps:fe,openBlock:_e,createBlock:ge,mergeProps:he,createCommentVNode:ve}=await i("vue"),{shallowRef:Ce,onBeforeUnmount:we}=await i("vue"),ye=me({__name:"oneRemoteCom",props:{remoteName:{},comName:{},attrsData:{},config:{}},async setup(m){let e,o;const r=m,t=Ce(null),n=$.getRemote(r.remoteName);n&&(t.value=([e,o]=de(()=>n.loadComponentModule(`./${r.comName}`)),e=await e,o(),e));const a=ue(document.getElementById("pane"),r.config,r.attrsData);return we(()=>{a&&a.dispose()}),(s,p)=>t.value?(_e(),ge(pe(t.value),fe(he({key:0},s.attrsData)),null,16)):ve("",!0)}}),{defineComponent:Ne}=await i("vue"),{openBlock:_,createBlock:h,createCommentVNode:be,unref:V,withCtx:b,createVNode:k,createElementVNode:O,mergeProps:z,Suspense:ke,resolveComponent:$e,Fragment:Be,createElementBlock:xe}=await i("vue"),{SRGBColorSpace:De,BasicShadowMap:Re,NoToneMapping:Se}=await i("three"),{nextTick:Pe,reactive:Te,ref:v}=await i("vue"),Ue=Ne({__name:"readConfig",setup(m){const e=Te({clearColor:"#201919",shadows:!0,alpha:!1,shadowMapType:Re,outputColorSpace:De,toneMapping:Se}),o=l=>{r.value=l,console.log("服务配置加载完成：",l)},r=v(null),t=v(null),n=v(null),a=v(null),s=l=>{console.log("选中组件",l),!(t.value&&t.value.comName===l.type)&&(t.value=null,n.value={},a.value=null,Pe(()=>{n.value=l?.default||{},a.value=l?.config||null,t.value={remoteName:"base",comName:l.type,position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]},l.defaultObject3D?.position&&(t.value.position=[l.defaultObject3D.position.x,l.defaultObject3D.position.y,l.defaultObject3D.position.z]),l.defaultObject3D?.rotation&&(t.value.rotation=[l.defaultObject3D.rotation.x,l.defaultObject3D.rotation.y,l.defaultObject3D.rotation.z]),l.defaultObject3D?.scale&&(t.value.scale=[l.defaultObject3D.scale.x,l.defaultObject3D.scale.y,l.defaultObject3D.scale.z])}))},p=()=>{t.value=null,r.value=null};return(l,g)=>{const A=$e("TresCanvas");return _(),xe(Be,null,[k(V(G),null,{default:b(()=>[r.value?(_(),h(ce,{key:1,data:r.value,selectedType:t.value?.comName,onSelect:s,onReset:p,style:{"z-index":"99999",position:"absolute",left:"10px",top:"50px"}},null,8,["data","selectedType"])):(_(),h(oe,{key:0,onLoaded:o,style:{"z-index":"99999",position:"absolute",left:"10px",top:"50px"}}))]),_:1}),k(A,z(e,{"window-size":""}),{default:b(()=>[g[0]||(g[0]=O("TresPerspectiveCamera",{position:[5,5,5]},null,-1)),k(V(L)),(_(),h(ke,null,{default:b(()=>[t.value?(_(),h(ye,z({key:0},t.value,{attrsData:n.value,config:a.value}),null,16,["attrsData","config"])):be("",!0)]),_:1})),g[1]||(g[1]=O("TresGridHelper",{"position-y":.1},null,-1))]),_:1},16)],64)}}});export{Ue as default};
