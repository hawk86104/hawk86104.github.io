import{b as t}from"./pagesShow.vue_vue_type_script_setup_true_lang.cdvjGRv21736128832096.js";import{c5 as n,_ as e,c3 as o,cf as r,m as i,cp as u}from"./three.8H01GNxA1736128832096.js";import{m as s,e as c}from"./@tresjs.pA0fT6uQ1736128832096.js";import{d as a,a1 as l,r as p,o as f,f as d,g as v,j as m,aj as h,ak as w}from"./@vue.yG49nQHr1736128832096.js";import{P as x}from"./tweakpane.yHWGBmom1736128832096.js";import"./three-custom-shader-material.rJQtaDBw1736128832096.js";import"./buildingsCustomShaderMaterial.hq-IAd4G1736128832096.js";import"./@vueuse.iB8cUOAP1736128832096.js";const P=I;!function(t,n){const e=I,o=y();for(;;)try{if(988909===-parseInt(e(168))/1*(parseInt(e(156))/2)+-parseInt(e(152))/3*(parseInt(e(140))/4)+-parseInt(e(114))/5+-parseInt(e(161))/6*(parseInt(e(142))/7)+-parseInt(e(110))/8*(-parseInt(e(165))/9)+parseInt(e(131))/10*(parseInt(e(119))/11)+-parseInt(e(129))/12*(-parseInt(e(166))/13))break;o.push(o.shift())}catch(r){o.push(o.shift())}}();const S=function(){let t=!0;return function(n,e){const o=t?function(){if(e){const t=e[I(151)](n,arguments);return e=null,t}}:function(){};return t=!1,o}}();!function(){S(this,(function(){const t=I,n=new RegExp("function *\\( *\\)"),e=new RegExp("\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","i"),o=_("init");n[t(133)](o+t(145))&&e.test(o+t(148))?_():o("0")}))()}();const g=function(){let t=!0;return function(n,e){const o=t?function(){if(e){const t=e[I(151)](n,arguments);return e=null,t}}:function(){};return t=!1,o}}();function y(){const t=["Color","call","material","warn","stateObject","render","1473036oVvFFS","info","889JtKCGr","readBuffer","trace","chain","DepthTexture","action","input","height","uScaleone","apply","12IOANZB","depthBuffer","log","bind","322xKiYhE","gger","debu","uPosition","uScalenum","2646pDMXib","string","return (function() ","exception","9KgvnNI","683072kUTLML","length","797fiDUER","uWidth","15428344aiEpAf","value","error","toString","7769705wRkCjp","constructor","uColor","counter","Vector2","1588103SjhQQB","projectionMatrixInverse","set","matrixWorld",'{}.constructor("return this")( )',"table","#FFF","console","color","uniforms","288auKyut","addPass","70LNSYNb","speed","test"];return(y=function(){return t})()}g(void 0,(function(){const t=I,n=function(){const t=I;let n;try{n=Function(t(163)+t(123)+");")()}catch(e){n=window}return n}(),e=n[t(126)]=n.console||{},o=[t(154),t(137),t(141),t(112),t(164),t(124),t(144)];for(let r=0;r<o[t(167)];r++){const n=g[t(115)].prototype[t(155)](g),i=o[r],u=e[i]||n;n.__proto__=g[t(155)](g),n[t(113)]=u[t(113)][t(155)](u),e[i]=n}}))();const b=a({__name:"buildingsPassA",props:{color:{default:P(125)},uScalenum:{default:150},uScaleone:{default:24},uWidth:{default:1},speed:{default:1},uPosition:{default:{x:0,y:0}}},setup(t){const a=t,{renderer:p,scene:f,camera:d,sizes:v}=s();let m,h=0,w=null,x=null;l((()=>{const t=I;v.width.value&&(m=v.width[t(111)],h=v[t(149)][t(111)],(()=>{const t=I;w=new n(p.value);const s=new(e[t(146)])(m,h);w[t(143)][t(153)]=!0,w[t(143)].depthTexture=s;const c=new o(f.value,d[t(111)]);w[t(130)](c),x=new r(new i({uniforms:{time:{value:0},tDiffuse:{value:null},depthTexture:{value:s},uProjectionInverse:{value:d[t(111)][t(120)]},uMatrixWorld:{value:d[t(111)][t(122)]},uColor:{value:new(e[t(134)])(a[t(127)])},uScalenum:{value:a.uScalenum},uScaleone:{value:a[t(150)]},uWidth:{value:a.uWidth},uPosition:{value:new(e[t(118)])(a[t(159)].x,a[t(159)].y)}},vertexShader:"varying vec2 vUv;\nvarying vec3 vPosition;\n\nvoid main(){\n\tvUv=uv;\n\tvPosition=position;\n\tgl_Position=vec4(position,1.);\n}\n",fragmentShader:"varying vec2 vUv;\nvarying vec3 vPosition;\nuniform sampler2D tDiffuse;\nuniform sampler2D depthTexture;\n\nuniform mat4 uProjectionInverse;\nuniform mat4 uMatrixWorld;\n\nuniform float time;\nuniform vec3 uColor;\nuniform float uScalenum;//最大范围\nuniform float uScaleone;//单条圈间距\nuniform float uWidth;//单条厚度\nuniform vec2 uPosition;//位置\n\nvec3 WorldPosFromDepth(float depth){\n\tfloat z=(depth-.5)*2.;\n\tvec4 clipSpacePosition=vec4(vPosition.xy,z,1.);\n\tvec4 viewSpacePosition=uProjectionInverse*clipSpacePosition;\n\tviewSpacePosition/=viewSpacePosition.w;\n\tvec4 worldSpacePosition=uMatrixWorld*viewSpacePosition;\n\treturn worldSpacePosition.xyz;\n}\nvec3 WorldPosFromDepth2(float depth){\n\t// 规范化设备坐标系 ndc (Normalized Device Coordinates)\n\tvec4 ndc=vec4(vPosition.x,vPosition.y,((depth-.5)*2.),1.);\n\t// 根据视图中的位置和深度逆向MVP (ModelViewProjectionMatrix) 以获取真实渲染的位置\n\tvec4 worldSpacePosition=uMatrixWorld*uProjectionInverse*ndc;\n\t// 由于透视相机视图区域是一个截锥体 在乘以矩阵后，结果不在同一个射影空间上（这意味着 w 分量不是每个顶点的 1）\n\t// 为了完成转换，我们需要将向量的每个分量除以 w 分量本身\n\t// 这一步正常渲染时在GPU中做 我们复原需要手动处理\n\tworldSpacePosition/=worldSpacePosition.w;\n\treturn worldSpacePosition.xyz;\n}\n\nvoid main(){\n\tvec4 base=texture2D(tDiffuse,vUv);//之前的纹理\n\tfloat depth=texture2D(depthTexture,vUv).r;\n\t\n\t// vec3 pos=WorldPosFromDepth(depth);\n\tvec3 pos=WorldPosFromDepth2(depth);\n\tpos.x=pos.x+uPosition.x;\n\tpos.z=pos.z+uPosition.y;\n\tfloat dis=distance(pos.xz,vec2(0,0));\n\tvec3 color=vec3(base);\n\tif(pos.y<=0.){\n\t\tdiscard;\n\t}\n\tif(dis<uScalenum){\n\t\tvec3 scanT=uColor;\n\t\tfloat wave=fract((dis-time*10.)/uScaleone);\n\t\tif(wave<uWidth){\n\t\t\tfloat p=wave/uWidth;\n\t\t\tcolor=mix(color,scanT+.1,p*(1.-(dis/uScalenum)));\n\t\t}\n\t}\n\tgl_FragColor=vec4(color,1.);\n}\n"})),w[t(130)](x);const l=new r(u);w.addPass(l)})())}));const{onLoop:P}=c();return P((({elapsed:t})=>{const n=I;w&&(w[n(139)](),x[n(128)].time[n(111)]+=a[n(132)]/60)})),l((()=>{const t=I;x&&(a[t(127)]&&(x[t(136)][t(128)][t(116)][t(111)]=new(e[t(134)])(a[t(127)])),a[t(160)]&&(x[t(136)][t(128)][t(160)][t(111)]=a[t(160)]),a.uScaleone&&(x[t(136)][t(128)][t(150)].value=a[t(150)]),a[t(109)]&&(x.material[t(128)][t(109)].value=a[t(109)]),a[t(159)]&&x[t(136)][t(128)][t(159)].value[t(121)](a[t(159)].x,a[t(159)].y))})),(t,n)=>null}});function I(t,n){const e=y();return(I=function(t,n){return e[t-=109]})(t,n)}function _(t){function n(t){const e=I;if(typeof t===e(162))return function(t){}[e(115)]("while (true) {}")[e(151)](e(117));1!==(""+t/t)[e(167)]||t%20==0?function(){return!0}.constructor(e(158)+e(157))[e(135)](e(147)):function(){return!1}[e(115)](e(158)+e(157))[e(151)](e(138)),n(++t)}try{if(t)return n;n(0)}catch(e){}}const j=F;!function(t,n){const e=F,o=D();for(;;)try{if(291724===-parseInt(e(269))/1*(-parseInt(e(268))/2)+-parseInt(e(247))/3+parseInt(e(248))/4+-parseInt(e(270))/5+-parseInt(e(258))/6+parseInt(e(251))/7*(-parseInt(e(256))/8)+parseInt(e(236))/9)break;o.push(o.shift())}catch(r){o.push(o.shift())}}();const W=function(){let t=!0;return function(n,e){const o=t?function(){if(e){const t=e[F(264)](n,arguments);return e=null,t}}:function(){};return t=!1,o}}();function D(){const t=["uScaleone","apply","最大范围","trace","#00b4fb","826rylULw","683yMHhRZ","211660RXOEQT","test","while (true) {}","inline","exception","toString","return (function() ","buildingsPassA","gger","debu","uScalenum","__proto__","console","单条圈宽度","call","2754234xdaefY","input","uPosition","init","uWidth","bind","单条圈间距","info","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","圈颜色","prototype","468081CBzcGt","191872TCfHQs","length","error","42bOYMeX","addBinding","string","stateObject","counter","131888eirUWF","color","282444tfONKK","action","warn","constructor","function *\\( *\\)"];return(D=function(){return t})()}!function(){W(this,(function(){const t=F,n=new RegExp(t(262)),e=new RegExp(t(244),"i"),o=C(t(239));n.test(o+"chain")&&e[t(271)](o+t(237))?C():o("0")}))()}();const z=function(){let t=!0;return function(n,e){const o=t?function(){if(e){const t=e.apply(n,arguments);return e=null,t}}:function(){};return t=!1,o}}();function F(t,n){const e=D();return(F=function(t,n){return e[t-=227]})(t,n)}z(void 0,(function(){const t=F,n=function(){const t=F;let n;try{n=Function(t(227)+'{}.constructor("return this")( ));')()}catch(e){n=window}return n}(),e=n[t(233)]=n[t(233)]||{},o=["log",t(260),t(243),t(250),t(274),"table",t(266)];for(let r=0;r<o[t(249)];r++){const n=z[t(261)][t(246)][t(241)](z),i=o[r],u=e[i]||n;n[t(232)]=z[t(241)](z),n[t(275)]=u.toString.bind(u),e[i]=n}}))();const M=a({__name:j(228),setup(n){const e=j,o=p({color:e(267),uScalenum:250,uScaleone:82,uWidth:.2,speed:10,uPosition:{x:0,y:0}}),r=new x({title:"后期效果",expanded:!0});return r[e(252)](o,e(257),{label:e(245)}),r[e(252)](o,e(231),{label:e(265),min:1,max:500,step:10}),r[e(252)](o,e(263),{label:e(242),min:1,max:100,step:1}),r[e(252)](o,e(240),{label:e(234),min:0,max:1,step:.01}),r[e(252)](o,"speed",{label:"速度",min:1,max:20,step:1}),r[e(252)](o,e(238),{picker:e(273),label:"位置",expanded:!0,x:{min:-1e3,max:1e3,step:10},y:{min:-1e3,max:1e3,step:10}}),(n,e)=>(f(),d(t,{disableRender:!0,showAxesHelper:!1},{ability:v((()=>[m(b,h(w(o)),null,16)])),_:1}))}});function C(t){function n(t){const e=F;if(typeof t===e(253))return function(t){}[e(261)](e(272))[e(264)](e(255));1!==(""+t/t)[e(249)]||t%20==0?function(){return!0}.constructor(e(230)+e(229))[e(235)](e(259)):function(){return!1}[e(261)](e(230)+e(229))[e(264)](e(254)),n(++t)}try{if(t)return n;n(0)}catch(e){}}export{M as default};
