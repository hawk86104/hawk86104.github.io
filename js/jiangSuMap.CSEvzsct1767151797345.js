import{importShared as e}from"./3d-tiles-renderer.BWkWgmMi1767151797345.js";import{useTres as t,useLoop as r,HTML_default as o,OrbitControls_default as n}from"./index.DdZsEhdb1767151797345.js";import{loadGeojson as i}from"./utils.CLJkivYr1767151797345.js";import{useTexture as s}from"./customShaderMaterial.vue_vue_type_script_setup_true_lang.e0hhdInO1767151797345.js";import"./index.vue_vue_type_script_setup_true_lang.0B77w2vF1767151797345.js";import{flyTo as a}from"./utils.DG43M36M1767151797345.js";import{mercator as p}from"./mercator.WSW2E7OF1767151797345.js";import{computeBoundsTree as l,disposeBoundsTree as c,acceleratedRaycast as u}from"./ExtensionUtilities.sfOplke61767151797345.js";const{withAsyncContext:m}=await e("vue"),{renderList:d,Fragment:h,openBlock:f,createElementBlock:y,toDisplayString:g,createElementVNode:v,unref:w,mergeProps:T,withCtx:_,createBlock:C,createCommentVNode:B}=await e("vue"),M=["position"],j=["blending","map"],x=["name","renderOrder","pCenter"],S=["args"],k=["color","side"],E=["renderOrder","position-z"],L=["position"],b=["renderOrder"],z=["position"],{watchEffect:P,ref:G}=await e("vue"),O=await e("three"),D={__name:"jiangSuMapMesh",async setup(e){let n,D;O.BufferGeometry.prototype.computeBoundsTree=l,O.BufferGeometry.prototype.disposeBoundsTree=c,O.Mesh.prototype.raycast=u;const V=([n,D]=m(()=>i("./plugins/simpleGIS/json/320000_full.json","features")),n=await n,D(),n),N=([n,D]=m(()=>s("./plugins/simpleGIS/image/icon.png")),n=await n,D(),n),F=V[0].properties.centroid,H=p();H.center(F).translate([0,0]);const A=[];V.forEach(e=>{const t=new O.Color(`hsl( 16, ${30*Math.random()+55}%, ${30*Math.random()+55}%)`).getHex(),r=.3*Math.random()+.3,{centroid:o,oneCenter:n,center:i,name:s}=e.properties,{coordinates:a,type:p}=e.geometry,l=o||n||i||[0,0],c=H(l);c[1]=-c[1],c[2]=r,A.push({type:"Html",position:c,name:s});const u=H(l);u[1]=.2-u[1],u[2]=r+.22,A.push({type:"Sprite",position:u}),a.forEach(e=>{function o(e){const o=new O.Shape;e.forEach((e,t)=>{const[r,n]=H(e);0===t?o.moveTo(r,-n):o.lineTo(r,-n)}),A.push({type:"Shape",shape:o,name:s,color:t,depth:r,pCenter:u});const n=[];e.forEach(e=>{const[t,r]=H(e);n.push(t,-r,0)}),A.push({type:"Line",points:new Float32Array(n),depth:r})}"MultiPolygon"===p&&e.forEach(e=>o(e)),"Polygon"===p&&o(e)})});const I=G();P(()=>{I.value&&((e=>{e.rotation.x=-Math.PI/2;const t=(new O.Box3).setFromObject(e).getCenter(new O.Vector3),r=[0,0];e.position.x=e.position.x-t.x-r[0],e.position.z=e.position.z-t.z-r[1]})(I.value),I.value.children.forEach(e=>{"Mesh"===e.type&&e.geometry.computeBoundsTree()}))});const R=e=>{e.object.material.opacity=.4},$=e=>{e.eventObject.material.opacity=1},{camera:U,controls:q}=t();let J=null;const K=e=>{const t=new O.Vector3;t.x=e.point.x,t.y=e.point.y+10,t.z=e.point.z,J=a(U,t,q)},{onBeforeRender:Q}=r();Q(()=>{J?.update()});const W={wrapperClass:"wrapper",as:"div",center:!0,sprite:!0,prepend:!0,transform:!0};return(e,t)=>(f(),y("TresGroup",{ref_key:"tgRef",ref:I},[(f(),y(h,null,d(A,(e,r)=>(f(),y(h,{key:`${r}`},["Html"===e.type?(f(),C(w(o),T({key:0,ref_for:!0},W,{position:e.position}),{default:_(()=>[v("span",null,g(e.name),1)]),_:2},1040,["position"])):B("",!0),"Sprite"===e.type?(f(),y("TresSprite",{key:1,position:e.position,scale:.3,renderOrder:1e3},[v("TresSpriteMaterial",{color:16711680,blending:O.NormalBlending,map:w(N)},null,8,j)],8,M)):B("",!0),"Shape"===e.type?(f(),y("TresMesh",{key:2,name:e.name,renderOrder:r,pCenter:e.pCenter,onPointerenter:R,onPointerleave:$,onClick:K},[v("TresExtrudeGeometry",{args:[e.shape,{depth:e.depth,bevelEnabled:!1}]},null,8,S),v("TresMeshStandardMaterial",{color:e.color,emissive:0,roughness:.45,metalness:.8,transparent:!0,side:O.DoubleSide},null,8,k)],40,x)):B("",!0),"Line"===e.type?(f(),y(h,{key:3},[v("TresLine",{renderOrder:r,"position-z":e.depth+1e-4},[v("TresBufferGeometry",{position:[e.points,3]},null,8,L),t[0]||(t[0]=v("TresLineBasicMaterial",{color:16777215,linewidth:.5},null,-1))],8,E),v("TresLine",{renderOrder:r,"position-z":-1e-4},[v("TresBufferGeometry",{position:[e.points,3]},null,8,z),t[1]||(t[1]=v("TresLineBasicMaterial",{color:0,linewidth:.5},null,-1))],8,b)],64)):B("",!0)],64))),64))],512))}},{defineComponent:V}=await e("vue"),{createElementVNode:N,unref:F,normalizeProps:H,guardReactiveProps:A,createVNode:I,Suspense:R,withCtx:$,openBlock:U,createBlock:q,resolveComponent:J,mergeProps:K}=await e("vue"),{reactive:Q}=await e("vue"),W=V({__name:"jiangSuMap",setup(e){const t=Q({clearColor:"#ffdbd1",alpha:!0,antialias:!0}),r=Q({enableDamping:!0,dampingFactor:.05,makeDefault:!0});return(e,o)=>{const i=J("TresCanvas");return U(),q(i,K(t,{"window-size":""}),{default:$(()=>[o[0]||(o[0]=N("TresPerspectiveCamera",{position:[0,12,0],fov:75,near:.1,far:1e3,up:[0,0,-1]},null,-1)),I(F(n),H(A(r)),null,16),o[1]||(o[1]=N("TresAmbientLight",{intensity:8.8},null,-1)),o[2]||(o[2]=N("TresDirectionalLight",{position:[0,10,5],intensity:.2},null,-1)),o[3]||(o[3]=N("TresDirectionalLight",{position:[0,10,-5],intensity:.2},null,-1)),o[4]||(o[4]=N("TresDirectionalLight",{position:[5,10,0],intensity:.2},null,-1)),o[5]||(o[5]=N("TresDirectionalLight",{position:[-5,10,0],intensity:.2},null,-1)),o[6]||(o[6]=N("TresGridHelper",{args:[20,10]},null,-1)),(U(),q(R,null,{default:$(()=>[I(D)]),_:1}))]),_:1},16)}}});export{W as default};
