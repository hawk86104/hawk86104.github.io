var ee=Object.defineProperty;var ae=(h,t,n)=>t in h?ee(h,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):h[t]=n;var O=(h,t,n)=>(ae(h,typeof t!="symbol"?t+"":t,n),n);import{cH as re,bf as F,at as P,cI as x,aI as Y,ak as K,cb as te,l as N,v as W,cJ as ne,w as M,cK as X,L as D,cL as oe,cp as j,ct as se,aF as ie,aw as le,a1 as Q,cM as q,cN as ce,cO as ue,aQ as de,cP as _e,aD as me,o as I,c as U,a0 as pe,Z as he,a9 as ge,az as fe,a6 as ve,x as Ee,Y as Re,ap as ye}from"./vendor.ydO6dH7Z1712722105506.js";class J extends re{constructor(t){super(t),this.type=F}parse(t){const _=function(e,o){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(o||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(o||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(o||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(o||""))}return-1},c="\n",E=function(e,o,u){o=o||1024;let l=e.pos,s=-1,a=0,d="",r=String.fromCharCode.apply(null,new Uint16Array(e.subarray(l,l+128)));for(;0>(s=r.indexOf(c))&&a<o&&l<e.byteLength;)d+=r,a+=r.length,l+=128,r+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(l,l+128)));return-1<s?(u!==!1&&(e.pos+=a+s+1),d+r.slice(0,s)):!1},R=function(e){const o=/^#\?(\S+)/,u=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,l=/^\s*FORMAT=(\S+)\s*$/,s=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,a={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let d,r;if(e.pos>=e.byteLength||!(d=E(e)))return _(1,"no header found");if(!(r=d.match(o)))return _(3,"bad initial token");for(a.valid|=1,a.programtype=r[1],a.string+=d+"\n";d=E(e),d!==!1;){if(a.string+=d+"\n",d.charAt(0)==="#"){a.comments+=d+"\n";continue}if((r=d.match(u))&&(a.gamma=parseFloat(r[1])),(r=d.match(i))&&(a.exposure=parseFloat(r[1])),(r=d.match(l))&&(a.valid|=2,a.format=r[1]),(r=d.match(s))&&(a.valid|=4,a.height=parseInt(r[1],10),a.width=parseInt(r[2],10)),a.valid&2&&a.valid&4)break}return a.valid&2?a.valid&4?a:_(3,"missing image size specifier"):_(3,"missing format specifier")},B=function(e,o,u){const i=o;if(i<8||i>32767||e[0]!==2||e[1]!==2||e[2]&128)return new Uint8Array(e);if(i!==(e[2]<<8|e[3]))return _(3,"wrong scanline width");const l=new Uint8Array(4*o*u);if(!l.length)return _(4,"unable to allocate buffer space");let s=0,a=0;const d=4*i,r=new Uint8Array(4),L=new Uint8Array(d);let $=u;for(;$>0&&a<e.byteLength;){if(a+4>e.byteLength)return _(1);if(r[0]=e[a++],r[1]=e[a++],r[2]=e[a++],r[3]=e[a++],r[0]!=2||r[1]!=2||(r[2]<<8|r[3])!=i)return _(3,"bad rgbe scanline format");let A=0,y;for(;A<d&&a<e.byteLength;){y=e[a++];const w=y>128;if(w&&(y-=128),y===0||A+y>d)return _(3,"bad scanline data");if(w){const b=e[a++];for(let z=0;z<y;z++)L[A++]=b}else L.set(e.subarray(a,a+y),A),A+=y,a+=y}const Z=i;for(let w=0;w<Z;w++){let b=0;l[s]=L[w+b],b+=i,l[s+1]=L[w+b],b+=i,l[s+2]=L[w+b],b+=i,l[s+3]=L[w+b],s+=4}$--}return l},G=function(e,o,u,i){const l=e[o+3],s=Math.pow(2,l-128)/255;u[i+0]=e[o+0]*s,u[i+1]=e[o+1]*s,u[i+2]=e[o+2]*s,u[i+3]=1},V=function(e,o,u,i){const l=e[o+3],s=Math.pow(2,l-128)/255;u[i+0]=x.toHalfFloat(Math.min(e[o+0]*s,65504)),u[i+1]=x.toHalfFloat(Math.min(e[o+1]*s,65504)),u[i+2]=x.toHalfFloat(Math.min(e[o+2]*s,65504)),u[i+3]=x.toHalfFloat(1)},C=new Uint8Array(t);C.pos=0;const T=R(C);if(T!==-1){const e=T.width,o=T.height,u=B(C.subarray(C.pos),e,o);if(u!==-1){let i,l,s;switch(this.type){case P:s=u.length/4;const a=new Float32Array(s*4);for(let r=0;r<s;r++)G(u,r*4,a,r*4);i=a,l=P;break;case F:s=u.length/4;const d=new Uint16Array(s*4);for(let r=0;r<s;r++)V(u,r*4,d,r*4);i=d,l=F;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:e,height:o,data:i,header:T.string,gamma:T.gamma,exposure:T.exposure,type:l}}}return null}setDataType(t){return this.type=t,this}load(t,n,g,m){function S(p,_){switch(p.type){case P:case F:"colorSpace"in p?p.colorSpace="srgb-linear":p.encoding=3e3,p.minFilter=Y,p.magFilter=Y,p.generateMipmaps=!1,p.flipY=!0;break}n&&n(p,_)}return super.load(t,S,g,m)}}const H={sunset:"venice/venice_sunset_1k.hdr",studio:"studio/poly_haven_studio_1k.hdr",city:"city/canary_wharf_1k.hdr",umbrellas:"outdoor/outdoor_umbrellas_1k.hdr",night:"outdoor/satara_night_1k.hdr",forest:"outood/mossy_forest_1k.hdr",snow:"outdoor/snowy_forest_path_01_1k.hdr",dawn:"kiara/kiara_1_dawn_1k.hdr",hangar:"indoor/small_hangar_01_1k.hdr",urban:"indoor/abandoned_games_room_02_1k.hdr",modern:"city/modern_buildings_2_1k.hdr",shangai:"city/shanghai_bund_1k.hdr"},we="https://raw.githubusercontent.com/Tresjs/assets/main/textures/hdr/";function be(h){const{scene:t}=K(),{preset:n,blur:g,files:m=[],path:S="",background:p}=te(h),_=N(),k=W(()=>Array.isArray(m.value)),f=W(()=>k.value?ne:J),v=N(null);return M(()=>[m,S],async([c,E])=>{if(c.value.length>0&&!n.value){try{v.value=await X(D(f),k.value?[D(c)]:D(c),R=>{E.value&&R.setPath(D(E))})}catch(R){throw new Error("Failed to load environment map: ".concat(R))}v.value&&(_.value=k.value?v.value[0]:v.value,_.value.mapping=k.value?oe:j)}},{immediate:!0}),M(()=>_.value,c=>{t.value&&(t.value.environment=c)},{immediate:!0}),M(()=>[p.value,_.value],([c,E])=>{t.value&&(t.value.background=c?E:void 0)},{immediate:!0}),M(()=>g==null?void 0:g.value,c=>{t.value&&(t.value.backgroundBlurriness=c)},{immediate:!0}),M(n,async c=>{if(c&&c in H){const E=we,R=H[c];try{v.value=await X(J,R,B=>{E&&B.setPath(E)})}catch(B){throw new Error("Failed to load environment map: ".concat(B))}v.value&&(_.value=v.value,_.value.mapping=j)}else if(c&&!(c in H))throw new Error("Preset must be one of: ".concat(Object.keys(H).join(", ")))},{immediate:!0}),{texture:_}}class ke extends se{constructor(){super();O(this,"virtualScene",null);this.virtualScene=new ie}add(...n){return this.virtualScene.add(...n),this}destructor(){this.virtualScene.traverse(n=>{n instanceof le&&(n.geometry.dispose(),n.material.dispose(),n.material.map&&n.material.map.dispose(),this.virtualScene.remove(n))}),this.virtualScene=null}}const Ie=Q({__name:"component",props:{background:{type:[Boolean,String],default:!1},blur:{default:0},files:{default:[]},path:{default:""},preset:{default:void 0},resolution:{default:256},near:{default:1},far:{default:1e3},frames:{default:1/0}},async setup(h,{expose:t}){let n,g;const m=h,S=N(null);t({texture:S});const{extend:p,renderer:_,scene:k}=K();let f=null,v=null;q().default!==void 0&&(p({EnvSence:ke}),q().default(),f=new ce(m.resolution),f.texture.type=F,v=new ue(m.near,m.far,f));const c=N(null);de(()=>{var G;(G=c.value)==null||G.destructor(),f==null||f.dispose()});const{onBeforeLoop:E}=ge();let R=1;E(()=>{v&&c.value&&(m.frames===1/0||R<m.frames)&&(v.update(_.value,_e(c.value.virtualScene)),R++)});const B=([n,g]=me(()=>be(m).texture),n=await n,g(),n);return M(B,G=>{f&&(k.value.environment=f.texture,m.background&&(k.value.background=f.texture))},{immediate:!0,deep:!0}),S.value=B,(G,V)=>D(f)?(I(),U("TresEnvSence",{key:0,ref_key:"envSence",ref:c},[pe(G.$slots,"default")],512)):he("",!0)}}),Be={key:0,args:[0,1,64]},Se={key:1,args:[.5,1,64]},Ge={key:2},Te=["toneMapped","map","side","color"],Ae=Q({__name:"index",props:{args:{default:null},from:{default:"rect"},toneMapped:{type:Boolean,default:!1},map:{default:null},intensity:{default:1},color:{default:new fe(16777215)}},setup(h){const t=h,n=N();return ve(()=>{n.value&&(n.value.color.multiplyScalar(t.intensity),n.value.needsUpdate=!0)}),(g,m)=>(I(),U("TresMesh",null,[t.from==="circle"?(I(),U("TresRingGeometry",Be)):t.from==="ring"?(I(),U("TresRingGeometry",Se)):t.from==="rect"?(I(),U("TresPlaneGeometry",Ge)):(I(),Ee(t.from,{key:3,args:t})),Re("TresMeshBasicMaterial",{ref_key:"material",ref:n,toneMapped:g.toneMapped,map:g.map,side:ye,color:g.color},null,8,Te)]))}});export{Ae as _,Ie as a};
