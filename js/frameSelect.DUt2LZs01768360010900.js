import{importShared as e}from"./3d-tiles-renderer.CvhCoabY1768360010900.js";import{useGLTF as t,useTres as n,OrbitControls_default as i}from"./index.CsTVQ09Z1768360010900.js";const{Frustum:o,Vector3:s,Matrix4:r,Quaternion:a}=await e("three"),l=new o,h=new s,c=new s,m=new s,p=new s,d=new s,u=new s,y=new s,w=new s,P=new s,v=new s,x=new s,f=new s,_=new s,g=new s,M=new r,E=new a,C=new s;class b{constructor(e,t,n=Number.MAX_VALUE){this.camera=e,this.scene=t,this.startPoint=new s,this.endPoint=new s,this.collection=[],this.instances={},this.deep=n}select(e,t){return this.startPoint=e||this.startPoint,this.endPoint=t||this.endPoint,this.collection=[],this._updateFrustum(this.startPoint,this.endPoint),this._searchChildInFrustum(l,this.scene),this.collection}_updateFrustum(e,t){if(e=e||this.startPoint,t=t||this.endPoint,e.x===t.x&&(t.x+=Number.EPSILON),e.y===t.y&&(t.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera){c.copy(e),c.x=Math.min(e.x,t.x),c.y=Math.max(e.y,t.y),t.x=Math.max(e.x,t.x),t.y=Math.min(e.y,t.y),m.setFromMatrixPosition(this.camera.matrixWorld),p.copy(c),d.set(t.x,c.y,0),u.copy(t),y.set(c.x,t.y,0),p.unproject(this.camera),d.unproject(this.camera),u.unproject(this.camera),y.unproject(this.camera),f.copy(p).sub(m),_.copy(d).sub(m),g.copy(u).sub(m),f.normalize(),_.normalize(),g.normalize(),f.multiplyScalar(this.deep),_.multiplyScalar(this.deep),g.multiplyScalar(this.deep),f.add(m),_.add(m),g.add(m);const n=l.planes;n[0].setFromCoplanarPoints(m,p,d),n[1].setFromCoplanarPoints(m,d,u),n[2].setFromCoplanarPoints(u,y,m),n[3].setFromCoplanarPoints(y,p,m),n[4].setFromCoplanarPoints(d,u,y),n[5].setFromCoplanarPoints(g,_,f),n[5].normal.multiplyScalar(-1)}else if(this.camera.isOrthographicCamera){const n=Math.min(e.x,t.x),i=Math.max(e.y,t.y),o=Math.max(e.x,t.x),s=Math.min(e.y,t.y);p.set(n,i,-1),d.set(o,i,-1),u.set(o,s,-1),y.set(n,s,-1),w.set(n,i,1),P.set(o,i,1),v.set(o,s,1),x.set(n,s,1),p.unproject(this.camera),d.unproject(this.camera),u.unproject(this.camera),y.unproject(this.camera),w.unproject(this.camera),P.unproject(this.camera),v.unproject(this.camera),x.unproject(this.camera);const r=l.planes;r[0].setFromCoplanarPoints(p,w,P),r[1].setFromCoplanarPoints(d,P,v),r[2].setFromCoplanarPoints(v,x,y),r[3].setFromCoplanarPoints(x,w,p),r[4].setFromCoplanarPoints(d,u,y),r[5].setFromCoplanarPoints(v,P,w),r[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}_searchChildInFrustum(e,t){if(t.isMesh||t.isLine||t.isPoints)if(t.isInstancedMesh){this.instances[t.uuid]=[];for(let n=0;n<t.count;n++)t.getMatrixAt(n,M),M.decompose(h,E,C),h.applyMatrix4(t.matrixWorld),e.containsPoint(h)&&this.instances[t.uuid].push(n)}else null===t.geometry.boundingSphere&&t.geometry.computeBoundingSphere(),h.copy(t.geometry.boundingSphere.center),h.applyMatrix4(t.matrixWorld),e.containsPoint(h)&&this.collection.push(t);if(t.children.length>0)for(let n=0;n<t.children.length;n++)this._searchChildInFrustum(e,t.children[n])}}const{Vector2:S}=await e("three");class L{constructor(e,t){this.element=document.createElement("div"),this.element.classList.add(t),this.element.style.pointerEvents="none",this.renderer=e,this.isDown=!1,this.enabled=!0,this._startPoint=new S,this._pointTopLeft=new S,this._pointBottomRight=new S,this._onPointerDown=function(e){!1!==this.enabled&&(this.isDown=!0,this._onSelectStart(e))}.bind(this),this._onPointerMove=function(e){!1!==this.enabled&&this.isDown&&this._onSelectMove(e)}.bind(this),this._onPointerUp=function(){!1!==this.enabled&&(this.isDown=!1,this._onSelectOver())}.bind(this),this.renderer.domElement.addEventListener("pointerdown",this._onPointerDown),this.renderer.domElement.addEventListener("pointermove",this._onPointerMove),this.renderer.domElement.addEventListener("pointerup",this._onPointerUp)}dispose(){this.renderer.domElement.removeEventListener("pointerdown",this._onPointerDown),this.renderer.domElement.removeEventListener("pointermove",this._onPointerMove),this.renderer.domElement.removeEventListener("pointerup",this._onPointerUp),this.element.remove()}_onSelectStart(e){this.element.style.display="none",this.renderer.domElement.parentElement.appendChild(this.element),this.element.style.left=e.clientX+"px",this.element.style.top=e.clientY+"px",this.element.style.width="0px",this.element.style.height="0px",this._startPoint.x=e.clientX,this._startPoint.y=e.clientY}_onSelectMove(e){this.element.style.display="block",this._pointBottomRight.x=Math.max(this._startPoint.x,e.clientX),this._pointBottomRight.y=Math.max(this._startPoint.y,e.clientY),this._pointTopLeft.x=Math.min(this._startPoint.x,e.clientX),this._pointTopLeft.y=Math.min(this._startPoint.y,e.clientY),this.element.style.left=this._pointTopLeft.x+"px",this.element.style.top=this._pointTopLeft.y+"px",this.element.style.width=this._pointBottomRight.x-this._pointTopLeft.x+"px",this.element.style.height=this._pointBottomRight.y-this._pointTopLeft.y+"px"}_onSelectOver(){this.element.remove()}}const{defineComponent:F}=await e("vue"),{unref:j,openBlock:B,createElementBlock:T,createCommentVNode:D}=await e("vue"),R=["object"],{onMounted:N,watchEffect:X}=await e("vue"),k=await e("three"),Y=F({__name:"frameSelect",setup(e){const{state:i}=t("https://opensource.cdn.icegl.cn/model/operationTool/湖中小亭/湖中小亭.gltf"),{camera:o,renderer:s,scene:r,sizes:a,controls:l}=n(),h=new b(o.value,r.value),c=new L(s,"selectBox");let m=function(e){console.log(l.value);for(const t of h.collection)t instanceof k.Mesh&&t.material.emissive.set(0);h.collection.length=0,h.startPoint.set(e.clientX/a.width.value*2-1,-e.clientY/a.height.value*2+1,.5)},p=function(e){if(c.isDown){h.endPoint.set(e.clientX/a.width.value*2-1,-e.clientY/a.height.value*2+1,.5);const t=h.select();console.log("allSelected",t);for(let e=0;e<t.length;e++){const n=t[e];n instanceof k.Mesh&&n.material.emissive.set(16252928)}}},d=function(e){const t=h.select();h.endPoint.set(e.clientX/a.width.value*2-1,-e.clientY/a.height.value*2+1,.5);for(let n=0;n<t.length;n++){const e=t[n];e instanceof k.Mesh&&e.material.emissive.set(0)}};return N(()=>{document.addEventListener("mousedown",m,!1),document.addEventListener("mousemove",p,!1),document.addEventListener("mouseup",d,!1)}),X(()=>{}),(e,t)=>j(i)?(B(),T("primitive",{key:0,object:j(i)?.scene},null,8,R)):D("",!0)}}),{defineComponent:z}=await e("vue"),{createElementVNode:I,unref:V,normalizeProps:O,guardReactiveProps:U,createVNode:A,Suspense:W,withCtx:H,openBlock:Q,createBlock:Z,resolveComponent:q,mergeProps:G}=await e("vue"),{reactive:J}=await e("vue"),K=z({__name:"frameSelect",setup(e){const t=J({alpha:!0,antialias:!0}),n=J({enableDamping:!1,enableZoom:!1,autoRotate:!1,enablePan:!1,enableRotate:!1,makeDefault:!0});return(e,o)=>{const s=q("TresCanvas");return Q(),Z(s,G({clearColor:"#201919","window-size":""},t),{default:H(()=>[o[0]||(o[0]=I("TresPerspectiveCamera",{fov:60,near:.1,far:2e3,position:[0,10,-28]},null,-1)),o[1]||(o[1]=I("TresAmbientLight",{intensity:1},null,-1)),A(V(i),O(U(n)),null,16),(Q(),Z(W,null,{default:H(()=>[A(Y)]),_:1}))]),_:1},16)}}});export{K as default};
