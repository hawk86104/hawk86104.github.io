import{i as e}from"./3d-tiles-renderer.CbgZh8zU1767066396612.js";import{_ as o,K as a}from"./@tresjs.B1f7s3pS1767066396612.js";import{i as t}from"./Resource.BqPJptsT1767066396612.js";import{B as r}from"./three-custom-shader-material.DAA_4JPH1767066396612.js";import{b as l,a as i}from"./buildingsCustomShaderMaterial.DyBo--wu1767066396612.js";import{ab as n,a as s,ac as u}from"./three.BD1hRFgo1767066396612.js";const{watch:d}=await e("vue"),c=async()=>{t.getResource("FBXLoader","https://opensource.cdn.icegl.cn/model/digitalCity/shanghai.FBX","shanghai.FBX");const e=t.getReactiveItem("shanghai.FBX");return new Promise((o,a)=>{const t=d(()=>e(),e=>{if(e){t();let a=null,r=null,l=null;e.traverse(e=>{"CITY_UNTRIANGULATED"===e.name&&(a=e),"LANDMASS"===e.name&&(r=e),"ROADS"===e.name&&(l=e)}),o({model:e,city:a,land:r,roads:l})}else a(new Error("FBX 加载失败，未得到模型"))})})},{defineComponent:m}=await e("vue"),{unref:p,openBlock:f,createElementBlock:w}=await e("vue"),h=["object"],{watchEffect:y,watch:g}=await e("vue"),v=await e("three"),C=m({__name:"buildingsModelCustomShader",props:{model:{},bulidingsColor:{default:"#e523ff"},landColor:{default:"#112233"},topColor:{default:"#ffff00"},opacity:{default:.9},gradient:{type:Boolean,default:!0}},setup(e){const a=e,t=a.model.city;t.renderOrder=1001;const n=a.model.land;(()=>{const{geometry:e}=t;e.computeBoundingBox(),e.computeBoundingSphere();const{max:o,min:n}=e.boundingBox;if(t.material.__csm)return;const s=new r({baseMaterial:t.material,vertexShader:i,fragmentShader:l,silent:!0,uniforms:{uMax:{value:o},uMin:{value:n},uBorderWidth:{value:5},uCircleTime:{value:5},uColor:{value:new v.Color(a.bulidingsColor)},uOpacity:{value:a.opacity},uLightColor:{value:new v.Color("#ffffff")},uTopColor:{value:new v.Color(a.topColor)},uTime:{value:0},uGradient:{value:a.gradient}},depthWrite:!0,depthTest:!0,transparent:!0,side:v.DoubleSide});t.material.dispose(),t.material=s})();const{onBeforeRender:s}=o();s(({delta:e})=>{t.material.uniforms.uTime.value+=e}),y(()=>{a.bulidingsColor&&t.material.uniforms.uColor.value.setStyle(a.bulidingsColor),a.landColor&&((e,o)=>{let t;t=Array.isArray(n.material)?n.material:[n.material],t.forEach(e=>{e[o].setStyle(a.landColor),e.side=v.DoubleSide})})(0,"color"),a.opacity&&(t.material.uniforms.uOpacity.value=a.opacity)}),g(a,(e,o)=>{t.material.uniforms.uGradient.value=e.gradient});const u=a.model.model.clone();return(e,o)=>(f(),w("primitive",{object:p(u)},null,8,h))}}),{defineComponent:b}=await e("vue"),{unref:B,openBlock:S,createElementBlock:x}=await e("vue"),M=["object"],{Color:T,EdgesGeometry:R,ShaderMaterial:_}=await e("three"),{watchEffect:E}=await e("vue"),j=b({__name:"buildingsLines",props:{builds:{},width:{default:1},color:{default:"#FFF"},opacity:{default:1},style:{default:"Wireframe"}},setup(e){const o=e;let a=null,t=null;if("Wireframe"===o.style){const e=new R(o.builds.geometry);let t=(new n).fromEdgesGeometry(e),r=new s({color:o.color,linewidth:o.width,opacity:o.opacity,transparent:!0,depthWrite:!0,depthTest:!0});r.resolution.set(window.innerWidth,window.innerHeight),a=new u(t,r),a.applyMatrix4(o.builds.matrix.clone())}else{t={transparent:!0,uniforms:{uColor:{value:new T(o.color)},uOpacity:{value:o.opacity}},vertexShader:"\n       void main() {\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:" \n        uniform vec3 uColor;\n\t\t\t\tuniform float uOpacity;\n        void main() {\n          gl_FragColor = vec4(uColor, uOpacity);\n        }\n      "};const e=new R(o.builds.geometry),r=new _(t);a=new LineSegments(e,r),a.applyMatrix4(o.builds.matrix.clone()),a.material.linewidth=o.width,a.renderOrder=1e3}return E(()=>{"Shader"===o.style&&(o.color&&(t.uniforms.uColor.value=new T(o.color)),o.opacity&&(t.uniforms.uOpacity.value=o.opacity)),"Wireframe"===o.style&&(o.color&&(a.material.color=new T(o.color)),o.opacity&&(a.material.opacity=o.opacity)),o.width&&(a.material.linewidth=o.width)}),(e,o)=>(S(),x("primitive",{object:B(a)},null,8,M))}}),{defineComponent:k}=await e("vue"),{createElementVNode:A,unref:F,normalizeProps:L,guardReactiveProps:G,createVNode:O,Fragment:D,openBlock:H,createElementBlock:W,createCommentVNode:N,renderSlot:P,resolveComponent:X,mergeProps:V,withCtx:I,createBlock:z}=await e("vue"),U={key:1,args:[1e3],position:[0,19,0]},K={key:2,args:[6e3,100],position:[0,19,0]},{SRGBColorSpace:Y,BasicShadowMap:$,ACESFilmicToneMapping:q}=await e("three"),{reactive:J,ref:Q,onMounted:Z}=await e("vue"),ee=k({__name:"pagesShow",props:{showBuildings:{type:Boolean,default:!0},autoRotate:{type:Boolean,default:!0},showAxesHelper:{type:Boolean,default:!0},showGridHelper:{type:Boolean,default:!0},disableRender:{type:Boolean,default:!1}},setup(e,{expose:o}){const t=e,r=J({clearColor:"#000000",shadows:!0,alpha:!1,useLegacyLights:!0,shadowMapType:$,outputColorSpace:Y,toneMapping:q,toneMappingExposure:1.2,renderMode:t.disableRender?"manual":"always"}),l={autoRotate:t.autoRotate,enableDamping:!0,makeDefault:!0};let i=Q(null);const n=Q(!1);Z(async()=>{t.showBuildings&&(i.value=await c()),n.value=!0});const s=e=>{},u=Q();return o({context:u,contextReady:n}),(e,o)=>{const d=X("TresCanvas");return H(),z(d,V({ref_key:"tcRef",ref:u},r,{"window-size":"",onReady:s}),{default:I(()=>[o[0]||(o[0]=A("TresPerspectiveCamera",{position:[600,750,-1221],fov:45,near:1,far:1e5},null,-1)),O(F(a),L(G(l)),null,16),o[1]||(o[1]=A("TresAmbientLight",{color:"#ffffff"},null,-1)),o[2]||(o[2]=A("TresDirectionalLight",{position:[100,100,0],intensity:.5,color:"#ffffff"},null,-1)),t.showBuildings&&n.value?(H(),W(D,{key:0},[O(C,{model:F(i)},null,8,["model"]),O(j,{builds:F(i).city,color:"#000"},null,8,["builds"])],64)):N("",!0),P(e.$slots,"ability"),t.showAxesHelper?(H(),W("TresAxesHelper",U)):N("",!0),t.showGridHelper?(H(),W("TresGridHelper",K)):N("",!0)]),_:3},16)}}});export{ee as _,C as a,j as b,c as l};
