import{v as e,a3 as a,a4 as t,j as r,k as n,n as s,q as o,H as i,z as l,aF as u,c_ as c,a0 as m,O as x,b as v,c$ as f}from"./three.rXKzP9fQ1763540743861.js";import{c as p,_ as d,F as g}from"./@tresjs.BCHtwiaC1763540743861.js";import{l as y}from"./util.BiQZqwAw1763540743861.js";import{_ as h}from"./particalMesh.vue_vue_type_script_setup_true_lang.D5R3Tcae1763540743861.js";import{d as w,a as M,a8 as T,w as b,b as A,o as _}from"./@vue.Co_gxueH1763540743861.js";const z=r=>{let n=r.attributes.position.count,s=Math.ceil(Math.sqrt(n)),o=Math.ceil(n/s),i=new Float32Array(s*o*4);!function(e){for(let a=Math.floor(e.length/3)-1;a>0;a--){const t=Math.floor(Math.random()*(a+1));for(let r=0;r<3;r++){let n=e[3*a+r];e[3*a+r]=e[3*t+r],e[3*t+r]=n}}}(r.attributes.position.array);for(let e=0;e<n;e++){const a=r.attributes.position.array[3*e+0],t=r.attributes.position.array[3*e+1],n=r.attributes.position.array[3*e+2],s=0;i[4*e+0]=a,i[4*e+1]=t,i[4*e+2]=n,i[4*e+3]=s}let l=new e(i,s,o,a,t);return l.needsUpdate=!0,l},B=()=>{const e=new o({uniforms:{uTextureA:{value:null},uTextureB:{value:null},uTime:{value:0},uScroll:{value:0}},vertexShader:"varying vec2 vUv;\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  vUv = uv;\n}",fragmentShader:"uniform sampler2D uTextureA;\nuniform sampler2D uTextureB;\nprecision mediump float; \nuniform float uTime;\nuniform float uScroll;\nvarying vec2 vUv;\n\nmat3 rotationMatrix3(vec3 axis, float angle) {\n  axis = normalize(axis);\n  float s = sin(angle);\n  float c = cos(angle);\n  float oc = 1. - c;\n\n  return mat3(oc * axis.x * axis.x + c, oc * axis.x * axis.y - axis.z * s,\n              oc * axis.z * axis.x + axis.y * s,\n              oc * axis.x * axis.y + axis.z * s, oc * axis.y * axis.y + c,\n              oc * axis.y * axis.z - axis.x * s,\n              oc * axis.z * axis.x - axis.y * s,\n              oc * axis.y * axis.z + axis.x * s, oc * axis.z * axis.z + c);\n}\n\nvoid main() {\n  vec3 textureA = rotationMatrix3(vec3(10., 6., 3.), sin(uTime) * .1) *\n                  texture2D(uTextureA, vUv).xyz;\n  \n\n  vec3 textureB = rotationMatrix3(vec3(10., 6., 3.), sin(uTime) * .1) *\n                  texture2D(uTextureB, vUv).xyz;\n  \n\n  float t = uScroll;\n  vec3 pos = mix(textureA, textureB, t);\n\n  gl_FragColor = vec4(pos, 1.);\n}"}),a=new r;return a.setAttribute("position",new n(new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]),3)),a.setAttribute("uv",new n(new Float32Array([0,1,1,1,1,0,0,1,1,0,0,0]),2)),new s(a,e)},F=w({__name:"particalFBO",props:{progress:{default:0},width:{default:256},height:{default:256},color:{default:"#ffaa00"}},async setup(e){let r,n;const o=e,w=M(null),F=new i(o.width,o.height,{minFilter:u,magFilter:u,generateMipmaps:!1,colorSpace:l,depthBuffer:!1,stencilBuffer:!1,format:a,type:t}),S=e=>{const a=[];return e.traverse(e=>{e instanceof s&&(e.geometry.deleteAttribute("uv"),e.geometry.deleteAttribute("normal"),e.geometry.deleteAttribute("tangent"),a.push(e.geometry))}),f(a)},j="https://opensource.cdn.icegl.cn",P=j+"/model/medical/brainparts.OBJ",U=new c,D=([r,n]=T(()=>y(P,U)),r=await r,n(),r),C=S(D);C.scale(.01,.01,.01);const I=z(C),O=M(null),R=M(null),k=j+"/model/eCommerce/guanYu.glb",{state:q,nodes:X,materials:Y,animations:H}=p(k,{draco:!0,decoderPath:"./draco/"});b(()=>q.value,e=>{if(e?.scene)try{const a=e.scene||e?.scene||e.scene,t=a.children?.[0]??a,r=S(t);r.rotateX(Math.PI/2),r.translate(0,-.9,0),O.value=z(r)}catch(a){console.warn("guanyu merge error",a)}},{immediate:!0});const J=j+"/model/industry4/modelDraco.glb",{state:V,nodes:$,materials:E,animations:G}=p(J,{draco:!0,decoderPath:"./draco/"});b(()=>V.value,e=>{if(e?.scene)try{const a=e.scene||e,t=a.children?.[0]??a,r=S(t);r.rotateX(-Math.PI/2),r.rotateY(Math.PI/3),r.translate(0,0,0),R.value=z(r)}catch(a){console.warn("plane merge error",a)}},{immediate:!0});const K=B(),L=new m,N=new x(-1,1,1,-1,1/Math.pow(2,53),1);L.add(K);const{onBeforeRender:Q}=d(),{camera:W,renderer:Z}=g();return Q(({elapsed:e})=>{if(Z&&W.value&&w.value){Z.setRenderTarget(F),Z.clear(),Z.render(L,N),Z.setRenderTarget(null);const a=O.value||null,t=I||null,r=R.value||null,n=v.clamp(-o.progress/2,0,1);if(n<.5?(K.material.uniforms.uTextureA.value=a??t,K.material.uniforms.uTextureB.value=t,K.material.uniforms.uScroll.value=2*n):(K.material.uniforms.uTextureA.value=t,K.material.uniforms.uTextureB.value=r??t,K.material.uniforms.uScroll.value=2*(n-.5)),K.material.uniforms.uTime.value=e,w.value?.particles?.material?.uniforms){w.value.particles.material.uniforms.uPositions.value=F.texture;const e=w.value.particles.material.uniforms.uColor;e&&e.value.setStyle(o.color)}}}),(e,a)=>(_(),A(h,{ref_key:"pMesh",ref:w,progress:e.progress},null,8,["progress"]))}});export{F as _};
