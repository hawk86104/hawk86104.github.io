import{importShared as e}from"./3d-tiles-renderer.BWkWgmMi1767151797345.js";import{_export_sfc as t,OrbitControls_default as a}from"./index.DdZsEhdb1767151797345.js";import{__federation_method_setRemote as o,__federation_method_getRemote as n,__federation_method_unwrapDefault as l}from"./_virtual___federation__.jJOykNuc1767151797345.js";import{Button as i}from"./Button.BEVW1Qpf1767151797345.js";import{useMessage as s,NMessageProvider as r}from"./use-message.h6WMZkEO1767151797345.js";import{NSpace as c}from"./Space.gdkL9YWK1767151797345.js";import{NInput as u}from"./Input.BifxbkeM1767151797345.js";import{NDescriptions as d,NDescriptionsItem as m,NList as p,NListItem as f,NThing as h}from"./Thing.qlLIeyZi1767151797345.js";import{NTag as g}from"./Tag.B9PyQvz51767151797345.js";import{Pane as v}from"./tweakpane.BbuIEN141767151797345.js";class w{constructor(e){this.path="",this.resPath="",this.config=null,this.loading=null,this.remoteName=e}setPath(e){this.path===e&&this.config||(this.path=e,this.config=null,this.loading=null,o(this.remoteName,{url:()=>Promise.resolve(e),format:"esm",from:"vite"}))}setResPath(e){this.resPath=e,window.__REMOTE_ASSET_MAP__??={}}async loadConfig(){return this.config?this.config:(this.loading||(this.loading=n(this.remoteName,"./config").then(e=>l(e)).then(e=>(this.validateConfig(e),this.config=e,window.__REMOTE_ASSET_MAP__[e.name]=this.resPath,e)).catch(e=>{throw this.config=null,console.error(`[Remote ${this.remoteName}] load config failed:`,e),e}).finally(()=>{this.loading=null})),this.loading)}async loadComponentModule(e){if(!this.config)throw new Error(`[Remote ${this.remoteName}] config not loaded`);return n(this.remoteName,e).then(e=>l(e))}getConfig(){return this.config}async reload(){return this.config=null,this.loading=null,this.loadConfig()}validateConfig(e){if(!e?.name||!Array.isArray(e.components))throw new Error(`[Remote ${this.remoteName}] config schema invalid`)}}class y{constructor(){this.remotes=new Map}static getInstance(){return this.instance||(this.instance=new y),this.instance}registerRemote(e,t,a){let o=this.remotes.get(e);return o||(o=new w(e),this.remotes.set(e,o)),o.setResPath(t),o.setPath(a),o}getRemote(e){return this.remotes.get(e)}async loadRemoteConfig(e){const t=this.remotes.get(e);if(!t)throw new Error(`Remote "${e}" not registered`);return t.loadConfig()}getRemoteConfig(e){return this.remotes.get(e)?.getConfig()}async loadAll(){return Promise.all([...this.remotes.values()].map(e=>e.loadConfig()))}}const _=y.getInstance(),{defineComponent:C}=await e("vue"),{unref:b,createVNode:k,createTextVNode:j,withCtx:N,openBlock:x,createBlock:B}=await e("vue"),{ref:D}=await e("vue"),R=C({__name:"ServiceLoader",emits:["loaded"],setup(e,{emit:t}){const a=t,o=s(),n=D("http://dcser.icegl.cn"),l=D(!1),r=async()=>{if(n.value){l.value=!0;try{_.registerRemote("base",n.value+"/",n.value+"/assets/remoteEntry.js");const e=await _.loadRemoteConfig("base");a("loaded",e),o.success("服务加载成功")}catch(e){o.error("服务加载失败")}finally{l.value=!1}}else o.warning("请输入服务地址")};return(e,t)=>(x(),B(b(c),{vertical:"",size:"large"},{default:N(()=>[k(b(u),{value:n.value,"onUpdate:value":t[0]||(t[0]=e=>n.value=e),placeholder:"请输入服务地址",clearable:""},null,8,["value"]),k(b(i),{type:"primary",block:"",loading:l.value,onClick:r},{default:N(()=>[...t[1]||(t[1]=[j(" 应用服务 ",-1)])]),_:1},8,["loading"])]),_:1}))}}),{defineComponent:T}=await e("vue"),{toDisplayString:S,createTextVNode:P,unref:E,withCtx:O,createVNode:z,renderList:M,Fragment:V,openBlock:A,createElementBlock:$,normalizeClass:I,createBlock:L}=await e("vue"),F=t(T({__name:"ServiceViewer",props:{data:{},selectedType:{}},emits:["select","reset"],setup(e,{emit:t}){const a=e,o=t;return(e,t)=>(A(),L(E(c),{vertical:"",size:"large"},{default:O(()=>[z(E(d),{bordered:"",size:"small"},{default:O(()=>[z(E(m),{label:"名称"},{default:O(()=>[P(S(a.data.name),1)]),_:1}),z(E(m),{label:"版本"},{default:O(()=>[z(E(g),{type:"info"},{default:O(()=>[P(S(a.data.version),1)]),_:1})]),_:1}),z(E(m),{label:"描述"},{default:O(()=>[P(S(a.data.description),1)]),_:1})]),_:1}),z(E(p),{bordered:"",hoverable:"",clickable:""},{default:O(()=>[(A(!0),$(V,null,M(a.data.components,a=>(A(),L(E(f),{class:I({"n-list-item--active":e.selectedType&&a.type===e.selectedType}),key:a.type,onClick:e=>(e=>{o("select",e)})(a)},{default:O(()=>[z(E(h),{title:a.name,description:a.type},{"header-extra":O(()=>[z(E(g),{size:"small"},{default:O(()=>[...t[1]||(t[1]=[P("点击载入调试",-1)])]),_:1})]),_:1},8,["title","description"])]),_:2},1032,["class","onClick"]))),128))]),_:1}),z(E(i),{type:"warning",block:"",onClick:t[0]||(t[0]=e=>o("reset"))},{default:O(()=>[...t[2]||(t[2]=[P(" 删除当前服务 / 重新加载 ",-1)])]),_:1})]),_:1}))}}),[["__scopeId","data-v-e8a20270"]]);const{withAsyncContext:G,defineComponent:U}=await e("vue"),{resolveDynamicComponent:H,normalizeProps:q,openBlock:J,createBlock:K,mergeProps:Q,createCommentVNode:W}=await e("vue"),{shallowRef:X,onBeforeUnmount:Y}=await e("vue"),Z=U({__name:"oneRemoteCom",props:{remoteName:{},comName:{},attrsData:{},config:{}},async setup(e){let t,a;const o=e,n=X(null),l=_.getRemote(o.remoteName);l&&(n.value=([t,a]=G(()=>l.loadComponentModule(`./${o.comName}`)),t=await t,a(),t));const i=function(e,t,a){const o=new v({container:e,title:"配置"});return Object.entries(t).forEach(([e,t])=>{switch(t.com){case"Select":o.addBinding(a,e,{label:t.name,options:t.options?.reduce((e,t)=>(e[t.label]=t.value,e),{})}).on("change",t=>{a[e]=t.value});break;case"ColorPicker":o.addBinding(a,e,{label:t.name,picker:"inline"}).on("change",t=>{a[e]=t.value});break;case"Switch":o.addBinding(a,e,{label:t.name}).on("change",t=>{a[e]=t.value});break;case"Slider":o.addBinding(a,e,{label:t.name,min:t.min,max:t.max,step:t.step}).on("change",t=>{a[e]=t.value});break;default:console.warn(`未知组件类型：${t.com}`)}}),o}(document.getElementById("pane"),o.config,o.attrsData);return Y(()=>{i&&i.dispose()}),(e,t)=>n.value?(J(),K(H(n.value),q(Q({key:0},e.attrsData)),null,16)):W("",!0)}}),{defineComponent:ee}=await e("vue"),{openBlock:te,createBlock:ae,createCommentVNode:oe,unref:ne,withCtx:le,createVNode:ie,createElementVNode:se,mergeProps:re,Suspense:ce,resolveComponent:ue,Fragment:de,createElementBlock:me}=await e("vue"),{SRGBColorSpace:pe,BasicShadowMap:fe,NoToneMapping:he}=await e("three"),{nextTick:ge,reactive:ve,ref:we}=await e("vue"),ye=ee({__name:"readConfig",setup(e){const t=ve({clearColor:"#201919",shadows:!0,alpha:!1,shadowMapType:fe,outputColorSpace:pe,toneMapping:he}),o=e=>{n.value=e,console.log("服务配置加载完成：",e)},n=we(null),l=we(null),i=we(null),s=we(null),c=e=>{console.log("选中组件",e),l.value&&l.value.comName===e.type||(l.value=null,i.value={},s.value=null,ge(()=>{i.value=e?.default||{},s.value=e?.config||null,l.value={remoteName:"base",comName:e.type,position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]},e.defaultObject3D?.position&&(l.value.position=[e.defaultObject3D.position.x,e.defaultObject3D.position.y,e.defaultObject3D.position.z]),e.defaultObject3D?.rotation&&(l.value.rotation=[e.defaultObject3D.rotation.x,e.defaultObject3D.rotation.y,e.defaultObject3D.rotation.z]),e.defaultObject3D?.scale&&(l.value.scale=[e.defaultObject3D.scale.x,e.defaultObject3D.scale.y,e.defaultObject3D.scale.z])}))},u=()=>{l.value=null,n.value=null};return(e,d)=>{const m=ue("TresCanvas");return te(),me(de,null,[ie(ne(r),null,{default:le(()=>[n.value?(te(),ae(F,{key:1,data:n.value,selectedType:l.value?.comName,onSelect:c,onReset:u,style:{"z-index":"99999",position:"absolute",left:"10px",top:"50px"}},null,8,["data","selectedType"])):(te(),ae(R,{key:0,onLoaded:o,style:{"z-index":"99999",position:"absolute",left:"10px",top:"50px"}}))]),_:1}),ie(m,re(t,{"window-size":""}),{default:le(()=>[d[0]||(d[0]=se("TresPerspectiveCamera",{position:[5,5,5]},null,-1)),ie(ne(a)),(te(),ae(ce,null,{default:le(()=>[l.value?(te(),ae(Z,re({key:0},l.value,{attrsData:i.value,config:s.value}),null,16,["attrsData","config"])):oe("",!0)]),_:1})),d[1]||(d[1]=se("TresGridHelper",{"position-y":.1},null,-1))]),_:1},16)],64)}}});export{ye as default};
