import{m as n,e as t,o as e}from"./@tresjs.Uh9iM8du1742436572432.js";import{_ as r,b as o,m as a}from"./three.RUAk_tvU1742436572432.js";import{P as i}from"./tweakpane.yDiyAAkA1742436572432.js";import{d as c,b as l,r as u,w as s,q as p,o as m,H as f,N as v,u as _,e as g,z as d,j as x,g as h,aj as y,ak as b,f as S,al as z,m as w,F as j}from"./@vue.deO5D3Lf1742436572432.js";import{_ as I}from"./@fesjs.40Mt4LlK1742436572432.js";import"./postprocessing.5QD_59xS1742436572432.js";import"./@vueuse.F4UpVCIS1742436572432.js";import"./vue-router.EzCcHFzL1742436572432.js";import"./lodash-es.p1wj6C0b1742436572432.js";import"./@qlin.yHhFDldE1742436572432.js";import"./pinia.9br8mKkJ1742436572432.js";import"./@floating-ui.BPbuo5Gx1742436572432.js";import"./@juggle.7yjBMqoW1742436572432.js";const k=O;!function(n,t){const e=O,r=L();for(;;)try{if(296361===parseInt(e(445))/1+parseInt(e(470))/2*(-parseInt(e(412))/3)+parseInt(e(467))/4+-parseInt(e(437))/5*(parseInt(e(410))/6)+-parseInt(e(427))/7*(parseInt(e(425))/8)+parseInt(e(421))/9*(parseInt(e(456))/10)+parseInt(e(444))/11)break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const D=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[O(442)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();!function(){D(this,(function(){const n=O,t=new RegExp("function *\\( *\\)"),e=new RegExp(n(454),"i"),r=C(n(476));t.test(r+n(424))&&e[n(429)](r+n(451))?C():r("0")}))()}();const V=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e.apply(t,arguments);return e=null,n}}:function(){};return n=!1,r}}();V(void 0,(function(){const n=O;let t;try{t=Function(n(432)+n(431)+");")()}catch(o){t=window}const e=t[n(463)]=t[n(463)]||{},r=[n(440),"warn",n(479),"error",n(486),n(413),"trace"];for(let a=0;a<r.length;a++){const t=V.constructor[n(462)][n(483)](V),o=r[a],i=e[o]||t;t[n(419)]=V[n(483)](V),t[n(464)]=i.toString.bind(i),e[o]=t}}))();const M=[k(453)],F=[k(434),k(455),k(468)];function O(n,t){const e=L();return(O=function(n,t){return e[n-=409]})(n,t)}const P=41,R=c({__name:k(461),setup(e){var c;const g=k,d=window[g(426)],x=window[g(411)],h=l(null),y=l(null),b=new(r[g(418)]);b.start();const S=(new i)[g(472)]({title:g(474)}),z=S[g(472)]({title:g(409)}),w=new o(.5,.5,.5);z.addBinding(w,"x",{label:"X",min:.02,max:.5,step:.02}),z[g(433)](w,"y",{label:"Y",min:.02,max:.5,step:.02}),z.addBinding(w,"z",{label:"Z",min:.02,max:.5,step:.02}),z[g(481)]=!0;const{camera:j}=n(),I=u({u_camera:{value:null==(c=j[g(458)])?void 0:c[g(436)]},u_resolution:{value:new(r[g(452)])(d,x,1)},u_dt:{value:.004},u_time:{value:0},u_crossSectionSize:{value:w},u_color:{value:1},u_volume:{value:null},u_isoValue:{value:.2},u_alphaVal:{value:.2}}),D=S[g(472)]({title:g(417)});D[g(433)](I[g(428)],g(458),{label:"dt",min:4e-4,max:.016,step:2e-4}),D[g(433)](I[g(459)],g(458),{label:g(414),min:1,max:3,step:1}),D[g(433)](I[g(438)],g(458),{label:g(466),min:.01,max:1,step:.01}),D[g(433)](I[g(460)],g(458),{label:g(415),min:0,max:1,step:.04}),s(y,(n=>{const t=g;if(n){const e=new(r[t(441)])(n,P,P,P);e[t(473)]=r[t(443)],e[t(423)]=r[t(484)],e[t(447)]=a,e[t(435)]=r[t(471)],e[t(477)]=!0,I[t(475)][t(458)]=e}}));const{onLoop:V}=t();return V((()=>{const n=g;I.u_time[n(458)]=b[n(449)]()})),p((()=>{(()=>{const n=g;fetch("/plugins/volumeRendering/image/nucleon_41x41x41_uint8.raw")[n(450)]((n=>n.arrayBuffer()))[n(450)]((t=>{const e=n,r=new Uint8Array(t),o=new Uint8Array(68921);for(let n=0;n<r[e(448)];n++)o[n]=r[n];y[e(458)]=o}))[n(430)]((t=>{const e=n;console.error(e(480),t)}))})()})),(n,t)=>{const e=g;return m(),f(e(457),{ref_key:e(416),ref:h,"rotation-x":Math.PI/-2},[t[0]||(t[0]=v(e(469),{args:[1,16,16]},null,-1)),v(e(422),{uniforms:I,vertexShader:_("precision mediump float;\n\nuniform vec3 u_camera;\nuniform vec3 u_resolution;\nuniform float u_time;\n\nvarying vec3 v_hitPos;\nvarying vec3 v_hitPosWorldSpace;\nvarying vec3 v_cameraObjectSpace;\n\nvoid main() {\n  vec3 pos = position;\n\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\n\n  v_hitPos = position.xyz;\n\n  v_hitPosWorldSpace = (modelMatrix * vec4(position, 1.0)).xyz;\n\n  v_cameraObjectSpace = (inverse(modelMatrix) * vec4(u_camera, 1.0)).xyz;\n}"),fragmentShader:_("precision mediump int;\nprecision mediump float;\n\nuniform vec3 u_camera;\nuniform vec3 u_resolution;\nuniform mediump sampler3D u_volume;\nuniform vec3 u_crossSectionSize;\nuniform float u_dt;\nuniform float u_time;\nuniform float u_color;\nuniform float u_isoValue;\nuniform float u_alphaVal;\n\nvec3 palette(in float t) {\n  vec3 a = vec3(0.5, 0.5, 0.5);\n  vec3 b = vec3(0.5, 0.5, 0.5);\n  vec3 c = vec3(1.0, 1.0, 1.0);\n  vec3 d = vec3(0.00, 0.33, 0.67);\n\n  return a + b * cos(6.28318 * (c * t + d));\n}\n\nvarying vec3 v_hitPos;\nvarying vec3 v_hitPosWorldSpace;\nvarying vec3 v_cameraObjectSpace;\n\nvec2 intersect_box(vec3 orig, vec3 dir) {\n\n  vec3 box_min = vec3(-u_crossSectionSize);\n  vec3 box_max = vec3(u_crossSectionSize);\n  vec3 inv_dir = 1.0 / dir;\n  vec3 tmin_tmp = (box_min - orig) * inv_dir;\n  vec3 tmax_tmp = (box_max - orig) * inv_dir;\n  vec3 tmin = min(tmin_tmp, tmax_tmp);\n  vec3 tmax = max(tmin_tmp, tmax_tmp);\n  float t0 = max(tmin.x, max(tmin.y, tmin.z));\n  float t1 = min(tmax.x, min(tmax.y, tmax.z));\n  return vec2(t0, t1);\n}\n\nvoid main() {\n  vec3 rayOrigin = vec3(0.0, 0.0, -3.0);\n  rayOrigin = v_cameraObjectSpace;\n\n  vec2 uv = 2.0 * gl_FragCoord.xy / u_resolution.xy - 1.0;\n  vec3 rayDir = normalize(vec3(uv, 1.0));\n  rayDir = normalize(v_hitPos - rayOrigin);\n\n  vec2 t_hit = intersect_box(rayOrigin, rayDir);\n  if (t_hit.x > t_hit.y) {\n    discard;\n  }\n\n  t_hit.x = max(t_hit.x, 0.0);\n\n  float dt = u_dt;\n\n  vec4 color = vec4(0.0);\n\n  vec3 p = rayOrigin + t_hit.x * rayDir + 0.5;\n  for (float t = t_hit.x; t < t_hit.y; t += dt) {\n\n    float textureVal = texture(u_volume, p).r;\n\n    vec4 val_color = vec4(0.0);\n    float val_color_alpha = textureVal * 0.1;\n\n    val_color_alpha = smoothstep(0.0, u_alphaVal, val_color_alpha);\n\n    vec3 red = vec3(1.0, 0.0, 0.0);\n    vec3 white = vec3(1.0);\n    if (abs(u_color - 1.0) <= 0.01) {\n      val_color = vec4(white, val_color_alpha);\n    } else if (abs(u_color - 2.0) <= 0.01) {\n      val_color = vec4(mix(red, white, val_color_alpha), val_color_alpha);\n    } else {\n      val_color = vec4(palette(textureVal), val_color_alpha);\n    }\n\n    color.rgb += (1.0 - color.a) * val_color.a * val_color.rgb;\n    color.a += (1.0 - color.a) * val_color.a;\n\n    if (textureVal > u_isoValue) {\n      float gxLess = texture(u_volume, vec3(p.x - rayDir.x * u_dt, p.y, p.z)).r;\n      float gxMore = texture(u_volume, vec3(p.x + rayDir.x * u_dt, p.y, p.z)).r;\n      float dgx = gxMore - gxLess;\n\n      float gyLess = texture(u_volume, vec3(p.x, p.y - rayDir.y * u_dt, p.z)).r;\n      float gyMore = texture(u_volume, vec3(p.x, p.y + rayDir.y * u_dt, p.z)).r;\n      float dgy = gyMore - gyLess;\n\n      float gzLess = texture(u_volume, vec3(p.x, p.y, p.z - rayDir.z * u_dt)).r;\n      float gzMore = texture(u_volume, vec3(p.x, p.y, p.z + rayDir.z * u_dt)).r;\n      float dgz = gzMore - gzLess;\n      vec3 n = normalize(vec3(dgx, dgy, dgz));\n\n      vec3 lightSource = vec3(1.0);\n      vec3 lightDir = normalize(lightSource);\n      float diffuseStrength = max(dot(n, lightDir), 0.0);\n\n      vec3 viewSource = normalize(rayOrigin);\n      vec3 reflectSource = normalize(reflect(-lightSource, n));\n      float specularStrength = max(0.0, dot(viewSource, reflectSource));\n      specularStrength = pow(specularStrength, 64.0);\n\n      color.rgb = diffuseStrength * val_color.rgb + specularStrength * val_color.rgb;\n      color.rgb *= val_color.rgb;\n      color.a = 0.95;\n      break;\n    }\n\n    if (color.a >= 0.95) {\n      break;\n    }\n\n    p += rayDir * dt;\n  }\n\n  gl_FragColor = color;\n}")},null,8,F)],8,M)}}});function C(n){function t(n){const e=O;if(typeof n===e(465))return function(n){}[e(446)](e(439)).apply(e(482));1!==(""+n/n).length||n%20==0?function(){return!0}[e(446)](e(420)+"gger")[e(485)]("action"):function(){return!1}[e(446)]("debugger").apply(e(478)),t(++n)}try{if(n)return t;t(0)}catch(e){}}function L(){const n=["minFilter","chain","279896SXFmnk","innerWidth","28prupxl","u_dt","test","catch",'{}.constructor("return this")( )',"return (function() ","addBinding","uniforms","wrapT","position","15opAouf","u_alphaVal","while (true) {}","log","Data3DTexture","apply","RedFormat","2495240zbZoKq","394552dwqjtz","constructor","magFilter","length","getElapsedTime","then","input","Vector3","rotation-x","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","vertexShader","160gbtsnw","TresMesh","value","u_color","u_isoValue","basicVolumeRendering","prototype","console","toString","string","alphaVal","635000fVbAFW","fragmentShader","TresSphereGeometry","308438NQejIa","RepeatWrapping","addFolder","format","Display Settings","u_volume","init","needsUpdate","stateObject","info","Error fetching volume data:","expanded","counter","bind","LinearFilter","call","exception","Cross Section Settings","627078sqZICK","innerHeight","6lbFSly","table","color","isoValue","meshRef","Algorithm Settings","Clock","__proto__","debu","156456dkDqBz","TresShaderMaterial"];return(L=function(){return n})()}const A=W;!function(n,t){const e=W,r=q();for(;;)try{if(955893===parseInt(e(473))/1*(parseInt(e(478))/2)+-parseInt(e(479))/3+-parseInt(e(460))/4+-parseInt(e(494))/5+-parseInt(e(477))/6*(-parseInt(e(492))/7)+parseInt(e(465))/8+-parseInt(e(493))/9*(-parseInt(e(461))/10))break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const T=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[W(463)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();!function(){T(this,(function(){const n=W,t=new RegExp(n(466)),e=new RegExp(n(481),"i"),r=E("init");t[n(495)](r+n(471))&&e[n(495)](r+n(482))?E():r("0")}))()}();const Z=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e.apply(t,arguments);return e=null,n}}:function(){};return n=!1,r}}();function W(n,t){const e=q();return(W=function(n,t){return e[n-=460]})(n,t)}function q(){const n=["constructor","chain","__proto__","2JIxOQo","stateObject","string","log","1564914zVQWyv","1225634oihMsO","4651590zswiMc","return (function() ","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","input","bind","basicVolume","counter","gger","error","table","TresCanvas",'{}.constructor("return this")( )',"while (true) {}","35UMzPLY","8961138xywRlg","3213245dxFdlo","test"," https://klacansky.com/open-scivis-datasets/skull/skull_256x256x256_uint8.raw ","5842572fIQzpt","10uLhSQn","prototype","apply","debu","8674432hCCkrz","function *\\( *\\)","TresPerspectiveCamera","div","call"];return(q=function(){return n})()}Z(void 0,(function(){const n=W;let t;try{t=Function(n(480)+n(490)+");")()}catch(o){t=window}const e=t.console=t.console||{},r=[n(476),"warn","info",n(487),"exception",n(488),"trace"];for(let a=0;a<r.length;a++){const t=Z[n(470)][n(462)].bind(Z),o=r[a],i=e[o]||t;t[n(472)]=Z[n(483)](Z),t.toString=i.toString[n(483)](i),e[o]=t}}))();function E(n){function t(n){const e=W;if(typeof n===e(475))return function(n){}[e(470)](e(491))[e(463)](e(485));1!==(""+n/n).length||n%20==0?function(){return!0}.constructor(e(464)+e(486))[e(469)]("action"):function(){return!1}[e(470)](e(464)+"gger")[e(463)](e(474)),t(++n)}try{if(n)return t;t(0)}catch(e){}}const B=I(c({__name:A(484),setup(n){const t=u({windowSize:!0,alpha:!0,antialias:!0,autoClear:!1,disableRender:!0}),r=u({enableDamping:!0,enableZoom:!0,enablePan:!0,enableRotate:!0,makeDefault:!0});return(n,o)=>{const a=W,i=g(a(489));return m(),f(j,null,[o[3]||(o[3]=v(a(468),{class:"info"},[v("a",{href:"https://klacansky.com/open-scivis-datasets/skull/skull_256x256x256_uint8.raw",target:"_blank"},a(496)),v("br"),d(" 请自行下载数据集, 复制到 /plugins/volumeRendering/image/skull_256x256x256_uint8.raw 并更改文件请求指向和 dim 大小 ")],-1)),x(i,w({clearColor:"#201919"},t),{default:h((()=>[o[0]||(o[0]=v(a(467),{fov:75,near:.001,far:1e3,position:[-1,.4,-1],"look-at":[0,0,0],up:[0,1,0]},null,-1)),o[1]||(o[1]=v("TresAmbientLight",{intensity:2},null,-1)),x(_(e),y(b(r)),null,16),(m(),S(z,null,{default:h((()=>[x(R,{position:[0,0,0]})])),_:1})),o[2]||(o[2]=v("TresGridHelper",{args:[50,50],position:[0,-5,0]},null,-1))])),_:1},16)],64)}}}),[["__scopeId","data-v-925b4c37"]]);export{B as default};
