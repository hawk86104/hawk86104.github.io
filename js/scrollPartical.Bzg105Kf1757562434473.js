import{_ as e}from"./@fesjs.B-eV0iDW1757562434473.js";import"./Resource.BowyBt9V1757562434473.js";/* empty css                                                                             */import{l as t}from"./bubbleLoading.s8_iZHAc1757562434473.js";import{J as a,be as o,ad as l,B as s,c as n,l as r,n as i,d as u,bL as c,C as m,u as d,_ as p,ac as v,cf as f,K as h,O as g,cg as x,ch as y,ci as w,a as _,r as P,cj as b}from"./three.CMHPKQCP1757562434473.js";import"./three-mesh-ui.module.CVvu0VoA1757562434473.js";/* empty css                                                              */import{P as j}from"./tweakpane.C0HtAJSg1757562434473.js";import{Q as z,m as S,Z as M,e as T,k as C}from"./@tresjs.Cox_Ej0K1757562434473.js";import{q as B,s as A,d as F}from"./@vueuse.CO9YPEko1757562434473.js";import{d as L,w as E,v as R,b as V,G as D,o as U,L as I,u as k,aa as N,e as Y,a2 as O,r as X,h as q,j as G,I as J,f as K,a5 as W,a7 as $,a8 as H,F as Z}from"./@vue.pEDXJ_3Z1757562434473.js";import{l as Q}from"./util.BTRj-dGq1757562434473.js";import"./vue-router.DJjrSDwT1757562434473.js";import"./lodash-es.C7pWAXPe1757562434473.js";import"./pinia.BfnF9Own1757562434473.js";import"./@qlin.q6OWdsQV1757562434473.js";import"./@babel.BPq7uOAK1757562434473.js";import"./@floating-ui.BFjFSAYt1757562434473.js";import"./@juggle.CcBCnTIR1757562434473.js";import"./utils.CsnUis9b1757562434473.js";import"./postprocessing.mBO420ZZ1757562434473.js";const ee=L({__name:"ScrollControls",props:{pages:{default:4},distance:{default:4},smoothScroll:{default:.1},horizontal:{type:Boolean,default:!1},htmlScroll:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{expose:t,emit:a}){const o=e,l=a,{logWarning:s}=z();o.smoothScroll<0&&s("SmoothControl must be greater than zero"),o.pages<0&&s("Pages must be greater than zero");const{camera:n,controls:r,renderer:i,invalidate:u}=S();E(o,(()=>{u()}));const c=R(),m=document.createElement("div"),{y:d}=B(),{x:p,y:v,isScrolling:f}=A(m),{height:h,width:g}=F();let x=0;const y=V(!1),w=V(0),_=V(0),P=V(0),b=o.horizontal?"x":"y",j=E(n,(e=>{y.value?j():(x=o.horizontal?e?.position.x||0:e?.position.y||0,y.value=!0)}),{immediate:!0});E(f,(e=>{r.value&&(r.value.enabled=!e)}),{immediate:!0}),E(d,(e=>{(f.value||o.htmlScroll)&&(_.value=e/h.value/(P.value/h.value-1),w.value=-1*_.value,l("update:modelValue",_.value))})),E(v,(e=>{_.value=e/h.value/(P.value/h.value),w.value=-1*_.value,l("update:modelValue",_.value)})),E(p,(e=>{_.value=e/g.value/(P.value/g.value-1),w.value=+_.value,l("update:modelValue",_.value)})),E(i,(e=>{const t=e?.domElement;if(o.htmlScroll&&e?.domElement)t?.style.width&&t?.style.position&&t?.style.top&&t?.style.left&&(t.style.width="100%",t.style.position="fixed",t.style.top="0",t.style.left="0"),P.value=document.body.scrollHeight;else{const a=document.createElement("div"),l=document.createElement("div");m.style[o.horizontal?"overflowX":"overflowY"]="auto",m.style[o.horizontal?"overflowY":"overflowX"]="hidden",m.style.position="absolute",m.style.width="100%",m.style.height=" 100%",m.style.top="0",m.style.left="0",m.classList.add("scrollContainer"),a.style.position="sticky",a.style.top="0px",a.style.left="0px",a.style.width="100%",a.style.height="100%",a.style.overflow="hidden",m.appendChild(a),l.style.height=o.horizontal?"100%":h.value*o.pages+"px",l.style.width=o.horizontal?g.value*o.pages+"px":"100vw",l.style.pointerEvents="none",t.style.position="fixed",t.style.zIndex="0",t?.style.width&&(t.style.width="100%"),m.appendChild(l),e?.domElement.parentNode&&(e.domElement.parentNode.style.position="relative"),e?.domElement?.parentNode?.appendChild(m),P.value=o.horizontal?g.value*o.pages:h.value*o.pages}}),{immediate:!0});const{onBeforeRender:T}=M();return T((({invalidate:e})=>{if(n.value?.position){const t=(w.value*o.distance-n.value.position[b]+x)*o.smoothScroll;n.value.position[b]+=t,c.value.children.length>0&&(c.value.position[b]+=t),e()}})),t({instance:c}),(e,t)=>(U(),D("TresGroup",{ref_key:"wrapperRef",ref:c},[I(e.$slots,"default")],512))}});const te=e=>{let t=e.attributes.position.count,s=Math.ceil(Math.sqrt(t)),n=Math.ceil(t/s),r=new Float32Array(s*n*4);!function(e){for(let t=Math.floor(e.length/3)-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));for(let o=0;o<3;o++){let l=e[3*t+o];e[3*t+o]=e[3*a+o],e[3*a+o]=l}}}(e.attributes.position.array);for(let a=0;a<t;a++){const t=e.attributes.position.array[3*a+0],o=e.attributes.position.array[3*a+1],l=e.attributes.position.array[3*a+2],s=0;r[4*a+0]=t,r[4*a+1]=o,r[4*a+2]=l,r[4*a+3]=s}let i=new a(r,s,n,o,l);return i.needsUpdate=!0,i},ae=()=>{const e=new i({uniforms:{uTextureA:{value:null},uTextureB:{value:null},uTime:{value:0},uScroll:{value:0}},vertexShader:"varying vec2 vUv;\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  vUv = uv;\n}",fragmentShader:"uniform sampler2D uTextureA;\nuniform sampler2D uTextureB;\nprecision mediump float; \nuniform float uTime;\nuniform float uScroll;\nvarying vec2 vUv;\n\nmat3 rotationMatrix3(vec3 axis, float angle) {\n  axis = normalize(axis);\n  float s = sin(angle);\n  float c = cos(angle);\n  float oc = 1. - c;\n\n  return mat3(oc * axis.x * axis.x + c, oc * axis.x * axis.y - axis.z * s,\n              oc * axis.z * axis.x + axis.y * s,\n              oc * axis.x * axis.y + axis.z * s, oc * axis.y * axis.y + c,\n              oc * axis.y * axis.z - axis.x * s,\n              oc * axis.z * axis.x - axis.y * s,\n              oc * axis.y * axis.z + axis.x * s, oc * axis.z * axis.z + c);\n}\n\nvoid main() {\n  vec3 textureA = rotationMatrix3(vec3(10., 6., 3.), sin(uTime) * .1) *\n                  texture2D(uTextureA, vUv).xyz;\n  \n\n  vec3 textureB = rotationMatrix3(vec3(10., 6., 3.), sin(uTime) * .1) *\n                  texture2D(uTextureB, vUv).xyz;\n  \n\n  float t = uScroll;\n  vec3 pos = mix(textureA, textureB, t);\n\n  gl_FragColor = vec4(pos, 1.);\n}"}),t=new s;return t.setAttribute("position",new n(new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]),3)),t.setAttribute("uv",new n(new Float32Array([0,1,1,1,1,0,0,1,1,0,0,0]),2)),new r(t,e)};const oe=["object"],le=L({__name:"particalMesh",props:{progress:{default:0},width:{default:256},height:{default:256}},setup(e,{expose:t}){const a=e;let o=((e,t)=>{const a=e*t;let o=new Float32Array(3*a);for(let s=0;s<a;s++){let a=3*s;o[a+0]=s%e/e,o[a+1]=s/e/t}const l=new s;return l.setAttribute("position",new n(o,3)),new u(l,new i({uniforms:{uPositions:{value:null},uSize:{value:12},uPixelRatio:{value:Math.min(window.devicePixelRatio,2)},uColor:{value:new m("#ffaa00")}},vertexShader:"uniform sampler2D\n    uPositions; \nuniform float uSize;\nuniform float uPixelRatio;\nvarying vec3 vPos;\nvarying vec2 vUv;\nvoid main() {\n  vec3 pos = texture2D(uPositions, position.xy).xyz;\n\n  float customSize = uSize;\n\n  vec4 modelPosition = modelMatrix * vec4(pos, 1.0);\n  vec4 viewPosition = viewMatrix * modelPosition;\n  vec4 projectionPosition = projectionMatrix * viewPosition;\n\n  gl_Position = projectionPosition;\n  gl_PointSize = customSize * uPixelRatio;\n  gl_PointSize *= (1.0 / -viewPosition.z);\n\n  vPos = pos;\n}",fragmentShader:"precision mediump float;\nvarying vec3 vPos;\nuniform vec3 uColor; \nvoid main() {\n\n  float distanceToCenter = distance(gl_PointCoord, vec2(0.5));\n  float strength = 0.05 / distanceToCenter - 0.1;\n\n  \n\n  gl_FragColor = vec4(uColor, strength * length(vPos));\n}",transparent:!0,depthWrite:!1,blending:c}))})(a.width,a.height);return t({particles:o}),(e,t)=>(U(),D("primitive",{object:k(o)},null,8,oe))}}),se=L({__name:"particalFBO",props:{progress:{default:0},width:{default:256},height:{default:256},color:{default:"#ffaa00"}},async setup(e){let t,a;const s=e,n=V(),i=new d(s.width,s.height,{minFilter:v,magFilter:v,generateMipmaps:!1,colorSpace:p,depthBuffer:!1,stencilBuffer:!1,format:o,type:l}),u=e=>{const t=[];return e.traverse((e=>{e instanceof r&&(e.geometry.deleteAttribute("uv"),e.geometry.deleteAttribute("normal"),e.geometry.deleteAttribute("tangent"),t.push(e.geometry))})),x(t)},c=new f,m=u(([t,a]=N((()=>Q("https://opensource.cdn.icegl.cn/model/medical/brainparts.OBJ",c))),t=await t,a(),t));m.scale(.01,.01,.01);const y=te(m),w=u(([t,a]=N((()=>C("https://opensource.cdn.icegl.cn/model/eCommerce/guanYu.glb",{draco:!0,decoderPath:"./draco/"}))),t=await t,a(),t).scene.children[0]);w.rotateX(Math.PI/2),w.translate(0,-.9,0);const _=te(w),P=u(([t,a]=N((()=>C("https://opensource.cdn.icegl.cn/model/industry4/modelDraco.glb",{draco:!0,decoderPath:"./draco/"}))),t=await t,a(),t).scene.children[0]);P.rotateX(-Math.PI/2),P.rotateY(Math.PI/3),P.translate(0,0,0);const b=te(P),j=ae(),z=new h,M=new g(-1,1,1,-1,1/Math.pow(2,53),1);z.add(j);const{onBeforeLoop:B}=T(),{camera:A,renderer:F}=S();return B((({elapsed:e})=>{F.value&&A.value&&n.value&&(F.value.setRenderTarget(i),F.value.clear(),F.value.render(z,M),F.value.setRenderTarget(null),s.progress<.5?(j.material.uniforms.uTextureA.value=_,j.material.uniforms.uTextureB.value=y,j.material.uniforms.uScroll.value=2*s.progress):(j.material.uniforms.uTextureA.value=y,j.material.uniforms.uTextureB.value=b,j.material.uniforms.uScroll.value=2*(s.progress-.5)),j.material.uniforms.uTime.value=e,n.value.particles.material.uniforms.uPositions.value=i.texture,n.value.particles.material.uniforms.uColor.value.setStyle(s.color))})),(e,t)=>(U(),Y(le,{ref_key:"pMesh",ref:n,progress:e.progress},null,8,["progress"]))}}),ne=L({__name:"particalPass",props:{use:{type:Boolean,default:!0}},setup(e){const t=e,{camera:a,renderer:l,scene:s,sizes:n}=S(),r=0,i=.472,u=1.61;let c=null;O((()=>{n.width.value&&((e,t,a,l,s)=>{const n=new y(e,t),m=new w(new _(l,s),i,u,r),v=new d(l,s,{generateMipmaps:!1,minFilter:P,magFilter:P,format:o,colorSpace:p,samples:0});c=new b(a,v),c.addPass(n),c.addPass(m)})(s.value,a.value,l.value,n.width.value,n.height.value)}));const{onLoop:m}=T();return m((()=>{t.use?c&&c.render():l.value&&a.value&&l.value.render(s.value,a.value)})),(e,t)=>null}}),re=e(L({__name:"scrollPartical",setup(e){const a=V(0);O((()=>{console.log("jaime ~ progress:",a.value)}));const o={clearColor:"#000",outputColorSpace:p,windowSize:!0,renderMode:"manual",powerPreference:"high-performance",antialias:!1,alpha:!1,useLegacyLights:!1,physicallyCorrectLights:!0},l=X({pass:!1,color:"#ffaa00"}),s=new j({title:"参数",expanded:!0});return s.addBinding(l,"pass",{label:"后处理"}),s.addBinding(l,"color",{label:"颜色"}),(e,s)=>{const n=q("TresCanvas");return U(),D(Z,null,[G(k(t),{styleNum:4}),G(n,$(H(o)),{default:K((()=>[s[1]||(s[1]=J("TresPerspectiveCamera",{position:[0,0,-4],fov:45,near:.1,far:1e3,"look-at":[0,0,0]},null,-1)),G(ne,{use:l.pass},null,8,["use"]),G(ee,{modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=e=>a.value=e),distance:10,"smooth-scroll":.1,htmlScroll:""},{default:K((()=>[(U(),Y(W,null,{default:K((()=>[G(se,{progress:a.value,color:l.color},null,8,["progress","color"])])),_:1}))])),_:1},8,["modelValue"])])),_:1},16),s[2]||(s[2]=J("main",null,[J("section",null,[J("h1",null,"关羽 - GuanYu")]),J("section",null,[J("h1",{style:{"margin-left":"-11em","margin-bottom":"-10em"}},"大脑 - Brain")]),J("section",null,[J("h1",{style:{"margin-left":"11em","margin-bottom":"-10em"}},"设备 - Device")])],-1))],64)}}}),[["__scopeId","data-v-18b1351b"]]);export{re as default};
