import{bb as K,by as ct,aA as A,cK as lt,ba as X,bm as b,ay as U,c6 as ut,bB as dt,az as ft,a8 as pt,c5 as mt,bS as gt,et as vt,a5 as Mt,q as xt,B as wt,o as Tt,c as yt,t as N,ep as bt,aL as Pt,_ as Bt}from"./vendor.J2DLLmWp1718158885800.js";import{c as _t,d as Ct,a as Ft}from"./ExtensionUtilities._zG6lGnR1718158885800.js";import{F as Wt}from"./HeightCorrection.c8NcwD5G1718158885800.js";import{C as St}from"./vanilla.hNhDUL1D1718158885800.js";import"./object_hash.ac3g0oJg1718158885800.js";import"./builtins-300es.Tm_BdSQ71718158885800.js";var kt=Math.PI/180,It=180/Math.PI;function V(o){var t=$(o[0]+1,o[2]),e=$(o[0],o[2]),r=H(o[1]+1,o[2]),s=H(o[1],o[2]);return[e,r,t,s]}function jt(o){var t=V(o),e={type:"Polygon",coordinates:[[[t[0],t[3]],[t[0],t[1]],[t[2],t[1]],[t[2],t[3]],[t[0],t[3]]]]};return e}function $(o,t){return o/Math.pow(2,t)*360-180}function H(o,t){var e=Math.PI-2*Math.PI*o/Math.pow(2,t);return It*Math.atan(.5*(Math.exp(e)-Math.exp(-e)))}function L(o,t,e){var r=it(o,t,e);return r[0]=Math.floor(r[0]),r[1]=Math.floor(r[1]),r}function tt(o){return[[o[0]*2,o[1]*2,o[2]+1],[o[0]*2+1,o[1]*2,o[2]+1],[o[0]*2+1,o[1]*2+1,o[2]+1],[o[0]*2,o[1]*2+1,o[2]+1]]}function et(o){return[o[0]>>1,o[1]>>1,o[2]-1]}function rt(o){return tt(et(o))}function Rt(o,t){for(var e=rt(o),r=0;r<e.length;r++)if(!ot(t,e[r]))return!1;return!0}function ot(o,t){for(var e=0;e<o.length;e++)if(st(o[e],t))return!0;return!1}function st(o,t){return o[0]===t[0]&&o[1]===t[1]&&o[2]===t[2]}function Et(o){for(var t="",e=o[2];e>0;e--){var r=0,s=1<<e-1;o[0]&s&&r++,o[1]&s&&(r+=2),t+=r.toString()}return t}function Ut(o){for(var t=0,e=0,r=o.length,s=r;s>0;s--){var i=1<<s-1,a=+o[r-s];a===1&&(t|=i),a===2&&(e|=i),a===3&&(t|=i,e|=i)}return[t,e,r]}function Ot(o){var t=L(o[0],o[1],32),e=L(o[2],o[3],32),r=[t[0],t[1],e[0],e[1]],s=qt(r);if(s===0)return[0,0,0];var i=r[0]>>>32-s,a=r[1]>>>32-s;return[i,a,s]}function qt(o){for(var t=28,e=0;e<t;e++){var r=1<<32-(e+1);if((o[0]&r)!==(o[2]&r)||(o[1]&r)!==(o[3]&r))return e}return t}function it(o,t,e){var r=Math.sin(t*kt),s=Math.pow(2,e),i=s*(o/360+.5),a=s*(.5-.25*Math.log((1+r)/(1-r))/Math.PI);return i=i%s,i<0&&(i=i+s),[i,a,e]}var O={tileToGeoJSON:jt,tileToBBOX:V,getChildren:tt,getParent:et,getSiblings:rt,hasTile:ot,hasSiblings:Rt,tilesEqual:st,tileToQuadkey:Et,quadkeyToTile:Ut,pointToTile:L,bboxToTile:Ot,pointToTileFraction:it};class Z extends K{constructor(){super(),this.isDisposed=!1,this.isReady=!1,this.childrenTiles=[],this.boundingBoxWorld=new ct}init(t,e,r){this.tileNo=t,Object.freeze(this.tileNo),this.map=e,this.parentTile=r,this.visible=!1,this.renderOrder=t[2],this.ready()}async ready(){if(this.content=await this.map.provider.getTile(this.tileNo),!this.isDisposed){if(this.add(this.content),this.boundingBoxWorld.setFromObject(this.content).applyMatrix4(this.matrixWorld.makeRotationX(-Math.PI/2)),this.map.add(this),this.visible=!0,this.isReady=!0,this.parentTile){const t=this.parentTile.childrenTiles;let e=0;for(let r=0;r<t.length;r++)t[r].isReady&&e++;e===4&&(this.parentTile.visible=!1)}this.update()}}update(){if(!this.isReady||this.isDisposed)return;const{cameraFrustum:t,cameraWorldPosition:e}=this.map;if(!t.intersectsBox(this.boundingBoxWorld)){this.simplify();return}this.content instanceof A&&this.map.provider.filter&&(this.content.material.uniforms.t_Matrix.value=this.map.provider.getTranMatrix());let r=this.boundingBoxWorld.distanceToPoint(e);const s=this.tileNo[2];r/=Math.pow(2,this.map.provider.maxZoom-s),r<60&&this.subdivide(),r>80&&this.simplify(),this.childrenTiles.sort((a,h)=>a.boundingBoxWorld.distanceToPoint(e)-h.boundingBoxWorld.distanceToPoint(e)).forEach(a=>a.update())}subdivide(){const{isReady:t,tileNo:e,map:r,childrenTiles:s}=this,i=e[2];if(!t||s.length>0||i>=r.maxZoom)return;O.getChildren(e).forEach(h=>{const n=new Z;n.init(h,r,this),s.push(n)})}simplify(){this.childrenTiles.forEach(t=>t.dispose()),this.childrenTiles=[],this.visible=!0}dispose(){this.map.remove(this),this.map.provider.abort(this.tileNo),this.childrenTiles.forEach(t=>t.dispose()),this.childrenTiles=[],this.parentTile=void 0,this.content&&(this.map.provider.dispose(this.tileNo,this.content),this.content=void 0),this.isDisposed=!0}}let ie=class extends K{constructor(){super(),this.bbox=[74.390592,6.900905,134.071423,54.318199],this.maxZoom=20,this.rootForward=0,this.cameraFrustum=new lt,this.cameraWorldPosition=new X,this.cameraProjectionMatrix=new b,this.lastCameraProjectionMatrix=new b,this.lastCameraWorldPosition=new X,this.rootTiles=[],this.lastUpdateTime=0,U.prototype.computeBoundsTree||(U.prototype.computeBoundsTree=_t),U.prototype.disposeBoundsTree||(U.prototype.disposeBoundsTree=Ct),A.prototype.raycast=Ft}initRootTiles(){this.rootForward>3&&(console.warn("rootForward needs to be 0 - 3."),this.rootForward=3),this.rootForward<0&&(console.warn("rootForward needs to be 0 - 3."),this.rootForward=0);const t=[];let e=[O.bboxToTile(this.bbox)],r=this.rootForward;for(;r>0;){const s=[...e];e=[],s.forEach(i=>{const a=O.getChildren(i);e.push(...a)}),r--}t.push(...e),t.forEach(s=>{const i=new Z;i.init(s,this),this.rootTiles.push(i)})}update(){if(!this.visible||!this.camera)return;const t=Date.now();if(!(t-this.lastUpdateTime<300)){if(this.rootTiles.length===0){this.initRootTiles();return}this.camera.getWorldPosition(this.cameraWorldPosition),this.cameraProjectionMatrix.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),!(this.cameraWorldPosition.equals(this.lastCameraWorldPosition)&&this.cameraProjectionMatrix.equals(this.lastCameraProjectionMatrix))&&(this.cameraFrustum.setFromProjectionMatrix(this.cameraProjectionMatrix),this.rootTiles.forEach(e=>e.update()),this.lastCameraProjectionMatrix.copy(this.cameraProjectionMatrix),this.lastCameraWorldPosition.copy(this.cameraWorldPosition),this.lastUpdateTime=t)}}dispose(){throw new Error("[Map.dispose] Method not implemented.")}regenerate(){throw new Error("[Map.regenerate] Method not implemented.")}},R;async function Dt(o,t,e=!1){const s=await(await t.ready()).blob(),i=await createImageBitmap(s,e?void 0:{imageOrientation:"flipY"});if(!e)return i;R||(R=new OffscreenCanvas(256,256));const a=R.getContext("2d");if(!a)throw new Error('Offscreencanvas.getContext("2d") error!');const{width:h,height:n}=R;return a.drawImage(i,0,0),a.rect(0,0,h,n),a.strokeStyle="#00FFFF",a.font="20px Arial",a.stroke(),a.fillStyle="#FF4444",a.fillText("".concat(o[0]),10,30),a.fillStyle="#44FF44",a.fillText("".concat(o[1]),10,55),a.fillStyle="#66AAFF",a.fillText("".concat(o[2]),10,80),await createImageBitmap(R,{imageOrientation:"flipY"})}class Xt{constructor(t){this.terminated=!0,this.map=new Map,this.worker=new t,this.worker.onmessage=this.onMessage.bind(this),this.terminated=!1}async postMessage(t){if(!this.terminated)return this.worker.postMessage(t),new Promise((e,r)=>{this.map.set(t.id,e)})}onMessage(t){const{id:e,error:r}=t.data,s=this.map.get(e);s&&!r&&s(t.data),this.map.delete(e)}terminate(){this.worker.onmessage=null,this.worker.terminate(),this.terminated=!0,this.map.clear()}}function Lt(o){return new Worker(""+new URL("../static/MapWorker-InhFhe39.js",import.meta.url).href,{name:o==null?void 0:o.name})}class ne{constructor(){this.maxZoom=20,this.source="https://gac-geo.googlecnapps.cn/maps/vt?lyrs=s&x=[x]&y=[y]&z=[z]",this.showTileNo=!1,this._useWorker=!1,this.fetching=new Map}set useWorker(t){var e;this._useWorker=t,this._useWorker||((e=this._worker)==null||e.terminate(),this._worker=void 0)}get useWorker(){return this._useWorker}async getTile(t){const e=this.getUrl(t),r=new ut;if(this._useWorker){this._worker||(this._worker=new Xt(Lt));const s=this.getId(t),i=await this._worker.postMessage({id:s,tileNo:t,url:e,debug:this.showTileNo});r.image=i.bitmap}else{const s=new Wt(e,{cache:"force-cache",mode:"cors"});this.fetching.set(t,s);try{r.image=await Dt(t,s,this.showTileNo)}finally{this.fetching.delete(t)}}return r.needsUpdate=!0,r.anisotropy=4,r}abort(t){var e;if(this._useWorker)(e=this._worker)==null||e.postMessage({id:this.getId(t),abort:!0});else{const r=this.fetching.get(t);r&&r.abort(),this.fetching.delete(t)}}dispose(t,e){e.dispose()}getId(t){return t.join("-")}getUrl(t){const[e,r,s]=t;return this.source.indexOf("[x]")===-1?this.source.replace("{x}",e+"").replace("{y}",r+"").replace("{z}",s+""):this.source.replace("[x]",e+"").replace("[y]",r+"").replace("[z]",s+"")}}const z="utm",zt="merc",q=6378137,J=Math.PI/180;function Q(o,t){const e=q*o*J,r=q*Math.log(Math.tan(Math.PI*.25+t*J*.5));return[e,r]}function At(o,t){let e=o/(q*Math.PI)*180,r=t/(q*Math.PI)*180;return r=180/Math.PI*(2*Math.atan(Math.exp(r*Math.PI/180))-Math.PI/2),[e,r]}function x(o){return o*Math.PI/180}function Y(o){return o*180/Math.PI}const at={a:6378137,b:6356752314245e-6,f:1/298.257223563},Zt="CDEFGHJKLMNPQRSTUVWXX",Gt=5e5,Nt=1e7;function $t(o,t,e){if(!(-80<=t&&t<=84))throw new RangeError("latitude ‘".concat(t,"’ outside UTM limits"));let r=e||Math.floor((o+180)/6)+1,s=x((r-1)*6-180+3);const i=Zt.charAt(Math.floor(t/8+10));r===31&&i==="V"&&o>=3?(r++,s+=x(6)):r===32&&i==="X"&&o<9?(r--,s-=x(6)):r===32&&i==="X"&&o>=9?(r++,s+=x(6)):r===34&&i==="X"&&o<21?(r--,s-=x(6)):r===34&&i==="X"&&o>=21?(r++,s+=x(6)):r===36&&i==="X"&&o<33?(r--,s-=x(6)):r===36&&i==="X"&&o>=33&&(r++,s+=x(6));const a=x(t),h=x(o)-s,{a:n,f:l}=at,c=.9996,f=Math.sqrt(l*(2-l)),u=l/(2-l),T=u*u,y=u*T,g=u*y,v=u*g,p=u*v,_=Math.cos(h),k=Math.sin(h),w=Math.tan(a),C=Math.sinh(f*Math.atanh(f*w/Math.sqrt(1+w*w))),P=w*Math.sqrt(1+C*C)-C*Math.sqrt(1+w*w),F=Math.atan2(P,_),B=Math.asinh(k/Math.sqrt(P*P+_*_)),E=n/(1+u)*(1+1/4*T+1/64*g+1/256*p),W=[null,1/2*u-2/3*T+5/16*y+41/180*g-127/288*v+7891/37800*p,13/48*T-3/5*y+557/1440*g+281/630*v-1983433/1935360*p,61/240*y-103/140*g+15061/26880*v+167603/181440*p,49561/161280*g-179/168*v+6601661/7257600*p,34729/80640*v-3418889/1995840*p,212378941/319334400*p];let I=F;for(let M=1;M<=6;M++)I+=W[M]*Math.sin(2*M*F)*Math.cosh(2*M*B);let S=B;for(let M=1;M<=6;M++)S+=W[M]*Math.cos(2*M*F)*Math.sinh(2*M*B);let d=c*E*S,j=c*E*I;return d=d+Gt,j<0&&(j=j+Nt),[d,j]}function Ht(o,t,e){const s=e||50,i=5e5,{a,f:h}=at,n=.9996,l=o-i,c=t,f=Math.sqrt(h*(2-h)),u=h/(2-h),T=u*u,y=u*T,g=u*y,v=u*g,p=u*v,_=a/(1+u)*(1+1/4*T+1/64*g+1/256*p),k=l/(n*_),w=c/(n*_),C=[null,1/2*u-2/3*T+37/96*y-1/360*g-81/512*v+96199/604800*p,1/48*T+1/15*y-437/1440*g+46/105*v-1118711/3870720*p,17/480*y-37/840*g-209/4480*v+5569/90720*p,4397/161280*g-11/504*v-830251/7257600*p,4583/161280*v-108847/3991680*p,20648693/638668800*p];let P=w;for(let m=1;m<=6;m++)P-=C[m]*Math.sin(2*m*w)*Math.cosh(2*m*k);let F=k;for(let m=1;m<=6;m++)F-=C[m]*Math.cos(2*m*w)*Math.sinh(2*m*k);const B=Math.sinh(F),E=Math.sin(P),W=Math.cos(P),I=E/Math.sqrt(B*B+W*W);let S=null,d=I;do{const m=Math.sinh(f*Math.atanh(f*d/Math.sqrt(1+d*d))),D=d*Math.sqrt(1+m*m)-m*Math.sqrt(1+d*d);S=(I-D)/Math.sqrt(1+D*D)*(1+(1-f*f)*d*d)/((1-f*f)*Math.sqrt(1+d*d)),d+=S}while(Math.abs(S)>1e-12);const M=Math.atan(d);let G=Math.atan2(B,W);const nt=x((s-1)*6-180+3);G+=nt;const ht=Number(Y(M).toFixed(14));return[Number(Y(G).toFixed(14)),ht]}class he{constructor(){this.utmZone=50,this.coordType=z,this.maxZoom=20}async getTile(t){const e=new dt,r=O.tileToBBOX(t),s=this.convertCoordinate(r[0],r[3]),i=this.convertCoordinate(r[2],r[3]),a=this.convertCoordinate(r[0],r[1]),h=this.convertCoordinate(r[2],r[1]),n=new Float32Array([s[0],s[1],0,i[0],i[1],0,a[0],a[1],0,h[0],h[1],0]);return e.setAttribute("position",new ft(n,3)),e}abort(t){}dispose(t,e){e.dispose()}convertCoordinate(t,e){switch(this.coordType){case z:return $t(t,e,this.utmZone);case zt:return Q(t,e);default:return Q(t,e)}}}class Jt extends A{constructor(t){super(t),this.center=new X}}class ce{constructor(t,e){this.geometryProvider=t,this.textureProvider=e,this.maxZoom=20,this.showBoundingBox=!1,this.wireframe=!1,this.flatShading=!1,this.useStandardMaterial=!1,this.filter=null}getTranMatrix(){var e,r,s,i,a;let t=new b;if((e=this.filter)!=null&&e.opposite){let h=new b;h.set(-1,0,0,0,0,-1,0,0,0,0,-1,0,1,1,1,1),t.multiply(h)}if((r=this.filter)!=null&&r.monochrome){let h=new b;const n=this.filter.monochrome.r,l=this.filter.monochrome.g,c=this.filter.monochrome.b;h.set(n,l,c,0,n,l,c,0,n,l,c,0,0,0,0,1),t.multiply(h)}if((s=this.filter)!=null&&s.genBright){let h=new b;const n=this.filter.genBright;h.set(n,0,0,0,0,n,0,0,0,0,n,0,0,0,0,1),t.multiply(h)}if((i=this.filter)!=null&&i.genContrast){let h=new b;const n=this.filter.genContrast,l=.5*(1-n);h.set(n,0,0,0,0,n,0,0,0,0,n,0,l,l,l,1),t.multiply(h)}if((a=this.filter)!=null&&a.genSaturate){let h=new b;const n=this.filter.genSaturate,l=.3*(1-n),c=.6*(1-n),f=.1*(1-n);h.set(l+n,l,l,0,c,c+n,c,0,f,f,f+n,0,0,0,0,1),t.multiply(h)}return t}async getTile(t){const e=[this.geometryProvider.getTile(t),this.textureProvider.getTile(t)],r=await Promise.all(e),s=r[0],i=r[1];i.colorSpace=pt;const{wireframe:a,flatShading:h}=this;let n=null;const l=t[0]+t[1]+t[2];n=this.useStandardMaterial?new mt({map:i,wireframe:a,flatShading:h}):new gt({map:i,wireframe:a}),this.filter&&(n=new St({baseMaterial:n,vertexShader:"\n                varying vec2 vUv;    //顶点纹理坐标\n                void main () {\n                    vUv = uv;\n                    // gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4( position, 1.0 ); 着色器会抖动\n                    // gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                    csm_Position = position * vec3(1.0);\n                }\n                ",fragmentShader:"\n                uniform sampler2D e_Texture;     //纹理图像\n                varying vec2 vUv;               //片元纹理坐标\n                uniform mat4 t_Matrix;     //接收变换矩阵\n                void main () {\n                    // gl_FragColor = texture2D( e_Texture, vUv );\n\n                    // vec4 textureColor = texture2D( e_Texture, vUv );\n                    // //计算加权平均值\n                    // float w_a = textureColor.r * 0.3 + textureColor.g * 0.6 + textureColor.b * 0.1;\n                    // gl_FragColor = vec4(w_a, w_a, w_a, 1.0);\n\n                    vec4 textureColor = texture2D( e_Texture, vUv );\n                    //变换矩阵乘以 vec4(R,G,B,1)    --->vec4(R,G,B,1) 是齐次坐标，原本是n维的向量用一个n+1维向量来表示\n                    //vec4(R,G,B,1)第四个分量不是透明度\n                    vec4 transColor =  vec4(textureColor.r, textureColor.g, textureColor.b, 1.0)*t_Matrix; \n                    //设置透明度\n                    transColor.a = 1.0;\n                    csm_FragColor = transColor;\n\n                    // if(vUv.x==0.0 || vUv.x==1.0 || vUv.y==0.0 || vUv.y==1.0){\n                    //     gl_FragColor.a = 0.0;\n                    // }\n                }",silent:!0,flatShading:h,uniforms:{e_Texture:{value:i},t_Matrix:{value:this.getTranMatrix()}}}));const c=new Jt;if(c.renderOrder=l,s.computeBoundingBox(),s.boundingBox.getCenter(c.center),s.center(),s.computeBoundingSphere(),s.computeBoundsTree(),c.position.copy(c.center),c.geometry=s,c.material=n,this.showBoundingBox){const f=new vt(s.boundingBox);c.add(f)}return c}abort(t){this.geometryProvider.abort(t),this.textureProvider.abort(t)}dispose(t,e){const r=e.geometry,s=e.material;r&&this.geometryProvider.dispose(t,r),s&&s.map&&this.textureProvider.dispose(t,s.map),s==null||s.dispose()}}const Qt={class:"lonLatDiv"},Yt=Mt({__name:"raycasterEvent",props:{tileMapRef:{}},setup(o){const t=o,e=xt([0,0]);return wt(()=>t.tileMapRef,(r,s)=>{if(!s&&r){let h=function(n){a.x=n.clientX/window.innerWidth*2-1,a.y=-(n.clientY/window.innerHeight)*2+1,i.setFromCamera(a,r.camera);var l=i.intersectObjects(r.map.children);if(l.length>0){var c=l[0];r.map.provider.geometryProvider.coordType===z?e.value=Ht(c.point.x,-c.point.z):e.value=At(c.point.x,-c.point.z),e.value[0]=e.value[0].toFixed(4),e.value[1]=e.value[1].toFixed(4)}};console.log("raycasterEvent:",r);var i=new bt,a=new Pt;document.addEventListener("mousemove",h,!1)}}),(r,s)=>(Tt(),yt("div",Qt," lon:"+N(e.value[0])+" lat:"+N(e.value[1]),1))}}),le=Bt(Yt,[["__scopeId","data-v-462a60f8"]]);export{ie as M,he as P,ce as T,z as U,ne as a,Xt as b,zt as c,Q as d,$t as l,le as r};
