{"version":3,"file":"effectComposerLayers.DQeZIsdY1767105581793.js","sources":["../../src/plugins/basic/components/ecLayers.vue","../../src/plugins/basic/pages/shine/effectComposerLayers.vue"],"sourcesContent":["<!--\n * @Description: \n * @Version: 1.668\n * @Autor: 地虎降天龙\n * @Date: 2024-01-11 08:12:17\n * @LastEditors: 地虎降天龙\n * @LastEditTime: 2025-09-24 18:07:55\n-->\n<template>\n    <Box ref=\"normalBox\" :args=\"[1, 1, 1]\" color=\"orange\" :position=\"[3, 2, 1]\" />\n    <TresMesh ref=\"shineBox\" :position=\"[0, 2, -4]\">\n        <TresBoxGeometry :args=\"[1, 1, 1]\" />\n        <TresMeshNormalMaterial />\n    </TresMesh>\n    <TresMesh ref=\"filmBox\" :position=\"[1, 2, 3]\">\n        <TresBoxGeometry :args=\"[1, 1, 1]\" />\n        <TresMeshNormalMaterial />\n    </TresMesh>\n</template>\n\n<script setup lang=\"ts\">\nimport { watchEffect, ref } from 'vue'\nimport * as THREE from 'three'\nimport { Box } from '@tresjs/cientos'\nimport { useTres, useLoop } from '@tresjs/core'\nimport { RenderPass } from 'three/examples/jsm/postprocessing/RenderPass'\nimport { EffectComposer } from 'three/examples/jsm/postprocessing/EffectComposer'\nimport { UnrealBloomPass } from 'three/examples/jsm/postprocessing/UnrealBloomPass'\n// import { FilmPass } from 'three/examples/jsm/postprocessing/FilmPass.js'\n\nconst { camera, renderer, scene, sizes } = useTres()\n\nconst normalBox = ref()\nconst shineBox = ref()\nconst filmBox = ref()\n\nlet effectComposer = null as any\nconst params = {\n    threshold: 0,\n    strength: 0.972, // 强度\n    radius: 0.21, // 半径\n}\nconst bloomPassEffect = (scene: THREE.Scene, camera: THREE.PerspectiveCamera, renderer: THREE.WebGLRenderer, width: number, height: number) => {\n    // 渲染器通道，将场景全部加入渲染器\n    const renderScene = new RenderPass(scene, camera)\n    // 添加虚幻发光通道\n    const bloomPass = new UnrealBloomPass(new THREE.Vector2(width, height), params.strength, params.radius, params.threshold)\n    // 创建合成器\n    effectComposer = new EffectComposer(renderer)\n    // 将渲染器和场景结合到合成器中\n    effectComposer.addPass(renderScene)\n    effectComposer.addPass(bloomPass)\n}\n\n// let effectComposer2 = null as any\n// const filmPassEffect = (scene2: THREE.Scene, camera: THREE.PerspectiveCamera, renderer: THREE.WebGLRenderer, width: number, height: number) => {\n// \tvar renderPass2 = new RenderPass(scene2, camera)\n\n// \tconst filmPass = new FilmPass()\n// \t// 创建合成器\n// \teffectComposer2 = new EffectComposer(renderer)\n// \t// 将渲染器和场景结合到合成器中\n// \teffectComposer2.addPass(renderPass2)\n// \teffectComposer2.addPass(filmPass)\n// }\n// filmPassEffect(scene.value, camera.value as any, renderer.value, sizes.width.value, sizes.height.value)\nwatchEffect(() => {\n    if (normalBox.value) {\n        normalBox.value.instance.layers.set(0)\n    }\n    if (shineBox.value) {\n        shineBox.value.layers.set(1)\n    }\n    if (filmBox.value) {\n        filmBox.value.layers.set(2)\n    }\n    if (sizes.width.value) {\n        bloomPassEffect(scene.value, camera.value as any, renderer, sizes.width.value, sizes.height.value)\n    }\n})\nconst { onRender } = useLoop()\nonRender(() => {\n    if (effectComposer && camera.value) {\n        renderer.clear()\n\n        camera.value.layers.set(1)\n        effectComposer.render()\n\n        // renderer.value.clearDepth() // 清除深度缓存\n        // camera.value.layers.set(2)\n        // effectComposer2.render()\n\n        renderer.clearDepth() // 清除深度缓存\n\n        camera.value.layers.set(0)\n        renderer.render(scene.value, camera.value)\n    }\n})\n</script>\n","<!--\n * @Description: \n * @Version: 1.668\n * @Autor: 地虎降天龙\n * @Date: 2024-01-09 15:02:26\n * @LastEditors: 地虎降天龙\n * @LastEditTime: 2024-09-12 10:24:41\n-->\n\n<template>\n    <TresCanvas ref=\"tcRef\" renderMode=\"manual\" window-size>\n        <TresPerspectiveCamera :position=\"[10, 10, 10]\" />\n        <TresAmbientLight :intensity=\"1\" />\n        <OrbitControls />\n        <TresGridHelper :args=\"[10, 10]\" />\n        <!-- 这种方式存在bug：无论相机在哪个角度，都看到正常方块绘制在发光方块之上 -->\n        <ecLayers />\n    </TresCanvas>\n</template>\n\n<script setup lang=\"ts\">\nimport { OrbitControls } from '@tresjs/cientos'\nimport { watchEffect, ref } from 'vue'\nimport ecLayers from '../../components/ecLayers.vue'\n\nconst tcRef = ref()\nwatchEffect(() => {\n    if (tcRef.value) {\n        const renderer = tcRef.value.context.renderer.instance\n        renderer.autoClear = false\n    }\n})\n</script>\n"],"names":["watchEffect","ref","useTres","scene","camera","renderer","useLoop","_createVNode","_unref","Box","_createElementVNode","OrbitControls","ecLayers"],"mappings":"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"}