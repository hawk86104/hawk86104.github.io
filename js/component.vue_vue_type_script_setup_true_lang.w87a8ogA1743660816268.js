import{au as e,_ as a,l as t,aO as r,aP as u,aQ as s,N as l,aE as n,aF as o,U as i,aY as d}from"./three.2wx8FU0g1743660816268.js";import{m as v,j as c,e as m}from"./@tresjs.zc7faK4J1743660816268.js";import{R as p}from"./three-stdlib.rtqrSiFZ1743660816268.js";import{y as h,b as f,w as _,a as y,u as g,d as k,W as b,a4 as w,o as x,H as S,J as j,M as E,a0 as F,a7 as A}from"./@vue.B5PFBfKs1743660816268.js";class B extends e{constructor(){super(),this.virtualScene=null,this.virtualScene=new a}add(...e){return this.virtualScene.add(...e),this}destructor(){this.virtualScene.traverse((e=>{e instanceof t&&(e.geometry.dispose(),e.material.dispose(),e.material.map&&e.material.map.dispose(),this.virtualScene.remove(e))})),this.virtualScene=null}}const D={sunset:"venice/venice_sunset_1k.hdr",studio:"studio/poly_haven_studio_1k.hdr",city:"city/canary_wharf_1k.hdr",umbrellas:"outdoor/outdoor_umbrellas_1k.hdr",night:"outdoor/satara_night_1k.hdr",forest:"outood/mossy_forest_1k.hdr",snow:"outdoor/snowy_forest_path_01_1k.hdr",dawn:"kiara/kiara_1_dawn_1k.hdr",hangar:"indoor/small_hangar_01_1k.hdr",urban:"indoor/abandoned_games_room_02_1k.hdr",modern:"city/modern_buildings_2_1k.hdr",shangai:"city/shanghai_bund_1k.hdr"};const P=k({__name:"component",props:{background:{type:[Boolean,String],default:!1},blur:{default:0},files:{default:[]},path:{default:""},preset:{default:void 0},resolution:{default:256},near:{default:1},far:{default:1e3},frames:{default:1/0},useDefaultScene:{type:Boolean,default:!1}},async setup(e,{expose:a}){let t,k;const P=e,$=f(null);a({texture:$});const{extend:M,renderer:O,scene:T}=v();let C=null,H=f(null),J=null;const L=f(null);b((()=>{L.value?.destructor(),H.value?.dispose()}));const{onBeforeLoop:N}=m();let Q=1;N((()=>{J&&L.value&&H.value&&(P.frames===1/0||Q<P.frames)&&(P.useDefaultScene?J.update(O.value,T.value):J.update(O.value,A(L.value.virtualScene)),Q++)}));const R=([t,k]=w((()=>async function(e,a){const{scene:t,invalidate:l}=v(),{preset:n,blur:o,files:i=f([]),path:d=f(""),background:m}=h(e);_(e,(()=>{l()}));const k=f(null),b=y((()=>Array.isArray(i.value))),w=y((()=>b.value?r:p));return _([i,d],(async([e,a])=>{if(e&&e.length>0&&!n?.value){try{k.value=await c(w.value,b.value?[...g(e)]:g(e),(e=>{a&&e.setPath(g(a))}))}catch(t){throw new Error(`Failed to load environment map: ${t}`)}k.value&&(k.value.mapping=b.value?u:s)}}),{immediate:!0}),_(k,(e=>{t.value&&e&&(t.value.environment=e)}),{immediate:!0}),_([m,k],(([e,r])=>{if(t.value){let u=a?.value?a.value.texture:r,s=t.value.background;s?.isColor||(s=void 0),t.value.background=e?u:s}}),{immediate:!0}),_((()=>o?.value),(e=>{t.value&&e&&(t.value.backgroundBlurriness=e)}),{immediate:!0}),_((()=>n?.value),(async e=>{if(e&&e in D){const t="https://raw.githubusercontent.com/Tresjs/assets/main/textures/hdr/",r=D[e];try{k.value=await c(p,r,(e=>{t&&e.setPath(t)}))}catch(a){throw new Error(`Failed to load environment map: ${a}`)}k.value&&k.value&&(k.value.mapping=s),l()}else if(e&&!(e in D))throw new Error(`Preset must be one of: ${Object.keys(D).join(", ")}`)}),{immediate:!0}),k}(P,H))),t=await t,k(),t),U=e=>{e?(T.value.environment=e.texture,P.background&&(T.value.background=e.texture)):(T.value.environment=R.value,P.background&&(T.value.background=R.value))};_(R,(e=>{H.value&&U(H.value)}),{immediate:!0,deep:!0}),M({EnvSence:B});const W=()=>{H.value?.dispose(),H.value=new n(P.resolution),J=new o(P.near,P.far,H.value),P.useDefaultScene?(H.value.texture.type=i,H.value.texture.generateMipmaps=!1,H.value.texture.minFilter=d,H.value.texture.magFilter=d):H.value.texture.type=l,U(H.value)};return _((()=>F().default),(e=>{e&&(!H.value||H.value.texture.type!==l)&&(C=e(),Array.isArray(C)&&C.length>0&&"symbol"!=typeof C[0]?.type)?W():(H.value?.dispose(),H.value=null,U(null))}),{immediate:!0,deep:!0}),$.value=R,_((()=>P.useDefaultScene),(e=>{H.value&&W()})),(e,a)=>g(H)?(x(),S("TresEnvSence",{key:0,ref_key:"envSence",ref:L},[j(e.$slots,"default")],512)):E("",!0)}});export{P as _};
