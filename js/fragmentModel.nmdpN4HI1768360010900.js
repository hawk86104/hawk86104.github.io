import{importShared as e,mergeGeometries as o}from"./3d-tiles-renderer.CvhCoabY1768360010900.js";import{useLoop as t,OrbitControls_default as n}from"./index.CsTVQ09Z1768360010900.js";import{useTexture as a}from"./customShaderMaterial.vue_vue_type_script_setup_true_lang.DRa1gKCP1768360010900.js";import"./index.vue_vue_type_script_setup_true_lang.Bmv2kfnV1768360010900.js";import{useGLTF as r}from"./index.DrYw1pc-1768360010900.js";import{Pane as i}from"./tweakpane.BbuIEN141768360010900.js";const{withAsyncContext:s,defineComponent:l}=await e("vue"),{unref:c,normalizeProps:m,guardReactiveProps:u,createElementVNode:v,openBlock:p,createElementBlock:d}=await e("vue"),f=["geometry"],{reactive:x,ref:g,watch:y}=await e("vue"),w=await e("three"),b=l({__name:"fragmentModelCom",async setup(e){let n,l;const b=e=>{const t=[];return e.traverse(e=>{e instanceof w.Mesh&&(e.geometry.deleteAttribute("uv"),e.geometry.deleteAttribute("tangent"),t.push(e.geometry))}),o(t)},C=b(([n,l]=s(()=>r("https://opensource.cdn.icegl.cn/model/eCommerce/guanYu.glb")),n=await n,l(),n).scene.children[0]);C.rotateX(Math.PI/2),C.translate(0,-.9,0);const _=C.clone().toNonIndexed(),P=b(([n,l]=s(()=>r("https://opensource.cdn.icegl.cn/model/industry4/modelDraco.glb")),n=await n,l(),n).scene.children[0]);P.rotateX(-Math.PI/2),P.rotateY(Math.PI/3);const h=P.clone().toNonIndexed(),z=_.attributes.position.array,A=_.attributes.position.count,M=h.attributes.position.array,B=h.attributes.normal.array,N=h.attributes.position.count,V=new Float32Array(A),D=new Float32Array(3*(A+2)),R=new Float32Array(3*(A+2)),S=new Float32Array(3*(A+2));for(let o=0;o<A;o+=3){const e=1*Math.random(),t=o%N;V[o]=e,V[o+1]=e,V[o+2]=e;const n=3*o,a=z[n],r=z[n+1],i=z[n+2],s=z[n+3],l=z[n+4],c=z[n+5],m=z[n+6],u=z[n+7],v=z[n+8],p=new w.Vector3(a+s+m,r+l+u,i+c+v).divideScalar(3);D.set([p.x,p.y,p.z],3*o),D.set([p.x,p.y,p.z],3*(o+1)),D.set([p.x,p.y,p.z],3*(o+2));const d=(e,o,t)=>{const n=3*t;for(let a=0;a<3;a++){const r=n+3*a;o.set([e[r],e[r+1],e[r+2]],3*(t+a))}};d(M,R,t),d(B,S,t)}_.setAttribute("aRandom",new w.BufferAttribute(V,1)),_.setAttribute("aCenter",new w.BufferAttribute(D,3)),_.setAttribute("toPosition",new w.BufferAttribute(R,3)),_.setAttribute("toNormal",new w.BufferAttribute(S,3)),console.log(_.attributes);const j=([n,l]=s(()=>a("./plugins/visualArts/image/fragment512px.png")),n=await n,l(),n),I={uniforms:{u_progress:{value:-.1},matcap1:{value:j},m1Color:{type:"v3",value:new w.Color("#ffc0fa")},matcap2:{value:j},m2Color:{type:"v3",value:new w.Color("#bcd4ff")}},vertexShader:"varying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\n\nattribute vec3 aCenter;\nattribute vec3 toPosition;\nattribute vec3 toNormal;\nattribute float aRandom;\n\nuniform float u_progress;\n\n#include <common>\n\nmat4 rotation3d(vec3 axis, float angle) {\n  axis = normalize(axis);\n  float s = sin(angle);\n  float c = cos(angle);\n  float oc = 1.0 - c;\n\n  return mat4(\n      oc * axis.x * axis.x + c, oc * axis.x * axis.y - axis.z * s,\n      oc * axis.z * axis.x + axis.y * s, 0.0, oc * axis.x * axis.y + axis.z * s,\n      oc * axis.y * axis.y + c, oc * axis.y * axis.z - axis.x * s, 0.0,\n      oc * axis.z * axis.x - axis.y * s, oc * axis.y * axis.z + axis.x * s,\n      oc * axis.z * axis.z + c, 0.0, 0.0, 0.0, 0.0, 1.0);\n}\n\nvoid main() {\n  vUv = uv;\n\n  float progress = u_progress;\n  float sinProgress = sin(progress * PI);\n\n  vec3 pos = mix(position, toPosition, progress);\n  vec3 nor = mix(normal, toNormal, progress);\n\n  vNormal = normalMatrix * normalize(nor);\n\n  float prog = ((pos.y + 1.) / 2.) * 1.1;\n\n  float locprog = clamp((sinProgress - 0.9 * prog) / 0.2, 0., 1.);\n\n  vec3 transform = pos - aCenter;\n\n  transform += 3. * aRandom * nor * locprog;\n\n  transform *= (1.0 - locprog);\n\n  transform += aCenter;\n\n  mat4 rotation = rotation3d(vec3(0., 1., 0.), aRandom * (locprog)*PI * 3.);\n\n  transform = (rotation * vec4(transform, 1.)).xyz;\n\n  vec4 modelViewPosition = modelViewMatrix * vec4(transform, 1.0);\n\n  gl_Position = projectionMatrix * modelViewPosition;\n\n  vViewPosition = -modelViewPosition.xyz;\n}",fragmentShader:"varying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vViewPosition;\nuniform sampler2D matcap;\nuniform sampler2D matcap2;\nuniform float u_progress;\nuniform vec3 m1Color;\nuniform vec3 m2Color;\n\nvoid main() {\n  vec3 viewDir = normalize(vViewPosition);\n  vec3 x = normalize(vec3(viewDir.z, 0.0, -viewDir.x));\n  vec3 y = cross(viewDir, x);\n  vec2 uv = vec2(dot(x, vNormal), dot(y, vNormal)) * 0.495 + 0.5;\n\n  float progress = abs(sin(u_progress));\n\n  vec3 matcapColor = texture2D(matcap, uv).rgb;\n  matcapColor = mix(matcapColor, m1Color, 0.5);\n  vec3 matcap2Color = texture2D(matcap2, uv).rgb;\n  matcap2Color = mix(matcap2Color, m2Color, 0.5);\n\n  vec3 color = vec3(matcapColor);\n  color = mix(color, matcap2Color, progress);\n\n  gl_FragColor = vec4(color, 1.0);\n}"},F=x({c1:"#ffc0fa",c2:"#bcd4ff"}),T=g(.5),k=new i({title:"参数"});return k.addBinding(I.uniforms.u_progress,"value",{label:"变化量",min:-.1,max:1,step:.001}).disabled=!0,k.addBinding(F,"c1",{label:"颜色1st"}),k.addBinding(F,"c2",{label:"颜色2rd"}),k.addBinding(T,"value",{label:"速度",min:.001,max:1,step:.001}),y(F,e=>{I.uniforms.m1Color.value.set(e.c1),I.uniforms.m2Color.value.set(e.c2)},{deep:!0}),t().onBeforeRender(({elapsed:e})=>{I.uniforms.u_progress.value=(Math.sin(e*T.value)+1)/2,k.refresh()}),(e,o)=>(p(),d("TresMesh",{geometry:c(_)},[v("TresShaderMaterial",m(u(I)),null,16)],8,f))}}),{defineComponent:C}=await e("vue"),{createElementVNode:_,unref:P,normalizeProps:h,guardReactiveProps:z,createVNode:A,Suspense:M,withCtx:B,openBlock:N,createBlock:V,resolveComponent:D}=await e("vue"),R=await e("three"),{reactive:S}=await e("vue"),j=C({__name:"fragmentModel",setup(e){const o=S({enableDamping:!0,enableZoom:!0,autoRotate:!0,enablePan:!0,enableRotate:!0}),t={clearColor:"#000000",windowSize:!0,toneMapping:R.ACESFilmicToneMapping,toneMappingExposure:.8};return(e,a)=>{const r=D("TresCanvas");return N(),V(r,h(z(t)),{default:B(()=>[a[0]||(a[0]=_("TresPerspectiveCamera",{position:[0,2,8],fov:45,near:.1,far:1e3},null,-1)),A(P(n),h(z(o)),null,16),a[1]||(a[1]=_("TresAmbientLight",{intensity:2},null,-1)),(N(),V(M,null,{default:B(()=>[A(b)]),_:1}))]),_:1},16)}}});export{j as default};
