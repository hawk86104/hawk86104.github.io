import{importShared as e}from"./3d-tiles-renderer.COLnOnaF1767661981680.js";import{useAnimations as t,Levioso_default as a,ContactShadows_default as o,OrbitControls_default as l}from"./index.DJAV0vsW1767661981680.js";import{MqttClientWrapper as n}from"./mqttTvt.CJKnO3P-1767661981680.js";import{useMessage as r,NMessageProvider as i}from"./use-message.Cb7s1AXd1767661981680.js";import{NCard as u}from"./Card.CTaiiHiB1767661981680.js";import{NFormItem as s}from"./FormItem.CZx6PxPr1767661981680.js";import{NTag as c}from"./Tag.BcfcsUdr1767661981680.js";import{NDivider as m,NLog as d}from"./Log.B1yWLEvk1767661981680.js";import{NInput as p}from"./Input.sEi667qX1767661981680.js";import{NSwitch as v}from"./Switch.B30dUSNi1767661981680.js";import"./customShaderMaterial.vue_vue_type_script_setup_true_lang.DgUcrDxr1767661981680.js";import"./index.vue_vue_type_script_setup_true_lang.BX1FIS001767661981680.js";import{useGLTF as f}from"./index.D1qpHi0h1767661981680.js";const{defineComponent:_}=await e("vue"),{createElementVNode:g,createTextVNode:b,unref:h,withCtx:w,createVNode:y,openBlock:j,createElementBlock:T}=await e("vue"),S={class:"w-100 absolute z-99999 mqttdebugger",style:{"margin-top":"40px"}},{ref:x,onUnmounted:O,onMounted:k,watch:C,inject:M}=await e("vue"),B=_({__name:"widthMqtt",setup(e){const t=r(),a=x(!1),o=x(!1),l={host:"a5183db3.ala.asia-southeast1.emqxsl.com",port:8084,protocol:"wss",clientId:`tvt-test-client-${Math.random().toString(16).slice(2,8)}`,username:"tvt.js",password:"test",topic:"tvtDevices/#"},i=x(null),f=x(!1),_=x([]);function B(){i.value&&N(),i.value=new n(l),i.value.on("connected",()=>{f.value=!0,console.log("MQTT 连接成功"),function(){if(!i.value)return;i.value.subscribe(l.topic,e=>{e?console.error(`订阅失败: ${e.message}`):console.log(`已订阅主题: ${l.topic}`)})}()}),i.value.on("close",()=>{f.value=!1,console.log("MQTT 连接关闭")}),i.value.on("error",e=>{console.error(`MQTT 错误: ${e.message}`)}),i.value.on("message",(e,l)=>{_.value.push(`[${e}] ${JSON.stringify(l)}`),_.value.length>100&&_.value.shift(),!o.value&&l&&l.status&&(a.value="运行"===l.status),l&&l.detail&&t.info("mqtt["+l.deviceId+"] 设备详情："+l.detail+"程序已运行："+l.uptime,{keepAliveOnHover:!0,duration:18e3})}),i.value.connect()}function N(){i.value&&(i.value.removeAllListeners(),i.value.disconnect(),i.value=null,f.value=!1)}k(()=>{B()}),O(()=>{i.value,N()});let A=null;function q(e){o.value=!0;const t={deviceId:"tvtDevice001",status:e?"运行":"关闭"};i.value.publish("tvtDevices/tvtDevice001/control",t),clearTimeout(A),A=setTimeout(()=>{o.value=!1},1e3)}const F=M("animationPlay");return C(()=>a.value,e=>{F.value=e},{immediate:!0}),(e,t)=>(j(),T("div",S,[y(h(u),{title:"MQTT 调试面板",style:{"background-color":"#d6d0c540"}},{default:w(()=>[y(h(s),{label:"注意："},{default:w(()=>[y(h(c),{style:{padding:"30px 21px","line-height":"21px"},type:"warning"},{default:w(()=>[...t[1]||(t[1]=[b("免费服务每月流量/次数有限",-1),g("br",null,null,-1),b("若连接失败请自行更换自己的mqtt服务",-1)])]),_:1})]),_:1}),y(h(m),{style:{"margin-top":"-10px"}},{default:w(()=>[...t[2]||(t[2]=[b("mqtt配置信息",-1)])]),_:1}),y(h(p),{value:JSON.stringify(l,null,2),type:"textarea",rows:9,disabled:""},null,8,["value"]),y(h(m),null,{default:w(()=>[...t[3]||(t[3]=[b("连接状态",-1)])]),_:1}),y(h(s),{label:"mqtt代理通路"},{default:w(()=>[y(h(v),{value:f.value},{checked:w(()=>[...t[4]||(t[4]=[b(" 已连接 ",-1)])]),unchecked:w(()=>[...t[5]||(t[5]=[b(" 连接中 ",-1)])]),_:1},8,["value"])]),_:1}),y(h(s),{label:"订阅主题"},{default:w(()=>[y(h(p),{value:l.topic,disabled:""},null,8,["value"])]),_:1}),y(h(m),null,{default:w(()=>[...t[6]||(t[6]=[b("信息日志列表",-1)])]),_:1}),y(h(d),{log:_.value.join("\n"),rows:12},null,8,["log"]),y(h(m),null,{default:w(()=>[...t[7]||(t[7]=[b("通过mqtt交互状态",-1)])]),_:1}),t[8]||(t[8]=b(" 开关电风扇 : ",-1)),y(h(v),{loading:o.value,round:!1,value:a.value,"onUpdate:value":[t[0]||(t[0]=e=>a.value=e),q]},null,8,["loading","value"])]),_:1})]))}}),{withAsyncContext:N,defineComponent:A}=await e("vue"),{unref:q,createElementVNode:F,withCtx:P,createVNode:I,Fragment:V,openBlock:D,createElementBlock:E}=await e("vue"),$=["object"],{watch:L,inject:z,toRaw:Q}=await e("vue"),R=A({__name:"efanModel",props:{color:{type:String,required:!0}},async setup(e){let l,n;const r=e,{nodes:i,animations:u}=([l,n]=N(()=>f("https://opensource.cdn.icegl.cn/model/eCommerce/eFan/nFan.gltf")),l=await l,n(),l),s=e=>i.Sketchfab_model.getObjectByName(e).geometry.attributes.uv.array,c={Object_4:new Float32Array(s("Object_4")),Object_8:new Float32Array(s("Object_8")),Object_6:new Float32Array(s("Object_6")),Object_6001:new Float32Array(s("Object_6001"))},m=i.Sketchfab_model.getObjectByName("Object_6001"),{actions:d}=t(u,i.Sketchfab_model),p=d.Animation,v=z("animationPlay");return L(()=>r.color,e=>{(e=>{const t={"#ff8b04":0,"#999999":.04,"#d3ac10":.19,"#ffbec4":-.06,"#d0d5c6":.55};for(const[a,o]of Object.entries(c)){for(let l=0;l<s(a).length;l++)s(a)[l]=o[l]+t[e];i.Sketchfab_model.getObjectByName(a).geometry.getAttribute("uv").needsUpdate=!0}})(e)},{immediate:!0}),L(()=>v.value,e=>{e?(p.reset().play(),m?.rotateY(-Math.PI)):(p.fadeOut(.6).paused=!0,m?.rotateY(Math.PI))},{immediate:!0}),(e,t)=>(D(),E(V,null,[I(q(a),{range:[-.5,-.5],speed:2},{default:P(()=>[F("primitive",{position:[-2,0,0],object:Q(q(i).Sketchfab_model),scale:3},null,8,$)]),_:1}),I(q(o),{opacity:.3,blur:2.6,position:[0,-2,0]})],64))}}),{defineComponent:U}=await e("vue"),{createElementVNode:J,unref:Y,createVNode:G,Suspense:H,withCtx:K,openBlock:W,createBlock:X,resolveComponent:Z,normalizeProps:ee,guardReactiveProps:te,Fragment:ae,createElementBlock:oe}=await e("vue"),{ref:le,provide:ne}=await e("vue"),{BasicShadowMap:re,SRGBColorSpace:ie}=await e("three"),ue=U({__name:"withModel",setup(e){const t={shadows:!0,alpha:!0,shadowMapType:re,outputColorSpace:ie,windowSize:!0,clearColor:"#ffffff"},a=le(!1);return ne("animationPlay",a),(e,a)=>{const o=Z("TresCanvas");return W(),oe(ae,null,[G(o,ee(te(t)),{default:K(()=>[a[0]||(a[0]=J("TresPerspectiveCamera",{position:[10,5,-8],fov:45,near:.1,far:1e5},null,-1)),G(Y(l),{enableDamping:""}),(W(),X(H,null,{default:K(()=>[G(R,{color:"#ff8b04"})]),_:1})),a[1]||(a[1]=J("TresAmbientLight",{intensity:2},null,-1)),a[2]||(a[2]=J("TresPointLight",{position:[0,0,10],intensity:1},null,-1)),a[3]||(a[3]=J("TresDirectionalLight",{position:[3,3,3],intensity:3},null,-1))]),_:1},16),G(Y(i),null,{default:K(()=>[G(B)]),_:1})],64)}}});export{ue as default};
