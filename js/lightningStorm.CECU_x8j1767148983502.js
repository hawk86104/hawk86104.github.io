import{importShared as y}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{_sfc_main as v}from"./pagesShow.vue_vue_type_script_setup_true_lang.Crq63Xp41767148983502.js";import{_l as F}from"./index.DTe2qqjO1767148983502.js";import{createNoise4D as P}from"./simplex-noise.DV0DHqK31767148983502.js";import"./reflectorDiffuse.vue_vue_type_script_setup_true_lang.Cxj_Ip691767148983502.js";import"./reflectorDUDV.vue_vue_type_script_setup_true_lang.DYMkkQ781767148983502.js";import"./reflectorShaderMesh.vue_vue_type_script_setup_true_lang.T7UkXoyg1767148983502.js";import"./dynamicRotatingBase.vue_vue_type_script_setup_true_lang.BVQWYa0i1767148983502.js";import"./whiteFloorMesh.vue_vue_type_script_setup_true_lang.BCd7Uxt-1767148983502.js";import{_sfc_main as A}from"./gridPlusCom.vue_vue_type_script_setup_true_lang.x_N2tft71767148983502.js";import"./videoFloor.vue_vue_type_script_setup_true_lang.Xg1Eqw4f1767148983502.js";import"./digitalGround.vue_vue_type_script_setup_true_lang.DBVFezcY1767148983502.js";import"./imgFloor.vue_vue_type_script_setup_true_lang.BPVumalx1767148983502.js";import"./reflectorRoundedBox.vue_vue_type_script_setup_true_lang.BOdU7iQo1767148983502.js";import"./particleBase.vue_vue_type_script_setup_true_lang.CIf_5jma1767148983502.js";import"./rippleFloor.vue_vue_type_script_setup_true_lang.BmWDhTNl1767148983502.js";import{It as G,Kt as U}from"./tresleches.BdwDbeJP1767148983502.js";const{BufferGeometry:H,DynamicDrawUsage:C,Float32BufferAttribute:R,MathUtils:I,Uint32BufferAttribute:_,Vector3:c}=await y("three");class h extends H{constructor(i={}){super(),this.isLightningStrike=!0,this.type="LightningStrike",this.init(h.copyParameters(i,i)),this.createMesh()}static createRandomGenerator(){const t=[];for(let e=0;e<2053;e++)t.push(Math.random());const o={currentSeed:0,random:function(){const e=t[o.currentSeed];return o.currentSeed=(o.currentSeed+1)%2053,e},getSeed:function(){return o.currentSeed/2053},setSeed:function(e){o.currentSeed=Math.floor(e*2053)%2053}};return o}static copyParameters(i={},t={}){const o=function(e){return t===i?e:e.clone()};return i.sourceOffset=t.sourceOffset!==void 0?o(t.sourceOffset):new c(0,100,0),i.destOffset=t.destOffset!==void 0?o(t.destOffset):new c(0,0,0),i.timeScale=t.timeScale!==void 0?t.timeScale:1,i.roughness=t.roughness!==void 0?t.roughness:.9,i.straightness=t.straightness!==void 0?t.straightness:.7,i.up0=t.up0!==void 0?o(t.up0):new c(0,0,1),i.up1=t.up1!==void 0?o(t.up1):new c(0,0,1),i.radius0=t.radius0!==void 0?t.radius0:1,i.radius1=t.radius1!==void 0?t.radius1:1,i.radius0Factor=t.radius0Factor!==void 0?t.radius0Factor:.5,i.radius1Factor=t.radius1Factor!==void 0?t.radius1Factor:.2,i.minRadius=t.minRadius!==void 0?t.minRadius:.2,i.isEternal=t.isEternal!==void 0?t.isEternal:t.birthTime===void 0||t.deathTime===void 0,i.birthTime=t.birthTime,i.deathTime=t.deathTime,i.propagationTimeFactor=t.propagationTimeFactor!==void 0?t.propagationTimeFactor:.1,i.vanishingTimeFactor=t.vanishingTimeFactor!==void 0?t.vanishingTimeFactor:.9,i.subrayPeriod=t.subrayPeriod!==void 0?t.subrayPeriod:4,i.subrayDutyCycle=t.subrayDutyCycle!==void 0?t.subrayDutyCycle:.6,i.maxIterations=t.maxIterations!==void 0?t.maxIterations:9,i.isStatic=t.isStatic!==void 0?t.isStatic:!1,i.ramification=t.ramification!==void 0?t.ramification:5,i.maxSubrayRecursion=t.maxSubrayRecursion!==void 0?t.maxSubrayRecursion:3,i.recursionProbability=t.recursionProbability!==void 0?t.recursionProbability:.6,i.generateUVs=t.generateUVs!==void 0?t.generateUVs:!1,i.randomGenerator=t.randomGenerator,i.noiseSeed=t.noiseSeed,i.onDecideSubrayCreation=t.onDecideSubrayCreation,i.onSubrayCreation=t.onSubrayCreation,i}update(i){this.isStatic||(this.rayParameters.isEternal||this.rayParameters.birthTime<=i&&i<=this.rayParameters.deathTime?(this.updateMesh(i),i<this.subrays[0].endPropagationTime?this.state=h.RAY_PROPAGATING:i>this.subrays[0].beginVanishingTime?this.state=h.RAY_VANISHING:this.state=h.RAY_STEADY,this.visible=!0):(this.visible=!1,i<this.rayParameters.birthTime?this.state=h.RAY_UNBORN:this.state=h.RAY_EXTINGUISHED))}init(i){this.rayParameters=i,this.maxIterations=i.maxIterations!==void 0?Math.floor(i.maxIterations):9,i.maxIterations=this.maxIterations,this.isStatic=i.isStatic!==void 0?i.isStatic:!1,i.isStatic=this.isStatic,this.ramification=i.ramification!==void 0?Math.floor(i.ramification):5,i.ramification=this.ramification,this.maxSubrayRecursion=i.maxSubrayRecursion!==void 0?Math.floor(i.maxSubrayRecursion):3,i.maxSubrayRecursion=this.maxSubrayRecursion,this.recursionProbability=i.recursionProbability!==void 0?i.recursionProbability:.6,i.recursionProbability=this.recursionProbability,this.generateUVs=i.generateUVs!==void 0?i.generateUVs:!1,i.generateUVs=this.generateUVs,i.randomGenerator!==void 0?(this.randomGenerator=i.randomGenerator,this.seedGenerator=i.randomGenerator,i.noiseSeed!==void 0&&this.seedGenerator.setSeed(i.noiseSeed)):(this.randomGenerator=h.createRandomGenerator(),this.seedGenerator=Math),i.onDecideSubrayCreation!==void 0?this.onDecideSubrayCreation=i.onDecideSubrayCreation:(this.createDefaultSubrayCreationCallbacks(),i.onSubrayCreation!==void 0&&(this.onSubrayCreation=i.onSubrayCreation)),this.state=h.RAY_INITIALIZED,this.maxSubrays=Math.ceil(1+Math.pow(this.ramification,Math.max(0,this.maxSubrayRecursion-1))),i.maxSubrays=this.maxSubrays,this.maxRaySegments=2*(1<<this.maxIterations),this.subrays=[];for(let t=0;t<this.maxSubrays;t++)this.subrays.push(this.createSubray());this.raySegments=[];for(let t=0;t<this.maxRaySegments;t++)this.raySegments.push(this.createSegment());this.time=0,this.timeFraction=0,this.currentSegmentCallback=null,this.currentCreateTriangleVertices=this.generateUVs?this.createTriangleVerticesWithUVs:this.createTriangleVerticesWithoutUVs,this.numSubrays=0,this.currentSubray=null,this.currentSegmentIndex=0,this.isInitialSegment=!1,this.subrayProbability=0,this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.vertices=null,this.uvs=null,this.indices=null,this.positionAttribute=null,this.uvsAttribute=null,this.simplexX=P(this.seedGenerator.random),this.simplexY=P(this.seedGenerator.random),this.simplexZ=P(this.seedGenerator.random),this.forwards=new c,this.forwardsFill=new c,this.side=new c,this.down=new c,this.middlePos=new c,this.middleLinPos=new c,this.newPos=new c,this.vPos=new c,this.cross1=new c}createMesh(){const i=1<<this.maxIterations,t=3*(i+1)*this.maxSubrays,o=18*i*this.maxSubrays;this.vertices=new Float32Array(t*3),this.indices=new Uint32Array(o),this.generateUVs&&(this.uvs=new Float32Array(t*2)),this.fillMesh(0),this.setIndex(new _(this.indices,1)),this.positionAttribute=new R(this.vertices,3),this.setAttribute("position",this.positionAttribute),this.generateUVs&&(this.uvsAttribute=new R(new Float32Array(this.uvs),2),this.setAttribute("uv",this.uvsAttribute)),this.isStatic||(this.index.usage=C,this.positionAttribute.usage=C,this.generateUVs&&(this.uvsAttribute.usage=C)),this.vertices=this.positionAttribute.array,this.indices=this.index.array,this.generateUVs&&(this.uvs=this.uvsAttribute.array)}updateMesh(i){this.fillMesh(i),this.drawRange.count=this.currentIndex,this.index.needsUpdate=!0,this.positionAttribute.needsUpdate=!0,this.generateUVs&&(this.uvsAttribute.needsUpdate=!0)}fillMesh(i){const t=this;this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.fractalRay(i,function(e){const a=t.currentSubray;i<a.birthTime||(this.rayParameters.isEternal&&t.currentSubray.recursion==0?(t.createPrism(e),t.onDecideSubrayCreation(e,t)):i<a.endPropagationTime?t.timeFraction>=e.fraction0*a.propagationTimeFactor&&(t.createPrism(e),t.onDecideSubrayCreation(e,t)):i<a.beginVanishingTime?(t.createPrism(e),t.onDecideSubrayCreation(e,t)):(t.timeFraction<=a.vanishingTimeFactor+e.fraction1*(1-a.vanishingTimeFactor)&&t.createPrism(e),t.onDecideSubrayCreation(e,t)))})}addNewSubray(){return this.subrays[this.numSubrays++]}initSubray(i,t){i.pos0.copy(t.sourceOffset),i.pos1.copy(t.destOffset),i.up0.copy(t.up0),i.up1.copy(t.up1),i.radius0=t.radius0,i.radius1=t.radius1,i.birthTime=t.birthTime,i.deathTime=t.deathTime,i.timeScale=t.timeScale,i.roughness=t.roughness,i.straightness=t.straightness,i.propagationTimeFactor=t.propagationTimeFactor,i.vanishingTimeFactor=t.vanishingTimeFactor,i.maxIterations=this.maxIterations,i.seed=t.noiseSeed!==void 0?t.noiseSeed:0,i.recursion=0}fractalRay(i,t){this.time=i,this.currentSegmentCallback=t,this.numSubrays=0,this.initSubray(this.addNewSubray(),this.rayParameters);for(let o=0;o<this.numSubrays;o++){const e=this.subrays[o];this.currentSubray=e,this.randomGenerator.setSeed(e.seed),e.endPropagationTime=I.lerp(e.birthTime,e.deathTime,e.propagationTimeFactor),e.beginVanishingTime=I.lerp(e.deathTime,e.birthTime,1-e.vanishingTimeFactor);const a=this.randomGenerator.random;e.linPos0.set(a(),a(),a()).multiplyScalar(1e3),e.linPos1.set(a(),a(),a()).multiplyScalar(1e3),this.timeFraction=(i-e.birthTime)/(e.deathTime-e.birthTime),this.currentSegmentIndex=0,this.isInitialSegment=!0;const n=this.getNewSegment();n.iteration=0,n.pos0.copy(e.pos0),n.pos1.copy(e.pos1),n.linPos0.copy(e.linPos0),n.linPos1.copy(e.linPos1),n.up0.copy(e.up0),n.up1.copy(e.up1),n.radius0=e.radius0,n.radius1=e.radius1,n.fraction0=0,n.fraction1=1,n.positionVariationFactor=1-e.straightness,this.subrayProbability=this.ramification*Math.pow(this.recursionProbability,e.recursion)/(1<<e.maxIterations),this.fractalRayRecursive(n)}this.currentSegmentCallback=null,this.currentSubray=null}fractalRayRecursive(i){if(i.iteration>=this.currentSubray.maxIterations){this.currentSegmentCallback(i);return}this.forwards.subVectors(i.pos1,i.pos0);let t=this.forwards.length();t<1e-6&&(this.forwards.set(0,0,.01),t=this.forwards.length());const o=(i.radius0+i.radius1)*.5,e=(i.fraction0+i.fraction1)*.5,a=this.time*this.currentSubray.timeScale*Math.pow(2,i.iteration);this.middlePos.lerpVectors(i.pos0,i.pos1,.5),this.middleLinPos.lerpVectors(i.linPos0,i.linPos1,.5);const n=this.middleLinPos;this.newPos.set(this.simplexX(n.x,n.y,n.z,a),this.simplexY(n.x,n.y,n.z,a),this.simplexZ(n.x,n.y,n.z,a)),this.newPos.multiplyScalar(i.positionVariationFactor*t),this.newPos.add(this.middlePos);const s=this.getNewSegment();s.pos0.copy(i.pos0),s.pos1.copy(this.newPos),s.linPos0.copy(i.linPos0),s.linPos1.copy(this.middleLinPos),s.up0.copy(i.up0),s.up1.copy(i.up1),s.radius0=i.radius0,s.radius1=o,s.fraction0=i.fraction0,s.fraction1=e,s.positionVariationFactor=i.positionVariationFactor*this.currentSubray.roughness,s.iteration=i.iteration+1;const r=this.getNewSegment();r.pos0.copy(this.newPos),r.pos1.copy(i.pos1),r.linPos0.copy(this.middleLinPos),r.linPos1.copy(i.linPos1),this.cross1.crossVectors(i.up0,this.forwards.normalize()),r.up0.crossVectors(this.forwards,this.cross1).normalize(),r.up1.copy(i.up1),r.radius0=o,r.radius1=i.radius1,r.fraction0=e,r.fraction1=i.fraction1,r.positionVariationFactor=i.positionVariationFactor*this.currentSubray.roughness,r.iteration=i.iteration+1,this.fractalRayRecursive(s),this.fractalRayRecursive(r)}createPrism(i){this.forwardsFill.subVectors(i.pos1,i.pos0).normalize(),this.isInitialSegment&&(this.currentCreateTriangleVertices(i.pos0,i.up0,this.forwardsFill,i.radius0,0),this.isInitialSegment=!1),this.currentCreateTriangleVertices(i.pos1,i.up0,this.forwardsFill,i.radius1,i.fraction1),this.createPrismFaces()}createTriangleVerticesWithoutUVs(i,t,o,e){this.side.crossVectors(t,o).multiplyScalar(e*h.COS30DEG),this.down.copy(t).multiplyScalar(-e*h.SIN30DEG);const a=this.vPos,n=this.vertices;a.copy(i).sub(this.side).add(this.down),n[this.currentCoordinate++]=a.x,n[this.currentCoordinate++]=a.y,n[this.currentCoordinate++]=a.z,a.copy(i).add(this.side).add(this.down),n[this.currentCoordinate++]=a.x,n[this.currentCoordinate++]=a.y,n[this.currentCoordinate++]=a.z,a.copy(t).multiplyScalar(e).add(i),n[this.currentCoordinate++]=a.x,n[this.currentCoordinate++]=a.y,n[this.currentCoordinate++]=a.z,this.currentVertex+=3}createTriangleVerticesWithUVs(i,t,o,e,a){this.side.crossVectors(t,o).multiplyScalar(e*h.COS30DEG),this.down.copy(t).multiplyScalar(-e*h.SIN30DEG);const n=this.vPos,s=this.vertices,r=this.uvs;n.copy(i).sub(this.side).add(this.down),s[this.currentCoordinate++]=n.x,s[this.currentCoordinate++]=n.y,s[this.currentCoordinate++]=n.z,r[this.currentUVCoordinate++]=a,r[this.currentUVCoordinate++]=0,n.copy(i).add(this.side).add(this.down),s[this.currentCoordinate++]=n.x,s[this.currentCoordinate++]=n.y,s[this.currentCoordinate++]=n.z,r[this.currentUVCoordinate++]=a,r[this.currentUVCoordinate++]=.5,n.copy(t).multiplyScalar(e).add(i),s[this.currentCoordinate++]=n.x,s[this.currentCoordinate++]=n.y,s[this.currentCoordinate++]=n.z,r[this.currentUVCoordinate++]=a,r[this.currentUVCoordinate++]=1,this.currentVertex+=3}createPrismFaces(i){const t=this.indices;i=this.currentVertex-6,t[this.currentIndex++]=i+1,t[this.currentIndex++]=i+2,t[this.currentIndex++]=i+5,t[this.currentIndex++]=i+1,t[this.currentIndex++]=i+5,t[this.currentIndex++]=i+4,t[this.currentIndex++]=i+0,t[this.currentIndex++]=i+1,t[this.currentIndex++]=i+4,t[this.currentIndex++]=i+0,t[this.currentIndex++]=i+4,t[this.currentIndex++]=i+3,t[this.currentIndex++]=i+2,t[this.currentIndex++]=i+0,t[this.currentIndex++]=i+3,t[this.currentIndex++]=i+2,t[this.currentIndex++]=i+3,t[this.currentIndex++]=i+5}createDefaultSubrayCreationCallbacks(){const i=this.randomGenerator.random;this.onDecideSubrayCreation=function(n,s){const r=s.currentSubray,d=s.rayParameters.subrayPeriod,f=s.rayParameters.subrayDutyCycle,l=s.rayParameters.isEternal&&r.recursion==0?-i()*d:I.lerp(r.birthTime,r.endPropagationTime,n.fraction0)-i()*d,g=s.time-l,m=Math.floor(g/d),b=i()*(m+1),S=g%d<=f*d;let w=0;if(S&&(w=s.subrayProbability),r.recursion<s.maxSubrayRecursion&&s.numSubrays<s.maxSubrays&&i()<w){const u=s.addNewSubray(),D=s.randomGenerator.getSeed();u.seed=b,s.randomGenerator.setSeed(b),u.recursion=r.recursion+1,u.maxIterations=Math.max(1,r.maxIterations-1),u.linPos0.set(i(),i(),i()).multiplyScalar(1e3),u.linPos1.set(i(),i(),i()).multiplyScalar(1e3),u.up0.copy(r.up0),u.up1.copy(r.up1),u.radius0=n.radius0*s.rayParameters.radius0Factor,u.radius1=Math.min(s.rayParameters.minRadius,n.radius1*s.rayParameters.radius1Factor),u.birthTime=l+m*d,u.deathTime=u.birthTime+d*f,!s.rayParameters.isEternal&&r.recursion==0&&(u.birthTime=Math.max(u.birthTime,r.birthTime),u.deathTime=Math.min(u.deathTime,r.deathTime)),u.timeScale=r.timeScale*2,u.roughness=r.roughness,u.straightness=r.straightness,u.propagationTimeFactor=r.propagationTimeFactor,u.vanishingTimeFactor=r.vanishingTimeFactor,s.onSubrayCreation(n,r,u,s),s.randomGenerator.setSeed(D)}};const t=new c,o=new c,e=new c,a=new c;this.onSubrayCreation=function(n,s,r,d){d.subrayCylinderPosition(n,s,r,.5,.6,.2)},this.subrayConePosition=function(n,s,r,d,f,l){r.pos0.copy(n.pos0),t.subVectors(s.pos1,s.pos0),o.copy(t).normalize(),t.multiplyScalar(n.fraction0+(1-n.fraction0)*(i()*d));const g=t.length();e.crossVectors(s.up0,o);const m=2*Math.PI*i();e.multiplyScalar(Math.cos(m)),a.copy(s.up0).multiplyScalar(Math.sin(m)),r.pos1.copy(e).add(a).multiplyScalar(g*f*(l+i()*(1-l))).add(t).add(s.pos0)},this.subrayCylinderPosition=function(n,s,r,d,f,l){r.pos0.copy(n.pos0),t.subVectors(s.pos1,s.pos0),o.copy(t).normalize(),t.multiplyScalar(n.fraction0+(1-n.fraction0)*((2*i()-1)*d));const g=t.length();e.crossVectors(s.up0,o);const m=2*Math.PI*i();e.multiplyScalar(Math.cos(m)),a.copy(s.up0).multiplyScalar(Math.sin(m)),r.pos1.copy(e).add(a).multiplyScalar(g*f*(l+i()*(1-l))).add(t).add(s.pos0)}}createSubray(){return{seed:0,maxIterations:0,recursion:0,pos0:new c,pos1:new c,linPos0:new c,linPos1:new c,up0:new c,up1:new c,radius0:0,radius1:0,birthTime:0,deathTime:0,timeScale:0,roughness:0,straightness:0,propagationTimeFactor:0,vanishingTimeFactor:0,endPropagationTime:0,beginVanishingTime:0}}createSegment(){return{iteration:0,pos0:new c,pos1:new c,linPos0:new c,linPos1:new c,up0:new c,up1:new c,radius0:0,radius1:0,fraction0:0,fraction1:0,positionVariationFactor:0}}getNewSegment(){return this.raySegments[this.currentSegmentIndex++]}copy(i){return super.copy(i),this.init(h.copyParameters({},i.rayParameters)),this}clone(){return new this.constructor(h.copyParameters({},this.rayParameters))}}h.RAY_INITIALIZED=0;h.RAY_UNBORN=1;h.RAY_PROPAGATING=2;h.RAY_STEADY=3;h.RAY_VANISHING=4;h.RAY_EXTINGUISHED=5;h.COS30DEG=Math.cos(30*Math.PI/180);h.SIN30DEG=Math.sin(30*Math.PI/180);const{MathUtils:V,Mesh:N,MeshBasicMaterial:E,Object3D:z}=await y("three");class L extends z{constructor(i={}){super(),this.isLightningStorm=!0,this.stormParams=i,i.size=i.size!==void 0?i.size:1e3,i.minHeight=i.minHeight!==void 0?i.minHeight:80,i.maxHeight=i.maxHeight!==void 0?i.maxHeight:100,i.maxSlope=i.maxSlope!==void 0?i.maxSlope:1.1,i.maxLightnings=i.maxLightnings!==void 0?i.maxLightnings:3,i.lightningMinPeriod=i.lightningMinPeriod!==void 0?i.lightningMinPeriod:3,i.lightningMaxPeriod=i.lightningMaxPeriod!==void 0?i.lightningMaxPeriod:7,i.lightningMinDuration=i.lightningMinDuration!==void 0?i.lightningMinDuration:1,i.lightningMaxDuration=i.lightningMaxDuration!==void 0?i.lightningMaxDuration:2.5,this.lightningParameters=h.copyParameters(i.lightningParameters,i.lightningParameters),this.lightningParameters.isEternal=!1,this.lightningMaterial=i.lightningMaterial!==void 0?i.lightningMaterial:new E({color:11599871}),i.onRayPosition!==void 0?this.onRayPosition=i.onRayPosition:this.onRayPosition=function(t,o){o.set((Math.random()-.5)*i.size,0,(Math.random()-.5)*i.size);const e=V.lerp(i.minHeight,i.maxHeight,Math.random());t.set(i.maxSlope*(2*Math.random()-1),1,i.maxSlope*(2*Math.random()-1)).multiplyScalar(e).add(o)},this.onLightningDown=i.onLightningDown,this.inited=!1,this.nextLightningTime=0,this.lightningsMeshes=[],this.deadLightningsMeshes=[];for(let t=0;t<this.stormParams.maxLightnings;t++){const o=new h(h.copyParameters({},this.lightningParameters)),e=new N(o,this.lightningMaterial);this.deadLightningsMeshes.push(e)}}update(i){if(this.inited||(this.nextLightningTime=this.getNextLightningTime(i)*Math.random(),this.inited=!0),i>=this.nextLightningTime){const e=this.deadLightningsMeshes.pop();if(e){const a=h.copyParameters(e.geometry.rayParameters,this.lightningParameters);a.birthTime=i,a.deathTime=i+V.lerp(this.stormParams.lightningMinDuration,this.stormParams.lightningMaxDuration,Math.random()),this.onRayPosition(a.sourceOffset,a.destOffset),a.noiseSeed=Math.random(),this.add(e),this.lightningsMeshes.push(e)}this.nextLightningTime=this.getNextLightningTime(i)}let t=0,o=this.lightningsMeshes.length;for(;t<o;){const e=this.lightningsMeshes[t],a=e.geometry,n=a.state;a.update(i),n===h.RAY_PROPAGATING&&a.state>n&&this.onLightningDown&&this.onLightningDown(a),a.state===h.RAY_EXTINGUISHED?(this.lightningsMeshes.splice(this.lightningsMeshes.indexOf(e),1),this.deadLightningsMeshes.push(e),this.remove(e),o--):t++}}getNextLightningTime(i){return i+V.lerp(this.stormParams.lightningMinPeriod,this.stormParams.lightningMaxPeriod,Math.random())/(this.stormParams.maxLightnings+1)}copy(i,t){return super.copy(i,t),this.stormParams.size=i.stormParams.size,this.stormParams.minHeight=i.stormParams.minHeight,this.stormParams.maxHeight=i.stormParams.maxHeight,this.stormParams.maxSlope=i.stormParams.maxSlope,this.stormParams.maxLightnings=i.stormParams.maxLightnings,this.stormParams.lightningMinPeriod=i.stormParams.lightningMinPeriod,this.stormParams.lightningMaxPeriod=i.stormParams.lightningMaxPeriod,this.stormParams.lightningMinDuration=i.stormParams.lightningMinDuration,this.stormParams.lightningMaxDuration=i.stormParams.lightningMaxDuration,this.lightningParameters=h.copyParameters({},i.lightningParameters),this.lightningMaterial=i.stormParams.lightningMaterial,this.onLightningDown=i.onLightningDown,this}clone(){return new this.constructor(this.stormParams).copy(this)}}const{defineComponent:O}=await y("vue"),{unref:Y,openBlock:B,createElementBlock:$}=await y("vue"),X=["object"],x=await y("three"),{watchEffect:j}=await y("vue"),Z=O({__name:"lightStorm",props:{color:{default:"#b0ffff"},size:{default:2e3},minHeight:{default:100},maxHeight:{default:500},maxLightnings:{default:18},roughness:{default:.85},straightness:{default:.65},radius0:{default:1},radius1:{default:.5},timeScale:{default:.15},subrayPeriod:{default:4},subrayDutyCycle:{default:.6}},setup(M){const i=M,t=new x.Color(i.color),o=new x.MeshBasicMaterial({color:t}),e=new x.Vector3(0,-1,0);let a=0;const n=new x.Vector3,s=new x.Vector3,r={roughness:i.roughness,straightness:i.straightness,radius0:i.radius0,radius1:i.radius1,timeScale:i.timeScale,subrayPeriod:i.subrayPeriod,subrayDutyCycle:i.subrayDutyCycle,minRadius:.3,maxIterations:7,propagationTimeFactor:.2,vanishingTimeFactor:.9,maxSubrayRecursion:3,ramification:3,recursionProbability:.4,onSubrayCreation:function(l,g,m,b){b.subrayConePosition(l,g,m,.6,.6,.5),a=b.rayParameters.sourceOffset.y,n.subVectors(m.pos1,b.rayParameters.sourceOffset);const S=e.dot(n);s.copy(e).multiplyScalar(S),n.sub(s);const w=S/a>.5?a/S:1;s.multiplyScalar(w),n.add(s),m.pos1.addVectors(n,b.rayParameters.sourceOffset)}},d=new L({size:i.size,minHeight:i.minHeight,maxHeight:i.maxHeight,maxSlope:.6,maxLightnings:i.maxLightnings,lightningParameters:r,lightningMaterial:o});j(()=>{const l=d.stormParams;l.size=i.size,l.minHeight=i.minHeight,l.maxHeight=i.maxHeight,o.color.set(i.color),r.roughness=i.roughness,r.straightness=i.straightness,r.radius0=i.radius0,r.radius1=i.radius1,r.timeScale=i.timeScale});const{onBeforeRender:f}=F();return f(({elapsed:l})=>{d.update(l)}),(l,g)=>(B(),$("primitive",{object:Y(d),renderOrder:9999},null,8,X))}}),{defineComponent:W}=await y("vue"),{unref:p,createVNode:T,mergeProps:K,withCtx:q,Fragment:J,openBlock:Q,createElementBlock:k}=await y("vue"),{reactive:ii}=await y("vue"),bi=W({__name:"lightningStorm",setup(M){const i=ii({cellSize:60,cellThickness:1,cellColor:"#6f6f6f",sectionColor:"#92399e",sectionSize:330,sectionThickness:1.5,fadeDistance:3600,fadeStrength:1,followCamera:!1,infiniteGrid:!0}),{minHeight:t,maxHeight:o,color:e,roughness:a,straightness:n,radius0:s,radius1:r,timeScale:d}=G({minHeight:{label:"最低",value:100,min:10,max:500,step:10},maxHeight:{label:"最高",value:1e3,min:50,max:2e3,step:10},color:"#ffbde7",roughness:{label:"粗糙度",value:.85,min:0,max:1,step:.01},straightness:{label:"直度度",value:.65,min:0,max:1,step:.01},radius0:{label:"端部半径",value:1,min:.1,max:10,step:.01},radius1:{label:"未部半径",value:.5,min:.1,max:10,step:.01},timeScale:{label:"时间缩放",value:.15,min:.01,max:1,step:.01}});return(f,l)=>(Q(),k(J,null,[T(v,{showAxesHelper:!1,showGridHelper:!1},{ability:q(()=>[T(Z,{minHeight:p(t).value,maxHeight:p(o).value,color:p(e).value,roughness:p(a).value,straightness:p(n).value,radius0:p(s).value,radius1:p(r).value,timeScale:p(d).value},null,8,["minHeight","maxHeight","color","roughness","straightness","radius0","radius1","timeScale"]),T(p(A),K({args:[100,100]},i,{position:[0,-50,0]}),null,16)]),_:1}),T(p(U))],64))}});export{bi as default};
