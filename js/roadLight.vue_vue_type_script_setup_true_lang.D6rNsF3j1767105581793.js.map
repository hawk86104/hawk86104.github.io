{"version":3,"file":"roadLight.vue_vue_type_script_setup_true_lang.D6rNsF3j1767105581793.js","sources":["../../src/plugins/digitalCity/components/roads/roadLight.vue"],"sourcesContent":["<!--\n * @Description: \n * @Version: 1.668\n * @Autor: 地虎降天龙\n * @Date: 2023-10-24 10:36:23\n * @LastEditors: 地虎降天龙\n * @LastEditTime: 2025-09-26 14:57:09\n-->\n<script setup lang=\"ts\">\nimport { ref, watchEffect } from 'vue'\nimport { useLoop } from '@tresjs/core'\nimport { UseTexture } from '@tresjs/cientos'\nimport { CatmullRomCurve3, Vector3, RepeatWrapping, BackSide, Color, Texture } from 'three'\nimport { loadGeojson } from '../../common/utils'\n// import transformControlsDebug from '../../components/transformControlsDebug.vue'\n\nconst props = withDefaults(\n    defineProps<{\n        geoJson: string\n        color?: string\n        radius?: number\n        speed?: number\n    }>(),\n    {\n        color: '#ffff00',\n        radius: 2,\n        speed: 1.0,\n    },\n)\n\nconst tgRef = ref()\nconst tmbmRef = ref()\n\n// pTexture.rotation = Math.PI\n// pTexture.generateMipmaps = false\n// pTexture.magFilter = NearestFilter\n\nconst linePrimary = await loadGeojson(props.geoJson)\n\n// 一下两个参数 是城市建筑物模型的大小中心点 以及 实际地理位置的偏移和位置， 需要和 建模的人 进行沟通不对，不能直接用\n// 121.511782,31.229849\nconst geoOffSet = [-31.258949, 0, -121.465782]\nconst scalegeoScale = 60000\n\nlet curve: CatmullRomCurve3[] = []\nfor (var i = 0; i < linePrimary.length; i++) {\n    const item = linePrimary[i]\n    const points: Vector3[] = []\n    item.geometry.coordinates.forEach((lineOne: number[]) => {\n        points.push(new Vector3((lineOne[1] + geoOffSet[0]) * scalegeoScale, geoOffSet[1], (lineOne[0] + geoOffSet[2]) * scalegeoScale))\n    })\n    curve.push(new CatmullRomCurve3(points))\n}\n\nwatchEffect(() => {\n    if (props.color) {\n        if (tmbmRef.value) {\n            tmbmRef.value.color = new Color(props.color)\n        }\n    }\n})\nconst { onBeforeRender } = useLoop()\nconst ppTexture = ref<Texture>()\nonBeforeRender(() => {\n    if (ppTexture.value) {\n        ppTexture.value.offset.x -= (Math.random() / 20) * props.speed\n    }\n})\n\nconst handleLoaded = (texture: Texture) => {\n    texture.wrapS = texture.wrapT = RepeatWrapping\n    texture.repeat.set(1, 1)\n    ppTexture.value = texture\n}\n\n</script>\n\n<template>\n    <TresGroup ref=\"tgRef\">\n        <UseTexture v-slot=\"{ state: pTexture }\" path=\"./plugins/digitalCity/image/line.png\" @loaded=\"handleLoaded\">\n            <TresMesh v-for=\"item in curve\" :renderOrder=\"3000\">\n                <TresTubeGeometry :args=\"[item, 64, props.radius, 20 /*管道圆润*/, false]\" />\n                <TresMeshBasicMaterial ref=\"tmbmRef\" :map=\"pTexture\" :side=\"BackSide\" :transparent=\"true\"\n                    :color=\"props.color\" />\n            </TresMesh>\n        </UseTexture>\n    </TresGroup>\n</template>\n"],"names":["useLoop","UseTexture"],"mappings":"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"}