import{_ as t}from"./index.TbB8XgBA1742895693222.js";import{n as e,_ as n,m as r,Y as o,u as i,a2 as a,l as c,aZ as s,C as l}from"./three.DqHgeVY11742895693222.js";import{m as u,e as f,a as p,D as v,o as d}from"./@tresjs.xCsT8yve1742895693222.js";import{_ as m}from"./whiteFloorMesh.vue_vue_type_script_setup_true_lang.LLsikmuH1742895693222.js";import{_ as h}from"./skyBoxAmesh.vue_vue_type_script_setup_true_lang.pLKHfOZC1742895693222.js";import{P as x}from"./tweakpane.ivGeiIdz1742895693222.js";import{d as g,a3 as w,a2 as y,w as b,o as C,H as S,u as _,r as P,e as F,j as I,g as z,N as D,f as j,al as k,aj as T,ak as N,m as M,F as R}from"./@vue.C4dqouNn1742895693222.js";import"./utils.GnimYh381742895693222.js";import"./@fesjs.C15FMxIg1742895693222.js";import"./vue-router.0ovIAQEA1742895693222.js";import"./lodash-es.p1wj6C0b1742895693222.js";import"./@qlin.o0hjOMCg1742895693222.js";import"./pinia.JZN5hDyR1742895693222.js";import"./@floating-ui.HzHndBae1742895693222.js";import"./@juggle.4EyLec-41742895693222.js";import"./default.vue_vue_type_script_setup_true_lang.3MPHZthM1742895693222.js";import"./three-mesh-ui.module.e7fgp9vA1742895693222.js";import"./postprocessing.vTwfsnPH1742895693222.js";import"./@vueuse.q8TRDI1e1742895693222.js";var B=A;!function(t,e){for(var n=A,r=Z();;)try{if(666984===-parseInt(n(174))/1*(parseInt(n(154))/2)+parseInt(n(150))/3*(-parseInt(n(152))/4)+parseInt(n(173))/5*(-parseInt(n(149))/6)+parseInt(n(160))/7*(parseInt(n(170))/8)+parseInt(n(137))/9*(-parseInt(n(142))/10)+-parseInt(n(155))/11*(parseInt(n(178))/12)+parseInt(n(165))/13)break;r.push(r.shift())}catch(o){r.push(r.shift())}}();var E,W=(E=!0,function(t,e){var n=E?function(){if(e){var n=e[A(185)](t,arguments);return e=null,n}}:function(){};return E=!1,n});!function(){W(this,(function(){var t=A,e=new RegExp(t(184)),n=new RegExp(t(179),"i"),r=O("init");e[t(156)](r+t(176))&&n[t(156)](r+"input")?O():r("0")}))()}();var V,H=(V=!0,function(t,e){var n=V?function(){if(e){var n=e[A(185)](t,arguments);return e=null,n}}:function(){};return V=!1,n});function A(t,e){var n=Z();return A=function(t,e){return n[t-=137]},A(t,e)}H(void 0,(function(){var t,e=A;try{t=Function("return (function() "+e(143)+");")()}catch(s){t=window}for(var n=t[e(169)]=t[e(169)]||{},r=[e(172),e(151),e(161),e(188),e(177),e(162),"trace"],o=0;o<r[e(147)];o++){var i=H[e(167)][e(159)].bind(H),a=r[o],c=n[a]||i;i.__proto__=H[e(153)](H),i[e(163)]=c.toString[e(153)](c),n[a]=i}}))();class U{constructor(t,o){var i=A;this[i(148)]=new e({uniforms:{uTexture:{type:"t",value:null}},vertexShader:i(139),fragmentShader:"\n                uniform sampler2D uTexture;\n\n                varying vec2 vUv;\n\n                void main() {\n                    "+(o||i(166))+i(157),depthTest:!1,depthWrite:!1}),this[i(182)]=new(n[i(138)])(new r(2,2),this[i(148)]),this[i(164)]=new(n[i(187)])(45,window[i(140)]/window.innerHeight,1,1e3),this.renderer=t,this[i(141)]=new(n[i(146)]),this[i(141)][i(158)](this.mesh)}[B(168)](t,e){var n=B;this.renderer[n(181)](e),this.material[n(171)][n(183)][n(144)]=t,this[n(175)].render(this.scene,this[n(164)]),this.renderer.setRenderTarget(null)}}function Z(){var t=['{}.constructor("return this")( )',"value","debu","Scene","length","material","6MkhCMJ","6048CgpLKU","warn","824IFSdcj","bind","18HiJeNm","1925539KOwjbW","test","  \n                }","add","prototype","1432207ERTziR","info","table","toString","camera","51369942DmwZYF","gl_FragColor = texture2D(uTexture, vUv);","constructor","blit","console","40dlbVdx","uniforms","log","4921745YUYoMJ","94771zDxzNa","renderer","chain","exception","84vubAWY","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","while (true) {}","setRenderTarget","mesh","uTexture","function *\\( *\\)","apply","gger","PerspectiveCamera","error","4311MugEHf","Mesh","\n                varying vec2 vUv;\n\n                void main() {\n                    vUv = uv;\n                    gl_Position = vec4(position.xy, 0.0, 1.0);    \n                }","innerWidth","scene","17320tQwLHd"];return(Z=function(){return t})()}function O(t){function e(t){var n=A;if("string"==typeof t)return function(t){}.constructor(n(180))[n(185)]("counter");1!==(""+t/t).length||t%20==0?function(){return!0}[n(167)](n(145)+n(186)).call("action"):function(){return!1}[n(167)](n(145)+"gger").apply("stateObject"),e(++t)}try{if(t)return e;e(0)}catch(n){}}const X=K;!function(t,e){const n=K,r=G();for(;;)try{if(486916===parseInt(n(209))/1*(parseInt(n(207))/2)+-parseInt(n(161))/3*(-parseInt(n(162))/4)+-parseInt(n(188))/5+parseInt(n(185))/6+parseInt(n(165))/7+-parseInt(n(210))/8*(-parseInt(n(178))/9)+-parseInt(n(171))/10)break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const Y=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[K(202)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();!function(){Y(this,(function(){const t=K,e=new RegExp("function *\\( *\\)"),n=new RegExp("\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","i"),r=J(t(148));e.test(r+t(153))&&n[t(192)](r+"input")?J():r("0")}))()}();const L=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n.apply(e,arguments);return n=null,t}}:function(){};return t=!1,r}}();L(void 0,(function(){const t=K,e=function(){const t=K;let e;try{e=Function(t(183)+'{}.constructor("return this")( ));')()}catch(n){e=window}return e}(),n=e[t(181)]=e[t(181)]||{},r=[t(179),t(145),"info",t(211),t(212),t(189),t(206)];for(let o=0;o<r.length;o++){const e=L[t(197)][t(213)][t(149)](L),i=r[o],a=n[i]||e;e.__proto__=L[t(149)](L),e[t(190)]=a[t(190)].bind(a),n[i]=e}}))();class ${constructor(t,r,s){const l=K;this[l(169)]=t[l(199)](),this.camera=r,this[l(166)]=s,this.scene=new o,this.scene[l(168)](this[l(169)]),this.blitProgram=new U(this[l(166)]),this[l(167)]=new(n[l(146)])(innerWidth,innerHeight,{type:n[l(204)],depthBuffer:!1,stencilBuffer:!1}),this.pong=new(n[l(146)])(innerWidth,innerHeight,{type:n[l(204)],depthBuffer:!1,stencilBuffer:!1}),this.frontFaceRT=new i(innerWidth,innerHeight,{type:n[l(204)]}),this[l(182)]=new(n[l(158)])({uniforms:{uCameraFarInverse:{value:1/this[l(200)][l(187)]}},vertexShader:l(194),fragmentShader:l(195),depthTest:!0,depthWrite:!0,side:a}),this[l(147)]=new e({uniforms:{uScreenSize:{value:new(n[l(186)])(innerWidth,innerHeight)},uPrevDepth:{type:"t",value:this[l(167)][l(205)]},uCameraFarInverse:{value:1/this[l(200)][l(187)]},uSample:{value:0}},vertexShader:l(175),fragmentShader:l(155),depthTest:!1,depthWrite:!1,side:n[l(180)]}),this[l(169)][l(151)]((t=>{const e=l;t instanceof c&&(t[e(147)]=this[e(147)])}))}[X(203)](t){const e=X;this[e(166)][e(208)](this[e(167)]),this.renderer[e(160)](),this[e(166)].setRenderTarget(this[e(170)]),this[e(166)].clear(),this[e(169)][e(151)]((t=>{const n=e;t instanceof c&&(t[n(147)]=this[n(147)])})),this[e(147)][e(173)][e(156)][e(157)]=1/this.camera[e(187)];for(let n=0;n<t;n++){let t=n%2==0?this[e(167)]:this[e(170)],r=n%2==0?this[e(170)]:this[e(167)];this[e(147)][e(173)][e(159)][e(157)]=t.texture,this[e(147)][e(173)][e(172)][e(157)]=n,this[e(166)][e(163)]=!1,this[e(166)][e(208)](r),this[e(166)][e(176)](this.scene,this[e(200)]),this[e(166)][e(163)]=!0,this.blitProgram.blit(r[e(205)],t)}t%2==0?this[e(152)]=this[e(167)]:this.resultBuffer=this[e(170)],this[e(169)].traverse((t=>{const r=e;t instanceof n[r(193)]&&(t[r(147)]=this[r(182)])})),this[e(166)].setRenderTarget(this[e(198)]),this.renderer.render(this.scene,this.camera)}[X(184)](){const t=X;return this[t(152)][t(205)]}getFrontFaceTexture(){const t=X;return this[t(198)][t(205)]}}function K(t,e){const n=G();return K=function(t,e){return n[t-=145]},K(t,e)}function G(){const t=["console","frontFaceMaterial","return (function() ","getBackFaceTexture","4502178KuoQpT","Vector2","far","1100875nltszQ","table","toString","length","test","Mesh","\n                varying vec3 vCameraSpacePos;\n                varying vec3 vWorldSpaceNormal;\n\n                void main() {\n                    vCameraSpacePos = (modelViewMatrix * vec4(position, 1.0)).xyz;\n                    vWorldSpaceNormal = normal;\n\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);    \n                }","\n                uniform float uCameraFarInverse;\n\n                varying vec3 vWorldSpaceNormal;\n                varying vec3 vCameraSpacePos;\n\n                void main() {\n                    float currentDepth = abs(vCameraSpacePos.z) * uCameraFarInverse;\n                    gl_FragColor = vec4(vWorldSpaceNormal, currentDepth);    \n                }","action","constructor","frontFaceRT","clone","camera","string","apply","compute","FloatType","texture","trace","2jHUHwv","setRenderTarget","519721IYcMed","88AIPfFU","error","exception","prototype","warn","WebGLRenderTarget","material","init","bind","gger","traverse","resultBuffer","chain","stateObject","\n                uniform sampler2D uPrevDepth;\n                uniform float uCameraFarInverse;\n                uniform float uSample;\n                uniform vec2  uScreenSize;\n\n                varying vec3 vWorldSpaceNormal;\n                varying vec3 vCameraSpacePos;\n\n                void main() {\n\n                    vec2 uv = gl_FragCoord.xy / uScreenSize;\n                    float prevRegisteredDepth = texture2D(uPrevDepth, uv).w;\n                    float currentDepth        = abs(vCameraSpacePos.z) * uCameraFarInverse;\n\n                    if(currentDepth <= prevRegisteredDepth) {\n                        discard;\n                    }\n\n                    gl_FragColor = vec4(vWorldSpaceNormal, currentDepth);    \n                }","uCameraFarInverse","value","ShaderMaterial","uPrevDepth","clear","61914xAodqh","176zLiFmj","autoClear","counter","6148744uxpPPA","renderer","ping","add","mesh","pong","25186590Redcti","uSample","uniforms","debu","\n                varying vec3 vCameraSpacePos;\n                varying vec3 vWorldSpaceNormal;\n\n                void main() {\n                    vCameraSpacePos = (modelViewMatrix * vec4(position, 1.0)).xyz;\n                    vWorldSpaceNormal = normalize((modelMatrix * vec4(normal, 0.0)).xyz);\n\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);    \n                }","render","while (true) {}","138438aKYIwQ","log","DoubleSide"];return(G=function(){return t})()}function J(t){function e(t){const n=K;if(typeof t===n(201))return function(t){}[n(197)](n(177))[n(202)](n(164));1!==(""+t/t)[n(191)]||t%20==0?function(){return!0}[n(197)](n(174)+n(150)).call(n(196)):function(){return!1}.constructor(n(174)+n(150))[n(202)](n(154)),e(++t)}try{if(t)return e;e(0)}catch(n){}}const q=ot;!function(t,e){const n=ot,r=nt();for(;;)try{if(824936===parseInt(n(520))/1*(parseInt(n(456))/2)+parseInt(n(464))/3*(parseInt(n(501))/4)+parseInt(n(488))/5*(-parseInt(n(459))/6)+-parseInt(n(472))/7*(parseInt(n(525))/8)+parseInt(n(522))/9*(-parseInt(n(508))/10)+parseInt(n(457))/11*(parseInt(n(523))/12)+parseInt(n(467))/13)break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const Q=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[ot(486)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();!function(){Q(this,(function(){const t=ot,e=new RegExp("function *\\( *\\)"),n=new RegExp(t(517),"i"),r=it("init");e[t(497)](r+"chain")&&n[t(497)](r+t(451))?it():r("0")}))()}();const tt=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[ot(486)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();tt(void 0,(function(){const t=ot;let e;try{e=Function("return (function() "+t(498)+");")()}catch(o){e=window}const n=e.console=e[t(510)]||{},r=[t(476),t(484),t(490),t(455),t(448),"table",t(453)];for(let i=0;i<r[t(475)];i++){const e=tt.constructor[t(452)].bind(tt),o=r[i],a=n[o]||e;e[t(509)]=tt[t(524)](tt),e.toString=a[t(483)][t(524)](a),n[o]=e}}))();const et=[q(481)];function nt(){const t=["uReflectionFactor","uExtintionColor2","convertLinearToSRGB","extintionFactor","test",'{}.constructor("return this")( )',"modelName","Color","32zXlMZa","clone","uExtinctionFX1","sub","extintionCol1Random","side","counter","49180LraXdt","__proto__","console","Vector4","position","string","uniforms","getBackFaceTexture","traverse","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","uCameraPos","Vector3","64218dWUTET","stateObject","1656mvhppy","15307212JAyHVo","bind","344broOVd","ShaderMaterial","ssrtGlassMesh","wrapT","uExtintionFactor","innerWidth","while (true) {}","material","exception","exposure","value","input","prototype","trace","gger","error","38yUMhgh","11rJUrVf","ClampToEdgeWrapping","215598TRxoBe","uExtintionColor1","extintionCol2Random","LinearMipmapLinearFilter","extintionColor1","115227mjYBTW","magFilter","compute","11879114RSdZVk","modelPath","uFrontFaceBuffer","action","rgb(192,123,25)","206465pKrZne","Mesh","extintionColor2","length","log","constructor","reflectionFactor","minFilter","uExposure","object","#fff","toString","warn","setRenderTarget","apply","innerHeight","100ddPoWD","Vector2","info","Scene","debu"];return(nt=function(){return t})()}const rt=g({__name:q(527),props:{skyBoxTexture:{},modelPath:{},modelName:{},extintionFactor:{default:5},reflectionFactor:{default:1},exposure:{default:0},extintionColor1:{default:q(471)},extintionColor2:{default:"rgb(26, 166, 192)"},extintionCol1Random:{type:Boolean,default:!1},extintionCol2Random:{type:Boolean,default:!1}},async setup(t){const e=q;let r,o;const i=t,{map:c}=([r,o]=w((()=>p({map:i.skyBoxTexture}))),r=await r,o(),r);c.wrapS=s,c[e(443)]=n[e(458)],c[e(465)]=n[e(462)],c[e(479)]=n[e(462)];const{camera:d,renderer:m,scene:h}=u(),x=new(n[e(526)])({uniforms:{uSkybox:{type:"t",value:c},uBackFaceBuffer:{type:"t",value:null},uFrontFaceBuffer:{type:"t",value:null},uCameraFarInverse:{value:1/d[e(450)].far},uScreenSizeInv:{value:new(n[e(489)])(1/window[e(445)],1/window[e(487)])},uCameraPos:{value:new(n[e(519)])(0,0,0)},uTime:{value:0},uExtintionColor1:{value:new l(e(482))[e(504)](new(n[e(500)])(i[e(463)]).convertLinearToSRGB())},uExtintionColor2:{value:new(n[e(500)])(e(482))[e(504)](new l(i.extintionColor2)[e(495)]())},uExtintionFactor:{value:i.extintionFactor},uExposure:{value:i[e(449)]},uReflectionFactor:{value:i.reflectionFactor},uExtinctionFX1:{value:new(n[e(511)])(i[e(505)]?1:0,i[e(461)]?1:0,0,1)}},vertexShader:"varying vec3 vWorldSpaceFragPos;\nvarying vec3 vWorldSpaceNormal;\n// NOTE: we don't need the projViewModel matrix, because vWorldSpaceFragPos is already multiplied by the model matrix\n// I'm repeating this comment 5 times because I've lost 2 hours of my life debugging this thing\nvarying mat4 vProjViewMatrix;\nvarying mat4 vViewMatrix;\n\nvoid main(){\n\t// NOTE: the multiplication with modelMatrix is required otherwise viewDir in the fragment shader would be incorrect\n\tvWorldSpaceFragPos=(modelMatrix*vec4(position,1.)).xyz;\n\tvWorldSpaceNormal=normalize((modelMatrix*vec4(normal,0.)).xyz);\n\t\n\tgl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);\n\tvProjViewMatrix=projectionMatrix*viewMatrix;\n\tvViewMatrix=viewMatrix;\n}",fragmentShader:"uniform sampler2D uSkybox;\nuniform sampler2D uBackFaceBuffer;\nuniform sampler2D uFrontFaceBuffer;\n\nuniform vec3 uExtintionColor1;\nuniform vec3 uExtintionColor2;\nuniform float uExtintionFactor;\nuniform float uExposure;\nuniform float uReflectionFactor;\nuniform vec4 uExtinctionFX1;\n\nuniform float uTime;\n\nuniform vec3 uCameraPos;\nuniform vec2 uScreenSizeInv;\nuniform float uCameraFarInverse;\n\nvarying vec3 vWorldSpaceFragPos;\nvarying vec3 vWorldSpaceNormal;\nvarying mat4 vProjViewMatrix;\nvarying mat4 vViewMatrix;\n\nconst float PI=3.14159265359;\nconst float e=2.7182818284590;\n\nconst float planeSize=3.;\nconst vec3 planeColor=pow(vec3(202./255.,205./255.,185./255.),vec3(3.));\n\nfloat mod289(float x){return x-floor(x*(1./289.))*289.;}\nvec4 mod289(vec4 x){return x-floor(x*(1./289.))*289.;}\nvec4 perm(vec4 x){return mod289(((x*34.)+1.)*x);}\n\nfloat noise(vec3 p){\n\tvec3 a=floor(p);\n\tvec3 d=p-a;\n\td=d*d*(3.-2.*d);\n\t\n\tvec4 b=a.xxyy+vec4(0.,1.,0.,1.);\n\tvec4 k1=perm(b.xyxy);\n\tvec4 k2=perm(k1.xyxy+b.zzww);\n\t\n\tvec4 c=k2+a.zzzz;\n\tvec4 k3=perm(c);\n\tvec4 k4=perm(c+1.);\n\t\n\tvec4 o1=fract(k3*(1./41.));\n\tvec4 o2=fract(k4*(1./41.));\n\t\n\tvec4 o3=o2*d.z+o1*(1.-d.z);\n\tvec2 o4=o3.yw*d.x+o3.xz*(1.-d.x);\n\t\n\treturn o4.y*d.y+o4.x*(1.-d.y);\n}\n\nvec3 acesFilm(const vec3 x){\n\tconst float a=2.51;\n\tconst float b=.03;\n\tconst float c=2.43;\n\tconst float d=.59;\n\tconst float e=.14;\n\treturn clamp((x*(a*x+b))/(x*(c*x+d)+e),0.,1.);\n}\n\n// gets the skybox color from a given view direction\nvec3 getSkyboxColor(vec3 viewDir){\n\t// skybox coordinates\n\tvec2 skyboxUV=vec2(\n\t\t(atan(viewDir.x,viewDir.z)+PI)/(PI*2.),\n\t\t(asin(viewDir.y)+PI*.5)/(PI)\n\t);\n\t\n\tvec3 col=texture2D(uSkybox,skyboxUV).xyz;\n\tcol=pow(col,vec3(2.2));\n\treturn col;\n}\n\nbool refract2(vec3 v,vec3 n,float ni_over_nt,inout vec3 refracted){\n\tvec3 uv=normalize(v);\n\tfloat dt=dot(uv,n);\n\tfloat discriminant=1.-ni_over_nt*ni_over_nt*(1.-dt*dt);\n\tif(discriminant>0.){\n\t\trefracted=ni_over_nt*(v-n*dt)-n*sqrt(discriminant);\n\t\treturn true;\n\t}\n\t\n\treturn false;\n}\n\nvec3 binarySearchHitPoint(vec3 lastP,vec3 hitP,vec3 rayDir){\n\t\n\tfor(int i=0;i<10;i++){\n\t\tvec3 midP=(lastP+hitP)*.5;\n\t\t\n\t\t// project midP in uv space\n\t\tvec4 projCoord=vProjViewMatrix*vec4(midP,1.);\n\t\tprojCoord.xyz/=projCoord.w;\n\t\t\n\t\tvec2 midpNDC=projCoord.xy;\n\t\tvec2 midpUV=midpNDC*.5+.5;\n\t\t\n\t\t// get depth at point\n\t\tvec4 backBuffer=texture2D(uBackFaceBuffer,midpUV);\n\t\tfloat depth=backBuffer.w;\n\t\t\n\t\tfloat midpDepth=abs((vViewMatrix*vec4(midP,1.)).z)*uCameraFarInverse;\n\t\tif(midpDepth>depth){\n\t\t\thitP=midP;\n\t\t}else{\n\t\t\tlastP=midP;\n\t\t}\n\t}\n\t\n\treturn hitP;\n}\n\nvec3 getRefractedColor(vec3 refractionDir,vec3 hitPoint,float refractionIndex){\n\t// move the hitpoint inside the mesh with epsilon\n\thitPoint+=refractionDir*.0001;\n\t\n\t// raymarch!\n\tfloat stepSize=.02;\n\tfloat stepMult=1.5;\n\t\n\tvec3 lastP=hitPoint;\n\tvec3 p=hitPoint;\n\tvec3 hitPNormal;\n\tfloat currStepSize=stepSize;\n\tfloat transmissionDistance=0.;\n\tfor(int i=0;i<20;i++){\n\t\tp+=currStepSize*refractionDir;\n\t\t\n\t\t// project p in uv space\n\t\tvec4 projCoord=vProjViewMatrix*vec4(p,1.);\n\t\tprojCoord.xyz/=projCoord.w;\n\t\t\n\t\tvec2 pNDC=projCoord.xy;\n\t\tvec2 pUV=pNDC*.5+.5;\n\t\t\n\t\t// get depth at point\n\t\tvec4 backBuffer=texture2D(uBackFaceBuffer,pUV);\n\t\tfloat depth=backBuffer.w;\n\t\tvec3 norm=backBuffer.xyz;\n\t\t\n\t\t// get p depth\n\t\tfloat pDepth=abs((vViewMatrix*vec4(p,1.)).z)*uCameraFarInverse;\n\t\t\n\t\tif(pDepth>depth){\n\t\t\t\n\t\t\tvec3 hitp=binarySearchHitPoint(lastP,p,refractionDir);\n\t\t\tp=hitp;\n\t\t\t\n\t\t\t// ************ get the hitpoint normal\n\t\t\tvec4 projCoord=vProjViewMatrix*vec4(p,1.);\n\t\t\tprojCoord.xyz/=projCoord.w;\n\t\t\t\n\t\t\tvec2 pNDC=projCoord.xy;\n\t\t\tvec2 pUV=pNDC*.5+.5;\n\t\t\t\n\t\t\t// get depth at point\n\t\t\thitPNormal=texture2D(uBackFaceBuffer,pUV).xyz;\n\t\t\t// ************ get the hitpoint normal - END\n\t\t\t\n\t\t\tbreak;\n\t\t}\n\t\t\n\t\tlastP=p;\n\t\tcurrStepSize*=stepMult;\n\t}\n\t\n\ttransmissionDistance=length(hitPoint-p);\n\t\n\t// ******************** recalc directions\n\tvec3 outward_normal;\n\tvec3 reflected=reflect(refractionDir,hitPNormal);\n\tfloat ni_over_nt;\n\tvec3 refr;\n\t// vec3 refracted;\n\tfloat reflect_prob;\n\tfloat cosine;\n\t\n\tif(dot(refractionDir,hitPNormal)>0.){\n\t\toutward_normal=-hitPNormal;\n\t\tni_over_nt=refractionIndex;\n\t\tcosine=refractionIndex*dot(refractionDir,hitPNormal);\n\t}else{\n\t\toutward_normal=hitPNormal;\n\t\tni_over_nt=1./refractionIndex;\n\t\tcosine=-dot(refractionDir,hitPNormal);\n\t}\n\t\n\t// if (refract2(refractionDir, outward_normal, ni_over_nt, refracted)) {\n\t\tif(refract2(refractionDir,outward_normal,ni_over_nt,refr)){\n\t\t\tfloat r0=(1.-refractionIndex)/(1.+refractionIndex);\n\t\t\tr0*=r0;\n\t\t\treflect_prob=r0+(1.-r0)*pow((1.-cosine),5.);\n\t\t}else{\n\t\t\treflect_prob=1.;\n\t\t}\n\t\t// ******************** recalc directions - END\n\t\t\n\t\t// ******************** get colors\n\t\tvec3 col;\n\t\tvec3 colrefl;\n\t\tvec3 colrefr;\n\t\t// if(refracted.y < 0.0) {\n\t\t\tif(refr.y<0.){\n\t\t\t\t// float t = p.y / abs(refracted.y);\n\t\t\t\t// vec3 planeHitP = p + refracted * t;\n\t\t\t\tfloat t=p.y/abs(refr.y);\n\t\t\t\tvec3 planeHitP=p+refr*t;\n\t\t\t\tif(abs(planeHitP.x)<planeSize&&abs(planeHitP.z)<planeSize){\n\t\t\t\t\tcolrefr=planeColor;\n\t\t\t\t}else{\n\t\t\t\t\t// colrefr = getSkyboxColor(refracted);\n\t\t\t\t\tcolrefr=getSkyboxColor(refr);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\t// colrefr = getSkyboxColor(refracted);\n\t\t\t\tcolrefr=getSkyboxColor(refr);\n\t\t\t}\n\t\t\t\n\t\t\tif(reflected.y<0.){\n\t\t\t\tfloat t=p.y/abs(reflected.y);\n\t\t\t\tvec3 planeHitP=p+reflected*t;\n\t\t\t\tif(abs(planeHitP.x)<planeSize&&abs(planeHitP.z)<planeSize){\n\t\t\t\t\tcolrefl=planeColor;\n\t\t\t\t}else{\n\t\t\t\t\tcolrefl=getSkyboxColor(reflected);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tcolrefl=getSkyboxColor(reflected);\n\t\t\t}\n\t\t\t\n\t\t\tcol=colrefl*(reflect_prob*uReflectionFactor)+colrefr*(1.-reflect_prob);\n\t\t\t// ******************** get colors\n\t\t\t\n\t\t\tvec3 transm=vec3(1.);\n\t\t\t// const int steps = 8;\n\t\t\tconst int steps=15;\n\t\t\tfloat step=transmissionDistance/float(steps);\n\t\t\tfloat fc=uExtintionFactor*.07;\n\t\t\t\n\t\t\t// raymarching transmission color\n\t\t\t\n\t\t\t// float noiseStrength = 0.8;\n\t\t\tfloat noiseSpeed=.5;\n\t\t\tfloat noiseTimeSpeed=.5;\n\t\t\t\n\t\t\tfor(int i=0;i<steps;i++){\n\t\t\t\tvec3 np=hitPoint+refractionDir*float(i)*step;\n\t\t\t\t\n\t\t\t\tvec3 nnp=np;\n\t\t\t\tvec3 w=normalize(np-vec3(.75,1.5,0.));\n\t\t\t\tvec3 u=vec3(0.,0.,1.);\n\t\t\t\t// vec3 timeOffset = uTime * normalize(np - vec3(0.75, 1.5, 0.0));\n\t\t\t\tvec3 timeOffset=cos(uTime)*w+sin(uTime)*u;\n\t\t\t\tfloat colorNoiseX=noise(np*noiseSpeed+timeOffset*noiseTimeSpeed);\n\t\t\t\tfloat colorNoiseY=noise(np*noiseSpeed+timeOffset*noiseTimeSpeed+vec3(15.3278,125.19879,0.));\n\t\t\t\tfloat colorNoiseZ=noise(np*noiseSpeed+timeOffset*noiseTimeSpeed+vec3(2.6008,78.19879,543.12993));\n\t\t\t\t\n\t\t\t\tfloat targ=length(nnp*.8*uExtinctionFX1.w-vec3(.75,1.5,0.));\n\t\t\t\tfloat targAperture=.25;\n\t\t\t\t\n\t\t\t\t// wave raymarch\n\t\t\t\tif(uExtinctionFX1.z>.5){\n\t\t\t\t\tnnp=np+sin(np.x*2.5+uTime*1.5)*.3;\n\t\t\t\t\ttarg=nnp.y-.85*uExtinctionFX1.w;\n\t\t\t\t}else{\n\t\t\t\t\tnnp=np+vec3(colorNoiseX,colorNoiseY,colorNoiseZ)*1.05;\n\t\t\t\t\tvec3 diff=nnp-vec3(3.3,4.5,0.);\n\t\t\t\t\tfloat angle=(atan(diff.x,diff.y)+PI)/(PI*2.);\n\t\t\t\t\ttarg=length(diff)+sin(angle*32.*PI+uTime*1.5)*.4;\n\t\t\t\t\ttarg*=.475;\n\t\t\t\t\ttargAperture=.5+colorNoiseX*.75;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// what's the color at np?\n\t\t\t\tvec3 col1=uExtintionColor1;\n\t\t\t\tvec3 col2=uExtintionColor2;\n\t\t\t\tif(uExtinctionFX1.x>.5){\n\t\t\t\t\tcol1=vec3(colorNoiseX,colorNoiseY,colorNoiseZ)*.85;\n\t\t\t\t}\n\t\t\t\tif(uExtinctionFX1.y>.5){\n\t\t\t\t\tcol2=vec3(colorNoiseX,colorNoiseY,colorNoiseZ)*.85;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(targ<1.){\n\t\t\t\t\t\n\t\t\t\t\ttransm*=exp(-step*col2*fc);\n\t\t\t\t\t\n\t\t\t\t}else if(targ>1.&&targ<1.+targAperture){\n\t\t\t\t\tfloat t=(targ-1.)/targAperture;\n\t\t\t\t\t\n\t\t\t\t\ttransm*=exp(-step*(col1*t+col2*(1.-t))*fc);\n\t\t\t\t\t\n\t\t\t\t}else if(targ<(1.+targAperture)*1.85){\n\t\t\t\t\ttransm*=exp(-step*col1*fc);\n\t\t\t\t\t\n\t\t\t\t}else{\n\t\t\t\t\t// transm = (col1) * targAperture;\n\t\t\t\t\t// transm *= exp(-step * col1 * uExtintionFactor);\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// return col * uExtintionColor2 * transm;\n\t\t\tcol*=transm;\n\t\t\t\n\t\t\treturn col;\n\t\t}\n\t\t\n\t\tvoid main(){\n\t\t\tvec2 screenUV=gl_FragCoord.xy*uScreenSizeInv;\n\t\t\t\n\t\t\tvec3 viewDir=normalize(vWorldSpaceFragPos-uCameraPos);\n\t\t\tvec3 normal=vWorldSpaceNormal;\n\t\t\tfloat refractionIndex=1.5;\n\t\t\t\n\t\t\tvec3 outward_normal;\n\t\t\tvec3 reflected=reflect(viewDir,normal);\n\t\t\tfloat ni_over_nt;\n\t\t\tvec3 refracted;\n\t\t\tfloat reflect_prob;\n\t\t\tfloat cosine;\n\t\t\t\n\t\t\tif(dot(viewDir,normal)>0.){\n\t\t\t\toutward_normal=-normal;\n\t\t\t\tni_over_nt=refractionIndex;\n\t\t\t\tcosine=refractionIndex*dot(viewDir,normal);\n\t\t\t}else{\n\t\t\t\toutward_normal=normal;\n\t\t\t\tni_over_nt=1./refractionIndex;\n\t\t\t\tcosine=-dot(viewDir,normal);\n\t\t\t}\n\t\t\t\n\t\t\tif(refract2(viewDir,outward_normal,ni_over_nt,refracted)){\n\t\t\t\tfloat r0=(1.-refractionIndex)/(1.+refractionIndex);\n\t\t\t\tr0*=r0;\n\t\t\t\treflect_prob=r0+(1.-r0)*pow((1.-cosine),5.);\n\t\t\t}else{\n\t\t\t\treflect_prob=1.;\n\t\t\t}\n\t\t\t\n\t\t\tvec3 reflectedCol;\n\t\t\tif(reflected.y<0.){\n\t\t\t\tfloat t=vWorldSpaceFragPos.y/abs(reflected.y);\n\t\t\t\tvec3 planeHitP=vWorldSpaceFragPos+reflected*t;\n\t\t\t\tif(abs(planeHitP.x)<planeSize&&abs(planeHitP.z)<planeSize){\n\t\t\t\t\treflectedCol=planeColor;\n\t\t\t\t}else{\n\t\t\t\t\treflectedCol=getSkyboxColor(reflected);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\treflectedCol=getSkyboxColor(reflected);\n\t\t\t}\n\t\t\t\n\t\t\tvec3 col=reflectedCol*reflect_prob*uReflectionFactor+getRefractedColor(refracted,vWorldSpaceFragPos,refractionIndex)*(1.-reflect_prob);\n\t\t\t// getRefractedColor(normalize(refracted + vec3(0.0, 0.0, 0.0)), vWorldSpaceFragPos) * (1.0 - reflect_prob) * 0.333 +\n\t\t\t// getRefractedColor(normalize(refracted + vec3(0.0, 0.15, 0.0)), vWorldSpaceFragPos) * (1.0 - reflect_prob) * 0.333 +\n\t\t\t// getRefractedColor(normalize(refracted + vec3(0.0, 0.35, 0.0)), vWorldSpaceFragPos) * (1.0 - reflect_prob) * 0.333;\n\t\t\t\n\t\t\t// col = getRefractedColor(refracted, vWorldSpaceFragPos) * (1.0 - reflect_prob);\n\t\t\t// vec3 col = getRefractedColor(refracted, vWorldSpaceFragPos);\n\t\t\t// col = getSkyboxColor(reflected) * reflect_prob * 1.0;\n\t\t\t\n\t\t\t// vec3 col = viewDir;\n\t\t\t// gl_FragColor = vec4(col, 1.0);\n\t\t\t// return;\n\t\t\t\n\t\t\tcol*=pow(2.,uExposure);\n\t\t\tcol=acesFilm(col);\n\t\t\tcol=pow(col,vec3(1./2.2));\n\t\t\t\n\t\t\tgl_FragColor=vec4(col,1.);\n\t\t\t// gl_FragColor = vec4(getSkyboxColor(viewDir), 1.0) * 0.5 + vec4(viewDir * 0.5 + 0.5, 1.0);\n\t\t}"}),{nodes:g}=([r,o]=w((()=>v(i[e(468)],{draco:!0,decoderPath:"./draco/"}))),r=await r,o(),r),P=g[e(491)].getObjectByName(i[e(499)]),F=new $(P,d[e(450)],m[e(450)]),I=P?.[e(502)]();I?.[e(516)]((t=>{const r=e;t instanceof n[r(473)]&&(t[r(447)]=x,t.material[r(506)]=a)}));const{onAfterLoop:z}=f();return z((({elapsed:t})=>{const n=e;P&&x&&(x[n(514)][n(518)][n(450)]=d[n(450)][n(512)][n(502)](),x[n(514)].uTime.value=t,F[n(466)](6),x.uniforms.uBackFaceBuffer[n(450)]=F[n(515)](),x[n(514)][n(469)].value=F.getFrontFaceTexture(),m.value[n(485)](null),m[n(450)].autoClear=!1)})),y((()=>{const t=e;i[t(496)]&&(x[t(514)][t(444)][t(450)]=i.extintionFactor),i[t(478)]&&(x.uniforms[t(493)][t(450)]=i[t(478)]),i[t(449)]&&(x[t(514)][t(480)][t(450)]=i[t(449)]),i[t(463)]&&(x.uniforms[t(460)].value=new(n[t(500)])(t(482))[t(504)](new(n[t(500)])(i[t(463)]).convertLinearToSRGB())),i[t(474)]&&(x.uniforms[t(494)].value=new(n[t(500)])("#fff")[t(504)](new(n[t(500)])(i[t(474)])[t(495)]())),i[t(505)]&&(x[t(514)][t(480)][t(450)]=i.exposure)})),b((()=>i.extintionCol1Random),(t=>{const n=e;x.uniforms[n(503)].value.x=t?1:0}),{immediate:!0}),b((()=>i.extintionCol2Random),(t=>{const n=e;x[n(514)][n(503)][n(450)].y=t?1:0}),{immediate:!0}),(t,e)=>(C(),S("primitive",{object:_(I)},null,8,et))}});function ot(t,e){const n=nt();return ot=function(t,e){return n[t-=443]},ot(t,e)}function it(t){function e(t){const n=ot;if(typeof t===n(513))return function(t){}[n(477)](n(446))[n(486)](n(507));1!==(""+t/t)[n(475)]||t%20==0?function(){return!0}.constructor(n(492)+n(454)).call(n(470)):function(){return!1}[n(477)](n(492)+n(454)).apply(n(521)),e(++t)}try{if(t)return e;e(0)}catch(n){}}!function(t,e){const n=st,r=lt();for(;;)try{if(636378===-parseInt(n(477))/1+-parseInt(n(471))/2+-parseInt(n(470))/3*(-parseInt(n(469))/4)+parseInt(n(499))/5+-parseInt(n(480))/6*(parseInt(n(476))/7)+parseInt(n(510))/8*(parseInt(n(519))/9)+parseInt(n(467))/10*(parseInt(n(468))/11))break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const at=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n.apply(e,arguments);return n=null,t}}:function(){};return t=!1,r}}();!function(){at(this,(function(){const t=st,e=new RegExp("function *\\( *\\)"),n=new RegExp(t(501),"i"),r=ft(t(524));e[t(494)](r+"chain")&&n[t(494)](r+t(483))?ft():r("0")}))()}();const ct=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[st(474)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();function st(t,e){const n=lt();return st=function(t,e){return n[t-=465]},st(t,e)}function lt(){const t=["extintionCol2Random","198065SWzobM","消光系数","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","bind","/model/eCommerce/guanYu.glb","曝光系数","ACESFilmicToneMapping","reflectionFactor","extintionCol1Random","TresPerspectiveCamera","反射系数","3568TotwtF","error","#201919","prototype","/images/skyBox/workshop_blur.jpg","constructor","length","skyBoxTexture","rgb(192,123,25)","2934EYEmWS","debu","call","消光颜色一","trace","init","table","extintionFactor","195630rnocOk","1221BHdesN","3043856WlOARC","3AnWnSh","1959762nBvQEq","stateObject","counter","apply","exposure","2692669mDKJhE","1116540oHuDcH","https://opensource.cdn.icegl.cn","addBinding","6AmXtex","随机色2",'{}.constructor("return this")( )',"input","statue","action","TresAmbientLight","modelPath","texture","exception","__proto__","TresCanvas","resource.cos","info","test","console","rgb(26, 166, 192)","toString"];return(lt=function(){return t})()}ct(void 0,(function(){const t=st;let e;try{e=Function("return (function() "+t(482)+");")()}catch(o){e=window}const n=e[t(495)]=e[t(495)]||{},r=["log","warn",t(493),t(511),t(489),t(465),t(523)];for(let i=0;i<r[t(516)];i++){const e=ct.constructor[t(513)].bind(ct),o=r[i],a=n[o]||e;e[t(490)]=ct[t(502)](ct),e[t(497)]=a[t(497)][t(502)](a),n[o]=e}}))();const ut=g({__name:"ssrtGlass",setup(e){const r=st,o={clearColor:r(512),windowSize:!0,toneMapping:n[r(505)],toneMappingExposure:.8},i=P({size:[20,20],color:"#cbcb96",shadowColor:"#b8b59e",edge:.35}),a=P({extintionFactor:5,reflectionFactor:1,exposure:0,extintionColor1:r(518),extintionColor2:r(496),extintionCol1Random:!1,extintionCol2Random:!1}),c=new x({title:"参数"});return c[r(479)](a,r(466),{label:r(500),min:0,max:10,step:.1}),c[r(479)](a,r(506),{label:r(509),min:0,max:2,step:.1}),c.addBinding(a,r(475),{label:r(504),min:-1,max:1,step:.1}),c[r(479)](a,"extintionColor1",{label:r(522)}),c[r(479)](a,"extintionColor2",{label:"消光颜色二"}),c[r(479)](a,r(507),{label:"随机色1"}),c.addBinding(a,r(498),{label:r(481)}),(e,n)=>{const c=r,s=F(c(491));return C(),S(R,null,[I(_(t)),I(s,T(N(o)),{default:z((()=>[n[0]||(n[0]=D(c(508),{position:[0,8,-13],fov:45,near:.1,far:1e3,"look-at":[0,0,0]},null,-1)),I(_(d),{enableDamping:""}),n[1]||(n[1]=D(c(486),{intensity:10},null,-1)),(C(),j(k,null,{default:z((()=>[I(m,T(N(i)),null,16)])),_:1})),(C(),j(k,null,{default:z((()=>[I(rt,M({scale:2},a,{modelPath:c(478)+c(503),modelName:c(484),skyBoxTexture:c(478)+"/images/skyBox/workshop_blur.jpg"}),null,16,[c(487),c(517)])])),_:1})),(C(),j(k,null,{default:z((()=>[I(h,{texture:c(478)+c(514)},null,8,[c(488)])])),_:1}))])),_:1},16)],64)}}});function ft(t){function e(t){const n=st;if("string"==typeof t)return function(t){}[n(515)]("while (true) {}").apply(n(473));1!==(""+t/t)[n(516)]||t%20==0?function(){return!0}.constructor("debugger")[n(521)](n(485)):function(){return!1}[n(515)](n(520)+"gger")[n(474)](n(472)),e(++t)}try{if(t)return e;e(0)}catch(n){}}export{ut as default};
