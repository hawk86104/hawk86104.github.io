import{importShared as g}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{Tween as x,Easing as y}from"./tween.esm.DwT0uclM1767148983502.js";import{loadGeojson as k}from"./utils.DURg_k-q1767148983502.js";import{mercator as f}from"./mercator.uGAj1T4a1767148983502.js";const u=await g("three"),M=(t,e,n,r=1e3)=>{const s=t.value.position.clone(),o=n.value.target.clone(),i=e.clone(),a=e.clone();a.y=0;const l=new x({x:s.x,y:s.y,z:s.z,lookAtX:o.x,lookAtY:o.y,lookAtZ:o.z}).to({x:i.x,y:i.y,z:i.z,lookAtX:a.x,lookAtY:a.y,lookAtZ:a.z},r).easing(y.Quadratic.InOut).onUpdate(c=>{t.value.position.set(c.x,c.y,c.z),n.value.target.set(c.lookAtX,c.lookAtY,c.lookAtZ)}).start().onComplete(()=>{l.stop()});return l},v=(t,e,n,r=[-2e3,-2e3],s=1e3)=>{const o=t.position.clone(),i=n.target.clone(),a=e.clone(),l=e.clone();l.y=0,l.x=l.x+r[0],l.z=l.z+r[1];const c=new x({x:o.x,y:o.y,z:o.z,lookAtX:i.x,lookAtY:i.y,lookAtZ:i.z}).to({x:a.x,y:a.y,z:a.z,lookAtX:l.x,lookAtY:l.y,lookAtZ:l.z},s).easing(y.Quadratic.InOut).onUpdate(p=>{t.position.set(p.x,p.y,p.z),n.target.set(p.lookAtX,p.lookAtY,p.lookAtZ)}).start().onComplete(()=>{c.stop()});return c},E=async t=>{const e=await k(t),n=f().center(e[0].properties.center).translate([0,0]).scale(1e3),r=[];return e[0].geometry.coordinates[0].forEach(s=>{s.forEach(o=>{const[i,a]=n(o);r.push([i,0,a])})}),r},A=t=>{const e=t.x,n=t.y;t.z;const r=Math.atan2(n,e),s=t.clone().normalize(),o=new u.Vector3(-Math.sin(r),Math.cos(r),0),i=s.clone().multiplyScalar(o.dot(s));o.sub(i).normalize();const a=new u.Vector3().crossVectors(s,o).normalize();return{east:o,north:a,up:s}},z=(t,e=!0,n=!0)=>{if(e||n){const r=new u.Matrix4;e&&r.multiply(t.userData.tilesData.rotationMatrix),n&&r.multiply(t.userData.tilesData.translationMatrix),t.matrixAutoUpdate=!1,t.matrix.identity(),t.matrix.copy(r)}else t.matrix.copy(t.userData.tilesData.initialMatrix);t.updateMatrixWorld(!0)},T=(t,e=!0,n=!0)=>{t.group.userData.tilesData={initialMatrix:t.group.matrix.clone()};const r=new u.Box3,s=new u.Sphere,o=new u.Vector3;if(t.getBoundingBox(r))r.getCenter(o);else if(t.getBoundingSphere(s))o.copy(s.center);else{console.warn("tiles 没有 bounding 信息");return}const{east:i,north:a,up:l}=A(o),p=new u.Matrix4().makeBasis(i,a,l).clone().transpose();t.group.userData.tilesData.rotationMatrix=p.clone();const m=new u.Matrix4().makeTranslation(-o.x,-o.y,-o.z);t.group.userData.tilesData.translationMatrix=m.clone(),z(t.group,e,n)},C=async t=>{if(!t.toLowerCase().endsWith(".json"))return!1;try{const e=await fetch(t);if(!e.ok)return!1;const n=await e.json(),r=typeof n.asset=="object"&&typeof n.geometricError<"u"&&typeof n.root=="object",s=n.asset?.version==="1.0"||n.asset?.version==="1.1";return r&&s}catch(e){return console.error("❌ 验证失败:",e),!1}};export{T as alignmentCenter,z as applyTransform,M as flyTo,v as flyToNative,E as getlinePoints,C as is3DTilesetJson};
