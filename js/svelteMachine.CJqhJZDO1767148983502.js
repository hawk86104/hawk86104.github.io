import{importShared as p}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{Fs as R,_l as C,ol as L,Kk as M}from"./index.DTe2qqjO1767148983502.js";import{loadJsonFile as j,loadImageToBase64 as A}from"./utils.CpCKOQ7U1767148983502.js";import{loading as F}from"./generalFont.vue_vue_type_script_setup_true_lang.Cx7Vff0m1767148983502.js";import"./default.vue_vue_type_script_setup_true_lang.Bjy6WD1C1767148983502.js";import"./three-mesh-ui.module.Cv5lk1vQ1767148983502.js";import"./domPanel.vue_vue_type_style_index_0_lang.DqrQKbSz1767148983502.js";const S=await p("three");window.THREE=S;const h={scene:null,renderer:null,camera:null,sizes:null},c={get renderer(){return h.renderer?.value},loader:new S.TextureLoader,get scene(){return h.scene?.value},get camera(){return h.camera?.value},get width(){return h.sizes?.width?.value},get height(){return h.sizes?.height?.value},get dom(){return h.renderer?.value.domElement.parentElement},get canvas(){return h.renderer?.value.domElement},events:{},init(t,e,n,o){h.scene=t,h.renderer=e,h.camera=n,h.sizes=o},load(t){const e={"1d0e8871-bd60-47f9-8ab7-232dabd30201":[{name:"SpotLightEvent",source:`this.shadow.mapSize.width = 1024 * 2
this.shadow.mapSize.height = 1024 * 2
this.shadow.camera.near = 1
this.shadow.camera.far = 10
this.shadow.bias = -0.0075
this.shadow.radius = 24
this.target.position.copy(this.position.clone().setY(0))
function update( event ) {}`}],"beea1423-1e37-47ab-9443-f8429259e120":[{name:"dirb",source:`this.shadow.mapSize.width = 1024 * 2
this.shadow.mapSize.height = 1024 * 2
this.shadow.camera.near = 1
this.shadow.camera.far = 50
this.shadow.camera.top = 80
this.shadow.camera.bottom = -80
this.shadow.camera.left = -80
this.shadow.camera.right = 80
this.shadow.radius = 24
this.shadow.bias = -0.0075
function update( event ) {}`}],"31517222-A9A7-4EAF-B5F6-60751C0BABA3":[{name:"senceScirpt",source:`this.environment.mapping = THREE.EquirectangularReflectionMapping;
this.environment.colorSpace = THREE.SRGBColorSpace;
function update( event ) {}`}]};this.events={init:[],start:[],stop:[],keydown:[],keyup:[],pointerdown:[],pointerup:[],pointermove:[],update:[]};let n="player,renderer,scene,camera";const o={};for(const a in this.events)n+=`,${a}`,o[a]=a;const i=JSON.stringify(o).replace(/\"/g,"");for(const a in e){let l=a;a===t.uuid&&(l=this.scene.uuid);const d=this.scene.getObjectByProperty("uuid",l,!0);if(d===void 0){console.warn("player: Script without object.",l);continue}const m=e[a];for(let s=0;s<m.length;s++){const f=m[s],y=new Function(n,`${f.source}
return ${i};`).bind(d)(this,this.renderer,this.scene,this.camera);for(const r in y)if(y[r]!==void 0){if(this.events[r]===void 0){console.warn("player: Event type not supported (",r,")");continue}this.events[r].push(y[r].bind(d))}}this.dispatch(this.events.init,arguments)}},dispatch(t,e){for(let n=0,o=t.length;n<o;n++)t[n](e)},setCamera(t){console.warn("暂时不考虑摄像机的设置函数",t)},setScene(t){console.warn("暂时不考虑场景的设置函数",t)},setPixelRatio(t){console.warn("暂时不考虑像素比的设置函数",t)},setSize(t){console.warn("暂时不考虑尺寸的设置函数",t)},dispose(){console.warn("暂时不考虑释放资源的函数")},onKeyDown(t){c.dispatch(c.events.keydown,t)},onKeyUp(t){c.dispatch(c.events.keyup,t)},onPointerDown(t){c.dispatch(c.events.pointerdown,t)},onPointerUp(t){c.dispatch(c.events.pointerup,t)},onPointerMove(t){c.dispatch(c.events.pointermove,t)},play(){document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp),document.addEventListener("pointerdown",this.onPointerDown),document.addEventListener("pointerup",this.onPointerUp),document.addEventListener("pointermove",this.onPointerMove),this.dispatch(this.events.start,null)},stop(){document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("pointerdown",this.onPointerDown),document.removeEventListener("pointerup",this.onPointerUp),document.removeEventListener("pointermove",this.onPointerMove),this.dispatch(this.events.stop,arguments)},render(t,e){this.dispatch(this.events.update,{time:t,delta:e})}},N=[{x:-16.017528533935547,y:2.4581613540649414,z:53.098697662353516},{x:-11.40013599395752,y:2.4513251781463623,z:43.62754821777344},{x:-7.9051361083984375,y:2.4462289810180664,z:36.4436149597168},{x:-5.53253173828125,y:2.442873001098633,z:31.546899795532227},{x:-4.282320976257324,y:2.4412572383880615,z:28.937395095825195},{x:-3.9756288528442383,y:2.4410974979400635,z:28.24086570739746},{x:-3.7963345050811768,y:2.4410974979400635,z:27.74983024597168},{x:-3.6438193321228027,y:2.4410974979400635,z:27.253768920898438},{x:-3.5180840492248535,y:2.4410974979400635,z:26.75269317626953},{x:-3.419203519821167,y:2.4411063194274902,z:26.243703842163086},{x:-3.3517673015594482,y:2.4416656494140625,z:25.55027961730957},{x:-3.318483829498291,y:2.4430952072143555,z:24.5682430267334},{x:-3.319352865219116,y:2.445394515991211,z:23.297592163085938},{x:-3.354374647140503,y:2.448564052581787,z:21.73832893371582},{x:-3.4121222496032715,y:2.4521596431732178,z:19.611284255981445},{x:-3.461057662963867,y:2.454956293106079,z:16.145946502685547},{x:-3.49935245513916,y:2.456882953643799,z:11.297648429870605},{x:-3.5270066261291504,y:2.457939386367798,z:5.066390037536621},{x:-3.544764518737793,y:2.4581613540649414,z:-2.423649311065674},{x:-3.565464973449707,y:2.4581613540649414,z:-9.03036880493164},{x:-3.5937604904174805,y:2.4581613540649414,z:-13.977668762207031},{x:-3.629650592803955,y:2.4581613540649414,z:-17.265522003173828},{x:-3.673135280609131,y:2.4581613540649414,z:-18.893949508666992},{x:-3.7082104682922363,y:2.4581613540649414,z:-19.473438262939453},{x:-3.7077581882476807,y:2.4581613540649414,z:-20.038450241088867},{x:-3.6713337898254395,y:2.4581613540649414,z:-20.605941772460938},{x:-3.5989370346069336,y:2.4581613540649414,z:-21.175914764404297},{x:-3.3510568141937256,y:2.4581613540649414,z:-22.262161254882812},{x:-1.7961064577102661,y:2.4581615924835205,z:-28.032060623168945},{x:1.3139424324035645,y:2.4581618309020996,z:-39.39905548095703},{x:5.9790754318237305,y:2.458162546157837,z:-56.36309814453125},{x:12.19931411743164,y:2.458163261413574,z:-78.92425537109375}],O=!1,T={points:N,closed:O},E=await p("three");function V(t){const e=t.points,n=[];for(const i of e){const a=i.x,l=i.y,d=i.z;n.unshift(new E.Vector3(a,l,d))}const o=new E.CatmullRomCurve3(n);return o.closed=t.closed,o}const g=V(T),x=new E.Matrix4;function H(t){const e=g.points.length/2,n=new E.InstancedMesh(t.geometry,t.material,e);n.userData={progresses:[]};for(let o=0;o<e;o++){const i=o/(e-1),a=g.getPointAt(i);n.userData.progresses[o]=i,x.setPosition(a),n.setMatrixAt(o,x)}return n}function K(t){const e=t.userData.progresses;for(let n=0;n<t.count;n++){const o=g.getPointAt(e[n]);x.setPosition(o),t.setMatrixAt(n,x),e[n]+=5e-4,e[n]>1&&(e[n]=0)}t.instanceMatrix.needsUpdate=!0,t.computeBoundingSphere()}function U(t){const e=[];e.push(t[2].clone()),e.push(t[4].clone()),e.push(t[5].clone()),e.push(t[2].clone()),e.push(t[5].clone()),e.push(t[4].clone()),e.push(t[2].clone()),e.push(t[4].clone());for(let n=0;n<e.length;n++){const o=n/e.length*.6;e[n].userData={progress:o};const i=g.getPointAt(o);e[n].position.copy(i),e[n].visible=!0}return e}function W(t){for(let e=0;e<t.length;e++){t[e].userData.progress+=5e-4,t[e].userData.progress>.6&&(t[e].userData.progress=0);const n=t[e].userData.progress,o=g.getPointAt(n);t[e].name==="flat_item"&&(o.y=1.5),t[e].position.copy(o)}}function J(t){const e=[];for(let n=0;n<6;n++){e.push(t[3].clone());const o=1-n/6*.4-.04;e[n].userData={progress:o};const i=g.getPointAt(o);e[n].position.copy(i),e[n].visible=!0}return e}function G(t){for(let e=0;e<t.length;e++){t[e].userData.progress+=5e-4,t[e].userData.progress>1&&(t[e].userData.progress=1-5/6*.4-.04);const n=t[e].userData.progress,o=g.getPointAt(n);t[e].position.copy(o)}}const{defineComponent:I}=await p("vue"),{createElementVNode:v,Fragment:q,openBlock:Y,createElementBlock:Q}=await p("vue"),X=["object"],Z=["object"],ee=["object"],te=["object"],ne=["object"],oe=["object"],se=["object"],B=await p("three"),re=I({__name:"firstLevel-bf61e255d699",props:{object:{}},setup(t){const e=t,{scene:n}=R(),o=H(e.object[1]);n.value.add(o);const i=U(e.object),a=new B.Group;a.position.set(0,1,0),a.add(...i),n.value.add(a);const l=J(e.object),d=new B.Group;d.add(...l),d.position.set(0,1,0),n.value.add(d);const{onBeforeRender:m}=C();return m(({delta:s,elapsed:f})=>{o&&K(o),i&&W(i),l&&G(l)}),(s,f)=>(Y(),Q(q,null,[v("primitive",{object:s.object[0]},null,8,X),v("primitive",{object:s.object[1],visible:!1},null,8,Z),v("primitive",{object:s.object[2]},null,8,ee),v("primitive",{object:s.object[4]},null,8,te),v("primitive",{object:s.object[5]},null,8,ne),v("primitive",{object:s.object[6]},null,8,oe),v("primitive",{object:s.object[3]},null,8,se)],64))}}),{withAsyncContext:z,defineComponent:ie}=await p("vue"),{unref:w,createVNode:ae,createElementVNode:_,Fragment:ce,openBlock:le,createElementBlock:ue}=await p("vue"),pe=["object"],de=["object"],he=["object"],me=["object"],fe=["object"],{onMounted:ve,ref:ge}=await p("vue"),we=await p("three"),ye=ie({__name:"scene",async setup(t){let e,n;const{scene:o,renderer:i,camera:a,sizes:l}=R();c.init(o,i,a,l);const d=new we.ObjectLoader,m=([e,n]=z(()=>j("./plugins/tresEditor/svelteMachine/json/scene.json")),e=await e,n(),e);if(m.geometries){for(const r of m.geometries)if(r.data&&r.data.startsWith("url:")){let u=r.data.slice(4);u.startsWith("geometries/")&&(u=`./plugins/tresEditor/svelteMachine/${u}`),r.data=([e,n]=z(()=>j(u)),e=await e,n(),e)}}if(m.images){for(const r of m.images)if(r.url&&r.url.startsWith("url:")){let u=r.url.slice(4);u.startsWith("images/")&&(u=`./plugins/tresEditor/svelteMachine/${u}`),r.url=([e,n]=z(()=>A(u)),e=await e,n(),e)}}const s=d.parse(m),f=ge(null);ve(()=>{if(o.value.background=s.background,o.value.environment=s.environment,o.value.fog=s.fog,c.load(s),c.play(),f.value){const r=f.value;r.target.position.set(-3.8,0,-2.3),o.value.add(r.target),r.angle=Math.PI/2.5}});const{onBeforeRender:y}=C();return y(({delta:r,elapsed:u})=>{if(c.renderer&&c.render(u*1e3,r*1e3),f.value){const D=f.value;D.intensity=100+Math.sin(u*2)*100}}),(r,u)=>(le(),ue(ce,null,[_("primitive",{object:w(s).children[0]},[ae(re,{object:w(s).children[0].children},null,8,["object"])],8,pe),_("primitive",{object:w(s).children[1]},null,8,de),_("primitive",{object:w(s).children[2]},null,8,he),_("primitive",{object:w(s).children[3]},null,8,me),_("primitive",{object:w(s).children[4],ref_key:"spotLightRef",ref:f},null,8,fe)],64))}}),{defineComponent:_e}=await p("vue"),{unref:P,createVNode:b,createElementVNode:be,Suspense:Ee,withCtx:$,openBlock:k,createBlock:xe,normalizeProps:ze,guardReactiveProps:Pe,Fragment:je,createElementBlock:Be}=await p("vue"),$e=await p("three"),{reactive:ke,watch:Re,ref:Ce}=await p("vue"),Oe=_e({__name:"svelteMachine",setup(t){const e=ke({clearColor:"#201919",windowSize:!0,antialias:!0,shadows:!0,shadowMapType:2,toneMapping:3,toneMappingExposure:1.75}),n={metadata:{version:4.6,type:"Object",generator:"Object3D.toJSON"},object:{type:"PerspectiveCamera",name:"Camera",layers:1,matrix:[-.6267758441936044,-27755575615628914e-33,.7791996157182023,0,.48061725621232265,.787112942007701,.3866009176850464,0,-.6133181019392243,.6168088978962458,-.49334337870258826,0,-80.48773984917322,89.13969162136891,-91.54490099940386,1],up:[0,1,0],fov:50,zoom:1,near:.01,far:1e3,focus:10,aspect:1.1063238359972203,filmGauge:35,filmOffset:0}},i=new $e.ObjectLoader().parse(n),a=Ce(null);return Re(()=>a.value,l=>{l.copy(i)}),(l,d)=>(k(),Be(je,null,[b(P(F)),b(P(L),ze(Pe(e)),{default:$(()=>[b(P(M)),be("TresPerspectiveCamera",{ref_key:"cameraRef",ref:a,uuid:"9ca45c84-3c16-48da-b0a2-9e469abea3d1",name:"Camera"},null,512),(k(),xe(Ee,null,{default:$(()=>[b(ye)]),_:1}))]),_:1},16)],64))}});export{Oe as default};
