var t=t||{};t.collision||(t.collision={}),t.collision.broadphase||(t.collision.broadphase={}),t.collision.broadphase.BroadPhase=class{constructor(i){this._type=i,this._numProxies=0,this._proxyList=null,this._proxyListLast=null,this._proxyPairList=null,this._incremental=!1,this._testCount=0,this._proxyPairPool=null,this._idCount=0,this._convexSweep=new t.collision.broadphase._BroadPhase.ConvexSweepGeometry,this._aabb=new t.collision.broadphase._BroadPhase.AabbGeometry,this.identity=new t.common.Transform,this.zero=new t.common.Vec3,this.rayCastHit=new t.collision.geometry.RayCastHit}createProxy(t,i){return null}destroyProxy(t){}moveProxy(t,i,a){}isOverlapping(t,i){return t._aabbMinX<i._aabbMaxX&&t._aabbMaxX>i._aabbMinX&&t._aabbMinY<i._aabbMaxY&&t._aabbMaxY>i._aabbMinY&&t._aabbMinZ<i._aabbMaxZ&&t._aabbMaxZ>i._aabbMinZ}collectPairs(){}getProxyPairList(){return this._proxyPairList}isIncremental(){return this._incremental}getTestCount(){return this._testCount}rayCast(t,i,a){}convexCast(t,i,a,s){}aabbTest(t,i){}},t.collision.geometry||(t.collision.geometry={}),t.collision.geometry.Geometry=class{constructor(t){this._type=t,this._volume=0}_updateMass(){}_computeAabb(t,i){}_rayCastLocal(t,i,a,s,o,n,r){return!1}getType(){return this._type}getVolume(){return this._volume}rayCast(t,i,a,s){var o,n,r,_,e,h,l=t;o=l.x,n=l.y,r=l.z;var c,m,v,b,x,p,f=i;if(_=f.x,e=f.y,h=f.z,o-=a._positionX,n-=a._positionY,r-=a._positionZ,_-=a._positionX,e-=a._positionY,h-=a._positionZ,c=a._rotation00*o+a._rotation10*n+a._rotation20*r,m=a._rotation01*o+a._rotation11*n+a._rotation21*r,v=a._rotation02*o+a._rotation12*n+a._rotation22*r,o=c,n=m,r=v,b=a._rotation00*_+a._rotation10*e+a._rotation20*h,x=a._rotation01*_+a._rotation11*e+a._rotation21*h,p=a._rotation02*_+a._rotation12*e+a._rotation22*h,_=b,e=x,h=p,this._rayCastLocal(o,n,r,_,e,h,s)){var u,y,X,g,z,d,Y=s.position;u=Y.x,y=Y.y,X=Y.z;var Z,M,I,V,L,w,k=s.normal;g=k.x,z=k.y,d=k.z,Z=a._rotation00*u+a._rotation01*y+a._rotation02*X,M=a._rotation10*u+a._rotation11*y+a._rotation12*X,I=a._rotation20*u+a._rotation21*y+a._rotation22*X,u=Z,y=M,X=I,V=a._rotation00*g+a._rotation01*z+a._rotation02*d,L=a._rotation10*g+a._rotation11*z+a._rotation12*d,w=a._rotation20*g+a._rotation21*z+a._rotation22*d,g=V,z=L,d=w,u+=a._positionX,y+=a._positionY,X+=a._positionZ;var B=s.position;B.x=u,B.y=y,B.z=X;var A=s.normal;return A.x=g,A.y=z,A.z=d,!0}return!1}},t.collision.geometry.ConvexGeometry=class extends t.collision.geometry.Geometry{constructor(i){super(i),this._gjkMargin=t.common.Setting.defaultGJKMargin,this._useGjkRayCast=!1}getGjkMergin(){return this._gjkMargin}setGjkMergin(t){t<0&&(t=0),this._gjkMargin=t}computeLocalSupportingVertex(t,i){}rayCast(i,a,s,o){return this._useGjkRayCast?t.collision.narrowphase.detector.gjkepa.GjkEpa.instance.rayCast(this,s,i,a,o):super.rayCast(i,a,s,o)}},t.collision.broadphase._BroadPhase||(t.collision.broadphase._BroadPhase={}),t.collision.broadphase._BroadPhase.ConvexSweepGeometry=class extends t.collision.geometry.ConvexGeometry{constructor(){super(-1)}init(i,a,s){var o,n,r;this.c=i;var _,e,h,l=s;o=l.x,n=l.y,r=l.z,_=a._rotation00*o+a._rotation10*n+a._rotation20*r,e=a._rotation01*o+a._rotation11*n+a._rotation21*r,h=a._rotation02*o+a._rotation12*n+a._rotation22*r,this.localTranslation=new t.common.Vec3;var c=this.localTranslation;c.x=_,c.y=e,c.z=h,this._gjkMargin=i._gjkMargin}computeLocalSupportingVertex(t,i){this.c.computeLocalSupportingVertex(t,i);var a=this.localTranslation;if(t.x*a.x+t.y*a.y+t.z*a.z>0){var s=this.localTranslation,o=i.x+s.x,n=i.y+s.y,r=i.z+s.z;i.x=o,i.y=n,i.z=r}}},t.collision.broadphase._BroadPhase.AabbGeometry=class extends t.collision.geometry.ConvexGeometry{constructor(){super(-1),this.min=new t.common.Vec3,this.max=new t.common.Vec3}computeLocalSupportingVertex(t,i){i.x=t.x>0?this.max.x:this.min.x,i.y=t.y>0?this.max.y:this.min.y,i.z=t.z>0?this.max.z:this.min.z}},t.collision.broadphase.BroadPhaseProxyCallback=class{constructor(){}process(t){}},t.collision.broadphase.BroadPhaseType=class{},t.collision.broadphase.Proxy=class{constructor(t,i){this.userData=t,this._id=i,this._prev=null,this._next=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}getId(){return this._id}getFatAabb(){var i=new t.collision.geometry.Aabb;return i._minX=this._aabbMinX,i._minY=this._aabbMinY,i._minZ=this._aabbMinZ,i._maxX=this._aabbMaxX,i._maxY=this._aabbMaxY,i._maxZ=this._aabbMaxZ,i}getFatAabbTo(t){t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ}},t.collision.broadphase.ProxyPair=class{constructor(){this._p1=null,this._p2=null}getProxy1(){return this._p1}getProxy2(){return this._p2}getNext(){return this._next}},t.collision.broadphase.bruteforce||(t.collision.broadphase.bruteforce={}),t.collision.broadphase.bruteforce.BruteForceBroadPhase=class extends t.collision.broadphase.BroadPhase{constructor(){super(1),this._incremental=!1}createProxy(i,a){var s=new t.collision.broadphase.Proxy(i,this._idCount++);return this._numProxies++,null==this._proxyList?(this._proxyList=s,this._proxyListLast=s):(this._proxyListLast._next=s,s._prev=this._proxyListLast,this._proxyListLast=s),s._aabbMinX=a._minX,s._aabbMinY=a._minY,s._aabbMinZ=a._minZ,s._aabbMaxX=a._maxX,s._aabbMaxY=a._maxY,s._aabbMaxZ=a._maxZ,s}destroyProxy(t){this._numProxies--;var i=t._prev,a=t._next;null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null,t.userData=null}moveProxy(t,i,a){t._aabbMinX=i._minX,t._aabbMinY=i._minY,t._aabbMinZ=i._minZ,t._aabbMaxX=i._maxX,t._aabbMaxY=i._maxY,t._aabbMaxZ=i._maxZ}collectPairs(){var i=this._proxyPairList;if(null!=i){for(;i._p1=null,i._p2=null,null!=(i=i._next););this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}this._testCount=0;for(var a=this._proxyList;null!=a;){for(var s=a._next,o=a._next;null!=o;){var n=o._next;if(this._testCount++,a._aabbMinX<o._aabbMaxX&&a._aabbMaxX>o._aabbMinX&&a._aabbMinY<o._aabbMaxY&&a._aabbMaxY>o._aabbMinY&&a._aabbMinZ<o._aabbMaxZ&&a._aabbMaxZ>o._aabbMinZ){var r=this._proxyPairPool;null!=r?(this._proxyPairPool=r._next,r._next=null):r=new t.collision.broadphase.ProxyPair;var _=r;null==this._proxyPairList||(_._next=this._proxyPairList),this._proxyPairList=_,_._p1=a,_._p2=o}o=n}a=s}}rayCast(t,i,a){var s,o,n,r,_,e,h=t;s=h.x,o=h.y,n=h.z;var l=i;r=l.x,_=l.y,e=l.z;for(var c=this._proxyList;null!=c;){var m,v=c._next,b=s,x=o,p=n,f=r,u=_,y=e,X=b<f?b:f,g=x<u?x:u,z=p<y?p:y,d=b>f?b:f,Y=x>u?x:u,Z=p>y?p:y,M=c._aabbMinX,I=c._aabbMinY,V=c._aabbMinZ,L=c._aabbMaxX,w=c._aabbMaxY,k=c._aabbMaxZ;if(M>d||L<X||I>Y||w<g||V>Z||k<z)m=!1;else{var B,A,P=f-b,S=u-x,T=y-p,C=P<0?-P:P,j=S<0?-S:S,R=T<0?-T:T,q=.5*(L-M),E=.5*(w-I),D=.5*(k-V),F=b-.5*(L+M),N=x-.5*(w+I),W=p-.5*(k+V),G=N*T-W*S;if((G<0?-G:G)-(E*R+D*j)>0)A=!0;else{var J=W*P-F*T;A=(J<0?-J:J)-(D*C+q*R)>0}if(A)B=!0;else{var O=F*S-N*P;B=(O<0?-O:O)-(q*j+E*C)>0}m=!B}m&&a.process(c),c=v}}convexCast(i,a,s,o){for(var n=this._proxyList;null!=n;){var r=n._next,_=this._aabb.min;_.x=n._aabbMinX,_.y=n._aabbMinY,_.z=n._aabbMinZ;var e=this._aabb.max;e.x=n._aabbMaxX,e.y=n._aabbMaxY,e.z=n._aabbMaxZ,this._convexSweep.init(i,a,s);var h=t.collision.narrowphase.detector.gjkepa.GjkEpa.instance;0==h.computeClosestPointsImpl(this._convexSweep,this._aabb,a,this.identity,null,!1)&&h.distance<=0&&o.process(n),n=r}}aabbTest(t,i){for(var a=this._proxyList;null!=a;){var s=a._next;t._minX<a._aabbMaxX&&t._maxX>a._aabbMinX&&t._minY<a._aabbMaxY&&t._maxY>a._aabbMinY&&t._minZ<a._aabbMaxZ&&t._maxZ>a._aabbMinZ&&i.process(a),a=s}}},t.collision.broadphase.bvh||(t.collision.broadphase.bvh={}),t.collision.broadphase.bvh.BvhBroadPhase=class extends t.collision.broadphase.BroadPhase{constructor(){super(2),this._incremental=!0,this._tree=new t.collision.broadphase.bvh.BvhTree;var i=new Array(1024);this.movedProxies=i,this.numMovedProxies=0}collide(i,a){this._testCount++;var s=0==i._height,o=0==a._height;if(i==a){if(s)return;return this.collide(i._children[0],a),void this.collide(i._children[1],a)}if(i._aabbMinX<a._aabbMaxX&&i._aabbMaxX>a._aabbMinX&&i._aabbMinY<a._aabbMaxY&&i._aabbMaxY>a._aabbMinY&&i._aabbMinZ<a._aabbMaxZ&&i._aabbMaxZ>a._aabbMinZ){if(s&&o){var n=i._proxy,r=a._proxy,_=this._proxyPairPool;null!=_?(this._proxyPairPool=_._next,_._next=null):_=new t.collision.broadphase.ProxyPair;var e=_;return null==this._proxyPairList||(e._next=this._proxyPairList),this._proxyPairList=e,e._p1=n,void(e._p2=r)}o||i._height>a._height?(this.collide(i._children[0],a),this.collide(i._children[1],a)):(this.collide(a._children[0],i),this.collide(a._children[1],i))}}rayCastRecursive(t,i,a,s,o,n,r,_){var e,h,l,c,m,v,b,x=e=i,p=h=a,f=l=s,u=c=o,y=m=n,X=v=r,g=x<u?x:u,z=p<y?p:y,d=f<X?f:X,Y=x>u?x:u,Z=p>y?p:y,M=f>X?f:X,I=t._aabbMinX,V=t._aabbMinY,L=t._aabbMinZ,w=t._aabbMaxX,k=t._aabbMaxY,B=t._aabbMaxZ;if(I>Y||w<g||V>Z||k<z||L>M||B<d)b=!1;else{var A,P,S=u-x,T=y-p,C=X-f,j=S<0?-S:S,R=T<0?-T:T,q=C<0?-C:C,E=.5*(w-I),D=.5*(k-V),F=.5*(B-L),N=x-.5*(w+I),W=p-.5*(k+V),G=f-.5*(B+L),J=W*C-G*T;if((J<0?-J:J)-(D*q+F*R)>0)P=!0;else{var O=G*S-N*C;P=(O<0?-O:O)-(F*j+E*q)>0}if(P)A=!0;else{var H=N*T-W*S;A=(H<0?-H:H)-(E*R+D*j)>0}b=!A}b&&(0!=t._height?(this.rayCastRecursive(t._children[0],e,h,l,c,m,v,_),this.rayCastRecursive(t._children[1],e,h,l,c,m,v,_)):_.process(t._proxy))}convexCastRecursive(i,a,s,o,n){var r=this._aabb.min;r.x=i._aabbMinX,r.y=i._aabbMinY,r.z=i._aabbMinZ;var _=this._aabb.max;_.x=i._aabbMaxX,_.y=i._aabbMaxY,_.z=i._aabbMaxZ,this._convexSweep.init(a,s,o);var e=t.collision.narrowphase.detector.gjkepa.GjkEpa.instance;0==e.computeClosestPointsImpl(this._convexSweep,this._aabb,s,this.identity,null,!1)&&e.distance<=0&&(0!=i._height?(this.convexCastRecursive(i._children[0],a,s,o,n),this.convexCastRecursive(i._children[1],a,s,o,n)):n.process(i._proxy))}aabbTestRecursive(t,i,a){t._aabbMinX<i._maxX&&t._aabbMaxX>i._minX&&t._aabbMinY<i._maxY&&t._aabbMaxY>i._minY&&t._aabbMinZ<i._maxZ&&t._aabbMaxZ>i._minZ&&(0!=t._height?(this.aabbTestRecursive(t._children[0],i,a),this.aabbTestRecursive(t._children[1],i,a)):a.process(t._proxy))}createProxy(i,a){var s=new t.collision.broadphase.bvh.BvhProxy(i,this._idCount++);this._numProxies++,null==this._proxyList?(this._proxyList=s,this._proxyListLast=s):(this._proxyListLast._next=s,s._prev=this._proxyListLast,this._proxyListLast=s),s._aabbMinX=a._minX,s._aabbMinY=a._minY,s._aabbMinZ=a._minZ,s._aabbMaxX=a._maxX,s._aabbMaxY=a._maxY,s._aabbMaxZ=a._maxZ;var o,n,r,_=t.common.Setting.bvhProxyPadding;o=_,n=_,r=_,s._aabbMinX-=o,s._aabbMinY-=n,s._aabbMinZ-=r,s._aabbMaxX+=o,s._aabbMaxY+=n,s._aabbMaxZ+=r;var e=this._tree,h=e._nodePool;null!=h?(e._nodePool=h._next,h._next=null):h=new t.collision.broadphase.bvh.BvhNode;var l=h;if(l._proxy=s,s._leaf=l,l._aabbMinX=s._aabbMinX,l._aabbMinY=s._aabbMinY,l._aabbMinZ=s._aabbMinZ,l._aabbMaxX=s._aabbMaxX,l._aabbMaxY=s._aabbMaxY,l._aabbMaxZ=s._aabbMaxZ,e._numLeaves++,null==e.leafList?(e.leafList=l,e.leafListLast=l):(e.leafListLast._nextLeaf=l,l._prevLeaf=e.leafListLast,e.leafListLast=l),null==e._root)e._root=l;else{for(var c=e._root;c._height>0;){var m=e._strategy._decideInsertion(c,l);if(-1==m)break;c=c._children[m]}var v=c._parent,b=e._nodePool;null!=b?(e._nodePool=b._next,b._next=null):b=new t.collision.broadphase.bvh.BvhNode;var x=b;if(null==v)e._root=x;else{var p=c._childIndex;v._children[p]=x,x._parent=v,x._childIndex=p}var f=c._childIndex;x._children[f]=c,c._parent=x,c._childIndex=f;var u=1^c._childIndex;for(x._children[u]=l,l._parent=x,l._childIndex=u;null!=x;){if(e._strategy._balancingEnabled)if(x._height<2);else{var y=x._parent,X=x._children[0],g=x._children[1],z=X._height-g._height,d=x._childIndex;if(z>1){var Y=X._children[0],Z=X._children[1];if(Y._height>Z._height){X._children[1]=x,x._parent=X,x._childIndex=1,x._children[0]=Z,Z._parent=x,Z._childIndex=0;var M=X._children[0],I=X._children[1];X._aabbMinX=M._aabbMinX<I._aabbMinX?M._aabbMinX:I._aabbMinX,X._aabbMinY=M._aabbMinY<I._aabbMinY?M._aabbMinY:I._aabbMinY,X._aabbMinZ=M._aabbMinZ<I._aabbMinZ?M._aabbMinZ:I._aabbMinZ,X._aabbMaxX=M._aabbMaxX>I._aabbMaxX?M._aabbMaxX:I._aabbMaxX,X._aabbMaxY=M._aabbMaxY>I._aabbMaxY?M._aabbMaxY:I._aabbMaxY,X._aabbMaxZ=M._aabbMaxZ>I._aabbMaxZ?M._aabbMaxZ:I._aabbMaxZ;var V=X._children[0]._height,L=X._children[1]._height;X._height=(V>L?V:L)+1;var w=x._children[0],k=x._children[1];x._aabbMinX=w._aabbMinX<k._aabbMinX?w._aabbMinX:k._aabbMinX,x._aabbMinY=w._aabbMinY<k._aabbMinY?w._aabbMinY:k._aabbMinY,x._aabbMinZ=w._aabbMinZ<k._aabbMinZ?w._aabbMinZ:k._aabbMinZ,x._aabbMaxX=w._aabbMaxX>k._aabbMaxX?w._aabbMaxX:k._aabbMaxX,x._aabbMaxY=w._aabbMaxY>k._aabbMaxY?w._aabbMaxY:k._aabbMaxY,x._aabbMaxZ=w._aabbMaxZ>k._aabbMaxZ?w._aabbMaxZ:k._aabbMaxZ;var B=x._children[0]._height,A=x._children[1]._height;x._height=(B>A?B:A)+1}else{X._children[0]=x,x._parent=X,x._childIndex=0,x._children[0]=Y,Y._parent=x,Y._childIndex=0;var P=X._children[0],S=X._children[1];X._aabbMinX=P._aabbMinX<S._aabbMinX?P._aabbMinX:S._aabbMinX,X._aabbMinY=P._aabbMinY<S._aabbMinY?P._aabbMinY:S._aabbMinY,X._aabbMinZ=P._aabbMinZ<S._aabbMinZ?P._aabbMinZ:S._aabbMinZ,X._aabbMaxX=P._aabbMaxX>S._aabbMaxX?P._aabbMaxX:S._aabbMaxX,X._aabbMaxY=P._aabbMaxY>S._aabbMaxY?P._aabbMaxY:S._aabbMaxY,X._aabbMaxZ=P._aabbMaxZ>S._aabbMaxZ?P._aabbMaxZ:S._aabbMaxZ;var T=X._children[0]._height,C=X._children[1]._height;X._height=(T>C?T:C)+1;var j=x._children[0],R=x._children[1];x._aabbMinX=j._aabbMinX<R._aabbMinX?j._aabbMinX:R._aabbMinX,x._aabbMinY=j._aabbMinY<R._aabbMinY?j._aabbMinY:R._aabbMinY,x._aabbMinZ=j._aabbMinZ<R._aabbMinZ?j._aabbMinZ:R._aabbMinZ,x._aabbMaxX=j._aabbMaxX>R._aabbMaxX?j._aabbMaxX:R._aabbMaxX,x._aabbMaxY=j._aabbMaxY>R._aabbMaxY?j._aabbMaxY:R._aabbMaxY,x._aabbMaxZ=j._aabbMaxZ>R._aabbMaxZ?j._aabbMaxZ:R._aabbMaxZ;var q=x._children[0]._height,E=x._children[1]._height;x._height=(q>E?q:E)+1}null!=y?(y._children[d]=X,X._parent=y,X._childIndex=d):(e._root=X,X._parent=null),x=X}else if(z<-1){var D=g._children[0],F=g._children[1];if(D._height>F._height){g._children[1]=x,x._parent=g,x._childIndex=1,x._children[1]=F,F._parent=x,F._childIndex=1;var N=g._children[0],W=g._children[1];g._aabbMinX=N._aabbMinX<W._aabbMinX?N._aabbMinX:W._aabbMinX,g._aabbMinY=N._aabbMinY<W._aabbMinY?N._aabbMinY:W._aabbMinY,g._aabbMinZ=N._aabbMinZ<W._aabbMinZ?N._aabbMinZ:W._aabbMinZ,g._aabbMaxX=N._aabbMaxX>W._aabbMaxX?N._aabbMaxX:W._aabbMaxX,g._aabbMaxY=N._aabbMaxY>W._aabbMaxY?N._aabbMaxY:W._aabbMaxY,g._aabbMaxZ=N._aabbMaxZ>W._aabbMaxZ?N._aabbMaxZ:W._aabbMaxZ;var G=g._children[0]._height,J=g._children[1]._height;g._height=(G>J?G:J)+1;var O=x._children[0],H=x._children[1];x._aabbMinX=O._aabbMinX<H._aabbMinX?O._aabbMinX:H._aabbMinX,x._aabbMinY=O._aabbMinY<H._aabbMinY?O._aabbMinY:H._aabbMinY,x._aabbMinZ=O._aabbMinZ<H._aabbMinZ?O._aabbMinZ:H._aabbMinZ,x._aabbMaxX=O._aabbMaxX>H._aabbMaxX?O._aabbMaxX:H._aabbMaxX,x._aabbMaxY=O._aabbMaxY>H._aabbMaxY?O._aabbMaxY:H._aabbMaxY,x._aabbMaxZ=O._aabbMaxZ>H._aabbMaxZ?O._aabbMaxZ:H._aabbMaxZ;var U=x._children[0]._height,Q=x._children[1]._height;x._height=(U>Q?U:Q)+1}else{g._children[0]=x,x._parent=g,x._childIndex=0,x._children[1]=D,D._parent=x,D._childIndex=1;var K=g._children[0],$=g._children[1];g._aabbMinX=K._aabbMinX<$._aabbMinX?K._aabbMinX:$._aabbMinX,g._aabbMinY=K._aabbMinY<$._aabbMinY?K._aabbMinY:$._aabbMinY,g._aabbMinZ=K._aabbMinZ<$._aabbMinZ?K._aabbMinZ:$._aabbMinZ,g._aabbMaxX=K._aabbMaxX>$._aabbMaxX?K._aabbMaxX:$._aabbMaxX,g._aabbMaxY=K._aabbMaxY>$._aabbMaxY?K._aabbMaxY:$._aabbMaxY,g._aabbMaxZ=K._aabbMaxZ>$._aabbMaxZ?K._aabbMaxZ:$._aabbMaxZ;var tt=g._children[0]._height,it=g._children[1]._height;g._height=(tt>it?tt:it)+1;var at=x._children[0],st=x._children[1];x._aabbMinX=at._aabbMinX<st._aabbMinX?at._aabbMinX:st._aabbMinX,x._aabbMinY=at._aabbMinY<st._aabbMinY?at._aabbMinY:st._aabbMinY,x._aabbMinZ=at._aabbMinZ<st._aabbMinZ?at._aabbMinZ:st._aabbMinZ,x._aabbMaxX=at._aabbMaxX>st._aabbMaxX?at._aabbMaxX:st._aabbMaxX,x._aabbMaxY=at._aabbMaxY>st._aabbMaxY?at._aabbMaxY:st._aabbMaxY,x._aabbMaxZ=at._aabbMaxZ>st._aabbMaxZ?at._aabbMaxZ:st._aabbMaxZ;var ot=x._children[0]._height,nt=x._children[1]._height;x._height=(ot>nt?ot:nt)+1}null!=y?(y._children[d]=g,g._parent=y,g._childIndex=d):(e._root=g,g._parent=null),x=g}}var rt=x._children[0]._height,_t=x._children[1]._height;x._height=(rt>_t?rt:_t)+1;var et=x._children[0],ht=x._children[1];x._aabbMinX=et._aabbMinX<ht._aabbMinX?et._aabbMinX:ht._aabbMinX,x._aabbMinY=et._aabbMinY<ht._aabbMinY?et._aabbMinY:ht._aabbMinY,x._aabbMinZ=et._aabbMinZ<ht._aabbMinZ?et._aabbMinZ:ht._aabbMinZ,x._aabbMaxX=et._aabbMaxX>ht._aabbMaxX?et._aabbMaxX:ht._aabbMaxX,x._aabbMaxY=et._aabbMaxY>ht._aabbMaxY?et._aabbMaxY:ht._aabbMaxY,x._aabbMaxZ=et._aabbMaxZ>ht._aabbMaxZ?et._aabbMaxZ:ht._aabbMaxZ,x=x._parent}}if(!s._moved){if(s._moved=!0,this.movedProxies.length==this.numMovedProxies){for(var lt=this.numMovedProxies<<1,ct=new Array(lt),mt=0,vt=this.numMovedProxies;mt<vt;){var bt=mt++;ct[bt]=this.movedProxies[bt],this.movedProxies[bt]=null}this.movedProxies=ct}this.movedProxies[this.numMovedProxies++]=s}return s}destroyProxy(t){this._numProxies--;var i=t._prev,a=t._next;null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null;var s=t,o=this._tree,n=s._leaf;o._numLeaves--;var r=n._prevLeaf,_=n._nextLeaf;if(null!=r&&(r._nextLeaf=_),null!=_&&(_._prevLeaf=r),n==o.leafList&&(o.leafList=o.leafList._nextLeaf),n==o.leafListLast&&(o.leafListLast=o.leafListLast._prevLeaf),n._nextLeaf=null,n._prevLeaf=null,o._root==n)o._root=null;else{var e=n._parent,h=e._children[1^n._childIndex],l=e._parent;if(null==l)h._parent=null,h._childIndex=0,o._root=h,e._next=null,e._childIndex=0,e._children[0]=null,e._children[1]=null,e._childIndex=0,e._parent=null,e._height=0,e._proxy=null,e._next=o._nodePool,o._nodePool=e;else{h._parent=l;var c=e._childIndex;l._children[c]=h,h._parent=l,h._childIndex=c,e._next=null,e._childIndex=0,e._children[0]=null,e._children[1]=null,e._childIndex=0,e._parent=null,e._height=0,e._proxy=null,e._next=o._nodePool,o._nodePool=e;for(var m=l;null!=m;){if(o._strategy._balancingEnabled)if(m._height<2);else{var v=m._parent,b=m._children[0],x=m._children[1],p=b._height-x._height,f=m._childIndex;if(p>1){var u=b._children[0],y=b._children[1];if(u._height>y._height){b._children[1]=m,m._parent=b,m._childIndex=1,m._children[0]=y,y._parent=m,y._childIndex=0;var X=b._children[0],g=b._children[1];b._aabbMinX=X._aabbMinX<g._aabbMinX?X._aabbMinX:g._aabbMinX,b._aabbMinY=X._aabbMinY<g._aabbMinY?X._aabbMinY:g._aabbMinY,b._aabbMinZ=X._aabbMinZ<g._aabbMinZ?X._aabbMinZ:g._aabbMinZ,b._aabbMaxX=X._aabbMaxX>g._aabbMaxX?X._aabbMaxX:g._aabbMaxX,b._aabbMaxY=X._aabbMaxY>g._aabbMaxY?X._aabbMaxY:g._aabbMaxY,b._aabbMaxZ=X._aabbMaxZ>g._aabbMaxZ?X._aabbMaxZ:g._aabbMaxZ;var z=b._children[0]._height,d=b._children[1]._height;b._height=(z>d?z:d)+1;var Y=m._children[0],Z=m._children[1];m._aabbMinX=Y._aabbMinX<Z._aabbMinX?Y._aabbMinX:Z._aabbMinX,m._aabbMinY=Y._aabbMinY<Z._aabbMinY?Y._aabbMinY:Z._aabbMinY,m._aabbMinZ=Y._aabbMinZ<Z._aabbMinZ?Y._aabbMinZ:Z._aabbMinZ,m._aabbMaxX=Y._aabbMaxX>Z._aabbMaxX?Y._aabbMaxX:Z._aabbMaxX,m._aabbMaxY=Y._aabbMaxY>Z._aabbMaxY?Y._aabbMaxY:Z._aabbMaxY,m._aabbMaxZ=Y._aabbMaxZ>Z._aabbMaxZ?Y._aabbMaxZ:Z._aabbMaxZ;var M=m._children[0]._height,I=m._children[1]._height;m._height=(M>I?M:I)+1}else{b._children[0]=m,m._parent=b,m._childIndex=0,m._children[0]=u,u._parent=m,u._childIndex=0;var V=b._children[0],L=b._children[1];b._aabbMinX=V._aabbMinX<L._aabbMinX?V._aabbMinX:L._aabbMinX,b._aabbMinY=V._aabbMinY<L._aabbMinY?V._aabbMinY:L._aabbMinY,b._aabbMinZ=V._aabbMinZ<L._aabbMinZ?V._aabbMinZ:L._aabbMinZ,b._aabbMaxX=V._aabbMaxX>L._aabbMaxX?V._aabbMaxX:L._aabbMaxX,b._aabbMaxY=V._aabbMaxY>L._aabbMaxY?V._aabbMaxY:L._aabbMaxY,b._aabbMaxZ=V._aabbMaxZ>L._aabbMaxZ?V._aabbMaxZ:L._aabbMaxZ;var w=b._children[0]._height,k=b._children[1]._height;b._height=(w>k?w:k)+1;var B=m._children[0],A=m._children[1];m._aabbMinX=B._aabbMinX<A._aabbMinX?B._aabbMinX:A._aabbMinX,m._aabbMinY=B._aabbMinY<A._aabbMinY?B._aabbMinY:A._aabbMinY,m._aabbMinZ=B._aabbMinZ<A._aabbMinZ?B._aabbMinZ:A._aabbMinZ,m._aabbMaxX=B._aabbMaxX>A._aabbMaxX?B._aabbMaxX:A._aabbMaxX,m._aabbMaxY=B._aabbMaxY>A._aabbMaxY?B._aabbMaxY:A._aabbMaxY,m._aabbMaxZ=B._aabbMaxZ>A._aabbMaxZ?B._aabbMaxZ:A._aabbMaxZ;var P=m._children[0]._height,S=m._children[1]._height;m._height=(P>S?P:S)+1}null!=v?(v._children[f]=b,b._parent=v,b._childIndex=f):(o._root=b,b._parent=null),m=b}else if(p<-1){var T=x._children[0],C=x._children[1];if(T._height>C._height){x._children[1]=m,m._parent=x,m._childIndex=1,m._children[1]=C,C._parent=m,C._childIndex=1;var j=x._children[0],R=x._children[1];x._aabbMinX=j._aabbMinX<R._aabbMinX?j._aabbMinX:R._aabbMinX,x._aabbMinY=j._aabbMinY<R._aabbMinY?j._aabbMinY:R._aabbMinY,x._aabbMinZ=j._aabbMinZ<R._aabbMinZ?j._aabbMinZ:R._aabbMinZ,x._aabbMaxX=j._aabbMaxX>R._aabbMaxX?j._aabbMaxX:R._aabbMaxX,x._aabbMaxY=j._aabbMaxY>R._aabbMaxY?j._aabbMaxY:R._aabbMaxY,x._aabbMaxZ=j._aabbMaxZ>R._aabbMaxZ?j._aabbMaxZ:R._aabbMaxZ;var q=x._children[0]._height,E=x._children[1]._height;x._height=(q>E?q:E)+1;var D=m._children[0],F=m._children[1];m._aabbMinX=D._aabbMinX<F._aabbMinX?D._aabbMinX:F._aabbMinX,m._aabbMinY=D._aabbMinY<F._aabbMinY?D._aabbMinY:F._aabbMinY,m._aabbMinZ=D._aabbMinZ<F._aabbMinZ?D._aabbMinZ:F._aabbMinZ,m._aabbMaxX=D._aabbMaxX>F._aabbMaxX?D._aabbMaxX:F._aabbMaxX,m._aabbMaxY=D._aabbMaxY>F._aabbMaxY?D._aabbMaxY:F._aabbMaxY,m._aabbMaxZ=D._aabbMaxZ>F._aabbMaxZ?D._aabbMaxZ:F._aabbMaxZ;var N=m._children[0]._height,W=m._children[1]._height;m._height=(N>W?N:W)+1}else{x._children[0]=m,m._parent=x,m._childIndex=0,m._children[1]=T,T._parent=m,T._childIndex=1;var G=x._children[0],J=x._children[1];x._aabbMinX=G._aabbMinX<J._aabbMinX?G._aabbMinX:J._aabbMinX,x._aabbMinY=G._aabbMinY<J._aabbMinY?G._aabbMinY:J._aabbMinY,x._aabbMinZ=G._aabbMinZ<J._aabbMinZ?G._aabbMinZ:J._aabbMinZ,x._aabbMaxX=G._aabbMaxX>J._aabbMaxX?G._aabbMaxX:J._aabbMaxX,x._aabbMaxY=G._aabbMaxY>J._aabbMaxY?G._aabbMaxY:J._aabbMaxY,x._aabbMaxZ=G._aabbMaxZ>J._aabbMaxZ?G._aabbMaxZ:J._aabbMaxZ;var O=x._children[0]._height,H=x._children[1]._height;x._height=(O>H?O:H)+1;var U=m._children[0],Q=m._children[1];m._aabbMinX=U._aabbMinX<Q._aabbMinX?U._aabbMinX:Q._aabbMinX,m._aabbMinY=U._aabbMinY<Q._aabbMinY?U._aabbMinY:Q._aabbMinY,m._aabbMinZ=U._aabbMinZ<Q._aabbMinZ?U._aabbMinZ:Q._aabbMinZ,m._aabbMaxX=U._aabbMaxX>Q._aabbMaxX?U._aabbMaxX:Q._aabbMaxX,m._aabbMaxY=U._aabbMaxY>Q._aabbMaxY?U._aabbMaxY:Q._aabbMaxY,m._aabbMaxZ=U._aabbMaxZ>Q._aabbMaxZ?U._aabbMaxZ:Q._aabbMaxZ;var K=m._children[0]._height,$=m._children[1]._height;m._height=(K>$?K:$)+1}null!=v?(v._children[f]=x,x._parent=v,x._childIndex=f):(o._root=x,x._parent=null),m=x}}var tt=m._children[0]._height,it=m._children[1]._height;m._height=(tt>it?tt:it)+1;var at=m._children[0],st=m._children[1];m._aabbMinX=at._aabbMinX<st._aabbMinX?at._aabbMinX:st._aabbMinX,m._aabbMinY=at._aabbMinY<st._aabbMinY?at._aabbMinY:st._aabbMinY,m._aabbMinZ=at._aabbMinZ<st._aabbMinZ?at._aabbMinZ:st._aabbMinZ,m._aabbMaxX=at._aabbMaxX>st._aabbMaxX?at._aabbMaxX:st._aabbMaxX,m._aabbMaxY=at._aabbMaxY>st._aabbMaxY?at._aabbMaxY:st._aabbMaxY,m._aabbMaxZ=at._aabbMaxZ>st._aabbMaxZ?at._aabbMaxZ:st._aabbMaxZ,m=m._parent}}}s._leaf=null,n._next=null,n._childIndex=0,n._children[0]=null,n._children[1]=null,n._childIndex=0,n._parent=null,n._height=0,n._proxy=null,n._next=o._nodePool,o._nodePool=n,s.userData=null,s._next=null,s._prev=null,s._moved&&(s._moved=!1)}moveProxy(i,a,s){var o=i;if(!(o._aabbMinX<=a._minX&&o._aabbMaxX>=a._maxX&&o._aabbMinY<=a._minY&&o._aabbMaxY>=a._maxY&&o._aabbMinZ<=a._minZ&&o._aabbMaxZ>=a._maxZ)){o._aabbMinX=a._minX,o._aabbMinY=a._minY,o._aabbMinZ=a._minZ,o._aabbMaxX=a._maxX,o._aabbMaxY=a._maxY,o._aabbMaxZ=a._maxZ;var n,r,_,e=t.common.Setting.bvhProxyPadding;if(n=e,r=e,_=e,o._aabbMinX-=n,o._aabbMinY-=r,o._aabbMinZ-=_,o._aabbMaxX+=n,o._aabbMaxY+=r,o._aabbMaxZ+=_,null!=s){var h,l,c,m,v,b,x,p,f;0,0,0;var u=s;m=0<(h=u.x)?0:h,v=0<(l=u.y)?0:l,b=0<(c=u.z)?0:c,x=0>h?0:h,p=0>l?0:l,f=0>c?0:c,o._aabbMinX+=m,o._aabbMinY+=v,o._aabbMinZ+=b,o._aabbMaxX+=x,o._aabbMaxY+=p,o._aabbMaxZ+=f}if(!o._moved){if(o._moved=!0,this.movedProxies.length==this.numMovedProxies){for(var y=this.numMovedProxies<<1,X=new Array(y),g=0,z=this.numMovedProxies;g<z;){var d=g++;X[d]=this.movedProxies[d],this.movedProxies[d]=null}this.movedProxies=X}this.movedProxies[this.numMovedProxies++]=o}}}collectPairs(){var i=this._proxyPairList;if(null!=i){for(;i._p1=null,i._p2=null,null!=(i=i._next););this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}if(this._testCount=0,!(this._numProxies<2)){for(var a=this.numMovedProxies/this._numProxies<t.common.Setting.bvhIncrementalCollisionThreshold,s=0,o=this.numMovedProxies;s<o;){var n=s++,r=this.movedProxies[n];if(r._moved){var _=this._tree,e=r._leaf;_._numLeaves--;var h=e._prevLeaf,l=e._nextLeaf;if(null!=h&&(h._nextLeaf=l),null!=l&&(l._prevLeaf=h),e==_.leafList&&(_.leafList=_.leafList._nextLeaf),e==_.leafListLast&&(_.leafListLast=_.leafListLast._prevLeaf),e._nextLeaf=null,e._prevLeaf=null,_._root==e)_._root=null;else{var c=e._parent,m=c._children[1^e._childIndex],v=c._parent;if(null==v)m._parent=null,m._childIndex=0,_._root=m,c._next=null,c._childIndex=0,c._children[0]=null,c._children[1]=null,c._childIndex=0,c._parent=null,c._height=0,c._proxy=null,c._next=_._nodePool,_._nodePool=c;else{m._parent=v;var b=c._childIndex;v._children[b]=m,m._parent=v,m._childIndex=b,c._next=null,c._childIndex=0,c._children[0]=null,c._children[1]=null,c._childIndex=0,c._parent=null,c._height=0,c._proxy=null,c._next=_._nodePool,_._nodePool=c;for(var x=v;null!=x;){if(_._strategy._balancingEnabled)if(x._height<2);else{var p=x._parent,f=x._children[0],u=x._children[1],y=f._height-u._height,X=x._childIndex;if(y>1){var g=f._children[0],z=f._children[1];if(g._height>z._height){f._children[1]=x,x._parent=f,x._childIndex=1,x._children[0]=z,z._parent=x,z._childIndex=0;var d=f._children[0],Y=f._children[1];f._aabbMinX=d._aabbMinX<Y._aabbMinX?d._aabbMinX:Y._aabbMinX,f._aabbMinY=d._aabbMinY<Y._aabbMinY?d._aabbMinY:Y._aabbMinY,f._aabbMinZ=d._aabbMinZ<Y._aabbMinZ?d._aabbMinZ:Y._aabbMinZ,f._aabbMaxX=d._aabbMaxX>Y._aabbMaxX?d._aabbMaxX:Y._aabbMaxX,f._aabbMaxY=d._aabbMaxY>Y._aabbMaxY?d._aabbMaxY:Y._aabbMaxY,f._aabbMaxZ=d._aabbMaxZ>Y._aabbMaxZ?d._aabbMaxZ:Y._aabbMaxZ;var Z=f._children[0]._height,M=f._children[1]._height;f._height=(Z>M?Z:M)+1;var I=x._children[0],V=x._children[1];x._aabbMinX=I._aabbMinX<V._aabbMinX?I._aabbMinX:V._aabbMinX,x._aabbMinY=I._aabbMinY<V._aabbMinY?I._aabbMinY:V._aabbMinY,x._aabbMinZ=I._aabbMinZ<V._aabbMinZ?I._aabbMinZ:V._aabbMinZ,x._aabbMaxX=I._aabbMaxX>V._aabbMaxX?I._aabbMaxX:V._aabbMaxX,x._aabbMaxY=I._aabbMaxY>V._aabbMaxY?I._aabbMaxY:V._aabbMaxY,x._aabbMaxZ=I._aabbMaxZ>V._aabbMaxZ?I._aabbMaxZ:V._aabbMaxZ;var L=x._children[0]._height,w=x._children[1]._height;x._height=(L>w?L:w)+1}else{f._children[0]=x,x._parent=f,x._childIndex=0,x._children[0]=g,g._parent=x,g._childIndex=0;var k=f._children[0],B=f._children[1];f._aabbMinX=k._aabbMinX<B._aabbMinX?k._aabbMinX:B._aabbMinX,f._aabbMinY=k._aabbMinY<B._aabbMinY?k._aabbMinY:B._aabbMinY,f._aabbMinZ=k._aabbMinZ<B._aabbMinZ?k._aabbMinZ:B._aabbMinZ,f._aabbMaxX=k._aabbMaxX>B._aabbMaxX?k._aabbMaxX:B._aabbMaxX,f._aabbMaxY=k._aabbMaxY>B._aabbMaxY?k._aabbMaxY:B._aabbMaxY,f._aabbMaxZ=k._aabbMaxZ>B._aabbMaxZ?k._aabbMaxZ:B._aabbMaxZ;var A=f._children[0]._height,P=f._children[1]._height;f._height=(A>P?A:P)+1;var S=x._children[0],T=x._children[1];x._aabbMinX=S._aabbMinX<T._aabbMinX?S._aabbMinX:T._aabbMinX,x._aabbMinY=S._aabbMinY<T._aabbMinY?S._aabbMinY:T._aabbMinY,x._aabbMinZ=S._aabbMinZ<T._aabbMinZ?S._aabbMinZ:T._aabbMinZ,x._aabbMaxX=S._aabbMaxX>T._aabbMaxX?S._aabbMaxX:T._aabbMaxX,x._aabbMaxY=S._aabbMaxY>T._aabbMaxY?S._aabbMaxY:T._aabbMaxY,x._aabbMaxZ=S._aabbMaxZ>T._aabbMaxZ?S._aabbMaxZ:T._aabbMaxZ;var C=x._children[0]._height,j=x._children[1]._height;x._height=(C>j?C:j)+1}null!=p?(p._children[X]=f,f._parent=p,f._childIndex=X):(_._root=f,f._parent=null),x=f}else if(y<-1){var R=u._children[0],q=u._children[1];if(R._height>q._height){u._children[1]=x,x._parent=u,x._childIndex=1,x._children[1]=q,q._parent=x,q._childIndex=1;var E=u._children[0],D=u._children[1];u._aabbMinX=E._aabbMinX<D._aabbMinX?E._aabbMinX:D._aabbMinX,u._aabbMinY=E._aabbMinY<D._aabbMinY?E._aabbMinY:D._aabbMinY,u._aabbMinZ=E._aabbMinZ<D._aabbMinZ?E._aabbMinZ:D._aabbMinZ,u._aabbMaxX=E._aabbMaxX>D._aabbMaxX?E._aabbMaxX:D._aabbMaxX,u._aabbMaxY=E._aabbMaxY>D._aabbMaxY?E._aabbMaxY:D._aabbMaxY,u._aabbMaxZ=E._aabbMaxZ>D._aabbMaxZ?E._aabbMaxZ:D._aabbMaxZ;var F=u._children[0]._height,N=u._children[1]._height;u._height=(F>N?F:N)+1;var W=x._children[0],G=x._children[1];x._aabbMinX=W._aabbMinX<G._aabbMinX?W._aabbMinX:G._aabbMinX,x._aabbMinY=W._aabbMinY<G._aabbMinY?W._aabbMinY:G._aabbMinY,x._aabbMinZ=W._aabbMinZ<G._aabbMinZ?W._aabbMinZ:G._aabbMinZ,x._aabbMaxX=W._aabbMaxX>G._aabbMaxX?W._aabbMaxX:G._aabbMaxX,x._aabbMaxY=W._aabbMaxY>G._aabbMaxY?W._aabbMaxY:G._aabbMaxY,x._aabbMaxZ=W._aabbMaxZ>G._aabbMaxZ?W._aabbMaxZ:G._aabbMaxZ;var J=x._children[0]._height,O=x._children[1]._height;x._height=(J>O?J:O)+1}else{u._children[0]=x,x._parent=u,x._childIndex=0,x._children[1]=R,R._parent=x,R._childIndex=1;var H=u._children[0],U=u._children[1];u._aabbMinX=H._aabbMinX<U._aabbMinX?H._aabbMinX:U._aabbMinX,u._aabbMinY=H._aabbMinY<U._aabbMinY?H._aabbMinY:U._aabbMinY,u._aabbMinZ=H._aabbMinZ<U._aabbMinZ?H._aabbMinZ:U._aabbMinZ,u._aabbMaxX=H._aabbMaxX>U._aabbMaxX?H._aabbMaxX:U._aabbMaxX,u._aabbMaxY=H._aabbMaxY>U._aabbMaxY?H._aabbMaxY:U._aabbMaxY,u._aabbMaxZ=H._aabbMaxZ>U._aabbMaxZ?H._aabbMaxZ:U._aabbMaxZ;var Q=u._children[0]._height,K=u._children[1]._height;u._height=(Q>K?Q:K)+1;var $=x._children[0],tt=x._children[1];x._aabbMinX=$._aabbMinX<tt._aabbMinX?$._aabbMinX:tt._aabbMinX,x._aabbMinY=$._aabbMinY<tt._aabbMinY?$._aabbMinY:tt._aabbMinY,x._aabbMinZ=$._aabbMinZ<tt._aabbMinZ?$._aabbMinZ:tt._aabbMinZ,x._aabbMaxX=$._aabbMaxX>tt._aabbMaxX?$._aabbMaxX:tt._aabbMaxX,x._aabbMaxY=$._aabbMaxY>tt._aabbMaxY?$._aabbMaxY:tt._aabbMaxY,x._aabbMaxZ=$._aabbMaxZ>tt._aabbMaxZ?$._aabbMaxZ:tt._aabbMaxZ;var it=x._children[0]._height,at=x._children[1]._height;x._height=(it>at?it:at)+1}null!=p?(p._children[X]=u,u._parent=p,u._childIndex=X):(_._root=u,u._parent=null),x=u}}var st=x._children[0]._height,ot=x._children[1]._height;x._height=(st>ot?st:ot)+1;var nt=x._children[0],rt=x._children[1];x._aabbMinX=nt._aabbMinX<rt._aabbMinX?nt._aabbMinX:rt._aabbMinX,x._aabbMinY=nt._aabbMinY<rt._aabbMinY?nt._aabbMinY:rt._aabbMinY,x._aabbMinZ=nt._aabbMinZ<rt._aabbMinZ?nt._aabbMinZ:rt._aabbMinZ,x._aabbMaxX=nt._aabbMaxX>rt._aabbMaxX?nt._aabbMaxX:rt._aabbMaxX,x._aabbMaxY=nt._aabbMaxY>rt._aabbMaxY?nt._aabbMaxY:rt._aabbMaxY,x._aabbMaxZ=nt._aabbMaxZ>rt._aabbMaxZ?nt._aabbMaxZ:rt._aabbMaxZ,x=x._parent}}}r._leaf=null,e._next=null,e._childIndex=0,e._children[0]=null,e._children[1]=null,e._childIndex=0,e._parent=null,e._height=0,e._proxy=null,e._next=_._nodePool,_._nodePool=e;var _t=this._tree,et=_t._nodePool;null!=et?(_t._nodePool=et._next,et._next=null):et=new t.collision.broadphase.bvh.BvhNode;var ht=et;if(ht._proxy=r,r._leaf=ht,ht._aabbMinX=r._aabbMinX,ht._aabbMinY=r._aabbMinY,ht._aabbMinZ=r._aabbMinZ,ht._aabbMaxX=r._aabbMaxX,ht._aabbMaxY=r._aabbMaxY,ht._aabbMaxZ=r._aabbMaxZ,_t._numLeaves++,null==_t.leafList?(_t.leafList=ht,_t.leafListLast=ht):(_t.leafListLast._nextLeaf=ht,ht._prevLeaf=_t.leafListLast,_t.leafListLast=ht),null==_t._root)_t._root=ht;else{for(var lt=_t._root;lt._height>0;){var ct=_t._strategy._decideInsertion(lt,ht);if(-1==ct)break;lt=lt._children[ct]}var mt=lt._parent,vt=_t._nodePool;null!=vt?(_t._nodePool=vt._next,vt._next=null):vt=new t.collision.broadphase.bvh.BvhNode;var bt=vt;if(null==mt)_t._root=bt;else{var xt=lt._childIndex;mt._children[xt]=bt,bt._parent=mt,bt._childIndex=xt}var pt=lt._childIndex;bt._children[pt]=lt,lt._parent=bt,lt._childIndex=pt;var ft=1^lt._childIndex;for(bt._children[ft]=ht,ht._parent=bt,ht._childIndex=ft;null!=bt;){if(_t._strategy._balancingEnabled)if(bt._height<2);else{var ut=bt._parent,yt=bt._children[0],Xt=bt._children[1],gt=yt._height-Xt._height,zt=bt._childIndex;if(gt>1){var dt=yt._children[0],Yt=yt._children[1];if(dt._height>Yt._height){yt._children[1]=bt,bt._parent=yt,bt._childIndex=1,bt._children[0]=Yt,Yt._parent=bt,Yt._childIndex=0;var Zt=yt._children[0],Mt=yt._children[1];yt._aabbMinX=Zt._aabbMinX<Mt._aabbMinX?Zt._aabbMinX:Mt._aabbMinX,yt._aabbMinY=Zt._aabbMinY<Mt._aabbMinY?Zt._aabbMinY:Mt._aabbMinY,yt._aabbMinZ=Zt._aabbMinZ<Mt._aabbMinZ?Zt._aabbMinZ:Mt._aabbMinZ,yt._aabbMaxX=Zt._aabbMaxX>Mt._aabbMaxX?Zt._aabbMaxX:Mt._aabbMaxX,yt._aabbMaxY=Zt._aabbMaxY>Mt._aabbMaxY?Zt._aabbMaxY:Mt._aabbMaxY,yt._aabbMaxZ=Zt._aabbMaxZ>Mt._aabbMaxZ?Zt._aabbMaxZ:Mt._aabbMaxZ;var It=yt._children[0]._height,Vt=yt._children[1]._height;yt._height=(It>Vt?It:Vt)+1;var Lt=bt._children[0],wt=bt._children[1];bt._aabbMinX=Lt._aabbMinX<wt._aabbMinX?Lt._aabbMinX:wt._aabbMinX,bt._aabbMinY=Lt._aabbMinY<wt._aabbMinY?Lt._aabbMinY:wt._aabbMinY,bt._aabbMinZ=Lt._aabbMinZ<wt._aabbMinZ?Lt._aabbMinZ:wt._aabbMinZ,bt._aabbMaxX=Lt._aabbMaxX>wt._aabbMaxX?Lt._aabbMaxX:wt._aabbMaxX,bt._aabbMaxY=Lt._aabbMaxY>wt._aabbMaxY?Lt._aabbMaxY:wt._aabbMaxY,bt._aabbMaxZ=Lt._aabbMaxZ>wt._aabbMaxZ?Lt._aabbMaxZ:wt._aabbMaxZ;var kt=bt._children[0]._height,Bt=bt._children[1]._height;bt._height=(kt>Bt?kt:Bt)+1}else{yt._children[0]=bt,bt._parent=yt,bt._childIndex=0,bt._children[0]=dt,dt._parent=bt,dt._childIndex=0;var At=yt._children[0],Pt=yt._children[1];yt._aabbMinX=At._aabbMinX<Pt._aabbMinX?At._aabbMinX:Pt._aabbMinX,yt._aabbMinY=At._aabbMinY<Pt._aabbMinY?At._aabbMinY:Pt._aabbMinY,yt._aabbMinZ=At._aabbMinZ<Pt._aabbMinZ?At._aabbMinZ:Pt._aabbMinZ,yt._aabbMaxX=At._aabbMaxX>Pt._aabbMaxX?At._aabbMaxX:Pt._aabbMaxX,yt._aabbMaxY=At._aabbMaxY>Pt._aabbMaxY?At._aabbMaxY:Pt._aabbMaxY,yt._aabbMaxZ=At._aabbMaxZ>Pt._aabbMaxZ?At._aabbMaxZ:Pt._aabbMaxZ;var St=yt._children[0]._height,Tt=yt._children[1]._height;yt._height=(St>Tt?St:Tt)+1;var Ct=bt._children[0],jt=bt._children[1];bt._aabbMinX=Ct._aabbMinX<jt._aabbMinX?Ct._aabbMinX:jt._aabbMinX,bt._aabbMinY=Ct._aabbMinY<jt._aabbMinY?Ct._aabbMinY:jt._aabbMinY,bt._aabbMinZ=Ct._aabbMinZ<jt._aabbMinZ?Ct._aabbMinZ:jt._aabbMinZ,bt._aabbMaxX=Ct._aabbMaxX>jt._aabbMaxX?Ct._aabbMaxX:jt._aabbMaxX,bt._aabbMaxY=Ct._aabbMaxY>jt._aabbMaxY?Ct._aabbMaxY:jt._aabbMaxY,bt._aabbMaxZ=Ct._aabbMaxZ>jt._aabbMaxZ?Ct._aabbMaxZ:jt._aabbMaxZ;var Rt=bt._children[0]._height,qt=bt._children[1]._height;bt._height=(Rt>qt?Rt:qt)+1}null!=ut?(ut._children[zt]=yt,yt._parent=ut,yt._childIndex=zt):(_t._root=yt,yt._parent=null),bt=yt}else if(gt<-1){var Et=Xt._children[0],Dt=Xt._children[1];if(Et._height>Dt._height){Xt._children[1]=bt,bt._parent=Xt,bt._childIndex=1,bt._children[1]=Dt,Dt._parent=bt,Dt._childIndex=1;var Ft=Xt._children[0],Nt=Xt._children[1];Xt._aabbMinX=Ft._aabbMinX<Nt._aabbMinX?Ft._aabbMinX:Nt._aabbMinX,Xt._aabbMinY=Ft._aabbMinY<Nt._aabbMinY?Ft._aabbMinY:Nt._aabbMinY,Xt._aabbMinZ=Ft._aabbMinZ<Nt._aabbMinZ?Ft._aabbMinZ:Nt._aabbMinZ,Xt._aabbMaxX=Ft._aabbMaxX>Nt._aabbMaxX?Ft._aabbMaxX:Nt._aabbMaxX,Xt._aabbMaxY=Ft._aabbMaxY>Nt._aabbMaxY?Ft._aabbMaxY:Nt._aabbMaxY,Xt._aabbMaxZ=Ft._aabbMaxZ>Nt._aabbMaxZ?Ft._aabbMaxZ:Nt._aabbMaxZ;var Wt=Xt._children[0]._height,Gt=Xt._children[1]._height;Xt._height=(Wt>Gt?Wt:Gt)+1;var Jt=bt._children[0],Ot=bt._children[1];bt._aabbMinX=Jt._aabbMinX<Ot._aabbMinX?Jt._aabbMinX:Ot._aabbMinX,bt._aabbMinY=Jt._aabbMinY<Ot._aabbMinY?Jt._aabbMinY:Ot._aabbMinY,bt._aabbMinZ=Jt._aabbMinZ<Ot._aabbMinZ?Jt._aabbMinZ:Ot._aabbMinZ,bt._aabbMaxX=Jt._aabbMaxX>Ot._aabbMaxX?Jt._aabbMaxX:Ot._aabbMaxX,bt._aabbMaxY=Jt._aabbMaxY>Ot._aabbMaxY?Jt._aabbMaxY:Ot._aabbMaxY,bt._aabbMaxZ=Jt._aabbMaxZ>Ot._aabbMaxZ?Jt._aabbMaxZ:Ot._aabbMaxZ;var Ht=bt._children[0]._height,Ut=bt._children[1]._height;bt._height=(Ht>Ut?Ht:Ut)+1}else{Xt._children[0]=bt,bt._parent=Xt,bt._childIndex=0,bt._children[1]=Et,Et._parent=bt,Et._childIndex=1;var Qt=Xt._children[0],Kt=Xt._children[1];Xt._aabbMinX=Qt._aabbMinX<Kt._aabbMinX?Qt._aabbMinX:Kt._aabbMinX,Xt._aabbMinY=Qt._aabbMinY<Kt._aabbMinY?Qt._aabbMinY:Kt._aabbMinY,Xt._aabbMinZ=Qt._aabbMinZ<Kt._aabbMinZ?Qt._aabbMinZ:Kt._aabbMinZ,Xt._aabbMaxX=Qt._aabbMaxX>Kt._aabbMaxX?Qt._aabbMaxX:Kt._aabbMaxX,Xt._aabbMaxY=Qt._aabbMaxY>Kt._aabbMaxY?Qt._aabbMaxY:Kt._aabbMaxY,Xt._aabbMaxZ=Qt._aabbMaxZ>Kt._aabbMaxZ?Qt._aabbMaxZ:Kt._aabbMaxZ;var $t=Xt._children[0]._height,ti=Xt._children[1]._height;Xt._height=($t>ti?$t:ti)+1;var ii=bt._children[0],ai=bt._children[1];bt._aabbMinX=ii._aabbMinX<ai._aabbMinX?ii._aabbMinX:ai._aabbMinX,bt._aabbMinY=ii._aabbMinY<ai._aabbMinY?ii._aabbMinY:ai._aabbMinY,bt._aabbMinZ=ii._aabbMinZ<ai._aabbMinZ?ii._aabbMinZ:ai._aabbMinZ,bt._aabbMaxX=ii._aabbMaxX>ai._aabbMaxX?ii._aabbMaxX:ai._aabbMaxX,bt._aabbMaxY=ii._aabbMaxY>ai._aabbMaxY?ii._aabbMaxY:ai._aabbMaxY,bt._aabbMaxZ=ii._aabbMaxZ>ai._aabbMaxZ?ii._aabbMaxZ:ai._aabbMaxZ;var si=bt._children[0]._height,oi=bt._children[1]._height;bt._height=(si>oi?si:oi)+1}null!=ut?(ut._children[zt]=Xt,Xt._parent=ut,Xt._childIndex=zt):(_t._root=Xt,Xt._parent=null),bt=Xt}}var ni=bt._children[0]._height,ri=bt._children[1]._height;bt._height=(ni>ri?ni:ri)+1;var _i=bt._children[0],ei=bt._children[1];bt._aabbMinX=_i._aabbMinX<ei._aabbMinX?_i._aabbMinX:ei._aabbMinX,bt._aabbMinY=_i._aabbMinY<ei._aabbMinY?_i._aabbMinY:ei._aabbMinY,bt._aabbMinZ=_i._aabbMinZ<ei._aabbMinZ?_i._aabbMinZ:ei._aabbMinZ,bt._aabbMaxX=_i._aabbMaxX>ei._aabbMaxX?_i._aabbMaxX:ei._aabbMaxX,bt._aabbMaxY=_i._aabbMaxY>ei._aabbMaxY?_i._aabbMaxY:ei._aabbMaxY,bt._aabbMaxZ=_i._aabbMaxZ>ei._aabbMaxZ?_i._aabbMaxZ:ei._aabbMaxZ,bt=bt._parent}}a&&this.collide(this._tree._root,r._leaf),r._moved=!1}this.movedProxies[n]=null}a||this.collide(this._tree._root,this._tree._root),this.numMovedProxies=0}}rayCast(t,i,a){if(null!=this._tree._root){var s,o,n,r,_,e,h=t;s=h.x,o=h.y,n=h.z;var l=i;r=l.x,_=l.y,e=l.z,this.rayCastRecursive(this._tree._root,s,o,n,r,_,e,a)}}convexCast(t,i,a,s){null!=this._tree._root&&this.convexCastRecursive(this._tree._root,t,i,a,s)}aabbTest(t,i){null!=this._tree._root&&this.aabbTestRecursive(this._tree._root,t,i)}getTreeBalance(){return this._tree._getBalance()}},t.collision.broadphase.bvh.BvhInsertionStrategy=class{},t.collision.broadphase.bvh.BvhNode=class{constructor(){this._next=null,this._prevLeaf=null,this._nextLeaf=null;var t=new Array(2);this._children=t,this._childIndex=0,this._parent=null,this._height=0,this._proxy=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}},t.collision.broadphase.bvh.BvhProxy=class extends t.collision.broadphase.Proxy{constructor(t,i){super(t,i),this._leaf=null,this._moved=!1}},t.collision.broadphase.bvh.BvhStrategy=class{constructor(){this._insertionStrategy=0,this._balancingEnabled=!1}_decideInsertion(t,i){switch(this._insertionStrategy){case 0:var a,s,o;a=i._aabbMinX+i._aabbMaxX,s=i._aabbMinY+i._aabbMaxY,o=i._aabbMinZ+i._aabbMaxZ;var n,r,_,e,h,l,c=t._children[0],m=t._children[1];return n=c._aabbMinX+c._aabbMaxX,r=c._aabbMinY+c._aabbMaxY,_=c._aabbMinZ+c._aabbMaxZ,e=m._aabbMinX+m._aabbMaxX,h=m._aabbMinY+m._aabbMaxY,l=m._aabbMinZ+m._aabbMaxZ,(n-=a)*n+(r-=s)*r+(_-=o)*_<(e-=a)*e+(h-=s)*h+(l-=o)*l?0:1;case 1:var v,b,x,p,f,u,y=t._children[0],X=t._children[1],g=t._aabbMaxX-t._aabbMinX,z=t._aabbMaxY-t._aabbMinY,d=t._aabbMaxZ-t._aabbMinZ,Y=2*(g*(z+d)+z*d);v=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,b=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,x=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,p=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX;var Z=(f=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY)-b,M=(u=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ)-x,I=2*((p-v)*(Z+M)+Z*M),V=2*I,L=2*(I-Y),w=L;if(v=y._aabbMinX<i._aabbMinX?y._aabbMinX:i._aabbMinX,b=y._aabbMinY<i._aabbMinY?y._aabbMinY:i._aabbMinY,x=y._aabbMinZ<i._aabbMinZ?y._aabbMinZ:i._aabbMinZ,p=y._aabbMaxX>i._aabbMaxX?y._aabbMaxX:i._aabbMaxX,f=y._aabbMaxY>i._aabbMaxY?y._aabbMaxY:i._aabbMaxY,u=y._aabbMaxZ>i._aabbMaxZ?y._aabbMaxZ:i._aabbMaxZ,0==y._height){var k=f-b,B=u-x;w+=2*((p-v)*(k+B)+k*B)}else{var A=p-v,P=f-b,S=u-x,T=y._aabbMaxX-y._aabbMinX,C=y._aabbMaxY-y._aabbMinY,j=y._aabbMaxZ-y._aabbMinZ;w+=2*(A*(P+S)+P*S)-2*(T*(C+j)+C*j)}var R=L;if(v=X._aabbMinX<i._aabbMinX?X._aabbMinX:i._aabbMinX,b=X._aabbMinY<i._aabbMinY?X._aabbMinY:i._aabbMinY,x=X._aabbMinZ<i._aabbMinZ?X._aabbMinZ:i._aabbMinZ,p=X._aabbMaxX>i._aabbMaxX?X._aabbMaxX:i._aabbMaxX,f=X._aabbMaxY>i._aabbMaxY?X._aabbMaxY:i._aabbMaxY,u=X._aabbMaxZ>i._aabbMaxZ?X._aabbMaxZ:i._aabbMaxZ,0==X._height){var q=f-b,E=u-x;R+=2*((p-v)*(q+E)+q*E)}else{var D=p-v,F=f-b,N=u-x,W=X._aabbMaxX-X._aabbMinX,G=X._aabbMaxY-X._aabbMinY,J=X._aabbMaxZ-X._aabbMinZ;R+=2*(D*(F+N)+F*N)-2*(W*(G+J)+G*J)}return V<w?V<R?-1:1:w<R?0:1;default:return console.log("src/oimo/collision/broadphase/bvh/BvhStrategy.hx:37:","invalid BVH insertion strategy: "+this._insertionStrategy),-1}}_splitLeaves(t,i,a){var s,o,n,r=1/(a-i);s=0,o=0,n=0;for(var _,e,h,l=i,c=a;l<c;){var m=t[l++];m._tmpX=m._aabbMaxX+m._aabbMinX,m._tmpY=m._aabbMaxY+m._aabbMinY,m._tmpZ=m._aabbMaxZ+m._aabbMinZ,s+=m._tmpX,o+=m._tmpY,n+=m._tmpZ}s*=r,o*=r,n*=r,_=0,e=0,h=0;for(var v=i,b=a;v<b;){var x,p,f,u=t[v++];x=u._tmpX-s,p=u._tmpY-o,f=u._tmpZ-n,_+=x*=x,e+=p*=p,h+=f*=f}var y=e,X=h,g=i,z=a-1;if(_>y)if(_>X)for(var d=s;;){for(;;){if(t[g]._tmpX<=d)break;++g}for(;;){if(t[z]._tmpX>=d)break;--z}if(g>=z)break;var Y=t[g];t[g]=t[z],t[z]=Y,++g,--z}else for(var Z=n;;){for(;;){if(t[g]._tmpZ<=Z)break;++g}for(;;){if(t[z]._tmpZ>=Z)break;--z}if(g>=z)break;var M=t[g];t[g]=t[z],t[z]=M,++g,--z}else if(y>X)for(var I=o;;){for(;;){if(t[g]._tmpY<=I)break;++g}for(;;){if(t[z]._tmpY>=I)break;--z}if(g>=z)break;var V=t[g];t[g]=t[z],t[z]=V,++g,--z}else for(var L=n;;){for(;;){if(t[g]._tmpZ<=L)break;++g}for(;;){if(t[z]._tmpZ>=L)break;--z}if(g>=z)break;var w=t[g];t[g]=t[z],t[z]=w,++g,--z}return g}},t.collision.broadphase.bvh.BvhTree=class{constructor(){this._root=null,this._numLeaves=0,this._strategy=new t.collision.broadphase.bvh.BvhStrategy,this._nodePool=null,this.leafList=null,this.leafListLast=null;var i=new Array(1024);this.tmp=i}_print(t,i){if(null==i&&(i=""),null!=t)if(0==t._height)console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:39:",i+t._proxy._id);else{var a,s,o,n;this._print(t._children[0],i+"  "),s=t._aabbMaxX-t._aabbMinX;o=t._aabbMaxY-t._aabbMinY,n=t._aabbMaxZ-t._aabbMinZ;if(s*(o+n)+o*n>0){var r,_,e;r=t._aabbMaxX-t._aabbMinX;_=t._aabbMaxY-t._aabbMinY,e=t._aabbMaxZ-t._aabbMinZ;a=(1e3*(r*(_+e)+_*e)+.5|0)/1e3}else{var h,l,c;h=t._aabbMaxX-t._aabbMinX;l=t._aabbMaxY-t._aabbMinY,c=t._aabbMaxZ-t._aabbMinZ;a=(1e3*(h*(l+c)+l*c)-.5|0)/1e3}console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:42:",i+"#"+t._height+", "+a),this._print(t._children[1],i+"  ")}}_getBalance(){return this.getBalanceRecursive(this._root)}deleteRecursive(t){if(0==t._height){var i=t._prevLeaf,a=t._nextLeaf;return null!=i&&(i._nextLeaf=a),null!=a&&(a._prevLeaf=i),t==this.leafList&&(this.leafList=this.leafList._nextLeaf),t==this.leafListLast&&(this.leafListLast=this.leafListLast._prevLeaf),t._nextLeaf=null,t._prevLeaf=null,t._proxy._leaf=null,t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,void(this._nodePool=t)}this.deleteRecursive(t._children[0]),this.deleteRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t}decomposeRecursive(t){if(0==t._height)return t._childIndex=0,void(t._parent=null);this.decomposeRecursive(t._children[0]),this.decomposeRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t}buildTopDownRecursive(i,a,s){if(1==s-a){var o=i[a],n=o._proxy;return o._aabbMinX=n._aabbMinX,o._aabbMinY=n._aabbMinY,o._aabbMinZ=n._aabbMinZ,o._aabbMaxX=n._aabbMaxX,o._aabbMaxY=n._aabbMaxY,o._aabbMaxZ=n._aabbMaxZ,o}var r=this._strategy._splitLeaves(i,a,s),_=this.buildTopDownRecursive(i,a,r),e=this.buildTopDownRecursive(i,r,s),h=this._nodePool;null!=h?(this._nodePool=h._next,h._next=null):h=new t.collision.broadphase.bvh.BvhNode;var l=h;l._children[0]=_,_._parent=l,_._childIndex=0,l._children[1]=e,e._parent=l,e._childIndex=1;var c=l._children[0],m=l._children[1];l._aabbMinX=c._aabbMinX<m._aabbMinX?c._aabbMinX:m._aabbMinX,l._aabbMinY=c._aabbMinY<m._aabbMinY?c._aabbMinY:m._aabbMinY,l._aabbMinZ=c._aabbMinZ<m._aabbMinZ?c._aabbMinZ:m._aabbMinZ,l._aabbMaxX=c._aabbMaxX>m._aabbMaxX?c._aabbMaxX:m._aabbMaxX,l._aabbMaxY=c._aabbMaxY>m._aabbMaxY?c._aabbMaxY:m._aabbMaxY,l._aabbMaxZ=c._aabbMaxZ>m._aabbMaxZ?c._aabbMaxZ:m._aabbMaxZ;var v=l._children[0]._height,b=l._children[1]._height;return l._height=(v>b?v:b)+1,l}getBalanceRecursive(t){if(null==t||0==t._height)return 0;var i=t._children[0]._height-t._children[1]._height;return i<0&&(i=-i),i+this.getBalanceRecursive(t._children[0])+this.getBalanceRecursive(t._children[1])}},t.collision.geometry.Aabb=class{constructor(){this._minX=0,this._minY=0,this._minZ=0,this._maxX=0,this._maxY=0,this._maxZ=0}init(t,i){var a=t;this._minX=a.x,this._minY=a.y,this._minZ=a.z;var s=i;return this._maxX=s.x,this._maxY=s.y,this._maxZ=s.z,this}getMin(){var i=new t.common.Vec3,a=i;return a.x=this._minX,a.y=this._minY,a.z=this._minZ,i}getMinTo(t){var i=t;i.x=this._minX,i.y=this._minY,i.z=this._minZ}setMin(t){var i=t;return this._minX=i.x,this._minY=i.y,this._minZ=i.z,this}getMax(){var i=new t.common.Vec3,a=i;return a.x=this._maxX,a.y=this._maxY,a.z=this._maxZ,i}getMaxTo(t){var i=t;i.x=this._maxX,i.y=this._maxY,i.z=this._maxZ}setMax(t){var i=t;return this._maxX=i.x,this._maxY=i.y,this._maxZ=i.z,this}getCenter(){var i,a,s,o=new t.common.Vec3;i=this._minX+this._maxX,a=this._minY+this._maxY,s=this._minZ+this._maxZ,i*=.5,a*=.5,s*=.5;var n=o;return n.x=i,n.y=a,n.z=s,o}getCenterTo(t){var i,a,s;i=this._minX+this._maxX,a=this._minY+this._maxY,s=this._minZ+this._maxZ,i*=.5,a*=.5,s*=.5;var o=t;o.x=i,o.y=a,o.z=s}getExtents(){var i,a,s,o=new t.common.Vec3;i=this._maxX-this._minX,a=this._maxY-this._minY,s=this._maxZ-this._minZ,i*=.5,a*=.5,s*=.5;var n=o;return n.x=i,n.y=a,n.z=s,o}getExtentsTo(t){var i,a,s;i=this._maxX-this._minX,a=this._maxY-this._minY,s=this._maxZ-this._minZ,i*=.5,a*=.5,s*=.5;var o=t;o.x=i,o.y=a,o.z=s}combine(t){return this._minX=this._minX<t._minX?this._minX:t._minX,this._minY=this._minY<t._minY?this._minY:t._minY,this._minZ=this._minZ<t._minZ?this._minZ:t._minZ,this._maxX=this._maxX>t._maxX?this._maxX:t._maxX,this._maxY=this._maxY>t._maxY?this._maxY:t._maxY,this._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,this}combined(i){var a=new t.collision.geometry.Aabb;return a._minX=this._minX<i._minX?this._minX:i._minX,a._minY=this._minY<i._minY?this._minY:i._minY,a._minZ=this._minZ<i._minZ?this._minZ:i._minZ,a._maxX=this._maxX>i._maxX?this._maxX:i._maxX,a._maxY=this._maxY>i._maxY?this._maxY:i._maxY,a._maxZ=this._maxZ>i._maxZ?this._maxZ:i._maxZ,a}overlap(t){return this._minX<t._maxX&&this._maxX>t._minX&&this._minY<t._maxY&&this._maxY>t._minY&&this._minZ<t._maxZ&&this._maxZ>t._minZ}getIntersection(i){var a=new t.collision.geometry.Aabb;return a._minX=this._minX>i._minX?this._minX:i._minX,a._minY=this._minY>i._minY?this._minY:i._minY,a._minZ=this._minZ>i._minZ?this._minZ:i._minZ,a._maxX=this._maxX<i._maxX?this._maxX:i._maxX,a._maxY=this._maxY<i._maxY?this._maxY:i._maxY,a._maxZ=this._maxZ<i._maxZ?this._maxZ:i._maxZ,a}getIntersectionTo(t,i){i._minX=this._minX>t._minX?this._minX:t._minX,i._minY=this._minY>t._minY?this._minY:t._minY,i._minZ=this._minZ>t._minZ?this._minZ:t._minZ,i._maxX=this._maxX<t._maxX?this._maxX:t._maxX,i._maxY=this._maxY<t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ}copyFrom(t){return this._minX=t._minX,this._minY=t._minY,this._minZ=t._minZ,this._maxX=t._maxX,this._maxY=t._maxY,this._maxZ=t._maxZ,this}clone(){var i=new t.collision.geometry.Aabb;return i._minX=this._minX,i._minY=this._minY,i._minZ=this._minZ,i._maxX=this._maxX,i._maxY=this._maxY,i._maxZ=this._maxZ,i}},t.collision.geometry.BoxGeometry=class extends t.collision.geometry.ConvexGeometry{constructor(t){super(1);var i=t;this._halfExtentsX=i.x,this._halfExtentsY=i.y,this._halfExtentsZ=i.z,this._halfAxisXX=t.x,this._halfAxisXY=0,this._halfAxisXZ=0,this._halfAxisYX=0,this._halfAxisYY=t.y,this._halfAxisYZ=0,this._halfAxisZX=0,this._halfAxisZY=0,this._halfAxisZZ=t.z,this._updateMass();var a=t.x<t.y?t.z<t.x?t.z:t.x:t.z<t.y?t.z:t.y;this._gjkMargin>.2*a&&(this._gjkMargin=.2*a)}getHalfExtents(){var i=new t.common.Vec3,a=i;return a.x=this._halfExtentsX,a.y=this._halfExtentsY,a.z=this._halfExtentsZ,i}getHalfExtentsTo(t){var i=t;i.x=this._halfExtentsX,i.y=this._halfExtentsY,i.z=this._halfExtentsZ}_updateMass(){var t,i,a;this._volume=this._halfExtentsX*this._halfExtentsY*this._halfExtentsZ*8,t=this._halfExtentsX*this._halfExtentsX,i=this._halfExtentsY*this._halfExtentsY,a=this._halfExtentsZ*this._halfExtentsZ,this._inertiaCoeff00=.3333333333333333*(i+a),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(a+t),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(t+i)}_computeAabb(t,i){var a,s,o,n,r,_,e,h,l,c,m,v,b;c=i._rotation00*this._halfAxisXX+i._rotation01*this._halfAxisXY+i._rotation02*this._halfAxisXZ,s=i._rotation10*this._halfAxisXX+i._rotation11*this._halfAxisXY+i._rotation12*this._halfAxisXZ,o=i._rotation20*this._halfAxisXX+i._rotation21*this._halfAxisXY+i._rotation22*this._halfAxisXZ,m=(a=(a=c)<0?-a:a)+(n=(n=i._rotation00*this._halfAxisYX+i._rotation01*this._halfAxisYY+i._rotation02*this._halfAxisYZ)<0?-n:n),v=(s=s<0?-s:s)+(r=(r=i._rotation10*this._halfAxisYX+i._rotation11*this._halfAxisYY+i._rotation12*this._halfAxisYZ)<0?-r:r),b=(o=o<0?-o:o)+(_=(_=i._rotation20*this._halfAxisYX+i._rotation21*this._halfAxisYY+i._rotation22*this._halfAxisYZ)<0?-_:_),m+=e=(e=i._rotation00*this._halfAxisZX+i._rotation01*this._halfAxisZY+i._rotation02*this._halfAxisZZ)<0?-e:e,v+=h=(h=i._rotation10*this._halfAxisZX+i._rotation11*this._halfAxisZY+i._rotation12*this._halfAxisZZ)<0?-h:h,b+=l=(l=i._rotation20*this._halfAxisZX+i._rotation21*this._halfAxisZY+i._rotation22*this._halfAxisZZ)<0?-l:l,t._minX=i._positionX-m,t._minY=i._positionY-v,t._minZ=i._positionZ-b,t._maxX=i._positionX+m,t._maxY=i._positionY+v,t._maxZ=i._positionZ+b}computeLocalSupportingVertex(t,i){var a,s,o,n,r,_;a=this._gjkMargin,s=this._gjkMargin,o=this._gjkMargin,a=a<this._halfExtentsX?a:this._halfExtentsX,s=s<this._halfExtentsY?s:this._halfExtentsY,o=o<this._halfExtentsZ?o:this._halfExtentsZ,n=this._halfExtentsX-a,r=this._halfExtentsY-s,_=this._halfExtentsZ-o,i.x=t.x>0?n:-n,i.y=t.y>0?r:-r,i.z=t.z>0?_:-_}_rayCastLocal(t,i,a,s,o,n,r){var _=t,e=i,h=a,l=s,c=o,m=n,v=this._halfExtentsX,b=this._halfExtentsY,x=this._halfExtentsZ,p=l-_,f=c-e,u=m-h,y=0,X=0,g=0,z=1,d=1,Y=1;if(p>-1e-6&&p<1e-6){if(_<=-v||_>=v)return!1}else{var Z=1/p,M=(-v-_)*Z,I=(v-_)*Z;if(M>I){var V=M;M=I,I=V}M>0&&(y=M),I<1&&(z=I)}if(f>-1e-6&&f<1e-6){if(e<=-b||e>=b)return!1}else{var L=1/f,w=(-b-e)*L,k=(b-e)*L;if(w>k){var B=w;w=k,k=B}w>0&&(X=w),k<1&&(d=k)}if(u>-1e-6&&u<1e-6){if(h<=-x||h>=x)return!1}else{var A=1/u,P=(-x-h)*A,S=(x-h)*A;if(P>S){var T=P;P=S,S=T}P>0&&(g=P),S<1&&(Y=S)}if(y>=1||X>=1||g>=1||z<=0||d<=0||Y<=0)return!1;var C=y,j=z,R=0;if(X>C&&(C=X,R=1),g>C&&(C=g,R=2),d<j&&(j=d),Y<j&&(j=Y),C>j)return!1;if(0==C)return!1;switch(R){case 0:r.normal.init(p>0?-1:1,0,0);break;case 1:r.normal.init(0,f>0?-1:1,0);break;case 2:r.normal.init(0,0,u>0?-1:1)}return r.position.init(_+C*p,e+C*f,h+C*u),r.fraction=C,!0}},t.collision.geometry.CapsuleGeometry=class extends t.collision.geometry.ConvexGeometry{constructor(t,i){super(4),this._radius=t,this._halfHeight=i,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){var t=this._radius*this._radius,i=this._halfHeight*this._halfHeight,a=6.28318530717958*t*this._halfHeight,s=3.14159265358979*t*this._radius*4/3;this._volume=a+s;var o=0==this._volume?0:1/this._volume,n=o*(a*t*.5+s*t*.4),r=o*(a*(.25*t+i/3)+s*(.4*t+this._halfHeight*this._radius*.75+i));this._inertiaCoeff00=r,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=n,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=r}_computeAabb(t,i){var a,s,o,n,r,_;a=this._radius,s=this._radius,o=this._radius,n=(n=i._rotation01)<0?-n:n,r=(r=i._rotation11)<0?-r:r,_=(_=i._rotation21)<0?-_:_,a+=n*=this._halfHeight,s+=r*=this._halfHeight,o+=_*=this._halfHeight,t._minX=i._positionX-a,t._minY=i._positionY-s,t._minZ=i._positionZ-o,t._maxX=i._positionX+a,t._maxY=i._positionY+s,t._maxZ=i._positionZ+o}computeLocalSupportingVertex(t,i){t.y>0?i.init(0,this._halfHeight,0):i.init(0,-this._halfHeight,0)}_rayCastLocal(t,i,a,s,o,n,r){var _=t,e=i,h=a,l=s,c=o,m=n,v=this._halfHeight,b=l-_,x=c-e,p=m-h,f=0,u=1,y=b*b+p*p,X=_*b+h*p,g=_*_+h*h-this._radius*this._radius,z=X*X-y*g;if(z<0)return!1;if(y>0){var d=Math.sqrt(z);if(u=(-X+d)/y,(f=(-X-d)/y)>=1||u<=0)return!1}else{if(g>=0)return!1;f=0,u=1}var Y,Z,M,I,V,L,w,k,B=e+x*f;if(B>-v&&B<v){if(f>0){Y=f;var A=r.normal.init(_+b*Y,0,h+p*Y),P=Math.sqrt(A.x*A.x+A.y*A.y+A.z*A.z);P>0&&(P=1/P);var S=A.x*P,T=A.y*P,C=A.z*P;return A.x=S,A.y=T,A.z=C,r.position.init(_+Y*b,B,h+Y*p),r.fraction=Y,!0}return!1}if(0,0,(z=(X=(M=t-0)*(L=s-t)+(I=i-(Z=B<0?-v:v))*(w=o-i)+(V=a-0)*(k=n-a))*X-(y=L*L+w*w+k*k)*(g=M*M+I*I+V*V-this._radius*this._radius))<0)return!1;var j,R,q,E,D,F,N=(-X-Math.sqrt(z))/y;if(N<0||N>1)return!1;var W=(j=M+L*N)*j+(R=I+w*N)*R+(q=V+k*N)*q;W>0&&(W=1/Math.sqrt(W)),E=j*W,D=R*W,F=q*W,j+=0,R+=Z,q+=0;var G=r.position;G.x=j,G.y=R,G.z=q;var J=r.normal;return J.x=E,J.y=D,J.z=F,r.fraction=N,!0}},t.collision.geometry.ConeGeometry=class extends t.collision.geometry.ConvexGeometry{constructor(t,i){super(3),this._radius=t,this._halfHeight=i,this.sinTheta=t/Math.sqrt(t*t+4*i*i),this.cosTheta=2*i/Math.sqrt(t*t+4*i*i),this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){var t=this._radius*this._radius,i=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2/3,this._inertiaCoeff00=.05*(3*t+2*i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.05*(3*t+2*i)}_computeAabb(t,i){var a,s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y,X,g,z,d=(a=i._rotation01)*a,Y=(s=i._rotation11)*s,Z=(o=i._rotation21)*o;e=Math.sqrt(1-d),h=Math.sqrt(1-Y),l=Math.sqrt(1-Z),e*=this._radius,h*=this._radius,l*=this._radius,c=-(n=a*this._halfHeight),m=-(r=s*this._halfHeight),v=-(_=o*this._halfHeight),b=-n,x=-r,p=-_,f=(f=(c-=e)>(b+=e)?c:b)>n?f:n,u=(u=(m-=h)>(x+=h)?m:x)>r?u:r,y=(y=(v-=l)>(p+=l)?v:p)>_?y:_,X=(X=c<b?c:b)<n?X:n,g=(g=m<x?m:x)<r?g:r,z=(z=v<p?v:p)<_?z:_,t._minX=i._positionX+X,t._minY=i._positionY+g,t._minZ=i._positionZ+z,t._maxX=i._positionX+f,t._maxY=i._positionY+u,t._maxZ=i._positionZ+y}computeLocalSupportingVertex(t,i){var a=t.x,s=t.y,o=t.z;if(s>0&&s*s>this.sinTheta*this.sinTheta*(a*a+s*s+o*o))return i.init(0,this._halfHeight-this._gjkMargin/this.sinTheta,0),void(i.y<0&&(i.y=0));var n=t.x,r=t.z,_=n*n+r*r,e=2*this._halfHeight,h=(e-this._gjkMargin)/e*this._radius-this._gjkMargin/this.cosTheta;h<0&&(h=0);var l=_>0?h/Math.sqrt(_):0,c=this._halfHeight-this._gjkMargin;c<0&&(c=0),i.x=n*l,i.y=-c,i.z=r*l}_rayCastLocal(t,i,a,s,o,n,r){var _=t,e=i,h=a,l=s,c=o,m=n,v=this._halfHeight,b=l-_,x=c-e,p=m-h,f=0,u=1;if(x>-1e-6&&x<1e-6){if(e<=-v||e>=v)return!1}else{var y=1/x,X=(-v-e)*y,g=(v-e)*y;if(X>g){var z=X;X=g,g=z}X>0&&(f=X),g<1&&(u=g)}if(f>=1||u<=0)return!1;var d=0,Y=0;e-=v;var Z,M=this.cosTheta*this.cosTheta,I=M*(b*b+x*x+p*p)-x*x,V=M*(_*b+e*x+h*p)-e*x,L=M*(_*_+e*e+h*h)-e*e,w=V*V-I*L;if(0!=I){if(w<0)return!1;var k=Math.sqrt(w);if(I<0){if(x>0){if(d=0,(Y=(-V+k)/I)<=0)return!1}else if(Y=1,(d=(-V-k)/I)>=1)return!1}else if(Y=(-V+k)/I,(d=(-V-k)/I)>=1||Y<=0)return!1}else{var B=-L/(2*V);if(V>0){if(d=0,Y=B,B<=0)return!1}else if(d=B,Y=1,B>=1)return!1}if(e+=v,Y<=f||u<=d)return!1;if(d<f){if(0==(Z=f))return!1;r.normal.init(0,x>0?-1:1,0)}else{if(0==(Z=d))return!1;var A=r.normal.init(_+b*Z,0,h+p*Z),P=Math.sqrt(A.x*A.x+A.y*A.y+A.z*A.z);P>0&&(P=1/P);var S=A.x*P,T=A.y*P,C=A.z*P;A.x=S,A.y=T,A.z=C;var j=A,R=this.cosTheta,q=j.x*R,E=j.y*R,D=j.z*R;j.x=q,j.y=E,j.z=D,r.normal.y+=this.sinTheta}return r.position.init(_+Z*b,e+Z*x,h+Z*p),r.fraction=Z,!0}},t.collision.geometry.ConvexHullGeometry=class extends t.collision.geometry.ConvexGeometry{constructor(i){super(5),this._numVertices=i.length;var a=new Array(this._numVertices);this._vertices=a;var s=new Array(this._numVertices);this._tmpVertices=s;for(var o=0,n=this._numVertices;o<n;){var r=o++;this._vertices[r]=i[r],this._tmpVertices[r]=new t.common.Vec3}this._useGjkRayCast=!0,this._updateMass()}getVertices(){return this._vertices}_updateMass(){this._volume=1,this._inertiaCoeff00=1,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=1,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=1;for(var t=this._vertices[0].x,i=this._vertices[0].y,a=this._vertices[0].z,s=this._vertices[0].x,o=this._vertices[0].y,n=this._vertices[0].z,r=1,_=this._numVertices;r<_;){var e=r++,h=this._vertices[e].x,l=this._vertices[e].y,c=this._vertices[e].z;h<t?t=h:h>s&&(s=h),l<i?i=l:l>o&&(o=l),c<a?a=c:c>n&&(n=c)}var m=s-t,v=o-i,b=n-a;this._volume=m*v*b;var x=.25*((t+s)*(t+s)+(i+o)*(i+o)+(a+n)*(a+n));m=m*m*.25,v=v*v*.25,b=b*b*.25,this._inertiaCoeff00=.3333333333333333*(v+b)+x,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(b+m)+x,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(m+v)+x}_computeAabb(t,i){var a,s,o,n,r,_,e,h,l,c,m,v;e=this._gjkMargin,h=this._gjkMargin,l=this._gjkMargin;var b,x,p,f=this._vertices[0];c=f.x,m=f.y,v=f.z,b=i._rotation00*c+i._rotation01*m+i._rotation02*v,x=i._rotation10*c+i._rotation11*m+i._rotation12*v,p=i._rotation20*c+i._rotation21*m+i._rotation22*v,a=b+=i._positionX,s=x+=i._positionY,o=p+=i._positionZ,n=b,r=x,_=p;for(var u=1,y=this._numVertices;u<y;){var X=u++,g=this._vertices[X];c=g.x,m=g.y,v=g.z,b=i._rotation00*c+i._rotation01*m+i._rotation02*v,x=i._rotation10*c+i._rotation11*m+i._rotation12*v,p=i._rotation20*c+i._rotation21*m+i._rotation22*v,a=a<(b+=i._positionX)?a:b,s=s<(x+=i._positionY)?s:x,o=o<(p+=i._positionZ)?o:p,n=n>b?n:b,r=r>x?r:x,_=_>p?_:p}t._minX=a-e,t._minY=s-h,t._minZ=o-l,t._maxX=n+e,t._maxY=r+h,t._maxZ=_+l}computeLocalSupportingVertex(t,i){for(var a=this._vertices[0],s=a.x*t.x+a.y*t.y+a.z*t.z,o=0,n=1,r=this._numVertices;n<r;){var _=n++,e=this._vertices[_],h=e.x*t.x+e.y*t.y+e.z*t.z;h>s&&(s=h,o=_)}var l=this._vertices[o];i.x=l.x,i.y=l.y,i.z=l.z}},t.collision.geometry.CylinderGeometry=class extends t.collision.geometry.ConvexGeometry{constructor(t,i){super(2),this._radius=t,this._halfHeight=i,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){var t=this._radius*this._radius,i=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2,this._inertiaCoeff00=.08333333333333333*(3*t+i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.5*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.08333333333333333*(3*t+i)}_computeAabb(t,i){var a,s,o,n,r,_,e,h,l,c=(a=(a=i._rotation01)<0?-a:a)*a,m=(s=(s=i._rotation11)<0?-s:s)*s,v=(o=(o=i._rotation21)<0?-o:o)*o;n=Math.sqrt(1-c),r=Math.sqrt(1-m),_=Math.sqrt(1-v),n*=this._radius,r*=this._radius,_*=this._radius,e=n+a*this._halfHeight,h=r+s*this._halfHeight,l=_+o*this._halfHeight,t._minX=i._positionX-e,t._minY=i._positionY-h,t._minZ=i._positionZ-l,t._maxX=i._positionX+e,t._maxY=i._positionY+h,t._maxZ=i._positionZ+l}computeLocalSupportingVertex(t,i){var a=t.x,s=t.z,o=a*a+s*s,n=this._radius-this._gjkMargin;n<0&&(n=0);var r=o>0?n/Math.sqrt(o):0,_=this._halfHeight-this._gjkMargin;_<0&&(_=0),i.x=a*r,i.y=t.y>0?_:-_,i.z=s*r}_rayCastLocal(t,i,a,s,o,n,r){var _=t,e=i,h=a,l=s,c=o,m=n,v=this._halfHeight,b=l-_,x=c-e,p=m-h,f=0,u=1;if(x>-1e-6&&x<1e-6){if(e<=-v||e>=v)return!1}else{var y=1/x,X=(-v-e)*y,g=(v-e)*y;if(X>g){var z=X;X=g,g=z}X>0&&(f=X),g<1&&(u=g)}if(f>=1||u<=0)return!1;var d,Y=0,Z=1,M=b*b+p*p,I=_*b+h*p,V=_*_+h*h-this._radius*this._radius,L=I*I-M*V;if(L<0)return!1;if(M>0){var w=Math.sqrt(L);if(Z=(-I+w)/M,(Y=(-I-w)/M)>=1||Z<=0)return!1}else{if(V>=0)return!1;Y=0,Z=1}if(Z<=f||u<=Y)return!1;if(Y<f){if(0==(d=f))return!1;r.normal.init(0,x>0?-1:1,0)}else{if(0==(d=Y))return!1;var k=r.normal.init(_+b*d,0,h+p*d),B=Math.sqrt(k.x*k.x+k.y*k.y+k.z*k.z);B>0&&(B=1/B);var A=k.x*B,P=k.y*B,S=k.z*B;k.x=A,k.y=P,k.z=S}return r.position.init(_+d*b,e+d*x,h+d*p),r.fraction=d,!0}},t.collision.geometry.GeometryType=class{},t.collision.geometry.RayCastHit=class{constructor(){this.position=new t.common.Vec3,this.normal=new t.common.Vec3,this.fraction=0}},t.collision.geometry.SphereGeometry=class extends t.collision.geometry.ConvexGeometry{constructor(t){super(0),this._radius=t,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}_updateMass(){this._volume=4.188790204786386*this._radius*this._radius*this._radius,this._inertiaCoeff00=.4*this._radius*this._radius,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.4*this._radius*this._radius,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.4*this._radius*this._radius}_computeAabb(t,i){var a,s,o;a=this._radius,s=this._radius,o=this._radius,t._minX=i._positionX-a,t._minY=i._positionY-s,t._minZ=i._positionZ-o,t._maxX=i._positionX+a,t._maxY=i._positionY+s,t._maxZ=i._positionZ+o}computeLocalSupportingVertex(t,i){i.zero()}_rayCastLocal(t,i,a,s,o,n,r){var _,e,h,l=(_=s-t)*_+(e=o-i)*e+(h=n-a)*h,c=t*_+i*e+a*h,m=c*c-l*(t*t+i*i+a*a-this._radius*this._radius);if(m<0)return!1;var v,b,x,p,f,u,y=(-c-Math.sqrt(m))/l;if(y<0||y>1)return!1;var X=(v=t+_*y)*v+(b=i+e*y)*b+(x=a+h*y)*x;X>0&&(X=1/Math.sqrt(X)),p=v*X,f=b*X,u=x*X;var g=r.position;g.x=v,g.y=b,g.z=x;var z=r.normal;return z.x=p,z.y=f,z.z=u,r.fraction=y,!0}},t.collision.narrowphase||(t.collision.narrowphase={}),t.collision.narrowphase.CollisionMatrix=class{constructor(){var i=new Array(8);this.detectors=i;var a=this.detectors,s=new Array(8);a[0]=s;var o=this.detectors,n=new Array(8);o[1]=n;var r=this.detectors,_=new Array(8);r[2]=_;var e=this.detectors,h=new Array(8);e[3]=h;var l=this.detectors,c=new Array(8);l[4]=c;var m=this.detectors,v=new Array(8);m[5]=v;var b=new t.collision.narrowphase.detector.GjkEpaDetector;this.detectors[0][0]=new t.collision.narrowphase.detector.SphereSphereDetector,this.detectors[0][1]=new t.collision.narrowphase.detector.SphereBoxDetector(!1),this.detectors[0][2]=b,this.detectors[0][3]=b,this.detectors[0][4]=new t.collision.narrowphase.detector.SphereCapsuleDetector(!1),this.detectors[0][5]=b,this.detectors[1][0]=new t.collision.narrowphase.detector.SphereBoxDetector(!0),this.detectors[1][1]=new t.collision.narrowphase.detector.BoxBoxDetector,this.detectors[1][2]=b,this.detectors[1][3]=b,this.detectors[1][4]=b,this.detectors[1][5]=b,this.detectors[2][0]=b,this.detectors[2][1]=b,this.detectors[2][2]=b,this.detectors[2][3]=b,this.detectors[2][4]=b,this.detectors[2][5]=b,this.detectors[3][0]=b,this.detectors[3][1]=b,this.detectors[3][2]=b,this.detectors[3][3]=b,this.detectors[3][4]=b,this.detectors[3][5]=b,this.detectors[4][0]=new t.collision.narrowphase.detector.SphereCapsuleDetector(!0),this.detectors[4][1]=b,this.detectors[4][2]=b,this.detectors[4][3]=b,this.detectors[4][4]=new t.collision.narrowphase.detector.CapsuleCapsuleDetector,this.detectors[4][5]=b,this.detectors[5][0]=b,this.detectors[5][1]=b,this.detectors[5][2]=b,this.detectors[5][3]=b,this.detectors[5][4]=b,this.detectors[5][5]=b}getDetector(t,i){return this.detectors[t][i]}},t.collision.narrowphase.DetectorResult=class{constructor(){this.numPoints=0,this.normal=new t.common.Vec3;var i=new Array(t.common.Setting.maxManifoldPoints);this.points=i,this.incremental=!1;for(var a=0,s=t.common.Setting.maxManifoldPoints;a<s;){var o=a++;this.points[o]=new t.collision.narrowphase.DetectorResultPoint}}getMaxDepth(){for(var t=0,i=0,a=this.numPoints;i<a;){var s=i++;this.points[s].depth>t&&(t=this.points[s].depth)}return t}clear(){this.numPoints=0;for(var t=0,i=this.points;t<i.length;){var a=i[t];++t,a.position1.zero(),a.position2.zero(),a.depth=0,a.id=0}this.normal.zero()}},t.collision.narrowphase.DetectorResultPoint=class{constructor(){this.position1=new t.common.Vec3,this.position2=new t.common.Vec3,this.depth=0,this.id=0}},t.collision.narrowphase.detector||(t.collision.narrowphase.detector={}),t.collision.narrowphase.detector.Detector=class{constructor(t){this.swapped=t}setNormal(t,i,a,s){var o=t.normal;if(o.x=i,o.y=a,o.z=s,this.swapped){var n=t.normal,r=-n.x,_=-n.y,e=-n.z;n.x=r,n.y=_,n.z=e}}addPoint(t,i,a,s,o,n,r,_,e){var h=t.points[t.numPoints++];if(h.depth=_,h.id=e,this.swapped){var l=h.position1;l.x=o,l.y=n,l.z=r;var c=h.position2;c.x=i,c.y=a,c.z=s}else{var m=h.position1;m.x=i,m.y=a,m.z=s;var v=h.position2;v.x=o,v.y=n,v.z=r}}detectImpl(t,i,a,s,o,n){}detect(t,i,a,s,o,n){t.numPoints=0;for(var r=0,_=t.points;r<_.length;){var e=_[r];++r,e.position1.zero(),e.position2.zero(),e.depth=0,e.id=0}t.normal.zero(),this.swapped?this.detectImpl(t,a,i,o,s,n):this.detectImpl(t,i,a,s,o,n)}},t.collision.narrowphase.detector.BoxBoxDetector=class extends t.collision.narrowphase.detector.Detector{constructor(){super(!1),this.clipper=new t.collision.narrowphase.detector._BoxBoxDetector.FaceClipper}detectImpl(i,a,s,o,n,r){var _,e,h,l,c,m,v,b,x,p,f,u,y,X,g,z,d,Y,Z,M,I,V,L,w,k,B,A,P=a,S=s;i.incremental=!1,_=o._positionX,e=o._positionY,h=o._positionZ,v=(l=n._positionX)-_,b=(c=n._positionY)-e,x=(m=n._positionZ)-h,p=o._rotation00,f=o._rotation10,u=o._rotation20,y=o._rotation01,X=o._rotation11,g=o._rotation21,z=o._rotation02,d=o._rotation12,Y=o._rotation22,Z=n._rotation00,M=n._rotation10,I=n._rotation20,V=n._rotation01,L=n._rotation11,w=n._rotation21,k=n._rotation02,B=n._rotation12,A=n._rotation22;var T,C,j,R,q,E,D,F,N,W,G,J,O,H,U,Q,K,$,tt=P._halfExtentsX,it=P._halfExtentsY,at=P._halfExtentsZ,st=S._halfExtentsX,ot=S._halfExtentsY,nt=S._halfExtentsZ;T=p*tt,C=f*tt,j=u*tt,R=y*it,q=X*it,E=g*it,D=z*at,F=d*at,N=Y*at;var rt,_t,et,ht=1/0,lt=-1,ct=0;rt=0,_t=0,et=0;var mt=tt,vt=p*(W=Z*st)+f*(G=M*st)+u*(J=I*st),bt=p*(O=V*ot)+f*(H=L*ot)+u*(U=w*ot),xt=p*(Q=k*nt)+f*(K=B*nt)+u*($=A*nt);vt<0&&(vt=-vt),bt<0&&(bt=-bt),xt<0&&(xt=-xt);var pt=vt+bt+xt,ft=p*v+f*b+u*x,ut=mt+pt,yt=ft<0,Xt=yt?-ft:ft;if(Xt<ut){var gt=ut-Xt;gt<ht&&(ht=gt,lt=0,rt=p,_t=f,et=u,ct=yt?-1:1);var zt=y*W+X*G+g*J,dt=y*O+X*H+g*U,Yt=y*Q+X*K+g*$;zt<0&&(zt=-zt),dt<0&&(dt=-dt),Yt<0&&(Yt=-Yt);var Zt=(mt=it)+(pt=zt+dt+Yt),Mt=(ft=y*v+X*b+g*x)<0,It=Mt?-ft:ft;if(It<Zt){var Vt=Zt-It;Vt<ht&&(ht=Vt,lt=1,rt=y,_t=X,et=g,ct=Mt?-1:1);var Lt=z*W+d*G+Y*J,wt=z*O+d*H+Y*U,kt=z*Q+d*K+Y*$;Lt<0&&(Lt=-Lt),wt<0&&(wt=-wt),kt<0&&(kt=-kt);var Bt=(mt=at)+(pt=Lt+wt+kt),At=(ft=z*v+d*b+Y*x)<0,Pt=At?-ft:ft;if(Pt<Bt){var St=Bt-Pt;St<ht&&(ht=St,lt=2,rt=z,_t=d,et=Y,ct=At?-1:1),ht>t.common.Setting.linearSlop?ht-=t.common.Setting.linearSlop:ht=0;var Tt=Z*T+M*C+I*j,Ct=Z*R+M*q+I*E,jt=Z*D+M*F+I*N;Tt<0&&(Tt=-Tt),Ct<0&&(Ct=-Ct),jt<0&&(jt=-jt);var Rt=(mt=Tt+Ct+jt)+(pt=st),qt=(ft=Z*v+M*b+I*x)<0,Et=qt?-ft:ft;if(Et<Rt){var Dt=Rt-Et;Dt<ht&&(ht=Dt,lt=3,rt=Z,_t=M,et=I,ct=qt?-1:1);var Ft=V*T+L*C+w*j,Nt=V*R+L*q+w*E,Wt=V*D+L*F+w*N;Ft<0&&(Ft=-Ft),Nt<0&&(Nt=-Nt),Wt<0&&(Wt=-Wt);var Gt=(mt=Ft+Nt+Wt)+(pt=ot),Jt=(ft=V*v+L*b+w*x)<0,Ot=Jt?-ft:ft;if(Ot<Gt){var Ht=Gt-Ot;Ht<ht&&(ht=Ht,lt=4,rt=V,_t=L,et=w,ct=Jt?-1:1);var Ut=k*T+B*C+A*j,Qt=k*R+B*q+A*E,Kt=k*D+B*F+A*N;Ut<0&&(Ut=-Ut),Qt<0&&(Qt=-Qt),Kt<0&&(Kt=-Kt);var $t=(mt=Ut+Qt+Kt)+(pt=nt),ti=(ft=k*v+B*b+A*x)<0,ii=ti?-ft:ft;if(ii<$t){var ai,si,oi,ni,ri,_i,ei,hi,li,ci,mi,vi,bi,xi,pi,fi,ui,yi,Xi,gi,zi,di=$t-ii;if(di<ht&&(ht=di,lt=5,rt=k,_t=B,et=A,ct=ti?-1:1),ht>t.common.Setting.linearSlop?ht-=t.common.Setting.linearSlop:ht=0,si=u*Z-p*I,oi=p*M-f*Z,0!=(ai=f*I-u*M)||0!=si||0!=oi){var Yi=ai*ai+si*si+oi*oi;Yi>0&&(Yi=1/Math.sqrt(Yi));var Zi=(ai*=Yi)*R+(si*=Yi)*q+(oi*=Yi)*E,Mi=ai*D+si*F+oi*N;Zi<0&&(Zi=-Zi),Mi<0&&(Mi=-Mi);var Ii=ai*O+si*H+oi*U,Vi=ai*Q+si*K+oi*$;Ii<0&&(Ii=-Ii),Vi<0&&(Vi=-Vi);var Li=(mt=Zi+Mi)+(pt=Ii+Vi),wi=(ft=ai*v+si*b+oi*x)<0,ki=wi?-ft:ft;if(!(ki<Li))return;var Bi=Li-ki;Bi<ht&&(ht=Bi,lt=6,rt=ai,_t=si,et=oi,ct=wi?-1:1)}if(si=u*V-p*w,oi=p*L-f*V,0!=(ai=f*w-u*L)||0!=si||0!=oi){var Ai=ai*ai+si*si+oi*oi;Ai>0&&(Ai=1/Math.sqrt(Ai));var Pi=(ai*=Ai)*R+(si*=Ai)*q+(oi*=Ai)*E,Si=ai*D+si*F+oi*N;Pi<0&&(Pi=-Pi),Si<0&&(Si=-Si);var Ti=ai*W+si*G+oi*J,Ci=ai*Q+si*K+oi*$;Ti<0&&(Ti=-Ti),Ci<0&&(Ci=-Ci);var ji=(mt=Pi+Si)+(pt=Ti+Ci),Ri=(ft=ai*v+si*b+oi*x)<0,qi=Ri?-ft:ft;if(!(qi<ji))return;var Ei=ji-qi;Ei<ht&&(ht=Ei,lt=7,rt=ai,_t=si,et=oi,ct=Ri?-1:1)}if(si=u*k-p*A,oi=p*B-f*k,0!=(ai=f*A-u*B)||0!=si||0!=oi){var Di=ai*ai+si*si+oi*oi;Di>0&&(Di=1/Math.sqrt(Di));var Fi=(ai*=Di)*R+(si*=Di)*q+(oi*=Di)*E,Ni=ai*D+si*F+oi*N;Fi<0&&(Fi=-Fi),Ni<0&&(Ni=-Ni);var Wi=ai*W+si*G+oi*J,Gi=ai*O+si*H+oi*U;Wi<0&&(Wi=-Wi),Gi<0&&(Gi=-Gi);var Ji=(mt=Fi+Ni)+(pt=Wi+Gi),Oi=(ft=ai*v+si*b+oi*x)<0,Hi=Oi?-ft:ft;if(!(Hi<Ji))return;var Ui=Ji-Hi;Ui<ht&&(ht=Ui,lt=8,rt=ai,_t=si,et=oi,ct=Oi?-1:1)}if(si=g*Z-y*I,oi=y*M-X*Z,0!=(ai=X*I-g*M)||0!=si||0!=oi){var Qi=ai*ai+si*si+oi*oi;Qi>0&&(Qi=1/Math.sqrt(Qi));var Ki=(ai*=Qi)*T+(si*=Qi)*C+(oi*=Qi)*j,$i=ai*D+si*F+oi*N;Ki<0&&(Ki=-Ki),$i<0&&($i=-$i);var ta=ai*O+si*H+oi*U,ia=ai*Q+si*K+oi*$;ta<0&&(ta=-ta),ia<0&&(ia=-ia);var aa=(mt=Ki+$i)+(pt=ta+ia),sa=(ft=ai*v+si*b+oi*x)<0,oa=sa?-ft:ft;if(!(oa<aa))return;var na=aa-oa;na<ht&&(ht=na,lt=9,rt=ai,_t=si,et=oi,ct=sa?-1:1)}if(si=g*V-y*w,oi=y*L-X*V,0!=(ai=X*w-g*L)||0!=si||0!=oi){var ra=ai*ai+si*si+oi*oi;ra>0&&(ra=1/Math.sqrt(ra));var _a=(ai*=ra)*T+(si*=ra)*C+(oi*=ra)*j,ea=ai*D+si*F+oi*N;_a<0&&(_a=-_a),ea<0&&(ea=-ea);var ha=ai*W+si*G+oi*J,la=ai*Q+si*K+oi*$;ha<0&&(ha=-ha),la<0&&(la=-la);var ca=(mt=_a+ea)+(pt=ha+la),ma=(ft=ai*v+si*b+oi*x)<0,va=ma?-ft:ft;if(!(va<ca))return;var ba=ca-va;ba<ht&&(ht=ba,lt=10,rt=ai,_t=si,et=oi,ct=ma?-1:1)}if(si=g*k-y*A,oi=y*B-X*k,0!=(ai=X*A-g*B)||0!=si||0!=oi){var xa=ai*ai+si*si+oi*oi;xa>0&&(xa=1/Math.sqrt(xa));var pa=(ai*=xa)*T+(si*=xa)*C+(oi*=xa)*j,fa=ai*D+si*F+oi*N;pa<0&&(pa=-pa),fa<0&&(fa=-fa);var ua=ai*W+si*G+oi*J,ya=ai*O+si*H+oi*U;ua<0&&(ua=-ua),ya<0&&(ya=-ya);var Xa=(mt=pa+fa)+(pt=ua+ya),ga=(ft=ai*v+si*b+oi*x)<0,za=ga?-ft:ft;if(!(za<Xa))return;var da=Xa-za;da<ht&&(ht=da,lt=11,rt=ai,_t=si,et=oi,ct=ga?-1:1)}if(si=Y*Z-z*I,oi=z*M-d*Z,0!=(ai=d*I-Y*M)||0!=si||0!=oi){var Ya=ai*ai+si*si+oi*oi;Ya>0&&(Ya=1/Math.sqrt(Ya));var Za=(ai*=Ya)*T+(si*=Ya)*C+(oi*=Ya)*j,Ma=ai*R+si*q+oi*E;Za<0&&(Za=-Za),Ma<0&&(Ma=-Ma);var Ia=ai*O+si*H+oi*U,Va=ai*Q+si*K+oi*$;Ia<0&&(Ia=-Ia),Va<0&&(Va=-Va);var La=(mt=Za+Ma)+(pt=Ia+Va),wa=(ft=ai*v+si*b+oi*x)<0,ka=wa?-ft:ft;if(!(ka<La))return;var Ba=La-ka;Ba<ht&&(ht=Ba,lt=12,rt=ai,_t=si,et=oi,ct=wa?-1:1)}if(si=Y*V-z*w,oi=z*L-d*V,0!=(ai=d*w-Y*L)||0!=si||0!=oi){var Aa=ai*ai+si*si+oi*oi;Aa>0&&(Aa=1/Math.sqrt(Aa));var Pa=(ai*=Aa)*T+(si*=Aa)*C+(oi*=Aa)*j,Sa=ai*R+si*q+oi*E;Pa<0&&(Pa=-Pa),Sa<0&&(Sa=-Sa);var Ta=ai*W+si*G+oi*J,Ca=ai*Q+si*K+oi*$;Ta<0&&(Ta=-Ta),Ca<0&&(Ca=-Ca);var ja=(mt=Pa+Sa)+(pt=Ta+Ca),Ra=(ft=ai*v+si*b+oi*x)<0,qa=Ra?-ft:ft;if(!(qa<ja))return;var Ea=ja-qa;Ea<ht&&(ht=Ea,lt=13,rt=ai,_t=si,et=oi,ct=Ra?-1:1)}if(si=Y*k-z*A,oi=z*B-d*k,0!=(ai=d*A-Y*B)||0!=si||0!=oi){var Da=ai*ai+si*si+oi*oi;Da>0&&(Da=1/Math.sqrt(Da));var Fa=(ai*=Da)*T+(si*=Da)*C+(oi*=Da)*j,Na=ai*R+si*q+oi*E;Fa<0&&(Fa=-Fa),Na<0&&(Na=-Na);var Wa=ai*W+si*G+oi*J,Ga=ai*O+si*H+oi*U;Wa<0&&(Wa=-Wa),Ga<0&&(Ga=-Ga);var Ja=(mt=Fa+Na)+(pt=Wa+Ga),Oa=(ft=ai*v+si*b+oi*x)<0,Ha=Oa?-ft:ft;if(!(Ha<Ja))return;var Ua=Ja-Ha;Ua<ht&&(ht=Ua,lt=14,rt=ai,_t=si,et=oi,ct=Oa?-1:1)}if(lt>=6){rt*=ct,_t*=ct,et*=ct;var Qa,Ka,$a,ts,is,as,ss,os,ns,rs,_s,es,hs,ls,cs,ms=(lt-6)/3|0,vs=lt-6-3*ms;switch(ms){case 0:ss=p,os=f,ns=u;var bs=D*rt+F*_t+N*et>0;R*rt+q*_t+E*et>0?bs?(Qa=R+D,Ka=q+F,$a=E+N):(Qa=R-D,Ka=q-F,$a=E-N):bs?(Qa=D-R,Ka=F-q,$a=N-E):(Qa=-(Qa=R+D),Ka=-(Ka=q+F),$a=-($a=E+N));break;case 1:ss=y,os=X,ns=g;var xs=D*rt+F*_t+N*et>0;T*rt+C*_t+j*et>0?xs?(Qa=T+D,Ka=C+F,$a=j+N):(Qa=T-D,Ka=C-F,$a=j-N):xs?(Qa=D-T,Ka=F-C,$a=N-j):(Qa=-(Qa=T+D),Ka=-(Ka=C+F),$a=-($a=j+N));break;default:ss=z,os=d,ns=Y;var ps=R*rt+q*_t+E*et>0;T*rt+C*_t+j*et>0?ps?(Qa=T+R,Ka=C+q,$a=j+E):(Qa=T-R,Ka=C-q,$a=j-E):ps?(Qa=R-T,Ka=q-C,$a=E-j):(Qa=-(Qa=T+R),Ka=-(Ka=C+q),$a=-($a=j+E))}switch(Qa=_+Qa,Ka=e+Ka,$a=h+$a,vs){case 0:rs=Z,_s=M,es=I;var fs=Q*rt+K*_t+$*et>0;O*rt+H*_t+U*et>0?fs?(ts=O+Q,is=H+K,as=U+$):(ts=O-Q,is=H-K,as=U-$):fs?(ts=Q-O,is=K-H,as=$-U):(ts=-(ts=O+Q),is=-(is=H+K),as=-(as=U+$));break;case 1:rs=V,_s=L,es=w;var us=Q*rt+K*_t+$*et>0;W*rt+G*_t+J*et>0?us?(ts=W+Q,is=G+K,as=J+$):(ts=W-Q,is=G-K,as=J-$):us?(ts=Q-W,is=K-G,as=$-J):(ts=-(ts=W+Q),is=-(is=G+K),as=-(as=J+$));break;default:rs=k,_s=B,es=A;var ys=O*rt+H*_t+U*et>0;W*rt+G*_t+J*et>0?ys?(ts=W+O,is=G+H,as=J+U):(ts=W-O,is=G-H,as=J-U):ys?(ts=O-W,is=H-G,as=U-J):(ts=-(ts=W+O),is=-(is=G+H),as=-(as=J+U))}var Xs,gs,zs,ds,Ys,Zs,Ms,Is,Vs,Ls=ss*rs+os*_s+ns*es,ws=ss*(hs=Qa-(ts=l-ts))+os*(ls=Ka-(is=c-is))+ns*(cs=$a-(as=m-as)),ks=rs*hs+_s*ls+es*cs,Bs=1/(1-Ls*Ls),As=(Ls*ks-ws)*Bs,Ps=(ks-Ls*ws)*Bs;return Xs=Qa+ss*As,gs=Ka+os*As,zs=$a+ns*As,ds=ts+rs*Ps,Ys=is+_s*Ps,Zs=as+es*Ps,Ms=-rt,Is=-_t,Vs=-et,this.setNormal(i,Ms,Is,Vs),void this.addPoint(i,Xs,gs,zs,ds,Ys,Zs,ht,4)}if(lt>=3){ct=-ct,v=-v,b=-b,x=-x;var Ss=P;P=S,S=Ss;var Ts=tt;tt=st,st=Ts;var Cs=it;it=ot,ot=Cs;var js=at;at=nt,nt=js,ni=_,ri=e,_i=h,_=l,e=c,h=m,l=ni,c=ri,m=_i,ni=p,ri=f,_i=u,p=Z,f=M,u=I,Z=ni,M=ri,I=_i,ni=y,ri=X,_i=g,y=V,X=L,g=w,V=ni,L=ri,w=_i,ni=z,ri=d,_i=Y,z=k,d=B,Y=A,k=ni,B=ri,A=_i,ni=T,ri=C,_i=j,T=W,C=G,j=J,W=ni,G=ri,J=_i,ni=R,ri=q,_i=E,R=O,q=H,E=U,O=ni,H=ri,U=_i,ni=D,ri=F,_i=N,D=Q,F=K,N=$,Q=ni,K=ri,$=_i,lt-=3,ei=!0}else ei=!1;switch(lt){case 0:hi=T,li=C,ci=j,mi=p,vi=f,bi=u,xi=y,pi=X,fi=g,ui=z,yi=d,Xi=Y,gi=it,zi=at;break;case 1:hi=R,li=q,ci=E,mi=y,vi=X,bi=g,xi=z,pi=d,fi=Y,ui=p,yi=f,Xi=u,gi=at,zi=tt;break;default:hi=D,li=F,ci=N,mi=z,vi=d,bi=Y,xi=p,pi=f,fi=u,ui=y,yi=X,Xi=g,gi=tt,zi=it}if(ct<0){hi=-hi,li=-li,ci=-ci,mi=-mi,vi=-vi,bi=-bi,ni=xi,ri=pi,_i=fi,xi=ui,pi=yi,fi=Xi,ui=ni,yi=ri,Xi=_i;var Rs=gi;gi=zi,zi=Rs}hi+=_,li+=e,ci+=h;var qs,Es,Ds,Fs,Ns,Ws,Gs,Js,Os,Hs,Us,Qs,Ks=1,$s=0,to=mi*Z+vi*M+bi*I;switch(to<Ks&&(Ks=to,$s=0),-to<Ks&&(Ks=-to,$s=1),(to=mi*V+vi*L+bi*w)<Ks&&(Ks=to,$s=2),-to<Ks&&(Ks=-to,$s=3),(to=mi*k+vi*B+bi*A)<Ks&&(Ks=to,$s=4),-to<Ks&&(Ks=-to,$s=5),$s){case 0:qs=W+O,Es=G+H,Ds=J+U,qs+=Q,Es+=K,Ds+=$,Fs=W-O,Ns=G-H,Ws=J-U,Fs+=Q,Ns+=K,Ws+=$,Gs=W-O,Js=G-H,Os=J-U,Gs-=Q,Js-=K,Os-=$,Hs=W+O,Us=G+H,Qs=J+U,Hs-=Q,Us-=K,Qs-=$;break;case 1:qs=O-W,Es=H-G,Ds=U-J,qs+=Q,Es+=K,Ds+=$,Fs=O-W,Ns=H-G,Ws=U-J,Fs-=Q,Ns-=K,Ws-=$,Gs=-(Gs=W+O),Js=-(Js=G+H),Os=-(Os=J+U),Gs-=Q,Js-=K,Os-=$,Hs=-(Hs=W+O),Us=-(Us=G+H),Qs=-(Qs=J+U),Hs+=Q,Us+=K,Qs+=$;break;case 2:qs=W+O,Es=G+H,Ds=J+U,qs+=Q,Es+=K,Ds+=$,Fs=W+O,Ns=G+H,Ws=J+U,Fs-=Q,Ns-=K,Ws-=$,Gs=O-W,Js=H-G,Os=U-J,Gs-=Q,Js-=K,Os-=$,Hs=O-W,Us=H-G,Qs=U-J,Hs+=Q,Us+=K,Qs+=$;break;case 3:qs=W-O,Es=G-H,Ds=J-U,qs+=Q,Es+=K,Ds+=$,Fs=-(Fs=W+O),Ns=-(Ns=G+H),Ws=-(Ws=J+U),Fs+=Q,Ns+=K,Ws+=$,Gs=-(Gs=W+O),Js=-(Js=G+H),Os=-(Os=J+U),Gs-=Q,Js-=K,Os-=$,Hs=W-O,Us=G-H,Qs=J-U,Hs-=Q,Us-=K,Qs-=$;break;case 4:qs=W+O,Es=G+H,Ds=J+U,qs+=Q,Es+=K,Ds+=$,Fs=O-W,Ns=H-G,Ws=U-J,Fs+=Q,Ns+=K,Ws+=$,Gs=-(Gs=W+O),Js=-(Js=G+H),Os=-(Os=J+U),Gs+=Q,Js+=K,Os+=$,Hs=W-O,Us=G-H,Qs=J-U,Hs+=Q,Us+=K,Qs+=$;break;default:qs=W+O,Es=G+H,Ds=J+U,qs-=Q,Es-=K,Ds-=$,Fs=W-O,Ns=G-H,Ws=J-U,Fs-=Q,Ns-=K,Ws-=$,Gs=-(Gs=W+O),Js=-(Js=G+H),Os=-(Os=J+U),Gs-=Q,Js-=K,Os-=$,Hs=O-W,Us=H-G,Qs=U-J,Hs-=Q,Us-=K,Qs-=$}qs+=v,Es+=b,Ds+=x,Fs+=v,Ns+=b,Ws+=x,Gs+=v,Js+=b,Os+=x,Hs+=v,Us+=b,Qs+=x;var io=this.clipper;io.w=gi,io.h=zi,io.numVertices=0,io.numTmpVertices=0;var ao=this.clipper,so=ao.vertices[ao.numVertices++];so.x=qs*xi+Es*pi+Ds*fi,so.y=qs*ui+Es*yi+Ds*Xi,so.wx=qs,so.wy=Es,so.wz=Ds;var oo=this.clipper,no=oo.vertices[oo.numVertices++];no.x=Fs*xi+Ns*pi+Ws*fi,no.y=Fs*ui+Ns*yi+Ws*Xi,no.wx=Fs,no.wy=Ns,no.wz=Ws;var ro=this.clipper,_o=ro.vertices[ro.numVertices++];_o.x=Gs*xi+Js*pi+Os*fi,_o.y=Gs*ui+Js*yi+Os*Xi,_o.wx=Gs,_o.wy=Js,_o.wz=Os;var eo,ho,lo,co=this.clipper,mo=co.vertices[co.numVertices++];mo.x=Hs*xi+Us*pi+Qs*fi,mo.y=Hs*ui+Us*yi+Qs*Xi,mo.wx=Hs,mo.wy=Us,mo.wz=Qs,this.clipper.clip(),this.clipper.reduce(),ei?(eo=mi,ho=vi,lo=bi):(eo=-mi,ho=-vi,lo=-bi),this.setNormal(i,eo,ho,lo);for(var vo=0,bo=this.clipper.numVertices;vo<bo;){var xo,po,fo,uo=vo++,yo=this.clipper.vertices[uo];xo=yo.wx,po=yo.wy,fo=yo.wz;var Xo,go,zo,Yo=(hi-(xo+=_))*mi+(li-(po+=e))*vi+(ci-(fo+=h))*bi;Xo=xo+mi*Yo,go=po+vi*Yo,zo=fo+bi*Yo,Yo>-t.common.Setting.contactPersistenceThreshold&&(ei?this.addPoint(i,xo,po,fo,Xo,go,zo,Yo,uo):this.addPoint(i,Xo,go,zo,xo,po,fo,Yo,uo))}}}}}}}}},t.collision.narrowphase.detector._BoxBoxDetector||(t.collision.narrowphase.detector._BoxBoxDetector={}),t.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex=class{constructor(){this.x=0,this.y=0,this.wx=0,this.wy=0,this.wz=0}},t.collision.narrowphase.detector._BoxBoxDetector.FaceClipper=class{constructor(){this.w=0,this.h=0,this.numVertices=0,this.numTmpVertices=0;var i=new Array(8);this.vertices=i;var a=new Array(8);this.tmpVertices=a,this.vertices[0]=new t.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[0]=new t.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[1]=new t.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[1]=new t.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[2]=new t.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[2]=new t.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[3]=new t.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[3]=new t.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[4]=new t.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[4]=new t.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[5]=new t.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[5]=new t.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[6]=new t.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[6]=new t.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[7]=new t.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[7]=new t.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex}clip(){for(var t=0,i=this.numVertices;t<i;){var a=t++,s=this.vertices[a],o=this.vertices[(a+1)%this.numVertices],n=this.w+s.x,r=this.w+o.x;if(n>0&&r>0){var _=this.tmpVertices[this.numTmpVertices++];_.x=s.x,_.y=s.y,_.wx=s.wx,_.wy=s.wy,_.wz=s.wz}else if(n>0&&r<=0){var e=this.tmpVertices[this.numTmpVertices++];e.x=s.x,e.y=s.y,e.wx=s.wx,e.wy=s.wy,e.wz=s.wz;var h=n/(n-r),l=this.tmpVertices[this.numTmpVertices++];l.x=s.x+(o.x-s.x)*h,l.y=s.y+(o.y-s.y)*h,l.wx=s.wx+(o.wx-s.wx)*h,l.wy=s.wy+(o.wy-s.wy)*h,l.wz=s.wz+(o.wz-s.wz)*h}else if(n<=0&&r>0){var c=n/(n-r),m=this.tmpVertices[this.numTmpVertices++];m.x=s.x+(o.x-s.x)*c,m.y=s.y+(o.y-s.y)*c,m.wx=s.wx+(o.wx-s.wx)*c,m.wy=s.wy+(o.wy-s.wy)*c,m.wz=s.wz+(o.wz-s.wz)*c}}var v=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=v,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var b=0,x=this.numVertices;b<x;){var p=b++,f=this.vertices[p],u=this.vertices[(p+1)%this.numVertices],y=this.w-f.x,X=this.w-u.x;if(y>0&&X>0){var g=this.tmpVertices[this.numTmpVertices++];g.x=f.x,g.y=f.y,g.wx=f.wx,g.wy=f.wy,g.wz=f.wz}else if(y>0&&X<=0){var z=this.tmpVertices[this.numTmpVertices++];z.x=f.x,z.y=f.y,z.wx=f.wx,z.wy=f.wy,z.wz=f.wz;var d=y/(y-X),Y=this.tmpVertices[this.numTmpVertices++];Y.x=f.x+(u.x-f.x)*d,Y.y=f.y+(u.y-f.y)*d,Y.wx=f.wx+(u.wx-f.wx)*d,Y.wy=f.wy+(u.wy-f.wy)*d,Y.wz=f.wz+(u.wz-f.wz)*d}else if(y<=0&&X>0){var Z=y/(y-X),M=this.tmpVertices[this.numTmpVertices++];M.x=f.x+(u.x-f.x)*Z,M.y=f.y+(u.y-f.y)*Z,M.wx=f.wx+(u.wx-f.wx)*Z,M.wy=f.wy+(u.wy-f.wy)*Z,M.wz=f.wz+(u.wz-f.wz)*Z}}var I=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=I,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var V=0,L=this.numVertices;V<L;){var w=V++,k=this.vertices[w],B=this.vertices[(w+1)%this.numVertices],A=this.h+k.y,P=this.h+B.y;if(A>0&&P>0){var S=this.tmpVertices[this.numTmpVertices++];S.x=k.x,S.y=k.y,S.wx=k.wx,S.wy=k.wy,S.wz=k.wz}else if(A>0&&P<=0){var T=this.tmpVertices[this.numTmpVertices++];T.x=k.x,T.y=k.y,T.wx=k.wx,T.wy=k.wy,T.wz=k.wz;var C=A/(A-P),j=this.tmpVertices[this.numTmpVertices++];j.x=k.x+(B.x-k.x)*C,j.y=k.y+(B.y-k.y)*C,j.wx=k.wx+(B.wx-k.wx)*C,j.wy=k.wy+(B.wy-k.wy)*C,j.wz=k.wz+(B.wz-k.wz)*C}else if(A<=0&&P>0){var R=A/(A-P),q=this.tmpVertices[this.numTmpVertices++];q.x=k.x+(B.x-k.x)*R,q.y=k.y+(B.y-k.y)*R,q.wx=k.wx+(B.wx-k.wx)*R,q.wy=k.wy+(B.wy-k.wy)*R,q.wz=k.wz+(B.wz-k.wz)*R}}var E=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=E,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var D=0,F=this.numVertices;D<F;){var N=D++,W=this.vertices[N],G=this.vertices[(N+1)%this.numVertices],J=this.h-W.y,O=this.h-G.y;if(J>0&&O>0){var H=this.tmpVertices[this.numTmpVertices++];H.x=W.x,H.y=W.y,H.wx=W.wx,H.wy=W.wy,H.wz=W.wz}else if(J>0&&O<=0){var U=this.tmpVertices[this.numTmpVertices++];U.x=W.x,U.y=W.y,U.wx=W.wx,U.wy=W.wy,U.wz=W.wz;var Q=J/(J-O),K=this.tmpVertices[this.numTmpVertices++];K.x=W.x+(G.x-W.x)*Q,K.y=W.y+(G.y-W.y)*Q,K.wx=W.wx+(G.wx-W.wx)*Q,K.wy=W.wy+(G.wy-W.wy)*Q,K.wz=W.wz+(G.wz-W.wz)*Q}else if(J<=0&&O>0){var $=J/(J-O),tt=this.tmpVertices[this.numTmpVertices++];tt.x=W.x+(G.x-W.x)*$,tt.y=W.y+(G.y-W.y)*$,tt.wx=W.wx+(G.wx-W.wx)*$,tt.wy=W.wy+(G.wy-W.wy)*$,tt.wz=W.wz+(G.wz-W.wz)*$}}var it=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=it,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}reduce(){if(!(this.numVertices<4)){for(var t=-1/0,i=1/0,a=-1/0,s=1/0,o=null,n=null,r=null,_=null,e=0,h=this.numVertices;e<h;){var l=e++,c=this.vertices[l],m=1*c.x+1*c.y,v=-1*c.x+1*c.y;m>t&&(t=m,o=c),m<i&&(i=m,n=c),v>a&&(a=v,r=c),v<s&&(s=v,_=c)}var b=this.tmpVertices[this.numTmpVertices++];b.x=o.x,b.y=o.y,b.wx=o.wx,b.wy=o.wy,b.wz=o.wz;var x=this.tmpVertices[this.numTmpVertices++];x.x=r.x,x.y=r.y,x.wx=r.wx,x.wy=r.wy,x.wz=r.wz;var p=this.tmpVertices[this.numTmpVertices++];p.x=n.x,p.y=n.y,p.wx=n.wx,p.wy=n.wy,p.wz=n.wz;var f=this.tmpVertices[this.numTmpVertices++];f.x=_.x,f.y=_.y,f.wx=_.wx,f.wy=_.wy,f.wz=_.wz;var u=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=u,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}}},t.collision.narrowphase.detector.BoxBoxDetectorMacro=class{},t.collision.narrowphase.detector.CachedDetectorData=class{constructor(){}_clear(){null!=this._gjkCache&&this._gjkCache.clear()}},t.collision.narrowphase.detector.CapsuleCapsuleDetector=class extends t.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,i,a,s,o,n){var r,_,e,h,l,c,m=i,v=a;t.incremental=!1,r=s._rotation01,_=s._rotation11,e=s._rotation21,h=o._rotation01,l=o._rotation11,c=o._rotation21;var b,x,p,f,u,y,X,g,z,d,Y,Z,M,I,V,L,w,k,B=m._halfHeight,A=v._halfHeight,P=m._radius,S=v._radius;b=s._positionX+r*-B,x=s._positionY+_*-B,p=s._positionZ+e*-B,f=s._positionX+r*B,u=s._positionY+_*B,y=s._positionZ+e*B;var T,C,j,R,q,E,D,F,N,W,G,J=-((d=b-(X=o._positionX+h*-A))*(M=f-b)+(Y=x-(g=o._positionY+l*-A))*(I=u-x)+(Z=p-(z=o._positionZ+c*-A))*(V=y-p)),O=d*(L=o._positionX+h*A-X)+Y*(w=o._positionY+l*A-g)+Z*(k=o._positionZ+c*A-z),H=B*B*4,U=M*L+I*w+V*k,Q=A*A*4;if(0==H&&0==Q)T=0,C=0;else if(0==H)T=0,(C=O)<0?C=0:C>Q?C=1:C/=Q;else if(0==Q)C=0,(T=J)<0?T=0:T>H?T=1:T/=H;else{var K=H*Q-U*U;0==K||(T=U*O+Q*J)<0?T=0:T>K?T=1:T/=K,(C=T*U+O)<0?(C=0,(T=J)<0?T=0:T>H?T=1:T/=H):C>Q?(C=1,(T=U+J)<0?T=0:T>H?T=1:T/=H):C/=Q}var $=(N=(j=b+M*T)-(E=X+L*C))*N+(W=(R=x+I*T)-(D=g+w*C))*W+(G=(q=p+V*T)-(F=z+k*C))*G;if(!($>=(P+S)*(P+S))){var tt,it,at,st,ot,nt,rt,_t,et,ht=Math.sqrt($);ht>0?(tt=N*(1/ht),it=W*(1/ht),at=G*(1/ht)):(tt=1,it=0,at=0),this.setNormal(t,tt,it,at),st=j+tt*-P,ot=R+it*-P,nt=q+at*-P,rt=E+tt*S,_t=D+it*S,et=F+at*S,this.addPoint(t,st,ot,nt,rt,_t,et,P+S-ht,0)}}},t.collision.narrowphase.detector.GjkEpaDetector=class extends t.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(i,a,s,o,n,r){var _=t.collision.narrowphase.detector.gjkepa.GjkEpa.instance,e=a,h=s,l=_.computeClosestPointsImpl(e,h,o,n,t.common.Setting.enableGJKCaching?r:null,!0);if(i.incremental=!0,l==t.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED){var c=e._gjkMargin,m=h._gjkMargin;if(!(_.distance>c+m)){var v,b,x,p,f,u,y=_.closestPoint1;v=y.x,b=y.y,x=y.z;var X,g,z,d=_.closestPoint2;if((X=v-(p=d.x))*X+(g=b-(f=d.y))*g+(z=x-(u=d.z))*z!=0){_.distance<0&&(X=-X,g=-g,z=-z);var Y=X*X+g*g+z*z;Y>0&&(Y=1/Math.sqrt(Y)),X*=Y,g*=Y,z*=Y,this.setNormal(i,X,g,z),v+=X*-e._gjkMargin,b+=g*-e._gjkMargin,x+=z*-e._gjkMargin,p+=X*h._gjkMargin,f+=g*h._gjkMargin,u+=z*h._gjkMargin,this.addPoint(i,v,b,x,p,f,u,e._gjkMargin+h._gjkMargin-_.distance,0)}}}else console.log("src/oimo/collision/narrowphase/detector/GjkEpaDetector.hx:28:","GJK/EPA failed: status="+l)}},t.collision.narrowphase.detector.SphereBoxDetector=class extends t.collision.narrowphase.detector.Detector{constructor(t){super(t)}detectImpl(t,i,a,s,o,n){var r,_,e,h,l,c,m=i,v=a;t.incremental=!1,h=-(r=v._halfExtentsX),l=-(_=v._halfExtentsY),c=-(e=v._halfExtentsZ);var b,x,p,f,u,y,X,g,z,d,Y=m._radius;if(b=s._positionX-o._positionX,x=s._positionY-o._positionY,p=s._positionZ-o._positionZ,X=o._rotation00*b+o._rotation10*x+o._rotation20*p,u=o._rotation01*b+o._rotation11*x+o._rotation21*p,y=o._rotation02*b+o._rotation12*x+o._rotation22*p,h<(f=X)&&r>f&&l<u&&_>u&&c<y&&e>y){var Z,M,I,V,L,w,k,B,A,P,S,T,C,j,R,q,E,D,F,N,W,G,J,O,H;Z=r-(Z=f<0?-f:f),M=_-(M=u<0?-u:u),I=e-(I=y<0?-y:y);return Z<M?Z<I?(f>0?(V=1,L=0,w=0):(V=-1,L=0,w=0),B=0,A=1,P=1,k=Z):(y>0?(V=0,L=0,w=1):(V=0,L=0,w=-1),B=1,A=1,P=0,k=I):M<I?(u>0?(V=0,L=1,w=0):(V=0,L=-1,w=0),B=1,A=0,P=1,k=M):(y>0?(V=0,L=0,w=1):(V=0,L=0,w=-1),B=1,A=1,P=0,k=I),S=V*r,T=L*_,C=w*e,S+=B*f,T+=A*u,C+=P*y,j=o._rotation00*S+o._rotation01*T+o._rotation02*C,R=o._rotation10*S+o._rotation11*T+o._rotation12*C,q=o._rotation20*S+o._rotation21*T+o._rotation22*C,E=o._rotation00*V+o._rotation01*L+o._rotation02*w,D=o._rotation10*V+o._rotation11*L+o._rotation12*w,F=o._rotation20*V+o._rotation21*L+o._rotation22*w,this.setNormal(t,E,D,F),N=s._positionX+E*-Y,W=s._positionY+D*-Y,G=s._positionZ+F*-Y,J=o._positionX+j,O=o._positionY+R,H=o._positionZ+q,void this.addPoint(t,N,W,G,J,O,H,k,0)}var U,Q,K,$=1e-9;var tt=(U=f-(g=(g=f<(r-=1e-9)?f:r)>(h+=1e-9)?g:h))*U+(Q=u-(z=(z=u<(_-=1e-9)?u:_)>(l+=1e-9)?z:l))*Q+(K=y-(d=(d=y<(e-=1e-9)?y:e)>(c+=1e-9)?d:c))*K;if(!(tt>=Y*Y)){var it,at,st,ot,nt,rt,_t,et,ht;tt=Math.sqrt(tt),it=o._rotation00*g+o._rotation01*z+o._rotation02*d,at=o._rotation10*g+o._rotation11*z+o._rotation12*d,st=o._rotation20*g+o._rotation21*z+o._rotation22*d;var lt,ct,mt,vt,bt,xt,pt=(ot=o._rotation00*U+o._rotation01*Q+o._rotation02*K)*ot+(nt=o._rotation10*U+o._rotation11*Q+o._rotation12*K)*nt+(rt=o._rotation20*U+o._rotation21*Q+o._rotation22*K)*rt;pt>0&&(pt=1/Math.sqrt(pt)),_t=ot*pt,et=nt*pt,ht=rt*pt,this.setNormal(t,_t,et,ht),lt=s._positionX+_t*-Y,ct=s._positionY+et*-Y,mt=s._positionZ+ht*-Y,vt=o._positionX+it,bt=o._positionY+at,xt=o._positionZ+st,this.addPoint(t,lt,ct,mt,vt,bt,xt,Y-tt,0)}}},t.collision.narrowphase.detector.SphereCapsuleDetector=class extends t.collision.narrowphase.detector.Detector{constructor(t){super(t)}detectImpl(t,i,a,s,o,n){var r=i,_=a;t.incremental=!1;var e,h,l,c,m,v,b,x,p,f,u,y,X=_._halfHeight,g=r._radius,z=_._radius;e=o._rotation01,h=o._rotation11,l=o._rotation21,c=s._positionX,m=s._positionY,v=s._positionZ,b=o._positionX+e*-X,x=o._positionY+h*-X,p=o._positionZ+l*-X;var d,Y,Z,M,I,V,L=X*X*4,w=(c-b)*(f=o._positionX+e*X-b)+(m-x)*(u=o._positionY+h*X-x)+(v-p)*(y=o._positionZ+l*X-p);w<0?w=0:w>L?w=1:w/=L;var k=(M=c-(d=b+f*w))*M+(I=m-(Y=x+u*w))*I+(V=v-(Z=p+y*w))*V;if(!(k>=(g+z)*(g+z))){var B,A,P,S,T,C,j,R,q,E=Math.sqrt(k);E>0?(B=M*(1/E),A=I*(1/E),P=V*(1/E)):(B=1,A=0,P=0),this.setNormal(t,B,A,P),S=c+B*-g,T=m+A*-g,C=v+P*-g,j=d+B*z,R=Y+A*z,q=Z+P*z,this.addPoint(t,S,T,C,j,R,q,g+z-E,0)}}},t.collision.narrowphase.detector.SphereSphereDetector=class extends t.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,i,a,s,o,n){var r,_,e,h=i,l=a;t.incremental=!1,r=s._positionX-o._positionX,_=s._positionY-o._positionY,e=s._positionZ-o._positionZ;var c=h._radius,m=l._radius,v=r*r+_*_+e*e;if(!(v>=(c+m)*(c+m))){var b,x,p,f,u,y,X,g,z,d=Math.sqrt(v);d>0?(b=r*(1/d),x=_*(1/d),p=e*(1/d)):(b=1,x=0,p=0),this.setNormal(t,b,x,p),f=s._positionX+b*-c,u=s._positionY+x*-c,y=s._positionZ+p*-c,X=o._positionX+b*m,g=o._positionY+x*m,z=o._positionZ+p*m,this.addPoint(t,f,u,y,X,g,z,c+m-d,0)}}},t.collision.narrowphase.detector.gjkepa||(t.collision.narrowphase.detector.gjkepa={}),t.collision.narrowphase.detector.gjkepa.EpaPolyhedron=class{constructor(){var i=new Array(t.common.Setting.maxEPAVertices);this._vertices=i,this._center=new t.common.Vec3,this._numVertices=0,this._triangleList=null,this._triangleListLast=null,this._numTriangles=0,this._trianglePool=null,this._vertexPool=null}dumpHoleEdge(t){}validate(){for(var t=this._triangleList;null!=t;){var i=t._next;if(t._vertices[0]._tmpEdgeLoopOuterTriangle=null,t._vertices[0]._tmpEdgeLoopNext=null,-1==t._adjacentPairIndex[0])return this._status=2,!1;if(null==t._adjacentTriangles[0])return this._status=3,!1;if(t._vertices[1]._tmpEdgeLoopOuterTriangle=null,t._vertices[1]._tmpEdgeLoopNext=null,-1==t._adjacentPairIndex[1])return this._status=2,!1;if(null==t._adjacentTriangles[1])return this._status=3,!1;if(t._vertices[2]._tmpEdgeLoopOuterTriangle=null,t._vertices[2]._tmpEdgeLoopNext=null,-1==t._adjacentPairIndex[2])return this._status=2,!1;if(null==t._adjacentTriangles[2])return this._status=3,!1;t=i}return!0}findEdgeLoop(t,i,a){if(i._tmpDfsId!=t){i._tmpDfsId=t;var s=i.tmp;s.x=a.x,s.y=a.y,s.z=a.z;var o=s,n=i._vertices[0].v,r=o.x-n.x,_=o.y-n.y,e=o.z-n.z;o.x=r,o.y=_,o.z=e;var h=i.tmp,l=i._normal;if(i._tmpDfsVisible=h.x*l.x+h.y*l.y+h.z*l.z>0,i._tmpDfsVisible){for(var c=0;c<3;){var m=c++,v=i._adjacentTriangles[m];if(null!=v){var b=v.tmp;b.x=a.x,b.y=a.y,b.z=a.z;var x=b,p=v._vertices[0].v,f=x.x-p.x,u=x.y-p.y,y=x.z-p.z;x.x=f,x.y=u,x.z=y;var X=v.tmp,g=v._normal;if(v._tmpDfsVisible=X.x*g.x+X.y*g.y+X.z*g.z>0,v._tmpDfsVisible)this.findEdgeLoop(t,v,a);else{var z=i._nextIndex[m],d=i._vertices[m],Y=i._vertices[z];d._tmpEdgeLoopNext=Y,d._tmpEdgeLoopOuterTriangle=v}}}var Z=i._adjacentTriangles[0];if(null!=Z){var M=i._adjacentPairIndex[0];Z._adjacentTriangles[M]=null,Z._adjacentPairIndex[M]=-1,i._adjacentTriangles[0]=null,i._adjacentPairIndex[0]=-1}var I=i._adjacentTriangles[1];if(null!=I){var V=i._adjacentPairIndex[1];I._adjacentTriangles[V]=null,I._adjacentPairIndex[V]=-1,i._adjacentTriangles[1]=null,i._adjacentPairIndex[1]=-1}var L=i._adjacentTriangles[2];if(null!=L){var w=i._adjacentPairIndex[2];L._adjacentTriangles[w]=null,L._adjacentPairIndex[w]=-1,i._adjacentTriangles[2]=null,i._adjacentPairIndex[2]=-1}this._numTriangles--;var k=i._prev,B=i._next;null!=k&&(k._next=B),null!=B&&(B._prev=k),i==this._triangleList&&(this._triangleList=this._triangleList._next),i==this._triangleListLast&&(this._triangleListLast=this._triangleListLast._prev),i._next=null,i._prev=null,i.removeReferences(),i._next=this._trianglePool,this._trianglePool=i}else this._status=6}}_init(i,a,s,o){this._status=0,this._numVertices=4,this._vertices[0]=i,this._vertices[1]=a,this._vertices[2]=s,this._vertices[3]=o;var n=this._center,r=i.v;n.x=r.x,n.y=r.y,n.z=r.z;var _=n,e=a.v,h=_.x+e.x,l=_.y+e.y,c=_.z+e.z;_.x=h,_.y=l,_.z=c;var m=_,v=s.v,b=m.x+v.x,x=m.y+v.y,p=m.z+v.z;m.x=b,m.y=x,m.z=p;var f=m,u=o.v,y=f.x+u.x,X=f.y+u.y,g=f.z+u.z;f.x=y,f.y=X,f.z=g;var z=f,d=.25*z.x,Y=.25*z.y,Z=.25*z.z;z.x=d,z.y=Y,z.z=Z;var M=this._trianglePool;null!=M?(this._trianglePool=M._next,M._next=null):M=new t.collision.narrowphase.detector.gjkepa.EpaTriangle;var I=M,V=this._trianglePool;null!=V?(this._trianglePool=V._next,V._next=null):V=new t.collision.narrowphase.detector.gjkepa.EpaTriangle;var L=V,w=this._trianglePool;null!=w?(this._trianglePool=w._next,w._next=null):w=new t.collision.narrowphase.detector.gjkepa.EpaTriangle;var k=w,B=this._trianglePool;null!=B?(this._trianglePool=B._next,B._next=null):B=new t.collision.narrowphase.detector.gjkepa.EpaTriangle;var A=B;I.init(i,a,s,this._center,!0)||(this._status=1);L.init(i,a,o,this._center,!0)||(this._status=1);k.init(i,s,o,this._center,!0)||(this._status=1);return A.init(a,s,o,this._center,!0)||(this._status=1),I.setAdjacentTriangle(L)||(this._status=1),I.setAdjacentTriangle(k)||(this._status=1),I.setAdjacentTriangle(A)||(this._status=1),L.setAdjacentTriangle(k)||(this._status=1),L.setAdjacentTriangle(A)||(this._status=1),k.setAdjacentTriangle(A)||(this._status=1),this._numTriangles++,null==this._triangleList?(this._triangleList=I,this._triangleListLast=I):(this._triangleListLast._next=I,I._prev=this._triangleListLast,this._triangleListLast=I),this._numTriangles++,null==this._triangleList?(this._triangleList=L,this._triangleListLast=L):(this._triangleListLast._next=L,L._prev=this._triangleListLast,this._triangleListLast=L),this._numTriangles++,null==this._triangleList?(this._triangleList=k,this._triangleListLast=k):(this._triangleListLast._next=k,k._prev=this._triangleListLast,this._triangleListLast=k),this._numTriangles++,null==this._triangleList?(this._triangleList=A,this._triangleListLast=A):(this._triangleListLast._next=A,A._prev=this._triangleListLast,this._triangleListLast=A),0==this._status}_addVertex(i,a){this._vertices[this._numVertices++]=i;var s=a._vertices[0];if(this.findEdgeLoop(this._numVertices,a,i.v),0!=this._status)return!1;for(var o=s,n=s,r=null,_=null;;){if(null==o._tmpEdgeLoopNext)return this._dumpAsObjModel(),this._status=4,!1;if(null==o._tmpEdgeLoopOuterTriangle)return this._status=5,!1;var e=this._trianglePool;null!=e?(this._trianglePool=e._next,e._next=null):e=new t.collision.narrowphase.detector.gjkepa.EpaTriangle;var h=e;if(null==_&&(_=h),h.init(o,o._tmpEdgeLoopNext,i,this._center,!1)||(this._status=1),0!=this._status)return!1;if(this._numTriangles++,null==this._triangleList?(this._triangleList=h,this._triangleListLast=h):(this._triangleListLast._next=h,h._prev=this._triangleListLast,this._triangleListLast=h),h.setAdjacentTriangle(o._tmpEdgeLoopOuterTriangle)||(this._status=1),null!=r&&(h.setAdjacentTriangle(r)||(this._status=1)),r=h,(o=o._tmpEdgeLoopNext)==n)break}return r.setAdjacentTriangle(_)||(this._status=1),0==this._status&&this.validate()}_dumpAsObjModel(){}},t.collision.narrowphase.detector.gjkepa.EpaPolyhedronState=class{},t.collision.narrowphase.detector.gjkepa.EpaTriangle=class{constructor(){this.id=++t.collision.narrowphase.detector.gjkepa.EpaTriangle.count,this._next=null,this._prev=null,this._normal=new t.common.Vec3,this._distanceSq=0,this._tmpDfsId=0,this._tmpDfsVisible=!1;var i=new Array(3);this._vertices=i;var a=new Array(3);this._adjacentTriangles=a;var s=new Array(3);this._adjacentPairIndex=s,this.tmp=new t.common.Vec3;var o=new Array(3);this._nextIndex=o,this._nextIndex[0]=1,this._nextIndex[1]=2,this._nextIndex[2]=0}init(t,i,a,s,o){var n,r,_,e,h,l,c,m,v;null==o&&(o=!1);var b=t.v;n=b.x,r=b.y,_=b.z;var x=i.v;e=x.x,h=x.y,l=x.z;var p=a.v;c=p.x,m=p.y,v=p.z;var f,u,y,X,g,z,d,Y,Z,M=s,I=!1;if((n-M.x)*(d=(u=h-r)*(z=v-_)-(y=l-_)*(g=m-r))+(r-M.y)*(Y=y*(X=c-n)-(f=e-n)*z)+(_-M.z)*(Z=f*g-u*X)<0)if(o){var V=i;i=a,a=V,d*=-1,Y*=-1,Z*=-1}else I=!0;this._vertices[0]=t,this._vertices[1]=i,this._vertices[2]=a;var L=this._normal;L.x=d,L.y=Y,L.z=Z;var w,k,B,A,P,S,T,C,j,R,q,E,D,F,N,W,G,J,O=t.v,H=i.v,U=a.v,Q=this.tmp,K=O;w=K.x,k=K.y,B=K.z;var $=H;A=$.x,P=$.y,S=$.z;var tt,it,at,st=U;T=st.x;var ot,nt,rt,_t=A*((F=(C=st.y)-P)*(at=(R=A-w)*F-(q=P-k)*(D=T-A))-(N=(j=st.z)-S)*(it=(E=S-B)*D-R*N))+P*(N*(tt=q*N-E*F)-D*at)+S*(D*it-F*tt),et=T*((G=k-C)*at-(J=B-j)*it)+C*(J*tt-(W=w-T)*at)+j*(W*it-G*tt),ht=-1;if(ot=0,nt=0,rt=0,w*(q*at-E*it)+k*(E*tt-R*at)+B*(R*it-q*tt)<0){var lt,ct,mt,vt,bt,xt,pt=O;lt=pt.x,ct=pt.y,mt=pt.z;var ft,ut,yt,Xt=H,gt=(ft=(vt=Xt.x)-lt)*lt+(ut=(bt=Xt.y)-ct)*ct+(yt=(xt=Xt.z)-mt)*mt;if((gt=-gt/(ft*ft+ut*ut+yt*yt))<0){var zt=Q;zt.x=lt,zt.y=ct,zt.z=mt}else if(gt>1){var dt=Q;dt.x=vt,dt.y=bt,dt.z=xt}else{var Yt,Zt,Mt;Yt=lt+ft*gt,Zt=ct+ut*gt,Mt=mt+yt*gt;var It=Q;It.x=Yt,It.y=Zt,It.z=Mt}ht=Q.x*Q.x+Q.y*Q.y+Q.z*Q.z;var Vt=Q;ot=Vt.x,nt=Vt.y,rt=Vt.z}if(_t<0){var Lt,wt,kt,Bt,At,Pt,St=H;Lt=St.x,wt=St.y,kt=St.z;var Tt,Ct,jt,Rt=U,qt=(Tt=(Bt=Rt.x)-Lt)*Lt+(Ct=(At=Rt.y)-wt)*wt+(jt=(Pt=Rt.z)-kt)*kt;if((qt=-qt/(Tt*Tt+Ct*Ct+jt*jt))<0){var Et=Q;Et.x=Lt,Et.y=wt,Et.z=kt}else if(qt>1){var Dt=Q;Dt.x=Bt,Dt.y=At,Dt.z=Pt}else{var Ft,Nt,Wt;Ft=Lt+Tt*qt,Nt=wt+Ct*qt,Wt=kt+jt*qt;var Gt=Q;Gt.x=Ft,Gt.y=Nt,Gt.z=Wt}var Jt=Q.x*Q.x+Q.y*Q.y+Q.z*Q.z;if(ht<0||Jt<ht){ht=Jt;var Ot=Q;ot=Ot.x,nt=Ot.y,rt=Ot.z}}if(et<0){var Ht,Ut,Qt,Kt,$t,ti,ii=O;Ht=ii.x,Ut=ii.y,Qt=ii.z;var ai,si,oi,ni=U,ri=(ai=(Kt=ni.x)-Ht)*Ht+(si=($t=ni.y)-Ut)*Ut+(oi=(ti=ni.z)-Qt)*Qt;if((ri=-ri/(ai*ai+si*si+oi*oi))<0){var _i=Q;_i.x=Ht,_i.y=Ut,_i.z=Qt}else if(ri>1){var ei=Q;ei.x=Kt,ei.y=$t,ei.z=ti}else{var hi,li,ci;hi=Ht+ai*ri,li=Ut+si*ri,ci=Qt+oi*ri;var mi=Q;mi.x=hi,mi.y=li,mi.z=ci}var vi=Q.x*Q.x+Q.y*Q.y+Q.z*Q.z;if(ht<0||vi<ht){ht=vi;var bi=Q;ot=bi.x,nt=bi.y,rt=bi.z}}if(ht>0){var xi=Q;xi.x=ot,xi.y=nt,xi.z=rt}else{var pi=tt*tt+it*it+at*at;pi>0&&(pi=1/Math.sqrt(pi));var fi=(tt*=pi)*tt+(it*=pi)*it+(at*=pi)*at;ot=tt*(fi=(w*tt+k*it+B*at)/fi),nt=it*fi,rt=at*fi;var ui=Q;ui.x=ot,ui.y=nt,ui.z=rt}var yi=this.tmp;return this._distanceSq=yi.x*yi.x+yi.y*yi.y+yi.z*yi.z,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=-1,this._adjacentPairIndex[1]=-1,this._adjacentPairIndex[2]=-1,!I}setAdjacentTriangle(t){var i=0,a=this._nextIndex[0],s=this._nextIndex[0];this._vertices[0]==t._vertices[s]&&this._vertices[a]==t._vertices[0]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=0,++i);var o=this._nextIndex[0],n=this._nextIndex[1];this._vertices[0]==t._vertices[n]&&this._vertices[o]==t._vertices[1]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=0,++i);var r=this._nextIndex[0],_=this._nextIndex[2];this._vertices[0]==t._vertices[_]&&this._vertices[r]==t._vertices[2]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=0,++i);var e=this._nextIndex[1],h=this._nextIndex[0];this._vertices[1]==t._vertices[h]&&this._vertices[e]==t._vertices[0]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=1,++i);var l=this._nextIndex[1],c=this._nextIndex[1];this._vertices[1]==t._vertices[c]&&this._vertices[l]==t._vertices[1]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=1,++i);var m=this._nextIndex[1],v=this._nextIndex[2];this._vertices[1]==t._vertices[v]&&this._vertices[m]==t._vertices[2]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=1,++i);var b=this._nextIndex[2],x=this._nextIndex[0];this._vertices[2]==t._vertices[x]&&this._vertices[b]==t._vertices[0]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=2,++i);var p=this._nextIndex[2],f=this._nextIndex[1];this._vertices[2]==t._vertices[f]&&this._vertices[p]==t._vertices[1]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=2,++i);var u=this._nextIndex[2],y=this._nextIndex[2];return this._vertices[2]==t._vertices[y]&&this._vertices[u]==t._vertices[2]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=2,++i),1==i}removeAdjacentTriangles(){var t=this._adjacentTriangles[0];if(null!=t){var i=this._adjacentPairIndex[0];t._adjacentTriangles[i]=null,t._adjacentPairIndex[i]=-1,this._adjacentTriangles[0]=null,this._adjacentPairIndex[0]=-1}var a=this._adjacentTriangles[1];if(null!=a){var s=this._adjacentPairIndex[1];a._adjacentTriangles[s]=null,a._adjacentPairIndex[s]=-1,this._adjacentTriangles[1]=null,this._adjacentPairIndex[1]=-1}var o=this._adjacentTriangles[2];if(null!=o){var n=this._adjacentPairIndex[2];o._adjacentTriangles[n]=null,o._adjacentPairIndex[n]=-1,this._adjacentTriangles[2]=null,this._adjacentPairIndex[2]=-1}}removeReferences(){this._next=null,this._prev=null,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._distanceSq=0,this._vertices[0]=null,this._vertices[1]=null,this._vertices[2]=null,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=0,this._adjacentPairIndex[1]=0,this._adjacentPairIndex[2]=0}dump(){}},t.collision.narrowphase.detector.gjkepa.EpaVertex=class{constructor(){this.randId=1e5*Math.random()|0,this.v=new t.common.Vec3,this.w1=new t.common.Vec3,this.w2=new t.common.Vec3}init(t,i,a){var s=this.v;s.x=t.x,s.y=t.y,s.z=t.z;var o=this.w1;o.x=i.x,o.y=i.y,o.z=i.z;var n=this.w2;return n.x=a.x,n.y=a.y,n.z=a.z,this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null,this}removeReferences(){this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null}},t.collision.narrowphase.detector.gjkepa.GjkCache=class{constructor(){this.prevClosestDir=new t.common.Vec3}clear(){this.prevClosestDir.zero()}},t.common||(t.common={}),t.common.Vec3=class{constructor(i,a,s){null==s&&(s=0),null==a&&(a=0),null==i&&(i=0),this.x=i,this.y=a,this.z=s,t.common.Vec3.numCreations++}init(t,i,a){return this.x=t,this.y=i,this.z=a,this}zero(){return this.x=0,this.y=0,this.z=0,this}add(i){return new t.common.Vec3(this.x+i.x,this.y+i.y,this.z+i.z)}add3(i,a,s){return new t.common.Vec3(this.x+i,this.y+a,this.z+s)}addScaled(i,a){return new t.common.Vec3(this.x+i.x*a,this.y+i.y*a,this.z+i.z*a)}sub(i){return new t.common.Vec3(this.x-i.x,this.y-i.y,this.z-i.z)}sub3(i,a,s){return new t.common.Vec3(this.x-i,this.y-a,this.z-s)}scale(i){return new t.common.Vec3(this.x*i,this.y*i,this.z*i)}scale3(i,a,s){return new t.common.Vec3(this.x*i,this.y*a,this.z*s)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(i){return new t.common.Vec3(this.y*i.z-this.z*i.y,this.z*i.x-this.x*i.z,this.x*i.y-this.y*i.x)}addEq(t){var i=this.x+t.x,a=this.y+t.y,s=this.z+t.z;return this.x=i,this.y=a,this.z=s,this}add3Eq(t,i,a){var s=this.x+t,o=this.y+i,n=this.z+a;return this.x=s,this.y=o,this.z=n,this}addScaledEq(t,i){var a=this.x+t.x*i,s=this.y+t.y*i,o=this.z+t.z*i;return this.x=a,this.y=s,this.z=o,this}subEq(t){var i=this.x-t.x,a=this.y-t.y,s=this.z-t.z;return this.x=i,this.y=a,this.z=s,this}sub3Eq(t,i,a){var s=this.x-t,o=this.y-i,n=this.z-a;return this.x=s,this.y=o,this.z=n,this}scaleEq(t){var i=this.x*t,a=this.y*t,s=this.z*t;return this.x=i,this.y=a,this.z=s,this}scale3Eq(t,i,a){var s=this.x*t,o=this.y*i,n=this.z*a;return this.x=s,this.y=o,this.z=n,this}crossEq(t){var i=this.y*t.z-this.z*t.y,a=this.z*t.x-this.x*t.z,s=this.x*t.y-this.y*t.x;return this.x=i,this.y=a,this.z=s,this}mulMat3(i){return new t.common.Vec3(this.x*i.e00+this.y*i.e01+this.z*i.e02,this.x*i.e10+this.y*i.e11+this.z*i.e12,this.x*i.e20+this.y*i.e21+this.z*i.e22)}mulMat4(i){return new t.common.Vec3(this.x*i.e00+this.y*i.e01+this.z*i.e02+i.e03,this.x*i.e10+this.y*i.e11+this.z*i.e12+i.e13,this.x*i.e20+this.y*i.e21+this.z*i.e22+i.e23)}mulTransform(i){var a,s,o,n,r,_,e=this;a=e.x,s=e.y,o=e.z,n=i._rotation00*a+i._rotation01*s+i._rotation02*o,r=i._rotation10*a+i._rotation11*s+i._rotation12*o,_=i._rotation20*a+i._rotation21*s+i._rotation22*o,a=n,s=r,o=_,a+=i._positionX,s+=i._positionY,o+=i._positionZ;var h=new t.common.Vec3,l=h;return l.x=a,l.y=s,l.z=o,h}mulMat3Eq(t){var i=this.x*t.e00+this.y*t.e01+this.z*t.e02,a=this.x*t.e10+this.y*t.e11+this.z*t.e12,s=this.x*t.e20+this.y*t.e21+this.z*t.e22;return this.x=i,this.y=a,this.z=s,this}mulMat4Eq(t){var i=this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,a=this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,s=this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23;return this.x=i,this.y=a,this.z=s,this}mulTransformEq(t){var i,a,s,o,n,r,_=this;i=_.x,a=_.y,s=_.z,o=t._rotation00*i+t._rotation01*a+t._rotation02*s,n=t._rotation10*i+t._rotation11*a+t._rotation12*s,r=t._rotation20*i+t._rotation21*a+t._rotation22*s,i=o,a=n,s=r,i+=t._positionX,a+=t._positionY,s+=t._positionZ;var e=this;return e.x=i,e.y=a,e.z=s,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}normalized(){var i=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return i>0&&(i=1/i),new t.common.Vec3(this.x*i,this.y*i,this.z*i)}normalize(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);t>0&&(t=1/t);var i=this.x*t,a=this.y*t,s=this.z*t;return this.x=i,this.y=a,this.z=s,this}negate(){return new t.common.Vec3(-this.x,-this.y,-this.z)}negateEq(){var t=-this.x,i=-this.y,a=-this.z;return this.x=t,this.y=i,this.z=a,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}clone(){return new t.common.Vec3(this.x,this.y,this.z)}toString(){return"Vec3["+(this.x>0?(1e7*this.x+.5|0)/1e7:(1e7*this.x-.5|0)/1e7)+", "+(this.y>0?(1e7*this.y+.5|0)/1e7:(1e7*this.y-.5|0)/1e7)+", "+(this.z>0?(1e7*this.z+.5|0)/1e7:(1e7*this.z-.5|0)/1e7)+"]"}},t.common.Transform=class{constructor(){this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1}identity(){return this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1,this}getPosition(){var i=new t.common.Vec3,a=i;return a.x=this._positionX,a.y=this._positionY,a.z=this._positionZ,i}getPositionTo(t){var i=t;i.x=this._positionX,i.y=this._positionY,i.z=this._positionZ}setPosition(t){var i=t;return this._positionX=i.x,this._positionY=i.y,this._positionZ=i.z,this}translate(t){var i,a,s,o=t;i=o.x,a=o.y,s=o.z,this._positionX+=i,this._positionY+=a,this._positionZ+=s}getRotation(){var i=new t.common.Mat3,a=i;return a.e00=this._rotation00,a.e01=this._rotation01,a.e02=this._rotation02,a.e10=this._rotation10,a.e11=this._rotation11,a.e12=this._rotation12,a.e20=this._rotation20,a.e21=this._rotation21,a.e22=this._rotation22,i}getRotationTo(t){var i=t;i.e00=this._rotation00,i.e01=this._rotation01,i.e02=this._rotation02,i.e10=this._rotation10,i.e11=this._rotation11,i.e12=this._rotation12,i.e20=this._rotation20,i.e21=this._rotation21,i.e22=this._rotation22}setRotation(t){var i=t;return this._rotation00=i.e00,this._rotation01=i.e01,this._rotation02=i.e02,this._rotation10=i.e10,this._rotation11=i.e11,this._rotation12=i.e12,this._rotation20=i.e20,this._rotation21=i.e21,this._rotation22=i.e22,this}setRotationXyz(t){var i,a,s,o=t;i=o.x,a=o.y,s=o.z;var n=Math.sin(i),r=Math.sin(a),_=Math.sin(s),e=Math.cos(i),h=Math.cos(a),l=Math.cos(s);this._rotation00=h*l,this._rotation01=-h*_,this._rotation02=r,this._rotation10=e*_+l*n*r,this._rotation11=e*l-n*r*_,this._rotation12=-h*n,this._rotation20=n*_-e*l*r,this._rotation21=l*n+e*r*_,this._rotation22=e*h}rotate(t){var i,a,s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y=t;i=y.e00,a=y.e01,s=y.e02,o=y.e10,n=y.e11,r=y.e12,_=y.e20,e=y.e21,h=y.e22,l=i*this._rotation00+a*this._rotation10+s*this._rotation20,c=i*this._rotation01+a*this._rotation11+s*this._rotation21,m=i*this._rotation02+a*this._rotation12+s*this._rotation22,v=o*this._rotation00+n*this._rotation10+r*this._rotation20,b=o*this._rotation01+n*this._rotation11+r*this._rotation21,x=o*this._rotation02+n*this._rotation12+r*this._rotation22,p=_*this._rotation00+e*this._rotation10+h*this._rotation20,f=_*this._rotation01+e*this._rotation11+h*this._rotation21,u=_*this._rotation02+e*this._rotation12+h*this._rotation22,this._rotation00=l,this._rotation01=c,this._rotation02=m,this._rotation10=v,this._rotation11=b,this._rotation12=x,this._rotation20=p,this._rotation21=f,this._rotation22=u}rotateXyz(t){var i,a,s,o,n,r,_,e,h,l,c,m,v=t;i=v.x,a=v.y,s=v.z;var b,x,p,f,u,y,X,g,z,d=Math.sin(i),Y=Math.sin(a),Z=Math.sin(s),M=Math.cos(i),I=Math.cos(a),V=Math.cos(s);n=-I*Z,r=Y,_=M*Z+V*d*Y,e=M*V-d*Y*Z,h=-I*d,l=d*Z-M*V*Y,c=V*d+M*Y*Z,m=M*I,b=(o=I*V)*this._rotation00+n*this._rotation10+r*this._rotation20,x=o*this._rotation01+n*this._rotation11+r*this._rotation21,p=o*this._rotation02+n*this._rotation12+r*this._rotation22,f=_*this._rotation00+e*this._rotation10+h*this._rotation20,u=_*this._rotation01+e*this._rotation11+h*this._rotation21,y=_*this._rotation02+e*this._rotation12+h*this._rotation22,X=l*this._rotation00+c*this._rotation10+m*this._rotation20,g=l*this._rotation01+c*this._rotation11+m*this._rotation21,z=l*this._rotation02+c*this._rotation12+m*this._rotation22,this._rotation00=b,this._rotation01=x,this._rotation02=p,this._rotation10=f,this._rotation11=u,this._rotation12=y,this._rotation20=X,this._rotation21=g,this._rotation22=z}getOrientation(){var i,a,s,o,n,r=new t.common.Quat,_=this._rotation00,e=this._rotation11,h=this._rotation22,l=_+e+h;l>0?(o=.5*(n=Math.sqrt(l+1)),n=.5/n,i=(this._rotation21-this._rotation12)*n,a=(this._rotation02-this._rotation20)*n,s=(this._rotation10-this._rotation01)*n):_>e?_>h?(i=.5*(n=Math.sqrt(_-e-h+1)),n=.5/n,a=(this._rotation01+this._rotation10)*n,s=(this._rotation02+this._rotation20)*n,o=(this._rotation21-this._rotation12)*n):(s=.5*(n=Math.sqrt(h-_-e+1)),n=.5/n,i=(this._rotation02+this._rotation20)*n,a=(this._rotation12+this._rotation21)*n,o=(this._rotation10-this._rotation01)*n):e>h?(a=.5*(n=Math.sqrt(e-h-_+1)),n=.5/n,i=(this._rotation01+this._rotation10)*n,s=(this._rotation12+this._rotation21)*n,o=(this._rotation02-this._rotation20)*n):(s=.5*(n=Math.sqrt(h-_-e+1)),n=.5/n,i=(this._rotation02+this._rotation20)*n,a=(this._rotation12+this._rotation21)*n,o=(this._rotation10-this._rotation01)*n);var c=r;return c.x=i,c.y=a,c.z=s,c.w=o,r}getOrientationTo(t){var i,a,s,o,n,r=this._rotation00,_=this._rotation11,e=this._rotation22,h=r+_+e;h>0?(o=.5*(n=Math.sqrt(h+1)),n=.5/n,i=(this._rotation21-this._rotation12)*n,a=(this._rotation02-this._rotation20)*n,s=(this._rotation10-this._rotation01)*n):r>_?r>e?(i=.5*(n=Math.sqrt(r-_-e+1)),n=.5/n,a=(this._rotation01+this._rotation10)*n,s=(this._rotation02+this._rotation20)*n,o=(this._rotation21-this._rotation12)*n):(s=.5*(n=Math.sqrt(e-r-_+1)),n=.5/n,i=(this._rotation02+this._rotation20)*n,a=(this._rotation12+this._rotation21)*n,o=(this._rotation10-this._rotation01)*n):_>e?(a=.5*(n=Math.sqrt(_-e-r+1)),n=.5/n,i=(this._rotation01+this._rotation10)*n,s=(this._rotation12+this._rotation21)*n,o=(this._rotation02-this._rotation20)*n):(s=.5*(n=Math.sqrt(e-r-_+1)),n=.5/n,i=(this._rotation02+this._rotation20)*n,a=(this._rotation12+this._rotation21)*n,o=(this._rotation10-this._rotation01)*n);var l=t;l.x=i,l.y=a,l.z=s,l.w=o}setOrientation(t){var i,a,s,o,n=t,r=(i=n.x,a=n.y,s=n.z,o=n.w,2*i),_=2*a,e=2*s,h=i*r,l=a*_,c=s*e,m=i*_,v=a*e,b=i*e,x=o*r,p=o*_,f=o*e;return this._rotation00=1-l-c,this._rotation01=m-f,this._rotation02=b+p,this._rotation10=m+f,this._rotation11=1-h-c,this._rotation12=v-x,this._rotation20=b-p,this._rotation21=v+x,this._rotation22=1-h-l,this}clone(){var i=new t.common.Transform;return i._positionX=this._positionX,i._positionY=this._positionY,i._positionZ=this._positionZ,i._rotation00=this._rotation00,i._rotation01=this._rotation01,i._rotation02=this._rotation02,i._rotation10=this._rotation10,i._rotation11=this._rotation11,i._rotation12=this._rotation12,i._rotation20=this._rotation20,i._rotation21=this._rotation21,i._rotation22=this._rotation22,i}copyFrom(t){return this._positionX=t._positionX,this._positionY=t._positionY,this._positionZ=t._positionZ,this._rotation00=t._rotation00,this._rotation01=t._rotation01,this._rotation02=t._rotation02,this._rotation10=t._rotation10,this._rotation11=t._rotation11,this._rotation12=t._rotation12,this._rotation20=t._rotation20,this._rotation21=t._rotation21,this._rotation22=t._rotation22,this}},t.common.Setting=class{},t.collision.narrowphase.detector.gjkepa.GjkEpa=class{constructor(){var i=new Array(4);this.s=i;var a=new Array(4);this.w1=a;var s=new Array(4);this.w2=s;var o=new Array(3);this.baseDirs=o,this.baseDirs[0]=new t.common.Vec3(1,0,0),this.baseDirs[1]=new t.common.Vec3(0,1,0),this.baseDirs[2]=new t.common.Vec3(0,0,1),this.tl1=new t.common.Vec3,this.tl2=new t.common.Vec3,this.rayX=new t.common.Vec3,this.rayR=new t.common.Vec3,this.tempTransform=new t.common.Transform,this.s[0]=new t.common.Vec3,this.w1[0]=new t.common.Vec3,this.w2[0]=new t.common.Vec3,this.s[1]=new t.common.Vec3,this.w1[1]=new t.common.Vec3,this.w2[1]=new t.common.Vec3,this.s[2]=new t.common.Vec3,this.w1[2]=new t.common.Vec3,this.w2[2]=new t.common.Vec3,this.s[3]=new t.common.Vec3,this.w1[3]=new t.common.Vec3,this.w2[3]=new t.common.Vec3,this.dir=new t.common.Vec3,this.closest=new t.common.Vec3,this.closestPoint1=new t.common.Vec3,this.closestPoint2=new t.common.Vec3,this.polyhedron=new t.collision.narrowphase.detector.gjkepa.EpaPolyhedron}computeClosestPointsImpl(i,a,s,o,n,r){this.c1=i,this.c2=a,this.tf1=s,this.tf2=o;var _=this.s,e=this.w1,h=this.w2,l=this.closest,c=this.dir;if(null!=n?(null==n._gjkCache&&(n._gjkCache=new t.collision.narrowphase.detector.gjkepa.GjkCache),this.loadCache(n._gjkCache)):c.zero(),c.x*c.x+c.y*c.y+c.z*c.z==0){var m,v,b;m=o._positionX-s._positionX,v=o._positionY-s._positionY,b=o._positionZ-s._positionZ;var x=c;x.x=m,x.y=v,x.z=b,c.x*c.x+c.y*c.y+c.z*c.z<1e-6&&c.init(1,0,0)}this.simplexSize=0,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var p=this.s[this.simplexSize],f=this.w1[this.simplexSize];p.x=f.x,p.y=f.y,p.z=f.z;var u=p,y=this.w2[this.simplexSize],X=u.x-y.x,g=u.y-y.y,z=u.z-y.z;u.x=X,u.y=g,u.z=z,this.simplexSize=1;for(var d=0,Y=1e-8;d<40;){var Z=0;switch(this.simplexSize){case 1:var M=_[0];l.x=M.x,l.y=M.y,l.z=M.z,Z=1;break;case 2:var I,V,L,w,k,B,A=_[0];I=A.x,V=A.y,L=A.z;var P,S,T,C=_[1],j=(P=(w=C.x)-I)*I+(S=(k=C.y)-V)*V+(T=(B=C.z)-L)*L;if((j=-j/(P*P+S*S+T*T))<0){var R=l;R.x=I,R.y=V,R.z=L,Z=1}else if(j>1){var q=l;q.x=w,q.y=k,q.z=B,Z=2}else{var E,D,F;E=I+P*j,D=V+S*j,F=L+T*j;var N=l;N.x=E,N.y=D,N.z=F,Z=3}break;case 3:var W,G,J,O,H,U,Q,K,$,tt,it,at,st,ot,nt,rt,_t,et,ht=_[0],lt=_[1],ct=_[2],mt=ht;W=mt.x,G=mt.y,J=mt.z;var vt=lt;O=vt.x,H=vt.y,U=vt.z;var bt,xt,pt,ft=ct;Q=ft.x;var ut,yt,Xt,gt=O*((ot=(K=ft.y)-H)*(pt=(tt=O-W)*ot-(it=H-G)*(st=Q-O))-(nt=($=ft.z)-U)*(xt=(at=U-J)*st-tt*nt))+H*(nt*(bt=it*nt-at*ot)-st*pt)+U*(st*xt-ot*bt),zt=Q*((_t=G-K)*pt-(et=J-$)*xt)+K*(et*bt-(rt=W-Q)*pt)+$*(rt*xt-_t*bt),dt=-1,Yt=0;if(ut=0,yt=0,Xt=0,W*(it*pt-at*xt)+G*(at*bt-tt*pt)+J*(tt*xt-it*bt)<0){var Zt,Mt,It,Vt,Lt,wt,kt=ht;Zt=kt.x,Mt=kt.y,It=kt.z;var Bt,At,Pt,St,Tt=lt,Ct=(Bt=(Vt=Tt.x)-Zt)*Zt+(At=(Lt=Tt.y)-Mt)*Mt+(Pt=(wt=Tt.z)-It)*It;if((Ct=-Ct/(Bt*Bt+At*At+Pt*Pt))<0){var jt=l;jt.x=Zt,jt.y=Mt,jt.z=It,St=1}else if(Ct>1){var Rt=l;Rt.x=Vt,Rt.y=Lt,Rt.z=wt,St=2}else{var qt,Et,Dt;qt=Zt+Bt*Ct,Et=Mt+At*Ct,Dt=It+Pt*Ct;var Ft=l;Ft.x=qt,Ft.y=Et,Ft.z=Dt,St=3}Yt=St,dt=l.x*l.x+l.y*l.y+l.z*l.z;var Nt=l;ut=Nt.x,yt=Nt.y,Xt=Nt.z}if(gt<0){var Wt,Gt,Jt,Ot,Ht,Ut,Qt=lt;Wt=Qt.x,Gt=Qt.y,Jt=Qt.z;var Kt,$t,ti,ii,ai=ct,si=(Kt=(Ot=ai.x)-Wt)*Wt+($t=(Ht=ai.y)-Gt)*Gt+(ti=(Ut=ai.z)-Jt)*Jt;if((si=-si/(Kt*Kt+$t*$t+ti*ti))<0){var oi=l;oi.x=Wt,oi.y=Gt,oi.z=Jt,ii=1}else if(si>1){var ni=l;ni.x=Ot,ni.y=Ht,ni.z=Ut,ii=2}else{var ri,_i,ei;ri=Wt+Kt*si,_i=Gt+$t*si,ei=Jt+ti*si;var hi=l;hi.x=ri,hi.y=_i,hi.z=ei,ii=3}var li=l.x*l.x+l.y*l.y+l.z*l.z;if(dt<0||li<dt){Yt=ii<<1,dt=li;var ci=l;ut=ci.x,yt=ci.y,Xt=ci.z}}if(zt<0){var mi,vi,bi,xi,pi,fi,ui=ht;mi=ui.x,vi=ui.y,bi=ui.z;var yi,Xi,gi,zi,di=ct,Yi=(yi=(xi=di.x)-mi)*mi+(Xi=(pi=di.y)-vi)*vi+(gi=(fi=di.z)-bi)*bi;if((Yi=-Yi/(yi*yi+Xi*Xi+gi*gi))<0){var Zi=l;Zi.x=mi,Zi.y=vi,Zi.z=bi,zi=1}else if(Yi>1){var Mi=l;Mi.x=xi,Mi.y=pi,Mi.z=fi,zi=2}else{var Ii,Vi,Li;Ii=mi+yi*Yi,Vi=vi+Xi*Yi,Li=bi+gi*Yi;var wi=l;wi.x=Ii,wi.y=Vi,wi.z=Li,zi=3}var ki=l.x*l.x+l.y*l.y+l.z*l.z;if(dt<0||ki<dt){Yt=1&zi|(2&zi)<<1,dt=ki;var Bi=l;ut=Bi.x,yt=Bi.y,Xt=Bi.z}}if(dt>0){var Ai=l;Ai.x=ut,Ai.y=yt,Ai.z=Xt,Z=Yt}else{var Pi=bt*bt+xt*xt+pt*pt;Pi>0&&(Pi=1/Math.sqrt(Pi));var Si=(bt*=Pi)*bt+(xt*=Pi)*xt+(pt*=Pi)*pt;ut=bt*(Si=(W*bt+G*xt+J*pt)/Si),yt=xt*Si,Xt=pt*Si;var Ti=l;Ti.x=ut,Ti.y=yt,Ti.z=Xt,Z=7}break;case 4:var Ci,ji,Ri,qi,Ei,Di,Fi,Ni,Wi,Gi,Ji,Oi,Hi,Ui,Qi,Ki,$i,ta,ia,aa,sa,oa,na,ra,_a,ea,ha,la=_[0],ca=_[1],ma=_[2],va=_[3],ba=la;Ci=ba.x,ji=ba.y,Ri=ba.z;var xa=ca;qi=xa.x,Ei=xa.y,Di=xa.z;var pa=ma;Fi=pa.x,Ni=pa.y,Wi=pa.z;var fa,ua,ya,Xa=va;Gi=Xa.x;var ga,za,da,Ya=(Hi=qi-Ci)*(fa=(ea=(Ji=Xa.y)-Ei)*(ra=Wi-Di)-(ha=(Oi=Xa.z)-Di)*(na=Ni-Ei))+(Ui=Ei-ji)*(ua=ha*(oa=Fi-qi)-(_a=Gi-qi)*ra)+(Qi=Di-Ri)*(ya=_a*na-ea*oa)>0?1:-1,Za=Ci*(($i=Ni-ji)*(sa=Oi-Ri)-(ta=Wi-Ri)*(aa=Ji-ji))+ji*(ta*(ia=Gi-Ci)-(Ki=Fi-Ci)*sa)+Ri*(Ki*aa-$i*ia),Ma=Ci*(aa*Qi-sa*Ui)+ji*(sa*Hi-ia*Qi)+Ri*(ia*Ui-aa*Hi),Ia=qi*fa+Ei*ua+Di*ya,Va=-1,La=0;if(ga=0,za=0,da=0,(Ci*(Ui*ta-Qi*$i)+ji*(Qi*Ki-Hi*ta)+Ri*(Hi*$i-Ui*Ki))*Ya<0){var wa,ka,Ba,Aa,Pa,Sa,Ta,Ca,ja,Ra,qa,Ea,Da,Fa,Na,Wa,Ga,Ja,Oa=la;wa=Oa.x,ka=Oa.y,Ba=Oa.z;var Ha=ca;Aa=Ha.x,Pa=Ha.y,Sa=Ha.z;var Ua,Qa,Ka,$a=ma;Ta=$a.x;var ts,is,as,ss,os=Aa*((Fa=(Ca=$a.y)-Pa)*(Ka=(Ra=Aa-wa)*Fa-(qa=Pa-ka)*(Da=Ta-Aa))-(Na=(ja=$a.z)-Sa)*(Qa=(Ea=Sa-Ba)*Da-Ra*Na))+Pa*(Na*(Ua=qa*Na-Ea*Fa)-Da*Ka)+Sa*(Da*Qa-Fa*Ua),ns=Ta*((Ga=ka-Ca)*Ka-(Ja=Ba-ja)*Qa)+Ca*(Ja*Ua-(Wa=wa-Ta)*Ka)+ja*(Wa*Qa-Ga*Ua),rs=-1,_s=0;if(ts=0,is=0,as=0,wa*(qa*Ka-Ea*Qa)+ka*(Ea*Ua-Ra*Ka)+Ba*(Ra*Qa-qa*Ua)<0){var es,hs,ls,cs,ms,vs,bs=la;es=bs.x,hs=bs.y,ls=bs.z;var xs,ps,fs,us,ys=ca,Xs=(xs=(cs=ys.x)-es)*es+(ps=(ms=ys.y)-hs)*hs+(fs=(vs=ys.z)-ls)*ls;if((Xs=-Xs/(xs*xs+ps*ps+fs*fs))<0){var gs=l;gs.x=es,gs.y=hs,gs.z=ls,us=1}else if(Xs>1){var zs=l;zs.x=cs,zs.y=ms,zs.z=vs,us=2}else{var ds,Ys,Zs;ds=es+xs*Xs,Ys=hs+ps*Xs,Zs=ls+fs*Xs;var Ms=l;Ms.x=ds,Ms.y=Ys,Ms.z=Zs,us=3}_s=us,rs=l.x*l.x+l.y*l.y+l.z*l.z;var Is=l;ts=Is.x,is=Is.y,as=Is.z}if(os<0){var Vs,Ls,ws,ks,Bs,As,Ps=ca;Vs=Ps.x,Ls=Ps.y,ws=Ps.z;var Ss,Ts,Cs,js,Rs=ma,qs=(Ss=(ks=Rs.x)-Vs)*Vs+(Ts=(Bs=Rs.y)-Ls)*Ls+(Cs=(As=Rs.z)-ws)*ws;if((qs=-qs/(Ss*Ss+Ts*Ts+Cs*Cs))<0){var Es=l;Es.x=Vs,Es.y=Ls,Es.z=ws,js=1}else if(qs>1){var Ds=l;Ds.x=ks,Ds.y=Bs,Ds.z=As,js=2}else{var Fs,Ns,Ws;Fs=Vs+Ss*qs,Ns=Ls+Ts*qs,Ws=ws+Cs*qs;var Gs=l;Gs.x=Fs,Gs.y=Ns,Gs.z=Ws,js=3}var Js=l.x*l.x+l.y*l.y+l.z*l.z;if(rs<0||Js<rs){_s=js<<1,rs=Js;var Os=l;ts=Os.x,is=Os.y,as=Os.z}}if(ns<0){var Hs,Us,Qs,Ks,$s,to,io=la;Hs=io.x,Us=io.y,Qs=io.z;var ao,so,oo,no,ro=ma,_o=(ao=(Ks=ro.x)-Hs)*Hs+(so=($s=ro.y)-Us)*Us+(oo=(to=ro.z)-Qs)*Qs;if((_o=-_o/(ao*ao+so*so+oo*oo))<0){var eo=l;eo.x=Hs,eo.y=Us,eo.z=Qs,no=1}else if(_o>1){var ho=l;ho.x=Ks,ho.y=$s,ho.z=to,no=2}else{var lo,co,mo;lo=Hs+ao*_o,co=Us+so*_o,mo=Qs+oo*_o;var vo=l;vo.x=lo,vo.y=co,vo.z=mo,no=3}var bo=l.x*l.x+l.y*l.y+l.z*l.z;if(rs<0||bo<rs){_s=1&no|(2&no)<<1,rs=bo;var xo=l;ts=xo.x,is=xo.y,as=xo.z}}if(rs>0){var po=l;po.x=ts,po.y=is,po.z=as,ss=_s}else{var fo=Ua*Ua+Qa*Qa+Ka*Ka;fo>0&&(fo=1/Math.sqrt(fo));var uo=(Ua*=fo)*Ua+(Qa*=fo)*Qa+(Ka*=fo)*Ka;ts=Ua*(uo=(wa*Ua+ka*Qa+Ba*Ka)/uo),is=Qa*uo,as=Ka*uo;var yo=l;yo.x=ts,yo.y=is,yo.z=as,ss=7}La=ss,Va=l.x*l.x+l.y*l.y+l.z*l.z;var Xo=l;ga=Xo.x,za=Xo.y,da=Xo.z}if(Za*Ya<0){var go,zo,Yo,Zo,Mo,Io,Vo,Lo,wo,ko,Bo,Ao,Po,So,To,Co,jo,Ro,qo=la;go=qo.x,zo=qo.y,Yo=qo.z;var Eo=ma;Zo=Eo.x,Mo=Eo.y,Io=Eo.z;var Do,Fo,No,Wo=va;Vo=Wo.x;var Go,Jo,Oo,Ho,Uo=Zo*((So=(Lo=Wo.y)-Mo)*(No=(ko=Zo-go)*So-(Bo=Mo-zo)*(Po=Vo-Zo))-(To=(wo=Wo.z)-Io)*(Fo=(Ao=Io-Yo)*Po-ko*To))+Mo*(To*(Do=Bo*To-Ao*So)-Po*No)+Io*(Po*Fo-So*Do),Qo=Vo*((jo=zo-Lo)*No-(Ro=Yo-wo)*Fo)+Lo*(Ro*Do-(Co=go-Vo)*No)+wo*(Co*Fo-jo*Do),Ko=-1,$o=0;if(Go=0,Jo=0,Oo=0,go*(Bo*No-Ao*Fo)+zo*(Ao*Do-ko*No)+Yo*(ko*Fo-Bo*Do)<0){var tn,an,sn,on,nn,rn,_n=la;tn=_n.x,an=_n.y,sn=_n.z;var en,hn,ln,cn,mn=ma,vn=(en=(on=mn.x)-tn)*tn+(hn=(nn=mn.y)-an)*an+(ln=(rn=mn.z)-sn)*sn;if((vn=-vn/(en*en+hn*hn+ln*ln))<0){var bn=l;bn.x=tn,bn.y=an,bn.z=sn,cn=1}else if(vn>1){var xn=l;xn.x=on,xn.y=nn,xn.z=rn,cn=2}else{var pn,fn,un;pn=tn+en*vn,fn=an+hn*vn,un=sn+ln*vn;var yn=l;yn.x=pn,yn.y=fn,yn.z=un,cn=3}$o=cn,Ko=l.x*l.x+l.y*l.y+l.z*l.z;var Xn=l;Go=Xn.x,Jo=Xn.y,Oo=Xn.z}if(Uo<0){var gn,zn,dn,Yn,Zn,Mn,In=ma;gn=In.x,zn=In.y,dn=In.z;var Vn,Ln,wn,kn,Bn=va,An=(Vn=(Yn=Bn.x)-gn)*gn+(Ln=(Zn=Bn.y)-zn)*zn+(wn=(Mn=Bn.z)-dn)*dn;if((An=-An/(Vn*Vn+Ln*Ln+wn*wn))<0){var Pn=l;Pn.x=gn,Pn.y=zn,Pn.z=dn,kn=1}else if(An>1){var Sn=l;Sn.x=Yn,Sn.y=Zn,Sn.z=Mn,kn=2}else{var Tn,Cn,jn;Tn=gn+Vn*An,Cn=zn+Ln*An,jn=dn+wn*An;var Rn=l;Rn.x=Tn,Rn.y=Cn,Rn.z=jn,kn=3}var qn=l.x*l.x+l.y*l.y+l.z*l.z;if(Ko<0||qn<Ko){$o=kn<<1,Ko=qn;var En=l;Go=En.x,Jo=En.y,Oo=En.z}}if(Qo<0){var Dn,Fn,Nn,Wn,Gn,Jn,On=la;Dn=On.x,Fn=On.y,Nn=On.z;var Hn,Un,Qn,Kn,$n=va,tr=(Hn=(Wn=$n.x)-Dn)*Dn+(Un=(Gn=$n.y)-Fn)*Fn+(Qn=(Jn=$n.z)-Nn)*Nn;if((tr=-tr/(Hn*Hn+Un*Un+Qn*Qn))<0){var ir=l;ir.x=Dn,ir.y=Fn,ir.z=Nn,Kn=1}else if(tr>1){var ar=l;ar.x=Wn,ar.y=Gn,ar.z=Jn,Kn=2}else{var sr,or,nr;sr=Dn+Hn*tr,or=Fn+Un*tr,nr=Nn+Qn*tr;var rr=l;rr.x=sr,rr.y=or,rr.z=nr,Kn=3}var _r=l.x*l.x+l.y*l.y+l.z*l.z;if(Ko<0||_r<Ko){$o=1&Kn|(2&Kn)<<1,Ko=_r;var er=l;Go=er.x,Jo=er.y,Oo=er.z}}if(Ko>0){var hr=l;hr.x=Go,hr.y=Jo,hr.z=Oo,Ho=$o}else{var lr=Do*Do+Fo*Fo+No*No;lr>0&&(lr=1/Math.sqrt(lr));var cr=(Do*=lr)*Do+(Fo*=lr)*Fo+(No*=lr)*No;Go=Do*(cr=(go*Do+zo*Fo+Yo*No)/cr),Jo=Fo*cr,Oo=No*cr;var mr=l;mr.x=Go,mr.y=Jo,mr.z=Oo,Ho=7}var vr=l.x*l.x+l.y*l.y+l.z*l.z;if(Va<0||vr<Va){La=1&Ho|(6&Ho)<<1,Va=vr;var br=l;ga=br.x,za=br.y,da=br.z}}if(Ma*Ya<0){var xr,pr,fr,ur,yr,Xr,gr,zr,dr,Yr,Zr,Mr,Ir,Vr,Lr,wr,kr,Br,Ar=la;xr=Ar.x,pr=Ar.y,fr=Ar.z;var Pr=ca;ur=Pr.x,yr=Pr.y,Xr=Pr.z;var Sr,Tr,Cr,jr=va;gr=jr.x;var Rr,qr,Er,Dr,Fr=ur*((Vr=(zr=jr.y)-yr)*(Cr=(Yr=ur-xr)*Vr-(Zr=yr-pr)*(Ir=gr-ur))-(Lr=(dr=jr.z)-Xr)*(Tr=(Mr=Xr-fr)*Ir-Yr*Lr))+yr*(Lr*(Sr=Zr*Lr-Mr*Vr)-Ir*Cr)+Xr*(Ir*Tr-Vr*Sr),Nr=gr*((kr=pr-zr)*Cr-(Br=fr-dr)*Tr)+zr*(Br*Sr-(wr=xr-gr)*Cr)+dr*(wr*Tr-kr*Sr),Wr=-1,Gr=0;if(Rr=0,qr=0,Er=0,xr*(Zr*Cr-Mr*Tr)+pr*(Mr*Sr-Yr*Cr)+fr*(Yr*Tr-Zr*Sr)<0){var Jr,Or,Hr,Ur,Qr,Kr,$r=la;Jr=$r.x,Or=$r.y,Hr=$r.z;var t_,i_,a_,s_,o_=ca,n_=(t_=(Ur=o_.x)-Jr)*Jr+(i_=(Qr=o_.y)-Or)*Or+(a_=(Kr=o_.z)-Hr)*Hr;if((n_=-n_/(t_*t_+i_*i_+a_*a_))<0){var r_=l;r_.x=Jr,r_.y=Or,r_.z=Hr,s_=1}else if(n_>1){var __=l;__.x=Ur,__.y=Qr,__.z=Kr,s_=2}else{var e_,h_,l_;e_=Jr+t_*n_,h_=Or+i_*n_,l_=Hr+a_*n_;var c_=l;c_.x=e_,c_.y=h_,c_.z=l_,s_=3}Gr=s_,Wr=l.x*l.x+l.y*l.y+l.z*l.z;var m_=l;Rr=m_.x,qr=m_.y,Er=m_.z}if(Fr<0){var v_,b_,x_,p_,f_,u_,y_=ca;v_=y_.x,b_=y_.y,x_=y_.z;var X_,g_,z_,d_,Y_=va,Z_=(X_=(p_=Y_.x)-v_)*v_+(g_=(f_=Y_.y)-b_)*b_+(z_=(u_=Y_.z)-x_)*x_;if((Z_=-Z_/(X_*X_+g_*g_+z_*z_))<0){var M_=l;M_.x=v_,M_.y=b_,M_.z=x_,d_=1}else if(Z_>1){var I_=l;I_.x=p_,I_.y=f_,I_.z=u_,d_=2}else{var V_,L_,w_;V_=v_+X_*Z_,L_=b_+g_*Z_,w_=x_+z_*Z_;var k_=l;k_.x=V_,k_.y=L_,k_.z=w_,d_=3}var B_=l.x*l.x+l.y*l.y+l.z*l.z;if(Wr<0||B_<Wr){Gr=d_<<1,Wr=B_;var A_=l;Rr=A_.x,qr=A_.y,Er=A_.z}}if(Nr<0){var P_,S_,T_,C_,j_,R_,q_=la;P_=q_.x,S_=q_.y,T_=q_.z;var E_,D_,F_,N_,W_=va,G_=(E_=(C_=W_.x)-P_)*P_+(D_=(j_=W_.y)-S_)*S_+(F_=(R_=W_.z)-T_)*T_;if((G_=-G_/(E_*E_+D_*D_+F_*F_))<0){var J_=l;J_.x=P_,J_.y=S_,J_.z=T_,N_=1}else if(G_>1){var O_=l;O_.x=C_,O_.y=j_,O_.z=R_,N_=2}else{var H_,U_,Q_;H_=P_+E_*G_,U_=S_+D_*G_,Q_=T_+F_*G_;var K_=l;K_.x=H_,K_.y=U_,K_.z=Q_,N_=3}var $_=l.x*l.x+l.y*l.y+l.z*l.z;if(Wr<0||$_<Wr){Gr=1&N_|(2&N_)<<1,Wr=$_;var te=l;Rr=te.x,qr=te.y,Er=te.z}}if(Wr>0){var ie=l;ie.x=Rr,ie.y=qr,ie.z=Er,Dr=Gr}else{var ae=Sr*Sr+Tr*Tr+Cr*Cr;ae>0&&(ae=1/Math.sqrt(ae));var se=(Sr*=ae)*Sr+(Tr*=ae)*Tr+(Cr*=ae)*Cr;Rr=Sr*(se=(xr*Sr+pr*Tr+fr*Cr)/se),qr=Tr*se,Er=Cr*se;var oe=l;oe.x=Rr,oe.y=qr,oe.z=Er,Dr=7}var ne=l.x*l.x+l.y*l.y+l.z*l.z;if(Va<0||ne<Va){La=3&Dr|(4&Dr)<<1,Va=ne;var re=l;ga=re.x,za=re.y,da=re.z}}if(Ia*Ya<0){var _e,ee,he,le,ce,me,ve,be,xe,pe,fe,ue,ye,Xe,ge,ze,de,Ye,Ze=ca;_e=Ze.x,ee=Ze.y,he=Ze.z;var Me=ma;le=Me.x,ce=Me.y,me=Me.z;var Ie,Ve,Le,we=va;ve=we.x;var ke,Be,Ae,Pe,Se=le*((Xe=(be=we.y)-ce)*(Le=(pe=le-_e)*Xe-(fe=ce-ee)*(ye=ve-le))-(ge=(xe=we.z)-me)*(Ve=(ue=me-he)*ye-pe*ge))+ce*(ge*(Ie=fe*ge-ue*Xe)-ye*Le)+me*(ye*Ve-Xe*Ie),Te=ve*((de=ee-be)*Le-(Ye=he-xe)*Ve)+be*(Ye*Ie-(ze=_e-ve)*Le)+xe*(ze*Ve-de*Ie),Ce=-1,je=0;if(ke=0,Be=0,Ae=0,_e*(fe*Le-ue*Ve)+ee*(ue*Ie-pe*Le)+he*(pe*Ve-fe*Ie)<0){var Re,qe,Ee,De,Fe,Ne,We=ca;Re=We.x,qe=We.y,Ee=We.z;var Ge,Je,Oe,He,Ue=ma,Qe=(Ge=(De=Ue.x)-Re)*Re+(Je=(Fe=Ue.y)-qe)*qe+(Oe=(Ne=Ue.z)-Ee)*Ee;if((Qe=-Qe/(Ge*Ge+Je*Je+Oe*Oe))<0){var Ke=l;Ke.x=Re,Ke.y=qe,Ke.z=Ee,He=1}else if(Qe>1){var $e=l;$e.x=De,$e.y=Fe,$e.z=Ne,He=2}else{var th,ih,ah;th=Re+Ge*Qe,ih=qe+Je*Qe,ah=Ee+Oe*Qe;var sh=l;sh.x=th,sh.y=ih,sh.z=ah,He=3}je=He,Ce=l.x*l.x+l.y*l.y+l.z*l.z;var oh=l;ke=oh.x,Be=oh.y,Ae=oh.z}if(Se<0){var nh,rh,_h,eh,hh,lh,ch=ma;nh=ch.x,rh=ch.y,_h=ch.z;var mh,vh,bh,xh,ph=va,fh=(mh=(eh=ph.x)-nh)*nh+(vh=(hh=ph.y)-rh)*rh+(bh=(lh=ph.z)-_h)*_h;if((fh=-fh/(mh*mh+vh*vh+bh*bh))<0){var uh=l;uh.x=nh,uh.y=rh,uh.z=_h,xh=1}else if(fh>1){var yh=l;yh.x=eh,yh.y=hh,yh.z=lh,xh=2}else{var Xh,gh,zh;Xh=nh+mh*fh,gh=rh+vh*fh,zh=_h+bh*fh;var dh=l;dh.x=Xh,dh.y=gh,dh.z=zh,xh=3}var Yh=l.x*l.x+l.y*l.y+l.z*l.z;if(Ce<0||Yh<Ce){je=xh<<1,Ce=Yh;var Zh=l;ke=Zh.x,Be=Zh.y,Ae=Zh.z}}if(Te<0){var Mh,Ih,Vh,Lh,wh,kh,Bh=ca;Mh=Bh.x,Ih=Bh.y,Vh=Bh.z;var Ah,Ph,Sh,Th,Ch=va,jh=(Ah=(Lh=Ch.x)-Mh)*Mh+(Ph=(wh=Ch.y)-Ih)*Ih+(Sh=(kh=Ch.z)-Vh)*Vh;if((jh=-jh/(Ah*Ah+Ph*Ph+Sh*Sh))<0){var Rh=l;Rh.x=Mh,Rh.y=Ih,Rh.z=Vh,Th=1}else if(jh>1){var qh=l;qh.x=Lh,qh.y=wh,qh.z=kh,Th=2}else{var Eh,Dh,Fh;Eh=Mh+Ah*jh,Dh=Ih+Ph*jh,Fh=Vh+Sh*jh;var Nh=l;Nh.x=Eh,Nh.y=Dh,Nh.z=Fh,Th=3}var Wh=l.x*l.x+l.y*l.y+l.z*l.z;if(Ce<0||Wh<Ce){je=1&Th|(2&Th)<<1,Ce=Wh;var Gh=l;ke=Gh.x,Be=Gh.y,Ae=Gh.z}}if(Ce>0){var Jh=l;Jh.x=ke,Jh.y=Be,Jh.z=Ae,Pe=je}else{var Oh=Ie*Ie+Ve*Ve+Le*Le;Oh>0&&(Oh=1/Math.sqrt(Oh));var Hh=(Ie*=Oh)*Ie+(Ve*=Oh)*Ve+(Le*=Oh)*Le;ke=Ie*(Hh=(_e*Ie+ee*Ve+he*Le)/Hh),Be=Ve*Hh,Ae=Le*Hh;var Uh=l;Uh.x=ke,Uh.y=Be,Uh.z=Ae,Pe=7}var Qh=l.x*l.x+l.y*l.y+l.z*l.z;if(Va<0||Qh<Va){La=Pe<<1,Va=Qh;var Kh=l;ga=Kh.x,za=Kh.y,da=Kh.z}}if(Va>0){var $h=l;$h.x=ga,$h.y=za,$h.z=da,Z=La}else l.zero(),Z=15}if(l.x*l.x+l.y*l.y+l.z*l.z<Y){if(!r)return this.distance=0,0;switch(this.simplexSize){case 1:this.pointToTetrahedron();break;case 2:this.lineToTetrahedron();break;case 3:this.triangleToTetrahedron()}if(4==this.simplexSize){var tl=this.computeDepth(i,a,s,o,_,e,h);return 0!=tl?(this.distance=0,tl):(this.distance=-this.depth,0)}return this.distance=0,1}this.shrinkSimplex(Z),c.x=l.x,c.y=l.y,c.z=l.z;var il=c,al=-il.x,sl=-il.y,ol=-il.z;il.x=al,il.y=sl,il.z=ol,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var nl=this.s[this.simplexSize],rl=this.w1[this.simplexSize];nl.x=rl.x,nl.y=rl.y,nl.z=rl.z;var _l=nl,el=this.w2[this.simplexSize],hl=_l.x-el.x,ll=_l.y-el.y,cl=_l.z-el.z;if(_l.x=hl,_l.y=ll,_l.z=cl,c.x*c.x+c.y*c.y+c.z*c.z<Y)throw new Error("!?");var ml=l.x*c.x+l.y*c.y+l.z*c.z,vl=_[this.simplexSize];if(vl.x*c.x+vl.y*c.y+vl.z*c.z-ml<Y)return this.interpolateClosestPoints(),this.distance=Math.sqrt(l.x*l.x+l.y*l.y+l.z*l.z),null!=n&&null!=n._gjkCache&&this.saveCache(n._gjkCache),0;this.simplexSize++,++d}return 2}convexCastImpl(t,i,a,s,o,n,r){this.c1=t,this.c2=i,this.tf1=a,this.tf2=s;var _=this.s;this.w1,this.w2;var e,h,l,c=this.closest,m=this.dir;e=s._positionX-a._positionX,h=s._positionY-a._positionY,l=s._positionZ-a._positionZ;var v=m;if(v.x=e,v.y=h,v.z=l,m.x*m.x+m.y*m.y+m.z*m.z<1e-6&&m.init(1,0,0),this.simplexSize=0,null!=this.c1)this.computeWitnessPoint1(!0);else{var b=this.w1[this.simplexSize];b.x=this.tf1._positionX,b.y=this.tf1._positionY,b.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);var x=this.s[this.simplexSize],p=this.w1[this.simplexSize];x.x=p.x,x.y=p.y,x.z=p.z;var f=x,u=this.w2[this.simplexSize],y=f.x-u.x,X=f.y-u.y,g=f.z-u.z;f.x=y,f.y=X,f.z=g,this.simplexSize=1;var z=0,d=0,Y=this.rayX,Z=this.rayR;Y.zero(),Z.x=n.x,Z.y=n.y,Z.z=n.z;var M=Z,I=M.x-o.x,V=M.y-o.y,L=M.z-o.z;M.x=I,M.y=V,M.z=L;for(var w=1e-8;z<40;){var k=0;switch(this.simplexSize){case 1:var B=_[0];c.x=B.x,c.y=B.y,c.z=B.z,k=1;break;case 2:var A,P,S,T,C,j,R=_[0];A=R.x,P=R.y,S=R.z;var q,E,D,F=_[1],N=(q=(T=F.x)-A)*A+(E=(C=F.y)-P)*P+(D=(j=F.z)-S)*S;if((N=-N/(q*q+E*E+D*D))<0){var W=c;W.x=A,W.y=P,W.z=S,k=1}else if(N>1){var G=c;G.x=T,G.y=C,G.z=j,k=2}else{var J,O,H;J=A+q*N,O=P+E*N,H=S+D*N;var U=c;U.x=J,U.y=O,U.z=H,k=3}break;case 3:var Q,K,$,tt,it,at,st,ot,nt,rt,_t,et,ht,lt,ct,mt,vt,bt,xt=_[0],pt=_[1],ft=_[2],ut=xt;Q=ut.x,K=ut.y,$=ut.z;var yt=pt;tt=yt.x,it=yt.y,at=yt.z;var Xt,gt,zt,dt=ft;st=dt.x;var Yt,Zt,Mt,It=tt*((lt=(ot=dt.y)-it)*(zt=(rt=tt-Q)*lt-(_t=it-K)*(ht=st-tt))-(ct=(nt=dt.z)-at)*(gt=(et=at-$)*ht-rt*ct))+it*(ct*(Xt=_t*ct-et*lt)-ht*zt)+at*(ht*gt-lt*Xt),Vt=st*((vt=K-ot)*zt-(bt=$-nt)*gt)+ot*(bt*Xt-(mt=Q-st)*zt)+nt*(mt*gt-vt*Xt),Lt=-1,wt=0;if(Yt=0,Zt=0,Mt=0,Q*(_t*zt-et*gt)+K*(et*Xt-rt*zt)+$*(rt*gt-_t*Xt)<0){var kt,Bt,At,Pt,St,Tt,Ct=xt;kt=Ct.x,Bt=Ct.y,At=Ct.z;var jt,Rt,qt,Et,Dt=pt,Ft=(jt=(Pt=Dt.x)-kt)*kt+(Rt=(St=Dt.y)-Bt)*Bt+(qt=(Tt=Dt.z)-At)*At;if((Ft=-Ft/(jt*jt+Rt*Rt+qt*qt))<0){var Nt=c;Nt.x=kt,Nt.y=Bt,Nt.z=At,Et=1}else if(Ft>1){var Wt=c;Wt.x=Pt,Wt.y=St,Wt.z=Tt,Et=2}else{var Gt,Jt,Ot;Gt=kt+jt*Ft,Jt=Bt+Rt*Ft,Ot=At+qt*Ft;var Ht=c;Ht.x=Gt,Ht.y=Jt,Ht.z=Ot,Et=3}wt=Et,Lt=c.x*c.x+c.y*c.y+c.z*c.z;var Ut=c;Yt=Ut.x,Zt=Ut.y,Mt=Ut.z}if(It<0){var Qt,Kt,$t,ti,ii,ai,si=pt;Qt=si.x,Kt=si.y,$t=si.z;var oi,ni,ri,_i,ei=ft,hi=(oi=(ti=ei.x)-Qt)*Qt+(ni=(ii=ei.y)-Kt)*Kt+(ri=(ai=ei.z)-$t)*$t;if((hi=-hi/(oi*oi+ni*ni+ri*ri))<0){var li=c;li.x=Qt,li.y=Kt,li.z=$t,_i=1}else if(hi>1){var ci=c;ci.x=ti,ci.y=ii,ci.z=ai,_i=2}else{var mi,vi,bi;mi=Qt+oi*hi,vi=Kt+ni*hi,bi=$t+ri*hi;var xi=c;xi.x=mi,xi.y=vi,xi.z=bi,_i=3}var pi=c.x*c.x+c.y*c.y+c.z*c.z;if(Lt<0||pi<Lt){wt=_i<<1,Lt=pi;var fi=c;Yt=fi.x,Zt=fi.y,Mt=fi.z}}if(Vt<0){var ui,yi,Xi,gi,zi,di,Yi=xt;ui=Yi.x,yi=Yi.y,Xi=Yi.z;var Zi,Mi,Ii,Vi,Li=ft,wi=(Zi=(gi=Li.x)-ui)*ui+(Mi=(zi=Li.y)-yi)*yi+(Ii=(di=Li.z)-Xi)*Xi;if((wi=-wi/(Zi*Zi+Mi*Mi+Ii*Ii))<0){var ki=c;ki.x=ui,ki.y=yi,ki.z=Xi,Vi=1}else if(wi>1){var Bi=c;Bi.x=gi,Bi.y=zi,Bi.z=di,Vi=2}else{var Ai,Pi,Si;Ai=ui+Zi*wi,Pi=yi+Mi*wi,Si=Xi+Ii*wi;var Ti=c;Ti.x=Ai,Ti.y=Pi,Ti.z=Si,Vi=3}var Ci=c.x*c.x+c.y*c.y+c.z*c.z;if(Lt<0||Ci<Lt){wt=1&Vi|(2&Vi)<<1,Lt=Ci;var ji=c;Yt=ji.x,Zt=ji.y,Mt=ji.z}}if(Lt>0){var Ri=c;Ri.x=Yt,Ri.y=Zt,Ri.z=Mt,k=wt}else{var qi=Xt*Xt+gt*gt+zt*zt;qi>0&&(qi=1/Math.sqrt(qi));var Ei=(Xt*=qi)*Xt+(gt*=qi)*gt+(zt*=qi)*zt;Yt=Xt*(Ei=(Q*Xt+K*gt+$*zt)/Ei),Zt=gt*Ei,Mt=zt*Ei;var Di=c;Di.x=Yt,Di.y=Zt,Di.z=Mt,k=7}break;case 4:var Fi,Ni,Wi,Gi,Ji,Oi,Hi,Ui,Qi,Ki,$i,ta,ia,aa,sa,oa,na,ra,_a,ea,ha,la,ca,ma,va,ba,xa,pa=_[0],fa=_[1],ua=_[2],ya=_[3],Xa=pa;Fi=Xa.x,Ni=Xa.y,Wi=Xa.z;var ga=fa;Gi=ga.x,Ji=ga.y,Oi=ga.z;var za=ua;Hi=za.x,Ui=za.y,Qi=za.z;var da,Ya,Za,Ma=ya;Ki=Ma.x;var Ia,Va,La,wa=(ia=Gi-Fi)*(da=(ba=($i=Ma.y)-Ji)*(ma=Qi-Oi)-(xa=(ta=Ma.z)-Oi)*(ca=Ui-Ji))+(aa=Ji-Ni)*(Ya=xa*(la=Hi-Gi)-(va=Ki-Gi)*ma)+(sa=Oi-Wi)*(Za=va*ca-ba*la)>0?1:-1,ka=Fi*((na=Ui-Ni)*(ha=ta-Wi)-(ra=Qi-Wi)*(ea=$i-Ni))+Ni*(ra*(_a=Ki-Fi)-(oa=Hi-Fi)*ha)+Wi*(oa*ea-na*_a),Ba=Fi*(ea*sa-ha*aa)+Ni*(ha*ia-_a*sa)+Wi*(_a*aa-ea*ia),Aa=Gi*da+Ji*Ya+Oi*Za,Pa=-1,Sa=0;if(Ia=0,Va=0,La=0,(Fi*(aa*ra-sa*na)+Ni*(sa*oa-ia*ra)+Wi*(ia*na-aa*oa))*wa<0){var Ta,Ca,ja,Ra,qa,Ea,Da,Fa,Na,Wa,Ga,Ja,Oa,Ha,Ua,Qa,Ka,$a,ts=pa;Ta=ts.x,Ca=ts.y,ja=ts.z;var is=fa;Ra=is.x,qa=is.y,Ea=is.z;var as,ss,os,ns=ua;Da=ns.x;var rs,_s,es,hs,ls=Ra*((Ha=(Fa=ns.y)-qa)*(os=(Wa=Ra-Ta)*Ha-(Ga=qa-Ca)*(Oa=Da-Ra))-(Ua=(Na=ns.z)-Ea)*(ss=(Ja=Ea-ja)*Oa-Wa*Ua))+qa*(Ua*(as=Ga*Ua-Ja*Ha)-Oa*os)+Ea*(Oa*ss-Ha*as),cs=Da*((Ka=Ca-Fa)*os-($a=ja-Na)*ss)+Fa*($a*as-(Qa=Ta-Da)*os)+Na*(Qa*ss-Ka*as),ms=-1,vs=0;if(rs=0,_s=0,es=0,Ta*(Ga*os-Ja*ss)+Ca*(Ja*as-Wa*os)+ja*(Wa*ss-Ga*as)<0){var bs,xs,ps,fs,us,ys,Xs=pa;bs=Xs.x,xs=Xs.y,ps=Xs.z;var gs,zs,ds,Ys,Zs=fa,Ms=(gs=(fs=Zs.x)-bs)*bs+(zs=(us=Zs.y)-xs)*xs+(ds=(ys=Zs.z)-ps)*ps;if((Ms=-Ms/(gs*gs+zs*zs+ds*ds))<0){var Is=c;Is.x=bs,Is.y=xs,Is.z=ps,Ys=1}else if(Ms>1){var Vs=c;Vs.x=fs,Vs.y=us,Vs.z=ys,Ys=2}else{var Ls,ws,ks;Ls=bs+gs*Ms,ws=xs+zs*Ms,ks=ps+ds*Ms;var Bs=c;Bs.x=Ls,Bs.y=ws,Bs.z=ks,Ys=3}vs=Ys,ms=c.x*c.x+c.y*c.y+c.z*c.z;var As=c;rs=As.x,_s=As.y,es=As.z}if(ls<0){var Ps,Ss,Ts,Cs,js,Rs,qs=fa;Ps=qs.x,Ss=qs.y,Ts=qs.z;var Es,Ds,Fs,Ns,Ws=ua,Gs=(Es=(Cs=Ws.x)-Ps)*Ps+(Ds=(js=Ws.y)-Ss)*Ss+(Fs=(Rs=Ws.z)-Ts)*Ts;if((Gs=-Gs/(Es*Es+Ds*Ds+Fs*Fs))<0){var Js=c;Js.x=Ps,Js.y=Ss,Js.z=Ts,Ns=1}else if(Gs>1){var Os=c;Os.x=Cs,Os.y=js,Os.z=Rs,Ns=2}else{var Hs,Us,Qs;Hs=Ps+Es*Gs,Us=Ss+Ds*Gs,Qs=Ts+Fs*Gs;var Ks=c;Ks.x=Hs,Ks.y=Us,Ks.z=Qs,Ns=3}var $s=c.x*c.x+c.y*c.y+c.z*c.z;if(ms<0||$s<ms){vs=Ns<<1,ms=$s;var to=c;rs=to.x,_s=to.y,es=to.z}}if(cs<0){var io,ao,so,oo,no,ro,_o=pa;io=_o.x,ao=_o.y,so=_o.z;var eo,ho,lo,co,mo=ua,vo=(eo=(oo=mo.x)-io)*io+(ho=(no=mo.y)-ao)*ao+(lo=(ro=mo.z)-so)*so;if((vo=-vo/(eo*eo+ho*ho+lo*lo))<0){var bo=c;bo.x=io,bo.y=ao,bo.z=so,co=1}else if(vo>1){var xo=c;xo.x=oo,xo.y=no,xo.z=ro,co=2}else{var po,fo,uo;po=io+eo*vo,fo=ao+ho*vo,uo=so+lo*vo;var yo=c;yo.x=po,yo.y=fo,yo.z=uo,co=3}var Xo=c.x*c.x+c.y*c.y+c.z*c.z;if(ms<0||Xo<ms){vs=1&co|(2&co)<<1,ms=Xo;var go=c;rs=go.x,_s=go.y,es=go.z}}if(ms>0){var zo=c;zo.x=rs,zo.y=_s,zo.z=es,hs=vs}else{var Yo=as*as+ss*ss+os*os;Yo>0&&(Yo=1/Math.sqrt(Yo));var Zo=(as*=Yo)*as+(ss*=Yo)*ss+(os*=Yo)*os;rs=as*(Zo=(Ta*as+Ca*ss+ja*os)/Zo),_s=ss*Zo,es=os*Zo;var Mo=c;Mo.x=rs,Mo.y=_s,Mo.z=es,hs=7}Sa=hs,Pa=c.x*c.x+c.y*c.y+c.z*c.z;var Io=c;Ia=Io.x,Va=Io.y,La=Io.z}if(ka*wa<0){var Vo,Lo,wo,ko,Bo,Ao,Po,So,To,Co,jo,Ro,qo,Eo,Do,Fo,No,Wo,Go=pa;Vo=Go.x,Lo=Go.y,wo=Go.z;var Jo=ua;ko=Jo.x,Bo=Jo.y,Ao=Jo.z;var Oo,Ho,Uo,Qo=ya;Po=Qo.x;var Ko,$o,tn,an,sn=ko*((Eo=(So=Qo.y)-Bo)*(Uo=(Co=ko-Vo)*Eo-(jo=Bo-Lo)*(qo=Po-ko))-(Do=(To=Qo.z)-Ao)*(Ho=(Ro=Ao-wo)*qo-Co*Do))+Bo*(Do*(Oo=jo*Do-Ro*Eo)-qo*Uo)+Ao*(qo*Ho-Eo*Oo),on=Po*((No=Lo-So)*Uo-(Wo=wo-To)*Ho)+So*(Wo*Oo-(Fo=Vo-Po)*Uo)+To*(Fo*Ho-No*Oo),nn=-1,rn=0;if(Ko=0,$o=0,tn=0,Vo*(jo*Uo-Ro*Ho)+Lo*(Ro*Oo-Co*Uo)+wo*(Co*Ho-jo*Oo)<0){var _n,en,hn,ln,cn,mn,vn=pa;_n=vn.x,en=vn.y,hn=vn.z;var bn,xn,pn,fn,un=ua,yn=(bn=(ln=un.x)-_n)*_n+(xn=(cn=un.y)-en)*en+(pn=(mn=un.z)-hn)*hn;if((yn=-yn/(bn*bn+xn*xn+pn*pn))<0){var Xn=c;Xn.x=_n,Xn.y=en,Xn.z=hn,fn=1}else if(yn>1){var gn=c;gn.x=ln,gn.y=cn,gn.z=mn,fn=2}else{var zn,dn,Yn;zn=_n+bn*yn,dn=en+xn*yn,Yn=hn+pn*yn;var Zn=c;Zn.x=zn,Zn.y=dn,Zn.z=Yn,fn=3}rn=fn,nn=c.x*c.x+c.y*c.y+c.z*c.z;var Mn=c;Ko=Mn.x,$o=Mn.y,tn=Mn.z}if(sn<0){var In,Vn,Ln,wn,kn,Bn,An=ua;In=An.x,Vn=An.y,Ln=An.z;var Pn,Sn,Tn,Cn,jn=ya,Rn=(Pn=(wn=jn.x)-In)*In+(Sn=(kn=jn.y)-Vn)*Vn+(Tn=(Bn=jn.z)-Ln)*Ln;if((Rn=-Rn/(Pn*Pn+Sn*Sn+Tn*Tn))<0){var qn=c;qn.x=In,qn.y=Vn,qn.z=Ln,Cn=1}else if(Rn>1){var En=c;En.x=wn,En.y=kn,En.z=Bn,Cn=2}else{var Dn,Fn,Nn;Dn=In+Pn*Rn,Fn=Vn+Sn*Rn,Nn=Ln+Tn*Rn;var Wn=c;Wn.x=Dn,Wn.y=Fn,Wn.z=Nn,Cn=3}var Gn=c.x*c.x+c.y*c.y+c.z*c.z;if(nn<0||Gn<nn){rn=Cn<<1,nn=Gn;var Jn=c;Ko=Jn.x,$o=Jn.y,tn=Jn.z}}if(on<0){var On,Hn,Un,Qn,Kn,$n,tr=pa;On=tr.x,Hn=tr.y,Un=tr.z;var ir,ar,sr,or,nr=ya,rr=(ir=(Qn=nr.x)-On)*On+(ar=(Kn=nr.y)-Hn)*Hn+(sr=($n=nr.z)-Un)*Un;if((rr=-rr/(ir*ir+ar*ar+sr*sr))<0){var _r=c;_r.x=On,_r.y=Hn,_r.z=Un,or=1}else if(rr>1){var er=c;er.x=Qn,er.y=Kn,er.z=$n,or=2}else{var hr,lr,cr;hr=On+ir*rr,lr=Hn+ar*rr,cr=Un+sr*rr;var mr=c;mr.x=hr,mr.y=lr,mr.z=cr,or=3}var vr=c.x*c.x+c.y*c.y+c.z*c.z;if(nn<0||vr<nn){rn=1&or|(2&or)<<1,nn=vr;var br=c;Ko=br.x,$o=br.y,tn=br.z}}if(nn>0){var xr=c;xr.x=Ko,xr.y=$o,xr.z=tn,an=rn}else{var pr=Oo*Oo+Ho*Ho+Uo*Uo;pr>0&&(pr=1/Math.sqrt(pr));var fr=(Oo*=pr)*Oo+(Ho*=pr)*Ho+(Uo*=pr)*Uo;Ko=Oo*(fr=(Vo*Oo+Lo*Ho+wo*Uo)/fr),$o=Ho*fr,tn=Uo*fr;var ur=c;ur.x=Ko,ur.y=$o,ur.z=tn,an=7}var yr=c.x*c.x+c.y*c.y+c.z*c.z;if(Pa<0||yr<Pa){Sa=1&an|(6&an)<<1,Pa=yr;var Xr=c;Ia=Xr.x,Va=Xr.y,La=Xr.z}}if(Ba*wa<0){var gr,zr,dr,Yr,Zr,Mr,Ir,Vr,Lr,wr,kr,Br,Ar,Pr,Sr,Tr,Cr,jr,Rr=pa;gr=Rr.x,zr=Rr.y,dr=Rr.z;var qr=fa;Yr=qr.x,Zr=qr.y,Mr=qr.z;var Er,Dr,Fr,Nr=ya;Ir=Nr.x;var Wr,Gr,Jr,Or,Hr=Yr*((Pr=(Vr=Nr.y)-Zr)*(Fr=(wr=Yr-gr)*Pr-(kr=Zr-zr)*(Ar=Ir-Yr))-(Sr=(Lr=Nr.z)-Mr)*(Dr=(Br=Mr-dr)*Ar-wr*Sr))+Zr*(Sr*(Er=kr*Sr-Br*Pr)-Ar*Fr)+Mr*(Ar*Dr-Pr*Er),Ur=Ir*((Cr=zr-Vr)*Fr-(jr=dr-Lr)*Dr)+Vr*(jr*Er-(Tr=gr-Ir)*Fr)+Lr*(Tr*Dr-Cr*Er),Qr=-1,Kr=0;if(Wr=0,Gr=0,Jr=0,gr*(kr*Fr-Br*Dr)+zr*(Br*Er-wr*Fr)+dr*(wr*Dr-kr*Er)<0){var $r,t_,i_,a_,s_,o_,n_=pa;$r=n_.x,t_=n_.y,i_=n_.z;var r_,__,e_,h_,l_=fa,c_=(r_=(a_=l_.x)-$r)*$r+(__=(s_=l_.y)-t_)*t_+(e_=(o_=l_.z)-i_)*i_;if((c_=-c_/(r_*r_+__*__+e_*e_))<0){var m_=c;m_.x=$r,m_.y=t_,m_.z=i_,h_=1}else if(c_>1){var v_=c;v_.x=a_,v_.y=s_,v_.z=o_,h_=2}else{var b_,x_,p_;b_=$r+r_*c_,x_=t_+__*c_,p_=i_+e_*c_;var f_=c;f_.x=b_,f_.y=x_,f_.z=p_,h_=3}Kr=h_,Qr=c.x*c.x+c.y*c.y+c.z*c.z;var u_=c;Wr=u_.x,Gr=u_.y,Jr=u_.z}if(Hr<0){var y_,X_,g_,z_,d_,Y_,Z_=fa;y_=Z_.x,X_=Z_.y,g_=Z_.z;var M_,I_,V_,L_,w_=ya,k_=(M_=(z_=w_.x)-y_)*y_+(I_=(d_=w_.y)-X_)*X_+(V_=(Y_=w_.z)-g_)*g_;if((k_=-k_/(M_*M_+I_*I_+V_*V_))<0){var B_=c;B_.x=y_,B_.y=X_,B_.z=g_,L_=1}else if(k_>1){var A_=c;A_.x=z_,A_.y=d_,A_.z=Y_,L_=2}else{var P_,S_,T_;P_=y_+M_*k_,S_=X_+I_*k_,T_=g_+V_*k_;var C_=c;C_.x=P_,C_.y=S_,C_.z=T_,L_=3}var j_=c.x*c.x+c.y*c.y+c.z*c.z;if(Qr<0||j_<Qr){Kr=L_<<1,Qr=j_;var R_=c;Wr=R_.x,Gr=R_.y,Jr=R_.z}}if(Ur<0){var q_,E_,D_,F_,N_,W_,G_=pa;q_=G_.x,E_=G_.y,D_=G_.z;var J_,O_,H_,U_,Q_=ya,K_=(J_=(F_=Q_.x)-q_)*q_+(O_=(N_=Q_.y)-E_)*E_+(H_=(W_=Q_.z)-D_)*D_;if((K_=-K_/(J_*J_+O_*O_+H_*H_))<0){var $_=c;$_.x=q_,$_.y=E_,$_.z=D_,U_=1}else if(K_>1){var te=c;te.x=F_,te.y=N_,te.z=W_,U_=2}else{var ie,ae,se;ie=q_+J_*K_,ae=E_+O_*K_,se=D_+H_*K_;var oe=c;oe.x=ie,oe.y=ae,oe.z=se,U_=3}var ne=c.x*c.x+c.y*c.y+c.z*c.z;if(Qr<0||ne<Qr){Kr=1&U_|(2&U_)<<1,Qr=ne;var re=c;Wr=re.x,Gr=re.y,Jr=re.z}}if(Qr>0){var _e=c;_e.x=Wr,_e.y=Gr,_e.z=Jr,Or=Kr}else{var ee=Er*Er+Dr*Dr+Fr*Fr;ee>0&&(ee=1/Math.sqrt(ee));var he=(Er*=ee)*Er+(Dr*=ee)*Dr+(Fr*=ee)*Fr;Wr=Er*(he=(gr*Er+zr*Dr+dr*Fr)/he),Gr=Dr*he,Jr=Fr*he;var le=c;le.x=Wr,le.y=Gr,le.z=Jr,Or=7}var ce=c.x*c.x+c.y*c.y+c.z*c.z;if(Pa<0||ce<Pa){Sa=3&Or|(4&Or)<<1,Pa=ce;var me=c;Ia=me.x,Va=me.y,La=me.z}}if(Aa*wa<0){var ve,be,xe,pe,fe,ue,ye,Xe,ge,ze,de,Ye,Ze,Me,Ie,Ve,Le,we,ke=fa;ve=ke.x,be=ke.y,xe=ke.z;var Be=ua;pe=Be.x,fe=Be.y,ue=Be.z;var Ae,Pe,Se,Te=ya;ye=Te.x;var Ce,je,Re,qe,Ee=pe*((Me=(Xe=Te.y)-fe)*(Se=(ze=pe-ve)*Me-(de=fe-be)*(Ze=ye-pe))-(Ie=(ge=Te.z)-ue)*(Pe=(Ye=ue-xe)*Ze-ze*Ie))+fe*(Ie*(Ae=de*Ie-Ye*Me)-Ze*Se)+ue*(Ze*Pe-Me*Ae),De=ye*((Le=be-Xe)*Se-(we=xe-ge)*Pe)+Xe*(we*Ae-(Ve=ve-ye)*Se)+ge*(Ve*Pe-Le*Ae),Fe=-1,Ne=0;if(Ce=0,je=0,Re=0,ve*(de*Se-Ye*Pe)+be*(Ye*Ae-ze*Se)+xe*(ze*Pe-de*Ae)<0){var We,Ge,Je,Oe,He,Ue,Qe=fa;We=Qe.x,Ge=Qe.y,Je=Qe.z;var Ke,$e,th,ih,ah=ua,sh=(Ke=(Oe=ah.x)-We)*We+($e=(He=ah.y)-Ge)*Ge+(th=(Ue=ah.z)-Je)*Je;if((sh=-sh/(Ke*Ke+$e*$e+th*th))<0){var oh=c;oh.x=We,oh.y=Ge,oh.z=Je,ih=1}else if(sh>1){var nh=c;nh.x=Oe,nh.y=He,nh.z=Ue,ih=2}else{var rh,_h,eh;rh=We+Ke*sh,_h=Ge+$e*sh,eh=Je+th*sh;var hh=c;hh.x=rh,hh.y=_h,hh.z=eh,ih=3}Ne=ih,Fe=c.x*c.x+c.y*c.y+c.z*c.z;var lh=c;Ce=lh.x,je=lh.y,Re=lh.z}if(Ee<0){var ch,mh,vh,bh,xh,ph,fh=ua;ch=fh.x,mh=fh.y,vh=fh.z;var uh,yh,Xh,gh,zh=ya,dh=(uh=(bh=zh.x)-ch)*ch+(yh=(xh=zh.y)-mh)*mh+(Xh=(ph=zh.z)-vh)*vh;if((dh=-dh/(uh*uh+yh*yh+Xh*Xh))<0){var Yh=c;Yh.x=ch,Yh.y=mh,Yh.z=vh,gh=1}else if(dh>1){var Zh=c;Zh.x=bh,Zh.y=xh,Zh.z=ph,gh=2}else{var Mh,Ih,Vh;Mh=ch+uh*dh,Ih=mh+yh*dh,Vh=vh+Xh*dh;var Lh=c;Lh.x=Mh,Lh.y=Ih,Lh.z=Vh,gh=3}var wh=c.x*c.x+c.y*c.y+c.z*c.z;if(Fe<0||wh<Fe){Ne=gh<<1,Fe=wh;var kh=c;Ce=kh.x,je=kh.y,Re=kh.z}}if(De<0){var Bh,Ah,Ph,Sh,Th,Ch,jh=fa;Bh=jh.x,Ah=jh.y,Ph=jh.z;var Rh,qh,Eh,Dh,Fh=ya,Nh=(Rh=(Sh=Fh.x)-Bh)*Bh+(qh=(Th=Fh.y)-Ah)*Ah+(Eh=(Ch=Fh.z)-Ph)*Ph;if((Nh=-Nh/(Rh*Rh+qh*qh+Eh*Eh))<0){var Wh=c;Wh.x=Bh,Wh.y=Ah,Wh.z=Ph,Dh=1}else if(Nh>1){var Gh=c;Gh.x=Sh,Gh.y=Th,Gh.z=Ch,Dh=2}else{var Jh,Oh,Hh;Jh=Bh+Rh*Nh,Oh=Ah+qh*Nh,Hh=Ph+Eh*Nh;var Uh=c;Uh.x=Jh,Uh.y=Oh,Uh.z=Hh,Dh=3}var Qh=c.x*c.x+c.y*c.y+c.z*c.z;if(Fe<0||Qh<Fe){Ne=1&Dh|(2&Dh)<<1,Fe=Qh;var Kh=c;Ce=Kh.x,je=Kh.y,Re=Kh.z}}if(Fe>0){var $h=c;$h.x=Ce,$h.y=je,$h.z=Re,qe=Ne}else{var tl=Ae*Ae+Pe*Pe+Se*Se;tl>0&&(tl=1/Math.sqrt(tl));var il=(Ae*=tl)*Ae+(Pe*=tl)*Pe+(Se*=tl)*Se;Ce=Ae*(il=(ve*Ae+be*Pe+xe*Se)/il),je=Pe*il,Re=Se*il;var al=c;al.x=Ce,al.y=je,al.z=Re,qe=7}var sl=c.x*c.x+c.y*c.y+c.z*c.z;if(Pa<0||sl<Pa){Sa=qe<<1,Pa=sl;var ol=c;Ia=ol.x,Va=ol.y,La=ol.z}}if(Pa>0){var nl=c;nl.x=Ia,nl.y=Va,nl.z=La,k=Sa}else c.zero(),k=15}if(this.shrinkSimplex(k),c.x*c.x+c.y*c.y+c.z*c.z<w){if(0==d||4==this.simplexSize)return r.fraction=d,!1;this.interpolateClosestPoints(),r.fraction=d;var rl=r.normal;rl.x=m.x,rl.y=m.y,rl.z=m.z;var _l=rl,el=Math.sqrt(_l.x*_l.x+_l.y*_l.y+_l.z*_l.z);el>0&&(el=1/el);var hl=_l.x*el,ll=_l.y*el,cl=_l.z*el;_l.x=hl,_l.y=ll,_l.z=cl;var ml=r.position,vl=this.closestPoint1;ml.x=vl.x,ml.y=vl.y,ml.z=vl.z;var bl=ml,xl=bl.x+o.x*d,pl=bl.y+o.y*d,fl=bl.z+o.z*d;return bl.x=xl,bl.y=pl,bl.z=fl,!0}m.x=c.x,m.y=c.y,m.z=c.z;var ul=m,yl=-ul.x,Xl=-ul.y,gl=-ul.z;if(ul.x=yl,ul.y=Xl,ul.z=gl,null!=this.c1)this.computeWitnessPoint1(!0);else{var zl=this.w1[this.simplexSize];zl.x=this.tf1._positionX,zl.y=this.tf1._positionY,zl.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);var dl=this.s[this.simplexSize],Yl=this.w1[this.simplexSize];dl.x=Yl.x,dl.y=Yl.y,dl.z=Yl.z;var Zl=dl,Ml=this.w2[this.simplexSize],Il=Zl.x-Ml.x,Vl=Zl.y-Ml.y,Ll=Zl.z-Ml.z;Zl.x=Il,Zl.y=Vl,Zl.z=Ll;var wl=_[this.simplexSize],kl=wl.x-Y.x,Bl=wl.y-Y.y,Al=wl.z-Y.z;if(wl.x=kl,wl.y=Bl,wl.z=Al,m.x*m.x+m.y*m.y+m.z*m.z<w)throw new Error("!?");var Pl=_[this.simplexSize],Sl=m,Tl=Pl.x*Sl.x+Pl.y*Sl.y+Pl.z*Sl.z;if(Tl<0){if(Z.x*Sl.x+Z.y*Sl.y+Z.z*Sl.z>=0)return!1;var Cl=Tl/(Z.x*Sl.x+Z.y*Sl.y+Z.z*Sl.z);if((d+=Cl)>=1)return!1;var jl=Y.x+Z.x*Cl,Rl=Y.y+Z.y*Cl,ql=Y.z+Z.z*Cl;Y.x=jl,Y.y=Rl,Y.z=ql;for(var El=0,Dl=this.simplexSize+1;El<Dl;){var Fl=_[El++],Nl=-Cl,Wl=Fl.x+Z.x*Nl,Gl=Fl.y+Z.y*Nl,Jl=Fl.z+Z.z*Nl;Fl.x=Wl,Fl.y=Gl,Fl.z=Jl}}for(var Ol=!1,Hl=0,Ul=this.simplexSize;Hl<Ul;){var Ql=Hl++,Kl=_[Ql].x-_[this.simplexSize].x,$l=_[Ql].y-_[this.simplexSize].y,tc=_[Ql].z-_[this.simplexSize].z;if(Kl*Kl+$l*$l+tc*tc<w){Ol=!0;break}}Ol||this.simplexSize++,++z}return!1}interpolateClosestPoints(){switch(this.simplexSize){case 1:var t=this.closestPoint1,i=this.w1[0];t.x=i.x,t.y=i.y,t.z=i.z;var a=this.closestPoint2,s=this.w2[0];a.x=s.x,a.y=s.y,a.z=s.z;break;case 2:var o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y,X,g,z,d,Y,Z=this.closest;o=Z.x,n=Z.y,r=Z.z;var M=this.s[0];_=M.x,e=M.y,h=M.z;var I=this.w1[0];l=I.x,c=I.y,m=I.z;var V=this.w2[0];v=V.x,b=V.y,x=V.z;var L=this.s[1];p=L.x,f=L.y,u=L.z;var w=this.w1[1];y=w.x,X=w.y,g=w.z;var k=this.w2[1];z=k.x,d=k.y,Y=k.z;var B=this.s[2];B.x,B.y,B.z;var A=this.w1[2];A.x,A.y,A.z;var P,S,T,C=this.w2[2];C.x,C.y,C.z;var j=(P=p-_)*P+(S=f-e)*S+(T=u-h)*T;0!=j&&(j=1/j);var R,q,E,D,F,N,W=((o-_)*P+(n-e)*S+(r-h)*T)*j;R=l+(y-l)*W,q=c+(X-c)*W,E=m+(g-m)*W,D=v+(z-v)*W,F=b+(d-b)*W,N=x+(Y-x)*W;var G=this.closestPoint1;G.x=R,G.y=q,G.z=E;var J=this.closestPoint2;J.x=D,J.y=F,J.z=N;break;case 3:var O,H,U,Q,K,$,tt,it,at,st,ot,nt,rt,_t,et,ht,lt,ct,mt,vt,bt,xt,pt,ft,ut,yt,Xt,gt=this.closest;O=gt.x,H=gt.y,U=gt.z;var zt=this.s[0];Q=zt.x,K=zt.y,$=zt.z;var dt=this.w1[0];tt=dt.x,it=dt.y,at=dt.z;var Yt=this.w2[0];st=Yt.x,ot=Yt.y,nt=Yt.z;var Zt=this.s[1];rt=Zt.x,_t=Zt.y,et=Zt.z;var Mt=this.w1[1];ht=Mt.x,lt=Mt.y,ct=Mt.z;var It=this.w2[1];mt=It.x,vt=It.y,bt=It.z;var Vt=this.s[2];xt=Vt.x,pt=Vt.y,ft=Vt.z;var Lt=this.w1[2];ut=Lt.x,yt=Lt.y,Xt=Lt.z;var wt,kt,Bt,At,Pt,St,Tt,Ct,jt,Rt=this.w2[2],qt=(wt=rt-Q)*wt+(kt=_t-K)*kt+(Bt=et-$)*Bt,Et=wt*(At=xt-Q)+kt*(Pt=pt-K)+Bt*(St=ft-$),Dt=At*At+Pt*Pt+St*St,Ft=wt*(Tt=O-Q)+kt*(Ct=H-K)+Bt*(jt=U-$),Nt=At*Tt+Pt*Ct+St*jt,Wt=qt*Dt-Et*Et;0!=Wt&&(Wt=1/Wt);var Gt,Jt,Ot,Ht,Ut,Qt,Kt=(Ft*Dt-Nt*Et)*Wt,$t=(-Ft*Et+Nt*qt)*Wt;Gt=tt+(ht-tt)*Kt,Jt=it+(lt-it)*Kt,Ot=at+(ct-at)*Kt,Gt+=(ut-tt)*$t,Jt+=(yt-it)*$t,Ot+=(Xt-at)*$t,Ht=st+(mt-st)*Kt,Ut=ot+(vt-ot)*Kt,Qt=nt+(bt-nt)*Kt,Ht+=(Rt.x-st)*$t,Ut+=(Rt.y-ot)*$t,Qt+=(Rt.z-nt)*$t;var ti=this.closestPoint1;ti.x=Gt,ti.y=Jt,ti.z=Ot;var ii=this.closestPoint2;ii.x=Ht,ii.y=Ut,ii.z=Qt;break;default:throw new Error("!?")}}loadCache(t){var i=this.dir,a=t.prevClosestDir;i.x=a.x,i.y=a.y,i.z=a.z}saveCache(t){var i=t.prevClosestDir,a=this.closest;i.x=a.x,i.y=a.y,i.z=a.z;var s=i,o=-s.x,n=-s.y,r=-s.z;s.x=o,s.y=n,s.z=r}shrinkSimplex(t){switch(this.simplexSize=t,this.simplexSize=(5&this.simplexSize)+(this.simplexSize>>1&5),this.simplexSize=(3&this.simplexSize)+(this.simplexSize>>2&3),t){case 2:var i=this.s[0],a=this.s[1];i.x=a.x,i.y=a.y,i.z=a.z;var s=this.w1[0],o=this.w1[1];s.x=o.x,s.y=o.y,s.z=o.z;var n=this.w2[0],r=this.w2[1];n.x=r.x,n.y=r.y,n.z=r.z;break;case 4:var _=this.s[0],e=this.s[2];_.x=e.x,_.y=e.y,_.z=e.z;var h=this.w1[0],l=this.w1[2];h.x=l.x,h.y=l.y,h.z=l.z;var c=this.w2[0],m=this.w2[2];c.x=m.x,c.y=m.y,c.z=m.z;break;case 5:var v=this.s[1],b=this.s[2];v.x=b.x,v.y=b.y,v.z=b.z;var x=this.w1[1],p=this.w1[2];x.x=p.x,x.y=p.y,x.z=p.z;var f=this.w2[1],u=this.w2[2];f.x=u.x,f.y=u.y,f.z=u.z;break;case 6:var y=this.s[0],X=this.s[2];y.x=X.x,y.y=X.y,y.z=X.z;var g=this.w1[0],z=this.w1[2];g.x=z.x,g.y=z.y,g.z=z.z;var d=this.w2[0],Y=this.w2[2];d.x=Y.x,d.y=Y.y,d.z=Y.z;break;case 8:var Z=this.s[0],M=this.s[3];Z.x=M.x,Z.y=M.y,Z.z=M.z;var I=this.w1[0],V=this.w1[3];I.x=V.x,I.y=V.y,I.z=V.z;var L=this.w2[0],w=this.w2[3];L.x=w.x,L.y=w.y,L.z=w.z;break;case 9:var k=this.s[1],B=this.s[3];k.x=B.x,k.y=B.y,k.z=B.z;var A=this.w1[1],P=this.w1[3];A.x=P.x,A.y=P.y,A.z=P.z;var S=this.w2[1],T=this.w2[3];S.x=T.x,S.y=T.y,S.z=T.z;break;case 10:var C=this.s[0],j=this.s[3];C.x=j.x,C.y=j.y,C.z=j.z;var R=this.w1[0],q=this.w1[3];R.x=q.x,R.y=q.y,R.z=q.z;var E=this.w2[0],D=this.w2[3];E.x=D.x,E.y=D.y,E.z=D.z;break;case 11:var F=this.s[2],N=this.s[3];F.x=N.x,F.y=N.y,F.z=N.z;var W=this.w1[2],G=this.w1[3];W.x=G.x,W.y=G.y,W.z=G.z;var J=this.w2[2],O=this.w2[3];J.x=O.x,J.y=O.y,J.z=O.z;break;case 12:var H=this.s[0],U=this.s[2];H.x=U.x,H.y=U.y,H.z=U.z;var Q=this.w1[0],K=this.w1[2];Q.x=K.x,Q.y=K.y,Q.z=K.z;var $=this.w2[0],tt=this.w2[2];$.x=tt.x,$.y=tt.y,$.z=tt.z;var it=this.s[1],at=this.s[3];it.x=at.x,it.y=at.y,it.z=at.z;var st=this.w1[1],ot=this.w1[3];st.x=ot.x,st.y=ot.y,st.z=ot.z;var nt=this.w2[1],rt=this.w2[3];nt.x=rt.x,nt.y=rt.y,nt.z=rt.z;break;case 13:var _t=this.s[1],et=this.s[3];_t.x=et.x,_t.y=et.y,_t.z=et.z;var ht=this.w1[1],lt=this.w1[3];ht.x=lt.x,ht.y=lt.y,ht.z=lt.z;var ct=this.w2[1],mt=this.w2[3];ct.x=mt.x,ct.y=mt.y,ct.z=mt.z;break;case 14:var vt=this.s[0],bt=this.s[3];vt.x=bt.x,vt.y=bt.y,vt.z=bt.z;var xt=this.w1[0],pt=this.w1[3];xt.x=pt.x,xt.y=pt.y,xt.z=pt.z;var ft=this.w2[0],ut=this.w2[3];ft.x=ut.x,ft.y=ut.y,ft.z=ut.z}}computeWitnessPoint1(t){var i,a,s,o,n,r,_,e,h,l,c,m,v=this.dir;o=v.x,n=v.y,r=v.z,_=this.tf1._rotation00*o+this.tf1._rotation10*n+this.tf1._rotation20*r,e=this.tf1._rotation01*o+this.tf1._rotation11*n+this.tf1._rotation21*r,h=this.tf1._rotation02*o+this.tf1._rotation12*n+this.tf1._rotation22*r;var b=this.dir;if(b.x=_,b.y=e,b.z=h,this.c1.computeLocalSupportingVertex(this.dir,this.w1[this.simplexSize]),t){var x=this.dir,p=Math.sqrt(x.x*x.x+x.y*x.y+x.z*x.z);p>0&&(p=1/p);var f=x.x*p,u=x.y*p,y=x.z*p;x.x=f,x.y=u,x.z=y;var X=this.w1[this.simplexSize],g=this.dir,z=this.c1._gjkMargin,d=X.x+g.x*z,Y=X.y+g.y*z,Z=X.z+g.z*z;X.x=d,X.y=Y,X.z=Z}var M=this.w1[this.simplexSize];i=M.x,a=M.y,s=M.z,l=this.tf1._rotation00*i+this.tf1._rotation01*a+this.tf1._rotation02*s,c=this.tf1._rotation10*i+this.tf1._rotation11*a+this.tf1._rotation12*s,m=this.tf1._rotation20*i+this.tf1._rotation21*a+this.tf1._rotation22*s,l+=this.tf1._positionX,c+=this.tf1._positionY,m+=this.tf1._positionZ;var I=this.w1[this.simplexSize];I.x=l,I.y=c,I.z=m;var V=this.dir;V.x=o,V.y=n,V.z=r}computeWitnessPoint2(t){var i,a,s,o,n,r,_,e,h,l,c,m,v=this.dir;o=v.x,n=v.y,r=v.z,_=-(_=this.tf2._rotation00*o+this.tf2._rotation10*n+this.tf2._rotation20*r),e=-(e=this.tf2._rotation01*o+this.tf2._rotation11*n+this.tf2._rotation21*r),h=-(h=this.tf2._rotation02*o+this.tf2._rotation12*n+this.tf2._rotation22*r);var b=this.dir;if(b.x=_,b.y=e,b.z=h,this.c2.computeLocalSupportingVertex(this.dir,this.w2[this.simplexSize]),t){var x=this.dir,p=Math.sqrt(x.x*x.x+x.y*x.y+x.z*x.z);p>0&&(p=1/p);var f=x.x*p,u=x.y*p,y=x.z*p;x.x=f,x.y=u,x.z=y;var X=this.w2[this.simplexSize],g=this.dir,z=this.c2._gjkMargin,d=X.x+g.x*z,Y=X.y+g.y*z,Z=X.z+g.z*z;X.x=d,X.y=Y,X.z=Z}var M=this.w2[this.simplexSize];i=M.x,a=M.y,s=M.z,l=this.tf2._rotation00*i+this.tf2._rotation01*a+this.tf2._rotation02*s,c=this.tf2._rotation10*i+this.tf2._rotation11*a+this.tf2._rotation12*s,m=this.tf2._rotation20*i+this.tf2._rotation21*a+this.tf2._rotation22*s,l+=this.tf2._positionX,c+=this.tf2._positionY,m+=this.tf2._positionZ;var I=this.w2[this.simplexSize];I.x=l,I.y=c,I.z=m;var V=this.dir;V.x=o,V.y=n,V.z=r}pointToTetrahedron(){for(var t=0;t<3;){var i=t++,a=this.dir,s=this.baseDirs[i];a.x=s.x,a.y=s.y,a.z=s.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var o=this.s[this.simplexSize],n=this.w1[this.simplexSize];o.x=n.x,o.y=n.y,o.z=n.z;var r=o,_=this.w2[this.simplexSize],e=r.x-_.x,h=r.y-_.y,l=r.z-_.z;if(r.x=e,r.y=h,r.z=l,this.simplexSize++,this.lineToTetrahedron(),4==this.simplexSize)break;this.simplexSize--;var c=this.dir,m=-c.x,v=-c.y,b=-c.z;c.x=m,c.y=v,c.z=b,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var x=this.s[this.simplexSize],p=this.w1[this.simplexSize];x.x=p.x,x.y=p.y,x.z=p.z;var f=x,u=this.w2[this.simplexSize],y=f.x-u.x,X=f.y-u.y,g=f.z-u.z;if(f.x=y,f.y=X,f.z=g,this.simplexSize++,this.lineToTetrahedron(),4==this.simplexSize)break;this.simplexSize--}}lineToTetrahedron(){var t,i,a,s,o,n,r,_,e,h=this.dir;t=h.x,i=h.y,a=h.z;var l=this.s[0];s=l.x,o=l.y,n=l.z;var c=this.s[1];r=s-c.x,_=o-c.y,e=n-c.z;for(var m=0;m<3;){var v,b,x,p,f,u,y=m++,X=this.baseDirs[y];v=X.x,b=X.y,p=_*(x=X.z)-e*b,f=e*v-r*x,u=r*b-_*v;var g=this.dir;g.x=p,g.y=f,g.z=u,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var z=this.s[this.simplexSize],d=this.w1[this.simplexSize];z.x=d.x,z.y=d.y,z.z=d.z;var Y=z,Z=this.w2[this.simplexSize],M=Y.x-Z.x,I=Y.y-Z.y,V=Y.z-Z.z;if(Y.x=M,Y.y=I,Y.z=V,this.simplexSize++,this.triangleToTetrahedron(),4==this.simplexSize)break;this.simplexSize--;var L=this.dir,w=-L.x,k=-L.y,B=-L.z;L.x=w,L.y=k,L.z=B,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var A=this.s[this.simplexSize],P=this.w1[this.simplexSize];A.x=P.x,A.y=P.y,A.z=P.z;var S=A,T=this.w2[this.simplexSize],C=S.x-T.x,j=S.y-T.y,R=S.z-T.z;if(S.x=C,S.y=j,S.z=R,this.simplexSize++,this.triangleToTetrahedron(),4==this.simplexSize)break;this.simplexSize--}var q=this.dir;q.x=t,q.y=i,q.z=a}triangleToTetrahedron(){var t,i,a,s=this.dir;for(t=s.x,i=s.y,a=s.z;;){var o,n,r,_,e,h,l,c,m,v,b,x,p,f,u=this.s[0];o=u.x,n=u.y,r=u.z;var y=this.s[1];_=y.x,e=y.y,h=y.z;var X,g,z,d=this.s[2];l=d.x,c=d.y,X=(v=e-n)*(f=d.z-r)-(b=h-r)*(p=c-n),g=b*(x=l-o)-(m=_-o)*f,z=m*p-v*x;var Y=this.dir;Y.x=X,Y.y=g,Y.z=z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var Z=this.s[this.simplexSize],M=this.w1[this.simplexSize];Z.x=M.x,Z.y=M.y,Z.z=M.z;var I=Z,V=this.w2[this.simplexSize],L=I.x-V.x,w=I.y-V.y,k=I.z-V.z;if(I.x=L,I.y=w,I.z=k,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;var B=this.dir,A=-B.x,P=-B.y,S=-B.z;B.x=A,B.y=P,B.z=S,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var T=this.s[this.simplexSize],C=this.w1[this.simplexSize];T.x=C.x,T.y=C.y,T.z=C.z;var j=T,R=this.w2[this.simplexSize],q=j.x-R.x,E=j.y-R.y,D=j.z-R.z;if(j.x=q,j.y=E,j.z=D,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;break}var F=this.dir;F.x=t,F.y=i,F.z=a}isValidTetrahedron(){var t=this.s[1].x-this.s[0].x,i=this.s[1].y-this.s[0].y,a=this.s[1].z-this.s[0].z,s=this.s[2].x-this.s[0].x,o=this.s[2].y-this.s[0].y,n=this.s[2].z-this.s[0].z,r=this.s[3].x-this.s[0].x,_=this.s[3].y-this.s[0].y,e=this.s[3].z-this.s[0].z,h=t*(o*e-n*_)-i*(s*e-n*r)+a*(s*_-o*r);return h>1e-12||h<-1e-12}computeDepth(i,a,s,o,n,r,_){for(var e=this.polyhedron;e._numTriangles>0;){var h=e._triangleList;e._numTriangles--;var l=h._prev,c=h._next;null!=l&&(l._next=c),null!=c&&(c._prev=l),h==e._triangleList&&(e._triangleList=e._triangleList._next),h==e._triangleListLast&&(e._triangleListLast=e._triangleListLast._prev),h._next=null,h._prev=null,h.removeReferences(),h._next=e._trianglePool,e._trianglePool=h}for(;e._numVertices>0;){var m=e._vertices[--e._numVertices];m.removeReferences(),m._next=e._vertexPool,e._vertexPool=m}var v=this.polyhedron,b=this.polyhedron,x=b._vertexPool;null!=x?(b._vertexPool=x._next,x._next=null):x=new t.collision.narrowphase.detector.gjkepa.EpaVertex;var p=x.init(n[0],r[0],_[0]),f=this.polyhedron,u=f._vertexPool;null!=u?(f._vertexPool=u._next,u._next=null):u=new t.collision.narrowphase.detector.gjkepa.EpaVertex;var y=u.init(n[1],r[1],_[1]),X=this.polyhedron,g=X._vertexPool;null!=g?(X._vertexPool=g._next,g._next=null):g=new t.collision.narrowphase.detector.gjkepa.EpaVertex;var z=g.init(n[2],r[2],_[2]),d=this.polyhedron,Y=d._vertexPool;if(null!=Y?(d._vertexPool=Y._next,Y._next=null):Y=new t.collision.narrowphase.detector.gjkepa.EpaVertex,!v._init(p,y,z,Y.init(n[3],r[3],_[3])))return t.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT;this.simplexSize=0;for(var Z=this.s[0],M=this.w1[0],I=this.w2[0],V=0;V<40;){for(var L=this.polyhedron._triangleList,w=1/0,k=null;null!=L;){var B=L._next;L._distanceSq<w&&(w=L._distanceSq,k=L),L=B}var A=k,P=this.dir,S=A._normal;P.x=S.x,P.y=S.y,P.z=S.z;var T=P,C=Math.sqrt(T.x*T.x+T.y*T.y+T.z*T.z);C>0&&(C=1/C);var j=T.x*C,R=T.y*C,q=T.z*C;T.x=j,T.y=R,T.z=q,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var E=this.s[this.simplexSize],D=this.w1[this.simplexSize];E.x=D.x,E.y=D.y,E.z=D.z;var F=E,N=this.w2[this.simplexSize],W=F.x-N.x,G=F.y-N.y,J=F.z-N.z;F.x=W,F.y=G,F.z=J;var O=A._vertices[0],H=A._vertices[1],U=A._vertices[2],Q=O.v,K=this.dir,$=Q.x*K.x+Q.y*K.y+Q.z*K.z,tt=this.dir;if(Z.x*tt.x+Z.y*tt.y+Z.z*tt.z-$<1e-6||39==V){var it=this.closest,at=this.dir;it.x=at.x,it.y=at.y,it.z=at.z;var st,ot,nt,rt=it,_t=this.dir,et=O.v,ht=this.dir,lt=(_t.x*et.x+_t.y*et.y+_t.z*et.z)/(ht.x*ht.x+ht.y*ht.y+ht.z*ht.z),ct=rt.x*lt,mt=rt.y*lt,vt=rt.z*lt;rt.x=ct,rt.y=mt,rt.z=vt;var bt,xt,pt,ft,ut,yt,Xt,gt,zt,dt,Yt,Zt,Mt,It,Vt,Lt,wt,kt,Bt,At,Pt,St,Tt,Ct,jt=this.closest;st=jt.x,ot=jt.y,nt=jt.z;var Rt=O.v;bt=Rt.x,xt=Rt.y,pt=Rt.z;var qt=O.w1;ft=qt.x,ut=qt.y,yt=qt.z;var Et=O.w2;Xt=Et.x,gt=Et.y,zt=Et.z;var Dt=H.v;dt=Dt.x,Yt=Dt.y,Zt=Dt.z;var Ft=H.w1;Mt=Ft.x,It=Ft.y,Vt=Ft.z;var Nt=H.w2;Lt=Nt.x,wt=Nt.y,kt=Nt.z;var Wt=U.v;Bt=Wt.x,At=Wt.y,Pt=Wt.z;var Gt=U.w1;St=Gt.x,Tt=Gt.y,Ct=Gt.z;var Jt,Ot,Ht,Ut,Qt,Kt,$t,ti,ii,ai=U.w2,si=(Jt=dt-bt)*Jt+(Ot=Yt-xt)*Ot+(Ht=Zt-pt)*Ht,oi=Jt*(Ut=Bt-bt)+Ot*(Qt=At-xt)+Ht*(Kt=Pt-pt),ni=Ut*Ut+Qt*Qt+Kt*Kt,ri=Jt*($t=st-bt)+Ot*(ti=ot-xt)+Ht*(ii=nt-pt),_i=Ut*$t+Qt*ti+Kt*ii,ei=si*ni-oi*oi;0!=ei&&(ei=1/ei);var hi,li,ci,mi,vi,bi,xi=(ri*ni-_i*oi)*ei,pi=(-ri*oi+_i*si)*ei;hi=ft+(Mt-ft)*xi,li=ut+(It-ut)*xi,ci=yt+(Vt-yt)*xi,hi+=(St-ft)*pi,li+=(Tt-ut)*pi,ci+=(Ct-yt)*pi,mi=Xt+(Lt-Xt)*xi,vi=gt+(wt-gt)*xi,bi=zt+(kt-zt)*xi,mi+=(ai.x-Xt)*pi,vi+=(ai.y-gt)*pi,bi+=(ai.z-zt)*pi;var fi=this.closestPoint1;fi.x=hi,fi.y=li,fi.z=ci;var ui=this.closestPoint2;ui.x=mi,ui.y=vi,ui.z=bi;var yi=this.closest;return this.depth=Math.sqrt(yi.x*yi.x+yi.y*yi.y+yi.z*yi.z),t.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED}var Xi=this.polyhedron,gi=Xi._vertexPool;null!=gi?(Xi._vertexPool=gi._next,gi._next=null):gi=new t.collision.narrowphase.detector.gjkepa.EpaVertex;var zi=gi.init(Z,M,I);if(!this.polyhedron._addVertex(zi,A))return t.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX;++V}return t.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE}computeClosestPoints(t,i,a,s,o){return this.computeClosestPointsImpl(t,i,a,s,o,!0)}computeDistance(t,i,a,s,o){return this.computeClosestPointsImpl(t,i,a,s,o,!1)}convexCast(t,i,a,s,o,n,r){return this.convexCastImpl(t,i,a,s,o,n,r)}rayCast(t,i,a,s,o){var n=this.tempTransform,r=i,_=a;n._positionX=_.x,n._positionY=_.y,n._positionZ=_.z;var e=this.tl1,h=this.tl2;e.x=s.x,e.y=s.y,e.z=s.z;var l=e,c=l.x-a.x,m=l.y-a.y,v=l.z-a.z;return l.x=c,l.y=m,l.z=v,h.zero(),this.convexCastImpl(null,t,n,r,e,h,o)}static getInstance(){return t.collision.narrowphase.detector.gjkepa.GjkEpa.instance}},t.collision.narrowphase.detector.gjkepa.GjkEpaLog=class{},t.collision.narrowphase.detector.gjkepa.GjkEpaResultState=class{},t.collision.narrowphase.detector.gjkepa.SimplexUtil=class{static projectOrigin2(t,i,a){var s,o,n,r,_,e,h=t;s=h.x,o=h.y,n=h.z;var l,c,m,v,b,x,p=i,f=(l=(r=p.x)-s)*s+(c=(_=p.y)-o)*o+(m=(e=p.z)-n)*n;if((f=-f/(l*l+c*c+m*m))<0){var u=a;return u.x=s,u.y=o,u.z=n,1}if(f>1){var y=a;return y.x=r,y.y=_,y.z=e,2}v=s+l*f,b=o+c*f,x=n+m*f;var X=a;return X.x=v,X.y=b,X.z=x,3}static projectOrigin3(t,i,a,s){var o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y,X,g,z=t;o=z.x,n=z.y,r=z.z;var d=i;_=d.x,e=d.y,h=d.z;var Y,Z,M,I=a;l=I.x;var V,L,w,k=_*((f=(c=I.y)-e)*(M=(v=_-o)*f-(b=e-n)*(p=l-_))-(u=(m=I.z)-h)*(Z=(x=h-r)*p-v*u))+e*(u*(Y=b*u-x*f)-p*M)+h*(p*Z-f*Y),B=l*((X=n-c)*M-(g=r-m)*Z)+c*(g*Y-(y=o-l)*M)+m*(y*Z-X*Y),A=-1,P=0;if(V=0,L=0,w=0,o*(b*M-x*Z)+n*(x*Y-v*M)+r*(v*Z-b*Y)<0){var S,T,C,j,R,q,E=t;S=E.x,T=E.y,C=E.z;var D,F,N,W,G=i,J=(D=(j=G.x)-S)*S+(F=(R=G.y)-T)*T+(N=(q=G.z)-C)*C;if((J=-J/(D*D+F*F+N*N))<0){var O=s;O.x=S,O.y=T,O.z=C,W=1}else if(J>1){var H=s;H.x=j,H.y=R,H.z=q,W=2}else{var U,Q,K;U=S+D*J,Q=T+F*J,K=C+N*J;var $=s;$.x=U,$.y=Q,$.z=K,W=3}P=W,A=s.x*s.x+s.y*s.y+s.z*s.z;var tt=s;V=tt.x,L=tt.y,w=tt.z}if(k<0){var it,at,st,ot,nt,rt,_t=i;it=_t.x,at=_t.y,st=_t.z;var et,ht,lt,ct,mt=a,vt=(et=(ot=mt.x)-it)*it+(ht=(nt=mt.y)-at)*at+(lt=(rt=mt.z)-st)*st;if((vt=-vt/(et*et+ht*ht+lt*lt))<0){var bt=s;bt.x=it,bt.y=at,bt.z=st,ct=1}else if(vt>1){var xt=s;xt.x=ot,xt.y=nt,xt.z=rt,ct=2}else{var pt,ft,ut;pt=it+et*vt,ft=at+ht*vt,ut=st+lt*vt;var yt=s;yt.x=pt,yt.y=ft,yt.z=ut,ct=3}var Xt=s.x*s.x+s.y*s.y+s.z*s.z;if(A<0||Xt<A){P=ct<<1,A=Xt;var gt=s;V=gt.x,L=gt.y,w=gt.z}}if(B<0){var zt,dt,Yt,Zt,Mt,It,Vt=t;zt=Vt.x,dt=Vt.y,Yt=Vt.z;var Lt,wt,kt,Bt,At=a,Pt=(Lt=(Zt=At.x)-zt)*zt+(wt=(Mt=At.y)-dt)*dt+(kt=(It=At.z)-Yt)*Yt;if((Pt=-Pt/(Lt*Lt+wt*wt+kt*kt))<0){var St=s;St.x=zt,St.y=dt,St.z=Yt,Bt=1}else if(Pt>1){var Tt=s;Tt.x=Zt,Tt.y=Mt,Tt.z=It,Bt=2}else{var Ct,jt,Rt;Ct=zt+Lt*Pt,jt=dt+wt*Pt,Rt=Yt+kt*Pt;var qt=s;qt.x=Ct,qt.y=jt,qt.z=Rt,Bt=3}var Et=s.x*s.x+s.y*s.y+s.z*s.z;if(A<0||Et<A){P=1&Bt|(2&Bt)<<1,A=Et;var Dt=s;V=Dt.x,L=Dt.y,w=Dt.z}}if(A>0){var Ft=s;return Ft.x=V,Ft.y=L,Ft.z=w,P}var Nt=Y*Y+Z*Z+M*M;Nt>0&&(Nt=1/Math.sqrt(Nt));var Wt=(Y*=Nt)*Y+(Z*=Nt)*Z+(M*=Nt)*M;V=Y*(Wt=(o*Y+n*Z+r*M)/Wt),L=Z*Wt,w=M*Wt;var Gt=s;return Gt.x=V,Gt.y=L,Gt.z=w,7}static projectOrigin4(t,i,a,s,o){var n,r,_,e,h,l,c,m,v,b,x,p,f,u,y,X,g,z,d,Y,Z,M,I,V,L,w,k,B=t;n=B.x,r=B.y,_=B.z;var A=i;e=A.x,h=A.y,l=A.z;var P=a;c=P.x,m=P.y,v=P.z;var S,T,C,j=s;b=j.x;var R,q,E,D=(f=e-n)*(S=(w=(x=j.y)-h)*(V=v-l)-(k=(p=j.z)-l)*(I=m-h))+(u=h-r)*(T=k*(M=c-e)-(L=b-e)*V)+(y=l-_)*(C=L*I-w*M)>0?1:-1,F=n*((g=m-r)*(Z=p-_)-(z=v-_)*(Y=x-r))+r*(z*(d=b-n)-(X=c-n)*Z)+_*(X*Y-g*d),N=n*(Y*y-Z*u)+r*(Z*f-d*y)+_*(d*u-Y*f),W=e*S+h*T+l*C,G=-1,J=0;if(R=0,q=0,E=0,(n*(u*z-y*g)+r*(y*X-f*z)+_*(f*g-u*X))*D<0){var O,H,U,Q,K,$,tt,it,at,st,ot,nt,rt,_t,et,ht,lt,ct,mt=t;O=mt.x,H=mt.y,U=mt.z;var vt=i;Q=vt.x,K=vt.y,$=vt.z;var bt,xt,pt,ft=a;tt=ft.x;var ut,yt,Xt,gt,zt=Q*((_t=(it=ft.y)-K)*(pt=(st=Q-O)*_t-(ot=K-H)*(rt=tt-Q))-(et=(at=ft.z)-$)*(xt=(nt=$-U)*rt-st*et))+K*(et*(bt=ot*et-nt*_t)-rt*pt)+$*(rt*xt-_t*bt),dt=tt*((lt=H-it)*pt-(ct=U-at)*xt)+it*(ct*bt-(ht=O-tt)*pt)+at*(ht*xt-lt*bt),Yt=-1,Zt=0;if(ut=0,yt=0,Xt=0,O*(ot*pt-nt*xt)+H*(nt*bt-st*pt)+U*(st*xt-ot*bt)<0){var Mt,It,Vt,Lt,wt,kt,Bt=t;Mt=Bt.x,It=Bt.y,Vt=Bt.z;var At,Pt,St,Tt,Ct=i,jt=(At=(Lt=Ct.x)-Mt)*Mt+(Pt=(wt=Ct.y)-It)*It+(St=(kt=Ct.z)-Vt)*Vt;if((jt=-jt/(At*At+Pt*Pt+St*St))<0){var Rt=o;Rt.x=Mt,Rt.y=It,Rt.z=Vt,Tt=1}else if(jt>1){var qt=o;qt.x=Lt,qt.y=wt,qt.z=kt,Tt=2}else{var Et,Dt,Ft;Et=Mt+At*jt,Dt=It+Pt*jt,Ft=Vt+St*jt;var Nt=o;Nt.x=Et,Nt.y=Dt,Nt.z=Ft,Tt=3}Zt=Tt,Yt=o.x*o.x+o.y*o.y+o.z*o.z;var Wt=o;ut=Wt.x,yt=Wt.y,Xt=Wt.z}if(zt<0){var Gt,Jt,Ot,Ht,Ut,Qt,Kt=i;Gt=Kt.x,Jt=Kt.y,Ot=Kt.z;var $t,ti,ii,ai,si=a,oi=($t=(Ht=si.x)-Gt)*Gt+(ti=(Ut=si.y)-Jt)*Jt+(ii=(Qt=si.z)-Ot)*Ot;if((oi=-oi/($t*$t+ti*ti+ii*ii))<0){var ni=o;ni.x=Gt,ni.y=Jt,ni.z=Ot,ai=1}else if(oi>1){var ri=o;ri.x=Ht,ri.y=Ut,ri.z=Qt,ai=2}else{var _i,ei,hi;_i=Gt+$t*oi,ei=Jt+ti*oi,hi=Ot+ii*oi;var li=o;li.x=_i,li.y=ei,li.z=hi,ai=3}var ci=o.x*o.x+o.y*o.y+o.z*o.z;if(Yt<0||ci<Yt){Zt=ai<<1,Yt=ci;var mi=o;ut=mi.x,yt=mi.y,Xt=mi.z}}if(dt<0){var vi,bi,xi,pi,fi,ui,yi=t;vi=yi.x,bi=yi.y,xi=yi.z;var Xi,gi,zi,di,Yi=a,Zi=(Xi=(pi=Yi.x)-vi)*vi+(gi=(fi=Yi.y)-bi)*bi+(zi=(ui=Yi.z)-xi)*xi;if((Zi=-Zi/(Xi*Xi+gi*gi+zi*zi))<0){var Mi=o;Mi.x=vi,Mi.y=bi,Mi.z=xi,di=1}else if(Zi>1){var Ii=o;Ii.x=pi,Ii.y=fi,Ii.z=ui,di=2}else{var Vi,Li,wi;Vi=vi+Xi*Zi,Li=bi+gi*Zi,wi=xi+zi*Zi;var ki=o;ki.x=Vi,ki.y=Li,ki.z=wi,di=3}var Bi=o.x*o.x+o.y*o.y+o.z*o.z;if(Yt<0||Bi<Yt){Zt=1&di|(2&di)<<1,Yt=Bi;var Ai=o;ut=Ai.x,yt=Ai.y,Xt=Ai.z}}if(Yt>0){var Pi=o;Pi.x=ut,Pi.y=yt,Pi.z=Xt,gt=Zt}else{var Si=bt*bt+xt*xt+pt*pt;Si>0&&(Si=1/Math.sqrt(Si));var Ti=(bt*=Si)*bt+(xt*=Si)*xt+(pt*=Si)*pt;ut=bt*(Ti=(O*bt+H*xt+U*pt)/Ti),yt=xt*Ti,Xt=pt*Ti;var Ci=o;Ci.x=ut,Ci.y=yt,Ci.z=Xt,gt=7}J=gt,G=o.x*o.x+o.y*o.y+o.z*o.z;var ji=o;R=ji.x,q=ji.y,E=ji.z}if(F*D<0){var Ri,qi,Ei,Di,Fi,Ni,Wi,Gi,Ji,Oi,Hi,Ui,Qi,Ki,$i,ta,ia,aa,sa=t;Ri=sa.x,qi=sa.y,Ei=sa.z;var oa=a;Di=oa.x,Fi=oa.y,Ni=oa.z;var na,ra,_a,ea=s;Wi=ea.x;var ha,la,ca,ma,va=Di*((Ki=(Gi=ea.y)-Fi)*(_a=(Oi=Di-Ri)*Ki-(Hi=Fi-qi)*(Qi=Wi-Di))-($i=(Ji=ea.z)-Ni)*(ra=(Ui=Ni-Ei)*Qi-Oi*$i))+Fi*($i*(na=Hi*$i-Ui*Ki)-Qi*_a)+Ni*(Qi*ra-Ki*na),ba=Wi*((ia=qi-Gi)*_a-(aa=Ei-Ji)*ra)+Gi*(aa*na-(ta=Ri-Wi)*_a)+Ji*(ta*ra-ia*na),xa=-1,pa=0;if(ha=0,la=0,ca=0,Ri*(Hi*_a-Ui*ra)+qi*(Ui*na-Oi*_a)+Ei*(Oi*ra-Hi*na)<0){var fa,ua,ya,Xa,ga,za,da=t;fa=da.x,ua=da.y,ya=da.z;var Ya,Za,Ma,Ia,Va=a,La=(Ya=(Xa=Va.x)-fa)*fa+(Za=(ga=Va.y)-ua)*ua+(Ma=(za=Va.z)-ya)*ya;if((La=-La/(Ya*Ya+Za*Za+Ma*Ma))<0){var wa=o;wa.x=fa,wa.y=ua,wa.z=ya,Ia=1}else if(La>1){var ka=o;ka.x=Xa,ka.y=ga,ka.z=za,Ia=2}else{var Ba,Aa,Pa;Ba=fa+Ya*La,Aa=ua+Za*La,Pa=ya+Ma*La;var Sa=o;Sa.x=Ba,Sa.y=Aa,Sa.z=Pa,Ia=3}pa=Ia,xa=o.x*o.x+o.y*o.y+o.z*o.z;var Ta=o;ha=Ta.x,la=Ta.y,ca=Ta.z}if(va<0){var Ca,ja,Ra,qa,Ea,Da,Fa=a;Ca=Fa.x,ja=Fa.y,Ra=Fa.z;var Na,Wa,Ga,Ja,Oa=s,Ha=(Na=(qa=Oa.x)-Ca)*Ca+(Wa=(Ea=Oa.y)-ja)*ja+(Ga=(Da=Oa.z)-Ra)*Ra;if((Ha=-Ha/(Na*Na+Wa*Wa+Ga*Ga))<0){var Ua=o;Ua.x=Ca,Ua.y=ja,Ua.z=Ra,Ja=1}else if(Ha>1){var Qa=o;Qa.x=qa,Qa.y=Ea,Qa.z=Da,Ja=2}else{var Ka,$a,ts;Ka=Ca+Na*Ha,$a=ja+Wa*Ha,ts=Ra+Ga*Ha;var is=o;is.x=Ka,is.y=$a,is.z=ts,Ja=3}var as=o.x*o.x+o.y*o.y+o.z*o.z;if(xa<0||as<xa){pa=Ja<<1,xa=as;var ss=o;ha=ss.x,la=ss.y,ca=ss.z}}if(ba<0){var os,ns,rs,_s,es,hs,ls=t;os=ls.x,ns=ls.y,rs=ls.z;var cs,ms,vs,bs,xs=s,ps=(cs=(_s=xs.x)-os)*os+(ms=(es=xs.y)-ns)*ns+(vs=(hs=xs.z)-rs)*rs;if((ps=-ps/(cs*cs+ms*ms+vs*vs))<0){var fs=o;fs.x=os,fs.y=ns,fs.z=rs,bs=1}else if(ps>1){var us=o;us.x=_s,us.y=es,us.z=hs,bs=2}else{var ys,Xs,gs;ys=os+cs*ps,Xs=ns+ms*ps,gs=rs+vs*ps;var zs=o;zs.x=ys,zs.y=Xs,zs.z=gs,bs=3}var ds=o.x*o.x+o.y*o.y+o.z*o.z;if(xa<0||ds<xa){pa=1&bs|(2&bs)<<1,xa=ds;var Ys=o;ha=Ys.x,la=Ys.y,ca=Ys.z}}if(xa>0){var Zs=o;Zs.x=ha,Zs.y=la,Zs.z=ca,ma=pa}else{var Ms=na*na+ra*ra+_a*_a;Ms>0&&(Ms=1/Math.sqrt(Ms));var Is=(na*=Ms)*na+(ra*=Ms)*ra+(_a*=Ms)*_a;ha=na*(Is=(Ri*na+qi*ra+Ei*_a)/Is),la=ra*Is,ca=_a*Is;var Vs=o;Vs.x=ha,Vs.y=la,Vs.z=ca,ma=7}var Ls=o.x*o.x+o.y*o.y+o.z*o.z;if(G<0||Ls<G){J=1&ma|(6&ma)<<1,G=Ls;var ws=o;R=ws.x,q=ws.y,E=ws.z}}if(N*D<0){var ks,Bs,As,Ps,Ss,Ts,Cs,js,Rs,qs,Es,Ds,Fs,Ns,Ws,Gs,Js,Os,Hs=t;ks=Hs.x,Bs=Hs.y,As=Hs.z;var Us=i;Ps=Us.x,Ss=Us.y,Ts=Us.z;var Qs,Ks,$s,to=s;Cs=to.x;var io,ao,so,oo,no=Ps*((Ns=(js=to.y)-Ss)*($s=(qs=Ps-ks)*Ns-(Es=Ss-Bs)*(Fs=Cs-Ps))-(Ws=(Rs=to.z)-Ts)*(Ks=(Ds=Ts-As)*Fs-qs*Ws))+Ss*(Ws*(Qs=Es*Ws-Ds*Ns)-Fs*$s)+Ts*(Fs*Ks-Ns*Qs),ro=Cs*((Js=Bs-js)*$s-(Os=As-Rs)*Ks)+js*(Os*Qs-(Gs=ks-Cs)*$s)+Rs*(Gs*Ks-Js*Qs),_o=-1,eo=0;if(io=0,ao=0,so=0,ks*(Es*$s-Ds*Ks)+Bs*(Ds*Qs-qs*$s)+As*(qs*Ks-Es*Qs)<0){var ho,lo,co,mo,vo,bo,xo=t;ho=xo.x,lo=xo.y,co=xo.z;var po,fo,uo,yo,Xo=i,go=(po=(mo=Xo.x)-ho)*ho+(fo=(vo=Xo.y)-lo)*lo+(uo=(bo=Xo.z)-co)*co;if((go=-go/(po*po+fo*fo+uo*uo))<0){var zo=o;zo.x=ho,zo.y=lo,zo.z=co,yo=1}else if(go>1){var Yo=o;Yo.x=mo,Yo.y=vo,Yo.z=bo,yo=2}else{var Zo,Mo,Io;Zo=ho+po*go,Mo=lo+fo*go,Io=co+uo*go;var Vo=o;Vo.x=Zo,Vo.y=Mo,Vo.z=Io,yo=3}eo=yo,_o=o.x*o.x+o.y*o.y+o.z*o.z;var Lo=o;io=Lo.x,ao=Lo.y,so=Lo.z}if(no<0){var wo,ko,Bo,Ao,Po,So,To=i;wo=To.x,ko=To.y,Bo=To.z;var Co,jo,Ro,qo,Eo=s,Do=(Co=(Ao=Eo.x)-wo)*wo+(jo=(Po=Eo.y)-ko)*ko+(Ro=(So=Eo.z)-Bo)*Bo;if((Do=-Do/(Co*Co+jo*jo+Ro*Ro))<0){var Fo=o;Fo.x=wo,Fo.y=ko,Fo.z=Bo,qo=1}else if(Do>1){var No=o;No.x=Ao,No.y=Po,No.z=So,qo=2}else{var Wo,Go,Jo;Wo=wo+Co*Do,Go=ko+jo*Do,Jo=Bo+Ro*Do;var Oo=o;Oo.x=Wo,Oo.y=Go,Oo.z=Jo,qo=3}var Ho=o.x*o.x+o.y*o.y+o.z*o.z;if(_o<0||Ho<_o){eo=qo<<1,_o=Ho;var Uo=o;io=Uo.x,ao=Uo.y,so=Uo.z}}if(ro<0){var Qo,Ko,$o,tn,an,sn,on=t;Qo=on.x,Ko=on.y,$o=on.z;var nn,rn,_n,en,hn=s,ln=(nn=(tn=hn.x)-Qo)*Qo+(rn=(an=hn.y)-Ko)*Ko+(_n=(sn=hn.z)-$o)*$o;if((ln=-ln/(nn*nn+rn*rn+_n*_n))<0){var cn=o;cn.x=Qo,cn.y=Ko,cn.z=$o,en=1}else if(ln>1){var mn=o;mn.x=tn,mn.y=an,mn.z=sn,en=2}else{var vn,bn,xn;vn=Qo+nn*ln,bn=Ko+rn*ln,xn=$o+_n*ln;var pn=o;pn.x=vn,pn.y=bn,pn.z=xn,en=3}var fn=o.x*o.x+o.y*o.y+o.z*o.z;if(_o<0||fn<_o){eo=1&en|(2&en)<<1,_o=fn;var un=o;io=un.x,ao=un.y,so=un.z}}if(_o>0){var yn=o;yn.x=io,yn.y=ao,yn.z=so,oo=eo}else{var Xn=Qs*Qs+Ks*Ks+$s*$s;Xn>0&&(Xn=1/Math.sqrt(Xn));var gn=(Qs*=Xn)*Qs+(Ks*=Xn)*Ks+($s*=Xn)*$s;io=Qs*(gn=(ks*Qs+Bs*Ks+As*$s)/gn),ao=Ks*gn,so=$s*gn;var zn=o;zn.x=io,zn.y=ao,zn.z=so,oo=7}var dn=o.x*o.x+o.y*o.y+o.z*o.z;if(G<0||dn<G){J=3&oo|(4&oo)<<1,G=dn;var Yn=o;R=Yn.x,q=Yn.y,E=Yn.z}}if(W*D<0){var Zn,Mn,In,Vn,Ln,wn,kn,Bn,An,Pn,Sn,Tn,Cn,jn,Rn,qn,En,Dn,Fn=i;Zn=Fn.x,Mn=Fn.y,In=Fn.z;var Nn=a;Vn=Nn.x,Ln=Nn.y,wn=Nn.z;var Wn,Gn,Jn,On=s;kn=On.x;var Hn,Un,Qn,Kn,$n=Vn*((jn=(Bn=On.y)-Ln)*(Jn=(Pn=Vn-Zn)*jn-(Sn=Ln-Mn)*(Cn=kn-Vn))-(Rn=(An=On.z)-wn)*(Gn=(Tn=wn-In)*Cn-Pn*Rn))+Ln*(Rn*(Wn=Sn*Rn-Tn*jn)-Cn*Jn)+wn*(Cn*Gn-jn*Wn),tr=kn*((En=Mn-Bn)*Jn-(Dn=In-An)*Gn)+Bn*(Dn*Wn-(qn=Zn-kn)*Jn)+An*(qn*Gn-En*Wn),ir=-1,ar=0;if(Hn=0,Un=0,Qn=0,Zn*(Sn*Jn-Tn*Gn)+Mn*(Tn*Wn-Pn*Jn)+In*(Pn*Gn-Sn*Wn)<0){var sr,or,nr,rr,_r,er,hr=i;sr=hr.x,or=hr.y,nr=hr.z;var lr,cr,mr,vr,br=a,xr=(lr=(rr=br.x)-sr)*sr+(cr=(_r=br.y)-or)*or+(mr=(er=br.z)-nr)*nr;if((xr=-xr/(lr*lr+cr*cr+mr*mr))<0){var pr=o;pr.x=sr,pr.y=or,pr.z=nr,vr=1}else if(xr>1){var fr=o;fr.x=rr,fr.y=_r,fr.z=er,vr=2}else{var ur,yr,Xr;ur=sr+lr*xr,yr=or+cr*xr,Xr=nr+mr*xr;var gr=o;gr.x=ur,gr.y=yr,gr.z=Xr,vr=3}ar=vr,ir=o.x*o.x+o.y*o.y+o.z*o.z;var zr=o;Hn=zr.x,Un=zr.y,Qn=zr.z}if($n<0){var dr,Yr,Zr,Mr,Ir,Vr,Lr=a;dr=Lr.x,Yr=Lr.y,Zr=Lr.z;var wr,kr,Br,Ar,Pr=s,Sr=(wr=(Mr=Pr.x)-dr)*dr+(kr=(Ir=Pr.y)-Yr)*Yr+(Br=(Vr=Pr.z)-Zr)*Zr;if((Sr=-Sr/(wr*wr+kr*kr+Br*Br))<0){var Tr=o;Tr.x=dr,Tr.y=Yr,Tr.z=Zr,Ar=1}else if(Sr>1){var Cr=o;Cr.x=Mr,Cr.y=Ir,Cr.z=Vr,Ar=2}else{var jr,Rr,qr;jr=dr+wr*Sr,Rr=Yr+kr*Sr,qr=Zr+Br*Sr;var Er=o;Er.x=jr,Er.y=Rr,Er.z=qr,Ar=3}var Dr=o.x*o.x+o.y*o.y+o.z*o.z;if(ir<0||Dr<ir){ar=Ar<<1,ir=Dr;var Fr=o;Hn=Fr.x,Un=Fr.y,Qn=Fr.z}}if(tr<0){var Nr,Wr,Gr,Jr,Or,Hr,Ur=i;Nr=Ur.x,Wr=Ur.y,Gr=Ur.z;var Qr,Kr,$r,t_,i_=s,a_=(Qr=(Jr=i_.x)-Nr)*Nr+(Kr=(Or=i_.y)-Wr)*Wr+($r=(Hr=i_.z)-Gr)*Gr;if((a_=-a_/(Qr*Qr+Kr*Kr+$r*$r))<0){var s_=o;s_.x=Nr,s_.y=Wr,s_.z=Gr,t_=1}else if(a_>1){var o_=o;o_.x=Jr,o_.y=Or,o_.z=Hr,t_=2}else{var n_,r_,__;n_=Nr+Qr*a_,r_=Wr+Kr*a_,__=Gr+$r*a_;var e_=o;e_.x=n_,e_.y=r_,e_.z=__,t_=3}var h_=o.x*o.x+o.y*o.y+o.z*o.z;if(ir<0||h_<ir){ar=1&t_|(2&t_)<<1,ir=h_;var l_=o;Hn=l_.x,Un=l_.y,Qn=l_.z}}if(ir>0){var c_=o;c_.x=Hn,c_.y=Un,c_.z=Qn,Kn=ar}else{var m_=Wn*Wn+Gn*Gn+Jn*Jn;m_>0&&(m_=1/Math.sqrt(m_));var v_=(Wn*=m_)*Wn+(Gn*=m_)*Gn+(Jn*=m_)*Jn;Hn=Wn*(v_=(Zn*Wn+Mn*Gn+In*Jn)/v_),Un=Gn*v_,Qn=Jn*v_;var b_=o;b_.x=Hn,b_.y=Un,b_.z=Qn,Kn=7}var x_=o.x*o.x+o.y*o.y+o.z*o.z;if(G<0||x_<G){J=Kn<<1,G=x_;var p_=o;R=p_.x,q=p_.y,E=p_.z}}if(G>0){var f_=o;return f_.x=R,f_.y=q,f_.z=E,J}return o.zero(),15}},t.common.Mat3=class{constructor(i,a,s,o,n,r,_,e,h){null==h&&(h=1),null==e&&(e=0),null==_&&(_=0),null==r&&(r=0),null==n&&(n=1),null==o&&(o=0),null==s&&(s=0),null==a&&(a=0),null==i&&(i=1),this.e00=i,this.e01=a,this.e02=s,this.e10=o,this.e11=n,this.e12=r,this.e20=_,this.e21=e,this.e22=h,t.common.Mat3.numCreations++}init(t,i,a,s,o,n,r,_,e){return this.e00=t,this.e01=i,this.e02=a,this.e10=s,this.e11=o,this.e12=n,this.e20=r,this.e21=_,this.e22=e,this}identity(){return this.e00=1,this.e01=0,this.e02=0,this.e10=0,this.e11=1,this.e12=0,this.e20=0,this.e21=0,this.e22=1,this}add(i){return new t.common.Mat3(this.e00+i.e00,this.e01+i.e01,this.e02+i.e02,this.e10+i.e10,this.e11+i.e11,this.e12+i.e12,this.e20+i.e20,this.e21+i.e21,this.e22+i.e22)}sub(i){return new t.common.Mat3(this.e00-i.e00,this.e01-i.e01,this.e02-i.e02,this.e10-i.e10,this.e11-i.e11,this.e12-i.e12,this.e20-i.e20,this.e21-i.e21,this.e22-i.e22)}scale(i){return new t.common.Mat3(this.e00*i,this.e01*i,this.e02*i,this.e10*i,this.e11*i,this.e12*i,this.e20*i,this.e21*i,this.e22*i)}mul(i){return new t.common.Mat3(this.e00*i.e00+this.e01*i.e10+this.e02*i.e20,this.e00*i.e01+this.e01*i.e11+this.e02*i.e21,this.e00*i.e02+this.e01*i.e12+this.e02*i.e22,this.e10*i.e00+this.e11*i.e10+this.e12*i.e20,this.e10*i.e01+this.e11*i.e11+this.e12*i.e21,this.e10*i.e02+this.e11*i.e12+this.e12*i.e22,this.e20*i.e00+this.e21*i.e10+this.e22*i.e20,this.e20*i.e01+this.e21*i.e11+this.e22*i.e21,this.e20*i.e02+this.e21*i.e12+this.e22*i.e22)}addEq(t){var i=this.e00+t.e00,a=this.e01+t.e01,s=this.e02+t.e02,o=this.e10+t.e10,n=this.e11+t.e11,r=this.e12+t.e12,_=this.e20+t.e20,e=this.e21+t.e21,h=this.e22+t.e22;return this.e00=i,this.e01=a,this.e02=s,this.e10=o,this.e11=n,this.e12=r,this.e20=_,this.e21=e,this.e22=h,this}subEq(t){var i=this.e00-t.e00,a=this.e01-t.e01,s=this.e02-t.e02,o=this.e10-t.e10,n=this.e11-t.e11,r=this.e12-t.e12,_=this.e20-t.e20,e=this.e21-t.e21,h=this.e22-t.e22;return this.e00=i,this.e01=a,this.e02=s,this.e10=o,this.e11=n,this.e12=r,this.e20=_,this.e21=e,this.e22=h,this}scaleEq(t){var i=this.e00*t,a=this.e01*t,s=this.e02*t,o=this.e10*t,n=this.e11*t,r=this.e12*t,_=this.e20*t,e=this.e21*t,h=this.e22*t;return this.e00=i,this.e01=a,this.e02=s,this.e10=o,this.e11=n,this.e12=r,this.e20=_,this.e21=e,this.e22=h,this}mulEq(t){var i=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,a=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,s=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,o=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,n=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,r=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,_=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,e=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,h=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22;return this.e00=i,this.e01=a,this.e02=s,this.e10=o,this.e11=n,this.e12=r,this.e20=_,this.e21=e,this.e22=h,this}prependScale(i,a,s){return new t.common.Mat3(this.e00*i,this.e01*i,this.e02*i,this.e10*a,this.e11*a,this.e12*a,this.e20*s,this.e21*s,this.e22*s)}appendScale(i,a,s){return new t.common.Mat3(this.e00*i,this.e01*a,this.e02*s,this.e10*i,this.e11*a,this.e12*s,this.e20*i,this.e21*a,this.e22*s)}prependRotation(i,a,s,o){var n=Math.sin(i),r=Math.cos(i),_=1-r,e=a*a*_+r,h=a*s*_-o*n,l=a*o*_+s*n,c=s*a*_+o*n,m=s*s*_+r,v=s*o*_-a*n,b=o*a*_-s*n,x=o*s*_+a*n,p=o*o*_+r;return new t.common.Mat3(e*this.e00+h*this.e10+l*this.e20,e*this.e01+h*this.e11+l*this.e21,e*this.e02+h*this.e12+l*this.e22,c*this.e00+m*this.e10+v*this.e20,c*this.e01+m*this.e11+v*this.e21,c*this.e02+m*this.e12+v*this.e22,b*this.e00+x*this.e10+p*this.e20,b*this.e01+x*this.e11+p*this.e21,b*this.e02+x*this.e12+p*this.e22)}appendRotation(i,a,s,o){var n=Math.sin(i),r=Math.cos(i),_=1-r,e=a*a*_+r,h=a*s*_-o*n,l=a*o*_+s*n,c=s*a*_+o*n,m=s*s*_+r,v=s*o*_-a*n,b=o*a*_-s*n,x=o*s*_+a*n,p=o*o*_+r;return new t.common.Mat3(this.e00*e+this.e01*c+this.e02*b,this.e00*h+this.e01*m+this.e02*x,this.e00*l+this.e01*v+this.e02*p,this.e10*e+this.e11*c+this.e12*b,this.e10*h+this.e11*m+this.e12*x,this.e10*l+this.e11*v+this.e12*p,this.e20*e+this.e21*c+this.e22*b,this.e20*h+this.e21*m+this.e22*x,this.e20*l+this.e21*v+this.e22*p)}prependScaleEq(t,i,a){var s=this.e00*t,o=this.e01*t,n=this.e02*t,r=this.e10*i,_=this.e11*i,e=this.e12*i,h=this.e20*a,l=this.e21*a,c=this.e22*a;return this.e00=s,this.e01=o,this.e02=n,this.e10=r,this.e11=_,this.e12=e,this.e20=h,this.e21=l,this.e22=c,this}appendScaleEq(t,i,a){var s=this.e00*t,o=this.e01*i,n=this.e02*a,r=this.e10*t,_=this.e11*i,e=this.e12*a,h=this.e20*t,l=this.e21*i,c=this.e22*a;return this.e00=s,this.e01=o,this.e02=n,this.e10=r,this.e11=_,this.e12=e,this.e20=h,this.e21=l,this.e22=c,this}prependRotationEq(t,i,a,s){var o=Math.sin(t),n=Math.cos(t),r=1-n,_=i*i*r+n,e=i*a*r-s*o,h=i*s*r+a*o,l=a*i*r+s*o,c=a*a*r+n,m=a*s*r-i*o,v=s*i*r-a*o,b=s*a*r+i*o,x=s*s*r+n,p=_*this.e00+e*this.e10+h*this.e20,f=_*this.e01+e*this.e11+h*this.e21,u=_*this.e02+e*this.e12+h*this.e22,y=l*this.e00+c*this.e10+m*this.e20,X=l*this.e01+c*this.e11+m*this.e21,g=l*this.e02+c*this.e12+m*this.e22,z=v*this.e00+b*this.e10+x*this.e20,d=v*this.e01+b*this.e11+x*this.e21,Y=v*this.e02+b*this.e12+x*this.e22;return this.e00=p,this.e01=f,this.e02=u,this.e10=y,this.e11=X,this.e12=g,this.e20=z,this.e21=d,this.e22=Y,this}appendRotationEq(t,i,a,s){var o=Math.sin(t),n=Math.cos(t),r=1-n,_=i*i*r+n,e=i*a*r-s*o,h=i*s*r+a*o,l=a*i*r+s*o,c=a*a*r+n,m=a*s*r-i*o,v=s*i*r-a*o,b=s*a*r+i*o,x=s*s*r+n,p=this.e00*_+this.e01*l+this.e02*v,f=this.e00*e+this.e01*c+this.e02*b,u=this.e00*h+this.e01*m+this.e02*x,y=this.e10*_+this.e11*l+this.e12*v,X=this.e10*e+this.e11*c+this.e12*b,g=this.e10*h+this.e11*m+this.e12*x,z=this.e20*_+this.e21*l+this.e22*v,d=this.e20*e+this.e21*c+this.e22*b,Y=this.e20*h+this.e21*m+this.e22*x;return this.e00=p,this.e01=f,this.e02=u,this.e10=y,this.e11=X,this.e12=g,this.e20=z,this.e21=d,this.e22=Y,this}transpose(){return new t.common.Mat3(this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22)}transposeEq(){var t=this.e00,i=this.e10,a=this.e20,s=this.e01,o=this.e11,n=this.e21,r=this.e02,_=this.e12,e=this.e22;return this.e00=t,this.e01=i,this.e02=a,this.e10=s,this.e11=o,this.e12=n,this.e20=r,this.e21=_,this.e22=e,this}determinant(){return this.e00*(this.e11*this.e22-this.e12*this.e21)-this.e01*(this.e10*this.e22-this.e12*this.e20)+this.e02*(this.e10*this.e21-this.e11*this.e20)}trace(){return this.e00+this.e11+this.e22}inverse(){var i=this.e11*this.e22-this.e12*this.e21,a=this.e10*this.e22-this.e12*this.e20,s=this.e10*this.e21-this.e11*this.e20,o=this.e01*this.e22-this.e02*this.e21,n=this.e00*this.e22-this.e02*this.e20,r=this.e00*this.e21-this.e01*this.e20,_=this.e01*this.e12-this.e02*this.e11,e=this.e00*this.e12-this.e02*this.e10,h=this.e00*this.e11-this.e01*this.e10,l=this.e00*i-this.e01*a+this.e02*s;return 0!=l&&(l=1/l),new t.common.Mat3(i*l,-o*l,_*l,-a*l,n*l,-e*l,s*l,-r*l,h*l)}inverseEq(){var t=this.e11*this.e22-this.e12*this.e21,i=this.e10*this.e22-this.e12*this.e20,a=this.e10*this.e21-this.e11*this.e20,s=this.e01*this.e22-this.e02*this.e21,o=this.e00*this.e22-this.e02*this.e20,n=this.e00*this.e21-this.e01*this.e20,r=this.e01*this.e12-this.e02*this.e11,_=this.e00*this.e12-this.e02*this.e10,e=this.e00*this.e11-this.e01*this.e10,h=this.e00*t-this.e01*i+this.e02*a;0!=h&&(h=1/h);var l=t*h,c=-s*h,m=r*h,v=-i*h,b=o*h,x=-_*h,p=a*h,f=-n*h,u=e*h;return this.e00=l,this.e01=c,this.e02=m,this.e10=v,this.e11=b,this.e12=x,this.e20=p,this.e21=f,this.e22=u,this}toArray(t){return null==t&&(t=!1),t?[this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22]:[this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22]}copyFrom(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this}clone(){return new t.common.Mat3(this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22)}fromQuat(t){var i=t.x,a=t.y,s=t.z,o=t.w,n=2*i,r=2*a,_=2*s,e=i*n,h=a*r,l=s*_,c=i*r,m=a*_,v=i*_,b=o*n,x=o*r,p=o*_;return this.e00=1-h-l,this.e01=c-p,this.e02=v+x,this.e10=c+p,this.e11=1-e-l,this.e12=m-b,this.e20=v-x,this.e21=m+b,this.e22=1-e-h,this}toQuat(){var i,a=new t.common.Quat,s=this.e00,o=this.e11,n=this.e22,r=s+o+n;return r>0?(i=Math.sqrt(r+1),a.w=.5*i,i=.5/i,a.x=(this.e21-this.e12)*i,a.y=(this.e02-this.e20)*i,a.z=(this.e10-this.e01)*i):s>o?s>n?(i=Math.sqrt(s-o-n+1),a.x=.5*i,i=.5/i,a.y=(this.e01+this.e10)*i,a.z=(this.e02+this.e20)*i,a.w=(this.e21-this.e12)*i):(i=Math.sqrt(n-s-o+1),a.z=.5*i,i=.5/i,a.x=(this.e02+this.e20)*i,a.y=(this.e12+this.e21)*i,a.w=(this.e10-this.e01)*i):o>n?(i=Math.sqrt(o-n-s+1),a.y=.5*i,i=.5/i,a.x=(this.e01+this.e10)*i,a.z=(this.e12+this.e21)*i,a.w=(this.e02-this.e20)*i):(i=Math.sqrt(n-s-o+1),a.z=.5*i,i=.5/i,a.x=(this.e02+this.e20)*i,a.y=(this.e12+this.e21)*i,a.w=(this.e10-this.e01)*i),a}fromEulerXyz(t){var i=Math.sin(t.x),a=Math.sin(t.y),s=Math.sin(t.z),o=Math.cos(t.x),n=Math.cos(t.y),r=Math.cos(t.z),_=n*r,e=-n*s,h=a,l=o*s+r*i*a,c=o*r-i*a*s,m=-n*i,v=i*s-o*r*a,b=r*i+o*a*s,x=o*n;return this.e00=_,this.e01=e,this.e02=h,this.e10=l,this.e11=c,this.e12=m,this.e20=v,this.e21=b,this.e22=x,this}toEulerXyz(){var i=this.e02;if(i<=-1){var a=Math.atan2(this.e21,this.e11);return new t.common.Vec3(.5*a,-1.570796326794895,.5*-a)}if(i>=1){var s=Math.atan2(this.e21,this.e11);return new t.common.Vec3(.5*s,1.570796326794895,.5*s)}var o=Math.asin(i),n=Math.atan2(-this.e12,this.e22),r=Math.atan2(-this.e01,this.e00);return new t.common.Vec3(n,o,r)}getRow(i){return 0==i?new t.common.Vec3(this.e00,this.e01,this.e02):1==i?new t.common.Vec3(this.e10,this.e11,this.e12):2==i?new t.common.Vec3(this.e20,this.e21,this.e22):null}getCol(i){return 0==i?new t.common.Vec3(this.e00,this.e10,this.e20):1==i?new t.common.Vec3(this.e01,this.e11,this.e21):2==i?new t.common.Vec3(this.e02,this.e12,this.e22):null}getRowTo(t,i){0==t?i.init(this.e00,this.e01,this.e02):1==t?i.init(this.e10,this.e11,this.e12):2==t?i.init(this.e20,this.e21,this.e22):i.zero()}getColTo(t,i){0==t?i.init(this.e00,this.e10,this.e20):1==t?i.init(this.e01,this.e11,this.e21):2==t?i.init(this.e02,this.e12,this.e22):i.zero()}fromRows(t,i,a){var s=t.x,o=t.y,n=t.z,r=i.x,_=i.y,e=i.z,h=a.x,l=a.y,c=a.z;return this.e00=s,this.e01=o,this.e02=n,this.e10=r,this.e11=_,this.e12=e,this.e20=h,this.e21=l,this.e22=c,this}fromCols(t,i,a){var s=t.x,o=i.x,n=a.x,r=t.y,_=i.y,e=a.y,h=t.z,l=i.z,c=a.z;return this.e00=s,this.e01=o,this.e02=n,this.e10=r,this.e11=_,this.e12=e,this.e20=h,this.e21=l,this.e22=c,this}toString(){return"Mat3["+(this.e00>0?(1e7*this.e00+.5|0)/1e7:(1e7*this.e00-.5|0)/1e7)+", "+(this.e01>0?(1e7*this.e01+.5|0)/1e7:(1e7*this.e01-.5|0)/1e7)+", "+(this.e02>0?(1e7*this.e02+.5|0)/1e7:(1e7*this.e02-.5|0)/1e7)+",\n     "+(this.e10>0?(1e7*this.e10+.5|0)/1e7:(1e7*this.e10-.5|0)/1e7)+", "+(this.e11>0?(1e7*this.e11+.5|0)/1e7:(1e7*this.e11-.5|0)/1e7)+", "+(this.e12>0?(1e7*this.e12+.5|0)/1e7:(1e7*this.e12-.5|0)/1e7)+",\n     "+(this.e20>0?(1e7*this.e20+.5|0)/1e7:(1e7*this.e20-.5|0)/1e7)+", "+(this.e21>0?(1e7*this.e21+.5|0)/1e7:(1e7*this.e21-.5|0)/1e7)+", "+(this.e22>0?(1e7*this.e22+.5|0)/1e7:(1e7*this.e22-.5|0)/1e7)+"]"}},t.common.Mat4=class{constructor(i,a,s,o,n,r,_,e,h,l,c,m,v,b,x,p){null==p&&(p=1),null==x&&(x=0),null==b&&(b=0),null==v&&(v=0),null==m&&(m=0),null==c&&(c=1),null==l&&(l=0),null==h&&(h=0),null==e&&(e=0),null==_&&(_=0),null==r&&(r=1),null==n&&(n=0),null==o&&(o=0),null==s&&(s=0),null==a&&(a=0),null==i&&(i=1),this.e00=i,this.e01=a,this.e02=s,this.e03=o,this.e10=n,this.e11=r,this.e12=_,this.e13=e,this.e20=h,this.e21=l,this.e22=c,this.e23=m,this.e30=v,this.e31=b,this.e32=x,this.e33=p,t.common.Mat4.numCreations++}init(t,i,a,s,o,n,r,_,e,h,l,c,m,v,b,x){return this.e00=t,this.e01=i,this.e02=a,this.e03=s,this.e10=o,this.e11=n,this.e12=r,this.e13=_,this.e20=e,this.e21=h,this.e22=l,this.e23=c,this.e30=m,this.e31=v,this.e32=b,this.e33=x,this}identity(){return this.e00=1,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=1,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=1,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}add(i){return new t.common.Mat4(this.e00+i.e00,this.e01+i.e01,this.e02+i.e02,this.e03+i.e03,this.e10+i.e10,this.e11+i.e11,this.e12+i.e12,this.e13+i.e13,this.e20+i.e20,this.e21+i.e21,this.e22+i.e22,this.e23+i.e23,this.e30+i.e30,this.e31+i.e31,this.e32+i.e32,this.e33+i.e33)}sub(i){return new t.common.Mat4(this.e00-i.e00,this.e01-i.e01,this.e02-i.e02,this.e03-i.e03,this.e10-i.e10,this.e11-i.e11,this.e12-i.e12,this.e13-i.e13,this.e20-i.e20,this.e21-i.e21,this.e22-i.e22,this.e23-i.e23,this.e30-i.e30,this.e31-i.e31,this.e32-i.e32,this.e33-i.e33)}scale(i){return new t.common.Mat4(this.e00*i,this.e01*i,this.e02*i,this.e03*i,this.e10*i,this.e11*i,this.e12*i,this.e13*i,this.e20*i,this.e21*i,this.e22*i,this.e23*i,this.e30*i,this.e31*i,this.e32*i,this.e33*i)}mul(i){return new t.common.Mat4(this.e00*i.e00+this.e01*i.e10+this.e02*i.e20+this.e03*i.e30,this.e00*i.e01+this.e01*i.e11+this.e02*i.e21+this.e03*i.e31,this.e00*i.e02+this.e01*i.e12+this.e02*i.e22+this.e03*i.e32,this.e00*i.e03+this.e01*i.e13+this.e02*i.e23+this.e03*i.e33,this.e10*i.e00+this.e11*i.e10+this.e12*i.e20+this.e13*i.e30,this.e10*i.e01+this.e11*i.e11+this.e12*i.e21+this.e13*i.e31,this.e10*i.e02+this.e11*i.e12+this.e12*i.e22+this.e13*i.e32,this.e10*i.e03+this.e11*i.e13+this.e12*i.e23+this.e13*i.e33,this.e20*i.e00+this.e21*i.e10+this.e22*i.e20+this.e23*i.e30,this.e20*i.e01+this.e21*i.e11+this.e22*i.e21+this.e23*i.e31,this.e20*i.e02+this.e21*i.e12+this.e22*i.e22+this.e23*i.e32,this.e20*i.e03+this.e21*i.e13+this.e22*i.e23+this.e23*i.e33,this.e30*i.e00+this.e31*i.e10+this.e32*i.e20+this.e33*i.e30,this.e30*i.e01+this.e31*i.e11+this.e32*i.e21+this.e33*i.e31,this.e30*i.e02+this.e31*i.e12+this.e32*i.e22+this.e33*i.e32,this.e30*i.e03+this.e31*i.e13+this.e32*i.e23+this.e33*i.e33)}addEq(t){var i=this.e00+t.e00,a=this.e01+t.e01,s=this.e02+t.e02,o=this.e03+t.e03,n=this.e10+t.e10,r=this.e11+t.e11,_=this.e12+t.e12,e=this.e13+t.e13,h=this.e20+t.e20,l=this.e21+t.e21,c=this.e22+t.e22,m=this.e23+t.e23,v=this.e30+t.e30,b=this.e31+t.e31,x=this.e32+t.e32,p=this.e33+t.e33;return this.e00=i,this.e01=a,this.e02=s,this.e03=o,this.e10=n,this.e11=r,this.e12=_,this.e13=e,this.e20=h,this.e21=l,this.e22=c,this.e23=m,this.e30=v,this.e31=b,this.e32=x,this.e33=p,this}subEq(t){var i=this.e00-t.e00,a=this.e01-t.e01,s=this.e02-t.e02,o=this.e03-t.e03,n=this.e10-t.e10,r=this.e11-t.e11,_=this.e12-t.e12,e=this.e13-t.e13,h=this.e20-t.e20,l=this.e21-t.e21,c=this.e22-t.e22,m=this.e23-t.e23,v=this.e30-t.e30,b=this.e31-t.e31,x=this.e32-t.e32,p=this.e33-t.e33;return this.e00=i,this.e01=a,this.e02=s,this.e03=o,this.e10=n,this.e11=r,this.e12=_,this.e13=e,this.e20=h,this.e21=l,this.e22=c,this.e23=m,this.e30=v,this.e31=b,this.e32=x,this.e33=p,this}scaleEq(t){var i=this.e00*t,a=this.e01*t,s=this.e02*t,o=this.e03*t,n=this.e10*t,r=this.e11*t,_=this.e12*t,e=this.e13*t,h=this.e20*t,l=this.e21*t,c=this.e22*t,m=this.e23*t,v=this.e30*t,b=this.e31*t,x=this.e32*t,p=this.e33*t;return this.e00=i,this.e01=a,this.e02=s,this.e03=o,this.e10=n,this.e11=r,this.e12=_,this.e13=e,this.e20=h,this.e21=l,this.e22=c,this.e23=m,this.e30=v,this.e31=b,this.e32=x,this.e33=p,this}mulEq(t){var i=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,a=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,s=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,o=this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,n=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,r=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,_=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,e=this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,h=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,l=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,c=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,m=this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,v=this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,b=this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,x=this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,p=this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33;return this.e00=i,this.e01=a,this.e02=s,this.e03=o,this.e10=n,this.e11=r,this.e12=_,this.e13=e,this.e20=h,this.e21=l,this.e22=c,this.e23=m,this.e30=v,this.e31=b,this.e32=x,this.e33=p,this}prependScale(i,a,s){return new t.common.Mat4(this.e00*i,this.e01*i,this.e02*i,this.e03*i,this.e10*a,this.e11*a,this.e12*a,this.e13*a,this.e20*s,this.e21*s,this.e22*s,this.e23*s,this.e30,this.e31,this.e32,this.e33)}appendScale(i,a,s){return new t.common.Mat4(this.e00*i,this.e01*a,this.e02*s,this.e03,this.e10*i,this.e11*a,this.e12*s,this.e13,this.e20*i,this.e21*a,this.e22*s,this.e23,this.e30*i,this.e31*a,this.e32*s,this.e33)}prependRotation(i,a,s,o){var n=Math.sin(i),r=Math.cos(i),_=1-r,e=a*a*_+r,h=a*s*_-o*n,l=a*o*_+s*n,c=s*a*_+o*n,m=s*s*_+r,v=s*o*_-a*n,b=o*a*_-s*n,x=o*s*_+a*n,p=o*o*_+r;return new t.common.Mat4(e*this.e00+h*this.e10+l*this.e20,e*this.e01+h*this.e11+l*this.e21,e*this.e02+h*this.e12+l*this.e22,e*this.e03+h*this.e13+l*this.e23,c*this.e00+m*this.e10+v*this.e20,c*this.e01+m*this.e11+v*this.e21,c*this.e02+m*this.e12+v*this.e22,c*this.e03+m*this.e13+v*this.e23,b*this.e00+x*this.e10+p*this.e20,b*this.e01+x*this.e11+p*this.e21,b*this.e02+x*this.e12+p*this.e22,b*this.e03+x*this.e13+p*this.e23,this.e30,this.e31,this.e32,this.e33)}appendRotation(i,a,s,o){var n=Math.sin(i),r=Math.cos(i),_=1-r,e=a*a*_+r,h=a*s*_-o*n,l=a*o*_+s*n,c=s*a*_+o*n,m=s*s*_+r,v=s*o*_-a*n,b=o*a*_-s*n,x=o*s*_+a*n,p=o*o*_+r;return new t.common.Mat4(this.e00*e+this.e01*c+this.e02*b,this.e00*h+this.e01*m+this.e02*x,this.e00*l+this.e01*v+this.e02*p,this.e03,this.e10*e+this.e11*c+this.e12*b,this.e10*h+this.e11*m+this.e12*x,this.e10*l+this.e11*v+this.e12*p,this.e13,this.e20*e+this.e21*c+this.e22*b,this.e20*h+this.e21*m+this.e22*x,this.e20*l+this.e21*v+this.e22*p,this.e23,this.e30*e+this.e31*c+this.e32*b,this.e30*h+this.e31*m+this.e32*x,this.e30*l+this.e31*v+this.e32*p,this.e33)}prependTranslation(i,a,s){return new t.common.Mat4(this.e00+i*this.e30,this.e01+i*this.e31,this.e02+i*this.e32,this.e03+i*this.e33,this.e10+a*this.e30,this.e11+a*this.e31,this.e12+a*this.e32,this.e13+a*this.e33,this.e20+s*this.e30,this.e21+s*this.e31,this.e22+s*this.e32,this.e23+s*this.e33,this.e30,this.e31,this.e32,this.e33)}appendTranslation(i,a,s){return new t.common.Mat4(this.e00,this.e01,this.e02,this.e00*i+this.e01*a+this.e02*s+this.e03,this.e10,this.e11,this.e12,this.e10*i+this.e11*a+this.e12*s+this.e13,this.e20,this.e21,this.e22,this.e20*i+this.e21*a+this.e22*s+this.e23,this.e30,this.e31,this.e32,this.e30*i+this.e31*a+this.e32*s+this.e33)}prependScaleEq(t,i,a){var s=this.e00*t,o=this.e01*t,n=this.e02*t,r=this.e03*t,_=this.e10*i,e=this.e11*i,h=this.e12*i,l=this.e13*i,c=this.e20*a,m=this.e21*a,v=this.e22*a,b=this.e23*a,x=this.e30,p=this.e31,f=this.e32,u=this.e33;return this.e00=s,this.e01=o,this.e02=n,this.e03=r,this.e10=_,this.e11=e,this.e12=h,this.e13=l,this.e20=c,this.e21=m,this.e22=v,this.e23=b,this.e30=x,this.e31=p,this.e32=f,this.e33=u,this}appendScaleEq(t,i,a){var s=this.e00*t,o=this.e01*i,n=this.e02*a,r=this.e03,_=this.e10*t,e=this.e11*i,h=this.e12*a,l=this.e13,c=this.e20*t,m=this.e21*i,v=this.e22*a,b=this.e23,x=this.e30*t,p=this.e31*i,f=this.e32*a,u=this.e33;return this.e00=s,this.e01=o,this.e02=n,this.e03=r,this.e10=_,this.e11=e,this.e12=h,this.e13=l,this.e20=c,this.e21=m,this.e22=v,this.e23=b,this.e30=x,this.e31=p,this.e32=f,this.e33=u,this}prependRotationEq(t,i,a,s){var o=Math.sin(t),n=Math.cos(t),r=1-n,_=i*i*r+n,e=i*a*r-s*o,h=i*s*r+a*o,l=a*i*r+s*o,c=a*a*r+n,m=a*s*r-i*o,v=s*i*r-a*o,b=s*a*r+i*o,x=s*s*r+n,p=_*this.e00+e*this.e10+h*this.e20,f=_*this.e01+e*this.e11+h*this.e21,u=_*this.e02+e*this.e12+h*this.e22,y=_*this.e03+e*this.e13+h*this.e23,X=l*this.e00+c*this.e10+m*this.e20,g=l*this.e01+c*this.e11+m*this.e21,z=l*this.e02+c*this.e12+m*this.e22,d=l*this.e03+c*this.e13+m*this.e23,Y=v*this.e00+b*this.e10+x*this.e20,Z=v*this.e01+b*this.e11+x*this.e21,M=v*this.e02+b*this.e12+x*this.e22,I=v*this.e03+b*this.e13+x*this.e23,V=this.e30,L=this.e31,w=this.e32,k=this.e33;return this.e00=p,this.e01=f,this.e02=u,this.e03=y,this.e10=X,this.e11=g,this.e12=z,this.e13=d,this.e20=Y,this.e21=Z,this.e22=M,this.e23=I,this.e30=V,this.e31=L,this.e32=w,this.e33=k,this}appendRotationEq(t,i,a,s){var o=Math.sin(t),n=Math.cos(t),r=1-n,_=i*i*r+n,e=i*a*r-s*o,h=i*s*r+a*o,l=a*i*r+s*o,c=a*a*r+n,m=a*s*r-i*o,v=s*i*r-a*o,b=s*a*r+i*o,x=s*s*r+n,p=this.e00*_+this.e01*l+this.e02*v,f=this.e00*e+this.e01*c+this.e02*b,u=this.e00*h+this.e01*m+this.e02*x,y=this.e03,X=this.e10*_+this.e11*l+this.e12*v,g=this.e10*e+this.e11*c+this.e12*b,z=this.e10*h+this.e11*m+this.e12*x,d=this.e13,Y=this.e20*_+this.e21*l+this.e22*v,Z=this.e20*e+this.e21*c+this.e22*b,M=this.e20*h+this.e21*m+this.e22*x,I=this.e23,V=this.e30*_+this.e31*l+this.e32*v,L=this.e30*e+this.e31*c+this.e32*b,w=this.e30*h+this.e31*m+this.e32*x,k=this.e33;return this.e00=p,this.e01=f,this.e02=u,this.e03=y,this.e10=X,this.e11=g,this.e12=z,this.e13=d,this.e20=Y,this.e21=Z,this.e22=M,this.e23=I,this.e30=V,this.e31=L,this.e32=w,this.e33=k,this}prependTranslationEq(t,i,a){var s=this.e00+t*this.e30,o=this.e01+t*this.e31,n=this.e02+t*this.e32,r=this.e03+t*this.e33,_=this.e10+i*this.e30,e=this.e11+i*this.e31,h=this.e12+i*this.e32,l=this.e13+i*this.e33,c=this.e20+a*this.e30,m=this.e21+a*this.e31,v=this.e22+a*this.e32,b=this.e23+a*this.e33,x=this.e30,p=this.e31,f=this.e32,u=this.e33;return this.e00=s,this.e01=o,this.e02=n,this.e03=r,this.e10=_,this.e11=e,this.e12=h,this.e13=l,this.e20=c,this.e21=m,this.e22=v,this.e23=b,this.e30=x,this.e31=p,this.e32=f,this.e33=u,this}appendTranslationEq(t,i,a){var s=this.e00,o=this.e01,n=this.e02,r=this.e00*t+this.e01*i+this.e02*a+this.e03,_=this.e10,e=this.e11,h=this.e12,l=this.e10*t+this.e11*i+this.e12*a+this.e13,c=this.e20,m=this.e21,v=this.e22,b=this.e20*t+this.e21*i+this.e22*a+this.e23,x=this.e30,p=this.e31,f=this.e32,u=this.e30*t+this.e31*i+this.e32*a+this.e33;return this.e00=s,this.e01=o,this.e02=n,this.e03=r,this.e10=_,this.e11=e,this.e12=h,this.e13=l,this.e20=c,this.e21=m,this.e22=v,this.e23=b,this.e30=x,this.e31=p,this.e32=f,this.e33=u,this}transpose(){return new t.common.Mat4(this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33)}transposeEq(){var t=this.e00,i=this.e10,a=this.e20,s=this.e30,o=this.e01,n=this.e11,r=this.e21,_=this.e31,e=this.e02,h=this.e12,l=this.e22,c=this.e32,m=this.e03,v=this.e13,b=this.e23,x=this.e33;return this.e00=t,this.e01=i,this.e02=a,this.e03=s,this.e10=o,this.e11=n,this.e12=r,this.e13=_,this.e20=e,this.e21=h,this.e22=l,this.e23=c,this.e30=m,this.e31=v,this.e32=b,this.e33=x,this}determinant(){var t=this.e20*this.e31-this.e21*this.e30,i=this.e20*this.e32-this.e22*this.e30,a=this.e20*this.e33-this.e23*this.e30,s=this.e21*this.e32-this.e22*this.e31,o=this.e21*this.e33-this.e23*this.e31,n=this.e22*this.e33-this.e23*this.e32;return this.e00*(this.e11*n-this.e12*o+this.e13*s)-this.e01*(this.e10*n-this.e12*a+this.e13*i)+this.e02*(this.e10*o-this.e11*a+this.e13*t)-this.e03*(this.e10*s-this.e11*i+this.e12*t)}trace(){return this.e00+this.e11+this.e22+this.e33}inverse(){var i=this.e00*this.e11-this.e01*this.e10,a=this.e00*this.e12-this.e02*this.e10,s=this.e00*this.e13-this.e03*this.e10,o=this.e01*this.e12-this.e02*this.e11,n=this.e01*this.e13-this.e03*this.e11,r=this.e02*this.e13-this.e03*this.e12,_=this.e20*this.e31-this.e21*this.e30,e=this.e20*this.e32-this.e22*this.e30,h=this.e20*this.e33-this.e23*this.e30,l=this.e21*this.e32-this.e22*this.e31,c=this.e21*this.e33-this.e23*this.e31,m=this.e22*this.e33-this.e23*this.e32,v=this.e11*m-this.e12*c+this.e13*l,b=this.e10*m-this.e12*h+this.e13*e,x=this.e10*c-this.e11*h+this.e13*_,p=this.e10*l-this.e11*e+this.e12*_,f=this.e01*m-this.e02*c+this.e03*l,u=this.e00*m-this.e02*h+this.e03*e,y=this.e00*c-this.e01*h+this.e03*_,X=this.e00*l-this.e01*e+this.e02*_,g=this.e31*r-this.e32*n+this.e33*o,z=this.e30*r-this.e32*s+this.e33*a,d=this.e30*n-this.e31*s+this.e33*i,Y=this.e30*o-this.e31*a+this.e32*i,Z=this.e21*r-this.e22*n+this.e23*o,M=this.e20*r-this.e22*s+this.e23*a,I=this.e20*n-this.e21*s+this.e23*i,V=this.e20*o-this.e21*a+this.e22*i,L=this.e00*v-this.e01*b+this.e02*x-this.e03*p;return 0!=L&&(L=1/L),new t.common.Mat4(v*L,-f*L,g*L,-Z*L,-b*L,u*L,-z*L,M*L,x*L,-y*L,d*L,-I*L,-p*L,X*L,-Y*L,V*L)}inverseEq(){var t=this.e00*this.e11-this.e01*this.e10,i=this.e00*this.e12-this.e02*this.e10,a=this.e00*this.e13-this.e03*this.e10,s=this.e01*this.e12-this.e02*this.e11,o=this.e01*this.e13-this.e03*this.e11,n=this.e02*this.e13-this.e03*this.e12,r=this.e20*this.e31-this.e21*this.e30,_=this.e20*this.e32-this.e22*this.e30,e=this.e20*this.e33-this.e23*this.e30,h=this.e21*this.e32-this.e22*this.e31,l=this.e21*this.e33-this.e23*this.e31,c=this.e22*this.e33-this.e23*this.e32,m=this.e11*c-this.e12*l+this.e13*h,v=this.e10*c-this.e12*e+this.e13*_,b=this.e10*l-this.e11*e+this.e13*r,x=this.e10*h-this.e11*_+this.e12*r,p=this.e01*c-this.e02*l+this.e03*h,f=this.e00*c-this.e02*e+this.e03*_,u=this.e00*l-this.e01*e+this.e03*r,y=this.e00*h-this.e01*_+this.e02*r,X=this.e31*n-this.e32*o+this.e33*s,g=this.e30*n-this.e32*a+this.e33*i,z=this.e30*o-this.e31*a+this.e33*t,d=this.e30*s-this.e31*i+this.e32*t,Y=this.e21*n-this.e22*o+this.e23*s,Z=this.e20*n-this.e22*a+this.e23*i,M=this.e20*o-this.e21*a+this.e23*t,I=this.e20*s-this.e21*i+this.e22*t,V=this.e00*m-this.e01*v+this.e02*b-this.e03*x;0!=V&&(V=1/V);var L=m*V,w=-p*V,k=X*V,B=-Y*V,A=-v*V,P=f*V,S=-g*V,T=Z*V,C=b*V,j=-u*V,R=z*V,q=-M*V,E=-x*V,D=y*V,F=-d*V,N=I*V;return this.e00=L,this.e01=w,this.e02=k,this.e03=B,this.e10=A,this.e11=P,this.e12=S,this.e13=T,this.e20=C,this.e21=j,this.e22=R,this.e23=q,this.e30=E,this.e31=D,this.e32=F,this.e33=N,this}lookAt(t,i,a,s,o,n,r,_,e){var h=t-s,l=i-o,c=a-n,m=1/Math.sqrt(h*h+l*l+c*c),v=_*(c*=m)-e*(l*=m),b=e*(h*=m)-r*c,x=r*l-_*h,p=l*(x*=m=1/Math.sqrt(v*v+b*b+x*x))-c*(b*=m),f=c*(v*=m)-h*x,u=h*b-l*v;return this.e00=v,this.e01=b,this.e02=x,this.e03=-(v*t+b*i+x*a),this.e10=p,this.e11=f,this.e12=u,this.e13=-(p*t+f*i+u*a),this.e20=h,this.e21=l,this.e22=c,this.e23=-(h*t+l*i+c*a),this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}perspective(t,i,a,s){var o=1/Math.tan(.5*t),n=s/(a-s);return this.e00=o/i,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=o,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=n,this.e23=a*n,this.e30=0,this.e31=0,this.e32=-1,this.e33=0,this}ortho(t,i,a,s){var o=1/(a-s);return this.e00=2/t,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=2/i,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=o,this.e23=a*o,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}toArray(t){return null==t&&(t=!1),t?[this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33]:[this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33]}copyFrom(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e03=t.e03,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e13=t.e13,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this.e23=t.e23,this.e30=t.e30,this.e31=t.e31,this.e32=t.e32,this.e33=t.e33,this}fromMat3(t){var i=t.e00,a=t.e01,s=t.e02,o=t.e10,n=t.e11,r=t.e12,_=t.e20,e=t.e21,h=t.e22;return this.e00=i,this.e01=a,this.e02=s,this.e03=0,this.e10=o,this.e11=n,this.e12=r,this.e13=0,this.e20=_,this.e21=e,this.e22=h,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}fromTransform(t){var i=this;return i.e00=t._rotation00,i.e01=t._rotation01,i.e02=t._rotation02,i.e10=t._rotation10,i.e11=t._rotation11,i.e12=t._rotation12,i.e20=t._rotation20,i.e21=t._rotation21,i.e22=t._rotation22,i.e03=t._positionX,i.e13=t._positionY,i.e23=t._positionZ,i.e30=0,i.e31=0,i.e32=0,i.e33=1,this}clone(){return new t.common.Mat4(this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33)}toString(){return"Mat4["+(this.e00>0?(1e7*this.e00+.5|0)/1e7:(1e7*this.e00-.5|0)/1e7)+", "+(this.e01>0?(1e7*this.e01+.5|0)/1e7:(1e7*this.e01-.5|0)/1e7)+", "+(this.e02>0?(1e7*this.e02+.5|0)/1e7:(1e7*this.e02-.5|0)/1e7)+", "+(this.e03>0?(1e7*this.e03+.5|0)/1e7:(1e7*this.e03-.5|0)/1e7)+",\n    "+(this.e10>0?(1e7*this.e10+.5|0)/1e7:(1e7*this.e10-.5|0)/1e7)+", "+(this.e11>0?(1e7*this.e11+.5|0)/1e7:(1e7*this.e11-.5|0)/1e7)+", "+(this.e12>0?(1e7*this.e12+.5|0)/1e7:(1e7*this.e12-.5|0)/1e7)+", "+(this.e13>0?(1e7*this.e13+.5|0)/1e7:(1e7*this.e13-.5|0)/1e7)+",\n    "+(this.e20>0?(1e7*this.e20+.5|0)/1e7:(1e7*this.e20-.5|0)/1e7)+", "+(this.e21>0?(1e7*this.e21+.5|0)/1e7:(1e7*this.e21-.5|0)/1e7)+", "+(this.e22>0?(1e7*this.e22+.5|0)/1e7:(1e7*this.e22-.5|0)/1e7)+", "+(this.e23>0?(1e7*this.e23+.5|0)/1e7:(1e7*this.e23-.5|0)/1e7)+",\n    "+(this.e30>0?(1e7*this.e30+.5|0)/1e7:(1e7*this.e30-.5|0)/1e7)+", "+(this.e31>0?(1e7*this.e31+.5|0)/1e7:(1e7*this.e31-.5|0)/1e7)+", "+(this.e32>0?(1e7*this.e32+.5|0)/1e7:(1e7*this.e32-.5|0)/1e7)+", "+(this.e33>0?(1e7*this.e33+.5|0)/1e7:(1e7*this.e33-.5|0)/1e7)+"]"}},t.common.MathUtil=class{static abs(t){return t>0?t:-t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static tan(t){return Math.tan(t)}static asin(t){return Math.asin(t)}static acos(t){return Math.acos(t)}static atan(t){return Math.atan(t)}static safeAsin(t){return t<=-1?-1.570796326794895:t>=1?1.570796326794895:Math.asin(t)}static safeAcos(t){return t<=-1?3.14159265358979:t>=1?0:Math.acos(t)}static atan2(t,i){return Math.atan2(t,i)}static sqrt(t){return Math.sqrt(t)}static clamp(t,i,a){return t<i?i:t>a?a:t}static rand(){return Math.random()}static randIn(t,i){return t+Math.random()*(i-t)}static randVec3In(i,a){return new t.common.Vec3(i+Math.random()*(a-i),i+Math.random()*(a-i),i+Math.random()*(a-i))}static randVec3(){return new t.common.Vec3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1)}},t.common.Pool=class{constructor(){var t=new Array(256);this.stackVec3=t,this.sizeVec3=0;var i=new Array(256);this.stackMat3=i,this.sizeMat3=0;var a=new Array(256);this.stackMat4=a,this.sizeMat4=0;var s=new Array(256);this.stackQuat=s,this.sizeQuat=0}vec3(){return 0==this.sizeVec3?new t.common.Vec3:this.stackVec3[--this.sizeVec3]}mat3(){return 0==this.sizeMat3?new t.common.Mat3:this.stackMat3[--this.sizeMat3]}mat4(){return 0==this.sizeMat4?new t.common.Mat4:this.stackMat4[--this.sizeMat4]}quat(){return 0==this.sizeQuat?new t.common.Quat:this.stackQuat[--this.sizeQuat]}dispose(t,i,a,s){if(null!=t){if(t.zero(),this.sizeVec3==this.stackVec3.length){for(var o=this.sizeVec3<<1,n=new Array(o),r=0,_=this.sizeVec3;r<_;){var e=r++;n[e]=this.stackVec3[e],this.stackVec3[e]=null}this.stackVec3=n}this.stackVec3[this.sizeVec3++]=t}if(null!=i){if(i.e00=1,i.e01=0,i.e02=0,i.e10=0,i.e11=1,i.e12=0,i.e20=0,i.e21=0,i.e22=1,this.sizeMat3==this.stackMat3.length){for(var h=this.sizeMat3<<1,l=new Array(h),c=0,m=this.sizeMat3;c<m;){var v=c++;l[v]=this.stackMat3[v],this.stackMat3[v]=null}this.stackMat3=l}this.stackMat3[this.sizeMat3++]=i}if(null!=a){if(a.e00=1,a.e01=0,a.e02=0,a.e03=0,a.e10=0,a.e11=1,a.e12=0,a.e13=0,a.e20=0,a.e21=0,a.e22=1,a.e23=0,a.e30=0,a.e31=0,a.e32=0,a.e33=1,this.sizeMat4==this.stackMat4.length){for(var b=this.sizeMat4<<1,x=new Array(b),p=0,f=this.sizeMat4;p<f;){var u=p++;x[u]=this.stackMat4[u],this.stackMat4[u]=null}this.stackMat4=x}this.stackMat4[this.sizeMat4++]=a}if(null!=s){if(s.x=0,s.y=0,s.z=0,s.w=1,this.sizeQuat==this.stackQuat.length){for(var y=this.sizeQuat<<1,X=new Array(y),g=0,z=this.sizeQuat;g<z;){var d=g++;X[d]=this.stackQuat[d],this.stackQuat[d]=null}this.stackQuat=X}this.stackQuat[this.sizeQuat++]=s}}disposeVec3(t){if(t.zero(),this.sizeVec3==this.stackVec3.length){for(var i=this.sizeVec3<<1,a=new Array(i),s=0,o=this.sizeVec3;s<o;){var n=s++;a[n]=this.stackVec3[n],this.stackVec3[n]=null}this.stackVec3=a}this.stackVec3[this.sizeVec3++]=t}disposeMat3(t){if(t.e00=1,t.e01=0,t.e02=0,t.e10=0,t.e11=1,t.e12=0,t.e20=0,t.e21=0,t.e22=1,this.sizeMat3==this.stackMat3.length){for(var i=this.sizeMat3<<1,a=new Array(i),s=0,o=this.sizeMat3;s<o;){var n=s++;a[n]=this.stackMat3[n],this.stackMat3[n]=null}this.stackMat3=a}this.stackMat3[this.sizeMat3++]=t}disposeMat4(t){if(t.e00=1,t.e01=0,t.e02=0,t.e03=0,t.e10=0,t.e11=1,t.e12=0,t.e13=0,t.e20=0,t.e21=0,t.e22=1,t.e23=0,t.e30=0,t.e31=0,t.e32=0,t.e33=1,this.sizeMat4==this.stackMat4.length){for(var i=this.sizeMat4<<1,a=new Array(i),s=0,o=this.sizeMat4;s<o;){var n=s++;a[n]=this.stackMat4[n],this.stackMat4[n]=null}this.stackMat4=a}this.stackMat4[this.sizeMat4++]=t}disposeQuat(t){if(t.x=0,t.y=0,t.z=0,t.w=1,this.sizeQuat==this.stackQuat.length){for(var i=this.sizeQuat<<1,a=new Array(i),s=0,o=this.sizeQuat;s<o;){var n=s++;a[n]=this.stackQuat[n],this.stackQuat[n]=null}this.stackQuat=a}this.stackQuat[this.sizeQuat++]=t}},t.common.Quat=class{constructor(i,a,s,o){null==o&&(o=1),null==s&&(s=0),null==a&&(a=0),null==i&&(i=0),this.x=i,this.y=a,this.z=s,this.w=o,t.common.Quat.numCreations++}identity(){return this.x=0,this.y=0,this.z=0,this.w=1,this}init(t,i,a,s){return this.x=t,this.y=i,this.z=a,this.w=s,this}add(i){return new t.common.Quat(this.x+i.x,this.y+i.y,this.z+i.z,this.w+i.w)}sub(i){return new t.common.Quat(this.x-i.x,this.y-i.y,this.z-i.z,this.w-i.w)}scale(i){return new t.common.Quat(this.x*i,this.y*i,this.z*i,this.w*i)}addEq(t){var i=this.x+t.x,a=this.y+t.y,s=this.z+t.z,o=this.w+t.w;return this.x=i,this.y=a,this.z=s,this.w=o,this}subEq(t){var i=this.x-t.x,a=this.y-t.y,s=this.z-t.z,o=this.w-t.w;return this.x=i,this.y=a,this.z=s,this.w=o,this}scaleEq(t){var i=this.x*t,a=this.y*t,s=this.z*t,o=this.w*t;return this.x=i,this.y=a,this.z=s,this.w=o,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}normalized(){var i=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return i>0&&(i=1/i),new t.common.Quat(this.x*i,this.y*i,this.z*i,this.w*i)}normalize(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);t>0&&(t=1/t);var i=this.x*t,a=this.y*t,s=this.z*t,o=this.w*t;return this.x=i,this.y=a,this.z=s,this.w=o,this}setArc(t,i){var a=t.x,s=t.y,o=t.z,n=i.x,r=i.y,_=i.z,e=a*n+s*r+o*_;if(this.w=Math.sqrt(.5*(1+e)),0==this.w)return _=o*o,(n=a*a)<(r=s*s)?n<_?(e=1/Math.sqrt(r+_),this.x=0,this.y=o*e,this.z=-s*e):(e=1/Math.sqrt(n+r),this.z=0,this.x=s*e,this.y=-a*e):r<_?(e=1/Math.sqrt(_+n),this.y=0,this.z=a*e,this.x=-o*e):(e=1/Math.sqrt(n+r),this.z=0,this.x=s*e,this.y=-a*e),this;e=.5/this.w;var h=s*_-o*r,l=o*n-a*_,c=a*r-s*n;return this.x=h*e,this.y=l*e,this.z=c*e,this}slerp(i,a){var s,o,n,r,_=this.x*i.x+this.y*i.y+this.z*i.z+this.w*i.w;if(_<0?(_=-_,s=-i.x,o=-i.y,n=-i.z,r=-i.w):(s=i.x,o=i.y,n=i.z,r=i.w),_>.999999){var e=new t.common.Quat(this.x+(s-this.x)*a,this.y+(o-this.y)*a,this.z+(n-this.z)*a,this.w+(r-this.w)*a),h=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w);h>0&&(h=1/h);var l=e.x*h,c=e.y*h,m=e.z*h,v=e.w*h;return e.x=l,e.y=c,e.z=m,e.w=v,e}var b=a*Math.acos(_);s-=this.x*_,o-=this.y*_,n-=this.z*_,r-=this.w*_;var x=1/Math.sqrt(s*s+o*o+n*n+r*r);s*=x,o*=x,n*=x,r*=x;var p=Math.sin(b),f=Math.cos(b);return new t.common.Quat(this.x*f+s*p,this.y*f+o*p,this.z*f+n*p,this.w*f+r*p)}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}clone(){return new t.common.Quat(this.x,this.y,this.z,this.w)}fromMat3(t){var i,a=t.e00,s=t.e11,o=t.e22,n=a+s+o;return n>0?(i=Math.sqrt(n+1),this.w=.5*i,i=.5/i,this.x=(t.e21-t.e12)*i,this.y=(t.e02-t.e20)*i,this.z=(t.e10-t.e01)*i):a>s?a>o?(i=Math.sqrt(a-s-o+1),this.x=.5*i,i=.5/i,this.y=(t.e01+t.e10)*i,this.z=(t.e02+t.e20)*i,this.w=(t.e21-t.e12)*i):(i=Math.sqrt(o-a-s+1),this.z=.5*i,i=.5/i,this.x=(t.e02+t.e20)*i,this.y=(t.e12+t.e21)*i,this.w=(t.e10-t.e01)*i):s>o?(i=Math.sqrt(s-o-a+1),this.y=.5*i,i=.5/i,this.x=(t.e01+t.e10)*i,this.z=(t.e12+t.e21)*i,this.w=(t.e02-t.e20)*i):(i=Math.sqrt(o-a-s+1),this.z=.5*i,i=.5/i,this.x=(t.e02+t.e20)*i,this.y=(t.e12+t.e21)*i,this.w=(t.e10-t.e01)*i),this}toMat3(){var i=new t.common.Mat3,a=this.x,s=this.y,o=this.z,n=this.w,r=2*a,_=2*s,e=2*o,h=a*r,l=s*_,c=o*e,m=a*_,v=s*e,b=a*e,x=n*r,p=n*_,f=n*e;return i.e00=1-l-c,i.e01=m-f,i.e02=b+p,i.e10=m+f,i.e11=1-h-c,i.e12=v-x,i.e20=b-p,i.e21=v+x,i.e22=1-h-l,i}toString(){return"Quat["+(this.x>0?(1e7*this.x+.5|0)/1e7:(1e7*this.x-.5|0)/1e7)+" i,\n    "+(this.y>0?(1e7*this.y+.5|0)/1e7:(1e7*this.y-.5|0)/1e7)+" j,\n    "+(this.z>0?(1e7*this.z+.5|0)/1e7:(1e7*this.z-.5|0)/1e7)+" k,\n    "+(this.w>0?(1e7*this.w+.5|0)/1e7:(1e7*this.w-.5|0)/1e7)+"]"}},t.dynamics||(t.dynamics={}),t.dynamics.Contact=class{constructor(){this._next=null,this._prev=null,this._link1=new t.dynamics.ContactLink,this._link2=new t.dynamics.ContactLink,this._s1=null,this._s2=null,this._b1=null,this._b2=null,this._detector=null,this._cachedDetectorData=new t.collision.narrowphase.detector.CachedDetectorData,this._detectorResult=new t.collision.narrowphase.DetectorResult,this._latest=!1,this._shouldBeSkipped=!1,this._manifold=new t.dynamics.constraint.contact.Manifold,this._updater=new t.dynamics.constraint.contact.ManifoldUpdater(this._manifold),this._contactConstraint=new t.dynamics.constraint.contact.ContactConstraint(this._manifold),this._touching=!1}_updateManifold(){if(null!=this._detector){var i=this._touching,a=this._detectorResult;this._detector.detect(a,this._s1._geom,this._s2._geom,this._s1._transform,this._s2._transform,this._cachedDetectorData);var s=a.numPoints;if(this._touching=s>0,this._touching?(this._manifold._buildBasis(a.normal),a.getMaxDepth()>t.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold?this._contactConstraint._positionCorrectionAlgorithm=t.common.Setting.alternativeContactPositionCorrectionAlgorithm:this._contactConstraint._positionCorrectionAlgorithm=t.common.Setting.defaultContactPositionCorrectionAlgorithm,a.incremental?this._updater.incrementalUpdate(a,this._b1._transform,this._b2._transform):this._updater.totalUpdate(a,this._b1._transform,this._b2._transform)):this._manifold._clear(),this._touching&&!i){var o=this._s1._contactCallback,n=this._s2._contactCallback;o==n&&(n=null),null!=o&&o.beginContact(this),null!=n&&n.beginContact(this)}if(!this._touching&&i){var r=this._s1._contactCallback,_=this._s2._contactCallback;r==_&&(_=null),null!=r&&r.endContact(this),null!=_&&_.endContact(this)}if(this._touching){var e=this._s1._contactCallback,h=this._s2._contactCallback;e==h&&(h=null),null!=e&&e.preSolve(this),null!=h&&h.preSolve(this)}}}_postSolve(){var t=this._s1._contactCallback,i=this._s2._contactCallback;t==i&&(i=null),null!=t&&t.postSolve(this),null!=i&&i.postSolve(this)}getShape1(){return this._s1}getShape2(){return this._s2}isTouching(){return this._touching}getManifold(){return this._manifold}getContactConstraint(){return this._contactConstraint}getPrev(){return this._prev}getNext(){return this._next}},t.dynamics.ContactLink=class{constructor(){this._prev=null,this._next=null,this._contact=null,this._other=null}getContact(){return this._contact}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}},t.dynamics.ContactManager=class{constructor(i){this._broadPhase=i,this._collisionMatrix=new t.collision.narrowphase.CollisionMatrix,this._numContacts=0}createContacts(){for(var i=this._broadPhase._proxyPairList;null!=i;){for(var a=i._next;;){var s,o;if(i._p1._id<i._p2._id?(s=i._p1.userData,o=i._p2.userData):(s=i._p2.userData,o=i._p1.userData),!this.shouldCollide(s,o))break;var n,r=s._rigidBody,_=o._rigidBody;n=r._numContactLinks<_._numContactLinks?r._contactLinkList:_._contactLinkList;for(var e=s._id,h=o._id,l=!1;null!=n;){var c=n._next,m=n._contact;if(m._s1._id==e&&m._s2._id==h){m._latest=!0,l=!0;break}n=c}if(!l){var v=this._contactPool;null!=v?(this._contactPool=v._next,v._next=null):v=new t.dynamics.Contact;var b=v;null==this._contactList?(this._contactList=b,this._contactListLast=b):(this._contactListLast._next=b,b._prev=this._contactListLast,this._contactListLast=b),b._latest=!0;var x=this._collisionMatrix.detectors[s._geom._type][o._geom._type];b._s1=s,b._s2=o,b._b1=s._rigidBody,b._b2=o._rigidBody,b._touching=!1,null==b._b1._contactLinkList?(b._b1._contactLinkList=b._link1,b._b1._contactLinkListLast=b._link1):(b._b1._contactLinkListLast._next=b._link1,b._link1._prev=b._b1._contactLinkListLast,b._b1._contactLinkListLast=b._link1),null==b._b2._contactLinkList?(b._b2._contactLinkList=b._link2,b._b2._contactLinkListLast=b._link2):(b._b2._contactLinkListLast._next=b._link2,b._link2._prev=b._b2._contactLinkListLast,b._b2._contactLinkListLast=b._link2),b._b1._numContactLinks++,b._b2._numContactLinks++,b._link1._other=b._b2,b._link2._other=b._b1,b._link1._contact=b,b._link2._contact=b,b._detector=x;var p=b._contactConstraint;p._s1=s,p._s2=o,p._b1=p._s1._rigidBody,p._b2=p._s2._rigidBody,p._tf1=p._b1._transform,p._tf2=p._b2._transform,this._numContacts++}break}i=a}}destroyOutdatedContacts(){for(var t=this._broadPhase._incremental,i=this._contactList;null!=i;){for(var a=i._next;;){if(i._latest){i._latest=!1,i._shouldBeSkipped=!1;break}if(!t){var s=i._prev,o=i._next;if(null!=s&&(s._next=o),null!=o&&(o._prev=s),i==this._contactList&&(this._contactList=this._contactList._next),i==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),i._next=null,i._prev=null,i._touching){var n=i._s1._contactCallback,r=i._s2._contactCallback;n==r&&(r=null),null!=n&&n.endContact(i),null!=r&&r.endContact(i)}var _=i._link1._prev,e=i._link1._next;null!=_&&(_._next=e),null!=e&&(e._prev=_),i._link1==i._b1._contactLinkList&&(i._b1._contactLinkList=i._b1._contactLinkList._next),i._link1==i._b1._contactLinkListLast&&(i._b1._contactLinkListLast=i._b1._contactLinkListLast._prev),i._link1._next=null,i._link1._prev=null;var h=i._link2._prev,l=i._link2._next;null!=h&&(h._next=l),null!=l&&(l._prev=h),i._link2==i._b2._contactLinkList&&(i._b2._contactLinkList=i._b2._contactLinkList._next),i._link2==i._b2._contactLinkListLast&&(i._b2._contactLinkListLast=i._b2._contactLinkListLast._prev),i._link2._next=null,i._link2._prev=null,i._b1._numContactLinks--,i._b2._numContactLinks--,i._link1._other=null,i._link2._other=null,i._link1._contact=null,i._link2._contact=null,i._s1=null,i._s2=null,i._b1=null,i._b2=null,i._touching=!1,i._cachedDetectorData._clear(),i._manifold._clear(),i._detector=null;var c=i._contactConstraint;c._s1=null,c._s2=null,c._b1=null,c._b2=null,c._tf1=null,c._tf2=null,i._next=this._contactPool,this._contactPool=i,this._numContacts--;break}var m=i._s1,v=i._s2,b=m._rigidBody,x=v._rigidBody,p=!b._sleeping&&1!=b._type,f=!x._sleeping&&1!=x._type;if(!p&&!f){i._shouldBeSkipped=!0;break}var u=m._aabb,y=v._aabb,X=m._proxy,g=v._proxy;if(!(X._aabbMinX<g._aabbMaxX&&X._aabbMaxX>g._aabbMinX&&X._aabbMinY<g._aabbMaxY&&X._aabbMaxY>g._aabbMinY&&X._aabbMinZ<g._aabbMaxZ&&X._aabbMaxZ>g._aabbMinZ&&this.shouldCollide(m,v))){var z=i._prev,d=i._next;if(null!=z&&(z._next=d),null!=d&&(d._prev=z),i==this._contactList&&(this._contactList=this._contactList._next),i==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),i._next=null,i._prev=null,i._touching){var Y=i._s1._contactCallback,Z=i._s2._contactCallback;Y==Z&&(Z=null),null!=Y&&Y.endContact(i),null!=Z&&Z.endContact(i)}var M=i._link1._prev,I=i._link1._next;null!=M&&(M._next=I),null!=I&&(I._prev=M),i._link1==i._b1._contactLinkList&&(i._b1._contactLinkList=i._b1._contactLinkList._next),i._link1==i._b1._contactLinkListLast&&(i._b1._contactLinkListLast=i._b1._contactLinkListLast._prev),i._link1._next=null,i._link1._prev=null;var V=i._link2._prev,L=i._link2._next;null!=V&&(V._next=L),null!=L&&(L._prev=V),i._link2==i._b2._contactLinkList&&(i._b2._contactLinkList=i._b2._contactLinkList._next),i._link2==i._b2._contactLinkListLast&&(i._b2._contactLinkListLast=i._b2._contactLinkListLast._prev),i._link2._next=null,i._link2._prev=null,i._b1._numContactLinks--,i._b2._numContactLinks--,i._link1._other=null,i._link2._other=null,i._link1._contact=null,i._link2._contact=null,i._s1=null,i._s2=null,i._b1=null,i._b2=null,i._touching=!1,i._cachedDetectorData._clear(),i._manifold._clear(),i._detector=null;var w=i._contactConstraint;w._s1=null,w._s2=null,w._b1=null,w._b2=null,w._tf1=null,w._tf2=null,i._next=this._contactPool,this._contactPool=i,this._numContacts--;break}var k=u._minX<y._maxX&&u._maxX>y._minX&&u._minY<y._maxY&&u._maxY>y._minY&&u._minZ<y._maxZ&&u._maxZ>y._minZ;i._shouldBeSkipped=!k;break}i=a}}shouldCollide(t,i){var a,s,o=t._rigidBody,n=i._rigidBody;if(o==n)return!1;if(0!=o._type&&0!=n._type)return!1;if(0==(t._collisionGroup&i._collisionMask)||0==(i._collisionGroup&t._collisionMask))return!1;for(o._numJointLinks<n._numJointLinks?(a=o._jointLinkList,s=n):(a=n._jointLinkList,s=o);null!=a;){var r=a._next;if(a._other==s&&!a._joint._allowCollision)return!1;a=r}return!0}_updateContacts(){this._broadPhase.collectPairs(),this.createContacts(),this.destroyOutdatedContacts()}_postSolve(){for(var t=this._contactList;null!=t;){var i=t._next;t._touching&&t._postSolve(),t=i}}getNumContacts(){return this._numContacts}getContactList(){return this._contactList}},t.dynamics.Island=class{constructor(){var i=new Array(t.common.Setting.islandInitialRigidBodyArraySize);this.rigidBodies=i;var a=new Array(t.common.Setting.islandInitialConstraintArraySize);this.solvers=a;var s=new Array(t.common.Setting.islandInitialConstraintArraySize);this.solversSi=s;var o=new Array(t.common.Setting.islandInitialConstraintArraySize);this.solversNgs=o,this.numRigidBodies=0,this.numSolvers=0,this.numSolversSi=0,this.numSolversNgs=0}_clear(){for(;this.numRigidBodies>0;)this.rigidBodies[--this.numRigidBodies]=null;for(;this.numSolvers>0;)this.solvers[--this.numSolvers]=null;for(;this.numSolversSi>0;)this.solversSi[--this.numSolversSi]=null;for(;this.numSolversNgs>0;)this.solversNgs[--this.numSolversNgs]=null}_addRigidBody(t){if(this.numRigidBodies==this.rigidBodies.length){for(var i=this.numRigidBodies<<1,a=new Array(i),s=0,o=this.numRigidBodies;s<o;){var n=s++;a[n]=this.rigidBodies[n],this.rigidBodies[n]=null}this.rigidBodies=a}t._addedToIsland=!0,this.rigidBodies[this.numRigidBodies++]=t}_addConstraintSolver(i,a){if(this.numSolvers==this.solvers.length){for(var s=this.numSolvers<<1,o=new Array(s),n=0,r=this.numSolvers;n<r;){var _=n++;o[_]=this.solvers[_],this.solvers[_]=null}this.solvers=o}if(i._addedToIsland=!0,this.solvers[this.numSolvers++]=i,a==t.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE){if(this.numSolversSi==this.solversSi.length){for(var e=this.numSolversSi<<1,h=new Array(e),l=0,c=this.numSolversSi;l<c;){var m=l++;h[m]=this.solversSi[m],this.solversSi[m]=null}this.solversSi=h}this.solversSi[this.numSolversSi++]=i}if(a==t.dynamics.constraint.PositionCorrectionAlgorithm.NGS){if(this.numSolversNgs==this.solversNgs.length){for(var v=this.numSolversNgs<<1,b=new Array(v),x=0,p=this.numSolversNgs;x<p;){var f=x++;b[f]=this.solversNgs[f],this.solversNgs[f]=null}this.solversNgs=b}this.solversNgs[this.numSolversNgs++]=i}}_stepSingleRigidBody(i,a){var s=i.dt,o=a._ptransform,n=a._transform;if(o._positionX=n._positionX,o._positionY=n._positionY,o._positionZ=n._positionZ,o._rotation00=n._rotation00,o._rotation01=n._rotation01,o._rotation02=n._rotation02,o._rotation10=n._rotation10,o._rotation11=n._rotation11,o._rotation12=n._rotation12,o._rotation20=n._rotation20,o._rotation21=n._rotation21,o._rotation22=n._rotation22,a._linearContactImpulseX=0,a._linearContactImpulseY=0,a._linearContactImpulseZ=0,a._angularContactImpulseX=0,a._angularContactImpulseY=0,a._angularContactImpulseZ=0,a._autoSleep&&a._velX*a._velX+a._velY*a._velY+a._velZ*a._velZ<t.common.Setting.sleepingVelocityThreshold*t.common.Setting.sleepingVelocityThreshold&&a._angVelX*a._angVelX+a._angVelY*a._angVelY+a._angVelZ*a._angVelZ<t.common.Setting.sleepingAngularVelocityThreshold*t.common.Setting.sleepingAngularVelocityThreshold?(a._sleepTime+=s,a._sleepTime>t.common.Setting.sleepingTimeThreshold&&(a._sleeping=!0,a._sleepTime=0)):a._sleepTime=0,!a._sleeping){if(0==a._type){var r,_,e,h,l,c,m=s*a._linearDamping,v=m*m,b=1/(1+m+v*(.5+.16666666666666666*m+.041666666666666664*v)),x=s*a._angularDamping,p=x*x,f=1/(1+x+p*(.5+.16666666666666666*x+.041666666666666664*p));r=this.gravityX*a._gravityScale,_=this.gravityY*a._gravityScale,e=this.gravityZ*a._gravityScale,r+=a._forceX*a._invMass,_+=a._forceY*a._invMass,e+=a._forceZ*a._invMass,h=a._invInertia00*a._torqueX+a._invInertia01*a._torqueY+a._invInertia02*a._torqueZ,l=a._invInertia10*a._torqueX+a._invInertia11*a._torqueY+a._invInertia12*a._torqueZ,c=a._invInertia20*a._torqueX+a._invInertia21*a._torqueY+a._invInertia22*a._torqueZ,a._velX+=r*s,a._velY+=_*s,a._velZ+=e*s,a._velX*=b,a._velY*=b,a._velZ*=b,a._angVelX+=h*s,a._angVelY+=l*s,a._angVelZ+=c*s,a._angVelX*=f,a._angVelY*=f,a._angVelZ*=f}a._integrate(s);for(var u=a._shapeList;null!=u;){var y,X,g,z,d,Y,Z,M,I,V,L,w,k=u._next,B=u._ptransform,A=u._localTransform,P=a._ptransform;y=P._rotation00*A._rotation00+P._rotation01*A._rotation10+P._rotation02*A._rotation20,X=P._rotation00*A._rotation01+P._rotation01*A._rotation11+P._rotation02*A._rotation21,g=P._rotation00*A._rotation02+P._rotation01*A._rotation12+P._rotation02*A._rotation22,z=P._rotation10*A._rotation00+P._rotation11*A._rotation10+P._rotation12*A._rotation20,d=P._rotation10*A._rotation01+P._rotation11*A._rotation11+P._rotation12*A._rotation21,Y=P._rotation10*A._rotation02+P._rotation11*A._rotation12+P._rotation12*A._rotation22,Z=P._rotation20*A._rotation00+P._rotation21*A._rotation10+P._rotation22*A._rotation20,M=P._rotation20*A._rotation01+P._rotation21*A._rotation11+P._rotation22*A._rotation21,I=P._rotation20*A._rotation02+P._rotation21*A._rotation12+P._rotation22*A._rotation22,B._rotation00=y,B._rotation01=X,B._rotation02=g,B._rotation10=z,B._rotation11=d,B._rotation12=Y,B._rotation20=Z,B._rotation21=M,B._rotation22=I,V=P._rotation00*A._positionX+P._rotation01*A._positionY+P._rotation02*A._positionZ,L=P._rotation10*A._positionX+P._rotation11*A._positionY+P._rotation12*A._positionZ,w=P._rotation20*A._positionX+P._rotation21*A._positionY+P._rotation22*A._positionZ,B._positionX=V,B._positionY=L,B._positionZ=w,B._positionX+=P._positionX,B._positionY+=P._positionY,B._positionZ+=P._positionZ;var S,T,C,j,R,q,E,D,F,N,W,G,J,O,H,U,Q,K,$=u._transform,tt=u._localTransform,it=a._transform;if(S=it._rotation00*tt._rotation00+it._rotation01*tt._rotation10+it._rotation02*tt._rotation20,T=it._rotation00*tt._rotation01+it._rotation01*tt._rotation11+it._rotation02*tt._rotation21,C=it._rotation00*tt._rotation02+it._rotation01*tt._rotation12+it._rotation02*tt._rotation22,j=it._rotation10*tt._rotation00+it._rotation11*tt._rotation10+it._rotation12*tt._rotation20,R=it._rotation10*tt._rotation01+it._rotation11*tt._rotation11+it._rotation12*tt._rotation21,q=it._rotation10*tt._rotation02+it._rotation11*tt._rotation12+it._rotation12*tt._rotation22,E=it._rotation20*tt._rotation00+it._rotation21*tt._rotation10+it._rotation22*tt._rotation20,D=it._rotation20*tt._rotation01+it._rotation21*tt._rotation11+it._rotation22*tt._rotation21,F=it._rotation20*tt._rotation02+it._rotation21*tt._rotation12+it._rotation22*tt._rotation22,$._rotation00=S,$._rotation01=T,$._rotation02=C,$._rotation10=j,$._rotation11=R,$._rotation12=q,$._rotation20=E,$._rotation21=D,$._rotation22=F,N=it._rotation00*tt._positionX+it._rotation01*tt._positionY+it._rotation02*tt._positionZ,W=it._rotation10*tt._positionX+it._rotation11*tt._positionY+it._rotation12*tt._positionZ,G=it._rotation20*tt._positionX+it._rotation21*tt._positionY+it._rotation22*tt._positionZ,$._positionX=N,$._positionY=W,$._positionZ=G,$._positionX+=it._positionX,$._positionY+=it._positionY,$._positionZ+=it._positionZ,u._geom._computeAabb(u._aabb,u._ptransform),J=u._aabb._minX,O=u._aabb._minY,H=u._aabb._minZ,U=u._aabb._maxX,Q=u._aabb._maxY,K=u._aabb._maxZ,u._geom._computeAabb(u._aabb,u._transform),u._aabb._minX=J<u._aabb._minX?J:u._aabb._minX,u._aabb._minY=O<u._aabb._minY?O:u._aabb._minY,u._aabb._minZ=H<u._aabb._minZ?H:u._aabb._minZ,u._aabb._maxX=U>u._aabb._maxX?U:u._aabb._maxX,u._aabb._maxY=Q>u._aabb._maxY?Q:u._aabb._maxY,u._aabb._maxZ=K>u._aabb._maxZ?K:u._aabb._maxZ,null!=u._proxy){var at,st,ot;at=u._transform._positionX-u._ptransform._positionX,st=u._transform._positionY-u._ptransform._positionY,ot=u._transform._positionZ-u._ptransform._positionZ;var nt=u.displacement;nt.x=at,nt.y=st,nt.z=ot,u._rigidBody._world._broadPhase.moveProxy(u._proxy,u._aabb,u.displacement)}u=k}}}_step(i,a,s){for(var o=i.dt,n=!0,r=0,_=this.numRigidBodies;r<_;){var e=r++,h=this.rigidBodies[e],l=h._ptransform,c=h._transform;if(l._positionX=c._positionX,l._positionY=c._positionY,l._positionZ=c._positionZ,l._rotation00=c._rotation00,l._rotation01=c._rotation01,l._rotation02=c._rotation02,l._rotation10=c._rotation10,l._rotation11=c._rotation11,l._rotation12=c._rotation12,l._rotation20=c._rotation20,l._rotation21=c._rotation21,l._rotation22=c._rotation22,h._linearContactImpulseX=0,h._linearContactImpulseY=0,h._linearContactImpulseZ=0,h._angularContactImpulseX=0,h._angularContactImpulseY=0,h._angularContactImpulseZ=0,h._sleeping=!1,h._autoSleep&&h._velX*h._velX+h._velY*h._velY+h._velZ*h._velZ<t.common.Setting.sleepingVelocityThreshold*t.common.Setting.sleepingVelocityThreshold&&h._angVelX*h._angVelX+h._angVelY*h._angVelY+h._angVelZ*h._angVelZ<t.common.Setting.sleepingAngularVelocityThreshold*t.common.Setting.sleepingAngularVelocityThreshold?h._sleepTime+=o:h._sleepTime=0,h._sleepTime<t.common.Setting.sleepingTimeThreshold&&(n=!1),0==h._type){var m,v,b,x,p,f,u=o*h._linearDamping,y=u*u,X=1/(1+u+y*(.5+.16666666666666666*u+.041666666666666664*y)),g=o*h._angularDamping,z=g*g,d=1/(1+g+z*(.5+.16666666666666666*g+.041666666666666664*z));m=this.gravityX*h._gravityScale,v=this.gravityY*h._gravityScale,b=this.gravityZ*h._gravityScale,m+=h._forceX*h._invMass,v+=h._forceY*h._invMass,b+=h._forceZ*h._invMass,x=h._invInertia00*h._torqueX+h._invInertia01*h._torqueY+h._invInertia02*h._torqueZ,p=h._invInertia10*h._torqueX+h._invInertia11*h._torqueY+h._invInertia12*h._torqueZ,f=h._invInertia20*h._torqueX+h._invInertia21*h._torqueY+h._invInertia22*h._torqueZ,h._velX+=m*o,h._velY+=v*o,h._velZ+=b*o,h._velX*=X,h._velY*=X,h._velZ*=X,h._angVelX+=x*o,h._angVelY+=p*o,h._angVelZ+=f*o,h._angVelX*=d,h._angVelY*=d,h._angVelZ*=d}}if(n)for(var Y=0,Z=this.numRigidBodies;Y<Z;){var M=Y++,I=this.rigidBodies[M];I._sleeping=!0,I._sleepTime=0}else{for(var V=0,L=this.numSolvers;V<L;){var w=V++;this.solvers[w].preSolveVelocity(i)}for(var k=0,B=this.numSolvers;k<B;){var A=k++;this.solvers[A].warmStart(i)}for(var P=0,S=a;P<S;){P++;for(var T=0,C=this.numSolvers;T<C;){var j=T++;this.solvers[j].solveVelocity()}}for(var R=0,q=this.numSolvers;R<q;){var E=R++;this.solvers[E].postSolveVelocity(i)}for(var D=0,F=this.numRigidBodies;D<F;){var N=D++;this.rigidBodies[N]._integrate(o)}for(var W=0,G=this.numSolversSi;W<G;){var J=W++;this.solversSi[J].preSolvePosition(i)}for(var O=0,H=s;O<H;){O++;for(var U=0,Q=this.numSolversSi;U<Q;){var K=U++;this.solversSi[K].solvePositionSplitImpulse()}}for(var $=0,tt=this.numRigidBodies;$<tt;){var it=$++;this.rigidBodies[it]._integratePseudoVelocity()}for(var at=0,st=this.numSolversNgs;at<st;){var ot=at++;this.solversNgs[ot].preSolvePosition(i)}for(var nt=0,rt=s;nt<rt;){nt++;for(var _t=0,et=this.numSolversNgs;_t<et;){var ht=_t++;this.solversNgs[ht].solvePositionNgs(i)}}for(var lt=0,ct=this.numSolvers;lt<ct;){var mt=lt++;this.solvers[mt].postSolve()}for(var vt=0,bt=this.numRigidBodies;vt<bt;)for(var xt=vt++,pt=this.rigidBodies[xt],ft=pt._shapeList;null!=ft;){var ut,yt,Xt,gt,zt,dt,Yt,Zt,Mt,It,Vt,Lt,wt=ft._next,kt=ft._ptransform,Bt=ft._localTransform,At=pt._ptransform;ut=At._rotation00*Bt._rotation00+At._rotation01*Bt._rotation10+At._rotation02*Bt._rotation20,yt=At._rotation00*Bt._rotation01+At._rotation01*Bt._rotation11+At._rotation02*Bt._rotation21,Xt=At._rotation00*Bt._rotation02+At._rotation01*Bt._rotation12+At._rotation02*Bt._rotation22,gt=At._rotation10*Bt._rotation00+At._rotation11*Bt._rotation10+At._rotation12*Bt._rotation20,zt=At._rotation10*Bt._rotation01+At._rotation11*Bt._rotation11+At._rotation12*Bt._rotation21,dt=At._rotation10*Bt._rotation02+At._rotation11*Bt._rotation12+At._rotation12*Bt._rotation22,Yt=At._rotation20*Bt._rotation00+At._rotation21*Bt._rotation10+At._rotation22*Bt._rotation20,Zt=At._rotation20*Bt._rotation01+At._rotation21*Bt._rotation11+At._rotation22*Bt._rotation21,Mt=At._rotation20*Bt._rotation02+At._rotation21*Bt._rotation12+At._rotation22*Bt._rotation22,kt._rotation00=ut,kt._rotation01=yt,kt._rotation02=Xt,kt._rotation10=gt,kt._rotation11=zt,kt._rotation12=dt,kt._rotation20=Yt,kt._rotation21=Zt,kt._rotation22=Mt,It=At._rotation00*Bt._positionX+At._rotation01*Bt._positionY+At._rotation02*Bt._positionZ,Vt=At._rotation10*Bt._positionX+At._rotation11*Bt._positionY+At._rotation12*Bt._positionZ,Lt=At._rotation20*Bt._positionX+At._rotation21*Bt._positionY+At._rotation22*Bt._positionZ,kt._positionX=It,kt._positionY=Vt,kt._positionZ=Lt,kt._positionX+=At._positionX,kt._positionY+=At._positionY,kt._positionZ+=At._positionZ;var Pt,St,Tt,Ct,jt,Rt,qt,Et,Dt,Ft,Nt,Wt,Gt,Jt,Ot,Ht,Ut,Qt,Kt=ft._transform,$t=ft._localTransform,ti=pt._transform;if(Pt=ti._rotation00*$t._rotation00+ti._rotation01*$t._rotation10+ti._rotation02*$t._rotation20,St=ti._rotation00*$t._rotation01+ti._rotation01*$t._rotation11+ti._rotation02*$t._rotation21,Tt=ti._rotation00*$t._rotation02+ti._rotation01*$t._rotation12+ti._rotation02*$t._rotation22,Ct=ti._rotation10*$t._rotation00+ti._rotation11*$t._rotation10+ti._rotation12*$t._rotation20,jt=ti._rotation10*$t._rotation01+ti._rotation11*$t._rotation11+ti._rotation12*$t._rotation21,Rt=ti._rotation10*$t._rotation02+ti._rotation11*$t._rotation12+ti._rotation12*$t._rotation22,qt=ti._rotation20*$t._rotation00+ti._rotation21*$t._rotation10+ti._rotation22*$t._rotation20,Et=ti._rotation20*$t._rotation01+ti._rotation21*$t._rotation11+ti._rotation22*$t._rotation21,Dt=ti._rotation20*$t._rotation02+ti._rotation21*$t._rotation12+ti._rotation22*$t._rotation22,Kt._rotation00=Pt,Kt._rotation01=St,Kt._rotation02=Tt,Kt._rotation10=Ct,Kt._rotation11=jt,Kt._rotation12=Rt,Kt._rotation20=qt,Kt._rotation21=Et,Kt._rotation22=Dt,Ft=ti._rotation00*$t._positionX+ti._rotation01*$t._positionY+ti._rotation02*$t._positionZ,Nt=ti._rotation10*$t._positionX+ti._rotation11*$t._positionY+ti._rotation12*$t._positionZ,Wt=ti._rotation20*$t._positionX+ti._rotation21*$t._positionY+ti._rotation22*$t._positionZ,Kt._positionX=Ft,Kt._positionY=Nt,Kt._positionZ=Wt,Kt._positionX+=ti._positionX,Kt._positionY+=ti._positionY,Kt._positionZ+=ti._positionZ,ft._geom._computeAabb(ft._aabb,ft._ptransform),Gt=ft._aabb._minX,Jt=ft._aabb._minY,Ot=ft._aabb._minZ,Ht=ft._aabb._maxX,Ut=ft._aabb._maxY,Qt=ft._aabb._maxZ,ft._geom._computeAabb(ft._aabb,ft._transform),ft._aabb._minX=Gt<ft._aabb._minX?Gt:ft._aabb._minX,ft._aabb._minY=Jt<ft._aabb._minY?Jt:ft._aabb._minY,ft._aabb._minZ=Ot<ft._aabb._minZ?Ot:ft._aabb._minZ,ft._aabb._maxX=Ht>ft._aabb._maxX?Ht:ft._aabb._maxX,ft._aabb._maxY=Ut>ft._aabb._maxY?Ut:ft._aabb._maxY,ft._aabb._maxZ=Qt>ft._aabb._maxZ?Qt:ft._aabb._maxZ,null!=ft._proxy){var ii,ai,si;ii=ft._transform._positionX-ft._ptransform._positionX,ai=ft._transform._positionY-ft._ptransform._positionY,si=ft._transform._positionZ-ft._ptransform._positionZ;var oi=ft.displacement;oi.x=ii,oi.y=ai,oi.z=si,ft._rigidBody._world._broadPhase.moveProxy(ft._proxy,ft._aabb,ft.displacement)}ft=wt}}}},t.dynamics.TimeStep=class{constructor(){this.dt=0,this.invDt=0,this.dtRatio=1}},t.dynamics.World=class{constructor(i,a){switch(null==i&&(i=2),i){case 1:this._broadPhase=new t.collision.broadphase.bruteforce.BruteForceBroadPhase;break;case 2:this._broadPhase=new t.collision.broadphase.bvh.BvhBroadPhase}this._contactManager=new t.dynamics.ContactManager(this._broadPhase),null==a&&(a=new t.common.Vec3(0,-9.80665,0)),this._gravity=new t.common.Vec3(a.x,a.y,a.z),this._rigidBodyList=null,this._rigidBodyListLast=null,this._jointList=null,this._jointListLast=null,this._numRigidBodies=0,this._numShapes=0,this._numJoints=0,this._numIslands=0,this._numVelocityIterations=10,this._numPositionIterations=5,this._rayCastWrapper=new t.dynamics._World.RayCastWrapper,this._convexCastWrapper=new t.dynamics._World.ConvexCastWrapper,this._aabbTestWrapper=new t.dynamics._World.AabbTestWrapper,this._island=new t.dynamics.Island;var s=new Array(t.common.Setting.islandInitialConstraintArraySize);this._solversInIslands=s;var o=new Array(t.common.Setting.islandInitialRigidBodyArraySize);this._rigidBodyStack=o,this._timeStep=new t.dynamics.TimeStep,this._pool=new t.common.Pool,this._shapeIdCount=0}_updateContacts(){var i=Date.now()/1e3;this._contactManager._updateContacts();var a=Date.now()/1e3;t.dynamics.common.Performance.broadPhaseCollisionTime=1e3*(a-i);for(var s=Date.now()/1e3,o=this._contactManager._contactList;null!=o;){var n=o._next;o._shouldBeSkipped||o._updateManifold(),o=n}var r=Date.now()/1e3;t.dynamics.common.Performance.narrowPhaseCollisionTime=1e3*(r-s)}_solveIslands(){var i=Date.now()/1e3;if(t.common.Setting.disableSleeping)for(var a=this._rigidBodyList;null!=a;){var s=a._next;a._sleeping=!1,a._sleepTime=0,a=s}if(this._rigidBodyStack.length<this._numRigidBodies){for(var o=this._rigidBodyStack.length<<1;o<this._numRigidBodies;)o<<=1;var n=new Array(o);this._rigidBodyStack=n}this._numIslands=0;var r=this._island,_=this._gravity;r.gravityX=_.x,r.gravityY=_.y,r.gravityZ=_.z;var e=this._rigidBodyList;for(this._numSolversInIslands=0;null!=e;){for(var h=e._next;!e._addedToIsland&&!e._sleeping&&1!=e._type;){if(0==e._numContactLinks&&0==e._numJointLinks){this._island._stepSingleRigidBody(this._timeStep,e),this._numIslands++;break}this.buildIsland(e),this._island._step(this._timeStep,this._numVelocityIterations,this._numPositionIterations),this._island._clear(),this._numIslands++;break}e=h}for(this._contactManager._postSolve(),e=this._rigidBodyList;null!=e;){var l=e._next;e._addedToIsland=!1,e=l}for(e=this._rigidBodyList;null!=e;){var c=e._next;e._forceX=0,e._forceY=0,e._forceZ=0,e._torqueX=0,e._torqueY=0,e._torqueZ=0,e=c}for(;this._numSolversInIslands>0;)this._solversInIslands[--this._numSolversInIslands]._addedToIsland=!1,this._solversInIslands[this._numSolversInIslands]=null;var m=Date.now()/1e3;t.dynamics.common.Performance.dynamicsTime=1e3*(m-i)}buildIsland(t){var i=1;for(this._island._addRigidBody(t),this._rigidBodyStack[0]=t;i>0;){var a=this._rigidBodyStack[--i];if(this._rigidBodyStack[i]=null,1!=a._type){for(var s=a._contactLinkList;null!=s;){var o=s._next,n=s._contact._contactConstraint,r=s._contact._contactConstraint._solver;if(n.isTouching()&&!r._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){for(var _=this._numSolversInIslands<<1,e=new Array(_),h=0,l=this._numSolversInIslands;h<l;){var c=h++;e[c]=this._solversInIslands[c],this._solversInIslands[c]=null}this._solversInIslands=e}this._solversInIslands[this._numSolversInIslands++]=r,this._island._addConstraintSolver(r,n._positionCorrectionAlgorithm);var m=s._other;m._addedToIsland||(this._island._addRigidBody(m),this._rigidBodyStack[i++]=m)}s=o}for(var v=a._jointLinkList;null!=v;){var b=v._next,x=v._joint,p=x._solver;if(!p._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){for(var f=this._numSolversInIslands<<1,u=new Array(f),y=0,X=this._numSolversInIslands;y<X;){var g=y++;u[g]=this._solversInIslands[g],this._solversInIslands[g]=null}this._solversInIslands=u}this._solversInIslands[this._numSolversInIslands++]=p,this._island._addConstraintSolver(p,x._positionCorrectionAlgorithm);var z=v._other;z._addedToIsland||(this._island._addRigidBody(z),this._rigidBodyStack[i++]=z)}v=b}}}}_drawBvh(t,i){t.drawBvh&&this._drawBvhNode(t,i._root,0,t.style.bvhNodeColor)}_drawBvhNode(i,a,s,o){if(null!=a){if(s>=i.drawBvhMinLevel&&s<=i.drawBvhMaxLevel){var n=this._pool,r=0==n.sizeVec3?new t.common.Vec3:n.stackVec3[--n.sizeVec3],_=this._pool,e=0==_.sizeVec3?new t.common.Vec3:_.stackVec3[--_.sizeVec3],h=r;h.x=a._aabbMinX,h.y=a._aabbMinY,h.z=a._aabbMinZ;var l=e;l.x=a._aabbMaxX,l.y=a._aabbMaxY,l.z=a._aabbMaxZ,i.aabb(r,e,o);var c=this._pool;if(null!=r){if(r.zero(),c.sizeVec3==c.stackVec3.length){for(var m=c.sizeVec3<<1,v=new Array(m),b=0,x=c.sizeVec3;b<x;){var p=b++;v[p]=c.stackVec3[p],c.stackVec3[p]=null}c.stackVec3=v}c.stackVec3[c.sizeVec3++]=r}var f=this._pool;if(null!=e){if(e.zero(),f.sizeVec3==f.stackVec3.length){for(var u=f.sizeVec3<<1,y=new Array(u),X=0,g=f.sizeVec3;X<g;){var z=X++;y[z]=f.stackVec3[z],f.stackVec3[z]=null}f.stackVec3=y}f.stackVec3[f.sizeVec3++]=e}}this._drawBvhNode(i,a._children[0],s+1,o),this._drawBvhNode(i,a._children[1],s+1,o)}}_drawRigidBodies(i){for(var a=i.style,s=this._rigidBodyList;null!=s;){var o=s._next;if(i.drawBases){var n=i.style;i.basis(s._transform,n.basisLength,n.basisColorX,n.basisColorY,n.basisColorZ)}var r=null,_=0==s._type;_||(r=2==s._type?a.kinematicShapeColor:a.staticShapeColor);for(var e=s._shapeList;null!=e;){var h=e._next;if(_&&(r=0==(1&e._id)?s._sleeping?a.sleepingShapeColor1:s._sleepTime>t.common.Setting.sleepingTimeThreshold?a.sleepyShapeColor1:a.shapeColor1:s._sleeping?a.sleepingShapeColor2:s._sleepTime>t.common.Setting.sleepingTimeThreshold?a.sleepyShapeColor2:a.shapeColor2),i.drawShapes){var l=e._geom,c=e._transform;switch(l._type){case 0:i.sphere(c,l._radius,r);break;case 1:var m=l,v=this._pool,b=0==v.sizeVec3?new t.common.Vec3:v.stackVec3[--v.sizeVec3],x=b;x.x=m._halfExtentsX,x.y=m._halfExtentsY,x.z=m._halfExtentsZ,i.box(c,b,r);var p=this._pool;if(null!=b){if(b.zero(),p.sizeVec3==p.stackVec3.length){for(var f=p.sizeVec3<<1,u=new Array(f),y=0,X=p.sizeVec3;y<X;){var g=y++;u[g]=p.stackVec3[g],p.stackVec3[g]=null}p.stackVec3=u}p.stackVec3[p.sizeVec3++]=b}break;case 2:var z=l;i.cylinder(c,z._radius,z._halfHeight,r);break;case 3:var d=l;i.cone(c,d._radius,d._halfHeight,r);break;case 4:var Y=l;i.capsule(c,Y._radius,Y._halfHeight,r);break;case 5:var Z=l,M=Z._numVertices,I=this._pool,V=0==I.sizeVec3?new t.common.Vec3:I.stackVec3[--I.sizeVec3],L=this._pool,w=0==L.sizeVec3?new t.common.Vec3:L.stackVec3[--L.sizeVec3],k=this._pool,B=0==k.sizeVec3?new t.common.Vec3:k.stackVec3[--k.sizeVec3],A=this._pool,P=0==A.sizeVec3?new t.common.Vec3:A.stackVec3[--A.sizeVec3],S=this._pool,T=0==S.sizeVec3?new t.common.Vec3:S.stackVec3[--S.sizeVec3],C=this._pool,j=0==C.sizeVec3?new t.common.Vec3:C.stackVec3[--C.sizeVec3],R=this._pool,q=0==R.sizeMat3?new t.common.Mat3:R.stackMat3[--R.sizeMat3],E=this._pool,D=0==E.sizeVec3?new t.common.Vec3:E.stackVec3[--E.sizeVec3],F=q;F.e00=c._rotation00,F.e01=c._rotation01,F.e02=c._rotation02,F.e10=c._rotation10,F.e11=c._rotation11,F.e12=c._rotation12,F.e20=c._rotation20,F.e21=c._rotation21,F.e22=c._rotation22;var N=D;N.x=c._positionX,N.y=c._positionY,N.z=c._positionZ;for(var W=0,G=M;W<G;){var J=W++,O=Z._tmpVertices[J],H=Z._vertices[J];O.x=H.x,O.y=H.y,O.z=H.z;var U=O,Q=U.x*q.e00+U.y*q.e01+U.z*q.e02,K=U.x*q.e10+U.y*q.e11+U.z*q.e12,$=U.x*q.e20+U.y*q.e21+U.z*q.e22;U.x=Q,U.y=K,U.z=$;var tt=U,it=tt.x+D.x,at=tt.y+D.y,st=tt.z+D.z;tt.x=it,tt.y=at,tt.z=st}if(M>30)for(var ot=0,nt=M;ot<nt;){var rt=ot++,_t=Z._tmpVertices[rt];V.x=_t.x,V.y=_t.y,V.z=_t.z;var et=Z._tmpVertices[(rt+1)%M];w.x=et.x,w.y=et.y,w.z=et.z,i.line(V,w,r)}else if(this._debugDraw.wireframe||M>10)for(var ht=0,lt=M;ht<lt;){var ct=ht++,mt=Z._tmpVertices[ct];V.x=mt.x,V.y=mt.y,V.z=mt.z;for(var vt=0,bt=ct;vt<bt;){var xt=vt++,pt=Z._tmpVertices[xt];w.x=pt.x,w.y=pt.y,w.z=pt.z,i.line(V,w,r)}}else for(var ft=0,ut=M;ft<ut;){var yt=ft++,Xt=Z._tmpVertices[yt];V.x=Xt.x,V.y=Xt.y,V.z=Xt.z;for(var gt=0,zt=yt;gt<zt;){var dt=gt++,Yt=Z._tmpVertices[dt];w.x=Yt.x,w.y=Yt.y,w.z=Yt.z;for(var Zt=0,Mt=dt;Zt<Mt;){var It=Zt++,Vt=Z._tmpVertices[It];B.x=Vt.x,B.y=Vt.y,B.z=Vt.z,P.x=w.x,P.y=w.y,P.z=w.z;var Lt=P,wt=Lt.x-V.x,kt=Lt.y-V.y,Bt=Lt.z-V.z;Lt.x=wt,Lt.y=kt,Lt.z=Bt,T.x=B.x,T.y=B.y,T.z=B.z;var At=T,Pt=At.x-V.x,St=At.y-V.y,Tt=At.z-V.z;At.x=Pt,At.y=St,At.z=Tt,j.x=P.x,j.y=P.y,j.z=P.z;var Ct=j,jt=Ct.y*T.z-Ct.z*T.y,Rt=Ct.z*T.x-Ct.x*T.z,qt=Ct.x*T.y-Ct.y*T.x;Ct.x=jt,Ct.y=Rt,Ct.z=qt;var Et=Ct,Dt=Math.sqrt(Et.x*Et.x+Et.y*Et.y+Et.z*Et.z);Dt>0&&(Dt=1/Dt);var Ft=Et.x*Dt,Nt=Et.y*Dt,Wt=Et.z*Dt;Et.x=Ft,Et.y=Nt,Et.z=Wt,i.triangle(V,w,B,j,j,j,r);var Gt=-j.x,Jt=-j.y,Ot=-j.z;j.x=Gt,j.y=Jt,j.z=Ot,i.triangle(V,B,w,j,j,j,r)}}}var Ht=this._pool;if(null!=V){if(V.zero(),Ht.sizeVec3==Ht.stackVec3.length){for(var Ut=Ht.sizeVec3<<1,Qt=new Array(Ut),Kt=0,$t=Ht.sizeVec3;Kt<$t;){var ti=Kt++;Qt[ti]=Ht.stackVec3[ti],Ht.stackVec3[ti]=null}Ht.stackVec3=Qt}Ht.stackVec3[Ht.sizeVec3++]=V}var ii=this._pool;if(null!=w){if(w.zero(),ii.sizeVec3==ii.stackVec3.length){for(var ai=ii.sizeVec3<<1,si=new Array(ai),oi=0,ni=ii.sizeVec3;oi<ni;){var ri=oi++;si[ri]=ii.stackVec3[ri],ii.stackVec3[ri]=null}ii.stackVec3=si}ii.stackVec3[ii.sizeVec3++]=w}var _i=this._pool;if(null!=B){if(B.zero(),_i.sizeVec3==_i.stackVec3.length){for(var ei=_i.sizeVec3<<1,hi=new Array(ei),li=0,ci=_i.sizeVec3;li<ci;){var mi=li++;hi[mi]=_i.stackVec3[mi],_i.stackVec3[mi]=null}_i.stackVec3=hi}_i.stackVec3[_i.sizeVec3++]=B}var vi=this._pool;if(null!=P){if(P.zero(),vi.sizeVec3==vi.stackVec3.length){for(var bi=vi.sizeVec3<<1,xi=new Array(bi),pi=0,fi=vi.sizeVec3;pi<fi;){var ui=pi++;xi[ui]=vi.stackVec3[ui],vi.stackVec3[ui]=null}vi.stackVec3=xi}vi.stackVec3[vi.sizeVec3++]=P}var yi=this._pool;if(null!=T){if(T.zero(),yi.sizeVec3==yi.stackVec3.length){for(var Xi=yi.sizeVec3<<1,gi=new Array(Xi),zi=0,di=yi.sizeVec3;zi<di;){var Yi=zi++;gi[Yi]=yi.stackVec3[Yi],yi.stackVec3[Yi]=null}yi.stackVec3=gi}yi.stackVec3[yi.sizeVec3++]=T}var Zi=this._pool;if(null!=j){if(j.zero(),Zi.sizeVec3==Zi.stackVec3.length){for(var Mi=Zi.sizeVec3<<1,Ii=new Array(Mi),Vi=0,Li=Zi.sizeVec3;Vi<Li;){var wi=Vi++;Ii[wi]=Zi.stackVec3[wi],Zi.stackVec3[wi]=null}Zi.stackVec3=Ii}Zi.stackVec3[Zi.sizeVec3++]=j}var ki=this._pool;if(null!=q){if(q.e00=1,q.e01=0,q.e02=0,q.e10=0,q.e11=1,q.e12=0,q.e20=0,q.e21=0,q.e22=1,ki.sizeMat3==ki.stackMat3.length){for(var Bi=ki.sizeMat3<<1,Ai=new Array(Bi),Pi=0,Si=ki.sizeMat3;Pi<Si;){var Ti=Pi++;Ai[Ti]=ki.stackMat3[Ti],ki.stackMat3[Ti]=null}ki.stackMat3=Ai}ki.stackMat3[ki.sizeMat3++]=q}var Ci=this._pool;if(null!=D){if(D.zero(),Ci.sizeVec3==Ci.stackVec3.length){for(var ji=Ci.sizeVec3<<1,Ri=new Array(ji),qi=0,Ei=Ci.sizeVec3;qi<Ei;){var Di=qi++;Ri[Di]=Ci.stackVec3[Di],Ci.stackVec3[Di]=null}Ci.stackVec3=Ri}Ci.stackVec3[Ci.sizeVec3++]=D}}}if(i.drawAabbs){var Fi=e._aabb,Ni=a.aabbColor,Wi=this._pool,Gi=0==Wi.sizeVec3?new t.common.Vec3:Wi.stackVec3[--Wi.sizeVec3],Ji=this._pool,Oi=0==Ji.sizeVec3?new t.common.Vec3:Ji.stackVec3[--Ji.sizeVec3],Hi=Gi;Hi.x=Fi._minX,Hi.y=Fi._minY,Hi.z=Fi._minZ;var Ui=Oi;Ui.x=Fi._maxX,Ui.y=Fi._maxY,Ui.z=Fi._maxZ,i.aabb(Gi,Oi,Ni);var Qi=this._pool;if(null!=Gi){if(Gi.zero(),Qi.sizeVec3==Qi.stackVec3.length){for(var Ki=Qi.sizeVec3<<1,$i=new Array(Ki),ta=0,ia=Qi.sizeVec3;ta<ia;){var aa=ta++;$i[aa]=Qi.stackVec3[aa],Qi.stackVec3[aa]=null}Qi.stackVec3=$i}Qi.stackVec3[Qi.sizeVec3++]=Gi}var sa=this._pool;if(null!=Oi){if(Oi.zero(),sa.sizeVec3==sa.stackVec3.length){for(var oa=sa.sizeVec3<<1,na=new Array(oa),ra=0,_a=sa.sizeVec3;ra<_a;){var ea=ra++;na[ea]=sa.stackVec3[ea],sa.stackVec3[ea]=null}sa.stackVec3=na}sa.stackVec3[sa.sizeVec3++]=Oi}}e=h}s=o}}_drawConstraints(i){var a=i.style;if(i.drawPairs||i.drawContacts)for(var s=this._contactManager._contactList;null!=s;){var o=s._next;if(i.drawPairs){var n=a.pairColor,r=this._pool,_=0==r.sizeVec3?new t.common.Vec3:r.stackVec3[--r.sizeVec3],e=this._pool,h=0==e.sizeVec3?new t.common.Vec3:e.stackVec3[--e.sizeVec3],l=_;l.x=s._s1._transform._positionX,l.y=s._s1._transform._positionY,l.z=s._s1._transform._positionZ;var c=h;c.x=s._s2._transform._positionX,c.y=s._s2._transform._positionY,c.z=s._s2._transform._positionZ,i.line(_,h,n);var m=this._pool;if(null!=_){if(_.zero(),m.sizeVec3==m.stackVec3.length){for(var v=m.sizeVec3<<1,b=new Array(v),x=0,p=m.sizeVec3;x<p;){var f=x++;b[f]=m.stackVec3[f],m.stackVec3[f]=null}m.stackVec3=b}m.stackVec3[m.sizeVec3++]=_}var u=this._pool;if(null!=h){if(h.zero(),u.sizeVec3==u.stackVec3.length){for(var y=u.sizeVec3<<1,X=new Array(y),g=0,z=u.sizeVec3;g<z;){var d=g++;X[d]=u.stackVec3[d],u.stackVec3[d]=null}u.stackVec3=X}u.stackVec3[u.sizeVec3++]=h}}if(i.drawContacts)for(var Y=s._contactConstraint,Z=s._contactConstraint._manifold._points,M=0,I=s._contactConstraint._manifold._numPoints;M<I;){var V=Z[M++],L=i.style;Y._s1._transform,Y._s2._transform;var w=this._pool,k=0==w.sizeVec3?new t.common.Vec3:w.stackVec3[--w.sizeVec3],B=this._pool,A=0==B.sizeVec3?new t.common.Vec3:B.stackVec3[--B.sizeVec3],P=this._pool,S=0==P.sizeVec3?new t.common.Vec3:P.stackVec3[--P.sizeVec3],T=this._pool,C=0==T.sizeVec3?new t.common.Vec3:T.stackVec3[--T.sizeVec3],j=this._pool,R=0==j.sizeVec3?new t.common.Vec3:j.stackVec3[--j.sizeVec3],q=k;q.x=V._pos1X,q.y=V._pos1Y,q.z=V._pos1Z;var E=A;E.x=V._pos2X,E.y=V._pos2Y,E.z=V._pos2Z;var D=S;D.x=Y._manifold._normalX,D.y=Y._manifold._normalY,D.z=Y._manifold._normalZ;var F=C;F.x=Y._manifold._tangentX,F.y=Y._manifold._tangentY,F.z=Y._manifold._tangentZ;var N=R;if(N.x=Y._manifold._binormalX,N.y=Y._manifold._binormalY,N.z=Y._manifold._binormalZ,V._disabled)i.point(k,L.disabledContactColor),i.point(A,L.disabledContactColor),i.line(k,A,L.disabledContactColor);else if(V._warmStarted){var W;switch(3&V._id){case 0:W=L.contactColor;break;case 1:W=L.contactColor2;break;case 2:W=L.contactColor3;break;default:W=L.contactColor4}i.point(k,W),i.point(A,W),i.line(k,A,L.contactColor)}else i.point(k,L.newContactColor),i.point(A,L.newContactColor),i.line(k,A,L.newContactColor);A.x=k.x,A.y=k.y,A.z=k.z;var G=A,J=L.contactNormalLength,O=G.x+S.x*J,H=G.y+S.y*J,U=G.z+S.z*J;if(G.x=O,G.y=H,G.z=U,i.line(k,A,L.contactNormalColor),i.drawContactBases){A.x=k.x,A.y=k.y,A.z=k.z;var Q=A,K=L.contactTangentLength,$=Q.x+C.x*K,tt=Q.y+C.y*K,it=Q.z+C.z*K;Q.x=$,Q.y=tt,Q.z=it,i.line(k,A,L.contactTangentColor),A.x=k.x,A.y=k.y,A.z=k.z;var at=A,st=L.contactBinormalLength,ot=at.x+R.x*st,nt=at.y+R.y*st,rt=at.z+R.z*st;at.x=ot,at.y=nt,at.z=rt,i.line(k,A,L.contactBinormalColor)}var _t=this._pool;if(null!=k){if(k.zero(),_t.sizeVec3==_t.stackVec3.length){for(var et=_t.sizeVec3<<1,ht=new Array(et),lt=0,ct=_t.sizeVec3;lt<ct;){var mt=lt++;ht[mt]=_t.stackVec3[mt],_t.stackVec3[mt]=null}_t.stackVec3=ht}_t.stackVec3[_t.sizeVec3++]=k}var vt=this._pool;if(null!=A){if(A.zero(),vt.sizeVec3==vt.stackVec3.length){for(var bt=vt.sizeVec3<<1,xt=new Array(bt),pt=0,ft=vt.sizeVec3;pt<ft;){var ut=pt++;xt[ut]=vt.stackVec3[ut],vt.stackVec3[ut]=null}vt.stackVec3=xt}vt.stackVec3[vt.sizeVec3++]=A}var yt=this._pool;if(null!=S){if(S.zero(),yt.sizeVec3==yt.stackVec3.length){for(var Xt=yt.sizeVec3<<1,gt=new Array(Xt),zt=0,dt=yt.sizeVec3;zt<dt;){var Yt=zt++;gt[Yt]=yt.stackVec3[Yt],yt.stackVec3[Yt]=null}yt.stackVec3=gt}yt.stackVec3[yt.sizeVec3++]=S}var Zt=this._pool;if(null!=C){if(C.zero(),Zt.sizeVec3==Zt.stackVec3.length){for(var Mt=Zt.sizeVec3<<1,It=new Array(Mt),Vt=0,Lt=Zt.sizeVec3;Vt<Lt;){var wt=Vt++;It[wt]=Zt.stackVec3[wt],Zt.stackVec3[wt]=null}Zt.stackVec3=It}Zt.stackVec3[Zt.sizeVec3++]=C}var kt=this._pool;if(null!=R){if(R.zero(),kt.sizeVec3==kt.stackVec3.length){for(var Bt=kt.sizeVec3<<1,At=new Array(Bt),Pt=0,St=kt.sizeVec3;Pt<St;){var Tt=Pt++;At[Tt]=kt.stackVec3[Tt],kt.stackVec3[Tt]=null}kt.stackVec3=At}kt.stackVec3[kt.sizeVec3++]=R}}s=o}if(i.drawJoints)for(var Ct=this._jointList;null!=Ct;){var jt=Ct._next,Rt=this._pool,qt=0==Rt.sizeVec3?new t.common.Vec3:Rt.stackVec3[--Rt.sizeVec3],Et=this._pool,Dt=0==Et.sizeVec3?new t.common.Vec3:Et.stackVec3[--Et.sizeVec3],Ft=qt;Ft.x=Ct._b1._transform._positionX,Ft.y=Ct._b1._transform._positionY,Ft.z=Ct._b1._transform._positionZ;var Nt=Dt;Nt.x=Ct._b2._transform._positionX,Nt.y=Ct._b2._transform._positionY,Nt.z=Ct._b2._transform._positionZ;var Wt=this._pool,Gt=0==Wt.sizeVec3?new t.common.Vec3:Wt.stackVec3[--Wt.sizeVec3],Jt=this._pool,Ot=0==Jt.sizeVec3?new t.common.Vec3:Jt.stackVec3[--Jt.sizeVec3],Ht=this._pool,Ut=0==Ht.sizeVec3?new t.common.Vec3:Ht.stackVec3[--Ht.sizeVec3],Qt=this._pool,Kt=0==Qt.sizeVec3?new t.common.Vec3:Qt.stackVec3[--Qt.sizeVec3],$t=this._pool,ti=0==$t.sizeVec3?new t.common.Vec3:$t.stackVec3[--$t.sizeVec3],ii=this._pool,ai=0==ii.sizeVec3?new t.common.Vec3:ii.stackVec3[--ii.sizeVec3],si=this._pool,oi=0==si.sizeVec3?new t.common.Vec3:si.stackVec3[--si.sizeVec3],ni=this._pool,ri=0==ni.sizeVec3?new t.common.Vec3:ni.stackVec3[--ni.sizeVec3],_i=Gt;_i.x=Ct._anchor1X,_i.y=Ct._anchor1Y,_i.z=Ct._anchor1Z;var ei=Ot;ei.x=Ct._anchor2X,ei.y=Ct._anchor2Y,ei.z=Ct._anchor2Z;var hi=Ut;hi.x=Ct._basisX1X,hi.y=Ct._basisX1Y,hi.z=Ct._basisX1Z;var li=Kt;li.x=Ct._basisY1X,li.y=Ct._basisY1Y,li.z=Ct._basisY1Z;var ci=ti;ci.x=Ct._basisZ1X,ci.y=Ct._basisZ1Y,ci.z=Ct._basisZ1Z;var mi=ai;mi.x=Ct._basisX2X,mi.y=Ct._basisX2Y,mi.z=Ct._basisX2Z;var vi=oi;vi.x=Ct._basisY2X,vi.y=Ct._basisY2Y,vi.z=Ct._basisY2Z;var bi=ri;if(bi.x=Ct._basisZ2X,bi.y=Ct._basisZ2Y,bi.z=Ct._basisZ2Z,i.line(qt,Gt,i.style.jointLineColor),i.line(Dt,Ot,i.style.jointLineColor),i.drawJointLimits)switch(Ct._type){case 0:break;case 1:var xi=i.style.jointRotationalConstraintRadius,pi=i.style.jointLineColor,fi=Ct._lm;this._drawRotationalLimit(i,Gt,Kt,ti,oi,xi,fi.lowerLimit,fi.upperLimit,pi);break;case 2:var ui=Ct,yi=i.style.jointRotationalConstraintRadius,Xi=i.style.jointLineColor,gi=ui._rotLm,zi=ui._translLm;this._drawRotationalLimit(i,Ot,Kt,ti,oi,yi,gi.lowerLimit,gi.upperLimit,Xi),this._drawTranslationalLimit(i,Gt,Ut,zi.lowerLimit,zi.upperLimit,Xi);break;case 3:i.style.jointRotationalConstraintRadius;var di=i.style.jointLineColor,Yi=Ct._lm;this._drawTranslationalLimit(i,Gt,Ut,Yi.lowerLimit,Yi.upperLimit,di);break;case 4:var Zi=Ct,Mi=i.style.jointRotationalConstraintRadius,Ii=i.style.jointLineColor,Vi=Zi._lm1,Li=Zi._lm2;this._drawRotationalLimit(i,Gt,Kt,ti,Kt,Mi,Zi._angleX-Vi.upperLimit,Zi._angleX-Vi.lowerLimit,Ii),this._drawRotationalLimit(i,Ot,ai,oi,ai,Mi,Li.lowerLimit-Zi._angleZ,Li.upperLimit-Zi._angleZ,Ii);break;case 5:var wi=Ct,ki=i.style.jointRotationalConstraintRadius,Bi=i.style.jointLineColor,Ai=wi._twistLm;this._drawRotationalLimit(i,Ot,oi,ri,oi,ki,Ai.lowerLimit-wi._twistAngle,Ai.upperLimit-wi._twistAngle,Bi),this._drawEllipseOnSphere(i,Gt,Ut,Kt,ti,wi._maxSwingAngle1,wi._maxSwingAngle2,ki,Bi);var Pi=this._pool,Si=0==Pi.sizeVec3?new t.common.Vec3:Pi.stackVec3[--Pi.sizeVec3];Si.x=Ot.x,Si.y=Ot.y,Si.z=Ot.z;var Ti=Si,Ci=Ti.x+ai.x*ki,ji=Ti.y+ai.y*ki,Ri=Ti.z+ai.z*ki;Ti.x=Ci,Ti.y=ji,Ti.z=Ri;var qi=Ti;i.line(Ot,qi,Bi);var Ei=this._pool;if(null!=qi){if(qi.zero(),Ei.sizeVec3==Ei.stackVec3.length){for(var Di=Ei.sizeVec3<<1,Fi=new Array(Di),Ni=0,Wi=Ei.sizeVec3;Ni<Wi;){var Gi=Ni++;Fi[Gi]=Ei.stackVec3[Gi],Ei.stackVec3[Gi]=null}Ei.stackVec3=Fi}Ei.stackVec3[Ei.sizeVec3++]=qi}break;case 6:var Ji=Ct,Oi=i.style.jointRotationalConstraintRadius,Hi=i.style.jointLineColor,Ui=Ji._translLms[0],Qi=Ji._translLms[1],Ki=Ji._translLms[2],$i=Ji._rotLms[0],ta=Ji._rotLms[1],ia=Ji._rotLms[2];this._drawTranslationalLimit3D(i,Gt,Ut,Kt,ti,Ui,Qi,Ki,Hi);var aa=this._pool,sa=0==aa.sizeVec3?new t.common.Vec3:aa.stackVec3[--aa.sizeVec3],oa=sa;oa.x=Ji._axisYX,oa.y=Ji._axisYY,oa.z=Ji._axisYZ;var na=this._pool,ra=0==na.sizeVec3?new t.common.Vec3:na.stackVec3[--na.sizeVec3];ra.x=Ut.x,ra.y=Ut.y,ra.z=Ut.z;var _a=ra,ea=this._pool,ha=0==ea.sizeVec3?new t.common.Vec3:ea.stackVec3[--ea.sizeVec3];ha.x=Ut.x,ha.y=Ut.y,ha.z=Ut.z;var la=ha,ca=la.y*sa.z-la.z*sa.y,ma=la.z*sa.x-la.x*sa.z,va=la.x*sa.y-la.y*sa.x;la.x=ca,la.y=ma,la.z=va;var ba=la;this._drawRotationalLimit(i,Ot,Kt,ti,Kt,Oi,Ji._angleX-$i.upperLimit,Ji._angleX-$i.lowerLimit,Hi),this._drawRotationalLimit(i,Ot,_a,ba,_a,Oi,ta.lowerLimit-Ji._angleY,ta.upperLimit-Ji._angleY,Hi),this._drawRotationalLimit(i,Ot,ai,oi,ai,Oi,ia.lowerLimit-Ji._angleZ,ia.upperLimit-Ji._angleZ,Hi)}i.line(Gt,Ot,i.style.jointErrorColor);var xa=this._pool;if(null!=qt){if(qt.zero(),xa.sizeVec3==xa.stackVec3.length){for(var pa=xa.sizeVec3<<1,fa=new Array(pa),ua=0,ya=xa.sizeVec3;ua<ya;){var Xa=ua++;fa[Xa]=xa.stackVec3[Xa],xa.stackVec3[Xa]=null}xa.stackVec3=fa}xa.stackVec3[xa.sizeVec3++]=qt}var ga=this._pool;if(null!=Dt){if(Dt.zero(),ga.sizeVec3==ga.stackVec3.length){for(var za=ga.sizeVec3<<1,da=new Array(za),Ya=0,Za=ga.sizeVec3;Ya<Za;){var Ma=Ya++;da[Ma]=ga.stackVec3[Ma],ga.stackVec3[Ma]=null}ga.stackVec3=da}ga.stackVec3[ga.sizeVec3++]=Dt}var Ia=this._pool;if(null!=Gt){if(Gt.zero(),Ia.sizeVec3==Ia.stackVec3.length){for(var Va=Ia.sizeVec3<<1,La=new Array(Va),wa=0,ka=Ia.sizeVec3;wa<ka;){var Ba=wa++;La[Ba]=Ia.stackVec3[Ba],Ia.stackVec3[Ba]=null}Ia.stackVec3=La}Ia.stackVec3[Ia.sizeVec3++]=Gt}var Aa=this._pool;if(null!=Ot){if(Ot.zero(),Aa.sizeVec3==Aa.stackVec3.length){for(var Pa=Aa.sizeVec3<<1,Sa=new Array(Pa),Ta=0,Ca=Aa.sizeVec3;Ta<Ca;){var ja=Ta++;Sa[ja]=Aa.stackVec3[ja],Aa.stackVec3[ja]=null}Aa.stackVec3=Sa}Aa.stackVec3[Aa.sizeVec3++]=Ot}var Ra=this._pool;if(null!=Ut){if(Ut.zero(),Ra.sizeVec3==Ra.stackVec3.length){for(var qa=Ra.sizeVec3<<1,Ea=new Array(qa),Da=0,Fa=Ra.sizeVec3;Da<Fa;){var Na=Da++;Ea[Na]=Ra.stackVec3[Na],Ra.stackVec3[Na]=null}Ra.stackVec3=Ea}Ra.stackVec3[Ra.sizeVec3++]=Ut}var Wa=this._pool;if(null!=Kt){if(Kt.zero(),Wa.sizeVec3==Wa.stackVec3.length){for(var Ga=Wa.sizeVec3<<1,Ja=new Array(Ga),Oa=0,Ha=Wa.sizeVec3;Oa<Ha;){var Ua=Oa++;Ja[Ua]=Wa.stackVec3[Ua],Wa.stackVec3[Ua]=null}Wa.stackVec3=Ja}Wa.stackVec3[Wa.sizeVec3++]=Kt}var Qa=this._pool;if(null!=ti){if(ti.zero(),Qa.sizeVec3==Qa.stackVec3.length){for(var Ka=Qa.sizeVec3<<1,$a=new Array(Ka),ts=0,is=Qa.sizeVec3;ts<is;){var as=ts++;$a[as]=Qa.stackVec3[as],Qa.stackVec3[as]=null}Qa.stackVec3=$a}Qa.stackVec3[Qa.sizeVec3++]=ti}var ss=this._pool;if(null!=ai){if(ai.zero(),ss.sizeVec3==ss.stackVec3.length){for(var os=ss.sizeVec3<<1,ns=new Array(os),rs=0,_s=ss.sizeVec3;rs<_s;){var es=rs++;ns[es]=ss.stackVec3[es],ss.stackVec3[es]=null}ss.stackVec3=ns}ss.stackVec3[ss.sizeVec3++]=ai}var hs=this._pool;if(null!=oi){if(oi.zero(),hs.sizeVec3==hs.stackVec3.length){for(var ls=hs.sizeVec3<<1,cs=new Array(ls),ms=0,vs=hs.sizeVec3;ms<vs;){var bs=ms++;cs[bs]=hs.stackVec3[bs],hs.stackVec3[bs]=null}hs.stackVec3=cs}hs.stackVec3[hs.sizeVec3++]=oi}var xs=this._pool;if(null!=ri){if(ri.zero(),xs.sizeVec3==xs.stackVec3.length){for(var ps=xs.sizeVec3<<1,fs=new Array(ps),us=0,ys=xs.sizeVec3;us<ys;){var Xs=us++;fs[Xs]=xs.stackVec3[Xs],xs.stackVec3[Xs]=null}xs.stackVec3=fs}xs.stackVec3[xs.sizeVec3++]=ri}Ct=jt}}_drawRotationalLimit(i,a,s,o,n,r,_,e,h){if(_!=e){var l=this._pool,c=0==l.sizeVec3?new t.common.Vec3:l.stackVec3[--l.sizeVec3];c.x=a.x,c.y=a.y,c.z=a.z;var m=c,v=m.x+n.x*r,b=m.y+n.y*r,x=m.z+n.z*r;m.x=v,m.y=b,m.z=x;var p=m;i.line(a,p,h);var f=this._pool;if(null!=p){if(p.zero(),f.sizeVec3==f.stackVec3.length){for(var u=f.sizeVec3<<1,y=new Array(u),X=0,g=f.sizeVec3;X<g;){var z=X++;y[z]=f.stackVec3[z],f.stackVec3[z]=null}f.stackVec3=y}f.stackVec3[f.sizeVec3++]=p}_>e?i.ellipse(a,s,o,r,r,h):i.arc(a,s,o,r,r,_,e,!0,h)}}_drawTranslationalLimit(i,a,s,o,n,r){if(o<n){var _=this._pool,e=0==_.sizeVec3?new t.common.Vec3:_.stackVec3[--_.sizeVec3];e.x=a.x,e.y=a.y,e.z=a.z;var h=e,l=h.x+s.x*o,c=h.y+s.y*o,m=h.z+s.z*o;h.x=l,h.y=c,h.z=m;var v=h,b=this._pool,x=0==b.sizeVec3?new t.common.Vec3:b.stackVec3[--b.sizeVec3];x.x=a.x,x.y=a.y,x.z=a.z;var p=x,f=p.x+s.x*n,u=p.y+s.y*n,y=p.z+s.z*n;p.x=f,p.y=u,p.z=y;var X=p;i.line(v,X,r);var g=this._pool;if(null!=v){if(v.zero(),g.sizeVec3==g.stackVec3.length){for(var z=g.sizeVec3<<1,d=new Array(z),Y=0,Z=g.sizeVec3;Y<Z;){var M=Y++;d[M]=g.stackVec3[M],g.stackVec3[M]=null}g.stackVec3=d}g.stackVec3[g.sizeVec3++]=v}var I=this._pool;if(null!=X){if(X.zero(),I.sizeVec3==I.stackVec3.length){for(var V=I.sizeVec3<<1,L=new Array(V),w=0,k=I.sizeVec3;w<k;){var B=w++;L[B]=I.stackVec3[B],I.stackVec3[B]=null}I.stackVec3=L}I.stackVec3[I.sizeVec3++]=X}}}_drawTranslationalLimit3D(i,a,s,o,n,r,_,e,h){var l=r.lowerLimit,c=r.upperLimit,m=_.lowerLimit,v=_.upperLimit,b=e.lowerLimit,x=e.upperLimit,p=this._pool;0==p.sizeVec3?new t.common.Vec3:p.stackVec3[--p.sizeVec3];var f=this._pool;0==f.sizeVec3?new t.common.Vec3:f.stackVec3[--f.sizeVec3];var u=this._pool,y=0==u.sizeVec3?new t.common.Vec3:u.stackVec3[--u.sizeVec3];y.x=a.x,y.y=a.y,y.z=a.z;var X=y,g=X.x+s.x*l,z=X.y+s.y*l,d=X.z+s.z*l;X.x=g,X.y=z,X.z=d;var Y=X,Z=Y.x+o.x*m,M=Y.y+o.y*m,I=Y.z+o.z*m;Y.x=Z,Y.y=M,Y.z=I;var V=Y,L=V.x+n.x*b,w=V.y+n.y*b,k=V.z+n.z*b;V.x=L,V.y=w,V.z=k;var B=V,A=this._pool,P=0==A.sizeVec3?new t.common.Vec3:A.stackVec3[--A.sizeVec3];P.x=a.x,P.y=a.y,P.z=a.z;var S=P,T=S.x+s.x*l,C=S.y+s.y*l,j=S.z+s.z*l;S.x=T,S.y=C,S.z=j;var R=S,q=R.x+o.x*m,E=R.y+o.y*m,D=R.z+o.z*m;R.x=q,R.y=E,R.z=D;var F=R,N=F.x+n.x*x,W=F.y+n.y*x,G=F.z+n.z*x;F.x=N,F.y=W,F.z=G;var J=F,O=this._pool,H=0==O.sizeVec3?new t.common.Vec3:O.stackVec3[--O.sizeVec3];H.x=a.x,H.y=a.y,H.z=a.z;var U=H,Q=U.x+s.x*l,K=U.y+s.y*l,$=U.z+s.z*l;U.x=Q,U.y=K,U.z=$;var tt=U,it=tt.x+o.x*v,at=tt.y+o.y*v,st=tt.z+o.z*v;tt.x=it,tt.y=at,tt.z=st;var ot=tt,nt=ot.x+n.x*b,rt=ot.y+n.y*b,_t=ot.z+n.z*b;ot.x=nt,ot.y=rt,ot.z=_t;var et=ot,ht=this._pool,lt=0==ht.sizeVec3?new t.common.Vec3:ht.stackVec3[--ht.sizeVec3];lt.x=a.x,lt.y=a.y,lt.z=a.z;var ct=lt,mt=ct.x+s.x*l,vt=ct.y+s.y*l,bt=ct.z+s.z*l;ct.x=mt,ct.y=vt,ct.z=bt;var xt=ct,pt=xt.x+o.x*v,ft=xt.y+o.y*v,ut=xt.z+o.z*v;xt.x=pt,xt.y=ft,xt.z=ut;var yt=xt,Xt=yt.x+n.x*x,gt=yt.y+n.y*x,zt=yt.z+n.z*x;yt.x=Xt,yt.y=gt,yt.z=zt;var dt=yt,Yt=this._pool,Zt=0==Yt.sizeVec3?new t.common.Vec3:Yt.stackVec3[--Yt.sizeVec3];Zt.x=a.x,Zt.y=a.y,Zt.z=a.z;var Mt=Zt,It=Mt.x+s.x*c,Vt=Mt.y+s.y*c,Lt=Mt.z+s.z*c;Mt.x=It,Mt.y=Vt,Mt.z=Lt;var wt=Mt,kt=wt.x+o.x*m,Bt=wt.y+o.y*m,At=wt.z+o.z*m;wt.x=kt,wt.y=Bt,wt.z=At;var Pt=wt,St=Pt.x+n.x*b,Tt=Pt.y+n.y*b,Ct=Pt.z+n.z*b;Pt.x=St,Pt.y=Tt,Pt.z=Ct;var jt=Pt,Rt=this._pool,qt=0==Rt.sizeVec3?new t.common.Vec3:Rt.stackVec3[--Rt.sizeVec3];qt.x=a.x,qt.y=a.y,qt.z=a.z;var Et=qt,Dt=Et.x+s.x*c,Ft=Et.y+s.y*c,Nt=Et.z+s.z*c;Et.x=Dt,Et.y=Ft,Et.z=Nt;var Wt=Et,Gt=Wt.x+o.x*m,Jt=Wt.y+o.y*m,Ot=Wt.z+o.z*m;Wt.x=Gt,Wt.y=Jt,Wt.z=Ot;var Ht=Wt,Ut=Ht.x+n.x*x,Qt=Ht.y+n.y*x,Kt=Ht.z+n.z*x;Ht.x=Ut,Ht.y=Qt,Ht.z=Kt;var $t=Ht,ti=this._pool,ii=0==ti.sizeVec3?new t.common.Vec3:ti.stackVec3[--ti.sizeVec3];ii.x=a.x,ii.y=a.y,ii.z=a.z;var ai=ii,si=ai.x+s.x*c,oi=ai.y+s.y*c,ni=ai.z+s.z*c;ai.x=si,ai.y=oi,ai.z=ni;var ri=ai,_i=ri.x+o.x*v,ei=ri.y+o.y*v,hi=ri.z+o.z*v;ri.x=_i,ri.y=ei,ri.z=hi;var li=ri,ci=li.x+n.x*b,mi=li.y+n.y*b,vi=li.z+n.z*b;li.x=ci,li.y=mi,li.z=vi;var bi=li,xi=this._pool,pi=0==xi.sizeVec3?new t.common.Vec3:xi.stackVec3[--xi.sizeVec3];pi.x=a.x,pi.y=a.y,pi.z=a.z;var fi=pi,ui=fi.x+s.x*c,yi=fi.y+s.y*c,Xi=fi.z+s.z*c;fi.x=ui,fi.y=yi,fi.z=Xi;var gi=fi,zi=gi.x+o.x*v,di=gi.y+o.y*v,Yi=gi.z+o.z*v;gi.x=zi,gi.y=di,gi.z=Yi;var Zi=gi,Mi=Zi.x+n.x*x,Ii=Zi.y+n.y*x,Vi=Zi.z+n.z*x;Zi.x=Mi,Zi.y=Ii,Zi.z=Vi;var Li=Zi;i.line(B,jt,h),i.line(et,bi,h),i.line(J,$t,h),i.line(dt,Li,h),i.line(B,et,h),i.line(jt,bi,h),i.line(J,dt,h),i.line($t,Li,h),i.line(B,J,h),i.line(jt,$t,h),i.line(et,dt,h),i.line(bi,Li,h);var wi=this._pool;if(null!=B){if(B.zero(),wi.sizeVec3==wi.stackVec3.length){for(var ki=wi.sizeVec3<<1,Bi=new Array(ki),Ai=0,Pi=wi.sizeVec3;Ai<Pi;){var Si=Ai++;Bi[Si]=wi.stackVec3[Si],wi.stackVec3[Si]=null}wi.stackVec3=Bi}wi.stackVec3[wi.sizeVec3++]=B}var Ti=this._pool;if(null!=J){if(J.zero(),Ti.sizeVec3==Ti.stackVec3.length){for(var Ci=Ti.sizeVec3<<1,ji=new Array(Ci),Ri=0,qi=Ti.sizeVec3;Ri<qi;){var Ei=Ri++;ji[Ei]=Ti.stackVec3[Ei],Ti.stackVec3[Ei]=null}Ti.stackVec3=ji}Ti.stackVec3[Ti.sizeVec3++]=J}var Di=this._pool;if(null!=et){if(et.zero(),Di.sizeVec3==Di.stackVec3.length){for(var Fi=Di.sizeVec3<<1,Ni=new Array(Fi),Wi=0,Gi=Di.sizeVec3;Wi<Gi;){var Ji=Wi++;Ni[Ji]=Di.stackVec3[Ji],Di.stackVec3[Ji]=null}Di.stackVec3=Ni}Di.stackVec3[Di.sizeVec3++]=et}var Oi=this._pool;if(null!=dt){if(dt.zero(),Oi.sizeVec3==Oi.stackVec3.length){for(var Hi=Oi.sizeVec3<<1,Ui=new Array(Hi),Qi=0,Ki=Oi.sizeVec3;Qi<Ki;){var $i=Qi++;Ui[$i]=Oi.stackVec3[$i],Oi.stackVec3[$i]=null}Oi.stackVec3=Ui}Oi.stackVec3[Oi.sizeVec3++]=dt}var ta=this._pool;if(null!=jt){if(jt.zero(),ta.sizeVec3==ta.stackVec3.length){for(var ia=ta.sizeVec3<<1,aa=new Array(ia),sa=0,oa=ta.sizeVec3;sa<oa;){var na=sa++;aa[na]=ta.stackVec3[na],ta.stackVec3[na]=null}ta.stackVec3=aa}ta.stackVec3[ta.sizeVec3++]=jt}var ra=this._pool;if(null!=$t){if($t.zero(),ra.sizeVec3==ra.stackVec3.length){for(var _a=ra.sizeVec3<<1,ea=new Array(_a),ha=0,la=ra.sizeVec3;ha<la;){var ca=ha++;ea[ca]=ra.stackVec3[ca],ra.stackVec3[ca]=null}ra.stackVec3=ea}ra.stackVec3[ra.sizeVec3++]=$t}var ma=this._pool;if(null!=bi){if(bi.zero(),ma.sizeVec3==ma.stackVec3.length){for(var va=ma.sizeVec3<<1,ba=new Array(va),xa=0,pa=ma.sizeVec3;xa<pa;){var fa=xa++;ba[fa]=ma.stackVec3[fa],ma.stackVec3[fa]=null}ma.stackVec3=ba}ma.stackVec3[ma.sizeVec3++]=bi}var ua=this._pool;if(null!=Li){if(Li.zero(),ua.sizeVec3==ua.stackVec3.length){for(var ya=ua.sizeVec3<<1,Xa=new Array(ya),ga=0,za=ua.sizeVec3;ga<za;){var da=ga++;Xa[da]=ua.stackVec3[da],ua.stackVec3[da]=null}ua.stackVec3=Xa}ua.stackVec3[ua.sizeVec3++]=Li}}_drawEllipseOnSphere(i,a,s,o,n,r,_,e,h){for(var l=0,c=this._pool,m=0==c.sizeVec3?new t.common.Vec3:c.stackVec3[--c.sizeVec3],v=this._pool,b=0==v.sizeQuat?new t.common.Quat:v.stackQuat[--v.sizeQuat],x=this._pool,p=0==x.sizeMat3?new t.common.Mat3:x.stackMat3[--x.sizeMat3],f=this._pool,u=0==f.sizeVec3?new t.common.Vec3:f.stackVec3[--f.sizeVec3],y=0;y<17;){var X=y++,g=Math.cos(l)*r,z=Math.sin(l)*_,d=Math.sqrt(g*g+z*z),Y=Math.sin(.5*d),Z=Math.cos(.5*d),M=m.zero(),I=M.x+o.x*g,V=M.y+o.y*g,L=M.z+o.z*g;M.x=I,M.y=V,M.z=L;var w=M,k=w.x+n.x*z,B=w.y+n.y*z,A=w.z+n.z*z;w.x=k,w.y=B,w.z=A;var P=1/d*Y,S=m.x*P,T=m.y*P,C=m.z*P;m.x=S,m.y=T,m.z=C,b.x=m.x,b.y=m.y,b.z=m.z,b.w=Z;var j=b.x,R=b.y,q=b.z,E=b.w,D=2*j,F=2*R,N=2*q,W=j*D,G=R*F,J=q*N,O=j*F,H=R*N,U=j*N,Q=E*D,K=E*F,$=E*N;p.e00=1-G-J,p.e01=O-$,p.e02=U+K,p.e10=O+$,p.e11=1-W-J,p.e12=H-Q,p.e20=U-K,p.e21=H+Q,p.e22=1-W-G;var tt=this._pool,it=0==tt.sizeVec3?new t.common.Vec3:tt.stackVec3[--tt.sizeVec3],at=it.x+s.x*e,st=it.y+s.y*e,ot=it.z+s.z*e;it.x=at,it.y=st,it.z=ot;var nt=it,rt=nt.x*p.e00+nt.y*p.e01+nt.z*p.e02,_t=nt.x*p.e10+nt.y*p.e11+nt.z*p.e12,et=nt.x*p.e20+nt.y*p.e21+nt.z*p.e22;nt.x=rt,nt.y=_t,nt.z=et;var ht=nt,lt=ht.x+a.x,ct=ht.y+a.y,mt=ht.z+a.z;ht.x=lt,ht.y=ct,ht.z=mt,X>=1&&i.line(u,nt,h);var vt=this._pool;if(null!=u){if(u.zero(),vt.sizeVec3==vt.stackVec3.length){for(var bt=vt.sizeVec3<<1,xt=new Array(bt),pt=0,ft=vt.sizeVec3;pt<ft;){var ut=pt++;xt[ut]=vt.stackVec3[ut],vt.stackVec3[ut]=null}vt.stackVec3=xt}vt.stackVec3[vt.sizeVec3++]=u}u=nt,l+=.39269908169872375}var yt=this._pool;if(null!=m){if(m.zero(),yt.sizeVec3==yt.stackVec3.length){for(var Xt=yt.sizeVec3<<1,gt=new Array(Xt),zt=0,dt=yt.sizeVec3;zt<dt;){var Yt=zt++;gt[Yt]=yt.stackVec3[Yt],yt.stackVec3[Yt]=null}yt.stackVec3=gt}yt.stackVec3[yt.sizeVec3++]=m}var Zt=this._pool;if(null!=b){if(b.x=0,b.y=0,b.z=0,b.w=1,Zt.sizeQuat==Zt.stackQuat.length){for(var Mt=Zt.sizeQuat<<1,It=new Array(Mt),Vt=0,Lt=Zt.sizeQuat;Vt<Lt;){var wt=Vt++;It[wt]=Zt.stackQuat[wt],Zt.stackQuat[wt]=null}Zt.stackQuat=It}Zt.stackQuat[Zt.sizeQuat++]=b}var kt=this._pool;if(null!=p){if(p.e00=1,p.e01=0,p.e02=0,p.e10=0,p.e11=1,p.e12=0,p.e20=0,p.e21=0,p.e22=1,kt.sizeMat3==kt.stackMat3.length){for(var Bt=kt.sizeMat3<<1,At=new Array(Bt),Pt=0,St=kt.sizeMat3;Pt<St;){var Tt=Pt++;At[Tt]=kt.stackMat3[Tt],kt.stackMat3[Tt]=null}kt.stackMat3=At}kt.stackMat3[kt.sizeMat3++]=p}var Ct=this._pool;if(null!=u){if(u.zero(),Ct.sizeVec3==Ct.stackVec3.length){for(var jt=Ct.sizeVec3<<1,Rt=new Array(jt),qt=0,Et=Ct.sizeVec3;qt<Et;){var Dt=qt++;Rt[Dt]=Ct.stackVec3[Dt],Ct.stackVec3[Dt]=null}Ct.stackVec3=Rt}Ct.stackVec3[Ct.sizeVec3++]=u}}step(i){this._timeStep.dt>0&&(this._timeStep.dtRatio=i/this._timeStep.dt),this._timeStep.dt=i,this._timeStep.invDt=1/i;var a=Date.now()/1e3;this._updateContacts(),this._solveIslands();var s=Date.now()/1e3;t.dynamics.common.Performance.totalTime=1e3*(s-a)}addRigidBody(t){if(null!=t._world)throw new Error("A rigid body cannot belong to multiple worlds.");null==this._rigidBodyList?(this._rigidBodyList=t,this._rigidBodyListLast=t):(this._rigidBodyListLast._next=t,t._prev=this._rigidBodyListLast,this._rigidBodyListLast=t),t._world=this;for(var i=t._shapeList;null!=i;){var a=i._next;i._proxy=this._broadPhase.createProxy(i,i._aabb),i._id=this._shapeIdCount++,this._numShapes++,i=a}this._numRigidBodies++}removeRigidBody(t){if(t._world!=this)throw new Error("The rigid body doesn't belong to the world.");var i=t._prev,a=t._next;null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._rigidBodyList&&(this._rigidBodyList=this._rigidBodyList._next),t==this._rigidBodyListLast&&(this._rigidBodyListLast=this._rigidBodyListLast._prev),t._next=null,t._prev=null,t._world=null;for(var s=t._shapeList;null!=s;){var o=s._next;this._broadPhase.destroyProxy(s._proxy),s._proxy=null,s._id=-1;for(var n=s._rigidBody._contactLinkList;null!=n;){var r=n._next,_=n._contact;if(_._s1==s||_._s2==s){var e=n._other;e._sleeping=!1,e._sleepTime=0;var h=this._contactManager,l=_._prev,c=_._next;if(null!=l&&(l._next=c),null!=c&&(c._prev=l),_==h._contactList&&(h._contactList=h._contactList._next),_==h._contactListLast&&(h._contactListLast=h._contactListLast._prev),_._next=null,_._prev=null,_._touching){var m=_._s1._contactCallback,v=_._s2._contactCallback;m==v&&(v=null),null!=m&&m.endContact(_),null!=v&&v.endContact(_)}var b=_._link1._prev,x=_._link1._next;null!=b&&(b._next=x),null!=x&&(x._prev=b),_._link1==_._b1._contactLinkList&&(_._b1._contactLinkList=_._b1._contactLinkList._next),_._link1==_._b1._contactLinkListLast&&(_._b1._contactLinkListLast=_._b1._contactLinkListLast._prev),_._link1._next=null,_._link1._prev=null;var p=_._link2._prev,f=_._link2._next;null!=p&&(p._next=f),null!=f&&(f._prev=p),_._link2==_._b2._contactLinkList&&(_._b2._contactLinkList=_._b2._contactLinkList._next),_._link2==_._b2._contactLinkListLast&&(_._b2._contactLinkListLast=_._b2._contactLinkListLast._prev),_._link2._next=null,_._link2._prev=null,_._b1._numContactLinks--,_._b2._numContactLinks--,_._link1._other=null,_._link2._other=null,_._link1._contact=null,_._link2._contact=null,_._s1=null,_._s2=null,_._b1=null,_._b2=null,_._touching=!1,_._cachedDetectorData._clear(),_._manifold._clear(),_._detector=null;var u=_._contactConstraint;u._s1=null,u._s2=null,u._b1=null,u._b2=null,u._tf1=null,u._tf2=null,_._next=h._contactPool,h._contactPool=_,h._numContacts--}n=r}this._numShapes--,s=o}this._numRigidBodies--}addJoint(t){if(null!=t._world)throw new Error("A joint cannot belong to multiple worlds.");null==this._jointList?(this._jointList=t,this._jointListLast=t):(this._jointListLast._next=t,t._prev=this._jointListLast,this._jointListLast=t),t._world=this,t._link1._other=t._b2,t._link2._other=t._b1,null==t._b1._jointLinkList?(t._b1._jointLinkList=t._link1,t._b1._jointLinkListLast=t._link1):(t._b1._jointLinkListLast._next=t._link1,t._link1._prev=t._b1._jointLinkListLast,t._b1._jointLinkListLast=t._link1),null==t._b2._jointLinkList?(t._b2._jointLinkList=t._link2,t._b2._jointLinkListLast=t._link2):(t._b2._jointLinkListLast._next=t._link2,t._link2._prev=t._b2._jointLinkListLast,t._b2._jointLinkListLast=t._link2),t._b1._numJointLinks++,t._b2._numJointLinks++;var i=t._b1;i._sleeping=!1,i._sleepTime=0;var a=t._b2;a._sleeping=!1,a._sleepTime=0,t._syncAnchors(),this._numJoints++}removeJoint(t){if(t._world!=this)throw new Error("The joint doesn't belong to the world.");var i=t._prev,a=t._next;null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._jointList&&(this._jointList=this._jointList._next),t==this._jointListLast&&(this._jointListLast=this._jointListLast._prev),t._next=null,t._prev=null,t._world=null;var s=t._link1._prev,o=t._link1._next;null!=s&&(s._next=o),null!=o&&(o._prev=s),t._link1==t._b1._jointLinkList&&(t._b1._jointLinkList=t._b1._jointLinkList._next),t._link1==t._b1._jointLinkListLast&&(t._b1._jointLinkListLast=t._b1._jointLinkListLast._prev),t._link1._next=null,t._link1._prev=null;var n=t._link2._prev,r=t._link2._next;null!=n&&(n._next=r),null!=r&&(r._prev=n),t._link2==t._b2._jointLinkList&&(t._b2._jointLinkList=t._b2._jointLinkList._next),t._link2==t._b2._jointLinkListLast&&(t._b2._jointLinkListLast=t._b2._jointLinkListLast._prev),t._link2._next=null,t._link2._prev=null,t._link1._other=null,t._link2._other=null,t._b1._numJointLinks--,t._b2._numJointLinks--;var _=t._b1;_._sleeping=!1,_._sleepTime=0;var e=t._b2;e._sleeping=!1,e._sleepTime=0,this._numJoints--}setDebugDraw(t){this._debugDraw=t}getDebugDraw(){return this._debugDraw}debugDraw(){if(null!=this._debugDraw){if(2==this._broadPhase._type){var t=this._broadPhase;this._drawBvh(this._debugDraw,t._tree)}this._drawRigidBodies(this._debugDraw),this._drawConstraints(this._debugDraw)}}rayCast(t,i,a){var s=this._rayCastWrapper.begin;s.x=t.x,s.y=t.y,s.z=t.z;var o=this._rayCastWrapper.end;o.x=i.x,o.y=i.y,o.z=i.z,this._rayCastWrapper.callback=a,this._broadPhase.rayCast(t,i,this._rayCastWrapper)}convexCast(t,i,a,s){this._convexCastWrapper.convex=t;var o=this._convexCastWrapper.begin;o._positionX=i._positionX,o._positionY=i._positionY,o._positionZ=i._positionZ,o._rotation00=i._rotation00,o._rotation01=i._rotation01,o._rotation02=i._rotation02,o._rotation10=i._rotation10,o._rotation11=i._rotation11,o._rotation12=i._rotation12,o._rotation20=i._rotation20,o._rotation21=i._rotation21,o._rotation22=i._rotation22;var n=this._convexCastWrapper.translation;n.x=a.x,n.y=a.y,n.z=a.z,this._convexCastWrapper.callback=s,this._broadPhase.convexCast(t,i,a,this._convexCastWrapper)}aabbTest(t,i){this._aabbTestWrapper._aabb.copyFrom(t),this._aabbTestWrapper._callback=i,this._broadPhase.aabbTest(t,this._aabbTestWrapper)}getRigidBodyList(){return this._rigidBodyList}getJointList(){return this._jointList}getBroadPhase(){return this._broadPhase}getContactManager(){return this._contactManager}getNumRigidBodies(){return this._numRigidBodies}getNumJoints(){return this._numJoints}getNumShapes(){return this._numShapes}getNumIslands(){return this._numIslands}getNumVelocityIterations(){return this._numVelocityIterations}setNumVelocityIterations(t){this._numVelocityIterations=t}getNumPositionIterations(){return this._numPositionIterations}setNumPositionIterations(t){this._numPositionIterations=t}getGravity(){return this._gravity}setGravity(t){var i=this._gravity;i.x=t.x,i.y=t.y,i.z=t.z}},t.dynamics._World||(t.dynamics._World={}),t.dynamics._World.RayCastWrapper=class extends t.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new t.collision.geometry.RayCastHit,this.begin=new t.common.Vec3,this.end=new t.common.Vec3,this.callback=null}process(t){var i=t.userData;i._geom.rayCast(this.begin,this.end,i._transform,this.rayCastHit)&&this.callback.process(i,this.rayCastHit)}},t.dynamics._World.ConvexCastWrapper=class extends t.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new t.collision.geometry.RayCastHit,this.begin=new t.common.Transform,this.translation=new t.common.Vec3,this.zero=new t.common.Vec3,this.callback=null,this.convex=null}process(i){var a=i.userData,s=a._geom._type;if(!(s<0||s>5)){var o=a._geom;t.collision.narrowphase.detector.gjkepa.GjkEpa.instance.convexCast(this.convex,o,this.begin,a._transform,this.translation,this.zero,this.rayCastHit)&&this.callback.process(a,this.rayCastHit)}}},t.dynamics._World.AabbTestWrapper=class extends t.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this._aabb=new t.collision.geometry.Aabb,this._callback=null}process(t){var i=t.userData,a=i._aabb;a._minX<this._aabb._maxX&&a._maxX>this._aabb._minX&&a._minY<this._aabb._maxY&&a._maxY>this._aabb._minY&&a._minZ<this._aabb._maxZ&&a._maxZ>this._aabb._minZ&&this._callback.process(i)}},t.dynamics.callback||(t.dynamics.callback={}),t.dynamics.callback.AabbTestCallback=class{constructor(){}process(t){}},t.dynamics.callback.ContactCallback=class{constructor(){}beginContact(t){}preSolve(t){}postSolve(t){}endContact(t){}},t.dynamics.callback.RayCastCallback=class{constructor(){}process(t,i){}},t.dynamics.callback.RayCastClosest=class extends t.dynamics.callback.RayCastCallback{constructor(){super(),this.position=new t.common.Vec3,this.normal=new t.common.Vec3,this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}clear(){this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}process(t,i){if(i.fraction<this.fraction){this.shape=t,this.hit=!0,this.fraction=i.fraction;var a=this.position,s=i.position;a.x=s.x,a.y=s.y,a.z=s.z;var o=this.normal,n=i.normal;o.x=n.x,o.y=n.y,o.z=n.z}}},t.dynamics.common||(t.dynamics.common={}),t.dynamics.common.DebugDraw=class{constructor(){this.p=new t.common.Pool,this.wireframe=!1,this.drawShapes=!0,this.drawBvh=!1,this.drawBvhMinLevel=0,this.drawBvhMaxLevel=65536,this.drawAabbs=!1,this.drawBases=!1,this.drawPairs=!1,this.drawContacts=!1,this.drawJoints=!0,this.drawJointLimits=!1;var i=new Array(5);this.sphereCoords=i;var a=new Array(5);this.tmpSphereVerts=a;var s=new Array(5);this.tmpSphereNorms=s;for(var o=0;o<5;){var n=o++,r=0==n||4==n?1:8,_=this.sphereCoords,e=new Array(r);_[n]=e;var h=this.tmpSphereVerts,l=new Array(r);h[n]=l;var c=this.tmpSphereNorms,m=new Array(r);c[n]=m;for(var v=0;v<8;){var b=v++,x=.7853981633974475*n,p=.7853981633974475*b;this.sphereCoords[n][b]=new t.common.Vec3(Math.sin(x)*Math.cos(p),Math.cos(x),-Math.sin(x)*Math.sin(p)),this.tmpSphereVerts[n][b]=new t.common.Vec3,this.tmpSphereNorms[n][b]=new t.common.Vec3}}var f=new Array(8);this.circleCoords=f;var u=new Array(8);this.circleCoordsShift=u;var y=new Array(8);this.tmpCircleVerts1=y;var X=new Array(8);this.tmpCircleVerts2=X;var g=new Array(8);this.tmpCircleNorms=g;for(var z=.7853981633974475,d=0;d<8;){var Y=d++;this.circleCoords[Y]=new t.common.Vec3(Math.cos(Y*z),0,-Math.sin(Y*z)),this.circleCoordsShift[Y]=new t.common.Vec3(Math.cos((Y+.5)*z),0,-Math.sin((Y+.5)*z)),this.tmpCircleVerts1[Y]=new t.common.Vec3,this.tmpCircleVerts2[Y]=new t.common.Vec3,this.tmpCircleNorms[Y]=new t.common.Vec3}this.style=new t.dynamics.common.DebugDrawStyle}aabb(i,a,s){var o=this.p,n=(0==o.sizeVec3?new t.common.Vec3:o.stackVec3[--o.sizeVec3]).init(i.x,i.y,i.z),r=this.p,_=(0==r.sizeVec3?new t.common.Vec3:r.stackVec3[--r.sizeVec3]).init(i.x,i.y,a.z),e=this.p,h=(0==e.sizeVec3?new t.common.Vec3:e.stackVec3[--e.sizeVec3]).init(i.x,a.y,i.z),l=this.p,c=(0==l.sizeVec3?new t.common.Vec3:l.stackVec3[--l.sizeVec3]).init(i.x,a.y,a.z),m=this.p,v=(0==m.sizeVec3?new t.common.Vec3:m.stackVec3[--m.sizeVec3]).init(a.x,i.y,i.z),b=this.p,x=(0==b.sizeVec3?new t.common.Vec3:b.stackVec3[--b.sizeVec3]).init(a.x,i.y,a.z),p=this.p,f=(0==p.sizeVec3?new t.common.Vec3:p.stackVec3[--p.sizeVec3]).init(a.x,a.y,i.z),u=this.p,y=(0==u.sizeVec3?new t.common.Vec3:u.stackVec3[--u.sizeVec3]).init(a.x,a.y,a.z);this.line(n,_,s),this.line(h,c,s),this.line(v,x,s),this.line(f,y,s),this.line(n,h,s),this.line(_,c,s),this.line(v,f,s),this.line(x,y,s),this.line(n,v,s),this.line(_,x,s),this.line(h,f,s),this.line(c,y,s);var X=this.p;if(null!=n){if(n.zero(),X.sizeVec3==X.stackVec3.length){for(var g=X.sizeVec3<<1,z=new Array(g),d=0,Y=X.sizeVec3;d<Y;){var Z=d++;z[Z]=X.stackVec3[Z],X.stackVec3[Z]=null}X.stackVec3=z}X.stackVec3[X.sizeVec3++]=n}var M=this.p;if(null!=_){if(_.zero(),M.sizeVec3==M.stackVec3.length){for(var I=M.sizeVec3<<1,V=new Array(I),L=0,w=M.sizeVec3;L<w;){var k=L++;V[k]=M.stackVec3[k],M.stackVec3[k]=null}M.stackVec3=V}M.stackVec3[M.sizeVec3++]=_}var B=this.p;if(null!=h){if(h.zero(),B.sizeVec3==B.stackVec3.length){for(var A=B.sizeVec3<<1,P=new Array(A),S=0,T=B.sizeVec3;S<T;){var C=S++;P[C]=B.stackVec3[C],B.stackVec3[C]=null}B.stackVec3=P}B.stackVec3[B.sizeVec3++]=h}var j=this.p;if(null!=c){if(c.zero(),j.sizeVec3==j.stackVec3.length){for(var R=j.sizeVec3<<1,q=new Array(R),E=0,D=j.sizeVec3;E<D;){var F=E++;q[F]=j.stackVec3[F],j.stackVec3[F]=null}j.stackVec3=q}j.stackVec3[j.sizeVec3++]=c}var N=this.p;if(null!=v){if(v.zero(),N.sizeVec3==N.stackVec3.length){for(var W=N.sizeVec3<<1,G=new Array(W),J=0,O=N.sizeVec3;J<O;){var H=J++;G[H]=N.stackVec3[H],N.stackVec3[H]=null}N.stackVec3=G}N.stackVec3[N.sizeVec3++]=v}var U=this.p;if(null!=x){if(x.zero(),U.sizeVec3==U.stackVec3.length){for(var Q=U.sizeVec3<<1,K=new Array(Q),$=0,tt=U.sizeVec3;$<tt;){var it=$++;K[it]=U.stackVec3[it],U.stackVec3[it]=null}U.stackVec3=K}U.stackVec3[U.sizeVec3++]=x}var at=this.p;if(null!=f){if(f.zero(),at.sizeVec3==at.stackVec3.length){for(var st=at.sizeVec3<<1,ot=new Array(st),nt=0,rt=at.sizeVec3;nt<rt;){var _t=nt++;ot[_t]=at.stackVec3[_t],at.stackVec3[_t]=null}at.stackVec3=ot}at.stackVec3[at.sizeVec3++]=f}var et=this.p;if(null!=y){if(y.zero(),et.sizeVec3==et.stackVec3.length){for(var ht=et.sizeVec3<<1,lt=new Array(ht),ct=0,mt=et.sizeVec3;ct<mt;){var vt=ct++;lt[vt]=et.stackVec3[vt],et.stackVec3[vt]=null}et.stackVec3=lt}et.stackVec3[et.sizeVec3++]=y}}basis(i,a,s,o,n){var r=this.p,_=0==r.sizeVec3?new t.common.Vec3:r.stackVec3[--r.sizeVec3],e=this.p,h=0==e.sizeMat3?new t.common.Mat3:e.stackMat3[--e.sizeMat3],l=this.p,c=0==l.sizeVec3?new t.common.Vec3:l.stackVec3[--l.sizeVec3],m=this.p,v=0==m.sizeVec3?new t.common.Vec3:m.stackVec3[--m.sizeVec3],b=this.p,x=0==b.sizeVec3?new t.common.Vec3:b.stackVec3[--b.sizeVec3],p=_;p.x=i._positionX,p.y=i._positionY,p.z=i._positionZ;var f=h;f.e00=i._rotation00,f.e01=i._rotation01,f.e02=i._rotation02,f.e10=i._rotation10,f.e11=i._rotation11,f.e12=i._rotation12,f.e20=i._rotation20,f.e21=i._rotation21,f.e22=i._rotation22,c.init(h.e00,h.e10,h.e20),v.init(h.e01,h.e11,h.e21),x.init(h.e02,h.e12,h.e22);var u=c.x*a,y=c.y*a,X=c.z*a;c.x=u,c.y=y,c.z=X;var g=c,z=g.x+_.x,d=g.y+_.y,Y=g.z+_.z;g.x=z,g.y=d,g.z=Y;var Z=v.x*a,M=v.y*a,I=v.z*a;v.x=Z,v.y=M,v.z=I;var V=v,L=V.x+_.x,w=V.y+_.y,k=V.z+_.z;V.x=L,V.y=w,V.z=k;var B=x.x*a,A=x.y*a,P=x.z*a;x.x=B,x.y=A,x.z=P;var S=x,T=S.x+_.x,C=S.y+_.y,j=S.z+_.z;S.x=T,S.y=C,S.z=j,this.line(_,c,s),this.line(_,v,o),this.line(_,x,n);var R=this.p;if(null!=_){if(_.zero(),R.sizeVec3==R.stackVec3.length){for(var q=R.sizeVec3<<1,E=new Array(q),D=0,F=R.sizeVec3;D<F;){var N=D++;E[N]=R.stackVec3[N],R.stackVec3[N]=null}R.stackVec3=E}R.stackVec3[R.sizeVec3++]=_}var W=this.p;if(null!=h){if(h.e00=1,h.e01=0,h.e02=0,h.e10=0,h.e11=1,h.e12=0,h.e20=0,h.e21=0,h.e22=1,W.sizeMat3==W.stackMat3.length){for(var G=W.sizeMat3<<1,J=new Array(G),O=0,H=W.sizeMat3;O<H;){var U=O++;J[U]=W.stackMat3[U],W.stackMat3[U]=null}W.stackMat3=J}W.stackMat3[W.sizeMat3++]=h}var Q=this.p;if(null!=c){if(c.zero(),Q.sizeVec3==Q.stackVec3.length){for(var K=Q.sizeVec3<<1,$=new Array(K),tt=0,it=Q.sizeVec3;tt<it;){var at=tt++;$[at]=Q.stackVec3[at],Q.stackVec3[at]=null}Q.stackVec3=$}Q.stackVec3[Q.sizeVec3++]=c}var st=this.p;if(null!=v){if(v.zero(),st.sizeVec3==st.stackVec3.length){for(var ot=st.sizeVec3<<1,nt=new Array(ot),rt=0,_t=st.sizeVec3;rt<_t;){var et=rt++;nt[et]=st.stackVec3[et],st.stackVec3[et]=null}st.stackVec3=nt}st.stackVec3[st.sizeVec3++]=v}var ht=this.p;if(null!=x){if(x.zero(),ht.sizeVec3==ht.stackVec3.length){for(var lt=ht.sizeVec3<<1,ct=new Array(lt),mt=0,vt=ht.sizeVec3;mt<vt;){var bt=mt++;ct[bt]=ht.stackVec3[bt],ht.stackVec3[bt]=null}ht.stackVec3=ct}ht.stackVec3[ht.sizeVec3++]=x}}ellipse(t,i,a,s,o,n){this.arc(t,i,a,s,o,0,6.28318530717958,!1,n)}arc(i,a,s,o,n,r,_,e,h){var l=this.p,c=0==l.sizeVec3?new t.common.Vec3:l.stackVec3[--l.sizeVec3];c.x=a.x,c.y=a.y,c.z=a.z;var m=c,v=m.x*o,b=m.y*o,x=m.z*o;m.x=v,m.y=b,m.z=x,a=m;var p=this.p,f=0==p.sizeVec3?new t.common.Vec3:p.stackVec3[--p.sizeVec3];f.x=s.x,f.y=s.y,f.z=s.z;var u=f,y=u.x*n,X=u.y*n,g=u.z*n;u.x=y,u.y=X,u.z=g,s=u;var z=_-r;z<0&&(z=-z);var d=z/.5235987755982984+.5|0;0==d&&(d=1);var Y=r,Z=(_-r)/d,M=this.p,I=0==M.sizeVec3?new t.common.Vec3:M.stackVec3[--M.sizeVec3];I.x=i.x,I.y=i.y,I.z=i.z;var V=I,L=Math.cos(Y),w=V.x+a.x*L,k=V.y+a.y*L,B=V.z+a.z*L;V.x=w,V.y=k,V.z=B;var A=V,P=Math.sin(Y),S=A.x+s.x*P,T=A.y+s.y*P,C=A.z+s.z*P;A.x=S,A.y=T,A.z=C;var j=A;e&&this.line(i,j,h);for(var R=0,q=d;R<q;){R++,Y+=Z;var E=this.p,D=0==E.sizeVec3?new t.common.Vec3:E.stackVec3[--E.sizeVec3];D.x=i.x,D.y=i.y,D.z=i.z;var F=D,N=Math.cos(Y),W=F.x+a.x*N,G=F.y+a.y*N,J=F.z+a.z*N;F.x=W,F.y=G,F.z=J;var O=F,H=Math.sin(Y),U=O.x+s.x*H,Q=O.y+s.y*H,K=O.z+s.z*H;O.x=U,O.y=Q,O.z=K;var $=O;this.line(j,$,h);var tt=this.p;if(null!=j){if(j.zero(),tt.sizeVec3==tt.stackVec3.length){for(var it=tt.sizeVec3<<1,at=new Array(it),st=0,ot=tt.sizeVec3;st<ot;){var nt=st++;at[nt]=tt.stackVec3[nt],tt.stackVec3[nt]=null}tt.stackVec3=at}tt.stackVec3[tt.sizeVec3++]=j}j=$}e&&this.line(i,j,h);var rt=this.p;if(null!=j){if(j.zero(),rt.sizeVec3==rt.stackVec3.length){for(var _t=rt.sizeVec3<<1,et=new Array(_t),ht=0,lt=rt.sizeVec3;ht<lt;){var ct=ht++;et[ct]=rt.stackVec3[ct],rt.stackVec3[ct]=null}rt.stackVec3=et}rt.stackVec3[rt.sizeVec3++]=j}var mt=this.p;if(null!=a){if(a.zero(),mt.sizeVec3==mt.stackVec3.length){for(var vt=mt.sizeVec3<<1,bt=new Array(vt),xt=0,pt=mt.sizeVec3;xt<pt;){var ft=xt++;bt[ft]=mt.stackVec3[ft],mt.stackVec3[ft]=null}mt.stackVec3=bt}mt.stackVec3[mt.sizeVec3++]=a}var ut=this.p;if(null!=s){if(s.zero(),ut.sizeVec3==ut.stackVec3.length){for(var yt=ut.sizeVec3<<1,Xt=new Array(yt),gt=0,zt=ut.sizeVec3;gt<zt;){var dt=gt++;Xt[dt]=ut.stackVec3[dt],ut.stackVec3[dt]=null}ut.stackVec3=Xt}ut.stackVec3[ut.sizeVec3++]=s}}cone(i,a,s,o){var n=this.p,r=0==n.sizeVec3?new t.common.Vec3:n.stackVec3[--n.sizeVec3],_=this.p,e=0==_.sizeVec3?new t.common.Vec3:_.stackVec3[--_.sizeVec3],h=this.p,l=0==h.sizeVec3?new t.common.Vec3:h.stackVec3[--h.sizeVec3],c=this.p,m=0==c.sizeVec3?new t.common.Vec3:c.stackVec3[--c.sizeVec3],v=this.p,b=0==v.sizeMat3?new t.common.Mat3:v.stackMat3[--v.sizeMat3],x=m;x.x=i._positionX,x.y=i._positionY,x.z=i._positionZ;var p=b;p.e00=i._rotation00,p.e01=i._rotation01,p.e02=i._rotation02,p.e10=i._rotation10,p.e11=i._rotation11,p.e12=i._rotation12,p.e20=i._rotation20,p.e21=i._rotation21,p.e22=i._rotation22,r.init(b.e00,b.e10,b.e20),e.init(b.e01,b.e11,b.e21),l.init(b.e02,b.e12,b.e22);var f=this.p,u=0==f.sizeVec3?new t.common.Vec3:f.stackVec3[--f.sizeVec3];u.x=m.x,u.y=m.y,u.z=m.z;var y=u,X=y.x+e.x*s,g=y.y+e.y*s,z=y.z+e.z*s;y.x=X,y.y=g,y.z=z;var d=y,Y=this.p,Z=0==Y.sizeVec3?new t.common.Vec3:Y.stackVec3[--Y.sizeVec3];Z.x=m.x,Z.y=m.y,Z.z=m.z;var M=Z,I=-s,V=M.x+e.x*I,L=M.y+e.y*I,w=M.z+e.z*I;M.x=V,M.y=L,M.z=w;var k=M;if(this.wireframe){var B=this.p,A=0==B.sizeVec3?new t.common.Vec3:B.stackVec3[--B.sizeVec3];A.x=k.x,A.y=k.y,A.z=k.z;var P=A,S=-a,T=P.x+r.x*S,C=P.y+r.y*S,j=P.z+r.z*S;P.x=T,P.y=C,P.z=j;var R=P,q=R.x+0*l.x,E=R.y+0*l.y,D=R.z+0*l.z;R.x=q,R.y=E,R.z=D;var F=R,N=this.p,W=0==N.sizeVec3?new t.common.Vec3:N.stackVec3[--N.sizeVec3];W.x=k.x,W.y=k.y,W.z=k.z;var G=W,J=G.x+r.x*a,O=G.y+r.y*a,H=G.z+r.z*a;G.x=J,G.y=O,G.z=H;var U=G,Q=U.x+0*l.x,K=U.y+0*l.y,$=U.z+0*l.z;U.x=Q,U.y=K,U.z=$;var tt=U,it=this.p,at=0==it.sizeVec3?new t.common.Vec3:it.stackVec3[--it.sizeVec3];at.x=k.x,at.y=k.y,at.z=k.z;var st=at,ot=st.x+0*r.x,nt=st.y+0*r.y,rt=st.z+0*r.z;st.x=ot,st.y=nt,st.z=rt;var _t=st,et=-a,ht=_t.x+l.x*et,lt=_t.y+l.y*et,ct=_t.z+l.z*et;_t.x=ht,_t.y=lt,_t.z=ct;var mt=_t,vt=this.p,bt=0==vt.sizeVec3?new t.common.Vec3:vt.stackVec3[--vt.sizeVec3];bt.x=k.x,bt.y=k.y,bt.z=k.z;var xt=bt,pt=xt.x+0*r.x,ft=xt.y+0*r.y,ut=xt.z+0*r.z;xt.x=pt,xt.y=ft,xt.z=ut;var yt=xt,Xt=yt.x+l.x*a,gt=yt.y+l.y*a,zt=yt.z+l.z*a;yt.x=Xt,yt.y=gt,yt.z=zt;var dt=yt;this.ellipse(k,r,l,a,a,o),this.line(d,F,o),this.line(d,tt,o),this.line(d,mt,o),this.line(d,dt,o);var Yt=this.p;if(null!=F){if(F.zero(),Yt.sizeVec3==Yt.stackVec3.length){for(var Zt=Yt.sizeVec3<<1,Mt=new Array(Zt),It=0,Vt=Yt.sizeVec3;It<Vt;){var Lt=It++;Mt[Lt]=Yt.stackVec3[Lt],Yt.stackVec3[Lt]=null}Yt.stackVec3=Mt}Yt.stackVec3[Yt.sizeVec3++]=F}var wt=this.p;if(null!=tt){if(tt.zero(),wt.sizeVec3==wt.stackVec3.length){for(var kt=wt.sizeVec3<<1,Bt=new Array(kt),At=0,Pt=wt.sizeVec3;At<Pt;){var St=At++;Bt[St]=wt.stackVec3[St],wt.stackVec3[St]=null}wt.stackVec3=Bt}wt.stackVec3[wt.sizeVec3++]=tt}var Tt=this.p;if(null!=mt){if(mt.zero(),Tt.sizeVec3==Tt.stackVec3.length){for(var Ct=Tt.sizeVec3<<1,jt=new Array(Ct),Rt=0,qt=Tt.sizeVec3;Rt<qt;){var Et=Rt++;jt[Et]=Tt.stackVec3[Et],Tt.stackVec3[Et]=null}Tt.stackVec3=jt}Tt.stackVec3[Tt.sizeVec3++]=mt}var Dt=this.p;if(null!=dt){if(dt.zero(),Dt.sizeVec3==Dt.stackVec3.length){for(var Ft=Dt.sizeVec3<<1,Nt=new Array(Ft),Wt=0,Gt=Dt.sizeVec3;Wt<Gt;){var Jt=Wt++;Nt[Jt]=Dt.stackVec3[Jt],Dt.stackVec3[Jt]=null}Dt.stackVec3=Nt}Dt.stackVec3[Dt.sizeVec3++]=dt}}else{for(var Ot=1/Math.sqrt(a*a+4*s*s),Ht=2*s*Ot,Ut=a*Ot,Qt=0;Qt<8;){var Kt=Qt++,$t=this.tmpCircleNorms[Kt],ti=this.circleCoords[Kt];$t.x=ti.x,$t.y=ti.y,$t.z=ti.z;var ii=$t,ai=ii.x*Ht,si=ii.y*Ht,oi=ii.z*Ht;ii.x=ai,ii.y=si,ii.z=oi,ii.y+=Ut;var ni=this.tmpCircleNorms[Kt],ri=ni.x*b.e00+ni.y*b.e01+ni.z*b.e02,_i=ni.x*b.e10+ni.y*b.e11+ni.z*b.e12,ei=ni.x*b.e20+ni.y*b.e21+ni.z*b.e22;ni.x=ri,ni.y=_i,ni.z=ei;var hi=this.tmpCircleVerts1[Kt],li=this.circleCoordsShift[Kt];hi.x=li.x,hi.y=li.y,hi.z=li.z;var ci=hi,mi=ci.x*Ht,vi=ci.y*Ht,bi=ci.z*Ht;ci.x=mi,ci.y=vi,ci.z=bi,ci.y+=Ut;var xi=this.tmpCircleVerts1[Kt],pi=xi.x*b.e00+xi.y*b.e01+xi.z*b.e02,fi=xi.x*b.e10+xi.y*b.e11+xi.z*b.e12,ui=xi.x*b.e20+xi.y*b.e21+xi.z*b.e22;xi.x=pi,xi.y=fi,xi.z=ui;var yi=this.tmpCircleVerts2[Kt],Xi=this.circleCoords[Kt];yi.x=Xi.x,yi.y=Xi.y,yi.z=Xi.z;var gi=yi,zi=gi.x*b.e00+gi.y*b.e01+gi.z*b.e02,di=gi.x*b.e10+gi.y*b.e11+gi.z*b.e12,Yi=gi.x*b.e20+gi.y*b.e21+gi.z*b.e22;gi.x=zi,gi.y=di,gi.z=Yi;var Zi=gi,Mi=Zi.x*a,Ii=Zi.y*a,Vi=Zi.z*a;Zi.x=Mi,Zi.y=Ii,Zi.z=Vi;var Li=Zi,wi=Li.x+m.x,ki=Li.y+m.y,Bi=Li.z+m.z;Li.x=wi,Li.y=ki,Li.z=Bi;var Ai=this.tmpCircleVerts2[Kt],Pi=-s,Si=Ai.x+e.x*Pi,Ti=Ai.y+e.y*Pi,Ci=Ai.z+e.z*Pi;Ai.x=Si,Ai.y=Ti,Ai.z=Ci}for(var ji=0;ji<8;){var Ri=ji++,qi=d,Ei=this.tmpCircleVerts2[Ri],Di=this.tmpCircleVerts2[(Ri+1)%8],Fi=this.tmpCircleVerts1[Ri],Ni=this.tmpCircleNorms[Ri],Wi=this.tmpCircleNorms[(Ri+1)%8];this.triangle(qi,Ei,Di,Fi,Ni,Wi,o),qi=k,Ei=this.tmpCircleVerts2[(Ri+1)%8],Di=this.tmpCircleVerts2[Ri];var Gi=this.p,Ji=0==Gi.sizeVec3?new t.common.Vec3:Gi.stackVec3[--Gi.sizeVec3];Ji.x=e.x,Ji.y=e.y,Ji.z=e.z;var Oi=Ji,Hi=-Oi.x,Ui=-Oi.y,Qi=-Oi.z;Oi.x=Hi,Oi.y=Ui,Oi.z=Qi,Fi=Oi,this.triangle(qi,Ei,Di,Fi,Fi,Fi,o);var Ki=this.p;if(null!=Fi){if(Fi.zero(),Ki.sizeVec3==Ki.stackVec3.length){for(var $i=Ki.sizeVec3<<1,ta=new Array($i),ia=0,aa=Ki.sizeVec3;ia<aa;){var sa=ia++;ta[sa]=Ki.stackVec3[sa],Ki.stackVec3[sa]=null}Ki.stackVec3=ta}Ki.stackVec3[Ki.sizeVec3++]=Fi}}}var oa=this.p;if(null!=d){if(d.zero(),oa.sizeVec3==oa.stackVec3.length){for(var na=oa.sizeVec3<<1,ra=new Array(na),_a=0,ea=oa.sizeVec3;_a<ea;){var ha=_a++;ra[ha]=oa.stackVec3[ha],oa.stackVec3[ha]=null}oa.stackVec3=ra}oa.stackVec3[oa.sizeVec3++]=d}var la=this.p;if(null!=k){if(k.zero(),la.sizeVec3==la.stackVec3.length){for(var ca=la.sizeVec3<<1,ma=new Array(ca),va=0,ba=la.sizeVec3;va<ba;){var xa=va++;ma[xa]=la.stackVec3[xa],la.stackVec3[xa]=null}la.stackVec3=ma}la.stackVec3[la.sizeVec3++]=k}var pa=this.p;if(null!=m){if(m.zero(),pa.sizeVec3==pa.stackVec3.length){for(var fa=pa.sizeVec3<<1,ua=new Array(fa),ya=0,Xa=pa.sizeVec3;ya<Xa;){var ga=ya++;ua[ga]=pa.stackVec3[ga],pa.stackVec3[ga]=null}pa.stackVec3=ua}pa.stackVec3[pa.sizeVec3++]=m}var za=this.p;if(null!=b){if(b.e00=1,b.e01=0,b.e02=0,b.e10=0,b.e11=1,b.e12=0,b.e20=0,b.e21=0,b.e22=1,za.sizeMat3==za.stackMat3.length){for(var da=za.sizeMat3<<1,Ya=new Array(da),Za=0,Ma=za.sizeMat3;Za<Ma;){var Ia=Za++;Ya[Ia]=za.stackMat3[Ia],za.stackMat3[Ia]=null}za.stackMat3=Ya}za.stackMat3[za.sizeMat3++]=b}var Va=this.p;if(null!=r){if(r.zero(),Va.sizeVec3==Va.stackVec3.length){for(var La=Va.sizeVec3<<1,wa=new Array(La),ka=0,Ba=Va.sizeVec3;ka<Ba;){var Aa=ka++;wa[Aa]=Va.stackVec3[Aa],Va.stackVec3[Aa]=null}Va.stackVec3=wa}Va.stackVec3[Va.sizeVec3++]=r}var Pa=this.p;if(null!=e){if(e.zero(),Pa.sizeVec3==Pa.stackVec3.length){for(var Sa=Pa.sizeVec3<<1,Ta=new Array(Sa),Ca=0,ja=Pa.sizeVec3;Ca<ja;){var Ra=Ca++;Ta[Ra]=Pa.stackVec3[Ra],Pa.stackVec3[Ra]=null}Pa.stackVec3=Ta}Pa.stackVec3[Pa.sizeVec3++]=e}var qa=this.p;if(null!=l){if(l.zero(),qa.sizeVec3==qa.stackVec3.length){for(var Ea=qa.sizeVec3<<1,Da=new Array(Ea),Fa=0,Na=qa.sizeVec3;Fa<Na;){var Wa=Fa++;Da[Wa]=qa.stackVec3[Wa],qa.stackVec3[Wa]=null}qa.stackVec3=Da}qa.stackVec3[qa.sizeVec3++]=l}}cylinder(i,a,s,o){var n=this.p,r=0==n.sizeVec3?new t.common.Vec3:n.stackVec3[--n.sizeVec3],_=this.p,e=0==_.sizeVec3?new t.common.Vec3:_.stackVec3[--_.sizeVec3],h=this.p,l=0==h.sizeVec3?new t.common.Vec3:h.stackVec3[--h.sizeVec3],c=this.p,m=0==c.sizeVec3?new t.common.Vec3:c.stackVec3[--c.sizeVec3],v=this.p,b=0==v.sizeMat3?new t.common.Mat3:v.stackMat3[--v.sizeMat3],x=m;x.x=i._positionX,x.y=i._positionY,x.z=i._positionZ;var p=b;p.e00=i._rotation00,p.e01=i._rotation01,p.e02=i._rotation02,p.e10=i._rotation10,p.e11=i._rotation11,p.e12=i._rotation12,p.e20=i._rotation20,p.e21=i._rotation21,p.e22=i._rotation22,r.init(b.e00,b.e10,b.e20),e.init(b.e01,b.e11,b.e21),l.init(b.e02,b.e12,b.e22);var f=this.p,u=0==f.sizeVec3?new t.common.Vec3:f.stackVec3[--f.sizeVec3];u.x=m.x,u.y=m.y,u.z=m.z;var y=u,X=y.x+e.x*s,g=y.y+e.y*s,z=y.z+e.z*s;y.x=X,y.y=g,y.z=z;var d=y,Y=this.p,Z=0==Y.sizeVec3?new t.common.Vec3:Y.stackVec3[--Y.sizeVec3];Z.x=m.x,Z.y=m.y,Z.z=m.z;var M=Z,I=-s,V=M.x+e.x*I,L=M.y+e.y*I,w=M.z+e.z*I;M.x=V,M.y=L,M.z=w;var k=M;if(this.wireframe){var B=this.p,A=0==B.sizeVec3?new t.common.Vec3:B.stackVec3[--B.sizeVec3];A.x=d.x,A.y=d.y,A.z=d.z;var P=A,S=-a,T=P.x+r.x*S,C=P.y+r.y*S,j=P.z+r.z*S;P.x=T,P.y=C,P.z=j;var R=P,q=R.x+0*l.x,E=R.y+0*l.y,D=R.z+0*l.z;R.x=q,R.y=E,R.z=D;var F=R,N=this.p,W=0==N.sizeVec3?new t.common.Vec3:N.stackVec3[--N.sizeVec3];W.x=d.x,W.y=d.y,W.z=d.z;var G=W,J=G.x+r.x*a,O=G.y+r.y*a,H=G.z+r.z*a;G.x=J,G.y=O,G.z=H;var U=G,Q=U.x+0*l.x,K=U.y+0*l.y,$=U.z+0*l.z;U.x=Q,U.y=K,U.z=$;var tt=U,it=this.p,at=0==it.sizeVec3?new t.common.Vec3:it.stackVec3[--it.sizeVec3];at.x=d.x,at.y=d.y,at.z=d.z;var st=at,ot=st.x+0*r.x,nt=st.y+0*r.y,rt=st.z+0*r.z;st.x=ot,st.y=nt,st.z=rt;var _t=st,et=-a,ht=_t.x+l.x*et,lt=_t.y+l.y*et,ct=_t.z+l.z*et;_t.x=ht,_t.y=lt,_t.z=ct;var mt=_t,vt=this.p,bt=0==vt.sizeVec3?new t.common.Vec3:vt.stackVec3[--vt.sizeVec3];bt.x=d.x,bt.y=d.y,bt.z=d.z;var xt=bt,pt=xt.x+0*r.x,ft=xt.y+0*r.y,ut=xt.z+0*r.z;xt.x=pt,xt.y=ft,xt.z=ut;var yt=xt,Xt=yt.x+l.x*a,gt=yt.y+l.y*a,zt=yt.z+l.z*a;yt.x=Xt,yt.y=gt,yt.z=zt;var dt=yt,Yt=this.p,Zt=0==Yt.sizeVec3?new t.common.Vec3:Yt.stackVec3[--Yt.sizeVec3];Zt.x=k.x,Zt.y=k.y,Zt.z=k.z;var Mt=Zt,It=-a,Vt=Mt.x+r.x*It,Lt=Mt.y+r.y*It,wt=Mt.z+r.z*It;Mt.x=Vt,Mt.y=Lt,Mt.z=wt;var kt=Mt,Bt=kt.x+0*l.x,At=kt.y+0*l.y,Pt=kt.z+0*l.z;kt.x=Bt,kt.y=At,kt.z=Pt;var St=kt,Tt=this.p,Ct=0==Tt.sizeVec3?new t.common.Vec3:Tt.stackVec3[--Tt.sizeVec3];Ct.x=k.x,Ct.y=k.y,Ct.z=k.z;var jt=Ct,Rt=jt.x+r.x*a,qt=jt.y+r.y*a,Et=jt.z+r.z*a;jt.x=Rt,jt.y=qt,jt.z=Et;var Dt=jt,Ft=Dt.x+0*l.x,Nt=Dt.y+0*l.y,Wt=Dt.z+0*l.z;Dt.x=Ft,Dt.y=Nt,Dt.z=Wt;var Gt=Dt,Jt=this.p,Ot=0==Jt.sizeVec3?new t.common.Vec3:Jt.stackVec3[--Jt.sizeVec3];Ot.x=k.x,Ot.y=k.y,Ot.z=k.z;var Ht=Ot,Ut=Ht.x+0*r.x,Qt=Ht.y+0*r.y,Kt=Ht.z+0*r.z;Ht.x=Ut,Ht.y=Qt,Ht.z=Kt;var $t=Ht,ti=-a,ii=$t.x+l.x*ti,ai=$t.y+l.y*ti,si=$t.z+l.z*ti;$t.x=ii,$t.y=ai,$t.z=si;var oi=$t,ni=this.p,ri=0==ni.sizeVec3?new t.common.Vec3:ni.stackVec3[--ni.sizeVec3];ri.x=k.x,ri.y=k.y,ri.z=k.z;var _i=ri,ei=_i.x+0*r.x,hi=_i.y+0*r.y,li=_i.z+0*r.z;_i.x=ei,_i.y=hi,_i.z=li;var ci=_i,mi=ci.x+l.x*a,vi=ci.y+l.y*a,bi=ci.z+l.z*a;ci.x=mi,ci.y=vi,ci.z=bi;var xi=ci;this.ellipse(d,r,l,a,a,o),this.ellipse(k,r,l,a,a,o),this.line(F,St,o),this.line(tt,Gt,o),this.line(mt,oi,o),this.line(dt,xi,o);var pi=this.p;if(null!=F){if(F.zero(),pi.sizeVec3==pi.stackVec3.length){for(var fi=pi.sizeVec3<<1,ui=new Array(fi),yi=0,Xi=pi.sizeVec3;yi<Xi;){var gi=yi++;ui[gi]=pi.stackVec3[gi],pi.stackVec3[gi]=null}pi.stackVec3=ui}pi.stackVec3[pi.sizeVec3++]=F}var zi=this.p;if(null!=tt){if(tt.zero(),zi.sizeVec3==zi.stackVec3.length){for(var di=zi.sizeVec3<<1,Yi=new Array(di),Zi=0,Mi=zi.sizeVec3;Zi<Mi;){var Ii=Zi++;Yi[Ii]=zi.stackVec3[Ii],zi.stackVec3[Ii]=null}zi.stackVec3=Yi}zi.stackVec3[zi.sizeVec3++]=tt}var Vi=this.p;if(null!=mt){if(mt.zero(),Vi.sizeVec3==Vi.stackVec3.length){for(var Li=Vi.sizeVec3<<1,wi=new Array(Li),ki=0,Bi=Vi.sizeVec3;ki<Bi;){var Ai=ki++;wi[Ai]=Vi.stackVec3[Ai],Vi.stackVec3[Ai]=null}Vi.stackVec3=wi}Vi.stackVec3[Vi.sizeVec3++]=mt}var Pi=this.p;if(null!=dt){if(dt.zero(),Pi.sizeVec3==Pi.stackVec3.length){for(var Si=Pi.sizeVec3<<1,Ti=new Array(Si),Ci=0,ji=Pi.sizeVec3;Ci<ji;){var Ri=Ci++;Ti[Ri]=Pi.stackVec3[Ri],Pi.stackVec3[Ri]=null}Pi.stackVec3=Ti}Pi.stackVec3[Pi.sizeVec3++]=dt}var qi=this.p;if(null!=St){if(St.zero(),qi.sizeVec3==qi.stackVec3.length){for(var Ei=qi.sizeVec3<<1,Di=new Array(Ei),Fi=0,Ni=qi.sizeVec3;Fi<Ni;){var Wi=Fi++;Di[Wi]=qi.stackVec3[Wi],qi.stackVec3[Wi]=null}qi.stackVec3=Di}qi.stackVec3[qi.sizeVec3++]=St}var Gi=this.p;if(null!=Gt){if(Gt.zero(),Gi.sizeVec3==Gi.stackVec3.length){for(var Ji=Gi.sizeVec3<<1,Oi=new Array(Ji),Hi=0,Ui=Gi.sizeVec3;Hi<Ui;){var Qi=Hi++;Oi[Qi]=Gi.stackVec3[Qi],Gi.stackVec3[Qi]=null}Gi.stackVec3=Oi}Gi.stackVec3[Gi.sizeVec3++]=Gt}var Ki=this.p;if(null!=oi){if(oi.zero(),Ki.sizeVec3==Ki.stackVec3.length){for(var $i=Ki.sizeVec3<<1,ta=new Array($i),ia=0,aa=Ki.sizeVec3;ia<aa;){var sa=ia++;ta[sa]=Ki.stackVec3[sa],Ki.stackVec3[sa]=null}Ki.stackVec3=ta}Ki.stackVec3[Ki.sizeVec3++]=oi}var oa=this.p;if(null!=xi){if(xi.zero(),oa.sizeVec3==oa.stackVec3.length){for(var na=oa.sizeVec3<<1,ra=new Array(na),_a=0,ea=oa.sizeVec3;_a<ea;){var ha=_a++;ra[ha]=oa.stackVec3[ha],oa.stackVec3[ha]=null}oa.stackVec3=ra}oa.stackVec3[oa.sizeVec3++]=xi}}else{for(var la=0;la<8;){var ca=la++,ma=this.tmpCircleNorms[ca],va=this.circleCoords[ca];ma.x=va.x,ma.y=va.y,ma.z=va.z;var ba=ma,xa=ba.x*b.e00+ba.y*b.e01+ba.z*b.e02,pa=ba.x*b.e10+ba.y*b.e11+ba.z*b.e12,fa=ba.x*b.e20+ba.y*b.e21+ba.z*b.e22;ba.x=xa,ba.y=pa,ba.z=fa;var ua=this.tmpCircleVerts1[ca],ya=this.tmpCircleNorms[ca];ua.x=ya.x,ua.y=ya.y,ua.z=ya.z;var Xa=ua,ga=Xa.x*a,za=Xa.y*a,da=Xa.z*a;Xa.x=ga,Xa.y=za,Xa.z=da;var Ya=Xa,Za=Ya.x+m.x,Ma=Ya.y+m.y,Ia=Ya.z+m.z;Ya.x=Za,Ya.y=Ma,Ya.z=Ia;var Va=this.tmpCircleVerts2[ca],La=this.tmpCircleVerts1[ca];Va.x=La.x,Va.y=La.y,Va.z=La.z;var wa=this.tmpCircleVerts1[ca],ka=wa.x+e.x*s,Ba=wa.y+e.y*s,Aa=wa.z+e.z*s;wa.x=ka,wa.y=Ba,wa.z=Aa;var Pa=this.tmpCircleVerts2[ca],Sa=-s,Ta=Pa.x+e.x*Sa,Ca=Pa.y+e.y*Sa,ja=Pa.z+e.z*Sa;Pa.x=Ta,Pa.y=Ca,Pa.z=ja}for(var Ra=0;Ra<8;){var qa=Ra++,Ea=d,Da=this.tmpCircleVerts1[qa],Fa=this.tmpCircleVerts1[(qa+1)%8],Na=e;this.triangle(Ea,Da,Fa,Na,Na,Na,o),Ea=k,Da=this.tmpCircleVerts2[(qa+1)%8],Fa=this.tmpCircleVerts2[qa];var Wa=this.p,Ga=0==Wa.sizeVec3?new t.common.Vec3:Wa.stackVec3[--Wa.sizeVec3];Ga.x=e.x,Ga.y=e.y,Ga.z=e.z;var Ja=Ga,Oa=-Ja.x,Ha=-Ja.y,Ua=-Ja.z;Ja.x=Oa,Ja.y=Ha,Ja.z=Ua,Na=Ja,this.triangle(Ea,Da,Fa,Na,Na,Na,o);var Qa=this.p;if(null!=Na){if(Na.zero(),Qa.sizeVec3==Qa.stackVec3.length){for(var Ka=Qa.sizeVec3<<1,$a=new Array(Ka),ts=0,is=Qa.sizeVec3;ts<is;){var as=ts++;$a[as]=Qa.stackVec3[as],Qa.stackVec3[as]=null}Qa.stackVec3=$a}Qa.stackVec3[Qa.sizeVec3++]=Na}Ea=this.tmpCircleVerts1[qa],Da=this.tmpCircleVerts2[qa],Fa=this.tmpCircleVerts2[(qa+1)%8];var ss=this.tmpCircleVerts1[(qa+1)%8];Na=this.tmpCircleNorms[qa];var os=this.tmpCircleNorms[(qa+1)%8];this.rect(Ea,Da,Fa,ss,Na,Na,os,os,o)}}var ns=this.p;if(null!=d){if(d.zero(),ns.sizeVec3==ns.stackVec3.length){for(var rs=ns.sizeVec3<<1,_s=new Array(rs),es=0,hs=ns.sizeVec3;es<hs;){var ls=es++;_s[ls]=ns.stackVec3[ls],ns.stackVec3[ls]=null}ns.stackVec3=_s}ns.stackVec3[ns.sizeVec3++]=d}var cs=this.p;if(null!=k){if(k.zero(),cs.sizeVec3==cs.stackVec3.length){for(var ms=cs.sizeVec3<<1,vs=new Array(ms),bs=0,xs=cs.sizeVec3;bs<xs;){var ps=bs++;vs[ps]=cs.stackVec3[ps],cs.stackVec3[ps]=null}cs.stackVec3=vs}cs.stackVec3[cs.sizeVec3++]=k}var fs=this.p;if(null!=m){if(m.zero(),fs.sizeVec3==fs.stackVec3.length){for(var us=fs.sizeVec3<<1,ys=new Array(us),Xs=0,gs=fs.sizeVec3;Xs<gs;){var zs=Xs++;ys[zs]=fs.stackVec3[zs],fs.stackVec3[zs]=null}fs.stackVec3=ys}fs.stackVec3[fs.sizeVec3++]=m}var ds=this.p;if(null!=b){if(b.e00=1,b.e01=0,b.e02=0,b.e10=0,b.e11=1,b.e12=0,b.e20=0,b.e21=0,b.e22=1,ds.sizeMat3==ds.stackMat3.length){for(var Ys=ds.sizeMat3<<1,Zs=new Array(Ys),Ms=0,Is=ds.sizeMat3;Ms<Is;){var Vs=Ms++;Zs[Vs]=ds.stackMat3[Vs],ds.stackMat3[Vs]=null}ds.stackMat3=Zs}ds.stackMat3[ds.sizeMat3++]=b}var Ls=this.p;if(null!=r){if(r.zero(),Ls.sizeVec3==Ls.stackVec3.length){for(var ws=Ls.sizeVec3<<1,ks=new Array(ws),Bs=0,As=Ls.sizeVec3;Bs<As;){var Ps=Bs++;ks[Ps]=Ls.stackVec3[Ps],Ls.stackVec3[Ps]=null}Ls.stackVec3=ks}Ls.stackVec3[Ls.sizeVec3++]=r}var Ss=this.p;if(null!=e){if(e.zero(),Ss.sizeVec3==Ss.stackVec3.length){for(var Ts=Ss.sizeVec3<<1,Cs=new Array(Ts),js=0,Rs=Ss.sizeVec3;js<Rs;){var qs=js++;Cs[qs]=Ss.stackVec3[qs],Ss.stackVec3[qs]=null}Ss.stackVec3=Cs}Ss.stackVec3[Ss.sizeVec3++]=e}var Es=this.p;if(null!=l){if(l.zero(),Es.sizeVec3==Es.stackVec3.length){for(var Ds=Es.sizeVec3<<1,Fs=new Array(Ds),Ns=0,Ws=Es.sizeVec3;Ns<Ws;){var Gs=Ns++;Fs[Gs]=Es.stackVec3[Gs],Es.stackVec3[Gs]=null}Es.stackVec3=Fs}Es.stackVec3[Es.sizeVec3++]=l}}capsule(i,a,s,o){var n=this.p,r=0==n.sizeVec3?new t.common.Vec3:n.stackVec3[--n.sizeVec3],_=this.p,e=0==_.sizeVec3?new t.common.Vec3:_.stackVec3[--_.sizeVec3],h=this.p,l=0==h.sizeVec3?new t.common.Vec3:h.stackVec3[--h.sizeVec3],c=this.p,m=0==c.sizeVec3?new t.common.Vec3:c.stackVec3[--c.sizeVec3],v=this.p,b=0==v.sizeMat3?new t.common.Mat3:v.stackMat3[--v.sizeMat3],x=m;x.x=i._positionX,x.y=i._positionY,x.z=i._positionZ;var p=b;p.e00=i._rotation00,p.e01=i._rotation01,p.e02=i._rotation02,p.e10=i._rotation10,p.e11=i._rotation11,p.e12=i._rotation12,p.e20=i._rotation20,p.e21=i._rotation21,p.e22=i._rotation22,r.init(b.e00,b.e10,b.e20),e.init(b.e01,b.e11,b.e21),l.init(b.e02,b.e12,b.e22);for(var f=this.tmpSphereVerts,u=this.tmpSphereNorms,y=0;y<5;)for(var X=y++,g=0,z=this.tmpSphereVerts[X].length;g<z;){var d=g++,Y=u[X][d],Z=this.sphereCoords[X][d];Y.x=Z.x,Y.y=Z.y,Y.z=Z.z;var M=Y,I=M.x*b.e00+M.y*b.e01+M.z*b.e02,V=M.x*b.e10+M.y*b.e11+M.z*b.e12,L=M.x*b.e20+M.y*b.e21+M.z*b.e22;M.x=I,M.y=V,M.z=L}for(var w=0;w<4;){var k=w++;if(0==k)for(var B=0;B<3;)for(var A=B++,P=0,S=this.tmpSphereVerts[A].length;P<S;){var T=P++,C=f[A][T],j=u[A][T];C.x=j.x,C.y=j.y,C.z=j.z;var R=C,q=R.x*a,E=R.y*a,D=R.z*a;R.x=q,R.y=E,R.z=D;var F=R,N=F.x+m.x,W=F.y+m.y,G=F.z+m.z;F.x=N,F.y=W,F.z=G;var J=F,O=J.x+e.x*s,H=J.y+e.y*s,U=J.z+e.z*s;J.x=O,J.y=H,J.z=U}if(2==k)for(var Q=2;Q<5;)for(var K=Q++,$=0,tt=this.tmpSphereVerts[K].length;$<tt;){var it=$++,at=f[K][it],st=u[K][it];at.x=st.x,at.y=st.y,at.z=st.z;var ot=at,nt=ot.x*a,rt=ot.y*a,_t=ot.z*a;ot.x=nt,ot.y=rt,ot.z=_t;var et=ot,ht=et.x+m.x,lt=et.y+m.y,ct=et.z+m.z;et.x=ht,et.y=lt,et.z=ct;var mt=et,vt=-s,bt=mt.x+e.x*vt,xt=mt.y+e.y*vt,pt=mt.z+e.z*vt;mt.x=bt,mt.y=xt,mt.z=pt}for(var ft=0;ft<8;){var ut,yt,Xt,gt,zt,dt,Yt,Zt,Mt=ft++;0==k?this.wireframe?(ut=f[0][0],yt=f[1][Mt],this.line(ut,yt,o)):(ut=f[0][0],yt=f[1][Mt],Xt=f[1][(Mt+1)%8],zt=u[0][0],dt=u[1][Mt],Yt=u[1][(Mt+1)%8],this.triangle(ut,yt,Xt,zt,dt,Yt,o)):3==k?this.wireframe?(ut=f[4][0],yt=f[k][(Mt+1)%8],Xt=f[k][Mt],this.line(ut,yt,o),this.line(yt,Xt,o)):(ut=f[4][0],yt=f[k][(Mt+1)%8],Xt=f[k][Mt],zt=u[4][0],dt=u[k][(Mt+1)%8],Yt=u[k][Mt],this.triangle(ut,yt,Xt,zt,dt,Yt,o)):this.wireframe?(ut=f[k][Mt],yt=f[k][(Mt+1)%8],Xt=f[k+1][Mt],this.line(ut,yt,o),this.line(ut,Xt,o)):(ut=f[k][Mt],yt=f[k][(Mt+1)%8],Xt=f[k+1][Mt],gt=f[k+1][(Mt+1)%8],zt=u[k][Mt],dt=u[k][(Mt+1)%8],Yt=u[k+1][Mt],Zt=u[k+1][(Mt+1)%8],this.rect(ut,Xt,gt,yt,zt,Yt,Zt,dt,o))}}var It=this.p,Vt=0==It.sizeVec3?new t.common.Vec3:It.stackVec3[--It.sizeVec3];Vt.x=m.x,Vt.y=m.y,Vt.z=m.z;var Lt=Vt,wt=Lt.x+e.x*s,kt=Lt.y+e.y*s,Bt=Lt.z+e.z*s;Lt.x=wt,Lt.y=kt,Lt.z=Bt;var At=Lt,Pt=this.p,St=0==Pt.sizeVec3?new t.common.Vec3:Pt.stackVec3[--Pt.sizeVec3];St.x=m.x,St.y=m.y,St.z=m.z;var Tt=St,Ct=-s,jt=Tt.x+e.x*Ct,Rt=Tt.y+e.y*Ct,qt=Tt.z+e.z*Ct;Tt.x=jt,Tt.y=Rt,Tt.z=qt;var Et=Tt;if(this.wireframe){var Dt=this.p,Ft=0==Dt.sizeVec3?new t.common.Vec3:Dt.stackVec3[--Dt.sizeVec3];Ft.x=At.x,Ft.y=At.y,Ft.z=At.z;var Nt=Ft,Wt=-a,Gt=Nt.x+r.x*Wt,Jt=Nt.y+r.y*Wt,Ot=Nt.z+r.z*Wt;Nt.x=Gt,Nt.y=Jt,Nt.z=Ot;var Ht=Nt,Ut=Ht.x+0*l.x,Qt=Ht.y+0*l.y,Kt=Ht.z+0*l.z;Ht.x=Ut,Ht.y=Qt,Ht.z=Kt;var $t=Ht,ti=this.p,ii=0==ti.sizeVec3?new t.common.Vec3:ti.stackVec3[--ti.sizeVec3];ii.x=At.x,ii.y=At.y,ii.z=At.z;var ai=ii,si=ai.x+r.x*a,oi=ai.y+r.y*a,ni=ai.z+r.z*a;ai.x=si,ai.y=oi,ai.z=ni;var ri=ai,_i=ri.x+0*l.x,ei=ri.y+0*l.y,hi=ri.z+0*l.z;ri.x=_i,ri.y=ei,ri.z=hi;var li=ri,ci=this.p,mi=0==ci.sizeVec3?new t.common.Vec3:ci.stackVec3[--ci.sizeVec3];mi.x=At.x,mi.y=At.y,mi.z=At.z;var vi=mi,bi=vi.x+0*r.x,xi=vi.y+0*r.y,pi=vi.z+0*r.z;vi.x=bi,vi.y=xi,vi.z=pi;var fi=vi,ui=-a,yi=fi.x+l.x*ui,Xi=fi.y+l.y*ui,gi=fi.z+l.z*ui;fi.x=yi,fi.y=Xi,fi.z=gi;var zi=fi,di=this.p,Yi=0==di.sizeVec3?new t.common.Vec3:di.stackVec3[--di.sizeVec3];Yi.x=At.x,Yi.y=At.y,Yi.z=At.z;var Zi=Yi,Mi=Zi.x+0*r.x,Ii=Zi.y+0*r.y,Vi=Zi.z+0*r.z;Zi.x=Mi,Zi.y=Ii,Zi.z=Vi;var Li=Zi,wi=Li.x+l.x*a,ki=Li.y+l.y*a,Bi=Li.z+l.z*a;Li.x=wi,Li.y=ki,Li.z=Bi;var Ai=Li,Pi=this.p,Si=0==Pi.sizeVec3?new t.common.Vec3:Pi.stackVec3[--Pi.sizeVec3];Si.x=Et.x,Si.y=Et.y,Si.z=Et.z;var Ti=Si,Ci=-a,ji=Ti.x+r.x*Ci,Ri=Ti.y+r.y*Ci,qi=Ti.z+r.z*Ci;Ti.x=ji,Ti.y=Ri,Ti.z=qi;var Ei=Ti,Di=Ei.x+0*l.x,Fi=Ei.y+0*l.y,Ni=Ei.z+0*l.z;Ei.x=Di,Ei.y=Fi,Ei.z=Ni;var Wi=Ei,Gi=this.p,Ji=0==Gi.sizeVec3?new t.common.Vec3:Gi.stackVec3[--Gi.sizeVec3];Ji.x=Et.x,Ji.y=Et.y,Ji.z=Et.z;var Oi=Ji,Hi=Oi.x+r.x*a,Ui=Oi.y+r.y*a,Qi=Oi.z+r.z*a;Oi.x=Hi,Oi.y=Ui,Oi.z=Qi;var Ki=Oi,$i=Ki.x+0*l.x,ta=Ki.y+0*l.y,ia=Ki.z+0*l.z;Ki.x=$i,Ki.y=ta,Ki.z=ia;var aa=Ki,sa=this.p,oa=0==sa.sizeVec3?new t.common.Vec3:sa.stackVec3[--sa.sizeVec3];oa.x=Et.x,oa.y=Et.y,oa.z=Et.z;var na=oa,ra=na.x+0*r.x,_a=na.y+0*r.y,ea=na.z+0*r.z;na.x=ra,na.y=_a,na.z=ea;var ha=na,la=-a,ca=ha.x+l.x*la,ma=ha.y+l.y*la,va=ha.z+l.z*la;ha.x=ca,ha.y=ma,ha.z=va;var ba=ha,xa=this.p,pa=0==xa.sizeVec3?new t.common.Vec3:xa.stackVec3[--xa.sizeVec3];pa.x=Et.x,pa.y=Et.y,pa.z=Et.z;var fa=pa,ua=fa.x+0*r.x,ya=fa.y+0*r.y,Xa=fa.z+0*r.z;fa.x=ua,fa.y=ya,fa.z=Xa;var ga=fa,za=ga.x+l.x*a,da=ga.y+l.y*a,Ya=ga.z+l.z*a;ga.x=za,ga.y=da,ga.z=Ya;var Za=ga;this.ellipse(At,r,l,a,a,o),this.ellipse(Et,r,l,a,a,o),this.line($t,Wi,o),this.line(li,aa,o),this.line(zi,ba,o),this.line(Ai,Za,o);var Ma=this.p;if(null!=$t){if($t.zero(),Ma.sizeVec3==Ma.stackVec3.length){for(var Ia=Ma.sizeVec3<<1,Va=new Array(Ia),La=0,wa=Ma.sizeVec3;La<wa;){var ka=La++;Va[ka]=Ma.stackVec3[ka],Ma.stackVec3[ka]=null}Ma.stackVec3=Va}Ma.stackVec3[Ma.sizeVec3++]=$t}var Ba=this.p;if(null!=li){if(li.zero(),Ba.sizeVec3==Ba.stackVec3.length){for(var Aa=Ba.sizeVec3<<1,Pa=new Array(Aa),Sa=0,Ta=Ba.sizeVec3;Sa<Ta;){var Ca=Sa++;Pa[Ca]=Ba.stackVec3[Ca],Ba.stackVec3[Ca]=null}Ba.stackVec3=Pa}Ba.stackVec3[Ba.sizeVec3++]=li}var ja=this.p;if(null!=zi){if(zi.zero(),ja.sizeVec3==ja.stackVec3.length){for(var Ra=ja.sizeVec3<<1,qa=new Array(Ra),Ea=0,Da=ja.sizeVec3;Ea<Da;){var Fa=Ea++;qa[Fa]=ja.stackVec3[Fa],ja.stackVec3[Fa]=null}ja.stackVec3=qa}ja.stackVec3[ja.sizeVec3++]=zi}var Na=this.p;if(null!=Ai){if(Ai.zero(),Na.sizeVec3==Na.stackVec3.length){for(var Wa=Na.sizeVec3<<1,Ga=new Array(Wa),Ja=0,Oa=Na.sizeVec3;Ja<Oa;){var Ha=Ja++;Ga[Ha]=Na.stackVec3[Ha],Na.stackVec3[Ha]=null}Na.stackVec3=Ga}Na.stackVec3[Na.sizeVec3++]=Ai}var Ua=this.p;if(null!=Wi){if(Wi.zero(),Ua.sizeVec3==Ua.stackVec3.length){for(var Qa=Ua.sizeVec3<<1,Ka=new Array(Qa),$a=0,ts=Ua.sizeVec3;$a<ts;){var is=$a++;Ka[is]=Ua.stackVec3[is],Ua.stackVec3[is]=null}Ua.stackVec3=Ka}Ua.stackVec3[Ua.sizeVec3++]=Wi}var as=this.p;if(null!=aa){if(aa.zero(),as.sizeVec3==as.stackVec3.length){for(var ss=as.sizeVec3<<1,os=new Array(ss),ns=0,rs=as.sizeVec3;ns<rs;){var _s=ns++;os[_s]=as.stackVec3[_s],as.stackVec3[_s]=null}as.stackVec3=os}as.stackVec3[as.sizeVec3++]=aa}var es=this.p;if(null!=ba){if(ba.zero(),es.sizeVec3==es.stackVec3.length){for(var hs=es.sizeVec3<<1,ls=new Array(hs),cs=0,ms=es.sizeVec3;cs<ms;){var vs=cs++;ls[vs]=es.stackVec3[vs],es.stackVec3[vs]=null}es.stackVec3=ls}es.stackVec3[es.sizeVec3++]=ba}var bs=this.p;if(null!=Za){if(Za.zero(),bs.sizeVec3==bs.stackVec3.length){for(var xs=bs.sizeVec3<<1,ps=new Array(xs),fs=0,us=bs.sizeVec3;fs<us;){var ys=fs++;ps[ys]=bs.stackVec3[ys],bs.stackVec3[ys]=null}bs.stackVec3=ps}bs.stackVec3[bs.sizeVec3++]=Za}}else{for(var Xs=0;Xs<8;){var gs=Xs++,zs=this.tmpCircleNorms[gs],ds=this.circleCoords[gs];zs.x=ds.x,zs.y=ds.y,zs.z=ds.z;var Ys=zs,Zs=Ys.x*b.e00+Ys.y*b.e01+Ys.z*b.e02,Ms=Ys.x*b.e10+Ys.y*b.e11+Ys.z*b.e12,Is=Ys.x*b.e20+Ys.y*b.e21+Ys.z*b.e22;Ys.x=Zs,Ys.y=Ms,Ys.z=Is;var Vs=this.tmpCircleVerts1[gs],Ls=this.tmpCircleNorms[gs];Vs.x=Ls.x,Vs.y=Ls.y,Vs.z=Ls.z;var ws=Vs,ks=ws.x*a,Bs=ws.y*a,As=ws.z*a;ws.x=ks,ws.y=Bs,ws.z=As;var Ps=ws,Ss=Ps.x+m.x,Ts=Ps.y+m.y,Cs=Ps.z+m.z;Ps.x=Ss,Ps.y=Ts,Ps.z=Cs;var js=this.tmpCircleVerts2[gs],Rs=this.tmpCircleVerts1[gs];js.x=Rs.x,js.y=Rs.y,js.z=Rs.z;var qs=this.tmpCircleVerts1[gs],Es=qs.x+e.x*s,Ds=qs.y+e.y*s,Fs=qs.z+e.z*s;qs.x=Es,qs.y=Ds,qs.z=Fs;var Ns=this.tmpCircleVerts2[gs],Ws=-s,Gs=Ns.x+e.x*Ws,Js=Ns.y+e.y*Ws,Os=Ns.z+e.z*Ws;Ns.x=Gs,Ns.y=Js,Ns.z=Os}for(var Hs=0;Hs<8;){var Us=Hs++,Qs=this.tmpCircleVerts1[Us],Ks=this.tmpCircleVerts2[Us],$s=this.tmpCircleVerts2[(Us+1)%8],to=this.tmpCircleVerts1[(Us+1)%8],io=this.tmpCircleNorms[Us],ao=this.tmpCircleNorms[(Us+1)%8];this.rect(Qs,Ks,$s,to,io,io,ao,ao,o)}}var so=this.p;if(null!=At){if(At.zero(),so.sizeVec3==so.stackVec3.length){for(var oo=so.sizeVec3<<1,no=new Array(oo),ro=0,_o=so.sizeVec3;ro<_o;){var eo=ro++;no[eo]=so.stackVec3[eo],so.stackVec3[eo]=null}so.stackVec3=no}so.stackVec3[so.sizeVec3++]=At}var ho=this.p;if(null!=Et){if(Et.zero(),ho.sizeVec3==ho.stackVec3.length){for(var lo=ho.sizeVec3<<1,co=new Array(lo),mo=0,vo=ho.sizeVec3;mo<vo;){var bo=mo++;co[bo]=ho.stackVec3[bo],ho.stackVec3[bo]=null}ho.stackVec3=co}ho.stackVec3[ho.sizeVec3++]=Et}var xo=this.p;if(null!=m){if(m.zero(),xo.sizeVec3==xo.stackVec3.length){for(var po=xo.sizeVec3<<1,fo=new Array(po),uo=0,yo=xo.sizeVec3;uo<yo;){var Xo=uo++;fo[Xo]=xo.stackVec3[Xo],xo.stackVec3[Xo]=null}xo.stackVec3=fo}xo.stackVec3[xo.sizeVec3++]=m}var go=this.p;if(null!=b){if(b.e00=1,b.e01=0,b.e02=0,b.e10=0,b.e11=1,b.e12=0,b.e20=0,b.e21=0,b.e22=1,go.sizeMat3==go.stackMat3.length){for(var zo=go.sizeMat3<<1,Yo=new Array(zo),Zo=0,Mo=go.sizeMat3;Zo<Mo;){var Io=Zo++;Yo[Io]=go.stackMat3[Io],go.stackMat3[Io]=null}go.stackMat3=Yo}go.stackMat3[go.sizeMat3++]=b}var Vo=this.p;if(null!=r){if(r.zero(),Vo.sizeVec3==Vo.stackVec3.length){for(var Lo=Vo.sizeVec3<<1,wo=new Array(Lo),ko=0,Bo=Vo.sizeVec3;ko<Bo;){var Ao=ko++;wo[Ao]=Vo.stackVec3[Ao],Vo.stackVec3[Ao]=null}Vo.stackVec3=wo}Vo.stackVec3[Vo.sizeVec3++]=r}var Po=this.p;if(null!=e){if(e.zero(),Po.sizeVec3==Po.stackVec3.length){for(var So=Po.sizeVec3<<1,To=new Array(So),Co=0,jo=Po.sizeVec3;Co<jo;){var Ro=Co++;To[Ro]=Po.stackVec3[Ro],Po.stackVec3[Ro]=null}Po.stackVec3=To}Po.stackVec3[Po.sizeVec3++]=e}var qo=this.p;if(null!=l){if(l.zero(),qo.sizeVec3==qo.stackVec3.length){for(var Eo=qo.sizeVec3<<1,Do=new Array(Eo),Fo=0,No=qo.sizeVec3;Fo<No;){var Wo=Fo++;Do[Wo]=qo.stackVec3[Wo],qo.stackVec3[Wo]=null}qo.stackVec3=Do}qo.stackVec3[qo.sizeVec3++]=l}}sphere(i,a,s){var o=this.p,n=0==o.sizeVec3?new t.common.Vec3:o.stackVec3[--o.sizeVec3],r=this.p,_=0==r.sizeMat3?new t.common.Mat3:r.stackMat3[--r.sizeMat3],e=n;e.x=i._positionX,e.y=i._positionY,e.z=i._positionZ;var h=_;h.e00=i._rotation00,h.e01=i._rotation01,h.e02=i._rotation02,h.e10=i._rotation10,h.e11=i._rotation11,h.e12=i._rotation12,h.e20=i._rotation20,h.e21=i._rotation21,h.e22=i._rotation22;for(var l=this.tmpSphereVerts,c=this.tmpSphereNorms,m=0;m<5;)for(var v=m++,b=0,x=this.tmpSphereVerts[v].length;b<x;){var p=b++,f=c[v][p],u=this.sphereCoords[v][p];f.x=u.x,f.y=u.y,f.z=u.z;var y=f,X=y.x*_.e00+y.y*_.e01+y.z*_.e02,g=y.x*_.e10+y.y*_.e11+y.z*_.e12,z=y.x*_.e20+y.y*_.e21+y.z*_.e22;y.x=X,y.y=g,y.z=z;var d=l[v][p],Y=c[v][p];d.x=Y.x,d.y=Y.y,d.z=Y.z;var Z=d,M=Z.x*a,I=Z.y*a,V=Z.z*a;Z.x=M,Z.y=I,Z.z=V;var L=Z,w=L.x+n.x,k=L.y+n.y,B=L.z+n.z;L.x=w,L.y=k,L.z=B}for(var A=0;A<4;)for(var P=A++,S=0;S<8;){var T,C,j,R,q,E,D,F,N=S++;0==P?this.wireframe?(T=l[0][0],C=l[1][N],this.line(T,C,s)):(T=l[0][0],C=l[1][N],j=l[1][(N+1)%8],q=c[0][0],E=c[1][N],D=c[1][(N+1)%8],this.triangle(T,C,j,q,E,D,s)):3==P?this.wireframe?(T=l[4][0],C=l[P][(N+1)%8],j=l[P][N],this.line(T,C,s),this.line(C,j,s)):(T=l[4][0],C=l[P][(N+1)%8],j=l[P][N],q=c[4][0],E=c[P][(N+1)%8],D=c[P][N],this.triangle(T,C,j,q,E,D,s)):this.wireframe?(T=l[P][N],C=l[P][(N+1)%8],j=l[P+1][N],this.line(T,C,s),this.line(T,j,s)):(T=l[P][N],C=l[P][(N+1)%8],j=l[P+1][N],R=l[P+1][(N+1)%8],q=c[P][N],E=c[P][(N+1)%8],D=c[P+1][N],F=c[P+1][(N+1)%8],this.rect(T,j,R,C,q,D,F,E,s))}var W=this.p;if(null!=n){if(n.zero(),W.sizeVec3==W.stackVec3.length){for(var G=W.sizeVec3<<1,J=new Array(G),O=0,H=W.sizeVec3;O<H;){var U=O++;J[U]=W.stackVec3[U],W.stackVec3[U]=null}W.stackVec3=J}W.stackVec3[W.sizeVec3++]=n}var Q=this.p;if(null!=_){if(_.e00=1,_.e01=0,_.e02=0,_.e10=0,_.e11=1,_.e12=0,_.e20=0,_.e21=0,_.e22=1,Q.sizeMat3==Q.stackMat3.length){for(var K=Q.sizeMat3<<1,$=new Array(K),tt=0,it=Q.sizeMat3;tt<it;){var at=tt++;$[at]=Q.stackMat3[at],Q.stackMat3[at]=null}Q.stackMat3=$}Q.stackMat3[Q.sizeMat3++]=_}}box(i,a,s){var o=this.p,n=0==o.sizeVec3?new t.common.Vec3:o.stackVec3[--o.sizeVec3],r=this.p,_=0==r.sizeVec3?new t.common.Vec3:r.stackVec3[--r.sizeVec3],e=this.p,h=0==e.sizeVec3?new t.common.Vec3:e.stackVec3[--e.sizeVec3],l=this.p,c=0==l.sizeVec3?new t.common.Vec3:l.stackVec3[--l.sizeVec3],m=this.p,v=0==m.sizeMat3?new t.common.Mat3:m.stackMat3[--m.sizeMat3],b=c;b.x=i._positionX,b.y=i._positionY,b.z=i._positionZ;var x=v;x.e00=i._rotation00,x.e01=i._rotation01,x.e02=i._rotation02,x.e10=i._rotation10,x.e11=i._rotation11,x.e12=i._rotation12,x.e20=i._rotation20,x.e21=i._rotation21,x.e22=i._rotation22,n.init(v.e00,v.e10,v.e20),_.init(v.e01,v.e11,v.e21),h.init(v.e02,v.e12,v.e22);var p=a.x,f=a.y,u=a.z,y=this.p,X=0==y.sizeVec3?new t.common.Vec3:y.stackVec3[--y.sizeVec3];X.x=c.x,X.y=c.y,X.z=c.z;var g=X,z=-p,d=g.x+n.x*z,Y=g.y+n.y*z,Z=g.z+n.z*z;g.x=d,g.y=Y,g.z=Z;var M=g,I=-f,V=M.x+_.x*I,L=M.y+_.y*I,w=M.z+_.z*I;M.x=V,M.y=L,M.z=w;var k=M,B=-u,A=k.x+h.x*B,P=k.y+h.y*B,S=k.z+h.z*B;k.x=A,k.y=P,k.z=S;var T=k,C=this.p,j=0==C.sizeVec3?new t.common.Vec3:C.stackVec3[--C.sizeVec3];j.x=c.x,j.y=c.y,j.z=c.z;var R=j,q=-p,E=R.x+n.x*q,D=R.y+n.y*q,F=R.z+n.z*q;R.x=E,R.y=D,R.z=F;var N=R,W=-f,G=N.x+_.x*W,J=N.y+_.y*W,O=N.z+_.z*W;N.x=G,N.y=J,N.z=O;var H=N,U=H.x+h.x*u,Q=H.y+h.y*u,K=H.z+h.z*u;H.x=U,H.y=Q,H.z=K;var $=H,tt=this.p,it=0==tt.sizeVec3?new t.common.Vec3:tt.stackVec3[--tt.sizeVec3];it.x=c.x,it.y=c.y,it.z=c.z;var at=it,st=-p,ot=at.x+n.x*st,nt=at.y+n.y*st,rt=at.z+n.z*st;at.x=ot,at.y=nt,at.z=rt;var _t=at,et=_t.x+_.x*f,ht=_t.y+_.y*f,lt=_t.z+_.z*f;_t.x=et,_t.y=ht,_t.z=lt;var ct=_t,mt=-u,vt=ct.x+h.x*mt,bt=ct.y+h.y*mt,xt=ct.z+h.z*mt;ct.x=vt,ct.y=bt,ct.z=xt;var pt=ct,ft=this.p,ut=0==ft.sizeVec3?new t.common.Vec3:ft.stackVec3[--ft.sizeVec3];ut.x=c.x,ut.y=c.y,ut.z=c.z;var yt=ut,Xt=-p,gt=yt.x+n.x*Xt,zt=yt.y+n.y*Xt,dt=yt.z+n.z*Xt;yt.x=gt,yt.y=zt,yt.z=dt;var Yt=yt,Zt=Yt.x+_.x*f,Mt=Yt.y+_.y*f,It=Yt.z+_.z*f;Yt.x=Zt,Yt.y=Mt,Yt.z=It;var Vt=Yt,Lt=Vt.x+h.x*u,wt=Vt.y+h.y*u,kt=Vt.z+h.z*u;Vt.x=Lt,Vt.y=wt,Vt.z=kt;var Bt=Vt,At=this.p,Pt=0==At.sizeVec3?new t.common.Vec3:At.stackVec3[--At.sizeVec3];Pt.x=c.x,Pt.y=c.y,Pt.z=c.z;var St=Pt,Tt=St.x+n.x*p,Ct=St.y+n.y*p,jt=St.z+n.z*p;St.x=Tt,St.y=Ct,St.z=jt;var Rt=St,qt=-f,Et=Rt.x+_.x*qt,Dt=Rt.y+_.y*qt,Ft=Rt.z+_.z*qt;Rt.x=Et,Rt.y=Dt,Rt.z=Ft;var Nt=Rt,Wt=-u,Gt=Nt.x+h.x*Wt,Jt=Nt.y+h.y*Wt,Ot=Nt.z+h.z*Wt;Nt.x=Gt,Nt.y=Jt,Nt.z=Ot;var Ht=Nt,Ut=this.p,Qt=0==Ut.sizeVec3?new t.common.Vec3:Ut.stackVec3[--Ut.sizeVec3];Qt.x=c.x,Qt.y=c.y,Qt.z=c.z;var Kt=Qt,$t=Kt.x+n.x*p,ti=Kt.y+n.y*p,ii=Kt.z+n.z*p;Kt.x=$t,Kt.y=ti,Kt.z=ii;var ai=Kt,si=-f,oi=ai.x+_.x*si,ni=ai.y+_.y*si,ri=ai.z+_.z*si;ai.x=oi,ai.y=ni,ai.z=ri;var _i=ai,ei=_i.x+h.x*u,hi=_i.y+h.y*u,li=_i.z+h.z*u;_i.x=ei,_i.y=hi,_i.z=li;var ci=_i,mi=this.p,vi=0==mi.sizeVec3?new t.common.Vec3:mi.stackVec3[--mi.sizeVec3];vi.x=c.x,vi.y=c.y,vi.z=c.z;var bi=vi,xi=bi.x+n.x*p,pi=bi.y+n.y*p,fi=bi.z+n.z*p;bi.x=xi,bi.y=pi,bi.z=fi;var ui=bi,yi=ui.x+_.x*f,Xi=ui.y+_.y*f,gi=ui.z+_.z*f;ui.x=yi,ui.y=Xi,ui.z=gi;var zi=ui,di=-u,Yi=zi.x+h.x*di,Zi=zi.y+h.y*di,Mi=zi.z+h.z*di;zi.x=Yi,zi.y=Zi,zi.z=Mi;var Ii=zi,Vi=this.p,Li=0==Vi.sizeVec3?new t.common.Vec3:Vi.stackVec3[--Vi.sizeVec3];Li.x=c.x,Li.y=c.y,Li.z=c.z;var wi=Li,ki=wi.x+n.x*p,Bi=wi.y+n.y*p,Ai=wi.z+n.z*p;wi.x=ki,wi.y=Bi,wi.z=Ai;var Pi=wi,Si=Pi.x+_.x*f,Ti=Pi.y+_.y*f,Ci=Pi.z+_.z*f;Pi.x=Si,Pi.y=Ti,Pi.z=Ci;var ji=Pi,Ri=ji.x+h.x*u,qi=ji.y+h.y*u,Ei=ji.z+h.z*u;ji.x=Ri,ji.y=qi,ji.z=Ei;var Di=ji;if(this.wireframe)this.line(T,$,s),this.line(pt,Bt,s),this.line(Ht,ci,s),this.line(Ii,Di,s),this.line(T,pt,s),this.line($,Bt,s),this.line(Ht,Ii,s),this.line(ci,Di,s),this.line(T,Ht,s),this.line($,ci,s),this.line(pt,Ii,s),this.line(Bt,Di,s);else{var Fi=this.p,Ni=0==Fi.sizeVec3?new t.common.Vec3:Fi.stackVec3[--Fi.sizeVec3];Ni.x=n.x,Ni.y=n.y,Ni.z=n.z;var Wi=Ni,Gi=-Wi.x,Ji=-Wi.y,Oi=-Wi.z;Wi.x=Gi,Wi.y=Ji,Wi.z=Oi;var Hi=Wi,Ui=this.p,Qi=0==Ui.sizeVec3?new t.common.Vec3:Ui.stackVec3[--Ui.sizeVec3];Qi.x=_.x,Qi.y=_.y,Qi.z=_.z;var Ki=Qi,$i=-Ki.x,ta=-Ki.y,ia=-Ki.z;Ki.x=$i,Ki.y=ta,Ki.z=ia;var aa=Ki,sa=this.p,oa=0==sa.sizeVec3?new t.common.Vec3:sa.stackVec3[--sa.sizeVec3];oa.x=h.x,oa.y=h.y,oa.z=h.z;var na=oa,ra=-na.x,_a=-na.y,ea=-na.z;na.x=ra,na.y=_a,na.z=ea;var ha=na;this.rect(T,$,Bt,pt,Hi,Hi,Hi,Hi,s),this.rect(Ht,Ii,Di,ci,n,n,n,n,s),this.rect(T,Ht,ci,$,aa,aa,aa,aa,s),this.rect(pt,Bt,Di,Ii,_,_,_,_,s),this.rect(T,pt,Ii,Ht,ha,ha,ha,ha,s),this.rect($,ci,Di,Bt,h,h,h,h,s);var la=this.p;if(null!=Hi){if(Hi.zero(),la.sizeVec3==la.stackVec3.length){for(var ca=la.sizeVec3<<1,ma=new Array(ca),va=0,ba=la.sizeVec3;va<ba;){var xa=va++;ma[xa]=la.stackVec3[xa],la.stackVec3[xa]=null}la.stackVec3=ma}la.stackVec3[la.sizeVec3++]=Hi}var pa=this.p;if(null!=aa){if(aa.zero(),pa.sizeVec3==pa.stackVec3.length){for(var fa=pa.sizeVec3<<1,ua=new Array(fa),ya=0,Xa=pa.sizeVec3;ya<Xa;){var ga=ya++;ua[ga]=pa.stackVec3[ga],pa.stackVec3[ga]=null}pa.stackVec3=ua}pa.stackVec3[pa.sizeVec3++]=aa}var za=this.p;if(null!=ha){if(ha.zero(),za.sizeVec3==za.stackVec3.length){for(var da=za.sizeVec3<<1,Ya=new Array(da),Za=0,Ma=za.sizeVec3;Za<Ma;){var Ia=Za++;Ya[Ia]=za.stackVec3[Ia],za.stackVec3[Ia]=null}za.stackVec3=Ya}za.stackVec3[za.sizeVec3++]=ha}}var Va=this.p;if(null!=T){if(T.zero(),Va.sizeVec3==Va.stackVec3.length){for(var La=Va.sizeVec3<<1,wa=new Array(La),ka=0,Ba=Va.sizeVec3;ka<Ba;){var Aa=ka++;wa[Aa]=Va.stackVec3[Aa],Va.stackVec3[Aa]=null}Va.stackVec3=wa}Va.stackVec3[Va.sizeVec3++]=T}var Pa=this.p;if(null!=$){if($.zero(),Pa.sizeVec3==Pa.stackVec3.length){for(var Sa=Pa.sizeVec3<<1,Ta=new Array(Sa),Ca=0,ja=Pa.sizeVec3;Ca<ja;){var Ra=Ca++;Ta[Ra]=Pa.stackVec3[Ra],Pa.stackVec3[Ra]=null}Pa.stackVec3=Ta}Pa.stackVec3[Pa.sizeVec3++]=$}var qa=this.p;if(null!=pt){if(pt.zero(),qa.sizeVec3==qa.stackVec3.length){for(var Ea=qa.sizeVec3<<1,Da=new Array(Ea),Fa=0,Na=qa.sizeVec3;Fa<Na;){var Wa=Fa++;Da[Wa]=qa.stackVec3[Wa],qa.stackVec3[Wa]=null}qa.stackVec3=Da}qa.stackVec3[qa.sizeVec3++]=pt}var Ga=this.p;if(null!=Bt){if(Bt.zero(),Ga.sizeVec3==Ga.stackVec3.length){for(var Ja=Ga.sizeVec3<<1,Oa=new Array(Ja),Ha=0,Ua=Ga.sizeVec3;Ha<Ua;){var Qa=Ha++;Oa[Qa]=Ga.stackVec3[Qa],Ga.stackVec3[Qa]=null}Ga.stackVec3=Oa}Ga.stackVec3[Ga.sizeVec3++]=Bt}var Ka=this.p;if(null!=Ht){if(Ht.zero(),Ka.sizeVec3==Ka.stackVec3.length){for(var $a=Ka.sizeVec3<<1,ts=new Array($a),is=0,as=Ka.sizeVec3;is<as;){var ss=is++;ts[ss]=Ka.stackVec3[ss],Ka.stackVec3[ss]=null}Ka.stackVec3=ts}Ka.stackVec3[Ka.sizeVec3++]=Ht}var os=this.p;if(null!=ci){if(ci.zero(),os.sizeVec3==os.stackVec3.length){for(var ns=os.sizeVec3<<1,rs=new Array(ns),_s=0,es=os.sizeVec3;_s<es;){var hs=_s++;rs[hs]=os.stackVec3[hs],os.stackVec3[hs]=null}os.stackVec3=rs}os.stackVec3[os.sizeVec3++]=ci}var ls=this.p;if(null!=Ii){if(Ii.zero(),ls.sizeVec3==ls.stackVec3.length){for(var cs=ls.sizeVec3<<1,ms=new Array(cs),vs=0,bs=ls.sizeVec3;vs<bs;){var xs=vs++;ms[xs]=ls.stackVec3[xs],ls.stackVec3[xs]=null}ls.stackVec3=ms}ls.stackVec3[ls.sizeVec3++]=Ii}var ps=this.p;if(null!=Di){if(Di.zero(),ps.sizeVec3==ps.stackVec3.length){for(var fs=ps.sizeVec3<<1,us=new Array(fs),ys=0,Xs=ps.sizeVec3;ys<Xs;){var gs=ys++;us[gs]=ps.stackVec3[gs],ps.stackVec3[gs]=null}ps.stackVec3=us}ps.stackVec3[ps.sizeVec3++]=Di}var zs=this.p;if(null!=c){if(c.zero(),zs.sizeVec3==zs.stackVec3.length){for(var ds=zs.sizeVec3<<1,Ys=new Array(ds),Zs=0,Ms=zs.sizeVec3;Zs<Ms;){var Is=Zs++;Ys[Is]=zs.stackVec3[Is],zs.stackVec3[Is]=null}zs.stackVec3=Ys}zs.stackVec3[zs.sizeVec3++]=c}var Vs=this.p;if(null!=v){if(v.e00=1,v.e01=0,v.e02=0,v.e10=0,v.e11=1,v.e12=0,v.e20=0,v.e21=0,v.e22=1,Vs.sizeMat3==Vs.stackMat3.length){for(var Ls=Vs.sizeMat3<<1,ws=new Array(Ls),ks=0,Bs=Vs.sizeMat3;ks<Bs;){var As=ks++;ws[As]=Vs.stackMat3[As],Vs.stackMat3[As]=null}Vs.stackMat3=ws}Vs.stackMat3[Vs.sizeMat3++]=v}var Ps=this.p;if(null!=n){if(n.zero(),Ps.sizeVec3==Ps.stackVec3.length){for(var Ss=Ps.sizeVec3<<1,Ts=new Array(Ss),Cs=0,js=Ps.sizeVec3;Cs<js;){var Rs=Cs++;Ts[Rs]=Ps.stackVec3[Rs],Ps.stackVec3[Rs]=null}Ps.stackVec3=Ts}Ps.stackVec3[Ps.sizeVec3++]=n}var qs=this.p;if(null!=_){if(_.zero(),qs.sizeVec3==qs.stackVec3.length){for(var Es=qs.sizeVec3<<1,Ds=new Array(Es),Fs=0,Ns=qs.sizeVec3;Fs<Ns;){var Ws=Fs++;Ds[Ws]=qs.stackVec3[Ws],qs.stackVec3[Ws]=null}qs.stackVec3=Ds}qs.stackVec3[qs.sizeVec3++]=_}var Gs=this.p;if(null!=h){if(h.zero(),Gs.sizeVec3==Gs.stackVec3.length){for(var Js=Gs.sizeVec3<<1,Os=new Array(Js),Hs=0,Us=Gs.sizeVec3;Hs<Us;){var Qs=Hs++;Os[Qs]=Gs.stackVec3[Qs],Gs.stackVec3[Qs]=null}Gs.stackVec3=Os}Gs.stackVec3[Gs.sizeVec3++]=h}}rect(t,i,a,s,o,n,r,_,e){this.triangle(t,i,a,o,n,r,e),this.triangle(t,a,s,o,r,_,e)}point(t,i){}triangle(t,i,a,s,o,n,r){}line(t,i,a){}},t.dynamics.common.DebugDrawStyle=class{constructor(){this.basisColorZ=new t.common.Vec3(0,0,1),this.basisColorY=new t.common.Vec3(0,1,0),this.basisColorX=new t.common.Vec3(1,0,0),this.basisLength=.5,this.jointRotationalConstraintRadius=.3,this.jointErrorColor=new t.common.Vec3(1,.1,.1),this.jointLineColor=new t.common.Vec3(.8,.8,.8),this.contactBinormalLength=.5,this.contactTangentLength=.5,this.contactNormalLength=.5,this.contactBinormalColor=new t.common.Vec3(.2,.2,1),this.contactTangentColor=new t.common.Vec3(.1,.8,.1),this.contactNormalColor=new t.common.Vec3(1,.1,.1),this.disabledContactColor=new t.common.Vec3(.5,.1,.1),this.newContactColor=new t.common.Vec3(1,1,.1),this.contactColor4=new t.common.Vec3(.8,.1,1),this.contactColor3=new t.common.Vec3(.1,.8,.6),this.contactColor2=new t.common.Vec3(1,.6,.1),this.contactColor=new t.common.Vec3(1,.1,.1),this.pairColor=new t.common.Vec3(1,1,.1),this.bvhNodeColor=new t.common.Vec3(.4,.4,.4),this.aabbColor=new t.common.Vec3(1,.1,.1),this.kinematicShapeColor=new t.common.Vec3(1,.5,.1),this.staticShapeColor=new t.common.Vec3(.7,.7,.7),this.sleepingShapeColor2=new t.common.Vec3(.2,.8,.5),this.sleepingShapeColor1=new t.common.Vec3(.3,.3,.8),this.sleepyShapeColor2=new t.common.Vec3(.6,.8,.3),this.sleepyShapeColor1=new t.common.Vec3(.5,.25,.6),this.shapeColor2=new t.common.Vec3(1,.8,.1),this.shapeColor1=new t.common.Vec3(.7,.2,.4)}},t.dynamics.common.Performance=class{},t.dynamics.constraint||(t.dynamics.constraint={}),t.dynamics.constraint.ConstraintSolver=class{constructor(){this._b1=null,this._b2=null,this._addedToIsland=!1}preSolveVelocity(t){}warmStart(t){}solveVelocity(){}postSolveVelocity(t){}preSolvePosition(t){}solvePositionSplitImpulse(){}solvePositionNgs(t){}postSolve(){}},t.dynamics.constraint.PositionCorrectionAlgorithm=class{},t.dynamics.constraint.contact||(t.dynamics.constraint.contact={}),t.dynamics.constraint.contact.ContactConstraint=class{constructor(i){this._solver=new t.dynamics.constraint.solver.pgs.PgsContactConstraintSolver(this),this._manifold=i}_getVelocitySolverInfo(i,a){var s,o,n,r,_,e,h,l,c;a.b1=this._b1,a.b2=this._b2,s=this._manifold._normalX,o=this._manifold._normalY,n=this._manifold._normalZ,r=this._manifold._tangentX,_=this._manifold._tangentY,e=this._manifold._tangentZ,h=this._manifold._binormalX,l=this._manifold._binormalY,c=this._manifold._binormalZ;var m=Math.sqrt(this._s1._friction*this._s2._friction),v=Math.sqrt(this._s1._restitution*this._s2._restitution),b=this._manifold._numPoints;a.numRows=0,this._tf1._positionX,this._tf2._positionX,this._tf1._positionY,this._tf2._positionY,this._tf1._positionZ,this._tf2._positionZ;for(var x=0,p=b;x<p;){var f=x++,u=this._manifold._points[f];if(u._depth<0){u._disabled=!0;var y=u._impulse;y.impulseN=0,y.impulseT=0,y.impulseB=0,y.impulseP=0,y.impulseLX=0,y.impulseLY=0,y.impulseLZ=0}else{u._disabled=!1;var X=a.rows[a.numRows++];X.friction=m,X.cfm=0;var g=X.jacobianN;g.lin1X=s,g.lin1Y=o,g.lin1Z=n,g.lin2X=s,g.lin2Y=o,g.lin2Z=n,g.ang1X=u._relPos1Y*n-u._relPos1Z*o,g.ang1Y=u._relPos1Z*s-u._relPos1X*n,g.ang1Z=u._relPos1X*o-u._relPos1Y*s,g.ang2X=u._relPos2Y*n-u._relPos2Z*o,g.ang2Y=u._relPos2Z*s-u._relPos2X*n,g.ang2Z=u._relPos2X*o-u._relPos2Y*s,(g=X.jacobianT).lin1X=r,g.lin1Y=_,g.lin1Z=e,g.lin2X=r,g.lin2Y=_,g.lin2Z=e,g.ang1X=u._relPos1Y*e-u._relPos1Z*_,g.ang1Y=u._relPos1Z*r-u._relPos1X*e,g.ang1Z=u._relPos1X*_-u._relPos1Y*r,g.ang2X=u._relPos2Y*e-u._relPos2Z*_,g.ang2Y=u._relPos2Z*r-u._relPos2X*e,g.ang2Z=u._relPos2X*_-u._relPos2Y*r,(g=X.jacobianB).lin1X=h,g.lin1Y=l,g.lin1Z=c,g.lin2X=h,g.lin2Y=l,g.lin2Z=c,g.ang1X=u._relPos1Y*c-u._relPos1Z*l,g.ang1Y=u._relPos1Z*h-u._relPos1X*c,g.ang1Z=u._relPos1X*l-u._relPos1Y*h,g.ang2X=u._relPos2Y*c-u._relPos2Z*l,g.ang2Y=u._relPos2Z*h-u._relPos2X*c,g.ang2Z=u._relPos2X*l-u._relPos2Y*h;var z=(g=X.jacobianN).lin1X*this._b1._velX+g.lin1Y*this._b1._velY+g.lin1Z*this._b1._velZ+(g.ang1X*this._b1._angVelX+g.ang1Y*this._b1._angVelY+g.ang1Z*this._b1._angVelZ)-(g.lin2X*this._b2._velX+g.lin2Y*this._b2._velY+g.lin2Z*this._b2._velZ+(g.ang2X*this._b2._angVelX+g.ang2Y*this._b2._angVelY+g.ang2Z*this._b2._angVelZ));if(z<-t.common.Setting.contactEnableBounceThreshold&&!u._warmStarted?X.rhs=-z*v:X.rhs=0,this._positionCorrectionAlgorithm==t.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE&&u._depth>t.common.Setting.linearSlop){var d=(u._depth-t.common.Setting.linearSlop)*t.common.Setting.velocityBaumgarte*i.invDt;X.rhs<d&&(X.rhs=d)}if(!u._warmStarted){var Y=u._impulse;Y.impulseN=0,Y.impulseT=0,Y.impulseB=0,Y.impulseP=0,Y.impulseLX=0,Y.impulseLY=0,Y.impulseLZ=0}X.impulse=u._impulse}}}_getPositionSolverInfo(i){var a,s,o;i.b1=this._b1,i.b2=this._b2,a=this._manifold._normalX,s=this._manifold._normalY,o=this._manifold._normalZ;var n=this._manifold._numPoints;i.numRows=0;for(var r=0,_=n;r<_;){var e=r++,h=this._manifold._points[e];if(!h._disabled){var l=i.rows[i.numRows++],c=l.jacobianN;c.lin1X=a,c.lin1Y=s,c.lin1Z=o,c.lin2X=a,c.lin2Y=s,c.lin2Z=o,c.ang1X=h._relPos1Y*o-h._relPos1Z*s,c.ang1Y=h._relPos1Z*a-h._relPos1X*o,c.ang1Z=h._relPos1X*s-h._relPos1Y*a,c.ang2X=h._relPos2Y*o-h._relPos2Z*s,c.ang2Y=h._relPos2Z*a-h._relPos2X*o,c.ang2Z=h._relPos2X*s-h._relPos2Y*a,l.rhs=h._depth-t.common.Setting.linearSlop,l.rhs<0&&(l.rhs=0),l.impulse=h._impulse}}}_syncManifold(){this._manifold._updateDepthsAndPositions(this._tf1,this._tf2)}getShape1(){return this._s1}getShape2(){return this._s2}getManifold(){return this._manifold}isTouching(){for(var t=0,i=this._manifold._numPoints;t<i;){var a=t++;if(this._manifold._points[a]._depth>=0)return!0}return!1}},t.dynamics.constraint.contact.ContactImpulse=class{constructor(){this.impulseN=0,this.impulseT=0,this.impulseB=0,this.impulseP=0,this.impulseLX=0,this.impulseLY=0,this.impulseLZ=0}copyFrom(t){this.impulseN=t.impulseN,this.impulseT=t.impulseT,this.impulseB=t.impulseB,this.impulseLX=t.impulseLX,this.impulseLY=t.impulseLY,this.impulseLZ=t.impulseLZ}},t.dynamics.constraint.contact.Manifold=class{constructor(){this._normalX=0,this._normalY=0,this._normalZ=0,this._tangentX=0,this._tangentY=0,this._tangentZ=0,this._binormalX=0,this._binormalY=0,this._binormalZ=0,this._numPoints=0;var i=new Array(t.common.Setting.maxManifoldPoints);this._points=i;for(var a=0,s=t.common.Setting.maxManifoldPoints;a<s;){var o=a++;this._points[o]=new t.dynamics.constraint.contact.ManifoldPoint}}_clear(){for(var t=0,i=this._numPoints;t<i;){var a=t++,s=this._points[a];s._localPos1X=0,s._localPos1Y=0,s._localPos1Z=0,s._localPos2X=0,s._localPos2Y=0,s._localPos2Z=0,s._relPos1X=0,s._relPos1Y=0,s._relPos1Z=0,s._relPos2X=0,s._relPos2Y=0,s._relPos2Z=0,s._pos1X=0,s._pos1Y=0,s._pos1Z=0,s._pos2X=0,s._pos2Y=0,s._pos2Z=0,s._depth=0;var o=s._impulse;o.impulseN=0,o.impulseT=0,o.impulseB=0,o.impulseP=0,o.impulseLX=0,o.impulseLY=0,o.impulseLZ=0,s._warmStarted=!1,s._disabled=!1,s._id=-1}this._numPoints=0}_buildBasis(t){var i=t;this._normalX=i.x,this._normalY=i.y,this._normalZ=i.z;var a,s,o,n,r,_,e=t.x,h=t.y,l=t.z,c=e*e,m=h*h,v=l*l;if(c<m)if(c<v){var b=1/Math.sqrt(m+v);a=0,n=h*(o=h*b)-l*(s=-l*b),r=-e*o,_=e*s}else{var x=1/Math.sqrt(c+m);o=0,n=-l*(s=e*x),r=l*(a=-h*x),_=e*s-h*a}else if(m<v){var p=1/Math.sqrt(c+v);s=0,n=h*(o=-e*p),r=l*(a=l*p)-e*o,_=-h*a}else{var f=1/Math.sqrt(c+m);o=0,n=-l*(s=e*f),r=l*(a=-h*f),_=e*s-h*a}this._tangentX=a,this._tangentY=s,this._tangentZ=o,this._binormalX=n,this._binormalY=r,this._binormalZ=_}_updateDepthsAndPositions(t,i){for(var a=0,s=this._numPoints;a<s;){var o,n,r,_,e,h,l,c,m,v=a++,b=this._points[v];o=t._rotation00*b._localPos1X+t._rotation01*b._localPos1Y+t._rotation02*b._localPos1Z,n=t._rotation10*b._localPos1X+t._rotation11*b._localPos1Y+t._rotation12*b._localPos1Z,r=t._rotation20*b._localPos1X+t._rotation21*b._localPos1Y+t._rotation22*b._localPos1Z,b._relPos1X=o,b._relPos1Y=n,b._relPos1Z=r,_=i._rotation00*b._localPos2X+i._rotation01*b._localPos2Y+i._rotation02*b._localPos2Z,e=i._rotation10*b._localPos2X+i._rotation11*b._localPos2Y+i._rotation12*b._localPos2Z,h=i._rotation20*b._localPos2X+i._rotation21*b._localPos2Y+i._rotation22*b._localPos2Z,b._relPos2X=_,b._relPos2Y=e,b._relPos2Z=h,b._pos1X=b._relPos1X+t._positionX,b._pos1Y=b._relPos1Y+t._positionY,b._pos1Z=b._relPos1Z+t._positionZ,b._pos2X=b._relPos2X+i._positionX,b._pos2Y=b._relPos2Y+i._positionY,b._pos2Z=b._relPos2Z+i._positionZ,l=b._pos1X-b._pos2X,c=b._pos1Y-b._pos2Y,m=b._pos1Z-b._pos2Z;var x=l*this._normalX+c*this._normalY+m*this._normalZ;b._depth=-x}}getNormal(){var i=new t.common.Vec3,a=i;return a.x=this._normalX,a.y=this._normalY,a.z=this._normalZ,i}getNormalTo(t){var i=t;i.x=this._normalX,i.y=this._normalY,i.z=this._normalZ}getTangent(){var i=new t.common.Vec3,a=i;return a.x=this._tangentX,a.y=this._tangentY,a.z=this._tangentZ,i}getTangentTo(t){var i=t;i.x=this._tangentX,i.y=this._tangentY,i.z=this._tangentZ}getBinormal(){var i=new t.common.Vec3,a=i;return a.x=this._binormalX,a.y=this._binormalY,a.z=this._binormalZ,i}getBinormalTo(t){var i=t;i.x=this._binormalX,i.y=this._binormalY,i.z=this._binormalZ}getPoints(){return this._points}getNumPoints(){return this._numPoints}},t.dynamics.constraint.contact.ManifoldPoint=class{constructor(){this._localPos1X=0,this._localPos1Y=0,this._localPos1Z=0,this._localPos2X=0,this._localPos2Y=0,this._localPos2Z=0,this._relPos1X=0,this._relPos1Y=0,this._relPos1Z=0,this._relPos2X=0,this._relPos2Y=0,this._relPos2Z=0,this._pos1X=0,this._pos1Y=0,this._pos1Z=0,this._pos2X=0,this._pos2Y=0,this._pos2Z=0,this._depth=0,this._impulse=new t.dynamics.constraint.contact.ContactImpulse,this._warmStarted=!1,this._disabled=!1,this._id=-1}getPosition1(){var i=new t.common.Vec3,a=i;return a.x=this._pos1X,a.y=this._pos1Y,a.z=this._pos1Z,i}getPosition1To(t){var i=t;i.x=this._pos1X,i.y=this._pos1Y,i.z=this._pos1Z}getPosition2(){var i=new t.common.Vec3,a=i;return a.x=this._pos2X,a.y=this._pos2Y,a.z=this._pos2Z,i}getPosition2To(t){var i=t;i.x=this._pos2X,i.y=this._pos2Y,i.z=this._pos2Z}getDepth(){return this._depth}isWarmStarted(){return this._warmStarted}getNormalImpulse(){return this._impulse.impulseN}getTangentImpulse(){return this._impulse.impulseT}getBinormalImpulse(){return this._impulse.impulseB}isEnabled(){return!this._disabled}},t.dynamics.constraint.contact.ManifoldUpdater=class{constructor(i){this._manifold=i,this.numOldPoints=0;var a=new Array(t.common.Setting.maxManifoldPoints);this.oldPoints=a;for(var s=0,o=t.common.Setting.maxManifoldPoints;s<o;){var n=s++;this.oldPoints[n]=new t.dynamics.constraint.contact.ManifoldPoint}}removeOutdatedPoints(){for(var i=this._manifold._numPoints;--i>=0;){var a,s,o,n=this._manifold._points[i];a=n._pos1X-n._pos2X,s=n._pos1Y-n._pos2Y,o=n._pos1Z-n._pos2Z;var r=this._manifold._normalX*a+this._manifold._normalY*s+this._manifold._normalZ*o;r>t.common.Setting.contactPersistenceThreshold?this.removeManifoldPoint(i):(a+=this._manifold._normalX*-r)*a+(s+=this._manifold._normalY*-r)*s+(o+=this._manifold._normalZ*-r)*o>t.common.Setting.contactPersistenceThreshold*t.common.Setting.contactPersistenceThreshold&&this.removeManifoldPoint(i)}}removeManifoldPoint(t){var i=--this._manifold._numPoints;if(t!=i){var a=this._manifold._points[t];this._manifold._points[t]=this._manifold._points[i],this._manifold._points[i]=a}var s=this._manifold._points[i];s._localPos1X=0,s._localPos1Y=0,s._localPos1Z=0,s._localPos2X=0,s._localPos2Y=0,s._localPos2Z=0,s._relPos1X=0,s._relPos1Y=0,s._relPos1Z=0,s._relPos2X=0,s._relPos2Y=0,s._relPos2Z=0,s._pos1X=0,s._pos1Y=0,s._pos1Z=0,s._pos2X=0,s._pos2Y=0,s._pos2Z=0,s._depth=0;var o=s._impulse;o.impulseN=0,o.impulseT=0,o.impulseB=0,o.impulseP=0,o.impulseLX=0,o.impulseLY=0,o.impulseLZ=0,s._warmStarted=!1,s._disabled=!1,s._id=-1}addManifoldPoint(i,a,s){var o=this._manifold._numPoints;if(o==t.common.Setting.maxManifoldPoints){var n=this.computeTargetIndex(i,a,s),r=this._manifold._points[n],_=i.position1;r._pos1X=_.x,r._pos1Y=_.y,r._pos1Z=_.z;var e,h,l,c,m,v,b=i.position2;r._pos2X=b.x,r._pos2Y=b.y,r._pos2Z=b.z,r._relPos1X=r._pos1X-a._positionX,r._relPos1Y=r._pos1Y-a._positionY,r._relPos1Z=r._pos1Z-a._positionZ,r._relPos2X=r._pos2X-s._positionX,r._relPos2Y=r._pos2Y-s._positionY,r._relPos2Z=r._pos2Z-s._positionZ,e=a._rotation00*r._relPos1X+a._rotation10*r._relPos1Y+a._rotation20*r._relPos1Z,h=a._rotation01*r._relPos1X+a._rotation11*r._relPos1Y+a._rotation21*r._relPos1Z,l=a._rotation02*r._relPos1X+a._rotation12*r._relPos1Y+a._rotation22*r._relPos1Z,r._localPos1X=e,r._localPos1Y=h,r._localPos1Z=l,c=s._rotation00*r._relPos2X+s._rotation10*r._relPos2Y+s._rotation20*r._relPos2Z,m=s._rotation01*r._relPos2X+s._rotation11*r._relPos2Y+s._rotation21*r._relPos2Z,v=s._rotation02*r._relPos2X+s._rotation12*r._relPos2Y+s._rotation22*r._relPos2Z,r._localPos2X=c,r._localPos2Y=m,r._localPos2Z=v,r._depth=i.depth;var x=r._impulse;return x.impulseN=0,x.impulseT=0,x.impulseB=0,x.impulseP=0,x.impulseLX=0,x.impulseLY=0,x.impulseLZ=0,r._id=i.id,r._warmStarted=!1,void(r._disabled=!1)}var p=this._manifold._points[o],f=i.position1;p._pos1X=f.x,p._pos1Y=f.y,p._pos1Z=f.z;var u,y,X,g,z,d,Y=i.position2;p._pos2X=Y.x,p._pos2Y=Y.y,p._pos2Z=Y.z,p._relPos1X=p._pos1X-a._positionX,p._relPos1Y=p._pos1Y-a._positionY,p._relPos1Z=p._pos1Z-a._positionZ,p._relPos2X=p._pos2X-s._positionX,p._relPos2Y=p._pos2Y-s._positionY,p._relPos2Z=p._pos2Z-s._positionZ,u=a._rotation00*p._relPos1X+a._rotation10*p._relPos1Y+a._rotation20*p._relPos1Z,y=a._rotation01*p._relPos1X+a._rotation11*p._relPos1Y+a._rotation21*p._relPos1Z,X=a._rotation02*p._relPos1X+a._rotation12*p._relPos1Y+a._rotation22*p._relPos1Z,p._localPos1X=u,p._localPos1Y=y,p._localPos1Z=X,g=s._rotation00*p._relPos2X+s._rotation10*p._relPos2Y+s._rotation20*p._relPos2Z,z=s._rotation01*p._relPos2X+s._rotation11*p._relPos2Y+s._rotation21*p._relPos2Z,d=s._rotation02*p._relPos2X+s._rotation12*p._relPos2Y+s._rotation22*p._relPos2Z,p._localPos2X=g,p._localPos2Y=z,p._localPos2Z=d,p._depth=i.depth;var Z=p._impulse;Z.impulseN=0,Z.impulseT=0,Z.impulseB=0,Z.impulseP=0,Z.impulseLX=0,Z.impulseLY=0,Z.impulseLZ=0,p._id=i.id,p._warmStarted=!1,p._disabled=!1,this._manifold._numPoints++}computeTargetIndex(t,i,a){var s,o,n,r=this._manifold._points[0],_=this._manifold._points[1],e=this._manifold._points[2],h=this._manifold._points[3],l=r._depth,c=0;_._depth>l&&(l=_._depth,c=1),e._depth>l&&(l=e._depth,c=2),h._depth>l&&(l=h._depth,c=3);var m=t.position1;s=m.x,o=m.y,n=m.z,s-=i._positionX,o-=i._positionY,n-=i._positionZ;var v,b,x,p,f,u,y,X,g,z,d,Y,Z,M,I,V,L,w,k,B,A,P,S,T,C,j,R,q,E,D,F,N,W,G,J,O,H,U,Q,K,$,tt,it,at,st,ot,nt,rt,_t,et,ht,lt,ct,mt,vt,bt,xt,pt,ft,ut,yt,Xt,gt,zt,dt,Yt,Zt,Mt,It,Vt,Lt,wt,kt,Bt,At,Pt,St,Tt,Ct,jt,Rt,qt,Et,Dt,Ft,Nt,Wt,Gt,Jt,Ot,Ht,Ut,Qt,Kt,$t,ti,ii,ai,si,oi,ni,ri,_i,ei,hi,li,ci,mi,vi=_._relPos1X,bi=_._relPos1Y,xi=_._relPos1Z,pi=e._relPos1X,fi=e._relPos1Y,ui=e._relPos1Z,yi=h._relPos1X,Xi=h._relPos1Y,gi=h._relPos1Z,zi=(k=(b=fi-bi)*(u=n-gi)-(x=ui-xi)*(f=o-Xi))*k+(B=x*(p=s-yi)-(v=pi-vi)*u)*B+(A=v*f-b*p)*A,di=(P=(X=Xi-bi)*(Y=n-ui)-(g=gi-xi)*(d=o-fi))*P+(S=g*(z=s-pi)-(y=yi-vi)*Y)*S+(T=y*d-X*z)*T,Yi=(C=(M=o-bi)*(w=gi-ui)-(I=n-xi)*(L=Xi-fi))*C+(j=I*(V=yi-pi)-(Z=s-vi)*w)*j+(R=Z*L-M*V)*R,Zi=zi>di?zi>Yi?zi:Yi:di>Yi?di:Yi,Mi=r._relPos1X,Ii=r._relPos1Y,Vi=r._relPos1Z,Li=e._relPos1X,wi=e._relPos1Y,ki=e._relPos1Z,Bi=h._relPos1X,Ai=h._relPos1Y,Pi=h._relPos1Z,Si=(ot=(E=wi-Ii)*(W=n-Pi)-(D=ki-Vi)*(N=o-Ai))*ot+(nt=D*(F=s-Bi)-(q=Li-Mi)*W)*nt+(rt=q*N-E*F)*rt,Ti=(_t=(J=Ai-Ii)*(Q=n-ki)-(O=Pi-Vi)*(U=o-wi))*_t+(et=O*(H=s-Li)-(G=Bi-Mi)*Q)*et+(ht=G*U-J*H)*ht,Ci=(lt=($=o-Ii)*(st=Pi-ki)-(tt=n-Vi)*(at=Ai-wi))*lt+(ct=tt*(it=Bi-Li)-(K=s-Mi)*st)*ct+(mt=K*at-$*it)*mt,ji=Si>Ti?Si>Ci?Si:Ci:Ti>Ci?Ti:Ci,Ri=r._relPos1X,qi=r._relPos1Y,Ei=r._relPos1Z,Di=_._relPos1X,Fi=_._relPos1Y,Ni=_._relPos1Z,Wi=h._relPos1X,Gi=h._relPos1Y,Ji=h._relPos1Z,Oi=(kt=(bt=Fi-qi)*(ut=n-Ji)-(xt=Ni-Ei)*(ft=o-Gi))*kt+(Bt=xt*(pt=s-Wi)-(vt=Di-Ri)*ut)*Bt+(At=vt*ft-bt*pt)*At,Hi=(Pt=(Xt=Gi-qi)*(Yt=n-Ni)-(gt=Ji-Ei)*(dt=o-Fi))*Pt+(St=gt*(zt=s-Di)-(yt=Wi-Ri)*Yt)*St+(Tt=yt*dt-Xt*zt)*Tt,Ui=(Ct=(Mt=o-qi)*(wt=Ji-Ni)-(It=n-Ei)*(Lt=Gi-Fi))*Ct+(jt=It*(Vt=Wi-Di)-(Zt=s-Ri)*wt)*jt+(Rt=Zt*Lt-Mt*Vt)*Rt,Qi=Oi>Hi?Oi>Ui?Oi:Ui:Hi>Ui?Hi:Ui,Ki=r._relPos1X,$i=r._relPos1Y,ta=r._relPos1Z,ia=_._relPos1X,aa=_._relPos1Y,sa=_._relPos1Z,oa=e._relPos1X,na=e._relPos1Y,ra=e._relPos1Z,_a=(oi=(Et=aa-$i)*(Wt=n-ra)-(Dt=sa-ta)*(Nt=o-na))*oi+(ni=Dt*(Ft=s-oa)-(qt=ia-Ki)*Wt)*ni+(ri=qt*Nt-Et*Ft)*ri,ea=(_i=(Jt=na-$i)*(Qt=n-sa)-(Ot=ra-ta)*(Ut=o-aa))*_i+(ei=Ot*(Ht=s-ia)-(Gt=oa-Ki)*Qt)*ei+(hi=Gt*Ut-Jt*Ht)*hi,ha=(li=($t=o-$i)*(si=ra-sa)-(ti=n-ta)*(ai=na-aa))*li+(ci=ti*(ii=oa-ia)-(Kt=s-Ki)*si)*ci+(mi=Kt*ai-$t*ii)*mi,la=_a>ea?_a>ha?_a:ha:ea>ha?ea:ha,ca=Zi,ma=0;return(ji>ca&&1!=c||0==c)&&(ca=ji,ma=1),Qi>ca&&2!=c&&(ca=Qi,ma=2),la>ca&&3!=c&&(ca=la,ma=3),ma}computeRelativePositions(t,i){for(var a=0,s=this._manifold._numPoints;a<s;){var o,n,r,_,e,h,l=a++,c=this._manifold._points[l];o=t._rotation00*c._localPos1X+t._rotation01*c._localPos1Y+t._rotation02*c._localPos1Z,n=t._rotation10*c._localPos1X+t._rotation11*c._localPos1Y+t._rotation12*c._localPos1Z,r=t._rotation20*c._localPos1X+t._rotation21*c._localPos1Y+t._rotation22*c._localPos1Z,c._relPos1X=o,c._relPos1Y=n,c._relPos1Z=r,_=i._rotation00*c._localPos2X+i._rotation01*c._localPos2Y+i._rotation02*c._localPos2Z,e=i._rotation10*c._localPos2X+i._rotation11*c._localPos2Y+i._rotation12*c._localPos2Z,h=i._rotation20*c._localPos2X+i._rotation21*c._localPos2Y+i._rotation22*c._localPos2Z,c._relPos2X=_,c._relPos2Y=e,c._relPos2Z=h,c._warmStarted=!0}}findNearestContactPointIndex(i,a,s){for(var o=t.common.Setting.contactPersistenceThreshold*t.common.Setting.contactPersistenceThreshold,n=-1,r=0,_=this._manifold._numPoints;r<_;){var e,h,l,c,m,v,b=r++,x=this._manifold._points[b],p=i.position1;e=p.x,h=p.y,l=p.z;var f,u,y,X,g,z,d=i.position2;c=d.x,m=d.y,v=d.z,e-=a._positionX,h-=a._positionY,l-=a._positionZ,c-=s._positionX,m-=s._positionY,v-=s._positionZ;var Y=(f=x._relPos1X-e)*f+(u=x._relPos1Y-h)*u+(y=x._relPos1Z-l)*y,Z=(X=x._relPos2X-c)*X+(g=x._relPos2Y-m)*g+(z=x._relPos2Z-v)*z,M=Y<Z?Y:Z;M<o&&(o=M,n=b)}return n}totalUpdate(t,i,a){this.numOldPoints=this._manifold._numPoints;for(var s=0,o=this.numOldPoints;s<o;){var n=s++,r=this.oldPoints[n],_=this._manifold._points[n];r._localPos1X=_._localPos1X,r._localPos1Y=_._localPos1Y,r._localPos1Z=_._localPos1Z,r._localPos2X=_._localPos2X,r._localPos2Y=_._localPos2Y,r._localPos2Z=_._localPos2Z,r._relPos1X=_._relPos1X,r._relPos1Y=_._relPos1Y,r._relPos1Z=_._relPos1Z,r._relPos2X=_._relPos2X,r._relPos2Y=_._relPos2Y,r._relPos2Z=_._relPos2Z,r._pos1X=_._pos1X,r._pos1Y=_._pos1Y,r._pos1Z=_._pos1Z,r._pos2X=_._pos2X,r._pos2Y=_._pos2Y,r._pos2Z=_._pos2Z,r._depth=_._depth,r._impulse.copyFrom(_._impulse),r._id=_._id,r._warmStarted=_._warmStarted,r._disabled=!1}var e=t.numPoints;this._manifold._numPoints=e;for(var h=0,l=e;h<l;){var c=h++,m=this._manifold._points[c],v=t.points[c],b=v.position1;m._pos1X=b.x,m._pos1Y=b.y,m._pos1Z=b.z;var x,p,f,u,y,X,g=v.position2;m._pos2X=g.x,m._pos2Y=g.y,m._pos2Z=g.z,m._relPos1X=m._pos1X-i._positionX,m._relPos1Y=m._pos1Y-i._positionY,m._relPos1Z=m._pos1Z-i._positionZ,m._relPos2X=m._pos2X-a._positionX,m._relPos2Y=m._pos2Y-a._positionY,m._relPos2Z=m._pos2Z-a._positionZ,x=i._rotation00*m._relPos1X+i._rotation10*m._relPos1Y+i._rotation20*m._relPos1Z,p=i._rotation01*m._relPos1X+i._rotation11*m._relPos1Y+i._rotation21*m._relPos1Z,f=i._rotation02*m._relPos1X+i._rotation12*m._relPos1Y+i._rotation22*m._relPos1Z,m._localPos1X=x,m._localPos1Y=p,m._localPos1Z=f,u=a._rotation00*m._relPos2X+a._rotation10*m._relPos2Y+a._rotation20*m._relPos2Z,y=a._rotation01*m._relPos2X+a._rotation11*m._relPos2Y+a._rotation21*m._relPos2Z,X=a._rotation02*m._relPos2X+a._rotation12*m._relPos2Y+a._rotation22*m._relPos2Z,m._localPos2X=u,m._localPos2Y=y,m._localPos2Z=X,m._depth=v.depth;var z=m._impulse;z.impulseN=0,z.impulseT=0,z.impulseB=0,z.impulseP=0,z.impulseLX=0,z.impulseLY=0,z.impulseLZ=0,m._id=v.id,m._warmStarted=!1,m._disabled=!1;for(var d=0,Y=this.numOldPoints;d<Y;){var Z=d++,M=this.oldPoints[Z];if(m._id==M._id){m._impulse.copyFrom(M._impulse),m._warmStarted=!0;break}}}}incrementalUpdate(t,i,a){this._manifold._updateDepthsAndPositions(i,a);for(var s=0,o=this._manifold._numPoints;s<o;){var n=s++;this._manifold._points[n]._warmStarted=!0}var r=t.points[0],_=this.findNearestContactPointIndex(r,i,a);if(-1==_)this.addManifoldPoint(r,i,a);else{var e=this._manifold._points[_],h=r.position1;e._pos1X=h.x,e._pos1Y=h.y,e._pos1Z=h.z;var l,c,m,v,b,x,p=r.position2;e._pos2X=p.x,e._pos2Y=p.y,e._pos2Z=p.z,e._relPos1X=e._pos1X-i._positionX,e._relPos1Y=e._pos1Y-i._positionY,e._relPos1Z=e._pos1Z-i._positionZ,e._relPos2X=e._pos2X-a._positionX,e._relPos2Y=e._pos2Y-a._positionY,e._relPos2Z=e._pos2Z-a._positionZ,l=i._rotation00*e._relPos1X+i._rotation10*e._relPos1Y+i._rotation20*e._relPos1Z,c=i._rotation01*e._relPos1X+i._rotation11*e._relPos1Y+i._rotation21*e._relPos1Z,m=i._rotation02*e._relPos1X+i._rotation12*e._relPos1Y+i._rotation22*e._relPos1Z,e._localPos1X=l,e._localPos1Y=c,e._localPos1Z=m,v=a._rotation00*e._relPos2X+a._rotation10*e._relPos2Y+a._rotation20*e._relPos2Z,b=a._rotation01*e._relPos2X+a._rotation11*e._relPos2Y+a._rotation21*e._relPos2Z,x=a._rotation02*e._relPos2X+a._rotation12*e._relPos2Y+a._rotation22*e._relPos2Z,e._localPos2X=v,e._localPos2Y=b,e._localPos2Z=x,e._depth=r.depth}this.removeOutdatedPoints()}},t.dynamics.constraint.info||(t.dynamics.constraint.info={}),t.dynamics.constraint.info.JacobianRow=class{constructor(){this.lin1X=0,this.lin1Y=0,this.lin1Z=0,this.lin2X=0,this.lin2Y=0,this.lin2Z=0,this.ang1X=0,this.ang1Y=0,this.ang1Z=0,this.ang2X=0,this.ang2Y=0,this.ang2Z=0,this.flag=0}updateSparsity(){this.flag=0,0==this.lin1X&&0==this.lin1Y&&0==this.lin1Z&&0==this.lin2X&&0==this.lin2Y&&0==this.lin2Z||(this.flag|=1),0==this.ang1X&&0==this.ang1Y&&0==this.ang1Z&&0==this.ang2X&&0==this.ang2Y&&0==this.ang2Z||(this.flag|=2)}},t.dynamics.constraint.info.contact||(t.dynamics.constraint.info.contact={}),t.dynamics.constraint.info.contact.ContactSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0;var i=new Array(t.common.Setting.maxManifoldPoints);this.rows=i;for(var a=0,s=this.rows.length;a<s;){var o=a++;this.rows[o]=new t.dynamics.constraint.info.contact.ContactSolverInfoRow}}},t.dynamics.constraint.info.contact.ContactSolverInfoRow=class{constructor(){this.jacobianN=new t.dynamics.constraint.info.JacobianRow,this.jacobianT=new t.dynamics.constraint.info.JacobianRow,this.jacobianB=new t.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.friction=0,this.impulse=null}},t.dynamics.constraint.info.joint||(t.dynamics.constraint.info.joint={}),t.dynamics.constraint.info.joint.JointSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0;var i=new Array(t.common.Setting.maxJacobianRows);this.rows=i;for(var a=0,s=this.rows.length;a<s;){var o=a++;this.rows[o]=new t.dynamics.constraint.info.joint.JointSolverInfoRow}}},t.dynamics.constraint.info.joint.JointSolverInfoRow=class{constructor(){this.jacobian=new t.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.minImpulse=0,this.maxImpulse=0,this.motorSpeed=0,this.motorMaxImpulse=0,this.impulse=null}},t.dynamics.constraint.joint||(t.dynamics.constraint.joint={}),t.dynamics.constraint.joint.BasisTracker=class{constructor(t){this.joint=t,this.xX=0,this.xY=0,this.xZ=0,this.yX=0,this.yY=0,this.yZ=0,this.zX=0,this.zY=0,this.zZ=0}},t.dynamics.constraint.joint.Joint=class{constructor(i,a){switch(this._link1=new t.dynamics.constraint.joint.JointLink(this),this._link2=new t.dynamics.constraint.joint.JointLink(this),this._positionCorrectionAlgorithm=t.common.Setting.defaultJointPositionCorrectionAlgorithm,this._type=a,this._world=null,this._b1=i.rigidBody1,this._b2=i.rigidBody2,this._allowCollision=i.allowCollision,this._breakForce=i.breakForce,this._breakTorque=i.breakTorque,i.solverType){case 0:this._solver=new t.dynamics.constraint.solver.pgs.PgsJointConstraintSolver(this);break;case 1:this._solver=new t.dynamics.constraint.solver.direct.DirectJointConstraintSolver(this)}var s=i.localAnchor1;this._localAnchor1X=s.x,this._localAnchor1Y=s.y,this._localAnchor1Z=s.z;var o=i.localAnchor2;this._localAnchor2X=o.x,this._localAnchor2Y=o.y,this._localAnchor2Z=o.z,this._relativeAnchor1X=0,this._relativeAnchor1Y=0,this._relativeAnchor1Z=0,this._relativeAnchor2X=0,this._relativeAnchor2Y=0,this._relativeAnchor2Z=0,this._anchor1X=0,this._anchor1Y=0,this._anchor1Z=0,this._anchor2X=0,this._anchor2Y=0,this._anchor2Z=0,this._localBasisX1X=0,this._localBasisX1Y=0,this._localBasisX1Z=0,this._localBasisY1X=0,this._localBasisY1Y=0,this._localBasisY1Z=0,this._localBasisZ1X=0,this._localBasisZ1Y=0,this._localBasisZ1Z=0,this._localBasisX2X=0,this._localBasisX2Y=0,this._localBasisX2Z=0,this._localBasisY2X=0,this._localBasisY2Y=0,this._localBasisY2Z=0,this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=0;var n=new Array(t.common.Setting.maxJacobianRows);this._impulses=n;for(var r=0,_=t.common.Setting.maxJacobianRows;r<_;){var e=r++;this._impulses[e]=new t.dynamics.constraint.joint.JointImpulse}}buildLocalBasesFromX(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{var i=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;i>0&&(i=1/Math.sqrt(i)),this._localBasisX2X*=i,this._localBasisX2Y*=i,this._localBasisX2Z*=i}var a,s,o,n,r,_,e,h,l,c,m,v,b,x=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(x<-.999999999){var p,f,u,y,X=this._localBasisX1X,g=this._localBasisX1Y,z=this._localBasisX1Z,d=X*X,Y=g*g,Z=z*z;d<Y?d<Z?(p=0,f=z*(y=1/Math.sqrt(Y+Z)),u=-g*y):(p=g*(y=1/Math.sqrt(d+Y)),f=-X*y,u=0):Y<Z?(p=-z*(y=1/Math.sqrt(Z+d)),f=0,u=X*y):(p=g*(y=1/Math.sqrt(d+Y)),f=-X*y,u=0),a=p,s=f,o=u,n=0}else{var M,I,V;M=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,I=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,V=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var L=Math.sqrt(.5*(1+x));a=M*=x=.5/L,s=I*=x,o=V*=x,n=L}var w=2*a,k=2*s,B=2*o,A=a*w,P=s*k,S=o*B,T=a*k,C=s*B,j=a*B,R=n*w,q=n*k,E=n*B;r=1-P-S,_=T-E,e=j+q,h=T+E,l=1-A-S,c=C-R,m=j-q,v=C+R,b=1-A-P;var D,F,N,W,G,J,O,H,U,Q,K=this._localBasisX1X,$=this._localBasisX1Y,tt=this._localBasisX1Z,it=K*K,at=$*$,st=tt*tt;it<at?it<st?(D=1/Math.sqrt(at+st),this._localBasisY1X=0,this._localBasisY1Y=tt*D,this._localBasisY1Z=-$*D):(D=1/Math.sqrt(it+at),this._localBasisY1X=$*D,this._localBasisY1Y=-K*D,this._localBasisY1Z=0):at<st?(D=1/Math.sqrt(st+it),this._localBasisY1X=-tt*D,this._localBasisY1Y=0,this._localBasisY1Z=K*D):(D=1/Math.sqrt(it+at),this._localBasisY1X=$*D,this._localBasisY1Y=-K*D,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,F=r*this._localBasisX1X+_*this._localBasisX1Y+e*this._localBasisX1Z,N=h*this._localBasisX1X+l*this._localBasisX1Y+c*this._localBasisX1Z,W=m*this._localBasisX1X+v*this._localBasisX1Y+b*this._localBasisX1Z,this._localBasisX2X=F,this._localBasisX2Y=N,this._localBasisX2Z=W,G=r*this._localBasisY1X+_*this._localBasisY1Y+e*this._localBasisY1Z,J=h*this._localBasisY1X+l*this._localBasisY1Y+c*this._localBasisY1Z,O=m*this._localBasisY1X+v*this._localBasisY1Y+b*this._localBasisY1Z,this._localBasisY2X=G,this._localBasisY2Y=J,this._localBasisY2Z=O,H=r*this._localBasisZ1X+_*this._localBasisZ1Y+e*this._localBasisZ1Z,U=h*this._localBasisZ1X+l*this._localBasisZ1Y+c*this._localBasisZ1Z,Q=m*this._localBasisZ1X+v*this._localBasisZ1Y+b*this._localBasisZ1Z,this._localBasisZ2X=H,this._localBasisZ2Y=U,this._localBasisZ2Z=Q}buildLocalBasesFromXY(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{var i=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;i>0&&(i=1/Math.sqrt(i)),this._localBasisX2X*=i,this._localBasisX2Y*=i,this._localBasisX2Z*=i}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){var a,s=this._localBasisX1X,o=this._localBasisX1Y,n=this._localBasisX1Z,r=s*s,_=o*o,e=n*n;r<_?r<e?(a=1/Math.sqrt(_+e),this._localBasisY1X=0,this._localBasisY1Y=n*a,this._localBasisY1Z=-o*a):(a=1/Math.sqrt(r+_),this._localBasisY1X=o*a,this._localBasisY1Y=-s*a,this._localBasisY1Z=0):_<e?(a=1/Math.sqrt(e+r),this._localBasisY1X=-n*a,this._localBasisY1Y=0,this._localBasisY1Z=s*a):(a=1/Math.sqrt(r+_),this._localBasisY1X=o*a,this._localBasisY1Y=-s*a,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{var h=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;h>0&&(h=1/Math.sqrt(h)),this._localBasisZ1X*=h,this._localBasisZ1Y*=h,this._localBasisZ1Z*=h,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0){var l,c=this._localBasisX2X,m=this._localBasisX2Y,v=this._localBasisX2Z,b=c*c,x=m*m,p=v*v;b<x?b<p?(l=1/Math.sqrt(x+p),this._localBasisY2X=0,this._localBasisY2Y=v*l,this._localBasisY2Z=-m*l):(l=1/Math.sqrt(b+x),this._localBasisY2X=m*l,this._localBasisY2Y=-c*l,this._localBasisY2Z=0):x<p?(l=1/Math.sqrt(p+b),this._localBasisY2X=-v*l,this._localBasisY2Y=0,this._localBasisY2Z=c*l):(l=1/Math.sqrt(b+x),this._localBasisY2X=m*l,this._localBasisY2Y=-c*l,this._localBasisY2Z=0),this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X}else{var f=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;f>0&&(f=1/Math.sqrt(f)),this._localBasisZ2X*=f,this._localBasisZ2Y*=f,this._localBasisZ2Z*=f,this._localBasisY2X=this._localBasisZ2Y*this._localBasisX2Z-this._localBasisZ2Z*this._localBasisX2Y,this._localBasisY2Y=this._localBasisZ2Z*this._localBasisX2X-this._localBasisZ2X*this._localBasisX2Z,this._localBasisY2Z=this._localBasisZ2X*this._localBasisX2Y-this._localBasisZ2Y*this._localBasisX2X}}buildLocalBasesFromX1Z2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0)this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=1;else{var i=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;i>0&&(i=1/Math.sqrt(i)),this._localBasisZ2X*=i,this._localBasisZ2Y*=i,this._localBasisZ2Z*=i}var a,s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y,X,g,z,d,Y,Z,M,I,V,L,w,k,B,A,P,S,T=this._b1._transform,C=this._b2._transform;if(a=T._rotation00*this._localBasisX1X+T._rotation01*this._localBasisX1Y+T._rotation02*this._localBasisX1Z,s=T._rotation10*this._localBasisX1X+T._rotation11*this._localBasisX1Y+T._rotation12*this._localBasisX1Z,o=T._rotation20*this._localBasisX1X+T._rotation21*this._localBasisX1Y+T._rotation22*this._localBasisX1Z,f=C._rotation00*this._localBasisZ2X+C._rotation01*this._localBasisZ2Y+C._rotation02*this._localBasisZ2Z,(e=(x=C._rotation10*this._localBasisZ2X+C._rotation11*this._localBasisZ2Y+C._rotation12*this._localBasisZ2Z)*o-(p=C._rotation20*this._localBasisZ2X+C._rotation21*this._localBasisZ2Y+C._rotation22*this._localBasisZ2Z)*s)*e+(h=p*a-(b=f)*o)*h+(l=b*s-x*a)*l==0){var j,R=a,q=s,E=o,D=R*R,F=q*q,N=E*E;D<F?D<N?(e=0,h=E*(j=1/Math.sqrt(F+N)),l=-q*j):(e=q*(j=1/Math.sqrt(D+F)),h=-R*j,l=0):F<N?(e=-E*(j=1/Math.sqrt(N+D)),h=0,l=R*j):(e=q*(j=1/Math.sqrt(D+F)),h=-R*j,l=0)}n=s*l-o*h,r=o*e-a*l,_=a*h-s*e,c=h*p-l*x,m=l*b-e*p,v=e*x-h*b,u=T._rotation00*a+T._rotation10*s+T._rotation20*o,y=T._rotation01*a+T._rotation11*s+T._rotation21*o,X=T._rotation02*a+T._rotation12*s+T._rotation22*o,this._localBasisX1X=u,this._localBasisX1Y=y,this._localBasisX1Z=X,g=T._rotation00*e+T._rotation10*h+T._rotation20*l,z=T._rotation01*e+T._rotation11*h+T._rotation21*l,d=T._rotation02*e+T._rotation12*h+T._rotation22*l,this._localBasisY1X=g,this._localBasisY1Y=z,this._localBasisY1Z=d,Y=T._rotation00*n+T._rotation10*r+T._rotation20*_,Z=T._rotation01*n+T._rotation11*r+T._rotation21*_,M=T._rotation02*n+T._rotation12*r+T._rotation22*_,this._localBasisZ1X=Y,this._localBasisZ1Y=Z,this._localBasisZ1Z=M,I=C._rotation00*c+C._rotation10*m+C._rotation20*v,V=C._rotation01*c+C._rotation11*m+C._rotation21*v,L=C._rotation02*c+C._rotation12*m+C._rotation22*v,this._localBasisX2X=I,this._localBasisX2Y=V,this._localBasisX2Z=L,w=C._rotation00*e+C._rotation10*h+C._rotation20*l,k=C._rotation01*e+C._rotation11*h+C._rotation21*l,B=C._rotation02*e+C._rotation12*h+C._rotation22*l,this._localBasisY2X=w,this._localBasisY2Y=k,this._localBasisY2Z=B,A=C._rotation00*b+C._rotation10*x+C._rotation20*p,P=C._rotation01*b+C._rotation11*x+C._rotation21*p,S=C._rotation02*b+C._rotation12*x+C._rotation22*p,this._localBasisZ2X=A,this._localBasisZ2Y=P,this._localBasisZ2Z=S}buildLocalBasesFromXY1X2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){var i,a=this._localBasisX1X,s=this._localBasisX1Y,o=this._localBasisX1Z,n=a*a,r=s*s,_=o*o;n<r?n<_?(i=1/Math.sqrt(r+_),this._localBasisY1X=0,this._localBasisY1Y=o*i,this._localBasisY1Z=-s*i):(i=1/Math.sqrt(n+r),this._localBasisY1X=s*i,this._localBasisY1Y=-a*i,this._localBasisY1Z=0):r<_?(i=1/Math.sqrt(_+n),this._localBasisY1X=-o*i,this._localBasisY1Y=0,this._localBasisY1Z=a*i):(i=1/Math.sqrt(n+r),this._localBasisY1X=s*i,this._localBasisY1Y=-a*i,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{var e=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;e>0&&(e=1/Math.sqrt(e)),this._localBasisZ1X*=e,this._localBasisZ1Y*=e,this._localBasisZ1Z*=e,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}var h,l,c,m,v,b,x,p,f,u,y,X,g,z=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(z<-.999999999){var d,Y,Z,M,I=this._localBasisX1X,V=this._localBasisX1Y,L=this._localBasisX1Z,w=I*I,k=V*V,B=L*L;w<k?w<B?(d=0,Y=L*(M=1/Math.sqrt(k+B)),Z=-V*M):(d=V*(M=1/Math.sqrt(w+k)),Y=-I*M,Z=0):k<B?(d=-L*(M=1/Math.sqrt(B+w)),Y=0,Z=I*M):(d=V*(M=1/Math.sqrt(w+k)),Y=-I*M,Z=0),h=d,l=Y,c=Z,m=0}else{var A,P,S;A=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,P=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,S=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var T=Math.sqrt(.5*(1+z));h=A*=z=.5/T,l=P*=z,c=S*=z,m=T}var C,j,R,q,E,D,F,N,W,G=2*h,J=2*l,O=2*c,H=h*G,U=l*J,Q=c*O,K=h*J,$=l*O,tt=h*O,it=m*G,at=m*J,st=m*O;b=K-st,x=tt+at,p=K+st,f=1-H-Q,u=$-it,y=tt-at,X=$+it,g=1-H-U,C=(v=1-U-Q)*this._localBasisX1X+b*this._localBasisX1Y+x*this._localBasisX1Z,j=p*this._localBasisX1X+f*this._localBasisX1Y+u*this._localBasisX1Z,R=y*this._localBasisX1X+X*this._localBasisX1Y+g*this._localBasisX1Z,this._localBasisX2X=C,this._localBasisX2Y=j,this._localBasisX2Z=R,q=v*this._localBasisY1X+b*this._localBasisY1Y+x*this._localBasisY1Z,E=p*this._localBasisY1X+f*this._localBasisY1Y+u*this._localBasisY1Z,D=y*this._localBasisY1X+X*this._localBasisY1Y+g*this._localBasisY1Z,this._localBasisY2X=q,this._localBasisY2Y=E,this._localBasisY2Z=D,F=v*this._localBasisZ1X+b*this._localBasisZ1Y+x*this._localBasisZ1Z,N=p*this._localBasisZ1X+f*this._localBasisZ1Y+u*this._localBasisZ1Z,W=y*this._localBasisZ1X+X*this._localBasisZ1Y+g*this._localBasisZ1Z,this._localBasisZ2X=F,this._localBasisZ2Y=N,this._localBasisZ2Z=W}setSolverInfoRowLinear(i,a,s,o,n,r,_){var e,h,l=t.common.Setting.linearSlop;if(_)e=0,h=1;else{if(n.frequency>0){l=0;var c=6.28318530717958*n.frequency,m=n.dampingRatio;m<t.common.Setting.minSpringDamperDampingRatio&&(m=t.common.Setting.minSpringDamperDampingRatio);var v=r.dt,b=2*m*c,x=c*c;n.useSymplecticEuler?(e=1/(v*b),h=x/b):(e=1/(v*(v*x+b)),h=x/(v*x+b))}else e=0,h=this.getErp(r,!1);s.motorForce>0?(i.motorSpeed=s.motorSpeed,i.motorMaxImpulse=s.motorForce*r.dt):(i.motorSpeed=0,i.motorMaxImpulse=0)}var p,f,u,y=s.lowerLimit,X=s.upperLimit;y>X?(p=0,f=0,u=0):y==X?(p=-1/0,f=1/0,u=a-y):a<y?(p=-1/0,f=0,(u=a-y+l)>0&&(u=0)):a>X?(p=0,f=1/0,(u=a-X-l)<0&&(u=0)):(p=0,f=0,u=0);var g=0==o?0:1/o;i.minImpulse=p,i.maxImpulse=f,i.cfm=e*g,i.rhs=u*h}setSolverInfoRowAngular(i,a,s,o,n,r,_){var e,h,l=t.common.Setting.angularSlop;if(_)e=0,h=1;else{if(n.frequency>0){l=0;var c=6.28318530717958*n.frequency,m=n.dampingRatio;m<t.common.Setting.minSpringDamperDampingRatio&&(m=t.common.Setting.minSpringDamperDampingRatio);var v=r.dt,b=2*m*c,x=c*c;n.useSymplecticEuler?(e=1/(v*b),h=x/b):(e=1/(v*(v*x+b)),h=x/(v*x+b))}else e=0,h=this.getErp(r,!1);s.motorTorque>0?(i.motorSpeed=s.motorSpeed,i.motorMaxImpulse=s.motorTorque*r.dt):(i.motorSpeed=0,i.motorMaxImpulse=0)}var p,f,u,y=s.lowerLimit,X=s.upperLimit,g=.5*(y+X);a=(((a-=g)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,a+=g,y>X?(p=0,f=0,u=0):y==X?(p=-1/0,f=1/0,u=a-y):a<y?(p=-1/0,f=0,(u=a-y+l)>0&&(u=0)):a>X?(p=0,f=1/0,(u=a-X-l)<0&&(u=0)):(p=0,f=0,u=0);var z=0==o?0:1/o;i.minImpulse=p,i.maxImpulse=f,i.cfm=e*z,i.rhs=u*h}getErp(i,a){return a?1:this._positionCorrectionAlgorithm==t.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?i.invDt*t.common.Setting.velocityBaumgarte:0}computeEffectiveInertiaMoment(t,i,a){var s=(this._b1._invInertia00*t+this._b1._invInertia01*i+this._b1._invInertia02*a)*t+(this._b1._invInertia10*t+this._b1._invInertia11*i+this._b1._invInertia12*a)*i+(this._b1._invInertia20*t+this._b1._invInertia21*i+this._b1._invInertia22*a)*a,o=(this._b2._invInertia00*t+this._b2._invInertia01*i+this._b2._invInertia02*a)*t+(this._b2._invInertia10*t+this._b2._invInertia11*i+this._b2._invInertia12*a)*i+(this._b2._invInertia20*t+this._b2._invInertia21*i+this._b2._invInertia22*a)*a;if(s>0){var n=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,r=t*this._relativeAnchor1X+i*this._relativeAnchor1Y+a*this._relativeAnchor1Z,_=n-r*r;_>0&&(s=this._b1._invMass>0?1/(1/s+this._b1._mass*_):0)}if(o>0){var e=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,h=t*this._relativeAnchor2X+i*this._relativeAnchor2Y+a*this._relativeAnchor2Z,l=e-h*h;l>0&&(o=this._b2._invMass>0?1/(1/o+this._b2._mass*l):0)}return s+o==0?0:1/(s+o)}computeEffectiveInertiaMoment2(t,i,a,s,o,n){var r=(this._b1._invInertia00*t+this._b1._invInertia01*i+this._b1._invInertia02*a)*t+(this._b1._invInertia10*t+this._b1._invInertia11*i+this._b1._invInertia12*a)*i+(this._b1._invInertia20*t+this._b1._invInertia21*i+this._b1._invInertia22*a)*a,_=(this._b2._invInertia00*s+this._b2._invInertia01*o+this._b2._invInertia02*n)*s+(this._b2._invInertia10*s+this._b2._invInertia11*o+this._b2._invInertia12*n)*o+(this._b2._invInertia20*s+this._b2._invInertia21*o+this._b2._invInertia22*n)*n;if(r>0){var e=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,h=t*this._relativeAnchor1X+i*this._relativeAnchor1Y+a*this._relativeAnchor1Z,l=e*e-h*h;l>0&&(r=this._b1._invMass>0?1/(1/r+this._b1._mass*l):0)}if(_>0){var c=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,m=s*this._relativeAnchor2X+o*this._relativeAnchor2Y+n*this._relativeAnchor2Z,v=c*c-m*m;v>0&&(_=this._b2._invMass>0?1/(1/_+this._b2._mass*v):0)}return r+_==0?0:1/(r+_)}_syncAnchors(){var t,i,a,s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y,X,g,z,d,Y=this._b1._transform,Z=this._b2._transform;t=Y._rotation00*this._localAnchor1X+Y._rotation01*this._localAnchor1Y+Y._rotation02*this._localAnchor1Z,i=Y._rotation10*this._localAnchor1X+Y._rotation11*this._localAnchor1Y+Y._rotation12*this._localAnchor1Z,a=Y._rotation20*this._localAnchor1X+Y._rotation21*this._localAnchor1Y+Y._rotation22*this._localAnchor1Z,this._relativeAnchor1X=t,this._relativeAnchor1Y=i,this._relativeAnchor1Z=a,s=Z._rotation00*this._localAnchor2X+Z._rotation01*this._localAnchor2Y+Z._rotation02*this._localAnchor2Z,o=Z._rotation10*this._localAnchor2X+Z._rotation11*this._localAnchor2Y+Z._rotation12*this._localAnchor2Z,n=Z._rotation20*this._localAnchor2X+Z._rotation21*this._localAnchor2Y+Z._rotation22*this._localAnchor2Z,this._relativeAnchor2X=s,this._relativeAnchor2Y=o,this._relativeAnchor2Z=n,this._anchor1X=this._relativeAnchor1X+Y._positionX,this._anchor1Y=this._relativeAnchor1Y+Y._positionY,this._anchor1Z=this._relativeAnchor1Z+Y._positionZ,this._anchor2X=this._relativeAnchor2X+Z._positionX,this._anchor2Y=this._relativeAnchor2Y+Z._positionY,this._anchor2Z=this._relativeAnchor2Z+Z._positionZ,r=Y._rotation00*this._localBasisX1X+Y._rotation01*this._localBasisX1Y+Y._rotation02*this._localBasisX1Z,_=Y._rotation10*this._localBasisX1X+Y._rotation11*this._localBasisX1Y+Y._rotation12*this._localBasisX1Z,e=Y._rotation20*this._localBasisX1X+Y._rotation21*this._localBasisX1Y+Y._rotation22*this._localBasisX1Z,this._basisX1X=r,this._basisX1Y=_,this._basisX1Z=e,h=Y._rotation00*this._localBasisY1X+Y._rotation01*this._localBasisY1Y+Y._rotation02*this._localBasisY1Z,l=Y._rotation10*this._localBasisY1X+Y._rotation11*this._localBasisY1Y+Y._rotation12*this._localBasisY1Z,c=Y._rotation20*this._localBasisY1X+Y._rotation21*this._localBasisY1Y+Y._rotation22*this._localBasisY1Z,this._basisY1X=h,this._basisY1Y=l,this._basisY1Z=c,m=Y._rotation00*this._localBasisZ1X+Y._rotation01*this._localBasisZ1Y+Y._rotation02*this._localBasisZ1Z,v=Y._rotation10*this._localBasisZ1X+Y._rotation11*this._localBasisZ1Y+Y._rotation12*this._localBasisZ1Z,b=Y._rotation20*this._localBasisZ1X+Y._rotation21*this._localBasisZ1Y+Y._rotation22*this._localBasisZ1Z,this._basisZ1X=m,this._basisZ1Y=v,this._basisZ1Z=b,x=Z._rotation00*this._localBasisX2X+Z._rotation01*this._localBasisX2Y+Z._rotation02*this._localBasisX2Z,p=Z._rotation10*this._localBasisX2X+Z._rotation11*this._localBasisX2Y+Z._rotation12*this._localBasisX2Z,f=Z._rotation20*this._localBasisX2X+Z._rotation21*this._localBasisX2Y+Z._rotation22*this._localBasisX2Z,this._basisX2X=x,this._basisX2Y=p,this._basisX2Z=f,u=Z._rotation00*this._localBasisY2X+Z._rotation01*this._localBasisY2Y+Z._rotation02*this._localBasisY2Z,y=Z._rotation10*this._localBasisY2X+Z._rotation11*this._localBasisY2Y+Z._rotation12*this._localBasisY2Z,X=Z._rotation20*this._localBasisY2X+Z._rotation21*this._localBasisY2Y+Z._rotation22*this._localBasisY2Z,this._basisY2X=u,this._basisY2Y=y,this._basisY2Z=X,g=Z._rotation00*this._localBasisZ2X+Z._rotation01*this._localBasisZ2Y+Z._rotation02*this._localBasisZ2Z,z=Z._rotation10*this._localBasisZ2X+Z._rotation11*this._localBasisZ2Y+Z._rotation12*this._localBasisZ2Z,d=Z._rotation20*this._localBasisZ2X+Z._rotation21*this._localBasisZ2Y+Z._rotation22*this._localBasisZ2Z,this._basisZ2X=g,this._basisZ2Y=z,this._basisZ2Z=d}_getVelocitySolverInfo(t,i){i.b1=this._b1,i.b2=this._b2,i.numRows=0}_getPositionSolverInfo(t){t.b1=this._b1,t.b2=this._b2,t.numRows=0}_checkDestruction(){var t=this._appliedForceX*this._appliedForceX+this._appliedForceY*this._appliedForceY+this._appliedForceZ*this._appliedForceZ,i=this._appliedTorqueX*this._appliedTorqueX+this._appliedTorqueY*this._appliedTorqueY+this._appliedTorqueZ*this._appliedTorqueZ;(this._breakForce>0&&t>this._breakForce*this._breakForce||this._breakTorque>0&&i>this._breakTorque*this._breakTorque)&&this._world.removeJoint(this)}getRigidBody1(){return this._b1}getRigidBody2(){return this._b2}getType(){return this._type}getAnchor1(){var i=new t.common.Vec3,a=i;return a.x=this._anchor1X,a.y=this._anchor1Y,a.z=this._anchor1Z,i}getAnchor2(){var i=new t.common.Vec3,a=i;return a.x=this._anchor2X,a.y=this._anchor2Y,a.z=this._anchor2Z,i}getAnchor1To(t){var i=t;i.x=this._anchor1X,i.y=this._anchor1Y,i.z=this._anchor1Z}getAnchor2To(t){var i=t;i.x=this._anchor2X,i.y=this._anchor2Y,i.z=this._anchor2Z}getLocalAnchor1(){var i=new t.common.Vec3,a=i;return a.x=this._localAnchor1X,a.y=this._localAnchor1Y,a.z=this._localAnchor1Z,i}getLocalAnchor2(){var i=new t.common.Vec3,a=i;return a.x=this._localAnchor2X,a.y=this._localAnchor2Y,a.z=this._localAnchor2Z,i}getLocalAnchor1To(t){var i=t;i.x=this._localAnchor1X,i.y=this._localAnchor1Y,i.z=this._localAnchor1Z}getLocalAnchor2To(t){var i=t;i.x=this._localAnchor2X,i.y=this._localAnchor2Y,i.z=this._localAnchor2Z}getBasis1(){var i,a,s,o,n,r,_,e,h,l=new t.common.Mat3;i=this._basisX1X,a=this._basisY1X,s=this._basisZ1X,o=this._basisX1Y,n=this._basisY1Y,r=this._basisZ1Y,_=this._basisX1Z,e=this._basisY1Z,h=this._basisZ1Z;var c=l;return c.e00=i,c.e01=a,c.e02=s,c.e10=o,c.e11=n,c.e12=r,c.e20=_,c.e21=e,c.e22=h,l}getBasis2(){var i,a,s,o,n,r,_,e,h,l=new t.common.Mat3;i=this._basisX2X,a=this._basisY2X,s=this._basisZ2X,o=this._basisX2Y,n=this._basisY2Y,r=this._basisZ2Y,_=this._basisX2Z,e=this._basisY2Z,h=this._basisZ2Z;var c=l;return c.e00=i,c.e01=a,c.e02=s,c.e10=o,c.e11=n,c.e12=r,c.e20=_,c.e21=e,c.e22=h,l}getBasis1To(t){var i,a,s,o,n,r,_,e,h;i=this._basisX1X,a=this._basisY1X,s=this._basisZ1X,o=this._basisX1Y,n=this._basisY1Y,r=this._basisZ1Y,_=this._basisX1Z,e=this._basisY1Z,h=this._basisZ1Z;var l=t;l.e00=i,l.e01=a,l.e02=s,l.e10=o,l.e11=n,l.e12=r,l.e20=_,l.e21=e,l.e22=h}getBasis2To(t){var i,a,s,o,n,r,_,e,h;i=this._basisX2X,a=this._basisY2X,s=this._basisZ2X,o=this._basisX2Y,n=this._basisY2Y,r=this._basisZ2Y,_=this._basisX2Z,e=this._basisY2Z,h=this._basisZ2Z;var l=t;l.e00=i,l.e01=a,l.e02=s,l.e10=o,l.e11=n,l.e12=r,l.e20=_,l.e21=e,l.e22=h}getAllowCollision(){return this._allowCollision}setAllowCollision(t){this._allowCollision=t}getBreakForce(){return this._breakForce}setBreakForce(t){this._breakForce=t}getBreakTorque(){return this._breakTorque}setBreakTorque(t){this._breakTorque=t}getPositionCorrectionAlgorithm(){return this._positionCorrectionAlgorithm}setPositionCorrectionAlgorithm(t){switch(t){case 0:case 1:case 2:break;default:throw new Error("invalid position correction algorithm id: "+t)}this._positionCorrectionAlgorithm=t}getAppliedForce(){var i=new t.common.Vec3,a=i;return a.x=this._appliedForceX,a.y=this._appliedForceY,a.z=this._appliedForceZ,i}getAppliedForceTo(t){var i=t;i.x=this._appliedForceX,i.y=this._appliedForceY,i.z=this._appliedForceZ}getAppliedTorque(){var i=new t.common.Vec3,a=i;return a.x=this._appliedTorqueX,a.y=this._appliedTorqueY,a.z=this._appliedTorqueZ,i}getAppliedTorqueTo(t){var i=t;i.x=this._appliedTorqueX,i.y=this._appliedTorqueY,i.z=this._appliedTorqueZ}getPrev(){return this._prev}getNext(){return this._next}},t.dynamics.constraint.joint.CylindricalJoint=class extends t.dynamics.constraint.joint.Joint{constructor(i){super(i,2);var a=i.localAxis1;this._localBasisX1X=a.x,this._localBasisX1Y=a.y,this._localBasisX1Z=a.z;var s=i.localAxis2;this._localBasisX2X=s.x,this._localBasisX2Y=s.y,this._localBasisX2Z=s.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this._basis=new t.dynamics.constraint.joint.BasisTracker(this),this._translSd=i.translationalSpringDamper.clone(),this._translLm=i.translationalLimitMotor.clone(),this._rotSd=i.rotationalSpringDamper.clone(),this._rotLm=i.rotationalLimitMotor.clone()}getInfo(t,i,a){var s,o,n=this.getErp(i,a),r=this.linearErrorY*n,_=this.linearErrorZ*n,e=this.angularErrorY*n,h=this.angularErrorZ*n,l=1/(this._b1._invMass+this._b2._invMass),c=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ);if(this._translSd.frequency<=0||!a){var m=this._impulses[0],v=t.rows[t.numRows++],b=v.jacobian;b.lin1X=0,b.lin1Y=0,b.lin1Z=0,b.lin2X=0,b.lin2Y=0,b.lin2Z=0,b.ang1X=0,b.ang1Y=0,b.ang1Z=0,b.ang2X=0,b.ang2Y=0,b.ang2Z=0,v.rhs=0,v.cfm=0,v.minImpulse=0,v.maxImpulse=0,v.motorSpeed=0,v.motorMaxImpulse=0,v.impulse=null,v.impulse=m,s=v,this.setSolverInfoRowLinear(s,this.translation,this._translLm,l,this._translSd,i,a),(o=s.jacobian).lin1X=this._basis.xX,o.lin1Y=this._basis.xY,o.lin1Z=this._basis.xZ,o.lin2X=this._basis.xX,o.lin2Y=this._basis.xY,o.lin2Z=this._basis.xZ,o.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,o.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,o.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,o.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,o.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,o.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}var x=this._impulses[1],p=t.rows[t.numRows++],f=p.jacobian;f.lin1X=0,f.lin1Y=0,f.lin1Z=0,f.lin2X=0,f.lin2Y=0,f.lin2Z=0,f.ang1X=0,f.ang1Y=0,f.ang1Z=0,f.ang2X=0,f.ang2Y=0,f.ang2Z=0,p.rhs=0,p.cfm=0,p.minImpulse=0,p.maxImpulse=0,p.motorSpeed=0,p.motorMaxImpulse=0,p.impulse=null,p.impulse=x,(s=p).rhs=r,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=1/0,(o=s.jacobian).lin1X=this._basis.yX,o.lin1Y=this._basis.yY,o.lin1Z=this._basis.yZ,o.lin2X=this._basis.yX,o.lin2Y=this._basis.yY,o.lin2Z=this._basis.yZ,o.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,o.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,o.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,o.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,o.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,o.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;var u=this._impulses[2],y=t.rows[t.numRows++],X=y.jacobian;if(X.lin1X=0,X.lin1Y=0,X.lin1Z=0,X.lin2X=0,X.lin2Y=0,X.lin2Z=0,X.ang1X=0,X.ang1Y=0,X.ang1Z=0,X.ang2X=0,X.ang2Y=0,X.ang2Z=0,y.rhs=0,y.cfm=0,y.minImpulse=0,y.maxImpulse=0,y.motorSpeed=0,y.motorMaxImpulse=0,y.impulse=null,y.impulse=u,(s=y).rhs=_,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=1/0,(o=s.jacobian).lin1X=this._basis.zX,o.lin1Y=this._basis.zY,o.lin1Z=this._basis.zZ,o.lin2X=this._basis.zX,o.lin2Y=this._basis.zY,o.lin2Z=this._basis.zZ,o.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,o.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,o.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,o.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,o.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,o.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX,this._rotSd.frequency<=0||!a){var g=this._impulses[3],z=t.rows[t.numRows++],d=z.jacobian;d.lin1X=0,d.lin1Y=0,d.lin1Z=0,d.lin2X=0,d.lin2Y=0,d.lin2Z=0,d.ang1X=0,d.ang1Y=0,d.ang1Z=0,d.ang2X=0,d.ang2Y=0,d.ang2Z=0,z.rhs=0,z.cfm=0,z.minImpulse=0,z.maxImpulse=0,z.motorSpeed=0,z.motorMaxImpulse=0,z.impulse=null,z.impulse=g,s=z,this.setSolverInfoRowAngular(s,this.angle,this._rotLm,c,this._rotSd,i,a),(o=s.jacobian).ang1X=this._basis.xX,o.ang1Y=this._basis.xY,o.ang1Z=this._basis.xZ,o.ang2X=this._basis.xX,o.ang2Y=this._basis.xY,o.ang2Z=this._basis.xZ}var Y=this._impulses[4],Z=t.rows[t.numRows++],M=Z.jacobian;M.lin1X=0,M.lin1Y=0,M.lin1Z=0,M.lin2X=0,M.lin2Y=0,M.lin2Z=0,M.ang1X=0,M.ang1Y=0,M.ang1Z=0,M.ang2X=0,M.ang2Y=0,M.ang2Z=0,Z.rhs=0,Z.cfm=0,Z.minImpulse=0,Z.maxImpulse=0,Z.motorSpeed=0,Z.motorMaxImpulse=0,Z.impulse=null,Z.impulse=Y,(s=Z).rhs=e,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=1/0,(o=s.jacobian).ang1X=this._basis.yX,o.ang1Y=this._basis.yY,o.ang1Z=this._basis.yZ,o.ang2X=this._basis.yX,o.ang2Y=this._basis.yY,o.ang2Z=this._basis.yZ;var I=this._impulses[5],V=t.rows[t.numRows++],L=V.jacobian;L.lin1X=0,L.lin1Y=0,L.lin1Z=0,L.lin2X=0,L.lin2Y=0,L.lin2Z=0,L.ang1X=0,L.ang1Y=0,L.ang1Z=0,L.ang2X=0,L.ang2Y=0,L.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=I,(s=V).rhs=h,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=1/0,(o=s.jacobian).ang1X=this._basis.zX,o.ang1Y=this._basis.zY,o.ang1Z=this._basis.zZ,o.ang2X=this._basis.zX,o.ang2Y=this._basis.zY,o.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();var t,i,a,s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y,X,g,z,d,Y,Z,M,I,V,L,w,k,B,A,P,S,T,C,j,R=this._basis,q=R.joint._b1._invMass,E=R.joint._b2._invMass,D=R.joint._basisX1X*R.joint._basisX2X+R.joint._basisX1Y*R.joint._basisX2Y+R.joint._basisX1Z*R.joint._basisX2Z;if(D<-.999999999){var F,N,W,G,J=R.joint._basisX1X,O=R.joint._basisX1Y,H=R.joint._basisX1Z,U=J*J,Q=O*O,K=H*H;U<Q?U<K?(F=0,N=H*(G=1/Math.sqrt(Q+K)),W=-O*G):(F=O*(G=1/Math.sqrt(U+Q)),N=-J*G,W=0):Q<K?(F=-H*(G=1/Math.sqrt(K+U)),N=0,W=J*G):(F=O*(G=1/Math.sqrt(U+Q)),N=-J*G,W=0),t=F,i=N,a=W,s=0}else{var $,tt,it;$=R.joint._basisX1Y*R.joint._basisX2Z-R.joint._basisX1Z*R.joint._basisX2Y,tt=R.joint._basisX1Z*R.joint._basisX2X-R.joint._basisX1X*R.joint._basisX2Z,it=R.joint._basisX1X*R.joint._basisX2Y-R.joint._basisX1Y*R.joint._basisX2X;var at=Math.sqrt(.5*(1+D));t=$*=D=.5/at,i=tt*=D,a=it*=D,s=at}var st=(k=0)*(S=t)+(B=0)*(T=i)+(A=0)*(C=a)+(P=1)*(j=s);if(st<0&&(st=-st,S=-S,T=-T,C=-C,j=-j),st>.999999){var ot=(S=k+(S-k)*(q/(q+E)))*S+(T=B+(T-B)*(q/(q+E)))*T+(C=A+(C-A)*(q/(q+E)))*C+(j=P+(j-P)*(q/(q+E)))*j;ot>1e-32&&(ot=1/Math.sqrt(ot)),o=S*ot,n=T*ot,r=C*ot,_=j*ot}else{var nt=q/(q+E)*Math.acos(st),rt=(S+=k*-st)*S+(T+=B*-st)*T+(C+=A*-st)*C+(j+=P*-st)*j;rt>1e-32&&(rt=1/Math.sqrt(rt)),S*=rt,T*=rt,C*=rt,j*=rt;var _t=Math.sin(nt),et=Math.cos(nt);o=(k*=et)+S*_t,n=(B*=et)+T*_t,r=(A*=et)+C*_t,_=(P*=et)+j*_t}var ht=2*o,lt=2*n,ct=2*r,mt=o*ht,vt=n*lt,bt=r*ct,xt=o*lt,pt=n*ct,ft=o*ct,ut=_*ht,yt=_*lt,Xt=_*ct;e=xt-Xt,h=ft+yt,l=xt+Xt,c=1-mt-bt,m=pt-ut,v=ft-yt,b=pt+ut,x=1-mt-vt,p=(1-vt-bt)*R.joint._basisX1X+e*R.joint._basisX1Y+h*R.joint._basisX1Z,f=l*R.joint._basisX1X+c*R.joint._basisX1Y+m*R.joint._basisX1Z,u=v*R.joint._basisX1X+b*R.joint._basisX1Y+x*R.joint._basisX1Z,Z=R.xX,M=R.xY,I=R.xZ,V=R.yX,L=R.yY,w=R.yZ;var gt=Z*p+M*f+I*u;if(gt<-.999999999){var zt,dt,Yt,Zt,Mt=Z,It=M,Vt=I,Lt=Mt*Mt,wt=It*It,kt=Vt*Vt;Lt<wt?Lt<kt?(zt=0,dt=Vt*(Zt=1/Math.sqrt(wt+kt)),Yt=-It*Zt):(zt=It*(Zt=1/Math.sqrt(Lt+wt)),dt=-Mt*Zt,Yt=0):wt<kt?(zt=-Vt*(Zt=1/Math.sqrt(kt+Lt)),dt=0,Yt=Mt*Zt):(zt=It*(Zt=1/Math.sqrt(Lt+wt)),dt=-Mt*Zt,Yt=0),o=zt,n=dt,r=Yt,_=0}else{var Bt,At,Pt;Bt=M*u-I*f,At=I*p-Z*u,Pt=Z*f-M*p;var St=Math.sqrt(.5*(1+gt));o=Bt*=gt=.5/St,n=At*=gt,r=Pt*=gt,_=St}var Tt,Ct,jt,Rt=2*o,qt=2*n,Et=2*r,Dt=o*Rt,Ft=n*qt,Nt=r*Et,Wt=o*qt,Gt=n*Et,Jt=o*Et,Ot=_*Rt,Ht=_*qt,Ut=_*Et;if((z=f*(g=(v=Jt-Ht)*V+(b=Gt+Ot)*L+(x=1-Dt-Ft)*w)-u*(X=(l=Wt+Ut)*V+(c=1-Dt-Nt)*L+(m=Gt-Ot)*w))*z+(d=u*(y=(1-Ft-Nt)*V+(e=Wt-Ut)*L+(h=Jt+Ht)*w)-p*g)*d+(Y=p*X-f*y)*Y>1e-6){var Qt=z*z+d*d+Y*Y;Qt>0&&(Qt=1/Math.sqrt(Qt)),z*=Qt,d*=Qt,Y*=Qt}else{var Kt,$t=p,ti=f,ii=u,ai=$t*$t,si=ti*ti,oi=ii*ii;ai<si?ai<oi?(z=0,d=ii*(Kt=1/Math.sqrt(si+oi)),Y=-ti*Kt):(z=ti*(Kt=1/Math.sqrt(ai+si)),d=-$t*Kt,Y=0):si<oi?(z=-ii*(Kt=1/Math.sqrt(oi+ai)),d=0,Y=$t*Kt):(z=ti*(Kt=1/Math.sqrt(ai+si)),d=-$t*Kt,Y=0)}y=d*u-Y*f,X=Y*p-z*u,g=z*f-d*p,R.xX=p,R.xY=f,R.xZ=u,R.yX=y,R.yY=X,R.yZ=g,R.zX=z,R.zY=d,R.zZ=Y,Tt=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,Ct=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,jt=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;var ni,ri,_i,ei,hi,li,ci=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,mi=ci<=-1?3.14159265358979:ci>=1?0:Math.acos(ci),vi=Tt*Tt+Ct*Ct+jt*jt;vi>0&&(vi=1/Math.sqrt(vi)),Tt*=vi,Ct*=vi,jt*=vi,Tt*=mi,Ct*=mi,jt*=mi,this.angularErrorY=Tt*this._basis.yX+Ct*this._basis.yY+jt*this._basis.yZ,this.angularErrorZ=Tt*this._basis.zX+Ct*this._basis.zY+jt*this._basis.zZ,ni=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,ri=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,_i=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,ci=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=ci<=-1?3.14159265358979:ci>=1?0:Math.acos(ci),ni*this._basis.xX+ri*this._basis.xY+_i*this._basis.xZ<0&&(this.angle=-this.angle),ei=this._anchor2X-this._anchor1X,hi=this._anchor2Y-this._anchor1Y,li=this._anchor2Z-this._anchor1Z,this.translation=ei*this._basis.xX+hi*this._basis.xY+li*this._basis.xZ,this.linearErrorY=ei*this._basis.yX+hi*this._basis.yY+li*this._basis.yZ,this.linearErrorZ=ei*this._basis.zX+hi*this._basis.zY+li*this._basis.zZ}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){var i=new t.common.Vec3,a=i;return a.x=this._basisX1X,a.y=this._basisX1Y,a.z=this._basisX1Z,i}getAxis2(){var i=new t.common.Vec3,a=i;return a.x=this._basisX2X,a.y=this._basisX2Y,a.z=this._basisX2Z,i}getAxis1To(t){var i=t;i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z}getAxis2To(t){var i=t;i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z}getLocalAxis1(){var i=new t.common.Vec3,a=i;return a.x=this._localBasisX1X,a.y=this._localBasisX1Y,a.z=this._localBasisX1Z,i}getLocalAxis2(){var i=new t.common.Vec3,a=i;return a.x=this._localBasisX2X,a.y=this._localBasisX2Y,a.z=this._localBasisX2Z,i}getLocalAxis1To(t){var i=t;i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z}getLocalAxis2To(t){var i=t;i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z}getTranslationalSpringDamper(){return this._translSd}getRotationalSpringDamper(){return this._rotSd}getTranslationalLimitMotor(){return this._translLm}getRotationalLimitMotor(){return this._rotLm}getAngle(){return this.angle}getTranslation(){return this.translation}},t.dynamics.constraint.joint.JointConfig=class{constructor(){this.rigidBody1=null,this.rigidBody2=null,this.localAnchor1=new t.common.Vec3,this.localAnchor2=new t.common.Vec3,this.allowCollision=!1,this.solverType=t.common.Setting.defaultJointConstraintSolverType,this.positionCorrectionAlgorithm=t.common.Setting.defaultJointPositionCorrectionAlgorithm,this.breakForce=0,this.breakTorque=0}_init(t,i,a){this.rigidBody1=t,this.rigidBody2=i;var s,o,n,r,_,e,h=this.rigidBody1,l=a;s=l.x,o=l.y,n=l.z,s-=h._transform._positionX,o-=h._transform._positionY,n-=h._transform._positionZ,r=h._transform._rotation00*s+h._transform._rotation10*o+h._transform._rotation20*n,_=h._transform._rotation01*s+h._transform._rotation11*o+h._transform._rotation21*n,e=h._transform._rotation02*s+h._transform._rotation12*o+h._transform._rotation22*n,s=r,o=_,n=e;var c=this.localAnchor1;c.x=s,c.y=o,c.z=n;var m,v,b,x,p,f,u=this.rigidBody2,y=a;m=y.x,v=y.y,b=y.z,m-=u._transform._positionX,v-=u._transform._positionY,b-=u._transform._positionZ,x=u._transform._rotation00*m+u._transform._rotation10*v+u._transform._rotation20*b,p=u._transform._rotation01*m+u._transform._rotation11*v+u._transform._rotation21*b,f=u._transform._rotation02*m+u._transform._rotation12*v+u._transform._rotation22*b,m=x,v=p,b=f;var X=this.localAnchor2;X.x=m,X.y=v,X.z=b}},t.dynamics.constraint.joint.CylindricalJointConfig=class extends t.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new t.common.Vec3(1,0,0),this.localAxis2=new t.common.Vec3(1,0,0),this.translationalLimitMotor=new t.dynamics.constraint.joint.TranslationalLimitMotor,this.translationalSpringDamper=new t.dynamics.constraint.joint.SpringDamper,this.rotationalLimitMotor=new t.dynamics.constraint.joint.RotationalLimitMotor,this.rotationalSpringDamper=new t.dynamics.constraint.joint.SpringDamper}init(t,i,a,s){var o,n,r;this._init(t,i,a);var _,e,h,l=s;o=l.x,n=l.y,r=l.z,_=t._transform._rotation00*o+t._transform._rotation10*n+t._transform._rotation20*r,e=t._transform._rotation01*o+t._transform._rotation11*n+t._transform._rotation21*r,h=t._transform._rotation02*o+t._transform._rotation12*n+t._transform._rotation22*r,o=_,n=e,r=h;var c,m,v,b=this.localAxis1;b.x=o,b.y=n,b.z=r;var x,p,f,u=s;c=u.x,m=u.y,v=u.z,x=i._transform._rotation00*c+i._transform._rotation10*m+i._transform._rotation20*v,p=i._transform._rotation01*c+i._transform._rotation11*m+i._transform._rotation21*v,f=i._transform._rotation02*c+i._transform._rotation12*m+i._transform._rotation22*v,c=x,m=p,v=f;var y=this.localAxis2;return y.x=c,y.y=m,y.z=v,this}},t.dynamics.constraint.joint.GenericJoint=class extends t.dynamics.constraint.joint.Joint{constructor(i){var a;super(i,t.dynamics.constraint.joint.JointType.GENERIC);var s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y,X,g=i.localBasis1;if(g.e00*(g.e11*g.e22-g.e12*g.e21)-g.e01*(g.e10*g.e22-g.e12*g.e20)+g.e02*(g.e10*g.e21-g.e11*g.e20)<0)a=!0;else{var z=i.localBasis2;a=z.e00*(z.e11*z.e22-z.e12*z.e21)-z.e01*(z.e10*z.e22-z.e12*z.e20)+z.e02*(z.e10*z.e21-z.e11*z.e20)<0}a&&console.log("src/oimo/dynamics/constraint/joint/GenericJoint.hx:50:","[warning] joint basis must be right handed");var d=i.localBasis1;s=d.e00,o=d.e01,n=d.e02,r=d.e10,_=d.e11,e=d.e12,h=d.e20,l=d.e21,c=d.e22;var Y=i.localBasis2;m=Y.e00,v=Y.e01,b=Y.e02,x=Y.e10,p=Y.e11,f=Y.e12,u=Y.e20,y=Y.e21,X=Y.e22,this._localBasisX1X=s,this._localBasisX1Y=r,this._localBasisX1Z=h,this._localBasisY1X=o,this._localBasisY1Y=_,this._localBasisY1Z=l,this._localBasisZ1X=n,this._localBasisZ1Y=e,this._localBasisZ1Z=c,this._localBasisX2X=m,this._localBasisX2Y=x,this._localBasisX2Z=u,this._localBasisY2X=v,this._localBasisY2Y=p,this._localBasisY2Z=y,this._localBasisZ2X=b,this._localBasisZ2Y=f,this._localBasisZ2Z=X,this._angleX=0,this._angleY=0,this._angleZ=0,this.translationX=0,this.translationY=0,this.translationZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1;var Z=new Array(3);this._translLms=Z;var M=new Array(3);this._translSds=M;var I=new Array(3);this._rotLms=I;var V=new Array(3);this._rotSds=V,this._translLms[0]=i.translationalLimitMotors[0].clone(),this._translLms[1]=i.translationalLimitMotors[1].clone(),this._translLms[2]=i.translationalLimitMotors[2].clone(),this._translSds[0]=i.translationalSpringDampers[0].clone(),this._translSds[1]=i.translationalSpringDampers[1].clone(),this._translSds[2]=i.translationalSpringDampers[2].clone(),this._rotLms[0]=i.rotationalLimitMotors[0].clone(),this._rotLms[1]=i.rotationalLimitMotors[1].clone(),this._rotLms[2]=i.rotationalLimitMotors[2].clone(),this._rotSds[0]=i.rotationalSpringDampers[0].clone(),this._rotSds[1]=i.rotationalSpringDampers[1].clone(),this._rotSds[2]=i.rotationalSpringDampers[2].clone()}getInfo(t,i,a){var s,o,n=1/(this._b1._invMass+this._b2._invMass),r=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),_=this.computeEffectiveInertiaMoment(this._axisYX,this._axisYY,this._axisYZ),e=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ);if(this._translSds[0].frequency<=0||!a){var h=this._impulses[0],l=t.rows[t.numRows++],c=l.jacobian;c.lin1X=0,c.lin1Y=0,c.lin1Z=0,c.lin2X=0,c.lin2Y=0,c.lin2Z=0,c.ang1X=0,c.ang1Y=0,c.ang1Z=0,c.ang2X=0,c.ang2Y=0,c.ang2Z=0,l.rhs=0,l.cfm=0,l.minImpulse=0,l.maxImpulse=0,l.motorSpeed=0,l.motorMaxImpulse=0,l.impulse=null,l.impulse=h,s=l,this.setSolverInfoRowLinear(s,this.translationX,this._translLms[0],n,this._translSds[0],i,a),(o=s.jacobian).lin1X=this._basisX1X,o.lin1Y=this._basisX1Y,o.lin1Z=this._basisX1Z,o.lin2X=this._basisX1X,o.lin2Y=this._basisX1Y,o.lin2Z=this._basisX1Z,o.ang1X=this._relativeAnchor1Y*this._basisX1Z-this._relativeAnchor1Z*this._basisX1Y,o.ang1Y=this._relativeAnchor1Z*this._basisX1X-this._relativeAnchor1X*this._basisX1Z,o.ang1Z=this._relativeAnchor1X*this._basisX1Y-this._relativeAnchor1Y*this._basisX1X,o.ang2X=this._relativeAnchor2Y*this._basisX1Z-this._relativeAnchor2Z*this._basisX1Y,o.ang2Y=this._relativeAnchor2Z*this._basisX1X-this._relativeAnchor2X*this._basisX1Z,o.ang2Z=this._relativeAnchor2X*this._basisX1Y-this._relativeAnchor2Y*this._basisX1X}if(this._translSds[1].frequency<=0||!a){var m=this._impulses[1],v=t.rows[t.numRows++],b=v.jacobian;b.lin1X=0,b.lin1Y=0,b.lin1Z=0,b.lin2X=0,b.lin2Y=0,b.lin2Z=0,b.ang1X=0,b.ang1Y=0,b.ang1Z=0,b.ang2X=0,b.ang2Y=0,b.ang2Z=0,v.rhs=0,v.cfm=0,v.minImpulse=0,v.maxImpulse=0,v.motorSpeed=0,v.motorMaxImpulse=0,v.impulse=null,v.impulse=m,s=v,this.setSolverInfoRowLinear(s,this.translationY,this._translLms[1],n,this._translSds[1],i,a),(o=s.jacobian).lin1X=this._basisY1X,o.lin1Y=this._basisY1Y,o.lin1Z=this._basisY1Z,o.lin2X=this._basisY1X,o.lin2Y=this._basisY1Y,o.lin2Z=this._basisY1Z,o.ang1X=this._relativeAnchor1Y*this._basisY1Z-this._relativeAnchor1Z*this._basisY1Y,o.ang1Y=this._relativeAnchor1Z*this._basisY1X-this._relativeAnchor1X*this._basisY1Z,o.ang1Z=this._relativeAnchor1X*this._basisY1Y-this._relativeAnchor1Y*this._basisY1X,o.ang2X=this._relativeAnchor2Y*this._basisY1Z-this._relativeAnchor2Z*this._basisY1Y,o.ang2Y=this._relativeAnchor2Z*this._basisY1X-this._relativeAnchor2X*this._basisY1Z,o.ang2Z=this._relativeAnchor2X*this._basisY1Y-this._relativeAnchor2Y*this._basisY1X}if(this._translSds[2].frequency<=0||!a){var x=this._impulses[2],p=t.rows[t.numRows++],f=p.jacobian;f.lin1X=0,f.lin1Y=0,f.lin1Z=0,f.lin2X=0,f.lin2Y=0,f.lin2Z=0,f.ang1X=0,f.ang1Y=0,f.ang1Z=0,f.ang2X=0,f.ang2Y=0,f.ang2Z=0,p.rhs=0,p.cfm=0,p.minImpulse=0,p.maxImpulse=0,p.motorSpeed=0,p.motorMaxImpulse=0,p.impulse=null,p.impulse=x,s=p,this.setSolverInfoRowLinear(s,this.translationZ,this._translLms[2],n,this._translSds[2],i,a),(o=s.jacobian).lin1X=this._basisZ1X,o.lin1Y=this._basisZ1Y,o.lin1Z=this._basisZ1Z,o.lin2X=this._basisZ1X,o.lin2Y=this._basisZ1Y,o.lin2Z=this._basisZ1Z,o.ang1X=this._relativeAnchor1Y*this._basisZ1Z-this._relativeAnchor1Z*this._basisZ1Y,o.ang1Y=this._relativeAnchor1Z*this._basisZ1X-this._relativeAnchor1X*this._basisZ1Z,o.ang1Z=this._relativeAnchor1X*this._basisZ1Y-this._relativeAnchor1Y*this._basisZ1X,o.ang2X=this._relativeAnchor2Y*this._basisZ1Z-this._relativeAnchor2Z*this._basisZ1Y,o.ang2Y=this._relativeAnchor2Z*this._basisZ1X-this._relativeAnchor2X*this._basisZ1Z,o.ang2Z=this._relativeAnchor2X*this._basisZ1Y-this._relativeAnchor2Y*this._basisZ1X}if(!this.xSingular&&(this._rotSds[0].frequency<=0||!a)){var u=this._impulses[3],y=t.rows[t.numRows++],X=y.jacobian;X.lin1X=0,X.lin1Y=0,X.lin1Z=0,X.lin2X=0,X.lin2Y=0,X.lin2Z=0,X.ang1X=0,X.ang1Y=0,X.ang1Z=0,X.ang2X=0,X.ang2Y=0,X.ang2Z=0,y.rhs=0,y.cfm=0,y.minImpulse=0,y.maxImpulse=0,y.motorSpeed=0,y.motorMaxImpulse=0,y.impulse=null,y.impulse=u,s=y,this.setSolverInfoRowAngular(s,this._angleX,this._rotLms[0],r,this._rotSds[0],i,a),(o=s.jacobian).ang1X=this._axisXX,o.ang1Y=this._axisXY,o.ang1Z=this._axisXZ,o.ang2X=this._axisXX,o.ang2Y=this._axisXY,o.ang2Z=this._axisXZ}if(!this.ySingular&&(this._rotSds[1].frequency<=0||!a)){var g=this._impulses[4],z=t.rows[t.numRows++],d=z.jacobian;d.lin1X=0,d.lin1Y=0,d.lin1Z=0,d.lin2X=0,d.lin2Y=0,d.lin2Z=0,d.ang1X=0,d.ang1Y=0,d.ang1Z=0,d.ang2X=0,d.ang2Y=0,d.ang2Z=0,z.rhs=0,z.cfm=0,z.minImpulse=0,z.maxImpulse=0,z.motorSpeed=0,z.motorMaxImpulse=0,z.impulse=null,z.impulse=g,s=z,this.setSolverInfoRowAngular(s,this._angleY,this._rotLms[1],_,this._rotSds[1],i,a),(o=s.jacobian).ang1X=this._axisYX,o.ang1Y=this._axisYY,o.ang1Z=this._axisYZ,o.ang2X=this._axisYX,o.ang2Y=this._axisYY,o.ang2Z=this._axisYZ}if(!this.zSingular&&(this._rotSds[2].frequency<=0||!a)){var Y=this._impulses[5],Z=t.rows[t.numRows++],M=Z.jacobian;M.lin1X=0,M.lin1Y=0,M.lin1Z=0,M.lin2X=0,M.lin2Y=0,M.lin2Z=0,M.ang1X=0,M.ang1Y=0,M.ang1Z=0,M.ang2X=0,M.ang2Y=0,M.ang2Z=0,Z.rhs=0,Z.cfm=0,Z.minImpulse=0,Z.maxImpulse=0,Z.motorSpeed=0,Z.motorMaxImpulse=0,Z.impulse=null,Z.impulse=Y,s=Z,this.setSolverInfoRowAngular(s,this._angleZ,this._rotLms[2],e,this._rotSds[2],i,a),(o=s.jacobian).ang1X=this._axisZX,o.ang1Y=this._axisZY,o.ang1Z=this._axisZZ,o.ang2X=this._axisZX,o.ang2Y=this._axisZY,o.ang2Z=this._axisZZ}}_syncAnchors(){var t,i,a,s,o,n,r,_,e;super._syncAnchors(),this._basisX1X,this._basisY1X,this._basisZ1X,this._basisX1Y,this._basisY1Y,this._basisZ1Y,this._basisX1Z,this._basisY1Z,this._basisZ1Z,this._basisX2X,this._basisY2X,this._basisZ2X,this._basisX2Y,this._basisY2Y,this._basisZ2Y,this._basisX2Z,this._basisY2Z,this._basisZ2Z,t=this._basisX1X,i=this._basisX1Y,a=this._basisX1Z,r=this._basisZ2X,s=(_=this._basisZ2Y)*a-(e=this._basisZ2Z)*i,o=e*t-r*a,n=r*i-_*t,this._axisXX=o*e-n*_,this._axisXY=n*r-s*e,this._axisXZ=s*_-o*r,this._axisYX=s,this._axisYY=o,this._axisYZ=n,this._axisZX=i*n-a*o,this._axisZY=a*s-t*n,this._axisZZ=t*o-i*s;var h=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;h>0&&(h=1/Math.sqrt(h)),this._axisXX*=h,this._axisXY*=h,this._axisXZ*=h;var l=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;l>0&&(l=1/Math.sqrt(l)),this._axisYX*=l,this._axisYY*=l,this._axisYZ*=l;var c,m,v,b,x,p,f,u,y,X,g,z,d,Y,Z,M,I,V,L,w,k,B,A,P,S,T,C=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;C>0&&(C=1/Math.sqrt(C)),this._axisZX*=C,this._axisZY*=C,this._axisZZ*=C,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0,c=this._basisX1X,m=this._basisY1X,v=this._basisZ1X,b=this._basisX1Y,x=this._basisY1Y,p=this._basisZ1Y,f=this._basisX1Z,u=this._basisY1Z,y=this._basisZ1Z,X=this._basisX2X,g=this._basisY2X,z=this._basisZ2X,d=this._basisX2Y,Y=this._basisY2Y,Z=this._basisZ2Y,V=c*X+b*d+f*this._basisX2Z,L=c*g+b*Y+f*(M=this._basisY2Z),w=m*g+x*Y+u*M,k=m*z+x*Z+u*(I=this._basisZ2Z),B=v*g+p*Y+y*M,A=v*z+p*Z+y*I;var j,R,q,E=c*z+b*Z+f*I;if(E<=-1){var D=Math.atan2(B,w);P=.5*D,S=-1.570796326794895,T=.5*-D}else if(E>=1){var F=Math.atan2(B,w);P=.5*F,S=1.570796326794895,T=.5*F}else{var N=Math.asin(E);P=Math.atan2(-k,A),S=N,T=Math.atan2(-L,V)}this._angleX=P,this._angleY=S,this._angleZ=T,j=this._anchor2X-this._anchor1X,R=this._anchor2Y-this._anchor1Y,q=this._anchor2Z-this._anchor1Z,this.translationX=j*this._basisX1X+R*this._basisX1Y+q*this._basisX1Z,this.translationY=j*this._basisY1X+R*this._basisY1Y+q*this._basisY1Z,this.translationZ=j*this._basisZ1X+R*this._basisZ1Y+q*this._basisZ1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxisX(){var i=new t.common.Vec3,a=i;return a.x=this._basisX1X,a.y=this._basisX1Y,a.z=this._basisX1Z,i}getAxisY(){var i=new t.common.Vec3,a=i;return a.x=this._axisYX,a.y=this._axisYY,a.z=this._axisYZ,i}getAxisZ(){var i=new t.common.Vec3,a=i;return a.x=this._basisZ2X,a.y=this._basisZ2Y,a.z=this._basisZ2Z,i}getTranslationalSpringDampers(){return this._translSds.slice(0)}getRotationalSpringDampers(){return this._translSds.slice(0)}getTranslationalLimitMotors(){return this._translLms.slice(0)}getRotationalLimitMotors(){return this._rotLms.slice(0)}getAngles(){return new t.common.Vec3(this._angleX,this._angleY,this._angleZ)}getTranslations(){return new t.common.Vec3(this.translationX,this.translationY,this.translationZ)}},t.dynamics.constraint.joint.GenericJointConfig=class extends t.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localBasis1=new t.common.Mat3,this.localBasis2=new t.common.Mat3;var i=[];i.push((new t.dynamics.constraint.joint.TranslationalLimitMotor).setLimits(0,0)),i.push((new t.dynamics.constraint.joint.TranslationalLimitMotor).setLimits(0,0)),i.push((new t.dynamics.constraint.joint.TranslationalLimitMotor).setLimits(0,0)),this.translationalLimitMotors=i;var a=[];a.push((new t.dynamics.constraint.joint.RotationalLimitMotor).setLimits(0,0)),a.push((new t.dynamics.constraint.joint.RotationalLimitMotor).setLimits(0,0)),a.push((new t.dynamics.constraint.joint.RotationalLimitMotor).setLimits(0,0)),this.rotationalLimitMotors=a,this.translationalSpringDampers=[new t.dynamics.constraint.joint.SpringDamper,new t.dynamics.constraint.joint.SpringDamper,new t.dynamics.constraint.joint.SpringDamper],this.rotationalSpringDampers=[new t.dynamics.constraint.joint.SpringDamper,new t.dynamics.constraint.joint.SpringDamper,new t.dynamics.constraint.joint.SpringDamper]}init(t,i,a,s,o){this._init(t,i,a);var n,r,_,e,h,l,c,m,v,b,x,p,f,u,y,X,g,z,d,Y,Z,M,I,V,L,w,k,B,A,P,S,T,C,j,R,q,E=t._transform,D=i._transform,F=s;n=F.e00,r=F.e01,_=F.e02,e=F.e10,h=F.e11,l=F.e12,c=F.e20,m=F.e21,v=F.e22;var N=o;b=N.e00,x=N.e01,p=N.e02,f=N.e10,u=N.e11,y=N.e12,X=N.e20,g=N.e21,z=N.e22,d=E._rotation00*n+E._rotation10*e+E._rotation20*c,Y=E._rotation00*r+E._rotation10*h+E._rotation20*m,Z=E._rotation00*_+E._rotation10*l+E._rotation20*v,M=E._rotation01*n+E._rotation11*e+E._rotation21*c,I=E._rotation01*r+E._rotation11*h+E._rotation21*m,V=E._rotation01*_+E._rotation11*l+E._rotation21*v,L=E._rotation02*n+E._rotation12*e+E._rotation22*c,w=E._rotation02*r+E._rotation12*h+E._rotation22*m,k=E._rotation02*_+E._rotation12*l+E._rotation22*v,B=D._rotation00*b+D._rotation10*f+D._rotation20*X,A=D._rotation00*x+D._rotation10*u+D._rotation20*g,P=D._rotation00*p+D._rotation10*y+D._rotation20*z,S=D._rotation01*b+D._rotation11*f+D._rotation21*X,T=D._rotation01*x+D._rotation11*u+D._rotation21*g,C=D._rotation01*p+D._rotation11*y+D._rotation21*z,j=D._rotation02*b+D._rotation12*f+D._rotation22*X,R=D._rotation02*x+D._rotation12*u+D._rotation22*g,q=D._rotation02*p+D._rotation12*y+D._rotation22*z;var W=this.localBasis1;W.e00=d,W.e01=Y,W.e02=Z,W.e10=M,W.e11=I,W.e12=V,W.e20=L,W.e21=w,W.e22=k;var G=this.localBasis2;return G.e00=B,G.e01=A,G.e02=P,G.e10=S,G.e11=T,G.e12=C,G.e20=j,G.e21=R,G.e22=q,this}},t.dynamics.constraint.joint.JointImpulse=class{constructor(){this.impulse=0,this.impulseM=0,this.impulseP=0}},t.dynamics.constraint.joint.JointLink=class{constructor(t){this._joint=t}getContact(){return this._joint}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}},t.dynamics.constraint.joint.JointMacro=class{},t.dynamics.constraint.joint.JointType=class{},t.dynamics.constraint.joint.PrismaticJoint=class extends t.dynamics.constraint.joint.Joint{constructor(i){super(i,t.dynamics.constraint.joint.JointType.PRISMATIC);var a=i.localAxis1;this._localBasisX1X=a.x,this._localBasisX1Y=a.y,this._localBasisX1Z=a.z;var s=i.localAxis2;this._localBasisX2X=s.x,this._localBasisX2Y=s.y,this._localBasisX2Z=s.z,this.buildLocalBasesFromX(),this._basis=new t.dynamics.constraint.joint.BasisTracker(this),this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this.angularErrorX=0,this.angularErrorY=0,this.angularErrorZ=0,this._sd=i.springDamper.clone(),this._lm=i.limitMotor.clone()}getInfo(t,i,a){var s,o,n=this.getErp(i,a),r=this.linearErrorY*n,_=this.linearErrorZ*n,e=this.angularErrorX*n,h=this.angularErrorY*n,l=this.angularErrorZ*n,c=1/(this._b1._invMass+this._b2._invMass);if(this._sd.frequency<=0||!a){var m=this._impulses[0],v=t.rows[t.numRows++],b=v.jacobian;b.lin1X=0,b.lin1Y=0,b.lin1Z=0,b.lin2X=0,b.lin2Y=0,b.lin2Z=0,b.ang1X=0,b.ang1Y=0,b.ang1Z=0,b.ang2X=0,b.ang2Y=0,b.ang2Z=0,v.rhs=0,v.cfm=0,v.minImpulse=0,v.maxImpulse=0,v.motorSpeed=0,v.motorMaxImpulse=0,v.impulse=null,v.impulse=m,s=v,this.setSolverInfoRowLinear(s,this.translation,this._lm,c,this._sd,i,a),(o=s.jacobian).lin1X=this._basis.xX,o.lin1Y=this._basis.xY,o.lin1Z=this._basis.xZ,o.lin2X=this._basis.xX,o.lin2Y=this._basis.xY,o.lin2Z=this._basis.xZ,o.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,o.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,o.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,o.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,o.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,o.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}var x=this._impulses[1],p=t.rows[t.numRows++],f=p.jacobian;f.lin1X=0,f.lin1Y=0,f.lin1Z=0,f.lin2X=0,f.lin2Y=0,f.lin2Z=0,f.ang1X=0,f.ang1Y=0,f.ang1Z=0,f.ang2X=0,f.ang2Y=0,f.ang2Z=0,p.rhs=0,p.cfm=0,p.minImpulse=0,p.maxImpulse=0,p.motorSpeed=0,p.motorMaxImpulse=0,p.impulse=null,p.impulse=x,(s=p).rhs=r,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=1/0,(o=s.jacobian).lin1X=this._basis.yX,o.lin1Y=this._basis.yY,o.lin1Z=this._basis.yZ,o.lin2X=this._basis.yX,o.lin2Y=this._basis.yY,o.lin2Z=this._basis.yZ,o.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,o.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,o.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,o.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,o.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,o.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;var u=this._impulses[2],y=t.rows[t.numRows++],X=y.jacobian;X.lin1X=0,X.lin1Y=0,X.lin1Z=0,X.lin2X=0,X.lin2Y=0,X.lin2Z=0,X.ang1X=0,X.ang1Y=0,X.ang1Z=0,X.ang2X=0,X.ang2Y=0,X.ang2Z=0,y.rhs=0,y.cfm=0,y.minImpulse=0,y.maxImpulse=0,y.motorSpeed=0,y.motorMaxImpulse=0,y.impulse=null,y.impulse=u,(s=y).rhs=_,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=1/0,(o=s.jacobian).lin1X=this._basis.zX,o.lin1Y=this._basis.zY,o.lin1Z=this._basis.zZ,o.lin2X=this._basis.zX,o.lin2Y=this._basis.zY,o.lin2Z=this._basis.zZ,o.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,o.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,o.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,o.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,o.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,o.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX;var g=this._impulses[3],z=t.rows[t.numRows++],d=z.jacobian;d.lin1X=0,d.lin1Y=0,d.lin1Z=0,d.lin2X=0,d.lin2Y=0,d.lin2Z=0,d.ang1X=0,d.ang1Y=0,d.ang1Z=0,d.ang2X=0,d.ang2Y=0,d.ang2Z=0,z.rhs=0,z.cfm=0,z.minImpulse=0,z.maxImpulse=0,z.motorSpeed=0,z.motorMaxImpulse=0,z.impulse=null,z.impulse=g,(s=z).rhs=e,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=1/0,(o=s.jacobian).ang1X=1,o.ang1Y=0,o.ang1Z=0,o.ang2X=1,o.ang2Y=0,o.ang2Z=0;var Y=this._impulses[4],Z=t.rows[t.numRows++],M=Z.jacobian;M.lin1X=0,M.lin1Y=0,M.lin1Z=0,M.lin2X=0,M.lin2Y=0,M.lin2Z=0,M.ang1X=0,M.ang1Y=0,M.ang1Z=0,M.ang2X=0,M.ang2Y=0,M.ang2Z=0,Z.rhs=0,Z.cfm=0,Z.minImpulse=0,Z.maxImpulse=0,Z.motorSpeed=0,Z.motorMaxImpulse=0,Z.impulse=null,Z.impulse=Y,(s=Z).rhs=h,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=1/0,(o=s.jacobian).ang1X=0,o.ang1Y=1,o.ang1Z=0,o.ang2X=0,o.ang2Y=1,o.ang2Z=0;var I=this._impulses[5],V=t.rows[t.numRows++],L=V.jacobian;L.lin1X=0,L.lin1Y=0,L.lin1Z=0,L.lin2X=0,L.lin2Y=0,L.lin2Z=0,L.ang1X=0,L.ang1Y=0,L.ang1Z=0,L.ang2X=0,L.ang2Y=0,L.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=I,(s=V).rhs=l,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=1/0,(o=s.jacobian).ang1X=0,o.ang1Y=0,o.ang1Z=1,o.ang2X=0,o.ang2Y=0,o.ang2Z=1}_syncAnchors(){super._syncAnchors();var t,i,a,s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y,X,g,z,d,Y,Z,M,I,V,L,w,k,B,A,P,S,T,C,j,R=this._basis,q=R.joint._b1._invMass,E=R.joint._b2._invMass,D=R.joint._basisX1X*R.joint._basisX2X+R.joint._basisX1Y*R.joint._basisX2Y+R.joint._basisX1Z*R.joint._basisX2Z;if(D<-.999999999){var F,N,W,G,J=R.joint._basisX1X,O=R.joint._basisX1Y,H=R.joint._basisX1Z,U=J*J,Q=O*O,K=H*H;U<Q?U<K?(F=0,N=H*(G=1/Math.sqrt(Q+K)),W=-O*G):(F=O*(G=1/Math.sqrt(U+Q)),N=-J*G,W=0):Q<K?(F=-H*(G=1/Math.sqrt(K+U)),N=0,W=J*G):(F=O*(G=1/Math.sqrt(U+Q)),N=-J*G,W=0),t=F,i=N,a=W,s=0}else{var $,tt,it;$=R.joint._basisX1Y*R.joint._basisX2Z-R.joint._basisX1Z*R.joint._basisX2Y,tt=R.joint._basisX1Z*R.joint._basisX2X-R.joint._basisX1X*R.joint._basisX2Z,it=R.joint._basisX1X*R.joint._basisX2Y-R.joint._basisX1Y*R.joint._basisX2X;var at=Math.sqrt(.5*(1+D));t=$*=D=.5/at,i=tt*=D,a=it*=D,s=at}var st=(k=0)*(S=t)+(B=0)*(T=i)+(A=0)*(C=a)+(P=1)*(j=s);if(st<0&&(st=-st,S=-S,T=-T,C=-C,j=-j),st>.999999){var ot=(S=k+(S-k)*(q/(q+E)))*S+(T=B+(T-B)*(q/(q+E)))*T+(C=A+(C-A)*(q/(q+E)))*C+(j=P+(j-P)*(q/(q+E)))*j;ot>1e-32&&(ot=1/Math.sqrt(ot)),o=S*ot,n=T*ot,r=C*ot,_=j*ot}else{var nt=q/(q+E)*Math.acos(st),rt=(S+=k*-st)*S+(T+=B*-st)*T+(C+=A*-st)*C+(j+=P*-st)*j;rt>1e-32&&(rt=1/Math.sqrt(rt)),S*=rt,T*=rt,C*=rt,j*=rt;var _t=Math.sin(nt),et=Math.cos(nt);o=(k*=et)+S*_t,n=(B*=et)+T*_t,r=(A*=et)+C*_t,_=(P*=et)+j*_t}var ht=2*o,lt=2*n,ct=2*r,mt=o*ht,vt=n*lt,bt=r*ct,xt=o*lt,pt=n*ct,ft=o*ct,ut=_*ht,yt=_*lt,Xt=_*ct;e=xt-Xt,h=ft+yt,l=xt+Xt,c=1-mt-bt,m=pt-ut,v=ft-yt,b=pt+ut,x=1-mt-vt,p=(1-vt-bt)*R.joint._basisX1X+e*R.joint._basisX1Y+h*R.joint._basisX1Z,f=l*R.joint._basisX1X+c*R.joint._basisX1Y+m*R.joint._basisX1Z,u=v*R.joint._basisX1X+b*R.joint._basisX1Y+x*R.joint._basisX1Z,Z=R.xX,M=R.xY,I=R.xZ,V=R.yX,L=R.yY,w=R.yZ;var gt=Z*p+M*f+I*u;if(gt<-.999999999){var zt,dt,Yt,Zt,Mt=Z,It=M,Vt=I,Lt=Mt*Mt,wt=It*It,kt=Vt*Vt;Lt<wt?Lt<kt?(zt=0,dt=Vt*(Zt=1/Math.sqrt(wt+kt)),Yt=-It*Zt):(zt=It*(Zt=1/Math.sqrt(Lt+wt)),dt=-Mt*Zt,Yt=0):wt<kt?(zt=-Vt*(Zt=1/Math.sqrt(kt+Lt)),dt=0,Yt=Mt*Zt):(zt=It*(Zt=1/Math.sqrt(Lt+wt)),dt=-Mt*Zt,Yt=0),o=zt,n=dt,r=Yt,_=0}else{var Bt,At,Pt;Bt=M*u-I*f,At=I*p-Z*u,Pt=Z*f-M*p;var St=Math.sqrt(.5*(1+gt));o=Bt*=gt=.5/St,n=At*=gt,r=Pt*=gt,_=St}var Tt,Ct,jt,Rt,qt,Et,Dt,Ft,Nt,Wt,Gt,Jt,Ot,Ht,Ut,Qt,Kt,$t,ti,ii,ai,si,oi,ni,ri,_i,ei,hi,li=2*o,ci=2*n,mi=2*r,vi=o*li,bi=n*ci,xi=r*mi,pi=o*ci,fi=n*mi,ui=o*mi,yi=_*li,Xi=_*ci,gi=_*mi;if((z=f*(g=(v=ui-Xi)*V+(b=fi+yi)*L+(x=1-vi-bi)*w)-u*(X=(l=pi+gi)*V+(c=1-vi-xi)*L+(m=fi-yi)*w))*z+(d=u*(y=(1-bi-xi)*V+(e=pi-gi)*L+(h=ui+Xi)*w)-p*g)*d+(Y=p*X-f*y)*Y>1e-6){var zi=z*z+d*d+Y*Y;zi>0&&(zi=1/Math.sqrt(zi)),z*=zi,d*=zi,Y*=zi}else{var di,Yi=p,Zi=f,Mi=u,Ii=Yi*Yi,Vi=Zi*Zi,Li=Mi*Mi;Ii<Vi?Ii<Li?(z=0,d=Mi*(di=1/Math.sqrt(Vi+Li)),Y=-Zi*di):(z=Zi*(di=1/Math.sqrt(Ii+Vi)),d=-Yi*di,Y=0):Vi<Li?(z=-Mi*(di=1/Math.sqrt(Li+Ii)),d=0,Y=Yi*di):(z=Zi*(di=1/Math.sqrt(Ii+Vi)),d=-Yi*di,Y=0)}y=d*u-Y*f,X=Y*p-z*u,g=z*f-d*p,R.xX=p,R.xY=f,R.xZ=u,R.yX=y,R.yY=X,R.yZ=g,R.zX=z,R.zY=d,R.zZ=Y,Tt=this._basisX1X,Ct=this._basisY1X,jt=this._basisZ1X,Rt=this._basisX1Y,qt=this._basisY1Y,Et=this._basisZ1Y,Dt=this._basisX1Z,Ft=this._basisY1Z,Nt=this._basisZ1Z,ti=(Wt=this._basisX2X)*Rt+(Gt=this._basisY2X)*qt+(Jt=this._basisZ2X)*Et,ii=Wt*Dt+Gt*Ft+Jt*Nt,ai=(Ot=this._basisX2Y)*Tt+(Ht=this._basisY2Y)*Ct+(Ut=this._basisZ2Y)*jt,si=Ot*Dt+Ht*Ft+Ut*Nt,oi=(Qt=this._basisX2Z)*Tt+(Kt=this._basisY2Z)*Ct+($t=this._basisZ2Z)*jt,ni=Qt*Rt+Kt*qt+$t*Et;var wi,ki=Wt*Tt+Gt*Ct+Jt*jt,Bi=Ot*Rt+Ht*qt+Ut*Et,Ai=Qt*Dt+Kt*Ft+$t*Nt,Pi=ki+Bi+Ai;Pi>0?(hi=.5*(wi=Math.sqrt(Pi+1)),ri=(ni-si)*(wi=.5/wi),_i=(ii-oi)*wi,ei=(ai-ti)*wi):ki>Bi?ki>Ai?(ri=.5*(wi=Math.sqrt(ki-Bi-Ai+1)),_i=(ti+ai)*(wi=.5/wi),ei=(ii+oi)*wi,hi=(ni-si)*wi):(ei=.5*(wi=Math.sqrt(Ai-ki-Bi+1)),ri=(ii+oi)*(wi=.5/wi),_i=(si+ni)*wi,hi=(ai-ti)*wi):Bi>Ai?(_i=.5*(wi=Math.sqrt(Bi-Ai-ki+1)),ri=(ti+ai)*(wi=.5/wi),ei=(si+ni)*wi,hi=(ii-oi)*wi):(ei=.5*(wi=Math.sqrt(Ai-ki-Bi+1)),ri=(ii+oi)*(wi=.5/wi),_i=(si+ni)*wi,hi=(ai-ti)*wi);var Si=hi,Ti=2*(Si<=-1?3.14159265358979:Si>=1?0:Math.acos(Si));this.angularErrorX=ri,this.angularErrorY=_i,this.angularErrorZ=ei;var Ci,ji,Ri,qi=this.angularErrorX*this.angularErrorX+this.angularErrorY*this.angularErrorY+this.angularErrorZ*this.angularErrorZ;qi>0&&(qi=1/Math.sqrt(qi)),this.angularErrorX*=qi,this.angularErrorY*=qi,this.angularErrorZ*=qi,this.angularErrorX*=Ti,this.angularErrorY*=Ti,this.angularErrorZ*=Ti,Ci=this._anchor2X-this._anchor1X,ji=this._anchor2Y-this._anchor1Y,Ri=this._anchor2Z-this._anchor1Z,this.translation=Ci*this._basis.xX+ji*this._basis.xY+Ri*this._basis.xZ,this.linearErrorY=Ci*this._basis.yX+ji*this._basis.yY+Ri*this._basis.yZ,this.linearErrorZ=Ci*this._basis.zX+ji*this._basis.zY+Ri*this._basis.zZ}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){var i=new t.common.Vec3,a=i;return a.x=this._basisX1X,a.y=this._basisX1Y,a.z=this._basisX1Z,i}getAxis2(){var i=new t.common.Vec3,a=i;return a.x=this._basisX2X,a.y=this._basisX2Y,a.z=this._basisX2Z,i}getAxis1To(t){var i=t;i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z}getAxis2To(t){var i=t;i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z}getLocalAxis1(){var i=new t.common.Vec3,a=i;return a.x=this._localBasisX1X,a.y=this._localBasisX1Y,a.z=this._localBasisX1Z,i}getLocalAxis2(){var i=new t.common.Vec3,a=i;return a.x=this._localBasisX2X,a.y=this._localBasisX2Y,a.z=this._localBasisX2Z,i}getLocalAxis1To(t){var i=t;i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z}getLocalAxis2To(t){var i=t;i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getTranslation(){return this.translation}},t.dynamics.constraint.joint.PrismaticJointConfig=class extends t.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new t.common.Vec3(1,0,0),this.localAxis2=new t.common.Vec3(1,0,0),this.limitMotor=new t.dynamics.constraint.joint.TranslationalLimitMotor,this.springDamper=new t.dynamics.constraint.joint.SpringDamper}init(t,i,a,s){var o,n,r;this._init(t,i,a);var _,e,h,l=s;o=l.x,n=l.y,r=l.z,_=t._transform._rotation00*o+t._transform._rotation10*n+t._transform._rotation20*r,e=t._transform._rotation01*o+t._transform._rotation11*n+t._transform._rotation21*r,h=t._transform._rotation02*o+t._transform._rotation12*n+t._transform._rotation22*r,o=_,n=e,r=h;var c,m,v,b=this.localAxis1;b.x=o,b.y=n,b.z=r;var x,p,f,u=s;c=u.x,m=u.y,v=u.z,x=i._transform._rotation00*c+i._transform._rotation10*m+i._transform._rotation20*v,p=i._transform._rotation01*c+i._transform._rotation11*m+i._transform._rotation21*v,f=i._transform._rotation02*c+i._transform._rotation12*m+i._transform._rotation22*v,c=x,m=p,v=f;var y=this.localAxis2;return y.x=c,y.y=m,y.z=v,this}},t.dynamics.constraint.joint.RagdollJoint=class extends t.dynamics.constraint.joint.Joint{constructor(i){super(i,t.dynamics.constraint.joint.JointType.RAGDOLL);var a=i.localTwistAxis1;this._localBasisX1X=a.x,this._localBasisX1Y=a.y,this._localBasisX1Z=a.z;var s=i.localSwingAxis1;this._localBasisY1X=s.x,this._localBasisY1Y=s.y,this._localBasisY1Z=s.z;var o=i.localTwistAxis2;this._localBasisX2X=o.x,this._localBasisX2Y=o.y,this._localBasisX2Z=o.z,this.buildLocalBasesFromXY1X2(),this._twistSd=i.twistSpringDamper.clone(),this._twistLm=i.twistLimitMotor.clone(),this._swingSd=i.swingSpringDamper.clone(),this._maxSwingAngle1=i.maxSwingAngle1,this._maxSwingAngle2=i.maxSwingAngle2,this._maxSwingAngle1<t.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle1=t.common.Setting.minRagdollMaxSwingAngle),this._maxSwingAngle2<t.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle2=t.common.Setting.minRagdollMaxSwingAngle),this.dummySwingLm=new t.dynamics.constraint.joint.RotationalLimitMotor,this.dummySwingLm.lowerLimit=-1,this.dummySwingLm.upperLimit=0,this._swingAngle=0,this._twistAngle=0,this.swingError=0,this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.twistAxisX=0,this.twistAxisY=0,this.twistAxisZ=0}getInfo(t,i,a){var s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y,X,g=this.getErp(i,a),z=this.linearErrorX*g,d=this.linearErrorY*g,Y=this.linearErrorZ*g;s=-(s=0),o=-(o=-this._relativeAnchor1Z),n=-(n=this._relativeAnchor1Y),r=-(r=this._relativeAnchor1Z),_=-(_=0),e=-(e=-this._relativeAnchor1X),h=-(h=-this._relativeAnchor1Y),l=-(l=this._relativeAnchor1X),c=-(c=0),m=-(m=0),v=-(v=-this._relativeAnchor2Z),b=-(b=this._relativeAnchor2Y),x=-(x=this._relativeAnchor2Z),p=-(p=0),f=-(f=-this._relativeAnchor2X),u=-(u=-this._relativeAnchor2Y),y=-(y=this._relativeAnchor2X),X=-(X=0);var Z=this.computeEffectiveInertiaMoment(this.swingAxisX,this.swingAxisY,this.swingAxisZ),M=this.computeEffectiveInertiaMoment(this._basisX2X,this._basisX2Y,this._basisX2Z),I=this._impulses[0],V=t.rows[t.numRows++],L=V.jacobian;L.lin1X=0,L.lin1Y=0,L.lin1Z=0,L.lin2X=0,L.lin2Y=0,L.lin2Z=0,L.ang1X=0,L.ang1Y=0,L.ang1Z=0,L.ang2X=0,L.ang2Y=0,L.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=I;var w=V;w.rhs=z,w.cfm=0,w.minImpulse=-1/0,w.maxImpulse=1/0;var k=w.jacobian;k.lin1X=1,k.lin1Y=0,k.lin1Z=0,k.lin2X=1,k.lin2Y=0,k.lin2Z=0,k.ang1X=s,k.ang1Y=o,k.ang1Z=n,k.ang2X=m,k.ang2Y=v,k.ang2Z=b;var B=this._impulses[1],A=t.rows[t.numRows++],P=A.jacobian;P.lin1X=0,P.lin1Y=0,P.lin1Z=0,P.lin2X=0,P.lin2Y=0,P.lin2Z=0,P.ang1X=0,P.ang1Y=0,P.ang1Z=0,P.ang2X=0,P.ang2Y=0,P.ang2Z=0,A.rhs=0,A.cfm=0,A.minImpulse=0,A.maxImpulse=0,A.motorSpeed=0,A.motorMaxImpulse=0,A.impulse=null,A.impulse=B,(w=A).rhs=d,w.cfm=0,w.minImpulse=-1/0,w.maxImpulse=1/0,(k=w.jacobian).lin1X=0,k.lin1Y=1,k.lin1Z=0,k.lin2X=0,k.lin2Y=1,k.lin2Z=0,k.ang1X=r,k.ang1Y=_,k.ang1Z=e,k.ang2X=x,k.ang2Y=p,k.ang2Z=f;var S=this._impulses[2],T=t.rows[t.numRows++],C=T.jacobian;if(C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,T.rhs=0,T.cfm=0,T.minImpulse=0,T.maxImpulse=0,T.motorSpeed=0,T.motorMaxImpulse=0,T.impulse=null,T.impulse=S,(w=T).rhs=Y,w.cfm=0,w.minImpulse=-1/0,w.maxImpulse=1/0,(k=w.jacobian).lin1X=0,k.lin1Y=0,k.lin1Z=1,k.lin2X=0,k.lin2Y=0,k.lin2Z=1,k.ang1X=h,k.ang1Y=l,k.ang1Z=c,k.ang2X=u,k.ang2Y=y,k.ang2Z=X,this.swingError>0&&(this._swingSd.frequency<=0||!a)){var j=this._impulses[3],R=t.rows[t.numRows++],q=R.jacobian;q.lin1X=0,q.lin1Y=0,q.lin1Z=0,q.lin2X=0,q.lin2Y=0,q.lin2Z=0,q.ang1X=0,q.ang1Y=0,q.ang1Z=0,q.ang2X=0,q.ang2Y=0,q.ang2Z=0,R.rhs=0,R.cfm=0,R.minImpulse=0,R.maxImpulse=0,R.motorSpeed=0,R.motorMaxImpulse=0,R.impulse=null,R.impulse=j,w=R,this.setSolverInfoRowAngular(w,this.swingError,this.dummySwingLm,Z,this._swingSd,i,a),(k=w.jacobian).ang1X=this.swingAxisX,k.ang1Y=this.swingAxisY,k.ang1Z=this.swingAxisZ,k.ang2X=this.swingAxisX,k.ang2Y=this.swingAxisY,k.ang2Z=this.swingAxisZ}if(this._twistSd.frequency<=0||!a){var E=this._impulses[4],D=t.rows[t.numRows++],F=D.jacobian;F.lin1X=0,F.lin1Y=0,F.lin1Z=0,F.lin2X=0,F.lin2Y=0,F.lin2Z=0,F.ang1X=0,F.ang1Y=0,F.ang1Z=0,F.ang2X=0,F.ang2Y=0,F.ang2Z=0,D.rhs=0,D.cfm=0,D.minImpulse=0,D.maxImpulse=0,D.motorSpeed=0,D.motorMaxImpulse=0,D.impulse=null,D.impulse=E,w=D,this.setSolverInfoRowAngular(w,this._twistAngle,this._twistLm,M,this._twistSd,i,a),(k=w.jacobian).ang1X=this.twistAxisX,k.ang1Y=this.twistAxisY,k.ang1Z=this.twistAxisZ,k.ang2X=this.twistAxisX,k.ang2Y=this.twistAxisY,k.ang2Z=this.twistAxisZ}}_syncAnchors(){var t,i,a,s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y,X,g,z,d,Y,Z,M,I,V,L,w;super._syncAnchors(),this._b1._transform,this._b2._transform,t=this._basisX1X,i=this._basisX1Y,a=this._basisX1Z,s=this._basisX2X,o=this._basisX2Y,n=this._basisX2Z,r=this._basisX1X,_=this._basisY1X,e=this._basisZ1X,h=this._basisX1Y,l=this._basisY1Y,c=this._basisZ1Y,m=this._basisX1Z,v=this._basisY1Z,b=this._basisZ1Z,this._basisX2X,this._basisY2X,this._basisZ2X,this._basisX2Y,this._basisY2Y,this._basisZ2Y,this._basisX2Z,this._basisY2Z,this._basisZ2Z;var k=t*s+i*o+a*n;if(k<-.999999999){var B,A,P,S,T=t,C=i,j=a,R=T*T,q=C*C,E=j*j;R<q?R<E?(B=0,A=j*(S=1/Math.sqrt(q+E)),P=-C*S):(B=C*(S=1/Math.sqrt(R+q)),A=-T*S,P=0):q<E?(B=-j*(S=1/Math.sqrt(E+R)),A=0,P=T*S):(B=C*(S=1/Math.sqrt(R+q)),A=-T*S,P=0),x=B,p=A,f=P,u=0}else{var D,F,N;D=i*n-a*o,F=a*s-t*n,N=t*o-i*s;var W=Math.sqrt(.5*(1+k));x=D*=k=.5/W,p=F*=k,f=N*=k,u=W}var G,J,O,H=2*x,U=2*p,Q=2*f,K=x*H,$=p*U,tt=f*Q,it=x*U,at=p*Q,st=x*Q,ot=u*H,nt=u*U,rt=u*Q;y=1-$-tt,X=it-rt,g=st+nt,z=it+rt,d=1-K-tt,Y=at-ot,Z=st-nt,M=at+ot,I=1-K-$,this._swingAngle=2*(u<=-1?3.14159265358979:u>=1?0:Math.acos(u)),V=x,L=p,w=f,G=y*this._basisY2X+z*this._basisY2Y+Z*this._basisY2Z,J=X*this._basisY2X+d*this._basisY2Y+M*this._basisY2Z,O=g*this._basisY2X+Y*this._basisY2Y+I*this._basisY2Z;var _t=this._basisY1X*G+this._basisY1Y*J+this._basisY1Z*O,et=this._basisZ1X*G+this._basisZ1Y*J+this._basisZ1Z*O;this._twistAngle=Math.atan2(et,_t),this.twistAxisX=this._basisX1X+this._basisX2X,this.twistAxisY=this._basisX1Y+this._basisX2Y,this.twistAxisZ=this._basisX1Z+this._basisX2Z;var ht=this.twistAxisX*this.twistAxisX+this.twistAxisY*this.twistAxisY+this.twistAxisZ*this.twistAxisZ;ht>0&&(ht=1/Math.sqrt(ht)),this.twistAxisX*=ht,this.twistAxisY*=ht,this.twistAxisZ*=ht;var lt,ct,mt=Math.sqrt(V*V+L*L+w*w);mt>0&&(mt=1/mt),lt=_*(V*=mt*this._swingAngle)+l*(L*=mt*this._swingAngle)+v*(w*=mt*this._swingAngle),ct=e*V+c*L+b*w,V=r*V+h*L+m*w;var vt=L=lt,bt=w=ct,xt=this._maxSwingAngle1,pt=this._maxSwingAngle2,ft=1/(xt*xt),ut=1/(pt*pt),yt=vt*vt*ft+bt*bt*ut;if(0==yt)this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.swingError=0;else{var Xt,gt,zt,dt,Yt,Zt,Mt=Math.sqrt(1/yt),It=vt*Mt,Vt=bt*Mt,Lt=It*ft,wt=Vt*ut,kt=(vt-It)*(Lt*=mt=1/Math.sqrt(Lt*Lt+wt*wt))+(bt-Vt)*(wt*=mt);if(kt>0)this.swingError=kt,this.swingAxisX=0,this.swingAxisY=Lt,this.swingAxisZ=wt,Xt=r*this.swingAxisX+_*this.swingAxisY+e*this.swingAxisZ,gt=h*this.swingAxisX+l*this.swingAxisY+c*this.swingAxisZ,zt=m*this.swingAxisX+v*this.swingAxisY+b*this.swingAxisZ,this.swingAxisX=Xt,this.swingAxisY=gt,this.swingAxisZ=zt,dt=y*this.swingAxisX+X*this.swingAxisY+g*this.swingAxisZ,Yt=z*this.swingAxisX+d*this.swingAxisY+Y*this.swingAxisZ,Zt=Z*this.swingAxisX+M*this.swingAxisY+I*this.swingAxisZ,this.swingAxisX=dt,this.swingAxisY=Yt,this.swingAxisZ=Zt;else this.swingError=0}this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){var i=new t.common.Vec3,a=i;return a.x=this._basisX1X,a.y=this._basisX1Y,a.z=this._basisX1Z,i}getAxis2(){var i=new t.common.Vec3,a=i;return a.x=this._basisX2X,a.y=this._basisX2Y,a.z=this._basisX2Z,i}getAxis1To(t){var i=t;i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z}getAxis2To(t){var i=t;i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z}getLocalAxis1(){var i=new t.common.Vec3,a=i;return a.x=this._localBasisX1X,a.y=this._localBasisX1Y,a.z=this._localBasisX1Z,i}getLocalAxis2(){var i=new t.common.Vec3,a=i;return a.x=this._localBasisX2X,a.y=this._localBasisX2Y,a.z=this._localBasisX2Z,i}getLocalAxis1To(t){var i=t;i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z}getLocalAxis2To(t){var i=t;i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z}getTwistSpringDamper(){return this._twistSd}getTwistLimitMotor(){return this._twistLm}getSwingSpringDamper(){return this._swingSd}getSwingAxis(){var i=new t.common.Vec3,a=i;return a.x=this.swingAxisX,a.y=this.swingAxisY,a.z=this.swingAxisZ,i}getSwingAxisTo(t){var i=t;i.x=this.swingAxisX,i.y=this.swingAxisY,i.z=this.swingAxisZ}getSwingAngle(){return this._swingAngle}getTwistAngle(){return this._twistAngle}},t.dynamics.constraint.joint.RagdollJointConfig=class extends t.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localTwistAxis1=new t.common.Vec3(1,0,0),this.localTwistAxis2=new t.common.Vec3(1,0,0),this.localSwingAxis1=new t.common.Vec3(0,1,0),this.twistSpringDamper=new t.dynamics.constraint.joint.SpringDamper,this.swingSpringDamper=new t.dynamics.constraint.joint.SpringDamper,this.twistLimitMotor=new t.dynamics.constraint.joint.RotationalLimitMotor,this.maxSwingAngle1=3.14159265358979,this.maxSwingAngle2=3.14159265358979}init(t,i,a,s,o){var n,r,_;this._init(t,i,a);var e,h,l,c=s;n=c.x,r=c.y,_=c.z,e=t._transform._rotation00*n+t._transform._rotation10*r+t._transform._rotation20*_,h=t._transform._rotation01*n+t._transform._rotation11*r+t._transform._rotation21*_,l=t._transform._rotation02*n+t._transform._rotation12*r+t._transform._rotation22*_,n=e,r=h,_=l;var m,v,b,x=this.localTwistAxis1;x.x=n,x.y=r,x.z=_;var p,f,u,y=s;m=y.x,v=y.y,b=y.z,p=i._transform._rotation00*m+i._transform._rotation10*v+i._transform._rotation20*b,f=i._transform._rotation01*m+i._transform._rotation11*v+i._transform._rotation21*b,u=i._transform._rotation02*m+i._transform._rotation12*v+i._transform._rotation22*b,m=p,v=f,b=u;var X,g,z,d=this.localTwistAxis2;d.x=m,d.y=v,d.z=b;var Y,Z,M,I=o;X=I.x,g=I.y,z=I.z,Y=t._transform._rotation00*X+t._transform._rotation10*g+t._transform._rotation20*z,Z=t._transform._rotation01*X+t._transform._rotation11*g+t._transform._rotation21*z,M=t._transform._rotation02*X+t._transform._rotation12*g+t._transform._rotation22*z,X=Y,g=Z,z=M;var V=this.localSwingAxis1;return V.x=X,V.y=g,V.z=z,this}},t.dynamics.constraint.joint.RevoluteJoint=class extends t.dynamics.constraint.joint.Joint{constructor(i){super(i,1);var a=i.localAxis1;this._localBasisX1X=a.x,this._localBasisX1Y=a.y,this._localBasisX1Z=a.z;var s=i.localAxis2;this._localBasisX2X=s.x,this._localBasisX2Y=s.y,this._localBasisX2Z=s.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this._basis=new t.dynamics.constraint.joint.BasisTracker(this),this._sd=i.springDamper.clone(),this._lm=i.limitMotor.clone()}getInfo(t,i,a){var s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y,X,g=this.getErp(i,a),z=this.linearErrorX*g,d=this.linearErrorY*g,Y=this.linearErrorZ*g,Z=this.angularErrorY*g,M=this.angularErrorZ*g;s=-(s=0),o=-(o=-this._relativeAnchor1Z),n=-(n=this._relativeAnchor1Y),r=-(r=this._relativeAnchor1Z),_=-(_=0),e=-(e=-this._relativeAnchor1X),h=-(h=-this._relativeAnchor1Y),l=-(l=this._relativeAnchor1X),c=-(c=0),m=-(m=0),v=-(v=-this._relativeAnchor2Z),b=-(b=this._relativeAnchor2Y),x=-(x=this._relativeAnchor2Z),p=-(p=0),f=-(f=-this._relativeAnchor2X),u=-(u=-this._relativeAnchor2Y),y=-(y=this._relativeAnchor2X),X=-(X=0);var I=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ),V=this._impulses[0],L=t.rows[t.numRows++],w=L.jacobian;w.lin1X=0,w.lin1Y=0,w.lin1Z=0,w.lin2X=0,w.lin2Y=0,w.lin2Z=0,w.ang1X=0,w.ang1Y=0,w.ang1Z=0,w.ang2X=0,w.ang2Y=0,w.ang2Z=0,L.rhs=0,L.cfm=0,L.minImpulse=0,L.maxImpulse=0,L.motorSpeed=0,L.motorMaxImpulse=0,L.impulse=null,L.impulse=V;var k=L;k.rhs=z,k.cfm=0,k.minImpulse=-1/0,k.maxImpulse=1/0;var B=k.jacobian;B.lin1X=1,B.lin1Y=0,B.lin1Z=0,B.lin2X=1,B.lin2Y=0,B.lin2Z=0,B.ang1X=s,B.ang1Y=o,B.ang1Z=n,B.ang2X=m,B.ang2Y=v,B.ang2Z=b;var A=this._impulses[1],P=t.rows[t.numRows++],S=P.jacobian;S.lin1X=0,S.lin1Y=0,S.lin1Z=0,S.lin2X=0,S.lin2Y=0,S.lin2Z=0,S.ang1X=0,S.ang1Y=0,S.ang1Z=0,S.ang2X=0,S.ang2Y=0,S.ang2Z=0,P.rhs=0,P.cfm=0,P.minImpulse=0,P.maxImpulse=0,P.motorSpeed=0,P.motorMaxImpulse=0,P.impulse=null,P.impulse=A,(k=P).rhs=d,k.cfm=0,k.minImpulse=-1/0,k.maxImpulse=1/0,(B=k.jacobian).lin1X=0,B.lin1Y=1,B.lin1Z=0,B.lin2X=0,B.lin2Y=1,B.lin2Z=0,B.ang1X=r,B.ang1Y=_,B.ang1Z=e,B.ang2X=x,B.ang2Y=p,B.ang2Z=f;var T=this._impulses[2],C=t.rows[t.numRows++],j=C.jacobian;if(j.lin1X=0,j.lin1Y=0,j.lin1Z=0,j.lin2X=0,j.lin2Y=0,j.lin2Z=0,j.ang1X=0,j.ang1Y=0,j.ang1Z=0,j.ang2X=0,j.ang2Y=0,j.ang2Z=0,C.rhs=0,C.cfm=0,C.minImpulse=0,C.maxImpulse=0,C.motorSpeed=0,C.motorMaxImpulse=0,C.impulse=null,C.impulse=T,(k=C).rhs=Y,k.cfm=0,k.minImpulse=-1/0,k.maxImpulse=1/0,(B=k.jacobian).lin1X=0,B.lin1Y=0,B.lin1Z=1,B.lin2X=0,B.lin2Y=0,B.lin2Z=1,B.ang1X=h,B.ang1Y=l,B.ang1Z=c,B.ang2X=u,B.ang2Y=y,B.ang2Z=X,this._sd.frequency<=0||!a){var R=this._impulses[3],q=t.rows[t.numRows++],E=q.jacobian;E.lin1X=0,E.lin1Y=0,E.lin1Z=0,E.lin2X=0,E.lin2Y=0,E.lin2Z=0,E.ang1X=0,E.ang1Y=0,E.ang1Z=0,E.ang2X=0,E.ang2Y=0,E.ang2Z=0,q.rhs=0,q.cfm=0,q.minImpulse=0,q.maxImpulse=0,q.motorSpeed=0,q.motorMaxImpulse=0,q.impulse=null,q.impulse=R,k=q,this.setSolverInfoRowAngular(k,this.angle,this._lm,I,this._sd,i,a),(B=k.jacobian).ang1X=this._basis.xX,B.ang1Y=this._basis.xY,B.ang1Z=this._basis.xZ,B.ang2X=this._basis.xX,B.ang2Y=this._basis.xY,B.ang2Z=this._basis.xZ}var D=this._impulses[4],F=t.rows[t.numRows++],N=F.jacobian;N.lin1X=0,N.lin1Y=0,N.lin1Z=0,N.lin2X=0,N.lin2Y=0,N.lin2Z=0,N.ang1X=0,N.ang1Y=0,N.ang1Z=0,N.ang2X=0,N.ang2Y=0,N.ang2Z=0,F.rhs=0,F.cfm=0,F.minImpulse=0,F.maxImpulse=0,F.motorSpeed=0,F.motorMaxImpulse=0,F.impulse=null,F.impulse=D,(k=F).rhs=Z,k.cfm=0,k.minImpulse=-1/0,k.maxImpulse=1/0,(B=k.jacobian).ang1X=this._basis.yX,B.ang1Y=this._basis.yY,B.ang1Z=this._basis.yZ,B.ang2X=this._basis.yX,B.ang2Y=this._basis.yY,B.ang2Z=this._basis.yZ;var W=this._impulses[5],G=t.rows[t.numRows++],J=G.jacobian;J.lin1X=0,J.lin1Y=0,J.lin1Z=0,J.lin2X=0,J.lin2Y=0,J.lin2Z=0,J.ang1X=0,J.ang1Y=0,J.ang1Z=0,J.ang2X=0,J.ang2Y=0,J.ang2Z=0,G.rhs=0,G.cfm=0,G.minImpulse=0,G.maxImpulse=0,G.motorSpeed=0,G.motorMaxImpulse=0,G.impulse=null,G.impulse=W,(k=G).rhs=M,k.cfm=0,k.minImpulse=-1/0,k.maxImpulse=1/0,(B=k.jacobian).ang1X=this._basis.zX,B.ang1Y=this._basis.zY,B.ang1Z=this._basis.zZ,B.ang2X=this._basis.zX,B.ang2Y=this._basis.zY,B.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();var t,i,a,s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y,X,g,z,d,Y,Z,M,I,V,L,w,k,B,A,P,S,T,C,j,R=this._basis,q=R.joint._b1._invMass,E=R.joint._b2._invMass,D=R.joint._basisX1X*R.joint._basisX2X+R.joint._basisX1Y*R.joint._basisX2Y+R.joint._basisX1Z*R.joint._basisX2Z;if(D<-.999999999){var F,N,W,G,J=R.joint._basisX1X,O=R.joint._basisX1Y,H=R.joint._basisX1Z,U=J*J,Q=O*O,K=H*H;U<Q?U<K?(F=0,N=H*(G=1/Math.sqrt(Q+K)),W=-O*G):(F=O*(G=1/Math.sqrt(U+Q)),N=-J*G,W=0):Q<K?(F=-H*(G=1/Math.sqrt(K+U)),N=0,W=J*G):(F=O*(G=1/Math.sqrt(U+Q)),N=-J*G,W=0),t=F,i=N,a=W,s=0}else{var $,tt,it;$=R.joint._basisX1Y*R.joint._basisX2Z-R.joint._basisX1Z*R.joint._basisX2Y,tt=R.joint._basisX1Z*R.joint._basisX2X-R.joint._basisX1X*R.joint._basisX2Z,it=R.joint._basisX1X*R.joint._basisX2Y-R.joint._basisX1Y*R.joint._basisX2X;var at=Math.sqrt(.5*(1+D));t=$*=D=.5/at,i=tt*=D,a=it*=D,s=at}var st=(k=0)*(S=t)+(B=0)*(T=i)+(A=0)*(C=a)+(P=1)*(j=s);if(st<0&&(st=-st,S=-S,T=-T,C=-C,j=-j),st>.999999){var ot=(S=k+(S-k)*(q/(q+E)))*S+(T=B+(T-B)*(q/(q+E)))*T+(C=A+(C-A)*(q/(q+E)))*C+(j=P+(j-P)*(q/(q+E)))*j;ot>1e-32&&(ot=1/Math.sqrt(ot)),o=S*ot,n=T*ot,r=C*ot,_=j*ot}else{var nt=q/(q+E)*Math.acos(st),rt=(S+=k*-st)*S+(T+=B*-st)*T+(C+=A*-st)*C+(j+=P*-st)*j;rt>1e-32&&(rt=1/Math.sqrt(rt)),S*=rt,T*=rt,C*=rt,j*=rt;var _t=Math.sin(nt),et=Math.cos(nt);o=(k*=et)+S*_t,n=(B*=et)+T*_t,r=(A*=et)+C*_t,_=(P*=et)+j*_t}var ht=2*o,lt=2*n,ct=2*r,mt=o*ht,vt=n*lt,bt=r*ct,xt=o*lt,pt=n*ct,ft=o*ct,ut=_*ht,yt=_*lt,Xt=_*ct;e=xt-Xt,h=ft+yt,l=xt+Xt,c=1-mt-bt,m=pt-ut,v=ft-yt,b=pt+ut,x=1-mt-vt,p=(1-vt-bt)*R.joint._basisX1X+e*R.joint._basisX1Y+h*R.joint._basisX1Z,f=l*R.joint._basisX1X+c*R.joint._basisX1Y+m*R.joint._basisX1Z,u=v*R.joint._basisX1X+b*R.joint._basisX1Y+x*R.joint._basisX1Z,Z=R.xX,M=R.xY,I=R.xZ,V=R.yX,L=R.yY,w=R.yZ;var gt=Z*p+M*f+I*u;if(gt<-.999999999){var zt,dt,Yt,Zt,Mt=Z,It=M,Vt=I,Lt=Mt*Mt,wt=It*It,kt=Vt*Vt;Lt<wt?Lt<kt?(zt=0,dt=Vt*(Zt=1/Math.sqrt(wt+kt)),Yt=-It*Zt):(zt=It*(Zt=1/Math.sqrt(Lt+wt)),dt=-Mt*Zt,Yt=0):wt<kt?(zt=-Vt*(Zt=1/Math.sqrt(kt+Lt)),dt=0,Yt=Mt*Zt):(zt=It*(Zt=1/Math.sqrt(Lt+wt)),dt=-Mt*Zt,Yt=0),o=zt,n=dt,r=Yt,_=0}else{var Bt,At,Pt;Bt=M*u-I*f,At=I*p-Z*u,Pt=Z*f-M*p;var St=Math.sqrt(.5*(1+gt));o=Bt*=gt=.5/St,n=At*=gt,r=Pt*=gt,_=St}var Tt,Ct,jt,Rt=2*o,qt=2*n,Et=2*r,Dt=o*Rt,Ft=n*qt,Nt=r*Et,Wt=o*qt,Gt=n*Et,Jt=o*Et,Ot=_*Rt,Ht=_*qt,Ut=_*Et;if((z=f*(g=(v=Jt-Ht)*V+(b=Gt+Ot)*L+(x=1-Dt-Ft)*w)-u*(X=(l=Wt+Ut)*V+(c=1-Dt-Nt)*L+(m=Gt-Ot)*w))*z+(d=u*(y=(1-Ft-Nt)*V+(e=Wt-Ut)*L+(h=Jt+Ht)*w)-p*g)*d+(Y=p*X-f*y)*Y>1e-6){var Qt=z*z+d*d+Y*Y;Qt>0&&(Qt=1/Math.sqrt(Qt)),z*=Qt,d*=Qt,Y*=Qt}else{var Kt,$t=p,ti=f,ii=u,ai=$t*$t,si=ti*ti,oi=ii*ii;ai<si?ai<oi?(z=0,d=ii*(Kt=1/Math.sqrt(si+oi)),Y=-ti*Kt):(z=ti*(Kt=1/Math.sqrt(ai+si)),d=-$t*Kt,Y=0):si<oi?(z=-ii*(Kt=1/Math.sqrt(oi+ai)),d=0,Y=$t*Kt):(z=ti*(Kt=1/Math.sqrt(ai+si)),d=-$t*Kt,Y=0)}y=d*u-Y*f,X=Y*p-z*u,g=z*f-d*p,R.xX=p,R.xY=f,R.xZ=u,R.yX=y,R.yY=X,R.yZ=g,R.zX=z,R.zY=d,R.zZ=Y,Tt=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,Ct=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,jt=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;var ni,ri,_i,ei=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,hi=ei<=-1?3.14159265358979:ei>=1?0:Math.acos(ei),li=Tt*Tt+Ct*Ct+jt*jt;li>0&&(li=1/Math.sqrt(li)),Tt*=li,Ct*=li,jt*=li,Tt*=hi,Ct*=hi,jt*=hi,this.angularErrorY=Tt*this._basis.yX+Ct*this._basis.yY+jt*this._basis.yZ,this.angularErrorZ=Tt*this._basis.zX+Ct*this._basis.zY+jt*this._basis.zZ,ni=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,ri=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,_i=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,ei=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=ei<=-1?3.14159265358979:ei>=1?0:Math.acos(ei),ni*this._basis.xX+ri*this._basis.xY+_i*this._basis.xZ<0&&(this.angle=-this.angle),this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){var i=new t.common.Vec3,a=i;return a.x=this._basisX1X,a.y=this._basisX1Y,a.z=this._basisX1Z,i}getAxis2(){var i=new t.common.Vec3,a=i;return a.x=this._basisX2X,a.y=this._basisX2Y,a.z=this._basisX2Z,i}getAxis1To(t){var i=t;i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z}getAxis2To(t){var i=t;i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z}getLocalAxis1(){var i=new t.common.Vec3,a=i;return a.x=this._localBasisX1X,a.y=this._localBasisX1Y,a.z=this._localBasisX1Z,i}getLocalAxis2(){var i=new t.common.Vec3,a=i;return a.x=this._localBasisX2X,a.y=this._localBasisX2Y,a.z=this._localBasisX2Z,i}getLocalAxis1To(t){var i=t;i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z}getLocalAxis2To(t){var i=t;i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getAngle(){return this.angle}},t.dynamics.constraint.joint.RevoluteJointConfig=class extends t.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new t.common.Vec3(1,0,0),this.localAxis2=new t.common.Vec3(1,0,0),this.springDamper=new t.dynamics.constraint.joint.SpringDamper,this.limitMotor=new t.dynamics.constraint.joint.RotationalLimitMotor}init(t,i,a,s){var o,n,r;this._init(t,i,a);var _,e,h,l=s;o=l.x,n=l.y,r=l.z,_=t._transform._rotation00*o+t._transform._rotation10*n+t._transform._rotation20*r,e=t._transform._rotation01*o+t._transform._rotation11*n+t._transform._rotation21*r,h=t._transform._rotation02*o+t._transform._rotation12*n+t._transform._rotation22*r,o=_,n=e,r=h;var c,m,v,b=this.localAxis1;b.x=o,b.y=n,b.z=r;var x,p,f,u=s;c=u.x,m=u.y,v=u.z,x=i._transform._rotation00*c+i._transform._rotation10*m+i._transform._rotation20*v,p=i._transform._rotation01*c+i._transform._rotation11*m+i._transform._rotation21*v,f=i._transform._rotation02*c+i._transform._rotation12*m+i._transform._rotation22*v,c=x,m=p,v=f;var y=this.localAxis2;return y.x=c,y.y=m,y.z=v,this}},t.dynamics.constraint.joint.RotationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorTorque=0}setLimits(t,i){return this.lowerLimit=t,this.upperLimit=i,this}setMotor(t,i){return this.motorSpeed=t,this.motorTorque=i,this}clone(){var i=new t.dynamics.constraint.joint.RotationalLimitMotor;return i.lowerLimit=this.lowerLimit,i.upperLimit=this.upperLimit,i.motorSpeed=this.motorSpeed,i.motorTorque=this.motorTorque,i}},t.dynamics.constraint.joint.SphericalJoint=class extends t.dynamics.constraint.joint.Joint{constructor(t){super(t,0),this._sd=t.springDamper.clone()}getInfo(i,a,s){if(!(this._sd.frequency>0&&s)){var o,n,r,_,e;if(o=this._anchor2X-this._anchor1X,n=this._anchor2Y-this._anchor1Y,r=this._anchor2Z-this._anchor1Z,this._sd.frequency>0){var h=6.28318530717958*this._sd.frequency,l=this._sd.dampingRatio;l<t.common.Setting.minSpringDamperDampingRatio&&(l=t.common.Setting.minSpringDamperDampingRatio);var c=a.dt,m=2*l*h,v=h*h;this._sd.useSymplecticEuler?(_=1/(c*m),e=v/m):(_=1/(c*(c*v+m)),e=v/(c*v+m)),_*=this._b1._invMass+this._b2._invMass}else _=0,e=this.getErp(a,s);var b,x,p,f,u,y,X,g,z,d,Y,Z,M,I,V,L,w,k,B=o*e,A=n*e,P=r*e;b=-(b=0),x=-(x=-this._relativeAnchor1Z),p=-(p=this._relativeAnchor1Y),f=-(f=this._relativeAnchor1Z),u=-(u=0),y=-(y=-this._relativeAnchor1X),X=-(X=-this._relativeAnchor1Y),g=-(g=this._relativeAnchor1X),z=-(z=0),d=-(d=0),Y=-(Y=-this._relativeAnchor2Z),Z=-(Z=this._relativeAnchor2Y),M=-(M=this._relativeAnchor2Z),I=-(I=0),V=-(V=-this._relativeAnchor2X),L=-(L=-this._relativeAnchor2Y),w=-(w=this._relativeAnchor2X),k=-(k=0);var S=this._impulses[0],T=i.rows[i.numRows++],C=T.jacobian;C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,T.rhs=0,T.cfm=0,T.minImpulse=0,T.maxImpulse=0,T.motorSpeed=0,T.motorMaxImpulse=0,T.impulse=null,T.impulse=S;var j=T;j.rhs=B,j.cfm=_,j.minImpulse=-1/0,j.maxImpulse=1/0;var R=j.jacobian;R.lin1X=1,R.lin1Y=0,R.lin1Z=0,R.lin2X=1,R.lin2Y=0,R.lin2Z=0,R.ang1X=b,R.ang1Y=x,R.ang1Z=p,R.ang2X=d,R.ang2Y=Y,R.ang2Z=Z;var q=this._impulses[1],E=i.rows[i.numRows++],D=E.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,E.rhs=0,E.cfm=0,E.minImpulse=0,E.maxImpulse=0,E.motorSpeed=0,E.motorMaxImpulse=0,E.impulse=null,E.impulse=q,(j=E).rhs=A,j.cfm=_,j.minImpulse=-1/0,j.maxImpulse=1/0,(R=j.jacobian).lin1X=0,R.lin1Y=1,R.lin1Z=0,R.lin2X=0,R.lin2Y=1,R.lin2Z=0,R.ang1X=f,R.ang1Y=u,R.ang1Z=y,R.ang2X=M,R.ang2Y=I,R.ang2Z=V;var F=this._impulses[2],N=i.rows[i.numRows++],W=N.jacobian;W.lin1X=0,W.lin1Y=0,W.lin1Z=0,W.lin2X=0,W.lin2Y=0,W.lin2Z=0,W.ang1X=0,W.ang1Y=0,W.ang1Z=0,W.ang2X=0,W.ang2Y=0,W.ang2Z=0,N.rhs=0,N.cfm=0,N.minImpulse=0,N.maxImpulse=0,N.motorSpeed=0,N.motorMaxImpulse=0,N.impulse=null,N.impulse=F,(j=N).rhs=P,j.cfm=_,j.minImpulse=-1/0,j.maxImpulse=1/0,(R=j.jacobian).lin1X=0,R.lin1Y=0,R.lin1Z=1,R.lin2X=0,R.lin2Y=0,R.lin2Z=1,R.ang1X=X,R.ang1Y=g,R.ang1Z=z,R.ang2X=L,R.ang2Y=w,R.ang2Z=k}}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getSpringDamper(){return this._sd}},t.dynamics.constraint.joint.SphericalJointConfig=class extends t.dynamics.constraint.joint.JointConfig{constructor(){super(),this.springDamper=new t.dynamics.constraint.joint.SpringDamper}init(t,i,a){return this._init(t,i,a),this}},t.dynamics.constraint.joint.SpringDamper=class{constructor(){this.frequency=0,this.dampingRatio=0,this.useSymplecticEuler=!1}setSpring(t,i){return this.frequency=t,this.dampingRatio=i,this}setSymplecticEuler(t){return this.useSymplecticEuler=t,this}clone(){var i=new t.dynamics.constraint.joint.SpringDamper;return i.frequency=this.frequency,i.dampingRatio=this.dampingRatio,i.useSymplecticEuler=this.useSymplecticEuler,i}},t.dynamics.constraint.joint.TranslationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorForce=0}setLimits(t,i){return this.lowerLimit=t,this.upperLimit=i,this}setMotor(t,i){return this.motorSpeed=t,this.motorForce=i,this}clone(){var i=new t.dynamics.constraint.joint.TranslationalLimitMotor;return i.lowerLimit=this.lowerLimit,i.upperLimit=this.upperLimit,i.motorSpeed=this.motorSpeed,i.motorForce=this.motorForce,i}},t.dynamics.constraint.joint.UniversalJoint=class extends t.dynamics.constraint.joint.Joint{constructor(i){super(i,t.dynamics.constraint.joint.JointType.UNIVERSAL);var a=i.localAxis1;this._localBasisX1X=a.x,this._localBasisX1Y=a.y,this._localBasisX1Z=a.z;var s=i.localAxis2;this._localBasisZ2X=s.x,this._localBasisZ2Y=s.y,this._localBasisZ2Z=s.z,this.buildLocalBasesFromX1Z2(),this._angleX=0,this._angleY=0,this._angleZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._sd1=i.springDamper1.clone(),this._sd2=i.springDamper2.clone(),this._lm1=i.limitMotor1.clone(),this._lm2=i.limitMotor2.clone()}getInfo(t,i,a){var s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y,X,g=this.getErp(i,a),z=this.linearErrorX*g,d=this.linearErrorY*g,Y=this.linearErrorZ*g,Z=this._angleY*g;s=-(s=0),o=-(o=-this._relativeAnchor1Z),n=-(n=this._relativeAnchor1Y),r=-(r=this._relativeAnchor1Z),_=-(_=0),e=-(e=-this._relativeAnchor1X),h=-(h=-this._relativeAnchor1Y),l=-(l=this._relativeAnchor1X),c=-(c=0),m=-(m=0),v=-(v=-this._relativeAnchor2Z),b=-(b=this._relativeAnchor2Y),x=-(x=this._relativeAnchor2Z),p=-(p=0),f=-(f=-this._relativeAnchor2X),u=-(u=-this._relativeAnchor2Y),y=-(y=this._relativeAnchor2X),X=-(X=0);var M=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),I=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ),V=this._impulses[0],L=t.rows[t.numRows++],w=L.jacobian;w.lin1X=0,w.lin1Y=0,w.lin1Z=0,w.lin2X=0,w.lin2Y=0,w.lin2Z=0,w.ang1X=0,w.ang1Y=0,w.ang1Z=0,w.ang2X=0,w.ang2Y=0,w.ang2Z=0,L.rhs=0,L.cfm=0,L.minImpulse=0,L.maxImpulse=0,L.motorSpeed=0,L.motorMaxImpulse=0,L.impulse=null,L.impulse=V;var k=L;k.rhs=z,k.cfm=0,k.minImpulse=-1/0,k.maxImpulse=1/0;var B=k.jacobian;B.lin1X=1,B.lin1Y=0,B.lin1Z=0,B.lin2X=1,B.lin2Y=0,B.lin2Z=0,B.ang1X=s,B.ang1Y=o,B.ang1Z=n,B.ang2X=m,B.ang2Y=v,B.ang2Z=b;var A=this._impulses[1],P=t.rows[t.numRows++],S=P.jacobian;S.lin1X=0,S.lin1Y=0,S.lin1Z=0,S.lin2X=0,S.lin2Y=0,S.lin2Z=0,S.ang1X=0,S.ang1Y=0,S.ang1Z=0,S.ang2X=0,S.ang2Y=0,S.ang2Z=0,P.rhs=0,P.cfm=0,P.minImpulse=0,P.maxImpulse=0,P.motorSpeed=0,P.motorMaxImpulse=0,P.impulse=null,P.impulse=A,(k=P).rhs=d,k.cfm=0,k.minImpulse=-1/0,k.maxImpulse=1/0,(B=k.jacobian).lin1X=0,B.lin1Y=1,B.lin1Z=0,B.lin2X=0,B.lin2Y=1,B.lin2Z=0,B.ang1X=r,B.ang1Y=_,B.ang1Z=e,B.ang2X=x,B.ang2Y=p,B.ang2Z=f;var T=this._impulses[2],C=t.rows[t.numRows++],j=C.jacobian;if(j.lin1X=0,j.lin1Y=0,j.lin1Z=0,j.lin2X=0,j.lin2Y=0,j.lin2Z=0,j.ang1X=0,j.ang1Y=0,j.ang1Z=0,j.ang2X=0,j.ang2Y=0,j.ang2Z=0,C.rhs=0,C.cfm=0,C.minImpulse=0,C.maxImpulse=0,C.motorSpeed=0,C.motorMaxImpulse=0,C.impulse=null,C.impulse=T,(k=C).rhs=Y,k.cfm=0,k.minImpulse=-1/0,k.maxImpulse=1/0,(B=k.jacobian).lin1X=0,B.lin1Y=0,B.lin1Z=1,B.lin2X=0,B.lin2Y=0,B.lin2Z=1,B.ang1X=h,B.ang1Y=l,B.ang1Z=c,B.ang2X=u,B.ang2Y=y,B.ang2Z=X,!this.xSingular&&(this._sd1.frequency<=0||!a)){var R=this._impulses[3],q=t.rows[t.numRows++],E=q.jacobian;E.lin1X=0,E.lin1Y=0,E.lin1Z=0,E.lin2X=0,E.lin2Y=0,E.lin2Z=0,E.ang1X=0,E.ang1Y=0,E.ang1Z=0,E.ang2X=0,E.ang2Y=0,E.ang2Z=0,q.rhs=0,q.cfm=0,q.minImpulse=0,q.maxImpulse=0,q.motorSpeed=0,q.motorMaxImpulse=0,q.impulse=null,q.impulse=R,k=q,this.setSolverInfoRowAngular(k,this._angleX,this._lm1,M,this._sd1,i,a),(B=k.jacobian).ang1X=this._axisXX,B.ang1Y=this._axisXY,B.ang1Z=this._axisXZ,B.ang2X=this._axisXX,B.ang2Y=this._axisXY,B.ang2Z=this._axisXZ}if(!this.ySingular){var D=this._impulses[4],F=t.rows[t.numRows++],N=F.jacobian;N.lin1X=0,N.lin1Y=0,N.lin1Z=0,N.lin2X=0,N.lin2Y=0,N.lin2Z=0,N.ang1X=0,N.ang1Y=0,N.ang1Z=0,N.ang2X=0,N.ang2Y=0,N.ang2Z=0,F.rhs=0,F.cfm=0,F.minImpulse=0,F.maxImpulse=0,F.motorSpeed=0,F.motorMaxImpulse=0,F.impulse=null,F.impulse=D,(k=F).rhs=Z,k.cfm=0,k.minImpulse=-1/0,k.maxImpulse=1/0,(B=k.jacobian).ang1X=this._axisYX,B.ang1Y=this._axisYY,B.ang1Z=this._axisYZ,B.ang2X=this._axisYX,B.ang2Y=this._axisYY,B.ang2Z=this._axisYZ}if(!this.zSingular&&(this._sd2.frequency<=0||!a)){var W=this._impulses[5],G=t.rows[t.numRows++],J=G.jacobian;J.lin1X=0,J.lin1Y=0,J.lin1Z=0,J.lin2X=0,J.lin2Y=0,J.lin2Z=0,J.ang1X=0,J.ang1Y=0,J.ang1Z=0,J.ang2X=0,J.ang2Y=0,J.ang2Z=0,G.rhs=0,G.cfm=0,G.minImpulse=0,G.maxImpulse=0,G.motorSpeed=0,G.motorMaxImpulse=0,G.impulse=null,G.impulse=W,k=G,this.setSolverInfoRowAngular(k,this._angleZ,this._lm2,I,this._sd2,i,a),(B=k.jacobian).ang1X=this._axisZX,B.ang1Y=this._axisZY,B.ang1Z=this._axisZZ,B.ang2X=this._axisZX,B.ang2Y=this._axisZY,B.ang2Z=this._axisZZ}}_syncAnchors(){var t,i,a,s,o,n,r,_,e;super._syncAnchors(),this._basisX1X,this._basisY1X,this._basisZ1X,this._basisX1Y,this._basisY1Y,this._basisZ1Y,this._basisX1Z,this._basisY1Z,this._basisZ1Z,this._basisX2X,this._basisY2X,this._basisZ2X,this._basisX2Y,this._basisY2Y,this._basisZ2Y,this._basisX2Z,this._basisY2Z,this._basisZ2Z,t=this._basisX1X,i=this._basisX1Y,a=this._basisX1Z,r=this._basisZ2X,s=(_=this._basisZ2Y)*a-(e=this._basisZ2Z)*i,o=e*t-r*a,n=r*i-_*t,this._axisXX=o*e-n*_,this._axisXY=n*r-s*e,this._axisXZ=s*_-o*r,this._axisYX=s,this._axisYY=o,this._axisYZ=n,this._axisZX=i*n-a*o,this._axisZY=a*s-t*n,this._axisZZ=t*o-i*s;var h=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;h>0&&(h=1/Math.sqrt(h)),this._axisXX*=h,this._axisXY*=h,this._axisXZ*=h;var l=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;l>0&&(l=1/Math.sqrt(l)),this._axisYX*=l,this._axisYY*=l,this._axisYZ*=l;var c,m,v,b,x,p,f,u,y,X,g,z,d,Y,Z,M,I,V,L,w,k,B,A,P,S,T,C=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;C>0&&(C=1/Math.sqrt(C)),this._axisZX*=C,this._axisZY*=C,this._axisZZ*=C,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0,c=this._basisX1X,m=this._basisY1X,v=this._basisZ1X,b=this._basisX1Y,x=this._basisY1Y,p=this._basisZ1Y,f=this._basisX1Z,u=this._basisY1Z,y=this._basisZ1Z,X=this._basisX2X,g=this._basisY2X,z=this._basisZ2X,d=this._basisX2Y,Y=this._basisY2Y,Z=this._basisZ2Y,V=c*X+b*d+f*this._basisX2Z,L=c*g+b*Y+f*(M=this._basisY2Z),w=m*g+x*Y+u*M,k=m*z+x*Z+u*(I=this._basisZ2Z),B=v*g+p*Y+y*M,A=v*z+p*Z+y*I;var j=c*z+b*Z+f*I;if(j<=-1){var R=Math.atan2(B,w);P=.5*R,S=-1.570796326794895,T=.5*-R}else if(j>=1){var q=Math.atan2(B,w);P=.5*q,S=1.570796326794895,T=.5*q}else{var E=Math.asin(j);P=Math.atan2(-k,A),S=E,T=Math.atan2(-L,V)}this._angleX=P,this._angleY=S,this._angleZ=T,this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){var i=new t.common.Vec3,a=i;return a.x=this._basisX1X,a.y=this._basisX1Y,a.z=this._basisX1Z,i}getAxis2(){var i=new t.common.Vec3,a=i;return a.x=this._basisZ2X,a.y=this._basisZ2Y,a.z=this._basisZ2Z,i}getAxis1To(t){var i=t;i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z}getAxis2To(t){var i=t;i.x=this._basisZ2X,i.y=this._basisZ2Y,i.z=this._basisZ2Z}getLocalAxis1(){var i=new t.common.Vec3,a=i;return a.x=this._localBasisX1X,a.y=this._localBasisX1Y,a.z=this._localBasisX1Z,i}getLocalAxis2(){var i=new t.common.Vec3,a=i;return a.x=this._localBasisZ2X,a.y=this._localBasisZ2Y,a.z=this._localBasisZ2Z,i}getLocalAxis1To(t){var i=t;i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z}getLocalAxis2To(t){var i=t;i.x=this._localBasisZ2X,i.y=this._localBasisZ2Y,i.z=this._localBasisZ2Z}getSpringDamper1(){return this._sd1}getSpringDamper2(){return this._sd2}getLimitMotor1(){return this._lm1}getLimitMotor2(){return this._lm2}getAngle1(){return this._angleX}getAngle2(){return this._angleZ}},t.dynamics.constraint.joint.UniversalJointConfig=class extends t.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new t.common.Vec3(1,0,0),this.localAxis2=new t.common.Vec3(1,0,0),this.springDamper1=new t.dynamics.constraint.joint.SpringDamper,this.springDamper2=new t.dynamics.constraint.joint.SpringDamper,this.limitMotor1=new t.dynamics.constraint.joint.RotationalLimitMotor,this.limitMotor2=new t.dynamics.constraint.joint.RotationalLimitMotor}init(t,i,a,s,o){var n,r,_;this._init(t,i,a);var e,h,l,c=s;n=c.x,r=c.y,_=c.z,e=t._transform._rotation00*n+t._transform._rotation10*r+t._transform._rotation20*_,h=t._transform._rotation01*n+t._transform._rotation11*r+t._transform._rotation21*_,l=t._transform._rotation02*n+t._transform._rotation12*r+t._transform._rotation22*_,n=e,r=h,_=l;var m,v,b,x=this.localAxis1;x.x=n,x.y=r,x.z=_;var p,f,u,y=o;m=y.x,v=y.y,b=y.z,p=i._transform._rotation00*m+i._transform._rotation10*v+i._transform._rotation20*b,f=i._transform._rotation01*m+i._transform._rotation11*v+i._transform._rotation21*b,u=i._transform._rotation02*m+i._transform._rotation12*v+i._transform._rotation22*b,m=p,v=f,b=u;var X=this.localAxis2;return X.x=m,X.y=v,X.z=b,this}},t.dynamics.constraint.solver||(t.dynamics.constraint.solver={}),t.dynamics.constraint.solver.ConstraintSolverType=class{},t.dynamics.constraint.solver.common||(t.dynamics.constraint.solver.common={}),t.dynamics.constraint.solver.common.ContactSolverMassDataRow=class{constructor(){this.invMLinN1X=0,this.invMLinN1Y=0,this.invMLinN1Z=0,this.invMLinN2X=0,this.invMLinN2Y=0,this.invMLinN2Z=0,this.invMAngN1X=0,this.invMAngN1Y=0,this.invMAngN1Z=0,this.invMAngN2X=0,this.invMAngN2Y=0,this.invMAngN2Z=0,this.invMLinT1X=0,this.invMLinT1Y=0,this.invMLinT1Z=0,this.invMLinT2X=0,this.invMLinT2Y=0,this.invMLinT2Z=0,this.invMAngT1X=0,this.invMAngT1Y=0,this.invMAngT1Z=0,this.invMAngT2X=0,this.invMAngT2Y=0,this.invMAngT2Z=0,this.invMLinB1X=0,this.invMLinB1Y=0,this.invMLinB1Z=0,this.invMLinB2X=0,this.invMLinB2Y=0,this.invMLinB2Z=0,this.invMAngB1X=0,this.invMAngB1Y=0,this.invMAngB1Z=0,this.invMAngB2X=0,this.invMAngB2Y=0,this.invMAngB2Z=0,this.massN=0,this.massTB00=0,this.massTB01=0,this.massTB10=0,this.massTB11=0}},t.dynamics.constraint.solver.common.JointSolverMassDataRow=class{constructor(){this.invMLin1X=0,this.invMLin1Y=0,this.invMLin1Z=0,this.invMLin2X=0,this.invMLin2Y=0,this.invMLin2Z=0,this.invMAng1X=0,this.invMAng1Y=0,this.invMAng1Z=0,this.invMAng2X=0,this.invMAng2Y=0,this.invMAng2Z=0,this.mass=0,this.massWithoutCfm=0}},t.dynamics.constraint.solver.direct||(t.dynamics.constraint.solver.direct={}),t.dynamics.constraint.solver.direct.Boundary=class{constructor(t){var i=new Array(t);this.iBounded=i;var a=new Array(t);this.iUnbounded=a;var s=new Array(t);this.signs=s;var o=new Array(t);this.b=o,this.numBounded=0,this.numUnbounded=0,this.matrixId=0}init(t){this.numBounded=t.numBounded;for(var i=0,a=this.numBounded;i<a;){var s=i++;this.iBounded[s]=t.iBounded[s],this.signs[s]=t.signs[s]}this.numUnbounded=t.numUnbounded,this.matrixId=0;for(var o=0,n=this.numUnbounded;o<n;){var r=o++,_=t.iUnbounded[r];this.iUnbounded[r]=_,this.matrixId|=1<<_}}computeImpulses(i,a,s,o,n,r,_){for(var e=0,h=this.numUnbounded;e<h;){var l=e++,c=this.iUnbounded[l],m=i.rows[c],v=s[c];this.b[c]=m.rhs*r-v-m.cfm*o[c]}for(var b=a._invMassWithoutCfm,x=0,p=this.numBounded;x<p;){var f=x++,u=this.iBounded[f],y=this.signs[f],X=i.rows[u],g=o[u],z=(y<0?X.minImpulse:y>0?X.maxImpulse:0)-g;if(n[u]=z,0!=z)for(var d=0,Y=this.numUnbounded;d<Y;){var Z=d++,M=this.iUnbounded[Z],I=b[u][M]*z,V=M,L=this.b;L[V]=L[V]-I}}for(var w,k=this.iUnbounded,B=this.numUnbounded,A=0,P=0,S=B;P<S;){A|=1<<k[P++]}a._cacheComputed[A]||(a.computeSubmatrix(A,k,B),a._cacheComputed[A]=!0),w=a._cachedSubmatrices[A];for(var T=!0,C=0,j=this.numUnbounded;C<j;){for(var R=C++,q=this.iUnbounded[R],E=i.rows[q],D=o[q],F=D,N=0,W=this.numUnbounded;N<W;){var G=N++,J=this.iUnbounded[G];F+=this.b[J]*w[R][G]}if(F<E.minImpulse-t.common.Setting.directMlcpSolverEps||F>E.maxImpulse+t.common.Setting.directMlcpSolverEps){T=!1;break}n[q]=F-D}if(_)return!0;if(!T)return!1;for(var O=0,H=this.numBounded;O<H;){for(var U,Q=O++,K=this.iBounded[Q],$=i.rows[K],tt=this.signs[Q],it=o[K]+n[K],at=s[K],st=0,ot=i.numRows;st<ot;){var nt=st++;at+=b[K][nt]*n[nt]}if(U=$.rhs*r-at-$.cfm*it,tt<0&&U>t.common.Setting.directMlcpSolverEps||tt>0&&U<-t.common.Setting.directMlcpSolverEps){T=!1;break}}return T}},t.dynamics.constraint.solver.direct.BoundaryBuildInfo=class{constructor(t){this.size=t,this.numBounded=0;var i=new Array(t);this.iBounded=i;var a=new Array(t);this.signs=a,this.numUnbounded=0;var s=new Array(t);this.iUnbounded=s}},t.dynamics.constraint.solver.direct.BoundaryBuilder=class{constructor(i){this.maxRows=i,this.numBoundaries=0;var a=new Array(1<<i);this.boundaries=a,this.bbInfo=new t.dynamics.constraint.solver.direct.BoundaryBuildInfo(i)}buildBoundariesRecursive(i,a){if(a==i.numRows)return null==this.boundaries[this.numBoundaries]&&(this.boundaries[this.numBoundaries]=new t.dynamics.constraint.solver.direct.Boundary(this.maxRows)),void this.boundaries[this.numBoundaries++].init(this.bbInfo);var s=i.rows[a],o=s.minImpulse>-1/0,n=s.maxImpulse<1/0;if(0==s.minImpulse&&0==s.maxImpulse){var r=this.bbInfo;return r.iBounded[r.numBounded]=a,r.signs[r.numBounded]=0,r.numBounded++,this.buildBoundariesRecursive(i,a+1),void this.bbInfo.numBounded--}var _=this.bbInfo;if(_.iUnbounded[_.numUnbounded]=a,_.numUnbounded++,this.buildBoundariesRecursive(i,a+1),this.bbInfo.numUnbounded--,o){var e=this.bbInfo;e.iBounded[e.numBounded]=a,e.signs[e.numBounded]=-1,e.numBounded++,this.buildBoundariesRecursive(i,a+1),this.bbInfo.numBounded--}if(n){var h=this.bbInfo;h.iBounded[h.numBounded]=a,h.signs[h.numBounded]=1,h.numBounded++,this.buildBoundariesRecursive(i,a+1),this.bbInfo.numBounded--}}buildBoundaries(t){this.numBoundaries=0;var i=this.bbInfo;i.numBounded=0,i.numUnbounded=0,this.buildBoundariesRecursive(t,0)}},t.dynamics.constraint.solver.direct.BoundarySelector=class{constructor(t){this.n=t;var i=new Array(t);this.indices=i;var a=new Array(t);this.tmpIndices=a;for(var s=0,o=t;s<o;){var n=s++;this.indices[n]=n}}getIndex(t){return this.indices[t]}select(t){for(var i=0;this.indices[i]!=t;)++i;for(;i>0;){var a=this.indices[i];this.indices[i]=this.indices[i-1],this.indices[i-1]=a,--i}}setSize(t){for(var i=0,a=0,s=0,o=this.n;s<o;){var n=s++,r=this.indices[n];r<t?(this.tmpIndices[i]=r,++i):(this.tmpIndices[t+a]=r,++a)}var _=this.indices;this.indices=this.tmpIndices,this.tmpIndices=_}},t.dynamics.constraint.solver.direct.DirectJointConstraintSolver=class extends t.dynamics.constraint.ConstraintSolver{constructor(i){super(),this.joint=i,this.info=new t.dynamics.constraint.info.joint.JointSolverInfo;var a=t.common.Setting.maxJacobianRows;this.massMatrix=new t.dynamics.constraint.solver.direct.MassMatrix(a),this.boundaryBuilder=new t.dynamics.constraint.solver.direct.BoundaryBuilder(a);var s=new Array(a);this.massData=s;for(var o=0,n=this.massData.length;o<n;){var r=o++;this.massData[r]=new t.dynamics.constraint.solver.common.JointSolverMassDataRow}var _=this.boundaryBuilder.boundaries.length;this.velBoundarySelector=new t.dynamics.constraint.solver.direct.BoundarySelector(_),this.posBoundarySelector=new t.dynamics.constraint.solver.direct.BoundarySelector(_);var e=new Array(a);this.relVels=e;var h=new Array(a);this.impulses=h;var l=new Array(a);this.dImpulses=l;var c=new Array(a);this.dTotalImpulses=c;for(var m=0,v=a;m<v;){var b=m++;this.relVels[b]=0,this.impulses[b]=0,this.dImpulses[b]=0,this.dTotalImpulses[b]=0}}preSolveVelocity(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var i=this.boundaryBuilder;i.numBoundaries=0;var a=i.bbInfo;a.numBounded=0,a.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);for(var s=this.velBoundarySelector,o=this.boundaryBuilder.numBoundaries,n=0,r=0,_=0,e=s.n;_<e;){var h=_++,l=s.indices[h];l<o?(s.tmpIndices[n]=l,++n):(s.tmpIndices[o+r]=l,++r)}var c=s.indices;s.indices=s.tmpIndices,s.tmpIndices=c}warmStart(i){var a=this.joint._positionCorrectionAlgorithm==t.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?t.common.Setting.jointWarmStartingFactorForBaungarte:t.common.Setting.jointWarmStartingFactor;if((a*=i.dtRatio)<=0)for(var s=0,o=this.info.numRows;s<o;){var n=s++,r=this.info.rows[n].impulse;r.impulse=0,r.impulseM=0,r.impulseP=0}else{for(var _=0,e=this.info.numRows;_<e;){var h=_++,l=this.info.rows[h],c=l.impulse,m=c.impulse*a;if(m<l.minImpulse?m=l.minImpulse:m>l.maxImpulse&&(m=l.maxImpulse),c.impulse=m,l.motorMaxImpulse>0){var v=c.impulseM*a,b=l.motorMaxImpulse;v<-b?v=-b:v>b&&(v=b),c.impulseM=v}else c.impulseM=0;this.dImpulses[h]=c.impulse+c.impulseM}var x,p,f,u,y,X,g,z,d,Y,Z,M,I=this.dImpulses,V=!1,L=!1;x=this._b1._velX,p=this._b1._velY,f=this._b1._velZ,u=this._b2._velX,y=this._b2._velY,X=this._b2._velZ,g=this._b1._angVelX,z=this._b1._angVelY,d=this._b1._angVelZ,Y=this._b2._angVelX,Z=this._b2._angVelY,M=this._b2._angVelZ;for(var w=0,k=this.info.numRows;w<k;){var B=w++,A=this.info.rows[B].jacobian,P=this.massData[B],S=I[B];0!=(1&A.flag)&&(x+=P.invMLin1X*S,p+=P.invMLin1Y*S,f+=P.invMLin1Z*S,u+=P.invMLin2X*-S,y+=P.invMLin2Y*-S,X+=P.invMLin2Z*-S,V=!0),0!=(2&A.flag)&&(g+=P.invMAng1X*S,z+=P.invMAng1Y*S,d+=P.invMAng1Z*S,Y+=P.invMAng2X*-S,Z+=P.invMAng2Y*-S,M+=P.invMAng2Z*-S,L=!0)}V&&(this._b1._velX=x,this._b1._velY=p,this._b1._velZ=f,this._b2._velX=u,this._b2._velY=y,this._b2._velZ=X),L&&(this._b1._angVelX=g,this._b1._angVelY=z,this._b1._angVelZ=d,this._b2._angVelX=Y,this._b2._angVelY=Z,this._b2._angVelZ=M)}}solveVelocity(){var t,i,a,s,o,n,r,_,e,h,l,c,m=this.info.numRows;t=this._b1._velX,i=this._b1._velY,a=this._b1._velZ,s=this._b2._velX,o=this._b2._velY,n=this._b2._velZ,r=this._b1._angVelX,_=this._b1._angVelY,e=this._b1._angVelZ,h=this._b2._angVelX,l=this._b2._angVelY,c=this._b2._angVelZ;for(var v=0,b=m;v<b;){var x=v++,p=this.info.rows[x],f=p.impulse,u=p.jacobian,y=0;y+=t*u.lin1X+i*u.lin1Y+a*u.lin1Z,y-=s*u.lin2X+o*u.lin2Y+n*u.lin2Z,y+=r*u.ang1X+_*u.ang1Y+e*u.ang1Z,y-=h*u.ang2X+l*u.ang2Y+c*u.ang2Z,this.relVels[x]=y,this.impulses[x]=f.impulse,this.dTotalImpulses[x]=0}for(var X=this.massMatrix._invMassWithoutCfm,g=0,z=m;g<z;){var d=g++,Y=this.info.rows[d],Z=Y.impulse,M=this.massData[d];if(Y.motorMaxImpulse>0){var I=Z.impulseM,V=I+M.massWithoutCfm*(-Y.motorSpeed-this.relVels[d]),L=Y.motorMaxImpulse;V<-L?V=-L:V>L&&(V=L),Z.impulseM=V;var w=V-I;this.dTotalImpulses[d]=w;for(var k=0,B=m;k<B;){var A=k++,P=A,S=this.relVels;S[P]=S[P]+w*X[d][A]}}}for(var T=!1,C=0,j=this.boundaryBuilder.numBoundaries;C<j;){var R=C++,q=this.velBoundarySelector.indices[R];if(this.boundaryBuilder.boundaries[q].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,1,!1)){for(var E=0,D=m;E<D;){var F=E++,N=this.info.rows[F].impulse,W=this.dImpulses[F];N.impulse+=W;var G=F,J=this.dTotalImpulses;J[G]=J[G]+W}var O,H,U,Q,K,$,tt,it,at,st,ot,nt,rt=this.dTotalImpulses,_t=!1,et=!1;O=this._b1._velX,H=this._b1._velY,U=this._b1._velZ,Q=this._b2._velX,K=this._b2._velY,$=this._b2._velZ,tt=this._b1._angVelX,it=this._b1._angVelY,at=this._b1._angVelZ,st=this._b2._angVelX,ot=this._b2._angVelY,nt=this._b2._angVelZ;for(var ht=0,lt=this.info.numRows;ht<lt;){var ct=ht++,mt=this.info.rows[ct].jacobian,vt=this.massData[ct],bt=rt[ct];0!=(1&mt.flag)&&(O+=vt.invMLin1X*bt,H+=vt.invMLin1Y*bt,U+=vt.invMLin1Z*bt,Q+=vt.invMLin2X*-bt,K+=vt.invMLin2Y*-bt,$+=vt.invMLin2Z*-bt,_t=!0),0!=(2&mt.flag)&&(tt+=vt.invMAng1X*bt,it+=vt.invMAng1Y*bt,at+=vt.invMAng1Z*bt,st+=vt.invMAng2X*-bt,ot+=vt.invMAng2Y*-bt,nt+=vt.invMAng2Z*-bt,et=!0)}_t&&(this._b1._velX=O,this._b1._velY=H,this._b1._velZ=U,this._b2._velX=Q,this._b2._velY=K,this._b2._velZ=$),et&&(this._b1._angVelX=tt,this._b1._angVelY=it,this._b1._angVelZ=at,this._b2._angVelX=st,this._b2._angVelY=ot,this._b2._angVelZ=nt);for(var xt=this.velBoundarySelector,pt=0;xt.indices[pt]!=q;)++pt;for(;pt>0;){var ft=xt.indices[pt];xt.indices[pt]=xt.indices[pt-1],xt.indices[pt-1]=ft,--pt}T=!0;break}}T||console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:335:","could not find solution. (velocity)")}postSolveVelocity(t){var i,a,s,o,n,r;i=0,a=0,s=0,o=0,n=0,r=0;for(var _=0,e=this.info.numRows;_<e;){var h=_++,l=this.info.rows[h],c=l.impulse,m=l.jacobian;0!=(1&m.flag)?(i+=m.lin1X*c.impulse,a+=m.lin1Y*c.impulse,s+=m.lin1Z*c.impulse):0!=(2&m.flag)&&(o+=m.ang1X*c.impulse,n+=m.ang1Y*c.impulse,r+=m.ang1Z*c.impulse)}this.joint._appliedForceX=i*t.invDt,this.joint._appliedForceY=a*t.invDt,this.joint._appliedForceZ=s*t.invDt,this.joint._appliedTorqueX=o*t.invDt,this.joint._appliedTorqueY=n*t.invDt,this.joint._appliedTorqueZ=r*t.invDt}preSolvePosition(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var i=this.boundaryBuilder;i.numBoundaries=0;var a=i.bbInfo;a.numBounded=0,a.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);for(var s=this.posBoundarySelector,o=this.boundaryBuilder.numBoundaries,n=0,r=0,_=0,e=s.n;_<e;){var h=_++,l=s.indices[h];l<o?(s.tmpIndices[n]=l,++n):(s.tmpIndices[o+r]=l,++r)}var c=s.indices;s.indices=s.tmpIndices,s.tmpIndices=c;for(var m=0,v=this.info.numRows;m<v;){var b=m++;this.info.rows[b].impulse.impulseP=0}}solvePositionSplitImpulse(){var i,a,s,o,n,r,_,e,h,l,c,m,v=this.info.numRows;i=this._b1._pseudoVelX,a=this._b1._pseudoVelY,s=this._b1._pseudoVelZ,o=this._b2._pseudoVelX,n=this._b2._pseudoVelY,r=this._b2._pseudoVelZ,_=this._b1._angPseudoVelX,e=this._b1._angPseudoVelY,h=this._b1._angPseudoVelZ,l=this._b2._angPseudoVelX,c=this._b2._angPseudoVelY,m=this._b2._angPseudoVelZ;for(var b=0,x=v;b<x;){var p=b++,f=this.info.rows[p],u=f.impulse,y=f.jacobian,X=0;X+=i*y.lin1X+a*y.lin1Y+s*y.lin1Z,X-=o*y.lin2X+n*y.lin2Y+r*y.lin2Z,X+=_*y.ang1X+e*y.ang1Y+h*y.ang1Z,X-=l*y.ang2X+c*y.ang2Y+m*y.ang2Z,this.relVels[p]=X,this.impulses[p]=u.impulseP}for(var g=!1,z=0,d=this.boundaryBuilder.numBoundaries;z<d;){var Y=z++,Z=this.posBoundarySelector.indices[Y];if(this.boundaryBuilder.boundaries[Z].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,t.common.Setting.positionSplitImpulseBaumgarte,!1)){for(var M=0,I=v;M<I;){var V=M++,L=this.info.rows[V].impulse,w=this.dImpulses[V];L.impulseP+=w}var k,B,A,P,S,T,C,j,R,q,E,D,F=this.dImpulses,N=!1,W=!1;k=this._b1._pseudoVelX,B=this._b1._pseudoVelY,A=this._b1._pseudoVelZ,P=this._b2._pseudoVelX,S=this._b2._pseudoVelY,T=this._b2._pseudoVelZ,C=this._b1._angPseudoVelX,j=this._b1._angPseudoVelY,R=this._b1._angPseudoVelZ,q=this._b2._angPseudoVelX,E=this._b2._angPseudoVelY,D=this._b2._angPseudoVelZ;for(var G=0,J=this.info.numRows;G<J;){var O=G++,H=this.info.rows[O].jacobian,U=this.massData[O],Q=F[O];0!=(1&H.flag)&&(k+=U.invMLin1X*Q,B+=U.invMLin1Y*Q,A+=U.invMLin1Z*Q,P+=U.invMLin2X*-Q,S+=U.invMLin2Y*-Q,T+=U.invMLin2Z*-Q,N=!0),0!=(2&H.flag)&&(C+=U.invMAng1X*Q,j+=U.invMAng1Y*Q,R+=U.invMAng1Z*Q,q+=U.invMAng2X*-Q,E+=U.invMAng2Y*-Q,D+=U.invMAng2Z*-Q,W=!0)}N&&(this._b1._pseudoVelX=k,this._b1._pseudoVelY=B,this._b1._pseudoVelZ=A,this._b2._pseudoVelX=P,this._b2._pseudoVelY=S,this._b2._pseudoVelZ=T),W&&(this._b1._angPseudoVelX=C,this._b1._angPseudoVelY=j,this._b1._angPseudoVelZ=R,this._b2._angPseudoVelX=q,this._b2._angPseudoVelY=E,this._b2._angPseudoVelZ=D);for(var K=this.posBoundarySelector,$=0;K.indices[$]!=Z;)++$;for(;$>0;){var tt=K.indices[$];K.indices[$]=K.indices[$-1],K.indices[$-1]=tt,--$}g=!0;break}}g||console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:450:","could not find solution. (split impulse)")}solvePositionNgs(i){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var a=this.boundaryBuilder;a.numBoundaries=0;var s=a.bbInfo;s.numBounded=0,s.numUnbounded=0,a.buildBoundariesRecursive(this.info,0);for(var o=this.posBoundarySelector,n=this.boundaryBuilder.numBoundaries,r=0,_=0,e=0,h=o.n;e<h;){var l=e++,c=o.indices[l];c<n?(o.tmpIndices[r]=c,++r):(o.tmpIndices[n+_]=c,++_)}var m=o.indices;o.indices=o.tmpIndices,o.tmpIndices=m;for(var v=this.info.numRows,b=0,x=v;b<x;){var p=b++,f=this.info.rows[p],u=f.impulse;f.jacobian,this.relVels[p]=0,this.impulses[p]=u.impulseP}for(var y=!1,X=0,g=this.boundaryBuilder.numBoundaries;X<g;){var z=X++,d=this.posBoundarySelector.indices[z];if(this.boundaryBuilder.boundaries[d].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,t.common.Setting.positionNgsBaumgarte,!1)){for(var Y=0,Z=v;Y<Z;){var M=Y++,I=this.info.rows[M].impulse,V=this.dImpulses[M];I.impulseP+=V}var L,w,k,B,A,P,S,T,C,j,R,q,E=this.dImpulses,D=!1,F=!1;L=0,w=0,k=0,B=0,A=0,P=0,S=0,T=0,C=0,j=0,R=0,q=0;for(var N=0,W=this.info.numRows;N<W;){var G=N++,J=this.info.rows[G].jacobian,O=this.massData[G],H=E[G];0!=(1&J.flag)&&(L+=O.invMLin1X*H,w+=O.invMLin1Y*H,k+=O.invMLin1Z*H,B+=O.invMLin2X*-H,A+=O.invMLin2Y*-H,P+=O.invMLin2Z*-H,D=!0),0!=(2&J.flag)&&(S+=O.invMAng1X*H,T+=O.invMAng1Y*H,C+=O.invMAng1Z*H,j+=O.invMAng2X*-H,R+=O.invMAng2Y*-H,q+=O.invMAng2Z*-H,F=!0)}if(D){var U=this._b1;U._transform._positionX+=L,U._transform._positionY+=w,U._transform._positionZ+=k;var Q=this._b2;Q._transform._positionX+=B,Q._transform._positionY+=A,Q._transform._positionZ+=P}if(F){var K,$,tt,it,at,st,ot,nt,rt,_t,et=this._b1,ht=Math.sqrt(S*S+T*T+C*C),lt=.5*ht;if(lt<.5){var ct=lt*lt;K=.5*(1-.16666666666666666*ct+ct*ct*.008333333333333333),$=1-.5*ct+ct*ct*.041666666666666664}else K=Math.sin(lt)/ht,$=Math.cos(lt);tt=S*K,it=T*K,at=C*K,st=$;var mt,vt=et._transform._rotation00,bt=et._transform._rotation11,xt=et._transform._rotation22,pt=vt+bt+xt;pt>0?(_t=.5*(mt=Math.sqrt(pt+1)),mt=.5/mt,ot=(et._transform._rotation21-et._transform._rotation12)*mt,nt=(et._transform._rotation02-et._transform._rotation20)*mt,rt=(et._transform._rotation10-et._transform._rotation01)*mt):vt>bt?vt>xt?(ot=.5*(mt=Math.sqrt(vt-bt-xt+1)),mt=.5/mt,nt=(et._transform._rotation01+et._transform._rotation10)*mt,rt=(et._transform._rotation02+et._transform._rotation20)*mt,_t=(et._transform._rotation21-et._transform._rotation12)*mt):(rt=.5*(mt=Math.sqrt(xt-vt-bt+1)),mt=.5/mt,ot=(et._transform._rotation02+et._transform._rotation20)*mt,nt=(et._transform._rotation12+et._transform._rotation21)*mt,_t=(et._transform._rotation10-et._transform._rotation01)*mt):bt>xt?(nt=.5*(mt=Math.sqrt(bt-xt-vt+1)),mt=.5/mt,ot=(et._transform._rotation01+et._transform._rotation10)*mt,rt=(et._transform._rotation12+et._transform._rotation21)*mt,_t=(et._transform._rotation02-et._transform._rotation20)*mt):(rt=.5*(mt=Math.sqrt(xt-vt-bt+1)),mt=.5/mt,ot=(et._transform._rotation02+et._transform._rotation20)*mt,nt=(et._transform._rotation12+et._transform._rotation21)*mt,_t=(et._transform._rotation10-et._transform._rotation01)*mt);var ft=(ot=st*ot+tt*_t+it*rt-at*nt)*ot+(nt=st*nt-tt*rt+it*_t+at*ot)*nt+(rt=st*rt+tt*nt-it*ot+at*_t)*rt+(_t=st*_t-tt*ot-it*nt-at*rt)*_t;ft>1e-32&&(ft=1/Math.sqrt(ft));ot*=ft,nt*=ft,rt*=ft,_t*=ft;var ut,yt,Xt,gt,zt,dt,Yt,Zt,Mt,It,Vt,Lt,wt,kt,Bt,At,Pt,St,Tt=2*ot,Ct=2*nt,jt=2*rt,Rt=ot*Tt,qt=nt*Ct,Et=rt*jt,Dt=ot*Ct,Ft=nt*jt,Nt=ot*jt,Wt=_t*Tt,Gt=_t*Ct,Jt=_t*jt;et._transform._rotation00=1-qt-Et,et._transform._rotation01=Dt-Jt,et._transform._rotation02=Nt+Gt,et._transform._rotation10=Dt+Jt,et._transform._rotation11=1-Rt-Et,et._transform._rotation12=Ft-Wt,et._transform._rotation20=Nt-Gt,et._transform._rotation21=Ft+Wt,et._transform._rotation22=1-Rt-qt,ut=et._transform._rotation00*et._invLocalInertia00+et._transform._rotation01*et._invLocalInertia10+et._transform._rotation02*et._invLocalInertia20,yt=et._transform._rotation00*et._invLocalInertia01+et._transform._rotation01*et._invLocalInertia11+et._transform._rotation02*et._invLocalInertia21,Xt=et._transform._rotation00*et._invLocalInertia02+et._transform._rotation01*et._invLocalInertia12+et._transform._rotation02*et._invLocalInertia22,gt=et._transform._rotation10*et._invLocalInertia00+et._transform._rotation11*et._invLocalInertia10+et._transform._rotation12*et._invLocalInertia20,zt=et._transform._rotation10*et._invLocalInertia01+et._transform._rotation11*et._invLocalInertia11+et._transform._rotation12*et._invLocalInertia21,dt=et._transform._rotation10*et._invLocalInertia02+et._transform._rotation11*et._invLocalInertia12+et._transform._rotation12*et._invLocalInertia22,Yt=et._transform._rotation20*et._invLocalInertia00+et._transform._rotation21*et._invLocalInertia10+et._transform._rotation22*et._invLocalInertia20,Zt=et._transform._rotation20*et._invLocalInertia01+et._transform._rotation21*et._invLocalInertia11+et._transform._rotation22*et._invLocalInertia21,Mt=et._transform._rotation20*et._invLocalInertia02+et._transform._rotation21*et._invLocalInertia12+et._transform._rotation22*et._invLocalInertia22,et._invInertia00=ut,et._invInertia01=yt,et._invInertia02=Xt,et._invInertia10=gt,et._invInertia11=zt,et._invInertia12=dt,et._invInertia20=Yt,et._invInertia21=Zt,et._invInertia22=Mt,It=et._invInertia00*et._transform._rotation00+et._invInertia01*et._transform._rotation01+et._invInertia02*et._transform._rotation02,Vt=et._invInertia00*et._transform._rotation10+et._invInertia01*et._transform._rotation11+et._invInertia02*et._transform._rotation12,Lt=et._invInertia00*et._transform._rotation20+et._invInertia01*et._transform._rotation21+et._invInertia02*et._transform._rotation22,wt=et._invInertia10*et._transform._rotation00+et._invInertia11*et._transform._rotation01+et._invInertia12*et._transform._rotation02,kt=et._invInertia10*et._transform._rotation10+et._invInertia11*et._transform._rotation11+et._invInertia12*et._transform._rotation12,Bt=et._invInertia10*et._transform._rotation20+et._invInertia11*et._transform._rotation21+et._invInertia12*et._transform._rotation22,At=et._invInertia20*et._transform._rotation00+et._invInertia21*et._transform._rotation01+et._invInertia22*et._transform._rotation02,Pt=et._invInertia20*et._transform._rotation10+et._invInertia21*et._transform._rotation11+et._invInertia22*et._transform._rotation12,St=et._invInertia20*et._transform._rotation20+et._invInertia21*et._transform._rotation21+et._invInertia22*et._transform._rotation22,et._invInertia00=It,et._invInertia01=Vt,et._invInertia02=Lt,et._invInertia10=wt,et._invInertia11=kt,et._invInertia12=Bt,et._invInertia20=At,et._invInertia21=Pt,et._invInertia22=St,et._invInertia00*=et._rotFactor.x,et._invInertia01*=et._rotFactor.x,et._invInertia02*=et._rotFactor.x,et._invInertia10*=et._rotFactor.y,et._invInertia11*=et._rotFactor.y,et._invInertia12*=et._rotFactor.y,et._invInertia20*=et._rotFactor.z,et._invInertia21*=et._rotFactor.z,et._invInertia22*=et._rotFactor.z;var Ot,Ht,Ut,Qt,Kt,$t,ti,ii,ai,si,oi=this._b2,ni=Math.sqrt(j*j+R*R+q*q),ri=.5*ni;if(ri<.5){var _i=ri*ri;Ot=.5*(1-.16666666666666666*_i+_i*_i*.008333333333333333),Ht=1-.5*_i+_i*_i*.041666666666666664}else Ot=Math.sin(ri)/ni,Ht=Math.cos(ri);Ut=j*Ot,Qt=R*Ot,Kt=q*Ot,$t=Ht;var ei,hi=oi._transform._rotation00,li=oi._transform._rotation11,ci=oi._transform._rotation22,mi=hi+li+ci;mi>0?(si=.5*(ei=Math.sqrt(mi+1)),ei=.5/ei,ti=(oi._transform._rotation21-oi._transform._rotation12)*ei,ii=(oi._transform._rotation02-oi._transform._rotation20)*ei,ai=(oi._transform._rotation10-oi._transform._rotation01)*ei):hi>li?hi>ci?(ti=.5*(ei=Math.sqrt(hi-li-ci+1)),ei=.5/ei,ii=(oi._transform._rotation01+oi._transform._rotation10)*ei,ai=(oi._transform._rotation02+oi._transform._rotation20)*ei,si=(oi._transform._rotation21-oi._transform._rotation12)*ei):(ai=.5*(ei=Math.sqrt(ci-hi-li+1)),ei=.5/ei,ti=(oi._transform._rotation02+oi._transform._rotation20)*ei,ii=(oi._transform._rotation12+oi._transform._rotation21)*ei,si=(oi._transform._rotation10-oi._transform._rotation01)*ei):li>ci?(ii=.5*(ei=Math.sqrt(li-ci-hi+1)),ei=.5/ei,ti=(oi._transform._rotation01+oi._transform._rotation10)*ei,ai=(oi._transform._rotation12+oi._transform._rotation21)*ei,si=(oi._transform._rotation02-oi._transform._rotation20)*ei):(ai=.5*(ei=Math.sqrt(ci-hi-li+1)),ei=.5/ei,ti=(oi._transform._rotation02+oi._transform._rotation20)*ei,ii=(oi._transform._rotation12+oi._transform._rotation21)*ei,si=(oi._transform._rotation10-oi._transform._rotation01)*ei);var vi=(ti=$t*ti+Ut*si+Qt*ai-Kt*ii)*ti+(ii=$t*ii-Ut*ai+Qt*si+Kt*ti)*ii+(ai=$t*ai+Ut*ii-Qt*ti+Kt*si)*ai+(si=$t*si-Ut*ti-Qt*ii-Kt*ai)*si;vi>1e-32&&(vi=1/Math.sqrt(vi));ti*=vi,ii*=vi,ai*=vi,si*=vi;var bi,xi,pi,fi,ui,yi,Xi,gi,zi,di,Yi,Zi,Mi,Ii,Vi,Li,wi,ki,Bi=2*ti,Ai=2*ii,Pi=2*ai,Si=ti*Bi,Ti=ii*Ai,Ci=ai*Pi,ji=ti*Ai,Ri=ii*Pi,qi=ti*Pi,Ei=si*Bi,Di=si*Ai,Fi=si*Pi;oi._transform._rotation00=1-Ti-Ci,oi._transform._rotation01=ji-Fi,oi._transform._rotation02=qi+Di,oi._transform._rotation10=ji+Fi,oi._transform._rotation11=1-Si-Ci,oi._transform._rotation12=Ri-Ei,oi._transform._rotation20=qi-Di,oi._transform._rotation21=Ri+Ei,oi._transform._rotation22=1-Si-Ti,bi=oi._transform._rotation00*oi._invLocalInertia00+oi._transform._rotation01*oi._invLocalInertia10+oi._transform._rotation02*oi._invLocalInertia20,xi=oi._transform._rotation00*oi._invLocalInertia01+oi._transform._rotation01*oi._invLocalInertia11+oi._transform._rotation02*oi._invLocalInertia21,pi=oi._transform._rotation00*oi._invLocalInertia02+oi._transform._rotation01*oi._invLocalInertia12+oi._transform._rotation02*oi._invLocalInertia22,fi=oi._transform._rotation10*oi._invLocalInertia00+oi._transform._rotation11*oi._invLocalInertia10+oi._transform._rotation12*oi._invLocalInertia20,ui=oi._transform._rotation10*oi._invLocalInertia01+oi._transform._rotation11*oi._invLocalInertia11+oi._transform._rotation12*oi._invLocalInertia21,yi=oi._transform._rotation10*oi._invLocalInertia02+oi._transform._rotation11*oi._invLocalInertia12+oi._transform._rotation12*oi._invLocalInertia22,Xi=oi._transform._rotation20*oi._invLocalInertia00+oi._transform._rotation21*oi._invLocalInertia10+oi._transform._rotation22*oi._invLocalInertia20,gi=oi._transform._rotation20*oi._invLocalInertia01+oi._transform._rotation21*oi._invLocalInertia11+oi._transform._rotation22*oi._invLocalInertia21,zi=oi._transform._rotation20*oi._invLocalInertia02+oi._transform._rotation21*oi._invLocalInertia12+oi._transform._rotation22*oi._invLocalInertia22,oi._invInertia00=bi,oi._invInertia01=xi,oi._invInertia02=pi,oi._invInertia10=fi,oi._invInertia11=ui,oi._invInertia12=yi,oi._invInertia20=Xi,oi._invInertia21=gi,oi._invInertia22=zi,di=oi._invInertia00*oi._transform._rotation00+oi._invInertia01*oi._transform._rotation01+oi._invInertia02*oi._transform._rotation02,Yi=oi._invInertia00*oi._transform._rotation10+oi._invInertia01*oi._transform._rotation11+oi._invInertia02*oi._transform._rotation12,Zi=oi._invInertia00*oi._transform._rotation20+oi._invInertia01*oi._transform._rotation21+oi._invInertia02*oi._transform._rotation22,Mi=oi._invInertia10*oi._transform._rotation00+oi._invInertia11*oi._transform._rotation01+oi._invInertia12*oi._transform._rotation02,Ii=oi._invInertia10*oi._transform._rotation10+oi._invInertia11*oi._transform._rotation11+oi._invInertia12*oi._transform._rotation12,Vi=oi._invInertia10*oi._transform._rotation20+oi._invInertia11*oi._transform._rotation21+oi._invInertia12*oi._transform._rotation22,Li=oi._invInertia20*oi._transform._rotation00+oi._invInertia21*oi._transform._rotation01+oi._invInertia22*oi._transform._rotation02,wi=oi._invInertia20*oi._transform._rotation10+oi._invInertia21*oi._transform._rotation11+oi._invInertia22*oi._transform._rotation12,ki=oi._invInertia20*oi._transform._rotation20+oi._invInertia21*oi._transform._rotation21+oi._invInertia22*oi._transform._rotation22,oi._invInertia00=di,oi._invInertia01=Yi,oi._invInertia02=Zi,oi._invInertia10=Mi,oi._invInertia11=Ii,oi._invInertia12=Vi,oi._invInertia20=Li,oi._invInertia21=wi,oi._invInertia22=ki,oi._invInertia00*=oi._rotFactor.x,oi._invInertia01*=oi._rotFactor.x,oi._invInertia02*=oi._rotFactor.x,oi._invInertia10*=oi._rotFactor.y,oi._invInertia11*=oi._rotFactor.y,oi._invInertia12*=oi._rotFactor.y,oi._invInertia20*=oi._rotFactor.z,oi._invInertia21*=oi._rotFactor.z,oi._invInertia22*=oi._rotFactor.z}for(var Ni=this.posBoundarySelector,Wi=0;Ni.indices[Wi]!=d;)++Wi;for(;Wi>0;){var Gi=Ni.indices[Wi];Ni.indices[Wi]=Ni.indices[Wi-1],Ni.indices[Wi-1]=Gi,--Wi}y=!0;break}}y||console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:502:","could not find solution. (NGS)")}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}},t.dynamics.constraint.solver.direct.MassMatrix=class{constructor(t){this._size=t;var i=new Array(this._size);this.tmpMatrix=i;var a=new Array(this._size);this._invMass=a;var s=new Array(this._size);this._invMassWithoutCfm=s;for(var o=0,n=this._size;o<n;){var r=o++,_=this.tmpMatrix,e=new Array(this._size);_[r]=e;var h=this._invMass,l=new Array(this._size);h[r]=l;var c=this._invMassWithoutCfm,m=new Array(this._size);c[r]=m;for(var v=0,b=this._size;v<b;){var x=v++;this.tmpMatrix[r][x]=0,this._invMass[r][x]=0,this._invMassWithoutCfm[r][x]=0}}this._maxSubmatrixId=1<<this._size;var p=new Array(this._maxSubmatrixId);this._cacheComputed=p;var f=new Array(this._maxSubmatrixId);this._cachedSubmatrices=f;for(var u=0,y=this._maxSubmatrixId;u<y;){for(var X=u++,g=X,z=g=(15&(g=(51&(g=(85&g)+(g>>1&85)))+(g>>2&51)))+(g>>4&15),d=new Array(z),Y=0,Z=z;Y<Z;){var M=Y++,I=new Array(z);d[M]=I;for(var V=0,L=z;V<L;){var w=V++;d[M][w]=0}}this._cacheComputed[X]=!1,this._cachedSubmatrices[X]=d}}computeSubmatrix(t,i,a){for(var s=0,o=a;s<o;)for(var n=s++,r=i[n],_=0,e=a;_<e;){var h=_++;this.tmpMatrix[n][h]=this._invMass[r][i[h]]}var l,c,m,v,b,x=this.tmpMatrix,p=this._cachedSubmatrices[t];switch(a){case 4:l=x[0],c=p[0],b=1/l[0],c[0]=b,l[1]=l[1]*b,l[2]=l[2]*b,l[3]=l[3]*b,m=x[1],(v=p[1])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],m=x[2],(v=p[2])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],m=x[3],(v=p[3])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],l=x[1],c=p[1],b=1/l[1],c[1]=b,c[0]=c[0]*b,l[2]=l[2]*b,l[3]=l[3]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],m=x[2],(v=p[2])[0]=v[0]-c[0]*m[1],v[1]=-b*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],m=x[3],(v=p[3])[0]=v[0]-c[0]*m[1],v[1]=-b*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],l=x[2],c=p[2],b=1/l[2],c[2]=b,c[0]=c[0]*b,c[1]=c[1]*b,l[3]=l[3]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[2],m[3]=m[3]-l[3]*m[2],m=x[1],(v=p[1])[0]=v[0]-c[0]*m[2],v[1]=v[1]-c[1]*m[2],m[3]=m[3]-l[3]*m[2],m=x[3],(v=p[3])[0]=v[0]-c[0]*m[2],v[1]=v[1]-c[1]*m[2],v[2]=-b*m[2],m[3]=m[3]-l[3]*m[2],l=x[3],c=p[3],b=1/l[3],c[3]=b,c[0]=c[0]*b,c[1]=c[1]*b,c[2]=c[2]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[3],m=x[1],(v=p[1])[0]=v[0]-c[0]*m[3],v[1]=v[1]-c[1]*m[3],m=x[2],(v=p[2])[0]=v[0]-c[0]*m[3],v[1]=v[1]-c[1]*m[3],v[2]=v[2]-c[2]*m[3],c=p[1],p[0][1]=c[0],c=p[2],p[0][2]=c[0],p[1][2]=c[1],c=p[3],p[0][3]=c[0],p[1][3]=c[1],p[2][3]=c[2];break;case 5:l=x[0],c=p[0],b=1/l[0],c[0]=b,l[1]=l[1]*b,l[2]=l[2]*b,l[3]=l[3]*b,l[4]=l[4]*b,m=x[1],(v=p[1])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],m[4]=m[4]-l[4]*m[0],m=x[2],(v=p[2])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],m[4]=m[4]-l[4]*m[0],m=x[3],(v=p[3])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],m[4]=m[4]-l[4]*m[0],m=x[4],(v=p[4])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],m[4]=m[4]-l[4]*m[0],l=x[1],c=p[1],b=1/l[1],c[1]=b,c[0]=c[0]*b,l[2]=l[2]*b,l[3]=l[3]*b,l[4]=l[4]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],m[4]=m[4]-l[4]*m[1],m=x[2],(v=p[2])[0]=v[0]-c[0]*m[1],v[1]=-b*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],m[4]=m[4]-l[4]*m[1],m=x[3],(v=p[3])[0]=v[0]-c[0]*m[1],v[1]=-b*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],m[4]=m[4]-l[4]*m[1],m=x[4],(v=p[4])[0]=v[0]-c[0]*m[1],v[1]=-b*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],m[4]=m[4]-l[4]*m[1],l=x[2],c=p[2],b=1/l[2],c[2]=b,c[0]=c[0]*b,c[1]=c[1]*b,l[3]=l[3]*b,l[4]=l[4]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[2],m[3]=m[3]-l[3]*m[2],m[4]=m[4]-l[4]*m[2],m=x[1],(v=p[1])[0]=v[0]-c[0]*m[2],v[1]=v[1]-c[1]*m[2],m[3]=m[3]-l[3]*m[2],m[4]=m[4]-l[4]*m[2],m=x[3],(v=p[3])[0]=v[0]-c[0]*m[2],v[1]=v[1]-c[1]*m[2],v[2]=-b*m[2],m[3]=m[3]-l[3]*m[2],m[4]=m[4]-l[4]*m[2],m=x[4],(v=p[4])[0]=v[0]-c[0]*m[2],v[1]=v[1]-c[1]*m[2],v[2]=-b*m[2],m[3]=m[3]-l[3]*m[2],m[4]=m[4]-l[4]*m[2],l=x[3],c=p[3],b=1/l[3],c[3]=b,c[0]=c[0]*b,c[1]=c[1]*b,c[2]=c[2]*b,l[4]=l[4]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[3],m[4]=m[4]-l[4]*m[3],m=x[1],(v=p[1])[0]=v[0]-c[0]*m[3],v[1]=v[1]-c[1]*m[3],m[4]=m[4]-l[4]*m[3],m=x[2],(v=p[2])[0]=v[0]-c[0]*m[3],v[1]=v[1]-c[1]*m[3],v[2]=v[2]-c[2]*m[3],m[4]=m[4]-l[4]*m[3],m=x[4],(v=p[4])[0]=v[0]-c[0]*m[3],v[1]=v[1]-c[1]*m[3],v[2]=v[2]-c[2]*m[3],v[3]=-b*m[3],m[4]=m[4]-l[4]*m[3],l=x[4],c=p[4],b=1/l[4],c[4]=b,c[0]=c[0]*b,c[1]=c[1]*b,c[2]=c[2]*b,c[3]=c[3]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[4],m=x[1],(v=p[1])[0]=v[0]-c[0]*m[4],v[1]=v[1]-c[1]*m[4],m=x[2],(v=p[2])[0]=v[0]-c[0]*m[4],v[1]=v[1]-c[1]*m[4],v[2]=v[2]-c[2]*m[4],m=x[3],(v=p[3])[0]=v[0]-c[0]*m[4],v[1]=v[1]-c[1]*m[4],v[2]=v[2]-c[2]*m[4],v[3]=v[3]-c[3]*m[4],c=p[1],p[0][1]=c[0],c=p[2],p[0][2]=c[0],p[1][2]=c[1],c=p[3],p[0][3]=c[0],p[1][3]=c[1],p[2][3]=c[2],c=p[4],p[0][4]=c[0],p[1][4]=c[1],p[2][4]=c[2],p[3][4]=c[3];break;case 6:l=x[0],c=p[0],b=1/l[0],c[0]=b,l[1]=l[1]*b,l[2]=l[2]*b,l[3]=l[3]*b,l[4]=l[4]*b,l[5]=l[5]*b,m=x[1],(v=p[1])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],m[4]=m[4]-l[4]*m[0],m[5]=m[5]-l[5]*m[0],m=x[2],(v=p[2])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],m[4]=m[4]-l[4]*m[0],m[5]=m[5]-l[5]*m[0],m=x[3],(v=p[3])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],m[4]=m[4]-l[4]*m[0],m[5]=m[5]-l[5]*m[0],m=x[4],(v=p[4])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],m[4]=m[4]-l[4]*m[0],m[5]=m[5]-l[5]*m[0],m=x[5],(v=p[5])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],m[4]=m[4]-l[4]*m[0],m[5]=m[5]-l[5]*m[0],l=x[1],c=p[1],b=1/l[1],c[1]=b,c[0]=c[0]*b,l[2]=l[2]*b,l[3]=l[3]*b,l[4]=l[4]*b,l[5]=l[5]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],m[4]=m[4]-l[4]*m[1],m[5]=m[5]-l[5]*m[1],m=x[2],(v=p[2])[0]=v[0]-c[0]*m[1],v[1]=-b*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],m[4]=m[4]-l[4]*m[1],m[5]=m[5]-l[5]*m[1],m=x[3],(v=p[3])[0]=v[0]-c[0]*m[1],v[1]=-b*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],m[4]=m[4]-l[4]*m[1],m[5]=m[5]-l[5]*m[1],m=x[4],(v=p[4])[0]=v[0]-c[0]*m[1],v[1]=-b*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],m[4]=m[4]-l[4]*m[1],m[5]=m[5]-l[5]*m[1],m=x[5],(v=p[5])[0]=v[0]-c[0]*m[1],v[1]=-b*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],m[4]=m[4]-l[4]*m[1],m[5]=m[5]-l[5]*m[1],l=x[2],c=p[2],b=1/l[2],c[2]=b,c[0]=c[0]*b,c[1]=c[1]*b,l[3]=l[3]*b,l[4]=l[4]*b,l[5]=l[5]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[2],m[3]=m[3]-l[3]*m[2],m[4]=m[4]-l[4]*m[2],m[5]=m[5]-l[5]*m[2],m=x[1],(v=p[1])[0]=v[0]-c[0]*m[2],v[1]=v[1]-c[1]*m[2],m[3]=m[3]-l[3]*m[2],m[4]=m[4]-l[4]*m[2],m[5]=m[5]-l[5]*m[2],m=x[3],(v=p[3])[0]=v[0]-c[0]*m[2],v[1]=v[1]-c[1]*m[2],v[2]=-b*m[2],m[3]=m[3]-l[3]*m[2],m[4]=m[4]-l[4]*m[2],m[5]=m[5]-l[5]*m[2],m=x[4],(v=p[4])[0]=v[0]-c[0]*m[2],v[1]=v[1]-c[1]*m[2],v[2]=-b*m[2],m[3]=m[3]-l[3]*m[2],m[4]=m[4]-l[4]*m[2],m[5]=m[5]-l[5]*m[2],m=x[5],(v=p[5])[0]=v[0]-c[0]*m[2],v[1]=v[1]-c[1]*m[2],v[2]=-b*m[2],m[3]=m[3]-l[3]*m[2],m[4]=m[4]-l[4]*m[2],m[5]=m[5]-l[5]*m[2],l=x[3],c=p[3],b=1/l[3],c[3]=b,c[0]=c[0]*b,c[1]=c[1]*b,c[2]=c[2]*b,l[4]=l[4]*b,l[5]=l[5]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[3],m[4]=m[4]-l[4]*m[3],m[5]=m[5]-l[5]*m[3],m=x[1],(v=p[1])[0]=v[0]-c[0]*m[3],v[1]=v[1]-c[1]*m[3],m[4]=m[4]-l[4]*m[3],m[5]=m[5]-l[5]*m[3],m=x[2],(v=p[2])[0]=v[0]-c[0]*m[3],v[1]=v[1]-c[1]*m[3],v[2]=v[2]-c[2]*m[3],m[4]=m[4]-l[4]*m[3],m[5]=m[5]-l[5]*m[3],m=x[4],(v=p[4])[0]=v[0]-c[0]*m[3],v[1]=v[1]-c[1]*m[3],v[2]=v[2]-c[2]*m[3],v[3]=-b*m[3],m[4]=m[4]-l[4]*m[3],m[5]=m[5]-l[5]*m[3],m=x[5],(v=p[5])[0]=v[0]-c[0]*m[3],v[1]=v[1]-c[1]*m[3],v[2]=v[2]-c[2]*m[3],v[3]=-b*m[3],m[4]=m[4]-l[4]*m[3],m[5]=m[5]-l[5]*m[3],l=x[4],c=p[4],b=1/l[4],c[4]=b,c[0]=c[0]*b,c[1]=c[1]*b,c[2]=c[2]*b,c[3]=c[3]*b,l[5]=l[5]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[4],m[5]=m[5]-l[5]*m[4],m=x[1],(v=p[1])[0]=v[0]-c[0]*m[4],v[1]=v[1]-c[1]*m[4],m[5]=m[5]-l[5]*m[4],m=x[2],(v=p[2])[0]=v[0]-c[0]*m[4],v[1]=v[1]-c[1]*m[4],v[2]=v[2]-c[2]*m[4],m[5]=m[5]-l[5]*m[4],m=x[3],(v=p[3])[0]=v[0]-c[0]*m[4],v[1]=v[1]-c[1]*m[4],v[2]=v[2]-c[2]*m[4],v[3]=v[3]-c[3]*m[4],m[5]=m[5]-l[5]*m[4],m=x[5],(v=p[5])[0]=v[0]-c[0]*m[4],v[1]=v[1]-c[1]*m[4],v[2]=v[2]-c[2]*m[4],v[3]=v[3]-c[3]*m[4],v[4]=-b*m[4],m[5]=m[5]-l[5]*m[4],l=x[5],c=p[5],b=1/l[5],c[5]=b,c[0]=c[0]*b,c[1]=c[1]*b,c[2]=c[2]*b,c[3]=c[3]*b,c[4]=c[4]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[5],m=x[1],(v=p[1])[0]=v[0]-c[0]*m[5],v[1]=v[1]-c[1]*m[5],m=x[2],(v=p[2])[0]=v[0]-c[0]*m[5],v[1]=v[1]-c[1]*m[5],v[2]=v[2]-c[2]*m[5],m=x[3],(v=p[3])[0]=v[0]-c[0]*m[5],v[1]=v[1]-c[1]*m[5],v[2]=v[2]-c[2]*m[5],v[3]=v[3]-c[3]*m[5],m=x[4],(v=p[4])[0]=v[0]-c[0]*m[5],v[1]=v[1]-c[1]*m[5],v[2]=v[2]-c[2]*m[5],v[3]=v[3]-c[3]*m[5],v[4]=v[4]-c[4]*m[5],c=p[1],p[0][1]=c[0],c=p[2],p[0][2]=c[0],p[1][2]=c[1],c=p[3],p[0][3]=c[0],p[1][3]=c[1],p[2][3]=c[2],c=p[4],p[0][4]=c[0],p[1][4]=c[1],p[2][4]=c[2],p[3][4]=c[3],c=p[5],p[0][5]=c[0],p[1][5]=c[1],p[2][5]=c[2],p[3][5]=c[3],p[4][5]=c[4];break;default:for(var f=0,u=a;f<u;){var y=f++;l=x[y],c=p[y];var X=1/l[y];c[y]=X;for(var g=0,z=y;g<z;){var d=g++;c[d]=c[d]*X}for(var Y=y+1,Z=a;Y<Z;){var M=Y++;l[M]=l[M]*X}for(var I=0,V=y;I<V;){var L=I++;m=x[L],v=p[L];for(var w=0,k=L+1;w<k;){var B=w++;v[B]=v[B]-c[B]*m[y]}for(var A=y+1,P=a;A<P;){var S=A++;m[S]=m[S]-l[S]*m[y]}}for(var T=y+1,C=a;T<C;){var j=T++;m=x[j],v=p[j];for(var R=0,q=y;R<q;){var E=R++;v[E]=v[E]-c[E]*m[y]}v[y]=-X*m[y];for(var D=y+1,F=a;D<F;){var N=D++;m[N]=m[N]-l[N]*m[y]}}}for(var W=1,G=a;W<G;){var J=W++;c=p[J];for(var O=0,H=J;O<H;){var U=O++;p[U][J]=c[U]}}}}computeInvMass(t,i){var a,s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y,X=this._invMass,g=this._invMassWithoutCfm,z=t.numRows,d=t.b1,Y=t.b2,Z=d._invMass,M=Y._invMass;a=d._invInertia00,s=d._invInertia01,o=d._invInertia02,n=d._invInertia10,r=d._invInertia11,_=d._invInertia12,e=d._invInertia20,h=d._invInertia21,l=d._invInertia22,c=Y._invInertia00,m=Y._invInertia01,v=Y._invInertia02,b=Y._invInertia10,x=Y._invInertia11,p=Y._invInertia12,f=Y._invInertia20,u=Y._invInertia21,y=Y._invInertia22;for(var I=0,V=z;I<V;){var L,w,k,B,A,P,S=I++,T=t.rows[S].jacobian,C=i[S];if(T.updateSparsity(),0!=(1&T.flag)?(C.invMLin1X=T.lin1X*Z,C.invMLin1Y=T.lin1Y*Z,C.invMLin1Z=T.lin1Z*Z,C.invMLin2X=T.lin2X*M,C.invMLin2Y=T.lin2Y*M,C.invMLin2Z=T.lin2Z*M):(C.invMLin1X=0,C.invMLin1Y=0,C.invMLin1Z=0,C.invMLin2X=0,C.invMLin2Y=0,C.invMLin2Z=0),0!=(2&T.flag))L=a*T.ang1X+s*T.ang1Y+o*T.ang1Z,w=n*T.ang1X+r*T.ang1Y+_*T.ang1Z,k=e*T.ang1X+h*T.ang1Y+l*T.ang1Z,C.invMAng1X=L,C.invMAng1Y=w,C.invMAng1Z=k,B=c*T.ang2X+m*T.ang2Y+v*T.ang2Z,A=b*T.ang2X+x*T.ang2Y+p*T.ang2Z,P=f*T.ang2X+u*T.ang2Y+y*T.ang2Z,C.invMAng2X=B,C.invMAng2Y=A,C.invMAng2Z=P;else C.invMAng1X=0,C.invMAng1Y=0,C.invMAng1Z=0,C.invMAng2X=0,C.invMAng2Y=0,C.invMAng2Z=0}for(var j=0,R=z;j<R;)for(var q=j++,E=t.rows[q].jacobian,D=q,F=z;D<F;){var N=D++;t.rows[N].jacobian;var W=i[N],G=E.lin1X*W.invMLin1X+E.lin1Y*W.invMLin1Y+E.lin1Z*W.invMLin1Z+(E.ang1X*W.invMAng1X+E.ang1Y*W.invMAng1Y+E.ang1Z*W.invMAng1Z)+(E.lin2X*W.invMLin2X+E.lin2Y*W.invMLin2Y+E.lin2Z*W.invMLin2Z)+(E.ang2X*W.invMAng2X+E.ang2Y*W.invMAng2Y+E.ang2Z*W.invMAng2Z);q==N?(X[q][N]=G+t.rows[q].cfm,g[q][N]=G,W.mass=G+t.rows[q].cfm,W.massWithoutCfm=G,0!=W.mass&&(W.mass=1/W.mass),0!=W.massWithoutCfm&&(W.massWithoutCfm=1/W.massWithoutCfm)):(X[q][N]=G,X[N][q]=G,g[q][N]=G,g[N][q]=G)}for(var J=0,O=this._maxSubmatrixId;J<O;){var H=J++;this._cacheComputed[H]=!1}}},t.dynamics.constraint.solver.pgs||(t.dynamics.constraint.solver.pgs={}),t.dynamics.constraint.solver.pgs.PgsContactConstraintSolver=class extends t.dynamics.constraint.ConstraintSolver{constructor(i){super(),this.constraint=i,this.info=new t.dynamics.constraint.info.contact.ContactSolverInfo;var a=new Array(t.common.Setting.maxManifoldPoints);this.massData=a;for(var s=0,o=this.massData.length;s<o;){var n=s++;this.massData[n]=new t.dynamics.constraint.solver.common.ContactSolverMassDataRow}}preSolveVelocity(t){this.constraint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;var i,a,s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y=this._b1._invMass,X=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,s=this._b1._invInertia02,o=this._b1._invInertia10,n=this._b1._invInertia11,r=this._b1._invInertia12,_=this._b1._invInertia20,e=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,v=this._b2._invInertia10,b=this._b2._invInertia11,x=this._b2._invInertia12,p=this._b2._invInertia20,f=this._b2._invInertia21,u=this._b2._invInertia22;for(var g=0,z=this.info.numRows;g<z;){var d,Y,Z,M,I,V,L=g++,w=this.info.rows[L],k=this.massData[L],B=w.jacobianN;k.invMLinN1X=B.lin1X*y,k.invMLinN1Y=B.lin1Y*y,k.invMLinN1Z=B.lin1Z*y,k.invMLinN2X=B.lin2X*X,k.invMLinN2Y=B.lin2Y*X,k.invMLinN2Z=B.lin2Z*X,d=i*B.ang1X+a*B.ang1Y+s*B.ang1Z,Y=o*B.ang1X+n*B.ang1Y+r*B.ang1Z,Z=_*B.ang1X+e*B.ang1Y+h*B.ang1Z,k.invMAngN1X=d,k.invMAngN1Y=Y,k.invMAngN1Z=Z,M=l*B.ang2X+c*B.ang2Y+m*B.ang2Z,I=v*B.ang2X+b*B.ang2Y+x*B.ang2Z,V=p*B.ang2X+f*B.ang2Y+u*B.ang2Z,k.invMAngN2X=M,k.invMAngN2Y=I,k.invMAngN2Z=V,k.massN=y+X+(k.invMAngN1X*B.ang1X+k.invMAngN1Y*B.ang1Y+k.invMAngN1Z*B.ang1Z)+(k.invMAngN2X*B.ang2X+k.invMAngN2Y*B.ang2Y+k.invMAngN2Z*B.ang2Z),0!=k.massN&&(k.massN=1/k.massN);var A,P,S,T,C,j,R,q,E,D,F,N,W=w.jacobianT,G=w.jacobianB;k.invMLinT1X=W.lin1X*y,k.invMLinT1Y=W.lin1Y*y,k.invMLinT1Z=W.lin1Z*y,k.invMLinT2X=W.lin2X*X,k.invMLinT2Y=W.lin2Y*X,k.invMLinT2Z=W.lin2Z*X,k.invMLinB1X=G.lin1X*y,k.invMLinB1Y=G.lin1Y*y,k.invMLinB1Z=G.lin1Z*y,k.invMLinB2X=G.lin2X*X,k.invMLinB2Y=G.lin2Y*X,k.invMLinB2Z=G.lin2Z*X,A=i*W.ang1X+a*W.ang1Y+s*W.ang1Z,P=o*W.ang1X+n*W.ang1Y+r*W.ang1Z,S=_*W.ang1X+e*W.ang1Y+h*W.ang1Z,k.invMAngT1X=A,k.invMAngT1Y=P,k.invMAngT1Z=S,T=l*W.ang2X+c*W.ang2Y+m*W.ang2Z,C=v*W.ang2X+b*W.ang2Y+x*W.ang2Z,j=p*W.ang2X+f*W.ang2Y+u*W.ang2Z,k.invMAngT2X=T,k.invMAngT2Y=C,k.invMAngT2Z=j,R=i*G.ang1X+a*G.ang1Y+s*G.ang1Z,q=o*G.ang1X+n*G.ang1Y+r*G.ang1Z,E=_*G.ang1X+e*G.ang1Y+h*G.ang1Z,k.invMAngB1X=R,k.invMAngB1Y=q,k.invMAngB1Z=E,D=l*G.ang2X+c*G.ang2Y+m*G.ang2Z,F=v*G.ang2X+b*G.ang2Y+x*G.ang2Z,N=p*G.ang2X+f*G.ang2Y+u*G.ang2Z,k.invMAngB2X=D,k.invMAngB2Y=F,k.invMAngB2Z=N;var J=y+X+(k.invMAngT1X*W.ang1X+k.invMAngT1Y*W.ang1Y+k.invMAngT1Z*W.ang1Z)+(k.invMAngT2X*W.ang2X+k.invMAngT2Y*W.ang2Y+k.invMAngT2Z*W.ang2Z),O=k.invMAngT1X*G.ang1X+k.invMAngT1Y*G.ang1Y+k.invMAngT1Z*G.ang1Z+(k.invMAngT2X*G.ang2X+k.invMAngT2Y*G.ang2Y+k.invMAngT2Z*G.ang2Z),H=O,U=y+X+(k.invMAngB1X*G.ang1X+k.invMAngB1Y*G.ang1Y+k.invMAngB1Z*G.ang1Z)+(k.invMAngB2X*G.ang2X+k.invMAngB2Y*G.ang2Y+k.invMAngB2Z*G.ang2Z),Q=J*U-O*H;0!=Q&&(Q=1/Q),k.massTB00=U*Q,k.massTB01=-O*Q,k.massTB10=-H*Q,k.massTB11=J*Q}}warmStart(t){var i,a,s,o,n,r,_,e,h,l,c,m;i=this._b1._velX,a=this._b1._velY,s=this._b1._velZ,o=this._b2._velX,n=this._b2._velY,r=this._b2._velZ,_=this._b1._angVelX,e=this._b1._angVelY,h=this._b1._angVelZ,l=this._b2._angVelX,c=this._b2._angVelY,m=this._b2._angVelZ;for(var v=0,b=this.info.numRows;v<b;){var x=v++,p=this.info.rows[x],f=p.impulse,u=this.massData[x],y=p.jacobianT,X=p.jacobianB,g=f.impulseN,z=f.impulseLX*y.lin1X+f.impulseLY*y.lin1Y+f.impulseLZ*y.lin1Z,d=f.impulseLX*X.lin1X+f.impulseLY*X.lin1Y+f.impulseLZ*X.lin1Z;f.impulseT=z,f.impulseB=d,f.impulseN*=t.dtRatio,f.impulseT*=t.dtRatio,f.impulseB*=t.dtRatio,i+=u.invMLinN1X*g,a+=u.invMLinN1Y*g,s+=u.invMLinN1Z*g,i+=u.invMLinT1X*z,a+=u.invMLinT1Y*z,s+=u.invMLinT1Z*z,i+=u.invMLinB1X*d,a+=u.invMLinB1Y*d,s+=u.invMLinB1Z*d,o+=u.invMLinN2X*-g,n+=u.invMLinN2Y*-g,r+=u.invMLinN2Z*-g,o+=u.invMLinT2X*-z,n+=u.invMLinT2Y*-z,r+=u.invMLinT2Z*-z,o+=u.invMLinB2X*-d,n+=u.invMLinB2Y*-d,r+=u.invMLinB2Z*-d,_+=u.invMAngN1X*g,e+=u.invMAngN1Y*g,h+=u.invMAngN1Z*g,_+=u.invMAngT1X*z,e+=u.invMAngT1Y*z,h+=u.invMAngT1Z*z,_+=u.invMAngB1X*d,e+=u.invMAngB1Y*d,h+=u.invMAngB1Z*d,l+=u.invMAngN2X*-g,c+=u.invMAngN2Y*-g,m+=u.invMAngN2Z*-g,l+=u.invMAngT2X*-z,c+=u.invMAngT2Y*-z,m+=u.invMAngT2Z*-z,l+=u.invMAngB2X*-d,c+=u.invMAngB2Y*-d,m+=u.invMAngB2Z*-d}this._b1._velX=i,this._b1._velY=a,this._b1._velZ=s,this._b2._velX=o,this._b2._velY=n,this._b2._velZ=r,this._b1._angVelX=_,this._b1._angVelY=e,this._b1._angVelZ=h,this._b2._angVelX=l,this._b2._angVelY=c,this._b2._angVelZ=m}solveVelocity(){var t,i,a,s,o,n,r,_,e,h,l,c;t=this._b1._velX,i=this._b1._velY,a=this._b1._velZ,s=this._b2._velX,o=this._b2._velY,n=this._b2._velZ,r=this._b1._angVelX,_=this._b1._angVelY,e=this._b1._angVelZ,h=this._b2._angVelX,l=this._b2._angVelY,c=this._b2._angVelZ;for(var m=0,v=this.info.numRows;m<v;){var b=m++,x=this.info.rows[b],p=this.massData[b],f=x.impulse,u=0,y=x.jacobianT;u+=t*y.lin1X+i*y.lin1Y+a*y.lin1Z,u-=s*y.lin2X+o*y.lin2Y+n*y.lin2Z,u+=r*y.ang1X+_*y.ang1Y+e*y.ang1Z,u-=h*y.ang2X+l*y.ang2Y+c*y.ang2Z;var X=0;X+=t*(y=x.jacobianB).lin1X+i*y.lin1Y+a*y.lin1Z,X-=s*y.lin2X+o*y.lin2Y+n*y.lin2Z,X+=r*y.ang1X+_*y.ang1Y+e*y.ang1Z,X-=h*y.ang2X+l*y.ang2Y+c*y.ang2Z;var g=-(u*p.massTB00+X*p.massTB01),z=-(u*p.massTB10+X*p.massTB11),d=f.impulseT,Y=f.impulseB;f.impulseT+=g,f.impulseB+=z;var Z=x.friction*f.impulseN;if(0==Z)f.impulseT=0,f.impulseB=0;else{var M=f.impulseT*f.impulseT+f.impulseB*f.impulseB;if(M>Z*Z){var I=Z/Math.sqrt(M);f.impulseT*=I,f.impulseB*=I}}g=f.impulseT-d,z=f.impulseB-Y,t+=p.invMLinT1X*g,i+=p.invMLinT1Y*g,a+=p.invMLinT1Z*g,t+=p.invMLinB1X*z,i+=p.invMLinB1Y*z,a+=p.invMLinB1Z*z,s+=p.invMLinT2X*-g,o+=p.invMLinT2Y*-g,n+=p.invMLinT2Z*-g,s+=p.invMLinB2X*-z,o+=p.invMLinB2Y*-z,n+=p.invMLinB2Z*-z,r+=p.invMAngT1X*g,_+=p.invMAngT1Y*g,e+=p.invMAngT1Z*g,r+=p.invMAngB1X*z,_+=p.invMAngB1Y*z,e+=p.invMAngB1Z*z,h+=p.invMAngT2X*-g,l+=p.invMAngT2Y*-g,c+=p.invMAngT2Z*-g,h+=p.invMAngB2X*-z,l+=p.invMAngB2Y*-z,c+=p.invMAngB2Z*-z}for(var V=0,L=this.info.numRows;V<L;){var w=V++,k=this.info.rows[w],B=this.massData[w],A=k.impulse,P=0,S=k.jacobianN;P+=t*S.lin1X+i*S.lin1Y+a*S.lin1Z,P-=s*S.lin2X+o*S.lin2Y+n*S.lin2Z,P+=r*S.ang1X+_*S.ang1Y+e*S.ang1Z,P-=h*S.ang2X+l*S.ang2Y+c*S.ang2Z;var T=(k.rhs-P)*B.massN,C=A.impulseN;A.impulseN+=T,A.impulseN<0&&(A.impulseN=0),T=A.impulseN-C,t+=B.invMLinN1X*T,i+=B.invMLinN1Y*T,a+=B.invMLinN1Z*T,s+=B.invMLinN2X*-T,o+=B.invMLinN2Y*-T,n+=B.invMLinN2Z*-T,r+=B.invMAngN1X*T,_+=B.invMAngN1Y*T,e+=B.invMAngN1Z*T,h+=B.invMAngN2X*-T,l+=B.invMAngN2Y*-T,c+=B.invMAngN2Z*-T}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=a,this._b2._velX=s,this._b2._velY=o,this._b2._velZ=n,this._b1._angVelX=r,this._b1._angVelY=_,this._b1._angVelZ=e,this._b2._angVelX=h,this._b2._angVelY=l,this._b2._angVelZ=c}preSolvePosition(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);var i,a,s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y=this._b1._invMass,X=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,s=this._b1._invInertia02,o=this._b1._invInertia10,n=this._b1._invInertia11,r=this._b1._invInertia12,_=this._b1._invInertia20,e=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,v=this._b2._invInertia10,b=this._b2._invInertia11,x=this._b2._invInertia12,p=this._b2._invInertia20,f=this._b2._invInertia21,u=this._b2._invInertia22;for(var g=0,z=this.info.numRows;g<z;){var d,Y,Z,M,I,V,L=g++,w=this.info.rows[L],k=this.massData[L],B=w.jacobianN;k.invMLinN1X=B.lin1X*y,k.invMLinN1Y=B.lin1Y*y,k.invMLinN1Z=B.lin1Z*y,k.invMLinN2X=B.lin2X*X,k.invMLinN2Y=B.lin2Y*X,k.invMLinN2Z=B.lin2Z*X,d=i*B.ang1X+a*B.ang1Y+s*B.ang1Z,Y=o*B.ang1X+n*B.ang1Y+r*B.ang1Z,Z=_*B.ang1X+e*B.ang1Y+h*B.ang1Z,k.invMAngN1X=d,k.invMAngN1Y=Y,k.invMAngN1Z=Z,M=l*B.ang2X+c*B.ang2Y+m*B.ang2Z,I=v*B.ang2X+b*B.ang2Y+x*B.ang2Z,V=p*B.ang2X+f*B.ang2Y+u*B.ang2Z,k.invMAngN2X=M,k.invMAngN2Y=I,k.invMAngN2Z=V,k.massN=y+X+(k.invMAngN1X*B.ang1X+k.invMAngN1Y*B.ang1Y+k.invMAngN1Z*B.ang1Z)+(k.invMAngN2X*B.ang2X+k.invMAngN2Y*B.ang2Y+k.invMAngN2Z*B.ang2Z),0!=k.massN&&(k.massN=1/k.massN)}for(var A=0,P=this.info.numRows;A<P;){var S=A++;this.info.rows[S].impulse.impulseP=0}}solvePositionSplitImpulse(){var i,a,s,o,n,r,_,e,h,l,c,m;i=this._b1._pseudoVelX,a=this._b1._pseudoVelY,s=this._b1._pseudoVelZ,o=this._b2._pseudoVelX,n=this._b2._pseudoVelY,r=this._b2._pseudoVelZ,_=this._b1._angPseudoVelX,e=this._b1._angPseudoVelY,h=this._b1._angPseudoVelZ,l=this._b2._angPseudoVelX,c=this._b2._angPseudoVelY,m=this._b2._angPseudoVelZ;for(var v=0,b=this.info.numRows;v<b;){var x=v++,p=this.info.rows[x],f=this.massData[x],u=p.impulse,y=p.jacobianN,X=0;X+=i*y.lin1X+a*y.lin1Y+s*y.lin1Z,X-=o*y.lin2X+n*y.lin2Y+r*y.lin2Z,X+=_*y.ang1X+e*y.ang1Y+h*y.ang1Z,X-=l*y.ang2X+c*y.ang2Y+m*y.ang2Z;var g=(p.rhs-X)*f.massN*t.common.Setting.positionSplitImpulseBaumgarte,z=u.impulseP;u.impulseP+=g,u.impulseP<0&&(u.impulseP=0),g=u.impulseP-z,i+=f.invMLinN1X*g,a+=f.invMLinN1Y*g,s+=f.invMLinN1Z*g,o+=f.invMLinN2X*-g,n+=f.invMLinN2Y*-g,r+=f.invMLinN2Z*-g,_+=f.invMAngN1X*g,e+=f.invMAngN1Y*g,h+=f.invMAngN1Z*g,l+=f.invMAngN2X*-g,c+=f.invMAngN2Y*-g,m+=f.invMAngN2Z*-g}this._b1._pseudoVelX=i,this._b1._pseudoVelY=a,this._b1._pseudoVelZ=s,this._b2._pseudoVelX=o,this._b2._pseudoVelY=n,this._b2._pseudoVelZ=r,this._b1._angPseudoVelX=_,this._b1._angPseudoVelY=e,this._b1._angPseudoVelZ=h,this._b2._angPseudoVelX=l,this._b2._angPseudoVelY=c,this._b2._angPseudoVelZ=m}solvePositionNgs(i){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);var a,s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y,X=this._b1._invMass,g=this._b2._invMass;a=this._b1._invInertia00,s=this._b1._invInertia01,o=this._b1._invInertia02,n=this._b1._invInertia10,r=this._b1._invInertia11,_=this._b1._invInertia12,e=this._b1._invInertia20,h=this._b1._invInertia21,l=this._b1._invInertia22,c=this._b2._invInertia00,m=this._b2._invInertia01,v=this._b2._invInertia02,b=this._b2._invInertia10,x=this._b2._invInertia11,p=this._b2._invInertia12,f=this._b2._invInertia20,u=this._b2._invInertia21,y=this._b2._invInertia22;for(var z,d,Y,Z,M,I,V,L,w,k,B,A,P=0,S=this.info.numRows;P<S;){var T,C,j,R,q,E,D=P++,F=this.info.rows[D],N=this.massData[D],W=F.jacobianN;N.invMLinN1X=W.lin1X*X,N.invMLinN1Y=W.lin1Y*X,N.invMLinN1Z=W.lin1Z*X,N.invMLinN2X=W.lin2X*g,N.invMLinN2Y=W.lin2Y*g,N.invMLinN2Z=W.lin2Z*g,T=a*W.ang1X+s*W.ang1Y+o*W.ang1Z,C=n*W.ang1X+r*W.ang1Y+_*W.ang1Z,j=e*W.ang1X+h*W.ang1Y+l*W.ang1Z,N.invMAngN1X=T,N.invMAngN1Y=C,N.invMAngN1Z=j,R=c*W.ang2X+m*W.ang2Y+v*W.ang2Z,q=b*W.ang2X+x*W.ang2Y+p*W.ang2Z,E=f*W.ang2X+u*W.ang2Y+y*W.ang2Z,N.invMAngN2X=R,N.invMAngN2Y=q,N.invMAngN2Z=E,N.massN=X+g+(N.invMAngN1X*W.ang1X+N.invMAngN1Y*W.ang1Y+N.invMAngN1Z*W.ang1Z)+(N.invMAngN2X*W.ang2X+N.invMAngN2Y*W.ang2Y+N.invMAngN2Z*W.ang2Z),0!=N.massN&&(N.massN=1/N.massN)}z=0,d=0,Y=0,Z=0,M=0,I=0,V=0,L=0,w=0,k=0,B=0,A=0;for(var G=0,J=this.info.numRows;G<J;){var O=G++,H=this.info.rows[O],U=this.massData[O],Q=H.impulse,K=H.jacobianN,$=0;$+=z*K.lin1X+d*K.lin1Y+Y*K.lin1Z,$-=Z*K.lin2X+M*K.lin2Y+I*K.lin2Z,$+=V*K.ang1X+L*K.ang1Y+w*K.ang1Z,$-=k*K.ang2X+B*K.ang2Y+A*K.ang2Z;var tt=(H.rhs-$)*U.massN*t.common.Setting.positionNgsBaumgarte,it=Q.impulseP;Q.impulseP+=tt,Q.impulseP<0&&(Q.impulseP=0),tt=Q.impulseP-it,z+=U.invMLinN1X*tt,d+=U.invMLinN1Y*tt,Y+=U.invMLinN1Z*tt,Z+=U.invMLinN2X*-tt,M+=U.invMLinN2Y*-tt,I+=U.invMLinN2Z*-tt,V+=U.invMAngN1X*tt,L+=U.invMAngN1Y*tt,w+=U.invMAngN1Z*tt,k+=U.invMAngN2X*-tt,B+=U.invMAngN2Y*-tt,A+=U.invMAngN2Z*-tt}var at=this._b1;at._transform._positionX+=z,at._transform._positionY+=d,at._transform._positionZ+=Y;var st=this._b2;st._transform._positionX+=Z,st._transform._positionY+=M,st._transform._positionZ+=I;var ot,nt,rt,_t,et,ht,lt,ct,mt,vt,bt=this._b1,xt=Math.sqrt(V*V+L*L+w*w),pt=.5*xt;if(pt<.5){var ft=pt*pt;ot=.5*(1-.16666666666666666*ft+ft*ft*.008333333333333333),nt=1-.5*ft+ft*ft*.041666666666666664}else ot=Math.sin(pt)/xt,nt=Math.cos(pt);rt=V*ot,_t=L*ot,et=w*ot,ht=nt;var ut,yt=bt._transform._rotation00,Xt=bt._transform._rotation11,gt=bt._transform._rotation22,zt=yt+Xt+gt;zt>0?(vt=.5*(ut=Math.sqrt(zt+1)),ut=.5/ut,lt=(bt._transform._rotation21-bt._transform._rotation12)*ut,ct=(bt._transform._rotation02-bt._transform._rotation20)*ut,mt=(bt._transform._rotation10-bt._transform._rotation01)*ut):yt>Xt?yt>gt?(lt=.5*(ut=Math.sqrt(yt-Xt-gt+1)),ut=.5/ut,ct=(bt._transform._rotation01+bt._transform._rotation10)*ut,mt=(bt._transform._rotation02+bt._transform._rotation20)*ut,vt=(bt._transform._rotation21-bt._transform._rotation12)*ut):(mt=.5*(ut=Math.sqrt(gt-yt-Xt+1)),ut=.5/ut,lt=(bt._transform._rotation02+bt._transform._rotation20)*ut,ct=(bt._transform._rotation12+bt._transform._rotation21)*ut,vt=(bt._transform._rotation10-bt._transform._rotation01)*ut):Xt>gt?(ct=.5*(ut=Math.sqrt(Xt-gt-yt+1)),ut=.5/ut,lt=(bt._transform._rotation01+bt._transform._rotation10)*ut,mt=(bt._transform._rotation12+bt._transform._rotation21)*ut,vt=(bt._transform._rotation02-bt._transform._rotation20)*ut):(mt=.5*(ut=Math.sqrt(gt-yt-Xt+1)),ut=.5/ut,lt=(bt._transform._rotation02+bt._transform._rotation20)*ut,ct=(bt._transform._rotation12+bt._transform._rotation21)*ut,vt=(bt._transform._rotation10-bt._transform._rotation01)*ut);var dt=(lt=ht*lt+rt*vt+_t*mt-et*ct)*lt+(ct=ht*ct-rt*mt+_t*vt+et*lt)*ct+(mt=ht*mt+rt*ct-_t*lt+et*vt)*mt+(vt=ht*vt-rt*lt-_t*ct-et*mt)*vt;dt>1e-32&&(dt=1/Math.sqrt(dt));lt*=dt,ct*=dt,mt*=dt,vt*=dt;var Yt,Zt,Mt,It,Vt,Lt,wt,kt,Bt,At,Pt,St,Tt,Ct,jt,Rt,qt,Et,Dt=2*lt,Ft=2*ct,Nt=2*mt,Wt=lt*Dt,Gt=ct*Ft,Jt=mt*Nt,Ot=lt*Ft,Ht=ct*Nt,Ut=lt*Nt,Qt=vt*Dt,Kt=vt*Ft,$t=vt*Nt;bt._transform._rotation00=1-Gt-Jt,bt._transform._rotation01=Ot-$t,bt._transform._rotation02=Ut+Kt,bt._transform._rotation10=Ot+$t,bt._transform._rotation11=1-Wt-Jt,bt._transform._rotation12=Ht-Qt,bt._transform._rotation20=Ut-Kt,bt._transform._rotation21=Ht+Qt,bt._transform._rotation22=1-Wt-Gt,Yt=bt._transform._rotation00*bt._invLocalInertia00+bt._transform._rotation01*bt._invLocalInertia10+bt._transform._rotation02*bt._invLocalInertia20,Zt=bt._transform._rotation00*bt._invLocalInertia01+bt._transform._rotation01*bt._invLocalInertia11+bt._transform._rotation02*bt._invLocalInertia21,Mt=bt._transform._rotation00*bt._invLocalInertia02+bt._transform._rotation01*bt._invLocalInertia12+bt._transform._rotation02*bt._invLocalInertia22,It=bt._transform._rotation10*bt._invLocalInertia00+bt._transform._rotation11*bt._invLocalInertia10+bt._transform._rotation12*bt._invLocalInertia20,Vt=bt._transform._rotation10*bt._invLocalInertia01+bt._transform._rotation11*bt._invLocalInertia11+bt._transform._rotation12*bt._invLocalInertia21,Lt=bt._transform._rotation10*bt._invLocalInertia02+bt._transform._rotation11*bt._invLocalInertia12+bt._transform._rotation12*bt._invLocalInertia22,wt=bt._transform._rotation20*bt._invLocalInertia00+bt._transform._rotation21*bt._invLocalInertia10+bt._transform._rotation22*bt._invLocalInertia20,kt=bt._transform._rotation20*bt._invLocalInertia01+bt._transform._rotation21*bt._invLocalInertia11+bt._transform._rotation22*bt._invLocalInertia21,Bt=bt._transform._rotation20*bt._invLocalInertia02+bt._transform._rotation21*bt._invLocalInertia12+bt._transform._rotation22*bt._invLocalInertia22,bt._invInertia00=Yt,bt._invInertia01=Zt,bt._invInertia02=Mt,bt._invInertia10=It,bt._invInertia11=Vt,bt._invInertia12=Lt,bt._invInertia20=wt,bt._invInertia21=kt,bt._invInertia22=Bt,At=bt._invInertia00*bt._transform._rotation00+bt._invInertia01*bt._transform._rotation01+bt._invInertia02*bt._transform._rotation02,Pt=bt._invInertia00*bt._transform._rotation10+bt._invInertia01*bt._transform._rotation11+bt._invInertia02*bt._transform._rotation12,St=bt._invInertia00*bt._transform._rotation20+bt._invInertia01*bt._transform._rotation21+bt._invInertia02*bt._transform._rotation22,Tt=bt._invInertia10*bt._transform._rotation00+bt._invInertia11*bt._transform._rotation01+bt._invInertia12*bt._transform._rotation02,Ct=bt._invInertia10*bt._transform._rotation10+bt._invInertia11*bt._transform._rotation11+bt._invInertia12*bt._transform._rotation12,jt=bt._invInertia10*bt._transform._rotation20+bt._invInertia11*bt._transform._rotation21+bt._invInertia12*bt._transform._rotation22,Rt=bt._invInertia20*bt._transform._rotation00+bt._invInertia21*bt._transform._rotation01+bt._invInertia22*bt._transform._rotation02,qt=bt._invInertia20*bt._transform._rotation10+bt._invInertia21*bt._transform._rotation11+bt._invInertia22*bt._transform._rotation12,Et=bt._invInertia20*bt._transform._rotation20+bt._invInertia21*bt._transform._rotation21+bt._invInertia22*bt._transform._rotation22,bt._invInertia00=At,bt._invInertia01=Pt,bt._invInertia02=St,bt._invInertia10=Tt,bt._invInertia11=Ct,bt._invInertia12=jt,bt._invInertia20=Rt,bt._invInertia21=qt,bt._invInertia22=Et,bt._invInertia00*=bt._rotFactor.x,bt._invInertia01*=bt._rotFactor.x,bt._invInertia02*=bt._rotFactor.x,bt._invInertia10*=bt._rotFactor.y,bt._invInertia11*=bt._rotFactor.y,bt._invInertia12*=bt._rotFactor.y,bt._invInertia20*=bt._rotFactor.z,bt._invInertia21*=bt._rotFactor.z,bt._invInertia22*=bt._rotFactor.z;var ti,ii,ai,si,oi,ni,ri,_i,ei,hi,li=this._b2,ci=Math.sqrt(k*k+B*B+A*A),mi=.5*ci;if(mi<.5){var vi=mi*mi;ti=.5*(1-.16666666666666666*vi+vi*vi*.008333333333333333),ii=1-.5*vi+vi*vi*.041666666666666664}else ti=Math.sin(mi)/ci,ii=Math.cos(mi);ai=k*ti,si=B*ti,oi=A*ti,ni=ii;var bi,xi=li._transform._rotation00,pi=li._transform._rotation11,fi=li._transform._rotation22,ui=xi+pi+fi;ui>0?(hi=.5*(bi=Math.sqrt(ui+1)),bi=.5/bi,ri=(li._transform._rotation21-li._transform._rotation12)*bi,_i=(li._transform._rotation02-li._transform._rotation20)*bi,ei=(li._transform._rotation10-li._transform._rotation01)*bi):xi>pi?xi>fi?(ri=.5*(bi=Math.sqrt(xi-pi-fi+1)),bi=.5/bi,_i=(li._transform._rotation01+li._transform._rotation10)*bi,ei=(li._transform._rotation02+li._transform._rotation20)*bi,hi=(li._transform._rotation21-li._transform._rotation12)*bi):(ei=.5*(bi=Math.sqrt(fi-xi-pi+1)),bi=.5/bi,ri=(li._transform._rotation02+li._transform._rotation20)*bi,_i=(li._transform._rotation12+li._transform._rotation21)*bi,hi=(li._transform._rotation10-li._transform._rotation01)*bi):pi>fi?(_i=.5*(bi=Math.sqrt(pi-fi-xi+1)),bi=.5/bi,ri=(li._transform._rotation01+li._transform._rotation10)*bi,ei=(li._transform._rotation12+li._transform._rotation21)*bi,hi=(li._transform._rotation02-li._transform._rotation20)*bi):(ei=.5*(bi=Math.sqrt(fi-xi-pi+1)),bi=.5/bi,ri=(li._transform._rotation02+li._transform._rotation20)*bi,_i=(li._transform._rotation12+li._transform._rotation21)*bi,hi=(li._transform._rotation10-li._transform._rotation01)*bi);var yi=(ri=ni*ri+ai*hi+si*ei-oi*_i)*ri+(_i=ni*_i-ai*ei+si*hi+oi*ri)*_i+(ei=ni*ei+ai*_i-si*ri+oi*hi)*ei+(hi=ni*hi-ai*ri-si*_i-oi*ei)*hi;yi>1e-32&&(yi=1/Math.sqrt(yi));ri*=yi,_i*=yi,ei*=yi,hi*=yi;var Xi,gi,zi,di,Yi,Zi,Mi,Ii,Vi,Li,wi,ki,Bi,Ai,Pi,Si,Ti,Ci,ji=2*ri,Ri=2*_i,qi=2*ei,Ei=ri*ji,Di=_i*Ri,Fi=ei*qi,Ni=ri*Ri,Wi=_i*qi,Gi=ri*qi,Ji=hi*ji,Oi=hi*Ri,Hi=hi*qi;li._transform._rotation00=1-Di-Fi,li._transform._rotation01=Ni-Hi,li._transform._rotation02=Gi+Oi,li._transform._rotation10=Ni+Hi,li._transform._rotation11=1-Ei-Fi,li._transform._rotation12=Wi-Ji,li._transform._rotation20=Gi-Oi,li._transform._rotation21=Wi+Ji,li._transform._rotation22=1-Ei-Di,Xi=li._transform._rotation00*li._invLocalInertia00+li._transform._rotation01*li._invLocalInertia10+li._transform._rotation02*li._invLocalInertia20,gi=li._transform._rotation00*li._invLocalInertia01+li._transform._rotation01*li._invLocalInertia11+li._transform._rotation02*li._invLocalInertia21,zi=li._transform._rotation00*li._invLocalInertia02+li._transform._rotation01*li._invLocalInertia12+li._transform._rotation02*li._invLocalInertia22,di=li._transform._rotation10*li._invLocalInertia00+li._transform._rotation11*li._invLocalInertia10+li._transform._rotation12*li._invLocalInertia20,Yi=li._transform._rotation10*li._invLocalInertia01+li._transform._rotation11*li._invLocalInertia11+li._transform._rotation12*li._invLocalInertia21,Zi=li._transform._rotation10*li._invLocalInertia02+li._transform._rotation11*li._invLocalInertia12+li._transform._rotation12*li._invLocalInertia22,Mi=li._transform._rotation20*li._invLocalInertia00+li._transform._rotation21*li._invLocalInertia10+li._transform._rotation22*li._invLocalInertia20,Ii=li._transform._rotation20*li._invLocalInertia01+li._transform._rotation21*li._invLocalInertia11+li._transform._rotation22*li._invLocalInertia21,Vi=li._transform._rotation20*li._invLocalInertia02+li._transform._rotation21*li._invLocalInertia12+li._transform._rotation22*li._invLocalInertia22,li._invInertia00=Xi,li._invInertia01=gi,li._invInertia02=zi,li._invInertia10=di,li._invInertia11=Yi,li._invInertia12=Zi,li._invInertia20=Mi,li._invInertia21=Ii,li._invInertia22=Vi,Li=li._invInertia00*li._transform._rotation00+li._invInertia01*li._transform._rotation01+li._invInertia02*li._transform._rotation02,wi=li._invInertia00*li._transform._rotation10+li._invInertia01*li._transform._rotation11+li._invInertia02*li._transform._rotation12,ki=li._invInertia00*li._transform._rotation20+li._invInertia01*li._transform._rotation21+li._invInertia02*li._transform._rotation22,Bi=li._invInertia10*li._transform._rotation00+li._invInertia11*li._transform._rotation01+li._invInertia12*li._transform._rotation02,Ai=li._invInertia10*li._transform._rotation10+li._invInertia11*li._transform._rotation11+li._invInertia12*li._transform._rotation12,Pi=li._invInertia10*li._transform._rotation20+li._invInertia11*li._transform._rotation21+li._invInertia12*li._transform._rotation22,Si=li._invInertia20*li._transform._rotation00+li._invInertia21*li._transform._rotation01+li._invInertia22*li._transform._rotation02,Ti=li._invInertia20*li._transform._rotation10+li._invInertia21*li._transform._rotation11+li._invInertia22*li._transform._rotation12,Ci=li._invInertia20*li._transform._rotation20+li._invInertia21*li._transform._rotation21+li._invInertia22*li._transform._rotation22,li._invInertia00=Li,li._invInertia01=wi,li._invInertia02=ki,li._invInertia10=Bi,li._invInertia11=Ai,li._invInertia12=Pi,li._invInertia20=Si,li._invInertia21=Ti,li._invInertia22=Ci,li._invInertia00*=li._rotFactor.x,li._invInertia01*=li._rotFactor.x,li._invInertia02*=li._rotFactor.x,li._invInertia10*=li._rotFactor.y,li._invInertia11*=li._rotFactor.y,li._invInertia12*=li._rotFactor.y,li._invInertia20*=li._rotFactor.z,li._invInertia21*=li._rotFactor.z,li._invInertia22*=li._rotFactor.z}postSolve(){var t,i,a,s,o,n,r,_,e;t=0,i=0,a=0,s=0,o=0,n=0,r=0,_=0,e=0;for(var h=0,l=this.info.numRows;h<l;){var c,m,v,b=h++,x=this.info.rows[b],p=x.impulse,f=x.jacobianN,u=x.jacobianT,y=x.jacobianB,X=p.impulseN,g=p.impulseT,z=p.impulseB;c=0,m=0,v=0,c+=u.lin1X*g,m+=u.lin1Y*g,v+=u.lin1Z*g,c+=y.lin1X*z,m+=y.lin1Y*z,v+=y.lin1Z*z,p.impulseLX=c,p.impulseLY=m,p.impulseLZ=v,t+=f.lin1X*X,i+=f.lin1Y*X,a+=f.lin1Z*X,s+=f.ang1X*X,o+=f.ang1Y*X,n+=f.ang1Z*X,r+=f.ang2X*X,_+=f.ang2Y*X,e+=f.ang2Z*X,t+=u.lin1X*g,i+=u.lin1Y*g,a+=u.lin1Z*g,s+=u.ang1X*g,o+=u.ang1Y*g,n+=u.ang1Z*g,r+=u.ang2X*g,_+=u.ang2Y*g,e+=u.ang2Z*g,t+=y.lin1X*z,i+=y.lin1Y*z,a+=y.lin1Z*z,s+=y.ang1X*z,o+=y.ang1Y*z,n+=y.ang1Z*z,r+=y.ang2X*z,_+=y.ang2Y*z,e+=y.ang2Z*z}this._b1._linearContactImpulseX+=t,this._b1._linearContactImpulseY+=i,this._b1._linearContactImpulseZ+=a,this._b1._angularContactImpulseX+=s,this._b1._angularContactImpulseY+=o,this._b1._angularContactImpulseZ+=n,this._b2._linearContactImpulseX-=t,this._b2._linearContactImpulseY-=i,this._b2._linearContactImpulseZ-=a,this._b2._angularContactImpulseX-=r,this._b2._angularContactImpulseY-=_,this._b2._angularContactImpulseZ-=e,this.constraint._syncManifold()}},t.dynamics.constraint.solver.pgs.PgsJointConstraintSolver=class extends t.dynamics.constraint.ConstraintSolver{constructor(i){super(),this.joint=i,this.info=new t.dynamics.constraint.info.joint.JointSolverInfo;var a=new Array(t.common.Setting.maxJacobianRows);this.massData=a;for(var s=0,o=this.massData.length;s<o;){var n=s++;this.massData[n]=new t.dynamics.constraint.solver.common.JointSolverMassDataRow}}preSolveVelocity(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;var i,a,s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y=this._b1._invMass,X=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,s=this._b1._invInertia02,o=this._b1._invInertia10,n=this._b1._invInertia11,r=this._b1._invInertia12,_=this._b1._invInertia20,e=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,v=this._b2._invInertia10,b=this._b2._invInertia11,x=this._b2._invInertia12,p=this._b2._invInertia20,f=this._b2._invInertia21,u=this._b2._invInertia22;for(var g=0,z=this.info.numRows;g<z;){var d,Y,Z,M,I,V,L=g++,w=this.info.rows[L],k=this.massData[L],B=w.jacobian;if(B.updateSparsity(),0!=(1&B.flag)?(k.invMLin1X=B.lin1X*y,k.invMLin1Y=B.lin1Y*y,k.invMLin1Z=B.lin1Z*y,k.invMLin2X=B.lin2X*X,k.invMLin2Y=B.lin2Y*X,k.invMLin2Z=B.lin2Z*X):(k.invMLin1X=0,k.invMLin1Y=0,k.invMLin1Z=0,k.invMLin2X=0,k.invMLin2Y=0,k.invMLin2Z=0),0!=(2&B.flag))d=i*B.ang1X+a*B.ang1Y+s*B.ang1Z,Y=o*B.ang1X+n*B.ang1Y+r*B.ang1Z,Z=_*B.ang1X+e*B.ang1Y+h*B.ang1Z,k.invMAng1X=d,k.invMAng1Y=Y,k.invMAng1Z=Z,M=l*B.ang2X+c*B.ang2Y+m*B.ang2Z,I=v*B.ang2X+b*B.ang2Y+x*B.ang2Z,V=p*B.ang2X+f*B.ang2Y+u*B.ang2Z,k.invMAng2X=M,k.invMAng2Y=I,k.invMAng2Z=V;else k.invMAng1X=0,k.invMAng1Y=0,k.invMAng1Z=0,k.invMAng2X=0,k.invMAng2Y=0,k.invMAng2Z=0;k.massWithoutCfm=k.invMLin1X*B.lin1X+k.invMLin1Y*B.lin1Y+k.invMLin1Z*B.lin1Z+(k.invMLin2X*B.lin2X+k.invMLin2Y*B.lin2Y+k.invMLin2Z*B.lin2Z)+(k.invMAng1X*B.ang1X+k.invMAng1Y*B.ang1Y+k.invMAng1Z*B.ang1Z)+(k.invMAng2X*B.ang2X+k.invMAng2Y*B.ang2Y+k.invMAng2Z*B.ang2Z),k.mass=k.massWithoutCfm+w.cfm,0!=k.massWithoutCfm&&(k.massWithoutCfm=1/k.massWithoutCfm),0!=k.mass&&(k.mass=1/k.mass)}}warmStart(i){var a=this.joint._positionCorrectionAlgorithm==t.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?t.common.Setting.jointWarmStartingFactorForBaungarte:t.common.Setting.jointWarmStartingFactor;if((a*=i.dtRatio)<=0)for(var s=0,o=this.info.numRows;s<o;){var n=s++,r=this.info.rows[n].impulse;r.impulse=0,r.impulseM=0,r.impulseP=0}else{var _,e,h,l,c,m,v,b,x,p,f,u;_=this._b1._velX,e=this._b1._velY,h=this._b1._velZ,l=this._b2._velX,c=this._b2._velY,m=this._b2._velZ,v=this._b1._angVelX,b=this._b1._angVelY,x=this._b1._angVelZ,p=this._b2._angVelX,f=this._b2._angVelY,u=this._b2._angVelZ;for(var y=0,X=this.info.numRows;y<X;){var g=y++,z=this.info.rows[g],d=this.massData[g],Y=z.impulse;z.jacobian,Y.impulse*=a,Y.impulseM*=a;var Z=Y.impulse+Y.impulseM;_+=d.invMLin1X*Z,e+=d.invMLin1Y*Z,h+=d.invMLin1Z*Z,l+=d.invMLin2X*-Z,c+=d.invMLin2Y*-Z,m+=d.invMLin2Z*-Z,v+=d.invMAng1X*Z,b+=d.invMAng1Y*Z,x+=d.invMAng1Z*Z,p+=d.invMAng2X*-Z,f+=d.invMAng2Y*-Z,u+=d.invMAng2Z*-Z}this._b1._velX=_,this._b1._velY=e,this._b1._velZ=h,this._b2._velX=l,this._b2._velY=c,this._b2._velZ=m,this._b1._angVelX=v,this._b1._angVelY=b,this._b1._angVelZ=x,this._b2._angVelX=p,this._b2._angVelY=f,this._b2._angVelZ=u}}solveVelocity(){var t,i,a,s,o,n,r,_,e,h,l,c;t=this._b1._velX,i=this._b1._velY,a=this._b1._velZ,s=this._b2._velX,o=this._b2._velY,n=this._b2._velZ,r=this._b1._angVelX,_=this._b1._angVelY,e=this._b1._angVelZ,h=this._b2._angVelX,l=this._b2._angVelY,c=this._b2._angVelZ;for(var m=0,v=this.info.numRows;m<v;){var b=m++,x=this.info.rows[b],p=this.massData[b],f=x.impulse,u=x.jacobian;if(0!=x.motorMaxImpulse){var y=0;y+=t*u.lin1X+i*u.lin1Y+a*u.lin1Z,y-=s*u.lin2X+o*u.lin2Y+n*u.lin2Z,y+=r*u.ang1X+_*u.ang1Y+e*u.ang1Z,y-=h*u.ang2X+l*u.ang2Y+c*u.ang2Z;var X=(-x.motorSpeed-y)*p.massWithoutCfm,g=f.impulseM;f.impulseM+=X,f.impulseM<-x.motorMaxImpulse?f.impulseM=-x.motorMaxImpulse:f.impulseM>x.motorMaxImpulse&&(f.impulseM=x.motorMaxImpulse),X=f.impulseM-g,0!=(1&u.flag)&&(t+=p.invMLin1X*X,i+=p.invMLin1Y*X,a+=p.invMLin1Z*X,s+=p.invMLin2X*-X,o+=p.invMLin2Y*-X,n+=p.invMLin2Z*-X),0!=(2&u.flag)&&(r+=p.invMAng1X*X,_+=p.invMAng1Y*X,e+=p.invMAng1Z*X,h+=p.invMAng2X*-X,l+=p.invMAng2Y*-X,c+=p.invMAng2Z*-X)}}for(var z=0,d=this.info.numRows;z<d;){var Y=z++,Z=this.info.rows[Y],M=this.massData[Y],I=Z.impulse,V=Z.jacobian,L=0;L+=t*V.lin1X+i*V.lin1Y+a*V.lin1Z,L-=s*V.lin2X+o*V.lin2Y+n*V.lin2Z,L+=r*V.ang1X+_*V.ang1Y+e*V.ang1Z,L-=h*V.ang2X+l*V.ang2Y+c*V.ang2Z;var w=(Z.rhs-L-I.impulse*Z.cfm)*M.mass,k=I.impulse;I.impulse+=w,I.impulse<Z.minImpulse?I.impulse=Z.minImpulse:I.impulse>Z.maxImpulse&&(I.impulse=Z.maxImpulse),w=I.impulse-k,0!=(1&V.flag)&&(t+=M.invMLin1X*w,i+=M.invMLin1Y*w,a+=M.invMLin1Z*w,s+=M.invMLin2X*-w,o+=M.invMLin2Y*-w,n+=M.invMLin2Z*-w),0!=(2&V.flag)&&(r+=M.invMAng1X*w,_+=M.invMAng1Y*w,e+=M.invMAng1Z*w,h+=M.invMAng2X*-w,l+=M.invMAng2Y*-w,c+=M.invMAng2Z*-w)}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=a,this._b2._velX=s,this._b2._velY=o,this._b2._velZ=n,this._b1._angVelX=r,this._b1._angVelY=_,this._b1._angVelZ=e,this._b2._angVelX=h,this._b2._angVelY=l,this._b2._angVelZ=c}postSolveVelocity(t){var i,a,s,o,n,r;i=0,a=0,s=0,o=0,n=0,r=0;for(var _=0,e=this.info.numRows;_<e;){var h=_++,l=this.info.rows[h],c=l.impulse,m=l.jacobian;0!=(1&m.flag)?(i+=m.lin1X*c.impulse,a+=m.lin1Y*c.impulse,s+=m.lin1Z*c.impulse):0!=(2&m.flag)&&(o+=m.ang1X*c.impulse,n+=m.ang1Y*c.impulse,r+=m.ang1Z*c.impulse)}this.joint._appliedForceX=i*t.invDt,this.joint._appliedForceY=a*t.invDt,this.joint._appliedForceZ=s*t.invDt,this.joint._appliedTorqueX=o*t.invDt,this.joint._appliedTorqueY=n*t.invDt,this.joint._appliedTorqueZ=r*t.invDt}preSolvePosition(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;var i,a,s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y=this._b1._invMass,X=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,s=this._b1._invInertia02,o=this._b1._invInertia10,n=this._b1._invInertia11,r=this._b1._invInertia12,_=this._b1._invInertia20,e=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,v=this._b2._invInertia10,b=this._b2._invInertia11,x=this._b2._invInertia12,p=this._b2._invInertia20,f=this._b2._invInertia21,u=this._b2._invInertia22;for(var g=0,z=this.info.numRows;g<z;){var d=g++,Y=this.info.rows[d],Z=this.massData[d];Y.impulse;var M,I,V,L,w,k,B=Y.jacobian;Z.invMLin1X=B.lin1X*y,Z.invMLin1Y=B.lin1Y*y,Z.invMLin1Z=B.lin1Z*y,Z.invMLin2X=B.lin2X*X,Z.invMLin2Y=B.lin2Y*X,Z.invMLin2Z=B.lin2Z*X,M=i*B.ang1X+a*B.ang1Y+s*B.ang1Z,I=o*B.ang1X+n*B.ang1Y+r*B.ang1Z,V=_*B.ang1X+e*B.ang1Y+h*B.ang1Z,Z.invMAng1X=M,Z.invMAng1Y=I,Z.invMAng1Z=V,L=l*B.ang2X+c*B.ang2Y+m*B.ang2Z,w=v*B.ang2X+b*B.ang2Y+x*B.ang2Z,k=p*B.ang2X+f*B.ang2Y+u*B.ang2Z,Z.invMAng2X=L,Z.invMAng2Y=w,Z.invMAng2Z=k,Z.mass=Z.invMLin1X*B.lin1X+Z.invMLin1Y*B.lin1Y+Z.invMLin1Z*B.lin1Z+(Z.invMLin2X*B.lin2X+Z.invMLin2Y*B.lin2Y+Z.invMLin2Z*B.lin2Z)+(Z.invMAng1X*B.ang1X+Z.invMAng1Y*B.ang1Y+Z.invMAng1Z*B.ang1Z)+(Z.invMAng2X*B.ang2X+Z.invMAng2Y*B.ang2Y+Z.invMAng2Z*B.ang2Z),0!=Z.mass&&(Z.mass=1/Z.mass)}for(var A=0,P=this.info.numRows;A<P;){var S=A++;this.info.rows[S].impulse.impulseP=0}}solvePositionSplitImpulse(){var i,a,s,o,n,r,_,e,h,l,c,m;i=this._b1._pseudoVelX,a=this._b1._pseudoVelY,s=this._b1._pseudoVelZ,o=this._b2._pseudoVelX,n=this._b2._pseudoVelY,r=this._b2._pseudoVelZ,_=this._b1._angPseudoVelX,e=this._b1._angPseudoVelY,h=this._b1._angPseudoVelZ,l=this._b2._angPseudoVelX,c=this._b2._angPseudoVelY,m=this._b2._angPseudoVelZ;for(var v=0,b=this.info.numRows;v<b;){var x=v++,p=this.info.rows[x],f=this.massData[x],u=p.impulse,y=p.jacobian,X=0;X+=i*y.lin1X+a*y.lin1Y+s*y.lin1Z,X-=o*y.lin2X+n*y.lin2Y+r*y.lin2Z,X+=_*y.ang1X+e*y.ang1Y+h*y.ang1Z,X-=l*y.ang2X+c*y.ang2Y+m*y.ang2Z;var g=(p.rhs*t.common.Setting.positionSplitImpulseBaumgarte-X)*f.mass,z=u.impulseP;u.impulseP+=g,u.impulseP<p.minImpulse?u.impulseP=p.minImpulse:u.impulseP>p.maxImpulse&&(u.impulseP=p.maxImpulse),g=u.impulseP-z,i+=f.invMLin1X*g,a+=f.invMLin1Y*g,s+=f.invMLin1Z*g,o+=f.invMLin2X*-g,n+=f.invMLin2Y*-g,r+=f.invMLin2Z*-g,_+=f.invMAng1X*g,e+=f.invMAng1Y*g,h+=f.invMAng1Z*g,l+=f.invMAng2X*-g,c+=f.invMAng2Y*-g,m+=f.invMAng2Z*-g}this._b1._pseudoVelX=i,this._b1._pseudoVelY=a,this._b1._pseudoVelZ=s,this._b2._pseudoVelX=o,this._b2._pseudoVelY=n,this._b2._pseudoVelZ=r,this._b1._angPseudoVelX=_,this._b1._angPseudoVelY=e,this._b1._angPseudoVelZ=h,this._b2._angPseudoVelX=l,this._b2._angPseudoVelY=c,this._b2._angPseudoVelZ=m}solvePositionNgs(i){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;var a,s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y,X=this._b1._invMass,g=this._b2._invMass;a=this._b1._invInertia00,s=this._b1._invInertia01,o=this._b1._invInertia02,n=this._b1._invInertia10,r=this._b1._invInertia11,_=this._b1._invInertia12,e=this._b1._invInertia20,h=this._b1._invInertia21,l=this._b1._invInertia22,c=this._b2._invInertia00,m=this._b2._invInertia01,v=this._b2._invInertia02,b=this._b2._invInertia10,x=this._b2._invInertia11,p=this._b2._invInertia12,f=this._b2._invInertia20,u=this._b2._invInertia21,y=this._b2._invInertia22;for(var z,d,Y,Z,M,I,V,L,w,k,B,A,P=0,S=this.info.numRows;P<S;){var T=P++,C=this.info.rows[T],j=this.massData[T];C.impulse;var R,q,E,D,F,N,W=C.jacobian;j.invMLin1X=W.lin1X*X,j.invMLin1Y=W.lin1Y*X,j.invMLin1Z=W.lin1Z*X,j.invMLin2X=W.lin2X*g,j.invMLin2Y=W.lin2Y*g,j.invMLin2Z=W.lin2Z*g,R=a*W.ang1X+s*W.ang1Y+o*W.ang1Z,q=n*W.ang1X+r*W.ang1Y+_*W.ang1Z,E=e*W.ang1X+h*W.ang1Y+l*W.ang1Z,j.invMAng1X=R,j.invMAng1Y=q,j.invMAng1Z=E,D=c*W.ang2X+m*W.ang2Y+v*W.ang2Z,F=b*W.ang2X+x*W.ang2Y+p*W.ang2Z,N=f*W.ang2X+u*W.ang2Y+y*W.ang2Z,j.invMAng2X=D,j.invMAng2Y=F,j.invMAng2Z=N,j.mass=j.invMLin1X*W.lin1X+j.invMLin1Y*W.lin1Y+j.invMLin1Z*W.lin1Z+(j.invMLin2X*W.lin2X+j.invMLin2Y*W.lin2Y+j.invMLin2Z*W.lin2Z)+(j.invMAng1X*W.ang1X+j.invMAng1Y*W.ang1Y+j.invMAng1Z*W.ang1Z)+(j.invMAng2X*W.ang2X+j.invMAng2Y*W.ang2Y+j.invMAng2Z*W.ang2Z),0!=j.mass&&(j.mass=1/j.mass)}z=0,d=0,Y=0,Z=0,M=0,I=0,V=0,L=0,w=0,k=0,B=0,A=0;for(var G=0,J=this.info.numRows;G<J;){var O=G++,H=this.info.rows[O],U=this.massData[O],Q=H.impulse,K=H.jacobian,$=0;$+=z*K.lin1X+d*K.lin1Y+Y*K.lin1Z,$-=Z*K.lin2X+M*K.lin2Y+I*K.lin2Z,$+=V*K.ang1X+L*K.ang1Y+w*K.ang1Z,$-=k*K.ang2X+B*K.ang2Y+A*K.ang2Z;var tt=(H.rhs*t.common.Setting.positionNgsBaumgarte-$)*U.mass,it=Q.impulseP;Q.impulseP+=tt,Q.impulseP<H.minImpulse?Q.impulseP=H.minImpulse:Q.impulseP>H.maxImpulse&&(Q.impulseP=H.maxImpulse),tt=Q.impulseP-it,z+=U.invMLin1X*tt,d+=U.invMLin1Y*tt,Y+=U.invMLin1Z*tt,Z+=U.invMLin2X*-tt,M+=U.invMLin2Y*-tt,I+=U.invMLin2Z*-tt,V+=U.invMAng1X*tt,L+=U.invMAng1Y*tt,w+=U.invMAng1Z*tt,k+=U.invMAng2X*-tt,B+=U.invMAng2Y*-tt,A+=U.invMAng2Z*-tt}var at=this._b1;at._transform._positionX+=z,at._transform._positionY+=d,at._transform._positionZ+=Y;var st=this._b2;st._transform._positionX+=Z,st._transform._positionY+=M,st._transform._positionZ+=I;var ot,nt,rt,_t,et,ht,lt,ct,mt,vt,bt=this._b1,xt=Math.sqrt(V*V+L*L+w*w),pt=.5*xt;if(pt<.5){var ft=pt*pt;ot=.5*(1-.16666666666666666*ft+ft*ft*.008333333333333333),nt=1-.5*ft+ft*ft*.041666666666666664}else ot=Math.sin(pt)/xt,nt=Math.cos(pt);rt=V*ot,_t=L*ot,et=w*ot,ht=nt;var ut,yt=bt._transform._rotation00,Xt=bt._transform._rotation11,gt=bt._transform._rotation22,zt=yt+Xt+gt;zt>0?(vt=.5*(ut=Math.sqrt(zt+1)),ut=.5/ut,lt=(bt._transform._rotation21-bt._transform._rotation12)*ut,ct=(bt._transform._rotation02-bt._transform._rotation20)*ut,mt=(bt._transform._rotation10-bt._transform._rotation01)*ut):yt>Xt?yt>gt?(lt=.5*(ut=Math.sqrt(yt-Xt-gt+1)),ut=.5/ut,ct=(bt._transform._rotation01+bt._transform._rotation10)*ut,mt=(bt._transform._rotation02+bt._transform._rotation20)*ut,vt=(bt._transform._rotation21-bt._transform._rotation12)*ut):(mt=.5*(ut=Math.sqrt(gt-yt-Xt+1)),ut=.5/ut,lt=(bt._transform._rotation02+bt._transform._rotation20)*ut,ct=(bt._transform._rotation12+bt._transform._rotation21)*ut,vt=(bt._transform._rotation10-bt._transform._rotation01)*ut):Xt>gt?(ct=.5*(ut=Math.sqrt(Xt-gt-yt+1)),ut=.5/ut,lt=(bt._transform._rotation01+bt._transform._rotation10)*ut,mt=(bt._transform._rotation12+bt._transform._rotation21)*ut,vt=(bt._transform._rotation02-bt._transform._rotation20)*ut):(mt=.5*(ut=Math.sqrt(gt-yt-Xt+1)),ut=.5/ut,lt=(bt._transform._rotation02+bt._transform._rotation20)*ut,ct=(bt._transform._rotation12+bt._transform._rotation21)*ut,vt=(bt._transform._rotation10-bt._transform._rotation01)*ut);var dt=(lt=ht*lt+rt*vt+_t*mt-et*ct)*lt+(ct=ht*ct-rt*mt+_t*vt+et*lt)*ct+(mt=ht*mt+rt*ct-_t*lt+et*vt)*mt+(vt=ht*vt-rt*lt-_t*ct-et*mt)*vt;dt>1e-32&&(dt=1/Math.sqrt(dt));lt*=dt,ct*=dt,mt*=dt,vt*=dt;var Yt,Zt,Mt,It,Vt,Lt,wt,kt,Bt,At,Pt,St,Tt,Ct,jt,Rt,qt,Et,Dt=2*lt,Ft=2*ct,Nt=2*mt,Wt=lt*Dt,Gt=ct*Ft,Jt=mt*Nt,Ot=lt*Ft,Ht=ct*Nt,Ut=lt*Nt,Qt=vt*Dt,Kt=vt*Ft,$t=vt*Nt;bt._transform._rotation00=1-Gt-Jt,bt._transform._rotation01=Ot-$t,bt._transform._rotation02=Ut+Kt,bt._transform._rotation10=Ot+$t,bt._transform._rotation11=1-Wt-Jt,bt._transform._rotation12=Ht-Qt,bt._transform._rotation20=Ut-Kt,bt._transform._rotation21=Ht+Qt,bt._transform._rotation22=1-Wt-Gt,Yt=bt._transform._rotation00*bt._invLocalInertia00+bt._transform._rotation01*bt._invLocalInertia10+bt._transform._rotation02*bt._invLocalInertia20,Zt=bt._transform._rotation00*bt._invLocalInertia01+bt._transform._rotation01*bt._invLocalInertia11+bt._transform._rotation02*bt._invLocalInertia21,Mt=bt._transform._rotation00*bt._invLocalInertia02+bt._transform._rotation01*bt._invLocalInertia12+bt._transform._rotation02*bt._invLocalInertia22,It=bt._transform._rotation10*bt._invLocalInertia00+bt._transform._rotation11*bt._invLocalInertia10+bt._transform._rotation12*bt._invLocalInertia20,Vt=bt._transform._rotation10*bt._invLocalInertia01+bt._transform._rotation11*bt._invLocalInertia11+bt._transform._rotation12*bt._invLocalInertia21,Lt=bt._transform._rotation10*bt._invLocalInertia02+bt._transform._rotation11*bt._invLocalInertia12+bt._transform._rotation12*bt._invLocalInertia22,wt=bt._transform._rotation20*bt._invLocalInertia00+bt._transform._rotation21*bt._invLocalInertia10+bt._transform._rotation22*bt._invLocalInertia20,kt=bt._transform._rotation20*bt._invLocalInertia01+bt._transform._rotation21*bt._invLocalInertia11+bt._transform._rotation22*bt._invLocalInertia21,Bt=bt._transform._rotation20*bt._invLocalInertia02+bt._transform._rotation21*bt._invLocalInertia12+bt._transform._rotation22*bt._invLocalInertia22,bt._invInertia00=Yt,bt._invInertia01=Zt,bt._invInertia02=Mt,bt._invInertia10=It,bt._invInertia11=Vt,bt._invInertia12=Lt,bt._invInertia20=wt,bt._invInertia21=kt,bt._invInertia22=Bt,At=bt._invInertia00*bt._transform._rotation00+bt._invInertia01*bt._transform._rotation01+bt._invInertia02*bt._transform._rotation02,Pt=bt._invInertia00*bt._transform._rotation10+bt._invInertia01*bt._transform._rotation11+bt._invInertia02*bt._transform._rotation12,St=bt._invInertia00*bt._transform._rotation20+bt._invInertia01*bt._transform._rotation21+bt._invInertia02*bt._transform._rotation22,Tt=bt._invInertia10*bt._transform._rotation00+bt._invInertia11*bt._transform._rotation01+bt._invInertia12*bt._transform._rotation02,Ct=bt._invInertia10*bt._transform._rotation10+bt._invInertia11*bt._transform._rotation11+bt._invInertia12*bt._transform._rotation12,jt=bt._invInertia10*bt._transform._rotation20+bt._invInertia11*bt._transform._rotation21+bt._invInertia12*bt._transform._rotation22,Rt=bt._invInertia20*bt._transform._rotation00+bt._invInertia21*bt._transform._rotation01+bt._invInertia22*bt._transform._rotation02,qt=bt._invInertia20*bt._transform._rotation10+bt._invInertia21*bt._transform._rotation11+bt._invInertia22*bt._transform._rotation12,Et=bt._invInertia20*bt._transform._rotation20+bt._invInertia21*bt._transform._rotation21+bt._invInertia22*bt._transform._rotation22,bt._invInertia00=At,bt._invInertia01=Pt,bt._invInertia02=St,bt._invInertia10=Tt,bt._invInertia11=Ct,bt._invInertia12=jt,bt._invInertia20=Rt,bt._invInertia21=qt,bt._invInertia22=Et,bt._invInertia00*=bt._rotFactor.x,bt._invInertia01*=bt._rotFactor.x,bt._invInertia02*=bt._rotFactor.x,bt._invInertia10*=bt._rotFactor.y,bt._invInertia11*=bt._rotFactor.y,bt._invInertia12*=bt._rotFactor.y,bt._invInertia20*=bt._rotFactor.z,bt._invInertia21*=bt._rotFactor.z,bt._invInertia22*=bt._rotFactor.z;var ti,ii,ai,si,oi,ni,ri,_i,ei,hi,li=this._b2,ci=Math.sqrt(k*k+B*B+A*A),mi=.5*ci;if(mi<.5){var vi=mi*mi;ti=.5*(1-.16666666666666666*vi+vi*vi*.008333333333333333),ii=1-.5*vi+vi*vi*.041666666666666664}else ti=Math.sin(mi)/ci,ii=Math.cos(mi);ai=k*ti,si=B*ti,oi=A*ti,ni=ii;var bi,xi=li._transform._rotation00,pi=li._transform._rotation11,fi=li._transform._rotation22,ui=xi+pi+fi;ui>0?(hi=.5*(bi=Math.sqrt(ui+1)),bi=.5/bi,ri=(li._transform._rotation21-li._transform._rotation12)*bi,_i=(li._transform._rotation02-li._transform._rotation20)*bi,ei=(li._transform._rotation10-li._transform._rotation01)*bi):xi>pi?xi>fi?(ri=.5*(bi=Math.sqrt(xi-pi-fi+1)),bi=.5/bi,_i=(li._transform._rotation01+li._transform._rotation10)*bi,ei=(li._transform._rotation02+li._transform._rotation20)*bi,hi=(li._transform._rotation21-li._transform._rotation12)*bi):(ei=.5*(bi=Math.sqrt(fi-xi-pi+1)),bi=.5/bi,ri=(li._transform._rotation02+li._transform._rotation20)*bi,_i=(li._transform._rotation12+li._transform._rotation21)*bi,hi=(li._transform._rotation10-li._transform._rotation01)*bi):pi>fi?(_i=.5*(bi=Math.sqrt(pi-fi-xi+1)),bi=.5/bi,ri=(li._transform._rotation01+li._transform._rotation10)*bi,ei=(li._transform._rotation12+li._transform._rotation21)*bi,hi=(li._transform._rotation02-li._transform._rotation20)*bi):(ei=.5*(bi=Math.sqrt(fi-xi-pi+1)),bi=.5/bi,ri=(li._transform._rotation02+li._transform._rotation20)*bi,_i=(li._transform._rotation12+li._transform._rotation21)*bi,hi=(li._transform._rotation10-li._transform._rotation01)*bi);var yi=(ri=ni*ri+ai*hi+si*ei-oi*_i)*ri+(_i=ni*_i-ai*ei+si*hi+oi*ri)*_i+(ei=ni*ei+ai*_i-si*ri+oi*hi)*ei+(hi=ni*hi-ai*ri-si*_i-oi*ei)*hi;yi>1e-32&&(yi=1/Math.sqrt(yi));ri*=yi,_i*=yi,ei*=yi,hi*=yi;var Xi,gi,zi,di,Yi,Zi,Mi,Ii,Vi,Li,wi,ki,Bi,Ai,Pi,Si,Ti,Ci,ji=2*ri,Ri=2*_i,qi=2*ei,Ei=ri*ji,Di=_i*Ri,Fi=ei*qi,Ni=ri*Ri,Wi=_i*qi,Gi=ri*qi,Ji=hi*ji,Oi=hi*Ri,Hi=hi*qi;li._transform._rotation00=1-Di-Fi,li._transform._rotation01=Ni-Hi,li._transform._rotation02=Gi+Oi,li._transform._rotation10=Ni+Hi,li._transform._rotation11=1-Ei-Fi,li._transform._rotation12=Wi-Ji,li._transform._rotation20=Gi-Oi,li._transform._rotation21=Wi+Ji,li._transform._rotation22=1-Ei-Di,Xi=li._transform._rotation00*li._invLocalInertia00+li._transform._rotation01*li._invLocalInertia10+li._transform._rotation02*li._invLocalInertia20,gi=li._transform._rotation00*li._invLocalInertia01+li._transform._rotation01*li._invLocalInertia11+li._transform._rotation02*li._invLocalInertia21,zi=li._transform._rotation00*li._invLocalInertia02+li._transform._rotation01*li._invLocalInertia12+li._transform._rotation02*li._invLocalInertia22,di=li._transform._rotation10*li._invLocalInertia00+li._transform._rotation11*li._invLocalInertia10+li._transform._rotation12*li._invLocalInertia20,Yi=li._transform._rotation10*li._invLocalInertia01+li._transform._rotation11*li._invLocalInertia11+li._transform._rotation12*li._invLocalInertia21,Zi=li._transform._rotation10*li._invLocalInertia02+li._transform._rotation11*li._invLocalInertia12+li._transform._rotation12*li._invLocalInertia22,Mi=li._transform._rotation20*li._invLocalInertia00+li._transform._rotation21*li._invLocalInertia10+li._transform._rotation22*li._invLocalInertia20,Ii=li._transform._rotation20*li._invLocalInertia01+li._transform._rotation21*li._invLocalInertia11+li._transform._rotation22*li._invLocalInertia21,Vi=li._transform._rotation20*li._invLocalInertia02+li._transform._rotation21*li._invLocalInertia12+li._transform._rotation22*li._invLocalInertia22,li._invInertia00=Xi,li._invInertia01=gi,li._invInertia02=zi,li._invInertia10=di,li._invInertia11=Yi,li._invInertia12=Zi,li._invInertia20=Mi,li._invInertia21=Ii,li._invInertia22=Vi,Li=li._invInertia00*li._transform._rotation00+li._invInertia01*li._transform._rotation01+li._invInertia02*li._transform._rotation02,wi=li._invInertia00*li._transform._rotation10+li._invInertia01*li._transform._rotation11+li._invInertia02*li._transform._rotation12,ki=li._invInertia00*li._transform._rotation20+li._invInertia01*li._transform._rotation21+li._invInertia02*li._transform._rotation22,Bi=li._invInertia10*li._transform._rotation00+li._invInertia11*li._transform._rotation01+li._invInertia12*li._transform._rotation02,Ai=li._invInertia10*li._transform._rotation10+li._invInertia11*li._transform._rotation11+li._invInertia12*li._transform._rotation12,Pi=li._invInertia10*li._transform._rotation20+li._invInertia11*li._transform._rotation21+li._invInertia12*li._transform._rotation22,Si=li._invInertia20*li._transform._rotation00+li._invInertia21*li._transform._rotation01+li._invInertia22*li._transform._rotation02,Ti=li._invInertia20*li._transform._rotation10+li._invInertia21*li._transform._rotation11+li._invInertia22*li._transform._rotation12,Ci=li._invInertia20*li._transform._rotation20+li._invInertia21*li._transform._rotation21+li._invInertia22*li._transform._rotation22,li._invInertia00=Li,li._invInertia01=wi,li._invInertia02=ki,li._invInertia10=Bi,li._invInertia11=Ai,li._invInertia12=Pi,li._invInertia20=Si,li._invInertia21=Ti,li._invInertia22=Ci,li._invInertia00*=li._rotFactor.x,li._invInertia01*=li._rotFactor.x,li._invInertia02*=li._rotFactor.x,li._invInertia10*=li._rotFactor.y,li._invInertia11*=li._rotFactor.y,li._invInertia12*=li._rotFactor.y,li._invInertia20*=li._rotFactor.z,li._invInertia21*=li._rotFactor.z,li._invInertia22*=li._rotFactor.z}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}},t.dynamics.rigidbody||(t.dynamics.rigidbody={}),t.dynamics.rigidbody.MassData=class{constructor(){this.mass=0,this.localInertia=new t.common.Mat3}},t.dynamics.rigidbody.RigidBody=class{constructor(i){this._next=null,this._prev=null,this._shapeList=null,this._shapeListLast=null,this._numShapes=0,this._contactLinkList=null,this._contactLinkListLast=null,this._numContactLinks=0,this._jointLinkList=null,this._jointLinkListLast=null,this._numJointLinks=0;var a=i.linearVelocity;this._velX=a.x,this._velY=a.y,this._velZ=a.z;var s=i.angularVelocity;this._angVelX=s.x,this._angVelY=s.y,this._angVelZ=s.z,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._ptransform=new t.common.Transform,this._transform=new t.common.Transform;var o=i.position;this._ptransform._positionX=o.x,this._ptransform._positionY=o.y,this._ptransform._positionZ=o.z;var n=i.rotation;this._ptransform._rotation00=n.e00,this._ptransform._rotation01=n.e01,this._ptransform._rotation02=n.e02,this._ptransform._rotation10=n.e10,this._ptransform._rotation11=n.e11,this._ptransform._rotation12=n.e12,this._ptransform._rotation20=n.e20,this._ptransform._rotation21=n.e21,this._ptransform._rotation22=n.e22;var r=this._transform,_=this._ptransform;r._positionX=_._positionX,r._positionY=_._positionY,r._positionZ=_._positionZ,r._rotation00=_._rotation00,r._rotation01=_._rotation01,r._rotation02=_._rotation02,r._rotation10=_._rotation10,r._rotation11=_._rotation11,r._rotation12=_._rotation12,r._rotation20=_._rotation20,r._rotation21=_._rotation21,r._rotation22=_._rotation22,this._type=i.type,this._sleepTime=0,this._sleeping=!1,this._autoSleep=i.autoSleep,this._mass=0,this._invMass=0,this._localInertia00=0,this._localInertia01=0,this._localInertia02=0,this._localInertia10=0,this._localInertia11=0,this._localInertia12=0,this._localInertia20=0,this._localInertia21=0,this._localInertia22=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._invInertia00=0,this._invInertia01=0,this._invInertia02=0,this._invInertia10=0,this._invInertia11=0,this._invInertia12=0,this._invInertia20=0,this._invInertia21=0,this._invInertia22=0,this._linearDamping=i.linearDamping,this._angularDamping=i.angularDamping,this._forceX=0,this._forceY=0,this._forceZ=0,this._torqueX=0,this._torqueY=0,this._torqueZ=0,this._linearContactImpulseX=0,this._linearContactImpulseY=0,this._linearContactImpulseZ=0,this._angularContactImpulseX=0,this._angularContactImpulseY=0,this._angularContactImpulseZ=0,this._rotFactor=new t.common.Vec3(1,1,1),this._addedToIsland=!1,this._gravityScale=1,this._world=null}_integrate(i){switch(this._type){case 1:this._velX=0,this._velY=0,this._velZ=0,this._angVelX=0,this._angVelY=0,this._angVelZ=0,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:var a,s,o,n,r,_,e=(a=this._velX*i)*a+(s=this._velY*i)*s+(o=this._velZ*i)*o,h=(n=this._angVelX*i)*n+(r=this._angVelY*i)*r+(_=this._angVelZ*i)*_;if(0==e&&0==h)return;if(e>t.common.Setting.maxTranslationPerStep*t.common.Setting.maxTranslationPerStep){var l=t.common.Setting.maxTranslationPerStep/Math.sqrt(e);this._velX*=l,this._velY*=l,this._velZ*=l,a*=l,s*=l,o*=l}if(h>t.common.Setting.maxRotationPerStep*t.common.Setting.maxRotationPerStep){var c=t.common.Setting.maxRotationPerStep/Math.sqrt(h);this._angVelX*=c,this._angVelY*=c,this._angVelZ*=c,n*=c,r*=c,_*=c}this._transform._positionX+=a,this._transform._positionY+=s,this._transform._positionZ+=o;var m,v,b,x,p,f,u,y,X,g,z=Math.sqrt(n*n+r*r+_*_),d=.5*z;if(d<.5){var Y=d*d;m=.5*(1-.16666666666666666*Y+Y*Y*.008333333333333333),v=1-.5*Y+Y*Y*.041666666666666664}else m=Math.sin(d)/z,v=Math.cos(d);b=n*m,x=r*m,p=_*m,f=v;var Z,M=this._transform._rotation00,I=this._transform._rotation11,V=this._transform._rotation22,L=M+I+V;L>0?(g=.5*(Z=Math.sqrt(L+1)),Z=.5/Z,u=(this._transform._rotation21-this._transform._rotation12)*Z,y=(this._transform._rotation02-this._transform._rotation20)*Z,X=(this._transform._rotation10-this._transform._rotation01)*Z):M>I?M>V?(u=.5*(Z=Math.sqrt(M-I-V+1)),Z=.5/Z,y=(this._transform._rotation01+this._transform._rotation10)*Z,X=(this._transform._rotation02+this._transform._rotation20)*Z,g=(this._transform._rotation21-this._transform._rotation12)*Z):(X=.5*(Z=Math.sqrt(V-M-I+1)),Z=.5/Z,u=(this._transform._rotation02+this._transform._rotation20)*Z,y=(this._transform._rotation12+this._transform._rotation21)*Z,g=(this._transform._rotation10-this._transform._rotation01)*Z):I>V?(y=.5*(Z=Math.sqrt(I-V-M+1)),Z=.5/Z,u=(this._transform._rotation01+this._transform._rotation10)*Z,X=(this._transform._rotation12+this._transform._rotation21)*Z,g=(this._transform._rotation02-this._transform._rotation20)*Z):(X=.5*(Z=Math.sqrt(V-M-I+1)),Z=.5/Z,u=(this._transform._rotation02+this._transform._rotation20)*Z,y=(this._transform._rotation12+this._transform._rotation21)*Z,g=(this._transform._rotation10-this._transform._rotation01)*Z);var w=(u=f*u+b*g+x*X-p*y)*u+(y=f*y-b*X+x*g+p*u)*y+(X=f*X+b*y-x*u+p*g)*X+(g=f*g-b*u-x*y-p*X)*g;w>1e-32&&(w=1/Math.sqrt(w));u*=w,y*=w,X*=w,g*=w;var k,B,A,P,S,T,C,j,R,q,E,D,F,N,W,G,J,O,H=2*u,U=2*y,Q=2*X,K=u*H,$=y*U,tt=X*Q,it=u*U,at=y*Q,st=u*Q,ot=g*H,nt=g*U,rt=g*Q;this._transform._rotation00=1-$-tt,this._transform._rotation01=it-rt,this._transform._rotation02=st+nt,this._transform._rotation10=it+rt,this._transform._rotation11=1-K-tt,this._transform._rotation12=at-ot,this._transform._rotation20=st-nt,this._transform._rotation21=at+ot,this._transform._rotation22=1-K-$,k=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,B=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,A=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,P=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,S=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,T=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,C=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,j=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,R=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=k,this._invInertia01=B,this._invInertia02=A,this._invInertia10=P,this._invInertia11=S,this._invInertia12=T,this._invInertia20=C,this._invInertia21=j,this._invInertia22=R,q=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,E=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,D=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,F=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,N=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,W=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,G=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,J=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,O=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=q,this._invInertia01=E,this._invInertia02=D,this._invInertia10=F,this._invInertia11=N,this._invInertia12=W,this._invInertia20=G,this._invInertia21=J,this._invInertia22=O,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z}}_integratePseudoVelocity(){var t=this._pseudoVelX*this._pseudoVelX+this._pseudoVelY*this._pseudoVelY+this._pseudoVelZ*this._pseudoVelZ,i=this._angPseudoVelX*this._angPseudoVelX+this._angPseudoVelY*this._angPseudoVelY+this._angPseudoVelZ*this._angPseudoVelZ;if(0!=t||0!=i)switch(this._type){case 1:this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:var a,s,o,n,r,_;a=this._pseudoVelX,s=this._pseudoVelY,o=this._pseudoVelZ,n=this._angPseudoVelX,r=this._angPseudoVelY,_=this._angPseudoVelZ,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._transform._positionX+=a,this._transform._positionY+=s,this._transform._positionZ+=o;var e,h,l,c,m,v,b,x,p,f,u=Math.sqrt(n*n+r*r+_*_),y=.5*u;if(y<.5){var X=y*y;e=.5*(1-.16666666666666666*X+X*X*.008333333333333333),h=1-.5*X+X*X*.041666666666666664}else e=Math.sin(y)/u,h=Math.cos(y);l=n*e,c=r*e,m=_*e,v=h;var g,z=this._transform._rotation00,d=this._transform._rotation11,Y=this._transform._rotation22,Z=z+d+Y;Z>0?(f=.5*(g=Math.sqrt(Z+1)),g=.5/g,b=(this._transform._rotation21-this._transform._rotation12)*g,x=(this._transform._rotation02-this._transform._rotation20)*g,p=(this._transform._rotation10-this._transform._rotation01)*g):z>d?z>Y?(b=.5*(g=Math.sqrt(z-d-Y+1)),g=.5/g,x=(this._transform._rotation01+this._transform._rotation10)*g,p=(this._transform._rotation02+this._transform._rotation20)*g,f=(this._transform._rotation21-this._transform._rotation12)*g):(p=.5*(g=Math.sqrt(Y-z-d+1)),g=.5/g,b=(this._transform._rotation02+this._transform._rotation20)*g,x=(this._transform._rotation12+this._transform._rotation21)*g,f=(this._transform._rotation10-this._transform._rotation01)*g):d>Y?(x=.5*(g=Math.sqrt(d-Y-z+1)),g=.5/g,b=(this._transform._rotation01+this._transform._rotation10)*g,p=(this._transform._rotation12+this._transform._rotation21)*g,f=(this._transform._rotation02-this._transform._rotation20)*g):(p=.5*(g=Math.sqrt(Y-z-d+1)),g=.5/g,b=(this._transform._rotation02+this._transform._rotation20)*g,x=(this._transform._rotation12+this._transform._rotation21)*g,f=(this._transform._rotation10-this._transform._rotation01)*g);var M=(b=v*b+l*f+c*p-m*x)*b+(x=v*x-l*p+c*f+m*b)*x+(p=v*p+l*x-c*b+m*f)*p+(f=v*f-l*b-c*x-m*p)*f;M>1e-32&&(M=1/Math.sqrt(M));b*=M,x*=M,p*=M,f*=M;var I,V,L,w,k,B,A,P,S,T,C,j,R,q,E,D,F,N,W=2*b,G=2*x,J=2*p,O=b*W,H=x*G,U=p*J,Q=b*G,K=x*J,$=b*J,tt=f*W,it=f*G,at=f*J;this._transform._rotation00=1-H-U,this._transform._rotation01=Q-at,this._transform._rotation02=$+it,this._transform._rotation10=Q+at,this._transform._rotation11=1-O-U,this._transform._rotation12=K-tt,this._transform._rotation20=$-it,this._transform._rotation21=K+tt,this._transform._rotation22=1-O-H,I=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,V=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,L=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,w=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,k=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,B=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,A=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,P=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,S=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=I,this._invInertia01=V,this._invInertia02=L,this._invInertia10=w,this._invInertia11=k,this._invInertia12=B,this._invInertia20=A,this._invInertia21=P,this._invInertia22=S,T=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,C=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,j=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,R=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,q=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,E=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,D=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,F=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,N=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=T,this._invInertia01=C,this._invInertia02=j,this._invInertia10=R,this._invInertia11=q,this._invInertia12=E,this._invInertia20=D,this._invInertia21=F,this._invInertia22=N,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z}}updateMass(){var t,i,a,s,o,n,r,_,e;t=0,i=0,a=0,s=0,o=0,n=0,r=0,_=0,e=0;for(var h=0,l=this._shapeList;null!=l;){var c=l._next,m=l._geom;m._updateMass();var v,b,x,p,f,u,y,X,g,z,d,Y,Z,M,I,V,L,w,k,B=l._density*m._volume;z=l._localTransform._rotation00*m._inertiaCoeff00+l._localTransform._rotation01*m._inertiaCoeff10+l._localTransform._rotation02*m._inertiaCoeff20,b=l._localTransform._rotation00*m._inertiaCoeff01+l._localTransform._rotation01*m._inertiaCoeff11+l._localTransform._rotation02*m._inertiaCoeff21,x=l._localTransform._rotation00*m._inertiaCoeff02+l._localTransform._rotation01*m._inertiaCoeff12+l._localTransform._rotation02*m._inertiaCoeff22,p=l._localTransform._rotation10*m._inertiaCoeff00+l._localTransform._rotation11*m._inertiaCoeff10+l._localTransform._rotation12*m._inertiaCoeff20,f=l._localTransform._rotation10*m._inertiaCoeff01+l._localTransform._rotation11*m._inertiaCoeff11+l._localTransform._rotation12*m._inertiaCoeff21,u=l._localTransform._rotation10*m._inertiaCoeff02+l._localTransform._rotation11*m._inertiaCoeff12+l._localTransform._rotation12*m._inertiaCoeff22,y=l._localTransform._rotation20*m._inertiaCoeff00+l._localTransform._rotation21*m._inertiaCoeff10+l._localTransform._rotation22*m._inertiaCoeff20,X=l._localTransform._rotation20*m._inertiaCoeff01+l._localTransform._rotation21*m._inertiaCoeff11+l._localTransform._rotation22*m._inertiaCoeff21,g=l._localTransform._rotation20*m._inertiaCoeff02+l._localTransform._rotation21*m._inertiaCoeff12+l._localTransform._rotation22*m._inertiaCoeff22,d=(v=z)*l._localTransform._rotation00+b*l._localTransform._rotation01+x*l._localTransform._rotation02,Y=v*l._localTransform._rotation10+b*l._localTransform._rotation11+x*l._localTransform._rotation12,Z=v*l._localTransform._rotation20+b*l._localTransform._rotation21+x*l._localTransform._rotation22,M=p*l._localTransform._rotation00+f*l._localTransform._rotation01+u*l._localTransform._rotation02,I=p*l._localTransform._rotation10+f*l._localTransform._rotation11+u*l._localTransform._rotation12,V=p*l._localTransform._rotation20+f*l._localTransform._rotation21+u*l._localTransform._rotation22,L=y*l._localTransform._rotation00+X*l._localTransform._rotation01+g*l._localTransform._rotation02,w=y*l._localTransform._rotation10+X*l._localTransform._rotation11+g*l._localTransform._rotation12,k=y*l._localTransform._rotation20+X*l._localTransform._rotation21+g*l._localTransform._rotation22,v=d,b=Y,x=Z,p=M,f=I,u=V,y=L,X=w,g=k,v*=B,b*=B,x*=B,p*=B,f*=B,u*=B,y*=B,X*=B,g*=B;var A=l._localTransform._positionX*l._localTransform._positionX,P=l._localTransform._positionY*l._localTransform._positionY,S=l._localTransform._positionZ*l._localTransform._positionZ,T=-l._localTransform._positionX*l._localTransform._positionY,C=-l._localTransform._positionY*l._localTransform._positionZ,j=-l._localTransform._positionZ*l._localTransform._positionX;h+=B,t+=v+=(P+S)*B,i+=b+=T*B,a+=x+=j*B,s+=p+=T*B,o+=f+=(A+S)*B,n+=u+=C*B,r+=y+=j*B,_+=X+=C*B,e+=g+=(A+P)*B,l=c}this._mass=h,this._localInertia00=t,this._localInertia01=i,this._localInertia02=a,this._localInertia10=s,this._localInertia11=o,this._localInertia12=n,this._localInertia20=r,this._localInertia21=_,this._localInertia22=e;var R,q,E,D,F,N,W,G,J,O,H,U,Q,K,$,tt,it,at,st=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,ot=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,nt=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,rt=this._localInertia00*st-this._localInertia01*ot+this._localInertia02*nt;if(this._mass>0&&rt>0&&0==this._type){this._invMass=1/this._mass;var _t=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,et=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,ht=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,lt=this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21,ct=this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20,mt=this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20,vt=this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11,bt=this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10,xt=this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10,pt=this._localInertia00*_t-this._localInertia01*et+this._localInertia02*ht;(pt<-1e-32||pt>1e-32)&&(pt=1/pt),this._invLocalInertia00=_t*pt,this._invLocalInertia01=-lt*pt,this._invLocalInertia02=vt*pt,this._invLocalInertia10=-et*pt,this._invLocalInertia11=ct*pt,this._invLocalInertia12=-bt*pt,this._invLocalInertia20=ht*pt,this._invLocalInertia21=-mt*pt,this._invLocalInertia22=xt*pt,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,0==this._type&&(this._type=1);R=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,q=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,E=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,D=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,F=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,N=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,W=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,G=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,J=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=R,this._invInertia01=q,this._invInertia02=E,this._invInertia10=D,this._invInertia11=F,this._invInertia12=N,this._invInertia20=W,this._invInertia21=G,this._invInertia22=J,O=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,H=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,U=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,Q=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,K=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,$=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,tt=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,it=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,at=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=O,this._invInertia01=H,this._invInertia02=U,this._invInertia10=Q,this._invInertia11=K,this._invInertia12=$,this._invInertia20=tt,this._invInertia21=it,this._invInertia22=at,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getPosition(){var i=new t.common.Vec3,a=i;return a.x=this._transform._positionX,a.y=this._transform._positionY,a.z=this._transform._positionZ,i}getPositionTo(t){var i=t;i.x=this._transform._positionX,i.y=this._transform._positionY,i.z=this._transform._positionZ}setPosition(t){var i=t;this._transform._positionX=i.x,this._transform._positionY=i.y,this._transform._positionZ=i.z;var a=this._ptransform,s=this._transform;a._positionX=s._positionX,a._positionY=s._positionY,a._positionZ=s._positionZ,a._rotation00=s._rotation00,a._rotation01=s._rotation01,a._rotation02=s._rotation02,a._rotation10=s._rotation10,a._rotation11=s._rotation11,a._rotation12=s._rotation12,a._rotation20=s._rotation20,a._rotation21=s._rotation21,a._rotation22=s._rotation22;for(var o=this._shapeList;null!=o;){var n,r,_,e,h,l,c,m,v,b,x,p,f=o._next,u=o._ptransform,y=o._localTransform,X=this._ptransform;n=X._rotation00*y._rotation00+X._rotation01*y._rotation10+X._rotation02*y._rotation20,r=X._rotation00*y._rotation01+X._rotation01*y._rotation11+X._rotation02*y._rotation21,_=X._rotation00*y._rotation02+X._rotation01*y._rotation12+X._rotation02*y._rotation22,e=X._rotation10*y._rotation00+X._rotation11*y._rotation10+X._rotation12*y._rotation20,h=X._rotation10*y._rotation01+X._rotation11*y._rotation11+X._rotation12*y._rotation21,l=X._rotation10*y._rotation02+X._rotation11*y._rotation12+X._rotation12*y._rotation22,c=X._rotation20*y._rotation00+X._rotation21*y._rotation10+X._rotation22*y._rotation20,m=X._rotation20*y._rotation01+X._rotation21*y._rotation11+X._rotation22*y._rotation21,v=X._rotation20*y._rotation02+X._rotation21*y._rotation12+X._rotation22*y._rotation22,u._rotation00=n,u._rotation01=r,u._rotation02=_,u._rotation10=e,u._rotation11=h,u._rotation12=l,u._rotation20=c,u._rotation21=m,u._rotation22=v,b=X._rotation00*y._positionX+X._rotation01*y._positionY+X._rotation02*y._positionZ,x=X._rotation10*y._positionX+X._rotation11*y._positionY+X._rotation12*y._positionZ,p=X._rotation20*y._positionX+X._rotation21*y._positionY+X._rotation22*y._positionZ,u._positionX=b,u._positionY=x,u._positionZ=p,u._positionX+=X._positionX,u._positionY+=X._positionY,u._positionZ+=X._positionZ;var g,z,d,Y,Z,M,I,V,L,w,k,B,A,P,S,T,C,j,R=o._transform,q=o._localTransform,E=this._transform;if(g=E._rotation00*q._rotation00+E._rotation01*q._rotation10+E._rotation02*q._rotation20,z=E._rotation00*q._rotation01+E._rotation01*q._rotation11+E._rotation02*q._rotation21,d=E._rotation00*q._rotation02+E._rotation01*q._rotation12+E._rotation02*q._rotation22,Y=E._rotation10*q._rotation00+E._rotation11*q._rotation10+E._rotation12*q._rotation20,Z=E._rotation10*q._rotation01+E._rotation11*q._rotation11+E._rotation12*q._rotation21,M=E._rotation10*q._rotation02+E._rotation11*q._rotation12+E._rotation12*q._rotation22,I=E._rotation20*q._rotation00+E._rotation21*q._rotation10+E._rotation22*q._rotation20,V=E._rotation20*q._rotation01+E._rotation21*q._rotation11+E._rotation22*q._rotation21,L=E._rotation20*q._rotation02+E._rotation21*q._rotation12+E._rotation22*q._rotation22,R._rotation00=g,R._rotation01=z,R._rotation02=d,R._rotation10=Y,R._rotation11=Z,R._rotation12=M,R._rotation20=I,R._rotation21=V,R._rotation22=L,w=E._rotation00*q._positionX+E._rotation01*q._positionY+E._rotation02*q._positionZ,k=E._rotation10*q._positionX+E._rotation11*q._positionY+E._rotation12*q._positionZ,B=E._rotation20*q._positionX+E._rotation21*q._positionY+E._rotation22*q._positionZ,R._positionX=w,R._positionY=k,R._positionZ=B,R._positionX+=E._positionX,R._positionY+=E._positionY,R._positionZ+=E._positionZ,o._geom._computeAabb(o._aabb,o._ptransform),A=o._aabb._minX,P=o._aabb._minY,S=o._aabb._minZ,T=o._aabb._maxX,C=o._aabb._maxY,j=o._aabb._maxZ,o._geom._computeAabb(o._aabb,o._transform),o._aabb._minX=A<o._aabb._minX?A:o._aabb._minX,o._aabb._minY=P<o._aabb._minY?P:o._aabb._minY,o._aabb._minZ=S<o._aabb._minZ?S:o._aabb._minZ,o._aabb._maxX=T>o._aabb._maxX?T:o._aabb._maxX,o._aabb._maxY=C>o._aabb._maxY?C:o._aabb._maxY,o._aabb._maxZ=j>o._aabb._maxZ?j:o._aabb._maxZ,null!=o._proxy){var D,F,N;D=o._transform._positionX-o._ptransform._positionX,F=o._transform._positionY-o._ptransform._positionY,N=o._transform._positionZ-o._ptransform._positionZ;var W=o.displacement;W.x=D,W.y=F,W.z=N,o._rigidBody._world._broadPhase.moveProxy(o._proxy,o._aabb,o.displacement)}o=f}this._sleeping=!1,this._sleepTime=0}translate(t){var i,a,s,o=t;i=o.x,a=o.y,s=o.z,this._transform._positionX+=i,this._transform._positionY+=a,this._transform._positionZ+=s;var n=this._ptransform,r=this._transform;n._positionX=r._positionX,n._positionY=r._positionY,n._positionZ=r._positionZ,n._rotation00=r._rotation00,n._rotation01=r._rotation01,n._rotation02=r._rotation02,n._rotation10=r._rotation10,n._rotation11=r._rotation11,n._rotation12=r._rotation12,n._rotation20=r._rotation20,n._rotation21=r._rotation21,n._rotation22=r._rotation22;for(var _=this._shapeList;null!=_;){var e,h,l,c,m,v,b,x,p,f,u,y,X=_._next,g=_._ptransform,z=_._localTransform,d=this._ptransform;e=d._rotation00*z._rotation00+d._rotation01*z._rotation10+d._rotation02*z._rotation20,h=d._rotation00*z._rotation01+d._rotation01*z._rotation11+d._rotation02*z._rotation21,l=d._rotation00*z._rotation02+d._rotation01*z._rotation12+d._rotation02*z._rotation22,c=d._rotation10*z._rotation00+d._rotation11*z._rotation10+d._rotation12*z._rotation20,m=d._rotation10*z._rotation01+d._rotation11*z._rotation11+d._rotation12*z._rotation21,v=d._rotation10*z._rotation02+d._rotation11*z._rotation12+d._rotation12*z._rotation22,b=d._rotation20*z._rotation00+d._rotation21*z._rotation10+d._rotation22*z._rotation20,x=d._rotation20*z._rotation01+d._rotation21*z._rotation11+d._rotation22*z._rotation21,p=d._rotation20*z._rotation02+d._rotation21*z._rotation12+d._rotation22*z._rotation22,g._rotation00=e,g._rotation01=h,g._rotation02=l,g._rotation10=c,g._rotation11=m,g._rotation12=v,g._rotation20=b,g._rotation21=x,g._rotation22=p,f=d._rotation00*z._positionX+d._rotation01*z._positionY+d._rotation02*z._positionZ,u=d._rotation10*z._positionX+d._rotation11*z._positionY+d._rotation12*z._positionZ,y=d._rotation20*z._positionX+d._rotation21*z._positionY+d._rotation22*z._positionZ,g._positionX=f,g._positionY=u,g._positionZ=y,g._positionX+=d._positionX,g._positionY+=d._positionY,g._positionZ+=d._positionZ;var Y,Z,M,I,V,L,w,k,B,A,P,S,T,C,j,R,q,E,D=_._transform,F=_._localTransform,N=this._transform;if(Y=N._rotation00*F._rotation00+N._rotation01*F._rotation10+N._rotation02*F._rotation20,Z=N._rotation00*F._rotation01+N._rotation01*F._rotation11+N._rotation02*F._rotation21,M=N._rotation00*F._rotation02+N._rotation01*F._rotation12+N._rotation02*F._rotation22,I=N._rotation10*F._rotation00+N._rotation11*F._rotation10+N._rotation12*F._rotation20,V=N._rotation10*F._rotation01+N._rotation11*F._rotation11+N._rotation12*F._rotation21,L=N._rotation10*F._rotation02+N._rotation11*F._rotation12+N._rotation12*F._rotation22,w=N._rotation20*F._rotation00+N._rotation21*F._rotation10+N._rotation22*F._rotation20,k=N._rotation20*F._rotation01+N._rotation21*F._rotation11+N._rotation22*F._rotation21,B=N._rotation20*F._rotation02+N._rotation21*F._rotation12+N._rotation22*F._rotation22,D._rotation00=Y,D._rotation01=Z,D._rotation02=M,D._rotation10=I,D._rotation11=V,D._rotation12=L,D._rotation20=w,D._rotation21=k,D._rotation22=B,A=N._rotation00*F._positionX+N._rotation01*F._positionY+N._rotation02*F._positionZ,P=N._rotation10*F._positionX+N._rotation11*F._positionY+N._rotation12*F._positionZ,S=N._rotation20*F._positionX+N._rotation21*F._positionY+N._rotation22*F._positionZ,D._positionX=A,D._positionY=P,D._positionZ=S,D._positionX+=N._positionX,D._positionY+=N._positionY,D._positionZ+=N._positionZ,_._geom._computeAabb(_._aabb,_._ptransform),T=_._aabb._minX,C=_._aabb._minY,j=_._aabb._minZ,R=_._aabb._maxX,q=_._aabb._maxY,E=_._aabb._maxZ,_._geom._computeAabb(_._aabb,_._transform),_._aabb._minX=T<_._aabb._minX?T:_._aabb._minX,_._aabb._minY=C<_._aabb._minY?C:_._aabb._minY,_._aabb._minZ=j<_._aabb._minZ?j:_._aabb._minZ,_._aabb._maxX=R>_._aabb._maxX?R:_._aabb._maxX,_._aabb._maxY=q>_._aabb._maxY?q:_._aabb._maxY,_._aabb._maxZ=E>_._aabb._maxZ?E:_._aabb._maxZ,null!=_._proxy){var W,G,J;W=_._transform._positionX-_._ptransform._positionX,G=_._transform._positionY-_._ptransform._positionY,J=_._transform._positionZ-_._ptransform._positionZ;var O=_.displacement;O.x=W,O.y=G,O.z=J,_._rigidBody._world._broadPhase.moveProxy(_._proxy,_._aabb,_.displacement)}_=X}this._sleeping=!1,this._sleepTime=0}getRotation(){var i=new t.common.Mat3,a=i;return a.e00=this._transform._rotation00,a.e01=this._transform._rotation01,a.e02=this._transform._rotation02,a.e10=this._transform._rotation10,a.e11=this._transform._rotation11,a.e12=this._transform._rotation12,a.e20=this._transform._rotation20,a.e21=this._transform._rotation21,a.e22=this._transform._rotation22,i}getRotationTo(t){var i=t;i.e00=this._transform._rotation00,i.e01=this._transform._rotation01,i.e02=this._transform._rotation02,i.e10=this._transform._rotation10,i.e11=this._transform._rotation11,i.e12=this._transform._rotation12,i.e20=this._transform._rotation20,i.e21=this._transform._rotation21,i.e22=this._transform._rotation22}setRotation(t){var i,a,s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y=t;this._transform._rotation00=y.e00,this._transform._rotation01=y.e01,this._transform._rotation02=y.e02,this._transform._rotation10=y.e10,this._transform._rotation11=y.e11,this._transform._rotation12=y.e12,this._transform._rotation20=y.e20,this._transform._rotation21=y.e21,this._transform._rotation22=y.e22,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,a=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,s=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,n=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,_=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,e=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=a,this._invInertia02=s,this._invInertia10=o,this._invInertia11=n,this._invInertia12=r,this._invInertia20=_,this._invInertia21=e,this._invInertia22=h,l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,v=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,b=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,x=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,p=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,f=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,u=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=c,this._invInertia02=m,this._invInertia10=v,this._invInertia11=b,this._invInertia12=x,this._invInertia20=p,this._invInertia21=f,this._invInertia22=u,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var X=this._ptransform,g=this._transform;X._positionX=g._positionX,X._positionY=g._positionY,X._positionZ=g._positionZ,X._rotation00=g._rotation00,X._rotation01=g._rotation01,X._rotation02=g._rotation02,X._rotation10=g._rotation10,X._rotation11=g._rotation11,X._rotation12=g._rotation12,X._rotation20=g._rotation20,X._rotation21=g._rotation21,X._rotation22=g._rotation22;for(var z=this._shapeList;null!=z;){var d,Y,Z,M,I,V,L,w,k,B,A,P,S=z._next,T=z._ptransform,C=z._localTransform,j=this._ptransform;d=j._rotation00*C._rotation00+j._rotation01*C._rotation10+j._rotation02*C._rotation20,Y=j._rotation00*C._rotation01+j._rotation01*C._rotation11+j._rotation02*C._rotation21,Z=j._rotation00*C._rotation02+j._rotation01*C._rotation12+j._rotation02*C._rotation22,M=j._rotation10*C._rotation00+j._rotation11*C._rotation10+j._rotation12*C._rotation20,I=j._rotation10*C._rotation01+j._rotation11*C._rotation11+j._rotation12*C._rotation21,V=j._rotation10*C._rotation02+j._rotation11*C._rotation12+j._rotation12*C._rotation22,L=j._rotation20*C._rotation00+j._rotation21*C._rotation10+j._rotation22*C._rotation20,w=j._rotation20*C._rotation01+j._rotation21*C._rotation11+j._rotation22*C._rotation21,k=j._rotation20*C._rotation02+j._rotation21*C._rotation12+j._rotation22*C._rotation22,T._rotation00=d,T._rotation01=Y,T._rotation02=Z,T._rotation10=M,T._rotation11=I,T._rotation12=V,T._rotation20=L,T._rotation21=w,T._rotation22=k,B=j._rotation00*C._positionX+j._rotation01*C._positionY+j._rotation02*C._positionZ,A=j._rotation10*C._positionX+j._rotation11*C._positionY+j._rotation12*C._positionZ,P=j._rotation20*C._positionX+j._rotation21*C._positionY+j._rotation22*C._positionZ,T._positionX=B,T._positionY=A,T._positionZ=P,T._positionX+=j._positionX,T._positionY+=j._positionY,T._positionZ+=j._positionZ;var R,q,E,D,F,N,W,G,J,O,H,U,Q,K,$,tt,it,at,st=z._transform,ot=z._localTransform,nt=this._transform;if(R=nt._rotation00*ot._rotation00+nt._rotation01*ot._rotation10+nt._rotation02*ot._rotation20,q=nt._rotation00*ot._rotation01+nt._rotation01*ot._rotation11+nt._rotation02*ot._rotation21,E=nt._rotation00*ot._rotation02+nt._rotation01*ot._rotation12+nt._rotation02*ot._rotation22,D=nt._rotation10*ot._rotation00+nt._rotation11*ot._rotation10+nt._rotation12*ot._rotation20,F=nt._rotation10*ot._rotation01+nt._rotation11*ot._rotation11+nt._rotation12*ot._rotation21,N=nt._rotation10*ot._rotation02+nt._rotation11*ot._rotation12+nt._rotation12*ot._rotation22,W=nt._rotation20*ot._rotation00+nt._rotation21*ot._rotation10+nt._rotation22*ot._rotation20,G=nt._rotation20*ot._rotation01+nt._rotation21*ot._rotation11+nt._rotation22*ot._rotation21,J=nt._rotation20*ot._rotation02+nt._rotation21*ot._rotation12+nt._rotation22*ot._rotation22,st._rotation00=R,st._rotation01=q,st._rotation02=E,st._rotation10=D,st._rotation11=F,st._rotation12=N,st._rotation20=W,st._rotation21=G,st._rotation22=J,O=nt._rotation00*ot._positionX+nt._rotation01*ot._positionY+nt._rotation02*ot._positionZ,H=nt._rotation10*ot._positionX+nt._rotation11*ot._positionY+nt._rotation12*ot._positionZ,U=nt._rotation20*ot._positionX+nt._rotation21*ot._positionY+nt._rotation22*ot._positionZ,st._positionX=O,st._positionY=H,st._positionZ=U,st._positionX+=nt._positionX,st._positionY+=nt._positionY,st._positionZ+=nt._positionZ,z._geom._computeAabb(z._aabb,z._ptransform),Q=z._aabb._minX,K=z._aabb._minY,$=z._aabb._minZ,tt=z._aabb._maxX,it=z._aabb._maxY,at=z._aabb._maxZ,z._geom._computeAabb(z._aabb,z._transform),z._aabb._minX=Q<z._aabb._minX?Q:z._aabb._minX,z._aabb._minY=K<z._aabb._minY?K:z._aabb._minY,z._aabb._minZ=$<z._aabb._minZ?$:z._aabb._minZ,z._aabb._maxX=tt>z._aabb._maxX?tt:z._aabb._maxX,z._aabb._maxY=it>z._aabb._maxY?it:z._aabb._maxY,z._aabb._maxZ=at>z._aabb._maxZ?at:z._aabb._maxZ,null!=z._proxy){var rt,_t,et;rt=z._transform._positionX-z._ptransform._positionX,_t=z._transform._positionY-z._ptransform._positionY,et=z._transform._positionZ-z._ptransform._positionZ;var ht=z.displacement;ht.x=rt,ht.y=_t,ht.z=et,z._rigidBody._world._broadPhase.moveProxy(z._proxy,z._aabb,z.displacement)}z=S}this._sleeping=!1,this._sleepTime=0}setRotationXyz(t){var i,a,s,o=t;i=o.x,a=o.y,s=o.z;var n,r,_,e,h,l,c,m,v,b,x,p,f,u,y,X,g,z,d=Math.sin(i),Y=Math.sin(a),Z=Math.sin(s),M=Math.cos(i),I=Math.cos(a),V=Math.cos(s);this._transform._rotation00=I*V,this._transform._rotation01=-I*Z,this._transform._rotation02=Y,this._transform._rotation10=M*Z+V*d*Y,this._transform._rotation11=M*V-d*Y*Z,this._transform._rotation12=-I*d,this._transform._rotation20=d*Z-M*V*Y,this._transform._rotation21=V*d+M*Y*Z,this._transform._rotation22=M*I,n=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,r=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,_=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,e=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,h=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,l=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,c=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,m=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,v=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=n,this._invInertia01=r,this._invInertia02=_,this._invInertia10=e,this._invInertia11=h,this._invInertia12=l,this._invInertia20=c,this._invInertia21=m,this._invInertia22=v,b=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,x=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,p=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,f=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,u=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,y=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,X=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,g=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,z=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=b,this._invInertia01=x,this._invInertia02=p,this._invInertia10=f,this._invInertia11=u,this._invInertia12=y,this._invInertia20=X,this._invInertia21=g,this._invInertia22=z,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var L=this._ptransform,w=this._transform;L._positionX=w._positionX,L._positionY=w._positionY,L._positionZ=w._positionZ,L._rotation00=w._rotation00,L._rotation01=w._rotation01,L._rotation02=w._rotation02,L._rotation10=w._rotation10,L._rotation11=w._rotation11,L._rotation12=w._rotation12,L._rotation20=w._rotation20,L._rotation21=w._rotation21,L._rotation22=w._rotation22;for(var k=this._shapeList;null!=k;){var B,A,P,S,T,C,j,R,q,E,D,F,N=k._next,W=k._ptransform,G=k._localTransform,J=this._ptransform;B=J._rotation00*G._rotation00+J._rotation01*G._rotation10+J._rotation02*G._rotation20,A=J._rotation00*G._rotation01+J._rotation01*G._rotation11+J._rotation02*G._rotation21,P=J._rotation00*G._rotation02+J._rotation01*G._rotation12+J._rotation02*G._rotation22,S=J._rotation10*G._rotation00+J._rotation11*G._rotation10+J._rotation12*G._rotation20,T=J._rotation10*G._rotation01+J._rotation11*G._rotation11+J._rotation12*G._rotation21,C=J._rotation10*G._rotation02+J._rotation11*G._rotation12+J._rotation12*G._rotation22,j=J._rotation20*G._rotation00+J._rotation21*G._rotation10+J._rotation22*G._rotation20,R=J._rotation20*G._rotation01+J._rotation21*G._rotation11+J._rotation22*G._rotation21,q=J._rotation20*G._rotation02+J._rotation21*G._rotation12+J._rotation22*G._rotation22,W._rotation00=B,W._rotation01=A,W._rotation02=P,W._rotation10=S,W._rotation11=T,W._rotation12=C,W._rotation20=j,W._rotation21=R,W._rotation22=q,E=J._rotation00*G._positionX+J._rotation01*G._positionY+J._rotation02*G._positionZ,D=J._rotation10*G._positionX+J._rotation11*G._positionY+J._rotation12*G._positionZ,F=J._rotation20*G._positionX+J._rotation21*G._positionY+J._rotation22*G._positionZ,W._positionX=E,W._positionY=D,W._positionZ=F,W._positionX+=J._positionX,W._positionY+=J._positionY,W._positionZ+=J._positionZ;var O,H,U,Q,K,$,tt,it,at,st,ot,nt,rt,_t,et,ht,lt,ct,mt=k._transform,vt=k._localTransform,bt=this._transform;if(O=bt._rotation00*vt._rotation00+bt._rotation01*vt._rotation10+bt._rotation02*vt._rotation20,H=bt._rotation00*vt._rotation01+bt._rotation01*vt._rotation11+bt._rotation02*vt._rotation21,U=bt._rotation00*vt._rotation02+bt._rotation01*vt._rotation12+bt._rotation02*vt._rotation22,Q=bt._rotation10*vt._rotation00+bt._rotation11*vt._rotation10+bt._rotation12*vt._rotation20,K=bt._rotation10*vt._rotation01+bt._rotation11*vt._rotation11+bt._rotation12*vt._rotation21,$=bt._rotation10*vt._rotation02+bt._rotation11*vt._rotation12+bt._rotation12*vt._rotation22,tt=bt._rotation20*vt._rotation00+bt._rotation21*vt._rotation10+bt._rotation22*vt._rotation20,it=bt._rotation20*vt._rotation01+bt._rotation21*vt._rotation11+bt._rotation22*vt._rotation21,at=bt._rotation20*vt._rotation02+bt._rotation21*vt._rotation12+bt._rotation22*vt._rotation22,mt._rotation00=O,mt._rotation01=H,mt._rotation02=U,mt._rotation10=Q,mt._rotation11=K,mt._rotation12=$,mt._rotation20=tt,mt._rotation21=it,mt._rotation22=at,st=bt._rotation00*vt._positionX+bt._rotation01*vt._positionY+bt._rotation02*vt._positionZ,ot=bt._rotation10*vt._positionX+bt._rotation11*vt._positionY+bt._rotation12*vt._positionZ,nt=bt._rotation20*vt._positionX+bt._rotation21*vt._positionY+bt._rotation22*vt._positionZ,mt._positionX=st,mt._positionY=ot,mt._positionZ=nt,mt._positionX+=bt._positionX,mt._positionY+=bt._positionY,mt._positionZ+=bt._positionZ,k._geom._computeAabb(k._aabb,k._ptransform),rt=k._aabb._minX,_t=k._aabb._minY,et=k._aabb._minZ,ht=k._aabb._maxX,lt=k._aabb._maxY,ct=k._aabb._maxZ,k._geom._computeAabb(k._aabb,k._transform),k._aabb._minX=rt<k._aabb._minX?rt:k._aabb._minX,k._aabb._minY=_t<k._aabb._minY?_t:k._aabb._minY,k._aabb._minZ=et<k._aabb._minZ?et:k._aabb._minZ,k._aabb._maxX=ht>k._aabb._maxX?ht:k._aabb._maxX,k._aabb._maxY=lt>k._aabb._maxY?lt:k._aabb._maxY,k._aabb._maxZ=ct>k._aabb._maxZ?ct:k._aabb._maxZ,null!=k._proxy){var xt,pt,ft;xt=k._transform._positionX-k._ptransform._positionX,pt=k._transform._positionY-k._ptransform._positionY,ft=k._transform._positionZ-k._ptransform._positionZ;var ut=k.displacement;ut.x=xt,ut.y=pt,ut.z=ft,k._rigidBody._world._broadPhase.moveProxy(k._proxy,k._aabb,k.displacement)}k=N}this._sleeping=!1,this._sleepTime=0}rotate(t){var i,a,s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y,X,g,z,d,Y,Z,M,I,V,L,w,k,B,A,P,S,T,C=t;i=C.e00,a=C.e01,s=C.e02,o=C.e10,n=C.e11,r=C.e12,_=C.e20,e=C.e21,h=C.e22,l=i*this._transform._rotation00+a*this._transform._rotation10+s*this._transform._rotation20,c=i*this._transform._rotation01+a*this._transform._rotation11+s*this._transform._rotation21,m=i*this._transform._rotation02+a*this._transform._rotation12+s*this._transform._rotation22,v=o*this._transform._rotation00+n*this._transform._rotation10+r*this._transform._rotation20,b=o*this._transform._rotation01+n*this._transform._rotation11+r*this._transform._rotation21,x=o*this._transform._rotation02+n*this._transform._rotation12+r*this._transform._rotation22,p=_*this._transform._rotation00+e*this._transform._rotation10+h*this._transform._rotation20,f=_*this._transform._rotation01+e*this._transform._rotation11+h*this._transform._rotation21,u=_*this._transform._rotation02+e*this._transform._rotation12+h*this._transform._rotation22,this._transform._rotation00=l,this._transform._rotation01=c,this._transform._rotation02=m,this._transform._rotation10=v,this._transform._rotation11=b,this._transform._rotation12=x,this._transform._rotation20=p,this._transform._rotation21=f,this._transform._rotation22=u,y=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,X=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,g=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,z=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,d=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,Y=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,Z=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,M=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,I=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=y,this._invInertia01=X,this._invInertia02=g,this._invInertia10=z,this._invInertia11=d,this._invInertia12=Y,this._invInertia20=Z,this._invInertia21=M,this._invInertia22=I,V=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,L=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,w=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,k=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,B=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,A=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,P=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,S=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,T=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=V,this._invInertia01=L,this._invInertia02=w,this._invInertia10=k,this._invInertia11=B,this._invInertia12=A,this._invInertia20=P,this._invInertia21=S,this._invInertia22=T,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var j=this._ptransform,R=this._transform;j._positionX=R._positionX,j._positionY=R._positionY,j._positionZ=R._positionZ,j._rotation00=R._rotation00,j._rotation01=R._rotation01,j._rotation02=R._rotation02,j._rotation10=R._rotation10,j._rotation11=R._rotation11,j._rotation12=R._rotation12,j._rotation20=R._rotation20,j._rotation21=R._rotation21,j._rotation22=R._rotation22;for(var q=this._shapeList;null!=q;){var E,D,F,N,W,G,J,O,H,U,Q,K,$=q._next,tt=q._ptransform,it=q._localTransform,at=this._ptransform;E=at._rotation00*it._rotation00+at._rotation01*it._rotation10+at._rotation02*it._rotation20,D=at._rotation00*it._rotation01+at._rotation01*it._rotation11+at._rotation02*it._rotation21,F=at._rotation00*it._rotation02+at._rotation01*it._rotation12+at._rotation02*it._rotation22,N=at._rotation10*it._rotation00+at._rotation11*it._rotation10+at._rotation12*it._rotation20,W=at._rotation10*it._rotation01+at._rotation11*it._rotation11+at._rotation12*it._rotation21,G=at._rotation10*it._rotation02+at._rotation11*it._rotation12+at._rotation12*it._rotation22,J=at._rotation20*it._rotation00+at._rotation21*it._rotation10+at._rotation22*it._rotation20,O=at._rotation20*it._rotation01+at._rotation21*it._rotation11+at._rotation22*it._rotation21,H=at._rotation20*it._rotation02+at._rotation21*it._rotation12+at._rotation22*it._rotation22,tt._rotation00=E,tt._rotation01=D,tt._rotation02=F,tt._rotation10=N,tt._rotation11=W,tt._rotation12=G,tt._rotation20=J,tt._rotation21=O,tt._rotation22=H,U=at._rotation00*it._positionX+at._rotation01*it._positionY+at._rotation02*it._positionZ,Q=at._rotation10*it._positionX+at._rotation11*it._positionY+at._rotation12*it._positionZ,K=at._rotation20*it._positionX+at._rotation21*it._positionY+at._rotation22*it._positionZ,tt._positionX=U,tt._positionY=Q,tt._positionZ=K,tt._positionX+=at._positionX,tt._positionY+=at._positionY,tt._positionZ+=at._positionZ;var st,ot,nt,rt,_t,et,ht,lt,ct,mt,vt,bt,xt,pt,ft,ut,yt,Xt,gt=q._transform,zt=q._localTransform,dt=this._transform;if(st=dt._rotation00*zt._rotation00+dt._rotation01*zt._rotation10+dt._rotation02*zt._rotation20,ot=dt._rotation00*zt._rotation01+dt._rotation01*zt._rotation11+dt._rotation02*zt._rotation21,nt=dt._rotation00*zt._rotation02+dt._rotation01*zt._rotation12+dt._rotation02*zt._rotation22,rt=dt._rotation10*zt._rotation00+dt._rotation11*zt._rotation10+dt._rotation12*zt._rotation20,_t=dt._rotation10*zt._rotation01+dt._rotation11*zt._rotation11+dt._rotation12*zt._rotation21,et=dt._rotation10*zt._rotation02+dt._rotation11*zt._rotation12+dt._rotation12*zt._rotation22,ht=dt._rotation20*zt._rotation00+dt._rotation21*zt._rotation10+dt._rotation22*zt._rotation20,lt=dt._rotation20*zt._rotation01+dt._rotation21*zt._rotation11+dt._rotation22*zt._rotation21,ct=dt._rotation20*zt._rotation02+dt._rotation21*zt._rotation12+dt._rotation22*zt._rotation22,gt._rotation00=st,gt._rotation01=ot,gt._rotation02=nt,gt._rotation10=rt,gt._rotation11=_t,gt._rotation12=et,gt._rotation20=ht,gt._rotation21=lt,gt._rotation22=ct,mt=dt._rotation00*zt._positionX+dt._rotation01*zt._positionY+dt._rotation02*zt._positionZ,vt=dt._rotation10*zt._positionX+dt._rotation11*zt._positionY+dt._rotation12*zt._positionZ,bt=dt._rotation20*zt._positionX+dt._rotation21*zt._positionY+dt._rotation22*zt._positionZ,gt._positionX=mt,gt._positionY=vt,gt._positionZ=bt,gt._positionX+=dt._positionX,gt._positionY+=dt._positionY,gt._positionZ+=dt._positionZ,q._geom._computeAabb(q._aabb,q._ptransform),xt=q._aabb._minX,pt=q._aabb._minY,ft=q._aabb._minZ,ut=q._aabb._maxX,yt=q._aabb._maxY,Xt=q._aabb._maxZ,q._geom._computeAabb(q._aabb,q._transform),q._aabb._minX=xt<q._aabb._minX?xt:q._aabb._minX,q._aabb._minY=pt<q._aabb._minY?pt:q._aabb._minY,q._aabb._minZ=ft<q._aabb._minZ?ft:q._aabb._minZ,q._aabb._maxX=ut>q._aabb._maxX?ut:q._aabb._maxX,q._aabb._maxY=yt>q._aabb._maxY?yt:q._aabb._maxY,q._aabb._maxZ=Xt>q._aabb._maxZ?Xt:q._aabb._maxZ,null!=q._proxy){var Yt,Zt,Mt;Yt=q._transform._positionX-q._ptransform._positionX,Zt=q._transform._positionY-q._ptransform._positionY,Mt=q._transform._positionZ-q._ptransform._positionZ;var It=q.displacement;It.x=Yt,It.y=Zt,It.z=Mt,q._rigidBody._world._broadPhase.moveProxy(q._proxy,q._aabb,q.displacement)}q=$}this._sleeping=!1,this._sleepTime=0}rotateXyz(t){var i,a,s,o,n,r,_,e,h,l,c,m,v=t;i=v.x,a=v.y,s=v.z;var b,x,p,f,u,y,X,g,z,d,Y,Z,M,I,V,L,w,k,B,A,P,S,T,C,j,R,q,E=Math.sin(i),D=Math.sin(a),F=Math.sin(s),N=Math.cos(i),W=Math.cos(a),G=Math.cos(s);n=-W*F,r=D,_=N*F+G*E*D,e=N*G-E*D*F,h=-W*E,l=E*F-N*G*D,c=G*E+N*D*F,m=N*W,b=(o=W*G)*this._transform._rotation00+n*this._transform._rotation10+r*this._transform._rotation20,x=o*this._transform._rotation01+n*this._transform._rotation11+r*this._transform._rotation21,p=o*this._transform._rotation02+n*this._transform._rotation12+r*this._transform._rotation22,f=_*this._transform._rotation00+e*this._transform._rotation10+h*this._transform._rotation20,u=_*this._transform._rotation01+e*this._transform._rotation11+h*this._transform._rotation21,y=_*this._transform._rotation02+e*this._transform._rotation12+h*this._transform._rotation22,X=l*this._transform._rotation00+c*this._transform._rotation10+m*this._transform._rotation20,g=l*this._transform._rotation01+c*this._transform._rotation11+m*this._transform._rotation21,z=l*this._transform._rotation02+c*this._transform._rotation12+m*this._transform._rotation22,this._transform._rotation00=b,this._transform._rotation01=x,this._transform._rotation02=p,this._transform._rotation10=f,this._transform._rotation11=u,this._transform._rotation12=y,this._transform._rotation20=X,this._transform._rotation21=g,this._transform._rotation22=z,d=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,Y=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,Z=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,M=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,I=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,V=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,L=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,w=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,k=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=d,this._invInertia01=Y,this._invInertia02=Z,this._invInertia10=M,this._invInertia11=I,this._invInertia12=V,this._invInertia20=L,this._invInertia21=w,this._invInertia22=k,B=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,A=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,P=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,S=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,T=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,C=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,j=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,R=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,q=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=B,this._invInertia01=A,this._invInertia02=P,this._invInertia10=S,this._invInertia11=T,this._invInertia12=C,this._invInertia20=j,this._invInertia21=R,this._invInertia22=q,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var J=this._ptransform,O=this._transform;J._positionX=O._positionX,J._positionY=O._positionY,J._positionZ=O._positionZ,J._rotation00=O._rotation00,J._rotation01=O._rotation01,J._rotation02=O._rotation02,J._rotation10=O._rotation10,J._rotation11=O._rotation11,J._rotation12=O._rotation12,J._rotation20=O._rotation20,J._rotation21=O._rotation21,J._rotation22=O._rotation22;for(var H=this._shapeList;null!=H;){var U,Q,K,$,tt,it,at,st,ot,nt,rt,_t,et=H._next,ht=H._ptransform,lt=H._localTransform,ct=this._ptransform;U=ct._rotation00*lt._rotation00+ct._rotation01*lt._rotation10+ct._rotation02*lt._rotation20,Q=ct._rotation00*lt._rotation01+ct._rotation01*lt._rotation11+ct._rotation02*lt._rotation21,K=ct._rotation00*lt._rotation02+ct._rotation01*lt._rotation12+ct._rotation02*lt._rotation22,$=ct._rotation10*lt._rotation00+ct._rotation11*lt._rotation10+ct._rotation12*lt._rotation20,tt=ct._rotation10*lt._rotation01+ct._rotation11*lt._rotation11+ct._rotation12*lt._rotation21,it=ct._rotation10*lt._rotation02+ct._rotation11*lt._rotation12+ct._rotation12*lt._rotation22,at=ct._rotation20*lt._rotation00+ct._rotation21*lt._rotation10+ct._rotation22*lt._rotation20,st=ct._rotation20*lt._rotation01+ct._rotation21*lt._rotation11+ct._rotation22*lt._rotation21,ot=ct._rotation20*lt._rotation02+ct._rotation21*lt._rotation12+ct._rotation22*lt._rotation22,ht._rotation00=U,ht._rotation01=Q,ht._rotation02=K,ht._rotation10=$,ht._rotation11=tt,ht._rotation12=it,ht._rotation20=at,ht._rotation21=st,ht._rotation22=ot,nt=ct._rotation00*lt._positionX+ct._rotation01*lt._positionY+ct._rotation02*lt._positionZ,rt=ct._rotation10*lt._positionX+ct._rotation11*lt._positionY+ct._rotation12*lt._positionZ,_t=ct._rotation20*lt._positionX+ct._rotation21*lt._positionY+ct._rotation22*lt._positionZ,ht._positionX=nt,ht._positionY=rt,ht._positionZ=_t,ht._positionX+=ct._positionX,ht._positionY+=ct._positionY,ht._positionZ+=ct._positionZ;var mt,vt,bt,xt,pt,ft,ut,yt,Xt,gt,zt,dt,Yt,Zt,Mt,It,Vt,Lt,wt=H._transform,kt=H._localTransform,Bt=this._transform;if(mt=Bt._rotation00*kt._rotation00+Bt._rotation01*kt._rotation10+Bt._rotation02*kt._rotation20,vt=Bt._rotation00*kt._rotation01+Bt._rotation01*kt._rotation11+Bt._rotation02*kt._rotation21,bt=Bt._rotation00*kt._rotation02+Bt._rotation01*kt._rotation12+Bt._rotation02*kt._rotation22,xt=Bt._rotation10*kt._rotation00+Bt._rotation11*kt._rotation10+Bt._rotation12*kt._rotation20,pt=Bt._rotation10*kt._rotation01+Bt._rotation11*kt._rotation11+Bt._rotation12*kt._rotation21,ft=Bt._rotation10*kt._rotation02+Bt._rotation11*kt._rotation12+Bt._rotation12*kt._rotation22,ut=Bt._rotation20*kt._rotation00+Bt._rotation21*kt._rotation10+Bt._rotation22*kt._rotation20,yt=Bt._rotation20*kt._rotation01+Bt._rotation21*kt._rotation11+Bt._rotation22*kt._rotation21,Xt=Bt._rotation20*kt._rotation02+Bt._rotation21*kt._rotation12+Bt._rotation22*kt._rotation22,wt._rotation00=mt,wt._rotation01=vt,wt._rotation02=bt,wt._rotation10=xt,wt._rotation11=pt,wt._rotation12=ft,wt._rotation20=ut,wt._rotation21=yt,wt._rotation22=Xt,gt=Bt._rotation00*kt._positionX+Bt._rotation01*kt._positionY+Bt._rotation02*kt._positionZ,zt=Bt._rotation10*kt._positionX+Bt._rotation11*kt._positionY+Bt._rotation12*kt._positionZ,dt=Bt._rotation20*kt._positionX+Bt._rotation21*kt._positionY+Bt._rotation22*kt._positionZ,wt._positionX=gt,wt._positionY=zt,wt._positionZ=dt,wt._positionX+=Bt._positionX,wt._positionY+=Bt._positionY,wt._positionZ+=Bt._positionZ,H._geom._computeAabb(H._aabb,H._ptransform),Yt=H._aabb._minX,Zt=H._aabb._minY,Mt=H._aabb._minZ,It=H._aabb._maxX,Vt=H._aabb._maxY,Lt=H._aabb._maxZ,H._geom._computeAabb(H._aabb,H._transform),H._aabb._minX=Yt<H._aabb._minX?Yt:H._aabb._minX,H._aabb._minY=Zt<H._aabb._minY?Zt:H._aabb._minY,H._aabb._minZ=Mt<H._aabb._minZ?Mt:H._aabb._minZ,H._aabb._maxX=It>H._aabb._maxX?It:H._aabb._maxX,H._aabb._maxY=Vt>H._aabb._maxY?Vt:H._aabb._maxY,H._aabb._maxZ=Lt>H._aabb._maxZ?Lt:H._aabb._maxZ,null!=H._proxy){var At,Pt,St;At=H._transform._positionX-H._ptransform._positionX,Pt=H._transform._positionY-H._ptransform._positionY,St=H._transform._positionZ-H._ptransform._positionZ;var Tt=H.displacement;Tt.x=At,Tt.y=Pt,Tt.z=St,H._rigidBody._world._broadPhase.moveProxy(H._proxy,H._aabb,H.displacement)}H=et}this._sleeping=!1,this._sleepTime=0}getOrientation(){var i,a,s,o,n,r=new t.common.Quat,_=this._transform._rotation00,e=this._transform._rotation11,h=this._transform._rotation22,l=_+e+h;l>0?(o=.5*(n=Math.sqrt(l+1)),n=.5/n,i=(this._transform._rotation21-this._transform._rotation12)*n,a=(this._transform._rotation02-this._transform._rotation20)*n,s=(this._transform._rotation10-this._transform._rotation01)*n):_>e?_>h?(i=.5*(n=Math.sqrt(_-e-h+1)),n=.5/n,a=(this._transform._rotation01+this._transform._rotation10)*n,s=(this._transform._rotation02+this._transform._rotation20)*n,o=(this._transform._rotation21-this._transform._rotation12)*n):(s=.5*(n=Math.sqrt(h-_-e+1)),n=.5/n,i=(this._transform._rotation02+this._transform._rotation20)*n,a=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation10-this._transform._rotation01)*n):e>h?(a=.5*(n=Math.sqrt(e-h-_+1)),n=.5/n,i=(this._transform._rotation01+this._transform._rotation10)*n,s=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation02-this._transform._rotation20)*n):(s=.5*(n=Math.sqrt(h-_-e+1)),n=.5/n,i=(this._transform._rotation02+this._transform._rotation20)*n,a=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation10-this._transform._rotation01)*n);var c=r;return c.x=i,c.y=a,c.z=s,c.w=o,r}getOrientationTo(t){var i,a,s,o,n,r=this._transform._rotation00,_=this._transform._rotation11,e=this._transform._rotation22,h=r+_+e;h>0?(o=.5*(n=Math.sqrt(h+1)),n=.5/n,i=(this._transform._rotation21-this._transform._rotation12)*n,a=(this._transform._rotation02-this._transform._rotation20)*n,s=(this._transform._rotation10-this._transform._rotation01)*n):r>_?r>e?(i=.5*(n=Math.sqrt(r-_-e+1)),n=.5/n,a=(this._transform._rotation01+this._transform._rotation10)*n,s=(this._transform._rotation02+this._transform._rotation20)*n,o=(this._transform._rotation21-this._transform._rotation12)*n):(s=.5*(n=Math.sqrt(e-r-_+1)),n=.5/n,i=(this._transform._rotation02+this._transform._rotation20)*n,a=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation10-this._transform._rotation01)*n):_>e?(a=.5*(n=Math.sqrt(_-e-r+1)),n=.5/n,i=(this._transform._rotation01+this._transform._rotation10)*n,s=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation02-this._transform._rotation20)*n):(s=.5*(n=Math.sqrt(e-r-_+1)),n=.5/n,i=(this._transform._rotation02+this._transform._rotation20)*n,a=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation10-this._transform._rotation01)*n);var l=t;l.x=i,l.y=a,l.z=s,l.w=o}setOrientation(t){var i,a,s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y,X,g,z,d=t,Y=(i=d.x,a=d.y,s=d.z,o=d.w,2*i),Z=2*a,M=2*s,I=i*Y,V=a*Z,L=s*M,w=i*Z,k=a*M,B=i*M,A=o*Y,P=o*Z,S=o*M;this._transform._rotation00=1-V-L,this._transform._rotation01=w-S,this._transform._rotation02=B+P,this._transform._rotation10=w+S,this._transform._rotation11=1-I-L,this._transform._rotation12=k-A,this._transform._rotation20=B-P,this._transform._rotation21=k+A,this._transform._rotation22=1-I-V,n=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,r=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,_=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,e=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,h=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,l=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,c=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,m=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,v=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=n,this._invInertia01=r,this._invInertia02=_,this._invInertia10=e,this._invInertia11=h,this._invInertia12=l,this._invInertia20=c,this._invInertia21=m,this._invInertia22=v,b=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,x=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,p=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,f=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,u=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,y=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,X=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,g=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,z=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=b,this._invInertia01=x,this._invInertia02=p,this._invInertia10=f,this._invInertia11=u,this._invInertia12=y,this._invInertia20=X,this._invInertia21=g,this._invInertia22=z,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var T=this._ptransform,C=this._transform;T._positionX=C._positionX,T._positionY=C._positionY,T._positionZ=C._positionZ,T._rotation00=C._rotation00,T._rotation01=C._rotation01,T._rotation02=C._rotation02,T._rotation10=C._rotation10,T._rotation11=C._rotation11,T._rotation12=C._rotation12,T._rotation20=C._rotation20,T._rotation21=C._rotation21,T._rotation22=C._rotation22;for(var j=this._shapeList;null!=j;){var R,q,E,D,F,N,W,G,J,O,H,U,Q=j._next,K=j._ptransform,$=j._localTransform,tt=this._ptransform;R=tt._rotation00*$._rotation00+tt._rotation01*$._rotation10+tt._rotation02*$._rotation20,q=tt._rotation00*$._rotation01+tt._rotation01*$._rotation11+tt._rotation02*$._rotation21,E=tt._rotation00*$._rotation02+tt._rotation01*$._rotation12+tt._rotation02*$._rotation22,D=tt._rotation10*$._rotation00+tt._rotation11*$._rotation10+tt._rotation12*$._rotation20,F=tt._rotation10*$._rotation01+tt._rotation11*$._rotation11+tt._rotation12*$._rotation21,N=tt._rotation10*$._rotation02+tt._rotation11*$._rotation12+tt._rotation12*$._rotation22,W=tt._rotation20*$._rotation00+tt._rotation21*$._rotation10+tt._rotation22*$._rotation20,G=tt._rotation20*$._rotation01+tt._rotation21*$._rotation11+tt._rotation22*$._rotation21,J=tt._rotation20*$._rotation02+tt._rotation21*$._rotation12+tt._rotation22*$._rotation22,K._rotation00=R,K._rotation01=q,K._rotation02=E,K._rotation10=D,K._rotation11=F,K._rotation12=N,K._rotation20=W,K._rotation21=G,K._rotation22=J,O=tt._rotation00*$._positionX+tt._rotation01*$._positionY+tt._rotation02*$._positionZ,H=tt._rotation10*$._positionX+tt._rotation11*$._positionY+tt._rotation12*$._positionZ,U=tt._rotation20*$._positionX+tt._rotation21*$._positionY+tt._rotation22*$._positionZ,K._positionX=O,K._positionY=H,K._positionZ=U,K._positionX+=tt._positionX,K._positionY+=tt._positionY,K._positionZ+=tt._positionZ;var it,at,st,ot,nt,rt,_t,et,ht,lt,ct,mt,vt,bt,xt,pt,ft,ut,yt=j._transform,Xt=j._localTransform,gt=this._transform;if(it=gt._rotation00*Xt._rotation00+gt._rotation01*Xt._rotation10+gt._rotation02*Xt._rotation20,at=gt._rotation00*Xt._rotation01+gt._rotation01*Xt._rotation11+gt._rotation02*Xt._rotation21,st=gt._rotation00*Xt._rotation02+gt._rotation01*Xt._rotation12+gt._rotation02*Xt._rotation22,ot=gt._rotation10*Xt._rotation00+gt._rotation11*Xt._rotation10+gt._rotation12*Xt._rotation20,nt=gt._rotation10*Xt._rotation01+gt._rotation11*Xt._rotation11+gt._rotation12*Xt._rotation21,rt=gt._rotation10*Xt._rotation02+gt._rotation11*Xt._rotation12+gt._rotation12*Xt._rotation22,_t=gt._rotation20*Xt._rotation00+gt._rotation21*Xt._rotation10+gt._rotation22*Xt._rotation20,et=gt._rotation20*Xt._rotation01+gt._rotation21*Xt._rotation11+gt._rotation22*Xt._rotation21,ht=gt._rotation20*Xt._rotation02+gt._rotation21*Xt._rotation12+gt._rotation22*Xt._rotation22,yt._rotation00=it,yt._rotation01=at,yt._rotation02=st,yt._rotation10=ot,yt._rotation11=nt,yt._rotation12=rt,yt._rotation20=_t,yt._rotation21=et,yt._rotation22=ht,lt=gt._rotation00*Xt._positionX+gt._rotation01*Xt._positionY+gt._rotation02*Xt._positionZ,ct=gt._rotation10*Xt._positionX+gt._rotation11*Xt._positionY+gt._rotation12*Xt._positionZ,mt=gt._rotation20*Xt._positionX+gt._rotation21*Xt._positionY+gt._rotation22*Xt._positionZ,yt._positionX=lt,yt._positionY=ct,yt._positionZ=mt,yt._positionX+=gt._positionX,yt._positionY+=gt._positionY,yt._positionZ+=gt._positionZ,j._geom._computeAabb(j._aabb,j._ptransform),vt=j._aabb._minX,bt=j._aabb._minY,xt=j._aabb._minZ,pt=j._aabb._maxX,ft=j._aabb._maxY,ut=j._aabb._maxZ,j._geom._computeAabb(j._aabb,j._transform),j._aabb._minX=vt<j._aabb._minX?vt:j._aabb._minX,j._aabb._minY=bt<j._aabb._minY?bt:j._aabb._minY,j._aabb._minZ=xt<j._aabb._minZ?xt:j._aabb._minZ,j._aabb._maxX=pt>j._aabb._maxX?pt:j._aabb._maxX,j._aabb._maxY=ft>j._aabb._maxY?ft:j._aabb._maxY,j._aabb._maxZ=ut>j._aabb._maxZ?ut:j._aabb._maxZ,null!=j._proxy){var zt,dt,Yt;zt=j._transform._positionX-j._ptransform._positionX,dt=j._transform._positionY-j._ptransform._positionY,Yt=j._transform._positionZ-j._ptransform._positionZ;var Zt=j.displacement;Zt.x=zt,Zt.y=dt,Zt.z=Yt,j._rigidBody._world._broadPhase.moveProxy(j._proxy,j._aabb,j.displacement)}j=Q}this._sleeping=!1,this._sleepTime=0}getTransform(){var i=this._transform,a=new t.common.Transform;return a._positionX=i._positionX,a._positionY=i._positionY,a._positionZ=i._positionZ,a._rotation00=i._rotation00,a._rotation01=i._rotation01,a._rotation02=i._rotation02,a._rotation10=i._rotation10,a._rotation11=i._rotation11,a._rotation12=i._rotation12,a._rotation20=i._rotation20,a._rotation21=i._rotation21,a._rotation22=i._rotation22,a}getTransformTo(t){var i=this._transform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}setTransform(t){var i,a,s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u;this._transform._positionX=t._positionX,this._transform._positionY=t._positionY,this._transform._positionZ=t._positionZ,this._transform._rotation00=t._rotation00,this._transform._rotation01=t._rotation01,this._transform._rotation02=t._rotation02,this._transform._rotation10=t._rotation10,this._transform._rotation11=t._rotation11,this._transform._rotation12=t._rotation12,this._transform._rotation20=t._rotation20,this._transform._rotation21=t._rotation21,this._transform._rotation22=t._rotation22,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,a=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,s=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,n=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,_=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,e=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=a,this._invInertia02=s,this._invInertia10=o,this._invInertia11=n,this._invInertia12=r,this._invInertia20=_,this._invInertia21=e,this._invInertia22=h,l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,v=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,b=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,x=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,p=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,f=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,u=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=c,this._invInertia02=m,this._invInertia10=v,this._invInertia11=b,this._invInertia12=x,this._invInertia20=p,this._invInertia21=f,this._invInertia22=u,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var y=this._ptransform,X=this._transform;y._positionX=X._positionX,y._positionY=X._positionY,y._positionZ=X._positionZ,y._rotation00=X._rotation00,y._rotation01=X._rotation01,y._rotation02=X._rotation02,y._rotation10=X._rotation10,y._rotation11=X._rotation11,y._rotation12=X._rotation12,y._rotation20=X._rotation20,y._rotation21=X._rotation21,y._rotation22=X._rotation22;for(var g=this._shapeList;null!=g;){var z,d,Y,Z,M,I,V,L,w,k,B,A,P=g._next,S=g._ptransform,T=g._localTransform,C=this._ptransform;z=C._rotation00*T._rotation00+C._rotation01*T._rotation10+C._rotation02*T._rotation20,d=C._rotation00*T._rotation01+C._rotation01*T._rotation11+C._rotation02*T._rotation21,Y=C._rotation00*T._rotation02+C._rotation01*T._rotation12+C._rotation02*T._rotation22,Z=C._rotation10*T._rotation00+C._rotation11*T._rotation10+C._rotation12*T._rotation20,M=C._rotation10*T._rotation01+C._rotation11*T._rotation11+C._rotation12*T._rotation21,I=C._rotation10*T._rotation02+C._rotation11*T._rotation12+C._rotation12*T._rotation22,V=C._rotation20*T._rotation00+C._rotation21*T._rotation10+C._rotation22*T._rotation20,L=C._rotation20*T._rotation01+C._rotation21*T._rotation11+C._rotation22*T._rotation21,w=C._rotation20*T._rotation02+C._rotation21*T._rotation12+C._rotation22*T._rotation22,S._rotation00=z,S._rotation01=d,S._rotation02=Y,S._rotation10=Z,S._rotation11=M,S._rotation12=I,S._rotation20=V,S._rotation21=L,S._rotation22=w,k=C._rotation00*T._positionX+C._rotation01*T._positionY+C._rotation02*T._positionZ,B=C._rotation10*T._positionX+C._rotation11*T._positionY+C._rotation12*T._positionZ,A=C._rotation20*T._positionX+C._rotation21*T._positionY+C._rotation22*T._positionZ,S._positionX=k,S._positionY=B,S._positionZ=A,S._positionX+=C._positionX,S._positionY+=C._positionY,S._positionZ+=C._positionZ;var j,R,q,E,D,F,N,W,G,J,O,H,U,Q,K,$,tt,it,at=g._transform,st=g._localTransform,ot=this._transform;if(j=ot._rotation00*st._rotation00+ot._rotation01*st._rotation10+ot._rotation02*st._rotation20,R=ot._rotation00*st._rotation01+ot._rotation01*st._rotation11+ot._rotation02*st._rotation21,q=ot._rotation00*st._rotation02+ot._rotation01*st._rotation12+ot._rotation02*st._rotation22,E=ot._rotation10*st._rotation00+ot._rotation11*st._rotation10+ot._rotation12*st._rotation20,D=ot._rotation10*st._rotation01+ot._rotation11*st._rotation11+ot._rotation12*st._rotation21,F=ot._rotation10*st._rotation02+ot._rotation11*st._rotation12+ot._rotation12*st._rotation22,N=ot._rotation20*st._rotation00+ot._rotation21*st._rotation10+ot._rotation22*st._rotation20,W=ot._rotation20*st._rotation01+ot._rotation21*st._rotation11+ot._rotation22*st._rotation21,G=ot._rotation20*st._rotation02+ot._rotation21*st._rotation12+ot._rotation22*st._rotation22,at._rotation00=j,at._rotation01=R,at._rotation02=q,at._rotation10=E,at._rotation11=D,at._rotation12=F,at._rotation20=N,at._rotation21=W,at._rotation22=G,J=ot._rotation00*st._positionX+ot._rotation01*st._positionY+ot._rotation02*st._positionZ,O=ot._rotation10*st._positionX+ot._rotation11*st._positionY+ot._rotation12*st._positionZ,H=ot._rotation20*st._positionX+ot._rotation21*st._positionY+ot._rotation22*st._positionZ,at._positionX=J,at._positionY=O,at._positionZ=H,at._positionX+=ot._positionX,at._positionY+=ot._positionY,at._positionZ+=ot._positionZ,g._geom._computeAabb(g._aabb,g._ptransform),U=g._aabb._minX,Q=g._aabb._minY,K=g._aabb._minZ,$=g._aabb._maxX,tt=g._aabb._maxY,it=g._aabb._maxZ,g._geom._computeAabb(g._aabb,g._transform),g._aabb._minX=U<g._aabb._minX?U:g._aabb._minX,g._aabb._minY=Q<g._aabb._minY?Q:g._aabb._minY,g._aabb._minZ=K<g._aabb._minZ?K:g._aabb._minZ,g._aabb._maxX=$>g._aabb._maxX?$:g._aabb._maxX,g._aabb._maxY=tt>g._aabb._maxY?tt:g._aabb._maxY,g._aabb._maxZ=it>g._aabb._maxZ?it:g._aabb._maxZ,null!=g._proxy){var nt,rt,_t;nt=g._transform._positionX-g._ptransform._positionX,rt=g._transform._positionY-g._ptransform._positionY,_t=g._transform._positionZ-g._ptransform._positionZ;var et=g.displacement;et.x=nt,et.y=rt,et.z=_t,g._rigidBody._world._broadPhase.moveProxy(g._proxy,g._aabb,g.displacement)}g=P}this._sleeping=!1,this._sleepTime=0}getMass(){return this._mass}getLocalInertia(){var i=new t.common.Mat3,a=i;return a.e00=this._localInertia00,a.e01=this._localInertia01,a.e02=this._localInertia02,a.e10=this._localInertia10,a.e11=this._localInertia11,a.e12=this._localInertia12,a.e20=this._localInertia20,a.e21=this._localInertia21,a.e22=this._localInertia22,i}getLocalInertiaTo(t){var i=t;i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22}getMassData(){var i=new t.dynamics.rigidbody.MassData;i.mass=this._mass;var a=i.localInertia;return a.e00=this._localInertia00,a.e01=this._localInertia01,a.e02=this._localInertia02,a.e10=this._localInertia10,a.e11=this._localInertia11,a.e12=this._localInertia12,a.e20=this._localInertia20,a.e21=this._localInertia21,a.e22=this._localInertia22,i}getMassDataTo(t){t.mass=this._mass;var i=t.localInertia;i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22}setMassData(t){this._mass=t.mass;var i=t.localInertia;this._localInertia00=i.e00,this._localInertia01=i.e01,this._localInertia02=i.e02,this._localInertia10=i.e10,this._localInertia11=i.e11,this._localInertia12=i.e12,this._localInertia20=i.e20,this._localInertia21=i.e21,this._localInertia22=i.e22;var a,s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y,X=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,g=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,z=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,d=this._localInertia00*X-this._localInertia01*g+this._localInertia02*z;if(this._mass>0&&d>0&&0==this._type){this._invMass=1/this._mass;var Y=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,Z=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,M=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,I=this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21,V=this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20,L=this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20,w=this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11,k=this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10,B=this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10,A=this._localInertia00*Y-this._localInertia01*Z+this._localInertia02*M;(A<-1e-32||A>1e-32)&&(A=1/A),this._invLocalInertia00=Y*A,this._invLocalInertia01=-I*A,this._invLocalInertia02=w*A,this._invLocalInertia10=-Z*A,this._invLocalInertia11=V*A,this._invLocalInertia12=-k*A,this._invLocalInertia20=M*A,this._invLocalInertia21=-L*A,this._invLocalInertia22=B*A,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,0==this._type&&(this._type=1);a=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,s=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,o=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,n=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,r=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,_=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,e=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,h=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=a,this._invInertia01=s,this._invInertia02=o,this._invInertia10=n,this._invInertia11=r,this._invInertia12=_,this._invInertia20=e,this._invInertia21=h,this._invInertia22=l,c=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,m=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,v=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,b=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,x=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,p=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,f=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,u=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,y=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=c,this._invInertia01=m,this._invInertia02=v,this._invInertia10=b,this._invInertia11=x,this._invInertia12=p,this._invInertia20=f,this._invInertia21=u,this._invInertia22=y,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getRotationFactor(){var i=this._rotFactor;return new t.common.Vec3(i.x,i.y,i.z)}setRotationFactor(t){var i,a,s,o,n,r,_,e,h,l,c,m,v,b,x,p,f,u,y=this._rotFactor;y.x=t.x,y.y=t.y,y.z=t.z,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,a=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,s=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,n=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,_=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,e=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=a,this._invInertia02=s,this._invInertia10=o,this._invInertia11=n,this._invInertia12=r,this._invInertia20=_,this._invInertia21=e,this._invInertia22=h,l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,v=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,b=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,x=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,p=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,f=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,u=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=c,this._invInertia02=m,this._invInertia10=v,this._invInertia11=b,this._invInertia12=x,this._invInertia20=p,this._invInertia21=f,this._invInertia22=u,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getLinearVelocity(){var i=new t.common.Vec3,a=i;return a.x=this._velX,a.y=this._velY,a.z=this._velZ,i}getLinearVelocityTo(t){var i=t;i.x=this._velX,i.y=this._velY,i.z=this._velZ}setLinearVelocity(t){if(1==this._type)this._velX=0,this._velY=0,this._velZ=0;else{var i=t;this._velX=i.x,this._velY=i.y,this._velZ=i.z}this._sleeping=!1,this._sleepTime=0}getAngularVelocity(){var i=new t.common.Vec3,a=i;return a.x=this._angVelX,a.y=this._angVelY,a.z=this._angVelZ,i}getAngularVelocityTo(t){var i=t;i.x=this._velX,i.y=this._velY,i.z=this._velZ}setAngularVelocity(t){if(1==this._type)this._angVelX=0,this._angVelY=0,this._angVelZ=0;else{var i=t;this._angVelX=i.x,this._angVelY=i.y,this._angVelZ=i.z}this._sleeping=!1,this._sleepTime=0}addLinearVelocity(t){if(1!=this._type){var i,a,s,o=t;i=o.x,a=o.y,s=o.z,this._velX+=i,this._velY+=a,this._velZ+=s}this._sleeping=!1,this._sleepTime=0}addAngularVelocity(t){if(1!=this._type){var i,a,s,o=t;i=o.x,a=o.y,s=o.z,this._angVelX+=i,this._angVelY+=a,this._angVelZ+=s}this._sleeping=!1,this._sleepTime=0}applyImpulse(t,i){var a,s,o,n,r,_,e,h,l,c=t;a=c.x,s=c.y,o=c.z,this._velX+=a*this._invMass,this._velY+=s*this._invMass,this._velZ+=o*this._invMass;var m,v,b,x=i;e=x.x,h=x.y,l=x.z,e-=this._transform._positionX,n=(h-=this._transform._positionY)*o-(l-=this._transform._positionZ)*s,r=l*a-e*o,_=e*s-h*a,m=this._invInertia00*n+this._invInertia01*r+this._invInertia02*_,v=this._invInertia10*n+this._invInertia11*r+this._invInertia12*_,b=this._invInertia20*n+this._invInertia21*r+this._invInertia22*_,n=m,r=v,_=b,this._angVelX+=n,this._angVelY+=r,this._angVelZ+=_,this._sleeping=!1,this._sleepTime=0}applyLinearImpulse(t){var i,a,s,o=t;i=o.x,a=o.y,s=o.z,this._velX+=i*this._invMass,this._velY+=a*this._invMass,this._velZ+=s*this._invMass,this._sleeping=!1,this._sleepTime=0}applyAngularImpulse(t){var i,a,s,o,n,r,_=t;i=_.x,a=_.y,s=_.z,o=this._invInertia00*i+this._invInertia01*a+this._invInertia02*s,n=this._invInertia10*i+this._invInertia11*a+this._invInertia12*s,r=this._invInertia20*i+this._invInertia21*a+this._invInertia22*s,i=o,a=n,s=r,this._angVelX+=i,this._angVelY+=a,this._angVelZ+=s,this._sleeping=!1,this._sleepTime=0}applyForce(t,i){var a,s,o,n,r,_,e,h,l,c=t;a=c.x,s=c.y,o=c.z,this._forceX+=a,this._forceY+=s,this._forceZ+=o;var m=i;e=m.x,h=m.y,l=m.z,e-=this._transform._positionX,n=(h-=this._transform._positionY)*o-(l-=this._transform._positionZ)*s,r=l*a-e*o,_=e*s-h*a,this._torqueX+=n,this._torqueY+=r,this._torqueZ+=_,this._sleeping=!1,this._sleepTime=0}applyForceToCenter(t){var i,a,s,o=t;i=o.x,a=o.y,s=o.z,this._forceX+=i,this._forceY+=a,this._forceZ+=s,this._sleeping=!1,this._sleepTime=0}applyTorque(t){var i,a,s,o=t;i=o.x,a=o.y,s=o.z,this._torqueX+=i,this._torqueY+=a,this._torqueZ+=s,this._sleeping=!1,this._sleepTime=0}getLinearContactImpulse(){var i=new t.common.Vec3,a=i;return a.x=this._linearContactImpulseX,a.y=this._linearContactImpulseY,a.z=this._linearContactImpulseZ,i}getLinearContactImpulseTo(t){var i=t;i.x=this._linearContactImpulseX,i.y=this._linearContactImpulseY,i.z=this._linearContactImpulseZ}getAngularContactImpulse(){var i=new t.common.Vec3,a=i;return a.x=this._angularContactImpulseX,a.y=this._angularContactImpulseY,a.z=this._angularContactImpulseZ,i}getAngularContactImpulseTo(t){var i=t;i.x=this._angularContactImpulseX,i.y=this._angularContactImpulseY,i.z=this._angularContactImpulseZ}getGravityScale(){return this._gravityScale}setGravityScale(t){this._gravityScale=t,this._sleeping=!1,this._sleepTime=0}getLocalPoint(i){var a,s,o,n,r,_,e=i;a=e.x,s=e.y,o=e.z,a-=this._transform._positionX,s-=this._transform._positionY,o-=this._transform._positionZ,n=this._transform._rotation00*a+this._transform._rotation10*s+this._transform._rotation20*o,r=this._transform._rotation01*a+this._transform._rotation11*s+this._transform._rotation21*o,_=this._transform._rotation02*a+this._transform._rotation12*s+this._transform._rotation22*o,a=n,s=r,o=_;var h=new t.common.Vec3,l=h;return l.x=a,l.y=s,l.z=o,h}getLocalPointTo(t,i){var a,s,o,n,r,_,e=t;a=e.x,s=e.y,o=e.z,a-=this._transform._positionX,s-=this._transform._positionY,o-=this._transform._positionZ,n=this._transform._rotation00*a+this._transform._rotation10*s+this._transform._rotation20*o,r=this._transform._rotation01*a+this._transform._rotation11*s+this._transform._rotation21*o,_=this._transform._rotation02*a+this._transform._rotation12*s+this._transform._rotation22*o,a=n,s=r,o=_;var h=i;h.x=a,h.y=s,h.z=o}getLocalVector(i){var a,s,o,n,r,_,e=i;a=e.x,s=e.y,o=e.z,n=this._transform._rotation00*a+this._transform._rotation10*s+this._transform._rotation20*o,r=this._transform._rotation01*a+this._transform._rotation11*s+this._transform._rotation21*o,_=this._transform._rotation02*a+this._transform._rotation12*s+this._transform._rotation22*o,a=n,s=r,o=_;var h=new t.common.Vec3,l=h;return l.x=a,l.y=s,l.z=o,h}getLocalVectorTo(t,i){var a,s,o,n,r,_,e=t;a=e.x,s=e.y,o=e.z,n=this._transform._rotation00*a+this._transform._rotation10*s+this._transform._rotation20*o,r=this._transform._rotation01*a+this._transform._rotation11*s+this._transform._rotation21*o,_=this._transform._rotation02*a+this._transform._rotation12*s+this._transform._rotation22*o,a=n,s=r,o=_;var h=i;h.x=a,h.y=s,h.z=o}getWorldPoint(i){var a,s,o,n,r,_,e=i;a=e.x,s=e.y,o=e.z,n=this._transform._rotation00*a+this._transform._rotation01*s+this._transform._rotation02*o,r=this._transform._rotation10*a+this._transform._rotation11*s+this._transform._rotation12*o,_=this._transform._rotation20*a+this._transform._rotation21*s+this._transform._rotation22*o,a=n,s=r,o=_,a+=this._transform._positionX,s+=this._transform._positionY,o+=this._transform._positionZ;var h=new t.common.Vec3,l=h;return l.x=a,l.y=s,l.z=o,h}getWorldPointTo(t,i){var a,s,o,n,r,_,e=t;a=e.x,s=e.y,o=e.z,n=this._transform._rotation00*a+this._transform._rotation01*s+this._transform._rotation02*o,r=this._transform._rotation10*a+this._transform._rotation11*s+this._transform._rotation12*o,_=this._transform._rotation20*a+this._transform._rotation21*s+this._transform._rotation22*o,a=n,s=r,o=_,a+=this._transform._positionX,s+=this._transform._positionY,o+=this._transform._positionZ;var h=i;h.x=a,h.y=s,h.z=o}getWorldVector(i){var a,s,o,n,r,_,e=i;a=e.x,s=e.y,o=e.z,n=this._transform._rotation00*a+this._transform._rotation01*s+this._transform._rotation02*o,r=this._transform._rotation10*a+this._transform._rotation11*s+this._transform._rotation12*o,_=this._transform._rotation20*a+this._transform._rotation21*s+this._transform._rotation22*o,a=n,s=r,o=_;var h=new t.common.Vec3,l=h;return l.x=a,l.y=s,l.z=o,h}getWorldVectorTo(t,i){var a,s,o,n,r,_,e=t;a=e.x,s=e.y,o=e.z,n=this._transform._rotation00*a+this._transform._rotation01*s+this._transform._rotation02*o,r=this._transform._rotation10*a+this._transform._rotation11*s+this._transform._rotation12*o,_=this._transform._rotation20*a+this._transform._rotation21*s+this._transform._rotation22*o,a=n,s=r,o=_;var h=i;h.x=a,h.y=s,h.z=o}getNumShapes(){return this._numShapes}getShapeList(){return this._shapeList}getNumContectLinks(){return this._numContactLinks}getContactLinkList(){return this._contactLinkList}getNumJointLinks(){return this._numJointLinks}getJointLinkList(){return this._jointLinkList}addShape(t){if(null==this._shapeList?(this._shapeList=t,this._shapeListLast=t):(this._shapeListLast._next=t,t._prev=this._shapeListLast,this._shapeListLast=t),this._numShapes++,t._rigidBody=this,null!=this._world){var i=this._world;t._proxy=i._broadPhase.createProxy(t,t._aabb),t._id=i._shapeIdCount++,i._numShapes++}this.updateMass();for(var a=this._shapeList;null!=a;){var s,o,n,r,_,e,h,l,c,m,v,b,x=a._next,p=a._ptransform,f=a._localTransform,u=this._ptransform;s=u._rotation00*f._rotation00+u._rotation01*f._rotation10+u._rotation02*f._rotation20,o=u._rotation00*f._rotation01+u._rotation01*f._rotation11+u._rotation02*f._rotation21,n=u._rotation00*f._rotation02+u._rotation01*f._rotation12+u._rotation02*f._rotation22,r=u._rotation10*f._rotation00+u._rotation11*f._rotation10+u._rotation12*f._rotation20,_=u._rotation10*f._rotation01+u._rotation11*f._rotation11+u._rotation12*f._rotation21,e=u._rotation10*f._rotation02+u._rotation11*f._rotation12+u._rotation12*f._rotation22,h=u._rotation20*f._rotation00+u._rotation21*f._rotation10+u._rotation22*f._rotation20,l=u._rotation20*f._rotation01+u._rotation21*f._rotation11+u._rotation22*f._rotation21,c=u._rotation20*f._rotation02+u._rotation21*f._rotation12+u._rotation22*f._rotation22,p._rotation00=s,p._rotation01=o,p._rotation02=n,p._rotation10=r,p._rotation11=_,p._rotation12=e,p._rotation20=h,p._rotation21=l,p._rotation22=c,m=u._rotation00*f._positionX+u._rotation01*f._positionY+u._rotation02*f._positionZ,v=u._rotation10*f._positionX+u._rotation11*f._positionY+u._rotation12*f._positionZ,b=u._rotation20*f._positionX+u._rotation21*f._positionY+u._rotation22*f._positionZ,p._positionX=m,p._positionY=v,p._positionZ=b,p._positionX+=u._positionX,p._positionY+=u._positionY,p._positionZ+=u._positionZ;var y,X,g,z,d,Y,Z,M,I,V,L,w,k,B,A,P,S,T,C=a._transform,j=a._localTransform,R=this._transform;if(y=R._rotation00*j._rotation00+R._rotation01*j._rotation10+R._rotation02*j._rotation20,X=R._rotation00*j._rotation01+R._rotation01*j._rotation11+R._rotation02*j._rotation21,g=R._rotation00*j._rotation02+R._rotation01*j._rotation12+R._rotation02*j._rotation22,z=R._rotation10*j._rotation00+R._rotation11*j._rotation10+R._rotation12*j._rotation20,d=R._rotation10*j._rotation01+R._rotation11*j._rotation11+R._rotation12*j._rotation21,Y=R._rotation10*j._rotation02+R._rotation11*j._rotation12+R._rotation12*j._rotation22,Z=R._rotation20*j._rotation00+R._rotation21*j._rotation10+R._rotation22*j._rotation20,M=R._rotation20*j._rotation01+R._rotation21*j._rotation11+R._rotation22*j._rotation21,I=R._rotation20*j._rotation02+R._rotation21*j._rotation12+R._rotation22*j._rotation22,C._rotation00=y,C._rotation01=X,C._rotation02=g,C._rotation10=z,C._rotation11=d,C._rotation12=Y,C._rotation20=Z,C._rotation21=M,C._rotation22=I,V=R._rotation00*j._positionX+R._rotation01*j._positionY+R._rotation02*j._positionZ,L=R._rotation10*j._positionX+R._rotation11*j._positionY+R._rotation12*j._positionZ,w=R._rotation20*j._positionX+R._rotation21*j._positionY+R._rotation22*j._positionZ,C._positionX=V,C._positionY=L,C._positionZ=w,C._positionX+=R._positionX,C._positionY+=R._positionY,C._positionZ+=R._positionZ,a._geom._computeAabb(a._aabb,a._ptransform),k=a._aabb._minX,B=a._aabb._minY,A=a._aabb._minZ,P=a._aabb._maxX,S=a._aabb._maxY,T=a._aabb._maxZ,a._geom._computeAabb(a._aabb,a._transform),a._aabb._minX=k<a._aabb._minX?k:a._aabb._minX,a._aabb._minY=B<a._aabb._minY?B:a._aabb._minY,a._aabb._minZ=A<a._aabb._minZ?A:a._aabb._minZ,a._aabb._maxX=P>a._aabb._maxX?P:a._aabb._maxX,a._aabb._maxY=S>a._aabb._maxY?S:a._aabb._maxY,a._aabb._maxZ=T>a._aabb._maxZ?T:a._aabb._maxZ,null!=a._proxy){var q,E,D;q=a._transform._positionX-a._ptransform._positionX,E=a._transform._positionY-a._ptransform._positionY,D=a._transform._positionZ-a._ptransform._positionZ;var F=a.displacement;F.x=q,F.y=E,F.z=D,a._rigidBody._world._broadPhase.moveProxy(a._proxy,a._aabb,a.displacement)}a=x}}removeShape(t){var i=t._prev,a=t._next;if(null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._shapeList&&(this._shapeList=this._shapeList._next),t==this._shapeListLast&&(this._shapeListLast=this._shapeListLast._prev),t._next=null,t._prev=null,this._numShapes--,t._rigidBody=null,null!=this._world){var s=this._world;s._broadPhase.destroyProxy(t._proxy),t._proxy=null,t._id=-1;for(var o=t._rigidBody._contactLinkList;null!=o;){var n=o._next,r=o._contact;if(r._s1==t||r._s2==t){var _=o._other;_._sleeping=!1,_._sleepTime=0;var e=s._contactManager,h=r._prev,l=r._next;if(null!=h&&(h._next=l),null!=l&&(l._prev=h),r==e._contactList&&(e._contactList=e._contactList._next),r==e._contactListLast&&(e._contactListLast=e._contactListLast._prev),r._next=null,r._prev=null,r._touching){var c=r._s1._contactCallback,m=r._s2._contactCallback;c==m&&(m=null),null!=c&&c.endContact(r),null!=m&&m.endContact(r)}var v=r._link1._prev,b=r._link1._next;null!=v&&(v._next=b),null!=b&&(b._prev=v),r._link1==r._b1._contactLinkList&&(r._b1._contactLinkList=r._b1._contactLinkList._next),r._link1==r._b1._contactLinkListLast&&(r._b1._contactLinkListLast=r._b1._contactLinkListLast._prev),r._link1._next=null,r._link1._prev=null;var x=r._link2._prev,p=r._link2._next;null!=x&&(x._next=p),null!=p&&(p._prev=x),r._link2==r._b2._contactLinkList&&(r._b2._contactLinkList=r._b2._contactLinkList._next),r._link2==r._b2._contactLinkListLast&&(r._b2._contactLinkListLast=r._b2._contactLinkListLast._prev),r._link2._next=null,r._link2._prev=null,r._b1._numContactLinks--,r._b2._numContactLinks--,r._link1._other=null,r._link2._other=null,r._link1._contact=null,r._link2._contact=null,r._s1=null,r._s2=null,r._b1=null,r._b2=null,r._touching=!1,r._cachedDetectorData._clear(),r._manifold._clear(),r._detector=null;var f=r._contactConstraint;f._s1=null,f._s2=null,f._b1=null,f._b2=null,f._tf1=null,f._tf2=null,r._next=e._contactPool,e._contactPool=r,e._numContacts--}o=n}s._numShapes--}this.updateMass();for(var u=this._shapeList;null!=u;){var y,X,g,z,d,Y,Z,M,I,V,L,w,k=u._next,B=u._ptransform,A=u._localTransform,P=this._ptransform;y=P._rotation00*A._rotation00+P._rotation01*A._rotation10+P._rotation02*A._rotation20,X=P._rotation00*A._rotation01+P._rotation01*A._rotation11+P._rotation02*A._rotation21,g=P._rotation00*A._rotation02+P._rotation01*A._rotation12+P._rotation02*A._rotation22,z=P._rotation10*A._rotation00+P._rotation11*A._rotation10+P._rotation12*A._rotation20,d=P._rotation10*A._rotation01+P._rotation11*A._rotation11+P._rotation12*A._rotation21,Y=P._rotation10*A._rotation02+P._rotation11*A._rotation12+P._rotation12*A._rotation22,Z=P._rotation20*A._rotation00+P._rotation21*A._rotation10+P._rotation22*A._rotation20,M=P._rotation20*A._rotation01+P._rotation21*A._rotation11+P._rotation22*A._rotation21,I=P._rotation20*A._rotation02+P._rotation21*A._rotation12+P._rotation22*A._rotation22,B._rotation00=y,B._rotation01=X,B._rotation02=g,B._rotation10=z,B._rotation11=d,B._rotation12=Y,B._rotation20=Z,B._rotation21=M,B._rotation22=I,V=P._rotation00*A._positionX+P._rotation01*A._positionY+P._rotation02*A._positionZ,L=P._rotation10*A._positionX+P._rotation11*A._positionY+P._rotation12*A._positionZ,w=P._rotation20*A._positionX+P._rotation21*A._positionY+P._rotation22*A._positionZ,B._positionX=V,B._positionY=L,B._positionZ=w,B._positionX+=P._positionX,B._positionY+=P._positionY,B._positionZ+=P._positionZ;var S,T,C,j,R,q,E,D,F,N,W,G,J,O,H,U,Q,K,$=u._transform,tt=u._localTransform,it=this._transform;if(S=it._rotation00*tt._rotation00+it._rotation01*tt._rotation10+it._rotation02*tt._rotation20,T=it._rotation00*tt._rotation01+it._rotation01*tt._rotation11+it._rotation02*tt._rotation21,C=it._rotation00*tt._rotation02+it._rotation01*tt._rotation12+it._rotation02*tt._rotation22,j=it._rotation10*tt._rotation00+it._rotation11*tt._rotation10+it._rotation12*tt._rotation20,R=it._rotation10*tt._rotation01+it._rotation11*tt._rotation11+it._rotation12*tt._rotation21,q=it._rotation10*tt._rotation02+it._rotation11*tt._rotation12+it._rotation12*tt._rotation22,E=it._rotation20*tt._rotation00+it._rotation21*tt._rotation10+it._rotation22*tt._rotation20,D=it._rotation20*tt._rotation01+it._rotation21*tt._rotation11+it._rotation22*tt._rotation21,F=it._rotation20*tt._rotation02+it._rotation21*tt._rotation12+it._rotation22*tt._rotation22,$._rotation00=S,$._rotation01=T,$._rotation02=C,$._rotation10=j,$._rotation11=R,$._rotation12=q,$._rotation20=E,$._rotation21=D,$._rotation22=F,N=it._rotation00*tt._positionX+it._rotation01*tt._positionY+it._rotation02*tt._positionZ,W=it._rotation10*tt._positionX+it._rotation11*tt._positionY+it._rotation12*tt._positionZ,G=it._rotation20*tt._positionX+it._rotation21*tt._positionY+it._rotation22*tt._positionZ,$._positionX=N,$._positionY=W,$._positionZ=G,$._positionX+=it._positionX,$._positionY+=it._positionY,$._positionZ+=it._positionZ,u._geom._computeAabb(u._aabb,u._ptransform),J=u._aabb._minX,O=u._aabb._minY,H=u._aabb._minZ,U=u._aabb._maxX,Q=u._aabb._maxY,K=u._aabb._maxZ,u._geom._computeAabb(u._aabb,u._transform),u._aabb._minX=J<u._aabb._minX?J:u._aabb._minX,u._aabb._minY=O<u._aabb._minY?O:u._aabb._minY,u._aabb._minZ=H<u._aabb._minZ?H:u._aabb._minZ,u._aabb._maxX=U>u._aabb._maxX?U:u._aabb._maxX,u._aabb._maxY=Q>u._aabb._maxY?Q:u._aabb._maxY,u._aabb._maxZ=K>u._aabb._maxZ?K:u._aabb._maxZ,null!=u._proxy){var at,st,ot;at=u._transform._positionX-u._ptransform._positionX,st=u._transform._positionY-u._ptransform._positionY,ot=u._transform._positionZ-u._ptransform._positionZ;var nt=u.displacement;nt.x=at,nt.y=st,nt.z=ot,u._rigidBody._world._broadPhase.moveProxy(u._proxy,u._aabb,u.displacement)}u=k}}getType(){return this._type}setType(t){this._type=t,this.updateMass()}wakeUp(){this._sleeping=!1,this._sleepTime=0}sleep(){this._sleeping=!0,this._sleepTime=0}isSleeping(){return this._sleeping}getSleepTime(){return this._sleepTime}setAutoSleep(t){this._autoSleep=t,this._sleeping=!1,this._sleepTime=0}getLinearDamping(){return this._linearDamping}setLinearDamping(t){this._linearDamping=t}getAngularDamping(){return this._angularDamping}setAngularDamping(t){this._angularDamping=t}getPrev(){return this._prev}getNext(){return this._next}},t.dynamics.rigidbody.RigidBodyConfig=class{constructor(){this.position=new t.common.Vec3,this.rotation=new t.common.Mat3,this.linearVelocity=new t.common.Vec3,this.angularVelocity=new t.common.Vec3,this.type=0,this.autoSleep=!0,this.linearDamping=0,this.angularDamping=0}},t.dynamics.rigidbody.RigidBodyType=class{},t.dynamics.rigidbody.Shape=class{constructor(i){this._id=-1,this._localTransform=new t.common.Transform,this._ptransform=new t.common.Transform,this._transform=new t.common.Transform;var a=i.position;this._localTransform._positionX=a.x,this._localTransform._positionY=a.y,this._localTransform._positionZ=a.z;var s=i.rotation;this._localTransform._rotation00=s.e00,this._localTransform._rotation01=s.e01,this._localTransform._rotation02=s.e02,this._localTransform._rotation10=s.e10,this._localTransform._rotation11=s.e11,this._localTransform._rotation12=s.e12,this._localTransform._rotation20=s.e20,this._localTransform._rotation21=s.e21,this._localTransform._rotation22=s.e22;var o=this._ptransform,n=this._localTransform;o._positionX=n._positionX,o._positionY=n._positionY,o._positionZ=n._positionZ,o._rotation00=n._rotation00,o._rotation01=n._rotation01,o._rotation02=n._rotation02,o._rotation10=n._rotation10,o._rotation11=n._rotation11,o._rotation12=n._rotation12,o._rotation20=n._rotation20,o._rotation21=n._rotation21,o._rotation22=n._rotation22;var r=this._transform,_=this._localTransform;r._positionX=_._positionX,r._positionY=_._positionY,r._positionZ=_._positionZ,r._rotation00=_._rotation00,r._rotation01=_._rotation01,r._rotation02=_._rotation02,r._rotation10=_._rotation10,r._rotation11=_._rotation11,r._rotation12=_._rotation12,r._rotation20=_._rotation20,r._rotation21=_._rotation21,r._rotation22=_._rotation22,this._restitution=i.restitution,this._friction=i.friction,this._density=i.density,this._geom=i.geometry,this._collisionGroup=i.collisionGroup,this._collisionMask=i.collisionMask,this._contactCallback=i.contactCallback,this._aabb=new t.collision.geometry.Aabb,this._proxy=null,this.displacement=new t.common.Vec3}getFriction(){return this._friction}setFriction(t){this._friction=t}getRestitution(){return this._restitution}setRestitution(t){this._restitution=t}getLocalTransform(){var i=this._localTransform,a=new t.common.Transform;return a._positionX=i._positionX,a._positionY=i._positionY,a._positionZ=i._positionZ,a._rotation00=i._rotation00,a._rotation01=i._rotation01,a._rotation02=i._rotation02,a._rotation10=i._rotation10,a._rotation11=i._rotation11,a._rotation12=i._rotation12,a._rotation20=i._rotation20,a._rotation21=i._rotation21,a._rotation22=i._rotation22,a}getLocalTransformTo(t){var i=this._localTransform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}getTransform(){var i=this._transform,a=new t.common.Transform;return a._positionX=i._positionX,a._positionY=i._positionY,a._positionZ=i._positionZ,a._rotation00=i._rotation00,a._rotation01=i._rotation01,a._rotation02=i._rotation02,a._rotation10=i._rotation10,a._rotation11=i._rotation11,a._rotation12=i._rotation12,a._rotation20=i._rotation20,a._rotation21=i._rotation21,a._rotation22=i._rotation22,a}getTransformTo(t){var i=this._transform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}setLocalTransform(t){var i=this._localTransform;if(i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,null!=this._rigidBody){var a=this._rigidBody;a.updateMass();for(var s=a._shapeList;null!=s;){var o,n,r,_,e,h,l,c,m,v,b,x,p=s._next,f=s._ptransform,u=s._localTransform,y=a._ptransform;o=y._rotation00*u._rotation00+y._rotation01*u._rotation10+y._rotation02*u._rotation20,n=y._rotation00*u._rotation01+y._rotation01*u._rotation11+y._rotation02*u._rotation21,r=y._rotation00*u._rotation02+y._rotation01*u._rotation12+y._rotation02*u._rotation22,_=y._rotation10*u._rotation00+y._rotation11*u._rotation10+y._rotation12*u._rotation20,e=y._rotation10*u._rotation01+y._rotation11*u._rotation11+y._rotation12*u._rotation21,h=y._rotation10*u._rotation02+y._rotation11*u._rotation12+y._rotation12*u._rotation22,l=y._rotation20*u._rotation00+y._rotation21*u._rotation10+y._rotation22*u._rotation20,c=y._rotation20*u._rotation01+y._rotation21*u._rotation11+y._rotation22*u._rotation21,m=y._rotation20*u._rotation02+y._rotation21*u._rotation12+y._rotation22*u._rotation22,f._rotation00=o,f._rotation01=n,f._rotation02=r,f._rotation10=_,f._rotation11=e,f._rotation12=h,f._rotation20=l,f._rotation21=c,f._rotation22=m,v=y._rotation00*u._positionX+y._rotation01*u._positionY+y._rotation02*u._positionZ,b=y._rotation10*u._positionX+y._rotation11*u._positionY+y._rotation12*u._positionZ,x=y._rotation20*u._positionX+y._rotation21*u._positionY+y._rotation22*u._positionZ,f._positionX=v,f._positionY=b,f._positionZ=x,f._positionX+=y._positionX,f._positionY+=y._positionY,f._positionZ+=y._positionZ;var X,g,z,d,Y,Z,M,I,V,L,w,k,B,A,P,S,T,C,j=s._transform,R=s._localTransform,q=a._transform;if(X=q._rotation00*R._rotation00+q._rotation01*R._rotation10+q._rotation02*R._rotation20,g=q._rotation00*R._rotation01+q._rotation01*R._rotation11+q._rotation02*R._rotation21,z=q._rotation00*R._rotation02+q._rotation01*R._rotation12+q._rotation02*R._rotation22,d=q._rotation10*R._rotation00+q._rotation11*R._rotation10+q._rotation12*R._rotation20,Y=q._rotation10*R._rotation01+q._rotation11*R._rotation11+q._rotation12*R._rotation21,Z=q._rotation10*R._rotation02+q._rotation11*R._rotation12+q._rotation12*R._rotation22,M=q._rotation20*R._rotation00+q._rotation21*R._rotation10+q._rotation22*R._rotation20,I=q._rotation20*R._rotation01+q._rotation21*R._rotation11+q._rotation22*R._rotation21,V=q._rotation20*R._rotation02+q._rotation21*R._rotation12+q._rotation22*R._rotation22,j._rotation00=X,j._rotation01=g,j._rotation02=z,j._rotation10=d,j._rotation11=Y,j._rotation12=Z,j._rotation20=M,j._rotation21=I,j._rotation22=V,L=q._rotation00*R._positionX+q._rotation01*R._positionY+q._rotation02*R._positionZ,w=q._rotation10*R._positionX+q._rotation11*R._positionY+q._rotation12*R._positionZ,k=q._rotation20*R._positionX+q._rotation21*R._positionY+q._rotation22*R._positionZ,j._positionX=L,j._positionY=w,j._positionZ=k,j._positionX+=q._positionX,j._positionY+=q._positionY,j._positionZ+=q._positionZ,s._geom._computeAabb(s._aabb,s._ptransform),B=s._aabb._minX,A=s._aabb._minY,P=s._aabb._minZ,S=s._aabb._maxX,T=s._aabb._maxY,C=s._aabb._maxZ,s._geom._computeAabb(s._aabb,s._transform),s._aabb._minX=B<s._aabb._minX?B:s._aabb._minX,s._aabb._minY=A<s._aabb._minY?A:s._aabb._minY,s._aabb._minZ=P<s._aabb._minZ?P:s._aabb._minZ,s._aabb._maxX=S>s._aabb._maxX?S:s._aabb._maxX,s._aabb._maxY=T>s._aabb._maxY?T:s._aabb._maxY,s._aabb._maxZ=C>s._aabb._maxZ?C:s._aabb._maxZ,null!=s._proxy){var E,D,F;E=s._transform._positionX-s._ptransform._positionX,D=s._transform._positionY-s._ptransform._positionY,F=s._transform._positionZ-s._ptransform._positionZ;var N=s.displacement;N.x=E,N.y=D,N.z=F,s._rigidBody._world._broadPhase.moveProxy(s._proxy,s._aabb,s.displacement)}s=p}}}getDensity(){return this._density}setDensity(t){if(this._density=t,null!=this._rigidBody){var i=this._rigidBody;i.updateMass();for(var a=i._shapeList;null!=a;){var s,o,n,r,_,e,h,l,c,m,v,b,x=a._next,p=a._ptransform,f=a._localTransform,u=i._ptransform;s=u._rotation00*f._rotation00+u._rotation01*f._rotation10+u._rotation02*f._rotation20,o=u._rotation00*f._rotation01+u._rotation01*f._rotation11+u._rotation02*f._rotation21,n=u._rotation00*f._rotation02+u._rotation01*f._rotation12+u._rotation02*f._rotation22,r=u._rotation10*f._rotation00+u._rotation11*f._rotation10+u._rotation12*f._rotation20,_=u._rotation10*f._rotation01+u._rotation11*f._rotation11+u._rotation12*f._rotation21,e=u._rotation10*f._rotation02+u._rotation11*f._rotation12+u._rotation12*f._rotation22,h=u._rotation20*f._rotation00+u._rotation21*f._rotation10+u._rotation22*f._rotation20,l=u._rotation20*f._rotation01+u._rotation21*f._rotation11+u._rotation22*f._rotation21,c=u._rotation20*f._rotation02+u._rotation21*f._rotation12+u._rotation22*f._rotation22,p._rotation00=s,p._rotation01=o,p._rotation02=n,p._rotation10=r,p._rotation11=_,p._rotation12=e,p._rotation20=h,p._rotation21=l,p._rotation22=c,m=u._rotation00*f._positionX+u._rotation01*f._positionY+u._rotation02*f._positionZ,v=u._rotation10*f._positionX+u._rotation11*f._positionY+u._rotation12*f._positionZ,b=u._rotation20*f._positionX+u._rotation21*f._positionY+u._rotation22*f._positionZ,p._positionX=m,p._positionY=v,p._positionZ=b,p._positionX+=u._positionX,p._positionY+=u._positionY,p._positionZ+=u._positionZ;var y,X,g,z,d,Y,Z,M,I,V,L,w,k,B,A,P,S,T,C=a._transform,j=a._localTransform,R=i._transform;if(y=R._rotation00*j._rotation00+R._rotation01*j._rotation10+R._rotation02*j._rotation20,X=R._rotation00*j._rotation01+R._rotation01*j._rotation11+R._rotation02*j._rotation21,g=R._rotation00*j._rotation02+R._rotation01*j._rotation12+R._rotation02*j._rotation22,z=R._rotation10*j._rotation00+R._rotation11*j._rotation10+R._rotation12*j._rotation20,d=R._rotation10*j._rotation01+R._rotation11*j._rotation11+R._rotation12*j._rotation21,Y=R._rotation10*j._rotation02+R._rotation11*j._rotation12+R._rotation12*j._rotation22,Z=R._rotation20*j._rotation00+R._rotation21*j._rotation10+R._rotation22*j._rotation20,M=R._rotation20*j._rotation01+R._rotation21*j._rotation11+R._rotation22*j._rotation21,I=R._rotation20*j._rotation02+R._rotation21*j._rotation12+R._rotation22*j._rotation22,C._rotation00=y,C._rotation01=X,C._rotation02=g,C._rotation10=z,C._rotation11=d,C._rotation12=Y,C._rotation20=Z,C._rotation21=M,C._rotation22=I,V=R._rotation00*j._positionX+R._rotation01*j._positionY+R._rotation02*j._positionZ,L=R._rotation10*j._positionX+R._rotation11*j._positionY+R._rotation12*j._positionZ,w=R._rotation20*j._positionX+R._rotation21*j._positionY+R._rotation22*j._positionZ,C._positionX=V,C._positionY=L,C._positionZ=w,C._positionX+=R._positionX,C._positionY+=R._positionY,C._positionZ+=R._positionZ,a._geom._computeAabb(a._aabb,a._ptransform),k=a._aabb._minX,B=a._aabb._minY,A=a._aabb._minZ,P=a._aabb._maxX,S=a._aabb._maxY,T=a._aabb._maxZ,a._geom._computeAabb(a._aabb,a._transform),a._aabb._minX=k<a._aabb._minX?k:a._aabb._minX,a._aabb._minY=B<a._aabb._minY?B:a._aabb._minY,a._aabb._minZ=A<a._aabb._minZ?A:a._aabb._minZ,a._aabb._maxX=P>a._aabb._maxX?P:a._aabb._maxX,a._aabb._maxY=S>a._aabb._maxY?S:a._aabb._maxY,a._aabb._maxZ=T>a._aabb._maxZ?T:a._aabb._maxZ,null!=a._proxy){var q,E,D;q=a._transform._positionX-a._ptransform._positionX,E=a._transform._positionY-a._ptransform._positionY,D=a._transform._positionZ-a._ptransform._positionZ;var F=a.displacement;F.x=q,F.y=E,F.z=D,a._rigidBody._world._broadPhase.moveProxy(a._proxy,a._aabb,a.displacement)}a=x}}}getAabb(){return this._aabb.clone()}getAabbTo(t){t.copyFrom(this._aabb)}getGeometry(){return this._geom}getRigidBody(){return this._rigidBody}getCollisionGroup(){return this._collisionGroup}setCollisionGroup(t){this._collisionGroup=t}getCollisionMask(){return this._collisionMask}setCollisionMask(t){this._collisionMask=t}getContactCallback(){return this._contactCallback}setContactCallback(t){this._contactCallback=t}getPrev(){return this._prev}getNext(){return this._next}},t.dynamics.rigidbody.ShapeConfig=class{constructor(){this.position=new t.common.Vec3,this.rotation=new t.common.Mat3,this.friction=t.common.Setting.defaultFriction,this.restitution=t.common.Setting.defaultRestitution,this.density=t.common.Setting.defaultDensity,this.collisionGroup=t.common.Setting.defaultCollisionGroup,this.collisionMask=t.common.Setting.defaultCollisionMask,this.geometry=null,this.contactCallback=null}},t.m||(t.m={}),t.m.M=class{},t.collision.broadphase.BroadPhaseType._BRUTE_FORCE=1,t.collision.broadphase.BroadPhaseType._BVH=2,t.collision.broadphase.BroadPhaseType.BRUTE_FORCE=1,t.collision.broadphase.BroadPhaseType.BVH=2,t.collision.broadphase.bvh.BvhInsertionStrategy.SIMPLE=0,t.collision.broadphase.bvh.BvhInsertionStrategy.MINIMIZE_SURFACE_AREA=1,t.collision.geometry.GeometryType._SPHERE=0,t.collision.geometry.GeometryType._BOX=1,t.collision.geometry.GeometryType._CYLINDER=2,t.collision.geometry.GeometryType._CONE=3,t.collision.geometry.GeometryType._CAPSULE=4,t.collision.geometry.GeometryType._CONVEX_HULL=5,t.collision.geometry.GeometryType._CONVEX_MIN=0,t.collision.geometry.GeometryType._CONVEX_MAX=5,t.collision.geometry.GeometryType.SPHERE=0,t.collision.geometry.GeometryType.BOX=1,t.collision.geometry.GeometryType.CYLINDER=2,t.collision.geometry.GeometryType.CONE=3,t.collision.geometry.GeometryType.CAPSULE=4,t.collision.geometry.GeometryType.CONVEX_HULL=5,t.collision.narrowphase.detector.BoxBoxDetector.EDGE_BIAS_MULT=1,t.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.OK=0,t.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.INVALID_TRIANGLE=1,t.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_PAIR_INDEX=2,t.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_TRIANGLE=3,t.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.EDGE_LOOP_BROKEN=4,t.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_OUTER_TRIANGLE=5,t.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.TRIANGLE_INVISIBLE=6,t.collision.narrowphase.detector.gjkepa.EpaTriangle.count=0,t.common.Vec3.numCreations=0,t.common.Setting.defaultFriction=.2,t.common.Setting.defaultRestitution=.2,t.common.Setting.defaultDensity=1,t.common.Setting.defaultCollisionGroup=1,t.common.Setting.defaultCollisionMask=1,t.common.Setting.maxTranslationPerStep=20,t.common.Setting.maxRotationPerStep=3.14159265358979,t.common.Setting.bvhProxyPadding=.1,t.common.Setting.bvhIncrementalCollisionThreshold=.45,t.common.Setting.defaultGJKMargin=.05,t.common.Setting.enableGJKCaching=!0,t.common.Setting.maxEPAVertices=128,t.common.Setting.maxEPAPolyhedronFaces=128,t.common.Setting.contactEnableBounceThreshold=.5,t.common.Setting.velocityBaumgarte=.2,t.common.Setting.positionSplitImpulseBaumgarte=.4,t.common.Setting.positionNgsBaumgarte=1,t.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold=.05,t.common.Setting.defaultContactPositionCorrectionAlgorithm=0,t.common.Setting.alternativeContactPositionCorrectionAlgorithm=1,t.common.Setting.contactPersistenceThreshold=.05,t.common.Setting.maxManifoldPoints=4,t.common.Setting.defaultJointConstraintSolverType=0,t.common.Setting.defaultJointPositionCorrectionAlgorithm=0,t.common.Setting.jointWarmStartingFactorForBaungarte=.8,t.common.Setting.jointWarmStartingFactor=.95,t.common.Setting.minSpringDamperDampingRatio=1e-6,t.common.Setting.minRagdollMaxSwingAngle=1e-6,t.common.Setting.maxJacobianRows=6,t.common.Setting.directMlcpSolverEps=1e-9,t.common.Setting.islandInitialRigidBodyArraySize=128,t.common.Setting.islandInitialConstraintArraySize=128,t.common.Setting.sleepingVelocityThreshold=.2,t.common.Setting.sleepingAngularVelocityThreshold=.5,t.common.Setting.sleepingTimeThreshold=1,t.common.Setting.disableSleeping=!1,t.common.Setting.linearSlop=.005,t.common.Setting.angularSlop=.017453292519943278,t.collision.narrowphase.detector.gjkepa.GjkEpa.instance=new t.collision.narrowphase.detector.gjkepa.GjkEpa,t.collision.narrowphase.detector.gjkepa.GjkEpaResultState._SUCCEEDED=0,t.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_FAILED_TO_MAKE_TETRAHEDRON=1,t.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_DID_NOT_CONVERGE=2,t.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_INIT=257,t.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_ADD_VERTEX=258,t.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_DID_NOT_CONVERGE=259,t.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED=0,t.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_FAILED_TO_MAKE_TETRAHEDRON=1,t.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_DID_NOT_CONVERGE=2,t.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT=257,t.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX=258,t.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE=259,t.common.Mat3.numCreations=0,t.common.Mat4.numCreations=0,t.common.MathUtil.POSITIVE_INFINITY=1/0,t.common.MathUtil.NEGATIVE_INFINITY=-1/0,t.common.MathUtil.PI=3.14159265358979,t.common.MathUtil.TWO_PI=6.28318530717958,t.common.MathUtil.HALF_PI=1.570796326794895,t.common.MathUtil.TO_RADIANS=.017453292519943278,t.common.MathUtil.TO_DEGREES=57.29577951308238,t.common.Quat.numCreations=0,t.dynamics.common.DebugDraw.SPHERE_PHI_DIVISION=8,t.dynamics.common.DebugDraw.SPHERE_THETA_DIVISION=4,t.dynamics.common.DebugDraw.CIRCLE_THETA_DIVISION=8,t.dynamics.common.Performance.broadPhaseCollisionTime=0,t.dynamics.common.Performance.narrowPhaseCollisionTime=0,t.dynamics.common.Performance.dynamicsTime=0,t.dynamics.common.Performance.totalTime=0,t.dynamics.constraint.PositionCorrectionAlgorithm._BAUMGARTE=0,t.dynamics.constraint.PositionCorrectionAlgorithm._SPLIT_IMPULSE=1,t.dynamics.constraint.PositionCorrectionAlgorithm._NGS=2,t.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE=0,t.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE=1,t.dynamics.constraint.PositionCorrectionAlgorithm.NGS=2,t.dynamics.constraint.info.JacobianRow.BIT_LINEAR_SET=1,t.dynamics.constraint.info.JacobianRow.BIT_ANGULAR_SET=2,t.dynamics.constraint.joint.JointType._SPHERICAL=0,t.dynamics.constraint.joint.JointType._REVOLUTE=1,t.dynamics.constraint.joint.JointType._CYLINDRICAL=2,t.dynamics.constraint.joint.JointType._PRISMATIC=3,t.dynamics.constraint.joint.JointType._UNIVERSAL=4,t.dynamics.constraint.joint.JointType._RAGDOLL=5,t.dynamics.constraint.joint.JointType._GENERIC=6,t.dynamics.constraint.joint.JointType.SPHERICAL=0,t.dynamics.constraint.joint.JointType.REVOLUTE=1,t.dynamics.constraint.joint.JointType.CYLINDRICAL=2,t.dynamics.constraint.joint.JointType.PRISMATIC=3,t.dynamics.constraint.joint.JointType.UNIVERSAL=4,t.dynamics.constraint.joint.JointType.RAGDOLL=5,t.dynamics.constraint.joint.JointType.GENERIC=6,t.dynamics.constraint.solver.ConstraintSolverType._ITERATIVE=0,t.dynamics.constraint.solver.ConstraintSolverType._DIRECT=1,t.dynamics.constraint.solver.ConstraintSolverType.ITERATIVE=0,t.dynamics.constraint.solver.ConstraintSolverType.DIRECT=1,t.dynamics.rigidbody.RigidBodyType._DYNAMIC=0,t.dynamics.rigidbody.RigidBodyType._STATIC=1,t.dynamics.rigidbody.RigidBodyType._KINEMATIC=2,t.dynamics.rigidbody.RigidBodyType.DYNAMIC=0,t.dynamics.rigidbody.RigidBodyType.STATIC=1,t.dynamics.rigidbody.RigidBodyType.KINEMATIC=2;export{t as o};
