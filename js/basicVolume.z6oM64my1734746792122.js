import{m as n,e as t,U as e}from"./@tresjs.vA_UT8oy1734746792122.js";import{_ as r,a3 as o}from"./three.1FILWcBb1734746792122.js";import{P as a}from"./tweakpane.yHWGBmom1734746792122.js";import{d as i,b as c,r as l,w as u,q as s,o as p,D as v,J as f,u as m,e as _,x as d,j as g,g as h,aj as x,ak as y,f as b,al as S,m as w,F as z}from"./@vue.-THQH3GC1734746792122.js";import{_ as I}from"./@fesjs.Y0rSBxCv1734746792122.js";import"./@vueuse.lqJslAkC1734746792122.js";import"./vue-router.PPpNBBl21734746792122.js";import"./lodash-es.kYt-_xTG1734746792122.js";import"./@qlin.yHhFDldE1734746792122.js";import"./pinia.fA-Uqav61734746792122.js";import"./vue-demi.C4xddsk91734746792122.js";import"./@floating-ui.BPbuo5Gx1734746792122.js";import"./@juggle.7yjBMqoW1734746792122.js";const j=V;!function(n,t){const e=V,r=M();for(;;)try{if(621960===parseInt(e(203))/1*(-parseInt(e(187))/2)+parseInt(e(161))/3+parseInt(e(183))/4*(parseInt(e(206))/5)+-parseInt(e(205))/6*(parseInt(e(207))/7)+-parseInt(e(202))/8*(parseInt(e(188))/9)+-parseInt(e(178))/10+-parseInt(e(195))/11*(-parseInt(e(144))/12))break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const k=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e.apply(t,arguments);return e=null,n}}:function(){};return n=!1,r}}();!function(){k(this,(function(){const n=V,t=new RegExp(n(204)),e=new RegExp("\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","i"),r=T(n(165));t[n(145)](r+n(146))&&e.test(r+n(209))?T():r("0")}))()}();const D=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e.apply(t,arguments);return e=null,n}}:function(){};return n=!1,r}}();function V(n,t){const e=M();return(V=function(n,t){return e[n-=144]})(n,t)}D(void 0,(function(){const n=V,t=function(){const n=V;let t;try{t=Function(n(208)+n(174)+");")()}catch(e){t=window}return t}(),e=t[n(151)]=t[n(151)]||{},r=[n(191),n(153),"info","error","exception",n(192),n(150)];for(let o=0;o<r.length;o++){const t=D[n(171)].prototype[n(155)](D),a=r[o],i=e[a]||t;t.__proto__=D[n(155)](D),t.toString=i[n(214)][n(155)](i),e[a]=t}}))();const O=["rotation-x"],P=[j(211),"vertexShader",j(157)];function M(){const n=["1441780NATKci","length","u_color","getElapsedTime","Clock","201404bAKYAQ","basicVolumeRendering","meshRef","magFilter","589022BXrMZt","9VCltyO","addFolder","TresShaderMaterial","log","table","RedFormat","counter","77AcfKYb","u_isoValue","LinearFilter","Vector3","TresMesh","isoValue","Algorithm Settings","3992824hoSZfO","1vpqhOK","function *\\( *\\)","6BZQPXQ","30ZCUdDd","6025054lPFzpn","return (function() ","input","gger","uniforms","then","u_time","toString","2011992TRqpPS","test","chain","position","needsUpdate","stateObject","trace","console","alphaVal","warn","color","bind","Display Settings","fragmentShader","Error fetching volume data:","while (true) {}","action","2834118CEknPH","format","TresSphereGeometry","error","init","minFilter","arrayBuffer","Cross Section Settings","value","debu","constructor","apply","addBinding",'{}.constructor("return this")( )',"u_alphaVal","Data3DTexture","expanded"];return(M=function(){return n})()}const R=41,Z=i({__name:j(184),setup(e){var i;const _=j,d=window.innerWidth,g=window.innerHeight,h=c(null),x=c(null),y=new(r[_(182)]);y.start();const b=(new a)[_(189)]({title:_(156)}),S=b[_(189)]({title:_(168)}),w=new(r[_(198)])(.5,.5,.5);S.addBinding(w,"x",{label:"X",min:.02,max:.5,step:.02}),S[_(173)](w,"y",{label:"Y",min:.02,max:.5,step:.02}),S[_(173)](w,"z",{label:"Z",min:.02,max:.5,step:.02}),S[_(177)]=!0;const{camera:z}=n(),I=l({u_camera:{value:null==(i=z[_(169)])?void 0:i[_(147)]},u_resolution:{value:new(r[_(198)])(d,g,1)},u_dt:{value:.004},u_time:{value:0},u_crossSectionSize:{value:w},u_color:{value:1},u_volume:{value:null},u_isoValue:{value:.2},u_alphaVal:{value:.2}}),k=b[_(189)]({title:_(201)});k[_(173)](I.u_dt,_(169),{label:"dt",min:4e-4,max:.016,step:2e-4}),k[_(173)](I[_(180)],_(169),{label:_(154),min:1,max:3,step:1}),k[_(173)](I[_(175)],_(169),{label:_(152),min:.01,max:1,step:.01}),k.addBinding(I[_(196)],_(169),{label:_(200),min:0,max:1,step:.04}),u(x,(n=>{const t=_;if(n){const e=new(r[t(176)])(n,R,R,R);e[t(162)]=r[t(193)],e[t(166)]=r[t(197)],e[t(186)]=r[t(197)],e.wrapT=o,e[t(148)]=!0,I.u_volume[t(169)]=e}}));const{onLoop:D}=t();return D((()=>{const n=_;I[n(213)][n(169)]=y[n(181)]()})),s((()=>{(()=>{const n=V;fetch("/plugins/volumeRendering/image/nucleon_41x41x41_uint8.raw")[n(212)]((t=>t[n(167)]()))[n(212)]((t=>{const e=n,r=new Uint8Array(t),o=new Uint8Array(68921);for(let n=0;n<r[e(179)];n++)o[n]=r[n];x[e(169)]=o})).catch((t=>{const e=n;console[e(164)](e(158),t)}))})()})),(n,t)=>{const e=_;return p(),v(e(199),{ref_key:e(185),ref:h,"rotation-x":Math.PI/-2},[t[0]||(t[0]=f(e(163),{args:[1,16,16]},null,-1)),f(e(190),{uniforms:I,vertexShader:m("precision mediump float;\n\nuniform vec3 u_camera;\nuniform vec3 u_resolution;\nuniform float u_time;\n\nvarying vec3 v_hitPos;\nvarying vec3 v_hitPosWorldSpace;\nvarying vec3 v_cameraObjectSpace;\n\nvoid main() {\n  vec3 pos = position;\n\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\n\n  v_hitPos = position.xyz;\n\n  v_hitPosWorldSpace = (modelMatrix * vec4(position, 1.0)).xyz;\n\n  v_cameraObjectSpace = (inverse(modelMatrix) * vec4(u_camera, 1.0)).xyz;\n}"),fragmentShader:m("precision mediump int;\nprecision mediump float;\n\nuniform vec3 u_camera;\nuniform vec3 u_resolution;\nuniform mediump sampler3D u_volume;\nuniform vec3 u_crossSectionSize;\nuniform float u_dt;\nuniform float u_time;\nuniform float u_color;\nuniform float u_isoValue;\nuniform float u_alphaVal;\n\nvec3 palette(in float t) {\n  vec3 a = vec3(0.5, 0.5, 0.5);\n  vec3 b = vec3(0.5, 0.5, 0.5);\n  vec3 c = vec3(1.0, 1.0, 1.0);\n  vec3 d = vec3(0.00, 0.33, 0.67);\n\n  return a + b * cos(6.28318 * (c * t + d));\n}\n\nvarying vec3 v_hitPos;\nvarying vec3 v_hitPosWorldSpace;\nvarying vec3 v_cameraObjectSpace;\n\nvec2 intersect_box(vec3 orig, vec3 dir) {\n\n  vec3 box_min = vec3(-u_crossSectionSize);\n  vec3 box_max = vec3(u_crossSectionSize);\n  vec3 inv_dir = 1.0 / dir;\n  vec3 tmin_tmp = (box_min - orig) * inv_dir;\n  vec3 tmax_tmp = (box_max - orig) * inv_dir;\n  vec3 tmin = min(tmin_tmp, tmax_tmp);\n  vec3 tmax = max(tmin_tmp, tmax_tmp);\n  float t0 = max(tmin.x, max(tmin.y, tmin.z));\n  float t1 = min(tmax.x, min(tmax.y, tmax.z));\n  return vec2(t0, t1);\n}\n\nvoid main() {\n  vec3 rayOrigin = vec3(0.0, 0.0, -3.0);\n  rayOrigin = v_cameraObjectSpace;\n\n  vec2 uv = 2.0 * gl_FragCoord.xy / u_resolution.xy - 1.0;\n  vec3 rayDir = normalize(vec3(uv, 1.0));\n  rayDir = normalize(v_hitPos - rayOrigin);\n\n  vec2 t_hit = intersect_box(rayOrigin, rayDir);\n  if (t_hit.x > t_hit.y) {\n    discard;\n  }\n\n  t_hit.x = max(t_hit.x, 0.0);\n\n  float dt = u_dt;\n\n  vec4 color = vec4(0.0);\n\n  vec3 p = rayOrigin + t_hit.x * rayDir + 0.5;\n  for (float t = t_hit.x; t < t_hit.y; t += dt) {\n\n    float textureVal = texture(u_volume, p).r;\n\n    vec4 val_color = vec4(0.0);\n    float val_color_alpha = textureVal * 0.1;\n\n    val_color_alpha = smoothstep(0.0, u_alphaVal, val_color_alpha);\n\n    vec3 red = vec3(1.0, 0.0, 0.0);\n    vec3 white = vec3(1.0);\n    if (abs(u_color - 1.0) <= 0.01) {\n      val_color = vec4(white, val_color_alpha);\n    } else if (abs(u_color - 2.0) <= 0.01) {\n      val_color = vec4(mix(red, white, val_color_alpha), val_color_alpha);\n    } else {\n      val_color = vec4(palette(textureVal), val_color_alpha);\n    }\n\n    color.rgb += (1.0 - color.a) * val_color.a * val_color.rgb;\n    color.a += (1.0 - color.a) * val_color.a;\n\n    if (textureVal > u_isoValue) {\n      float gxLess = texture(u_volume, vec3(p.x - rayDir.x * u_dt, p.y, p.z)).r;\n      float gxMore = texture(u_volume, vec3(p.x + rayDir.x * u_dt, p.y, p.z)).r;\n      float dgx = gxMore - gxLess;\n\n      float gyLess = texture(u_volume, vec3(p.x, p.y - rayDir.y * u_dt, p.z)).r;\n      float gyMore = texture(u_volume, vec3(p.x, p.y + rayDir.y * u_dt, p.z)).r;\n      float dgy = gyMore - gyLess;\n\n      float gzLess = texture(u_volume, vec3(p.x, p.y, p.z - rayDir.z * u_dt)).r;\n      float gzMore = texture(u_volume, vec3(p.x, p.y, p.z + rayDir.z * u_dt)).r;\n      float dgz = gzMore - gzLess;\n      vec3 n = normalize(vec3(dgx, dgy, dgz));\n\n      vec3 lightSource = vec3(1.0);\n      vec3 lightDir = normalize(lightSource);\n      float diffuseStrength = max(dot(n, lightDir), 0.0);\n\n      vec3 viewSource = normalize(rayOrigin);\n      vec3 reflectSource = normalize(reflect(-lightSource, n));\n      float specularStrength = max(0.0, dot(viewSource, reflectSource));\n      specularStrength = pow(specularStrength, 64.0);\n\n      color.rgb = diffuseStrength * val_color.rgb + specularStrength * val_color.rgb;\n      color.rgb *= val_color.rgb;\n      color.a = 0.95;\n      break;\n    }\n\n    if (color.a >= 0.95) {\n      break;\n    }\n\n    p += rayDir * dt;\n  }\n\n  gl_FragColor = color;\n}")},null,8,P)],8,O)}}});function T(n){function t(n){const e=V;if("string"==typeof n)return function(n){}[e(171)](e(159)).apply(e(194));1!==(""+n/n)[e(179)]||n%20==0?function(){return!0}[e(171)]("debu"+e(210)).call(e(160)):function(){return!1}[e(171)](e(170)+e(210))[e(172)](e(149)),t(++n)}try{if(n)return t;t(0)}catch(e){}}const A=B;!function(n,t){const e=B,r=F();for(;;)try{if(250845===-parseInt(e(506))/1*(-parseInt(e(493))/2)+-parseInt(e(502))/3*(parseInt(e(523))/4)+parseInt(e(531))/5*(-parseInt(e(509))/6)+-parseInt(e(532))/7*(-parseInt(e(513))/8)+parseInt(e(526))/9*(-parseInt(e(535))/10)+-parseInt(e(519))/11+-parseInt(e(499))/12*(-parseInt(e(527))/13))break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const C=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e.apply(t,arguments);return e=null,n}}:function(){};return n=!1,r}}();function F(){const n=["test","while (true) {}","prototype","8nfSWtc","basicVolume","trace","TresCanvas","exception","call","295526vUDzJU","action","console","__proto__","5860ChGOMq","return (function() ","https://klacansky.com/open-scivis-datasets/skull/skull_256x256x256_uint8.raw","9EJejBN","27508BTRspU","init","error","counter","20kzWXbZ","928669pRhUVE","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","TresPerspectiveCamera","1466090qZyZkl","warn","chain","info","#201919","24qIZieb","bind","debu","stateObject","apply","TresAmbientLight","4416vILJBf","toString","length","537eodROx",'{}.constructor("return this")( )',"constructor","gger","14727aSYbwG","_blank","input","602286tXYZnz"];return(F=function(){return n})()}!function(){C(this,(function(){const n=B,t=new RegExp("function *\\( *\\)"),e=new RegExp(n(533),"i"),r=E(n(528));t[n(510)](r+n(490))&&e[n(510)](r+n(508))?E():r("0")}))()}();const L=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[B(497)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();function B(n,t){const e=F();return(B=function(n,t){return e[n-=489]})(n,t)}L(void 0,(function(){const n=B,t=function(){const n=B;let t;try{t=Function(n(524)+n(503)+");")()}catch(e){t=window}return t}(),e=t.console=t[n(521)]||{},r=["log",n(489),n(491),n(529),n(517),"table",n(515)];for(let o=0;o<r.length;o++){const t=L[n(504)][n(512)][n(494)](L),a=r[o],i=e[a]||t;t[n(522)]=L[n(494)](L),t[n(500)]=i[n(500)][n(494)](i),e[a]=t}}))();function E(n){function t(n){const e=B;if("string"==typeof n)return function(n){}[e(504)](e(511))[e(497)](e(530));1!==(""+n/n)[e(501)]||n%20==0?function(){return!0}.constructor("debu"+e(505))[e(518)](e(520)):function(){return!1}[e(504)](e(495)+e(505)).apply(e(496)),t(++n)}try{if(n)return t;t(0)}catch(e){}}const U=I(i({__name:A(514),setup(n){const t=l({windowSize:!0,alpha:!0,antialias:!0,autoClear:!1,disableRender:!0}),r=l({enableDamping:!0,enableZoom:!0,enablePan:!0,enableRotate:!0,makeDefault:!0});return(n,o)=>{const a=B,i=_(a(516));return p(),v(z,null,[o[3]||(o[3]=f("div",{class:a(491)},[f("a",{href:a(525),target:a(507)}," https://klacansky.com/open-scivis-datasets/skull/skull_256x256x256_uint8.raw "),f("br"),d(" 请自行下载数据集, 复制到 /plugins/volumeRendering/image/skull_256x256x256_uint8.raw 并更改文件请求指向和 dim 大小 ")],-1)),g(i,w({clearColor:a(492)},t),{default:h((()=>[o[0]||(o[0]=f(a(534),{fov:75,near:.001,far:1e3,position:[-1,.4,-1],"look-at":[0,0,0],up:[0,1,0]},null,-1)),o[1]||(o[1]=f(a(498),{intensity:2},null,-1)),g(m(e),x(y(r)),null,16),(p(),b(S,null,{default:h((()=>[g(Z,{position:[0,0,0]})])),_:1})),o[2]||(o[2]=f("TresGridHelper",{args:[50,50],position:[0,-5,0]},null,-1))])),_:1},16)],64)}}}),[["__scopeId","data-v-925b4c37"]]);export{U as default};
