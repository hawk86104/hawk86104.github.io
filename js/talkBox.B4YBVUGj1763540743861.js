import{a as e}from"./axios.Bl1IyXmH1763540743861.js";import{_ as a,B as t,D as s,x as l,C as n}from"./@fesjs.BEMFm_yJ1763540743861.js";import{a as o,H as r,o as i,J as u,h as c,u as d,e as v,y as p}from"./@vue.Co_gxueH1763540743861.js";import"./vue-router.BxG8XxK11763540743861.js";import"./lodash-es.B7GkVYRo1763540743861.js";import"./@vueuse.CfFJ-iFV1763540743861.js";import"./pinia.CEQ6XgE61763540743861.js";import"./@qlin.y-0Z8WnK1763540743861.js";import"./@babel.BPq7uOAK1763540743861.js";import"./@floating-ui.Bhq4ibgf1763540743861.js";import"./@juggle.Vc7cP4_P1763540743861.js";const h={class:"chatClass"},m={class:"sendVal"},y=a({__name:"talkBox",setup(a,{emit:y}){const f=o(!0),g=o(!1),w=o(null),j=o(""),b=[],L=y,E=o("msy_HAzj7ayAFW85hRM6ogfuFf64M04xJEd7YRiB"),_=o(""),I=o(!0),C=o(""),T=o(""),x=o(""),A=o(""),H=e=>{w.value.innerHTML="",e.forEach(a=>{const t=document.createElement("div");"user"===a.role?(t.classList.add("userMessage"),t.innerHTML=a.content):"assistant"===a.role&&(t.classList.add("assistantMessage"),a===e[e.length-1]?function(e,a){let t=0;function s(){t<a.length?(e.innerHTML+=a.charAt(t),t++,w.value.scrollTop=w.value.scrollHeight,requestAnimationFrame(s)):w.value.scrollTop=w.value.scrollHeight}e.innerHTML="",requestAnimationFrame(s)}(t,a.content):t.innerHTML=a.content),w.value.appendChild(t)}),w.value.scrollTop=w.value.scrollHeight};async function k(){if(!E.value||!_.value)return void alert("请填写 API 密钥和模型描述");console.log("开始生成模型"),b.push({role:"assistant",content:"开始生成模型"}),H(b),I.value=!0,C.value=0;const a={Authorization:`Bearer ${E.value}`,"Content-Type":"application/json"},t={mode:"preview",prompt:_.value,art_style:"realistic",should_remesh:!0};try{const s=await e.post("https://api.meshy.ai/openapi/v2/text-to-3d",t,{headers:a});console.log("预览任务响应:",s.data),b.push({role:"assistant",content:"预览任务响应"}),H(b),T.value=s.data.result,await new Promise((t,s)=>{x.value=setInterval(async()=>{try{const l=await e.get(`https://api.meshy.ai/openapi/v2/text-to-3d/${T.value}`,{headers:a});C.value=l.data.progress||0,console.log("预览任务进度:",C.value),b.push({role:"assistant",content:`预览任务进度:${C.value}%`}),H(b),"SUCCEEDED"===l.data.status?(clearInterval(x.value),t()):"FAILED"===l.data.status&&(clearInterval(x.value),s(new Error("预览任务失败")))}catch(l){clearInterval(x.value),s(l)}},1e4)});const l=await async function(a){const t={Authorization:`Bearer ${E.value}`,"Content-Type":"application/json"},s={mode:"refine",preview_task_id:a,enable_pbr:!0};try{const a=await e.post("https://api.meshy.ai/openapi/v2/text-to-3d",s,{headers:t});return console.log("精炼任务创建成功:",a.data),a.data.result}catch(l){return console.error("创建精炼任务失败:",l.response?l.response.data:l.message),null}}(T.value);if(!l)throw new Error("精炼任务创建失败");await new Promise((t,s)=>{x.value=setInterval(async()=>{try{const n=await e.get(`https://api.meshy.ai/openapi/v2/text-to-3d/${l}`,{headers:a});C.value=n.data.progress||0,console.log("精炼任务进度:",C.value),b.push({role:"assistant",content:`精炼任务进度:${C.value}%`}),H(b),"SUCCEEDED"===n.data.status?(clearInterval(x.value),A.value=n.data.model_urls.glb,L("callParentFunction",A.value,b,H,g,f),t()):"FAILED"===n.data.status&&(clearInterval(x.value),s(new Error("精炼任务失败")))}catch(n){clearInterval(x.value),s(n)}},1e4)})}catch(s){console.error("生成模型错误:",s.message)}finally{I.value=!1}}async function M(){if(!A.value||""===A.value.trim()||"underfind"===A.value)return;console.log(A.value);const a=A.value.replace("https://assets.meshy.ai","/meshy"),t=new URL(A.value).pathname.split("/").pop();try{const s=await e.get(a,{responseType:"blob"}),l=new Blob([s.data],{type:s.headers["content-type"]}),n=window.URL.createObjectURL(l),o=document.getElementById("download-link");o.href=n,o.download=t,o.classList.remove("hidden"),o.click(),o.classList.add("hidden"),window.URL.revokeObjectURL(n)}catch(s){console.error("下载失败:",s)}}async function D(){if(""==j.value)return;L("clearParentFunction"),g.value=!0,f.value=!0,_.value=j.value;const e=j.value;j.value=" ",b.push({role:"user",content:e}),b.push({role:"assistant",content:""}),H(b),k()}return(e,a)=>(i(),r("div",null,[u("div",h,[u("div",{ref_key:"results",ref:w,class:"resultsDiv"},null,512),u("div",m,[c(d(t),{modelValue:j.value,"onUpdate:modelValue":a[0]||(a[0]=e=>j.value=e),type:"textarea",resize:"none",class:"question",placeholder:"可以尝试对我说：'生成一个小动物模型'、'生成一个小房子'、'生成一个小汽车'"},null,8,["modelValue"]),c(d(l),{type:"small",disabled:f.value,class:"downLoad",onClick:M},{icon:v(()=>[c(d(s))]),default:v(()=>[a[1]||(a[1]=p("下载 ",-1))]),_:1},8,["disabled"]),c(d(l),{type:"primary",disabled:g.value,class:"btn",onClick:D},{icon:v(()=>[c(d(n))]),default:v(()=>[a[2]||(a[2]=p("发送 ",-1))]),_:1},8,["disabled"]),a[3]||(a[3]=u("a",{id:"download-link",class:"hidden",download:""},"下载模型",-1))])])]))}},[["__scopeId","data-v-d07b9da2"]]);export{y as default};
