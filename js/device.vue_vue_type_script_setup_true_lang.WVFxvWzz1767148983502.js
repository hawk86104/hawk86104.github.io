import{importShared as f,mergeGeometries as R}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{Fs as U,_l as D}from"./index.DTe2qqjO1767148983502.js";import{RenderPass as F,EffectComposer as P,ShaderPass as L}from"./RenderPass.DewL5X8q1767148983502.js";import{UnrealBloomPass as N}from"./UnrealBloomPass.Ct_StmlH1767148983502.js";import{OutputPass as V}from"./OutputPass.BSCzWj0O1767148983502.js";import"./customShaderMaterial.vue_vue_type_script_setup_true_lang.B7dQ_CiZ1767148983502.js";import"./index.vue_vue_type_script_setup_true_lang.CjsHShHS1767148983502.js";import{useGLTF as A}from"./index.Bk2zy1aS1767148983502.js";const H=`varying vec2 vUv;
void main(){
	vUv=uv;
	gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);
}`,O=`uniform sampler2D baseTexture;
uniform sampler2D bloomTexture;
varying vec2 vUv;
void main(){
	gl_FragColor=(texture2D(baseTexture,vUv)+vec4(1.)*texture2D(bloomTexture,vUv));
}`,i=await f("three");let C=new i.Color("#0fb1fb");const z=new i.MeshBasicMaterial({color:C,transparent:!0,opacity:.3}),b=new i.LineBasicMaterial({color:new i.Color(C),depthTest:!0,transparent:!0}),I=m=>{const o=[];m.traverse(a=>{a.isMesh&&(o.push(a.geometry),a.material=z)});const l=R(o),t=new i.EdgesGeometry(l,Math.PI*6.137),r=new i.LineSegments(t);return b.opacity=1,r.material=b,r},g={threshold:0,strength:.972,radius:.21},X=(m,o,l,t,r)=>{const a=new F(m,o),h=new N(new i.Vector2(t,r),g.strength,g.radius,g.threshold),n=new P(l);n.renderToScreen=!1,n.addPass(a),n.addPass(h);const c=new L(new i.ShaderMaterial({uniforms:{baseTexture:{value:null},bloomTexture:{value:n.renderTarget2.texture}},vertexShader:H,fragmentShader:O,defines:{}}),"baseTexture");c.needsSwap=!0;const p=new V,s=new P(l);return s.addPass(a),s.addPass(c),s.addPass(p),{finalComposer:s,effectComposer:n,renderScene:a,bloomPass:h}},{withAsyncContext:q,defineComponent:J}=await f("vue"),{unref:K,openBlock:Q,createElementBlock:W}=await f("vue"),Y=["object"],{MeshBasicMaterial:B,Color:Z}=await f("three"),{watchEffect:$,toRaw:j}=await f("vue"),le=J({__name:"device",props:{threshold:{default:0},strength:{default:.972},radius:{default:.21}},async setup(m){let o,l;const t=m,{nodes:r}=([o,l]=q(()=>A("https://opensource.cdn.icegl.cn/model/industry4/modelDraco.glb")),o=await o,l(),o),a=I(r.Sketchfab_model),{camera:h,renderer:n,scene:c,sizes:p}=U();let s=null,w=null,d=null;const y=new B({color:"black"});$(()=>{if(h.value){n.setPixelRatio(window.devicePixelRatio),c.value.add(a);const{finalComposer:e,effectComposer:u,bloomPass:G}=X(c.value,h.value,n,p.width.value,p.height.value);s=e,w=u,d=G,d.threshold=t.threshold,d.strength=t.strength,d.radius=t.radius}t.threshold&&(d.threshold=t.threshold),t.strength&&(d.strength=t.strength),t.radius&&(d.radius=t.radius)});const v={},S=e=>{(e.isMesh||e.type==="GridHelper"||e.name==="reflectorShaderMesh")&&(v[e.uuid]=e.material,e.material=y)},T=e=>{v[e.uuid]&&(e.material=v[e.uuid],delete v[e.uuid])},{onBeforeRender:x}=D();let M=.03,_=r.Sketchfab_model.getObjectByName("canister_turbine_011_Nickel-Light-PBR_0"),k=_.material.clone(),E=new B({color:new Z("red"),transparent:!0,opacity:1});return x(({elapsed:e})=>{r.hull_turbine&&(r.hull_turbine.rotation.x+=M,r.blades_turbine_003.rotation.x+=M),Math.floor(e)%2?_.material=k:_.material=E},-1),x(({elapsed:e})=>{w&&(c.value.traverse(u=>{S(u)}),w.render(e)),s&&(c.value.traverse(u=>{T(u)}),s.render(e))},1),(e,u)=>(Q(),W("primitive",{object:j(K(r).Sketchfab_model)},null,8,Y))}});export{le as _sfc_main};
