var vt=Object.defineProperty,Et=Object.defineProperties;var Ot=Object.getOwnPropertyDescriptors;var Ne=Object.getOwnPropertySymbols;var jt=Object.prototype.hasOwnProperty,Ct=Object.prototype.propertyIsEnumerable;var fe=(i,o,n)=>o in i?vt(i,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[o]=n,Fe=(i,o)=>{for(var n in o||(o={}))jt.call(o,n)&&fe(i,n,o[n]);if(Ne)for(var n of Ne(o))Ct.call(o,n)&&fe(i,n,o[n]);return i},Be=(i,o)=>Et(i,Ot(o));var u=(i,o,n)=>(fe(i,typeof o!="symbol"?o+"":o,n),n);import{by as kt,b2 as St,aT as Rt,d5 as _t,b3 as j,d6 as Q,d7 as J,bo as We,cL as Ue,aH as N,bV as Qe,bw as Dt,aw as Me,d3 as Lt,bl as q,au as le,bU as At,bz as It,av as Nt,a4 as Ft,bT as Bt,bQ as Wt,d8 as Ut,a1 as zt,l as Yt,w as Xt,o as Zt,c as Ht,t as ze,d9 as Kt,_ as qt}from"./vendor.33RuSNcm1714098412116.js";import{c as Gt,d as Vt,a as Qt}from"./ExtensionUtilities.LQVNkM5R1714098412116.js";import{C as Jt}from"./vanilla.kBt42Cs21714098412116.js";const Ye={type:"change"},ge={type:"start"},Xe={type:"end"},he=new kt,Ze=new St,$t=Math.cos(70*Rt.DEG2RAD);class ko extends _t{constructor(o,n){super(),this.object=o,this.domElement=n,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new j,this.cursor=new j,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Q.ROTATE,MIDDLE:Q.DOLLY,RIGHT:Q.PAN},this.touches={ONE:J.ROTATE,TWO:J.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",me),this._domElementKeyEvents=t},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",me),this._domElementKeyEvents=null},this.saveState=function(){e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=function(){e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(Ye),e.update(),r=a.NONE},this.update=function(){const t=new j,s=new We().setFromUnitVectors(o.up,new j(0,1,0)),d=s.clone().invert(),f=new j,k=new We,K=new j,I=2*Math.PI;return function(Pt=null){const Ae=e.object.position;t.copy(Ae).sub(e.target),t.applyQuaternion(s),c.setFromVector3(t),e.autoRotate&&r===a.NONE&&A(Z(Pt)),e.enableDamping?(c.theta+=l.theta*e.dampingFactor,c.phi+=l.phi*e.dampingFactor):(c.theta+=l.theta,c.phi+=l.phi);let U=e.minAzimuthAngle,z=e.maxAzimuthAngle;isFinite(U)&&isFinite(z)&&(U<-Math.PI?U+=I:U>Math.PI&&(U-=I),z<-Math.PI?z+=I:z>Math.PI&&(z-=I),U<=z?c.theta=Math.max(U,Math.min(z,c.theta)):c.theta=c.theta>(U+z)/2?Math.max(U,c.theta):Math.min(z,c.theta)),c.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,c.phi)),c.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(m,e.dampingFactor):e.target.add(m),e.target.sub(e.cursor),e.target.clampLength(e.minTargetRadius,e.maxTargetRadius),e.target.add(e.cursor);let oe=!1;if(e.zoomToCursor&&L||e.object.isOrthographicCamera)c.radius=P(c.radius);else{const Y=c.radius;c.radius=P(c.radius*p),oe=Y!=c.radius}if(t.setFromSpherical(c),t.applyQuaternion(d),Ae.copy(e.target).add(t),e.object.lookAt(e.target),e.enableDamping===!0?(l.theta*=1-e.dampingFactor,l.phi*=1-e.dampingFactor,m.multiplyScalar(1-e.dampingFactor)):(l.set(0,0,0),m.set(0,0,0)),e.zoomToCursor&&L){let Y=null;if(e.object.isPerspectiveCamera){const ne=t.length();Y=P(ne*p);const ce=ne-Y;e.object.position.addScaledVector(_,ce),e.object.updateMatrixWorld(),oe=!!ce}else if(e.object.isOrthographicCamera){const ne=new j(C.x,C.y,0);ne.unproject(e.object);const ce=e.object.zoom;e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/p)),e.object.updateProjectionMatrix(),oe=ce!==e.object.zoom;const Ie=new j(C.x,C.y,0);Ie.unproject(e.object),e.object.position.sub(Ie).add(ne),e.object.updateMatrixWorld(),Y=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;Y!==null&&(this.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(Y).add(e.object.position):(he.origin.copy(e.object.position),he.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(he.direction))<$t?o.lookAt(e.target):(Ze.setFromNormalAndCoplanarPoint(e.object.up,e.target),he.intersectPlane(Ze,e.target))))}else if(e.object.isOrthographicCamera){const Y=e.object.zoom;e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/p)),Y!==e.object.zoom&&(e.object.updateProjectionMatrix(),oe=!0)}return p=1,L=!1,oe||f.distanceToSquared(e.object.position)>h||8*(1-k.dot(e.object.quaternion))>h||K.distanceToSquared(e.target)>h?(e.dispatchEvent(Ye),f.copy(e.object.position),k.copy(e.object.quaternion),K.copy(e.target),!0):!1}}(),this.dispose=function(){e.domElement.removeEventListener("contextmenu",De),e.domElement.removeEventListener("pointerdown",Ce),e.domElement.removeEventListener("pointercancel",te),e.domElement.removeEventListener("wheel",ke),e.domElement.removeEventListener("pointermove",pe),e.domElement.removeEventListener("pointerup",te),e.domElement.getRootNode().removeEventListener("keydown",Se,{capture:!0}),e._domElementKeyEvents!==null&&(e._domElementKeyEvents.removeEventListener("keydown",me),e._domElementKeyEvents=null)};const e=this,a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=a.NONE;const h=1e-6,c=new Ue,l=new Ue;let p=1;const m=new j,y=new N,g=new N,E=new N,v=new N,T=new N,x=new N,M=new N,S=new N,R=new N,_=new j,C=new N;let L=!1;const b=[],D={};let X=!1;function Z(t){return t!==null?2*Math.PI/60*e.autoRotateSpeed*t:2*Math.PI/60/60*e.autoRotateSpeed}function B(t){const s=Math.abs(t*.01);return Math.pow(.95,e.zoomSpeed*s)}function A(t){l.theta-=t}function w(t){l.phi-=t}const H=function(){const t=new j;return function(d,f){t.setFromMatrixColumn(f,0),t.multiplyScalar(-d),m.add(t)}}(),O=function(){const t=new j;return function(d,f){e.screenSpacePanning===!0?t.setFromMatrixColumn(f,1):(t.setFromMatrixColumn(f,0),t.crossVectors(e.object.up,t)),t.multiplyScalar(d),m.add(t)}}(),W=function(){const t=new j;return function(d,f){const k=e.domElement;if(e.object.isPerspectiveCamera){const K=e.object.position;t.copy(K).sub(e.target);let I=t.length();I*=Math.tan(e.object.fov/2*Math.PI/180),H(2*d*I/k.clientHeight,e.object.matrix),O(2*f*I/k.clientHeight,e.object.matrix)}else e.object.isOrthographicCamera?(H(d*(e.object.right-e.object.left)/e.object.zoom/k.clientWidth,e.object.matrix),O(f*(e.object.top-e.object.bottom)/e.object.zoom/k.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}}();function ee(t){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?p/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function re(t){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?p*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function se(t,s){if(!e.zoomToCursor)return;L=!0;const d=e.domElement.getBoundingClientRect(),f=t-d.left,k=s-d.top,K=d.width,I=d.height;C.x=f/K*2-1,C.y=-(k/I)*2+1,_.set(C.x,C.y,1).unproject(e.object).sub(e.object.position).normalize()}function P(t){return Math.max(e.minDistance,Math.min(e.maxDistance,t))}function G(t){y.set(t.clientX,t.clientY)}function rt(t){se(t.clientX,t.clientX),M.set(t.clientX,t.clientY)}function we(t){v.set(t.clientX,t.clientY)}function st(t){g.set(t.clientX,t.clientY),E.subVectors(g,y).multiplyScalar(e.rotateSpeed);const s=e.domElement;A(2*Math.PI*E.x/s.clientHeight),w(2*Math.PI*E.y/s.clientHeight),y.copy(g),e.update()}function ct(t){S.set(t.clientX,t.clientY),R.subVectors(S,M),R.y>0?ee(B(R.y)):R.y<0&&re(B(R.y)),M.copy(S),e.update()}function lt(t){T.set(t.clientX,t.clientY),x.subVectors(T,v).multiplyScalar(e.panSpeed),W(x.x,x.y),v.copy(T),e.update()}function ht(t){se(t.clientX,t.clientY),t.deltaY<0?re(B(t.deltaY)):t.deltaY>0&&ee(B(t.deltaY)),e.update()}function ut(t){let s=!1;switch(t.code){case e.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?w(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):W(0,e.keyPanSpeed),s=!0;break;case e.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?w(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):W(0,-e.keyPanSpeed),s=!0;break;case e.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?A(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):W(e.keyPanSpeed,0),s=!0;break;case e.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?A(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):W(-e.keyPanSpeed,0),s=!0;break}s&&(t.preventDefault(),e.update())}function xe(t){if(b.length===1)y.set(t.pageX,t.pageY);else{const s=V(t),d=.5*(t.pageX+s.x),f=.5*(t.pageY+s.y);y.set(d,f)}}function Pe(t){if(b.length===1)v.set(t.pageX,t.pageY);else{const s=V(t),d=.5*(t.pageX+s.x),f=.5*(t.pageY+s.y);v.set(d,f)}}function ve(t){const s=V(t),d=t.pageX-s.x,f=t.pageY-s.y,k=Math.sqrt(d*d+f*f);M.set(0,k)}function dt(t){e.enableZoom&&ve(t),e.enablePan&&Pe(t)}function pt(t){e.enableZoom&&ve(t),e.enableRotate&&xe(t)}function Ee(t){if(b.length==1)g.set(t.pageX,t.pageY);else{const d=V(t),f=.5*(t.pageX+d.x),k=.5*(t.pageY+d.y);g.set(f,k)}E.subVectors(g,y).multiplyScalar(e.rotateSpeed);const s=e.domElement;A(2*Math.PI*E.x/s.clientHeight),w(2*Math.PI*E.y/s.clientHeight),y.copy(g)}function Oe(t){if(b.length===1)T.set(t.pageX,t.pageY);else{const s=V(t),d=.5*(t.pageX+s.x),f=.5*(t.pageY+s.y);T.set(d,f)}x.subVectors(T,v).multiplyScalar(e.panSpeed),W(x.x,x.y),v.copy(T)}function je(t){const s=V(t),d=t.pageX-s.x,f=t.pageY-s.y,k=Math.sqrt(d*d+f*f);S.set(0,k),R.set(0,Math.pow(S.y/M.y,e.zoomSpeed)),ee(R.y),M.copy(S);const K=(t.pageX+s.x)*.5,I=(t.pageY+s.y)*.5;se(K,I)}function mt(t){e.enableZoom&&je(t),e.enablePan&&Oe(t)}function ft(t){e.enableZoom&&je(t),e.enableRotate&&Ee(t)}function Ce(t){e.enabled!==!1&&(b.length===0&&(e.domElement.setPointerCapture(t.pointerId),e.domElement.addEventListener("pointermove",pe),e.domElement.addEventListener("pointerup",te)),!xt(t)&&(Tt(t),t.pointerType==="touch"?_e(t):gt(t)))}function pe(t){e.enabled!==!1&&(t.pointerType==="touch"?Mt(t):bt(t))}function te(t){switch(wt(t),b.length){case 0:e.domElement.releasePointerCapture(t.pointerId),e.domElement.removeEventListener("pointermove",pe),e.domElement.removeEventListener("pointerup",te),e.dispatchEvent(Xe),r=a.NONE;break;case 1:const s=b[0],d=D[s];_e({pointerId:s,pageX:d.x,pageY:d.y});break}}function gt(t){let s;switch(t.button){case 0:s=e.mouseButtons.LEFT;break;case 1:s=e.mouseButtons.MIDDLE;break;case 2:s=e.mouseButtons.RIGHT;break;default:s=-1}switch(s){case Q.DOLLY:if(e.enableZoom===!1)return;rt(t),r=a.DOLLY;break;case Q.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(e.enablePan===!1)return;we(t),r=a.PAN}else{if(e.enableRotate===!1)return;G(t),r=a.ROTATE}break;case Q.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(e.enableRotate===!1)return;G(t),r=a.ROTATE}else{if(e.enablePan===!1)return;we(t),r=a.PAN}break;default:r=a.NONE}r!==a.NONE&&e.dispatchEvent(ge)}function bt(t){switch(r){case a.ROTATE:if(e.enableRotate===!1)return;st(t);break;case a.DOLLY:if(e.enableZoom===!1)return;ct(t);break;case a.PAN:if(e.enablePan===!1)return;lt(t);break}}function ke(t){e.enabled===!1||e.enableZoom===!1||r!==a.NONE||(t.preventDefault(),e.dispatchEvent(ge),ht(yt(t)),e.dispatchEvent(Xe))}function yt(t){const s=t.deltaMode,d={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(s){case 1:d.deltaY*=16;break;case 2:d.deltaY*=100;break}return t.ctrlKey&&!X&&(d.deltaY*=10),d}function Se(t){t.key==="Control"&&(X=!0,e.domElement.getRootNode().addEventListener("keyup",Re,{passive:!0,capture:!0}))}function Re(t){t.key==="Control"&&(X=!1,e.domElement.getRootNode().removeEventListener("keyup",Re,{passive:!0,capture:!0}))}function me(t){e.enabled===!1||e.enablePan===!1||ut(t)}function _e(t){switch(Le(t),b.length){case 1:switch(e.touches.ONE){case J.ROTATE:if(e.enableRotate===!1)return;xe(t),r=a.TOUCH_ROTATE;break;case J.PAN:if(e.enablePan===!1)return;Pe(t),r=a.TOUCH_PAN;break;default:r=a.NONE}break;case 2:switch(e.touches.TWO){case J.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;dt(t),r=a.TOUCH_DOLLY_PAN;break;case J.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;pt(t),r=a.TOUCH_DOLLY_ROTATE;break;default:r=a.NONE}break;default:r=a.NONE}r!==a.NONE&&e.dispatchEvent(ge)}function Mt(t){switch(Le(t),r){case a.TOUCH_ROTATE:if(e.enableRotate===!1)return;Ee(t),e.update();break;case a.TOUCH_PAN:if(e.enablePan===!1)return;Oe(t),e.update();break;case a.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;mt(t),e.update();break;case a.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;ft(t),e.update();break;default:r=a.NONE}}function De(t){e.enabled!==!1&&t.preventDefault()}function Tt(t){b.push(t.pointerId)}function wt(t){delete D[t.pointerId];for(let s=0;s<b.length;s++)if(b[s]==t.pointerId){b.splice(s,1);return}}function xt(t){for(let s=0;s<b.length;s++)if(b[s]==t.pointerId)return!0;return!1}function Le(t){let s=D[t.pointerId];s===void 0&&(s=new N,D[t.pointerId]=s),s.set(t.pageX,t.pageY)}function V(t){const s=t.pointerId===b[0]?b[1]:b[0];return D[s]}e.domElement.addEventListener("contextmenu",De),e.domElement.addEventListener("pointerdown",Ce),e.domElement.addEventListener("pointercancel",te),e.domElement.addEventListener("wheel",ke,{passive:!1}),e.domElement.getRootNode().addEventListener("keydown",Se,{passive:!0,capture:!0}),this.update()}}var eo=Math.PI/180,to=180/Math.PI;function Je(i){var o=He(i[0]+1,i[2]),n=He(i[0],i[2]),e=Ke(i[1]+1,i[2]),a=Ke(i[1],i[2]);return[n,e,o,a]}function oo(i){var o=Je(i),n={type:"Polygon",coordinates:[[[o[0],o[3]],[o[0],o[1]],[o[2],o[1]],[o[2],o[3]],[o[0],o[3]]]]};return n}function He(i,o){return i/Math.pow(2,o)*360-180}function Ke(i,o){var n=Math.PI-2*Math.PI*i/Math.pow(2,o);return to*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))}function be(i,o,n){var e=at(i,o,n);return e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e}function $e(i){return[[i[0]*2,i[1]*2,i[2]+1],[i[0]*2+1,i[1]*2,i[2]+1],[i[0]*2+1,i[1]*2+1,i[2]+1],[i[0]*2,i[1]*2+1,i[2]+1]]}function et(i){return[i[0]>>1,i[1]>>1,i[2]-1]}function tt(i){return $e(et(i))}function no(i,o){for(var n=tt(i),e=0;e<n.length;e++)if(!ot(o,n[e]))return!1;return!0}function ot(i,o){for(var n=0;n<i.length;n++)if(nt(i[n],o))return!0;return!1}function nt(i,o){return i[0]===o[0]&&i[1]===o[1]&&i[2]===o[2]}function ao(i){for(var o="",n=i[2];n>0;n--){var e=0,a=1<<n-1;i[0]&a&&e++,i[1]&a&&(e+=2),o+=e.toString()}return o}function io(i){for(var o=0,n=0,e=i.length,a=e;a>0;a--){var r=1<<a-1,h=+i[e-a];h===1&&(o|=r),h===2&&(n|=r),h===3&&(o|=r,n|=r)}return[o,n,e]}function ro(i){var o=be(i[0],i[1],32),n=be(i[2],i[3],32),e=[o[0],o[1],n[0],n[1]],a=so(e);if(a===0)return[0,0,0];var r=e[0]>>>32-a,h=e[1]>>>32-a;return[r,h,a]}function so(i){for(var o=28,n=0;n<o;n++){var e=1<<32-(n+1);if((i[0]&e)!==(i[2]&e)||(i[1]&e)!==(i[3]&e))return n}return o}function at(i,o,n){var e=Math.sin(o*eo),a=Math.pow(2,n),r=a*(i/360+.5),h=a*(.5-.25*Math.log((1+e)/(1-e))/Math.PI);return r=r%a,r<0&&(r=r+a),[r,h,n]}var ue={tileToGeoJSON:oo,tileToBBOX:Je,getChildren:$e,getParent:et,getSiblings:tt,hasTile:ot,hasSiblings:no,tilesEqual:nt,tileToQuadkey:ao,quadkeyToTile:io,pointToTile:be,bboxToTile:ro,pointToTileFraction:at};class Te extends Qe{constructor(){super();u(this,"map");u(this,"tileNo");u(this,"isDisposed",!1);u(this,"isReady",!1);u(this,"parentTile");u(this,"childrenTiles",[]);u(this,"boundingBoxWorld",new Dt);u(this,"content")}init(n,e,a){this.tileNo=n,Object.freeze(this.tileNo),this.map=e,this.parentTile=a,this.visible=!1,this.renderOrder=n[2],this.ready()}async ready(){if(this.content=await this.map.provider.getTile(this.tileNo),!this.isDisposed){if(this.add(this.content),this.boundingBoxWorld.setFromObject(this.content).applyMatrix4(this.matrixWorld.makeRotationX(-Math.PI/2)),this.map.add(this),this.visible=!0,this.isReady=!0,this.parentTile){const n=this.parentTile.childrenTiles;let e=0;for(let a=0;a<n.length;a++)n[a].isReady&&e++;e===4&&(this.parentTile.visible=!1)}this.update()}}update(){if(!this.isReady||this.isDisposed)return;const{cameraFrustum:n,cameraWorldPosition:e}=this.map;if(!n.intersectsBox(this.boundingBoxWorld)){this.simplify();return}this.content instanceof Me&&this.map.provider.filter&&(this.content.material.uniforms.t_Matrix.value=this.map.provider.getTranMatrix());let a=this.boundingBoxWorld.distanceToPoint(e);const r=this.tileNo[2];a/=Math.pow(2,this.map.provider.maxZoom-r),a<60&&this.subdivide(),a>80&&this.simplify(),this.childrenTiles.sort((c,l)=>c.boundingBoxWorld.distanceToPoint(e)-l.boundingBoxWorld.distanceToPoint(e)).forEach(c=>c.update())}subdivide(){const{isReady:n,tileNo:e,map:a,childrenTiles:r}=this,h=e[2];if(!n||r.length>0||h>=a.maxZoom)return;ue.getChildren(e).forEach(l=>{const p=new Te;p.init(l,a,this),r.push(p)})}simplify(){this.childrenTiles.forEach(n=>n.dispose()),this.childrenTiles=[],this.visible=!0}dispose(){this.map.remove(this),this.map.provider.abort(this.tileNo),this.childrenTiles.forEach(n=>n.dispose()),this.childrenTiles=[],this.parentTile=void 0,this.content&&(this.map.provider.dispose(this.tileNo,this.content),this.content=void 0),this.isDisposed=!0}}let So=class extends Qe{constructor(){super();u(this,"provider");u(this,"bbox",[74.390592,6.900905,134.071423,54.318199]);u(this,"maxZoom",20);u(this,"rootForward",0);u(this,"camera");u(this,"cameraFrustum",new Lt);u(this,"cameraWorldPosition",new j);u(this,"cameraProjectionMatrix",new q);u(this,"lastCameraProjectionMatrix",new q);u(this,"lastCameraWorldPosition",new j);u(this,"rootTiles",[]);u(this,"lastUpdateTime",0);le.prototype.computeBoundsTree||(le.prototype.computeBoundsTree=Gt),le.prototype.disposeBoundsTree||(le.prototype.disposeBoundsTree=Vt),Me.prototype.raycast=Qt}initRootTiles(){this.rootForward>3&&(console.warn("rootForward needs to be 0 - 3."),this.rootForward=3),this.rootForward<0&&(console.warn("rootForward needs to be 0 - 3."),this.rootForward=0);const n=[];let e=[ue.bboxToTile(this.bbox)],a=this.rootForward;for(;a>0;){const r=[...e];e=[],r.forEach(h=>{const c=ue.getChildren(h);e.push(...c)}),a--}n.push(...e),n.forEach(r=>{const h=new Te;h.init(r,this),this.rootTiles.push(h)})}update(){if(!this.visible||!this.camera)return;const n=Date.now();if(!(n-this.lastUpdateTime<300)){if(this.rootTiles.length===0){this.initRootTiles();return}this.camera.getWorldPosition(this.cameraWorldPosition),this.cameraProjectionMatrix.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),!(this.cameraWorldPosition.equals(this.lastCameraWorldPosition)&&this.cameraProjectionMatrix.equals(this.lastCameraProjectionMatrix))&&(this.cameraFrustum.setFromProjectionMatrix(this.cameraProjectionMatrix),this.rootTiles.forEach(e=>e.update()),this.lastCameraProjectionMatrix.copy(this.cameraProjectionMatrix),this.lastCameraWorldPosition.copy(this.cameraWorldPosition),this.lastUpdateTime=n)}}dispose(){throw new Error("[Map.dispose] Method not implemented.")}regenerate(){throw new Error("[Map.regenerate] Method not implemented.")}};const $=class ${constructor(){u(this,"_controller",new AbortController);u(this,"listeners",new Set)}fetch(o,n={}){$.pendings.has(o)||($.pendings.set(o,this),fetch(o,Be(Fe({},n),{signal:this._controller.signal})).then(e=>{this.listeners.forEach(a=>a.resolve(e.clone()))}).catch(e=>{this.listeners.forEach(a=>a.reject(e))}).finally(()=>{$.pendings.delete(o)}))}abort(){this._controller.abort()}};u($,"pendings",new Map);let ie=$;class co{constructor(o,n){u(this,"resolve");u(this,"reject");u(this,"promise");this.url=o,this.init=n,this.promise=new Promise((e,a)=>{this.resolve=e,this.reject=a})}ready(){let o=ie.pendings.get(this.url);return o||(o=new ie,o.fetch(this.url,this.init)),o.listeners.add(this),this.promise}abort(){this.reject("User abort.");const o=ie.pendings.get(this.url);o&&(o.listeners.delete(this),o.listeners.size===0&&o.abort())}}let ae;async function lo(i,o,n=!1){const a=await(await o.ready()).blob(),r=await createImageBitmap(a,n?void 0:{imageOrientation:"flipY"});if(!n)return r;ae||(ae=new OffscreenCanvas(256,256));const h=ae.getContext("2d");if(!h)throw new Error('Offscreencanvas.getContext("2d") error!');const{width:c,height:l}=ae;return h.drawImage(r,0,0),h.rect(0,0,c,l),h.strokeStyle="#00FFFF",h.font="20px Arial",h.stroke(),h.fillStyle="#FF4444",h.fillText("".concat(i[0]),10,30),h.fillStyle="#44FF44",h.fillText("".concat(i[1]),10,55),h.fillStyle="#66AAFF",h.fillText("".concat(i[2]),10,80),await createImageBitmap(ae,{imageOrientation:"flipY"})}class ho{constructor(o){u(this,"worker");u(this,"terminated",!0);u(this,"map",new Map);this.worker=new o,this.worker.onmessage=this.onMessage.bind(this),this.terminated=!1}async postMessage(o){if(!this.terminated)return this.worker.postMessage(o),new Promise((n,e)=>{this.map.set(o.id,n)})}onMessage(o){const{id:n,error:e}=o.data,a=this.map.get(n);a&&!e&&a(o.data),this.map.delete(n)}terminate(){this.worker.onmessage=null,this.worker.terminate(),this.terminated=!0,this.map.clear()}}function uo(i){return new Worker(""+new URL("../static/MapWorker-P8uJfnMJ.js",import.meta.url).href,{name:i==null?void 0:i.name})}class _o{constructor(){u(this,"maxZoom",20);u(this,"source","https://gac-geo.googlecnapps.cn/maps/vt?lyrs=s&x=[x]&y=[y]&z=[z]");u(this,"showTileNo",!1);u(this,"_useWorker",!1);u(this,"_worker");u(this,"fetching",new Map)}set useWorker(o){var n;this._useWorker=o,this._useWorker||((n=this._worker)==null||n.terminate(),this._worker=void 0)}get useWorker(){return this._useWorker}async getTile(o){const n=this.getUrl(o),e=new At;if(this._useWorker){this._worker||(this._worker=new ho(uo));const a=this.getId(o),r=await this._worker.postMessage({id:a,tileNo:o,url:n,debug:this.showTileNo});e.image=r.bitmap}else{const a=new co(n,{cache:"force-cache",mode:"cors"});this.fetching.set(o,a);try{e.image=await lo(o,a,this.showTileNo)}finally{this.fetching.delete(o)}}return e.needsUpdate=!0,e.anisotropy=4,e}abort(o){var n;if(this._useWorker)(n=this._worker)==null||n.postMessage({id:this.getId(o),abort:!0});else{const e=this.fetching.get(o);e&&e.abort(),this.fetching.delete(o)}}dispose(o,n){n.dispose()}getId(o){return o.join("-")}getUrl(o){const[n,e,a]=o;return this.source.indexOf("[x]")===-1?this.source.replace("{x}",n+"").replace("{y}",e+"").replace("{z}",a+""):this.source.replace("[x]",n+"").replace("[y]",e+"").replace("[z]",a+"")}}const ye="utm",po="merc",de=6378137,qe=Math.PI/180;function Ge(i,o){const n=de*i*qe,e=de*Math.log(Math.tan(Math.PI*.25+o*qe*.5));return[n,e]}function mo(i,o){let n=i/(de*Math.PI)*180,e=o/(de*Math.PI)*180;return e=180/Math.PI*(2*Math.atan(Math.exp(e*Math.PI/180))-Math.PI/2),[n,e]}function F(i){return i*Math.PI/180}function Ve(i){return i*180/Math.PI}const it={a:6378137,b:6356752314245e-6,f:1/298.257223563},fo="CDEFGHJKLMNPQRSTUVWXX",go=5e5,bo=1e7;function yo(i,o,n){if(!(-80<=o&&o<=84))throw new RangeError("latitude ‘".concat(o,"’ outside UTM limits"));let e=n||Math.floor((i+180)/6)+1,a=F((e-1)*6-180+3);const r=fo.charAt(Math.floor(o/8+10));e===31&&r==="V"&&i>=3?(e++,a+=F(6)):e===32&&r==="X"&&i<9?(e--,a-=F(6)):e===32&&r==="X"&&i>=9?(e++,a+=F(6)):e===34&&r==="X"&&i<21?(e--,a-=F(6)):e===34&&r==="X"&&i>=21?(e++,a+=F(6)):e===36&&r==="X"&&i<33?(e--,a-=F(6)):e===36&&r==="X"&&i>=33&&(e++,a+=F(6));const h=F(o),c=F(i)-a,{a:l,f:p}=it,m=.9996,y=Math.sqrt(p*(2-p)),g=p/(2-p),E=g*g,v=g*E,T=g*v,x=g*T,M=g*x,S=Math.cos(c),R=Math.sin(c),_=Math.tan(h),C=Math.sinh(y*Math.atanh(y*_/Math.sqrt(1+_*_))),L=_*Math.sqrt(1+C*C)-C*Math.sqrt(1+_*_),b=Math.atan2(L,S),D=Math.asinh(R/Math.sqrt(L*L+S*S)),X=l/(1+g)*(1+1/4*E+1/64*T+1/256*M),Z=[null,1/2*g-2/3*E+5/16*v+41/180*T-127/288*x+7891/37800*M,13/48*E-3/5*v+557/1440*T+281/630*x-1983433/1935360*M,61/240*v-103/140*T+15061/26880*x+167603/181440*M,49561/161280*T-179/168*x+6601661/7257600*M,34729/80640*x-3418889/1995840*M,212378941/319334400*M];let B=b;for(let O=1;O<=6;O++)B+=Z[O]*Math.sin(2*O*b)*Math.cosh(2*O*D);let A=D;for(let O=1;O<=6;O++)A+=Z[O]*Math.cos(2*O*b)*Math.sinh(2*O*D);let w=m*X*A,H=m*X*B;return w=w+go,H<0&&(H=H+bo),[w,H]}function Mo(i,o,n){const a=n||50,r=5e5,{a:h,f:c}=it,l=.9996,p=i-r,m=o,y=Math.sqrt(c*(2-c)),g=c/(2-c),E=g*g,v=g*E,T=g*v,x=g*T,M=g*x,S=h/(1+g)*(1+1/4*E+1/64*T+1/256*M),R=p/(l*S),_=m/(l*S),C=[null,1/2*g-2/3*E+37/96*v-1/360*T-81/512*x+96199/604800*M,1/48*E+1/15*v-437/1440*T+46/105*x-1118711/3870720*M,17/480*v-37/840*T-209/4480*x+5569/90720*M,4397/161280*T-11/504*x-830251/7257600*M,4583/161280*x-108847/3991680*M,20648693/638668800*M];let L=_;for(let P=1;P<=6;P++)L-=C[P]*Math.sin(2*P*_)*Math.cosh(2*P*R);let b=R;for(let P=1;P<=6;P++)b-=C[P]*Math.cos(2*P*_)*Math.sinh(2*P*R);const D=Math.sinh(b),X=Math.sin(L),Z=Math.cos(L),B=X/Math.sqrt(D*D+Z*Z);let A=null,w=B;do{const P=Math.sinh(y*Math.atanh(y*w/Math.sqrt(1+w*w))),G=w*Math.sqrt(1+P*P)-P*Math.sqrt(1+w*w);A=(B-G)/Math.sqrt(1+G*G)*(1+(1-y*y)*w*w)/((1-y*y)*Math.sqrt(1+w*w)),w+=A}while(Math.abs(A)>1e-12);const O=Math.atan(w);let W=Math.atan2(D,Z);const ee=F((a-1)*6-180+3);W+=ee;const re=Number(Ve(O).toFixed(14));return[Number(Ve(W).toFixed(14)),re]}class Do{constructor(){u(this,"utmZone",50);u(this,"coordType",ye);u(this,"maxZoom",20)}async getTile(o){const n=new It,e=ue.tileToBBOX(o),a=this.convertCoordinate(e[0],e[3]),r=this.convertCoordinate(e[2],e[3]),h=this.convertCoordinate(e[0],e[1]),c=this.convertCoordinate(e[2],e[1]),l=new Float32Array([a[0],a[1],0,r[0],r[1],0,h[0],h[1],0,c[0],c[1],0]);return n.setAttribute("position",new Nt(l,3)),n}abort(o){}dispose(o,n){n.dispose()}convertCoordinate(o,n){switch(this.coordType){case ye:return yo(o,n,this.utmZone);case po:return Ge(o,n);default:return Ge(o,n)}}}class To extends Me{constructor(n){super(n);u(this,"center",new j)}}class Lo{constructor(o,n){u(this,"maxZoom",20);u(this,"showBoundingBox",!1);u(this,"wireframe",!1);u(this,"flatShading",!1);u(this,"useStandardMaterial",!1);u(this,"filter",null);this.geometryProvider=o,this.textureProvider=n}getTranMatrix(){var n,e,a,r,h;let o=new q;if((n=this.filter)!=null&&n.opposite){let c=new q;c.set(-1,0,0,0,0,-1,0,0,0,0,-1,0,1,1,1,1),o.multiply(c)}if((e=this.filter)!=null&&e.monochrome){let c=new q;const l=this.filter.monochrome.r,p=this.filter.monochrome.g,m=this.filter.monochrome.b;c.set(l,p,m,0,l,p,m,0,l,p,m,0,0,0,0,1),o.multiply(c)}if((a=this.filter)!=null&&a.genBright){let c=new q;const l=this.filter.genBright;c.set(l,0,0,0,0,l,0,0,0,0,l,0,0,0,0,1),o.multiply(c)}if((r=this.filter)!=null&&r.genContrast){let c=new q;const l=this.filter.genContrast,p=.5*(1-l);c.set(l,0,0,0,0,l,0,0,0,0,l,0,p,p,p,1),o.multiply(c)}if((h=this.filter)!=null&&h.genSaturate){let c=new q;const l=this.filter.genSaturate,p=.3*(1-l),m=.6*(1-l),y=.1*(1-l);c.set(p+l,p,p,0,m,m+l,m,0,y,y,y+l,0,0,0,0,1),o.multiply(c)}return o}async getTile(o){const n=[this.geometryProvider.getTile(o),this.textureProvider.getTile(o)],e=await Promise.all(n),a=e[0],r=e[1];r.colorSpace=Ft;const{wireframe:h,flatShading:c}=this;let l=null;const p=o[0]+o[1]+o[2];l=this.useStandardMaterial?new Bt({map:r,wireframe:h,flatShading:c}):new Wt({map:r,wireframe:h}),this.filter&&(l=new Jt({baseMaterial:l,vertexShader:"\n                varying vec2 vUv;    //顶点纹理坐标\n                void main () {\n                    vUv = uv;\n                    // gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4( position, 1.0 ); 着色器会抖动\n                    // gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                    csm_Position = position * vec3(1.0);\n                }\n                ",fragmentShader:"\n                uniform sampler2D e_Texture;     //纹理图像\n                varying vec2 vUv;               //片元纹理坐标\n                uniform mat4 t_Matrix;     //接收变换矩阵\n                void main () {\n                    // gl_FragColor = texture2D( e_Texture, vUv );\n\n                    // vec4 textureColor = texture2D( e_Texture, vUv );\n                    // //计算加权平均值\n                    // float w_a = textureColor.r * 0.3 + textureColor.g * 0.6 + textureColor.b * 0.1;\n                    // gl_FragColor = vec4(w_a, w_a, w_a, 1.0);\n\n                    vec4 textureColor = texture2D( e_Texture, vUv );\n                    //变换矩阵乘以 vec4(R,G,B,1)    --->vec4(R,G,B,1) 是齐次坐标，原本是n维的向量用一个n+1维向量来表示\n                    //vec4(R,G,B,1)第四个分量不是透明度\n                    vec4 transColor =  vec4(textureColor.r, textureColor.g, textureColor.b, 1.0)*t_Matrix; \n                    //设置透明度\n                    transColor.a = 1.0;\n                    csm_FragColor = transColor;\n\n                    // if(vUv.x==0.0 || vUv.x==1.0 || vUv.y==0.0 || vUv.y==1.0){\n                    //     gl_FragColor.a = 0.0;\n                    // }\n                }",silent:!0,flatShading:c,uniforms:{e_Texture:{value:r},t_Matrix:{value:this.getTranMatrix()}}}));const m=new To;if(m.renderOrder=p,a.computeBoundingBox(),a.boundingBox.getCenter(m.center),a.center(),a.computeBoundingSphere(),a.computeBoundsTree(),m.position.copy(m.center),m.geometry=a,m.material=l,this.showBoundingBox){const y=new Ut(a.boundingBox);m.add(y)}return m}abort(o){this.geometryProvider.abort(o),this.textureProvider.abort(o)}dispose(o,n){const e=n.geometry,a=n.material;e&&this.geometryProvider.dispose(o,e),a&&a.map&&this.textureProvider.dispose(o,a.map),a==null||a.dispose()}}const wo={class:"lonLatDiv"},xo=zt({__name:"raycasterEvent",props:{tileMapRef:{}},setup(i){const o=i,n=Yt([0,0]);return Xt(()=>o.tileMapRef,(e,a)=>{if(!a&&e){let c=function(l){h.x=l.clientX/window.innerWidth*2-1,h.y=-(l.clientY/window.innerHeight)*2+1,r.setFromCamera(h,e.camera);var p=r.intersectObjects(e.map.children);if(p.length>0){var m=p[0];e.map.provider.geometryProvider.coordType===ye?n.value=Mo(m.point.x,-m.point.z):n.value=mo(m.point.x,-m.point.z),n.value[0]=n.value[0].toFixed(4),n.value[1]=n.value[1].toFixed(4)}};console.log("raycasterEvent:",e);var r=new Kt,h=new N;document.addEventListener("mousemove",c,!1)}}),(e,a)=>(Zt(),Ht("div",wo," lon:"+ze(n.value[0])+" lat:"+ze(n.value[1]),1))}}),Ao=qt(xo,[["__scopeId","data-v-462a60f8"]]);export{So as M,ko as O,Do as P,Lo as T,ye as U,_o as a,ho as b,po as c,Ge as d,yo as l,Ao as r};
