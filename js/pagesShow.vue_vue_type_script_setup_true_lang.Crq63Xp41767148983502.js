import{importShared as r}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{_l as b,Kk as M}from"./index.DTe2qqjO1767148983502.js";import{instance as B}from"./Resource.DwxffO9V1767148983502.js";import{B as x}from"./three-custom-shader-material.es.DIiohWIA1767148983502.js";import{buildingsCustomShaderMaterial_default as E,buildingsCustomShaderMaterial_default$1 as T}from"./buildingsCustomShaderMaterial.BegDixQI1767148983502.js";import{LineSegmentsGeometry as R,LineMaterial as k,LineSegments2 as A}from"./LineSegments2.BWdpcsAi1767148983502.js";const{watch:L}=await r("vue"),$=async()=>{B.getResource("FBXLoader","https://opensource.cdn.icegl.cn/model/digitalCity/shanghai.FBX","shanghai.FBX");const e=B.getReactiveItem("shanghai.FBX");return new Promise((t,n)=>{const s=L(()=>e(),i=>{if(i){s();let u=null,c=null,o=null;i.traverse(a=>{a.name==="CITY_UNTRIANGULATED"&&(u=a),a.name==="LANDMASS"&&(c=a),a.name==="ROADS"&&(o=a)}),t({model:i,city:u,land:c,roads:o})}else n(new Error("FBX 加载失败，未得到模型"))})})},{defineComponent:N}=await r("vue"),{unref:F,openBlock:D,createElementBlock:G}=await r("vue"),O=["object"],{watchEffect:P,watch:H}=await r("vue"),p=await r("three"),V=N({__name:"buildingsModelCustomShader",props:{model:{},bulidingsColor:{default:"#e523ff"},landColor:{default:"#112233"},topColor:{default:"#ffff00"},opacity:{default:.9},gradient:{type:Boolean,default:!0}},setup(d){const e=d,t=e.model.city;t.renderOrder=1001;const n=e.model.land,s=(o,a)=>{let l;l=Array.isArray(n.material)?n.material:[n.material],l.forEach(m=>{m[a].setStyle(e.landColor),m.side=p.DoubleSide})};(()=>{const{geometry:o}=t;o.computeBoundingBox(),o.computeBoundingSphere();const{max:a,min:l}=o.boundingBox;if(t.material.__csm)return;const m=new x({baseMaterial:t.material,vertexShader:T,fragmentShader:E,silent:!0,uniforms:{uMax:{value:a},uMin:{value:l},uBorderWidth:{value:5},uCircleTime:{value:5},uColor:{value:new p.Color(e.bulidingsColor)},uOpacity:{value:e.opacity},uLightColor:{value:new p.Color("#ffffff")},uTopColor:{value:new p.Color(e.topColor)},uTime:{value:0},uGradient:{value:e.gradient}},depthWrite:!0,depthTest:!0,transparent:!0,side:p.DoubleSide});t.material.dispose(),t.material=m})();const{onBeforeRender:u}=b();u(({delta:o})=>{t.material.uniforms.uTime.value+=o}),P(()=>{e.bulidingsColor&&t.material.uniforms.uColor.value.setStyle(e.bulidingsColor),e.landColor&&s("land","color"),e.opacity&&(t.material.uniforms.uOpacity.value=e.opacity)}),H(e,(o,a)=>{t.material.uniforms.uGradient.value=o.gradient});const c=e.model.model.clone();return(o,a)=>(D(),G("primitive",{object:F(c)},null,8,O))}}),{defineComponent:W}=await r("vue"),{unref:I,openBlock:X,createElementBlock:j}=await r("vue"),U=["object"],{Color:w,EdgesGeometry:S,ShaderMaterial:z}=await r("three"),{watchEffect:Y}=await r("vue"),K=W({__name:"buildingsLines",props:{builds:{},width:{default:1},color:{default:"#FFF"},opacity:{default:1},style:{default:"Wireframe"}},setup(d){const e=d;let t=null,n=null;if(e.style==="Wireframe"){const s=new S(e.builds.geometry);let u=new R().fromEdgesGeometry(s),c=new k({color:e.color,linewidth:e.width,opacity:e.opacity,transparent:!0,depthWrite:!0,depthTest:!0});c.resolution.set(window.innerWidth,window.innerHeight),t=new A(u,c),t.applyMatrix4(e.builds.matrix.clone())}else{n={transparent:!0,uniforms:{uColor:{value:new w(e.color)},uOpacity:{value:e.opacity}},vertexShader:`
       void main() {
          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
      `,fragmentShader:` 
        uniform vec3 uColor;
				uniform float uOpacity;
        void main() {
          gl_FragColor = vec4(uColor, uOpacity);
        }
      `};const s=new S(e.builds.geometry),i=new z(n);t=new LineSegments(s,i),t.applyMatrix4(e.builds.matrix.clone()),t.material.linewidth=e.width,t.renderOrder=1e3}return Y(()=>{e.style==="Shader"&&(e.color&&(n.uniforms.uColor.value=new w(e.color)),e.opacity&&(n.uniforms.uOpacity.value=e.opacity)),e.style==="Wireframe"&&(e.color&&(t.material.color=new w(e.color)),e.opacity&&(t.material.opacity=e.opacity)),e.width&&(t.material.linewidth=e.width)}),(s,i)=>(X(),j("primitive",{object:I(t)},null,8,U))}}),{defineComponent:q}=await r("vue"),{createElementVNode:g,unref:y,normalizeProps:J,guardReactiveProps:Q,createVNode:h,Fragment:Z,openBlock:f,createElementBlock:_,createCommentVNode:v,renderSlot:ee,resolveComponent:te,mergeProps:oe,withCtx:ae,createBlock:re}=await r("vue"),ne={key:1,args:[1e3],position:[0,19,0]},ie={key:2,args:[6e3,100],position:[0,19,0]},{SRGBColorSpace:le,BasicShadowMap:se,ACESFilmicToneMapping:ue}=await r("three"),{reactive:ce,ref:C,onMounted:de}=await r("vue"),he=q({__name:"pagesShow",props:{showBuildings:{type:Boolean,default:!0},autoRotate:{type:Boolean,default:!0},showAxesHelper:{type:Boolean,default:!0},showGridHelper:{type:Boolean,default:!0},disableRender:{type:Boolean,default:!1}},setup(d,{expose:e}){const t=d,n=ce({clearColor:"#000000",shadows:!0,alpha:!1,useLegacyLights:!0,shadowMapType:se,outputColorSpace:le,toneMapping:ue,toneMappingExposure:1.2,renderMode:t.disableRender?"manual":"always"}),s={autoRotate:t.autoRotate,enableDamping:!0,makeDefault:!0};let i=C(null);const u=C(!1);de(async()=>{t.showBuildings&&(i.value=await $()),u.value=!0});const c=a=>{debugger},o=C();return e({context:o,contextReady:u}),(a,l)=>{const m=te("TresCanvas");return f(),re(m,oe({ref_key:"tcRef",ref:o},n,{"window-size":"",onReady:c}),{default:ae(()=>[l[0]||(l[0]=g("TresPerspectiveCamera",{position:[600,750,-1221],fov:45,near:1,far:1e5},null,-1)),h(y(M),J(Q(s)),null,16),l[1]||(l[1]=g("TresAmbientLight",{color:"#ffffff"},null,-1)),l[2]||(l[2]=g("TresDirectionalLight",{position:[100,100,0],intensity:.5,color:"#ffffff"},null,-1)),t.showBuildings&&u.value?(f(),_(Z,{key:0},[h(V,{model:y(i)},null,8,["model"]),h(K,{builds:y(i).city,color:"#000"},null,8,["builds"])],64)):v("",!0),ee(a.$slots,"ability"),t.showAxesHelper?(f(),_("TresAxesHelper",ne)):v("",!0),t.showGridHelper?(f(),_("TresGridHelper",ie)):v("",!0)]),_:3},16)}}});export{he as _sfc_main,V as _sfc_main$1,K as _sfc_main$2,$ as loadCityFBX};
