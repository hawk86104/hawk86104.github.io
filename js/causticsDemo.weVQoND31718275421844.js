import{aA as nt,er as tt,aB as rt,at as ot,bi as it,bT as lt,bn as ze,c$ as pn,ax as qe,aw as st,cc as ct,es as at,aM as hn,bU as vn,a5 as En,aH as ut,bZ as pt,ao as ht,o as je,c as vt,T as xe,a6 as Ke,b7 as wt,q as ft,au as mt,C as wn,J as $e,ac as St,b8 as Et,ad as _t,a as Je,ae as fn,af as mn,ag as gt,a1 as pe,ak as It}from"./vendor.n5mLuYaN1718275421844.js";import"./vanilla.-sS8aqyU1718275421844.js";import"./vanilla.esm.5.5.0.YRRwLpko1718275421844.js";import{_ as yt}from"./index.vue_vue_type_script_setup_true_lang._bPWTBij1718275421844.js";import"./index.iuxbrWH61718275421844.js";import"./_commonjsHelpers.5-cIlDoe1718275421844.js";import"./object_hash.DvA9o96b1718275421844.js";import"./_commonjs-dynamic-modules.h-SxKiO41718275421844.js";import"./shaderMaterial.qwUzrG6_1718275421844.js";import"./Pass.VyKpn7B61718275421844.js";const dt=h=>h&&h.isCubeTexture;class Ct extends nt{constructor(p,w){var g,I;const x=dt(p),P=((I=x?(g=p.image[0])==null?void 0:g.width:p.image.width)!=null?I:1024)/4,y=Math.floor(Math.log2(P)),A=Math.pow(2,y),W=3*Math.max(A,16*7),K=4*A,ee=[x?"#define ENVMAP_TYPE_CUBE":"","#define CUBEUV_TEXEL_WIDTH ".concat(1/W),"#define CUBEUV_TEXEL_HEIGHT ".concat(1/K),"#define CUBEUV_MAX_MIP ".concat(y,".0")],ce="\n        varying vec3 vWorldPosition;\n        void main() \n        {\n            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );\n            vWorldPosition = worldPosition.xyz;\n            \n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n        ",we=ee.join("\n")+"\n        #define ENVMAP_TYPE_CUBE_UV\n        varying vec3 vWorldPosition;\n        uniform float radius;\n        uniform float height;\n        uniform float angle;\n        #ifdef ENVMAP_TYPE_CUBE\n            uniform samplerCube map;\n        #else\n            uniform sampler2D map;\n        #endif\n        // From: https://www.shadertoy.com/view/4tsBD7\n        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) \n        {\n            float d = dot ( rd, n );\n            \n            if( d > 0.0 ) { return 1e6; }\n            \n            vec3  o = ro - c;\n            float t = - dot( n, o ) / d;\n            vec3  q = o + rd * t;\n            \n            return ( dot( q, q ) < r * r ) ? t : 1e6;\n        }\n        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm\n        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) \n        {\n            vec3 oc = ro - ce;\n            float b = dot( oc, rd );\n            float c = dot( oc, oc ) - ra * ra;\n            float h = b * b - c;\n            \n            if( h < 0.0 ) { return -1.0; }\n            \n            h = sqrt( h );\n            \n            return - b + h;\n        }\n        vec3 project() \n        {\n            vec3 p = normalize( vWorldPosition );\n            vec3 camPos = cameraPosition;\n            camPos.y -= height;\n            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );\n            if( intersection > 0.0 ) {\n                \n                vec3 h = vec3( 0.0, - height, 0.0 );\n                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );\n                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;\n            } else {\n                p = vec3( 0.0, 1.0, 0.0 );\n            }\n            return p;\n        }\n        #include <common>\n        #include <cube_uv_reflection_fragment>\n        void main() \n        {\n            vec3 projectedWorldPosition = project();\n            \n            #ifdef ENVMAP_TYPE_CUBE\n                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;\n            #else\n                vec3 direction = normalize( projectedWorldPosition );\n                vec2 uv = equirectUv( direction );\n                vec3 outcolor = texture2D( map, uv ).rgb;\n            #endif\n            gl_FragColor = vec4( outcolor, 1.0 );\n            #include <tonemapping_fragment>\n            #include <".concat(parseInt(it.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment",">\n        }\n        "),fe={map:{value:p},height:{value:(w==null?void 0:w.height)||15},radius:{value:(w==null?void 0:w.radius)||100}},G=new tt(1,16),me=new rt({uniforms:fe,fragmentShader:we,vertexShader:ce,side:ot});super(G,me)}set radius(p){this.material.uniforms.radius.value=p}get radius(){return this.material.uniforms.radius.value}set height(p){this.material.uniforms.height.value=p}get height(){return this.material.uniforms.height.value}}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var Sn=function(h){return URL.createObjectURL(new Blob([h],{type:"text/javascript"}))};try{URL.revokeObjectURL(Sn(""))}catch(h){Sn=function(p){return"data:application/javascript;charset=UTF-8,"+encodeURI(p)}}var V=Uint8Array,ue=Uint16Array,en=Uint32Array,_n=new V([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),gn=new V([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ut=new V([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),In=function(h,p){for(var w=new ue(31),g=0;g<31;++g)w[g]=p+=1<<h[g-1];for(var I=new en(w[30]),g=1;g<30;++g)for(var x=w[g];x<w[g+1];++x)I[x]=x-w[g]<<5|g;return[w,I]},yn=In(_n,2),dn=yn[0],Tt=yn[1];dn[28]=258,Tt[258]=28;var xt=In(gn,0),bt=xt[0],nn=new ue(32768);for(var F=0;F<32768;++F){var ae=(F&43690)>>>1|(F&21845)<<1;ae=(ae&52428)>>>2|(ae&13107)<<2,ae=(ae&61680)>>>4|(ae&3855)<<4,nn[F]=((ae&65280)>>>8|(ae&255)<<8)>>>1}var be=function(h,p,w){for(var g=h.length,I=0,x=new ue(p);I<g;++I)++x[h[I]-1];var N=new ue(p);for(I=0;I<p;++I)N[I]=N[I-1]+x[I-1]<<1;var P;if(w){P=new ue(1<<p);var y=15-p;for(I=0;I<g;++I)if(h[I])for(var A=I<<4|h[I],W=p-h[I],K=N[h[I]-1]++<<W,ee=K|(1<<W)-1;K<=ee;++K)P[nn[K]>>>y]=A}else for(P=new ue(g),I=0;I<g;++I)h[I]&&(P[I]=nn[N[h[I]-1]++]>>>15-h[I]);return P},Ne=new V(288);for(var F=0;F<144;++F)Ne[F]=8;for(var F=144;F<256;++F)Ne[F]=9;for(var F=256;F<280;++F)Ne[F]=7;for(var F=280;F<288;++F)Ne[F]=8;var Cn=new V(32);for(var F=0;F<32;++F)Cn[F]=5;var Nt=be(Ne,9,1),At=be(Cn,5,1),Qe=function(h){for(var p=h[0],w=1;w<h.length;++w)h[w]>p&&(p=h[w]);return p},j=function(h,p,w){var g=p/8|0;return(h[g]|h[g+1]<<8)>>(p&7)&w},Ve=function(h,p){var w=p/8|0;return(h[w]|h[w+1]<<8|h[w+2]<<16)>>(p&7)},Rt=function(h){return(h/8|0)+(h&7&&1)},Mt=function(h,p,w){(p==null||p<0)&&(p=0),(w==null||w>h.length)&&(w=h.length);var g=new(h instanceof ue?ue:h instanceof en?en:V)(w-p);return g.set(h.subarray(p,w)),g},Ot=function(h,p,w){var g=h.length;if(!g||w&&!w.l&&g<5)return p||new V(0);var I=!p||w,x=!w||w.i;w||(w={}),p||(p=new V(g*3));var N=function(R){var ie=p.length;if(R>ie){var le=new V(Math.max(ie*2,R));le.set(p),p=le}},P=w.f||0,y=w.p||0,A=w.b||0,W=w.l,K=w.d,ee=w.m,ce=w.n,we=g*8;do{if(!W){w.f=P=j(h,y,1);var fe=j(h,y+1,3);if(y+=3,fe)if(fe==1)W=Nt,K=At,ee=9,ce=5;else if(fe==2){var Re=j(h,y,31)+257,He=j(h,y+10,15)+4,Xe=Re+j(h,y+5,31)+1;y+=14;for(var Se=new V(Xe),Me=new V(19),Y=0;Y<He;++Y)Me[Ut[Y]]=j(h,y+Y*3,7);y+=He*3;for(var Oe=Qe(Me),We=(1<<Oe)-1,Ge=be(Me,Oe,1),Y=0;Y<Xe;){var $=Ge[j(h,y,We)];y+=$&15;var G=$>>>4;if(G<16)Se[Y++]=G;else{var oe=0,ne=0;for(G==16?(ne=3+j(h,y,3),y+=2,oe=Se[Y-1]):G==17?(ne=3+j(h,y,7),y+=3):G==18&&(ne=11+j(h,y,127),y+=7);ne--;)Se[Y++]=oe}}var Fe=Se.subarray(0,Re),te=Se.subarray(Re);ee=Qe(Fe),ce=Qe(te),W=be(Fe,ee,1),K=be(te,ce,1)}else throw"invalid block type";else{var G=Rt(y)+4,me=h[G-4]|h[G-3]<<8,Ae=G+me;if(Ae>g){if(x)throw"unexpected EOF";break}I&&N(A+me),p.set(h.subarray(G,Ae),A),w.b=A+=me,w.p=y=Ae*8;continue}if(y>we){if(x)throw"unexpected EOF";break}}I&&N(A+131072);for(var Be=(1<<ee)-1,Pe=(1<<ce)-1,ge=y;;ge=y){var oe=W[Ve(h,y)&Be],L=oe>>>4;if(y+=oe&15,y>we){if(x)throw"unexpected EOF";break}if(!oe)throw"invalid length/literal";if(L<256)p[A++]=L;else if(L==256){ge=y,W=null;break}else{var Ee=L-254;if(L>264){var Y=L-257,H=_n[Y];Ee=j(h,y,(1<<H)-1)+dn[Y],y+=H}var he=K[Ve(h,y)&Pe],ve=he>>>4;if(!he)throw"invalid distance";y+=he&15;var te=bt[ve];if(ve>3){var H=gn[ve];te+=Ve(h,y)&(1<<H)-1,y+=H}if(y>we){if(x)throw"unexpected EOF";break}I&&N(A+131072);for(var Ie=A+Ee;A<Ie;A+=4)p[A]=p[A-te],p[A+1]=p[A+1-te],p[A+2]=p[A+2-te],p[A+3]=p[A+3-te];A=Ie}}w.l=W,w.p=ge,w.b=A,W&&(P=1,w.m=ee,w.d=K,w.n=ce)}while(!P);return A==p.length?p:Mt(p,0,A)},Ft=new V(0),Bt=function(h){if((h[0]&15)!=8||h[0]>>>4>7||(h[0]<<8|h[1])%31)throw"invalid zlib data";if(h[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Le(h,p){return Ot((Bt(h),h.subarray(2,-4)),p)}var Pt=typeof TextDecoder<"u"&&new TextDecoder,kt=0;try{Pt.decode(Ft,{stream:!0}),kt=1}catch(h){}class Dt extends lt{constructor(p){super(p),this.type=ze}parse(p){const Oe=Math.pow(2.7182818,2.2);function We(e,n){let t=0;for(let i=0;i<65536;++i)(i==0||e[i>>3]&1<<(i&7))&&(n[t++]=i);const r=t-1;for(;t<65536;)n[t++]=0;return r}function Ge(e){for(let n=0;n<16384;n++)e[n]={},e[n].len=0,e[n].lit=0,e[n].p=null}const $={l:0,c:0,lc:0};function oe(e,n,t,r,i){for(;t<e;)n=n<<8|an(r,i),t+=8;t-=e,$.l=n>>t&(1<<e)-1,$.c=n,$.lc=t}const ne=new Array(59);function Fe(e){for(let t=0;t<=58;++t)ne[t]=0;for(let t=0;t<65537;++t)ne[e[t]]+=1;let n=0;for(let t=58;t>0;--t){const r=n+ne[t]>>1;ne[t]=n,n=r}for(let t=0;t<65537;++t){const r=e[t];r>0&&(e[t]=r|ne[r]++<<6)}}function te(e,n,t,r,i,o){const s=n;let a=0,u=0;for(;r<=i;r++){if(s.value-n.value>t)return!1;oe(6,a,u,e,s);const l=$.l;if(a=$.c,u=$.lc,o[r]=l,l==63){if(s.value-n.value>t)throw new Error("Something wrong with hufUnpackEncTable");oe(8,a,u,e,s);let c=$.l+6;if(a=$.c,u=$.lc,r+c>i+1)throw new Error("Something wrong with hufUnpackEncTable");for(;c--;)o[r++]=0;r--}else if(l>=59){let c=l-59+2;if(r+c>i+1)throw new Error("Something wrong with hufUnpackEncTable");for(;c--;)o[r++]=0;r--}}Fe(o)}function Be(e){return e&63}function Pe(e){return e>>6}function ge(e,n,t,r){for(;n<=t;n++){const i=Pe(e[n]),o=Be(e[n]);if(i>>o)throw new Error("Invalid table entry");if(o>14){const s=r[i>>o-14];if(s.len)throw new Error("Invalid table entry");if(s.lit++,s.p){const a=s.p;s.p=new Array(s.lit);for(let u=0;u<s.lit-1;++u)s.p[u]=a[u]}else s.p=new Array(1);s.p[s.lit-1]=n}else if(o){let s=0;for(let a=1<<14-o;a>0;a--){const u=r[(i<<14-o)+s];if(u.len||u.p)throw new Error("Invalid table entry");u.len=o,u.lit=n,s++}}}return!0}const L={c:0,lc:0};function Ee(e,n,t,r){e=e<<8|an(t,r),n+=8,L.c=e,L.lc=n}const H={c:0,lc:0};function he(e,n,t,r,i,o,s,a,u){if(e==n){r<8&&(Ee(t,r,i,o),t=L.c,r=L.lc),r-=8;let l=t>>r;if(l=new Uint8Array([l])[0],a.value+l>u)return!1;const c=s[a.value-1];for(;l-- >0;)s[a.value++]=c}else if(a.value<u)s[a.value++]=e;else return!1;H.c=t,H.lc=r}function ve(e){return e&65535}function Ie(e){const n=ve(e);return n>32767?n-65536:n}const R={a:0,b:0};function ie(e,n){const t=Ie(e),i=Ie(n),o=t+(i&1)+(i>>1),s=o,a=o-i;R.a=s,R.b=a}function le(e,n){const t=ve(e),r=ve(n),i=t-(r>>1)&65535,o=r+i-32768&65535;R.a=o,R.b=i}function Un(e,n,t,r,i,o,s){const a=s<16384,u=t>i?i:t;let l=1,c,m;for(;l<=u;)l<<=1;for(l>>=1,c=l,l>>=1;l>=1;){m=0;const f=m+o*(i-c),_=o*l,d=o*c,S=r*l,E=r*c;let C,B,k,q;for(;m<=f;m+=d){let O=m;const T=m+r*(t-c);for(;O<=T;O+=E){const D=O+S,Q=O+_,Z=Q+S;a?(ie(e[O+n],e[Q+n]),C=R.a,k=R.b,ie(e[D+n],e[Z+n]),B=R.a,q=R.b,ie(C,B),e[O+n]=R.a,e[D+n]=R.b,ie(k,q),e[Q+n]=R.a,e[Z+n]=R.b):(le(e[O+n],e[Q+n]),C=R.a,k=R.b,le(e[D+n],e[Z+n]),B=R.a,q=R.b,le(C,B),e[O+n]=R.a,e[D+n]=R.b,le(k,q),e[Q+n]=R.a,e[Z+n]=R.b)}if(t&l){const D=O+_;a?ie(e[O+n],e[D+n]):le(e[O+n],e[D+n]),C=R.a,e[D+n]=R.b,e[O+n]=C}}if(i&l){let O=m;const T=m+r*(t-c);for(;O<=T;O+=E){const D=O+S;a?ie(e[O+n],e[D+n]):le(e[O+n],e[D+n]),C=R.a,e[D+n]=R.b,e[O+n]=C}}c=l,l>>=1}return m}function Tn(e,n,t,r,i,o,s,a,u){let l=0,c=0;const m=s,f=Math.trunc(r.value+(i+7)/8);for(;r.value<f;)for(Ee(l,c,t,r),l=L.c,c=L.lc;c>=14;){const d=l>>c-14&16383,S=n[d];if(S.len)c-=S.len,he(S.lit,o,l,c,t,r,a,u,m),l=H.c,c=H.lc;else{if(!S.p)throw new Error("hufDecode issues");let E;for(E=0;E<S.lit;E++){const C=Be(e[S.p[E]]);for(;c<C&&r.value<f;)Ee(l,c,t,r),l=L.c,c=L.lc;if(c>=C&&Pe(e[S.p[E]])==(l>>c-C&(1<<C)-1)){c-=C,he(S.p[E],o,l,c,t,r,a,u,m),l=H.c,c=H.lc;break}}if(E==S.lit)throw new Error("hufDecode issues")}}const _=8-i&7;for(l>>=_,c-=_;c>0;){const d=n[l<<14-c&16383];if(d.len)c-=d.len,he(d.lit,o,l,c,t,r,a,u,m),l=H.c,c=H.lc;else throw new Error("hufDecode issues")}return!0}function tn(e,n,t,r,i,o){const s={value:0},a=t.value,u=X(n,t),l=X(n,t);t.value+=4;const c=X(n,t);if(t.value+=4,u<0||u>=65537||l<0||l>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const m=new Array(65537),f=new Array(16384);Ge(f);const _=r-(t.value-a);if(te(e,t,_,u,l,m),c>8*(r-(t.value-a)))throw new Error("Something wrong with hufUncompress");ge(m,u,l,f),Tn(m,f,e,t,c,l,o,i,s)}function xn(e,n,t){for(let r=0;r<t;++r)n[r]=e[n[r]]}function rn(e){for(let n=1;n<e.length;n++){const t=e[n-1]+e[n]-128;e[n]=t}}function on(e,n){let t=0,r=Math.floor((e.length+1)/2),i=0;const o=e.length-1;for(;!(i>o||(n[i++]=e[t++],i>o));)n[i++]=e[r++]}function ln(e){let n=e.byteLength;const t=new Array;let r=0;const i=new DataView(e);for(;n>0;){const o=i.getInt8(r++);if(o<0){const s=-o;n-=s+1;for(let a=0;a<s;a++)t.push(i.getUint8(r++))}else{const s=o;n-=2;const a=i.getUint8(r++);for(let u=0;u<s+1;u++)t.push(a)}}return t}function bn(e,n,t,r,i,o){let s=new DataView(o.buffer);const a=t[e.idx[0]].width,u=t[e.idx[0]].height,l=3,c=Math.floor(a/8),m=Math.ceil(a/8),f=Math.ceil(u/8),_=a-(m-1)*8,d=u-(f-1)*8,S={value:0},E=new Array(l),C=new Array(l),B=new Array(l),k=new Array(l),q=new Array(l);for(let T=0;T<l;++T)q[T]=n[e.idx[T]],E[T]=T<1?0:E[T-1]+m*f,C[T]=new Float32Array(64),B[T]=new Uint16Array(64),k[T]=new Uint16Array(m*64);for(let T=0;T<f;++T){let D=8;T==f-1&&(D=d);let Q=8;for(let b=0;b<m;++b){b==m-1&&(Q=_);for(let M=0;M<l;++M)B[M].fill(0),B[M][0]=i[E[M]++],Nn(S,r,B[M]),An(B[M],C[M]),Rn(C[M]);Mn(C);for(let M=0;M<l;++M)On(C[M],k[M],b*64)}let Z=0;for(let b=0;b<l;++b){const M=t[e.idx[b]].type;for(let se=8*T;se<8*T+D;++se){Z=q[b][se];for(let Te=0;Te<c;++Te){const re=Te*64+(se&7)*8;s.setUint16(Z+0*2*M,k[b][re+0],!0),s.setUint16(Z+1*2*M,k[b][re+1],!0),s.setUint16(Z+2*2*M,k[b][re+2],!0),s.setUint16(Z+3*2*M,k[b][re+3],!0),s.setUint16(Z+4*2*M,k[b][re+4],!0),s.setUint16(Z+5*2*M,k[b][re+5],!0),s.setUint16(Z+6*2*M,k[b][re+6],!0),s.setUint16(Z+7*2*M,k[b][re+7],!0),Z+=8*2*M}}if(c!=m)for(let se=8*T;se<8*T+D;++se){const Te=q[b][se]+8*c*2*M,re=c*64+(se&7)*8;for(let Ze=0;Ze<Q;++Ze)s.setUint16(Te+Ze*2*M,k[b][re+Ze],!0)}}}const O=new Uint16Array(a);s=new DataView(o.buffer);for(let T=0;T<l;++T){t[e.idx[T]].decoded=!0;const D=t[e.idx[T]].type;if(t[T].type==2)for(let Q=0;Q<u;++Q){const Z=q[T][Q];for(let b=0;b<a;++b)O[b]=s.getUint16(Z+b*2*D,!0);for(let b=0;b<a;++b)s.setFloat32(Z+b*2*D,v(O[b]),!0)}}}function Nn(e,n,t){let r,i=1;for(;i<64;)r=n[e.value],r==65280?i=64:r>>8==255?i+=r&255:(t[i]=r,i++),e.value++}function An(e,n){n[0]=v(e[0]),n[1]=v(e[1]),n[2]=v(e[5]),n[3]=v(e[6]),n[4]=v(e[14]),n[5]=v(e[15]),n[6]=v(e[27]),n[7]=v(e[28]),n[8]=v(e[2]),n[9]=v(e[4]),n[10]=v(e[7]),n[11]=v(e[13]),n[12]=v(e[16]),n[13]=v(e[26]),n[14]=v(e[29]),n[15]=v(e[42]),n[16]=v(e[3]),n[17]=v(e[8]),n[18]=v(e[12]),n[19]=v(e[17]),n[20]=v(e[25]),n[21]=v(e[30]),n[22]=v(e[41]),n[23]=v(e[43]),n[24]=v(e[9]),n[25]=v(e[11]),n[26]=v(e[18]),n[27]=v(e[24]),n[28]=v(e[31]),n[29]=v(e[40]),n[30]=v(e[44]),n[31]=v(e[53]),n[32]=v(e[10]),n[33]=v(e[19]),n[34]=v(e[23]),n[35]=v(e[32]),n[36]=v(e[39]),n[37]=v(e[45]),n[38]=v(e[52]),n[39]=v(e[54]),n[40]=v(e[20]),n[41]=v(e[22]),n[42]=v(e[33]),n[43]=v(e[38]),n[44]=v(e[46]),n[45]=v(e[51]),n[46]=v(e[55]),n[47]=v(e[60]),n[48]=v(e[21]),n[49]=v(e[34]),n[50]=v(e[37]),n[51]=v(e[47]),n[52]=v(e[50]),n[53]=v(e[56]),n[54]=v(e[59]),n[55]=v(e[61]),n[56]=v(e[35]),n[57]=v(e[36]),n[58]=v(e[48]),n[59]=v(e[49]),n[60]=v(e[57]),n[61]=v(e[58]),n[62]=v(e[62]),n[63]=v(e[63])}function Rn(e){const n=.5*Math.cos(.7853975),t=.5*Math.cos(3.14159/16),r=.5*Math.cos(3.14159/8),i=.5*Math.cos(3*3.14159/16),o=.5*Math.cos(5*3.14159/16),s=.5*Math.cos(3*3.14159/8),a=.5*Math.cos(7*3.14159/16),u=new Array(4),l=new Array(4),c=new Array(4),m=new Array(4);for(let f=0;f<8;++f){const _=f*8;u[0]=r*e[_+2],u[1]=s*e[_+2],u[2]=r*e[_+6],u[3]=s*e[_+6],l[0]=t*e[_+1]+i*e[_+3]+o*e[_+5]+a*e[_+7],l[1]=i*e[_+1]-a*e[_+3]-t*e[_+5]-o*e[_+7],l[2]=o*e[_+1]-t*e[_+3]+a*e[_+5]+i*e[_+7],l[3]=a*e[_+1]-o*e[_+3]+i*e[_+5]-t*e[_+7],c[0]=n*(e[_+0]+e[_+4]),c[3]=n*(e[_+0]-e[_+4]),c[1]=u[0]+u[3],c[2]=u[1]-u[2],m[0]=c[0]+c[1],m[1]=c[3]+c[2],m[2]=c[3]-c[2],m[3]=c[0]-c[1],e[_+0]=m[0]+l[0],e[_+1]=m[1]+l[1],e[_+2]=m[2]+l[2],e[_+3]=m[3]+l[3],e[_+4]=m[3]-l[3],e[_+5]=m[2]-l[2],e[_+6]=m[1]-l[1],e[_+7]=m[0]-l[0]}for(let f=0;f<8;++f)u[0]=r*e[16+f],u[1]=s*e[16+f],u[2]=r*e[48+f],u[3]=s*e[48+f],l[0]=t*e[8+f]+i*e[24+f]+o*e[40+f]+a*e[56+f],l[1]=i*e[8+f]-a*e[24+f]-t*e[40+f]-o*e[56+f],l[2]=o*e[8+f]-t*e[24+f]+a*e[40+f]+i*e[56+f],l[3]=a*e[8+f]-o*e[24+f]+i*e[40+f]-t*e[56+f],c[0]=n*(e[f]+e[32+f]),c[3]=n*(e[f]-e[32+f]),c[1]=u[0]+u[3],c[2]=u[1]-u[2],m[0]=c[0]+c[1],m[1]=c[3]+c[2],m[2]=c[3]-c[2],m[3]=c[0]-c[1],e[0+f]=m[0]+l[0],e[8+f]=m[1]+l[1],e[16+f]=m[2]+l[2],e[24+f]=m[3]+l[3],e[32+f]=m[3]-l[3],e[40+f]=m[2]-l[2],e[48+f]=m[1]-l[1],e[56+f]=m[0]-l[0]}function Mn(e){for(let n=0;n<64;++n){const t=e[0][n],r=e[1][n],i=e[2][n];e[0][n]=t+1.5747*i,e[1][n]=t-.1873*r-.4682*i,e[2][n]=t+1.8556*r}}function On(e,n,t){for(let r=0;r<64;++r)n[t+r]=vn.toHalfFloat(Fn(e[r]))}function Fn(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(Oe,Math.abs(e)-1)}function sn(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function Bn(e){const n=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),t=new Uint8Array(ln(n)),r=new Uint8Array(t.length);return rn(t),on(t,r),new DataView(r.buffer)}function Ye(e){const n=e.array.slice(e.offset.value,e.offset.value+e.size),t=Le(n),r=new Uint8Array(t.length);return rn(t),on(t,r),new DataView(r.buffer)}function Pn(e){const n=e.viewer,t={value:e.offset.value},r=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),i=new Uint8Array(8192);let o=0;const s=new Array(e.channels);for(let d=0;d<e.channels;d++)s[d]={},s[d].start=o,s[d].end=s[d].start,s[d].nx=e.width,s[d].ny=e.lines,s[d].size=e.type,o+=s[d].nx*s[d].ny*s[d].size;const a=de(n,t),u=de(n,t);if(u>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(a<=u)for(let d=0;d<u-a+1;d++)i[d+a]=_e(n,t);const l=new Uint16Array(65536),c=We(i,l),m=X(n,t);tn(e.array,n,t,m,r,o);for(let d=0;d<e.channels;++d){const S=s[d];for(let E=0;E<s[d].size;++E)Un(r,S.start+E,S.nx,S.size,S.ny,S.nx*S.size,c)}xn(l,r,o);let f=0;const _=new Uint8Array(r.buffer.byteLength);for(let d=0;d<e.lines;d++)for(let S=0;S<e.channels;S++){const E=s[S],C=E.nx*E.size,B=new Uint8Array(r.buffer,E.end*2,C*2);_.set(B,f),f+=C*2,E.end+=C}return new DataView(_.buffer)}function kn(e){const n=e.array.slice(e.offset.value,e.offset.value+e.size),t=Le(n),r=e.lines*e.channels*e.width,i=e.type==1?new Uint16Array(r):new Uint32Array(r);let o=0,s=0;const a=new Array(4);for(let u=0;u<e.lines;u++)for(let l=0;l<e.channels;l++){let c=0;switch(e.type){case 1:a[0]=o,a[1]=a[0]+e.width,o=a[1]+e.width;for(let m=0;m<e.width;++m){const f=t[a[0]++]<<8|t[a[1]++];c+=f,i[s]=c,s++}break;case 2:a[0]=o,a[1]=a[0]+e.width,a[2]=a[1]+e.width,o=a[2]+e.width;for(let m=0;m<e.width;++m){const f=t[a[0]++]<<24|t[a[1]++]<<16|t[a[2]++]<<8;c+=f,i[s]=c,s++}break}}return new DataView(i.buffer)}function cn(e){const n=e.viewer,t={value:e.offset.value},r=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),i={version:J(n,t),unknownUncompressedSize:J(n,t),unknownCompressedSize:J(n,t),acCompressedSize:J(n,t),dcCompressedSize:J(n,t),rleCompressedSize:J(n,t),rleUncompressedSize:J(n,t),rleRawSize:J(n,t),totalAcUncompressedCount:J(n,t),totalDcUncompressedCount:J(n,t),acCompression:J(n,t)};if(i.version<2)throw new Error("EXRLoader.parse: "+Ue.compression+" version "+i.version+" is unsupported");const o=new Array;let s=de(n,t)-2;for(;s>0;){const S=ke(n.buffer,t),E=_e(n,t),C=E>>2&3,B=(E>>4)-1,k=new Int8Array([B])[0],q=_e(n,t);o.push({name:S,index:k,type:q,compression:C}),s-=S.length+3}const a=Ue.channels,u=new Array(e.channels);for(let S=0;S<e.channels;++S){const E=u[S]={},C=a[S];E.name=C.name,E.compression=0,E.decoded=!1,E.type=C.pixelType,E.pLinear=C.pLinear,E.width=e.width,E.height=e.lines}const l={idx:new Array(3)};for(let S=0;S<e.channels;++S){const E=u[S];for(let C=0;C<o.length;++C){const B=o[C];E.name==B.name&&(E.compression=B.compression,B.index>=0&&(l.idx[B.index]=S),E.offset=S)}}let c,m,f;if(i.acCompressedSize>0)switch(i.acCompression){case 0:c=new Uint16Array(i.totalAcUncompressedCount),tn(e.array,n,t,i.acCompressedSize,c,i.totalAcUncompressedCount);break;case 1:const S=e.array.slice(t.value,t.value+i.totalAcUncompressedCount),E=Le(S);c=new Uint16Array(E.buffer),t.value+=i.totalAcUncompressedCount;break}if(i.dcCompressedSize>0){const S={array:e.array,offset:t,size:i.dcCompressedSize};m=new Uint16Array(Ye(S).buffer),t.value+=i.dcCompressedSize}if(i.rleRawSize>0){const S=e.array.slice(t.value,t.value+i.rleCompressedSize),E=Le(S);f=ln(E.buffer),t.value+=i.rleCompressedSize}let _=0;const d=new Array(u.length);for(let S=0;S<d.length;++S)d[S]=new Array;for(let S=0;S<e.lines;++S)for(let E=0;E<u.length;++E)d[E].push(_),_+=u[E].width*e.type*2;bn(l,d,u,c,m,r);for(let S=0;S<u.length;++S){const E=u[S];if(!E.decoded)switch(E.compression){case 2:let C=0,B=0;for(let k=0;k<e.lines;++k){let q=d[S][C];for(let O=0;O<E.width;++O){for(let T=0;T<2*E.type;++T)r[q++]=f[B+T*E.width*E.height];B++}C++}break;case 1:default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(r.buffer)}function ke(e,n){const t=new Uint8Array(e);let r=0;for(;t[n.value+r]!=0;)r+=1;const i=new TextDecoder().decode(t.slice(n.value,n.value+r));return n.value=n.value+r+1,i}function Dn(e,n,t){const r=new TextDecoder().decode(new Uint8Array(e).slice(n.value,n.value+t));return n.value=n.value+t,r}function Zn(e,n){const t=ye(e,n),r=X(e,n);return[t,r]}function zn(e,n){const t=X(e,n),r=X(e,n);return[t,r]}function ye(e,n){const t=e.getInt32(n.value,!0);return n.value=n.value+4,t}function X(e,n){const t=e.getUint32(n.value,!0);return n.value=n.value+4,t}function an(e,n){const t=e[n.value];return n.value=n.value+1,t}function _e(e,n){const t=e.getUint8(n.value);return n.value=n.value+1,t}const J=function(e,n){let t;return"getBigInt64"in DataView.prototype?t=Number(e.getBigInt64(n.value,!0)):t=e.getUint32(n.value+4,!0)+Number(e.getUint32(n.value,!0)<<32),n.value+=8,t};function z(e,n){const t=e.getFloat32(n.value,!0);return n.value+=4,t}function Ln(e,n){return vn.toHalfFloat(z(e,n))}function v(e){const n=(e&31744)>>10,t=e&1023;return(e>>15?-1:1)*(n?n===31?t?NaN:1/0:Math.pow(2,n-15)*(1+t/1024):6103515625e-14*(t/1024))}function de(e,n){const t=e.getUint16(n.value,!0);return n.value+=2,t}function Hn(e,n){return v(de(e,n))}function Xn(e,n,t,r){const i=t.value,o=[];for(;t.value<i+r-1;){const s=ke(n,t),a=ye(e,t),u=_e(e,t);t.value+=3;const l=ye(e,t),c=ye(e,t);o.push({name:s,pixelType:a,pLinear:u,xSampling:l,ySampling:c})}return t.value+=1,o}function Wn(e,n){const t=z(e,n),r=z(e,n),i=z(e,n),o=z(e,n),s=z(e,n),a=z(e,n),u=z(e,n),l=z(e,n);return{redX:t,redY:r,greenX:i,greenY:o,blueX:s,blueY:a,whiteX:u,whiteY:l}}function Gn(e,n){const t=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],r=_e(e,n);return t[r]}function Yn(e,n){const t=X(e,n),r=X(e,n),i=X(e,n),o=X(e,n);return{xMin:t,yMin:r,xMax:i,yMax:o}}function qn(e,n){const t=["INCREASING_Y"],r=_e(e,n);return t[r]}function Kn(e,n){const t=z(e,n),r=z(e,n);return[t,r]}function $n(e,n){const t=z(e,n),r=z(e,n),i=z(e,n);return[t,r,i]}function Jn(e,n,t,r,i){if(r==="string"||r==="stringvector"||r==="iccProfile")return Dn(n,t,i);if(r==="chlist")return Xn(e,n,t,i);if(r==="chromaticities")return Wn(e,t);if(r==="compression")return Gn(e,t);if(r==="box2i")return Yn(e,t);if(r==="lineOrder")return qn(e,t);if(r==="float")return z(e,t);if(r==="v2f")return Kn(e,t);if(r==="v3f")return $n(e,t);if(r==="int")return ye(e,t);if(r==="rational")return Zn(e,t);if(r==="timecode")return zn(e,t);if(r==="preview")return t.value+=i,"skipped";t.value+=i}function Qn(e,n,t){const r={};if(e.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");r.version=e.getUint8(4);const i=e.getUint8(5);r.spec={singleTile:!!(i&2),longName:!!(i&4),deepFormat:!!(i&8),multiPart:!!(i&16)},t.value=8;let o=!0;for(;o;){const s=ke(n,t);if(s==0)o=!1;else{const a=ke(n,t),u=X(e,t),l=Jn(e,n,t,a,u);l===void 0?console.warn("THREE.EXRLoader: Skipped unknown header attribute type '".concat(a,"'.")):r[s]=l}}if(i&-5)throw console.error("THREE.EXRHeader:",r),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return r}function Vn(e,n,t,r,i){const o={size:0,viewer:n,array:t,offset:r,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:pn};switch(e.compression){case"NO_COMPRESSION":o.lines=1,o.uncompress=sn;break;case"RLE_COMPRESSION":o.lines=1,o.uncompress=Bn;break;case"ZIPS_COMPRESSION":o.lines=1,o.uncompress=Ye;break;case"ZIP_COMPRESSION":o.lines=16,o.uncompress=Ye;break;case"PIZ_COMPRESSION":o.lines=32,o.uncompress=Pn;break;case"PXR24_COMPRESSION":o.lines=16,o.uncompress=kn;break;case"DWAA_COMPRESSION":o.lines=32,o.uncompress=cn;break;case"DWAB_COMPRESSION":o.lines=256,o.uncompress=cn;break;default:throw new Error("EXRLoader.parse: "+e.compression+" is unsupported")}if(o.scanlineBlockSize=o.lines,o.type==1)switch(i){case qe:o.getter=Hn,o.inputSize=2;break;case ze:o.getter=de,o.inputSize=2;break}else if(o.type==2)switch(i){case qe:o.getter=z,o.inputSize=4;break;case ze:o.getter=Ln,o.inputSize=4}else throw new Error("EXRLoader.parse: unsupported pixelType "+o.type+" for "+e.compression+".");o.blockCount=(e.dataWindow.yMax+1)/o.scanlineBlockSize;for(let a=0;a<o.blockCount;a++)J(n,r);o.outputChannels=o.channels==3?4:o.channels;const s=o.width*o.height*o.outputChannels;switch(i){case qe:o.byteArray=new Float32Array(s),o.channels<o.outputChannels&&o.byteArray.fill(1,0,s);break;case ze:o.byteArray=new Uint16Array(s),o.channels<o.outputChannels&&o.byteArray.fill(15360,0,s);break;default:console.error("THREE.EXRLoader: unsupported type: ",i);break}return o.bytesPerLine=o.width*o.inputSize*o.channels,o.outputChannels==4?(o.format=st,o.colorSpace=pn):(o.format=ct,o.colorSpace=at),o}const De=new DataView(p),jn=new Uint8Array(p),Ce={value:0},Ue=Qn(De,p,Ce),U=Vn(Ue,De,jn,Ce,this.type),un={value:0},et={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<U.height/U.scanlineBlockSize;e++){const n=X(De,Ce);U.size=X(De,Ce),U.lines=n+U.scanlineBlockSize>U.height?U.height-n:U.scanlineBlockSize;const r=U.size<U.lines*U.bytesPerLine?U.uncompress(U):sn(U);Ce.value+=U.size;for(let i=0;i<U.scanlineBlockSize;i++){const o=i+e*U.scanlineBlockSize;if(o>=U.height)break;for(let s=0;s<U.channels;s++){const a=et[Ue.channels[s].name];for(let u=0;u<U.width;u++){un.value=(i*(U.channels*U.width)+s*U.width+u)*U.inputSize;const l=(U.height-1-o)*(U.width*U.outputChannels)+u*U.outputChannels+a;U.byteArray[l]=U.getter(r,un)}}}}return{header:Ue,width:U.width,height:U.height,data:U.byteArray,format:U.format,colorSpace:U.colorSpace,type:this.type}}setDataType(p){return this.type=p,this}load(p,w,g,I){function x(N,P){N.colorSpace=P.colorSpace,N.minFilter=hn,N.magFilter=hn,N.generateMipmaps=!1,N.flipY=!1,w&&w(N,P)}return super.load(p,x,g,I)}}const Zt=["object","scale"],zt=En({__name:"groundProjectedEnvCom",props:{texture:{default:"https://opensource-1314935952.cos.ap-nanjing.myqcloud.com/images/skyBox/round_platform_1k.exr"},size:{default:100}},async setup(h){let p,w;const g=h,I=new Dt,x=([p,w]=ut(()=>I.loadAsync(g.texture)),p=await p,w(),p);x.mapping=pt;const{scene:N}=ht();N.value.environment=x;const P=new Ct(x);return(y,A)=>(je(),vt("primitive",{object:xe(P),scale:g.size},null,8,Zt))}}),Lt=pe("TresPerspectiveCamera",{position:[-20,20,15],fov:45,near:1,far:1e3},null,-1),Ht=pe("TresDirectionalLight",{position:[10,2,4],intensity:1},null,-1),Xt=pe("TresMesh",{position:[8,5.5,8.5],"receive-shadow":"","cast-shadow":"",name:"sphere"},[pe("TresSphereGeometry",{args:[3.5]}),pe("TresMeshStandardMaterial",{color:16724991,roughness:0,metalness:1})],-1),Wt=pe("TresTorusKnotGeometry",{args:[3,1,100,32]},null,-1),Gt=pe("TresMeshPhysicalMaterial",{color:"#33ffff",transmission:1,roughness:0,thickness:2},null,-1),Yt=[Wt,Gt],rr=En({__name:"causticsDemo",setup(h){const p=Ke({alpha:!0,toneMapping:wt,windowSize:!0,clearColor:10066329}),w=Ke({enableDamping:!0,autoRotate:!1}),g=ft(null),{onBeforeLoop:I}=_t();I(({elapsed:P})=>{g.value&&(g.value.rotation.x=P,g.value.rotation.y=P)});const x=Ke({color:"#ffffff",ior:1.1,backsideIOR:1.1,far:30,worldRadius:.3,intensity:.05,causticsOnly:!1,lightSource:{x:1,y:1,z:1}}),N=new mt({title:"参数"});return N.addBinding(x,"color",{label:"颜色"}),N.addBinding(x,"ior",{label:"折射系数",min:.6,max:1.3,step:.01}),N.addBinding(x,"backsideIOR",{label:"折射系数2",min:.6,max:1.3,step:.01}),N.addBinding(x,"far",{label:"可视距离",min:0,max:30,step:1}),N.addBinding(x,"worldRadius",{label:"材质大小",min:.001,max:.5,step:.001}),N.addBinding(x,"intensity",{label:"强度",min:0,max:1,step:.01}),N.addBinding(x,"causticsOnly",{label:"只显示投射"}),N.addBinding(x,"lightSource",{label:"光源位置",x:{min:-1,max:1},y:{min:-1,max:1},z:{min:-1,max:1}}),(P,y)=>(je(),wn(xe(Et),St(p,{"window-size":""}),{default:$e(()=>[Lt,Je(xe(gt),fn(mn(w)),null,16),Ht,Je(xe(yt),fn(mn(x)),{default:$e(()=>[Xt,pe("TresMesh",{ref_key:"torusMesh",ref:g,position:[-8,6,-8],name:"torus"},Yt,512)]),_:1},16),(je(),wn(It,null,{default:$e(()=>[Je(xe(zt),{position:[0,-.1,0]})]),_:1}))]),_:1},16))}});export{rr as default};
