import{importShared as t}from"./3d-tiles-renderer.6uaxtGOi1769565599278.js";import{Pass as e,FullScreenQuad as r}from"./Pass.DLt00iiP1769565599278.js";import{CopyShader as i}from"./RenderPass.DKGPZmqR1769565599278.js";const n={uniforms:{damp:{value:.96},tOld:{value:null},tNew:{value:null}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float damp;\n\n\t\tuniform sampler2D tOld;\n\t\tuniform sampler2D tNew;\n\n\t\tvarying vec2 vUv;\n\n\t\tvec4 when_gt( vec4 x, float y ) {\n\n\t\t\treturn max( sign( x - y ), 0.0 );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec4 texelOld = texture2D( tOld, vUv );\n\t\t\tvec4 texelNew = texture2D( tNew, vUv );\n\n\t\t\ttexelOld *= damp * when_gt( texelOld, 0.1 );\n\n\t\t\tgl_FragColor = max(texelNew, texelOld);\n\n\t\t}"},{HalfFloatType:s,NearestFilter:a,NoBlending:o,ShaderMaterial:d,UniformsUtils:l,WebGLRenderTarget:m}=await t("three");class u extends e{constructor(t=.96){super(),this.uniforms=l.clone(n.uniforms),this.damp=t,this.compFsMaterial=new d({uniforms:this.uniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}),this.copyFsMaterial=new d({uniforms:l.clone(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,blending:o,depthTest:!1,depthWrite:!1}),this._textureComp=new m(window.innerWidth,window.innerHeight,{magFilter:a,type:s}),this._textureOld=new m(window.innerWidth,window.innerHeight,{magFilter:a,type:s}),this._compFsQuad=new r(this.compFsMaterial),this._copyFsQuad=new r(this.copyFsMaterial)}get damp(){return this.uniforms.damp.value}set damp(t){this.uniforms.damp.value=t}render(t,e,r){this.uniforms.tOld.value=this._textureOld.texture,this.uniforms.tNew.value=r.texture,t.setRenderTarget(this._textureComp),this._compFsQuad.render(t),this._copyFsQuad.material.uniforms.tDiffuse.value=this._textureComp.texture,this.renderToScreen?(t.setRenderTarget(null),this._copyFsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(),this._copyFsQuad.render(t));const i=this._textureOld;this._textureOld=this._textureComp,this._textureComp=i}setSize(t,e){this._textureComp.setSize(t,e),this._textureOld.setSize(t,e)}dispose(){this._textureComp.dispose(),this._textureOld.dispose(),this.compFsMaterial.dispose(),this.copyFsMaterial.dispose(),this._compFsQuad.dispose(),this._copyFsQuad.dispose()}}export{u as AfterimagePass};
