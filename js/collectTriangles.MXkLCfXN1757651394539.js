import{m as e,e as t,D as s,a as n,t as a}from"./@tresjs.DIdO2Yiu1757651394539.js";import"./@fesjs.Bp6K4IrA1757651394539.js";import"./Resource.KHds72Cg1757651394539.js";/* empty css                                                                             */import{_ as o}from"./randomLoading.vue_vue_type_script_setup_true_lang.vk5r7CeE1757651394539.js";import"./three-mesh-ui.module.DvGiv1gQ1757651394539.js";/* empty css                                                              */import{o as r,au as i,c as l,b9 as u,a as p,M as c,S as m,V as d,B as g,l as v,cm as y}from"./three.CMHPKQCP1757651394539.js";import{P as h}from"./tweakpane.C0HtAJSg1757651394539.js";import{I as f,C as j,N as b,c as w,d as _,a as T}from"./three-mesh-bvh.pxu9S_831757651394539.js";import{d as x,aa as M,b as L,a2 as B,G as C,o as X,F as k,I as A,u as O,r as S,h as Y,j as z,f as I,e as P,m as F,a5 as H}from"./@vue.pEDXJ_3Z1757651394539.js";import"./postprocessing.BgyKo9Ns1757651394539.js";import"./@vueuse.nD2ilM161757651394539.js";import"./vue-router.Dbyy8kqJ1757651394539.js";import"./lodash-es.C7pWAXPe1757651394539.js";import"./pinia.ByleU3mk1757651394539.js";import"./@qlin.q6OWdsQV1757651394539.js";import"./@babel.BPq7uOAK1757651394539.js";import"./@floating-ui.BFjFSAYt1757651394539.js";import"./@juggle.CcBCnTIR1757651394539.js";import"./starLoading.zOas0Fgx1757651394539.js";import"./utils.D-hA6rPX1757651394539.js";import"./cssLoaders.CZt9nZC81757651394539.js";import"./bubbleLoading.BHr0qewa1757651394539.js";import"./yangyangLoading.W2s5pDEd1757651394539.js";const R=["geometry","material"],U=["geometry"],W=x({__name:"model",props:{controls:{}},async setup(n){let a,o;const x=n;g.prototype.computeBoundsTree=w,g.prototype.disposeBoundsTree=_,v.prototype.raycast=T;const S=([a,o]=M((()=>s(y,"https://opensource.cdn.icegl.cn/model/industry4/TR12J_OCC.stl"))),a=await a,o(),a),Y=new i({color:16777215,roughness:.2,metalness:1,vertexColors:!0}),z=new Uint8Array(3*S.attributes.position.count);z.fill(255);const I=new l(z,3,!0);I.setUsage(u),S.setAttribute("color",I);const P=L(null),F=L(null),H=L(!1),W=L(-1),Z=L(.2),E=new p,{camera:G,raycaster:V}=e(),q=15/255,D=78/255,J=85/255;let N=null;B((()=>{P.value&&(console.log("targetMesh.value init",P.value),P.value.geometry.computeBoundsTree(),N=S.boundsTree,((e,t,s,n,a,o)=>{window.addEventListener("pointermove",(s=>{e.x=s.clientX/window.innerWidth*2-1,e.y=-s.clientY/window.innerHeight*2+1,t.value=!0})),window.addEventListener("pointerdown",(i=>{e.x=i.clientX/window.innerWidth*2-1,e.y=-i.clientY/window.innerHeight*2+1,n.value=i.button;const l=new r;l.setFromCamera(e,s.value),l.firstHitOnly=!0;const u=l.intersectObject(a.value,!0);t.value=!0,o.enabled=0===u.length}),!0),window.addEventListener("pointerup",(e=>{n.value=-1,"touch"===e.pointerType&&(t.value=!1)}),!0)})(E,H,G,W,P,x.controls.instance))}));const{onLoop:Q}=t();Q((()=>{const e=S.index;if(F.value)if(x.controls.instance.active||!H.value)F.value.visible=!1;else{F.value.scale.setScalar(Z.value),V.value.setFromCamera(E,G.value),V.value.firstHitOnly=!0;const t=V.value.intersectObject(P.value,!0);if(t.length){F.value.position.copy(t[0].point),x.controls.instance.enabled=!1,F.value.visible=!0;const s=new c;s.copy(P.value.matrixWorld).invert();const n=new m;n.center.copy(F.value.position).applyMatrix4(s),n.radius=100*Z.value;const a=[],o=new d;if(N?.shapecast({intersectsBounds:e=>{const t=n.intersectsBox(e),{min:s,max:a}=e;if(t){for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let r=0;r<=1;r++)if(o.set(0===e?s.x:a.x,0===t?s.y:a.y,0===r?s.z:a.z),!n.containsPoint(o))return f;return j}return t?f:b},intersectsTriangle:(e,t,s)=>{if(s||e.intersectsSphere(n)){const e=3*t;a.push(e,e+1,e+2)}return!1}}),0===W.value||2===W.value){let t=1,s=1,n=1;0===W.value&&(t=q,s=D,n=J);for(let o=0,r=a.length;o<r;o++){const r=e.getX(a[o]);I.setX(r,t),I.setY(r,s),I.setZ(r,n)}I.needsUpdate=!0}}else F.value.visible=!1,x.controls.instance.enabled=!0}}));const K=(new h).addButton({title:"点击按钮",label:"生成模型"}),$=new g;return K.on("click",(()=>{const e=[],t=[];for(let n=0;n<I.count;n++)I.getX(n)===q&&I.getY(n)===D&&I.getZ(n)===J&&(e.push(S.attributes.position.getX(n),S.attributes.position.getY(n),S.attributes.position.getZ(n)),t.push(S.attributes.normal.getX(n),S.attributes.normal.getY(n),S.attributes.normal.getZ(n)));const s=new Float32Array(e);$.setAttribute("position",new l(s,3)),$.setAttribute("normal",new l(s,3))})),(e,t)=>(X(),C(k,null,[A("TresMesh",{ref_key:"targetMesh",ref:P,geometry:O(S),scale:.005,material:O(Y)},null,8,R),A("TresMesh",{ref_key:"brushMesh",ref:F,visible:!1},t[0]||(t[0]=[A("TresSphereGeometry",{args:[1,40,40]},null,-1),A("TresMeshStandardMaterial",{color:15483002,roughness:.75,metalness:0,transparent:!0,opacity:.5,premultipliedAlpha:!0,emissive:15483002,emissiveIntensity:.5},null,-1)]),512),A("TresMesh",{geometry:O($),position:[-2,-2,2],scale:.005},t[1]||(t[1]=[A("TresMeshStandardMaterial",{color:"#023249",roughness:.2,metalness:0,envMapIntensity:.2},null,-1)]),8,U)],64))}}),Z=x({__name:"collectTriangles",setup(e){const t=S({clearColor:"#999999",antialias:!0}),s=S({autoRotate:!1}),r=L(null);return(e,i)=>{const l=Y("TresCanvas");return X(),C(k,null,[z(O(o)),z(l,F(t,{"window-size":""}),{default:I((()=>[i[0]||(i[0]=A("TresPerspectiveCamera",{position:[5,1,15],fov:30,near:.1,far:1e3},null,-1)),z(O(n),F({ref_key:"controlsRef",ref:r},s),null,16),i[1]||(i[1]=A("TresAmbientLight",{intensity:1},null,-1)),(X(),P(H,null,{default:I((()=>[z(W,{controls:r.value},null,8,["controls"])])),_:1})),(X(),P(H,null,{default:I((()=>[z(O(a),{background:!1,files:["pos-x.jpg","neg-x.jpg","pos-y.jpg","neg-y.jpg","pos-z.jpg","neg-z.jpg"],path:"https://opensource.cdn.icegl.cn/images/skyBox/6jpg/"},null,8,["path"])])),_:1}))])),_:1},16)],64)}}});export{Z as default};
