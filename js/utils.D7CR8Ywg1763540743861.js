import{T as t,E as o}from"./@tweenjs.CStbC9mZ1763540743861.js";import{i as e}from"./index.Crdf3MNx1763540743861.js";import{u as r}from"./commonData.BQ6HGNAS1763540743861.js";import"./Fetch.CIMEiaKn1763540743861.js";import{l as n}from"./CoordUtil.BerJhsxi1763540743861.js";import"./three-custom-shader-material.C6taB_aY1763540743861.js";import{m as s}from"./d3-geo.dcKspw7k1763540743861.js";function a(t){const o=t.geometry.coordinates,e=t=>{if(0===t.length)return[0,0];let o=0,e=0,r=0;return Array.isArray(t[0][0])?t.forEach(t=>{t.forEach(t=>{o+=t[1],e+=t[0],r++})}):t.forEach(t=>{o+=t[1],e+=t[0],r++}),[o/r,e/r]};switch(t.geometry.type){case"Point":return{lat:o[1],lng:o[0]};case"Polygon":case"MultiPolygon":return{lat:e(o)[0],lng:e(o)[1]};case"LineString":case"MultiLineString":let t=0,r=0,n=0;return o.forEach(o=>{t+=o[1],r+=o[0],n++}),{lat:t/n,lng:r/n};default:throw new Error("不支持的几何类型")}}function i(t,o){const e=a(t);return{x:e.lng,y:e.lat}}function l(t,o){const e=s();return e.center([o.lng,o.lat]).scale(1e5).translate([0,0]),e(t)}function c(t,o){let e=null;o?e=o:(e=a(t),t.properties.centroid=e);const r=s();r.center([e.lng,e.lat]).scale(1e5).translate([0,0]);const n=t.geometry.coordinates.map(t=>t.map(t=>r(t)));t.geometry.coordinates=n}function g(){const t=r(),o=JSON.parse(e.getItem("building.geojson")).features;if(!o.length)throw new Error("No building data");const s=a(o[0]);o[0].properties.centroid=s;const i=o[0].geometry.coordinates.map(t=>t.map(t=>n(t[0],t[1],50)));t.centerPos.lng=s.lng,t.centerPos.lat=s.lat,o[0].geometry.coordinates=i,t.buildingsPrimary=o}function p(){const t=r(),o=JSON.parse(e.getItem("building.geojson")).features;if(!o.length)throw new Error("No building data");if(c(o[0]),t.centerPos.lng=o[0].properties.centroid.lng,t.centerPos.lat=o[0].properties.centroid.lat,t.buildingsPrimary=o,e.getItem("F1.geojson")){const o=JSON.parse(e.getItem("F1.geojson")).features;t.areasPrimary=o}}function m(){const t=r(),o=JSON.parse(e.getItem("building.geojson")).features;if(!o.length)throw new Error("No building data");if(c(o[0]),t.centerPos.lng=o[0].properties.centroid.lng,t.centerPos.lat=o[0].properties.centroid.lat,t.buildingsPrimary=o,!o[0].properties["floors-id"])throw new Error("请正确配置楼层数据");t.floorIds=o[0].properties["floors-id"].split(",");for(let r=0;r<t.floorIds.length;r++){const o=t.floorIds[r];if(e.getItem(`${o}.geojson`)){const r=JSON.parse(e.getItem(`${o}.geojson`)).features;t.floorsPrimary.push({floorId:o,areasPrimary:r})}}}const f=(e,r,n,s,a=1e3,i)=>{const l=e.position.clone(),c=n.target.clone(),g=r.clone(),p=s.clone(),m=new t({x:l.x,y:l.y,z:l.z,lookAtX:c.x,lookAtY:c.y,lookAtZ:c.z}).to({x:g.x,y:g.y,z:g.z,lookAtX:p.x,lookAtY:p.y,lookAtZ:p.z},a).easing(o.Quadratic.InOut).onUpdate(t=>{e.position.set(t.x,t.y,t.z),n.target.set(t.lookAtX,t.lookAtY,t.lookAtZ)}).start().onComplete(()=>{m.stop(),i()});return m},u=(e,r,n=1e3)=>{const s={};"all"===r?Object.keys(e).forEach(t=>{s[t]=1}):Object.keys(e).forEach(t=>{s[t]=.009,r===t&&(s[t]=1)});const a=new t(e).to(s,n).easing(o.Quadratic.InOut).onUpdate(t=>{Object.keys(e).forEach(o=>{e[o]=t[o]})}).start().onComplete(()=>{a.stop()});return a};export{l as a,g as b,c,p as d,f,i as g,m as i,u as p};
