import{importShared as e}from"./3d-tiles-renderer.DoRCwQO21769048796101.js";import{useTres as r,useLoop as a,OrbitControls_default as n}from"./index.DY1Qq3wV1769048796101.js";import{RenderPass as t,EffectComposer as l,ShaderPass as o}from"./RenderPass.BZXWNfnD1769048796101.js";import{UnrealBloomPass as s}from"./UnrealBloomPass.DWUUUVBi1769048796101.js";const{defineComponent:u}=await e("vue"),{createElementVNode:i,Fragment:v,openBlock:d,createElementBlock:m}=await e("vue"),{watchEffect:c,ref:f}=await e("vue"),p=await e("three"),w=u({__name:"ecLayerShaderPass",setup(e){const n=f(),u=f(),{camera:w,renderer:x,scene:h,sizes:T}=r(),g=.572,y=.51,M=0;let P=null,_=null,B=null;c(()=>{n.value&&n.value.layers.set(0),u.value&&u.value.layers.set(1),T.width.value&&(((e,r,a,n,o)=>{P=new t(e,r);const u=new s(new p.Vector2(n,o),g,y,M);_=new l(a),_.renderToScreen=!1,_.addPass(P),_.addPass(u)})(h.value,w.value,x,T.width.value,T.height.value),(e=>{B=new l(e);const r=new p.ShaderMaterial({uniforms:{baseTexture:{value:null},bloomTexture:{value:_.renderTarget2.texture}},vertexShader:"\n            varying vec2 vUv;\n            void main() {\n                vUv = uv;\n                gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n            }\n        ",fragmentShader:"\n            uniform sampler2D baseTexture;\n            uniform sampler2D bloomTexture;\n            varying vec2 vUv;\n            void main() {\n                gl_FragColor = ( vec4( 1.0 ) *texture2D( baseTexture, vUv ) + vec4( 1.0 ) * texture2D( bloomTexture, vUv ) );\n            }\n        ",defines:{}}),a=new o(r,"baseTexture");a.needsSwap=!0,B.addPass(P),B.addPass(a)})(x))});const{onRender:C}=a();return C(()=>{_&&B&&w.value&&(x.clear(),w.value.layers.set(1),_.render(),x.clearDepth(),w.value.layers.set(0),B.render(h.value,w.value))}),(e,r)=>(d(),m(v,null,[i("TresMesh",{ref_key:"normalBox",ref:n,position:[3,2,1]},[...r[0]||(r[0]=[i("TresBoxGeometry",{args:[1,1,1]},null,-1),i("TresMeshNormalMaterial",null,null,-1)])],512),i("TresMesh",{ref_key:"shineBox",ref:u,position:[0,2,-4]},[...r[1]||(r[1]=[i("TresBoxGeometry",{args:[1,1,1]},null,-1),i("TresMeshNormalMaterial",null,null,-1)])],512)],64))}}),{defineComponent:x}=await e("vue"),{createElementVNode:h,unref:T,createVNode:g,resolveComponent:y,withCtx:M,openBlock:P,createBlock:_}=await e("vue"),{watch:B,ref:C,onMounted:b}=await e("vue"),k=x({__name:"effectComposerShaderPass",setup(e){const r=C();return b(()=>{r.value&&B(()=>r.value.context,()=>{r.value.context.renderer.instance.autoClear=!1})}),(e,a)=>{const t=y("TresCanvas");return P(),_(t,{renderMode:"manual","window-size":"",ref_key:"tcRef",ref:r},{default:M(()=>[a[0]||(a[0]=h("TresPerspectiveCamera",{position:[10,10,10]},null,-1)),a[1]||(a[1]=h("TresAmbientLight",{intensity:1},null,-1)),g(T(n)),a[2]||(a[2]=h("TresGridHelper",{args:[10,10]},null,-1)),g(w)]),_:1},512)}}});export{k as default};
