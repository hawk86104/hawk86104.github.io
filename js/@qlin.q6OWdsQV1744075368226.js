class e{constructor(){this.middlewares=[]}use(e){return this.middlewares.push(e),this}compose(){return(e,t)=>{let r=-1;const n=o=>{if(o<=r)return Promise.reject(new Error("next() called multiple times"));r=o;let c=this.middlewares[o];if(r===this.middlewares.length&&(c=t),!c)return Promise.resolve();try{return Promise.resolve(c(e,n.bind(null,o+1)))}catch(a){return Promise.reject(a)}};return n(0)}}}const t=async(e,t)=>{e.config.method?e.config.method=e.config.method.toUpperCase():e.config.method="POST",await t()};var r="object"==typeof global&&global&&global.Object===Object&&global,n="object"==typeof self&&self&&self.Object===Object&&self,o=r||n||Function("return this")(),c=o.Symbol,a=Object.prototype,i=a.hasOwnProperty,u=a.toString,s=c?c.toStringTag:void 0;var f=Object.prototype.toString;var l=c?c.toStringTag:void 0;function p(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":l&&l in Object(e)?function(e){var t=i.call(e,s),r=e[s];try{e[s]=void 0;var n=!0}catch{}var o=u.call(e);return n&&(t?e[s]=r:delete e[s]),o}(e):function(e){return f.call(e)}(e)}function y(e){return null!=e&&"object"==typeof e}function h(e){return"symbol"==typeof e||y(e)&&"[object Symbol]"==p(e)}function b(e,t){for(var r=-1,n=null==e?0:e.length,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o}var d=Array.isArray,g=c?c.prototype:void 0,v=g?g.toString:void 0;function j(e){if("string"==typeof e)return e;if(d(e))return b(e,j)+"";if(h(e))return v?v.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function m(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function w(e){if(!m(e))return!1;var t=p(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}var _,O=o["__core-js_shared__"],A=(_=/[^.]+$/.exec(O&&O.keys&&O.keys.IE_PROTO||""))?"Symbol(src)_1."+_:"";var T=Function.prototype.toString;function S(e){if(null!=e){try{return T.call(e)}catch{}try{return e+""}catch{}}return""}var k=/^\[object .+?Constructor\]$/,x=Function.prototype,P=Object.prototype,I=x.toString,E=P.hasOwnProperty,q=RegExp("^"+I.call(E).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function U(e){return!(!m(e)||function(e){return!!A&&A in e}(e))&&(w(e)?q:k).test(S(e))}function $(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return U(r)?r:void 0}var z=$(o,"WeakMap"),D=Object.create,M=function(){function e(){}return function(t){if(!m(t))return{};if(D)return D(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();var C=Date.now;function F(e){return function(){return e}}var R=function(){try{var e=$(Object,"defineProperty");return e({},"",{}),e}catch{}}(),H=R?function(e,t){return R(e,"toString",{configurable:!0,enumerable:!1,value:F(t),writable:!0})}:function(e){return e},B=function(e){var t=0,r=0;return function(){var n=C(),o=16-(n-r);if(r=n,o>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(H);var N=/^(?:0|[1-9]\d*)$/;function L(e,t){var r=typeof e;return!!(t=t??9007199254740991)&&("number"==r||"symbol"!=r&&N.test(e))&&e>-1&&e%1==0&&e<t}function J(e,t,r){"__proto__"==t&&R?R(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function V(e,t){return e===t||e!=e&&t!=t}var W=Object.prototype.hasOwnProperty;function G(e,t,r){var n=e[t];(!W.call(e,t)||!V(n,r)||void 0===r&&!(t in e))&&J(e,t,r)}function Q(e,t,r,n){var o=!r;r||(r={});for(var c=-1,a=t.length;++c<a;){var i=t[c],u=void 0;void 0===u&&(u=e[i]),o?J(r,i,u):G(r,i,u)}return r}var K=Math.max;function X(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function Y(e){return null!=e&&X(e.length)&&!w(e)}var Z=Object.prototype;function ee(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Z)}function te(e){return y(e)&&"[object Arguments]"==p(e)}var re=Object.prototype,ne=re.hasOwnProperty,oe=re.propertyIsEnumerable,ce=te(function(){return arguments}())?te:function(e){return y(e)&&ne.call(e,"callee")&&!oe.call(e,"callee")};var ae="object"==typeof exports&&exports&&!exports.nodeType&&exports,ie=ae&&"object"==typeof module&&module&&!module.nodeType&&module,ue=ie&&ie.exports===ae?o.Buffer:void 0,se=(ue?ue.isBuffer:void 0)||function(){return!1},fe={};function le(e){return function(t){return e(t)}}fe["[object Float32Array]"]=fe["[object Float64Array]"]=fe["[object Int8Array]"]=fe["[object Int16Array]"]=fe["[object Int32Array]"]=fe["[object Uint8Array]"]=fe["[object Uint8ClampedArray]"]=fe["[object Uint16Array]"]=fe["[object Uint32Array]"]=!0,fe["[object Arguments]"]=fe["[object Array]"]=fe["[object ArrayBuffer]"]=fe["[object Boolean]"]=fe["[object DataView]"]=fe["[object Date]"]=fe["[object Error]"]=fe["[object Function]"]=fe["[object Map]"]=fe["[object Number]"]=fe["[object Object]"]=fe["[object RegExp]"]=fe["[object Set]"]=fe["[object String]"]=fe["[object WeakMap]"]=!1;var pe="object"==typeof exports&&exports&&!exports.nodeType&&exports,ye=pe&&"object"==typeof module&&module&&!module.nodeType&&module,he=ye&&ye.exports===pe&&r.process,be=function(){try{return ye&&ye.require&&ye.require("util").types||he&&he.binding&&he.binding("util")}catch{}}(),de=be&&be.isTypedArray,ge=de?le(de):function(e){return y(e)&&X(e.length)&&!!fe[p(e)]},ve=Object.prototype.hasOwnProperty;function je(e,t){var r=d(e),n=!r&&ce(e),o=!r&&!n&&se(e),c=!r&&!n&&!o&&ge(e),a=r||n||o||c,i=a?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],u=i.length;for(var s in e)(t||ve.call(e,s))&&(!a||!("length"==s||o&&("offset"==s||"parent"==s)||c&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||L(s,u)))&&i.push(s);return i}function me(e,t){return function(r){return e(t(r))}}var we=me(Object.keys,Object),_e=Object.prototype.hasOwnProperty;function Oe(e){return Y(e)?je(e):function(e){if(!ee(e))return we(e);var t=[];for(var r in Object(e))_e.call(e,r)&&"constructor"!=r&&t.push(r);return t}(e)}var Ae=Object.prototype.hasOwnProperty;function Te(e){if(!m(e))return function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}(e);var t=ee(e),r=[];for(var n in e)"constructor"==n&&(t||!Ae.call(e,n))||r.push(n);return r}function Se(e){return Y(e)?je(e,!0):Te(e)}var ke=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,xe=/^\w*$/;var Pe=$(Object,"create");var Ie=Object.prototype.hasOwnProperty;var Ee=Object.prototype.hasOwnProperty;function qe(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ue(e,t){for(var r=e.length;r--;)if(V(e[r][0],t))return r;return-1}qe.prototype.clear=function(){this.__data__=Pe?Pe(null):{},this.size=0},qe.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},qe.prototype.get=function(e){var t=this.__data__;if(Pe){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return Ie.call(t,e)?t[e]:void 0},qe.prototype.has=function(e){var t=this.__data__;return Pe?void 0!==t[e]:Ee.call(t,e)},qe.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Pe&&void 0===t?"__lodash_hash_undefined__":t,this};var $e=Array.prototype.splice;function ze(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ze.prototype.clear=function(){this.__data__=[],this.size=0},ze.prototype.delete=function(e){var t=this.__data__,r=Ue(t,e);return!(r<0)&&(r==t.length-1?t.pop():$e.call(t,r,1),--this.size,!0)},ze.prototype.get=function(e){var t=this.__data__,r=Ue(t,e);return r<0?void 0:t[r][1]},ze.prototype.has=function(e){return Ue(this.__data__,e)>-1},ze.prototype.set=function(e,t){var r=this.__data__,n=Ue(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};var De=$(o,"Map");function Me(e,t){var r=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?r["string"==typeof t?"string":"hash"]:r.map}function Ce(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ce.prototype.clear=function(){this.size=0,this.__data__={hash:new qe,map:new(De||ze),string:new qe}},Ce.prototype.delete=function(e){var t=Me(this,e).delete(e);return this.size-=t?1:0,t},Ce.prototype.get=function(e){return Me(this,e).get(e)},Ce.prototype.has=function(e){return Me(this,e).has(e)},Ce.prototype.set=function(e,t){var r=Me(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function Fe(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var n=arguments,o=t?t.apply(this,n):n[0],c=r.cache;if(c.has(o))return c.get(o);var a=e.apply(this,n);return r.cache=c.set(o,a)||c,a};return r.cache=new(Fe.Cache||Ce),r}Fe.Cache=Ce;var Re=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,He=/\\(\\)?/g,Be=function(e){var t=Fe(e,(function(e){return 500===r.size&&r.clear(),e})),r=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Re,(function(e,r,n,o){t.push(n?o.replace(He,"$1"):r||e)})),t}));function Ne(e,t){return d(e)?e:function(e,t){if(d(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!h(e))||xe.test(e)||!ke.test(e)||null!=t&&e in Object(t)}(e,t)?[e]:Be(function(e){return null==e?"":j(e)}(e))}function Le(e){if("string"==typeof e||h(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Je(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}var Ve=c?c.isConcatSpreadable:void 0;function We(e){return d(e)||ce(e)||!!(Ve&&e&&e[Ve])}function Ge(e){return(null==e?0:e.length)?function(e,t,r,n,o){var c=-1,a=e.length;for(r||(r=We),o||(o=[]);++c<a;){var i=e[c];r(i)?Je(o,i):o[o.length]=i}return o}(e):[]}var Qe=me(Object.getPrototypeOf,Object),Ke=Function.prototype,Xe=Object.prototype,Ye=Ke.toString,Ze=Xe.hasOwnProperty,et=Ye.call(Object);function tt(e){if(!y(e)||"[object Object]"!=p(e))return!1;var t=Qe(e);if(null===t)return!0;var r=Ze.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&Ye.call(r)==et}function rt(e){var t=this.__data__=new ze(e);this.size=t.size}rt.prototype.clear=function(){this.__data__=new ze,this.size=0},rt.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},rt.prototype.get=function(e){return this.__data__.get(e)},rt.prototype.has=function(e){return this.__data__.has(e)},rt.prototype.set=function(e,t){var r=this.__data__;if(r instanceof ze){var n=r.__data__;if(!De||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Ce(n)}return r.set(e,t),this.size=r.size,this};var nt="object"==typeof exports&&exports&&!exports.nodeType&&exports,ot=nt&&"object"==typeof module&&module&&!module.nodeType&&module,ct=ot&&ot.exports===nt?o.Buffer:void 0,at=ct?ct.allocUnsafe:void 0;function it(){return[]}var ut=Object.prototype.propertyIsEnumerable,st=Object.getOwnPropertySymbols,ft=st?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,c=[];++r<n;){var a=e[r];t(a,r,e)&&(c[o++]=a)}return c}(st(e),(function(t){return ut.call(e,t)})))}:it;var lt=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Je(t,ft(e)),e=Qe(e);return t}:it;function pt(e,t,r){var n=t(e);return d(e)?n:Je(n,r(e))}function yt(e){return pt(e,Oe,ft)}function ht(e){return pt(e,Se,lt)}var bt=$(o,"DataView"),dt=$(o,"Promise"),gt=$(o,"Set"),vt="[object Map]",jt="[object Promise]",mt="[object Set]",wt="[object WeakMap]",_t="[object DataView]",Ot=S(bt),At=S(De),Tt=S(dt),St=S(gt),kt=S(z),xt=p;(bt&&xt(new bt(new ArrayBuffer(1)))!=_t||De&&xt(new De)!=vt||dt&&xt(dt.resolve())!=jt||gt&&xt(new gt)!=mt||z&&xt(new z)!=wt)&&(xt=function(e){var t=p(e),r="[object Object]"==t?e.constructor:void 0,n=r?S(r):"";if(n)switch(n){case Ot:return _t;case At:return vt;case Tt:return jt;case St:return mt;case kt:return wt}return t});var Pt=Object.prototype.hasOwnProperty;var It=o.Uint8Array;function Et(e){var t=new e.constructor(e.byteLength);return new It(t).set(new It(e)),t}var qt=/\w*$/;var Ut=c?c.prototype:void 0,$t=Ut?Ut.valueOf:void 0;function zt(e,t,r){var n=e.constructor;switch(t){case"[object ArrayBuffer]":return Et(e);case"[object Boolean]":case"[object Date]":return new n(+e);case"[object DataView]":return function(e,t){var r=t?Et(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(e,t){var r=t?Et(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}(e,r);case"[object Map]":case"[object Set]":return new n;case"[object Number]":case"[object String]":return new n(e);case"[object RegExp]":return function(e){var t=new e.constructor(e.source,qt.exec(e));return t.lastIndex=e.lastIndex,t}(e);case"[object Symbol]":return function(e){return $t?Object($t.call(e)):{}}(e)}}var Dt=be&&be.isMap,Mt=Dt?le(Dt):function(e){return y(e)&&"[object Map]"==xt(e)};var Ct=be&&be.isSet,Ft=Ct?le(Ct):function(e){return y(e)&&"[object Set]"==xt(e)},Rt="[object Arguments]",Ht="[object Function]",Bt="[object Object]",Nt={};function Lt(e,t,r,n,o,c){var a,i=1&t,u=2&t,s=4&t;if(r&&(a=o?r(e,n,o,c):r(e)),void 0!==a)return a;if(!m(e))return e;var f=d(e);if(f){if(a=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&Pt.call(e,"index")&&(r.index=e.index,r.input=e.input),r}(e),!i)return function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}(e,a)}else{var l=xt(e),p=l==Ht||"[object GeneratorFunction]"==l;if(se(e))return function(e,t){if(t)return e.slice();var r=e.length,n=at?at(r):new e.constructor(r);return e.copy(n),n}(e,i);if(l==Bt||l==Rt||p&&!o){if(a=u||p?{}:function(e){return"function"!=typeof e.constructor||ee(e)?{}:M(Qe(e))}(e),!i)return u?function(e,t){return Q(e,lt(e),t)}(e,function(e,t){return e&&Q(t,Se(t),e)}(a,e)):function(e,t){return Q(e,ft(e),t)}(e,function(e,t){return e&&Q(t,Oe(t),e)}(a,e))}else{if(!Nt[l])return o?e:{};a=zt(e,l,i)}}c||(c=new rt);var y=c.get(e);if(y)return y;c.set(e,a),Ft(e)?e.forEach((function(n){a.add(Lt(n,t,r,n,e,c))})):Mt(e)&&e.forEach((function(n,o){a.set(o,Lt(n,t,r,o,e,c))}));var h=f?void 0:(s?u?ht:yt:u?Se:Oe)(e);return function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););}(h||e,(function(n,o){h&&(n=e[o=n]),G(a,o,Lt(n,t,r,o,e,c))})),a}Nt[Rt]=Nt["[object Array]"]=Nt["[object ArrayBuffer]"]=Nt["[object DataView]"]=Nt["[object Boolean]"]=Nt["[object Date]"]=Nt["[object Float32Array]"]=Nt["[object Float64Array]"]=Nt["[object Int8Array]"]=Nt["[object Int16Array]"]=Nt["[object Int32Array]"]=Nt["[object Map]"]=Nt["[object Number]"]=Nt[Bt]=Nt["[object RegExp]"]=Nt["[object Set]"]=Nt["[object String]"]=Nt["[object Symbol]"]=Nt["[object Uint8Array]"]=Nt["[object Uint8ClampedArray]"]=Nt["[object Uint16Array]"]=Nt["[object Uint32Array]"]=!0,Nt["[object Error]"]=Nt[Ht]=Nt["[object WeakMap]"]=!1;function Jt(e){return Lt(e,5)}function Vt(e,t){return t.length<2?e:function(e,t){for(var r=0,n=(t=Ne(t,e)).length;null!=e&&r<n;)e=e[Le(t[r++])];return r&&r==n?e:void 0}(e,function(e,t,r){var n=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(r=r>o?o:r)<0&&(r+=o),o=t>r?0:r-t>>>0,t>>>=0;for(var c=Array(o);++n<o;)c[n]=e[n+t];return c}(t,0,-1))}function Wt(e,t){return null==(e=Vt(e,t=Ne(t,e)))||delete e[Le(function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}(t))]}function Gt(e){return tt(e)?void 0:e}var Qt=function(e){return B(function(e,t,r){return t=K(void 0===t?e.length-1:t,0),function(){for(var n=arguments,o=-1,c=K(n.length-t,0),a=Array(c);++o<c;)a[o]=n[t+o];o=-1;for(var i=Array(t+1);++o<t;)i[o]=n[o];return i[t]=r(a),function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}(e,this,i)}}(e,void 0,Ge),e+"")}((function(e,t){var r={};if(null==e)return r;var n=!1;t=b(t,(function(t){return t=Ne(t,e),n||(n=t.length>1),t})),Q(e,ht(e),r),n&&(r=Lt(r,7,Gt));for(var o=t.length;o--;)Wt(r,t[o]);return r}));function Kt(e){return"[object URLSearchParams]"===Object.prototype.toString.call(e)}function Xt(e){return{GET:{request_body:!1},POST:{request_body:!0},PUT:{request_body:!0},DELETE:{request_body:!0},HEAD:{request_body:!1},OPTIONS:{request_body:!1},PATCH:{request_body:!0}}[e=e.toUpperCase()].request_body}function Yt(e){tt(e)&&Object.entries(e).forEach((([t,r])=>{"string"==typeof r?e[t]=r.trim():tt(r)&&Yt(r)}))}const Zt=async(e,t)=>{Xt(e.config.method)&&Yt(e.config.params),await t()};const er=async(e,t)=>{e.reqHeaders=new Headers(e.config.headers),e.reqHeaders.has("Content-Type")||(e.config.params instanceof FormData?function(e){for(const[t,r]of e.entries())if(r instanceof Blob)return!0;return!1}(e.config.params)||e.reqHeaders.set("Content-Type","multipart/form-data"):tt(e.config.params)&&e.reqHeaders.set("Content-Type","application/json")),await t()};const tr=async(e,t)=>{e.config.baseURL&&!function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(e.config.url)&&(e.config.url=function(e,t){return t?`${e.replace(/\/+$/,"")}/${t.replace(/^\/+/,"")}`:e}(e.config.baseURL,e.config.url)),await t()},rr=e=>Kt(e)?e.toString():"string"==typeof e||function(e){return"number"==typeof e||y(e)&&"[object Number]"==p(e)}(e)?e:tt(e)||Array.isArray(e)?JSON.stringify(e):"";async function nr(e,t){if(e.config.params){const t=rr(e.config.params);t&&(e.key=`${e.config.url}${t}${e.config.method}`)}else e.key=`${e.config.url}${e.config.method}`;await t()}const or=()=>{const e=new Map,t=new Map,r=new Map;return async(n,o)=>{if(n.key)if(n.config.mergeRequest){const e=await function(e){if(t.get(e.key))return new Promise((t=>{const n=r.get(e.key)||[];r.set(e.key,n.concat(t))}));t.set(e.key,!0)}(n);if(e)return void Object.keys(e).forEach((t=>{n[t]=e[t]}))}else e.get(n.key)&&!n.config.mergeRequest&&console.warn("[request]: 重复请求, 可通过 mergeRequest 参数优化",n.config),e.set(n.key,!0);await o(),n.key&&(n.config.mergeRequest?function(e){const n=r.get(e.key);n&&n.length>0&&n.forEach((t=>{e.error?t({error:e.error}):t({response:e.response})})),r.delete(e.key),t.delete(e.key)}(n):e.delete(n.key))}},cr="__REQUEST_CACHE:",ar={ram:"ram",session:"sessionStorage",local:"localStorage"},ir=18e4;function ur(e,t="ram"){return t!==ar.ram?`${cr}${e}`:e}function sr(e){return tt(e)||function(e){return"string"==typeof e||!d(e)&&y(e)&&"[object String]"==p(e)}(e)||Array.isArray(e)||Kt(e)}function fr({expire:e,cacheTime:t}){return!(!t||e>=Date.now())}class lr{constructor(){this.data=new Map}get(e){const t=this.data.get(e);return t&&fr(t)?(this.data.delete(e),null):t?Jt(t.data):null}set(e,t){this.data.forEach(((e,t,r)=>{fr(e)&&r.delete(t)})),this.data.size>1e3?console.warn("Request: raw cache is exceed 1000 item, please check cache size"):this.data.set(e,Jt(t))}delete(e){this.data.delete(e)}}const pr=()=>{const e=new lr;const t=new Map,r=new Map;return async(n,o)=>{if(function(e){return!(!(e.config.cacheData||e.config.cache&&"string"!=typeof e.config.cache)||!e.key&&(console.warn(`request: ${e.config.url} 请求参数无法序列化，无法缓存，请移除相关配置`),1))}(n)){const c=function(e){return"object"==typeof e.config.cacheData?e.config.cacheData:"object"==typeof e.config.cache?e.config.cache:{cacheType:"ram",cacheTime:ir}}(n);if(c.force)!function({key:t,cacheType:r="ram"}){const n=ur(t,r);if(r===ar.ram)return e.delete(n);window[ar[r]].removeItem(n)}({key:n.key,cacheType:c.cacheType});else{const t=function({key:t,cacheType:r="ram"}){const n=ur(t,r);if(r===ar.ram)return e.get(n);{const e=window[ar[r]],t=e.getItem(n)||null;try{const r=JSON.parse(t);return r&&!fr(r)?r.data:(e.removeItem(n),null)}catch{return e.removeItem(n),null}}}({key:n.key,cacheType:c.cacheType});if(t)return void(n.response=t)}const a=await function(e,n){const o=ur(e.key,n.cacheType);if(t.get(o))return new Promise((e=>{const t=r.get(o)||[];r.set(o,t.concat(e))}));t.set(o,!0)}(n,c);if(a)return void Object.keys(a).forEach((e=>{n[e]=a[e]}));await o(),n.response&&!sr(n.response)&&console.warn(`request: ${n.config.url} 响应数据无法序列化，无法缓存，请移除相关配置`),!n.error&&n.response&&sr(n.response)?(function(e,n){const o=ur(e.key,n.cacheType),c=r.get(o);c&&c.length>0&&c.forEach((t=>{t({response:e.response})})),r.delete(o),t.delete(o)}(n,c),function({key:t,cacheType:r="ram",data:n,cacheTime:o=ir}){const c=ur(t,r),a={cacheType:r,data:n,cacheTime:o,expire:Date.now()+o};if(r!==ar.ram){const e=window[ar[r]];try{e.setItem(c,JSON.stringify(a))}catch{for(const t in e)t.startsWith(cr)&&Object.prototype.hasOwnProperty.call(e,t)&&e.removeItem(t)}}else e.set(c,a)}({key:n.key,data:n.response,...c})):function(e,n){const o=ur(e.key,n.cacheType),c=r.get(o);c&&c.length>0?(c.shift()(),r.set(o,c)):(r.delete(o),t.delete(o))}(n,c)}else await o()}},yr=e=>new Promise(((t,r)=>{setTimeout((()=>{r({type:"TIMEOUT",msg:"请求超时"})}),e||1e4)})),hr=e=>{if(Xt(e.config.method)){const t=e.config.params;if(tt(t)){if("application/x-www-form-urlencoded"===e.reqHeaders.get("Content-Type")){const e=new URLSearchParams;return Object.keys(t).forEach((r=>{e.set(r,t[r])})),e.toString()}if("multipart/form-data"===e.reqHeaders.get("Content-Type")){const e=new FormData;return Object.keys(t).forEach((r=>{e.append(r,t[r])})),e}return JSON.stringify(t)}return Array.isArray(t)?JSON.stringify(t):t}},br=e=>{const t={};return e.forEach(((e,r)=>{t[r]=e})),t};async function dr(e,t){const r=t.headers.get("content-type");try{const n=function(e,t){return e.config.responseType?e.config.responseType:/application\/json/i.test(t)?"json":/text|xml/.test(t)?"text":"blob"}(e,r);let o;return o="json"===n?await t.json():"text"===n?await t.text():"blob"===n?await t.blob():"arrayBuffer"===n?await t.arrayBuffer():"formData"===n?await t.formData():await t.blob(),o}catch(n){throw new Error(`response body parsing failed: ${n.message}`)}}const gr=e=>{const t=["baseURL","timeout","requestInterceptor","requestInterceptors","responseInterceptor","responseInterceptors","transformData","errorHandler","responseType"];return"string"!=typeof e.config.cache&&t.push("cache"),fetch((e=>{if(!Xt(e.config.method)){let t;return Kt(e.config.params)&&(t=e.config.params.toString()),tt(e.config.params)&&(t=new URLSearchParams(e.config.params).toString()),t?`${e.config.url}?${t}`:e.config.url}return e.config.url})(e),{...Qt(e.config,t),headers:br(e.reqHeaders),body:hr(e)}).then((async t=>("opaqueredirect"===t.type&&(location.href=t.url),t.ok?{status:t.status,data:await dr(e,t),headers:br(t.headers),config:e.config}:Promise.reject({response:{status:t.status,data:await dr(e,t),headers:br(t.headers),config:e.config}}))))};async function vr(e,t){await function(e){return new Promise(((t,r)=>{const n=[],o=e.map((e=>e.then((e=>{const t={status:"fulfilled",value:e};return n.push(t),t}),(e=>{const t={status:"rejected",reason:e};return n.push(t),t}))));Promise.race(o).then((async e=>{var o;"fulfilled"===e.status?t(e.value):"TIMEOUT"===(null==(o=e.reason)?void 0:o.type)?setTimeout((()=>{n.find((e=>"fulfilled"===e.status))?t(e.value):r(e.reason)})):r(e.reason)}))}))}([gr(e),yr(e.config.timeout)]).then((async t=>{"function"==typeof e.config.responseInterceptor&&(t=await e.config.responseInterceptor(t)),w(e.config.transformData)&&(t.data=await e.config.transformData(t.data,t)),e.response=t})).catch((t=>{e.error=t})),await t()}function jr(e){let t=[];return"function"==typeof e?t=[e]:Array.isArray(e)&&(t=e),t}function mr(e){const t=jr(e);return async(e,r)=>{let n=e;for(const o of t)n=await o(n,r);return n}}function wr(e){const t=jr(e);return 0===t.length?null:async(e,r)=>{let n=e;for(const o of t)n=await o(n,r);return n}}function _r(e={}){return e.requestInterceptor||e.requestInterceptors}function Or(e={}){return e.responseInterceptor||e.responseInterceptors}function Ar(r){const n=(new e).use(t).use(tr).use(er).use(Zt).use(nr).use(pr()).use(or()).use(vr).compose(),o={credentials:"include",...r};let c=mr(_r(o)),a=wr(Or(o));const i=async(e,t,r)=>{var i,u;"string"==typeof r&&(r={method:r});const s={config:{url:e,params:t,...o,...r}};try{return _r(r)?s.config=await mr(_r(r))(s.config,c):_r(o)&&(s.config=await c(s.config)),Or(r)?s.config.responseInterceptor=e=>wr(Or(r))(e,a):s.config.responseInterceptor=a||null,n(s).then((async()=>{var e,t;return s.response?s.response:(s.error.config||(s.error.config=s.config),null==(t=(e=s.config).errorHandler)||t.call(e,s.error),Promise.reject(s.error))}))}catch(f){throw null==(u=(i=s.config).errorHandler)||u.call(i,f),f}};return i.setConfig=function(e){Object.assign(o,{...e}),c=mr(_r(o)),a=wr(Or(o))},i}export{Ar as l};
