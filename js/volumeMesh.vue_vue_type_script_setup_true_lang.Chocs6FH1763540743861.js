import{r as e,f as a,n as t}from"./ncFileReader.tzMp_RC71763540743861.js";import{u as l}from"./rawData.Bm5IktqG1763540743861.js";import{u as s}from"./colorList.DbCLsRg71763540743861.js";import{g as n,a as r}from"./generalVolume.Bzkkd-tQ1763540743861.js";import{P as o}from"./tweakpane.CqZAnw7f1763540743861.js";import{d as i,a as u,a8 as m,c as p,w as v,H as d,o as c,u as x,J as f,I as g,ac as h,ao as y}from"./@vue.Co_gxueH1763540743861.js";import{V as b,bL as w,be as T,af as B,b1 as E,f as j,au as S,aE as F,aG as k,r as _,bK as L}from"./three.rXKzP9fQ1763540743861.js";const M=["position","rotation"],z=["scale","visible"],R=["object"],A=i({__name:"volumeMesh",props:{map:{}},async setup(i){let A,G;const I=i,C=I.map.geo2pos(new b(118.724419,32.010354,21e4));C.applyMatrix4(I.map.matrix);const D=u(1),H=u(1),J=u(1),P=s(),V=new w(new T(new B(1,1,1)),new E({color:10066329})),q=([A,G]=m(()=>e("https://opensource.cdn.icegl.cn/ncFile/2003.nc")),A=await A,G(),A),K=q.variables.filter(e=>3==e.dimensions.length),O=u("THT"),U=l(),N=async()=>{const e=await a(q,O.value),l=t(e);console.log(l),U.setDataTypeFromJSdata(l.data),U.xExtent=l.xLength,U.yExtent=l.yLength,U.zExtent=l.zLength,U.setArrayBuffer(l.data),D.value=400,H.value=U.yExtent/U.xExtent*400,J.value=U.zExtent/U.xExtent*400};[A,G]=m(()=>N()),await A,G();const Q=p(()=>!(D.value<=.01&&D.value>=-.01)&&(!(H.value<=.01&&H.value>=-.01)&&!(J.value<=.01&&J.value>=-.01))),W=()=>{const e=new F(U.byteArray,U.xExtent,U.yExtent,U.zExtent);return e.format=k,e.type=U.getThreeType(),e.minFilter=_,e.magFilter=_,e.wrapS=L,e.wrapT=L,e.wrapR=L,e.needsUpdate=!0,e},X={uniforms:{dataTexture:{value:W()},colorTexture:{value:P.updateTransferFunction()},samplingRate:{value:4},threshold:{value:.5},alphaScale:{value:1},invertColor:{value:!1},composeType:{value:1},u_clim:{value:new j(.093,-.001)}},vertexShader:r,fragmentShader:n,side:S,transparent:!0},Y=u(!0),Z=new o;return Z.addBlade({view:"list",label:"气象要素",options:K.map(e=>({text:e.name,value:e.name})),value:O.value}).on("change",async e=>{O.value=e.value,await N(),X.uniforms.dataTexture.value=W()}),Z.addBinding(X.uniforms.u_clim.value,"x",{label:"clim1",min:.01,max:.6,step:.001}),Z.addBinding(X.uniforms.u_clim.value,"y",{label:"clim2",min:-.1,max:.03,step:.001}),Z.addBlade({view:"list",label:"模式",options:[{text:"maximumIntensity",value:1},{text:"thresholding",value:2},{text:"emissionAbsorption",value:3}],value:X.uniforms.composeType.value}).on("change",e=>{X.uniforms.composeType.value=e.value}),Z.addBinding(X.uniforms.samplingRate,"value",{label:"体积采样率",min:0,max:5,step:.01}),Z.addBinding(X.uniforms.threshold,"value",{label:"体绘制的阈值",min:0,max:1,step:.01}),Z.addBinding(X.uniforms.alphaScale,"value",{label:"透明度",min:0,max:1,step:.01}),Z.addBinding(X.uniforms.invertColor,"value",{label:"是否反色"}),Z.addBinding(Y,"value",{label:"显示边框"}),v(()=>P.colorsStops,()=>{X.uniforms.colorTexture.value=P.updateTransferFunction()},{deep:!0,immediate:!0}),(e,a)=>(c(),d("TresGroup",{position:[...x(C)],rotation:[-Math.PI/2,0,0],scale:1e3},[f("TresMesh",{scale:[D.value,H.value,J.value],visible:Q.value,renderOrder:99990},[a[0]||(a[0]=f("TresBoxGeometry",{args:[1,1,1]},null,-1)),f("TresShaderMaterial",h(y(X)),null,16),Y.value?(c(),d("primitive",{key:0,object:x(V)},null,8,R)):g("",!0)],8,z)],8,M))}});export{A as _};
