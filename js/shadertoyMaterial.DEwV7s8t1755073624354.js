import{e,a,b as t}from"./@tresjs.BCY8YfXT1755073624354.js";import{a3 as r,aA as s,f as i,a as o,aX as n,m as l,cB as v,l as u}from"./three.QlBabAUP1755073624354.js";import{z as m}from"./three-custom-shader-material.CWc4oRjg1755073624354.js";import{P as c}from"./tweakpane.C0HtAJSg1755073624354.js";import{a as p}from"./axios.DLTVXJci1755073624354.js";import{d,r as h,aa as f,s as g,h as w,e as y,o as C,f as x,I as j,j as T,u as b,a7 as U,a8 as D,m as _}from"./@vue.BzMISRrV1755073624354.js";import"./postprocessing.5xFoYuqq1755073624354.js";import"./@vueuse.rvsfWOfQ1755073624354.js";class A{constructor(e,a){const t=A.replaceVariable(e),i=new m({baseMaterial:s,vertexShader:"\t\n            varying vec2 vUv;\n            void main() {\n                csm_Position = position * vec3(1.0);\n                vUv = uv;\n            } ",fragmentShader:t,side:r,uniforms:a.material.uniforms});this.material=i,console.log(this.material)}static replaceVariable(e){if(/iTime|iTimeDelta/g.test(e="varying vec2 vUv;\n"+e)){let a=e.split("varying vec2 vUv;\n");e=(e="varying vec2 vUv;\nuniform float utime;\n"+a[1]).replace(/iTime|iTimeDelta/g,"utime")}if(/iResolution\.[a-zA-Z_]+/g.test(e)){let a=e.split("varying vec2 vUv;\n");e=(e=(e="varying vec2 vUv;\nuniform vec2 uresolution;\n"+a[1]).replace(/iResolution\.[a-zA-Z_]+/g,"1.")).replace(/iResolution/g,"1.")}if(/iChannel0|iChannel1|iChannel2|iChannel3/g.test(e)){let a=e.split("varying vec2 vUv;\n");e=(e="varying vec2 vUv;\nuniform sampler2D  utexture;\n"+a[1]).replace(/iChannel0|iChannel1|iChannel2|iChannel3/g,"utexture")}return e.replace(/iMouse/g,"umouse"),e.replace(/void mainImage\( out vec4 fragColor, in vec2 fragCoord \)/g,"void main()").replace(/fragColor/g,"csm_DiffuseColor").replace(/fragCoord/g,"vUv")}}const G={ref:"perspectiveCameraRef",position:[300,250,-122],fov:45,near:1,far:1e4},B=["object","side"],L=d({__name:"shadertoyMaterial",async setup(s){let m,d;const L={clearColor:"#000000",shadows:!0,alpha:!1,useLegacyLights:!0},R={autoRotate:!0,enableDamping:!0},S=new c({title:"参数"}),H=h({addres:"https://www.shadertoy.com/view/mtyGWy",shadervalue:""});let P=([m,d]=f((()=>t(["./plugins/earthSample/image/earthA/moon_ring.png"]))),m=await m,d(),m),z=new i,M=h({material:{uniforms:{utime:{value:0},uresolution:{value:new o(40,40)},utexture:{value:P}}}}),V=new n(100,100,100);S.addBlade({view:"list",label:"shadertoy在线地址",parse:e=>String(e),options:[{text:"1",value:"https://www.shadertoy.com/view/mtyGWy"},{text:"2",value:"https://www.shadertoy.com/view/tlVGDt"},{text:"3",value:"https://www.shadertoy.com/view/ttKGDt"}],value:"https://www.shadertoy.com/view/mtyGWy"}).on("change",(e=>{H.addres=e.value,I(V)}));let W=new n(100,100,100),k=new l(100,100),E=new v(100,10,100,16);S.addBlade({view:"list",label:"几何体",options:[{text:"BOX",value:W},{text:"Plane",value:k},{text:"TorusKnot",value:E}],value:W}).on("change",(e=>{V=e.value,I(V)}));const I=e=>{let a="https://www.shadertoy.com/api/v1/shaders/"+H.addres.split("https://www.shadertoy.com/view/")[1]+"?key=BdHlhH";p.get(a).then((function(a){a.data.Error&&alert(a.data.Error),H.shadervalue=a.data.Shader.renderpass[0].code;let t=new A(H.shadervalue,M);z.clear();let r=new u(e,t.material);z.add(r),K(z,e)})).catch((function(e){console.log(e)}))},K=(e,a)=>{e.children[0].geometry.dispose(),e.children[0].geometry=a},{onLoop:X}=e();return X((({delta:e})=>{M.material.uniforms.utime.value+=e})),g((()=>{let e=new n(100,100,100);I(e)})),(e,t)=>{const s=w("TresCanvas");return C(),y(s,_(L,{"window-size":""}),{default:x((()=>[j("TresPerspectiveCamera",G,null,512),T(b(a),U(D(R)),null,16),t[0]||(t[0]=j("TresAmbientLight",{color:"#ffffff"},null,-1)),t[1]||(t[1]=j("TresDirectionalLight",{position:[100,100,0],intensity:.5,color:"#ffffff"},null,-1)),j("primitive",{object:b(z),side:b(r)},null,8,B),t[2]||(t[2]=j("TresAxesHelper",{args:[1e3],position:[0,19,0]},null,-1)),t[3]||(t[3]=j("TresGridHelper",{args:[6e3,100],position:[0,19,0]},null,-1))])),_:1},16)}}});export{L as default};
