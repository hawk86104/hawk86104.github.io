import"./all.three.CFZkxNVv1744075368226.js";import"./reflectorDiffuse.B6uce8F71744075368226.js";import"./vite-plugin-qiankun.B06WoCqG1744075368226.js";import"./index.Di1ws_Vv1744075368226.js";import{F as t,C as e}from"./three-stdlib.DdM8bY8B1744075368226.js";import{K as n,a as i,n as a,u as l,aZ as r,C as s,b as o}from"./three.Cqu7jvck1744075368226.js";import"./whiteFloor.BwqCJp7N1744075368226.js";function p(t){const e={...t};return"defines"in t&&(e.defines={...t.defines}),"uniforms"in t&&(e.uniforms=n.clone(t.uniforms)),e}const x={defines:{X_IS_EVEN:1,Y_IS_EVEN:1},uniforms:{map:{value:null},originalMapSize:{value:new i},parentMapSize:{value:new i},parentLevel:{value:0}},vertexShader:"\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\n\t\t\t#include <begin_vertex>\n\t\t\t#include <project_vertex>\n\t\t\tvUv = uv;\n\n\t\t}\n\t",fragmentShader:'\n\t\tvarying vec2 vUv;\n\t\tuniform sampler2D map;\n\t\tuniform int parentLevel;\n\t\tuniform vec2 parentMapSize;\n\t\tuniform vec2 originalMapSize;\n\n\t\t\n\n\t// Without original size argument for power of two targets\n\tvec4 packedTexture2DLOD( sampler2D tex, vec2 uv, int level ) {\n\n\t\t// the fraction of the uv space used by the target mip\n\t\tfloat targetSubview = 1.0 / pow( 2.0, float( level ) );\n\t\tfloat widthRatio = 2.0 / 3.0;\n\t\tvec2 scaledDimensions = vec2( targetSubview * widthRatio, targetSubview );\n\n\t\t// all levels > 0 are on the right third of the texture\n\t\t// y is offset from the bottom\n\t\tvec2 offset = vec2(\n\t\t\tlevel > 0 ? widthRatio : 0.0,\n\t\t\tlevel > 0 ? targetSubview : 0.0\n\t\t);\n\n\t\tvec2 samplePoint = mix( offset, offset + scaledDimensions, uv );\n\t\treturn texture2D( tex, samplePoint );\n\n\t}\n\n\tvec4 packedTexture2DLOD( sampler2D tex, vec2 uv, float level ) {\n\n\t\tfloat ratio = mod( level, 1.0 );\n\t\tint minLevel = int( floor( level ) );\n\t\tint maxLevel = int( ceil( level ) );\n\n\t\tvec4 minValue = packedTexture2DLOD( tex, uv, minLevel );\n\t\tvec4 maxValue = packedTexture2DLOD( tex, uv, maxLevel );\n\n\t\treturn mix( minValue, maxValue, ratio );\n\n\t}\n\n\t// With original size argument\n\tvec4 packedTexture2DLOD( sampler2D tex, vec2 uv, int level, vec2 originalPixelSize ) {\n\n\t\tfloat floatLevel = float( level );\n\t\tvec2 atlasSize;\n\t\tatlasSize.x = floor( originalPixelSize.x * 1.5 );\n\t\tatlasSize.y = originalPixelSize.y;\n\n\t\t// we stop making mip maps when one dimension == 1\n\t\tfloat maxLevel = min( floor( log2( originalPixelSize.x ) ), floor( log2( originalPixelSize.y ) ) );\n\t\tfloatLevel = min( floatLevel, maxLevel );\n\n\t\t// use inverse pow of 2 to simulate right bit shift operator\n\t\tvec2 currentPixelDimensions = floor( originalPixelSize / pow( 2.0, floatLevel ) );\n\t\tvec2 pixelOffset = vec2(\n\t\t\tfloatLevel > 0.0 ? originalPixelSize.x : 0.0,\n\t\t\tfloatLevel > 0.0 ? currentPixelDimensions.y : 0.0\n\t\t);\n\n\t\t// "minPixel / atlasSize" samples the top left piece of the first pixel\n\t\t// "maxPixel / atlasSize" samples the bottom right piece of the last pixel\n\t\tvec2 minPixel = pixelOffset;\n\t\tvec2 maxPixel = pixelOffset + currentPixelDimensions;\n\t\tvec2 samplePoint = mix( minPixel, maxPixel, uv );\n\t\tsamplePoint /= atlasSize;\n\n\t\tvec2 halfPixelSize = 1.0 / ( 2.0 * atlasSize );\n\t\tsamplePoint = min( samplePoint, maxPixel / atlasSize - halfPixelSize );\n\t\tsamplePoint = max( samplePoint, minPixel / atlasSize + halfPixelSize );\n\n\t\treturn texture2D( tex, samplePoint );\n\n\t}\n\n\tvec4 packedTexture2DLOD( sampler2D tex, vec2 uv, float level, vec2 originalPixelSize ) {\n\n\t\tfloat ratio = mod( level, 1.0 );\n\t\tint minLevel = int( floor( level ) );\n\t\tint maxLevel = int( ceil( level ) );\n\n\t\tvec4 minValue = packedTexture2DLOD( tex, uv, minLevel, originalPixelSize );\n\t\tvec4 maxValue = packedTexture2DLOD( tex, uv, maxLevel, originalPixelSize );\n\n\t\treturn mix( minValue, maxValue, ratio );\n\n\t}\n\n\n\n\t\t#if X_IS_EVEN && Y_IS_EVEN\n\n\t\t#define SAMPLES 4\n\t\t#define WIDTH 2\n\t\t#define HEIGHT 2\n\n\t\t#elif X_IS_EVEN\n\n\t\t#define SAMPLES 6\n\t\t#define WIDTH 2\n\t\t#define HEIGHT 3\n\n\t\t#elif Y_IS_EVEN\n\n\t\t#define SAMPLES 6\n\t\t#define WIDTH 3\n\t\t#define HEIGHT 2\n\n\t\t#else\n\n\t\t#define SAMPLES 9\n\t\t#define WIDTH 3\n\t\t#define HEIGHT 3\n\n\t\t#endif\n\n\t\tvec4 sampleAt( vec2 uv ) {\n\n\t\t\treturn packedTexture2DLOD( map, uv, parentLevel, originalMapSize );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec2 childMapSize = parentMapSize / 2.0;\n\t\t\t// vec2 childPixelSize = 1.0 / childMapSize;\n\t\t\t// vec2 halfChildPixelSize = childPixelSize / 2.0;\n\t\t\tvec2 childPixelPos = floor( vUv * childMapSize );\n\n\t\t\tvec2 parentPixelSize = 1.0 / parentMapSize;\n\t\t\tvec2 halfParentPixelSize = parentPixelSize / 2.0;\n\t\t\tvec2 parentPixelPos = childPixelPos * 2.0;\n\n\t\t\tvec2 baseUv = ( parentPixelPos / parentMapSize ) + halfParentPixelSize;\n\n\t\t\tvec4 samples[ SAMPLES ];\n\t\t\tfloat weights[ SAMPLES ];\n\n\t\t\t#if X_IS_EVEN && Y_IS_EVEN\n\n\t\t\tsamples[ 0 ] = sampleAt( baseUv );\n\t\t\tsamples[ 1 ] = sampleAt( baseUv + vec2( parentPixelSize.x, 0.0 ) );\n\t\t\tsamples[ 2 ] = sampleAt( baseUv + vec2( 0.0, parentPixelSize.y ) );\n\t\t\tsamples[ 3 ] = sampleAt( baseUv + vec2( parentPixelSize.x, parentPixelSize.y ) );\n\n\t\t\tweights[ 0 ] = 0.25;\n\t\t\tweights[ 1 ] = 0.25;\n\t\t\tweights[ 2 ] = 0.25;\n\t\t\tweights[ 3 ] = 0.25;\n\n\t\t\t#elif X_IS_EVEN\n\n\t\t\tfloat wx0 = 0.5;\n\t\t\tfloat wx1 = 0.5;\n\n\t\t\tfloat yden = 2.0 * parentMapSize.y + 1.0;\n\t\t\tfloat wy0 = ( parentMapSize.y - parentPixelPos.y ) / yden;\n\t\t\tfloat wy1 = ( parentMapSize.y ) / yden;\n\t\t\tfloat wy2 = ( parentPixelPos.y + 1.0 ) / yden;\n\n\t\t\tsamples[ 0 ] = sampleAt( baseUv );\n\t\t\tsamples[ 1 ] = sampleAt( baseUv + vec2( parentPixelSize.x, 0.0 ) );\n\n\t\t\tsamples[ 2 ] = sampleAt( baseUv + vec2( 0.0, parentPixelSize.y ) );\n\t\t\tsamples[ 3 ] = sampleAt( baseUv + vec2( parentPixelSize.x, parentPixelSize.y ) );\n\n\t\t\tsamples[ 4 ] = sampleAt( baseUv + vec2( 0.0, 2.0 * parentPixelSize.y ) );\n\t\t\tsamples[ 5 ] = sampleAt( baseUv + vec2( parentPixelSize.x, 2.0 * parentPixelSize.y ) );\n\n\t\t\tweights[ 0 ] = wx0 * wy0;\n\t\t\tweights[ 1 ] = wx1 * wy0;\n\n\t\t\tweights[ 2 ] = wx0 * wy1;\n\t\t\tweights[ 3 ] = wx1 * wy1;\n\n\t\t\tweights[ 4 ] = wx0 * wy2;\n\t\t\tweights[ 5 ] = wx1 * wy2;\n\n\t\t\t#elif Y_IS_EVEN\n\n\t\t\tfloat xden = 2.0 * parentMapSize.x + 1.0;\n\t\t\tfloat wx0 = ( parentMapSize.x - parentPixelPos.x ) / xden;\n\t\t\tfloat wx1 = ( parentMapSize.x ) / xden;\n\t\t\tfloat wx2 = ( parentPixelPos.x + 1.0 ) / xden;\n\n\t\t\tfloat wy0 = 0.5;\n\t\t\tfloat wy1 = 0.5;\n\n\t\t\tsamples[ 0 ] = sampleAt( baseUv );\n\t\t\tsamples[ 1 ] = sampleAt( baseUv + vec2( parentPixelSize.x, 0.0 ) );\n\t\t\tsamples[ 2 ] = sampleAt( baseUv + vec2( 2.0 * parentPixelSize.x, 0.0 ) );\n\n\t\t\tsamples[ 3 ] = sampleAt( baseUv + vec2( 0.0, parentPixelSize.y ) );\n\t\t\tsamples[ 4 ] = sampleAt( baseUv + vec2( parentPixelSize.x, parentPixelSize.y ) );\n\t\t\tsamples[ 5 ] = sampleAt( baseUv + vec2( 2.0 * parentPixelSize.x, parentPixelSize.y ) );\n\n\t\t\tweights[ 0 ] = wx0 * wy0;\n\t\t\tweights[ 1 ] = wx1 * wy0;\n\t\t\tweights[ 2 ] = wx2 * wy0;\n\n\t\t\tweights[ 3 ] = wx0 * wy1;\n\t\t\tweights[ 4 ] = wx1 * wy1;\n\t\t\tweights[ 5 ] = wx2 * wy1;\n\n\t\t\t#else\n\n\t\t\tfloat xden = 2.0 * parentMapSize.x + 1.0;\n\t\t\tfloat wx0 = ( parentMapSize.x - parentPixelPos.x ) / xden;\n\t\t\tfloat wx1 = ( parentMapSize.x ) / xden;\n\t\t\tfloat wx2 = ( parentPixelPos.x + 1.0 ) / xden;\n\n\t\t\tfloat yden = 2.0 * parentMapSize.y + 1.0;\n\t\t\tfloat wy0 = ( parentMapSize.y - parentPixelPos.y ) / yden;\n\t\t\tfloat wy1 = ( parentMapSize.y ) / yden;\n\t\t\tfloat wy2 = ( parentPixelPos.y + 1.0 ) / yden;\n\n\t\t\tsamples[ 0 ] = sampleAt( baseUv );\n\t\t\tsamples[ 1 ] = sampleAt( baseUv + vec2( parentPixelSize.x, 0.0 ) );\n\t\t\tsamples[ 2 ] = sampleAt( baseUv + vec2( 2.0 * parentPixelSize.x, 0.0 ) );\n\n\t\t\tsamples[ 3 ] = sampleAt( baseUv + vec2( 0.0, parentPixelSize.y ) );\n\t\t\tsamples[ 4 ] = sampleAt( baseUv + vec2( parentPixelSize.x, parentPixelSize.y ) );\n\t\t\tsamples[ 5 ] = sampleAt( baseUv + vec2( 2.0 * parentPixelSize.x, parentPixelSize.y ) );\n\n\t\t\tsamples[ 6 ] = sampleAt( baseUv + vec2( 0.0, 2.0 * parentPixelSize.y ) );\n\t\t\tsamples[ 7 ] = sampleAt( baseUv + vec2( parentPixelSize.x, 2.0 * parentPixelSize.y ) );\n\t\t\tsamples[ 8 ] = sampleAt( baseUv + vec2( 2.0 * parentPixelSize.x, 2.0 * parentPixelSize.y ) );\n\n\t\t\tweights[ 0 ] = wx0 * wy0;\n\t\t\tweights[ 1 ] = wx1 * wy0;\n\t\t\tweights[ 2 ] = wx2 * wy0;\n\n\t\t\tweights[ 3 ] = wx0 * wy1;\n\t\t\tweights[ 4 ] = wx1 * wy1;\n\t\t\tweights[ 5 ] = wx2 * wy1;\n\n\t\t\tweights[ 6 ] = wx0 * wy2;\n\t\t\tweights[ 7 ] = wx1 * wy2;\n\t\t\tweights[ 8 ] = wx2 * wy2;\n\n\t\t\t#endif\n\n\t\t\t<mipmap_logic>\n\n\t\t}\n\t'},f=new s;class v{constructor(n){n||(n="\n\n\t\t\t\t#pragma unroll_loop\n\t\t\t\tfor ( int i = 0; i < SAMPLES; i ++ ) {\n\n\t\t\t\t\tgl_FragColor += samples[ i ] * weights[ i ];\n\n\t\t\t\t}\n\n\t\t\t");const i=p(x);i.fragmentShader=i.fragmentShader.replace(/<mipmap_logic>/g,n);const s=new Array(4);s[0]=new a(p(i)),s[0].defines.X_IS_EVEN=0,s[0].defines.Y_IS_EVEN=0,s[1]=new a(p(i)),s[1].defines.X_IS_EVEN=1,s[1].defines.Y_IS_EVEN=0,s[2]=new a(p(i)),s[2].defines.X_IS_EVEN=0,s[2].defines.Y_IS_EVEN=1,s[3]=new a(p(i)),s[3].defines.X_IS_EVEN=1,s[3].defines.Y_IS_EVEN=1;const o=new l;o.texture.minFilter=r,o.texture.magFilter=r,this._swapTarget=o,this._copyQuad=new t(new a(e)),this._mipQuad=new t(null),this._mipMaterials=s}update(t,e,n,i=!1){t.isWebGLRenderTarget&&(t=t.texture);const a=n.autoClear,l=n.getClearAlpha(),r=n.getRenderTarget();n.getClearColor(f);const s=this._copyQuad,p=this._mipQuad,x=this._swapTarget,v=this._mipMaterials;let m,c;i?(m=o.floorPowerOfTwo(t.image.width),c=o.floorPowerOfTwo(t.image.height)):(m=Math.floor(t.image.width),c=Math.floor(t.image.height));const u=Math.floor(1.5*m),S=Math.floor(c);e.setSize(u,S),x.texture.type!==e.texture.type?(x.dispose(),x.copy(e),x.texture.image={...x.texture.image}):x.setSize(u,S),n.autoClear=!1,n.setClearColor(0),n.setClearAlpha(),s.material.uniforms.tDiffuse.value=t,s.camera.setViewOffset(m,c,0,0,u,S),n.setRenderTarget(e),n.clear(),s.render(n),n.setRenderTarget(x),n.clear(),s.render(n);let w=m,d=c,h=0;for(;w>1&&d>1;){const t=v[(w%2==0?1:0)|(d%2==0?2:0)];t.uniforms.map.value=x.texture,t.uniforms.parentLevel.value=h,t.uniforms.parentMapSize.value.set(w,d),t.uniforms.originalMapSize.value.set(m,c),p.material=t,w=Math.floor(w/2),d=Math.floor(d/2);const i=S-2*d;n.setRenderTarget(e),p.camera.setViewOffset(w,d,-m,-i,u,S),p.render(n),n.setRenderTarget(x),t.uniforms.map.value=e.texture,p.render(n),h++}return n.setRenderTarget(r),n.setClearAlpha(l),n.setClearColor(f),n.autoClear=a,h+1}dispose(){this._swapTarget.dispose(),this._mipQuad.dispose(),this._copyQuad.dispose(),this._mipMaterials.forEach((t=>t.dispose()))}}!function(){for(var t=u,e=d();;)try{if(847955===-parseInt(t(376))/1*(-parseInt(t(346))/2)+parseInt(t(378))/3*(parseInt(t(372))/4)+-parseInt(t(369))/5*(parseInt(t(374))/6)+parseInt(t(373))/7+-parseInt(t(345))/8+parseInt(t(365))/9*(-parseInt(t(359))/10)+-parseInt(t(353))/11)break;e.push(e.shift())}catch(n){e.push(e.shift())}}();var m,c=(m=!0,function(t,e){var n=m?function(){if(e){var n=e.apply(t,arguments);return e=null,n}}:function(){};return m=!1,n});function u(t,e){var n=d();return u=function(t,e){return n[t-=341]},u(t,e)}!function(){c(this,(function(){var t=u,e=new RegExp(t(356)),n=new RegExp(t(375),"i"),i=h(t(350));e[t(341)](i+t(368))&&n[t(341)](i+t(360))?h():i("0")}))()}();var S,w=(S=!0,function(t,e){var n=S?function(){if(e){var n=e.apply(t,arguments);return e=null,n}}:function(){};return S=!1,n});function d(){var t=["call","stateObject","init","bind","prototype","4570104fSPzMj","table","toString","function *\\( *\\)","constructor","action","38820DSElJe","input",'{}.constructor("return this")( )',"error","warn","trace","1251EnMIZU","console","string","chain","745RTHzlW","debu","counter","503084BMflfL","8113245tHgtHw","2364gHLABQ","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","43SCXErS","__proto__","6jHvyxt","gger","return (function() ","test","exception","log","while (true) {}","7017336zGMgup","61782PtgXwJ","apply"];return(d=function(){return t})()}function h(t){function e(t){var n=u;if(typeof t===n(367))return function(t){}.constructor(n(344))[n(347)](n(371));1!==(""+t/t).length||t%20==0?function(){return!0}[n(357)](n(370)+"gger")[n(348)](n(358)):function(){return!1}[n(357)]("debu"+n(379))[n(347)](n(349)),e(++t)}try{if(t)return e;e(0)}catch(n){}}w(void 0,(function(){var t,e=u;try{t=Function(e(380)+e(361)+");")()}catch(o){t=window}for(var n=t[e(366)]=t[e(366)]||{},i=[e(343),e(363),"info",e(362),e(342),e(354),e(364)],a=0;a<i.length;a++){var l=w[e(357)][e(352)].bind(w),r=i[a],s=n[r]||l;l[e(377)]=w[e(351)](w),l.toString=s[e(355)].bind(s),n[r]=l}}))();export{v as P};
