import{importShared as a}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{Kk as k}from"./index.DTe2qqjO1767148983502.js";import{Pane as P}from"./tweakpane.BQRZXf8M1767148983502.js";import"./customShaderMaterial.vue_vue_type_script_setup_true_lang.B7dQ_CiZ1767148983502.js";import"./index.vue_vue_type_script_setup_true_lang.CjsHShHS1767148983502.js";import{useGLTF as M}from"./index.Bk2zy1aS1767148983502.js";import{h337 as T}from"./heatmap.DPNtOJCL1767148983502.js";const{withAsyncContext:E,defineComponent:R}=await a("vue"),{unref:U,openBlock:V,createElementBlock:z}=await a("vue"),A=["object"],c=await a("three"),{watchEffect:D,toRaw:L}=await a("vue"),$=R({__name:"heatmapClickCom",props:{show2dCanvas:{type:Boolean,default:!0},radius:{default:20}},async setup(h){let r,s;const o=h,{nodes:i}=([r,s]=E(()=>M("https://opensource.cdn.icegl.cn/model/heatmap/test.glb")),r=await r,s(),r);i.mesh_0.position.set(-5088.96,-3.08,39374.7),i.mesh_0.scale.setScalar(.01);let e=null,l=null,n=null;const x=()=>(n=document.createElement("heatmap-canvas"),n.style.position="absolute",n.style.top="40px",n.style.left="0",document.body.appendChild(n),e=T.create({container:n,width:256,height:256,blur:"0.8",radius:o.radius}),e._renderer.canvas.style.border="1px solid #5384ff",e._renderer.canvas.onclick=function(t){e.addData({x:t.layerX,y:t.layerY,value:1,radius:o.radius}),e.setDataMax(1),l&&(l.needsUpdate=!0)},e);l=new c.Texture(x()._renderer.canvas);const g={vertexShader:`
	varying vec2 vUv;
	void main() {
		gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
		vUv = uv;
	}
	`,fragmentShader:`
	uniform sampler2D heightMap;
	uniform float uOpacity;
	varying vec2 vUv;
	void main() {
		gl_FragColor = vec4(texture2D(heightMap, vUv.xy).rgb, uOpacity);
	}
	`,uniforms:{uOpacity:{value:1},heightMap:{type:"t",value:l}},depthWrite:!0,depthTest:!0,transparent:!0,side:c.DoubleSide},y=new c.ShaderMaterial(g);return i.mesh_0.material=y,(t=>{t.computeBoundingBox();const{max:d,min:u}=t.boundingBox;t.deleteAttribute("uv");const b=d.x-u.x,B=d.z-u.z,m=[];for(let p=0;p<t.attributes.position.count;p++)m.push((t.attributes.position.getX(p)-u.x)/b),m.push((t.attributes.position.getZ(p)-u.z)/B);const S=new Float32Array(m);t.setAttribute("uv",new c.BufferAttribute(S,2))})(i.mesh_0.geometry),D(()=>{n.style.display=`${o.show2dCanvas?"block":"none"}`}),(t,d)=>(V(),z("primitive",{object:L(U(i).mesh_0)},null,8,A))}}),{defineComponent:F}=await a("vue"),{createElementVNode:v,unref:N,createVNode:f,normalizeProps:j,guardReactiveProps:G,Suspense:H,withCtx:_,openBlock:w,createBlock:C,resolveComponent:O,mergeProps:X}=await a("vue"),{PCFSoftShadowMap:Z,SRGBColorSpace:K}=await a("three"),{reactive:W}=await a("vue"),oe=F({__name:"heatmapClick",setup(h){const r={clearColor:"#030311",shadows:!0,alpha:!0,outputColorSpace:K,shadowMapType:Z,useLegacyLights:!0,antialias:!0},s=W({show2dCanvas:!0,radius:20}),o=new P({title:"参数",expanded:!0});return o.addBinding(s,"show2dCanvas",{label:"显示二维图"}),o.addBinding(s,"radius",{label:"圆圈的大小",min:.1,max:30,step:.1}),o.addButton({title:"点击左侧蓝色画框"}),(i,e)=>{const l=O("TresCanvas");return w(),C(l,X(r,{"window-size":""}),{default:_(()=>[e[0]||(e[0]=v("TresPerspectiveCamera",{position:[21,34,55],fov:60,near:1,far:1e5},null,-1)),f(N(k),{autoRotate:!1,autoRotateSpeed:2}),e[1]||(e[1]=v("TresDirectionalLight",{position:[5,10,7.5],color:"#ffffff",intensity:5},null,-1)),e[2]||(e[2]=v("TresGridHelper",{args:[50,25]},null,-1)),(w(),C(H,null,{default:_(()=>[f($,j(G(s)),null,16)]),_:1}))]),_:1},16)}}});export{oe as default};
