import{importShared as e,mergeGeometries as t}from"./3d-tiles-renderer.CPyPbRB51767152766904.js";import{loading$1 as a,_sfc_main$7 as r}from"./generalFont.vue_vue_type_script_setup_true_lang.BGlCyMZM1767152766904.js";import"./default.vue_vue_type_script_setup_true_lang.Dw-R0TE61767152766904.js";import"./three-mesh-ui.module.C5atkdvh1767152766904.js";import"./domPanel.vue_vue_type_style_index_0_lang.DYISUz3Y1767152766904.js";import{Pane as n}from"./tweakpane.BbuIEN141767152766904.js";import{useGLTF as o,useLoop as i,useTres as l,_export_sfc as s}from"./index.BGo9PN8R1767152766904.js";import{OBJLoader as u,loadOBJ as c}from"./util.BNfRkBxE1767152766904.js";import{RenderPass as m,EffectComposer as p}from"./RenderPass.coonXiPa1767152766904.js";import{UnrealBloomPass as d}from"./UnrealBloomPass.BAfZwd9i1767152766904.js";const v=await e("three"),f=e=>{let t=e.attributes.position.count,a=Math.ceil(Math.sqrt(t)),r=Math.ceil(t/a),n=new Float32Array(a*r*4);!function(e){for(let t=Math.floor(e.length/3)-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));for(let r=0;r<3;r++){let n=e[3*t+r];e[3*t+r]=e[3*a+r],e[3*a+r]=n}}}(e.attributes.position.array);for(let i=0;i<t;i++){const t=e.attributes.position.array[3*i+0],a=e.attributes.position.array[3*i+1],r=e.attributes.position.array[3*i+2],o=0;n[4*i+0]=t,n[4*i+1]=a,n[4*i+2]=r,n[4*i+3]=o}let o=new v.DataTexture(n,a,r,v.RGBAFormat,v.FloatType);return o.needsUpdate=!0,o},x=()=>{const e=new v.ShaderMaterial({uniforms:{uTextureA:{value:null},uTextureB:{value:null},uTime:{value:0},uScroll:{value:0}},vertexShader:"varying vec2 vUv;\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  vUv = uv;\n}",fragmentShader:"uniform sampler2D uTextureA;\nuniform sampler2D uTextureB;\nprecision mediump float; \nuniform float uTime;\nuniform float uScroll;\nvarying vec2 vUv;\n\nmat3 rotationMatrix3(vec3 axis, float angle) {\n  axis = normalize(axis);\n  float s = sin(angle);\n  float c = cos(angle);\n  float oc = 1. - c;\n\n  return mat3(oc * axis.x * axis.x + c, oc * axis.x * axis.y - axis.z * s,\n              oc * axis.z * axis.x + axis.y * s,\n              oc * axis.x * axis.y + axis.z * s, oc * axis.y * axis.y + c,\n              oc * axis.y * axis.z - axis.x * s,\n              oc * axis.z * axis.x - axis.y * s,\n              oc * axis.y * axis.z + axis.x * s, oc * axis.z * axis.z + c);\n}\n\nvoid main() {\n  vec3 textureA = rotationMatrix3(vec3(10., 6., 3.), sin(uTime) * .1) *\n                  texture2D(uTextureA, vUv).xyz;\n  \n\n  vec3 textureB = rotationMatrix3(vec3(10., 6., 3.), sin(uTime) * .1) *\n                  texture2D(uTextureB, vUv).xyz;\n  \n\n  float t = uScroll;\n  vec3 pos = mix(textureA, textureB, t);\n\n  gl_FragColor = vec4(pos, 1.);\n}"}),t=new v.BufferGeometry;return t.setAttribute("position",new v.BufferAttribute(new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]),3)),t.setAttribute("uv",new v.BufferAttribute(new Float32Array([0,1,1,1,1,0,0,1,1,0,0,0]),2)),new v.Mesh(t,e)};const{defineComponent:g}=await e("vue"),{unref:h,openBlock:w,createElementBlock:y}=await e("vue"),_=["object"],P=await e("three"),B=g({__name:"particalMesh",props:{progress:{default:0},width:{default:256},height:{default:256}},setup(e,{expose:t}){const a=e;let r=((e,t)=>{const a=e*t;let r=new Float32Array(3*a);for(let o=0;o<a;o++){let a=3*o;r[a+0]=o%e/e,r[a+1]=o/e/t}const n=new P.BufferGeometry;return n.setAttribute("position",new P.BufferAttribute(r,3)),new P.Points(n,new P.ShaderMaterial({uniforms:{uPositions:{value:null},uSize:{value:12},uPixelRatio:{value:Math.min(window.devicePixelRatio,2)},uColor:{value:new P.Color("#ffaa00")}},vertexShader:"uniform sampler2D\n    uPositions; \nuniform float uSize;\nuniform float uPixelRatio;\nvarying vec3 vPos;\nvarying vec2 vUv;\nvoid main() {\n  vec3 pos = texture2D(uPositions, position.xy).xyz;\n\n  float customSize = uSize;\n\n  vec4 modelPosition = modelMatrix * vec4(pos, 1.0);\n  vec4 viewPosition = viewMatrix * modelPosition;\n  vec4 projectionPosition = projectionMatrix * viewPosition;\n\n  gl_Position = projectionPosition;\n  gl_PointSize = customSize * uPixelRatio;\n  gl_PointSize *= (1.0 / -viewPosition.z);\n\n  vPos = pos;\n}",fragmentShader:"precision mediump float;\nvarying vec3 vPos;\nuniform vec3 uColor; \nvoid main() {\n\n  float distanceToCenter = distance(gl_PointCoord, vec2(0.5));\n  float strength = 0.05 / distanceToCenter - 0.1;\n\n  \n\n  gl_FragColor = vec4(uColor, strength * length(vPos));\n}",transparent:!0,depthWrite:!1,blending:P.AdditiveBlending}))})(a.width,a.height);return t({particles:r}),(e,t)=>(w(),y("primitive",{object:h(r)},null,8,_))}}),{withAsyncContext:M,defineComponent:S}=await e("vue"),{openBlock:C,createBlock:T}=await e("vue"),b=await e("three"),{ref:A,watch:z}=await e("vue"),F=S({__name:"particalFBO",props:{progress:{default:0},width:{default:256},height:{default:256},color:{default:"#ffaa00"}},async setup(e){let a,r;const n=e,s=A(null),m=new b.WebGLRenderTarget(n.width,n.height,{minFilter:b.NearestFilter,magFilter:b.NearestFilter,generateMipmaps:!1,colorSpace:b.SRGBColorSpace,depthBuffer:!1,stencilBuffer:!1,format:b.RGBAFormat,type:b.FloatType}),p=e=>{const a=[];return e.traverse(e=>{e instanceof b.Mesh&&(e.geometry.deleteAttribute("uv"),e.geometry.deleteAttribute("normal"),e.geometry.deleteAttribute("tangent"),a.push(e.geometry))}),t(a)},d="https://opensource.cdn.icegl.cn",v=d+"/model/medical/brainparts.OBJ",g=new u,h=([a,r]=M(()=>c(v,g)),a=await a,r(),a),w=p(h);w.scale(.01,.01,.01);const y=f(w),_=A(null),P=A(null),S=d+"/model/eCommerce/guanYu.glb",{state:F,nodes:R,materials:j,animations:G}=o(S,{draco:!0,decoderPath:"./draco/"});z(()=>F.value,e=>{if(e?.scene)try{const t=e.scene||e?.scene||e.scene,a=t.children?.[0]??t,r=p(a);r.rotateX(Math.PI/2),r.translate(0,-.9,0),_.value=f(r)}catch(t){console.warn("guanyu merge error",t)}},{immediate:!0});const k=d+"/model/industry4/modelDraco.glb",{state:U,nodes:D,materials:L,animations:V}=o(k,{draco:!0,decoderPath:"./draco/"});z(()=>U.value,e=>{if(e?.scene)try{const t=e.scene||e,a=t.children?.[0]??t,r=p(a);r.rotateX(-Math.PI/2),r.rotateY(Math.PI/3),r.translate(0,0,0),P.value=f(r)}catch(t){console.warn("plane merge error",t)}},{immediate:!0});const E=x(),N=new b.Scene,I=new b.OrthographicCamera(-1,1,1,-1,1/Math.pow(2,53),1);N.add(E);const{onBeforeRender:O}=i(),{camera:W,renderer:Y}=l();return O(({elapsed:e})=>{if(Y&&W.value&&s.value){Y.setRenderTarget(m),Y.clear(),Y.render(N,I),Y.setRenderTarget(null);const t=_.value||null,a=y||null,r=P.value||null,o=b.MathUtils.clamp(-n.progress/2,0,1);if(o<.5?(E.material.uniforms.uTextureA.value=t??a,E.material.uniforms.uTextureB.value=a,E.material.uniforms.uScroll.value=2*o):(E.material.uniforms.uTextureA.value=a,E.material.uniforms.uTextureB.value=r??a,E.material.uniforms.uScroll.value=2*(o-.5)),E.material.uniforms.uTime.value=e,s.value?.particles?.material?.uniforms){s.value.particles.material.uniforms.uPositions.value=m.texture;const e=s.value.particles.material.uniforms.uColor;e&&e.value.setStyle(n.color)}}}),(e,t)=>(C(),T(B,{ref_key:"pMesh",ref:s,progress:e.progress},null,8,["progress"]))}}),{defineComponent:R}=await e("vue"),{watchEffect:j}=await e("vue"),G=await e("three"),k=R({__name:"particalPass",props:{use:{type:Boolean,default:!0}},setup(e){const t=e,{camera:a,renderer:r,scene:n,sizes:o}=l(),s=0,u=.472,c=1.61;let v=null;j(()=>{o.width.value&&((e,t,a,r,n)=>{const o=new m(e,t),i=new d(new G.Vector2(r,n),u,c,s),l=new G.WebGLRenderTarget(r,n,{generateMipmaps:!1,minFilter:G.LinearFilter,magFilter:G.LinearFilter,format:G.RGBAFormat,colorSpace:G.SRGBColorSpace,samples:0});v=new p(a,l),v.addPass(o),v.addPass(i)})(n.value,a.value,r,o.width.value,o.height.value)});const{onRender:f}=i();return f(()=>{t.use?v&&v.render():r&&a.value&&r.render(n.value,a.value)}),(e,t)=>null}}),{defineComponent:U}=await e("vue"),{unref:D,createVNode:L,createElementVNode:V,Suspense:E,withCtx:N,openBlock:I,createBlock:O,resolveComponent:W,normalizeProps:Y,guardReactiveProps:X,Fragment:$,createElementBlock:q}=await e("vue"),{ref:J,watchEffect:Z,reactive:H}=await e("vue"),K=await e("three"),Q=s(U({__name:"scrollPartical",setup(e){const t=J(0);Z(()=>{console.log("jaime ~ progress:",t.value)});const o={clearColor:"#000",outputColorSpace:K.LinearSRGBColorSpace,toneMapping:K.NoToneMapping,toneMappingExposure:1,windowSize:!0,renderMode:"manual",powerPreference:"high-performance",antialias:!0,alpha:!1,useLegacyLights:!1,physicallyCorrectLights:!0},i=H({pass:!0,color:"#6aff00"}),l=new n({title:"参数",expanded:!0});return l.addBinding(i,"pass",{label:"后处理"}),l.addBinding(i,"color",{label:"颜色"}),(e,n)=>{const l=W("TresCanvas");return I(),q($,null,[L(D(a),{styleNum:4}),L(l,Y(X(o)),{default:N(()=>[n[1]||(n[1]=V("TresPerspectiveCamera",{position:[0,0,-4],fov:45,near:.1,far:1e3,"look-at":[0,0,0]},null,-1)),L(k,{use:i.pass},null,8,["use"]),L(r,{modelValue:t.value,"onUpdate:modelValue":n[0]||(n[0]=e=>t.value=e),distance:10,"smooth-scroll":.1,htmlScroll:""},{default:N(()=>[(I(),O(E,null,{default:N(()=>[L(F,{progress:t.value,color:i.color},null,8,["progress","color"])]),_:1}))]),_:1},8,["modelValue"])]),_:1},16),n[2]||(n[2]=V("main",null,[V("section",null,[V("h1",null,"关羽 - GuanYu")]),V("section",null,[V("h1",{style:{"margin-left":"-11em","margin-bottom":"-10em"}},"大脑 - Brain")]),V("section",null,[V("h1",{style:{"margin-left":"11em","margin-bottom":"-10em"}},"设备 - Device")])],-1))],64)}}}),[["__scopeId","data-v-9439621a"]]);export{Q as default};
