import{importShared as e}from"./3d-tiles-renderer.CvhCoabY1768360010900.js";import{qiankunWindow_1 as t,useTexture as i}from"./index.CsTVQ09Z1768360010900.js";import{Reflector as r,ReflectorDudvMaterial as l}from"./OimoPhysicsController.DbV4haM21768360010900.js";import{fixSpritesForMirror as a}from"./utils.BJ1fGVNw1768360010900.js";const{defineComponent:o}=await e("vue"),{unref:s,createElementVNode:n,openBlock:u,createElementBlock:c,createCommentVNode:v}=await e("vue"),f=["scale"],p=["object"],_=["object"],m=await e("three"),{Mesh:d,PlaneGeometry:w,RepeatWrapping:h,GridHelper:b}=await e("three"),{watchEffect:B,watch:E,ref:N,toRaw:U}=await e("vue"),g=o({__name:"reflectorDUDV",props:{reflectivity:{default:.8},showGridHelper:{type:Boolean,default:!0},scale:{default:1},ignoreObjects:{default:()=>[]},size:{default:()=>[10,10]},mapUrl:{default:"./plugins/floor/image/waterdudv.jpg"}},setup(e,{expose:o}){const g=e,j=new r,y=new b(g.size[0]-.5,g.size[1]);y.visible=g.showGridHelper;let C=g.mapUrl;t.__POWERED_BY_QIANKUN__&&(C=t.__INJECTED_PUBLIC_PATH_BY_QIANKUN__+C,console.log("qiankunWindow.__INJECTED_PUBLIC_PATH_BY_QIANKUN__",t.__INJECTED_PUBLIC_PATH_BY_QIANKUN__),console.log("process.env.BASE_URL","./"));let I=null,P=N(null);const{state:T,isLoading:R}=i(C);return E(()=>T.value,e=>{e&&(e.wrapS=h,e.wrapT=h,e.colorSpace=m.SRGBColorSpace,e.repeat.set(6,3),I=new l({map:e,reflectivity:g.reflectivity}),I.uniforms.tReflect={value:j.renderTarget.texture},I.uniforms.tReflectBlur=j.renderTargetUniform,I.uniforms.uMatrix=j.textureMatrixUniform,P.value=new d(new w(g.size[0],g.size[1]),void 0),P.value.material=I,P.value.rotation.x=-Math.PI/2,P.value.add(j),P.value.onBeforeRender=(e,t,i)=>{P.value.visible=!1,g.ignoreObjects.forEach(e=>{e.isMesh&&(e.visible=!1),e.value&&e.value.isMesh&&(e.value.visible=!1)}),a(t),j.update(e,t,i),a(t,!1),g.ignoreObjects.forEach(e=>{e.isMesh&&(e.visible=!0),e.value&&e.value.isMesh&&(e.value.visible=!0)}),P.value.visible=!0})}),B(()=>{g.reflectivity&&I&&(I.uniforms.uReflectivity.value=g.reflectivity)}),E(()=>g.showGridHelper,e=>{y.visible=e}),o({reflector:j}),(e,t)=>s(R)?v("",!0):(u(),c("TresGroup",{key:0,scale:[e.scale,1,e.scale]},[n("primitive",{object:U(s(P)),"position-y":-.01},null,8,p),n("primitive",{object:s(y)},null,8,_)],8,f))}});export{g as _sfc_main};
