import{b5 as j,bz as Y,cq as V,cn as q,b8 as H,b3 as v,aM as J,az as I,bl as G,bo as O,b9 as K,a1 as Q,aD as X,bj as Z,ak as tt,w as et,a6 as nt,o as k,c as at,L as st,a9 as ot,a2 as it,aq as rt,x as E,E as L,ag as lt,a as dt,a8 as ct,Y as ut}from"./vendor.lCqXCnsf1715918820022.js";import{_ as ft}from"./pagesShow.vue_vue_type_script_setup_true_lang.Fec0H6un1715918820022.js";import"./vanilla.RwuiOmr41715918820022.js";import"./_commonjsHelpers.5-cIlDoe1715918820022.js";import"./_commonjs-dynamic-modules.h-SxKiO41715918820022.js";import"./LineSegments2.K0qf0Vf01715918820022.js";const F=(f,t)=>{"updateRanges"in f?f.updateRanges[0]=t:f.updateRange=t},P=new G,D=new v,U=new O,R=new v,N=new O,S=new v,pt=f=>class extends f{constructor(){super();const t=parseInt(K.replace(/\D+/g,""))>=154?"opaque_fragment":"output_fragment";this.onBeforeCompile=a=>{a.vertexShader="attribute float opacity;\n               varying float vOpacity;\n              "+a.vertexShader.replace("#include <fog_vertex>","#include <fog_vertex>\n                 vOpacity = opacity;\n                "),a.fragmentShader="varying float vOpacity;\n              "+a.fragmentShader.replace("#include <".concat(t,">"),"#include <".concat(t,">\n                 gl_FragColor = vec4(outgoingLight, diffuseColor.a * vOpacity);\n                "))}}};class mt extends j{constructor({limit:t=200,range:a,material:e=J,texture:x,frustumCulled:p=!0}={}){super(),this.name="Clouds",this.ref=this;const o=this,m=new Y(1,1),w=new Float32Array(Array.from({length:t},()=>1)),C=new Float32Array(Array.from({length:t},()=>[1,1,1]).flat()),l=new V(w,1);l.setUsage(q),m.setAttribute("opacity",l);const h=pt(e),c=new h;c.map=x,c.transparent=!0,c.depthWrite=!1,c.needsUpdate=!0,this.cloudMaterial=c,this.instance=new H(m,c,t);const i=this.instance;i.matrixAutoUpdate=!1,i.frustumCulled=p,i.instanceColor=new V(C,3),i.instanceColor.setUsage(q),o.add(i);const g=[],b=()=>{const d=g.length;let z=0;for(let y=0;y<this.ref.children.length;y++){const u=this.ref.children[y];u.cloudStateArray&&(z+=u.cloudStateArray.length)}if(d===z)return g;g.length=0;for(let y=0;y<this.ref.children.length;y++){const u=this.ref.children[y];u.cloudStateArray&&g.push(...u.cloudStateArray)}return n(),g},n=()=>{const d=Math.min(t,a!==void 0?a:t,g.length);i.count=d,F(i.instanceMatrix,{offset:0,count:d*16}),i.instanceColor&&F(i.instanceColor,{offset:0,count:d*3}),F(i.geometry.attributes.opacity,{offset:0,count:d})};let B=0,r=0,s;const _=new O,M=new v(0,0,1),A=new v;this.update=(d,z,y)=>{B=z,P.copy(i.matrixWorld).invert(),d.matrixWorld.decompose(R,N,S);const u=b();for(r=0;r<u.length;r++)s=u[r],s.ref.matrixWorld.decompose(D,U,S),D.add(A.copy(s.position).applyQuaternion(U).multiply(S)),U.copy(N).multiply(_.setFromAxisAngle(M,s.rotation+=y*s.rotationFactor)),S.multiplyScalar(s.volume+(1+Math.sin(B*s.density*s.speed))/2*s.growth),s.matrix.compose(D,U,S).premultiply(P),s.dist=D.distanceTo(R);for(u.sort(($,T)=>T.dist-$.dist),r=0;r<u.length;r++)s=u[r],w[r]=s.opacity*(s.dist<s.fade-1?s.dist/s.fade:1),i.setMatrixAt(r,s.matrix),i.setColorAt(r,s.color);i.geometry.attributes.opacity.needsUpdate=!0,i.instanceMatrix.needsUpdate=!0,i.instanceColor&&(i.instanceColor.needsUpdate=!0)}}}let ht=0;class W extends j{constructor({opacity:t=1,speed:a=0,bounds:e=new v().fromArray([5,1,1]),segments:x=20,color:p=new I("#ffffff"),fade:o=10,volume:m=6,smallestVolume:w=.25,distribute:C=null,growth:l=4,concentrate:h="inside",seed:c=Math.random()}={}){super(),this.name="cloud_"+ht++,this.seed=c,this.segments=x,this.bounds=e,this.concentrate=h,this.volume=m,this.smallestVolume=w,this.distribute=C,this.growth=l,this.speed=a,this.fade=o,this.opacity=t,this.color=p,this.ref=this,this.cloudStateArray=[],this.updateCloud()}updateCloudStateArray(){if(this.cloudStateArray.length===this.segments)return;const{segments:t,uuid:a}=this;if(this.cloudStateArray.length>this.segments)this.cloudStateArray.splice(0,this.cloudStateArray.length-this.segments);else for(let e=this.cloudStateArray.length;e<t;e++)this.cloudStateArray.push({segments:t,bounds:new v(1,1,1),position:new v,uuid:a,index:e,ref:this,dist:0,matrix:new G,volume:0,length:0,speed:0,growth:0,opacity:1,fade:0,density:0,rotation:e*(Math.PI/t),rotationFactor:0,color:new I})}updateCloud(){const{volume:t,color:a,speed:e,growth:x,opacity:p,fade:o,bounds:m,seed:w,cloudStateArray:C,distribute:l,segments:h,concentrate:c,smallestVolume:i}=this;this.updateCloudStateArray();let g=0;function b(){const n=Math.sin(w+g)*1e4;return g++,n-Math.floor(n)}C.forEach((n,B)=>{n.segments=h,n.volume=t,n.color=a,n.speed=e,n.growth=x,n.opacity=p,n.fade=o,n.bounds.copy(m),n.density=Math.max(.5,b()),n.rotationFactor=Math.max(.2,.5*b())*e;const r=l==null?void 0:l(n,B);if(r||h>1){var s;n.position.copy(n.bounds).multiply((s=r==null?void 0:r.point)!==null&&s!==void 0?s:{x:b()*2-1,y:b()*2-1,z:b()*2-1})}const _=Math.abs(n.position.x),M=Math.abs(n.position.y),A=Math.abs(n.position.z),d=Math.max(_,M,A);n.length=1,_===d&&(n.length-=_/n.bounds.x),M===d&&(n.length-=M/n.bounds.y),A===d&&(n.length-=A/n.bounds.z),n.volume=((r==null?void 0:r.volume)!==void 0?r.volume:Math.max(Math.max(0,i),c==="random"?b():c==="inside"?n.length:1-n.length))*t})}}const gt=["object"],yt=Q({__name:"cloudsMesh",props:{color:{default:"#ffffff"},segments:{default:20},volume:{default:6},opacity:{default:1},seed:{default:0},fade:{default:10},growth:{default:4},speed:{default:0},bounds:{default:{x:5,y:1,z:1}}},async setup(f){let t,a;const e=f,x=([t,a]=X(()=>Z(["./plugins/digitalCity/image/cloud.png"])),t=await t,a(),t),p=new mt({texture:x}),o=new W({color:new I(e.color)});p.add(o);const m=new W({color:new I("pink")});m.position.set(20,0,10),p.add(m);const{camera:w}=tt(),{onBeforeLoop:C}=ot();return C(({delta:l,elapsed:h})=>{p.update(w.value,h,l)}),et(()=>e.color,l=>{o.color.set(l)}),nt(()=>{e.segments&&(o.segments=e.segments),e.volume&&(o.volume=e.volume),e.opacity&&(o.opacity=e.opacity),e.seed&&(o.seed=e.seed),e.fade&&(o.fade=e.fade),e.growth&&(o.growth=e.growth),e.speed&&(o.speed=e.speed),e.bounds&&(o.bounds.x=e.bounds.x,o.bounds.y=e.bounds.y,o.bounds.z=e.bounds.z),o.updateCloud()}),(l,h)=>(k(),at("primitive",{object:st(p),renderOrder:3e3},null,8,gt))}}),xt=ut("TresDirectionalLight",{position:[200,100,0],intensity:1.5,color:"#ffffff"},null,-1),At=Q({__name:"clouds2",setup(f){const t=it({color:"#ffffff",segments:20,volume:6,opacity:1,seed:0,fade:10,growth:4,speed:0,bounds:{x:5,y:1,z:1}}),a=new rt({title:"云彩效果",expanded:!0});return a.addBinding(t,"color",{label:"颜色"}),a.addBinding(t,"seed",{label:"seed",min:0,max:100,step:.1}),a.addBinding(t,"segments",{label:"segments",min:1,max:80,step:.1}),a.addBinding(t,"volume",{label:"volume",min:0,max:100,step:.1}),a.addBinding(t,"opacity",{label:"opacity",min:0,max:1,step:.01}),a.addBinding(t,"fade",{label:"fade",min:0,max:4e3,step:10}),a.addBinding(t,"growth",{label:"growth",min:0,max:20,step:.1}),a.addBinding(t,"speed",{label:"speed",min:0,max:1,step:.01}),a.addBinding(t,"bounds",{x:{min:0,max:25},y:{min:0,max:25},z:{min:0,max:25}}),(e,x)=>(k(),E(ft,null,{ability:L(()=>[xt,(k(),E(lt,null,{default:L(()=>[dt(yt,ct({position:[10,200,0],scale:20},t),null,16)]),_:1}))]),_:1}))}});export{At as default};
