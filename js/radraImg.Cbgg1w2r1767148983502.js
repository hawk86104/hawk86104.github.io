import{importShared as n}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{Fs as b,Kk as I}from"./index.DTe2qqjO1767148983502.js";import{scaleImg as N,$s as w,pt as V,en as x,controlsEvents as M,showLocation as D,informationDiv as L}from"./informationDiv.AUpsPnLl1767148983502.js";import{useTexture$1 as F}from"./customShaderMaterial.vue_vue_type_script_setup_true_lang.B7dQ_CiZ1767148983502.js";import"./index.vue_vue_type_script_setup_true_lang.CjsHShHS1767148983502.js";import{Pane as z}from"./tweakpane.BQRZXf8M1767148983502.js";const{withAsyncContext:j,defineComponent:A}=await n("vue"),{unref:_,createElementVNode:y,openBlock:G,createElementBlock:R}=await n("vue"),W=["position"],H=["scale","material","rotateX","position-y"],g=await n("three"),{watch:X}=await n("vue"),Q=A({__name:"radraImgShow",props:{map:{},height:{default:100},opacity:{default:.6}},async setup(h){let a,i;const t=h,o=new g.MeshPhongMaterial({displacementMap:new g.Texture,transparent:!0,side:g.DoubleSide,opacity:t.opacity,displacementScale:.5,displacementBias:0});o.onBeforeCompile=e=>{e.vertexShader=`uniform sampler2D map;
	`+e.vertexShader,e.vertexShader=e.vertexShader.replace("#include <displacementmap_vertex>","transformed += normalize( objectNormal ) * ( texture2D(map, vMapUv ).a * displacementScale + displacementBias );")};const l=t.map.geo2pos(new g.Vector3(105,34,0));l.applyMatrix4(t.map.matrix);const c=N(t.map,{x:67,y:11},{x:140,y:57},t.height*1e3),p=[];for(let e=0;e<9;e++)p.push(`https://opensource.cdn.icegl.cn/images/simpleGIS/QPFRef_202405311${e}40.png`);let r=0;const s=([a,i]=j(()=>F(p)),a=await a,i(),a);o.map=s[r],X(()=>[t.color,t.opacity],([e,d])=>{o.opacity=d});let m=null,u=!1;return(()=>{u?(clearInterval(m),m=null,u=!1):(m=setInterval(()=>{r=r<p.length-1?r+1:0,o.map=s[r],o.needsUpdate=!0,console.log(r)},1e3),u=!0)})(),(e,d)=>(G(),R("TresGroup",{position:[..._(l)]},[y("TresMesh",{scale:[_(c).x,_(c).y,e.height*1e3],material:_(o),rotateX:-Math.PI/2,renderOrder:9999,"position-y":e.height*1e3/5},[...d[0]||(d[0]=[y("TresPlaneGeometry",{args:[1,1,529,420]},null,-1)])],8,H)],8,W))}}),{defineComponent:U}=await n("vue"),{createElementVNode:$,unref:B,mergeProps:K,createVNode:O,Suspense:Y,withCtx:J,openBlock:T,createBlock:q,Fragment:Z,createElementBlock:ee}=await n("vue"),te=["object"],{watch:k,ref:oe,reactive:ne}=await n("vue"),S=await n("three"),C="pk.eyJ1IjoiaGF3azg2MTA0IiwiYSI6ImNrbTQ3cWtyeTAxejEzMHBtcW42bmc0N28ifQ.bvS9U_yWdHDh41jzaDS1dw",ae=U({__name:"mapBoxShow3",setup(h){const a=ne({height:200,opacity:1}),i=new z({title:"参数"});i.addBinding(a,"height",{label:"高度",min:10,max:300,step:1}),i.addBinding(a,"opacity",{label:"透明度",min:0,max:1,step:.1}),new w({token:C,dataType:"image",style:"mapbox.satellite"}),new w({token:C,dataType:"terrain-rgb",style:"mapbox.terrain-rgb",maxLevel:15});const t=new V({imgSource:[new x({style:"6"}),new x({style:"8"})],lon0:90,minLevel:2,maxLevel:20});t.rotateX(-Math.PI/2);const o=new S.Vector3(105,34,0),l=new S.Vector3(110,0,1e7),c=t.localToWorld(t.geo2map(o)),p=t.localToWorld(t.geo2map(l)),r=oe(),{camera:s,controls:m,scene:u,renderer:v}=b();return s.value&&s.value.position.copy(p),k(()=>m.value,e=>{e&&(e.target.copy(c),M(e,s.value,u.value))}),k(()=>r.value,e=>{e&&e.target.position.copy(c)}),D(s.value,v.domElement,t),(e,d)=>(T(),ee(Z,null,[$("TresDirectionalLight",{ref_key:"tdLight",ref:r,position:[0,2e3,1e3],intensity:1},null,512),$("primitive",{object:B(t)},null,8,te),(T(),q(Y,null,{default:J(()=>[O(Q,K({map:B(t)},a),null,16,["map"])]),_:1}))],64))}}),{defineComponent:re}=await n("vue"),{createElementVNode:E,unref:ie,normalizeProps:se,guardReactiveProps:le,createVNode:f,resolveComponent:ce,mergeProps:pe,withCtx:me,Fragment:ue,openBlock:de,createElementBlock:_e}=await n("vue"),{reactive:P}=await n("vue"),ye=re({__name:"radraImg",setup(h){const a=P({clearColor:"#dbf0ff",alpha:!0,antialias:!1,logarithmicDepthBuffer:!0,precision:"highp"}),i=P({enableDamping:!0,makeDefault:!0,screenSpacePanning:!1,dampingFactor:.035,keyPanSpeed:5});return(t,o)=>{const l=ce("TresCanvas");return de(),_e(ue,null,[f(l,pe(a,{"window-size":""}),{default:me(()=>[o[0]||(o[0]=E("TresPerspectiveCamera",{position:[0,12,0],fov:70,near:.1,far:4e10},null,-1)),f(ie(I),se(le(i)),null,16),o[1]||(o[1]=E("TresAmbientLight",{intensity:1},null,-1)),f(ae)]),_:1},16),f(L)],64)}}});export{ye as default};
