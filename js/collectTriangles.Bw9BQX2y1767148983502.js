import{importShared as m}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{Fs as J,_l as K,Kk as q,tk as Q}from"./index.DTe2qqjO1767148983502.js";import{_sfc_main$6 as ee}from"./generalFont.vue_vue_type_script_setup_true_lang.Cx7Vff0m1767148983502.js";import"./default.vue_vue_type_script_setup_true_lang.Bjy6WD1C1767148983502.js";import"./three-mesh-ui.module.Cv5lk1vQ1767148983502.js";import"./domPanel.vue_vue_type_style_index_0_lang.DqrQKbSz1767148983502.js";import{useLoader as te}from"./customShaderMaterial.vue_vue_type_script_setup_true_lang.B7dQ_CiZ1767148983502.js";import"./index.vue_vue_type_script_setup_true_lang.CjsHShHS1767148983502.js";import{STLLoader as ne}from"./Resource.DwxffO9V1767148983502.js";import{Pane as re}from"./tweakpane.BQRZXf8M1767148983502.js";import{INTERSECTED as Y,CONTAINED as oe,NOT_INTERSECTED as se,computeBoundsTree as ae,disposeBoundsTree as ie,acceleratedRaycast as le}from"./ExtensionUtilities.2O-yyDsQ1767148983502.js";const ce=await m("three"),ue=(c,a,g,i,A,e)=>{window.addEventListener("pointermove",r=>{c.x=r.clientX/window.innerWidth*2-1,c.y=-(r.clientY/window.innerHeight)*2+1,a.value=!0}),window.addEventListener("pointerdown",r=>{c.x=r.clientX/window.innerWidth*2-1,c.y=-(r.clientY/window.innerHeight)*2+1,i.value=r.button;const w=new ce.Raycaster;w.setFromCamera(c,g.value),w.firstHitOnly=!0;const o=w.intersectObject(A.value,!0);a.value=!0,e.enabled=o.length===0},!0),window.addEventListener("pointerup",r=>{i.value=-1,r.pointerType==="touch"&&(a.value=!1)},!0)},{withAsyncContext:pe,defineComponent:me}=await m("vue"),{unref:R,createElementVNode:h,Fragment:fe,openBlock:de,createElementBlock:ve}=await m("vue"),ye=["geometry","material"],ge=["geometry"],n=await m("three"),{ref:b,watchEffect:we}=await m("vue"),_e=me({__name:"model",props:{controls:{}},async setup(c){let a,g;const i=c;(()=>{n.BufferGeometry.prototype.computeBoundsTree=ae,n.BufferGeometry.prototype.disposeBoundsTree=ie,n.Mesh.prototype.raycast=le})();const e=([a,g]=pe(()=>te(ne,"https://opensource.cdn.icegl.cn/model/industry4/TR12J_OCC.stl")),a=await a,g(),a),r=new n.MeshStandardMaterial({color:16777215,roughness:.2,metalness:1,vertexColors:!0}),w=new Uint8Array(e.attributes.position.count*3);w.fill(255);const o=new n.BufferAttribute(w,3,!0);o.setUsage(n.DynamicDrawUsage),e.setAttribute("color",o);const f=b(null),u=b(null),F=b(!1),E=b(-1),V=b(.2),L=new n.Vector2,{camera:O}=J(),k=b(new n.Raycaster),_={x:15/255,y:78/255,z:85/255};let X=null;we(()=>{f.value&&(console.log("targetMesh.value init",f.value),f.value.geometry.computeBoundsTree(),X=e.boundsTree,ue(L,F,O,E,f,i.controls.instance))});const{onBeforeRender:Z}=K();Z(()=>{const B=e.index;if(u.value)if(i.controls.instance.active||!F.value)u.value.visible=!1;else{u.value.scale.setScalar(V.value),k.value.setFromCamera(L,O.value),k.value.firstHitOnly=!0;const l=k.value.intersectObject(f.value,!0);if(l.length){u.value.position.copy(l[0].point),i.controls.instance.enabled=!1,u.value.visible=!0;const T=new n.Matrix4;T.copy(f.value.matrixWorld).invert();const t=new n.Sphere;t.center.copy(u.value.position).applyMatrix4(T),t.radius=V.value*100;const S=[],H=new n.Vector3;if(X?.shapecast({intersectsBounds:d=>{const v=t.intersectsBox(d),{min:p,max:s}=d;if(v){for(let x=0;x<=1;x++)for(let y=0;y<=1;y++)for(let N=0;N<=1;N++)if(H.set(x===0?p.x:s.x,y===0?p.y:s.y,N===0?p.z:s.z),!t.containsPoint(H))return Y;return oe}return v?Y:se},intersectsTriangle:(d,v,p)=>{if(p||d.intersectsSphere(t)){const s=3*v;S.push(s,s+1,s+2)}return!1}}),E.value===0||E.value===2){let d=1,v=1,p=1;E.value===0&&(d=_.x,v=_.y,p=_.z);for(let s=0,x=S.length;s<x;s++){const y=B.getX(S[s]);o.setX(y,d),o.setY(y,v),o.setZ(y,p)}o.needsUpdate=!0}}else u.value.visible=!1,i.controls.instance.enabled=!0}});const W=new re().addButton({title:"点击按钮",label:"生成模型"}),M=new n.BufferGeometry;return M.setAttribute("position",new n.BufferAttribute(new Float32Array,0)),W.on("click",()=>{const B=[],l=[];for(let t=0;t<o.count;t++)o.getX(t)===_.x&&o.getY(t)===_.y&&o.getZ(t)===_.z&&(B.push(e.attributes.position.getX(t),e.attributes.position.getY(t),e.attributes.position.getZ(t)),l.push(e.attributes.normal.getX(t),e.attributes.normal.getY(t),e.attributes.normal.getZ(t)));const T=new Float32Array(B);M.setAttribute("position",new n.BufferAttribute(T,3)),M.setAttribute("normal",new n.BufferAttribute(T,3))}),(B,l)=>(de(),ve(fe,null,[h("TresMesh",{ref_key:"targetMesh",ref:f,geometry:R(e),scale:.005,material:R(r)},null,8,ye),h("TresMesh",{ref_key:"brushMesh",ref:u,visible:!1},[...l[0]||(l[0]=[h("TresSphereGeometry",{args:[1,40,40]},null,-1),h("TresMeshStandardMaterial",{color:15483002,roughness:.75,metalness:0,transparent:!0,opacity:.5,premultipliedAlpha:!0,emissive:15483002,emissiveIntensity:.5},null,-1)])],512),h("TresMesh",{geometry:R(M),position:[-2,-2,2],scale:.005},[...l[1]||(l[1]=[h("TresMeshStandardMaterial",{color:"#023249",roughness:.2,metalness:0,envMapIntensity:.2},null,-1)])],8,ge)],64))}}),{defineComponent:he}=await m("vue"),{unref:$,createVNode:C,createElementVNode:D,mergeProps:G,Suspense:I,withCtx:z,openBlock:j,createBlock:P,resolveComponent:be,Fragment:Be,createElementBlock:Te}=await m("vue"),{reactive:U,ref:xe}=await m("vue"),Ve=he({__name:"collectTriangles",setup(c){const a=U({clearColor:"#999999",antialias:!0}),g=U({autoRotate:!1}),i=xe(null);return(A,e)=>{const r=be("TresCanvas");return j(),Te(Be,null,[C($(ee)),C(r,G(a,{"window-size":""}),{default:z(()=>[e[0]||(e[0]=D("TresPerspectiveCamera",{position:[5,1,15],fov:30,near:.1,far:1e3},null,-1)),C($(q),G({ref_key:"controlsRef",ref:i},g),null,16),e[1]||(e[1]=D("TresAmbientLight",{intensity:1},null,-1)),(j(),P(I,null,{default:z(()=>[C(_e,{controls:i.value},null,8,["controls"])]),_:1})),(j(),P(I,null,{default:z(()=>[C($(Q),{background:!1,files:["pos-x.jpg","neg-x.jpg","pos-y.jpg","neg-y.jpg","pos-z.jpg","neg-z.jpg"],path:"https://opensource.cdn.icegl.cn/images/skyBox/6jpg/"},null,8,["path"])]),_:1}))]),_:1},16)],64)}}});export{Ve as default};
