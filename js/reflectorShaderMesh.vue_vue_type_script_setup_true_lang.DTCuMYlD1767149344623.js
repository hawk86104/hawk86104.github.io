import{importShared as e}from"./3d-tiles-renderer.de6b_qgz1767149344623.js";import{Fs as r,rz as o}from"./index.Btae5S5d1767149344623.js";import{Reflector as t,ReflectorMaterial as i}from"./OimoPhysicsController.DWT9IpO21767149344623.js";import{fixSpritesForMirror as l}from"./utils.BJ1fGVNw1767149344623.js";const{defineComponent:n}=await e("vue"),{unref:a,createElementVNode:f,openBlock:m,createElementBlock:c,createCommentVNode:s}=await e("vue"),u={key:0},p=["object"],d=["object"],{Vector2:w,PlaneGeometry:h,Mesh:v,RepeatWrapping:g,Color:x,GridHelper:y}=await e("three"),{watchEffect:S,watch:j}=await e("vue"),b=n({__name:"reflectorShaderMesh",props:{reflectivity:{default:.2},mirror:{default:.1},mixStrength:{default:9},showGridHelper:{type:Boolean,default:!0},color:{default:"#ffffff"}},setup(e){const n=e,{scene:b}=r(),{textures:M,isLoading:_}=o(["./plugins/floor/image/concrete_wet_floor_basecolor.jpg","./plugins/floor/image/concrete_wet_floor_normal.jpg"]);let G=null,C=null,B=null;return j([M,_],([e,r])=>{if(e&&2===e.length&&!r){e[0].wrapS=g,e[0].wrapT=g,e[1].wrapS=g,e[1].wrapT=g;const r=new t;G=new i({reflectivity:n.reflectivity,mirror:n.mirror,mixStrength:n.mixStrength,color:new x(n.color),map:e[0],normalMap:e[1],normalScale:new w(5,5),fog:b.value.fog,dithering:!0}),G.uniforms.tReflect=r.renderTargetUniform,G.uniforms.uMatrix=r.textureMatrixUniform;const o=new h(10,10);C=new v(o,G),C.name="reflectorShaderMesh",C.position.y=-.01,C.rotation.x=-Math.PI/2,C.add(r),C.onBeforeRender=(e,o,t)=>{C.visible=!1,l(o),r.update(e,o,t),l(o,!1),C.visible=!0},B=new y(9.5,10),B.visible=n.showGridHelper}}),S(()=>{n.reflectivity&&G&&(G.uniforms.uReflectivity.value=n.reflectivity),n.mirror&&G&&(G.uniforms.uMirror.value=n.mirror),n.mixStrength&&G&&(G.uniforms.uMixStrength.value=n.mixStrength),n.color&&G&&(G.uniforms.uColor.value=new x(n.color))}),j(()=>n.showGridHelper,e=>{B.visible=e}),(e,r)=>a(_)?s("",!0):(m(),c("TresGroup",u,[f("primitive",{object:a(C)},null,8,p),f("primitive",{object:a(B),position:[0,.01,0]},null,8,d)]))}});export{b as _sfc_main};
