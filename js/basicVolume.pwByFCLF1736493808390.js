import{m as n,e as t,U as e}from"./@tresjs.g7tJPOCI1736493808390.js";import{_ as r}from"./three.lAfZYOpc1736493808390.js";import{P as o}from"./tweakpane.yHWGBmom1736493808390.js";import{d as a,b as i,r as c,w as l,q as u,o as s,D as p,J as m,u as v,e as f,x as _,j as d,g,aj as h,ak as x,f as y,al as b,m as S,F as w}from"./@vue.-Mz_IXfk1736493808390.js";import{_ as z}from"./@fesjs.JLOwLS8V1736493808390.js";import"./@vueuse.kU-N6GoC1736493808390.js";import"./vue-router.orb3lCQB1736493808390.js";import"./lodash-es.guXTxyfJ1736493808390.js";import"./@qlin.yHhFDldE1736493808390.js";import"./pinia.HJbEB2CQ1736493808390.js";import"./vue-demi.C4xddsk91736493808390.js";import"./@floating-ui.BPbuo5Gx1736493808390.js";import"./@juggle.7yjBMqoW1736493808390.js";const j=O;function I(){const n=["424428MNOKwC","while (true) {}","Cross Section Settings","1783404VInAZd","needsUpdate","8310375KJIZqy","Clock","TresMesh","RedFormat","addBinding",'{}.constructor("return this")( )',"meshRef","string","RepeatWrapping","init","chain","position","basicVolumeRendering","gger","constructor","1hSfHmL","trace","expanded","uniforms","Vector3","addFolder","334118YWEbgJ","Error fetching volume data:","__proto__","apply","1025812wdIfyu","length","function *\\( *\\)","innerHeight","format","info","color","exception","minFilter","Algorithm Settings","debu","return (function() ","getElapsedTime","u_dt","TresShaderMaterial","innerWidth","646128zCghYQ","vertexShader","u_color","LinearFilter","error","1104815GfvWNV","isoValue","log","counter","value","console","TresSphereGeometry","call","table","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","u_isoValue","wrapT","catch","Display Settings","bind","16LlYQHp","u_alphaVal","toString","rotation-x","test","Data3DTexture"];return(I=function(){return n})()}!function(n,t){const e=O,r=I();for(;;)try{if(168488===parseInt(e(464))/1*(-parseInt(e(470))/2)+-parseInt(e(444))/3+parseInt(e(474))/4+-parseInt(e(495))/5+-parseInt(e(447))/6+-parseInt(e(490))/7*(parseInt(e(438))/8)+parseInt(e(449))/9)break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const D=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[O(473)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();!function(){D(this,(function(){const n=O,t=new RegExp(n(476)),e=new RegExp(n(432),"i"),r=F(n(458));t.test(r+n(459))&&e[n(442)](r+"input")?F():r("0")}))()}();const k=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[O(473)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();k(void 0,(function(){const n=O,t=function(){const n=O;let t;try{t=Function(n(485)+n(454)+");")()}catch(e){t=window}return t}(),e=t[n(428)]=t[n(428)]||{},r=[n(425),"warn",n(479),n(494),n(481),n(431),n(465)];for(let o=0;o<r[n(475)];o++){const t=k.constructor.prototype[n(437)](k),a=r[o],i=e[a]||t;t[n(472)]=k[n(437)](k),t[n(440)]=i[n(440)][n(437)](i),e[a]=t}}))();const V=[j(441)],M=[j(467),j(491),"fragmentShader"];function O(n,t){const e=I();return(O=function(n,t){return e[n-=425]})(n,t)}const P=41,L=a({__name:j(461),setup(e){var a;const f=j,_=window[f(489)],d=window[f(477)],g=i(null),h=i(null),x=new(r[f(450)]);x.start();const y=(new o)[f(469)]({title:f(436)}),b=y[f(469)]({title:f(446)}),S=new(r[f(468)])(.5,.5,.5);b.addBinding(S,"x",{label:"X",min:.02,max:.5,step:.02}),b[f(453)](S,"y",{label:"Y",min:.02,max:.5,step:.02}),b[f(453)](S,"z",{label:"Z",min:.02,max:.5,step:.02}),b[f(466)]=!0;const{camera:w}=n(),z=c({u_camera:{value:null==(a=w[f(427)])?void 0:a[f(460)]},u_resolution:{value:new(r[f(468)])(_,d,1)},u_dt:{value:.004},u_time:{value:0},u_crossSectionSize:{value:S},u_color:{value:1},u_volume:{value:null},u_isoValue:{value:.2},u_alphaVal:{value:.2}}),I=y[f(469)]({title:f(483)});I.addBinding(z[f(487)],f(427),{label:"dt",min:4e-4,max:.016,step:2e-4}),I[f(453)](z[f(492)],f(427),{label:f(480),min:1,max:3,step:1}),I[f(453)](z[f(439)],f(427),{label:"alphaVal",min:.01,max:1,step:.01}),I[f(453)](z[f(433)],f(427),{label:f(496),min:0,max:1,step:.04}),l(h,(n=>{const t=f;if(n){const e=new(r[t(443)])(n,P,P,P);e[t(478)]=r[t(452)],e[t(482)]=r[t(493)],e.magFilter=r[t(493)],e[t(434)]=r[t(457)],e[t(448)]=!0,z.u_volume[t(427)]=e}}));const{onLoop:D}=t();return D((()=>{const n=f;z.u_time.value=x[n(486)]()})),u((()=>{(()=>{const n=f;fetch("/plugins/volumeRendering/image/nucleon_41x41x41_uint8.raw").then((n=>n.arrayBuffer())).then((n=>{const t=O,e=new Uint8Array(n),r=new Uint8Array(68921);for(let o=0;o<e[t(475)];o++)r[o]=e[o];h[t(427)]=r}))[n(435)]((t=>{const e=n;console[e(494)](e(471),t)}))})()})),(n,t)=>{const e=f;return s(),p(e(451),{ref_key:e(455),ref:g,"rotation-x":Math.PI/-2},[t[0]||(t[0]=m(e(429),{args:[1,16,16]},null,-1)),m(e(488),{uniforms:z,vertexShader:v("precision mediump float;\n\nuniform vec3 u_camera;\nuniform vec3 u_resolution;\nuniform float u_time;\n\nvarying vec3 v_hitPos;\nvarying vec3 v_hitPosWorldSpace;\nvarying vec3 v_cameraObjectSpace;\n\nvoid main() {\n  vec3 pos = position;\n\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\n\n  v_hitPos = position.xyz;\n\n  v_hitPosWorldSpace = (modelMatrix * vec4(position, 1.0)).xyz;\n\n  v_cameraObjectSpace = (inverse(modelMatrix) * vec4(u_camera, 1.0)).xyz;\n}"),fragmentShader:v("precision mediump int;\nprecision mediump float;\n\nuniform vec3 u_camera;\nuniform vec3 u_resolution;\nuniform mediump sampler3D u_volume;\nuniform vec3 u_crossSectionSize;\nuniform float u_dt;\nuniform float u_time;\nuniform float u_color;\nuniform float u_isoValue;\nuniform float u_alphaVal;\n\nvec3 palette(in float t) {\n  vec3 a = vec3(0.5, 0.5, 0.5);\n  vec3 b = vec3(0.5, 0.5, 0.5);\n  vec3 c = vec3(1.0, 1.0, 1.0);\n  vec3 d = vec3(0.00, 0.33, 0.67);\n\n  return a + b * cos(6.28318 * (c * t + d));\n}\n\nvarying vec3 v_hitPos;\nvarying vec3 v_hitPosWorldSpace;\nvarying vec3 v_cameraObjectSpace;\n\nvec2 intersect_box(vec3 orig, vec3 dir) {\n\n  vec3 box_min = vec3(-u_crossSectionSize);\n  vec3 box_max = vec3(u_crossSectionSize);\n  vec3 inv_dir = 1.0 / dir;\n  vec3 tmin_tmp = (box_min - orig) * inv_dir;\n  vec3 tmax_tmp = (box_max - orig) * inv_dir;\n  vec3 tmin = min(tmin_tmp, tmax_tmp);\n  vec3 tmax = max(tmin_tmp, tmax_tmp);\n  float t0 = max(tmin.x, max(tmin.y, tmin.z));\n  float t1 = min(tmax.x, min(tmax.y, tmax.z));\n  return vec2(t0, t1);\n}\n\nvoid main() {\n  vec3 rayOrigin = vec3(0.0, 0.0, -3.0);\n  rayOrigin = v_cameraObjectSpace;\n\n  vec2 uv = 2.0 * gl_FragCoord.xy / u_resolution.xy - 1.0;\n  vec3 rayDir = normalize(vec3(uv, 1.0));\n  rayDir = normalize(v_hitPos - rayOrigin);\n\n  vec2 t_hit = intersect_box(rayOrigin, rayDir);\n  if (t_hit.x > t_hit.y) {\n    discard;\n  }\n\n  t_hit.x = max(t_hit.x, 0.0);\n\n  float dt = u_dt;\n\n  vec4 color = vec4(0.0);\n\n  vec3 p = rayOrigin + t_hit.x * rayDir + 0.5;\n  for (float t = t_hit.x; t < t_hit.y; t += dt) {\n\n    float textureVal = texture(u_volume, p).r;\n\n    vec4 val_color = vec4(0.0);\n    float val_color_alpha = textureVal * 0.1;\n\n    val_color_alpha = smoothstep(0.0, u_alphaVal, val_color_alpha);\n\n    vec3 red = vec3(1.0, 0.0, 0.0);\n    vec3 white = vec3(1.0);\n    if (abs(u_color - 1.0) <= 0.01) {\n      val_color = vec4(white, val_color_alpha);\n    } else if (abs(u_color - 2.0) <= 0.01) {\n      val_color = vec4(mix(red, white, val_color_alpha), val_color_alpha);\n    } else {\n      val_color = vec4(palette(textureVal), val_color_alpha);\n    }\n\n    color.rgb += (1.0 - color.a) * val_color.a * val_color.rgb;\n    color.a += (1.0 - color.a) * val_color.a;\n\n    if (textureVal > u_isoValue) {\n      float gxLess = texture(u_volume, vec3(p.x - rayDir.x * u_dt, p.y, p.z)).r;\n      float gxMore = texture(u_volume, vec3(p.x + rayDir.x * u_dt, p.y, p.z)).r;\n      float dgx = gxMore - gxLess;\n\n      float gyLess = texture(u_volume, vec3(p.x, p.y - rayDir.y * u_dt, p.z)).r;\n      float gyMore = texture(u_volume, vec3(p.x, p.y + rayDir.y * u_dt, p.z)).r;\n      float dgy = gyMore - gyLess;\n\n      float gzLess = texture(u_volume, vec3(p.x, p.y, p.z - rayDir.z * u_dt)).r;\n      float gzMore = texture(u_volume, vec3(p.x, p.y, p.z + rayDir.z * u_dt)).r;\n      float dgz = gzMore - gzLess;\n      vec3 n = normalize(vec3(dgx, dgy, dgz));\n\n      vec3 lightSource = vec3(1.0);\n      vec3 lightDir = normalize(lightSource);\n      float diffuseStrength = max(dot(n, lightDir), 0.0);\n\n      vec3 viewSource = normalize(rayOrigin);\n      vec3 reflectSource = normalize(reflect(-lightSource, n));\n      float specularStrength = max(0.0, dot(viewSource, reflectSource));\n      specularStrength = pow(specularStrength, 64.0);\n\n      color.rgb = diffuseStrength * val_color.rgb + specularStrength * val_color.rgb;\n      color.rgb *= val_color.rgb;\n      color.a = 0.95;\n      break;\n    }\n\n    if (color.a >= 0.95) {\n      break;\n    }\n\n    p += rayDir * dt;\n  }\n\n  gl_FragColor = color;\n}")},null,8,M)],8,V)}}});function F(n){function t(n){const e=O;if(typeof n===e(456))return function(n){}[e(463)](e(445))[e(473)](e(426));1!==(""+n/n)[e(475)]||n%20==0?function(){return!0}[e(463)]("debugger")[e(430)]("action"):function(){return!1}[e(463)](e(484)+e(462))[e(473)]("stateObject"),t(++n)}try{if(n)return t;t(0)}catch(e){}}function R(n,t){const e=A();return(R=function(n,t){return e[n-=419]})(n,t)}!function(n,t){const e=R,r=A();for(;;)try{if(267155===parseInt(e(419))/1+parseInt(e(425))/2+-parseInt(e(422))/3*(parseInt(e(430))/4)+parseInt(e(432))/5+-parseInt(e(436))/6*(-parseInt(e(455))/7)+-parseInt(e(444))/8+-parseInt(e(441))/9*(-parseInt(e(443))/10))break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const T=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[R(445)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();!function(){T(this,(function(){const n=R,t=new RegExp("function *\\( *\\)"),e=new RegExp(n(457),"i"),r=E(n(420));t[n(448)](r+n(426))&&e[n(448)](r+n(439))?E():r("0")}))()}();const C=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e.apply(t,arguments);return e=null,n}}:function(){};return n=!1,r}}();function A(){const n=["37450uEEzFi",'{}.constructor("return this")( )',"string","stateObject","5286JMhhPv","debu","https://klacansky.com/open-scivis-datasets/skull/skull_256x256x256_uint8.raw","input","length","351tYewhJ","error","32570SNisqn","2664272EHrKDZ","apply","_blank","prototype","test","return (function() ","toString","__proto__","gger","exception","constructor","721IBYGyY","TresCanvas","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","347591LIaXeb","init","bind","996027ATtPFa","log","#201919","718702xTJSfg","chain","info","trace","call","4OLyBCM","TresPerspectiveCamera"];return(A=function(){return n})()}C(void 0,(function(){const n=R,t=function(){const n=R;let t;try{t=Function(n(449)+n(433)+");")()}catch(e){t=window}return t}(),e=t.console=t.console||{},r=[n(423),"warn",n(427),n(442),n(453),"table",n(428)];for(let o=0;o<r[n(440)];o++){const t=C[n(454)][n(447)].bind(C),a=r[o],i=e[a]||t;t[n(451)]=C.bind(C),t[n(450)]=i[n(450)][n(421)](i),e[a]=t}}))();function E(n){function t(n){const e=R;if(typeof n===e(434))return function(n){}[e(454)]("while (true) {}")[e(445)]("counter");1!==(""+n/n)[e(440)]||n%20==0?function(){return!0}.constructor(e(437)+"gger")[e(429)]("action"):function(){return!1}[e(454)]("debu"+e(452))[e(445)](e(435)),t(++n)}try{if(n)return t;t(0)}catch(e){}}const Z=z(a({__name:"basicVolume",setup(n){const t=c({windowSize:!0,alpha:!0,antialias:!0,autoClear:!1,disableRender:!0}),r=c({enableDamping:!0,enableZoom:!0,enablePan:!0,enableRotate:!0,makeDefault:!0});return(n,o)=>{const a=R,i=f(a(456));return s(),p(w,null,[o[3]||(o[3]=m("div",{class:a(427)},[m("a",{href:a(438),target:a(446)}," https://klacansky.com/open-scivis-datasets/skull/skull_256x256x256_uint8.raw "),m("br"),_(" 请自行下载数据集, 复制到 /plugins/volumeRendering/image/skull_256x256x256_uint8.raw 并更改文件请求指向和 dim 大小 ")],-1)),d(i,S({clearColor:a(424)},t),{default:g((()=>[o[0]||(o[0]=m(a(431),{fov:75,near:.001,far:1e3,position:[-1,.4,-1],"look-at":[0,0,0],up:[0,1,0]},null,-1)),o[1]||(o[1]=m("TresAmbientLight",{intensity:2},null,-1)),d(v(e),h(x(r)),null,16),(s(),y(b,null,{default:g((()=>[d(L,{position:[0,0,0]})])),_:1})),o[2]||(o[2]=m("TresGridHelper",{args:[50,50],position:[0,-5,0]},null,-1))])),_:1},16)],64)}}}),[["__scopeId","data-v-925b4c37"]]);export{Z as default};
