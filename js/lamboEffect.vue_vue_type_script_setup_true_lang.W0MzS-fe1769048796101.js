import{importShared as t}from"./3d-tiles-renderer.DoRCwQO21769048796101.js";import{useTres as e,useLoop as n}from"./index.DY1Qq3wV1769048796101.js";import{ShaderPass as i,RenderPass as r,EffectComposer as a}from"./RenderPass.BZXWNfnD1769048796101.js";import{OutputPass as l}from"./OutputPass.D85kBp-t1769048796101.js";import{UnrealBloomPass as s}from"./UnrealBloomPass.DWUUUVBi1769048796101.js";const{ClampToEdgeWrapping:u,Data3DTexture:o,FileLoader:m,LinearFilter:d,Loader:c,UnsignedByteType:h,Vector3:p}=await t("three");class v extends c{constructor(t){super(t),this.type=h}setType(t){return this.type=t,this}load(t,e,n,i){const r=new m(this.manager);r.setPath(this.path),r.setResponseType("text"),r.load(t,n=>{try{e(this.parse(n))}catch(r){i?i(r):console.error(r),this.manager.itemError(t)}},n,i)}parse(t){const e=/^([\d.e+-]+) +([\d.e+-]+) +([\d.e+-]+) *$/gm;let n=/TITLE +"([^"]*)"/.exec(t);const i=null!==n?n[1]:null;if(n=/LUT_3D_SIZE +(\d+)/.exec(t),null===n)throw new Error("LUTCubeLoader: Missing LUT_3D_SIZE information");const r=Number(n[1]),a=r**3*4,l=this.type===h?new Uint8Array(a):new Float32Array(a),s=new p(0,0,0),m=new p(1,1,1);if(n=/DOMAIN_MIN +([\d.]+) +([\d.]+) +([\d.]+)/.exec(t),null!==n&&s.set(Number(n[1]),Number(n[2]),Number(n[3])),n=/DOMAIN_MAX +([\d.]+) +([\d.]+) +([\d.]+)/.exec(t),null!==n&&m.set(Number(n[1]),Number(n[2]),Number(n[3])),s.x>m.x||s.y>m.y||s.z>m.z)throw new Error("LUTCubeLoader: Invalid input domain");const c=this.type===h?255:1;let v=0;for(;null!==(n=e.exec(t));)l[v++]=Number(n[1])*c,l[v++]=Number(n[2])*c,l[v++]=Number(n[3])*c,l[v++]=c;const f=new o;return f.image.data=l,f.image.width=r,f.image.height=r,f.image.depth=r,f.type=this.type,f.magFilter=d,f.minFilter=d,f.wrapS=u,f.wrapT=u,f.wrapR=u,f.generateMipmaps=!1,f.needsUpdate=!0,{title:i,size:r,domainMin:s,domainMax:m,texture3D:f}}}const f={name:"LUTShader",uniforms:{lut:{value:null},lutSize:{value:0},tDiffuse:{value:null},intensity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}\n\n\t",fragmentShader:"\n\n\t\tuniform float lutSize;\n\t\tuniform sampler3D lut;\n\n\t\tvarying vec2 vUv;\n\t\tuniform float intensity;\n\t\tuniform sampler2D tDiffuse;\n\t\tvoid main() {\n\n\t\t\tvec4 val = texture2D( tDiffuse, vUv );\n\t\t\tvec4 lutVal;\n\n\t\t\t// pull the sample in by half a pixel so the sample begins\n\t\t\t// at the center of the edge pixels.\n\t\t\tfloat pixelWidth = 1.0 / lutSize;\n\t\t\tfloat halfPixelWidth = 0.5 / lutSize;\n\t\t\tvec3 uvw = vec3( halfPixelWidth ) + val.rgb * ( 1.0 - pixelWidth );\n\n\n\t\t\tlutVal = vec4( texture( lut, uvw ).rgb, val.a );\n\n\t\t\tgl_FragColor = vec4( mix( val, lutVal, intensity ) );\n\n\t\t}\n\n\t"};class w extends i{constructor(t={}){super(f),this.lut=t.lut||null,this.intensity="intensity"in t?t.intensity:1}set lut(t){const e=this.material;t!==this.lut&&(e.uniforms.lut.value=null,t&&(e.uniforms.lutSize.value=t.image.width,e.uniforms.lut.value=t))}get lut(){return this.material.uniforms.lut.value}set intensity(t){this.material.uniforms.intensity.value=t}get intensity(){return this.material.uniforms.intensity.value}}const{defineComponent:y}=await t("vue"),{watchEffect:g}=await t("vue"),x=await t("three"),b=y({__name:"lamboEffect",setup(t){const{camera:i,renderer:u,scene:o,sizes:m}=e(),d=.666,c=.366,h=.33;let p=null,f=null;(new v).load("https://opensource.cdn.icegl.cn/model/industry4/F-6800-STD.cube",function(t){f.lut=t.texture3D}),g(()=>{m.width.value&&((t,e,n,i,u)=>{const o=new r(t,e),m=new s(new x.Vector2(i,u),c,h,d);p=new a(n),p.addPass(o),p.addPass(m),p.addPass(new l),f=new w({intensity:1}),p.addPass(f)})(o.value,i.value,u,m.width.value,m.height.value)});const{onRender:y}=n();return y(()=>{p&&p.render()}),(t,e)=>null}});export{b as _sfc_main};
