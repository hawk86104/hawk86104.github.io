import{A as e,V as t,Y as a,k as s,a as l}from"./@tresjs.PrijCSbN1757990346019.js";import{_ as o,cj as n}from"./three.DHXbQd-f1757990346019.js";import{M as i}from"./mqttTvt.QA0MQWZO1757990346019.js";import{d as r,b as u,s as c,V as m,i as v,w as d,G as p,o as f,j,u as b,f as g,x as _,aa as h,F as y,I as w,h as O,e as T,a5 as k,a7 as M,a8 as q,E as S}from"./@vue.pEDXJ_3Z1757990346019.js";import{u as A,l as x,w as F,N as I,s as P,y as C,x as D,p as N}from"./naive-ui.Bq5Kiv221757990346019.js";import"./postprocessing.BxUQ5pTE1757990346019.js";import"./@vueuse.D19fGRfI1757990346019.js";import"./events.CafAsz9H1757990346019.js";import"./mqtt.DxgoMxFx1757990346019.js";import"./date-fns.DXfinlbv1757990346019.js";import"./@css-render.Dg-MBYFG1757990346019.js";import"./css-render.CtKLNfBW1757990346019.js";import"./@emotion.DFFAhID71757990346019.js";import"./seemly.BQc18TWx1757990346019.js";import"./vooks.mFbfhORj1757990346019.js";import"./evtd.DVZ1YWiB1757990346019.js";import"./vueuc.eGcu6XGj1757990346019.js";import"./vdirs.Ck_Dk7vX1757990346019.js";import"./@juggle.CcBCnTIR1757990346019.js";import"./lodash-es.C7pWAXPe1757990346019.js";import"./treemate.CnlbqGMX1757990346019.js";import"./date-fns-tz.B7EY-BzJ1757990346019.js";import"./async-validator.D9c8kbAV1757990346019.js";const $={class:"w-100 absolute z-99999 mqttdebugger",style:{"background-color":"#aaaaaa","margin-top":"40px"}},Q=r({__name:"widthMqtt",setup(e){const t=A(),a=u(!1),s=u(!1),l={host:"a5183db3.ala.asia-southeast1.emqxsl.com",port:8084,protocol:"wss",clientId:`tvt-test-client-${Math.random().toString(16).slice(2,8)}`,username:"tvt.js",password:"test",topic:"tvtDevices/#"},o=u(null),n=u(!1),r=u([]);function h(){o.value&&y(),o.value=new i(l),o.value.on("connected",(()=>{n.value=!0,console.log("MQTT 连接成功"),function(){if(!o.value)return;o.value.subscribe(l.topic,(e=>{e?console.error(`订阅失败: ${e.message}`):console.log(`已订阅主题: ${l.topic}`)}))}()})),o.value.on("close",(()=>{n.value=!1,console.log("MQTT 连接关闭")})),o.value.on("error",(e=>{console.error(`MQTT 错误: ${e.message}`)})),o.value.on("message",((e,l)=>{r.value.push(`[${e}] ${JSON.stringify(l)}`),r.value.length>100&&r.value.shift(),!s.value&&l&&l.status&&(a.value="运行"===l.status),l&&l.detail&&t.info("mqtt["+l.deviceId+"] 设备详情："+l.detail+"程序已运行："+l.uptime,{keepAliveOnHover:!0,duration:18e3})})),o.value.connect()}function y(){o.value&&(o.value.removeAllListeners(),o.value.disconnect(),o.value=null,n.value=!1)}c((()=>{h()})),m((()=>{o.value,y()}));let w=null;function O(e){s.value=!0;const t={deviceId:"tvtDevice001",status:e?"运行":"关闭"};o.value.publish("tvtDevices/tvtDevice001/control",t),clearTimeout(w),w=setTimeout((()=>{s.value=!1}),1e3)}const T=v("animationPlay");return d((()=>a.value),(e=>{T.value=e}),{immediate:!0}),(e,t)=>(f(),p("div",$,[j(b(x),{title:"MQTT 调试面板"},{default:g((()=>[j(b(F),{style:{"margin-top":"-10px"}},{default:g((()=>t[1]||(t[1]=[_("mqtt配置信息")]))),_:1}),j(b(I),{value:JSON.stringify(l,null,2),type:"textarea",rows:9,disabled:""},null,8,["value"]),j(b(F),null,{default:g((()=>t[2]||(t[2]=[_("连接状态")]))),_:1}),j(b(P),{label:"mqtt代理通路"},{default:g((()=>[j(b(C),{value:n.value},{checked:g((()=>t[3]||(t[3]=[_(" 已连接 ")]))),unchecked:g((()=>t[4]||(t[4]=[_(" 连接中 ")]))),_:1},8,["value"])])),_:1}),j(b(P),{label:"订阅主题"},{default:g((()=>[j(b(I),{value:l.topic,disabled:""},null,8,["value"])])),_:1}),j(b(F),null,{default:g((()=>t[5]||(t[5]=[_("信息日志列表")]))),_:1}),j(b(D),{log:r.value.join("\n"),rows:12},null,8,["log"]),j(b(F),null,{default:g((()=>t[6]||(t[6]=[_("通过mqtt交互状态")]))),_:1}),t[7]||(t[7]=_(" 开关电风扇 : ")),j(b(C),{loading:s.value,round:!1,value:a.value,"onUpdate:value":[t[0]||(t[0]=e=>a.value=e),O]},null,8,["loading","value"])])),_:1})]))}}),L=["object"],z=r({__name:"efanModel",props:{color:{type:String,required:!0}},async setup(l){let o,n;const i=l,{nodes:r,animations:u}=([o,n]=h((()=>s("https://opensource.cdn.icegl.cn/model/eCommerce/eFan/nFan.gltf"))),o=await o,n(),o),c=e=>r.Sketchfab_model.getObjectByName(e).geometry.attributes.uv.array,m={Object_4:new Float32Array(c("Object_4")),Object_8:new Float32Array(c("Object_8")),Object_6:new Float32Array(c("Object_6")),Object_6001:new Float32Array(c("Object_6001"))},_=r.Sketchfab_model.getObjectByName("Object_6001"),{actions:O}=e(u,r.Sketchfab_model),T=O.Animation,k=v("animationPlay");return d((()=>i.color),(e=>{(e=>{const t={"#ff8b04":0,"#999999":.04,"#d3ac10":.19,"#ffbec4":-.06,"#d0d5c6":.55};for(const[a,s]of Object.entries(m)){for(let l=0;l<c(a).length;l++)c(a)[l]=s[l]+t[e];r.Sketchfab_model.getObjectByName(a).geometry.getAttribute("uv").needsUpdate=!0}})(e)}),{immediate:!0}),d((()=>k.value),(e=>{e?(T.reset().play(),_?.rotateY(-Math.PI)):(T.fadeOut(.6).paused=!0,_?.rotateY(Math.PI))}),{immediate:!0}),(e,s)=>(f(),p(y,null,[j(b(t),{range:[-.5,-.5],speed:2},{default:g((()=>[w("primitive",{position:[-2,0,0],object:b(r).Sketchfab_model,scale:3},null,8,L)])),_:1}),j(b(a),{opacity:.3,blur:2.6,position:[0,-2,0]})],64))}}),B=r({__name:"withModel",setup(e){const t={shadows:!0,alpha:!0,shadowMapType:n,outputColorSpace:o,windowSize:!0},a=u(!1);return S("animationPlay",a),(e,a)=>{const s=O("TresCanvas");return f(),p(y,null,[j(s,M(q(t)),{default:g((()=>[a[0]||(a[0]=w("TresPerspectiveCamera",{position:[10,5,-8],fov:45,near:.1,far:1e5},null,-1)),j(b(l),{enableDamping:""}),(f(),T(k,null,{default:g((()=>[j(z,{color:"#ff8b04"})])),_:1})),a[1]||(a[1]=w("TresAmbientLight",{intensity:2},null,-1)),a[2]||(a[2]=w("TresPointLight",{position:[0,0,10],intensity:1},null,-1)),a[3]||(a[3]=w("TresDirectionalLight",{position:[3,3,3],intensity:3},null,-1))])),_:1},16),j(b(N),null,{default:g((()=>[j(Q)])),_:1})],64)}}});export{B as default};
