import{importShared as e,GLTFLoader as a}from"./3d-tiles-renderer.qyEDeaaW1769484739493.js";import{defineStore as t,_export_sfc as o,TresCanvas_default as l,OrbitControls_default as r,Levioso_default as n,Backdrop_default as i}from"./index.CuW8EyFk1769484739493.js";import{DRACOLoader as s}from"./DRACOLoader.WDC6VPxj1769484739493.js";import{Pane as c}from"./tweakpane.BbuIEN141769484739493.js";import{useMessage as u,NMessageProvider as m}from"./use-message.02i7TXqw1769484739493.js";import{useDialog as d,NSpin as p,NUpload as f,NImage as v,NAlert as y,download as h,NDialogProvider as g}from"./Upload.Cz7SWjoe1769484739493.js";import{Button as w}from"./Button.Dm4b10Vv1769484739493.js";import{NCard as k}from"./Card.JT4TRoUg1769484739493.js";import{NSpace as x}from"./Space.gQHDSOGR1769484739493.js";import{NInput as b}from"./Input.4BgkSjFW1769484739493.js";const{ref:S}=await e("vue"),C=t("materialDiyStore",()=>{const e=S("MeshBasicMaterial");return{curState:S({}),curType:e,curModelArrayBuffer:S(null)}}),{defineComponent:_}=await e("vue"),{unref:B,resolveDynamicComponent:M,mergeProps:j,openBlock:T,createBlock:P}=await e("vue"),{computed:A}=await e("vue"),D=_({__name:"materialDiy",setup(e){const a=C(),t=A(()=>`Tres${a.curType}`);return(e,o)=>(T(),P(M(t.value),j(B(a).curState,{transparent:"",flatShading:""}),null,16))}});const{defineComponent:L}=await e("vue"),{createVNode:N,createElementVNode:z,openBlock:O,createElementBlock:R,createCommentVNode:E}=await e("vue"),U={key:0,scale:.5},V=["position","rotation","scale","geometry"],{ref:F,watch:I}=await e("vue"),G=L({__name:"model",setup(e){const t=F(null),o=C();return I(()=>o.curModelArrayBuffer,async e=>{if(e){const o=await async function(e){const t=new a,o=new s;return o.setDecoderPath("./draco/"),t.setDRACOLoader(o),new Promise((a,o)=>{t.parse(e,"",e=>{a(e)},e=>{console.error("GLB 加载失败:",e),o(e)})})}(e);t.value=o.scene.children[0].children[0]}else t.value=null},{immediate:!0}),(e,a)=>t.value?(O(),R("TresGroup",U,[z("TresMesh",{position:t.value.position,rotation:t.value.rotation,scale:t.value.scale,geometry:t.value.geometry,"cast-shadow":""},[N(D)],8,V)])):E("",!0)}}),J={MeshBasicMaterial:{default:{color:"#161cff",wireframe:!1,opacity:1},config:{color:{name:"颜色",com:"ColorPicker"},wireframe:{name:"线框",com:"Switch"},opacity:{name:"透明度",com:"Slider",min:0,max:1,step:.01}}},MeshLambertMaterial:{default:{color:"#3ef561",wireframe:!1,opacity:1},config:{color:{name:"颜色",com:"ColorPicker"},wireframe:{name:"线框",com:"Switch"},opacity:{name:"透明度",com:"Slider",min:0,max:1,step:.01}}},MeshPhysicalMaterial:{default:{color:"#e75ff5",metalness:.45,roughness:.36,transmission:.33,reflectivity:.5,ior:1.5,opacity:1},config:{color:{name:"颜色",com:"ColorPicker"},metalness:{name:"金属度",com:"Slider",min:0,max:1,step:.01},roughness:{name:"粗糙度",com:"Slider",min:0,max:1,step:.01},reflectivity:{name:"反射率",com:"Slider",min:0,max:1,step:.01},ior:{name:"折射率",com:"Slider",min:1,max:2.33,step:.01},transmission:{name:"透光率",com:"Slider",min:0,max:1,step:.01},opacity:{name:"透明度",com:"Slider",min:0,max:1,step:.01}}}},{defineComponent:$}=await e("vue"),q=$({__name:"setupUI",setup(e){const a=C(),t=new c({title:"参数",expanded:!0}),o=Object.keys(J),l=[];o.forEach(e=>{l.push({text:e,value:e})}),t.addBlade({view:"list",label:"材质类型",options:l,value:o[2]}).on("change",e=>{n(e.value)});let r=null;const n=e=>{const o=J[e];a.curType=e,a.curState=JSON.parse(JSON.stringify(o.default)),r&&r.dispose(),r=t.addFolder({title:"材质属性"}),Object.keys(o.config).forEach(e=>{"ColorPicker"===o.config[e].com||"Switch"===o.config[e].com?r.addBinding(a.curState,e,{label:o.config[e].name}):"Slider"===o.config[e].com&&r.addBinding(a.curState,e,{label:o.config[e].name,min:o.config[e].min,max:o.config[e].max,step:o.config[e].step})})};return n(o[2]),(e,a)=>null}}),{withAsyncContext:H}=await e("vue"),{unref:K,createVNode:Q,createElementVNode:W,openBlock:X,createElementBlock:Y,createCommentVNode:Z,toDisplayString:ee,createTextVNode:ae,withCtx:te,Fragment:oe}=await e("vue"),le={key:0,class:"upload-mask"},re={class:"upload-mask-content"},ne={class:"image-uploader-panel"},ie={style:{"margin-bottom":"6px","padding-bottom":"6px","border-bottom":"2px solid #5f5f5f","word-break":"break-all"}},se={key:0},ce={key:1},ue={style:{"margin-top":"10px"}},me={key:2},de={style:{"margin-top":"10px"}},pe={style:{"margin-left":"30px","margin-top":"10px"}},{ref:fe,h:ve}=await e("vue"),ye=o({__name:"leftImg",async setup(e){let a,t;const o=C();o.curModelArrayBuffer=([a,t]=H(()=>async function(e){try{const a=await fetch(e);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return await a.arrayBuffer()}catch(a){return console.error("读取失败:",a),null}}("./plugins/hunyuan3D/model/icegl-bm.glb")),a=await a,t(),a);const l=u(),r=fe(null),n=fe("https://cdn.index.icegl.cn/uploads/20221122/9ed6756107c4e0c031ae26d54cb46c0d.png"),i=fe(!0),s=fe(!1),c=d(),m=fe("http://localhost:8081/generate");function g({file:e}){r.value=e.file,n.value=URL.createObjectURL(e.file)}async function S(){if(r.value){s.value=!0;try{const a={image:await(e=r.value,new Promise((a,t)=>{const o=new FileReader;o.readAsDataURL(e),o.onload=()=>{const e=o.result.split(",")[1];a(e)},o.onerror=t}))},t=await fetch(m.value,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});o.curModelArrayBuffer=await t.arrayBuffer(),i.value=!0,l.success("传递接口成功，模型已生成")}catch(a){console.error(a),l.error("传递接口失败")}finally{s.value=!1}var e}}function _(){if(!o.curModelArrayBuffer)return void l.error("没有可下载的模型");const e=new Blob([o.curModelArrayBuffer],{type:"model/gltf-binary"}),a=URL.createObjectURL(e);h(a,"generated-model.glb"),URL.revokeObjectURL(a)}function B(){r.value=null,n.value="",i.value=!1,o.curModelArrayBuffer=null}const M=()=>{const e=fe(""),a=fe(m.value);c.create({title:"请输入混元3D服务地址:",content:()=>ve("div",{},[ve(b,{value:a.value,placeholder:"服务说明详见'说明'按钮",onInput:t=>{a.value=t,e.value=""}}),e.value&&ve(y,{type:"error",style:"margin-top: 8px"},{default:()=>e.value})]),positiveText:"确认",negativeText:"取消",maskClosable:!1,onPositiveClick:()=>a.value.trim()?(m.value=a.value.trim(),!0):(e.value="配置不能为空",!1)})},j=()=>{window.open("https://icegl.cn/ask/article/22765.html","_blank")};return(e,a)=>(X(),Y(oe,null,[s.value?(X(),Y("div",le,[W("div",re,[Q(K(p),{size:"large"}),a[0]||(a[0]=W("div",{class:"upload-text"},"模型生成中，请稍候...",-1))])])):Z("",!0),W("div",ne,[Q(K(k),{title:"参考图片生产3D",size:"small",class:"panel-card","header-style":{textAlign:"center"},style:{backgroundColor:"#1a1a1a",color:"#ffffff",border:"1px solid #444"}},{default:te(()=>[W("div",ie,[a[3]||(a[3]=W("span",null,"混元3D服务：",-1)),a[4]||(a[4]=W("br",null,null,-1)),W("span",null,ee(m.value?m.value:"未配置"),1),Q(K(x),{justify:"end"},{default:te(()=>[Q(K(w),{type:"primary",size:"tiny",onClick:M},{default:te(()=>[...a[1]||(a[1]=[ae(" 设置 ",-1)])]),_:1}),Q(K(w),{type:"info",size:"tiny",style:{"margin-right":"6px"},onClick:j},{default:te(()=>[...a[2]||(a[2]=[ae(" 说明 ",-1)])]),_:1})]),_:1})]),s.value||i.value?Z("",!0):(X(),Y("div",se,[Q(K(f),{"default-upload":!1,"show-file-list":!1,accept:"image/*",onChange:g},{default:te(()=>[Q(K(w),{type:"primary",size:"small"},{default:te(()=>[...a[5]||(a[5]=[ae("选择图片",-1)])]),_:1})]),_:1})])),r.value&&!i.value?(X(),Y("div",ce,[Q(K(v),{src:n.value,width:"100",height:"100","object-fit":"cover",style:{"margin-top":"10px"}},null,8,["src"]),W("div",ue,[Q(K(w),{type:"success",size:"small",loading:s.value,onClick:S},{default:te(()=>[...a[6]||(a[6]=[ae(" 提交 ",-1)])]),_:1},8,["loading"])])])):Z("",!0),i.value?(X(),Y("div",me,[a[9]||(a[9]=W("span",null,"参考图片：",-1)),a[10]||(a[10]=W("br",null,null,-1)),Q(K(v),{src:n.value,width:"100",height:"100","object-fit":"cover",style:{"margin-top":"10px"}},null,8,["src"]),Q(K(x),null,{default:te(()=>[W("div",de,[Q(K(w),{type:"info",size:"small",onClick:B},{default:te(()=>[...a[7]||(a[7]=[ae("重新生产",-1)])]),_:1})]),W("div",pe,[Q(K(w),{type:"success",size:"small",onClick:_},{default:te(()=>[...a[8]||(a[8]=[ae("下载模型",-1)])]),_:1})])]),_:1})])):Z("",!0)]),_:1})])],64))}},[["__scopeId","data-v-75b74eb7"]]),{defineComponent:he}=await e("vue"),{createElementVNode:ge,unref:we,createVNode:ke,withCtx:xe,mergeProps:be,Fragment:Se,openBlock:Ce,createElementBlock:_e}=await e("vue"),{SRGBColorSpace:Be,BasicShadowMap:Me,NoToneMapping:je}=await e("three"),{reactive:Te,ref:Pe,watchEffect:Ae}=await e("vue"),De=he({__name:"index",setup(e){const a=Te({clearColor:"#201919",shadows:!0,alpha:!1,shadowMapType:Me,outputColorSpace:Be,toneMapping:je}),t=Pe(null);return Ae(()=>{t.value&&(t.value.shadow.mapSize.width=1024,t.value.shadow.mapSize.height=1024,t.value.shadow.camera.near=.1,t.value.shadow.camera.far=10,t.value.shadow.camera.left=-1,t.value.shadow.camera.right=1,t.value.shadow.camera.top=1,t.value.shadow.camera.bottom=-1,t.value.shadow.bias=-1e-4)}),(e,o)=>(Ce(),_e(Se,null,[ke(we(l),be(a,{"window-size":""}),{default:xe(()=>[o[1]||(o[1]=ge("TresPerspectiveCamera",{position:[0,1,2],fov:45,near:.1,far:1e3},null,-1)),ke(we(r)),o[2]||(o[2]=ge("TresAmbientLight",{intensity:2},null,-1)),ke(we(n),null,{default:xe(()=>[ke(G)]),_:1}),ke(we(i),{floor:1,segments:20,position:[-.1,-.8,-.5],scale:[4,2,2],"receive-shadow":""},{default:xe(()=>[...o[0]||(o[0]=[ge("TresMeshPhysicalMaterial",{color:"orange",roughness:1,receiveShadow:""},null,-1)])]),_:1}),ge("TresDirectionalLight",{position:[1,1,2],intensity:6,"cast-shadow":"",ref_key:"tdl",ref:t},null,512)]),_:1},16),ke(q),ke(we(g),null,{default:xe(()=>[ke(we(m),null,{default:xe(()=>[ke(ye)]),_:1})]),_:1})],64))}});export{De as default};
