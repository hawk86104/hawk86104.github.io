import{importShared as E,mergeGeometries as ft}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{Fs as _t,_l as gt}from"./index.DTe2qqjO1767148983502.js";import{clamp as Y}from"./MathUtils.CinN5xAo1767148983502.js";import{LineGeometry as wt,Line2 as yt}from"./Line2.BNbNjiwa1767148983502.js";import{LineMaterial as vt}from"./LineSegments2.BWdpcsAi1767148983502.js";const at=(s,t)=>{const[e,n]=t.split("-");return Object.assign(s.style,{left:n==="left"?"0":n==="center"?"50%":"",right:n==="right"?"0":"",top:e==="top"?"0":e==="bottom"?"":"50%",bottom:e==="bottom"?"0":"",transform:`${n==="center"?"translateX(-50%)":""} ${e==="center"?"translateY(-50%)":""}`}),t},St=({placement:s,size:t,offset:e,id:n,className:i})=>{const o=document.createElement("div"),{top:l,left:a,right:r,bottom:p}=e;return Object.assign(o.style,{id:n,position:"absolute",zIndex:"1000",height:`${t}px`,width:`${t}px`,margin:`${l}px ${r}px ${p}px ${a}px`,borderRadius:"100%"}),at(o,s),n&&(o.id=n),i&&(o.className=i),o},bt=s=>{const t=typeof s=="string"?document.querySelector(s):s;if(!t)throw Error("Invalid DOM element");return t},{Vector3:Mt}=await E("three"),Et=[["x",0,3],["y",1,4],["z",2,5]],Z=new Mt;function J({isSphere:s},t,e){s&&(Z.set(0,0,1).applyQuaternion(e.quaternion),Et.forEach(([n,i,o])=>{const l=Z[n];let a=t[i],r=a.userData.opacity;a.material.opacity=Y(l>=0?r:r/2,0,1),a=t[o],r=a.userData.opacity,a.material.opacity=Y(l>=0?r/2:r,0,1)}))}const xt=(s,t,e=10)=>Math.abs(s.clientX-t.x)<e&&Math.abs(s.clientY-t.y)<e,{Vector2:Ct,Raycaster:kt}=await E("three"),K=new kt,tt=new Ct,et=(s,t,e,n)=>{tt.set((s.clientX-t.left)/t.width*2-1,-((s.clientY-t.top)/t.height)*2+1),K.setFromCamera(tt,e);const i=K.intersectObjects(n,!1),o=i.length?i[0]:null;return!o||!o.object.visible?null:o},I=1e-6,At=2*Math.PI,ct=["x","y","z"],B=[...ct,"nx","ny","nz"],$t=["right","top","front","left","bottom","back"],lt=1.3,nt=(s,t=!0)=>{const{material:e,userData:n}=s,{color:i,opacity:o}=t?n.hover:n;e.color.set(i),e.opacity=o},P=s=>JSON.parse(JSON.stringify(s)),Lt=s=>{const t=s.type||"sphere",e=t==="sphere",n=s.resolution||e?64:128,{container:i}=s;s.container=void 0,s=JSON.parse(JSON.stringify(s)),s.container=i,$t.forEach((r,p)=>{s[r]&&(s[B[p]]=s[r])});const o={enabled:!0,color:16777215,opacity:1,scale:.7,labelColor:2236962,line:!1,border:{size:0,color:14540253},hover:{color:e?16777215:9688043,labelColor:2236962,opacity:1,scale:.7,border:{size:0,color:14540253}}},l={line:!1,scale:e?.45:.7,hover:{scale:e?.5:.7}},a={type:t,container:document.body,size:128,placement:"top-right",resolution:n,lineWidth:20,radius:e?1:.2,smoothness:18,animated:!0,speed:1,background:{enabled:!0,color:e?16777215:14739180,opacity:e?0:1,hover:{color:e?16777215:14739180,opacity:e?.2:1}},font:{family:"sans-serif",weight:900},offset:{top:10,left:10,bottom:10,right:10},corners:{enabled:!e,color:e?15915362:16777215,opacity:1,scale:e?.15:.2,radius:1,smoothness:18,hover:{color:e?16777215:9688043,opacity:1,scale:e?.2:.225}},edges:{enabled:!e,color:e?15915362:16777215,opacity:e?1:0,radius:e?1:.125,smoothness:18,scale:e?.15:1,hover:{color:e?16777215:9688043,opacity:1,scale:e?.2:1}},x:{...P(o),...e?{label:"X",color:16725587,line:!0}:{label:"Right"}},y:{...P(o),...e?{label:"Y",color:9100032,line:!0}:{label:"Top"}},z:{...P(o),...e?{label:"Z",color:2920447,line:!0}:{label:"Front"}},nx:{...P(l),label:e?"":"Left"},ny:{...P(l),label:e?"":"Bottom"},nz:{...P(l),label:e?"":"Back"}};return z(s,a),ct.forEach(r=>z(s[`n${r}`],P(s[r]))),{...s,isSphere:e}};function z(s,...t){if(s instanceof HTMLElement||typeof s!="object"||s===null)return s;for(const e of t)for(const n in e)n!=="container"&&n in e&&(s[n]===void 0?s[n]=e[n]:typeof e[n]=="object"&&!Array.isArray(e[n])&&(s[n]=z(s[n]||{},e[n])));return s}const{CanvasTexture:Ot,Color:Pt,RepeatWrapping:st,SRGBColorSpace:Vt}=await E("three"),Tt=(s,t=2)=>{const e=new Pt,n=t*2,{isSphere:i,resolution:o,radius:l,font:a,corners:r,edges:p}=s,d=B.map(h=>({...s[h],radius:l}));i&&r.enabled&&d.push(r),i&&p.enabled&&d.push(p);const w=document.createElement("canvas"),c=w.getContext("2d");w.width=o*2+n*2,w.height=o*d.length+n*d.length;const[y,b]=F(d,o,a);d.forEach(({radius:h,label:g,color:L,labelColor:m,border:_,hover:{color:O,labelColor:x,border:k}},A)=>{const $=o*A+A*n+t;D(t,$,t,o,h,g,_,L,m),D(o+t*3,$,t,o,h,g,k??_,O??L,x??m)});const v=d.length,f=t/(o*2),u=t/(o*6),M=1/v,C=new Ot(w);return C.repeat.set(.5-2*f,M-2*u),C.offset.set(f,1-u),Object.assign(C,{colorSpace:Vt,wrapS:st,wrapT:st,userData:{offsetX:f,offsetY:u,cellHeight:M}}),C;function D(h,g,L,m,_,O,x,k,A){if(_=_*(m/2),k!=null&&k!==""&&($(),c.fillStyle=e.set(k).getStyle(),c.fill()),x&&x.size){const V=x.size*m/2;h+=V,g+=V,m-=x.size*m,_=Math.max(0,_-V),$(),c.strokeStyle=e.set(x.color).getStyle(),c.lineWidth=x.size*m,c.stroke()}O&&S(c,h+m/2,g+(m+L)/2,O,e.set(A).getStyle());function $(){c.beginPath(),c.moveTo(h+_,g),c.lineTo(h+m-_,g),c.arcTo(h+m,g,h+m,g+_,_),c.lineTo(h+m,g+m-_),c.arcTo(h+m,g+m,h+m-_,g+m,_),c.lineTo(h+_,g+m),c.arcTo(h,g+m,h,g+m-_,_),c.lineTo(h,g+_),c.arcTo(h,g,h+_,g,_),c.closePath()}}function F(h,g,L){const _=[...h].sort((q,mt)=>(q.label?.length||0)-(mt.label?.length||0)).pop().label,{family:O,weight:x}=L,k=i?Math.sqrt(Math.pow(g*.7,2)/2):g;let A=k,$=0,V=0;do{c.font=`${x} ${A}px ${O}`;const q=c.measureText(_);$=q.width,V=q.fontBoundingBoxDescent,A--}while($>k&&A>0);const N=k/V,ut=Math.min(k/$,N),dt=Math.floor(A*ut);return[`${x} ${dt}px ${O}`,N]}function S(h,g,L,m,_){h.font=y,h.textAlign="center",h.textBaseline="middle",h.fillStyle=_,h.fillText(m,g,L+(i?b:0))}},Dt=(s,t)=>s.offset.x=(t?.5:0)+s.userData.offsetX,Q=(s,t)=>{const{offset:e,userData:{offsetY:n,cellHeight:i}}=s;e.y=1-(t+1)*i+n},{BufferGeometry:Ft,BufferAttribute:H}=await E("three");function U(s,t,e=2,n=2){const i=e/2-s,o=n/2-s,l=s/e,a=(e-s)/e,r=s/n,p=(n-s)/n,d=[i,o,0,-i,o,0,-i,-o,0,i,-o,0],w=[a,p,l,p,l,r,a,r],c=[3*(t+1)+3,3*(t+1)+4,t+4,t+5,2*(t+1)+4,2,1,2*(t+1)+3,3,4*(t+1)+3,4,0],y=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11].map(S=>c[S]);let b,v,f,u,M,C,D,F;for(let S=0;S<4;S++){u=S<1||S>2?i:-i,M=S<2?o:-o,C=S<1||S>2?a:l,D=S<2?p:r;for(let h=0;h<=t;h++)b=Math.PI/2*(S+h/t),v=Math.cos(b),f=Math.sin(b),d.push(u+s*v,M+s*f,0),w.push(C+l*v,D+r*f),h<t&&(F=(t+1)*S+h+4,y.push(S,F,F+1))}return new Ft().setIndex(new H(new Uint32Array(y),1)).setAttribute("position",new H(new Float32Array(d),3)).setAttribute("uv",new H(new Float32Array(w),2))}const{Mesh:Rt,MeshBasicMaterial:Bt,Sprite:qt,SpriteMaterial:jt,Vector3:Gt}=await E("three"),It=(s,t)=>{const e=new Gt,{isSphere:n,radius:i,smoothness:o}=s,l=U(i,o);return B.map((a,r)=>{const p=r<3,d=B[r],w=r?t.clone():t;Q(w,r);const{enabled:c,scale:y,opacity:b,hover:v}=s[d],f={map:w,opacity:b,transparent:!0},u=n?new qt(new jt(f)):new Rt(l,new Bt(f)),M=p?d:d[1];return u.position[M]=(p?1:-1)*(n?lt:1),n||u.lookAt(e.copy(u.position).multiplyScalar(1.7)),u.scale.setScalar(y),u.renderOrder=1,u.visible=c,u.userData={scale:y,opacity:b,hover:v},u})},{Mesh:Ht,MeshBasicMaterial:Xt,Sprite:Wt,SpriteMaterial:Yt,Vector3:zt}=await E("three"),Qt=(s,t)=>{const{isSphere:e,corners:n}=s;if(!n.enabled)return[];const{color:i,opacity:o,scale:l,radius:a,smoothness:r,hover:p}=n,d=e?null:U(a,r),w={transparent:!0,opacity:o},c=[1,1,1,-1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,-1,-1,-1,-1,-1].map(b=>b*.85),y=new zt;return Array(c.length/3).fill(0).map((b,v)=>{if(e){const M=t.clone();Q(M,6),w.map=M}else w.color=i;const f=e?new Wt(new Yt(w)):new Ht(d,new Xt(w)),u=v*3;return f.position.set(c[u],c[u+1],c[u+2]),e&&f.position.normalize().multiplyScalar(1.7),f.scale.setScalar(l),f.lookAt(y.copy(f.position).multiplyScalar(2)),f.renderOrder=1,f.userData={color:i,opacity:o,scale:l,hover:p},f})},{Mesh:Ut,MeshBasicMaterial:Nt,Sprite:Zt,SpriteMaterial:Jt,Vector3:Kt}=await E("three"),te=(s,t,e)=>{const{isSphere:n,edges:i}=s;if(!i.enabled)return[];const{color:o,opacity:l,scale:a,hover:r,radius:p,smoothness:d}=i,w=n?null:U(p,d,1.2,.25),c={transparent:!0,opacity:l},y=[0,1,1,0,-1,1,1,0,1,-1,0,1,0,1,-1,0,-1,-1,1,0,-1,-1,0,-1,1,1,0,1,-1,0,-1,1,0,-1,-1,0].map(v=>v*.925),b=new Kt;return Array(y.length/3).fill(0).map((v,f)=>{if(n){const C=t.clone();Q(C,e),c.map=C}else c.color=o;const u=n?new Zt(new Jt(c)):new Ut(w,new Nt(c)),M=f*3;return u.position.set(y[M],y[M+1],y[M+2]),n&&u.position.normalize().multiplyScalar(1.7),u.scale.setScalar(a),u.lookAt(b.copy(u.position).multiplyScalar(2)),!n&&!u.position.y&&(u.rotation.z=Math.PI/2),u.renderOrder=1,u.userData={color:o,opacity:l,scale:a,hover:r},u})},{BackSide:ee,Mesh:it,MeshBasicMaterial:ne,SphereGeometry:se}=await E("three"),ie=(s,t)=>{const{isSphere:e,background:{enabled:n,color:i,opacity:o,hover:l}}=t;let a;const r=new ne({color:i,side:ee,opacity:o,transparent:!0,depthWrite:!1});if(!n)return null;if(e)a=new it(new se(1.8,64,64),r);else{let p;s.forEach(d=>{const w=d.scale.x;d.scale.setScalar(.9),d.updateMatrix();const c=d.geometry.clone();c.applyMatrix4(d.matrix),p=p?ft([p,c]):c,d.scale.setScalar(w)}),a=new it(p,r)}return a.userData={color:i,opacity:o,hover:l},a},{Color:oe,Vector2:re}=await E("three"),ae=s=>{const t=new oe,e=[],n=[],{isSphere:i}=s;if(B.forEach((a,r)=>{const{enabled:p,line:d,scale:w,color:c}=s[a];if(!p||!d)return;const y=r<3?1:-1,v=(i?lt-w/2:.975)*y;e.push(a.includes("x")?v:0,a.includes("y")?v:0,a.includes("z")?v:0,0,0,0);const f=t.set(c).toArray();n.push(...f,...f)}),!e.length)return null;const o=new wt().setPositions(e).setColors(n),l=new vt({linewidth:s.lineWidth,vertexColors:!0,resolution:new re(window.innerWidth,window.innerHeight)});return new yt(o,l).computeLineDistances()},ce=s=>{const{corners:t,edges:e}=s,n=[],i=Tt(s),o=It(s,i);n.push(...o),t.enabled&&n.push(...Qt(s,i)),e.enabled&&n.push(...te(s,i,t.enabled?7:6));const l=ie(o,s),a=ae(s);return[n,l,a]},R=(s,t=!0)=>{const{material:e,userData:n}=s,{opacity:i,color:o,scale:l}=t?n.hover:n;s.scale.setScalar(l),e.opacity=i,e.map?Dt(e.map,t):e.color.set(o)},{Clock:le,Matrix4:he,Object3D:pe,OrthographicCamera:ue,PerspectiveCamera:de,Quaternion:X,Spherical:ht,Vector2:pt,Vector3:G,Vector4:W}=await E("three"),T=new he,me=new ht,ot=new G,fe=new pt;class _e extends pe{constructor(t,e,n={}){super(),this.type="ViewportGizmo",this.enabled=!0,this.target=new G,this.animated=!0,this.speed=1,this.animating=!1,this._background=null,this._viewport=new W,this._originalViewport=new W,this._originalScissor=new W,this._dragging=!1,this._distance=0,this._clock=new le,this._targetPosition=new G,this._targetQuaternion=new X,this._quaternionStart=new X,this._quaternionEnd=new X,this._pointerStart=new pt,this._focus=null,this.camera=t,this.renderer=e,this.set(n)}get placement(){return this._placement}set placement(t){this._placement=at(this._domElement,t),this.domUpdate()}set(t={}){this.dispose(),this.options=t,this._options=Lt(t),this._camera=this._options.isSphere?new ue(-1.8,1.8,1.8,-1.8,5,10):new de(26,1,5,10),this._camera.position.set(0,0,7);const[e,n,i]=ce(this._options);n&&this.add(n),i&&this.add(i),this.add(...e),this._background=n,this._intersections=e;const{container:o,animated:l,speed:a}=this._options;return this.animated=l,this.speed=a,this._container=o?bt(o):document.body,this._domElement=St(this._options),this._domElement.onpointerdown=r=>this._onPointerDown(r),this._domElement.onpointermove=r=>this._onPointerMove(r),this._domElement.onpointerleave=()=>this._onPointerLeave(),this._container.appendChild(this._domElement),this._controls&&this.attachControls(this._controls),this.update(),this}render(){this.animating&&this._animate();const{renderer:t,_viewport:e}=this,n=t.getScissorTest(),i=t.autoClear;return t.autoClear=!1,t.setViewport(e),n&&t.setScissor(e),t.clear(!1,!0,!1),t.render(this,this._camera),t.setViewport(this._originalViewport),n&&t.setScissor(this._originalScissor),t.autoClear=i,this}domUpdate(){this._domRect=this._domElement.getBoundingClientRect();const t=this.renderer,e=this._domRect,n=t.domElement.getBoundingClientRect();return this._viewport.set(e.left-n.left,t.domElement.clientHeight-(e.top-n.top+e.height),e.width,e.height),t.getViewport(this._originalViewport),t.getScissorTest()&&t.getScissor(this._originalScissor),this}cameraUpdate(){return this._updateOrientation(),this}update(t=!0){return t&&this._controls&&this._controls.update(),this.domUpdate().cameraUpdate()}attachControls(t){return this.detachControls(),this.target=t.target,this._controlsListeners={start:()=>t.enabled=!1,end:()=>t.enabled=!0,change:()=>this.update(!1)},this.addEventListener("start",this._controlsListeners.start),this.addEventListener("end",this._controlsListeners.end),t.addEventListener("change",this._controlsListeners.change),this._controls=t,this}detachControls(){if(!(!this._controlsListeners||!this._controls))return this.target=new G().copy(this._controls.target),this.removeEventListener("start",this._controlsListeners.start),this.removeEventListener("end",this._controlsListeners.end),this._controls.removeEventListener("change",this._controlsListeners.change),this._controlsListeners=void 0,this._controls=void 0,this}dispose(){this.detachControls(),this.children.forEach(t=>{this.remove(t);const e=t;e.material?.dispose(),e.material?.map?.dispose(),e.geometry?.dispose()}),this._domElement?.remove()}_updateOrientation(t=!0){t&&(this.quaternion.copy(this.camera.quaternion).invert(),this.updateMatrixWorld()),J(this._options,this._intersections,this.camera)}_animate(){const{position:t,quaternion:e}=this.camera;if(t.set(0,0,1),!this.animated){t.applyQuaternion(this._quaternionEnd).multiplyScalar(this._distance).add(this.target),e.copy(this._targetQuaternion),this._updateOrientation(),this.animating=!1,this.dispatchEvent({type:"change"}),this.dispatchEvent({type:"end"});return}const i=this._clock.getDelta()*At*this.speed;this._quaternionStart.rotateTowards(this._quaternionEnd,i),t.applyQuaternion(this._quaternionStart).multiplyScalar(this._distance).add(this.target),e.rotateTowards(this._targetQuaternion,i),this._updateOrientation(),requestAnimationFrame(()=>this.dispatchEvent({type:"change"})),this._quaternionStart.angleTo(this._quaternionEnd)<I&&(this.animating=!1,this.dispatchEvent({type:"end"}))}_setOrientation(t){const e=this.camera,n=this.target;this._targetPosition.copy(t).multiplyScalar(this._distance),T.setPosition(this._targetPosition).lookAt(this._targetPosition,this.position,this.up),this._targetQuaternion.setFromRotationMatrix(T),this._targetPosition.add(n),T.lookAt(this._targetPosition,n,this.up),this._quaternionEnd.setFromRotationMatrix(T),T.setPosition(e.position).lookAt(e.position,n,this.up),this._quaternionStart.setFromRotationMatrix(T),this.animating=!0,this._clock.start(),this.dispatchEvent({type:"start"})}_onPointerDown(t){if(!this.enabled)return;const e=a=>{if(!this._dragging){if(xt(a,this._pointerStart))return;this._dragging=!0}const r=fe.set(a.clientX,a.clientY).sub(this._pointerStart).multiplyScalar(1/this._domRect.width*Math.PI),p=me.setFromVector3(ot.subVectors(this.camera.position,this.target));p.theta=o-r.x,p.phi=Y(l-r.y,I,Math.PI-I),this.camera.position.setFromSpherical(p).add(this.target),this.camera.lookAt(this.target),this.quaternion.copy(this.camera.quaternion).invert(),this._updateOrientation(!1),this.dispatchEvent({type:"change"})},n=()=>{if(document.removeEventListener("pointermove",e,!1),document.removeEventListener("pointerup",n,!1),!this._dragging)return this._handleClick(t);this._focus&&(R(this._focus,!1),this._focus=null),this._dragging=!1,this.dispatchEvent({type:"end"})};if(this.animating)return;t.preventDefault(),this._pointerStart.set(t.clientX,t.clientY);const i=new ht().setFromVector3(ot.subVectors(this.camera.position,this.target)),o=i.theta,l=i.phi;this._distance=i.radius,document.addEventListener("pointermove",e,!1),document.addEventListener("pointerup",n,!1),this.dispatchEvent({type:"start"})}_onPointerMove(t){!this.enabled||this._dragging||(this._background&&nt(this._background,!0),this._handleHover(t))}_onPointerLeave(){!this.enabled||this._dragging||(this._background&&nt(this._background,!1),this._focus&&R(this._focus,!1),this._domElement.style.cursor="")}_handleClick(t){const e=et(t,this._domRect,this._camera,this._intersections);this._focus&&(R(this._focus,!1),this._focus=null),e&&(this._setOrientation(e.object.position),this.dispatchEvent({type:"change"}))}_handleHover(t){const n=et(t,this._domRect,this._camera,this._intersections)?.object||null;this._focus!==n&&(this._domElement.style.cursor=n?"pointer":"",this._focus&&R(this._focus,!1),(this._focus=n)?R(n,!0):J(this._options,this._intersections,this.camera))}}const{defineComponent:ge}=await E("vue"),{watch:rt,toRaw:j,useAttrs:we}=await E("vue"),Ee=ge({__name:"viewportGizmo",setup(s){const{camera:t,controls:e,renderer:n,sizes:i}=_t(),o=we(),l={...j(o)},a=new _e(j(t.value),j(n),l);rt(()=>e.value,p=>{p&&(a.attachControls(j(p)),console.log("gizmo attached to controls"))},{immediate:!0}),rt([i.width,i.height],()=>{a.update()},{immediate:!0});const{onRender:r}=gt();return r(()=>{a.render()},1),(p,d)=>null}});export{Ee as _sfc_main};
