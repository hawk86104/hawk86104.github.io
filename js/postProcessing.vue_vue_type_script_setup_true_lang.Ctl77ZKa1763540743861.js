import{F as e,_ as r}from"./@tresjs.BCHtwiaC1763540743861.js";import{d as n,w as t}from"./@vue.Co_gxueH1763540743861.js";import{H as a,O as v,a0 as u,n as l,o as s,q as o,x as i}from"./three.rXKzP9fQ1763540743861.js";const m=n({__name:"postProcessing",props:{use:{default:!0},start:{default:0},translate:{default:0}},setup(n){const m=n,{camera:c,renderer:d,scene:f,sizes:p}=e(),g=new a(p.width.value,p.height.value);let w=new a(p.width.value,p.height.value),x=new a(p.width.value,p.height.value);const h=new v(-1,1,1,-1,0,1);h.position.z=1;const U=new u,_=new l(new s(2,2),new o({uniforms:{current:{value:null},prev:{value:null},start:{value:m.start},time:{value:0},translate:{value:m.translate}},vertexShader:"\n        varying vec2 vUv;\n        void main(){\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n            ",fragmentShader:"\n        uniform sampler2D current;\n        uniform sampler2D prev;\n        uniform float start;\n        uniform float time;\n        uniform float translate;\n        varying vec2 vUv;\n        void main(){\n            float PI = 3.14159265359;\n            vec2 uv = vUv;\n            uv -= vec2(0.5);\n            uv *= vec2(2., 1.);\n            uv.y += translate;\n            uv /= 4.;\n            \n            uv.x += sin(uv.y * PI * 4. + time*0.3)*0.15;\n            uv.x += sin(uv.y * PI * 16. + time*0.5)*0.15;\n\n            uv += vec2(0.5);\n\n            uv = mix(vUv,uv, start);\n\n            vec4 currentColor = texture2D(current, uv);\n            vec4 prevColor = texture2D(prev,vUv);\n\n            vec4 color = vec4(mix( prevColor.rgb, currentColor.rgb, 0.05), 1.0);\n            gl_FragColor = color;\n            //gl_FragColor = vec4(vUv, 0.0, 1.0);\n    }"}));U.add(_);const y=new u,C=new l(new s(2,2),new i({color:16777215,map:null}));y.add(C);const{onBeforeRender:j,onRender:P}=r();return j(({elapsed:e})=>{_.material.uniforms.time.value=e}),P(()=>{if(m.use){d.setRenderTarget(g),d.render(f.value,c.value),_.material.uniforms.current.value=g.texture,_.material.uniforms.prev.value=w.texture,d.setRenderTarget(x),d.render(U,h),C.material.map=w.texture,d.setRenderTarget(null),d.render(y,h);const e=w;w=x,x=e,d.render(U,h)}else d.render(f.value,c.value)}),t(()=>[m.start,m.translate],([e,r])=>{_.material.uniforms.start.value=e,_.material.uniforms.translate.value=r}),(e,r)=>null}});export{m as _};
