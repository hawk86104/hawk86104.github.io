import{i as e}from"./3d-tiles-renderer.CbgZh8zU1767066396612.js";import{n as t}from"./@tresjs.B1f7s3pS1767066396612.js";const r=await e("three"),{defineComponent:a}=await e("vue"),{createElementVNode:o,normalizeProps:n,guardReactiveProps:l,openBlock:u,createElementBlock:s}=await e("vue"),d=["rotation-x"],h=["args"],i=await e("three"),{watch:m,ref:v}=await e("vue"),p=a({__name:"whiteFloorMesh",props:{size:{default:[20,20]},color:{default:"#990"},shadowColor:{default:"#999"},edge:{default:.35}},setup(e){const a=e,p=v(),{state:f}=t("./plugins/floor/image/whiteFloor.jpg"),g={uniforms:i.UniformsUtils.merge([i.UniformsLib.lights,{uColor:{value:new i.Color(a.color)},uShadowColor:{value:new i.Color(a.shadowColor)},fEdge:{value:a.edge},uTexture:{value:null}}]),side:i.DoubleSide,vertexShader:`\n       varying vec2 vUv;\n\t\t\t \t${r.ShaderChunk.common}\n      \t${r.ShaderChunk.bsdfs}\n      \t${r.ShaderChunk.shadowmap_pars_vertex}\n       void main() {\n\t\t\t\t\t${r.ShaderChunk.beginnormal_vertex}\n          ${r.ShaderChunk.defaultnormal_vertex}\n          ${r.ShaderChunk.begin_vertex}\n          ${r.ShaderChunk.project_vertex}\n          ${r.ShaderChunk.worldpos_vertex}\n          ${r.ShaderChunk.shadowmap_vertex}\n\n           gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);    \n           vUv = uv;\n       }`,fragmentShader:`\n\tvarying vec2 vUv;\n\tuniform sampler2D uTexture;\n\tuniform vec3 uShadowColor;\n\tuniform vec3 uColor;\n\tuniform float fEdge;\n\t// ShaderMaterial 下的 纹理参数重复无效 要在着色器中增加\n\tfloat repeatTime = 100.0;\n\n\tfloat smoothsteps(float t) {\n\t\t\treturn t * t * (3.0 - 2.0 * t);\n\t}\n\n\t ${r.ShaderChunk.common}\n\t ${r.ShaderChunk.packing}\n\t ${r.ShaderChunk.bsdfs}\n\t ${r.ShaderChunk.lights_pars_begin}\n\t ${r.ShaderChunk.shadowmap_pars_fragment}\n\t ${r.ShaderChunk.shadowmask_pars_fragment}\n\n\tvoid main() {\n\t\t\tvec4 col = texture2D(uTexture, vUv * repeatTime);\n\t\t\tcol.rgb = mix( uColor , col.rgb ,0.5);\n\t\t\t\n\t\t\tfloat alpha = 1.0;\n\t\t\tfloat d = length(vUv - vec2(0.5));\n\t\t\tif(d > 0.35) {\n\t\t\t\t\talpha = 1.0 - smoothsteps( clamp( (d - 0.35) / (fEdge-0.2), 0.0, 1.0) );\n\t\t\t}\n\n\t\t vec3 addShadow = mix( uShadowColor , col.rgb ,getShadowMask());\n\n\t\t\tgl_FragColor = vec4(addShadow, alpha);  \n\t}`,lights:!0,transparent:!0};return m(f,e=>{e&&(e.wrapS=i.RepeatWrapping,e.wrapT=i.RepeatWrapping,e.repeat.set(6,3),p.value.material.uniforms.uTexture.value=e)}),m(()=>a.edge,e=>{g.uniforms.fEdge.value=e}),m(()=>a.color,e=>{g.uniforms.uColor.value=new i.Color(a.color)}),m(()=>a.shadowColor,e=>{g.uniforms.uShadowColor.value=new i.Color(a.shadowColor)}),(e,t)=>(u(),s("TresMesh",{ref_key:"tmRef",ref:p,"rotation-x":-Math.PI/2},[o("TresPlaneGeometry",{args:a.size},null,8,h),o("TresShaderMaterial",n(l(g)),null,16)],8,d))}});export{p as _};
