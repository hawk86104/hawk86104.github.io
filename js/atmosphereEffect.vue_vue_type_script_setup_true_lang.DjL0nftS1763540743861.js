import{F as e,_ as a}from"./@tresjs.BCHtwiaC1763540743861.js";import{c as s,d as r,f as o,T as t,h as n,i}from"./postprocessing.51l5tmA-1763540743861.js";import{C as c,E as p,b as l,X as m,a as u,F as d,L as w,c as h,u as f,U as y,N as g,O as v}from"./@takram.DcJcNz4v1763540743861.js";import{d as T,a as x,w as S,a9 as M,H as j,o as D,J as G,u as E,F}from"./@vue.Co_gxueH1763540743861.js";import{V as P,M as B,a5 as W}from"./three.rXKzP9fQ1763540743861.js";const _=["material"],k=T({__name:"atmosphereEffect",setup(T){const k=x(),{controls:N,camera:b,scene:C,renderer:O}=e();O.depth=!1;const R=new Date("2000-06-01T10:00:00Z"),U=new c(0,p(60),1e3).toECEF(),z=new P,I=new P,V=(new P).copy(U).multiplyScalar(-1),X=l.WGS84.getSurfaceNormal(U);l.WGS84.getEastNorthUpVectors(U,z,I,X);const q=(new B).makeBasis(I,X,z).invert();S(()=>N.value,e=>{e&&(b.value?.position.copy(U),b.value?.up.copy(X),M(e)?.target.copy(U))},{immediate:!0});const A=new m,H=new u,J=new d({distance:30});J.target.position.copy(U),J.castShadow=!0,J.shadow.camera.top=300,J.shadow.camera.bottom=-300,J.shadow.camera.left=-300,J.shadow.camera.right=300,J.shadow.camera.near=0,J.shadow.camera.far=600,J.shadow.mapSize.width=2048,J.shadow.mapSize.height=2048,J.shadow.normalBias=1,S(()=>k.value,e=>{e&&l.WGS84.getEastNorthUpFrame(U).decompose(e.position,e.quaternion,e.scale)});const K=new w(b.value),Z=new s(O,{frameBufferType:W,multisampling:8});Z.addPass(new r(C.value,b.value)),Z.addPass(new o(b.value)),Z.addPass(new o(b.value,new h,K,new t({mode:n.AGX}),new f)),null!=Z&&Z.passes.forEach(e=>{e.fullscreenMaterial instanceof i&&e.fullscreenMaterial.adoptCameraSettings(b.value)}),(new y).setTypeFromRenderer(O).load("./plugins/useThreeGeospatial/exr/",function(e){Object.assign(A,e),J.transmittanceTexture=e.transmittanceTexture,H.irradianceTexture=e.irradianceTexture,Object.assign(K,e),K.skyIrradiance=!0,K.sunIrradiance=!0});const{onBeforeRender:L}=a(),Q=new P,Y=new P,$=new B;return L(({elapsed:e})=>{const a=+R+5e6*e%864e5;g(a,Q),v(a,Y),A.sunDirection.copy(Q),A.moonDirection.copy(Y),J.sunDirection.copy(Q),H.sunDirection.copy(Q),K.sunDirection.copy(Q),K.sunDirection.copy(Q),K.moonDirection.copy(Y),$.copy(k.value.matrixWorld).setPosition(0,0,0),q.copy($),V.setFromMatrixPosition(k.value.matrixWorld).applyMatrix4($.invert()),K.ellipsoid.radii.copy(V),J.update(),H.update(),Z.render()}),(e,a)=>(D(),j(F,null,[G("TresMesh",{frustumCulled:!1,material:E(A)},[...a[0]||(a[0]=[G("TresPlaneGeometry",{args:[2,2]},null,-1)])],8,_),G("TresGroup",{ref_key:"tgRef",ref:k},[...a[1]||(a[1]=[G("TresMesh",{castShadow:"",receiveShadow:""},[G("TresTorusKnotGeometry",{args:[200,60,256,64]}),G("TresMeshBasicMaterial",{color:"white"})],-1)])],512)],64))}});export{k as _};
