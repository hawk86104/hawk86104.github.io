var z=Object.defineProperty;var I=(s,t,e)=>t in s?z(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var u=(s,t,e)=>(I(s,typeof t!="symbol"?t+"":t,e),e);import{au as M,av as w,a1 as W,ak as L,az as b,bk as R,b3 as f,a6 as U,w as _,o as x,c as P,L as Z,a9 as j,ad as E,a2 as k,aq as A,a4 as D,a5 as G,r as O,a as v,E as y,a8 as C,G as F,x as N,ag as Q}from"./vendor.QQYnRAOM1715675014296.js";import{u as V,a as B}from"./utils.lL21jvBF1715675014296.js";import{U as Y,b as q,c as T,M as H,P as $,a as J,T as K,O as X,d as g,r as ee}from"./raycasterEvent.EFvt8aCT1715675014296.js";import"./vanilla.VDl6tfU91715675014296.js";import"./ExtensionUtilities.VnPGpOcf1715675014296.js";import"./_commonjsHelpers.5-cIlDoe1715675014296.js";import"./_commonjs-dynamic-modules.h-SxKiO41715675014296.js";function te(s){return new Worker(""+new URL("../static/MartiniWorker-8mf_OiU3.js",import.meta.url).href,{name:s==null?void 0:s.name})}class oe{constructor(){u(this,"maxZoom",12);u(this,"coordType",Y);u(this,"utmZone",50);u(this,"_worker");u(this,"_useWorker",!0);u(this,"source","https://api.maptiler.com/tiles/terrain-rgb-v2/[z]/[x]/[y].webp?key=L55MtSxL94Yb4hQeWewp")}set useWorker(t){var e;this._useWorker=t,this._useWorker||((e=this._worker)==null||e.terminate(),this._worker=void 0)}get useWorker(){return this._useWorker}async getTile(t){return this._useWorker?this.getInWorkerThread(t):this.getInMainThread()}async getInMainThread(){return new M}async getInWorkerThread(t){this._worker||(this._worker=new q(te));const e={tileNo:t,id:this.getId(t),url:this.getUrl(t),maxZ:this.maxZoom,coordType:this.coordType,utmZone:this.utmZone},r=await this._worker.postMessage(e),n=new M;return n.setAttribute("position",new w(r.positions,3)),n.setAttribute("uv",new w(r.uv,2)),n.setIndex(new w(r.triangles,1)),n}async abort(t){var e;this._useWorker&&((e=this._worker)==null||e.postMessage({id:this.getId(t),abort:!0}))}async dispose(t,e){var r;e.dispose(),this._useWorker&&((r=this._worker)==null||r.postMessage({id:this.getId(t),dispose:!0}))}getId(t){return t.join("-")}getUrl(t){const[e,r,n]=t;return this.source.replace("[x]",e+"").replace("[y]",r+"").replace("[z]",n+"")}}const re=["object","rotation"],ae=W({__name:"tileMapMesh",props:{bbox:{default:[104.955976,20.149765,120.998419,30.528687]},maxZoom:{default:20},opposite:{type:Boolean,default:!1},genBright:{default:1},genContrast:{default:1},genSaturation:{default:1},monochrome:{default:"#fff"},isMonochrome:{type:Boolean,default:!1},mapCenter:{}},setup(s,{expose:t}){const e=s,{renderer:r,scene:n}=L(),c=new $;c.coordType=T;const m=new oe;m.source="https://api.maptiler.com/tiles/terrain-rgb-v2/[z]/[x]/[y].webp?key=L55MtSxL94Yb4hQeWewp",m.coordType=T;const d=new J;d.source="https://webrd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",d.showTileNo=!1,d.useWorker=!0;const o=new K(m,d);if(o.showBoundingBox=!1,o.wireframe=!1,o.flatShading=!1,o.useStandardMaterial=!1,o.filter={opposite:e.opposite,monochrome:e.isMonochrome?{r:.299,g:.587,b:.114}:null,genBright:e.genBright,genContrast:e.genContrast,genSaturation:e.genSaturation},e.monochrome){let i=new b(e.monochrome);o.filter&&(o.filter.monochrome={r:i.r,g:i.g,b:i.b})}const l=new H;l.provider=o,l.bbox=e.bbox,l.maxZoom=e.maxZoom;const a=new R(60,window.innerWidth/window.innerHeight,1,1e7*10);a.up=new f(0,1,0),a.position.set(e.mapCenter[0],e.mapCenter[2],-e.mapCenter[1]),a.lookAt(new f(a.position.x,0,a.position.z-2e3)),l.camera=a;let p=null;U(()=>{if(r.value&&!p&&(p=new X(a,r.value.domElement),p.enableDamping=!0,p.dampingFactor=.05,p.minDistance=600,p.position0.set(a.position.x,a.position.y,a.position.z),p.target.set(a.position.x,0,a.position.z-2e3)),e.genBright&&o.filter&&(o.filter.genBright=e.genBright),e.genContrast&&o.filter&&(o.filter.genContrast=e.genContrast),e.genSaturation&&o.filter&&(o.filter.genSaturation=e.genSaturation),e.isMonochrome&&e.monochrome&&o.filter){let i=new b(e.monochrome);o.filter.monochrome={r:i.r,g:i.g,b:i.b}}}),_(()=>e.opposite,i=>{o.filter&&(o.filter.opposite=i)}),_(()=>e.isMonochrome,i=>{let h=new b(e.monochrome);o.filter&&(o.filter.monochrome=i?{r:h.r,g:h.g,b:h.b}:null)});const{onLoop:S}=j();return S(()=>{if(r.value){V(),p&&p.update(),l.update();const i=Math.abs(a.position.y)*50;a.far=i+5e3,a.updateProjectionMatrix(),p.target.y=0,r.value.render(n.value,a)}}),t({camera:a,map:l,orbitControl:p}),(i,h)=>(x(),P("primitive",{object:Z(l),rotation:[-Math.PI/2,0,0]},null,8,re))}}),de=W({__name:"tileMap",setup(s){const t=g(118.779958,32.017136),e=[t[0],t[1],5e3],r=E(),n=k({opposite:!0,genBright:1.3,genContrast:1,genSaturation:1,isMonochrome:!0,monochrome:"#4688b5",mapCenter:e}),c=new A({title:"参数"});c.addBinding(n,"opposite",{label:"反色"}),c.addBinding(n,"genBright",{label:"高亮",min:.1,max:3,step:.1}),c.addBinding(n,"genContrast",{label:"对比度",min:.1,max:3,step:.1}),c.addBinding(n,"genSaturation",{label:"饱和度",min:.1,max:3,step:.1}),c.addBinding(n,"isMonochrome",{label:"单色滤镜"}),c.addBinding(n,"monochrome",{label:"滤镜颜色"});const m={at:g(118.7425,31.9998),xjk:g(118.7842,32.0418),nss:g(118.7503,31.9082)};c.addBlade({view:"list",label:"飞去",options:[{text:"奥体中心",value:"at"},{text:"新街口",value:"xjk"},{text:"牛首山",value:"nss"}],value:"at"}).on("change",o=>{const l=new f(m[o.value][0],2e3,-m[o.value][1]);B(r.value.camera,l,r.value.orbitControl,[0,-300],4e3)});const d=k({clearColor:"#201919",antialias:!0,logarithmicDepthBuffer:!0,disableRender:!0,outputColorSpace:D,toneMapping:G,precision:"highp"});return setTimeout(()=>{const o=m.at,l=new f(o[0],1600,-o[1]);B(r.value.camera,l,r.value.orbitControl,[-2e3,-2e3],2e3)},1e3),(o,l)=>{const a=O("TresCanvas");return x(),P(F,null,[v(a,C(d,{"window-size":""}),{default:y(()=>[(x(),N(Q,null,{default:y(()=>[v(ae,C(n,{ref_key:"tileMapMeshRef",ref:r,bbox:[80,16,128,50]}),null,16)]),_:1}))]),_:1},16),v(ee,{tileMapRef:r.value},null,8,["tileMapRef"])],64)}}});export{de as default};
