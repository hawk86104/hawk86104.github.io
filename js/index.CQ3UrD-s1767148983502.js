import{importShared as s,GLTFLoader as G}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{defineStore as J,_export_sfc as q,ol as H,Kk as K,yk as Q,Gz as W}from"./index.DTe2qqjO1767148983502.js";import{DRACOLoader as X}from"./DRACOLoader.s6KPdFgO1767148983502.js";import{Pane as Y}from"./tweakpane.BQRZXf8M1767148983502.js";import{useMessage as Z,NMessageProvider as ee}from"./use-message.BBJznJob1767148983502.js";import{useDialog as te,NSpin as oe,NUpload as ae,NImage as V,NAlert as re,download as ne,NDialogProvider as le}from"./Upload.CVcof9m-1767148983502.js";import{Button as w}from"./Button.DslW6U6X1767148983502.js";import{NCard as ie}from"./Card.CLGorf6I1767148983502.js";import{NSpace as L}from"./Space.ugCFVeji1767148983502.js";import{NInput as se}from"./Input.FhrARThI1767148983502.js";const{ref:T}=await s("vue"),D=J("materialDiyStore",()=>{const p=T("MeshBasicMaterial"),t=T({}),o=T(null);return{curState:t,curType:p,curModelArrayBuffer:o}}),{defineComponent:ce}=await s("vue"),{unref:ue,resolveDynamicComponent:me,mergeProps:de,openBlock:fe,createBlock:pe}=await s("vue"),{computed:ve}=await s("vue"),ge=ce({__name:"materialDiy",setup(p){const t=D(),o=ve(()=>`Tres${t.curType}`);return(r,a)=>(fe(),pe(me(o.value),de(ue(t).curState,{transparent:"",flatShading:""}),null,16))}});async function _e(p){try{const t=await fetch(p);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.arrayBuffer()}catch(t){return console.error("读取失败:",t),null}}async function ye(p){const t=new G,o=new X;return o.setDecoderPath("./draco/"),t.setDRACOLoader(o),new Promise((r,a)=>{t.parse(p,"",l=>{r(l)},l=>{console.error("GLB 加载失败:",l),a(l)})})}const{defineComponent:we}=await s("vue"),{createVNode:he,createElementVNode:Ce,openBlock:xe,createElementBlock:be,createCommentVNode:Se}=await s("vue"),Be={key:0,scale:.5},ke=["position","rotation","scale","geometry"],{ref:Ne,watch:Me}=await s("vue"),$e=we({__name:"model",setup(p){const t=Ne(null),o=D();return Me(()=>o.curModelArrayBuffer,async r=>{if(r){const a=await ye(r);t.value=a.scene.children[0].children[0]}else t.value=null},{immediate:!0}),(r,a)=>t.value?(xe(),be("TresGroup",Be,[Ce("TresMesh",{position:t.value.position,rotation:t.value.rotation,scale:t.value.scale,geometry:t.value.geometry,"cast-shadow":""},[he(ge)],8,ke)])):Se("",!0)}}),A={MeshBasicMaterial:{default:{color:"#161cff",wireframe:!1,opacity:1},config:{color:{name:"颜色",com:"ColorPicker"},wireframe:{name:"线框",com:"Switch"},opacity:{name:"透明度",com:"Slider",min:0,max:1,step:.01}}},MeshLambertMaterial:{default:{color:"#3ef561",wireframe:!1,opacity:1},config:{color:{name:"颜色",com:"ColorPicker"},wireframe:{name:"线框",com:"Switch"},opacity:{name:"透明度",com:"Slider",min:0,max:1,step:.01}}},MeshPhysicalMaterial:{default:{color:"#e75ff5",metalness:.45,roughness:.36,transmission:.33,reflectivity:.5,ior:1.5,opacity:1},config:{color:{name:"颜色",com:"ColorPicker"},metalness:{name:"金属度",com:"Slider",min:0,max:1,step:.01},roughness:{name:"粗糙度",com:"Slider",min:0,max:1,step:.01},reflectivity:{name:"反射率",com:"Slider",min:0,max:1,step:.01},ior:{name:"折射率",com:"Slider",min:1,max:2.33,step:.01},transmission:{name:"透光率",com:"Slider",min:0,max:1,step:.01},opacity:{name:"透明度",com:"Slider",min:0,max:1,step:.01}}}},{defineComponent:De}=await s("vue"),Te=De({__name:"setupUI",setup(p){const t=D(),o=new Y({title:"参数",expanded:!0}),r=Object.keys(A),a=[];r.forEach(c=>{a.push({text:c,value:c})}),o.addBlade({view:"list",label:"材质类型",options:a,value:r[2]}).on("change",c=>{_(c.value)});let l=null;const _=c=>{const n=A[c];t.curType=c,t.curState=JSON.parse(JSON.stringify(n.default)),l&&l.dispose(),l=o.addFolder({title:"材质属性"}),Object.keys(n.config).forEach(d=>{n.config[d].com==="ColorPicker"||n.config[d].com==="Switch"?l.addBinding(t.curState,d,{label:n.config[d].name}):n.config[d].com==="Slider"&&l.addBinding(t.curState,d,{label:n.config[d].name,min:n.config[d].min,max:n.config[d].max,step:n.config[d].step})})};return _(r[2]),(c,n)=>null}}),{withAsyncContext:Pe}=await s("vue"),{unref:u,createVNode:m,createElementVNode:f,openBlock:S,createElementBlock:B,createCommentVNode:M,toDisplayString:Ve,createTextVNode:h,withCtx:v,Fragment:Le}=await s("vue"),Ae={key:0,class:"upload-mask"},Ee={class:"upload-mask-content"},ze={class:"image-uploader-panel"},Fe={style:{"margin-bottom":"6px","padding-bottom":"6px","border-bottom":"2px solid #5f5f5f","word-break":"break-all"}},Re={key:0},Oe={key:1},Ue={style:{"margin-top":"10px"}},Ie={key:2},je={style:{"margin-top":"10px"}},Ge={style:{"margin-left":"30px","margin-top":"10px"}},{ref:y,h:P}=await s("vue"),Je={__name:"leftImg",async setup(p){let t,o;const r=D();r.curModelArrayBuffer=([t,o]=Pe(()=>_e("./plugins/hunyuan3D/model/icegl-bm.glb")),t=await t,o(),t);const a=Z(),l=y(null),_=y("https://cdn.index.icegl.cn/uploads/20221122/9ed6756107c4e0c031ae26d54cb46c0d.png"),c=y(!0),n=y(!1),d=te(),x=y("http://localhost:8081/generate");function E({file:i}){l.value=i.file,_.value=URL.createObjectURL(i.file)}function z(i){return new Promise((e,b)=>{const N=new FileReader;N.readAsDataURL(i),N.onload=()=>{const j=N.result.split(",")[1];e(j)},N.onerror=b})}async function F(){if(l.value){n.value=!0;try{const e={image:await z(l.value)},b=await fetch(x.value,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});r.curModelArrayBuffer=await b.arrayBuffer(),c.value=!0,a.success("传递接口成功，模型已生成")}catch(i){console.error(i),a.error("传递接口失败")}finally{n.value=!1}}}function R(){if(!r.curModelArrayBuffer){a.error("没有可下载的模型");return}const i=new Blob([r.curModelArrayBuffer],{type:"model/gltf-binary"}),e=URL.createObjectURL(i);ne(e,"generated-model.glb"),URL.revokeObjectURL(e)}function O(){l.value=null,_.value="",c.value=!1,r.curModelArrayBuffer=null}const U=()=>{const i=y(""),e=y(x.value);d.create({title:"请输入混元3D服务地址:",content:()=>P("div",{},[P(se,{value:e.value,placeholder:"服务说明详见'说明'按钮",onInput:b=>{e.value=b,i.value=""}}),i.value&&P(re,{type:"error",style:"margin-top: 8px"},{default:()=>i.value})]),positiveText:"确认",negativeText:"取消",maskClosable:!1,onPositiveClick:()=>e.value.trim()?(x.value=e.value.trim(),!0):(i.value="配置不能为空",!1)})},I=()=>{window.open("https://icegl.cn/ask/article/22765.html","_blank")};return(i,e)=>(S(),B(Le,null,[n.value?(S(),B("div",Ae,[f("div",Ee,[m(u(oe),{size:"large"}),e[0]||(e[0]=f("div",{class:"upload-text"},"模型生成中，请稍候...",-1))])])):M("",!0),f("div",ze,[m(u(ie),{title:"参考图片生产3D",size:"small",class:"panel-card","header-style":{textAlign:"center"},style:{backgroundColor:"#1a1a1a",color:"#ffffff",border:"1px solid #444"}},{default:v(()=>[f("div",Fe,[e[3]||(e[3]=f("span",null,"混元3D服务：",-1)),e[4]||(e[4]=f("br",null,null,-1)),f("span",null,Ve(x.value?x.value:"未配置"),1),m(u(L),{justify:"end"},{default:v(()=>[m(u(w),{type:"primary",size:"tiny",onClick:U},{default:v(()=>[...e[1]||(e[1]=[h(" 设置 ",-1)])]),_:1}),m(u(w),{type:"info",size:"tiny",style:{"margin-right":"6px"},onClick:I},{default:v(()=>[...e[2]||(e[2]=[h(" 说明 ",-1)])]),_:1})]),_:1})]),!n.value&&!c.value?(S(),B("div",Re,[m(u(ae),{"default-upload":!1,"show-file-list":!1,accept:"image/*",onChange:E},{default:v(()=>[m(u(w),{type:"primary",size:"small"},{default:v(()=>[...e[5]||(e[5]=[h("选择图片",-1)])]),_:1})]),_:1})])):M("",!0),l.value&&!c.value?(S(),B("div",Oe,[m(u(V),{src:_.value,width:"100",height:"100","object-fit":"cover",style:{"margin-top":"10px"}},null,8,["src"]),f("div",Ue,[m(u(w),{type:"success",size:"small",loading:n.value,onClick:F},{default:v(()=>[...e[6]||(e[6]=[h(" 提交 ",-1)])]),_:1},8,["loading"])])])):M("",!0),c.value?(S(),B("div",Ie,[e[9]||(e[9]=f("span",null,"参考图片：",-1)),e[10]||(e[10]=f("br",null,null,-1)),m(u(V),{src:_.value,width:"100",height:"100","object-fit":"cover",style:{"margin-top":"10px"}},null,8,["src"]),m(u(L),null,{default:v(()=>[f("div",je,[m(u(w),{type:"info",size:"small",onClick:O},{default:v(()=>[...e[7]||(e[7]=[h("重新生产",-1)])]),_:1})]),f("div",Ge,[m(u(w),{type:"success",size:"small",onClick:R},{default:v(()=>[...e[8]||(e[8]=[h("下载模型",-1)])]),_:1})])]),_:1})])):M("",!0)]),_:1})])],64))}},qe=q(Je,[["__scopeId","data-v-75b74eb7"]]),{defineComponent:He}=await s("vue"),{createElementVNode:$,unref:C,createVNode:g,withCtx:k,mergeProps:Ke,Fragment:Qe,openBlock:We,createElementBlock:Xe}=await s("vue"),{SRGBColorSpace:Ye,BasicShadowMap:Ze,NoToneMapping:et}=await s("three"),{reactive:tt,ref:ot,watchEffect:at}=await s("vue"),pt=He({__name:"index",setup(p){const t=tt({clearColor:"#201919",shadows:!0,alpha:!1,shadowMapType:Ze,outputColorSpace:Ye,toneMapping:et}),o=ot(null);return at(()=>{o.value&&(o.value.shadow.mapSize.width=1024,o.value.shadow.mapSize.height=1024,o.value.shadow.camera.near=.1,o.value.shadow.camera.far=10,o.value.shadow.camera.left=-1,o.value.shadow.camera.right=1,o.value.shadow.camera.top=1,o.value.shadow.camera.bottom=-1,o.value.shadow.bias=-1e-4)}),(r,a)=>(We(),Xe(Qe,null,[g(C(H),Ke(t,{"window-size":""}),{default:k(()=>[a[1]||(a[1]=$("TresPerspectiveCamera",{position:[0,1,2],fov:45,near:.1,far:1e3},null,-1)),g(C(K)),a[2]||(a[2]=$("TresAmbientLight",{intensity:2},null,-1)),g(C(Q),null,{default:k(()=>[g($e)]),_:1}),g(C(W),{floor:1,segments:20,position:[-.1,-.8,-.5],scale:[4,2,2],"receive-shadow":""},{default:k(()=>[...a[0]||(a[0]=[$("TresMeshPhysicalMaterial",{color:"orange",roughness:1,receiveShadow:""},null,-1)])]),_:1}),$("TresDirectionalLight",{position:[1,1,2],intensity:6,"cast-shadow":"",ref_key:"tdl",ref:o},null,512)]),_:1},16),g(Te),g(C(le),null,{default:k(()=>[g(C(ee),null,{default:k(()=>[g(qe)]),_:1})]),_:1})],64))}});export{pt as default};
