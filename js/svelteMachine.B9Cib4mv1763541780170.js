import{F as e,_ as t,K as s,d as n}from"./@tresjs.MD0a_GHJ1763541780170.js";import{l as o,a as i}from"./utils.0CyeRs4M1763541780170.js";import{a8 as r,T as a,I as c,M as p,V as l,bA as u,f as d,cy as h}from"./three.F31Lz30M1763541780170.js";import{d as m,G as v,o as g,F as j,I as y,ac as f,a as b,q as w,h as z,u as x,r as _,w as E,e as P,b as D,ah as M,a9 as S,aa as A}from"./@vue.D9fSGD371763541780170.js";import"./@fesjs.DD9azIsJ1763541780170.js";import"./Resource.Cw8OnALu1763541780170.js";/* empty css                                                                             */import{l as L}from"./cssLoaders.DR-JB9KJ1763541780170.js";import"./three-mesh-ui.module.D3gU0ixQ1763541780170.js";import"./global.NituJV0f1763541780170.js";/* empty css                                                              */import"./shapeConfigurator.vue_vue_type_style_index_1_scoped_abbf0cc1_lang.D34gkB8O1763541780170.js";import"./postprocessing.CQ_CcmSv1763541780170.js";import"./@vueuse.C5rlNtd31763541780170.js";import"./jszip.DlMTIJ0v1763541780170.js";import"./@amap.fjyZdsU91763541780170.js";import"./file-saver.BHBnwLpy1763541780170.js";import"./vue-router.Bt0PFAN11763541780170.js";import"./lodash-es.DWe8oqPO1763541780170.js";import"./pinia.CbQiAydb1763541780170.js";import"./@qlin.y-0Z8WnK1763541780170.js";import"./@babel.BPq7uOAK1763541780170.js";import"./@floating-ui.Bhq4ibgf1763541780170.js";import"./@juggle.Vc7cP4_P1763541780170.js";import"./utils.C6G49BqD1763541780170.js";import"./color.CKhTNrTY1763541780170.js";import"./color-string.Cyg2_hFL1763541780170.js";import"./color-name.gyPnsvCn1763541780170.js";import"./lodash.BdjyYiRW1763541780170.js";import"./object-hash.Bg6hZt921763541780170.js";window.THREE=a;const k={scene:null,renderer:null,camera:null,sizes:null},R={get renderer(){return k.renderer?.value},loader:new r,get scene(){return k.scene?.value},get camera(){return k.camera?.value},get width(){return k.sizes?.width?.value},get height(){return k.sizes?.height?.value},get dom(){return k.renderer?.value.domElement.parentElement},get canvas(){return k.renderer?.value.domElement},events:{},init(e,t,s,n){k.scene=e,k.renderer=t,k.camera=s,k.sizes=n},load(e){const t={"1d0e8871-bd60-47f9-8ab7-232dabd30201":[{name:"SpotLightEvent",source:"this.shadow.mapSize.width = 1024 * 2\nthis.shadow.mapSize.height = 1024 * 2\nthis.shadow.camera.near = 1\nthis.shadow.camera.far = 10\nthis.shadow.bias = -0.0075\nthis.shadow.radius = 24\nthis.target.position.copy(this.position.clone().setY(0))\nfunction update( event ) {}"}],"beea1423-1e37-47ab-9443-f8429259e120":[{name:"dirb",source:"this.shadow.mapSize.width = 1024 * 2\nthis.shadow.mapSize.height = 1024 * 2\nthis.shadow.camera.near = 1\nthis.shadow.camera.far = 50\nthis.shadow.camera.top = 80\nthis.shadow.camera.bottom = -80\nthis.shadow.camera.left = -80\nthis.shadow.camera.right = 80\nthis.shadow.radius = 24\nthis.shadow.bias = -0.0075\nfunction update( event ) {}"}],"31517222-A9A7-4EAF-B5F6-60751C0BABA3":[{name:"senceScirpt",source:"this.environment.mapping = THREE.EquirectangularReflectionMapping;\nthis.environment.colorSpace = THREE.SRGBColorSpace;\nfunction update( event ) {}"}]};this.events={init:[],start:[],stop:[],keydown:[],keyup:[],pointerdown:[],pointerup:[],pointermove:[],update:[]};let s="player,renderer,scene,camera";const n={};for(const i in this.events)s+=`,${i}`,n[i]=i;const o=JSON.stringify(n).replace(/\"/g,"");for(const i in t){let n=i;i===e.uuid&&(n=this.scene.uuid);const r=this.scene.getObjectByProperty("uuid",n,!0);if(void 0===r){console.warn("player: Script without object.",n);continue}const a=t[i];for(let e=0;e<a.length;e++){const t=a[e],n=new Function(s,`${t.source}\nreturn ${o};`).bind(r)(this,this.renderer,this.scene,this.camera);for(const e in n)void 0!==n[e]&&(void 0!==this.events[e]?this.events[e].push(n[e].bind(r)):console.warn("player: Event type not supported (",e,")"))}this.dispatch(this.events.init,arguments)}},dispatch(e,t){for(let s=0,n=e.length;s<n;s++)e[s](t)},setCamera(e){console.warn("暂时不考虑摄像机的设置函数",e)},setScene(e){console.warn("暂时不考虑场景的设置函数",e)},setPixelRatio(e){console.warn("暂时不考虑像素比的设置函数",e)},setSize(e){console.warn("暂时不考虑尺寸的设置函数",e)},dispose(){console.warn("暂时不考虑释放资源的函数")},onKeyDown(e){R.dispatch(R.events.keydown,e)},onKeyUp(e){R.dispatch(R.events.keyup,e)},onPointerDown(e){R.dispatch(R.events.pointerdown,e)},onPointerUp(e){R.dispatch(R.events.pointerup,e)},onPointerMove(e){R.dispatch(R.events.pointermove,e)},play(){document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp),document.addEventListener("pointerdown",this.onPointerDown),document.addEventListener("pointerup",this.onPointerUp),document.addEventListener("pointermove",this.onPointerMove),this.dispatch(this.events.start,null)},stop(){document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("pointerdown",this.onPointerDown),document.removeEventListener("pointerup",this.onPointerUp),document.removeEventListener("pointermove",this.onPointerMove),this.dispatch(this.events.stop,arguments)},render(e,t){this.dispatch(this.events.update,{time:e,delta:t})}};const C=function(e){const t=e.points,s=[];for(const o of t){const e=o.x,t=o.y,n=o.z;s.unshift(new l(e,t,n))}const n=new u(s);return n.closed=e.closed,n}({points:[{x:-16.017528533935547,y:2.4581613540649414,z:53.098697662353516},{x:-11.40013599395752,y:2.4513251781463623,z:43.62754821777344},{x:-7.9051361083984375,y:2.4462289810180664,z:36.4436149597168},{x:-5.53253173828125,y:2.442873001098633,z:31.546899795532227},{x:-4.282320976257324,y:2.4412572383880615,z:28.937395095825195},{x:-3.9756288528442383,y:2.4410974979400635,z:28.24086570739746},{x:-3.7963345050811768,y:2.4410974979400635,z:27.74983024597168},{x:-3.6438193321228027,y:2.4410974979400635,z:27.253768920898438},{x:-3.5180840492248535,y:2.4410974979400635,z:26.75269317626953},{x:-3.419203519821167,y:2.4411063194274902,z:26.243703842163086},{x:-3.3517673015594482,y:2.4416656494140625,z:25.55027961730957},{x:-3.318483829498291,y:2.4430952072143555,z:24.5682430267334},{x:-3.319352865219116,y:2.445394515991211,z:23.297592163085938},{x:-3.354374647140503,y:2.448564052581787,z:21.73832893371582},{x:-3.4121222496032715,y:2.4521596431732178,z:19.611284255981445},{x:-3.461057662963867,y:2.454956293106079,z:16.145946502685547},{x:-3.49935245513916,y:2.456882953643799,z:11.297648429870605},{x:-3.5270066261291504,y:2.457939386367798,z:5.066390037536621},{x:-3.544764518737793,y:2.4581613540649414,z:-2.423649311065674},{x:-3.565464973449707,y:2.4581613540649414,z:-9.03036880493164},{x:-3.5937604904174805,y:2.4581613540649414,z:-13.977668762207031},{x:-3.629650592803955,y:2.4581613540649414,z:-17.265522003173828},{x:-3.673135280609131,y:2.4581613540649414,z:-18.893949508666992},{x:-3.7082104682922363,y:2.4581613540649414,z:-19.473438262939453},{x:-3.7077581882476807,y:2.4581613540649414,z:-20.038450241088867},{x:-3.6713337898254395,y:2.4581613540649414,z:-20.605941772460938},{x:-3.5989370346069336,y:2.4581613540649414,z:-21.175914764404297},{x:-3.3510568141937256,y:2.4581613540649414,z:-22.262161254882812},{x:-1.7961064577102661,y:2.4581615924835205,z:-28.032060623168945},{x:1.3139424324035645,y:2.4581618309020996,z:-39.39905548095703},{x:5.9790754318237305,y:2.458162546157837,z:-56.36309814453125},{x:12.19931411743164,y:2.458163261413574,z:-78.92425537109375}],closed:!1}),B=new p;const K=["object"],U=["object"],O=["object"],T=["object"],F=["object"],$=["object"],W=["object"],q=m({__name:"firstLevel-bf61e255d699",props:{object:{}},setup(s){const n=s,{scene:o}=e(),i=function(e){const t=C.points.length/2,s=new c(e.geometry,e.material,t);s.userData={progresses:[]};for(let n=0;n<t;n++){const e=n/(t-1),o=C.getPointAt(e);s.userData.progresses[n]=e,B.setPosition(o),s.setMatrixAt(n,B)}return s}(n.object[1]);o.value.add(i);const r=function(e){const t=[];t.push(e[2].clone()),t.push(e[4].clone()),t.push(e[5].clone()),t.push(e[2].clone()),t.push(e[5].clone()),t.push(e[4].clone()),t.push(e[2].clone()),t.push(e[4].clone());for(let s=0;s<t.length;s++){const e=s/t.length*.6;t[s].userData={progress:e};const n=C.getPointAt(e);t[s].position.copy(n),t[s].visible=!0}return t}(n.object),a=new d;a.position.set(0,1,0),a.add(...r),o.value.add(a);const p=function(e){const t=[];for(let s=0;s<6;s++){t.push(e[3].clone());const n=1-s/6*.4-.04;t[s].userData={progress:n};const o=C.getPointAt(n);t[s].position.copy(o),t[s].visible=!0}return t}(n.object),l=new d;l.add(...p),l.position.set(0,1,0),o.value.add(l);const{onBeforeRender:u}=t();return u(({delta:e,elapsed:t})=>{i&&function(e){const t=e.userData.progresses;for(let s=0;s<e.count;s++){const n=C.getPointAt(t[s]);B.setPosition(n),e.setMatrixAt(s,B),t[s]+=5e-4,t[s]>1&&(t[s]=0)}e.instanceMatrix.needsUpdate=!0,e.computeBoundingSphere()}(i),r&&function(e){for(let t=0;t<e.length;t++){e[t].userData.progress+=5e-4,e[t].userData.progress>.6&&(e[t].userData.progress=0);const s=e[t].userData.progress,n=C.getPointAt(s);"flat_item"===e[t].name&&(n.y=1.5),e[t].position.copy(n)}}(r),p&&function(e){for(let t=0;t<e.length;t++){e[t].userData.progress+=5e-4,e[t].userData.progress>1&&(e[t].userData.progress=1-5/6*.4-.04);const s=e[t].userData.progress,n=C.getPointAt(s);e[t].position.copy(n)}}(p)}),(e,t)=>(g(),v(j,null,[y("primitive",{object:e.object[0]},null,8,K),y("primitive",{object:e.object[1],visible:!1},null,8,U),y("primitive",{object:e.object[2]},null,8,O),y("primitive",{object:e.object[4]},null,8,T),y("primitive",{object:e.object[5]},null,8,F),y("primitive",{object:e.object[6]},null,8,$),y("primitive",{object:e.object[3]},null,8,W)],64))}}),G=["object"],H=["object"],I=["object"],J=["object"],N=["object"],Y=m({__name:"scene",async setup(s){let n,r;const{scene:a,renderer:c,camera:p,sizes:l}=e();R.init(a,c,p,l);const u=new h,d=([n,r]=f(()=>o("./plugins/tresEditor/svelteMachine/json/scene.json")),n=await n,r(),n);if(d.geometries)for(const e of d.geometries)if(e.data&&e.data.startsWith("url:")){let t=e.data.slice(4);t.startsWith("geometries/")&&(t=`./plugins/tresEditor/svelteMachine/${t}`),e.data=([n,r]=f(()=>o(t)),n=await n,r(),n)}if(d.images)for(const e of d.images)if(e.url&&e.url.startsWith("url:")){let t=e.url.slice(4);t.startsWith("images/")&&(t=`./plugins/tresEditor/svelteMachine/${t}`),e.url=([n,r]=f(()=>i(t)),n=await n,r(),n)}const m=u.parse(d),_=b(null);w(()=>{if(a.value.background=m.background,a.value.environment=m.environment,a.value.fog=m.fog,R.load(m),R.play(),_.value){const e=_.value;e.target.position.set(-3.8,0,-2.3),a.value.add(e.target),e.angle=Math.PI/2.5}});const{onBeforeRender:E}=t();return E(({delta:e,elapsed:t})=>{if(R.renderer&&R.render(1e3*t,1e3*e),_.value){_.value.intensity=100+100*Math.sin(2*t)}}),(e,t)=>(g(),v(j,null,[y("primitive",{object:x(m).children[0]},[z(q,{object:x(m).children[0].children},null,8,["object"])],8,G),y("primitive",{object:x(m).children[1]},null,8,H),y("primitive",{object:x(m).children[2]},null,8,I),y("primitive",{object:x(m).children[3]},null,8,J),y("primitive",{object:x(m).children[4],ref_key:"spotLightRef",ref:_},null,8,N)],64))}}),V=m({__name:"svelteMachine",setup(e){const t=_({clearColor:"#201919",windowSize:!0,antialias:!0,shadows:!0,shadowMapType:2,toneMapping:3,toneMappingExposure:1.75}),o=(new h).parse({metadata:{version:4.6,type:"Object",generator:"Object3D.toJSON"},object:{type:"PerspectiveCamera",name:"Camera",layers:1,matrix:[-.6267758441936044,-27755575615628914e-33,.7791996157182023,0,.48061725621232265,.787112942007701,.3866009176850464,0,-.6133181019392243,.6168088978962458,-.49334337870258826,0,-80.48773984917322,89.13969162136891,-91.54490099940386,1],up:[0,1,0],fov:50,zoom:1,near:.01,far:1e3,focus:10,aspect:1.1063238359972203,filmGauge:35,filmOffset:0}}),i=b(null);return E(()=>i.value,e=>{e.copy(o)}),(e,o)=>(g(),v(j,null,[z(x(L)),z(x(n),S(A(t)),{default:P(()=>[z(x(s)),y("TresPerspectiveCamera",{ref_key:"cameraRef",ref:i,uuid:"9ca45c84-3c16-48da-b0a2-9e469abea3d1",name:"Camera"},null,512),(g(),D(M,null,{default:P(()=>[z(Y)]),_:1}))]),_:1},16)],64))}});export{V as default};
