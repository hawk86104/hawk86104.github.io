import{m as t,e,D as n,a as s,t as o}from"./@tresjs.DYJWvbJh1744075368226.js";import"./index.BIncEoWp1744075368226.js";import{T as r,aI as a,c as i,a8 as l,a as u,M as c,S as p,V as f,B as m,l as d,ce as g}from"./three.Cqu7jvck1744075368226.js";import{P as v}from"./tweakpane.C0HtAJSg1744075368226.js";import{I as h,C as y,N as j,c as b,d as w,a as _}from"./three-mesh-bvh.Bnn-Sjcc1744075368226.js";import{d as x,a5 as T,b as I,a3 as M,H as k,o as L,F as A,J as C,u as O,r as B,h as S,j as X,f as z,e as R,m as U,am as Y}from"./@vue.DK6ok9LJ1744075368226.js";import{_ as P}from"./randomLoading.vue_vue_type_script_setup_true_lang.CtBOLq8Y1744075368226.js";import"./postprocessing.BQUpsS8o1744075368226.js";import"./@vueuse.3dpzNfMJ1744075368226.js";import"./utils.0DhvBX0O1744075368226.js";import"./@fesjs.DVzkLEh_1744075368226.js";import"./vue-router.CdB5-8IK1744075368226.js";import"./lodash-es.BOsRjQhS1744075368226.js";import"./@qlin.q6OWdsQV1744075368226.js";import"./pinia.BwN9Gs_m1744075368226.js";import"./@babel.BPq7uOAK1744075368226.js";import"./@floating-ui.BFjFSAYt1744075368226.js";import"./@juggle.CcBCnTIR1744075368226.js";import"./three-mesh-ui.module.DuejKpER1744075368226.js";import"./starLoading.S1P78AfB1744075368226.js";import"./cssLoaders.pCgg1DN31744075368226.js";import"./bubbleLoading.Ec5gYJ241744075368226.js";import"./yangyangLoading.wLt5sO-61744075368226.js";function Z(t,e){const n=H();return Z=function(t,e){return n[t-=274]},Z(t,e)}!function(){const t=Z,e=H();for(;;)try{if(785719===-parseInt(t(296))/1*(parseInt(t(323))/2)+-parseInt(t(319))/3*(parseInt(t(312))/4)+parseInt(t(280))/5+parseInt(t(284))/6*(parseInt(t(311))/7)+parseInt(t(289))/8+parseInt(t(320))/9*(-parseInt(t(303))/10)+parseInt(t(313))/11*(parseInt(t(279))/12))break;e.push(e.shift())}catch(n){e.push(e.shift())}}();const E=function(){let t=!0;return function(e,n){const s=t?function(){if(n){const t=n[Z(288)](e,arguments);return n=null,t}}:function(){};return t=!1,s}}();!function(){E(this,(function(){const t=Z,e=new RegExp(t(290)),n=new RegExp(t(306),"i"),s=W(t(301));e.test(s+"chain")&&n[t(277)](s+t(318))?W():s("0")}))()}();const F=function(){let t=!0;return function(e,n){const s=t?function(){if(n){const t=n[Z(288)](e,arguments);return n=null,t}}:function(){};return t=!1,s}}();F(void 0,(function(){const t=Z;let e;try{e=Function(t(292)+t(298)+");")()}catch(o){e=window}const n=e[t(308)]=e.console||{},s=["log",t(299),t(314),t(297),t(291),t(283),"trace"];for(let r=0;r<s[t(286)];r++){const e=F.constructor[t(294)][t(278)](F),o=s[r],a=n[o]||e;e[t(295)]=F.bind(F),e[t(324)]=a[t(324)][t(278)](a),n[o]=e}}))();function H(){const t=["init","constructor","10odVOjT","call","pointerType","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","debu","console","pointerdown","pointermove","4510037SYDUfA","3811076dOexUs","11ImPjsX","info","addEventListener","counter","Raycaster","input","3rPyzoo","13337937NukOOY","clientX","button","1193154CIxlGQ","toString","gger","innerWidth","string","test","bind","15190284LxnMMM","6410610iBUKJj","value","setFromCamera","table","6jhvgbf","stateObject","length","intersectObject","apply","9770920Pvcnuu","function *\\( *\\)","exception","return (function() ","clientY","prototype","__proto__","2mdDKlt","error",'{}.constructor("return this")( )',"warn","while (true) {}"];return(H=function(){return t})()}function W(t){function e(t){const n=Z;if(typeof t===n(276))return function(t){}[n(302)](n(300))[n(288)](n(316));1!==(""+t/t)[n(286)]||t%20==0?function(){return!0}[n(302)](n(307)+"gger")[n(304)]("action"):function(){return!1}[n(302)](n(307)+n(274))[n(288)](n(285)),e(++t)}try{if(t)return e;e(0)}catch(n){}}const D=["geometry","material"],J=["geometry"],N=x({__name:"model",props:{controls:{}},async setup(s){let o,x;const B=s;m.prototype.computeBoundsTree=b,m.prototype.disposeBoundsTree=w,d.prototype.raycast=_;const S=([o,x]=T((()=>n(g,"./plugins/industry4/model/TR12J_OCC.stl"))),o=await o,x(),o),X=new a({color:16777215,roughness:.2,metalness:1,vertexColors:!0}),z=new Uint8Array(3*S.attributes.position.count);z.fill(255);const R=new i(z,3,!0);R.setUsage(l),S.setAttribute("color",R);const U=I(null),Y=I(null),P=I(!1),E=I(-1),F=I(.2),H=new u,{camera:W,raycaster:N}=t(),V=15/255,G=78/255,K=85/255;let Q=null;M((()=>{U.value&&(console.log("targetMesh.value init",U.value),U.value.geometry.computeBoundsTree(),Q=S.boundsTree,((t,e,n,s,o,a)=>{const i=Z;window.addEventListener(i(310),(n=>{const s=i;t.x=n.clientX/window[s(275)]*2-1,t.y=-n[s(293)]/window.innerHeight*2+1,e.value=!0})),window[i(315)](i(309),(l=>{const u=i;t.x=l[u(321)]/window.innerWidth*2-1,t.y=-l[u(293)]/window.innerHeight*2+1,s[u(281)]=l[u(322)];const c=new(r[u(317)]);c[u(282)](t,n[u(281)]),c.firstHitOnly=!0;const p=c[u(287)](o[u(281)],!0);e[u(281)]=!0,a.enabled=0===p[u(286)]}),!0),window.addEventListener("pointerup",(t=>{const n=i;s[n(281)]=-1,"touch"===t[n(305)]&&(e[n(281)]=!1)}),!0)})(H,P,W,E,U,B.controls.instance))}));const{onLoop:$}=e();$((()=>{const t=S.index;if(Y.value)if(B.controls.instance.active||!P.value)Y.value.visible=!1;else{Y.value.scale.setScalar(F.value),N.value.setFromCamera(H,W.value),N.value.firstHitOnly=!0;const e=N.value.intersectObject(U.value,!0);if(e.length){Y.value.position.copy(e[0].point),B.controls.instance.enabled=!1,Y.value.visible=!0;const n=new c;n.copy(U.value.matrixWorld).invert();const s=new p;s.center.copy(Y.value.position).applyMatrix4(n),s.radius=100*F.value;const o=[],r=new f;if(Q?.shapecast({intersectsBounds:t=>{const e=s.intersectsBox(t),{min:n,max:o}=t;if(e){for(let t=0;t<=1;t++)for(let e=0;e<=1;e++)for(let a=0;a<=1;a++)if(r.set(0===t?n.x:o.x,0===e?n.y:o.y,0===a?n.z:o.z),!s.containsPoint(r))return h;return y}return e?h:j},intersectsTriangle:(t,e,n)=>{if(n||t.intersectsSphere(s)){const t=3*e;o.push(t,t+1,t+2)}return!1}}),0===E.value||2===E.value){let e=1,n=1,s=1;0===E.value&&(e=V,n=G,s=K);for(let r=0,a=o.length;r<a;r++){const a=t.getX(o[r]);R.setX(a,e),R.setY(a,n),R.setZ(a,s)}R.needsUpdate=!0}}else Y.value.visible=!1,B.controls.instance.enabled=!0}}));const q=(new v).addButton({title:"点击按钮",label:"生成模型"}),tt=new m;return q.on("click",(()=>{const t=[],e=[];for(let s=0;s<R.count;s++)R.getX(s)===V&&R.getY(s)===G&&R.getZ(s)===K&&(t.push(S.attributes.position.getX(s),S.attributes.position.getY(s),S.attributes.position.getZ(s)),e.push(S.attributes.normal.getX(s),S.attributes.normal.getY(s),S.attributes.normal.getZ(s)));const n=new Float32Array(t);tt.setAttribute("position",new i(n,3)),tt.setAttribute("normal",new i(n,3))})),(t,e)=>(L(),k(A,null,[C("TresMesh",{ref_key:"targetMesh",ref:U,geometry:O(S),scale:.005,material:O(X)},null,8,D),C("TresMesh",{ref_key:"brushMesh",ref:Y,visible:!1},e[0]||(e[0]=[C("TresSphereGeometry",{args:[1,40,40]},null,-1),C("TresMeshStandardMaterial",{color:15483002,roughness:.75,metalness:0,transparent:!0,opacity:.5,premultipliedAlpha:!0,emissive:15483002,emissiveIntensity:.5},null,-1)]),512),C("TresMesh",{geometry:O(tt),position:[-2,-2,2],scale:.005},e[1]||(e[1]=[C("TresMeshStandardMaterial",{color:"#023249",roughness:.2,metalness:0,envMapIntensity:.2},null,-1)]),8,J)],64))}}),V=x({__name:"collectTriangles",setup(t){const e=B({clearColor:"#999999",antialias:!0}),n=B({autoRotate:!1}),r=I(null);return(t,a)=>{const i=S("TresCanvas");return L(),k(A,null,[X(O(P)),X(i,U(e,{"window-size":""}),{default:z((()=>[a[0]||(a[0]=C("TresPerspectiveCamera",{position:[5,1,15],fov:30,near:.1,far:1e3},null,-1)),X(O(s),U({ref_key:"controlsRef",ref:r},n),null,16),a[1]||(a[1]=C("TresAmbientLight",{intensity:1},null,-1)),(L(),R(Y,null,{default:z((()=>[X(N,{controls:r.value},null,8,["controls"])])),_:1})),(L(),R(Y,null,{default:z((()=>[X(O(o),{background:!1,files:["pos-x.jpg","neg-x.jpg","pos-y.jpg","neg-y.jpg","pos-z.jpg","neg-z.jpg"],path:"https://opensource.cdn.icegl.cn/images/skyBox/6jpg/"},null,8,["path"])])),_:1}))])),_:1},16)],64)}}});export{V as default};
