import{b as t,l as n}from"./pagesShow.vue_vue_type_script_setup_true_lang.Sy4YoNOZ1725236486446.js";import{$ as o}from"./@tresjs.DDzpLB7Q1725236486446.js";import{C as e}from"./three-custom-shader-material.52Yxne6X1725236486446.js";import"./object-hash.p3nCq7ez1725236486446.js";import{a6 as r,C as i,Z as u,ca as c,k as a,b0 as s}from"./three.0IuNGJsA1725236486446.js";import"./@amap.YiJorLHg1725236486446.js";import"./glsl-tokenizer.5A8V64LF1725236486446.js";import{d as l,a1 as f,w as p,o as d,D as m,u as g,a4 as v,r as h,f as y,g as b,j as w,m as C}from"./@vue.9bHx4gg21725236486446.js";import{P as _}from"./tweakpane.yHWGBmom1725236486446.js";import"./@vueuse.XXpXaOwX1725236486446.js";import"./glsl-token-string.UAuwSUH71725236486446.js";import"./glsl-token-functions.GpZWHJDq1725236486446.js";import"./jszip.F8iULAGn1725236486446.js";const x=B;!function(t,n){const o=B,e=S();for(;;)try{if(483998===-parseInt(o(296))/1+parseInt(o(299))/2*(parseInt(o(307))/3)+parseInt(o(292))/4+parseInt(o(283))/5*(parseInt(o(266))/6)+-parseInt(o(280))/7+-parseInt(o(301))/8+parseInt(o(271))/9*(parseInt(o(272))/10))break;e.push(e.shift())}catch(r){e.push(e.shift())}}();const I=function(){let t=!0;return function(n,o){const e=t?function(){if(o){const t=o[B(281)](n,arguments);return o=null,t}}:function(){};return t=!1,e}}();!function(){I(this,(function(){const t=B,n=new RegExp(t(284)),o=new RegExp(t(305),"i"),e=P("init");n.test(e+t(260))&&o.test(e+t(282))?P():e("0")}))()}();const M=function(){let t=!0;return function(n,o){const e=t?function(){if(o){const t=o[B(281)](n,arguments);return o=null,t}}:function(){};return t=!1,e}}();M(void 0,(function(){const t=B;let n;try{n=Function(t(269)+'{}.constructor("return this")( ));')()}catch(r){n=window}const o=n.console=n[t(257)]||{},e=[t(255),t(278),"info",t(261),t(303),"table",t(286)];for(let i=0;i<e[t(256)];i++){const n=M[t(259)][t(270)][t(297)](M),r=e[i],u=o[r]||n;n.__proto__=M[t(297)](M),n.toString=u[t(264)][t(297)](u),o[r]=n}}))();const j=[x(304)];function S(){const t=["console","MeshBasicMaterial","constructor","chain","error","\n\t\tvarying vec4 vPosition;\n\t\tvoid main() {\n\t\t\tvPosition = modelMatrix * vec4(position,1.0);\n\t\t\tcsm_Position = position * vec3(1.0);\n\t\t}\n\t\t","gger","toString","model","270ogKLDe","setStyle","side","return (function() ","prototype","234iAqkVQ","200590IPLHza","topColor","bModel","computeBoundingSphere","string","value","warn","color","3695405ZrbGVY","apply","input","19900mVoMJu","function *\\( *\\)","#e523ff","trace","while (true) {}","DoubleSide","renderOrder","action","bulidingsColor","2569416AIZRFC","#ffff00","material","#112233","403760haFPNg","bind","debu","916eVdzyV","landColor","2602536vGRuUk","land","exception","object","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","children","2607vRJPsN","stateObject","#ffffff","opacity","uOpacity","call","gradient","uniforms","log","length"];return(S=function(){return t})()}const T=l({__name:x(274),props:{model:{},bulidingsColor:{default:x(285)},landColor:{default:x(295)},topColor:{default:x(293)},opacity:{default:.9},gradient:{type:Boolean,default:!0}},setup(t){const n=x,c=t,a=c[n(265)].city;c.model[n(265)][n(306)][0].material=new(r[n(258)])({color:n(293)}),a[n(289)]=1001;const s=c.model.land;(()=>{const t=n,{geometry:o}=a;o.computeBoundingBox(),o[t(275)]();const{max:r,min:s}=o.boundingBox;if(a[t(294)].__csm)return;const l=new e({baseMaterial:a[t(294)],vertexShader:t(262),fragmentShader:"\n\t\tuniform mat4 modelMatrix;\n\t\tvarying vec4 vPosition;\n\t\tuniform vec3 uMax; \n\t\tuniform vec3 uMin; \n\t\tuniform float uOpacity;  \n\t\tuniform float uBorderWidth; \n\t\tuniform vec3 uLightColor;\n\t\tuniform vec3 uColor;\n\t\tuniform float uCircleTime; \n\t\tuniform float uTime; \n\t\tuniform vec3 uTopColor;\t\t\t\t\t//顶部颜色\n\t\tuniform bool uGradient;\n\t\tvec4 uMax_world;\n\t\tvec4 uMin_world;\n\t\tvoid main() {\n\t\t\t// 转世界坐标\n\t\t\tuMax_world =  modelMatrix * vec4(uMax,1.0);\n\t\t\tuMin_world =  modelMatrix * vec4(uMin,1.0);\n\t\t\tvec3 distColor = uColor;\n\t\t\tfloat residue = uTime - floor(uTime / uCircleTime) * uCircleTime;\n\t\t\tfloat rate = residue / uCircleTime;\n\t\t\tfloat lightOffset = rate * (uMax_world.y - uMin_world.y);\n\n\t\t\tif (uMin_world.y + lightOffset < vPosition.y && uMin_world.y + lightOffset + uBorderWidth > vPosition.y) {\n\t\t\t\tcsm_DiffuseColor = vec4(uLightColor, uOpacity);\n\t\t\t} else {\n\t\t\t\tcsm_DiffuseColor = vec4(distColor, uOpacity);\n\t\t\t}\n\n\t\t\t//根据高度计算颜色\n\t\t\tif(uGradient){\n\t\t\t\tfloat rateHight = (vPosition.y - uMin_world.y) / (uMax_world.y - uMin_world.y); \n\t\t\t\tvec3 outColor = mix(csm_DiffuseColor.xyz, uTopColor, rateHight*2.0);\n\t\t\t\tcsm_DiffuseColor = vec4(outColor, uOpacity);\n\t\t\t}\n    }\n\t\t",silent:!0,uniforms:{uMax:{value:r},uMin:{value:s},uBorderWidth:{value:5},uCircleTime:{value:5},uColor:{value:new i(c[t(291)])},uOpacity:{value:c.opacity},uLightColor:{value:new i(t(309))},uTopColor:{value:new i(c[t(273)])},uTime:{value:0},uGradient:{value:c.gradient}},depthWrite:!0,depthTest:!0,transparent:!0,side:u});a[t(294)].dispose(),a[t(294)]=l})();const{onLoop:l}=o();l((({delta:t})=>{const o=n;a[o(294)].uniforms.uTime[o(277)]+=t})),f((()=>{const t=n;c[t(291)]&&a[t(294)][t(254)].uColor[t(277)][t(267)](c[t(291)]),c[t(300)]&&((t,o)=>{const e=n;let i;"cu"===t||t===e(302)&&(i=Array.isArray(s[e(294)])?s[e(294)]:[s.material],i.forEach((t=>{const n=e;t[o][n(267)](c[n(300)]),t[n(268)]=r[n(288)]})))})("land",t(279)),c[t(250)]&&(a.material.uniforms[t(251)][t(277)]=c[t(250)])})),p(c,((t,o)=>{const e=n;a.material[e(254)].uGradient.value=t[e(253)]}));const v=c[n(265)].model.clone();return(t,n)=>(d(),m("primitive",{object:g(v)},null,8,j))}});function B(t,n){const o=S();return(B=function(t,n){return o[t-=250]})(t,n)}function P(t){function n(t){const o=B;if(typeof t===o(276))return function(t){}.constructor(o(287)).apply("counter");1!==(""+t/t).length||t%20==0?function(){return!0}[o(259)](o(298)+o(263))[o(252)](o(290)):function(){return!1}[o(259)]("debu"+o(263))[o(281)](o(308)),n(++t)}try{if(t)return n;n(0)}catch(o){}}const F=R;!function(t,n){const o=R,e=A();for(;;)try{if(699650===parseInt(o(449))/1*(parseInt(o(492))/2)+parseInt(o(451))/3+parseInt(o(460))/4*(parseInt(o(468))/5)+-parseInt(o(463))/6+-parseInt(o(461))/7+parseInt(o(462))/8+-parseInt(o(464))/9*(parseInt(o(471))/10))break;e.push(e.shift())}catch(r){e.push(e.shift())}}();const G=function(){let t=!0;return function(n,o){const e=t?function(){if(o){const t=o[R(465)](n,arguments);return o=null,t}}:function(){};return t=!1,e}}();!function(){G(this,(function(){const t=R,n=new RegExp("function *\\( *\\)"),o=new RegExp(t(476),"i"),e=z("init");n.test(e+t(493))&&o[t(459)](e+t(470))?z():e("0")}))()}();const O=function(){let t=!0;return function(n,o){const e=t?function(){if(o){const t=o[R(465)](n,arguments);return o=null,t}}:function(){};return t=!1,e}}();O(void 0,(function(){const t=R,n=function(){const t=R;let n;try{n=Function(t(443)+t(456)+");")()}catch(o){n=window}return n}(),o=n.console=n[t(469)]||{},e=[t(484),"warn","info","error",t(466),t(481),t(486)];for(let r=0;r<e[t(455)];r++){const n=O[t(488)].prototype.bind(O),i=e[r],u=o[i]||n;n.__proto__=O.bind(O),n[t(446)]=u[t(446)][t(453)](u),o[i]=n}}))();const k=[F(490)];function A(){const t=["9600787KMZInl","8915936YeVGds","7302960mSGAHB","11007rSkvww","apply","exception","srcColor","138485TKKYhb","console","input","4270muREWU","#FFF","stateObject","uSrcColor","counter","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","uScale","#000","while (true) {}","color","table","uColor","debu","log","renderOrder","trace","bLine","constructor","matrix","object","uniforms","155626dEseQV","chain","gger","action","builds","return (function() ","value","gradual","toString","call","primitive","16UfgKMp","material","2940669NmOQUx","width","bind","uTime","length",'{}.constructor("return this")( )',"uGradual","scale","test","68TbmUdS"];return(A=function(){return t})()}function R(t,n){const o=A();return(R=function(t,n){return o[t-=441]})(t,n)}const Z=l({__name:F(487),props:{builds:{},color:{default:F(472)},srcColor:{default:F(478)},scale:{default:2e3},gradual:{default:10},speed:{default:.5}},setup(t){const n=F,e=t;let r=null;const u={transparent:!0,uniforms:{uColor:{value:new i(e.color)},uSrcColor:{value:new i(e.srcColor)},uScale:{value:e[n(458)]},uTime:{value:0},uGradual:{value:e[n(445)]}},vertexShader:"varying vec3 vPosition;\nvoid main(){\n\tvPosition=position;\n\tvec4 viewPosition=modelViewMatrix*vec4(position,1.);\n\tgl_Position=projectionMatrix*viewPosition;\n}",fragmentShader:"uniform float uScale;//最大扩散\nuniform float uGradual;//建变系数\nuniform float uTime;\nuniform vec3 uColor;//扩散颜色\nuniform vec3 uSrcColor;//原始颜色\nvarying vec3 vPosition;\n\nvoid main(){\n\tfloat dis=distance(vPosition.xz,vec2(.0,.0));\n\tif(dis>uScale){\n\t\tdiscard;\n\t}\n\tfloat opacity=smoothstep(uScale/uGradual*uTime,uScale*uTime,dis);\n\topacity*=step(dis,uScale*uTime);\n\t\n\tif(opacity<.3){\n\t\tgl_FragColor=vec4(uSrcColor,1.-opacity);\n\t}else{\n\t\tgl_FragColor=vec4(uColor,opacity);\n\t}\n\t// gl_FragColor=vec4(uColor,opacity);\n}\n"};let l=new c(e.builds.geometry).clone();l=l.applyMatrix4(e[n(442)][n(489)]);const p=new a(u);r=new s(l,p),r[n(450)].linewidth=e[n(452)],r[n(485)]=1e3,f((()=>{const t=n;e[t(480)]&&(u[t(491)][t(482)][t(444)]=new i(e[t(480)])),e[t(467)]&&(u[t(491)][t(474)][t(444)]=new i(e[t(467)])),e[t(458)]&&(u[t(491)][t(477)][t(444)]=e.scale),e.gradual&&(u.uniforms[t(457)].value=e[t(445)])}));const{onLoop:v}=o();return v((({delta:t})=>{const o=n;u.uniforms[o(454)].value+=t*e.speed,u[o(491)][o(454)][o(444)]%=1})),(t,o)=>{const e=n;return d(),m(e(448),{object:g(r)},null,8,k)}}});function z(t){function n(t){const o=R;if("string"==typeof t)return function(t){}.constructor(o(479))[o(465)](o(475));1!==(""+t/t)[o(455)]||t%20==0?function(){return!0}[o(488)]("debu"+o(494))[o(447)](o(441)):function(){return!1}[o(488)](o(483)+"gger").apply(o(473)),n(++t)}try{if(t)return n;n(0)}catch(o){}}!function(t,n){const o=D,e=L();for(;;)try{if(192913===-parseInt(o(356))/1+-parseInt(o(338))/2*(parseInt(o(323))/3)+parseInt(o(349))/4*(parseInt(o(364))/5)+parseInt(o(331))/6+parseInt(o(365))/7*(parseInt(o(339))/8)+parseInt(o(354))/9*(-parseInt(o(352))/10)+-parseInt(o(332))/11)break;e.push(e.shift())}catch(r){e.push(e.shift())}}();const E=function(){let t=!0;return function(n,o){const e=t?function(){if(o){const t=o[D(348)](n,arguments);return o=null,t}}:function(){};return t=!1,e}}();!function(){E(this,(function(){const t=D,n=new RegExp(t(341)),o=new RegExp(t(346),"i"),e=U(t(340));n[t(335)](e+"chain")&&o.test(e+t(326))?U():e("0")}))()}();const V=function(){let t=!0;return function(n,o){const e=t?function(){if(o){const t=o.apply(n,arguments);return o=null,t}}:function(){};return t=!1,e}}();function L(){const t=["5262PBlKZy","57968bGoQtU","init","function *\\( *\\)","srcColor","exception","#FFF","warn","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","stateObject","apply","62548puCiBJ","toString","info","10CxWjFZ","线扫颜色","352746YdrcyY","string","199983fuTSfW","counter","bind","#999","#000","length","log","constructor","55BQjVNb","287aUQGJb","console","return (function() ",'{}.constructor("return this")( )',"#000000","213dnGFkR","gger","addBinding","input","线原颜色","error","table","gradual","969984ZsunQr","130526NrBpiF","扩散系数","action","test","scale","while (true) {}"];return(L=function(){return t})()}function D(t,n){const o=L();return(D=function(t,n){return o[t-=323]})(t,n)}V(void 0,(function(){const t=D,n=function(){const t=D;let n;try{n=Function(t(367)+t(368)+");")()}catch(o){n=window}return n}(),o=n[t(366)]=n.console||{},e=[t(362),t(345),t(351),t(328),t(343),t(329),"trace"];for(let r=0;r<e[t(361)];r++){const n=V[t(363)].prototype[t(358)](V),i=e[r],u=o[i]||n;n.__proto__=V.bind(V),n[t(350)]=u[t(350)][t(358)](u),o[i]=n}}))();const Q=l({__name:"buildingsEffectA",async setup(o){const e=D;let r,i;const u=([r,i]=v((()=>n())),r=await r,i(),r),c=h({color:e(344),srcColor:e(360),scale:2e3,gradual:6.6,speed:.3}),a=new _({title:"效果参数",expanded:!0});return a.addBinding(c,e(342),{label:e(327)}),a.addBinding(c,"color",{label:e(353)}),a.addBinding(c,"speed",{label:"速度",min:.1,max:1,step:.1}),a[e(325)](c,e(336),{label:"最大扩散",min:10,max:2e3,step:10}),a[e(325)](c,e(330),{label:e(333),min:1.1,max:10,step:.1}),(n,o)=>{const r=e;return d(),y(t,{showAxesHelper:!1,autoRotate:!1,showBuildings:!1},{ability:b((()=>[w(T,{model:g(u),bulidingsColor:r(369),landColor:"#112233",topColor:r(359)},null,8,["model"]),w(Z,C({builds:g(u).city},c),null,16,["builds"])])),_:1})}}});function U(t){function n(t){const o=D;if(typeof t===o(355))return function(t){}.constructor(o(337)).apply(o(357));1!==(""+t/t)[o(361)]||t%20==0?function(){return!0}[o(363)]("debugger").call(o(334)):function(){return!1}[o(363)]("debu"+o(324)).apply(o(347)),n(++t)}try{if(t)return n;n(0)}catch(o){}}export{Q as default};
