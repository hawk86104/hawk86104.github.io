import{e,b as o,m as i}from"./@tresjs.D3Ezko2-1755574932434.js";import{aL as t,V as r,cG as n,a9 as a,g as s,S as l,M as u,Q as p,az as m,cC as c,cD as d,cE as f,a3 as g,C as _,bD as h,cY as v,N as y,_ as w,ce as j,q as x}from"./three.QlBabAUP1755574932434.js";import{z as M}from"./three-custom-shader-material.EFGJY8zp1755574932434.js";import{T as C}from"./3d-tiles-renderer.DPSVGoBH1755574932434.js";import{d as b,aa as P,G as T,o as z,F as B,W as S,I as L,u as D,b as W,a2 as G,j as O,e as E,f as H,a5 as q,v as A,r as R,h as k,m as N}from"./@vue.BzMISRrV1755574932434.js";import{l as Z,U as F,P as V,M as I,T as J,a as U,r as Y}from"./raycasterEvent.DWL62vhk1755574932434.js";import"./HeightCorrection.Bq98L9tL1755574932434.js";import"./three-tile.3QpKkTsV1755574932434.js";import"./@tweenjs.Dhzs71lh1755574932434.js";/* empty css                                                                                    */import"./@fesjs.C8tWfo4D1755574932434.js";import"./axios.CKBkq5Os1755574932434.js";import{_ as Q,a as X}from"./radraB.vue_vue_type_script_setup_true_lang.4_I8yZMN1755574932434.js";import"./vanilla.esm.5.5.0.DndbY4xJ1755574932434.js";import{_ as K}from"./precipitation.vue_vue_type_script_setup_true_lang.C4y2k6dB1755574932434.js";import{_ as $}from"./cloudMesh.vue_vue_type_script_setup_true_lang.BGrKXHLs1755574932434.js";import{_ as ee}from"./buildingsMarkA.vue_vue_type_script_setup_true_lang.KmAjyhFG1755574932434.js";import{_ as oe}from"./fireA.vue_vue_type_script_setup_true_lang.DtBg4CRD1755574932434.js";import{_ as ie}from"./fireB.vue_vue_type_script_setup_true_lang.Dgk3CSkS1755574932434.js";import{_ as te}from"./smokeA.vue_vue_type_script_setup_true_lang.BWGCDXiu1755574932434.js";import{_ as re}from"./rippleMesh.vue_vue_type_script_setup_true_lang.BM_-vdU01755574932434.js";import{l as ne}from"./utils.DGgE1p1_1755574932434.js";import"./postprocessing.DBDjiblp1755574932434.js";import"./@vueuse.BcmlNMCY1755574932434.js";import"./@mapbox.B8uYRbGC1755574932434.js";import"./three-mesh-bvh.CyUFl1uw1755574932434.js";import"./vue-router.BQU9In5l1755574932434.js";import"./lodash-es.C7pWAXPe1755574932434.js";import"./pinia.BE7EcXOZ1755574932434.js";import"./@qlin.q6OWdsQV1755574932434.js";import"./@babel.BPq7uOAK1755574932434.js";import"./@floating-ui.BFjFSAYt1755574932434.js";import"./@juggle.CcBCnTIR1755574932434.js";import"./axios.DLTVXJci1755574932434.js";import"./color.B3hN3VZ71755574932434.js";import"./@amap.CGUF9xH41755574932434.js";import"./color-string.CNBad7wI1755574932434.js";import"./color-name.BQ5IbGbl1755574932434.js";import"./simple-swizzle.BdGPcsAx1755574932434.js";import"./is-arrayish.CLsR9Wfx1755574932434.js";import"./color-convert.CNXkC9x81755574932434.js";import"./lodash.DfzB0K4j1755574932434.js";import"./object-hash.qJ-cAwEg1755574932434.js";import"./jszip.DDrqya1Y1755574932434.js";import"./SPE.D-giaCo-1755574932434.js";const ae={renderOrder:3e3},se=["args"],le=["map","side","color"],ue=b({__name:"roadLightByLonLat",props:{geoJson:{},color:{default:"#ffff00"},radius:{default:2},speed:{default:1}},async setup(i){let s,l;const u=i,{map:p}=([s,l]=P((()=>o({map:"./plugins/digitalCity/image/line.png"}))),s=await s,l(),s);p.needsUpdate=!0,p.wrapS=p.wrapT=t,p.repeat.set(1,1);const m=([s,l]=P((()=>ne(u.geoJson))),s=await s,l(),s);let c=[];for(var d=0;d<m.length;d++){const e=m[d],o=[];e.geometry.coordinates.forEach((e=>{const i=Z(e[0],e[1],50);o.push(new r(i[0],0,-i[1]))}));let i=u.color;i="primary"===e.properties.highway?"#7eff10":"tertiary"===e.properties.highway?"#0eeeee":"secondary"===e.properties.highway?"#ffffff":"#ff0ffe",c.push({cr3:new n(o),color:i})}const{onLoop:f}=e();return f((()=>{p.offset.x-=Math.random()/20*u.speed})),(e,o)=>(z(),T("TresGroup",null,[(z(!0),T(B,null,S(D(c),(e=>(z(),T("TresMesh",ae,[L("TresTubeGeometry",{args:[e.cr3,64,u.radius,20,!1]},null,8,se),L("TresMeshBasicMaterial",{map:D(p),side:D(a),transparent:!0,color:e.color},null,8,le)])))),256))]))}}),pe=e=>{e.onLoadTileSet=o=>{const i=new s,t=new l,n=new u;let a=null,m=0;e.getOrientedBounds(i,n)?(a=(new r).setFromMatrixPosition(n),m=a.length()):e.getBoundingSphere(t)&&(a=t.center.clone(),m=a.length());const c=a?.normalize(),d=((e,o)=>{const i=new p,t=(new r).crossVectors(e,o);return i.x=t.x,i.y=t.y,i.z=t.z,i.w=1+e.clone().dot(o),i.normalize(),i})(c,new r(0,1,0));e.group.quaternion.x=d.x,e.group.quaternion.y=d.y,e.group.quaternion.z=d.z,e.group.quaternion.w=d.w,e.group.position.z=-m}},me=["object","rotation"],ce=b({__name:"tilesBuildings",props:{bulidingsColor:{default:"#e523ff"},topColor:{default:"#ffff00"},opacity:{default:.8},gradient:{type:Boolean,default:!0},camera:{}},setup(o){const t=o,r=W(0),n=new C("https://jdvop.oss-cn-qingdao.aliyuncs.com/mapv-data/titleset/sz_ns/no.json");n.errorTarget=2,n.addEventListener("load-model",(({scene:e})=>{e.traverse((e=>{if(e.isMesh){(e=>{const{geometry:o}=e;o.computeBoundingBox(),o.computeBoundingSphere();const{max:i,min:n}=o.boundingBox,a=new M({baseMaterial:new h,vertexShader:"varying vec4 vPosition;\nvoid main(){\n\tvPosition=modelMatrix*vec4(position,1.);\n\tcsm_Position=position*vec3(1.);\n}",fragmentShader:"uniform mat4 modelMatrix;\nvarying vec4 vPosition;\nuniform vec3 uMax;\nuniform vec3 uMin;\nuniform float uOpacity;\nuniform float uBorderWidth;\nuniform vec3 uLightColor;\nuniform vec3 uColor;\nuniform float uCircleTime;\nuniform float uTime;\nuniform vec3 uTopColor; // 顶部颜色\nuniform bool uGradient;\nvec4 uMax_world;\nvec4 uMin_world;\nvoid main() {\n  // 转世界坐标\n  uMax_world = modelMatrix * vec4(uMax, 1.);\n  uMin_world = modelMatrix * vec4(uMin, 1.);\n  vec3 distColor = uColor;\n  float residue = uTime - floor(uTime / uCircleTime) * uCircleTime;\n  float rate = residue / uCircleTime;\n  float lightOffset = rate * (uMax_world.y - uMin_world.y);\n\n  if (uMin_world.y + lightOffset < vPosition.y &&\n      uMin_world.y + lightOffset + uBorderWidth > vPosition.y) {\n    csm_DiffuseColor = vec4(uLightColor, uOpacity);\n  } else {\n    csm_DiffuseColor = vec4(distColor, uOpacity);\n  }\n\n  // 根据高度计算颜色\n  if (uGradient) {\n    float rateHight =\n        (vPosition.y - uMin_world.y) / (uMax_world.y - uMin_world.y);\n    // vec3 outColor = mix(csm_DiffuseColor.xyz, uTopColor, rateHight * 0.6);\n    float mixNumber = clamp(rateHight * 2.3 - 1.5, 0., 1.);\n    vec3 outColor = mix(csm_DiffuseColor.xyz, uTopColor, mixNumber);\n\n    csm_DiffuseColor = vec4(outColor, uOpacity);\n  }\n}",silent:!0,uniforms:{uMax:{value:i},uMin:{value:n},uBorderWidth:{value:5},uCircleTime:{value:5},uColor:{value:new _(t.bulidingsColor)},uOpacity:{value:t.opacity},uLightColor:{value:new _("#ffffff")},uTopColor:{value:new _(t.topColor)},uTime:r,uGradient:{value:t.gradient}},depthWrite:!0,depthTest:!0,transparent:!0,side:g});e.material.dispose(),e.material=a})(e),e.receiveShadow=!1,e.castShadow=!1;const o=new m(e.geometry.clone());let i=(new c).fromEdgesGeometry(o),n=new d({color:0,linewidth:1,opacity:1,transparent:!0,depthWrite:!0,depthTest:!0});n.resolution.set(window.innerWidth,window.innerHeight);const a=new f(i,n);a.applyMatrix4(e.matrix.clone()),e.parent.add(a)}}));const o=new s,i=new l;n.getBoundingBox(o)?(o.getCenter(n.group.position),n.group.position.multiplyScalar(-1)):n.getBoundingSphere(i)&&(n.group.position.copy(i.center),n.group.position.multiplyScalar(-1))})),pe(n);const{renderer:a,sizes:u}=i();G((()=>{u.width.value&&(n.setCamera(t.camera),n.setResolutionFromRenderer(t.camera,a.value))}));const{onBeforeLoop:p}=e();return p((({delta:e})=>{r.value+=2*e,t.camera&&u.width.value&&(t.camera.updateMatrixWorld(),n.update())})),(e,o)=>(z(),T("TresGroup",null,[L("primitive",{object:D(n).group,rotation:[-Math.PI/2,0,0]},null,8,me)]))}}),de=["object","rotation"],fe=b({__name:"tileMapBuildingsMesh",props:{bbox:{default:[104.955976,20.149765,120.998419,30.528687]},maxZoom:{default:20},mapCenter:{},camera:{}},setup(o,{expose:t}){const n=o,{renderer:a,scene:s}=i(),l=new V;l.coordType=F;const u=new I;u.source="https://webrd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",u.showTileNo=!1,u.useWorker=!0;const p=new J(l,u);p.showBoundingBox=!1,p.wireframe=!1,p.flatShading=!1,p.filter={opposite:!0,genBright:1.3,genContrast:1,genSaturation:1};let m=new _("#4688b5");p.filter.monochrome={r:m.r,g:m.g,b:m.b};const c=new U;c.provider=p,c.bbox=n.bbox,c.maxZoom=n.maxZoom,n.camera.up=new r(0,1,0),n.camera.position.set(n.mapCenter[0],n.mapCenter[2],2e3-n.mapCenter[1]),n.camera.lookAt(new r(n.camera.position.x,0,n.camera.position.z-3e3)),c.camera=n.camera;let d=null;G((()=>{a.value&&(d=new v(n.camera,a.value.domElement),d.enableDamping=!0,d.dampingFactor=.05,d.minDistance=600,d.position0.set(n.camera.position.x,n.camera.position.y,n.camera.position.z),d.target.set(n.camera.position.x,0,n.camera.position.z-2e3))}));const{onLoop:f}=e();return f((()=>{if(a.value){const e=50*Math.abs(n.camera.position.y);n.camera.far=e+5e3,n.camera.updateProjectionMatrix(),d&&(d.update(),d.target.y=0),c.update(),a.value.render(s.value,n.camera)}})),t({camera:n.camera,map:c}),(e,o)=>(z(),T("primitive",{object:D(c),rotation:[-Math.PI/2,0,0]},null,8,de))}}),ge=b({__name:"mapBuildingsMoreMeshes",props:{cPosition:{}},setup(e){const o=Z(113.9456,22.5385,50),i=Z(113.9498,22.5364,50);return(e,t)=>(z(),T(B,null,[O(D(Q),{color:"#00c0ff",radius:300,size:300,position:[e.cPosition[0],8,-e.cPosition[1]]},null,8,["position"]),(z(),E(q,null,{default:H((()=>[O(D(ee),{position:[e.cPosition[0],8,-e.cPosition[1]],scale:.13,img:"./plugins/digitalCity/image/znsba.png",foremost:!1},null,8,["position"])])),_:1})),O(D(X),{position:[e.cPosition[0]+700,10,300-e.cPosition[1]],color:"#ffff00",height:180,maxRadius:400},null,8,["position"]),(z(),E(q,null,{default:H((()=>[O(D(ee),{position:[e.cPosition[0]+700,10,300-e.cPosition[1]],scale:200,img:"./plugins/digitalCity/image/znsb-err.png",sizeAttenuation:!0,foremost:!0},null,8,["position"])])),_:1})),(z(),E(q,null,{default:H((()=>[O(D(oe),{fireScale:80,magnitude:1.3,lacunarity:2,gain:1,position:[e.cPosition[0]+280,1,120-e.cPosition[1]]},null,8,["position"])])),_:1})),(z(),E(q,null,{default:H((()=>[O(D(ie),{position:[e.cPosition[0]+388,6,330-e.cPosition[1]]},null,8,["position"])])),_:1})),(z(),E(q,null,{default:H((()=>[O(D(te),{position:[e.cPosition[0]+388,6,330-e.cPosition[1]]},null,8,["position"])])),_:1})),(z(),E(q,null,{default:H((()=>[O(D(K),{speed:12,size:20,count:2e4,color:"#fff",type:"snow",position:[e.cPosition[0],300,-e.cPosition[1]],areaX:5e3,areaY:600,areaZ:5e3},null,8,["position"])])),_:1})),(z(),E(q,null,{default:H((()=>[O(D($),{cPosition:[e.cPosition[0],600,-e.cPosition[1]]},null,8,["cPosition"])])),_:1})),O(D(re),{"position-y":6,positionSrc:[{x:D(o)[0],y:-D(o)[1]},{x:D(o)[0],y:-D(i)[1]},{x:D(i)[0],y:-D(i)[1]},{x:D(i)[0],y:-D(o)[1]},{x:D(o)[0],y:-D(o)[1]}],height:220,color:"#00ffdd"},null,8,["positionSrc"]),(z(),E(q,null,{default:H((()=>[O(D(ue),{position:[500,0,340],radius:5,geoJson:"plugins/digitalCity/geojson/shenzhen2.geojson"})])),_:1}))],64))}}),_e=b({__name:"mapBuildings",setup(e){const o=Z(113.942639739199,22.53171672540276,50),i=A(),t=R({clearColor:"#000000",renderMode:"manual",alpha:!1,shadowMapType:j,outputColorSpace:w,toneMapping:y}),r=[o[0],o[1],1700],n=new x(60,window.innerWidth/window.innerHeight,1,1e8);return(e,a)=>{const s=k("TresCanvas");return z(),T(B,null,[O(s,N(t,{"window-size":""}),{default:H((()=>[a[0]||(a[0]=L("TresAmbientLight",{color:"#ffffff"},null,-1)),a[1]||(a[1]=L("TresDirectionalLight",{position:[100,100,0],intensity:.5,color:"#ffffff"},null,-1)),O(D(ce),{position:[D(o)[0],1,228-D(o)[1]],camera:D(n)},null,8,["position","camera"]),(z(),E(q,null,{default:H((()=>[O(D(fe),{ref_key:"tileMapBuildingsMeshRef",ref:i,bbox:[104.955976,20.149765,120.998419,30.528687],mapCenter:r,camera:D(n)},null,8,["camera"])])),_:1})),(z(),E(q,null,{default:H((()=>[O(ge,{cPosition:D(o)},null,8,["cPosition"])])),_:1})),a[2]||(a[2]=L("TresGridHelper",{args:[1e4,10]},null,-1)),a[3]||(a[3]=L("TresAxesHelper",{args:[1e5]},null,-1))])),_:1},16),O(Y,{tileMapRef:i.value},null,8,["tileMapRef"])],64)}}});export{_e as default};
