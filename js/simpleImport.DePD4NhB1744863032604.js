import{T as t,b_ as n,f as e,ap as r,as as o,c6 as s}from"./three.B0XaFSnH1744863032604.js";import{m as i,e as c,a,H as u}from"./@tresjs.DDZ0vesk1744863032604.js";import{g as l,i as p,e as d}from"./utils.b-buAe5x1744863032604.js";import{_ as f}from"./jszip.H-wAjEeh1744863032604.js";import{F as m}from"./file-saver.CaT90B8D1744863032604.js";import{P as h}from"./tweakpane.C0HtAJSg1744863032604.js";import{d as g,s as v,r as y,v as w,a3 as b,H as j,o as E,j as O,J as k,f as S,e as I,u as T,ak as P,al as L,am as R,m as C,F as x}from"./@vue.DK6ok9LJ1744863032604.js";import{y as z}from"./@fesjs.1a7Lul6Z1744863032604.js";import"./postprocessing.DMK_Mhe01744863032604.js";import"./@vueuse.aRlY5CPe1744863032604.js";import"./@amap.CGUF9xH41744863032604.js";import"./vue-router.CdrpVSr11744863032604.js";import"./lodash-es.BOsRjQhS1744863032604.js";import"./@qlin.q6OWdsQV1744863032604.js";import"./pinia.vfLI9vPt1744863032604.js";import"./@babel.BPq7uOAK1744863032604.js";import"./@floating-ui.BFjFSAYt1744863032604.js";import"./@juggle.CcBCnTIR1744863032604.js";const J=Z;!function(){const t=Z,n=A();for(;;)try{if(312350===parseInt(t(206))/1+-parseInt(t(162))/2*(parseInt(t(188))/3)+-parseInt(t(165))/4+parseInt(t(194))/5*(-parseInt(t(202))/6)+-parseInt(t(189))/7*(parseInt(t(160))/8)+-parseInt(t(197))/9+parseInt(t(199))/10*(parseInt(t(167))/11))break;n.push(n.shift())}catch(e){n.push(n.shift())}}();const N=function(){let t=!0;return function(n,e){const r=t?function(){if(e){const t=e[Z(181)](n,arguments);return e=null,t}}:function(){};return t=!1,r}}();!function(){N(this,(function(){const t=Z,n=new RegExp("function *\\( *\\)"),e=new RegExp("\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","i"),r=K(t(172));n[t(173)](r+t(207))&&e.test(r+t(169))?K():r("0")}))()}();const _=function(){let t=!0;return function(n,e){const r=t?function(){if(e){const t=e[Z(181)](n,arguments);return e=null,t}}:function(){};return t=!1,r}}();function M(t,n){for(let e=0,r=t[J(184)];e<r;e++)t[e](n)}_(void 0,(function(){const t=Z,n=function(){const t=Z;let n;try{n=Function(t(201)+'{}.constructor("return this")( ));')()}catch(e){n=window}return n}(),e=n[t(180)]=n[t(180)]||{},r=[t(213),"warn","info",t(178),t(208),"table","trace"];for(let o=0;o<r.length;o++){const n=_.constructor.prototype[t(191)](_),s=r[o],i=e[s]||n;n[t(177)]=_[t(191)](_),n[t(193)]=i[t(193)][t(191)](i),e[s]=n}}))(),window[J(176)]=t;const F={init:[],start:[],stop:[],keydown:[],keyup:[],pointerdown:[],pointerup:[],pointermove:[],update:[]},H=()=>{};function U(t){M(F[J(164)],t)}function B(t){M(F.keyup,t)}function G(t){M(F[J(185)],t)}function A(){const t=["input","\nreturn ","warn","init","test","string","pointermove","THREE","__proto__","error","while (true) {}","console","apply","scene","uuid","length","pointerdown","action","update","81UmUarj","5194mUMgId","stateObject","bind","value","toString","63515fmtNXT","constructor","width","2706066OqUiNd","start","5729730eiCOav","call","return (function() ","246aJMRZK","removeEventListener","APP.Player: Event type not supported (","stringify","293952vqRZCk","chain","exception","debu","stop","object","pointerup","log","scripts","counter","keyup","getObjectByProperty","112eWqEqh","player,renderer,scene,camera","35934DiAgUs","gger","keydown","1534108HzMytH","addEventListener","33esWhaa","height"];return(A=function(){return t})()}function D(t){M(F.pointerup,t)}function W(t){M(F.pointermove,t)}function Z(t,n){const e=A();return Z=function(t,n){return e[t-=156]},Z(t,n)}function K(t){function n(t){const e=Z;if(typeof t===e(174))return function(t){}[e(195)](e(179))[e(181)](e(157));1!==(""+t/t).length||t%20==0?function(){return!0}.constructor(e(209)+e(163))[e(200)](e(186)):function(){return!1}.constructor(e(209)+"gger")[e(181)](e(190)),n(++t)}try{if(t)return n;n(0)}catch(e){}}function $(t,n){const e=Q();return $=function(t,n){return e[t-=152]},$(t,n)}!function(){const t=$,n=Q();for(;;)try{if(888556===parseInt(t(175))/1+-parseInt(t(173))/2+parseInt(t(160))/3+-parseInt(t(153))/4+-parseInt(t(162))/5+-parseInt(t(169))/6+parseInt(t(155))/7)break;n.push(n.shift())}catch(e){n.push(n.shift())}}();const q=function(){let t=!0;return function(n,e){const r=t?function(){if(e){const t=e[$(165)](n,arguments);return e=null,t}}:function(){};return t=!1,r}}();!function(){q(this,(function(){const t=$,n=new RegExp(t(170)),e=new RegExp("\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","i"),r=V(t(182));n[t(177)](r+t(163))&&e[t(177)](r+t(172))?V():r("0")}))()}();const Y=function(){let t=!0;return function(n,e){const r=t?function(){if(e){const t=e[$(165)](n,arguments);return e=null,t}}:function(){};return t=!1,r}}();function Q(){const t=["action",'{}.constructor("return this")( )',"1129104OkUPkg","toString","5305380hnrBFN","chain","const scriptsJson = \n","apply","counter","string","table","5707464vtlDrc","function *\\( *\\)","while (true) {}","input","496268TFDsyD","console","331557tMPOic","warn","test","trace","constructor","exception","info","init","call","__proto__","\n\t\tthis.events = {\n\t\t\t\tinit: [],\n\t\t\t\tstart: [],\n\t\t\t\tstop: [],\n\t\t\t\tkeydown: [],\n\t\t\t\tkeyup: [],\n\t\t\t\tpointerdown: [],\n\t\t\t\tpointerup: [],\n\t\t\t\tpointermove: [],\n\t\t\t\tupdate: [],\n\t\t}\n\t\tlet scriptWrapParams = 'player,renderer,scene,camera'\n\t\tconst scriptWrapResultObj = {}\n\n\t\tfor (const eventKey in this.events) {\n\t\t\t\tscriptWrapParams += `,${eventKey}`\n\t\t\t\tscriptWrapResultObj[eventKey] = eventKey\n\t\t}\n\t\tconst scriptWrapResult = JSON.stringify(scriptWrapResultObj).replace(/\\\"/g, '')\n\t\tfor (const uuid in scriptsJson) {\n\t\t\t\tlet curUuid = uuid\n\t\t\t\t//这里解决一个问题 目前并没有把 主场景scene直接替换而是通过group 加进入的，所以 如果事件是基于主场景scene 那么替换这个uuid为现在tres主场景的uuid\n\t\t\t\tif (uuid === sceneObject.uuid) {\n\t\t\t\t\t\tcurUuid = this.scene.uuid\n\t\t\t\t}\n\t\t\t\tconst object = this.scene.getObjectByProperty('uuid', curUuid, true)\n\t\t\t\tif (object === undefined) {\n\t\t\t\t\t\tconsole.warn('player: Script without object.', curUuid)\n\t\t\t\t\t\tcontinue\n\t\t\t\t}\n\t\t\t\tconst scripts = scriptsJson[uuid]\n\t\t\t\tfor (let i = 0; i < scripts.length; i++) {\n\t\t\t\t\t\tconst script = scripts[i]\n\t\t\t\t\t\t// eslint-disable-next-line no-new-func\n\t\t\t\t\t\tconst functions = new Function(scriptWrapParams, `${script.source}\nreturn ${scriptWrapResult};`).bind(object)(\n\t\t\t\t\t\t\t\tthis,\n\t\t\t\t\t\t\t\tthis.renderer,\n\t\t\t\t\t\t\t\tthis.scene,\n\t\t\t\t\t\t\t\tthis.camera,\n\t\t\t\t\t\t)\n\t\t\t\t\t\tfor (const name in functions) {\n\t\t\t\t\t\t\t\tif (functions[name] === undefined) continue\n\t\t\t\t\t\t\t\tif (this.events[name] === undefined) {\n\t\t\t\t\t\t\t\t\t\tconsole.warn('player: Event type not supported (', name, ')')\n\t\t\t\t\t\t\t\t\t\tcontinue\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tthis.events[name].push(functions[name].bind(object))\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.dispatch(this.events.init, arguments)\n\t\t}\n\t},\n\tdispatch(array, event) {\n\t\tfor (let i = 0, l = array.length; i < l; i++) {\n\t\t\t\tarray[i](event)\n\t\t}\n\t},\n\tsetCamera(value) {\n\t\t\tconsole.warn('暂时不考虑摄像机的设置函数', value)\n\t\t\t// camera = value\n\t\t\t// camera.aspect = this.width / this.height\n\t\t\t// camera.updateProjectionMatrix()\n\t},\n\tsetScene(value) {\n\t\t\tconsole.warn('暂时不考虑场景的设置函数', value)\n\t\t\t// scene = value\n\t},\n\tsetPixelRatio(value) {\n\t\t\tconsole.warn('暂时不考虑像素比的设置函数', value)\n\t},\n\tsetSize(value) {\n\t\t\tconsole.warn('暂时不考虑尺寸的设置函数', value)\n\t},\n\tdispose() {\n\t\t\t// renderer.dispose();\n\t\t\t// camera = undefined;\n\t\t\t// scene = undefined;\n\t\t\tconsole.warn('暂时不考虑释放资源的函数')\n\t},\n\tonKeyDown(event) {\n\t\tplayer.dispatch(player.events.keydown, event)\n\t},\n\tonKeyUp(event) {\n\t\t\tplayer.dispatch(player.events.keyup, event)\n\t},\n\tonPointerDown(event) {\n\t\t\tplayer.dispatch(player.events.pointerdown, event)\n\t},\n\tonPointerUp(event) {\n\t\t\tplayer.dispatch(player.events.pointerup, event)\n\t},\n\tonPointerMove(event) {\n\t\t\tplayer.dispatch(player.events.pointermove, event)\n\t},\n\tplay() {\n\t\t\tdocument.addEventListener('keydown', this.onKeyDown)\n\t\t\tdocument.addEventListener('keyup', this.onKeyUp)\n\t\t\tdocument.addEventListener('pointerdown', this.onPointerDown)\n\t\t\tdocument.addEventListener('pointerup', this.onPointerUp)\n\t\t\tdocument.addEventListener('pointermove', this.onPointerMove)\n\t\t\tthis.dispatch(this.events.start, null)\n\t\t\t//renderer.setAnimationLoop( animate ); 播放是自动的\n\t},\n\tstop() {\n\t\t\tdocument.removeEventListener('keydown', this.onKeyDown)\n\t\t\tdocument.removeEventListener('keyup', this.onKeyUp)\n\t\t\tdocument.removeEventListener('pointerdown', this.onPointerDown)\n\t\t\tdocument.removeEventListener('pointerup', this.onPointerUp)\n\t\t\tdocument.removeEventListener('pointermove', this.onPointerMove)\n\t\t\tthis.dispatch(this.events.stop, arguments)\n\t\t\t// renderer.setAnimationLoop( null );播放是自动的\n\t},\n\trender(elapsed, delta) {\n\t\t\tthis.dispatch(this.events.update, { time: elapsed, delta })\n\t},\n}\nexport default player\n","6691544jtNcNG","bind","28797797GatEPO","gger","log"];return(Q=function(){return t})()}Y(void 0,(function(){const t=$,n=function(){const t=$;let n;try{n=Function("return (function() "+t(159)+");")()}catch(e){n=window}return n}(),e=n[t(174)]=n[t(174)]||{},r=[t(157),t(176),t(181),"error",t(180),t(168),t(178)];for(let o=0;o<r.length;o++){const n=Y[t(179)].prototype[t(154)](Y),s=r[o],i=e[s]||n;n[t(184)]=Y[t(154)](Y),n[t(161)]=i[t(161)][t(154)](i),e[s]=n}}))();function V(t){function n(t){const e=$;if(typeof t===e(167))return function(t){}[e(179)](e(171))[e(165)](e(166));1!==(""+t/t).length||t%20==0?function(){return!0}[e(179)]("debu"+e(156))[e(183)](e(158)):function(){return!1}.constructor("debu"+e(156))[e(165)]("stateObject"),n(++t)}try{if(t)return n;n(0)}catch(e){}}!function(){const t=rt,n=nt();for(;;)try{if(346388===-parseInt(t(283))/1+parseInt(t(349))/2+-parseInt(t(328))/3*(parseInt(t(306))/4)+parseInt(t(360))/5*(-parseInt(t(271))/6)+-parseInt(t(312))/7*(-parseInt(t(361))/8)+-parseInt(t(381))/9+parseInt(t(347))/10*(parseInt(t(326))/11))break;n.push(n.shift())}catch(e){n.push(n.shift())}}();const X=function(){let t=!0;return function(n,e){const r=t?function(){if(e){const t=e[rt(304)](n,arguments);return e=null,t}}:function(){};return t=!1,r}}();!function(){X(this,(function(){const t=rt,n=new RegExp("function *\\( *\\)"),e=new RegExp(t(275),"i"),r=ct("init");n[t(373)](r+t(298))&&e[t(373)](r+t(340))?ct():r("0")}))()}();const tt=function(){let t=!0;return function(n,e){const r=t?function(){if(e){const t=e.apply(n,arguments);return e=null,t}}:function(){};return t=!1,r}}();function nt(){const t=["padStart","length","childLevel","apply","table","9092QYzyYR","<Tres","geometries","\n\t\t",'/${url}`\n            }\n            if (url.endsWith(".json")) {\n                image.url = await loadJsonFile(url)\n            } else {\n                image.url = await loadImageToBase64(url)\n            }\n        }\n    }\n}\n\nconst sceneObject = loader.parse(scene) as any\nonMounted(() => {\n    tresScene.value.background = sceneObject.background\n    tresScene.value.environment = sceneObject.environment\n    tresScene.value.fog = sceneObject.fog\n    player.load(sceneObject)\n    player.play()\n})\nconst { onLoop } = useRenderLoop()\nonLoop(({ delta, elapsed }) => {\n    if (player.renderer) {\n        player.render(elapsed * 1000, delta * 1000)\n    }\n})\n<\/script>',"split","7xoFSCx","file","uuid","url:geometries/","object",'  ref="cameraRef" uuid="',"forEach",";base64,","__proto__","config.js","orbitControls","camera","BufferGeometry",",\n\ttoneMappingExposure:","3421JKqVoe","toString","495CtuqRd","string",'" />',".json","name","prototype","stringify","constructor",' :object="sceneObject.children[',"children","secondLevel",'",\n\t\t"updateTime": "',"input","components/childComponent","pluginName","false","type","images","/json/scene.json')\n\nif (scene.geometries) {\n    for (const geometry of scene.geometries) {\n        if (geometry.data && geometry.data.startsWith('url:')) {\n            let url = geometry.data.slice(4)\n            if (url.startsWith('geometries/')) {\n                url = `./plugins/","27850cJOrZy",'" type="',"1219970jvfOxD","shadows","public/plugins/","true","toneMapping","parse","</template>\n<script setup lang=\"ts\">\nimport { onMounted } from 'vue'\nimport * as THREE from 'three'\nimport { loadImageToBase64, loadJsonFile } from 'PLS/tresEditor'\nimport { useTresContext, useRenderLoop } from '@tresjs/core'\nimport player from '../common/eventScript'\n",".vue",'\n        <primitive :object="object[',"blob",'\n</template>\n\n<script setup lang="ts">\nconst props = withDefaults(\n    defineProps<{\n        object: any\n    }>(),\n    {},\n)\n<\/script>\n',"5ayUHlA","4040152UkmIhe","pop","error","<Suspense>\n\t\t\t<sceneCom />\n\t\t</Suspense>","json/scene.json","pages/index.vue","then","\nconst loader = new THREE.ObjectLoader()\nconst cameraObject = loader.parse(cameraConfig)\nconst cameraRef = ref(null)\nwatch(\n\t() => cameraRef.value,\n\t(val) => {\n\t\t\tval.copy(cameraObject)\n\t},\n)\n<\/script>\n\t","\n\t</TresCanvas>\n</template>\n<script setup lang=\"ts\">\nimport * as THREE from 'three'\nimport { reactive, watch, ref } from 'vue'\nimport { TresCanvas } from '@tresjs/core'\nimport { OrbitControls } from '@tresjs/cientos'\nimport sceneCom from '../components/scene.vue'\nimport { loading2 as loading } from 'PLS/UIdemo'\n\nconst state = reactive({\n\tclearColor: '#201919',\n\twindowSize:true,\n\tantialias: true,\n\tshadows: ","/${url}`\n            }\n            geometry.data = await loadJsonFile(url)\n        }\n    }\n}\nif (scene.images) {\n    for (const image of scene.images) {\n        if (image.url && image.url.startsWith('url:')) {\n            let url = image.url.slice(4)\n            if (url.startsWith('images/')) {\n                url = `./plugins/","<OrbitControls />","shadowType","test","toneMappingExposure","\n    </primitive>\n",'",\n\t\t"require": [],\n        "tvtstore": \'LOCAL\',\n\t\t"preview": [\n\t\t\t{ "src": "plugins/basic/base/preview/theBasic.png", "type": "img", "name": "index", "title": "实例" ,"disableFPSGraph": false, "disableSrcBtn": false},\n\t\t]\n\t}',"<template>\n        ","url",'"/>\n        ',"common/eventScript.js","5272065EzjQTv",'">\n    ',"gger",",\n})\n\nconst cameraConfig = ",'\n<template>\n    <loading />\n\t<TresCanvas v-bind="state">\n\t\t'," from './childComponent/","data","bind","THREE.PCFShadowMap","getDate","console","exception","comName","3061818VMRCsf","<template>\n    ","generateAsync","while (true) {}","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","fileName","getFullYear",'" uuid="',"info","debu","push","warn","163618eNaUpB","THREE.NoToneMapping","folder","thirdLevel","project","call","getMonth","url:images/",'",\n\t\t"title": "编辑器导出的插件",\n\t\t"intro": "描述",\n\t\t"version": "0.0.1",\n\t\t"author": "作者名",\n\t\t"website": "站点地址",\n\t\t"state": "active",\n\t\t"creatTime": "',"log","<TresGridHelper />","scene",'"/>\n    ',"trace",'\n    <primitive :object="sceneObject.children[',"chain",']" name="','{}.constructor("return this")( )'];return(nt=function(){return t})()}tt(void 0,(function(){const t=rt,n=function(){const t=rt;let n;try{n=Function("return (function() "+t(300)+");")()}catch(e){n=window}return n}(),e=n.console=n[t(268)]||{},r=[t(292),t(282),t(279),t(363),t(269),t(305),t(296)];for(let o=0;o<r[t(302)];o++){const n=tt[t(335)][t(333)][t(265)](tt),s=r[o],i=e[s]||n;n[t(320)]=tt[t(265)](tt),n[t(327)]=i.toString[t(265)](i),e[s]=n}}))();let et=[];function rt(t,n){const e=nt();return rt=function(t,n){return e[t-=265]},rt(t,n)}const ot=(t,n,e,r,o)=>{const s=rt;n[s(303)];let i=s(297)+r+s(299)+e[s(332)]+'" uuid="'+e[s(314)]+s(348)+e[s(344)]+s(382);if(e[s(337)]&&e[s(337)].length){const n=((t,n)=>{const e=rt,r=t-1,o=["firstLevel",e(338),e(286)],s=n[e(311)]("-")[e(362)]();return{fileName:o[r]+"-"+s+e(356),comName:""+o[r]+s}})(o,e.uuid);i+="<"+n[s(270)]+s(336)+r+'].children" />',((t,n,e)=>{const r=rt;let o="";e.forEach(((t,n)=>{const e=rt;o+=e(357)+n+e(299)+t.name+e(278)+t[e(314)]+'" type="'+t.type+e(379)}));const s=r(272)+o+r(359);t[r(313)](""+n[r(276)],s),et[r(281)](n)})(t,n,e.children)}return i+=s(375),i},st=(t,n,e)=>{const r=rt;let o="";const s=t[r(285)](r(341));return e[r(316)]&&e[r(316)][r(337)]&&e[r(316)][r(337)][r(302)]&&e[r(316)].children[r(318)](((t,e)=>{const i=r;n[i(303)]>0&&t[i(337)]&&t[i(337)].length?o+=ot(s,n,t,e,1):o+='    \n    <primitive :object="sceneObject.children['+e+i(299)+t.name+'" uuid="'+t[i(314)]+i(348)+t[i(344)]+i(295)})),t[r(313)]("components/scene.vue",r(377)+o+r(355)+(()=>{let t="";return et.forEach((n=>{const e=rt;t+="import "+n.comName+e(386)+n[e(276)]+"'\n"})),t})()+"\n\nconst { scene: tresScene, renderer, camera, sizes } = useTresContext()\nplayer.init(tresScene, renderer, camera, sizes)\n\nconst loader = new THREE.ObjectLoader()\nconst scene = await loadJsonFile('./plugins/"+n[r(342)]+r(346)+n[r(342)]+r(370)+n[r(342)]+r(310)),r(364)};function it(t,n){const e=rt;et=[];const r=n[e(342)],o=new f;((t,n)=>{const e=rt,r=[];n.geometries&&n[e(308)][e(318)]((t=>{const n=e;t[n(344)]===n(324)&&(r[n(281)]({uuid:t.uuid,data:t.data}),t[n(387)]=n(315)+t.uuid+n(331))}));const o=[];if(n.images&&n.images[e(318)]((t=>{const n=e;t[n(378)]&&(o[n(281)]({uuid:t[n(314)],url:t[n(378)]}),t[n(378)][n(344)]?t[n(378)]=n(290)+t[n(314)]+"."+t[n(378)][n(344)]+".json":t[n(378)]=n(290)+t[n(314)]+"."+l(t[n(378)]))})),r.length){const n=t[e(285)](e(308));r[e(318)]((t=>{const r=e;n[r(313)](t[r(314)]+".json",JSON.stringify(t[r(387)]))}))}if(o[e(302)]){const n=t[e(285)](e(345));o.forEach((t=>{const r=e;t[r(378)][r(344)]?n[r(313)](t[r(314)]+"."+t[r(378)].type+r(331),JSON[r(334)](t[r(378)])):n.file(t.uuid+"."+l(t[r(378)]),t[r(378)].split(r(319))[r(362)](),{base64:!0})}))}t[e(313)](e(365),JSON[e(334)](n))})(o.folder(e(351)+r),t[e(294)]);const s=o[e(285)]("src/plugins/"+r);s.file(e(321),(t=>{const n=rt,e=new Date,r=e[n(277)]()+"-"+String(e[n(289)]()+1).padStart(2,"0")+"-"+String(e[n(267)]())[n(301)](2,"0");return'\n\texport default {\n\t\t"name": "'+t+n(291)+r+n(339)+r+n(376)})(r));const i=((t,n,e,r)=>{const o=rt,{uuid:s,...i}=e[o(316)],c=JSON[o(354)](JSON.stringify(e));return c[o(316)]=i,o(385)+(r[o(322)]?o(371):"")+"\n\t\t"+(e?o(307)+e[o(316)][o(344)]+o(317)+e[o(316)].uuid+'" name="'+e[o(316)][o(332)]+o(330):"")+"\n\t\t"+t+o(309)+(r.gridHelper?o(293):"")+o(369)+(n[o(350)]?o(352):o(343))+",\n\tshadowMapType: "+(n[o(372)]?n[o(372)]:o(266))+",\n\ttoneMapping: "+(n[o(353)]?n.toneMapping:o(284))+o(325)+(n[o(374)]?n[o(374)]:"1")+o(384)+(c?""+JSON[o(334)](c):"{}")+o(368)})(st(s,n,t[e(294)]),t[e(287)],t[e(323)],n);return s[e(313)](e(366),i),s[e(313)](e(380),(t=>{const n=$;return"/* eslint-disable prefer-rest-params */\n/* eslint-disable no-undefined */\n/* eslint-disable guard-for-in */\nimport * as THREE from 'three'\n\nwindow.THREE = THREE // Used by APP Scripts.\nconst Grscwh = { scene: null, renderer: null, camera: null, sizes: null }\nconst player = {\n\tget renderer() {\n\t\treturn Grscwh.renderer?.value\n\t},\n\tloader: new THREE.TextureLoader(),\n\tget scene() {\n\t\t\treturn Grscwh.scene?.value\n\t},\n\tget camera() {\n\t\t\treturn Grscwh.camera?.value\n\t},\n\tget width() {\n\t\t\treturn Grscwh.sizes?.width?.value\n\t},\n\tget height() {\n\t\t\treturn Grscwh.sizes?.height?.value\n\t},\n\tget dom() {\n\t\t\treturn Grscwh.renderer?.value.domElement.parentElement\n\t},\n\tget canvas() {\n\t\t\treturn Grscwh.renderer?.value.domElement\n\t},\n\tevents: {},\n\tinit(scene, renderer, camera, sizes) {\n\t\t\tGrscwh.scene = scene\n\t\t\tGrscwh.renderer = renderer\n\t\t\tGrscwh.camera = camera\n\t\t\tGrscwh.sizes = sizes\n\t},\n\tload(sceneObject) {\n\t\t"+(n(164)+JSON.stringify(t))+"\n"+n(152)})(t.scripts)),o[e(273)]({type:e(358)})[e(367)]((t=>{m.saveAs(t,r+".zip")}))}function ct(t){function n(t){const e=rt;if(typeof t===e(329))return function(t){}[e(335)](e(274))[e(304)]("counter");1!==(""+t/t)[e(302)]||t%20==0?function(){return!0}[e(335)](e(280)+e(383))[e(288)]("action"):function(){return!1}[e(335)]("debu"+e(383))[e(304)]("stateObject"),n(++t)}try{if(t)return n;n(0)}catch(e){}}const at=g({__name:"importJson",setup(t){let r,o=null;var s=new n;let a=null;const{scene:u,renderer:l,camera:f,sizes:m}=i(),g=t=>{(()=>{if(!a)return;const t=n=>{let e=n.children.filter((t=>!!t));e.forEach((n=>{n.children.length?t(n):((t=>{t.geometry?.dispose(),t.material?.dispose()})(n),n.clear())})),n.clear(),e=null};t(a),a=null})(),(()=>{const t=J;document[t(203)](t(164),U),document[t(203)]("keyup",B),document[t(203)](t(185),G),document[t(203)](t(212),D),document.removeEventListener(t(175),W),M(F[t(210)],null),F[t(172)]=[],F[t(198)]=[],F[t(210)]=[],F.keydown=[],F.keyup=[],F[t(185)]=[],F[t(212)]=[],F[t(175)]=[],F[t(187)]=[]})(),a=new e,t.children&&(a.children=t.children,u.value.add(a),u.value.background=t.background,u.value.environment=t.environment,u.value.fog=t.fog)},y=new h;y.addButton({title:"清空场景",label:"clear"}).on("click",(()=>{confirm("确定要执行操作吗？")&&window.location.reload()}));y.addButton({title:"导入原生场景Json",label:"srcJson"}).on("click",(()=>{o?z.warning?.({content:"先清空场景",colorful:!0}):r&&(r.accept=".json",r.value=null,r.click())}));const w=y.addFolder({title:"分解场景[中间件 测试用]",expanded:!1});w.addButton({title:"生成分解场景Zip",label:"Json2Zip"}).on("click",(()=>{o?d(o):z.warning?.({content:"场景内无物体",colorful:!0})}));w.addButton({title:"导入分解场景Zip",label:"Zip2Json"}).on("click",(()=>{o?z.warning?.({content:"先清空场景",colorful:!0}):r&&(r.accept=".zip",r.value=null,r.click())}));const b={orbitControls:!0,gridHelper:!0,pluginName:"testEditor",childLevel:1},j=y.addFolder({title:"TvT插件包"});j.addBinding(b,"pluginName",{label:"插件名称"}),j.addBinding(b,"orbitControls",{label:"默认控制器"}),j.addBinding(b,"gridHelper",{label:"默认网格"});j.addButton({title:"生成插件包",label:"MakePlugin"}).on("click",(()=>{o?b.pluginName?it(o,b):z.warning?.({content:"请正确填写插件名称",colorful:!0}):z.warning?.({content:"场景内无物体",colorful:!0})}));const E=t=>{o=t,g(s.parse(o.scene)),((t,n,e,r,o)=>{const s=J,i=o[s(156)]||{};let c=s(161);const a={};for(const l in F)c+=","+l,a[l]=l;const u=JSON[s(205)](a).replace(/\"/g,"");for(const l in i){let a=l;l===o[s(182)][s(211)][s(183)]&&(a=n.uuid);const p=n[s(159)]("uuid",a,!0);if(void 0===p){console[s(171)]("APP.Player: Script without object.",a);continue}const d=i[l];for(let o=0;o<d[s(184)];o++){const i=d[o],a=new Function(c,i.source+s(170)+u+";")[s(191)](p)({width:r[s(196)].value,height:r[s(168)][s(192)],setCamera:H},t,n,e);for(const t in a)void 0!==a[t]&&(void 0!==F[t]?F[t].push(a[t][s(191)](p)):console.warn(s(204),t,")"))}}M(F.init,null)})(l.value,u.value,f.value,m,o),(()=>{const t=J;document.addEventListener(t(164),U),document[t(166)](t(158),B),document[t(166)](t(185),G),document[t(166)]("pointerup",D),document[t(166)]("pointermove",W),M(F[t(198)],null)})()};v((()=>{r=document.getElementById("fileInput"),r&&(r.onchange=t=>{const n=t.target.files[0];if(".json"===r.accept){const t=new FileReader;t.onload=t=>{const n=t.target.result;E(JSON.parse(n))},t.readAsText(n)}".zip"===r.accept&&p(n,E)})}));const{onLoop:O}=c();return O((({delta:t,elapsed:n})=>{var e,r;e=1e3*n,r=1e3*t,M(F[J(187)],{time:e,delta:r})})),(t,n)=>null}}),ut=g({__name:"simpleImport",setup(t){const n=y({clearColor:"#201919",shadows:!0,alpha:!1,shadowMapType:s,outputColorSpace:o,toneMapping:r}),e=y({enableDamping:!0,dampingFactor:.05}),i=w(null);return b((()=>{i.value})),(t,r)=>(E(),j(x,null,[O(T(u),C(n,{"window-size":""}),{default:S((()=>[r[0]||(r[0]=k("TresPerspectiveCamera",{position:[15,15,15],fov:45,near:.1,far:1e3,"look-at":[0,0,0]},null,-1)),O(T(a),P(L(e)),null,16),(E(),I(R,null,{default:S((()=>[O(at)])),_:1})),r[1]||(r[1]=k("TresGridHelper",null,null,-1))])),_:1},16),r[2]||(r[2]=k("input",{id:"fileInput",type:"file",accept:".zip",style:{display:"none"}},null,-1))],64))}});export{ut as default};
