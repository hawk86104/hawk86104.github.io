import{i as e}from"./3d-tiles-renderer.CbgZh8zU1767066396612.js";import{q as t,y as a,C as l,K as o}from"./@tresjs.B1f7s3pS1767066396612.js";import{M as n}from"./mqttTvt.DdS3HDCr1767066396612.js";import{u as i,b as u,d as r,e as s,h as c,a as d,n as v,i as m,j as p}from"./naive-ui.CmwCmbKm1767066396612.js";import"./customShaderMaterial.vue_vue_type_script_setup_true_lang.DS9PWjZT1767066396612.js";import"./index.vue_vue_type_script_setup_true_lang.iYOGhvYh1767066396612.js";import{u as f}from"./index.Y8o_qofm1767066396612.js";const{defineComponent:_}=await e("vue"),{createElementVNode:b,createTextVNode:g,unref:h,withCtx:w,createVNode:y,openBlock:j,createElementBlock:T}=await e("vue"),O={class:"w-100 absolute z-99999 mqttdebugger",style:{"margin-top":"40px"}},{ref:S,onUnmounted:k,onMounted:x,watch:C,inject:M}=await e("vue"),B=_({__name:"widthMqtt",setup(e){const t=i(),a=S(!1),l=S(!1),o={host:"a5183db3.ala.asia-southeast1.emqxsl.com",port:8084,protocol:"wss",clientId:`tvt-test-client-${Math.random().toString(16).slice(2,8)}`,username:"tvt.js",password:"test",topic:"tvtDevices/#"},p=S(null),f=S(!1),_=S([]);function B(){p.value&&N(),p.value=new n(o),p.value.on("connected",()=>{f.value=!0,console.log("MQTT 连接成功"),function(){if(!p.value)return;p.value.subscribe(o.topic,e=>{e?console.error(`订阅失败: ${e.message}`):console.log(`已订阅主题: ${o.topic}`)})}()}),p.value.on("close",()=>{f.value=!1,console.log("MQTT 连接关闭")}),p.value.on("error",e=>{console.error(`MQTT 错误: ${e.message}`)}),p.value.on("message",(e,o)=>{_.value.push(`[${e}] ${JSON.stringify(o)}`),_.value.length>100&&_.value.shift(),!l.value&&o&&o.status&&(a.value="运行"===o.status),o&&o.detail&&t.info("mqtt["+o.deviceId+"] 设备详情："+o.detail+"程序已运行："+o.uptime,{keepAliveOnHover:!0,duration:18e3})}),p.value.connect()}function N(){p.value&&(p.value.removeAllListeners(),p.value.disconnect(),p.value=null,f.value=!1)}x(()=>{B()}),k(()=>{p.value,N()});let q=null;function A(e){l.value=!0;const t={deviceId:"tvtDevice001",status:e?"运行":"关闭"};p.value.publish("tvtDevices/tvtDevice001/control",t),clearTimeout(q),q=setTimeout(()=>{l.value=!1},1e3)}const P=M("animationPlay");return C(()=>a.value,e=>{P.value=e},{immediate:!0}),(e,t)=>(j(),T("div",O,[y(h(u),{title:"MQTT 调试面板",style:{"background-color":"#d6d0c540"}},{default:w(()=>[y(h(r),{label:"注意："},{default:w(()=>[y(h(s),{style:{padding:"30px 21px","line-height":"21px"},type:"warning"},{default:w(()=>[...t[1]||(t[1]=[g("免费服务每月流量/次数有限",-1),b("br",null,null,-1),g("若连接失败请自行更换自己的mqtt服务",-1)])]),_:1})]),_:1}),y(h(c),{style:{"margin-top":"-10px"}},{default:w(()=>[...t[2]||(t[2]=[g("mqtt配置信息",-1)])]),_:1}),y(h(d),{value:JSON.stringify(o,null,2),type:"textarea",rows:9,disabled:""},null,8,["value"]),y(h(c),null,{default:w(()=>[...t[3]||(t[3]=[g("连接状态",-1)])]),_:1}),y(h(r),{label:"mqtt代理通路"},{default:w(()=>[y(h(v),{value:f.value},{checked:w(()=>[...t[4]||(t[4]=[g(" 已连接 ",-1)])]),unchecked:w(()=>[...t[5]||(t[5]=[g(" 连接中 ",-1)])]),_:1},8,["value"])]),_:1}),y(h(r),{label:"订阅主题"},{default:w(()=>[y(h(d),{value:o.topic,disabled:""},null,8,["value"])]),_:1}),y(h(c),null,{default:w(()=>[...t[6]||(t[6]=[g("信息日志列表",-1)])]),_:1}),y(h(m),{log:_.value.join("\n"),rows:12},null,8,["log"]),y(h(c),null,{default:w(()=>[...t[7]||(t[7]=[g("通过mqtt交互状态",-1)])]),_:1}),t[8]||(t[8]=g(" 开关电风扇 : ",-1)),y(h(v),{loading:l.value,round:!1,value:a.value,"onUpdate:value":[t[0]||(t[0]=e=>a.value=e),A]},null,8,["loading","value"])]),_:1})]))}}),{withAsyncContext:N,defineComponent:q}=await e("vue"),{unref:A,createElementVNode:P,withCtx:F,createVNode:V,Fragment:D,openBlock:E,createElementBlock:$}=await e("vue"),I=["object"],{watch:Q,inject:L,toRaw:R}=await e("vue"),z=q({__name:"efanModel",props:{color:{type:String,required:!0}},async setup(e){let o,n;const i=e,{nodes:u,animations:r}=([o,n]=N(()=>f("https://opensource.cdn.icegl.cn/model/eCommerce/eFan/nFan.gltf")),o=await o,n(),o),s=e=>u.Sketchfab_model.getObjectByName(e).geometry.attributes.uv.array,c={Object_4:new Float32Array(s("Object_4")),Object_8:new Float32Array(s("Object_8")),Object_6:new Float32Array(s("Object_6")),Object_6001:new Float32Array(s("Object_6001"))},d=u.Sketchfab_model.getObjectByName("Object_6001"),{actions:v}=t(r,u.Sketchfab_model),m=v.Animation,p=L("animationPlay");return Q(()=>i.color,e=>{(e=>{const t={"#ff8b04":0,"#999999":.04,"#d3ac10":.19,"#ffbec4":-.06,"#d0d5c6":.55};for(const[a,l]of Object.entries(c)){for(let o=0;o<s(a).length;o++)s(a)[o]=l[o]+t[e];u.Sketchfab_model.getObjectByName(a).geometry.getAttribute("uv").needsUpdate=!0}})(e)},{immediate:!0}),Q(()=>p.value,e=>{e?(m.reset().play(),d?.rotateY(-Math.PI)):(m.fadeOut(.6).paused=!0,d?.rotateY(Math.PI))},{immediate:!0}),(e,t)=>(E(),$(D,null,[V(A(a),{range:[-.5,-.5],speed:2},{default:F(()=>[P("primitive",{position:[-2,0,0],object:R(A(u).Sketchfab_model),scale:3},null,8,I)]),_:1}),V(A(l),{opacity:.3,blur:2.6,position:[0,-2,0]})],64))}}),{defineComponent:U}=await e("vue"),{createElementVNode:H,unref:J,createVNode:Y,Suspense:G,withCtx:K,openBlock:W,createBlock:X,resolveComponent:Z,normalizeProps:ee,guardReactiveProps:te,Fragment:ae,createElementBlock:le}=await e("vue"),{ref:oe,provide:ne}=await e("vue"),{BasicShadowMap:ie,SRGBColorSpace:ue}=await e("three"),re=U({__name:"withModel",setup(e){const t={shadows:!0,alpha:!0,shadowMapType:ie,outputColorSpace:ue,windowSize:!0,clearColor:"#ffffff"},a=oe(!1);return ne("animationPlay",a),(e,a)=>{const l=Z("TresCanvas");return W(),le(ae,null,[Y(l,ee(te(t)),{default:K(()=>[a[0]||(a[0]=H("TresPerspectiveCamera",{position:[10,5,-8],fov:45,near:.1,far:1e5},null,-1)),Y(J(o),{enableDamping:""}),(W(),X(G,null,{default:K(()=>[Y(z,{color:"#ff8b04"})]),_:1})),a[1]||(a[1]=H("TresAmbientLight",{intensity:2},null,-1)),a[2]||(a[2]=H("TresPointLight",{position:[0,0,10],intensity:1},null,-1)),a[3]||(a[3]=H("TresDirectionalLight",{position:[3,3,3],intensity:3},null,-1))]),_:1},16),Y(J(p),null,{default:K(()=>[Y(B)]),_:1})],64)}}});export{re as default};
