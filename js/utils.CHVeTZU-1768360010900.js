import{importShared as t}from"./3d-tiles-renderer.CvhCoabY1768360010900.js";import{Tween as o,Easing as e}from"./tween.esm.DkV9_dcO1768360010900.js";import{loadGeojson as r}from"./utils.DNaHl0jz1768360010900.js";import{mercator as a}from"./mercator.WSW2E7OF1768360010900.js";const n=await t("three"),s=(t,r,a,n=1e3)=>{const s=t.value.position.clone(),i=a.value.target.clone(),l=r.clone(),c=r.clone();c.y=0;const u=new o({x:s.x,y:s.y,z:s.z,lookAtX:i.x,lookAtY:i.y,lookAtZ:i.z}).to({x:l.x,y:l.y,z:l.z,lookAtX:c.x,lookAtY:c.y,lookAtZ:c.z},n).easing(e.Quadratic.InOut).onUpdate(o=>{t.value.position.set(o.x,o.y,o.z),a.value.target.set(o.lookAtX,o.lookAtY,o.lookAtZ)}).start().onComplete(()=>{u.stop()});return u},i=(t,r,a,n=[-2e3,-2e3],s=1e3)=>{const i=t.position.clone(),l=a.target.clone(),c=r.clone(),u=r.clone();u.y=0,u.x=u.x+n[0],u.z=u.z+n[1];const p=new o({x:i.x,y:i.y,z:i.z,lookAtX:l.x,lookAtY:l.y,lookAtZ:l.z}).to({x:c.x,y:c.y,z:c.z,lookAtX:u.x,lookAtY:u.y,lookAtZ:u.z},s).easing(e.Quadratic.InOut).onUpdate(o=>{t.position.set(o.x,o.y,o.z),a.target.set(o.lookAtX,o.lookAtY,o.lookAtZ)}).start().onComplete(()=>{p.stop()});return p},l=async t=>{const o=await r(t),e=a().center(o[0].properties.center).translate([0,0]).scale(1e3),n=[];return o[0].geometry.coordinates[0].forEach(t=>{t.forEach(t=>{const[o,r]=e(t);n.push([o,0,r])})}),n},c=(t,o=!0,e=!0)=>{if(o||e){const r=new n.Matrix4;o&&r.multiply(t.userData.tilesData.rotationMatrix),e&&r.multiply(t.userData.tilesData.translationMatrix),t.matrixAutoUpdate=!1,t.matrix.identity(),t.matrix.copy(r)}else t.matrix.copy(t.userData.tilesData.initialMatrix);t.updateMatrixWorld(!0)},u=(t,o=!0,e=!0)=>{t.group.userData.tilesData={initialMatrix:t.group.matrix.clone()};const r=new n.Box3,a=new n.Sphere,s=new n.Vector3;if(t.getBoundingBox(r))r.getCenter(s);else{if(!t.getBoundingSphere(a))return void console.warn("tiles 没有 bounding 信息");s.copy(a.center)}const{east:i,north:l,up:u}=(t=>{const o=t.x,e=t.y;t.z;const r=Math.atan2(e,o),a=t.clone().normalize(),s=new n.Vector3(-Math.sin(r),Math.cos(r),0),i=a.clone().multiplyScalar(s.dot(a));return s.sub(i).normalize(),{east:s,north:(new n.Vector3).crossVectors(a,s).normalize(),up:a}})(s),p=(new n.Matrix4).makeBasis(i,l,u).clone().transpose();t.group.userData.tilesData.rotationMatrix=p.clone();const x=(new n.Matrix4).makeTranslation(-s.x,-s.y,-s.z);t.group.userData.tilesData.translationMatrix=x.clone(),c(t.group,o,e)},p=async t=>{if(!t.toLowerCase().endsWith(".json"))return!1;try{const o=await fetch(t);if(!o.ok)return!1;const e=await o.json(),r="object"==typeof e.asset&&void 0!==e.geometricError&&"object"==typeof e.root,a="1.0"===e.asset?.version||"1.1"===e.asset?.version;return r&&a}catch(o){return console.error("❌ 验证失败:",o),!1}};export{u as alignmentCenter,c as applyTransform,s as flyTo,i as flyToNative,l as getlinePoints,p as is3DTilesetJson};
