import{importShared as t,mergeGeometries as e}from"./3d-tiles-renderer.BWkWgmMi1767151797345.js";import{useTres as i,useLoop as o}from"./index.DdZsEhdb1767151797345.js";import{clamp as s}from"./MathUtils.WZRlVKm41767151797345.js";import{LineGeometry as n,Line2 as r}from"./Line2.BEY9ajdd1767151797345.js";import{LineMaterial as a}from"./LineSegments2.BfxFofE21767151797345.js";const c=(t,e)=>{const[i,o]=e.split("-");return Object.assign(t.style,{left:"left"===o?"0":"center"===o?"50%":"",right:"right"===o?"0":"",top:"top"===i?"0":"bottom"===i?"":"50%",bottom:"bottom"===i?"0":"",transform:`${"center"===o?"translateX(-50%)":""} ${"center"===i?"translateY(-50%)":""}`}),e},{Vector3:l}=await t("three"),h=[["x",0,3],["y",1,4],["z",2,5]],p=new l;function d({isSphere:t},e,i){t&&(p.set(0,0,1).applyQuaternion(i.quaternion),h.forEach(([t,i,o])=>{const n=p[t];let r=e[i],a=r.userData.opacity;r.material.opacity=s(n>=0?a:a/2,0,1),r=e[o],a=r.userData.opacity,r.material.opacity=s(n>=0?a/2:a,0,1)}))}const{Vector2:u,Raycaster:m}=await t("three"),_=new m,g=new u,f=(t,e,i,o)=>{g.set((t.clientX-e.left)/e.width*2-1,-(t.clientY-e.top)/e.height*2+1),_.setFromCamera(g,i);const s=_.intersectObjects(o,!1),n=s.length?s[0]:null;return n&&n.object.visible?n:null},w=1e-6,y=2*Math.PI,b=["x","y","z"],v=[...b,"nx","ny","nz"],S=["right","top","front","left","bottom","back"],E=(t,e=!0)=>{const{material:i,userData:o}=t,{color:s,opacity:n}=e?o.hover:o;i.color.set(s),i.opacity=n},M=t=>JSON.parse(JSON.stringify(t));function x(t,...e){if(t instanceof HTMLElement||"object"!=typeof t||null===t)return t;for(const i of e)for(const e in i)"container"!==e&&e in i&&(void 0===t[e]?t[e]=i[e]:"object"!=typeof i[e]||Array.isArray(i[e])||(t[e]=x(t[e]||{},i[e])));return t}const{CanvasTexture:C,Color:k,RepeatWrapping:L,SRGBColorSpace:P}=await t("three"),z=(t,e=2)=>{const i=new k,o=2*e,{isSphere:s,resolution:n,radius:r,font:a,corners:c,edges:l}=t,h=v.map(e=>({...t[e],radius:r}));s&&c.enabled&&h.push(c),s&&l.enabled&&h.push(l);const p=document.createElement("canvas"),d=p.getContext("2d");p.width=2*n+2*o,p.height=n*h.length+o*h.length;const[u,m]=function(t,e,i){const o=[...t].sort((t,e)=>(t.label?.length||0)-(e.label?.length||0)).pop().label,{family:n,weight:r}=i,a=s?Math.sqrt(Math.pow(.7*e,2)/2):e;let c=a,l=0,h=0;do{d.font=`${r} ${c}px ${n}`;const t=d.measureText(o);l=t.width,h=t.fontBoundingBoxDescent,c--}while(l>a&&c>0);const p=a/h,u=Math.min(a/l,p),m=Math.floor(c*u);return[`${r} ${m}px ${n}`,p]}(h,n,a);h.forEach(({radius:t,label:i,color:s,labelColor:r,border:a,hover:{color:c,labelColor:l,border:h}},p)=>{const d=n*p+p*o+e;b(e,d,e,n,t,i,a,s,r),b(n+3*e,d,e,n,t,i,h??a,c??s,l??r)});const _=h.length,g=e/(2*n),f=e/(6*n),w=1/_,y=new C(p);return y.repeat.set(.5-2*g,w-2*f),y.offset.set(g,1-f),Object.assign(y,{colorSpace:P,wrapS:L,wrapT:L,userData:{offsetX:g,offsetY:f,cellHeight:w}}),y;function b(t,e,o,n,r,a,c,l,h){if(r*=n/2,null!=l&&""!==l&&(p(),d.fillStyle=i.set(l).getStyle(),d.fill()),c&&c.size){const o=c.size*n/2;t+=o,e+=o,n-=c.size*n,r=Math.max(0,r-o),p(),d.strokeStyle=i.set(c.color).getStyle(),d.lineWidth=c.size*n,d.stroke()}function p(){d.beginPath(),d.moveTo(t+r,e),d.lineTo(t+n-r,e),d.arcTo(t+n,e,t+n,e+r,r),d.lineTo(t+n,e+n-r),d.arcTo(t+n,e+n,t+n-r,e+n,r),d.lineTo(t+r,e+n),d.arcTo(t,e+n,t,e+n-r,r),d.lineTo(t,e+r),d.arcTo(t,e,t+r,e,r),d.closePath()}a&&function(t,e,i,o,n){t.font=u,t.textAlign="center",t.textBaseline="middle",t.fillStyle=n,t.fillText(o,e,i+(s?m:0))}(d,t+n/2,e+(n+o)/2,a,i.set(h).getStyle())}},A=(t,e)=>{const{offset:i,userData:{offsetY:o,cellHeight:s}}=t;i.y=1-(e+1)*s+o},{BufferGeometry:O,BufferAttribute:T}=await t("three");function V(t,e,i=2,o=2){const s=i/2-t,n=o/2-t,r=t/i,a=(i-t)/i,c=t/o,l=(o-t)/o,h=[s,n,0,-s,n,0,-s,-n,0,s,-n,0],p=[a,l,r,l,r,c,a,c],d=[3*(e+1)+3,3*(e+1)+4,e+4,e+5,2*(e+1)+4,2,1,2*(e+1)+3,3,4*(e+1)+3,4,0],u=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11].map(t=>d[t]);let m,_,g,f,w,y,b,v;for(let S=0;S<4;S++){f=S<1||S>2?s:-s,w=S<2?n:-n,y=S<1||S>2?a:r,b=S<2?l:c;for(let i=0;i<=e;i++)m=Math.PI/2*(S+i/e),_=Math.cos(m),g=Math.sin(m),h.push(f+t*_,w+t*g,0),p.push(y+r*_,b+c*g),i<e&&(v=(e+1)*S+i+4,u.push(S,v,v+1))}return(new O).setIndex(new T(new Uint32Array(u),1)).setAttribute("position",new T(new Float32Array(h),3)).setAttribute("uv",new T(new Float32Array(p),2))}const{Mesh:q,MeshBasicMaterial:D,Sprite:R,SpriteMaterial:j,Vector3:B}=await t("three"),{Mesh:$,MeshBasicMaterial:F,Sprite:Y,SpriteMaterial:I,Vector3:Q}=await t("three"),{Mesh:X,MeshBasicMaterial:H,Sprite:U,SpriteMaterial:W,Vector3:N}=await t("three"),{BackSide:G,Mesh:J,MeshBasicMaterial:Z,SphereGeometry:K}=await t("three"),{Color:tt,Vector2:et}=await t("three"),it=t=>{const{corners:i,edges:o}=t,s=[],c=z(t),l=((t,e)=>{const i=new B,{isSphere:o,radius:s,smoothness:n}=t,r=V(s,n);return v.map((s,n)=>{const a=n<3,c=v[n],l=n?e.clone():e;A(l,n);const{enabled:h,scale:p,opacity:d,hover:u}=t[c],m={map:l,opacity:d,transparent:!0},_=o?new R(new j(m)):new q(r,new D(m)),g=a?c:c[1];return _.position[g]=(a?1:-1)*(o?1.3:1),o||_.lookAt(i.copy(_.position).multiplyScalar(1.7)),_.scale.setScalar(p),_.renderOrder=1,_.visible=h,_.userData={scale:p,opacity:d,hover:u},_})})(t,c);s.push(...l),i.enabled&&s.push(...((t,e)=>{const{isSphere:i,corners:o}=t;if(!o.enabled)return[];const{color:s,opacity:n,scale:r,radius:a,smoothness:c,hover:l}=o,h=i?null:V(a,c),p={transparent:!0,opacity:n},d=[1,1,1,-1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,-1,-1,-1,-1,-1].map(t=>.85*t),u=new Q;return Array(d.length/3).fill(0).map((t,o)=>{if(i){const t=e.clone();A(t,6),p.map=t}else p.color=s;const a=i?new Y(new I(p)):new $(h,new F(p)),c=3*o;return a.position.set(d[c],d[c+1],d[c+2]),i&&a.position.normalize().multiplyScalar(1.7),a.scale.setScalar(r),a.lookAt(u.copy(a.position).multiplyScalar(2)),a.renderOrder=1,a.userData={color:s,opacity:n,scale:r,hover:l},a})})(t,c)),o.enabled&&s.push(...((t,e,i)=>{const{isSphere:o,edges:s}=t;if(!s.enabled)return[];const{color:n,opacity:r,scale:a,hover:c,radius:l,smoothness:h}=s,p=o?null:V(l,h,1.2,.25),d={transparent:!0,opacity:r},u=[0,1,1,0,-1,1,1,0,1,-1,0,1,0,1,-1,0,-1,-1,1,0,-1,-1,0,-1,1,1,0,1,-1,0,-1,1,0,-1,-1,0].map(t=>.925*t),m=new N;return Array(u.length/3).fill(0).map((t,s)=>{if(o){const t=e.clone();A(t,i),d.map=t}else d.color=n;const l=o?new U(new W(d)):new X(p,new H(d)),h=3*s;return l.position.set(u[h],u[h+1],u[h+2]),o&&l.position.normalize().multiplyScalar(1.7),l.scale.setScalar(a),l.lookAt(m.copy(l.position).multiplyScalar(2)),o||l.position.y||(l.rotation.z=Math.PI/2),l.renderOrder=1,l.userData={color:n,opacity:r,scale:a,hover:c},l})})(t,c,i.enabled?7:6));const h=((t,i)=>{const{isSphere:o,background:{enabled:s,color:n,opacity:r,hover:a}}=i;let c;const l=new Z({color:n,side:G,opacity:r,transparent:!0,depthWrite:!1});if(!s)return null;if(o)c=new J(new K(1.8,64,64),l);else{let i;t.forEach(t=>{const o=t.scale.x;t.scale.setScalar(.9),t.updateMatrix();const s=t.geometry.clone();s.applyMatrix4(t.matrix),i=i?e([i,s]):s,t.scale.setScalar(o)}),c=new J(i,l)}return c.userData={color:n,opacity:r,hover:a},c})(l,t),p=(t=>{const e=new tt,i=[],o=[],{isSphere:s}=t;if(v.forEach((n,r)=>{const{enabled:a,line:c,scale:l,color:h}=t[n];if(!a||!c)return;const p=(s?1.3-l/2:.975)*(r<3?1:-1);i.push(n.includes("x")?p:0,n.includes("y")?p:0,n.includes("z")?p:0,0,0,0);const d=e.set(h).toArray();o.push(...d,...d)}),!i.length)return null;const c=(new n).setPositions(i).setColors(o),l=new a({linewidth:t.lineWidth,vertexColors:!0,resolution:new et(window.innerWidth,window.innerHeight)});return new r(c,l).computeLineDistances()})(t);return[s,h,p]},ot=(t,e=!0)=>{const{material:i,userData:o}=t,{opacity:s,color:n,scale:r}=e?o.hover:o;var a,c;t.scale.setScalar(r),i.opacity=s,i.map?(a=i.map,c=e,a.offset.x=(c?.5:0)+a.userData.offsetX):i.color.set(n)},{Clock:st,Matrix4:nt,Object3D:rt,OrthographicCamera:at,PerspectiveCamera:ct,Quaternion:lt,Spherical:ht,Vector2:pt,Vector3:dt,Vector4:ut}=await t("three"),mt=new nt,_t=new ht,gt=new dt,ft=new pt;class wt extends rt{constructor(t,e,i={}){super(),this.type="ViewportGizmo",this.enabled=!0,this.target=new dt,this.animated=!0,this.speed=1,this.animating=!1,this._background=null,this._viewport=new ut,this._originalViewport=new ut,this._originalScissor=new ut,this._dragging=!1,this._distance=0,this._clock=new st,this._targetPosition=new dt,this._targetQuaternion=new lt,this._quaternionStart=new lt,this._quaternionEnd=new lt,this._pointerStart=new pt,this._focus=null,this.camera=t,this.renderer=e,this.set(i)}get placement(){return this._placement}set placement(t){this._placement=c(this._domElement,t),this.domUpdate()}set(t={}){this.dispose(),this.options=t,this._options=(t=>{const e=t.type||"sphere",i="sphere"===e,o=t.resolution||i?64:128,{container:s}=t;t.container=void 0,(t=JSON.parse(JSON.stringify(t))).container=s,S.forEach((e,i)=>{t[e]&&(t[v[i]]=t[e])});const n={enabled:!0,color:16777215,opacity:1,scale:.7,labelColor:2236962,line:!1,border:{size:0,color:14540253},hover:{color:i?16777215:9688043,labelColor:2236962,opacity:1,scale:.7,border:{size:0,color:14540253}}},r={line:!1,scale:i?.45:.7,hover:{scale:i?.5:.7}},a={type:e,container:document.body,size:128,placement:"top-right",resolution:o,lineWidth:20,radius:i?1:.2,smoothness:18,animated:!0,speed:1,background:{enabled:!0,color:i?16777215:14739180,opacity:i?0:1,hover:{color:i?16777215:14739180,opacity:i?.2:1}},font:{family:"sans-serif",weight:900},offset:{top:10,left:10,bottom:10,right:10},corners:{enabled:!i,color:i?15915362:16777215,opacity:1,scale:i?.15:.2,radius:1,smoothness:18,hover:{color:i?16777215:9688043,opacity:1,scale:i?.2:.225}},edges:{enabled:!i,color:i?15915362:16777215,opacity:i?1:0,radius:i?1:.125,smoothness:18,scale:i?.15:1,hover:{color:i?16777215:9688043,opacity:1,scale:i?.2:1}},x:{...M(n),...i?{label:"X",color:16725587,line:!0}:{label:"Right"}},y:{...M(n),...i?{label:"Y",color:9100032,line:!0}:{label:"Top"}},z:{...M(n),...i?{label:"Z",color:2920447,line:!0}:{label:"Front"}},nx:{...M(r),label:i?"":"Left"},ny:{...M(r),label:i?"":"Bottom"},nz:{...M(r),label:i?"":"Back"}};return x(t,a),b.forEach(e=>x(t[`n${e}`],M(t[e]))),{...t,isSphere:i}})(t),this._camera=this._options.isSphere?new at(-1.8,1.8,1.8,-1.8,5,10):new ct(26,1,5,10),this._camera.position.set(0,0,7);const[e,i,o]=it(this._options);i&&this.add(i),o&&this.add(o),this.add(...e),this._background=i,this._intersections=e;const{container:s,animated:n,speed:r}=this._options;return this.animated=n,this.speed=r,this._container=s?(t=>{const e="string"==typeof t?document.querySelector(t):t;if(!e)throw Error("Invalid DOM element");return e})(s):document.body,this._domElement=(({placement:t,size:e,offset:i,id:o,className:s})=>{const n=document.createElement("div"),{top:r,left:a,right:l,bottom:h}=i;return Object.assign(n.style,{id:o,position:"absolute",zIndex:"1000",height:`${e}px`,width:`${e}px`,margin:`${r}px ${l}px ${h}px ${a}px`,borderRadius:"100%"}),c(n,t),o&&(n.id=o),s&&(n.className=s),n})(this._options),this._domElement.onpointerdown=t=>this._onPointerDown(t),this._domElement.onpointermove=t=>this._onPointerMove(t),this._domElement.onpointerleave=()=>this._onPointerLeave(),this._container.appendChild(this._domElement),this._controls&&this.attachControls(this._controls),this.update(),this}render(){this.animating&&this._animate();const{renderer:t,_viewport:e}=this,i=t.getScissorTest(),o=t.autoClear;return t.autoClear=!1,t.setViewport(e),i&&t.setScissor(e),t.clear(!1,!0,!1),t.render(this,this._camera),t.setViewport(this._originalViewport),i&&t.setScissor(this._originalScissor),t.autoClear=o,this}domUpdate(){this._domRect=this._domElement.getBoundingClientRect();const t=this.renderer,e=this._domRect,i=t.domElement.getBoundingClientRect();return this._viewport.set(e.left-i.left,t.domElement.clientHeight-(e.top-i.top+e.height),e.width,e.height),t.getViewport(this._originalViewport),t.getScissorTest()&&t.getScissor(this._originalScissor),this}cameraUpdate(){return this._updateOrientation(),this}update(t=!0){return t&&this._controls&&this._controls.update(),this.domUpdate().cameraUpdate()}attachControls(t){return this.detachControls(),this.target=t.target,this._controlsListeners={start:()=>t.enabled=!1,end:()=>t.enabled=!0,change:()=>this.update(!1)},this.addEventListener("start",this._controlsListeners.start),this.addEventListener("end",this._controlsListeners.end),t.addEventListener("change",this._controlsListeners.change),this._controls=t,this}detachControls(){if(this._controlsListeners&&this._controls)return this.target=(new dt).copy(this._controls.target),this.removeEventListener("start",this._controlsListeners.start),this.removeEventListener("end",this._controlsListeners.end),this._controls.removeEventListener("change",this._controlsListeners.change),this._controlsListeners=void 0,this._controls=void 0,this}dispose(){this.detachControls(),this.children.forEach(t=>{this.remove(t);const e=t;e.material?.dispose(),e.material?.map?.dispose(),e.geometry?.dispose()}),this._domElement?.remove()}_updateOrientation(t=!0){t&&(this.quaternion.copy(this.camera.quaternion).invert(),this.updateMatrixWorld()),d(this._options,this._intersections,this.camera)}_animate(){const{position:t,quaternion:e}=this.camera;if(t.set(0,0,1),!this.animated)return t.applyQuaternion(this._quaternionEnd).multiplyScalar(this._distance).add(this.target),e.copy(this._targetQuaternion),this._updateOrientation(),this.animating=!1,this.dispatchEvent({type:"change"}),void this.dispatchEvent({type:"end"});const i=this._clock.getDelta()*y*this.speed;this._quaternionStart.rotateTowards(this._quaternionEnd,i),t.applyQuaternion(this._quaternionStart).multiplyScalar(this._distance).add(this.target),e.rotateTowards(this._targetQuaternion,i),this._updateOrientation(),requestAnimationFrame(()=>this.dispatchEvent({type:"change"})),this._quaternionStart.angleTo(this._quaternionEnd)<w&&(this.animating=!1,this.dispatchEvent({type:"end"}))}_setOrientation(t){const e=this.camera,i=this.target;this._targetPosition.copy(t).multiplyScalar(this._distance),mt.setPosition(this._targetPosition).lookAt(this._targetPosition,this.position,this.up),this._targetQuaternion.setFromRotationMatrix(mt),this._targetPosition.add(i),mt.lookAt(this._targetPosition,i,this.up),this._quaternionEnd.setFromRotationMatrix(mt),mt.setPosition(e.position).lookAt(e.position,i,this.up),this._quaternionStart.setFromRotationMatrix(mt),this.animating=!0,this._clock.start(),this.dispatchEvent({type:"start"})}_onPointerDown(t){if(!this.enabled)return;const e=t=>{if(!this._dragging){if(((t,e,i=10)=>Math.abs(t.clientX-e.x)<i&&Math.abs(t.clientY-e.y)<i)(t,this._pointerStart))return;this._dragging=!0}const e=ft.set(t.clientX,t.clientY).sub(this._pointerStart).multiplyScalar(1/this._domRect.width*Math.PI),i=_t.setFromVector3(gt.subVectors(this.camera.position,this.target));i.theta=n-e.x,i.phi=s(r-e.y,w,Math.PI-w),this.camera.position.setFromSpherical(i).add(this.target),this.camera.lookAt(this.target),this.quaternion.copy(this.camera.quaternion).invert(),this._updateOrientation(!1),this.dispatchEvent({type:"change"})},i=()=>{if(document.removeEventListener("pointermove",e,!1),document.removeEventListener("pointerup",i,!1),!this._dragging)return this._handleClick(t);this._focus&&(ot(this._focus,!1),this._focus=null),this._dragging=!1,this.dispatchEvent({type:"end"})};if(this.animating)return;t.preventDefault(),this._pointerStart.set(t.clientX,t.clientY);const o=(new ht).setFromVector3(gt.subVectors(this.camera.position,this.target)),n=o.theta,r=o.phi;this._distance=o.radius,document.addEventListener("pointermove",e,!1),document.addEventListener("pointerup",i,!1),this.dispatchEvent({type:"start"})}_onPointerMove(t){this.enabled&&!this._dragging&&(this._background&&E(this._background,!0),this._handleHover(t))}_onPointerLeave(){this.enabled&&!this._dragging&&(this._background&&E(this._background,!1),this._focus&&ot(this._focus,!1),this._domElement.style.cursor="")}_handleClick(t){const e=f(t,this._domRect,this._camera,this._intersections);this._focus&&(ot(this._focus,!1),this._focus=null),e&&(this._setOrientation(e.object.position),this.dispatchEvent({type:"change"}))}_handleHover(t){const e=f(t,this._domRect,this._camera,this._intersections),i=e?.object||null;this._focus!==i&&(this._domElement.style.cursor=i?"pointer":"",this._focus&&ot(this._focus,!1),(this._focus=i)?ot(i,!0):d(this._options,this._intersections,this.camera))}}const{defineComponent:yt}=await t("vue"),{watch:bt,toRaw:vt,useAttrs:St}=await t("vue"),Et=yt({__name:"viewportGizmo",setup(t){const{camera:e,controls:s,renderer:n,sizes:r}=i(),a=St(),c={...vt(a)},l=new wt(vt(e.value),vt(n),c);bt(()=>s.value,t=>{t&&(l.attachControls(vt(t)),console.log("gizmo attached to controls"))},{immediate:!0}),bt([r.width,r.height],()=>{l.update()},{immediate:!0});const{onRender:h}=o();return h(()=>{l.render()},1),(t,e)=>null}});export{Et as _sfc_main};
