import{au as x,av as f,a1 as W,ak as S,az as w,bk as z,b3 as g,a6 as I,w as M,o as v,c as T,L,a9 as R,ad as Z,a2 as _,aq as U,a4 as j,a5 as E,r as A,a as b,E as k,a8 as y,G as D,x as G,ag as F}from"./vendor.lj85K5ev1716383888730.js";import{u as N,a as C}from"./utils.lL21jvBF1716383888730.js";import{U as O,b as Q,c as B,M as V,P as Y,a as q,T as H,O as $,d,r as J}from"./raycasterEvent.Ygvi5a571716383888730.js";import"./HeightCorrection.c8NcwD5G1716383888730.js";import"./vanilla.M8EuyDnu1716383888730.js";import"./ExtensionUtilities.raU9Zim01716383888730.js";import"./_commonjsHelpers.5-cIlDoe1716383888730.js";import"./_commonjs-dynamic-modules.h-SxKiO41716383888730.js";function K(c){return new Worker(""+new URL("../static/MartiniWorker-kcpPhwaW.js",import.meta.url).href,{name:c==null?void 0:c.name})}class X{constructor(){this.maxZoom=12,this.coordType=O,this.utmZone=50,this._useWorker=!0,this.source="https://api.maptiler.com/tiles/terrain-rgb-v2/[z]/[x]/[y].webp?key=L55MtSxL94Yb4hQeWewp"}set useWorker(o){var e;this._useWorker=o,this._useWorker||((e=this._worker)==null||e.terminate(),this._worker=void 0)}get useWorker(){return this._useWorker}async getTile(o){return this._useWorker?this.getInWorkerThread(o):this.getInMainThread()}async getInMainThread(){return new x}async getInWorkerThread(o){this._worker||(this._worker=new Q(K));const e={tileNo:o,id:this.getId(o),url:this.getUrl(o),maxZ:this.maxZoom,coordType:this.coordType,utmZone:this.utmZone},r=await this._worker.postMessage(e),n=new x;return n.setAttribute("position",new f(r.positions,3)),n.setAttribute("uv",new f(r.uv,2)),n.setIndex(new f(r.triangles,1)),n}async abort(o){var e;this._useWorker&&((e=this._worker)==null||e.postMessage({id:this.getId(o),abort:!0}))}async dispose(o,e){var r;e.dispose(),this._useWorker&&((r=this._worker)==null||r.postMessage({id:this.getId(o),dispose:!0}))}getId(o){return o.join("-")}getUrl(o){const[e,r,n]=o;return this.source.replace("[x]",e+"").replace("[y]",r+"").replace("[z]",n+"")}}const ee=["object","rotation"],te=W({__name:"tileMapMesh",props:{bbox:{default:[104.955976,20.149765,120.998419,30.528687]},maxZoom:{default:20},opposite:{type:Boolean,default:!1},genBright:{default:1},genContrast:{default:1},genSaturation:{default:1},monochrome:{default:"#fff"},isMonochrome:{type:Boolean,default:!1},mapCenter:{}},setup(c,{expose:o}){const e=c,{renderer:r,scene:n}=S(),p=new Y;p.coordType=B;const m=new X;m.source="https://api.maptiler.com/tiles/terrain-rgb-v2/[z]/[x]/[y].webp?key=L55MtSxL94Yb4hQeWewp",m.coordType=B;const u=new q;u.source="https://webrd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",u.showTileNo=!1,u.useWorker=!0;const t=new H(m,u);if(t.showBoundingBox=!1,t.wireframe=!1,t.flatShading=!1,t.useStandardMaterial=!1,t.filter={opposite:e.opposite,monochrome:e.isMonochrome?{r:.299,g:.587,b:.114}:null,genBright:e.genBright,genContrast:e.genContrast,genSaturation:e.genSaturation},e.monochrome){let i=new w(e.monochrome);t.filter&&(t.filter.monochrome={r:i.r,g:i.g,b:i.b})}const s=new V;s.provider=t,s.bbox=e.bbox,s.maxZoom=e.maxZoom;const a=new z(60,window.innerWidth/window.innerHeight,1,1e7*10);a.up=new g(0,1,0),a.position.set(e.mapCenter[0],e.mapCenter[2],-e.mapCenter[1]),a.lookAt(new g(a.position.x,0,a.position.z-2e3)),s.camera=a;let l=null;I(()=>{if(r.value&&!l&&(l=new $(a,r.value.domElement),l.enableDamping=!0,l.dampingFactor=.05,l.minDistance=600,l.position0.set(a.position.x,a.position.y,a.position.z),l.target.set(a.position.x,0,a.position.z-2e3)),e.genBright&&t.filter&&(t.filter.genBright=e.genBright),e.genContrast&&t.filter&&(t.filter.genContrast=e.genContrast),e.genSaturation&&t.filter&&(t.filter.genSaturation=e.genSaturation),e.isMonochrome&&e.monochrome&&t.filter){let i=new w(e.monochrome);t.filter.monochrome={r:i.r,g:i.g,b:i.b}}}),M(()=>e.opposite,i=>{t.filter&&(t.filter.opposite=i)}),M(()=>e.isMonochrome,i=>{let h=new w(e.monochrome);t.filter&&(t.filter.monochrome=i?{r:h.r,g:h.g,b:h.b}:null)});const{onLoop:P}=R();return P(()=>{if(r.value){N(),l&&l.update(),s.update();const i=Math.abs(a.position.y)*50;a.far=i+5e3,a.updateProjectionMatrix(),l.target.y=0,r.value.render(n.value,a)}}),o({camera:a,map:s,orbitControl:l}),(i,h)=>(v(),T("primitive",{object:L(s),rotation:[-Math.PI/2,0,0]},null,8,ee))}}),ce=W({__name:"tileMap",setup(c){const o=d(118.779958,32.017136),e=[o[0],o[1],5e3],r=Z(),n=_({opposite:!0,genBright:1.3,genContrast:1,genSaturation:1,isMonochrome:!0,monochrome:"#4688b5",mapCenter:e}),p=new U({title:"参数"});p.addBinding(n,"opposite",{label:"反色"}),p.addBinding(n,"genBright",{label:"高亮",min:.1,max:3,step:.1}),p.addBinding(n,"genContrast",{label:"对比度",min:.1,max:3,step:.1}),p.addBinding(n,"genSaturation",{label:"饱和度",min:.1,max:3,step:.1}),p.addBinding(n,"isMonochrome",{label:"单色滤镜"}),p.addBinding(n,"monochrome",{label:"滤镜颜色"});const m={at:d(118.7425,31.9998),xjk:d(118.7842,32.0418),nss:d(118.7503,31.9082)};p.addBlade({view:"list",label:"飞去",options:[{text:"奥体中心",value:"at"},{text:"新街口",value:"xjk"},{text:"牛首山",value:"nss"}],value:"at"}).on("change",t=>{const s=new g(m[t.value][0],2e3,-m[t.value][1]);C(r.value.camera,s,r.value.orbitControl,[0,-300],4e3)});const u=_({clearColor:"#201919",antialias:!0,logarithmicDepthBuffer:!0,disableRender:!0,outputColorSpace:j,toneMapping:E,precision:"highp"});return setTimeout(()=>{const t=m.at,s=new g(t[0],1600,-t[1]);C(r.value.camera,s,r.value.orbitControl,[-2e3,-2e3],2e3)},1e3),(t,s)=>{const a=A("TresCanvas");return v(),T(D,null,[b(a,y(u,{"window-size":""}),{default:k(()=>[(v(),G(F,null,{default:k(()=>[b(te,y(n,{ref_key:"tileMapMeshRef",ref:r,bbox:[80,16,128,50]}),null,16)]),_:1}))]),_:1},16),b(J,{tileMapRef:r.value},null,8,["tileMapRef"])],64)}}});export{ce as default};
