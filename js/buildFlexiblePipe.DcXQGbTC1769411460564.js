import{importShared as e}from"./3d-tiles-renderer.HXNTGnH81769411460564.js";const n=await e("three");class t extends n.Curve{constructor(e,n,t,o,l,c){super(),this.center=e.clone(),this.xAxis=n.clone().normalize(),this.yAxis=t.clone().normalize(),this.radius=o,this.startAngle=l,this.deltaAngle=c}getPoint(e,t){const o=this.startAngle+this.deltaAngle*e,l=Math.cos(o),c=Math.sin(o);return(t||new n.Vector3).copy(this.xAxis).multiplyScalar(l*this.radius).addScaledVector(this.yAxis,c*this.radius).add(this.center)}}function o(e,o,l=16){const c=1e-6,a=new n.CurvePath;if(e.length<2)return a;let i=e[0].clone();const s=(e,n)=>e.distanceToSquared(n)<1e-8;for(let d=1;d<e.length-1;d++){const l=e[d-1].clone(),r=e[d].clone(),h=e[d+1].clone(),u=l.clone().sub(r),m=h.clone().sub(r),M=u.length(),g=m.length();if(M<c||g<c){s(i,r)||a.add(new n.LineCurve3(i.clone(),r.clone())),i=r.clone();continue}const f=u.clone().normalize(),w=m.clone().normalize(),p=n.MathUtils.clamp(f.dot(w),-1,1),v=Math.acos(p);if(v<1e-4){s(i,r)||a.add(new n.LineCurve3(i.clone(),r.clone())),i=r.clone();continue}const x=o/Math.tan(v/2),C=Math.min(M,g)-1e-6,z=Math.min(x,Math.max(0,C));if(z<=1e-6){s(i,r)||a.add(new n.LineCurve3(i.clone(),r.clone())),i=r.clone();continue}const A=z*Math.tan(v/2),y=f.clone().add(w);if(y.length()<1e-6){s(i,r)||a.add(new n.LineCurve3(i.clone(),r.clone())),i=r.clone();continue}const L=y.clone().normalize(),S=A/Math.sin(v/2),P=r.clone().add(L.multiplyScalar(S)),b=r.clone().add(f.clone().multiplyScalar(z)),I=r.clone().add(w.clone().multiplyScalar(z)),q=b.clone().sub(P);let T=q.clone().normalize();const V=u.clone().cross(m);if(V.length()<1e-7){s(i,r)||a.add(new n.LineCurve3(i.clone(),r.clone())),i=r.clone();continue}const j=V.clone().normalize().cross(T).normalize(),U=Math.atan2(q.dot(j),q.dot(T)),k=I.clone().sub(P);let B=Math.atan2(k.dot(j),k.dot(T))-U;for(;B<=-Math.PI;)B+=2*Math.PI;for(;B>Math.PI;)B-=2*Math.PI;s(i,b)||a.add(new n.LineCurve3(i.clone(),b.clone()));const D=new t(P,T,j,A,U,B);a.add(D),i=I.clone()}const r=e[e.length-1].clone();return!i.equals(r)&&i.distanceToSquared(r)>1e-8&&a.add(new n.LineCurve3(i.clone(),r.clone())),a}export{o as buildRoundedPath};
