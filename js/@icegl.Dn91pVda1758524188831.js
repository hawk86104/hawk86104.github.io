import{d as e,i as t,a0 as i,b as n,v as s,G as r,s as o,w as a,V as l,o as c,N as h,u,J as d,a1 as p,R as m,a2 as f,a as g,p as v,q as _,E as y,F as x,D as b,r as w,L as T,t as A,A as M,a3 as S,a4 as E,e as P,H as C,I as R,f as L,j as D,a5 as O,a6 as k,a7 as I,a8 as F,m as U,a9 as B}from"./@vue.pEDXJ_3Z1758524188831.js";import{p as z,K as N,q as j,o as H,W as G,N as V,X as W,Y as K,_ as X,C as q,b as Y,$ as Z,c as $,a0 as Q,a1 as J,a2 as ee,a as te,V as ie,T as ne,A as se,a3 as re,l as oe,U as ae,a4 as le,a5 as ce,a6 as he,a7 as ue,u as de,r as pe,a8 as me,a9 as fe,n as ge,aa as ve,ab as _e,ac as ye,ad as xe,ae as be,af as we,ag as Te,ah as Ae,B as Me,k as Se,ai as Ee,aj as Pe,t as Ce,ak as Re,O as Le,al as De,am as Oe,an as ke,f as Ie,ao as Fe,ap as Ue,aq as Be,E as ze,M as Ne,P as je,d as He,R as Ge,Q as Ve,h as We,ar as Ke,as as Xe,L as qe,S as Ye,at as Ze,au as $e,av as Qe,aw as Je,ax as et,e as tt,F as it,ay as nt,az as st,z as rt,D as ot,I as at,aA as lt,aB as ct,aC as ht,aD as ut,H as dt,m as pt,i as mt,g as ft,aE as gt,aF as vt,aG as _t,aH as yt,aI as xt,aJ as bt,aK as wt,aL as Tt,aM as At,aN as Mt,aO as St,aP as Et,aQ as Pt,aR as Ct,aS as Rt,aT as Lt,aU as Dt,aV as Ot,aW as kt,aX as It,aY as Ft,aZ as Ut,a_ as Bt,J as zt,a$ as Nt,b0 as jt,b1 as Ht,b2 as Gt,b3 as Vt,b4 as Wt,b5 as Kt,b6 as Xt,b7 as qt}from"./three.CC50Wz7a1758524188831.js";import{u as Yt,c as Zt,a as $t,b as Qt,t as Jt,d as ei,e as ti,r as ii,f as ni,g as si,h as ri,i as oi,j as ai}from"./@vueuse.C-O_6is-1758524188831.js";var li=Object.defineProperty,ci=(e,t,i)=>((e,t,i)=>t in e?li(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);const hi={name:"@tresjs/core",type:"module",version:"4.3.6",packageManager:"pnpm@10.6.3",description:"Declarative ThreeJS using Vue Components",author:"Alvaro Saburido <hola@alvarosaburido.dev> (https://github.com/alvarosabu/)",license:"MIT",repository:{type:"git",url:"git+https://github.com/Tresjs/tres.git"},keywords:["vue","3d","threejs","three","threejs-vue"],sideEffects:!1,exports:{".":{types:"./dist/index.d.ts",import:"./dist/tres.js",require:"./dist/tres.umd.cjs"},"./components":{types:"./dist/src/components/index.d.ts"},"./composables":{types:"./dist/src/composables/index.d.ts"},"./types":{types:"./dist/src/types/index.d.ts"},"./utils":{types:"./dist/src/utils/index.d.ts"},"./*":"./*"},main:"./dist/tres.js",module:"./dist/tres.js",types:"./dist/index.d.ts",files:["*.d.ts","dist"],publishConfig:{access:"public"},scripts:{dev:"pnpm --filter='./playground/vue' dev","dev:nuxt":"pnpm --filter='./playground/nuxt' dev",build:"vite build",test:"vitest","test:ci":"vitest run","test:ui":"vitest --ui --coverage.enabled=true",release:"release-it",coverage:"vitest run --coverage",lint:"eslint .","lint:fix":"eslint . --fix","docs:dev":"vitepress dev docs","docs:build":"vitepress build docs","docs:serve":"vitepress serve docs","docs:preview":"vitepress preview docs","docs:contributors":"esno scripts/update-contributors.ts"},peerDependencies:{three:">=0.133",vue:">=3.4"},dependencies:{"@alvarosabu/utils":"^3.2.0","@vue/devtools-api":"^6.6.3","@vueuse/core":"^12.5.0"},devDependencies:{"@release-it/conventional-changelog":"^10.0.0","@stackblitz/sdk":"^1.11.0","@tresjs/cientos":"4.1.0","@tresjs/eslint-config":"^1.4.0","@types/three":"^0.173.0","@typescript-eslint/eslint-plugin":"^8.23.0","@typescript-eslint/parser":"^8.23.0","@vitejs/plugin-vue":"^5.2.1","@vitest/coverage-c8":"^0.33.0","@vitest/coverage-v8":"^3.0.5","@vitest/ui":"^3.0.5","@vue/test-utils":"^2.4.6",eslint:"^9.19.0","eslint-plugin-vue":"^9.32.0",esno:"^4.8.0",gsap:"^3.12.7",jsdom:"^26.0.0",kolorist:"^1.8.0",ohmyfetch:"^0.4.21",pathe:"^2.0.2","release-it":"^18.1.2","rollup-plugin-analyzer":"^4.0.0","rollup-plugin-copy":"^3.5.0","rollup-plugin-visualizer":"^5.14.0",sponsorkit:"^16.3.0",three:"^0.173.0",unocss:"^65.4.3",unplugin:"^2.1.2","unplugin-vue-components":"^28.0.0",vite:"^6.1.0","vite-plugin-banner":"^0.8.0","vite-plugin-dts":"4.5.0","vite-plugin-inspect":"^10.1.0","vite-plugin-require-transform":"^1.0.21","vite-svg-loader":"^5.1.0",vitepress:"1.6.3",vitest:"3.0.5",vue:"3.5.13","vue-demi":"^0.14.10"}};let ui=class extends oe{constructor(...e){super(...e),ci(this,"type","HightlightMesh"),ci(this,"createTime"),this.createTime=Date.now()}onBeforeRender(){const e=(Date.now()-this.createTime)/1e3,t=1+.07*Math.sin(2.5*e);this.scale.set(t,t,t)}};function di(e){return typeof e>"u"}function pi(e){return Array.isArray(e)}function mi(e){return"string"==typeof e}function fi(e){return"function"==typeof e}function gi(e){return e===Object(e)&&!pi(e)&&!fi(e)}function vi(e){return gi(e)&&!!e.isObject3D}function _i(e){return gi(e)&&!!e.isColor}function yi(e){return null!==e&&"object"==typeof e&&"set"in e&&"function"==typeof e.set}function xi(e){return e instanceof ee}function bi(e){return gi(e)&&!!e.isCamera}function wi(e){return vi(e)||function(e){return gi(e)&&!!e.isBufferGeometry}(e)||function(e){return gi(e)&&!!e.isMaterial}(e)||function(e){return gi(e)&&!!e.isFog}(e)}const Ti=(e,t)=>{for(const i of Object.keys(t))t[i]instanceof Object&&Object.assign(t[i],Ti(e[i],t[i]));return Object.assign(e||{},t),e},Ai=Ci("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,hgroup,h1,h2,h3,h4,h5,h6,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,summary,template,blockquote,iframe,tfoot");function Mi(e){return e&&1===e.nodeType}function Si(e){return e.replace(/-([a-z])/g,((e,t)=>t.toUpperCase()))}const Ei=/\B([A-Z])/g;function Pi(e){return e.replace(Ei,"-$1").toLowerCase()}function Ci(e,t){const i=Object.create(null),n=e.split(",");for(let s=0;s<n.length;s++)i[n[s]]=!0;return t?e=>!!i[e.toLowerCase()]:e=>!!i[e]}const Ri=(e,t)=>{if(!t)return;const i=Array.isArray(t)?t:t.match(/([^[.\]])+/g);return null==i?void 0:i.reduce(((e,t)=>e&&e[t]),e)};function Li(e,t){if(Mi(e)&&Mi(t)){const i=e.attributes,n=t.attributes;return i.length===n.length&&Array.from(i).every((({name:e,value:i})=>t.getAttribute(e)===i))}if(e===t)return!0;if(null===e||"object"!=typeof e||null===t||"object"!=typeof t)return!1;const i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(const s of i)if(!n.includes(s)||!Li(e[s],t[s]))return!1;return!0}function Di(e){(function(e){return"map"in e})(e)&&e.map&&e.map.dispose(),e.dispose()}function Oi(e){var t,i;if(e.parent&&(null==(t=e.removeFromParent)||t.call(e)),delete e.__tres,[...e.children].forEach((e=>Oi(e))),!(e instanceof N)){const t=e;e&&(null==(i=e.dispose)||i.call(e)),t.geometry&&t.geometry.dispose(),Array.isArray(t.material)?t.material.forEach((e=>Di(e))):t.material&&Di(t.material)}}function ki(e,t){let i=e;if(t.includes("-")){const e=t.split("-");let n=e.shift();for(;i&&e.length;)n in i?(i=i[n],n=e.shift()):n=Ii(n,e.shift());return{target:i,key:Ii(n,...e)}}return{target:i,key:t}}function Ii(...e){return e.map(((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1))).join("")}const Fi=/-\d+$/;function Ui(e,t,i){const n=e;return n.__tres={type:"unknown",eventCount:0,root:i,handlers:{},memoizedProps:{},objects:[],parent:null,previousAttach:null,...t},n.__tres.attach||(n.isMaterial?n.__tres.attach="material":n.isBufferGeometry?n.__tres.attach="geometry":n.isFog&&(n.__tres.attach="fog")),n}function Bi(e){var t;const i=null==(t=null==e?void 0:e.__tres)?void 0:t.root;i&&i.render&&i.render.canBeInvalidated.value&&i.invalidate()}function zi(e){return function(e){return gi(e)&&!!e.isPrimitive}(e)?(e.object.__tres=e.__tres,e.object):e}function Ni(e,t){var i,n,s,r;const o=(null==(i=e.__tres)?void 0:i.parent)||t.scene.value;e.__tres&&(e.__tres.parent=null),o&&o.__tres&&"objects"in o.__tres&&function(e,t){let i=0;for(let n=0;n<e.length;n++)t(e[n],n)&&(e[i]=e[n],i++);e.length=i}(o.__tres.objects,(t=>t!==e)),null!=(n=e.__tres)&&n.attach?function(e,t,i){var n,s,r;if(mi(i)){const{target:n,key:s}=ki(e,i),r=t.__tres.previousAttach;void 0===r?delete n[s]:n[s]=r,"__tresDetach"in n&&n.__tresDetach()}else null==(s=null==(n=t.__tres)?void 0:n.previousAttach)||s.call(n,e,t);null==(r=t.__tres)||delete r.previousAttach}(o,e,e.__tres.attach):(null==(r=null==(s=e.parent)?void 0:s.remove)||r.call(s,zi(e)),e.parent=null)}function ji(e,t){var i;null==(i=e.traverse)||i.call(e,(e=>{var i;t.deregisterCamera(e),null==(i=t.eventManager)||i.deregisterPointerMissedObject(e)})),t.deregisterCamera(e),Bi(e)}const Hi="[TresJS ▲ ■ ●] ";function Gi(...e){"string"==typeof e[0]?e[0]=Hi+e[0]:e.unshift(Hi),console.error(...e)}function Vi(...e){"string"==typeof e[0]?e[0]=Hi+e[0]:e.unshift(Hi),console.warn(...e)}function Wi(e,t){}function Ki(){return{logError:Gi,logWarning:Vi,logMessage:Wi}}const Xi=n({}),qi=e=>Object.assign(Xi.value,e);function Yi(){const e=new Map,t=new Set;let i=0,n=!1;const s=i=>{e.delete(i),t.delete(i)};return{on:(t,r=0)=>{e.set(t,{priority:r,addI:i++});const o=()=>s(t);return ai(o),n=!0,{off:o}},off:s,trigger:(...i)=>{n&&((()=>{const i=Array.from(e.entries()).sort(((e,t)=>{const i=e[1].priority-t[1].priority;return 0===i?e[1].addI-t[1].addI:i}));t.clear(),i.forEach((e=>t.add(e[0])))})(),n=!1),t.forEach((e=>e(...i)))},dispose:()=>{e.clear(),t.clear()},get count(){return e.size}}}function Zi(){let e=!0,t=!0,i=!1;const s=new z(!1),r=n(s.running),o=n(!1);let a;const l=Y.generateUUID();let c=null;const h=Yi(),d=Yi(),p=Yi();g();let m={};function f(){if(!e)return void(a=requestAnimationFrame(f));const t=s.getDelta(),i=s.getElapsedTime(),n={camera:u(m.camera),scene:u(m.scene),renderer:u(m.renderer),raycaster:u(m.raycaster),controls:u(m.controls),invalidate:m.invalidate,advance:m.advance},l={delta:t,elapsed:i,clock:s,...n};r.value&&h.trigger(l),o.value||(d.count?d.trigger(l):c&&c(l)),r.value&&p.trigger(l),a=requestAnimationFrame(f)}function g(){const e=!t&&!i;s.running!==e&&(s.running?s.stop():s.start()),r.value=s.running}return{loopId:l,register:(e,t,i)=>function(e,t,i=0){switch(t){case"before":return h.on(e,i);case"render":return c||(c=e),d.dispose(),d.on(e);case"after":return p.on(e,i)}}(e,t,i),start:function(){t&&(t=!1,g(),f())},stop:function(){t=!0,g(),cancelAnimationFrame(a)},pause:function(){i=!0,g()},resume:function(){i=!1,g()},pauseRender:function(){o.value=!0},resumeRender:function(){o.value=!1},isRenderPaused:o,isActive:r,setContext:function(e){m=e},setReady:t=>e=t}}function $i(e){let t=0;return e.traverse((e=>{if(e.isMesh&&e.geometry&&"HightlightMesh"!==e.type){const i=e.geometry,n=3*i.attributes.position.count*Float32Array.BYTES_PER_ELEMENT,s=i.index?i.index.count*Uint32Array.BYTES_PER_ELEMENT:0,r=i.attributes.normal?3*i.attributes.normal.count*Float32Array.BYTES_PER_ELEMENT:0,o=i.attributes.uv?2*i.attributes.uv.count*Float32Array.BYTES_PER_ELEMENT:0;t+=n+s+r+o}})),t}function Qi(e){return(e/1024).toFixed(2)}const Ji=Number.parseInt(J.replace("dev",""));const en={realistic:{shadows:!0,physicallyCorrectLights:!0,outputColorSpace:X,toneMapping:K,toneMappingExposure:3,shadowMap:{enabled:!0,type:W}},flat:{toneMapping:V,toneMappingExposure:1}};function tn({canvas:e,options:t,contextParts:{sizes:i,render:n,invalidate:r,advance:o}}){const c=g((()=>({alpha:Jt(t.alpha)??!0,depth:Jt(t.depth),canvas:ni(e),context:Jt(t.context),stencil:Jt(t.stencil),antialias:Jt(t.antialias)??!0,precision:Jt(t.precision),powerPreference:Jt(t.powerPreference),premultipliedAlpha:Jt(t.premultipliedAlpha),preserveDrawingBuffer:Jt(t.preserveDrawingBuffer),logarithmicDepthBuffer:Jt(t.logarithmicDepthBuffer),failIfMajorPerformanceCaveat:Jt(t.failIfMajorPerformanceCaveat)}))),h=s(new G(c.value));function u(){"on-demand"===t.renderMode&&r()}a(c,(()=>{h.value.dispose(),h.value=new G(c.value),u()})),a([i.width,i.height],(()=>{h.value.setSize(i.width.value,i.height.value),u()}),{immediate:!0}),a((()=>t.clearColor),u);const{pixelRatio:d}=si(),{logError:p}=Ki(),m=(()=>{const e=new G,t={shadowMap:{enabled:e.shadowMap.enabled,type:e.shadowMap.type},toneMapping:e.toneMapping,toneMappingExposure:e.toneMappingExposure,outputColorSpace:e.outputColorSpace};return e.dispose(),t})(),v=Jt(t.renderMode);return"on-demand"===v&&r(),"manual"===v&&setTimeout((()=>{o()}),100),f((()=>{const e=Jt(t.preset);e&&(e in en||p(`Renderer Preset must be one of these: ${Object.keys(en).join(", ")}`),Ti(h.value,en[e])),function(e,t,i){var n;if(!fi(e.setPixelRatio))return;let s=0;if(i&&pi(i)&&i.length>=2){const[e,n]=i;s=Y.clamp(t,e,n)}else s=function(e){return"number"==typeof e}(i)?i:t;s!==(null==(n=e.getPixelRatio)?void 0:n.call(e))&&e.setPixelRatio(s)}(h.value,d.value,Jt(t.dpr)),"always"===v&&(n.frames.value=Math.max(1,n.frames.value));const i=(t,i)=>{const n=Jt(t);if(void 0!==n)return n;const s=(()=>{if(e)return Ri(en[e],i)})();return void 0!==s?s:Ri(m,i)},s=(e,t)=>((e,t,i)=>{const n=Array.isArray(t)?t:t.match(/([^[.\]])+/g);n&&n.reduce(((e,t,s)=>(void 0===e[t]&&(e[t]={}),s===n.length-1&&(e[t]=i),e[t])),e)})(h.value,t,i(e,t));s(t.shadows,"shadowMap.enabled"),s(t.toneMapping??K,"toneMapping"),s(t.shadowMapType,"shadowMap.type"),Ji<150&&s(!t.useLegacyLights,"physicallyCorrectLights"),s(t.outputColorSpace,"outputColorSpace"),s(t.toneMappingExposure,"toneMappingExposure");const r=i(t.clearColor,"clearColor");r&&h.value.setClearColor(r?function(e){return e instanceof q?e:Array.isArray(e)?new q(...e):new q(e)}(r):new q(0))})),l((()=>{h.value.dispose(),h.value.forceContextLoss()})),{renderer:h}}const nn=(e,t)=>{const i=g((()=>t.renderer.value.domElement)),n=s([]),{x:r,y:o}=ri({target:i});let a=0;const{width:c,height:h,top:u,left:d}=oi(i),p=s=>{const a=(({x:e,y:t})=>{if(i.value)return{x:(e-d.value)/c.value*2-1,y:-(t-u.value)/h.value*2+1}})({x:(null==s?void 0:s.clientX)??r.value,y:(null==s?void 0:s.clientY)??o.value});return a&&(({x:i,y:s})=>{if(t.camera.value)return t.raycaster.value.setFromCamera(new te(i,s),t.camera.value),n.value=t.raycaster.value.intersectObjects(e.value,!0),n.value})(a)||[]},m=Zt(),f=Zt(),v=Zt(),_=Zt(),y=Zt(),x=Zt(),b=Zt(),w=Zt();const T=(e,i)=>{var s,r,o;const l=function(e){const t={};for(const i in e)"function"!=typeof i&&(t[i]=e[i]);return t}(i),c=new ie(null==i?void 0:i.clientX,null==i?void 0:i.clientY,0).unproject(null==(s=t.camera)?void 0:s.value);e.trigger({...l,intersections:n.value,unprojectedPoint:c,ray:null==(r=t.raycaster)?void 0:r.value.ray,camera:null==(o=t.camera)?void 0:o.value,sourceEvent:i,delta:a,stopPropagating:!1})};let A;const M=e=>{p(e),T(v,e),A=e};let S,E,P;const C=e=>{var t;S=null==(t=n.value[0])?void 0:t.object,a=0,E=new te((null==e?void 0:e.clientX)??r.value,(null==e?void 0:e.clientY)??o.value),T(y,e)};let R,L=!1;const D=e=>{var t,i,s;e instanceof PointerEvent&&(0===n.value.length&&T(x,e),S===(null==(t=n.value[0])?void 0:t.object)&&(P=new te((null==e?void 0:e.clientX)??r.value,(null==e?void 0:e.clientY)??o.value),a=null==E?void 0:E.distanceTo(P),0===e.button?(T(m,e),R===(null==(i=n.value[0])?void 0:i.object)?L=!0:(R=null==(s=n.value[0])?void 0:s.object,L=!1)):2===e.button&&T(b,e)),T(_,e))},O=e=>{L&&(T(f,e),R=void 0,L=!1)},k=e=>T(v,e),I=e=>T(w,e);return i.value.addEventListener("pointerup",D),i.value.addEventListener("pointerdown",C),i.value.addEventListener("pointermove",M),i.value.addEventListener("pointerleave",k),i.value.addEventListener("dblclick",O),i.value.addEventListener("wheel",I),l((()=>{null!=i&&i.value&&(i.value.removeEventListener("pointerup",D),i.value.removeEventListener("pointerdown",C),i.value.removeEventListener("pointermove",M),i.value.removeEventListener("pointerleave",k),i.value.removeEventListener("dblclick",O),i.value.removeEventListener("wheel",I))})),{intersects:n,onClick:e=>m.on(e).off,onDblClick:e=>f.on(e).off,onContextMenu:e=>b.on(e).off,onPointerMove:e=>v.on(e).off,onPointerUp:e=>_.on(e).off,onPointerDown:e=>y.on(e).off,onPointerMissed:e=>x.on(e).off,onWheel:e=>w.on(e).off,forceUpdate:()=>{A&&M(A)}}};function sn(e,t){if(Array.isArray(e))for(const i of e)i(t);"function"==typeof e&&e(t)}const rn=new WeakMap;function on(e){if(e=e||ln(),rn.has(e))return rn.get(e);const t=Date.now(),i=function(e,t,i=100){i=i<=0?100:i;const n=Zt(),s=new Set;let r=!1,o=!1,a=null;return function l(){a&&clearTimeout(a),o||r||!e()?!o&&!r&&(a=setTimeout(l,i)):(n.trigger(t),s.forEach((e=>e())),s.clear(),r=!0)}(),{on:e=>{if(r)return((e,...t)=>{e(...t)})(e,t),{off:()=>{}};{const t=n.on(e);return s.add(t.off),n.on(e)}},off:n.off,trigger:n.trigger,clear:n.clear,cancel:function(){o=!0,a&&clearTimeout(a)}}}((()=>{if(Date.now()-t>=100)return!0;{const t=e.renderer.value,i=(null==t?void 0:t.domElement)||{width:0,height:0};return!!(t&&i.width>0&&i.height>0)}}),e);return rn.set(e,i),i}function an({scene:e,canvas:t,windowSize:i,rendererOptions:r,emit:o}){const a=s(e),c=function(e,t,i=10){const n=Jt(e)?ei():ti(g((()=>Jt(t).parentElement))),s=v(ii(n.width,i)),r=v(ii(n.height,i)),o=g((()=>s.value/r.value));return{height:r,width:s,aspectRatio:o}}(i,t),{camera:h,cameras:u,registerCamera:d,deregisterCamera:p,setCameraActive:m}=(({sizes:e})=>{const t=n([]),i=g((()=>t.value[0])),s=e=>{const i=e instanceof Q?e:t.value.find((t=>t.uuid===e));if(!i)return;const n=t.value.filter((({uuid:e})=>e!==i.uuid));t.value=[i,...n]};return f((()=>{e.aspectRatio.value&&t.value.forEach((t=>{!t.manual&&(t instanceof j||function(e){return e.hasOwnProperty("isOrthographicCamera")&&e.isOrthographicCamera}(t))&&(t instanceof j?t.aspect=e.aspectRatio.value:(t.left=-.5*e.width.value,t.right=.5*e.width.value,t.top=.5*e.height.value,t.bottom=-.5*e.height.value),t.updateProjectionMatrix())}))})),l((()=>{t.value=[]})),{camera:i,cameras:t,registerCamera:(e,i=!1)=>{if(bi(e)){const n=e;if(t.value.some((({uuid:e})=>e===n.uuid)))return;i?s(n):t.value.push(n)}},deregisterCamera:e=>{if(bi(e)){const i=e;t.value=t.value.filter((({uuid:e})=>e!==i.uuid))}},setCameraActive:s}})({sizes:c}),_={mode:n(r.renderMode||"always"),priority:n(0),frames:n(0),maxFrames:60,canBeInvalidated:g((()=>"on-demand"===_.mode.value&&0===_.frames.value))};function x(e=1){"on-demand"===r.renderMode&&(_.frames.value=Math.min(_.maxFrames,_.frames.value+e))}function b(){"manual"===r.renderMode&&(_.frames.value=1)}const{renderer:w}=tn({canvas:t,options:r,contextParts:{sizes:c,render:_,invalidate:x,advance:b}}),T={sizes:c,scene:a,camera:h,cameras:v(u),renderer:w,raycaster:s(new H),controls:n(null),perf:{maxFrames:160,fps:{value:0,accumulator:[]},memory:{currentMem:0,allocatedMem:0,accumulator:[]}},render:_,advance:b,extend:qi,invalidate:x,registerCamera:d,setCameraActive:m,deregisterCamera:p,loop:Zi()};y("useTres",T),T.scene.value.__tres={root:T},T.loop.register((()=>{h.value&&_.frames.value>0&&(w.value.render(e,h.value),o("render",T.renderer.value)),_.priority.value=0,"always"===_.mode.value?_.frames.value=1:_.frames.value=Math.max(0,_.frames.value-1)}),"render");const{on:A,cancel:M}=on(T);T.loop.setReady(!1),T.loop.start(),A((()=>{o("ready",T),T.loop.setReady(!0),function(e,t,i){var n;const r=s(),o=s();e&&(r.value=e),t&&(o.value=t);const a=e=>{var t;return(null==(t=e.children)?void 0:t.some((e=>a(e))))||(e=>{var t;return(null==(t=e.__tres)?void 0:t.eventCount)>0})(e)},l=s((null==(n=r.value)?void 0:n.children).filter(a)||[]);function c(e,t){const n=[];t.stopPropagation=()=>t.stopPropagating=!0;for(const s of null==t?void 0:t.intersections){if(t.stopPropagating)return;t={...t,...s};const{object:r}=s;t.eventObject=r,sn(r[e],t),n.push(r);let o=r.parent;for(;null!==o&&!t.stopPropagating&&!n.includes(o);)t.eventObject=o,sn(o[e],t),n.push(o),o=o.parent;const a=Pi(e.slice(2));i(a,{intersection:s,event:t})}}const{onClick:h,onDblClick:u,onContextMenu:d,onPointerMove:p,onPointerDown:m,onPointerUp:f,onPointerMissed:g,onWheel:v,forceUpdate:_}=nn(l,t);f((e=>c("onPointerUp",e))),m((e=>c("onPointerDown",e))),h((e=>c("onClick",e))),u((e=>c("onDoubleClick",e))),d((e=>c("onContextMenu",e))),v((e=>c("onWheel",e)));let y=[];p((e=>{const t=e.intersections.map((({object:e})=>e)),i=e.intersections;y.forEach((({object:i})=>{t.includes(i)||(e.intersections=y,c("onPointerLeave",e),c("onPointerOut",e))})),e.intersections=i,e.intersections.forEach((({object:t})=>{y.includes(t)||(c("onPointerEnter",e),c("onPointerOver",e))})),c("onPointerMove",e),y=e.intersections}));const x=[];function b(e){wi(e)&&vi(e)&&l.value.push(e)}function w(e){if(wi(e)&&vi(e)){const t=l.value.indexOf(e);t>-1&&l.value.splice(t,1)}}function T(e){wi(e)&&vi(e)&&e.onPointerMissed&&x.push(e)}function A(e){if(wi(e)&&vi(e)){const t=x.indexOf(e);t>-1&&x.splice(t,1)}}g((e=>{e.stopPropagation=()=>e.stopPropagating=!0,x.forEach((t=>{e.stopPropagating||(e.eventObject=t,sn(t.onPointerMissed,e))})),i("pointer-missed",{event:e})})),t.eventManager={forceUpdate:_,registerObject:b,deregisterObject:w,registerPointerMissedObject:T,deregisterPointerMissedObject:A}}(e,T,o)})),l((()=>{M(),T.loop.stop()}));const S=$t({every:100}),{isSupported:E,memory:P}=Qt({interval:100});let C=performance.now();let R=0;const{pause:L}=Yt((({delta:e})=>{window.__TRES__DEVTOOLS__&&((({timestamp:e})=>{T.scene.value&&(T.perf.memory.allocatedMem=$i(T.scene.value)),e-C>=100&&(C=e,T.perf.fps.accumulator.push(S.value),T.perf.fps.accumulator.length>160&&T.perf.fps.accumulator.shift(),T.perf.fps.value=S.value,E.value&&P.value&&(T.perf.memory.accumulator.push(P.value.usedJSHeapSize/1024/1024),T.perf.memory.accumulator.length>160&&T.perf.memory.accumulator.shift(),T.perf.memory.currentMem=T.perf.memory.accumulator.reduce(((e,t)=>e+t),0)/T.perf.memory.accumulator.length))})({timestamp:performance.now()}),R+=e,R>=1&&(window.__TRES__DEVTOOLS__.cb(T),R=0))}),{immediate:!0});return l((()=>{L()})),T}function ln(){const e=t("useTres");if(!e)throw new Error("useTresContext must be used together with useTresContextProvider");return e}function cn(){const{camera:e,scene:t,renderer:i,loop:n,raycaster:s,controls:r,invalidate:o,advance:a}=ln();return n.setContext({camera:e,scene:t,renderer:i,raycaster:s,controls:r,invalidate:o,advance:a}),{pause:n.pause,resume:n.resume,pauseRender:n.pauseRender,resumeRender:n.resumeRender,isActive:n.isActive,onBeforeRender:function(e,t=0){return n.register(e,"before",t)},render:function(e){return n.register(e,"render")},onAfterRender:function(e,t=0){return n.register(e,"after",t)}}}const hn=Zt(),un=Zt(),dn=Zt(),pn=new z;let mn=0,fn=0;const{pause:gn,resume:vn,isActive:_n}=Yt((()=>{hn.trigger({delta:mn,elapsed:fn,clock:pn}),un.trigger({delta:mn,elapsed:fn,clock:pn}),dn.trigger({delta:mn,elapsed:fn,clock:pn})}),{immediate:!1});dn.on((()=>{mn=pn.getDelta(),fn=pn.getElapsedTime()}));let yn=!1;const xn=()=>(yn||(yn=!0,vn()),{onBeforeLoop:hn.on,onLoop:un.on,onAfterLoop:dn.on,pause:gn,resume:vn,isActive:_n});const{logError:bn}=Ki(),wn=["onClick","onContextMenu","onPointerMove","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut","onDoubleClick","onPointerDown","onPointerUp","onPointerCancel","onPointerMissed","onLostPointerCapture","onWheel"],Tn=e=>{const t=e.scene.value;function i(i,n){var s,r,o;if(!i)return;n=n||t;const a=i.__tres?i:Ui(i,{},e),l=n.__tres?n:Ui(n,{},e);i=zi(a),n=zi(l),i.__tres&&(null==(s=i.__tres)?void 0:s.eventCount)>0&&(null==(r=e.eventManager)||r.registerObject(i)),e.registerCamera(i),null==(o=e.eventManager)||o.registerPointerMissedObject(i),a.__tres.attach?function(e,t,i){if(mi(i)){if(Fi.test(i)){const t=i.replace(Fi,""),{target:n,key:s}=ki(e,t);if(!Array.isArray(n[s])){const e=n[s],t=[];t.__tresDetach=()=>{t.every((e=>di(e)))&&(n[s]=e)},n[s]=t}}const{target:n,key:s}=ki(e,i);t.__tres.previousAttach=n[s],n[s]=zi(t)}else t.__tres.previousAttach=i(e,t)}(l,a,a.__tres.attach):vi(i)&&vi(l)&&(l.add(i),i.dispatchEvent({type:"added"})),a.__tres.parent=l,l.__tres.objects&&!l.__tres.objects.includes(a)&&l.__tres.objects.push(a)}function n(t,i){var s,r,o,a;if(!t)return;null!=t&&t.__tres&&(null==(s=t.__tres)?void 0:s.eventCount)>0&&(null==(r=e.eventManager)||r.deregisterObject(t)),i=di(i)?"default":i;const l=null==(o=t.__tres)?void 0:o.dispose;di(l)||(i=null!==l&&l);const c=null==(a=t.__tres)?void 0:a.primitive,h="default"===i?!c:!!i;if(t.__tres&&"objects"in t.__tres&&[...t.__tres.objects].forEach((e=>n(e,i))),h&&t.children&&[...t.children].forEach((e=>n(e,i))),Ni(t,e),ji(t,e),h&&!function(e){return gi(e)&&!!e.isScene}(t))if(fi(i))i(t);else if(fi(t.dispose))try{t.dispose()}catch{}"__tres"in t&&delete t.__tres}function s(t,s,r,o){var a,l;if(!t)return;let c=t,h=s;if(t.__tres&&(t.__tres.memoizedProps[s]=o),"attach"===s){const s=(null==(a=t.__tres)?void 0:a.parent)||t.parent;return n(t),Ui(t,{attach:o},e),void(s&&i(t,s))}if("dispose"===s)return t.__tres||(t=Ui(t,{},e)),void(t.__tres.dispose=o);if(vi(t)&&"blocks-pointer-events"===h)return void(o||""===o?t[h]=o:delete t[h]);wn.includes(s)&&t.__tres&&(t.__tres.eventCount+=1);let u=Si(h),d=null==c?void 0:c[u];if("args"===h){const e=t,i=r??[],n=o??[],s=(null==(l=t.__tres)?void 0:l.type)||t.type;return void(s&&i.length&&!function(e,t){if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!Li(e[i],t[i]))return!1;return!0}(i,n)&&(c=Object.assign(e,new Xi.value[s](...o))))}if("BufferGeometry"===c.type){if("args"===h)return;return void c.setAttribute(Si(h),new $(...o))}if(h.includes("-")&&void 0===d){d=c;for(const e of h.split("-"))u=h=Si(e),c=d,d=null==d?void 0:d[h]}let p=o;if(""===p&&(p=!0),fi(d))return wn.includes(s)||(pi(p)?t[u](...p):t[u](p)),void(u.startsWith("on")&&fi(p)&&(c[u]=p));xi(d)&&xi(p)?d.mask=p.mask:_i(d)&&function(e){return null!=e&&("string"==typeof e||"number"==typeof e||_i(e))}(p)?d.set(p):function(e){return yi(e)&&"copy"in e&&"function"==typeof e.copy}(d)&&function(e){return!(null==e||!e.constructor)}(p)&&d.constructor===p.constructor?d.copy(p):yi(d)&&Array.isArray(p)?"fromArray"in d&&"function"==typeof d.fromArray?d.fromArray(p):d.set(...p):yi(d)&&"number"==typeof p?"setScalar"in d&&"function"==typeof d.setScalar?d.setScalar(p):d.set(p):c[u]=p,Bi(t)}function r(e){var t;return(null==(t=null==e?void 0:e.__tres)?void 0:t.parent)||null}return{insert:i,remove:n,createElement:function(t,r,o,a){if(a||(a={}),a.args||(a.args=[]),"template"===t||Ai(t))return null;let l,c=t.replace("Tres","");if("primitive"===t){(!gi(a.object)||b(a.object))&&bn("Tres primitives need an 'object' prop, whose value is an object or shallowRef<object>"),c=a.object.type;const t={};l=function(e,t={},i={}){let n=e;const s=e=>{n=e};let r=new Proxy({},{});return r=new Proxy({},{has:(e,i)=>i in t||i in n,get:(e,i,s)=>i in t?t[i](n):n[i],set:(e,t,o)=>(i[t]?i[t](o,n,r,s):n[t]=o,!0)}),r}(a.object,{object:e=>e,isPrimitive:()=>!0,__tres:()=>t},{object:(t,r,o,a)=>{!function(e,t,i,n,s){const r=[...t.__tres.objects],o=zi(t);if(o===(e=zi(e)))return!0;const a=Ui(e,t.__tres??{},s),l=t.parent??t.__tres.parent??null,c={...t.__tres.memoizedProps};delete c.object;for(const h of r)Ni(h,s),ji(h,s);o.__tres.objects=[],n.remove(t);for(const[h,u]of Object.entries(c))n.patchProp(a,h,a[h],u);i(e),n.insert(t,l);for(const h of r)n.insert(h,t)}(t,o,a,{patchProp:s,remove:n,insert:i},e)},__tres:e=>{Object.assign(t,e)}})}else{const e=Xi.value[c];e||bn(`${c} is not defined on the THREE namespace. Use extend to add it to the catalog.`),l=new e(...a.args)}return l?(l.isCamera&&(null!=a&&a.position||l.position.set(3,3,3),null!=a&&a.lookAt||l.lookAt(0,0,0)),l=Ui(l,{...l.__tres,type:c,memoizedProps:a,eventCount:0,primitive:"primitive"===t,attach:a.attach},e),l):null},patchProp:s,parentNode:r,createText:()=>{},createComment:function(t){const i=Ui(new Z,{type:"Comment"},e);return i.name=t,i},setText:()=>{},setElementText:()=>{},nextSibling:function(e){var t;const i=r(e),n=(null==(t=null==i?void 0:i.__tres)?void 0:t.objects)||[],s=n.indexOf(e);return s<0||s>=n.length-1?null:n[s+1]},querySelector:()=>{},setScopeId:()=>{},cloneNode:()=>{},insertStaticContent:()=>{}}};function An(){return typeof navigator<"u"&&typeof window<"u"?window:typeof globalThis<"u"?globalThis:{}}const Mn="function"==typeof Proxy;let Sn,En;function Pn(){return void 0!==Sn||(typeof window<"u"&&window.performance?(Sn=!0,En=window.performance):typeof globalThis<"u"&&null!==(e=globalThis.perf_hooks)&&void 0!==e&&e.performance?(Sn=!0,En=globalThis.perf_hooks.performance):Sn=!1),Sn?En.now():Date.now();var e}let Cn=class{constructor(e,t){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=e,this.hook=t;const i={};if(e.settings)for(const r in e.settings){const t=e.settings[r];i[r]=t.defaultValue}const n=`__vue-devtools-plugin-settings__${e.id}`;let s=Object.assign({},i);try{const e=localStorage.getItem(n),t=JSON.parse(e);Object.assign(s,t)}catch{}this.fallbacks={getSettings:()=>s,setSettings(e){try{localStorage.setItem(n,JSON.stringify(e))}catch{}s=e},now:()=>Pn()},t&&t.on("plugin:settings:set",((e,t)=>{e===this.plugin.id&&this.fallbacks.setSettings(t)})),this.proxiedOn=new Proxy({},{get:(e,t)=>this.target?this.target.on[t]:(...e)=>{this.onQueue.push({method:t,args:e})}}),this.proxiedTarget=new Proxy({},{get:(e,t)=>this.target?this.target[t]:"on"===t?this.proxiedOn:Object.keys(this.fallbacks).includes(t)?(...e)=>(this.targetQueue.push({method:t,args:e,resolve:()=>{}}),this.fallbacks[t](...e)):(...e)=>new Promise((i=>{this.targetQueue.push({method:t,args:e,resolve:i})}))})}async setRealTarget(e){this.target=e;for(const t of this.onQueue)this.target.on[t.method](...t.args);for(const t of this.targetQueue)t.resolve(await this.target[t.method](...t.args))}};function Rn(e,t){const i=e,n=An(),s=An().__VUE_DEVTOOLS_GLOBAL_HOOK__,r=Mn&&i.enableEarlyProxy;if(!s||!n.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__&&r){const e=r?new Cn(i,s):null;(n.__VUE_DEVTOOLS_PLUGINS__=n.__VUE_DEVTOOLS_PLUGINS__||[]).push({pluginDescriptor:i,setupFn:t,proxy:e}),e&&t(e.proxiedTarget)}else s.emit("devtools-plugin:setup",e,t)}function Ln(e,t){throw new Error(e+t)}const Dn=e=>{const t={id:e.uuid,label:e.type,children:[],tags:[]};""!==e.name&&t.tags.push({label:e.name,textColor:5750629,backgroundColor:15793395});const i=$i(e);return i>0&&t.tags.push({label:`${Qi(i)} KB`,textColor:15707189,backgroundColor:16775644,tooltip:"Memory usage"}),e.type.includes("Light")&&(function(e){return gi(e)&&!!e.isLight}(e)&&t.tags.push({label:`${e.intensity}`,textColor:9738662,backgroundColor:16316922,tooltip:"Intensity"}),t.tags.push({label:`#${new q(e.color).getHexString()}`,textColor:9738662,backgroundColor:16316922,tooltip:"Color"})),e.type.includes("Camera")&&(t.tags.push({label:`${e.fov}°`,textColor:9738662,backgroundColor:16316922,tooltip:"Field of view"}),t.tags.push({label:`x: ${Math.round(e.position.x)} y: ${Math.round(e.position.y)} z: ${Math.round(e.position.z)}`,textColor:9738662,backgroundColor:16316922,tooltip:"Position"})),t};function On(e,t,i=""){e.children.forEach((e=>{if("HightlightMesh"===e.type||i&&!e.type.includes(i)&&!e.name.includes(i))return;const n=Dn(e);t.children.push(n),On(e,n,i)}))}const kn=[],In="tres:inspector",Fn=w({sceneGraph:null});function Un(e,t){Rn({id:"dev.esm.tres",label:"TresJS 🪐",logo:"https://raw.githubusercontent.com/Tresjs/tres/main/public/favicon.svg",packageName:"tresjs",homepage:"https://tresjs.org",componentStateTypes:kn,app:e},(e=>{"function"!=typeof e.now&&function(e,t){const i=`▲ ■ ●${e}`;Ln(i,t)}("You seem to be using an outdated version of Vue Devtools. Are you still using the Beta release instead of the stable one? You can find the links at https://devtools.vuejs.org/guide/installation.html."),e.addInspector({id:In,label:"TresJS 🪐",icon:"account_tree",treeFilterPlaceholder:"Search instances"}),setInterval((()=>{e.sendInspectorTree(In)}),1e3),setInterval((()=>{e.notifyComponentUpdate()}),5e3),e.on.getInspectorTree((e=>{if(e.inspectorId===In){const i=Dn(t.scene.value);On(t.scene.value,i,e.filter),Fn.sceneGraph=i,e.rootNodes=[i]}}));let i=null,n=null;e.on.getInspectorState((e=>{var s;if(e.inspectorId===In){const[r]=t.scene.value.getObjectsByProperty("uuid",e.nodeId);if(!r)return;if(n&&i&&i.parent&&n.remove(i),r.isMesh){const e=function(e){const t=new se({color:11003607,transparent:!0,opacity:.2,depthTest:!1,side:re});return new ui(e.geometry.clone(),t)}(r);r.add(e),i=e,n=r}e.state={object:Object.entries(r).map((([e,t])=>"children"===e?{key:e,value:t.filter((e=>"HightlightMesh"!==e.type))}:{key:e,value:t,editable:!0})).filter((({key:e})=>"parent"!==e))},r.isScene&&(e.state={...e.state,state:[{key:"Scene Info",value:{objects:r.children.length,memory:$i(r),calls:t.renderer.value.info.render.calls,triangles:t.renderer.value.info.render.triangles,points:t.renderer.value.info.render.points,lines:t.renderer.value.info.render.lines}},{key:"Programs",value:(null==(s=t.renderer.value.info.programs)?void 0:s.map((e=>({...e,programName:e.name}))))||[]}]})}})),e.on.editInspectorState((e=>{e.inspectorId===In&&function(e,t,i,n){const s=e=>{if(e.uuid===t)return e;for(const t of e.children){const e=s(t);if(e)return e}},r=s(e);if(!r)return void console.warn("Object with UUID not found in the scene.");let o=r;for(let l=0;l<i.length-1;l++){if(void 0===o[i[l]])return void console.warn(`Property path is not valid: ${i.join(".")}`);o=o[i[l]]}const a=i[i.length-1];void 0!==o[a]?o[a]=n:console.warn(`Property path is not valid: ${i.join(".")}`)}(t.scene.value,e.nodeId,e.path,e.state.value)}))}))}const Bn=["data-scene","data-tres"],zn=e({__name:"TresCanvas",props:{shadows:{type:Boolean,default:void 0},clearColor:{},toneMapping:{},shadowMapType:{},useLegacyLights:{type:Boolean,default:void 0},outputColorSpace:{},toneMappingExposure:{},renderMode:{default:"always"},dpr:{},camera:{},preset:{},windowSize:{type:Boolean,default:void 0},enableProvideBridge:{type:Boolean,default:!0},context:{},alpha:{type:Boolean,default:void 0},premultipliedAlpha:{type:Boolean},antialias:{type:Boolean,default:void 0},stencil:{type:Boolean,default:void 0},preserveDrawingBuffer:{type:Boolean,default:void 0},powerPreference:{},depth:{type:Boolean,default:void 0},failIfMajorPerformanceCaveat:{type:Boolean,default:void 0},precision:{},logarithmicDepthBuffer:{type:Boolean,default:void 0},reverseDepthBuffer:{type:Boolean}},emits:["render","click","double-click","context-menu","pointer-move","pointer-up","pointer-down","pointer-enter","pointer-leave","pointer-over","pointer-out","pointer-missed","wheel","ready"],setup(t,{expose:g,emit:v}){const b=t,w=v,T=i(),A=n(),M=s(new N),S=_();qi(ne);const E=(t,i=!1)=>{const n=((t,i=!1)=>e({setup(){var e;const n=null==(e=_())?void 0:e.appContext;n&&(n.app=null==S?void 0:S.appContext.app);const s={};return null!=S&&S.parent&&b.enableProvideBridge&&(function e(t){t&&(t.parent&&e(t.parent),t.provides&&Object.assign(s,t.provides))}(S.parent),Reflect.ownKeys(s).forEach((e=>{y(e,s[e])}))),y("useTres",t),y("extend",qi),typeof window<"u"&&Un(null==n?void 0:n.app,t),()=>m(x,null,i?[]:T.default())}}))(t,i),{render:s}=p(Tn(t));s(m(n),M.value)},P=(e,t=!1)=>{Oi(e.scene.value),t&&(e.renderer.value.dispose(),e.renderer.value.renderLists.dispose(),e.renderer.value.forceContextLoss()),M.value.__tres={root:e}},C=s(null);g({context:C,dispose:()=>P(C.value,!0)});return o((()=>{const e=A;C.value=an({scene:M.value,canvas:e,windowSize:b.windowSize??!1,rendererOptions:b,emit:w});const{registerCamera:t,camera:i,cameras:n,deregisterCamera:s}=C.value;E(C.value);a((()=>b.camera),((e,i)=>{e&&t(e),i&&(i.removeFromParent(),s(i))}),{immediate:!0}),i.value||(()=>{const e=new j(45,window.innerWidth/window.innerHeight,.1,1e3);e.position.set(3,3,3),e.lookAt(0,0,0),t(e);const i=f((()=>{n.value.length>=2&&(e.removeFromParent(),s(e),null==i||i())}))})()})),l((()=>{P(C.value),E(C.value,!0)})),(e,t)=>(c(),r("canvas",{ref_key:"canvas",ref:A,"data-scene":M.value.uuid,class:d(e.$attrs.class),"data-tres":`tresjs ${u(hi).version}`,style:h({display:"block",width:"100%",height:"100%",position:e.windowSize?"fixed":"relative",top:0,left:0,pointerEvents:"auto",touchAction:"none",...e.$attrs.style})},null,14,Bn))}});
/**
 * postprocessing v6.37.6 build Fri Jul 04 2025
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2025 Raoul van Rüschen
 * @license Zlib
 */var Nn=.001,jn=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(e){"undefined"!=typeof document&&void 0!==document.hidden&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=e)}get delta(){return this._delta*Nn}get fixedDelta(){return this._fixedDelta*Nn}set fixedDelta(e){this._fixedDelta=1e3*e}get elapsed(){return this._elapsed*Nn}update(e){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(void 0!==e?e:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(e){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},Hn=(()=>{const e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]),i=new Me;return i.setAttribute("position",new $(e,3)),i.setAttribute("uv",new $(t,2)),i})(),Gn=class e{static get fullscreenGeometry(){return Hn}constructor(e="Pass",t=new N,i=new Q){this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;null!==t&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return null!==this.screen?this.screen.material:null}set fullscreenMaterial(t){let i=this.screen;null!==i?i.material=t:(i=new oe(e.fullscreenGeometry,t),i.frustumCulled=!1,null===this.scene&&(this.scene=new N),this.scene.add(i),this.screen=i)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=me){}render(e,t,i,n,s){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(const t of Object.keys(this)){const i=this[t];(i instanceof de||i instanceof Te||i instanceof Ae||i instanceof e)&&this[t].dispose()}null!==this.fullscreenMaterial&&this.fullscreenMaterial.dispose()}},Vn=class extends Gn{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,i,n,s){const r=e.state.buffers.stencil;r.setLocked(!1),r.setTest(!1)}},Wn=class extends ge{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new be(null),opacity:new be(1)},blending:we,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#include <dithering_pars_fragment>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;\n#include <colorspace_fragment>\n#include <dithering_fragment>\n}",vertexShader:"varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}"})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},Kn=class extends Gn{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new Wn,this.needsSwap=!1,this.renderTarget=e,void 0===e&&(this.renderTarget=new de(1,1,{minFilter:pe,magFilter:pe,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,i,n,s){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,i){void 0!==i&&(this.renderTarget.texture.type=i,i!==ae?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":null!==e&&e.outputColorSpace===X&&(this.renderTarget.texture.colorSpace=X))}},Xn=new q,qn=class extends Gn{constructor(e=!0,t=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,i){this.color=e,this.depth=t,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,i,n,s){const r=this.overrideClearColor,o=this.overrideClearAlpha,a=e.getClearAlpha(),l=null!==r,c=o>=0;l?(e.getClearColor(Xn),e.setClearColor(r,c?o:a)):c&&e.setClearAlpha(o),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(Xn,a):c&&e.setClearAlpha(a)}},Yn=class extends Gn{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new qn(!1,!1,!0),this.inverse=!1}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,i,n,s){const r=e.getContext(),o=e.state.buffers,a=this.scene,l=this.camera,c=this.clearPass,h=this.inverted?0:1,u=1-h;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),o.stencil.setFunc(r.ALWAYS,h,4294967295),o.stencil.setClear(u),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(e,null):(c.render(e,t),c.render(e,i))),this.renderToScreen?(e.setRenderTarget(null),e.render(a,l)):(e.setRenderTarget(t),e.render(a,l),e.setRenderTarget(i),e.render(a,l)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(r.EQUAL,1,4294967295),o.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),o.stencil.setLocked(!0)}},Zn=class{constructor(e=null,{depthBuffer:t=!0,stencilBuffer:i=!1,multisampling:n=0,frameBufferType:s}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,i,s,n),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new Kn,this.depthTexture=null,this.passes=[],this.timer=new jn,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){const t=this.inputBuffer,i=this.multisampling;i>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,null!==e){const t=e.getSize(new te),i=e.getContext().getContextAttributes().alpha,n=this.inputBuffer.texture.type;n===ae&&e.outputColorSpace===X&&(this.inputBuffer.texture.colorSpace=X,this.outputBuffer.texture.colorSpace=X,this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(t.width,t.height);for(const s of this.passes)s.initialize(e,i,n)}}replaceRenderer(e,t=!0){const i=this.renderer,n=i.domElement.parentNode;return this.setRenderer(e),t&&null!==n&&(n.removeChild(i.domElement),n.appendChild(e.domElement)),i}createDepthTexture(){const e=this.depthTexture=new le;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=ce,e.type=he):e.type=ue,e}deleteDepthTexture(){if(null!==this.depthTexture){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,i,n){const s=this.renderer,r=null===s?new te:s.getDrawingBufferSize(new te),o={minFilter:pe,magFilter:pe,stencilBuffer:t,depthBuffer:e,type:i},a=new de(r.width,r.height,o);return n>0&&(a.ignoreDepthForMultisampleCopy=!1,a.samples=n),i===ae&&null!==s&&s.outputColorSpace===X&&(a.texture.colorSpace=X),a.texture.name="EffectComposer.Buffer",a.texture.generateMipmaps=!1,a}setMainScene(e){for(const t of this.passes)t.mainScene=e}setMainCamera(e){for(const t of this.passes)t.mainCamera=e}addPass(e,t){const i=this.passes,n=this.renderer,s=n.getDrawingBufferSize(new te),r=n.getContext().getContextAttributes().alpha,o=this.inputBuffer.texture.type;if(e.setRenderer(n),e.setSize(s.width,s.height),e.initialize(n,r,o),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),void 0!==t?i.splice(t,0,e):i.push(e),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),e.needsDepthTexture||null!==this.depthTexture)if(null===this.depthTexture){const t=this.createDepthTexture();for(e of i)e.setDepthTexture(t)}else e.setDepthTexture(this.depthTexture)}removePass(e){const t=this.passes,i=t.indexOf(e);if(-1!==i&&t.splice(i,1).length>0){if(null!==this.depthTexture){const i=(e,t)=>e||t.needsDepthTexture;t.reduce(i,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&i===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){const e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){const t=this.renderer,i=this.copyPass;let n,s,r,o=this.inputBuffer,a=this.outputBuffer,l=!1;void 0===e&&(this.timer.update(),e=this.timer.getDelta());for(const c of this.passes)c.enabled&&(c.render(t,o,a,e,l),c.needsSwap&&(l&&(i.renderToScreen=c.renderToScreen,n=t.getContext(),s=t.state.buffers.stencil,s.setFunc(n.NOTEQUAL,1,4294967295),i.render(t,o,a,e,l),s.setFunc(n.EQUAL,1,4294967295)),r=o,o=a,a=r),c instanceof Yn?l=!0:c instanceof Vn&&(l=!1))}setSize(e,t,i){const n=this.renderer,s=n.getSize(new te);void 0!==e&&void 0!==t||(e=s.width,t=s.height),s.width===e&&s.height===t||n.setSize(e,t,i);const r=n.getDrawingBufferSize(new te);this.inputBuffer.setSize(r.width,r.height),this.outputBuffer.setSize(r.width,r.height);for(const o of this.passes)o.setSize(r.width,r.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const e of this.passes)e.dispose();this.passes=[],null!==this.inputBuffer&&this.inputBuffer.dispose(),null!==this.outputBuffer&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),Gn.fullscreenGeometry.dispose()}},$n=0,Qn=1,Jn=2,es={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},ts=class{constructor(){this.shaderParts=new Map([[es.FRAGMENT_HEAD,null],[es.FRAGMENT_MAIN_UV,null],[es.FRAGMENT_MAIN_IMAGE,null],[es.VERTEX_HEAD,null],[es.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=$n,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Ee}},is=!1,ns=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case re:t=this.materialsFlatShadedDoubleSide;break;case fe:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded}else switch(e.material.side){case re:t=this.materialsDoubleSide;break;case fe:t=this.materialsBackSide;break;default:t=this.materials}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(e){if(!(e instanceof ge))return e.clone();const t=e.uniforms,i=new Map;for(const s in t){const e=t[s].value;e.isRenderTargetTexture&&(t[s].value=null,i.set(s,e))}const n=e.clone();for(const s of i)t[s[0]].value=s[1],n.uniforms[s[0]].value=s[1];return n}setMaterial(e){if(this.disposeMaterials(),this.material=e,null!==e){const t=this.materials=[this.cloneMaterial(e),this.cloneMaterial(e),this.cloneMaterial(e)];for(const i of t)i.uniforms=Object.assign({},e.uniforms),i.side=ve;t[2].skinning=!0,this.materialsBackSide=t.map((t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},e.uniforms),i.side=fe,i})),this.materialsDoubleSide=t.map((t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},e.uniforms),i.side=re,i})),this.materialsFlatShaded=t.map((t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i})),this.materialsFlatShadedBackSide=t.map((t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i.side=fe,i})),this.materialsFlatShadedDoubleSide=t.map((t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i.side=re,i}))}}render(e,t,i){const n=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,is){const n=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,i);for(const e of n)e[0].material=e[1];this.meshCount!==n.size&&n.clear()}else{const n=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,i),t.overrideMaterial=n}e.shadowMap.enabled=n}disposeMaterials(){if(null!==this.material){const e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return is}static set workaroundEnabled(e){is=e}},ss=-1,rs=class extends Se{constructor(e,t=-1,i=-1,n=1){super(),this.resizable=e,this.baseSize=new te(1,1),this.preferredSize=new te(t,i),this.target=this.preferredSize,this.s=n,this.effectiveSize=new te,this.addEventListener("change",(()=>this.updateEffectiveSize())),this.updateEffectiveSize()}updateEffectiveSize(){const e=this.baseSize,t=this.preferredSize,i=this.effectiveSize,n=this.scale;t.width!==ss?i.width=t.width:t.height!==ss?i.width=Math.round(t.height*(e.width/Math.max(e.height,1))):i.width=Math.round(e.width*n),t.height!==ss?i.height=t.height:t.width!==ss?i.height=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):i.height=Math.round(e.height*n)}get width(){return this.effectiveSize.width}set width(e){this.preferredWidth=e}get height(){return this.effectiveSize.height}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferredSize.setScalar(ss),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.baseSize.width}set baseWidth(e){this.baseSize.width!==e&&(this.baseSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(e){this.baseWidth=e}get baseHeight(){return this.baseSize.height}set baseHeight(e){this.baseSize.height!==e&&(this.baseSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){this.baseSize.width===e&&this.baseSize.height===t||(this.baseSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(e){this.preferredSize.width!==e&&(this.preferredSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferredSize.height}set preferredHeight(e){this.preferredSize.height!==e&&(this.preferredSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){this.preferredSize.width===e&&this.preferredSize.height===t||(this.preferredSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(e){this.s=e.scale,this.baseSize.set(e.baseWidth,e.baseHeight),this.preferredSize.set(e.preferredWidth,e.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return ss}},os=9,as=23,ls=new Map([[0,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb,y.a),opacity);}"],[1,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,y.a*opacity);}"],[2,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb)*0.5,y.a),opacity);}"],[3,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.xy,xHSL.z));return mix(x,vec4(z,y.a),opacity);}"],[4,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=mix(step(0.0,b)*(1.0-min(vec3(1.0),(1.0-a)/b)),vec3(1.0),step(1.0,a));return mix(x,vec4(z,y.a),opacity);}"],[5,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=step(0.0,a)*mix(min(vec3(1.0),a/max(1.0-b,1e-9)),vec3(1.0),step(1.0,b));return mix(x,vec4(z,y.a),opacity);}"],[6,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb,y.rgb),y.a),opacity);}"],[7,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(abs(x.rgb-y.rgb),y.a),opacity);}"],[8,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb/max(y.rgb,1e-12),y.a),opacity);}"],[os,null],[10,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb-2.0*x.rgb*y.rgb),y.a),opacity);}"],[11,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=min(x.rgb,1.0);vec3 b=min(y.rgb,1.0);vec3 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,b));return mix(x,vec4(z,y.a),opacity);}"],[12,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(step(1.0,x.rgb+y.rgb),y.a),opacity);}"],[13,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.x,xHSL.yz));return mix(x,vec4(z,y.a),opacity);}"],[14,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-y.rgb,y.a),opacity);}"],[15,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(y.rgb*(1.0-x.rgb),y.a),opacity);}"],[16,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb,y.rgb),y.a),opacity);}"],[17,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(y.rgb+x.rgb-1.0,0.0,1.0),y.a),opacity);}"],[18,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb+y.rgb,1.0),y.a),opacity);}"],[19,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(2.0*y.rgb+x.rgb-1.0,0.0,1.0),y.a),opacity);}"],[20,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.xy,yHSL.z));return mix(x,vec4(z,y.a),opacity);}"],[21,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb*y.rgb,y.a),opacity);}"],[22,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-abs(1.0-x.rgb-y.rgb),y.a),opacity);}"],[as,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}"],[24,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(2.0*y.rgb*x.rgb,1.0-2.0*(1.0-y.rgb)*(1.0-x.rgb),step(0.5,x.rgb));return mix(x,vec4(z,y.a),opacity);}"],[25,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 y2=2.0*y.rgb;vec3 z=mix(mix(y2,x.rgb,step(0.5*x.rgb,y.rgb)),max(y2-1.0,vec3(0.0)),step(x.rgb,y2-1.0));return mix(x,vec4(z,y.a),opacity);}"],[26,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(min(x.rgb*x.rgb/max(1.0-y.rgb,1e-12),1.0),y.rgb,step(1.0,y.rgb));return mix(x,vec4(z,y.a),opacity);}"],[27,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.x,yHSL.y,xHSL.z));return mix(x,vec4(z,y.a),opacity);}"],[28,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb-min(x.rgb*y.rgb,1.0),y.a),opacity);}"],[29,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb;vec3 b=y.rgb;vec3 y2=2.0*b;vec3 w=step(0.5,b);vec3 c=a-(1.0-y2)*a*(1.0-a);vec3 d=mix(a+(y2-1.0)*(sqrt(a)-a),a+(y2-1.0)*a*((16.0*a-12.0)*a+3.0),w*(1.0-step(0.25,a)));vec3 z=mix(c,d,w);return mix(x,vec4(z,y.a),opacity);}"],[30,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}"],[31,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb+y.rgb-1.0,0.0),y.a),opacity);}"],[32,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(max(1.0-min((1.0-x.rgb)/(2.0*y.rgb),1.0),0.0),min(x.rgb/(2.0*(1.0-y.rgb)),1.0),step(0.5,y.rgb));return mix(x,vec4(z,y.a),opacity);}"]]),cs=class extends Se{constructor(e,t=1){super(),this._blendFunction=e,this.opacity=new be(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this._blendFunction}set blendFunction(e){this._blendFunction=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return ls.get(this.blendFunction)}},hs=class extends Se{constructor(e,t,{attributes:i=$n,blendFunction:n=as,defines:s=new Map,uniforms:r=new Map,extensions:o=null,vertexShader:a=null}={}){super(),this.name=e,this.renderer=null,this.attributes=i,this.fragmentShader=t,this.vertexShader=a,this.defines=s,this.uniforms=r,this.extensions=o,this.blendMode=new cs(n),this.blendMode.addEventListener("change",(e=>this.setChanged())),this._inputColorSpace=Ee,this._outputColorSpace=Pe}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(e){this._inputColorSpace=e,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e,this.setChanged()}set mainScene(e){}set mainCamera(e){}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=me){}update(e,t,i){}setSize(e,t){}initialize(e,t,i){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof de||t instanceof Te||t instanceof Ae||t instanceof Gn)&&this[e].dispose()}}},us=2,ds=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],ps=class extends ge{constructor(e=new Ce){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new be(null),texelSize:new be(new Ce),scale:new be(1),kernel:new be(0)},blending:we,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nvarying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;\n#include <colorspace_fragment>\n}",vertexShader:"uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}"}),this.setTexelSize(e.x,e.y),this.kernelSize=us}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get kernelSequence(){return ds[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t,.5*e,.5*t)}setSize(e,t){const i=1/e,n=1/t;this.uniforms.texelSize.value.set(i,n,.5*i,.5*n)}},ms=class extends Gn{constructor({kernelSize:e=us,resolutionScale:t=.5,width:i=rs.AUTO_SIZE,height:n=rs.AUTO_SIZE,resolutionX:s=i,resolutionY:r=n}={}){super("KawaseBlurPass"),this.renderTargetA=new de(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const o=this.resolution=new rs(this,s,r,t);o.addEventListener("change",(e=>this.setSize(o.baseWidth,o.baseHeight))),this._blurMaterial=new ps,this._blurMaterial.kernelSize=e,this.copyMaterial=new Wn}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(e){this._blurMaterial=e}get dithering(){return this.copyMaterial.dithering}set dithering(e){this.copyMaterial.dithering=e}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(e){this.blurMaterial.kernelSize=e}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,n,s){const r=this.scene,o=this.camera,a=this.renderTargetA,l=this.renderTargetB,c=this.blurMaterial,h=c.kernelSequence;let u=t;this.fullscreenMaterial=c;for(let d=0,p=h.length;d<p;++d){const t=1&d?l:a;c.kernel=h[d],c.inputBuffer=u.texture,e.setRenderTarget(t),e.render(r,o),u=t}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=u.texture,e.setRenderTarget(this.renderToScreen?null:i),e.render(r,o)}setSize(e,t){const i=this.resolution;i.setBaseSize(e,t);const n=i.width,s=i.height;this.renderTargetA.setSize(n,s),this.renderTargetB.setSize(n,s),this.blurMaterial.setSize(e,t)}initialize(e,t,i){void 0!==i&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==ae?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):null!==e&&e.outputColorSpace===X&&(this.renderTargetA.texture.colorSpace=X,this.renderTargetB.texture.colorSpace=X))}static get AUTO_SIZE(){return rs.AUTO_SIZE}},fs=class extends Gn{constructor(e,t,i=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new qn,this.overrideMaterialManager=null===i?null:new ns(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){const e=this.overrideMaterialManager;return null!==e?e.material:null}set overrideMaterial(e){const t=this.overrideMaterialManager;null!==e?null!==t?t.setMaterial(e):this.overrideMaterialManager=new ns(e):null!==t&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,i,n,s){const r=this.scene,o=this.camera,a=this.selection,l=o.layers.mask,c=r.background,h=e.shadowMap.autoUpdate,u=this.renderToScreen?null:t;null!==a&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||null!==this.clearPass.overrideClearColor)&&(r.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(u),null!==this.overrideMaterialManager?this.overrideMaterialManager.render(e,r,o):e.render(r,o),o.layers.mask=l,r.background=c,e.shadowMap.autoUpdate=h}},gs=class extends ge{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new be(null),normalBuffer:new be(null),texelSize:new be(new te)},blending:we,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#include <packing>\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\n#ifdef DOWNSAMPLE_NORMALS\nuniform lowp sampler2D normalBuffer;\n#endif\nvarying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);\n#ifdef DOWNSAMPLE_NORMALS\nvec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;\n#else\nvec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);\n#endif\ngl_FragColor=vec4(n[index],d[index]);}",vertexShader:"uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}"})}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=me){this.depthBuffer=e,this.depthPacking=t}set normalBuffer(e){this.uniforms.normalBuffer.value=e,null!==e?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(e){this.normalBuffer=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},vs=class extends Gn{constructor({normalBuffer:e=null,resolutionScale:t=.5,width:i=rs.AUTO_SIZE,height:n=rs.AUTO_SIZE,resolutionX:s=i,resolutionY:r=n}={}){super("DepthDownsamplingPass");const o=new gs;o.normalBuffer=e,this.fullscreenMaterial=o,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new de(1,1,{minFilter:ye,magFilter:ye,depthBuffer:!1,type:xe}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const a=this.resolution=new rs(this,s,r,t);a.addEventListener("change",(e=>this.setSize(a.baseWidth,a.baseHeight)))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(e,t=me){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t}render(e,t,i,n,s){e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){const i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.fullscreenMaterial.setSize(e,t)}initialize(e,t,i){const n=e.getContext();if(!(n.getExtension("EXT_color_buffer_float")||n.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},_s=class extends ps{constructor({kernelSize:e=us,offset:t=0,rotation:i=0,focusArea:n=.4,feather:s=.3}={}){super(),this.fragmentShader="#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform vec4 maskParams;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;float linearGradientMask(const in float x){return smoothstep(maskParams.x,maskParams.y,x)-smoothstep(maskParams.w,maskParams.z,x);}void main(){vec2 dUv=vOffset*(1.0-linearGradientMask(vUv2.y));vec4 sum=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y-dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y-dUv.y));gl_FragColor=sum*0.25;\n#include <colorspace_fragment>\n}",this.vertexShader="uniform vec4 texelSize;uniform float kernel;uniform float scale;uniform float aspect;uniform vec2 rotation;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;void main(){vec2 uv=position.xy*0.5+0.5;vUv=uv;vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));vOffset=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;gl_Position=vec4(position.xy,1.0,1.0);}",this.kernelSize=e,this.uniforms.aspect=new be(1),this.uniforms.rotation=new be(new te),this.uniforms.maskParams=new be(new Ce),this._offset=t,this._focusArea=n,this._feather=s,this.rotation=i,this.updateParams()}updateParams(){const e=this.uniforms.maskParams.value,t=Math.max(this.focusArea,0),i=Math.max(t-this.feather,0);e.set(this.offset-t,this.offset-i,this.offset+t,this.offset+i)}get rotation(){return Math.acos(this.uniforms.rotation.value.x)}set rotation(e){this.uniforms.rotation.value.set(Math.cos(e),Math.sin(e))}get offset(){return this._offset}set offset(e){this._offset=e,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(e){this._focusArea=e,this.updateParams()}get feather(){return this._feather}set feather(e){this._feather=e,this.updateParams()}setSize(e,t){super.setSize(e,t),this.uniforms.aspect.value=e/t}},ys=class extends ms{constructor({offset:e=0,rotation:t=0,focusArea:i=.4,feather:n=.3,kernelSize:s=us,resolutionScale:r=.5,resolutionX:o=rs.AUTO_SIZE,resolutionY:a=rs.AUTO_SIZE}={}){super({kernelSize:s,resolutionScale:r,resolutionX:o,resolutionY:a}),this.blurMaterial=new _s({kernelSize:s,offset:e,rotation:t,focusArea:i,feather:n})}},xs=class extends hs{constructor({blendFunction:e,offset:t=0,rotation:i=0,focusArea:n=.4,feather:s=.3,kernelSize:r=us,resolutionScale:o=.5,resolutionX:a=rs.AUTO_SIZE,resolutionY:l=rs.AUTO_SIZE}={}){super("TiltShiftEffect","#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D map;\n#else\nuniform lowp sampler2D map;\n#endif\nuniform vec2 maskParams;varying vec2 vUv2;float linearGradientMask(const in float x){return step(maskParams.x,x)-step(maskParams.y,x);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){float mask=linearGradientMask(vUv2.y);vec4 texel=texture2D(map,uv);outputColor=mix(texel,inputColor,mask);}",{vertexShader:"uniform vec2 rotation;varying vec2 vUv2;void mainSupport(const in vec2 uv){vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));}",blendFunction:e,uniforms:new Map([["rotation",new be(new te)],["maskParams",new be(new te)],["map",new be(null)]])}),this._offset=t,this._focusArea=n,this._feather=s,this.renderTarget=new de(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="TiltShift.Target",this.uniforms.get("map").value=this.renderTarget.texture,this.blurPass=new ys({kernelSize:r,resolutionScale:o,resolutionX:a,resolutionY:l,offset:t,rotation:i,focusArea:n,feather:s});const c=this.resolution=new rs(this,a,l,o);c.addEventListener("change",(e=>this.setSize(c.baseWidth,c.baseHeight))),this.rotation=i,this.updateParams()}updateParams(){const e=this.uniforms.get("maskParams").value,t=Math.max(this.focusArea-this.feather,0);e.set(this.offset-t,this.offset+t)}get rotation(){return Math.acos(this.uniforms.get("rotation").value.x)}set rotation(e){this.uniforms.get("rotation").value.set(Math.cos(e),Math.sin(e)),this.blurPass.blurMaterial.rotation=e}get offset(){return this._offset}set offset(e){this._offset=e,this.blurPass.blurMaterial.offset=e,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(e){this._focusArea=e,this.blurPass.blurMaterial.focusArea=e,this.updateParams()}get feather(){return this._feather}set feather(e){this._feather=e,this.blurPass.blurMaterial.feather=e,this.updateParams()}get bias(){return 0}set bias(e){}update(e,t,i){this.blurPass.render(e,t,this.renderTarget)}setSize(e,t){const i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.blurPass.resolution.copy(i)}initialize(e,t,i){this.blurPass.initialize(e,t,i),void 0!==i&&(this.renderTarget.texture.type=i,null!==e&&e.outputColorSpace===X&&(this.renderTarget.texture.colorSpace=X))}},bs="#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#define packFloatToRGBA(v) packDepthToRGBA(v)\n#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#if DEPTH_PACKING == 3201\nuniform lowp sampler2D depthBuffer;\n#elif defined(GL_FRAGMENT_PRECISION_HIGH)\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}float getViewZ(const in float depth){\n#ifdef PERSPECTIVE_CAMERA\nreturn perspectiveDepthToViewZ(depth,cameraNear,cameraFar);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNear,cameraFar);\n#endif\n}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;\n#ifdef ENCODE_OUTPUT\n#include <colorspace_fragment>\n#endif\n#include <dithering_fragment>\n}",ws="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",Ts=class extends ge{constructor(e,t,i,n,s=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:J.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new be(null),depthBuffer:new be(null),resolution:new be(new te),texelSize:new be(new te),cameraNear:new be(.3),cameraFar:new be(1e3),aspect:new be(1),time:new be(0)},blending:we,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:s}),e&&this.setShaderParts(e),t&&this.setDefines(t),i&&this.setUniforms(i),this.copyCameraSettings(n)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=me){this.depthBuffer=e,this.depthPacking=t}setShaderData(e){this.setShaderParts(e.shaderParts),this.setDefines(e.defines),this.setUniforms(e.uniforms),this.setExtensions(e.extensions)}setShaderParts(e){return this.fragmentShader=bs.replace(es.FRAGMENT_HEAD,e.get(es.FRAGMENT_HEAD)||"").replace(es.FRAGMENT_MAIN_UV,e.get(es.FRAGMENT_MAIN_UV)||"").replace(es.FRAGMENT_MAIN_IMAGE,e.get(es.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=ws.replace(es.VERTEX_HEAD,e.get(es.VERTEX_HEAD)||"").replace(es.VERTEX_MAIN_SUPPORT,e.get(es.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(e){for(const t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(const t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(const t of e)this.extensions[t]=!0;return this}get encodeOutput(){return void 0!==this.defines.ENCODE_OUTPUT}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){this.copyCameraSettings(e)}copyCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof j?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){const i=this.uniforms;i.resolution.value.set(e,t),i.texelSize.value.set(1/e,1/t),i.aspect.value=e/t}static get Section(){return es}};function As(e,t,i){for(const n of t){const t="$1"+e+n.charAt(0).toUpperCase()+n.slice(1),s=new RegExp("([^\\.])(\\b"+n+"\\b)","g");for(const e of i.entries())null!==e[1]&&i.set(e[0],e[1].replace(s,t))}}function Ms(e,t,i){let n=t.getFragmentShader(),s=t.getVertexShader();const r=void 0!==n&&/mainImage/.test(n),o=void 0!==n&&/mainUv/.test(n);if(i.attributes|=t.getAttributes(),void 0===n)throw new Error(`Missing fragment shader (${t.name})`);if(o&&i.attributes&Jn)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${t.name})`);if(!r&&!o)throw new Error(`Could not find mainImage or mainUv function (${t.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,l=i.shaderParts;let c=l.get(es.FRAGMENT_HEAD)||"",h=l.get(es.FRAGMENT_MAIN_UV)||"",u=l.get(es.FRAGMENT_MAIN_IMAGE)||"",d=l.get(es.VERTEX_HEAD)||"",p=l.get(es.VERTEX_MAIN_SUPPORT)||"";const m=new Set,f=new Set;if(o&&(h+=`\t${e}MainUv(UV);\n`,i.uvTransformation=!0),null!==s&&/mainSupport/.test(s)){const t=/mainSupport *\([\w\s]*?uv\s*?\)/.test(s);p+=`\t${e}MainSupport(`,p+=t?"vUv);\n":");\n";for(const e of s.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const t of e[1].split(/\s*,\s*/))i.varyings.add(t),m.add(t),f.add(t);for(const e of s.matchAll(a))f.add(e[1])}for(const e of n.matchAll(a))f.add(e[1]);for(const e of t.defines.keys())f.add(e.replace(/\([\w\s,]*\)/g,""));for(const e of t.uniforms.keys())f.add(e);f.delete("while"),f.delete("for"),f.delete("if"),t.uniforms.forEach(((t,n)=>i.uniforms.set(e+n.charAt(0).toUpperCase()+n.slice(1),t))),t.defines.forEach(((t,n)=>i.defines.set(e+n.charAt(0).toUpperCase()+n.slice(1),t)));const g=new Map([["fragment",n],["vertex",s]]);As(e,f,i.defines),As(e,f,g),n=g.get("fragment"),s=g.get("vertex");const v=t.blendMode;if(i.blendModes.set(v.blendFunction,v),r){null!==t.inputColorSpace&&t.inputColorSpace!==i.colorSpace&&(u+=t.inputColorSpace===X?"color0 = sRGBTransferOETF(color0);\n\t":"color0 = sRGBToLinear(color0);\n\t"),t.outputColorSpace!==Pe?i.colorSpace=t.outputColorSpace:null!==t.inputColorSpace&&(i.colorSpace=t.inputColorSpace);const s=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;u+=`${e}MainImage(color0, UV, `,i.attributes&Qn&&s.test(n)&&(u+="depth, ",i.readDepth=!0),u+="color1);\n\t";const r=e+"BlendOpacity";i.uniforms.set(r,v.opacity),u+=`color0 = blend${v.blendFunction}(color0, color1, ${r});\n\n\t`,c+=`uniform float ${r};\n\n`}if(c+=n+"\n",null!==s&&(d+=s+"\n"),l.set(es.FRAGMENT_HEAD,c),l.set(es.FRAGMENT_MAIN_UV,h),l.set(es.FRAGMENT_MAIN_IMAGE,u),l.set(es.VERTEX_HEAD,d),l.set(es.VERTEX_MAIN_SUPPORT,p),null!==t.extensions)for(const e of t.extensions)i.extensions.add(e)}}var Ss=class extends Gn{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new Ts(null,null,null,e),this.listener=e=>this.handleEvent(e),this.effects=[],this.setEffects(t),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(e){for(const t of this.effects)t.mainScene=e}set mainCamera(e){this.fullscreenMaterial.copyCameraSettings(e);for(const t of this.effects)t.mainCamera=e}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){const t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}setEffects(e){for(const t of this.effects)t.removeEventListener("change",this.listener);this.effects=e.sort(((e,t)=>t.attributes-e.attributes));for(const t of this.effects)t.addEventListener("change",this.listener)}updateMaterial(){const e=new ts;let t=0;for(const o of this.effects)if(o.blendMode.blendFunction===os)e.attributes|=o.getAttributes()&Qn;else{if(e.attributes&o.getAttributes()&Jn)throw new Error(`Convolution effects cannot be merged (${o.name})`);Ms("e"+t++,o,e)}let i=e.shaderParts.get(es.FRAGMENT_HEAD),n=e.shaderParts.get(es.FRAGMENT_MAIN_IMAGE),s=e.shaderParts.get(es.FRAGMENT_MAIN_UV);const r=/\bblend\b/g;for(const o of e.blendModes.values())i+=o.getShaderCode().replace(r,`blend${o.blendFunction}`)+"\n";e.attributes&Qn?(e.readDepth&&(n="float depth = readDepth(UV);\n\n\t"+n),this.needsDepthTexture=null===this.getDepthTexture()):this.needsDepthTexture=!1,e.colorSpace===X&&(n+="color0 = sRGBToLinear(color0);\n\t"),e.uvTransformation?(s="vec2 transformedUv = vUv;\n"+s,e.defines.set("UV","transformedUv")):e.defines.set("UV","vUv"),e.shaderParts.set(es.FRAGMENT_HEAD,i),e.shaderParts.set(es.FRAGMENT_MAIN_IMAGE,n),e.shaderParts.set(es.FRAGMENT_MAIN_UV,s);for(const[o,a]of e.shaderParts)null!==a&&e.shaderParts.set(o,a.trim().replace(/^#/,"\n#"));this.skipRendering=0===t,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(e)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=me){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(const i of this.effects)i.setDepthTexture(e,t)}render(e,t,i,n,s){for(const r of this.effects)r.update(e,t,n);if(!this.skipRendering||this.renderToScreen){const s=this.fullscreenMaterial;s.inputBuffer=t.texture,s.time+=n*this.timeScale,e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(const i of this.effects)i.setSize(e,t)}initialize(e,t,i){this.renderer=e;for(const n of this.effects)n.initialize(e,t,i);this.updateMaterial(),void 0!==i&&i!==ae&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const e of this.effects)e.removeEventListener("change",this.listener),e.dispose()}handleEvent(e){if("change"===e.type)this.recompile()}},Es=class extends Gn{constructor(e,t,{renderTarget:i,resolutionScale:n=1,width:s=rs.AUTO_SIZE,height:r=rs.AUTO_SIZE,resolutionX:o=s,resolutionY:a=r}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new fs(e,t,new _e);const l=this.renderPass;l.ignoreBackground=!0,l.skipShadowMapUpdate=!0;const c=l.getClearPass();c.overrideClearColor=new q(7829503),c.overrideClearAlpha=1,this.renderTarget=i,void 0===this.renderTarget&&(this.renderTarget=new de(1,1,{minFilter:ye,magFilter:ye}),this.renderTarget.texture.name="NormalPass.Target");const h=this.resolution=new rs(this,o,a,n);h.addEventListener("change",(e=>this.setSize(h.baseWidth,h.baseHeight)))}set mainScene(e){this.renderPass.mainScene=e}set mainCamera(e){this.renderPass.mainCamera=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,n,s){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,r,r)}setSize(e,t){const i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}};let Ps=class{static isWebGL2Available(){try{const e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch{return!1}}static isColorSpaceAvailable(e){try{const t=document.createElement("canvas"),i=window.WebGL2RenderingContext&&t.getContext("webgl2");return i.drawingBufferColorSpace=e,i.drawingBufferColorSpace===e}catch{return!1}}static getWebGL2ErrorMessage(){return this.getErrorMessage(2)}static getErrorMessage(e){const t={1:window.WebGLRenderingContext,2:window.WebGL2RenderingContext};let i='Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>';const n=document.createElement("div");return n.id="webglmessage",n.style.fontFamily="monospace",n.style.fontSize="13px",n.style.fontWeight="normal",n.style.textAlign="center",n.style.background="#fff",n.style.color="#000",n.style.padding="1.5em",n.style.width="400px",n.style.margin="5em auto 0",i=t[e]?i.replace("$0","graphics card"):i.replace("$0","browser"),i=i.replace("$1",{1:"WebGL",2:"WebGL 2"}[e]),n.innerHTML=i,n}static isWebGLAvailable(){console.warn("isWebGLAvailable() has been deprecated and will be removed in r178. Use isWebGL2Available() instead.");try{const e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch{return!1}}static getWebGLErrorMessage(){return console.warn("getWebGLErrorMessage() has been deprecated and will be removed in r178. Use getWebGL2ErrorMessage() instead."),this.getErrorMessage(1)}};const Cs=Symbol("effectComposerPmndrs"),Rs=e({__name:"EffectComposerPmndrs",props:{enabled:{type:Boolean,default:!0},depthBuffer:{type:Boolean,default:void 0},disableNormalPass:{type:Boolean,default:!1},stencilBuffer:{type:Boolean,default:void 0},resolutionScale:{},autoClear:{type:Boolean,default:!0},multisampling:{default:0},frameBufferType:{default:Re}},emits:["render"],setup(e,{expose:t,emit:i}){const n=e,r=i,{scene:o,camera:c,renderer:h,sizes:u,render:d}=ln(),p=s(null);let m=null,f=null;y(Cs,p),t({composer:p});const v=g((()=>{const e=new Zn,t={depthBuffer:void 0!==n.depthBuffer?n.depthBuffer:e.inputBuffer.depthBuffer,stencilBuffer:void 0!==n.stencilBuffer?n.stencilBuffer:e.inputBuffer.stencilBuffer,multisampling:Ps.isWebGL2Available()?void 0!==n.multisampling?n.multisampling:e.multisampling:0,frameBufferType:void 0!==n.frameBufferType?n.frameBufferType:Re};return e.dispose(),t})),_=()=>{var e;!h.value&&!o.value&&!c.value||(null==(e=p.value)||e.dispose(),p.value=new Zn(h.value,v.value),p.value.addPass(new fs(o.value,c.value)),n.disableNormalPass||p.value&&(f=new Es(o.value,c.value),f.enabled=!1,p.value.addPass(f),void 0!==n.resolutionScale&&Ps.isWebGL2Available()&&(m=new vs({normalBuffer:f.texture,resolutionScale:n.resolutionScale}),m.enabled=!1,p.value.addPass(m))))};a([h,o,c,()=>n.disableNormalPass],(()=>{!u.width.value||!u.height.value||_()})),a((()=>[u.width.value,u.height.value]),(([e,t])=>{!e&&!t||(p.value?p.value.setSize(e,t):_())}),{immediate:!0});const{render:x}=cn();return x((()=>{if(n.enabled&&h.value&&p.value&&u.width.value&&u.height.value&&d.frames.value>0){const e=h.value.autoClear;h.value.autoClear=n.autoClear,n.stencilBuffer&&!n.autoClear&&h.value.clearStencil(),p.value.render(),r("render",p.value),h.value.autoClear=e}d.frames.value="always"===d.mode.value?1:Math.max(0,d.frames.value-1)})),l((()=>{var e;null==(e=p.value)||e.dispose()})),(e,t)=>T(e.$slots,"default")}}),Ls=(e,i,n)=>{const r=t(Cs),o=s(null),c=s(null),{scene:h,camera:u,invalidate:d}=ln();a(i,(()=>d()));f((()=>{!u.value||null==c||!c.value||(c.value.mainCamera=u.value)}));const p=f((()=>{var t;!u.value||null==r||!r.value||!h.value||(A((()=>p())),!c.value&&(!u.value||null==r||!r.value||!h.value||(c.value=e(),o.value=new Ss(u.value,c.value),r.value.addPass(o.value,t))))}));return l((()=>{var e,t,i;o.value&&(null==(e=null==r?void 0:r.value)||e.removePass(o.value)),null==(t=c.value)||t.dispose(),null==(i=o.value)||i.dispose()})),{pass:o,effect:c}},Ds=/([^[.\]])+/g,Os=(e,t,i)=>{const n=Array.isArray(t)?t:t.match(Ds);n&&n.reduce(((e,t,s)=>(void 0===e[t]&&(e[t]={}),s===n.length-1&&(e[t]=i),e[t])),e)},ks=(e,t,i,n,s={})=>a(e,(s=>{var r;if(t.value)if(void 0===s){const e=n();Os(t.value,i,((e,t)=>{if(!t)return;const i=Array.isArray(t)?t:t.match(Ds);return null==i?void 0:i.reduce(((e,t)=>e&&e[t]),e)})(e,i)),null==(r=e.dispose)||r.call(e)}else Os(t.value,i,e())}),s),Is=e({__name:"TiltShiftPmndrs",props:{blendFunction:{},offset:{},rotation:{},focusArea:{},feather:{},kernelSize:{},resolutionScale:{},resolutionX:{},resolutionY:{}},setup(e,{expose:t}){const i=e,{pass:n,effect:s}=Ls((()=>new xs(i)),i);return t({pass:n,effect:s}),((e,t,i)=>{e.map((([e,n])=>ks(e,t,n,i)))})([[()=>i.blendFunction,"blendMode.blendFunction"],[()=>i.offset,"offset"],[()=>i.rotation,"rotation"],[()=>i.focusArea,"focusArea"],[()=>i.feather,"feather"],[()=>i.kernelSize,"kernelSize"],[()=>i.resolutionScale,"resolution.scale"],[()=>i.resolutionX,"resolution.width"],[()=>i.resolutionY,"resolution.height"]],s,(()=>new xs)),()=>{}}});new Le(-1,1,1,-1,0,1);new class extends Me{constructor(){super(),this.setAttribute("position",new De([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new De([0,2,0,0,2,0],2))}},new te(1/1024,1/512),new te(1/1024,1/512),new te(1/1024,1/512),new q(0),new te(1,0),new te(0,1);class Fs extends Z{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new te(.5,.5),this.addEventListener("removed",(function(){this.traverse((function(e){e.element instanceof e.element.ownerDocument.defaultView.Element&&null!==e.element.parentNode&&e.element.remove()}))}))}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const Us=new ie,Bs=new Ne,zs=new Ne,Ns=new ie,js=new ie;class Hs{constructor(e={}){const t=this;let i,n,s,r;const o={objects:new WeakMap},a=void 0!==e.element?e.element:document.createElement("div");function l(e){e.isCSS2DObject&&(e.element.style.display="none");for(let t=0,i=e.children.length;t<i;t++)l(e.children[t])}function c(e,i,n){if(!1!==e.visible){if(e.isCSS2DObject){Us.setFromMatrixPosition(e.matrixWorld),Us.applyMatrix4(zs);const l=Us.z>=-1&&Us.z<=1&&!0===e.layers.test(n.layers),c=e.element;c.style.display=!0===l?"":"none",!0===l&&(e.onBeforeRender(t,i,n),c.style.transform="translate("+-100*e.center.x+"%,"+-100*e.center.y+"%)translate("+(Us.x*s+s)+"px,"+(-Us.y*r+r)+"px)",c.parentNode!==a&&a.appendChild(c),e.onAfterRender(t,i,n));const u={distanceToCameraSquared:h(n,e)};o.objects.set(e,u)}for(let t=0,s=e.children.length;t<s;t++)c(e.children[t],i,n)}else l(e)}function h(e,t){return Ns.setFromMatrixPosition(e.matrixWorld),js.setFromMatrixPosition(t.matrixWorld),Ns.distanceToSquared(js)}a.style.overflow="hidden",this.domElement=a,this.getSize=function(){return{width:i,height:n}},this.render=function(e,t){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),Bs.copy(t.matrixWorldInverse),zs.multiplyMatrices(t.projectionMatrix,Bs),c(e,e,t),function(e){const t=function(e){const t=[];return e.traverseVisible((function(e){e.isCSS2DObject&&t.push(e)})),t}(e).sort((function(e,t){if(e.renderOrder!==t.renderOrder)return t.renderOrder-e.renderOrder;return o.objects.get(e).distanceToCameraSquared-o.objects.get(t).distanceToCameraSquared})),i=t.length;for(let n=0,s=t.length;n<s;n++)t[n].element.style.zIndex=i-n}(e)},this.setSize=function(e,t){i=e,n=t,s=i/2,r=n/2,a.style.width=e+"px",a.style.height=t+"px"}}}function Gs(e,t){if(!e)throw new Error("Invariant failed")}const Vs=new ie;function Ws(e,t,i=new ie,n){const{x:s,y:r,z:o}=e,a=t.x,l=t.y,c=t.z,h=s*s*a,u=r*r*l,d=o*o*c,p=h+u+d,m=Math.sqrt(1/p);if(!Number.isFinite(m))return;const f=Vs.copy(e).multiplyScalar(m);if(p<(n?.centerTolerance??.1))return i.copy(f);const g=f.multiply(t).multiplyScalar(2);let v,_,y,x,b=(1-m)*e.length()/(g.length()/2),w=0;do{b-=w,v=1/(1+b*a),_=1/(1+b*l),y=1/(1+b*c);const e=v*v,t=_*_,i=y*y;x=h*e+u*t+d*i-1,w=x/(-2*(h*(e*v)*a+u*(t*_)*l+d*(i*y)*c))}while(Math.abs(x)>1e-12);return i.set(s*v,r*_,o*y)}const Ks=new ie,Xs=new ie,qs=new ie;let Ys=class e{static WGS84=new e(6378137,6378137,6356752.314245179);radii;constructor(e,t,i){this.radii=new ie(e,t,i)}get minimumRadius(){return Math.min(this.radii.x,this.radii.y,this.radii.z)}get maximumRadius(){return Math.max(this.radii.x,this.radii.y,this.radii.z)}reciprocalRadii(e=new ie){const{x:t,y:i,z:n}=this.radii;return e.set(1/t,1/i,1/n)}reciprocalRadiiSquared(e=new ie){const{x:t,y:i,z:n}=this.radii;return e.set(1/t**2,1/i**2,1/n**2)}projectOnSurface(e,t=new ie,i){return Ws(e,this.reciprocalRadiiSquared(),t,i)}getSurfaceNormal(e,t=new ie){return t.multiplyVectors(this.reciprocalRadiiSquared(Ks),e).normalize()}getEastNorthUpVectors(e,t=new ie,i=new ie,n=new ie){this.getSurfaceNormal(e,n),t.set(-e.y,e.x,0).normalize(),i.crossVectors(n,t).normalize()}getEastNorthUpFrame(e,t=new Ne){const i=Ks,n=Xs,s=qs;return this.getEastNorthUpVectors(e,i,n,s),t.makeBasis(i,n,s).setPosition(e)}getIntersection(e,t=new ie){const i=this.reciprocalRadii(Ks),n=Xs.copy(i).multiply(e.origin),s=qs.copy(i).multiply(e.direction),r=n.lengthSq(),o=s.lengthSq(),a=n.dot(s),l=a**2-o*(r-1);if(1===r)return t.copy(e.origin);if(r>1){if(a>=0||l<0)return;const i=Math.sqrt(l),n=(-a-i)/o,s=(-a+i)/o;return e.at(Math.min(n,s),t)}if(r<1){const i=a**2-o*(r-1),n=(-a+Math.sqrt(i))/o;return e.at(n,t)}return a<0?e.at(-a/o,t):void 0}getOsculatingSphereCenter(e,t,i=new ie){Gs(this.radii.x===this.radii.y);const n=this.radii.x**2,s=this.radii.z**2,r=Ks.set(e.x/n,e.y/n,e.z/s).normalize();return i.copy(r.multiplyScalar(-t).add(e))}getNormalAtHorizon(e,t,i=new ie){Gs(this.radii.x===this.radii.y);const n=this.radii.x**2,s=this.radii.z**2,r=e,o=t;let a=(r.x*o.x+r.y*o.y)/n+r.z*o.z/s;a/=(r.x**2+r.y**2)/n+r.z**2/s;const l=Ks.copy(o).multiplyScalar(-a).add(e);return i.set(l.x/n,l.y/n,l.z/s).normalize()}};const Zs=new ie,$s=new ie;class Qs{constructor(e=0,t=0,i=0){this.longitude=e,this.latitude=t,this.height=i}static MIN_LONGITUDE=-Math.PI;static MAX_LONGITUDE=Math.PI;static MIN_LATITUDE=-Math.PI/2;static MAX_LATITUDE=Math.PI/2;set(e,t,i){return this.longitude=e,this.latitude=t,null!=i&&(this.height=i),this}clone(){return new Qs(this.longitude,this.latitude,this.height)}copy(e){return this.longitude=e.longitude,this.latitude=e.latitude,this.height=e.height,this}equals(e){return e.longitude===this.longitude&&e.latitude===this.latitude&&e.height===this.height}setLongitude(e){return this.longitude=e,this}setLatitude(e){return this.latitude=e,this}setHeight(e){return this.height=e,this}normalize(){return this.longitude<Qs.MIN_LONGITUDE&&(this.longitude+=2*Math.PI),this}setFromECEF(e,t){const i=(t?.ellipsoid??Ys.WGS84).reciprocalRadiiSquared(Zs),n=Ws(e,i,$s,t);if(null==n)throw new Error(`Could not project position to ellipsoid surface: ${e.toArray()}`);const s=Zs.multiplyVectors(n,i).normalize();this.longitude=Math.atan2(s.y,s.x),this.latitude=Math.asin(s.z);const r=Zs.subVectors(e,n);return this.height=Math.sign(r.dot(e))*r.length(),this}toECEF(e=new ie,t){const i=t?.ellipsoid??Ys.WGS84,n=Zs.multiplyVectors(i.radii,i.radii),s=Math.cos(this.latitude),r=$s.set(s*Math.cos(this.longitude),s*Math.sin(this.longitude),Math.sin(this.latitude)).normalize();return e.multiplyVectors(n,r),e.divideScalar(Math.sqrt(r.dot(e))).add(r.multiplyScalar(this.height))}fromArray(e,t=0){return this.longitude=e[t],this.latitude=e[t+1],this.height=e[t+2],this}toArray(e=[],t=0){return e[t]=this.longitude,e[t+1]=this.latitude,e[t+2]=this.height,e}*[Symbol.iterator](){yield this.longitude,yield this.latitude,yield this.height}}const Js=1e-6,er=new ie,tr=new ie,ir=new ie,nr=new ie,sr=new ie,rr=new ie,or=new Ne,ar=new Ve,lr=new Ge;class cr{_distance;heading;_pitch;roll;constructor(e=0,t=0,i=0,n=0){this.distance=e,this.heading=t,this.pitch=i,this.roll=n}get distance(){return this._distance}set distance(e){this._distance=Math.max(e,Js)}get pitch(){return this._pitch}set pitch(e){this._pitch=Y.clamp(e,-Math.PI/2+Js,Math.PI/2-Js)}set(e,t,i,n){return this.distance=e,this.heading=t,this.pitch=i,null!=n&&(this.roll=n),this}clone(){return new cr(this.distance,this.heading,this.pitch,this.roll)}copy(e){return this.distance=e.distance,this.heading=e.heading,this.pitch=e.pitch,this.roll=e.roll,this}equals(e){return e.distance===this.distance&&e.heading===this.heading&&e.pitch===this.pitch&&e.roll===this.roll}decompose(e,t,i,n,s=Ys.WGS84){s.getEastNorthUpVectors(e,er,tr,ir),n?.copy(ir);const r=nr.copy(er).multiplyScalar(Math.cos(this.heading)).add(sr.copy(tr).multiplyScalar(Math.sin(this.heading))).multiplyScalar(Math.cos(this.pitch)).add(sr.copy(ir).multiplyScalar(Math.sin(this.pitch))).normalize().multiplyScalar(this.distance);if(t.copy(e).sub(r),0!==this.roll){const i=nr.copy(e).sub(t).normalize();ir.applyQuaternion(ar.setFromAxisAngle(i,this.roll))}i.setFromRotationMatrix(or.lookAt(t,e,ir))}setFromCamera(e,t=Ys.WGS84){const i=nr.setFromMatrixPosition(e.matrixWorld),n=sr.set(0,0,.5).unproject(e).sub(i).normalize(),s=t.getIntersection(lr.set(i,n));if(null==s)return;this.distance=i.distanceTo(s),t.getEastNorthUpVectors(s,er,tr,ir),this.heading=Math.atan2(tr.dot(n),er.dot(n)),this.pitch=Math.asin(ir.dot(n));const r=nr.copy(e.up).applyQuaternion(e.quaternion),o=rr.copy(n).multiplyScalar(-r.dot(n)).add(r).normalize(),a=nr.copy(n).multiplyScalar(-ir.dot(n)).add(ir).normalize(),l=a.dot(o),c=n.dot(a.cross(o));return this.roll=Math.atan2(c,l),this}}const hr=Y.degToRad,ur=Y.radToDeg,dr=(e,t,i)=>new Qs(hr(e),hr(t),i).toECEF(),pr=new cr,mr=new Qs,fr=new ie,gr=new ie,vr=new Ge,_r=Ys.WGS84;function yr(e,t,i){const n=i=>n=>{const s=[{...n,index:0},t,0];e(i,...s)};return{click:n("click"),"double-click":n("double-click"),"context-menu":n("context-menu"),"pointer-enter":n("pointer-enter"),"pointer-leave":n("pointer-leave"),"pointer-over":n("pointer-over"),"pointer-down":n("pointer-down"),"pointer-up":n("pointer-up"),wheel:n("wheel")}}function xr(e,t){e.removeEventListener("click",t.click),e.removeEventListener("dblclick",t["double-click"]),e.removeEventListener("contextmenu",t["context-menu"]),e.removeEventListener("pointerenter",t["pointer-enter"]),e.removeEventListener("pointerleave",t["pointer-leave"]),e.removeEventListener("pointerover",t["pointer-over"]),e.removeEventListener("pointerdown",t["pointer-down"]),e.removeEventListener("pointerup",t["pointer-up"]),e.removeEventListener("wheel",t.wheel)}const br=["object"],wr=e({__name:"GeoCSS2D",props:{point:{},renderOrder:{default:1},id:{}},emits:["click","double-click","context-menu","pointer-enter","pointer-leave","pointer-over","pointer-down","pointer-up","wheel"],setup(e,{expose:t,emit:n}){const s=document.createElement("div"),h=e,d=i(),p=n,m=()=>{k(d.default()[0],s)},f=new Fs(s),g=new Ie;g.layers.enableAll(),g.add(f),f.layers.set(1),f.renderOrder=h.renderOrder;const v=()=>{const e=dr(h.point.lon,h.point.lat,h.point.height);f.position.copy(e)},_=yr(p,h);return a([()=>h.point.lon,()=>h.point.lat,()=>h.point.height],(()=>{v()})),o((()=>{v(),m(),s.addEventListener("click",_.click),s.addEventListener("dblclick",_["double-click"]),s.addEventListener("contextmenu",_["context-menu"]),s.addEventListener("pointerenter",_["pointer-enter"]),s.addEventListener("pointerleave",_["pointer-leave"]),s.addEventListener("pointerover",_["pointer-over"]),s.addEventListener("pointerdown",_["pointer-down"]),s.addEventListener("pointerup",_["pointer-up"]),s.addEventListener("wheel",_.wheel)})),l((()=>{xr(s,_),g.clear()})),t({update:m}),(e,t)=>(c(),r("primitive",{object:u(g)},null,8,br))}}),Tr=["object"],Ar=e({__name:"GeoText",props:{point:{},fontSize:{default:16},color:{default:"#333"},text:{},renderOrder:{default:1},align:{default:"left"},id:{}},emits:["click","double-click","context-menu","pointer-enter","pointer-leave","pointer-over","pointer-down","pointer-up","wheel"],setup(e,{emit:t}){const i=document.createElement("div"),n=e,s=t,r=()=>{switch(i.innerText=n.text,i.style.fontSize=n.fontSize+"px",i.style.color=n.color,i.style.pointerEvents="auto",i.style.userSelect="none",n.align){case"center":i.style.transform="translateX(-50%)",i.style.textAlign="center";break;case"right":i.style.transform="translateX(-100%)",i.style.textAlign="right";break;default:i.style.transform="translateX(0)",i.style.textAlign="left"}},a=new Fs(i);a.renderOrder=n.renderOrder;const h=yr(s,n);return o((()=>{r(),i.addEventListener("click",h.click),i.addEventListener("dblclick",h["double-click"]),i.addEventListener("contextmenu",h["context-menu"]),i.addEventListener("pointerenter",h["pointer-enter"]),i.addEventListener("pointerleave",h["pointer-leave"]),i.addEventListener("pointerover",h["pointer-over"]),i.addEventListener("pointerdown",h["pointer-down"]),i.addEventListener("pointerup",h["pointer-up"]),i.addEventListener("wheel",h.wheel)})),f((()=>{r()})),l((()=>{xr(i,h),i.remove()})),(e,t)=>(c(),P(u(jo),{point:n.point},{default:L((()=>[R("primitive",{object:u(a)},null,8,Tr)])),_:1},8,["point"]))}}),Mr=["object"],Sr=e({__name:"GeoIcon",props:{point:{},size:{},icon:{},renderOrder:{default:1},id:{}},emits:["click","double-click","context-menu","pointer-enter","pointer-leave","pointer-over","pointer-down","pointer-up","wheel"],setup(e,{emit:t}){const i=document.createElement("img"),n=e,s=t,r=()=>{i.src=n.icon,i.style.width=n.size+"px",i.style.height=n.size+"px",i.style.left="0",i.style.top="0",i.style.pointerEvents="all"},a=new Fs(i);a.renderOrder=n.renderOrder;const h=yr(s,n);return o((()=>{r(),i.addEventListener("click",h.click),i.addEventListener("dblclick",h["double-click"]),i.addEventListener("contextmenu",h["context-menu"]),i.addEventListener("pointerenter",h["pointer-enter"]),i.addEventListener("pointerleave",h["pointer-leave"]),i.addEventListener("pointerover",h["pointer-over"]),i.addEventListener("pointerdown",h["pointer-down"]),i.addEventListener("pointerup",h["pointer-up"]),i.addEventListener("wheel",h.wheel)})),f((()=>{r()})),l((()=>{xr(i,h),i.remove()})),(e,t)=>(c(),P(u(jo),{point:n.point},{default:L((()=>[R("primitive",{object:u(a)},null,8,Mr)])),_:1},8,["point"]))}}),Er=["object"],Pr=e({__name:"GeoParticle",props:{points:{},size:{},icon:{},color:{},renderOrder:{default:1},raycastActive:{type:Boolean},raycastMultiplier:{default:1},sizeAttenuation:{type:Boolean,default:!0}},emits:["click","double-click","context-menu","pointer-enter","pointer-leave","pointer-over","pointer-down","pointer-up","wheel"],setup(e,{emit:t}){const i=e,h=t,d=s(),p=n([]),m=n(new ie),f=e=>{const t=e.raycast;e.raycast=function(e,n){const s=e.params.Points?.threshold||1;e.params.Points?e.params.Points.threshold=s*i.raycastMultiplier:e.params.Points={threshold:s*i.raycastMultiplier};const r=t.call(this,e,n);return e.params.Points.threshold=s,r}},g=()=>{if(d.value){const e=d.value.geometry,t=e.getAttribute("position"),n=e.getAttribute("color");p.value=i.points.map((e=>dr(e.lon,e.lat,e.height||0))),m.value=(e=>{if(0===e.length)return new ie;const t=new ie;return e.forEach((e=>t.add(e))),t.divideScalar(e.length),t})(p.value),((e,t)=>e.map((e=>e.clone().sub(t))))(p.value,m.value).forEach(((e,s)=>{t.setXYZ(s,e.x,e.y,e.z);const r=i.points[s].color||i.color||"#ffffff",o=new q(r);n.setXYZ(s,o.r,o.g,o.b)})),t.needsUpdate=!0,n.needsUpdate=!0,d.value.position.copy(m.value)}};a((()=>i.points),(()=>{g()}),{immediate:!0}),a((()=>i.size),(()=>{d.value&&(d.value.material.size=i.size||32,d.value.material.needsUpdate=!0)})),a((()=>i.raycastMultiplier),(e=>{d.value&&f(d.value)}));const v=e=>t=>{if(d.value&&i.raycastActive&&void 0!==t.index&&t.index<i.points.length){const n=i.points[t.index];h(e,t,n,t.index)}},_=v("click"),y=v("double-click"),x=v("context-menu"),b=v("pointer-enter"),w=v("pointer-leave"),T=v("pointer-over"),A=v("pointer-down"),M=v("pointer-up"),S=v("wheel");return o((()=>{(()=>{const e=new je({size:i.size||32,transparent:!0,sizeAttenuation:i.sizeAttenuation,vertexColors:!0});if(i.icon){const t=(new Oe).load(i.icon);e.map=t,e.needsUpdate=!0}const t=new Me,n=new Float32Array(3*i.points.length),s=new Float32Array(3*i.points.length);t.setAttribute("position",new De(n,3)),t.setAttribute("color",new De(s,3)),d.value=new He(t,e),d.value.renderOrder=i.renderOrder,f(d.value)})(),g()})),l((()=>{if(d.value){d.value.geometry.dispose();const e=d.value.material;e.map?.dispose(),e.dispose()}})),(e,t)=>d.value?(c(),r("primitive",{key:0,object:d.value,onClick:t[0]||(t[0]=(...e)=>u(_)&&u(_)(...e)),onDoubleClick:t[1]||(t[1]=(...e)=>u(y)&&u(y)(...e)),onContextMenu:t[2]||(t[2]=(...e)=>u(x)&&u(x)(...e)),onPointerEnter:t[3]||(t[3]=(...e)=>u(b)&&u(b)(...e)),onPointerLeave:t[4]||(t[4]=(...e)=>u(w)&&u(w)(...e)),onPointerOver:t[5]||(t[5]=(...e)=>u(T)&&u(T)(...e)),onPointerDown:t[6]||(t[6]=(...e)=>u(A)&&u(A)(...e)),onPointerUp:t[7]||(t[7]=(...e)=>u(M)&&u(M)(...e)),onWheel:t[8]||(t[8]=(...e)=>u(S)&&u(S)(...e))},null,40,Er)):C("",!0)}}),Cr=["object"],Rr=e({__name:"GeoPoint",props:{point:{},color:{},size:{},icon:{},renderOrder:{default:1},raycastActive:{type:Boolean},raycastMultiplier:{default:1},sizeAttenuation:{type:Boolean,default:!0},id:{}},emits:["click","double-click","context-menu","pointer-enter","pointer-leave","pointer-over","pointer-down","pointer-up","wheel"],setup(e,{emit:t}){const i=e,n=t,h=s(),d=e=>{const t=e.raycast;e.raycast=function(e,n){const s=e.params.Points?.threshold||1;e.params.Points?e.params.Points.threshold=s*i.raycastMultiplier:e.params.Points={threshold:s*i.raycastMultiplier};const r=t.call(this,e,n);return e.params.Points.threshold=s,r}};a((()=>i.size),(e=>{h.value&&(h.value.material.size=e||32,h.value.material.needsUpdate=!0)}));const p=e=>t=>{!h.value||!i.raycastActive||void 0!==t.index&&n(e,t,i,0)},m=p("click"),f=p("double-click"),g=p("context-menu"),v=p("pointer-enter"),_=p("pointer-leave"),y=p("pointer-over"),x=p("pointer-down"),b=p("pointer-up"),w=p("wheel");return o((()=>{const e=new Me;e.setAttribute("position",new De([0,0,0],3));const t=new je({size:i.size||32,transparent:!0,sizeAttenuation:i.sizeAttenuation,color:i.color||"#ffffff"});if(i.icon){const e=new Oe;t.map=e.load(i.icon),t.needsUpdate=!0}h.value=new He(e,t),h.value.renderOrder=i.renderOrder,d(h.value)})),l((()=>{if(h.value){h.value.geometry.dispose();const e=h.value.material;e.map?.dispose(),e.dispose()}})),(e,t)=>(c(),P(u(jo),{point:i.point},{default:L((()=>[h.value?(c(),r("primitive",{key:0,object:h.value,onClick:t[0]||(t[0]=(...e)=>u(m)&&u(m)(...e)),onDoubleClick:t[1]||(t[1]=(...e)=>u(f)&&u(f)(...e)),onContextMenu:t[2]||(t[2]=(...e)=>u(g)&&u(g)(...e)),onPointerEnter:t[3]||(t[3]=(...e)=>u(v)&&u(v)(...e)),onPointerLeave:t[4]||(t[4]=(...e)=>u(_)&&u(_)(...e)),onPointerOver:t[5]||(t[5]=(...e)=>u(y)&&u(y)(...e)),onPointerDown:t[6]||(t[6]=(...e)=>u(x)&&u(x)(...e)),onPointerUp:t[7]||(t[7]=(...e)=>u(b)&&u(b)(...e)),onWheel:t[8]||(t[8]=(...e)=>u(w)&&u(w)(...e))},null,40,Cr)):C("",!0)])),_:1},8,["point"]))}}),Lr=e=>{if(0===e.length)return new ie;const t=new ie;return e.forEach((e=>t.add(e))),t.divideScalar(e.length),t},Dr=(e,t)=>e.map((e=>e.clone().sub(t))),Or=e=>e.map((e=>dr(e.lon,e.lat,e.height||0))),kr=(e,t,i=!0,n)=>{const s=n=>s=>{if(!i)return;const r=void 0!==s.index?s.index:0;e(n,s,t,r)};return{handleClick:s("click"),handleDoubleClick:s("double-click"),handleContextMenu:s("context-menu"),handlePointerEnter:s("pointer-enter"),handlePointerLeave:s("pointer-leave"),handlePointerOver:s("pointer-over"),handlePointerDown:s("pointer-down"),handlePointerUp:s("pointer-up"),handleWheel:s("wheel")}},Ir=(e,t=1)=>{if(!e||!e.raycast)return;const i=e.raycast;e.raycast=function(n,s){const r=n.params.Points?.threshold||1;n.params.Points?n.params.Points.threshold=r*t:"Points"===e.type&&(n.params.Points={threshold:r*t});const o=i.call(this,n,s);return n.params.Points&&(n.params.Points.threshold=r),o}},Fr=["object"],Ur=e({__name:"GeoTubeline",props:{points:{},color:{},width:{},tubularSegments:{},map:{},renderOrder:{default:1},opacity:{default:1},repeat:{default:()=>[1,1]},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","double-click","context-menu","pointer-enter","pointer-leave","pointer-over","pointer-down","pointer-up","wheel"],setup(e,{emit:i}){const h=e,d=i,p=s(),m=s(),f=n([]),g=n(new ie),v=kr(d,h,h.raycastActive),_=t("registerAnimationTarget"),y=t("unregisterAnimationTarget"),x=()=>.3*(h.width||2),b=()=>{if(m.value){m.value.geometry.dispose(),f.value=Or(h.points),g.value=Lr(f.value);const e=Dr(f.value,g.value),t=new Fe;for(let n=0;n<e.length-1;n++){const i=new Ue(e[n],e[n+1]);t.add(i)}const i=new Be(t,h.tubularSegments||64,x(),8,!1);m.value.geometry=i,p.value.position.copy(g.value)}};return a((()=>h.points),(()=>{b()}),{immediate:!0}),a((()=>h.color),(e=>{m.value&&(m.value.material.color.set(e||"#ffffff"),m.value.material.needsUpdate=!0)})),a((()=>h.opacity),(e=>{m.value&&(m.value.material.opacity=void 0!==e?e:1,m.value.material.needsUpdate=!0)})),a((()=>h.repeat),(e=>{m.value&&m.value.material.map&&e&&e.length>=2&&(m.value.material.map.repeat.set(e[0],e[1]),m.value.material.map.needsUpdate=!0)}),{deep:!0}),a((()=>[h.width,h.tubularSegments]),(()=>{b()})),a((()=>h.map),(e=>{m.value&&(e?(m.value.material.map=e,h.repeat&&h.repeat.length>=2&&(e.repeat.set(h.repeat[0],h.repeat[1]),e.needsUpdate=!0),m.value.material.needsUpdate=!0,_&&_(m.value,"texture",e)):(m.value.material.map=null,m.value.material.needsUpdate=!0,_&&_(m.value,"texture",void 0)))})),o((()=>{(()=>{p.value=new Ie,f.value=Or(h.points),g.value=Lr(f.value);const e=Dr(f.value,g.value),t=new Fe;for(let r=0;r<e.length-1;r++){const i=new Ue(e[r],e[r+1]);t.add(i)}const i=new Be(t,h.tubularSegments||64,x(),8,!1),n={color:h.color||"#ffffff",transparent:!0,side:re,opacity:void 0!==h.opacity?h.opacity:1};h.map&&(n.map=h.map,h.repeat&&h.repeat.length>=2&&(h.map.repeat.set(h.repeat[0],h.repeat[1]),h.map.needsUpdate=!0));const s=new se(n);m.value=new oe(i,s),m.value.renderOrder=h.renderOrder,h.raycastActive&&Ir(m.value,h.raycastMultiplier),p.value.add(m.value),p.value.position.copy(g.value),_&&_(m.value,"texture",h.map)})()})),l((()=>{m.value&&(y&&y(m.value),m.value.geometry.dispose(),m.value.material.dispose()),p.value&&p.value.clear()})),(e,t)=>p.value?(c(),r("primitive",{key:0,object:p.value,onClick:t[0]||(t[0]=(...e)=>u(v).handleClick&&u(v).handleClick(...e)),onDoubleClick:t[1]||(t[1]=(...e)=>u(v).handleDoubleClick&&u(v).handleDoubleClick(...e)),onContextMenu:t[2]||(t[2]=(...e)=>u(v).handleContextMenu&&u(v).handleContextMenu(...e)),onPointerEnter:t[3]||(t[3]=(...e)=>u(v).handlePointerEnter&&u(v).handlePointerEnter(...e)),onPointerLeave:t[4]||(t[4]=(...e)=>u(v).handlePointerLeave&&u(v).handlePointerLeave(...e)),onPointerOver:t[5]||(t[5]=(...e)=>u(v).handlePointerOver&&u(v).handlePointerOver(...e)),onPointerDown:t[6]||(t[6]=(...e)=>u(v).handlePointerDown&&u(v).handlePointerDown(...e)),onPointerUp:t[7]||(t[7]=(...e)=>u(v).handlePointerUp&&u(v).handlePointerUp(...e)),onWheel:t[8]||(t[8]=(...e)=>u(v).handleWheel&&u(v).handleWheel(...e))},null,40,Fr)):C("",!0)}});class Br extends Me{constructor(){super(),this.isMeshLine=!0,this.type="MeshLine",this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this._points=[],this._geom=null,this.widthCallback=null,this.matrixWorld=new Ne,Object.defineProperties(this,{geometry:{enumerable:!0,get:function(){return this}},geom:{enumerable:!0,get:function(){return this._geom},set:function(e){this.setGeometry(e,this.widthCallback)}},points:{enumerable:!0,get:function(){return this._points},set:function(e){this.setPoints(e,this.widthCallback)}}})}}function zr(e,t,i,n,s){var r;if(e=e.subarray||e.slice?e:e.buffer,i=i.subarray||i.slice?i:i.buffer,e=t?e.subarray?e.subarray(t,s&&t+s):e.slice(t,s&&t+s):e,i.set)i.set(e,n);else for(r=0;r<e.length;r++)i[r+n]=e[r];return i}Br.prototype.setMatrixWorld=function(e){this.matrixWorld=e},Br.prototype.setGeometry=function(e,t){this._geometry=e,this.setPoints(e.getAttribute("position").array,t)},Br.prototype.setPoints=function(e,t){if(e instanceof Float32Array||e instanceof Array){if(this._points=e,this.widthCallback=t,this.positions=[],this.counters=[],e.length&&e[0]instanceof ie)for(var i=0;i<e.length;i++){var n=e[i],s=i/e.length;this.positions.push(n.x,n.y,n.z),this.positions.push(n.x,n.y,n.z),this.counters.push(s),this.counters.push(s)}else for(i=0;i<e.length;i+=3){s=i/e.length;this.positions.push(e[i],e[i+1],e[i+2]),this.positions.push(e[i],e[i+1],e[i+2]),this.counters.push(s),this.counters.push(s)}this.process()}else console.error("ERROR: The BufferArray of points is not instancied correctly.")},Br.prototype.raycast=function(e,t){var i=new Ne,n=new Ge,s=new Ye,r=new ie,o=this.geometry;if(o.boundingSphere||o.computeBoundingSphere(),s.copy(o.boundingSphere),s.applyMatrix4(this.matrixWorld),!1!==e.ray.intersectSphere(s,r)){i.copy(this.matrixWorld).invert(),n.copy(e.ray).applyMatrix4(i);var a=new ie,l=new ie,c=new ie,h=this instanceof lt?2:1,u=o.index,d=o.attributes;if(null!==u)for(var p=u.array,m=d.position.array,f=d.width.array,g=0,v=p.length-1;g<v;g+=h){var _=p[g],y=p[g+1];a.fromArray(m,3*_),l.fromArray(m,3*y);var x=void 0!==f[Math.floor(g/3)]?f[Math.floor(g/3)]:1,b=e.params.Line.threshold+this.material.lineWidth*x/2,w=b*b;if(!(n.distanceSqToSegment(a,l,r,c)>w)){r.applyMatrix4(this.matrixWorld);var T=e.ray.origin.distanceTo(r);T<e.near||T>e.far||(t.push({distance:T,point:c.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}),g=v)}}}},Br.prototype.compareV3=function(e,t){var i=6*e,n=6*t;return this.positions[i]===this.positions[n]&&this.positions[i+1]===this.positions[n+1]&&this.positions[i+2]===this.positions[n+2]},Br.prototype.copyV3=function(e){var t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]},Br.prototype.process=function(){var e,t,i=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],t=this.compareV3(0,i-1)?this.copyV3(i-2):this.copyV3(0),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);for(var n=0;n<i;n++){if(this.side.push(1),this.side.push(-1),e=this.widthCallback?this.widthCallback(n/(i-1)):1,this.width.push(e),this.width.push(e),this.uvs.push(n/(i-1),0),this.uvs.push(n/(i-1),1),n<i-1){t=this.copyV3(n),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);var s=2*n;this.indices_array.push(s,s+1,s+2),this.indices_array.push(s+2,s+1,s+3)}n>0&&(t=this.copyV3(n),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]))}t=this.compareV3(i-1,0)?this.copyV3(1):this.copyV3(i-1),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]),this._attributes&&this._attributes.position.count===this.positions.length?(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0):this._attributes={position:new $(new Float32Array(this.positions),3),previous:new $(new Float32Array(this.previous),3),next:new $(new Float32Array(this.next),3),side:new $(new Float32Array(this.side),1),width:new $(new Float32Array(this.width),1),uv:new $(new Float32Array(this.uvs),2),index:new $(new Uint16Array(this.indices_array),1),counters:new $(new Float32Array(this.counters),1)},this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox(),this._geometry.attributes=this.attributes,this._geometry.index=this.index,this._geometry.computeBoundingSphere(),this._geometry.computeBoundingBox()},Br.prototype.advance=function(e){var t=this._attributes.position.array,i=this._attributes.previous.array,n=this._attributes.next.array,s=t.length;zr(t,0,i,0,s),zr(t,6,t,0,s-6),t[s-6]=e.x,t[s-5]=e.y,t[s-4]=e.z,t[s-3]=e.x,t[s-2]=e.y,t[s-1]=e.z,zr(t,6,n,0,s-6),n[s-6]=e.x,n[s-5]=e.y,n[s-4]=e.z,n[s-3]=e.x,n[s-2]=e.y,n[s-1]=e.z,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0},Ke.meshline_vert=["",Ke.logdepthbuf_pars_vertex,Ke.fog_pars_vertex,"","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute float counters;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float near;","uniform float far;","uniform float sizeAttenuation;","uniform vec2 offset;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","\t vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","    float pixelWidthRatio = 1. / (resolution.x * projectionMatrix[0][0]);","","    vColor = vec4( color, opacity );","    vUV = uv + offset;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float pixelWidth = finalPosition.w * pixelWidthRatio;","    float w = 1.8 * pixelWidth * lineWidth * width;","","    if( sizeAttenuation == 1. ) {","        w = 1.8 * lineWidth * width;","    }","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec2 normal = vec2( -dir.y, dir.x );","    normal.x /= aspect;","    normal *= .5 * w;","","    vec4 offset = vec4( normal * side, 0.0, 1.0 );","    finalPosition.xy += offset.xy;","","    gl_Position = finalPosition;","",Ke.logdepthbuf_vertex,Ke.fog_vertex&&"    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",Ke.fog_vertex,"}"].join("\r\n"),Ke.meshline_frag=["",Ke.fog_pars_fragment,Ke.logdepthbuf_pars_fragment,"","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform float dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","void main() {","",Ke.logdepthbuf_fragment,"","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","    if( c.a < alphaTest ) discard;","    if( useDash == 1. ){","        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));","    }","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","",Ke.fog_fragment,"}"].join("\r\n");class Nr extends ge{constructor(e){super({uniforms:Object.assign({},Xe.fog,{lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new q(16777215)},opacity:{value:1},resolution:{value:new te(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new te(1,1)},offset:{value:new te(1,1)}}),depthWrite:void 0===e.depthWrite||e.depthWrite,depthTest:void 0===e.depthTest||e.depthTest,transparent:void 0===e.transparent||e.transparent,vertexShader:Ke.meshline_vert,fragmentShader:Ke.meshline_frag}),this.isMeshLineMaterial=!0,this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(e){this.uniforms.lineWidth.value=e}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(e){this.uniforms.map.value=e}},useMap:{enumerable:!0,get:function(){return this.uniforms.useMap.value},set:function(e){this.uniforms.useMap.value=e}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(e){this.uniforms.alphaMap.value=e}},useAlphaMap:{enumerable:!0,get:function(){return this.uniforms.useAlphaMap.value},set:function(e){this.uniforms.useAlphaMap.value=e}},color:{enumerable:!0,get:function(){return this.uniforms.color.value},set:function(e){this.uniforms.color.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(e){this.uniforms.sizeAttenuation.value=e}},dashArray:{enumerable:!0,get:function(){return this.uniforms.dashArray.value},set:function(e){this.uniforms.dashArray.value=e,this.useDash=0!==e?1:0}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},dashRatio:{enumerable:!0,get:function(){return this.uniforms.dashRatio.value},set:function(e){this.uniforms.dashRatio.value=e}},useDash:{enumerable:!0,get:function(){return this.uniforms.useDash.value},set:function(e){this.uniforms.useDash.value=e}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(e){this.uniforms.visibility.value=e}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(e){this.uniforms.alphaTest.value=e}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(e){this.uniforms.repeat.value.copy(e)}},offset:{enumerable:!0,get:function(){return this.uniforms.offset.value},set:function(e){this.uniforms.offset.value.copy(e)}}}),this.setValues(e)}}Nr.prototype.copy=function(e){return ge.prototype.copy.call(this,e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.dashArray.copy(e.dashArray),this.dashOffset.copy(e.dashOffset),this.dashRatio.copy(e.dashRatio),this.useDash=e.useDash,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this};const jr=["object"],Hr=e({__name:"GeoMeshline",props:{points:{},color:{},width:{},sizeAttenuation:{type:Boolean,default:!0},dashArray:{},dashRatio:{},dashOffset:{},map:{},renderOrder:{default:1},opacity:{default:1},repeat:{default:()=>[1,1]},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","double-click","context-menu","pointer-enter","pointer-leave","pointer-over","pointer-down","pointer-up","wheel"],setup(e,{emit:i}){const h=e,d=i,p=s(),m=s(),f=s(),g=n([]),v=n(new ie),_=kr(d,h,h.raycastActive),y=t("registerAnimationTarget"),x=t("unregisterAnimationTarget"),b=e=>{const t=new Me,i=new Float32Array(3*e.length);return e.forEach(((e,t)=>{i[3*t]=e.x,i[3*t+1]=e.y,i[3*t+2]=e.z})),t.setAttribute("position",new $(i,3)),t};a((()=>h.repeat),(e=>{if(f.value&&f.value.material){const t=f.value.material;t.uniforms.repeat.value.set(e[0],e[1]),t.needsUpdate=!0}}),{immediate:!0}),a((()=>h.opacity),(e=>{if(f.value&&f.value.material){const t=f.value.material;t.opacity=void 0!==e?e:1,t.needsUpdate=!0}}),{immediate:!0});return a((()=>h.points),(()=>{h.points.length>=2&&(()=>{if(!m.value||!f.value||h.points.length<2)return;g.value=Or(h.points),v.value=Lr(g.value);const e=Dr(g.value,v.value),t=b(e);m.value.setGeometry(t),p.value.position.copy(v.value)})()}),{deep:!0}),a((()=>[h.color,h.width]),(()=>{if(f.value){const e=f.value.material;e.uniforms&&(e.uniforms.color&&e.uniforms.color.value.set(h.color||"#ffffff"),e.uniforms.lineWidth&&(e.uniforms.lineWidth.value=h.width||1),e.uniforms.useDash&&(e.uniforms.useDash.value=0),e.uniforms.dashArray&&(e.uniforms.dashArray.value=0))}})),a((()=>h.map),(e=>{if(f.value){const t=f.value.material;e?(t.uniforms&&(t.uniforms.map.value=e,t.uniforms.useMap.value=1),y&&y(f.value,"meshline",e)):(t.uniforms&&(t.uniforms.map.value=null,t.uniforms.useMap.value=0),y&&y(f.value,"meshline",void 0))}})),o((()=>{(()=>{if(h.points.length<2)return;p.value=new Ie,g.value=Or(h.points),v.value=Lr(g.value);const e=Dr(g.value,v.value),t=b(e);m.value=new Br,m.value.setGeometry(t);const i={color:h.color||"#ffffff",lineWidth:h.width||1,dashArray:0,dashRatio:0,dashOffset:0,useDash:0,sizeAttenuation:h.sizeAttenuation?1:0,transparent:!0,depthTest:!1,depthWrite:!1,repeat:new te(...h.repeat)};h.map&&(i.map=h.map,i.useMap=1);const n=new Nr(i);f.value=new oe(m.value.geometry,n),f.value.renderOrder=h.renderOrder,h.raycastActive&&Ir(f.value,h.raycastMultiplier),p.value.add(f.value),p.value.position.copy(v.value),y&&y(f.value,"meshline",h.map)})()})),l((()=>{if(f.value&&(x&&x(f.value),f.value.geometry&&f.value.geometry.dispose(),f.value.material)){const e=f.value.material;e.dispose&&e.dispose()}p.value&&p.value.clear()})),(e,t)=>p.value?(c(),r("primitive",{key:0,object:p.value,onClick:t[0]||(t[0]=(...e)=>u(_).handleClick&&u(_).handleClick(...e)),onDoubleClick:t[1]||(t[1]=(...e)=>u(_).handleDoubleClick&&u(_).handleDoubleClick(...e)),onContextMenu:t[2]||(t[2]=(...e)=>u(_).handleContextMenu&&u(_).handleContextMenu(...e)),onPointerEnter:t[3]||(t[3]=(...e)=>u(_).handlePointerEnter&&u(_).handlePointerEnter(...e)),onPointerLeave:t[4]||(t[4]=(...e)=>u(_).handlePointerLeave&&u(_).handlePointerLeave(...e)),onPointerOver:t[5]||(t[5]=(...e)=>u(_).handlePointerOver&&u(_).handlePointerOver(...e)),onPointerDown:t[6]||(t[6]=(...e)=>u(_).handlePointerDown&&u(_).handlePointerDown(...e)),onPointerUp:t[7]||(t[7]=(...e)=>u(_).handlePointerUp&&u(_).handlePointerUp(...e)),onWheel:t[8]||(t[8]=(...e)=>u(_).handleWheel&&u(_).handleWheel(...e))},[T(e.$slots,"default")],40,jr)):C("",!0)}}),Gr=e({__name:"GeoLineAnimation",props:{texture:{},autoStart:{type:Boolean,default:!0},duration:{default:1e3},reverse:{type:Boolean,default:!1},speed:{default:1}},setup(e,{expose:t}){const i=e,s=n({startTime:0,isAnimating:!1}),r=n([]),{onLoop:c}=xn();y("registerAnimationTarget",((e,t,i)=>{const n=r.value.findIndex((t=>t.target===e));n>=0?r.value[n]={target:e,type:t,texture:i}:r.value.push({target:e,type:t,texture:i})})),y("unregisterAnimationTarget",(e=>{const t=r.value.findIndex((t=>t.target===e));t>=0&&r.value.splice(t,1)})),c((({elapsed:e})=>{!i.autoStart||!i.duration||!s.value.isAnimating||0!==r.value.length&&r.value.forEach((({target:t,type:n,texture:r})=>{if(t)if("meshline"===n)((e,t,i,n,s=!1,r=1)=>{0===n.startTime&&(n.startTime=t);let o=(t-n.startTime)*Math.max(0,r)%i/i;s&&(o=1-o),e.uniforms&&e.uniforms.offset&&(e.uniforms.offset.value.x=-o)})(t.material,1e3*e,i.duration,s.value,i.reverse,i.speed);else if("texture"===n){const t=r||i.texture;t&&((e,t,i,n,s=!1,r=1)=>{0===n.startTime&&(n.startTime=t);let o=(t-n.startTime)*Math.max(0,r)%i/i;s&&(o=1-o),e.offset.x=-o,e.needsUpdate=!0})(t,1e3*e,i.duration,s.value,i.reverse,i.speed)}}))}));const h=()=>{i.duration&&(e=>{e.startTime=0,e.isAnimating=!0})(s.value)},u=()=>{(e=>{e.isAnimating=!1})(s.value)};return a((()=>i.duration),(e=>{e&&i.autoStart&&r.value.length>0?h():u()})),a((()=>i.texture),(e=>{e&&i.duration&&i.autoStart&&r.value.length>0?h():u()})),a((()=>i.reverse),(()=>{i.autoStart&&i.duration&&r.value.length>0&&(u(),setTimeout((()=>{h()}),10))})),o((()=>{i.autoStart&&i.duration&&setTimeout((()=>{r.value.length>0&&h()}),100)})),l((()=>{u()})),t({start:h,stop:u,isAnimating:()=>s.value.isAnimating,getAnimationTargets:()=>r.value,getTargetCount:()=>r.value.length}),(e,t)=>T(e.$slots,"default")}}),Vr=e({__name:"GeoFlyline",props:{start:{},end:{},type:{default:"mesh"},color:{default:"#ffffff"},width:{default:1},map:{},autoStart:{type:Boolean,default:!0},arcHeight:{default:0},segments:{default:20},tubularSegments:{},renderOrder:{default:1},duration:{default:2e3},reverse:{type:Boolean,default:!1},opacity:{default:1},repeat:{default:()=>[1,1]},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","double-click","context-menu","pointer-enter","pointer-leave","pointer-over","pointer-down","pointer-up","wheel"],setup(e,{expose:i,emit:s}){const l=e,h=s,u=n([]),d=n(),p=t("registerAnimationTarget",null),m=g((()=>null!==p)),f=()=>{const{start:e,end:t,arcHeight:i,segments:n}=l,s=[],r=((e,t)=>{const i=t.lon-e.lon,n=t.lat-e.lat;return Math.sqrt(i*i+n*n)})(e,t),o=i||.2*r,a=e.height||0,c=t.height||0;for(let l=0;l<=n;l++){const i=l/n,r=e.lon+(t.lon-e.lon)*i,h=e.lat+(t.lat-e.lat)*i,u=a+(c-a)*i,d=4*o*i*(1-i);s.push({lon:r,lat:h,height:u+d})}u.value=s};return a((()=>[l.start,l.end,l.arcHeight,l.segments]),(()=>{f()}),{deep:!0,immediate:!0}),o((()=>{f()})),i({startAnimation:()=>{if(!m.value)return d.value?.start();console.warn("GeoFlyline is wrapped by GeoLineAnimation, please control animation through parent component")},stopAnimation:()=>{if(!m.value)return d.value?.stop();console.warn("GeoFlyline is wrapped by GeoLineAnimation, please control animation through parent component")},isAnimating:()=>!m.value&&(d.value?.isAnimating()||!1)}),(e,t)=>m.value?(c(),r(x,{key:1},["tube"===l.type?(c(),P(Ur,{key:0,points:u.value,color:l.color,width:l.width,map:l.map,tubularSegments:l.tubularSegments,renderOrder:l.renderOrder,opacity:l.opacity,repeat:l.repeat,id:l.id,raycastActive:l.raycastActive,raycastMultiplier:l.raycastMultiplier,onClick:t[18]||(t[18]=(...e)=>h("click",...e)),onDoubleClick:t[19]||(t[19]=(...e)=>h("double-click",...e)),onContextMenu:t[20]||(t[20]=(...e)=>h("context-menu",...e)),onPointerEnter:t[21]||(t[21]=(...e)=>h("pointer-enter",...e)),onPointerLeave:t[22]||(t[22]=(...e)=>h("pointer-leave",...e)),onPointerOver:t[23]||(t[23]=(...e)=>h("pointer-over",...e)),onPointerDown:t[24]||(t[24]=(...e)=>h("pointer-down",...e)),onPointerUp:t[25]||(t[25]=(...e)=>h("pointer-up",...e)),onWheel:t[26]||(t[26]=(...e)=>h("wheel",...e))},null,8,["points","color","width","map","tubularSegments","renderOrder","opacity","repeat","id","raycastActive","raycastMultiplier"])):(c(),P(Hr,{key:1,points:u.value,color:l.color,width:l.width,map:l.map,renderOrder:l.renderOrder,opacity:l.opacity,repeat:l.repeat,id:l.id,raycastActive:l.raycastActive,raycastMultiplier:l.raycastMultiplier,onClick:t[27]||(t[27]=(...e)=>h("click",...e)),onDoubleClick:t[28]||(t[28]=(...e)=>h("double-click",...e)),onContextMenu:t[29]||(t[29]=(...e)=>h("context-menu",...e)),onPointerEnter:t[30]||(t[30]=(...e)=>h("pointer-enter",...e)),onPointerLeave:t[31]||(t[31]=(...e)=>h("pointer-leave",...e)),onPointerOver:t[32]||(t[32]=(...e)=>h("pointer-over",...e)),onPointerDown:t[33]||(t[33]=(...e)=>h("pointer-down",...e)),onPointerUp:t[34]||(t[34]=(...e)=>h("pointer-up",...e)),onWheel:t[35]||(t[35]=(...e)=>h("wheel",...e))},null,8,["points","color","width","map","renderOrder","opacity","repeat","id","raycastActive","raycastMultiplier"]))],64)):(c(),P(Gr,{key:0,ref_key:"animationRef",ref:d,texture:l.map,autoStart:l.autoStart,duration:l.duration,reverse:l.reverse},{default:L((()=>["tube"===l.type?(c(),P(Ur,{key:0,points:u.value,color:l.color,width:l.width,map:l.map,tubularSegments:l.tubularSegments,renderOrder:l.renderOrder,opacity:l.opacity,repeat:l.repeat,id:l.id,raycastActive:l.raycastActive,raycastMultiplier:l.raycastMultiplier,onClick:t[0]||(t[0]=(...e)=>h("click",...e)),onDoubleClick:t[1]||(t[1]=(...e)=>h("double-click",...e)),onContextMenu:t[2]||(t[2]=(...e)=>h("context-menu",...e)),onPointerEnter:t[3]||(t[3]=(...e)=>h("pointer-enter",...e)),onPointerLeave:t[4]||(t[4]=(...e)=>h("pointer-leave",...e)),onPointerOver:t[5]||(t[5]=(...e)=>h("pointer-over",...e)),onPointerDown:t[6]||(t[6]=(...e)=>h("pointer-down",...e)),onPointerUp:t[7]||(t[7]=(...e)=>h("pointer-up",...e)),onWheel:t[8]||(t[8]=(...e)=>h("wheel",...e))},null,8,["points","color","width","map","tubularSegments","renderOrder","opacity","repeat","id","raycastActive","raycastMultiplier"])):(c(),P(Hr,{key:1,points:u.value,color:l.color,width:l.width,map:l.map,renderOrder:l.renderOrder,opacity:l.opacity,repeat:l.repeat,id:l.id,raycastActive:l.raycastActive,raycastMultiplier:l.raycastMultiplier,onClick:t[9]||(t[9]=(...e)=>h("click",...e)),onDoubleClick:t[10]||(t[10]=(...e)=>h("double-click",...e)),onContextMenu:t[11]||(t[11]=(...e)=>h("context-menu",...e)),onPointerEnter:t[12]||(t[12]=(...e)=>h("pointer-enter",...e)),onPointerLeave:t[13]||(t[13]=(...e)=>h("pointer-leave",...e)),onPointerOver:t[14]||(t[14]=(...e)=>h("pointer-over",...e)),onPointerDown:t[15]||(t[15]=(...e)=>h("pointer-down",...e)),onPointerUp:t[16]||(t[16]=(...e)=>h("pointer-up",...e)),onWheel:t[17]||(t[17]=(...e)=>h("wheel",...e))},null,8,["points","color","width","map","renderOrder","opacity","repeat","id","raycastActive","raycastMultiplier"]))])),_:1},8,["texture","autoStart","duration","reverse"]))}}),Wr=11102230246251565e-32,Kr=134217729,Xr=(3+8*Wr)*Wr;function qr(e,t,i,n,s){let r,o,a,l,c=t[0],h=n[0],u=0,d=0;h>c==h>-c?(r=c,c=t[++u]):(r=h,h=n[++d]);let p=0;if(u<e&&d<i)for(h>c==h>-c?(o=c+r,a=r-(o-c),c=t[++u]):(o=h+r,a=r-(o-h),h=n[++d]),r=o,0!==a&&(s[p++]=a);u<e&&d<i;)h>c==h>-c?(o=r+c,l=o-r,a=r-(o-l)+(c-l),c=t[++u]):(o=r+h,l=o-r,a=r-(o-l)+(h-l),h=n[++d]),r=o,0!==a&&(s[p++]=a);for(;u<e;)o=r+c,l=o-r,a=r-(o-l)+(c-l),c=t[++u],r=o,0!==a&&(s[p++]=a);for(;d<i;)o=r+h,l=o-r,a=r-(o-l)+(h-l),h=n[++d],r=o,0!==a&&(s[p++]=a);return(0!==r||0===p)&&(s[p++]=r),p}function Yr(e){return new Float64Array(e)}const Zr=(3+16*Wr)*Wr,$r=(2+12*Wr)*Wr,Qr=(9+64*Wr)*Wr*Wr,Jr=Yr(4),eo=Yr(8),to=Yr(12),io=Yr(16),no=Yr(4);function so(e,t,i,n,s,r){const o=(t-r)*(i-s),a=(e-s)*(n-r),l=o-a,c=Math.abs(o+a);return Math.abs(l)>=Zr*c?l:-function(e,t,i,n,s,r,o){let a,l,c,h,u,d,p,m,f,g,v,_,y,x,b,w,T,A;const M=e-s,S=i-s,E=t-r,P=n-r;x=M*P,d=Kr*M,p=d-(d-M),m=M-p,d=Kr*P,f=d-(d-P),g=P-f,b=m*g-(x-p*f-m*f-p*g),w=E*S,d=Kr*E,p=d-(d-E),m=E-p,d=Kr*S,f=d-(d-S),g=S-f,T=m*g-(w-p*f-m*f-p*g),v=b-T,u=b-v,Jr[0]=b-(v+u)+(u-T),_=x+v,u=_-x,y=x-(_-u)+(v-u),v=y-w,u=y-v,Jr[1]=y-(v+u)+(u-w),A=_+v,u=A-_,Jr[2]=_-(A-u)+(v-u),Jr[3]=A;let C=function(e,t){let i=t[0];for(let n=1;n<e;n++)i+=t[n];return i}(4,Jr),R=$r*o;if(C>=R||-C>=R||(u=e-M,a=e-(M+u)+(u-s),u=i-S,c=i-(S+u)+(u-s),u=t-E,l=t-(E+u)+(u-r),u=n-P,h=n-(P+u)+(u-r),0===a&&0===l&&0===c&&0===h)||(R=Qr*o+Xr*Math.abs(C),C+=M*h+P*a-(E*c+S*l),C>=R||-C>=R))return C;x=a*P,d=Kr*a,p=d-(d-a),m=a-p,d=Kr*P,f=d-(d-P),g=P-f,b=m*g-(x-p*f-m*f-p*g),w=l*S,d=Kr*l,p=d-(d-l),m=l-p,d=Kr*S,f=d-(d-S),g=S-f,T=m*g-(w-p*f-m*f-p*g),v=b-T,u=b-v,no[0]=b-(v+u)+(u-T),_=x+v,u=_-x,y=x-(_-u)+(v-u),v=y-w,u=y-v,no[1]=y-(v+u)+(u-w),A=_+v,u=A-_,no[2]=_-(A-u)+(v-u),no[3]=A;const L=qr(4,Jr,4,no,eo);x=M*h,d=Kr*M,p=d-(d-M),m=M-p,d=Kr*h,f=d-(d-h),g=h-f,b=m*g-(x-p*f-m*f-p*g),w=E*c,d=Kr*E,p=d-(d-E),m=E-p,d=Kr*c,f=d-(d-c),g=c-f,T=m*g-(w-p*f-m*f-p*g),v=b-T,u=b-v,no[0]=b-(v+u)+(u-T),_=x+v,u=_-x,y=x-(_-u)+(v-u),v=y-w,u=y-v,no[1]=y-(v+u)+(u-w),A=_+v,u=A-_,no[2]=_-(A-u)+(v-u),no[3]=A;const D=qr(L,eo,4,no,to);x=a*h,d=Kr*a,p=d-(d-a),m=a-p,d=Kr*h,f=d-(d-h),g=h-f,b=m*g-(x-p*f-m*f-p*g),w=l*c,d=Kr*l,p=d-(d-l),m=l-p,d=Kr*c,f=d-(d-c),g=c-f,T=m*g-(w-p*f-m*f-p*g),v=b-T,u=b-v,no[0]=b-(v+u)+(u-T),_=x+v,u=_-x,y=x-(_-u)+(v-u),v=y-w,u=y-v,no[1]=y-(v+u)+(u-w),A=_+v,u=A-_,no[2]=_-(A-u)+(v-u),no[3]=A;const O=qr(D,to,4,no,io);return io[O-1]}(e,t,i,n,s,r,c)}const ro=Math.pow(2,-52),oo=new Uint32Array(512);class ao{static from(e,t=mo,i=fo){const n=e.length,s=new Float64Array(2*n);for(let r=0;r<n;r++){const n=e[r];s[2*r]=t(n),s[2*r+1]=i(n)}return new ao(s)}constructor(e){const t=e.length>>1;if(t>0&&"number"!=typeof e[0])throw new Error("Expected coords to contain numbers.");this.coords=e;const i=Math.max(2*t-5,0);this._triangles=new Uint32Array(3*i),this._halfedges=new Int32Array(3*i),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:i,_hullTri:n,_hullHash:s}=this,r=e.length>>1;let o=1/0,a=1/0,l=-1/0,c=-1/0;for(let A=0;A<r;A++){const t=e[2*A],i=e[2*A+1];t<o&&(o=t),i<a&&(a=i),t>l&&(l=t),i>c&&(c=i),this._ids[A]=A}const h=(o+l)/2,u=(a+c)/2;let d,p,m;for(let A=0,M=1/0;A<r;A++){const t=lo(h,u,e[2*A],e[2*A+1]);t<M&&(d=A,M=t)}const f=e[2*d],g=e[2*d+1];for(let A=0,M=1/0;A<r;A++){if(A===d)continue;const t=lo(f,g,e[2*A],e[2*A+1]);t<M&&t>0&&(p=A,M=t)}let v=e[2*p],_=e[2*p+1],y=1/0;for(let A=0;A<r;A++){if(A===d||A===p)continue;const t=ho(f,g,v,_,e[2*A],e[2*A+1]);t<y&&(m=A,y=t)}let x=e[2*m],b=e[2*m+1];if(y===1/0){for(let n=0;n<r;n++)this._dists[n]=e[2*n]-e[0]||e[2*n+1]-e[1];uo(this._ids,this._dists,0,r-1);const t=new Uint32Array(r);let i=0;for(let e=0,n=-1/0;e<r;e++){const s=this._ids[e],r=this._dists[s];r>n&&(t[i++]=s,n=r)}return this.hull=t.subarray(0,i),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(so(f,g,v,_,x,b)<0){const e=p,t=v,i=_;p=m,v=x,_=b,m=e,x=t,b=i}const w=function(e,t,i,n,s,r){const o=i-e,a=n-t,l=s-e,c=r-t,h=o*o+a*a,u=l*l+c*c,d=.5/(o*c-a*l),p=e+(c*h-a*u)*d,m=t+(o*u-l*h)*d;return{x:p,y:m}}(f,g,v,_,x,b);this._cx=w.x,this._cy=w.y;for(let A=0;A<r;A++)this._dists[A]=lo(e[2*A],e[2*A+1],w.x,w.y);uo(this._ids,this._dists,0,r-1),this._hullStart=d;let T=3;i[d]=t[m]=p,i[p]=t[d]=m,i[m]=t[p]=d,n[d]=0,n[p]=1,n[m]=2,s.fill(-1),s[this._hashKey(f,g)]=d,s[this._hashKey(v,_)]=p,s[this._hashKey(x,b)]=m,this.trianglesLen=0,this._addTriangle(d,p,m,-1,-1,-1);for(let A,M,S=0;S<this._ids.length;S++){const r=this._ids[S],o=e[2*r],a=e[2*r+1];if(S>0&&Math.abs(o-A)<=ro&&Math.abs(a-M)<=ro||(A=o,M=a,r===d||r===p||r===m))continue;let l=0;for(let e=0,t=this._hashKey(o,a);e<this._hashSize&&(l=s[(t+e)%this._hashSize],-1===l||l===i[l]);e++);l=t[l];let c,h=l;for(;c=i[h],so(o,a,e[2*h],e[2*h+1],e[2*c],e[2*c+1])>=0;)if(h=c,h===l){h=-1;break}if(-1===h)continue;let u=this._addTriangle(h,r,i[h],-1,-1,n[h]);n[r]=this._legalize(u+2),n[h]=u,T++;let f=i[h];for(;c=i[f],so(o,a,e[2*f],e[2*f+1],e[2*c],e[2*c+1])<0;)u=this._addTriangle(f,r,c,n[r],-1,n[f]),n[r]=this._legalize(u+2),i[f]=f,T--,f=c;if(h===l)for(;c=t[h],so(o,a,e[2*c],e[2*c+1],e[2*h],e[2*h+1])<0;)u=this._addTriangle(c,r,h,-1,n[h],n[c]),this._legalize(u+2),n[c]=u,i[h]=h,T--,h=c;this._hullStart=t[r]=h,i[h]=t[f]=r,i[r]=f,s[this._hashKey(o,a)]=r,s[this._hashKey(e[2*h],e[2*h+1])]=h}this.hull=new Uint32Array(T);for(let A=0,M=this._hullStart;A<T;A++)this.hull[A]=M,M=i[M];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(function(e,t){const i=e/(Math.abs(e)+Math.abs(t));return(t>0?3-i:1+i)/4}(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:i,coords:n}=this;let s=0,r=0;for(;;){const o=i[e],a=e-e%3;if(r=a+(e+2)%3,-1===o){if(0===s)break;e=oo[--s];continue}const l=o-o%3,c=a+(e+1)%3,h=l+(o+2)%3,u=t[r],d=t[e],p=t[c],m=t[h];if(co(n[2*u],n[2*u+1],n[2*d],n[2*d+1],n[2*p],n[2*p+1],n[2*m],n[2*m+1])){t[e]=m,t[o]=u;const n=i[h];if(-1===n){let t=this._hullStart;do{if(this._hullTri[t]===h){this._hullTri[t]=e;break}t=this._hullPrev[t]}while(t!==this._hullStart)}this._link(e,n),this._link(o,i[r]),this._link(r,h);const a=l+(o+1)%3;s<oo.length&&(oo[s++]=a)}else{if(0===s)break;e=oo[--s]}}return r}_link(e,t){this._halfedges[e]=t,-1!==t&&(this._halfedges[t]=e)}_addTriangle(e,t,i,n,s,r){const o=this.trianglesLen;return this._triangles[o]=e,this._triangles[o+1]=t,this._triangles[o+2]=i,this._link(o,n),this._link(o+1,s),this._link(o+2,r),this.trianglesLen+=3,o}}function lo(e,t,i,n){const s=e-i,r=t-n;return s*s+r*r}function co(e,t,i,n,s,r,o,a){const l=e-o,c=t-a,h=i-o,u=n-a,d=s-o,p=r-a,m=h*h+u*u,f=d*d+p*p;return l*(u*f-m*p)-c*(h*f-m*d)+(l*l+c*c)*(h*p-u*d)<0}function ho(e,t,i,n,s,r){const o=i-e,a=n-t,l=s-e,c=r-t,h=o*o+a*a,u=l*l+c*c,d=.5/(o*c-a*l),p=(c*h-a*u)*d,m=(o*u-l*h)*d;return p*p+m*m}function uo(e,t,i,n){if(n-i<=20)for(let s=i+1;s<=n;s++){const n=e[s],r=t[n];let o=s-1;for(;o>=i&&t[e[o]]>r;)e[o+1]=e[o--];e[o+1]=n}else{let s=i+1,r=n;po(e,i+n>>1,s),t[e[i]]>t[e[n]]&&po(e,i,n),t[e[s]]>t[e[n]]&&po(e,s,n),t[e[i]]>t[e[s]]&&po(e,i,s);const o=e[s],a=t[o];for(;;){do{s++}while(t[e[s]]<a);do{r--}while(t[e[r]]>a);if(r<s)break;po(e,s,r)}e[i+1]=e[r],e[r]=o,n-s+1>=r-i?(uo(e,t,s,n),uo(e,t,i,r-1)):(uo(e,t,i,r-1),uo(e,t,s,n))}}function po(e,t,i){const n=e[t];e[t]=e[i],e[i]=n}function mo(e){return e[0]}function fo(e){return e[1]}const go=(e,t)=>{let i=!1;const n=e[0],s=e[1];let r=t.length-1;for(let o=0;o<t.length;o++){const e=t[o][0],a=t[o][1],l=t[r][0],c=t[r][1];a>s!=c>s&&n<(l-e)*(s-a)/(c-a)+e&&(i=!i),r=o}return i},vo=(e,t)=>{for(const i of t)if(go(e,i))return!0;return!1},_o=e=>{let t=0;for(let i=0,n=e.length;i<n;i++){const s=(i+1)%n;t+=e[i][0]*e[s][1],t-=e[s][0]*e[i][1]}return t<0},yo=e=>{let t=e[0];for(let i=1;i<=e.length;i++){const n=i%e.length,s=e[n],r=s[0]-t[0],o=s[1]-t[1],a=r*r+o*o,l=Math.max(Math.abs(s[0]),Math.abs(s[1]),Math.abs(t[0]),Math.abs(t[1]));a<=1.0000000000000001e-20*l*l?(e.splice(n,1),i--):t=s}},xo=(e,t)=>{if(t<=1)return[...e];const i=[];let n=0;for(let r=0;r<e.length;r++){const t=e[r],i=e[(r+1)%e.length],s=i[0]-t[0],o=i[1]-t[1];n+=Math.sqrt(s*s+o*o)}const s=n/(50*t);for(let r=0;r<e.length;r++){const t=e[r],n=e[(r+1)%e.length];i.push(t);const o=n[0]-t[0],a=n[1]-t[1],l=Math.sqrt(o*o+a*a),c=Math.max(1,Math.ceil(l/s));for(let e=1;e<c;e++){const n=e/c,s=[t[0]+n*o,t[1]+n*a];i.push(s)}}return i},bo=(e,t,i=1e-10)=>{const[n,s]=e;for(let r=0;r<t.length;r++){const e=(r+1)%t.length,[o,a]=t[r],[l,c]=t[e],h=(s-a)*(l-o)-(n-o)*(c-a);if(Math.abs(h)<i){const e=(n-o)*(l-o)+(s-a)*(c-a);if(e>=0&&e<=(l-o)*(l-o)+(c-a)*(c-a))return!0}}return!1},wo=(e,t,i,n)=>{const s=e[0],r=e[1],o=t[0],a=t[1],l=i[0],c=i[1],h=n[0],u=n[1],d=(s-o)*(c-u)-(r-a)*(l-h);if(Math.abs(d)<1e-10)return!1;const p=((s-l)*(c-u)-(r-c)*(l-h))/d,m=-((s-o)*(r-c)-(r-a)*(s-l))/d;return p>=0&&p<=1&&m>=0&&m<=1},To=(e,t,i)=>{for(let n=0;n<i.length;n++){const s=(n+1)%i.length,r=i[n],o=i[s],a=Math.abs(e[0]-r[0])<1e-10&&Math.abs(e[1]-r[1])<1e-10,l=Math.abs(e[0]-o[0])<1e-10&&Math.abs(e[1]-o[1])<1e-10,c=Math.abs(t[0]-r[0])<1e-10&&Math.abs(t[1]-r[1])<1e-10,h=Math.abs(t[0]-o[0])<1e-10&&Math.abs(t[1]-o[1])<1e-10;if(!(a||l||c||h)&&wo(e,t,r,o))return!0}return!1},Ao=(e,t,i,n,s)=>{const r=[(e[0]+t[0]+i[0])/3,(e[1]+t[1]+i[1])/3];if(!go(r,n)||vo(r,s))return!1;const o=[[e,t],[t,i],[i,e]];for(const l of s)for(const e of o)if(To(e[0],e[1],l))return!1;const a=[e,t,i];for(const l of a)if(!go(l,n)||vo(l,s)){let e=!1;for(const t of s)if(bo(l,t)){e=!0;break}if(!e&&!bo(l,n))return!1}return!s.some((e=>a.every((t=>go(t,e)))))},Mo=(e,t,i)=>{const n=[...e];for(const o of t)n.push(...o);n.push(...i);const s=ao.from(n).triangles,r=[];for(let o=0;o<s.length;o+=3){const i=n[s[o]],a=n[s[o+1]],l=n[s[o+2]];Ao(i,a,l,e,t)&&r.push(i,a,l)}return r},So=(e,t,i)=>{const n=[];if(i<=1)return n;const s=e.map((e=>e[0])),r=e.map((e=>e[1])),o=Math.min.apply(null,s),a=Math.max.apply(null,s),l=Math.min.apply(null,r),c=Math.max.apply(null,r),h=(a-o)/(10*i),u=(c-l)/(10*i);for(let d=o+h;d<a;d+=h)for(let i=l+u;i<c;i+=u){const s=[d,i];go(s,e)&&!vo(s,t)&&n.push(s)}return n},Eo=["position"],Po=["object"],Co=e({__name:"GeoPolygon",props:{geometry:{},subdivisions:{default:2},height:{default:30},renderOrder:{default:1},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","double-click","context-menu","pointer-enter","pointer-leave","pointer-over","pointer-down","pointer-up","wheel"],setup(e,{emit:t}){const i=e,h=t,d=s(),p=n(new ie),m=kr(h,i,i.raycastActive),f=e=>e.map((([e,t,n=i.height])=>({lon:e,lat:t,height:n}))),g=e=>{let t;if("Polygon"===e.type)t=[e.coordinates];else{if("MultiPolygon"!==e.type)throw new Error("不支持的几何类型，仅支持Polygon和MultiPolygon");t=e.coordinates}const i=[],n=[];return t.forEach((e=>{if(0===e.length)return;const t=f(e[0]);i.push(t);const s=[];for(let i=1;i<e.length;i++){const t=f(e[i]);s.push(t)}n.push(s)})),{contours:i,holes:n}},v=e=>{const{contours:t,holes:n}=g(i.geometry);if(0===t.length)throw new Error("没有有效的多边形轮廓");const s=[],r=[];t.forEach(((t,o)=>{if(t.length<3)return void console.warn(`多边形${o}的顶点数少于3，跳过`);const a=n[o]||[];let l=t.map((e=>[e.lon,e.lat])),c=a.map((e=>e.map((e=>[e.lon,e.lat]))));!_o(l)&&l.reverse();for(let e=0;e<c.length;e++){const t=c[e];_o(t)&&(c[e]=t.reverse())}yo(l),c.forEach((e=>yo(e)));const h=Math.max(1,i.subdivisions);l=xo(l,h),c=c.map((e=>xo(e,h)));const u=So(l,c,h),d=Mo(l,c,u),p=i.height??0,m=d.map((e=>e[0])),f=d.map((e=>e[1])),g=Math.min.apply(null,m),v=Math.max.apply(null,m),_=Math.min.apply(null,f),y=Math.max.apply(null,f),x=v-g,b=y-_;d.forEach((([t,i])=>{const n=dr(t,i,p);s.push(n.x-e.x,n.y-e.y,n.z-e.z);const o=x>0?(t-g)/x:0,a=b>0?1-(i-_)/b:0;r.push(o,a)}))}));const o=new Me;return o.setAttribute("position",new De(s,3)),o.setAttribute("uv",new De(r,2)),o.computeVertexNormals(),o},_=()=>{if(d.value)try{const{contours:e}=g(i.geometry);if(0===e.length||e[0].length<3)return;const t=d.value.geometry,n=y(i.geometry);p.value=n;const s=v(n);d.value.geometry=s,t.dispose()}catch(e){console.error("更新几何体失败:",e)}};a((()=>i.geometry),(()=>{_()}),{deep:!0}),a((()=>i.subdivisions),(()=>{_()})),a((()=>i.height),(()=>{_()}));const y=e=>{const{contours:t}=g(e);if(0===t.length)return new ie;let n=0,s=0,r=0;if(t.forEach((e=>{e.forEach((e=>{n+=e.lon,s+=e.lat,r++}))})),0===r)return new ie;const o=n/r,a=s/r,l=i.height??0;return new ie(...dr(o,a,l))};return o((()=>{(()=>{try{const{contours:e}=g(i.geometry);if(0===e.length||e[0].length<3)return void console.warn("多边形至少需要3个点");const t=y(i.geometry);p.value=t;const n=v(t);d.value=new oe(n),d.value.renderOrder=i.renderOrder,i.raycastActive&&Ir(d.value,i.raycastMultiplier)}catch(e){console.error("创建多边形失败:",e)}})()})),l((()=>{d.value&&d.value.geometry?.dispose?.()})),(e,t)=>d.value?(c(),r("TresGroup",{key:0,position:p.value},[R("primitive",{object:d.value,onClick:t[0]||(t[0]=(...e)=>u(m).handleClick&&u(m).handleClick(...e)),onDoubleClick:t[1]||(t[1]=(...e)=>u(m).handleDoubleClick&&u(m).handleDoubleClick(...e)),onContextMenu:t[2]||(t[2]=(...e)=>u(m).handleContextMenu&&u(m).handleContextMenu(...e)),onPointerEnter:t[3]||(t[3]=(...e)=>u(m).handlePointerEnter&&u(m).handlePointerEnter(...e)),onPointerLeave:t[4]||(t[4]=(...e)=>u(m).handlePointerLeave&&u(m).handlePointerLeave(...e)),onPointerOver:t[5]||(t[5]=(...e)=>u(m).handlePointerOver&&u(m).handlePointerOver(...e)),onPointerDown:t[6]||(t[6]=(...e)=>u(m).handlePointerDown&&u(m).handlePointerDown(...e)),onPointerUp:t[7]||(t[7]=(...e)=>u(m).handlePointerUp&&u(m).handlePointerUp(...e)),onWheel:t[8]||(t[8]=(...e)=>u(m).handleWheel&&u(m).handleWheel(...e))},[T(e.$slots,"default")],40,Po)],8,Eo)):C("",!0)}}),Ro=["position"],Lo=["object"],Do=e({__name:"GeoWall",props:{geometry:{},height:{default:100},baseHeight:{default:0},renderOrder:{default:1},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","double-click","context-menu","pointer-enter","pointer-leave","pointer-over","pointer-down","pointer-up","wheel"],setup(e,{emit:t}){const i=e,h=t,d=s(),p=n(new ie),m=kr(h,i,i.raycastActive),f=e=>e.map((([e,t,i=0])=>({lon:e,lat:t,height:i}))),g=e=>{const t=[];switch(e.type){case"LineString":t.push(f(e.coordinates));break;case"MultiLineString":case"Polygon":e.coordinates.forEach((e=>{t.push(f(e))}));break;case"MultiPolygon":e.coordinates.forEach((e=>{e.forEach((e=>{t.push(f(e))}))}));break;default:throw new Error(`不支持的几何类型: ${e.type}`)}return t},v=(e,t)=>{if(0===e.length)throw new Error("没有有效的线段数据");const n=[],s=[],r=[];let o=0;e.forEach((e=>{if(e.length<2)return void console.warn("线段至少需要2个点，跳过");const a=[...e],l=[],c=[];a.forEach((e=>{const n=dr(e.lon,e.lat,i.baseHeight);l.push(new ie(n.x-t.x,n.y-t.y,n.z-t.z));const s=dr(e.lon,e.lat,i.baseHeight+i.height);c.push(new ie(s.x-t.x,s.y-t.y,s.z-t.z))}));const h=[0];let u=0;for(let t=1;t<l.length;t++){const e=l[t-1].distanceTo(l[t]);u+=e,h.push(u)}l.forEach(((e,t)=>{n.push(e.x,e.y,e.z);const i=u>0?h[t]/u:0;r.push(i,0)})),c.forEach(((e,t)=>{n.push(e.x,e.y,e.z);const i=u>0?h[t]/u:0;r.push(i,1)}));const d=l.length;for(let t=0;t<d-1;t++){const e=o+t,i=o+t+1,n=o+t+d,r=o+t+1+d;s.push(e,i,n),s.push(i,r,n)}o+=2*d}));const a=new Me;return a.setAttribute("position",new De(n,3)),a.setAttribute("uv",new De(r,2)),a.setIndex(s),a.computeVertexNormals(),a},_=()=>{if(d.value)try{const e=g(i.geometry);if(0===e.length)return void console.warn("没有有效的线段数据");const t=d.value.geometry,n=y(i.geometry);p.value=n;const s=v(e,n);d.value.geometry=s,t.dispose()}catch(e){console.error("更新几何体失败:",e)}};a((()=>i.geometry),(()=>{_()}),{deep:!0}),a((()=>i.height),(()=>{_()})),a((()=>i.baseHeight),(()=>{_()}));const y=e=>{const t=g(e);if(0===t.length)return new ie;let n=0,s=0,r=0;if(t.forEach((e=>{e.forEach((e=>{n+=e.lon,s+=e.lat,r++}))})),0===r)return new ie;const o=n/r,a=s/r,l=i.baseHeight+i.height/2;return new ie(...dr(o,a,l))};return o((()=>{(()=>{try{const e=g(i.geometry);if(0===e.length)return void console.warn("没有有效的线段数据");const t=y(i.geometry);p.value=t;const n=v(e,t);d.value=new oe(n),d.value.renderOrder=i.renderOrder,i.raycastActive&&Ir(d.value,i.raycastMultiplier)}catch(e){console.error("创建墙体失败:",e)}})()})),l((()=>{d.value&&d.value.geometry.dispose()})),(e,t)=>d.value?(c(),r("TresGroup",{key:0,position:p.value},[R("primitive",{object:d.value,onClick:t[0]||(t[0]=(...e)=>u(m).handleClick&&u(m).handleClick(...e)),onDoubleClick:t[1]||(t[1]=(...e)=>u(m).handleDoubleClick&&u(m).handleDoubleClick(...e)),onContextMenu:t[2]||(t[2]=(...e)=>u(m).handleContextMenu&&u(m).handleContextMenu(...e)),onPointerEnter:t[3]||(t[3]=(...e)=>u(m).handlePointerEnter&&u(m).handlePointerEnter(...e)),onPointerLeave:t[4]||(t[4]=(...e)=>u(m).handlePointerLeave&&u(m).handlePointerLeave(...e)),onPointerOver:t[5]||(t[5]=(...e)=>u(m).handlePointerOver&&u(m).handlePointerOver(...e)),onPointerDown:t[6]||(t[6]=(...e)=>u(m).handlePointerDown&&u(m).handlePointerDown(...e)),onPointerUp:t[7]||(t[7]=(...e)=>u(m).handlePointerUp&&u(m).handlePointerUp(...e)),onWheel:t[8]||(t[8]=(...e)=>u(m).handleWheel&&u(m).handleWheel(...e))},[T(e.$slots,"default")],40,Lo)],8,Ro)):C("",!0)}}),Oo=["position"],ko=["object"],Io=["object"],Fo=["object"],Uo=e({__name:"GeoBuilding",props:{geometry:{},subdivisions:{default:2},height:{default:100},baseHeight:{default:0},showTop:{type:Boolean,default:!0},showBottom:{type:Boolean,default:!1},showWalls:{type:Boolean,default:!0},renderOrder:{default:1},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","double-click","context-menu","pointer-enter","pointer-leave","pointer-over","pointer-down","pointer-up","wheel"],setup(e,{emit:t}){const i=e,h=t,d=s(),p=s(),m=s(),f=n(new ie),g=kr(h,i,i.raycastActive),v=e=>e.map((([e,t,n=i.baseHeight])=>({lon:e,lat:t,height:n}))),_=e=>{let t;if("Polygon"===e.type)t=[e.coordinates];else{if("MultiPolygon"!==e.type)throw new Error("GeoBuilding 只支持 Polygon 和 MultiPolygon 类型");t=e.coordinates}const i=[],n=[];return t.forEach((e=>{if(0===e.length)return;const t=v(e[0]);i.push(t);const s=[];for(let i=1;i<e.length;i++){const t=v(e[i]);s.push(t)}n.push(s)})),{contours:i,holes:n}},y=(e,t)=>{const{contours:n,holes:s}=_(i.geometry);if(0===n.length)throw new Error("没有有效的多边形轮廓");const r=[],o=[];n.forEach(((n,a)=>{if(n.length<3)return void console.warn(`多边形${a}的顶点数少于3，跳过`);const l=s[a]||[];let c=n.map((e=>[e.lon,e.lat])),h=l.map((e=>e.map((e=>[e.lon,e.lat]))));!_o(c)&&c.reverse();for(let e=0;e<h.length;e++){const t=h[e];_o(t)&&(h[e]=t.reverse())}yo(c),h.forEach((e=>yo(e)));const u=Math.min(Math.max(1,i.subdivisions),5);c=xo(c,u),h=h.map((e=>xo(e,u)));const d=So(c,h,u),p=Mo(c,h,d);p.length>1e4&&console.warn(`多边形${a}顶点数过多(${p.length})，建议减少subdivisions`);const m=p.map((e=>e[0])),f=p.map((e=>e[1])),g=Math.min.apply(null,m),v=Math.max.apply(null,m),_=Math.min.apply(null,f),y=Math.max.apply(null,f),x=v-g,b=y-_;p.forEach((([n,s])=>{const a=dr(n,s,i.baseHeight+e);r.push(a.x-t.x,a.y-t.y,a.z-t.z);const l=x>0?(n-g)/x:0,c=b>0?1-(s-_)/b:0;o.push(l,c)}))}));const a=new Me;return a.setAttribute("position",new De(r,3)),a.setAttribute("uv",new De(o,2)),a.computeVertexNormals(),a},x=()=>{try{const{contours:e}=_(i.geometry);if(0===e.length||e[0].length<3)return void console.warn("多边形至少需要3个点");const t=w(i.geometry);if(f.value=t,i.showBottom){const e=y(0,t);p.value=new oe(e),p.value.renderOrder=i.renderOrder,i.raycastActive&&Ir(p.value,i.raycastMultiplier)}if(i.showTop){const e=y(i.height,t);d.value=new oe(e),d.value.renderOrder=i.renderOrder,i.raycastActive&&Ir(d.value,i.raycastMultiplier)}if(i.showWalls){const e=(e=>{const{contours:t,holes:n}=_(i.geometry);if(0===t.length)throw new Error("没有有效的多边形轮廓");const s=[],r=[],o=[];let a=0;t.forEach(((t,l)=>{const c=n[l]||[],h=t=>{if(t.length<3)return;const n=[],l=[];t.forEach((t=>{const s=dr(t.lon,t.lat,i.baseHeight);n.push(new ie(s.x-e.x,s.y-e.y,s.z-e.z));const r=dr(t.lon,t.lat,i.baseHeight+i.height);l.push(new ie(r.x-e.x,r.y-e.y,r.z-e.z))}));const c=[0];let h=0;for(let e=1;e<n.length;e++){const t=n[e-1].distanceTo(n[e]);h+=t,c.push(h)}n.forEach(((e,t)=>{s.push(e.x,e.y,e.z);const i=h>0?c[t]/h:0;o.push(i,0)})),l.forEach(((e,t)=>{s.push(e.x,e.y,e.z);const i=h>0?c[t]/h:0;o.push(i,1)}));const u=n.length;for(let e=0;e<u-1;e++){const t=a+e,i=a+e+1,n=a+e+u,s=a+e+1+u;r.push(t,i,n),r.push(i,s,n)}a+=2*u};h(t),c.forEach((e=>{h(e)}))}));const l=new Me;return l.setAttribute("position",new De(s,3)),l.setAttribute("uv",new De(o,2)),l.setIndex(r),l.computeVertexNormals(),l})(t);m.value=new oe(e),m.value.renderOrder=i.renderOrder,i.raycastActive&&Ir(m.value,i.raycastMultiplier)}}catch(e){console.error("创建建筑失败:",e)}},b=()=>{d.value&&d.value.geometry.dispose(),p.value&&p.value.geometry.dispose(),m.value&&m.value.geometry.dispose(),x()};a((()=>i.geometry),(()=>{b()}),{deep:!0}),a((()=>[i.subdivisions,i.height,i.baseHeight,i.showTop,i.showBottom,i.showWalls]),(()=>{b()}));const w=e=>{const{contours:t}=_(e);if(0===t.length)return new ie;let n=0,s=0,r=0;if(t.forEach((e=>{e.forEach((e=>{n+=e.lon,s+=e.lat,r++}))})),0===r)return new ie;const o=n/r,a=s/r,l=i.baseHeight+i.height/2;return new ie(...dr(o,a,l))};return o((()=>{x()})),l((()=>{d.value&&d.value.geometry.dispose(),p.value&&p.value.geometry.dispose(),m.value&&m.value.geometry.dispose()})),(e,t)=>p.value||d.value||m.value?(c(),r("TresGroup",{key:0,position:f.value,onClick:t[0]||(t[0]=(...e)=>u(g).handleClick&&u(g).handleClick(...e)),onDoubleClick:t[1]||(t[1]=(...e)=>u(g).handleDoubleClick&&u(g).handleDoubleClick(...e)),onContextMenu:t[2]||(t[2]=(...e)=>u(g).handleContextMenu&&u(g).handleContextMenu(...e)),onPointerEnter:t[3]||(t[3]=(...e)=>u(g).handlePointerEnter&&u(g).handlePointerEnter(...e)),onPointerLeave:t[4]||(t[4]=(...e)=>u(g).handlePointerLeave&&u(g).handlePointerLeave(...e)),onPointerOver:t[5]||(t[5]=(...e)=>u(g).handlePointerOver&&u(g).handlePointerOver(...e)),onPointerDown:t[6]||(t[6]=(...e)=>u(g).handlePointerDown&&u(g).handlePointerDown(...e)),onPointerUp:t[7]||(t[7]=(...e)=>u(g).handlePointerUp&&u(g).handlePointerUp(...e)),onWheel:t[8]||(t[8]=(...e)=>u(g).handleWheel&&u(g).handleWheel(...e))},[e.showBottom?(c(),r("primitive",{key:0,object:p.value},[T(e.$slots,"bottom")],8,ko)):C("",!0),e.showTop?(c(),r("primitive",{key:1,object:d.value},[T(e.$slots,"top")],8,Io)):C("",!0),e.showWalls?(c(),r("primitive",{key:2,object:m.value},[T(e.$slots,"walls")],8,Fo)):C("",!0)],40,Oo)):C("",!0)}}),Bo=["rotation-y"],zo=e({__name:"GeoRotate",props:{rotate:{default:0}},setup(e){const t=e,i=g((()=>t.rotate?t.rotate*(Math.PI/180):0));return(e,t)=>(c(),r("TresGroup",{"rotation-y":i.value},[T(e.$slots,"default")],8,Bo))}}),No=["position","rotation"],jo=e({__name:"GeoPosition",props:{point:{}},setup(e){const t=e,i=s(new ie),n=s(new ze),l=()=>{const e=dr(t.point?.lon,t.point?.lat,t.point?.height||0);i.value=e;const s=e.clone().normalize(),r=new ie(0,0,1),o=r.clone().sub(s.clone().multiplyScalar(r.dot(s))).normalize(),a=o.clone().cross(s).normalize();o.copy(s.clone().cross(a)).normalize();const l=new Ne;l.makeBasis(a,s,o);const c=new Z;c.matrix.copy(l),c.matrix.decompose(c.position,c.quaternion,c.scale),n.value.setFromQuaternion(c.quaternion),n.value=n.value.clone()};return a([()=>t.point?.lon,()=>t.point?.lat,()=>t.point?.height],(()=>{l()})),o((()=>{l()})),(e,t)=>(c(),r("TresGroup",{position:i.value,rotation:n.value},[T(e.$slots,"default")],8,No))}}),Ho=e({__name:"GeoTextureProps",props:{texture:{},center:{},rotation:{},scale:{},repeat:{},offset:{},wrapS:{},wrapT:{},magFilter:{},minFilter:{},flipY:{type:Boolean},format:{},type:{},colorSpace:{},generateMipmaps:{type:Boolean},premultiplyAlpha:{type:Boolean},unpackAlignment:{},anisotropy:{},encoding:{},matrixAutoUpdate:{type:Boolean},userData:{},name:{}},setup(e){const t=e;function i(e,t,i){void 0!==t&&e!==t&&i(t)}function n(e,t){t&&!function(e,t){return e.x===t[0]&&e.y===t[1]}(e,t)&&(e.x=t[0],e.y=t[1])}return a((()=>t.texture),(e=>{e&&t.texture&&(t.center&&(t.texture.center.x=t.center[0],t.texture.center.y=t.center[1]),void 0!==t.rotation&&(t.texture.rotation=t.rotation),t.scale&&(t.texture.repeat.x=t.scale[0],t.texture.repeat.y=t.scale[1]),t.repeat&&(t.texture.repeat.x=t.repeat[0],t.texture.repeat.y=t.repeat[1]),t.offset&&(t.texture.offset.x=t.offset[0],t.texture.offset.y=t.offset[1]),void 0!==t.wrapS&&(t.texture.wrapS=t.wrapS),void 0!==t.wrapT&&(t.texture.wrapT=t.wrapT),void 0!==t.magFilter&&(t.texture.magFilter=t.magFilter),void 0!==t.minFilter&&(t.texture.minFilter=t.minFilter),void 0!==t.flipY&&(t.texture.flipY=t.flipY),void 0!==t.format&&(t.texture.format=t.format),void 0!==t.type&&(t.texture.type=t.type),void 0!==t.colorSpace&&(t.texture.colorSpace=t.colorSpace),void 0!==t.generateMipmaps&&(t.texture.generateMipmaps=t.generateMipmaps),void 0!==t.premultiplyAlpha&&(t.texture.premultiplyAlpha=t.premultiplyAlpha),void 0!==t.unpackAlignment&&(t.texture.unpackAlignment=t.unpackAlignment),void 0!==t.anisotropy&&(t.texture.anisotropy=t.anisotropy),void 0!==t.encoding&&(t.texture.encoding=t.encoding),void 0!==t.userData&&(t.texture.userData=t.userData),void 0!==t.name&&(t.texture.name=t.name))}),{immediate:!0}),a((()=>t.center),(e=>{t.texture&&e&&n(t.texture.center,e)}),{deep:!0}),a((()=>t.rotation),(e=>{t.texture&&i(t.texture.rotation,e,(e=>{t.texture.rotation=e}))})),a((()=>t.scale),(e=>{t.texture&&e&&n(t.texture.repeat,e)}),{deep:!0}),a((()=>t.repeat),(e=>{t.texture&&e&&n(t.texture.repeat,e)}),{deep:!0}),a((()=>t.offset),(e=>{t.texture&&e&&n(t.texture.offset,e)}),{deep:!0}),a((()=>t.wrapS),(e=>{t.texture&&i(t.texture.wrapS,e,(e=>{t.texture.wrapS=e}))})),a((()=>t.wrapT),(e=>{t.texture&&i(t.texture.wrapT,e,(e=>{t.texture.wrapT=e}))})),a((()=>t.magFilter),(e=>{t.texture&&i(t.texture.magFilter,e,(e=>{t.texture.magFilter=e}))})),a((()=>t.minFilter),(e=>{t.texture&&i(t.texture.minFilter,e,(e=>{t.texture.minFilter=e}))})),a((()=>t.flipY),(e=>{t.texture&&i(t.texture.flipY,e,(e=>{t.texture.flipY=e}))})),a((()=>t.format),(e=>{t.texture&&i(t.texture.format,e,(e=>{t.texture.format=e}))})),a((()=>t.type),(e=>{t.texture&&i(t.texture.type,e,(e=>{t.texture.type=e}))})),a((()=>t.colorSpace),(e=>{t.texture&&i(t.texture.colorSpace,e,(e=>{t.texture.colorSpace=e}))})),a((()=>t.generateMipmaps),(e=>{t.texture&&i(t.texture.generateMipmaps,e,(e=>{t.texture.generateMipmaps=e}))})),a((()=>t.premultiplyAlpha),(e=>{t.texture&&i(t.texture.premultiplyAlpha,e,(e=>{t.texture.premultiplyAlpha=e}))})),a((()=>t.unpackAlignment),(e=>{t.texture&&i(t.texture.unpackAlignment,e,(e=>{t.texture.unpackAlignment=e}))})),a((()=>t.anisotropy),(e=>{t.texture&&i(t.texture.anisotropy,e,(e=>{t.texture.anisotropy=e}))})),a((()=>t.encoding),(e=>{t.texture&&i(t.texture.encoding,e,(e=>{t.texture.encoding=e}))})),a((()=>t.matrixAutoUpdate),(e=>{t.texture&&i(t.texture.matrixAutoUpdate,e,(e=>{t.texture.matrixAutoUpdate=e}))})),a((()=>t.userData),(e=>{t.texture&&i(t.texture.userData,e,(e=>{t.texture.userData=e}))}),{deep:!0}),a((()=>t.name),(e=>{t.texture&&i(t.texture.name,e,(e=>{t.texture.name=e}))})),(e,t)=>null}}),Go=e({__name:"GeoTextureClone",props:{map:{},displacementMap:{},normalMap:{},roughnessMap:{},metalnessMap:{},aoMap:{},alphaMap:{},matcap:{}},setup(e){const t=e,i=e=>{if(e)return e.clone()},n=g((()=>({map:i(t.map),displacementMap:i(t.displacementMap),normalMap:i(t.normalMap),roughnessMap:i(t.roughnessMap),metalnessMap:i(t.metalnessMap),aoMap:i(t.aoMap),alphaMap:i(t.alphaMap),matcap:i(t.matcap)})));return l((()=>{Object.values(n.value).forEach((e=>{e&&e.dispose()}))})),(e,t)=>T(e.$slots,"default",{textures:n.value})}});function Vo(e){if(!e)return null;const t=e.replace(/[a-z]+:\/\/[^/]+/i,"").replace(/\?.*$/i,"").replace(/.*\//g,""),i=t.lastIndexOf(".");return-1===i?null:t.substring(i+1)||null}const Wo=2**30;class Ko{get unloadPriorityCallback(){return this._unloadPriorityCallback}set unloadPriorityCallback(e){1===e.length?(console.warn('LRUCache: "unloadPriorityCallback" function has been changed to take two arguments.'),this._unloadPriorityCallback=(t,i)=>{const n=e(t),s=e(i);return n<s?-1:n>s?1:0}):this._unloadPriorityCallback=e}constructor(){this.minSize=6e3,this.maxSize=8e3,this.minBytesSize=.3*Wo,this.maxBytesSize=.4*Wo,this.unloadPercent=.05,this.autoMarkUnused=!0,this.itemSet=new Map,this.itemList=[],this.usedSet=new Set,this.callbacks=new Map,this.unloadingHandle=-1,this.cachedBytes=0,this.bytesMap=new Map,this.loadedSet=new Set,this._unloadPriorityCallback=null,this.computeMemoryUsageCallback=()=>null;const e=this.itemSet;this.defaultPriorityCallback=t=>e.get(t)}isFull(){return this.itemSet.size>=this.maxSize||this.cachedBytes>=this.maxBytesSize}getMemoryUsage(e){return this.bytesMap.get(e)??null}add(e,t){const i=this.itemSet;if(i.has(e)||this.isFull())return!1;const n=this.usedSet,s=this.itemList,r=this.callbacks,o=this.bytesMap;s.push(e),n.add(e),i.set(e,Date.now()),r.set(e,t);const a=this.computeMemoryUsageCallback(e);return this.cachedBytes+=a||0,o.set(e,a),!0}has(e){return this.itemSet.has(e)}remove(e){const t=this.usedSet,i=this.itemSet,n=this.itemList,s=this.bytesMap,r=this.callbacks,o=this.loadedSet;if(i.has(e)){this.cachedBytes-=s.get(e)||0,s.delete(e),r.get(e)(e);const a=n.indexOf(e);return n.splice(a,1),t.delete(e),i.delete(e),r.delete(e),o.delete(e),!0}return!1}setLoaded(e,t){const{itemSet:i,loadedSet:n}=this;i.has(e)&&(!0===t?n.add(e):n.delete(e))}updateMemoryUsage(e){const t=this.itemSet,i=this.bytesMap;if(!t.has(e))return;this.cachedBytes-=i.get(e)||0;const n=this.computeMemoryUsageCallback(e);i.set(e,n),this.cachedBytes+=n}markUsed(e){const t=this.itemSet,i=this.usedSet;t.has(e)&&!i.has(e)&&(t.set(e,Date.now()),i.add(e))}markUnused(e){this.usedSet.delete(e)}markAllUnused(){this.usedSet.clear()}unloadUnusedContent(){const{unloadPercent:e,minSize:t,maxSize:i,itemList:n,itemSet:s,usedSet:r,loadedSet:o,callbacks:a,bytesMap:l,minBytesSize:c,maxBytesSize:h}=this,u=n.length-r.size,d=n.length-o.size,p=Math.max(Math.min(n.length-t,u),0),m=this.cachedBytes-c,f=this.unloadPriorityCallback||this.defaultPriorityCallback;let g=!1;const v=p>0&&u>0||d&&n.length>i;if(u&&this.cachedBytes>c||d&&this.cachedBytes>h||v){n.sort(((e,t)=>{const i=r.has(e);if(i===r.has(t)){const i=o.has(e);return i===o.has(t)?-f(e,t):i?1:-1}return i?1:-1}));const d=Math.max(t*e,p*e),v=Math.ceil(Math.min(d,u,p)),_=Math.max(e*m,e*c),y=Math.min(_,m);let x=0,b=0;for(;this.cachedBytes-b>h||n.length-x>i;){const e=n[x],t=l.get(e)||0;if(r.has(e)&&o.has(e)||this.cachedBytes-b-t<h&&n.length-x<=i)break;b+=t,x++}for(;b<y||x<v;){const e=n[x],t=l.get(e)||0;if(r.has(e)||this.cachedBytes-b-t<c&&x>=v)break;b+=t,x++}n.splice(0,x).forEach((e=>{this.cachedBytes-=l.get(e)||0,a.get(e)(e),l.delete(e),s.delete(e),a.delete(e),o.delete(e),r.delete(e)})),g=x<p||b<m&&x<u,g=g&&x>0}g&&(this.unloadingHandle=requestAnimationFrame((()=>this.scheduleUnload())))}scheduleUnload(){cancelAnimationFrame(this.unloadingHandle),this.scheduled||(this.scheduled=!0,queueMicrotask((()=>{this.scheduled=!1,this.unloadUnusedContent()})))}}class Xo{get running(){return 0!==this.items.length||0!==this.currJobs}constructor(){this.maxJobs=6,this.items=[],this.callbacks=new Map,this.currJobs=0,this.scheduled=!1,this.autoUpdate=!0,this.priorityCallback=()=>{throw new Error("PriorityQueue: PriorityCallback function not defined.")},this.schedulingCallback=e=>{requestAnimationFrame(e)},this._runjobs=()=>{this.scheduled=!1,this.tryRunJobs()}}sort(){const e=this.priorityCallback;this.items.sort(e)}has(e){return this.callbacks.has(e)}add(e,t){const i={callback:t,reject:null,resolve:null,promise:null};return i.promise=new Promise(((t,n)=>{const s=this.items,r=this.callbacks;i.resolve=t,i.reject=n,s.push(e),r.set(e,i),this.autoUpdate&&this.scheduleJobRun()})),i.promise}remove(e){const t=this.items,i=this.callbacks,n=t.indexOf(e);if(-1!==n){const s=i.get(e);s.promise.catch((()=>{})),s.reject(new Error("PriorityQueue: Item removed.")),t.splice(n,1),i.delete(e)}}removeByFilter(e){const{items:t}=this;for(let i=0;i<t.length;i++){const n=t[i];e(n)&&this.remove(n)}}tryRunJobs(){this.sort();const e=this.items,t=this.callbacks,i=this.maxJobs;let n=0;const s=()=>{this.currJobs--,this.autoUpdate&&this.scheduleJobRun()};for(;i>this.currJobs&&e.length>0&&n<i;){this.currJobs++,n++;const i=e.pop(),{callback:r,resolve:o,reject:a}=t.get(i);let l;t.delete(i);try{l=r(i)}catch(Ls){a(Ls),s()}l instanceof Promise?l.then(o).catch(a).finally(s):(o(l),s())}}scheduleJobRun(){this.scheduled||(this.schedulingCallback(this._runjobs),this.scheduled=!0)}}const qo=-1,Yo=6378137,Zo={inView:!1,error:1/0,distanceFromCamera:1/0};function $o(e){return 3===e||e===qo}function Qo(e,t){return e.__lastFrameVisited===t&&e.__used}function Jo(e){return e.__childrenProcessed===e.children.length}function ea(e,t){e.__lastFrameVisited!==t.frameCount&&(e.__lastFrameVisited=t.frameCount,e.__used=!1,e.__inFrustum=!1,e.__isLeaf=!1,e.__visible=!1,e.__active=!1,e.__error=1/0,e.__distanceFromCamera=1/0,e.__childrenWereVisible=!1,e.__allChildrenLoaded=!1,t.calculateTileViewError(e,Zo),e.__inFrustum=Zo.inView,e.__error=Zo.error,e.__distanceFromCamera=Zo.distanceFromCamera)}function ta(e,t){if(t.ensureChildrenArePreprocessed(e),ea(e,t),na(e,t),!e.__hasRenderableContent&&Jo(e)){const i=e.children;for(let e=0,n=i.length;e<n;e++)ta(i[e],t)}}function ia(e,t){if(t.ensureChildrenArePreprocessed(e),Qo(e,t.frameCount)&&(e.__hasContent&&0===e.__loadingState&&!t.lruCache.isFull()&&t.queueTileForDownload(e),Jo(e))){const i=e.children;for(let e=0,n=i.length;e<n;e++)ia(i[e],t)}}function na(e,t){e.__used||(e.__used=!0,t.markTileUsed(e),t.stats.used++,!0===e.__inFrustum&&t.stats.inFrustum++)}function sa(e,t=null,i=null){const n=[];for(n.push(e),n.push(null),n.push(0);n.length>0;){const e=n.pop(),s=n.pop(),r=n.pop();if(t&&t(r,s,e))return void(i&&i(r,s,e));const o=r.children;if(o)for(let t=o.length-1;t>=0;t--)n.push(o[t]),n.push(r),n.push(e+1);i&&i(r,s,e)}}function ra(e,t){if(t.ensureChildrenArePreprocessed(e),ea(e,t),!e.__inFrustum)return;if(!function(e,t){return!(e.__error<=t.errorTarget||t.maxDepth>0&&e.__depth+1>=t.maxDepth||!Jo(e))}(e,t))return void na(e,t);let i=!1,n=!1;const s=e.children;for(let r=0,o=s.length;r<o;r++){const e=s[r];ra(e,t),i=i||Qo(e,t.frameCount),n=n||e.__inFrustum}if(na(e,t),i&&"REPLACE"===e.refine)for(let r=0,o=s.length;r<o;r++){ta(s[r],t)}}function oa(e,t){const i=t.frameCount;if(!Qo(e,i))return;const n=e.children;let s=!1;for(let r=0,o=n.length;r<o;r++){const e=n[r];s=s||Qo(e,i)}if(s){let s=!1,r=!0;for(let e=0,o=n.length;e<o;e++){const o=n[e];if(oa(o,t),s=s||o.__wasSetVisible||o.__childrenWereVisible,Qo(o,i)){const e=o.__allChildrenLoaded||o.__hasRenderableContent&&$o(o.__loadingState)||!o.__hasContent&&0===o.children.length||o.__hasUnrenderableContent&&o.__loadingState===qo;r=r&&e}}e.__childrenWereVisible=s,e.__allChildrenLoaded=r}else e.__isLeaf=!0}function aa(e,t){const i=t.stats;if(!Qo(e,t.frameCount))return;const n=t.lruCache;if(e.__isLeaf)return void(3===e.__loadingState?(e.__inFrustum&&(e.__visible=!0,i.visible++),e.__active=!0,i.active++):!n.isFull()&&e.__hasContent&&t.queueTileForDownload(e));const s=e.children,r=e.__hasContent,o=$o(e.__loadingState)&&r,a=(t.errorTarget+1)*t.errorThreshold,l=e.__error<=a,c=e.__childrenWereVisible,h=e.__allChildrenLoaded;if((l||"ADD"===e.refine)&&!o&&!n.isFull()&&r&&t.queueTileForDownload(e),(l&&!h&&!c&&o||"ADD"===e.refine&&o)&&(e.__inFrustum&&(e.__visible=!0,i.visible++),e.__active=!0,i.active++),"REPLACE"===e.refine&&l&&!h)for(let u=0,d=s.length;u<d;u++){const e=s[u];Qo(e,t.frameCount)&&ia(e,t)}else for(let u=0,d=s.length;u<d;u++)aa(s[u],t)}function la(e,t){const i=Qo(e,t.frameCount);if(i||e.__usedLastFrame){let n=!1,s=!1;i?(n=e.__active,s=t.displayActiveTiles&&e.__active||e.__visible):ea(e,t),e.__hasRenderableContent&&3===e.__loadingState&&(e.__wasSetActive!==n&&t.invokeOnePlugin((t=>t.setTileActive&&t.setTileActive(e,n))),e.__wasSetVisible!==s&&t.invokeOnePlugin((t=>t.setTileVisible&&t.setTileVisible(e,s)))),e.__wasSetActive=n,e.__wasSetVisible=s,e.__usedLastFrame=i;const r=e.children;for(let e=0,i=r.length;e<i;e++){la(r[e],t)}}}const ca=Symbol("PLUGIN_REGISTERED"),ha=(e,t)=>e.__depthFromRenderedParent!==t.__depthFromRenderedParent?e.__depthFromRenderedParent>t.__depthFromRenderedParent?-1:1:e.__inFrustum!==t.__inFrustum?e.__inFrustum?1:-1:e.__used!==t.__used?e.__used?1:-1:e.__error!==t.__error?e.__error>t.__error?1:-1:e.__distanceFromCamera!==t.__distanceFromCamera?e.__distanceFromCamera>t.__distanceFromCamera?-1:1:0,ua=(e,t)=>e.__depthFromRenderedParent!==t.__depthFromRenderedParent?e.__depthFromRenderedParent>t.__depthFromRenderedParent?1:-1:e.__loadingState!==t.__loadingState?e.__loadingState>t.__loadingState?-1:1:e.__lastFrameVisited!==t.__lastFrameVisited?e.__lastFrameVisited>t.__lastFrameVisited?-1:1:e.__hasUnrenderableContent!==t.__hasUnrenderableContent?e.__hasUnrenderableContent?-1:1:e.__error!==t.__error?e.__error>t.__error?-1:1:0;class da{get root(){const e=this.rootTileSet;return e?e.root:null}get loadProgress(){const{stats:e,isLoading:t}=this,i=e.downloading+e.parsing,n=e.inCacheSinceLoad+(t?1:0);return 0===n?1:1-i/n}get errorThreshold(){return this._errorThreshold}set errorThreshold(e){console.warn('TilesRenderer: The "errorThreshold" option has been deprecated.'),this._errorThreshold=e}constructor(e=null){this.rootLoadingState=0,this.rootTileSet=null,this.rootURL=e,this.fetchOptions={},this.plugins=[],this.queuedTiles=[],this.cachedSinceLoadComplete=new Set,this.isLoading=!1;const t=new Ko;t.unloadPriorityCallback=ua;const i=new Xo;i.maxJobs=10,i.priorityCallback=ha;const n=new Xo;n.maxJobs=1,n.priorityCallback=ha;const s=new Xo;s.maxJobs=25,s.priorityCallback=ha,s.log=!0,this.visibleTiles=new Set,this.activeTiles=new Set,this.usedSet=new Set,this.lruCache=t,this.downloadQueue=i,this.parseQueue=n,this.processNodeQueue=s,this.stats={inCacheSinceLoad:0,inCache:0,parsing:0,downloading:0,failed:0,inFrustum:0,used:0,active:0,visible:0},this.frameCount=0,this._dispatchNeedsUpdateEvent=function(e){let t=null;return()=>{null===t&&(t=requestAnimationFrame((()=>{t=null,e()})))}}((()=>{this.dispatchEvent({type:"needs-update"})})),this.errorTarget=16,this._errorThreshold=1/0,this.displayActiveTiles=!1,this.maxDepth=1/0}registerPlugin(e){if(!0===e[ca])throw new Error("TilesRendererBase: A plugin can only be registered to a single tile set");const t=this.plugins,i=e.priority||0;let n=t.length;for(let s=0;s<t.length;s++)if((t[s].priority||0)>i){n=s;break}t.splice(n,0,e),e[ca]=!0,e.init&&e.init(this)}unregisterPlugin(e){const t=this.plugins;if("string"==typeof e&&(e=this.getPluginByName(name)),t.includes(e)){const i=t.indexOf(e);return t.splice(i,1),e.dispose&&e.dispose(),!0}return!1}getPluginByName(e){return this.plugins.find((t=>t.name===e))||null}traverse(e,t,i=!0){this.root&&sa(this.root,((t,...n)=>(i&&this.ensureChildrenArePreprocessed(t,!0),!!e&&e(t,...n))),t)}queueTileForDownload(e){0===e.__loadingState&&this.queuedTiles.push(e)}markTileUsed(e){this.usedSet.add(e),this.lruCache.markUsed(e)}update(){const{lruCache:e,usedSet:t,stats:i,root:n,downloadQueue:s,parseQueue:r,processNodeQueue:o}=this;if(0===this.rootLoadingState&&(this.rootLoadingState=1,this.invokeOnePlugin((e=>e.loadRootTileSet&&e.loadRootTileSet())).then((e=>{let t=this.rootURL;null!==t&&this.invokeAllPlugins((e=>t=e.preprocessURL?e.preprocessURL(t,null):t)),this.rootLoadingState=3,this.rootTileSet=e,this.dispatchEvent({type:"needs-update"}),this.dispatchEvent({type:"load-content"}),this.dispatchEvent({type:"load-tile-set",tileSet:e,url:t})})).catch((e=>{this.rootLoadingState=qo,console.error(e),this.rootTileSet=null,this.dispatchEvent({type:"load-error",tile:null,error:e,url:this.rootURL})}))),!n)return;i.inFrustum=0,i.used=0,i.active=0,i.visible=0,this.frameCount++,t.forEach((t=>e.markUnused(t))),t.clear(),ra(n,this),oa(n,this),aa(n,this),la(n,this);const a=this.queuedTiles;a.sort(e.unloadPriorityCallback);for(let l=0,c=a.length;l<c&&!e.isFull();l++)this.requestTileContents(a[l]);a.length=0,e.scheduleUnload(),!1===(s.running||r.running||o.running)&&!0===this.isLoading&&(this.cachedSinceLoadComplete.clear(),i.inCacheSinceLoad=0,this.dispatchEvent({type:"tiles-load-end"}),this.isLoading=!1)}resetFailedTiles(){this.rootLoadingState===qo&&(this.rootLoadingState=0);const e=this.stats;0!==e.failed&&(this.traverse((e=>{e.__loadingState===qo&&(e.__loadingState=0)}),null,!1),e.failed=0)}dispose(){[...this.plugins].forEach((e=>{this.unregisterPlugin(e)}));const e=this.lruCache,t=[];this.traverse((e=>(t.push(e),!1)),null,!1);for(let i=0,n=t.length;i<n;i++)e.remove(t[i]);this.stats={parsing:0,downloading:0,failed:0,inFrustum:0,used:0,active:0,visible:0},this.frameCount=0}dispatchEvent(e){}fetchData(e,t){return fetch(e,t)}parseTile(e,t,i){return null}disposeTile(e){e.__visible&&(this.invokeOnePlugin((t=>t.setTileVisible&&t.setTileVisible(e,!1))),e.__visible=!1),e.__active&&(this.invokeOnePlugin((t=>t.setTileActive&&t.setTileActive(e,!1))),e.__active=!1)}preprocessNode(e,t,i=null){if(e.content&&(!("uri"in e.content)&&"url"in e.content&&(e.content.uri=e.content.url,delete e.content.url),e.content.boundingVolume&&!("box"in e.content.boundingVolume||"sphere"in e.content.boundingVolume||"region"in e.content.boundingVolume)&&delete e.content.boundingVolume),e.parent=i,e.children=e.children||[],e.content?.uri){const t=Vo(e.content.uri);e.__hasContent=!0,e.__hasUnrenderableContent=!(!t||!/json$/.test(t)),e.__hasRenderableContent=!e.__hasUnrenderableContent}else e.__hasContent=!1,e.__hasUnrenderableContent=!1,e.__hasRenderableContent=!1;e.__childrenProcessed=0,i&&i.__childrenProcessed++,e.__distanceFromCamera=1/0,e.__error=1/0,e.__inFrustum=!1,e.__isLeaf=!1,e.__usedLastFrame=!1,e.__used=!1,e.__wasSetVisible=!1,e.__visible=!1,e.__childrenWereVisible=!1,e.__allChildrenLoaded=!1,e.__wasSetActive=!1,e.__active=!1,e.__loadingState=0,null===i?(e.__depth=0,e.__depthFromRenderedParent=e.__hasRenderableContent?1:0,e.refine=e.refine||"REPLACE"):(e.__depth=i.__depth+1,e.__depthFromRenderedParent=i.__depthFromRenderedParent+(e.__hasRenderableContent?1:0),e.refine=e.refine||i.refine),e.__basePath=t,e.__lastFrameVisited=-1,this.invokeAllPlugins((n=>{n!==this&&n.preprocessNode&&n.preprocessNode(e,t,i)}))}setTileActive(e,t){t?this.activeTiles.add(e):this.activeTiles.delete(e)}setTileVisible(e,t){t?this.visibleTiles.add(e):this.visibleTiles.delete(e)}calculateTileViewError(e,t){}ensureChildrenArePreprocessed(e,t=!1){const i=e.children;for(let n=0,s=i.length;n<s;n++){const s=i[n];if("__depth"in s)break;t?(this.processNodeQueue.remove(s),this.preprocessNode(s,e.__basePath,e)):this.processNodeQueue.has(s)||this.processNodeQueue.add(s,(t=>{this.preprocessNode(t,e.__basePath,e),this._dispatchNeedsUpdateEvent()}))}}preprocessTileSet(e,t,i=null){const n=e.asset.version,[s,r]=n.split(".").map((e=>parseInt(e)));console.assert(s<=1,"TilesRenderer: asset.version is expected to be a 1.x or a compatible version."),1===s&&r>0&&console.warn("TilesRenderer: tiles versions at 1.1 or higher have limited support. Some new extensions and features may not be supported.");let o=t.replace(/\/[^/]*$/,"");o=new URL(o,window.location.href).toString(),this.preprocessNode(e.root,o,i)}loadRootTileSet(){let e=this.rootURL;return this.invokeAllPlugins((t=>e=t.preprocessURL?t.preprocessURL(e,null):e)),this.invokeOnePlugin((t=>t.fetchData&&t.fetchData(e,this.fetchOptions))).then((t=>{if(t instanceof Response){if(t.ok)return t.json();throw new Error(`TilesRenderer: Failed to load tileset "${e}" with status ${t.status} : ${t.statusText}`)}return t})).then((t=>(this.preprocessTileSet(t,e),t)))}requestTileContents(e){if(0!==e.__loadingState)return;let t=!1,i=null,n=new URL(e.content.uri,e.__basePath+"/").toString();this.invokeAllPlugins((t=>n=t.preprocessURL?t.preprocessURL(n,e):n));const s=this.stats,r=this.lruCache,o=this.downloadQueue,a=this.parseQueue,l=Vo(n),c=new AbortController,h=c.signal;return r.add(e,(i=>{c.abort(),t?(i.children.length=0,i.__childrenProcessed=0):this.invokeAllPlugins((e=>{e.disposeTile&&e.disposeTile(i)})),s.inCache--,this.cachedSinceLoadComplete.has(e)&&(this.cachedSinceLoadComplete.delete(e),s.inCacheSinceLoad--),1===i.__loadingState?s.downloading--:2===i.__loadingState&&s.parsing--,i.__loadingState=0,a.remove(i),o.remove(i)}))?(this.isLoading||(this.isLoading=!0,this.dispatchEvent({type:"tiles-load-start"})),this.cachedSinceLoadComplete.add(e),s.inCacheSinceLoad++,s.inCache++,s.downloading++,e.__loadingState=1,o.add(e,(t=>{if(h.aborted)return Promise.resolve();const i=this.invokeOnePlugin((e=>e.fetchData&&e.fetchData(n,{...this.fetchOptions,signal:h})));return this.dispatchEvent({type:"tile-download-start",tile:e}),i})).then((e=>{if(!h.aborted){if(e instanceof Response){if(e.ok)return"json"===l?e.json():e.arrayBuffer();throw new Error(`Failed to load model with error code ${e.status}`)}return e}})).then((r=>{if(!h.aborted)return s.downloading--,s.parsing++,e.__loadingState=2,a.add(e,(s=>h.aborted?Promise.resolve():"json"===l&&r.root?(this.preprocessTileSet(r,n,e),e.children.push(r.root),i=r,t=!0,Promise.resolve()):this.invokeOnePlugin((e=>e.parseTile&&e.parseTile(r,s,l,n,h)))))})).then((()=>{h.aborted||(s.parsing--,e.__loadingState=3,r.setLoaded(e,!0),null===r.getMemoryUsage(e)&&(r.isFull()&&r.computeMemoryUsageCallback(e)>0?r.remove(e):r.updateMemoryUsage(e)),this.dispatchEvent({type:"needs-update"}),this.dispatchEvent({type:"load-content"}),t&&this.dispatchEvent({type:"load-tile-set",tileSet:i,url:n}),e.cached.scene&&this.dispatchEvent({type:"load-model",scene:e.cached.scene,tile:e}))})).catch((t=>{h.aborted||("AbortError"!==t.name?(a.remove(e),o.remove(e),2===e.__loadingState?s.parsing--:1===e.__loadingState&&s.downloading--,s.failed++,console.error(`TilesRenderer : Failed to load tile at url "${e.content.uri}".`),console.error(t),e.__loadingState=qo,r.setLoaded(e,!0),this.dispatchEvent({type:"load-error",tile:e,error:t,url:n})):r.remove(e))}))):void 0}getAttributions(e=[]){return this.invokeAllPlugins((t=>t!==this&&t.getAttributions&&t.getAttributions(e))),e}invokeOnePlugin(e){const t=[...this.plugins,this];for(let i=0;i<t.length;i++){const n=e(t[i]);if(n)return n}return null}invokeAllPlugins(e){const t=[...this.plugins,this],i=[];for(let n=0;n<t.length;n++){const s=e(t[n]);s&&i.push(s)}return 0===i.length?null:Promise.all(i)}}const pa=new TextDecoder;function ma(e){return pa.decode(e)}function fa(e,t,i,n,s,r){let o,a;switch(n){case"SCALAR":o=1;break;case"VEC2":o=2;break;case"VEC3":o=3;break;case"VEC4":o=4;break;default:throw new Error(`FeatureTable : Feature type not provided for "${r}".`)}const l=i*o;switch(s){case"BYTE":a=new Int8Array(e,t,l);break;case"UNSIGNED_BYTE":a=new Uint8Array(e,t,l);break;case"SHORT":a=new Int16Array(e,t,l);break;case"UNSIGNED_SHORT":a=new Uint16Array(e,t,l);break;case"INT":a=new Int32Array(e,t,l);break;case"UNSIGNED_INT":a=new Uint32Array(e,t,l);break;case"FLOAT":a=new Float32Array(e,t,l);break;case"DOUBLE":a=new Float64Array(e,t,l);break;default:throw new Error(`FeatureTable : Feature component type not provided for "${r}".`)}return a}class ga{constructor(e,t,i,n){this.buffer=e,this.binOffset=t+i,this.binLength=n;let s=null;if(0!==i){const n=new Uint8Array(e,t,i);s=JSON.parse(ma(n))}else s={};this.header=s}getKeys(){return Object.keys(this.header)}getData(e,t,i=null,n=null){const s=this.header;if(!(e in s))return null;const r=s[e];if(r instanceof Object){if(Array.isArray(r))return r;{const{buffer:s,binOffset:o,binLength:a}=this,l=r.byteOffset||0,c=r.type||n,h=r.componentType||i;if("type"in r&&n&&r.type!==n)throw new Error("FeatureTable: Specified type does not match expected type.");const u=o+l,d=fa(s,u,t,c,h,e);if(u+d.byteLength>o+a)throw new Error("FeatureTable: Feature data read outside binary body length.");return d}}return r}getBuffer(e,t){const{buffer:i,binOffset:n}=this;return i.slice(n+e,n+e+t)}}class va{constructor(e){this.batchTable=e;const t=e.header.extensions["3DTILES_batch_table_hierarchy"];this.classes=t.classes;for(const n of this.classes){const e=n.instances;for(const t in e)n.instances[t]=this._parseProperty(e[t],n.length,t)}if(this.instancesLength=t.instancesLength,this.classIds=this._parseProperty(t.classIds,this.instancesLength,"classIds"),t.parentCounts?this.parentCounts=this._parseProperty(t.parentCounts,this.instancesLength,"parentCounts"):this.parentCounts=new Array(this.instancesLength).fill(1),t.parentIds){const e=this.parentCounts.reduce(((e,t)=>e+t),0);this.parentIds=this._parseProperty(t.parentIds,e,"parentIds")}else this.parentIds=null;this.instancesIds=[];const i={};for(const n of this.classIds)i[n]=i[n]??0,this.instancesIds.push(i[n]),i[n]++}_parseProperty(e,t,i){if(Array.isArray(e))return e;{const{buffer:n,binOffset:s}=this.batchTable;return fa(n,s+e.byteOffset,t,"SCALAR",e.componentType||"UNSIGNED_SHORT",i)}}getDataFromId(e,t={}){const i=this.parentCounts[e];if(this.parentIds&&i>0){let n=0;for(let t=0;t<e;t++)n+=this.parentCounts[t];for(let s=0;s<i;s++){const i=this.parentIds[n+s];i!==e&&this.getDataFromId(i,t)}}const n=this.classIds[e],s=this.classes[n].instances,r=this.classes[n].name,o=this.instancesIds[e];for(const a in s)t[r]=t[r]||{},t[r][a]=s[a][o];return t}}class _a extends ga{get batchSize(){return console.warn("BatchTable.batchSize has been deprecated and replaced with BatchTable.count."),this.count}constructor(e,t,i,n,s){super(e,i,n,s),this.count=t,this.extensions={};const r=this.header.extensions;r&&r["3DTILES_batch_table_hierarchy"]&&(this.extensions["3DTILES_batch_table_hierarchy"]=new va(this))}getData(e,t=null,i=null){return console.warn("BatchTable: BatchTable.getData is deprecated. Use BatchTable.getDataFromId to get allproperties for an id or BatchTable.getPropertyArray for getting an array of value for a property."),super.getData(e,this.count,t,i)}getDataFromId(e,t={}){if(e<0||e>=this.count)throw new Error(`BatchTable: id value "${e}" out of bounds for "${this.count}" features number.`);for(const i of this.getKeys())"extensions"!==i&&(t[i]=super.getData(i,this.count)[e]);for(const i in this.extensions){const n=this.extensions[i];n.getDataFromId instanceof Function&&(t[i]=t[i]||{},n.getDataFromId(e,t[i]))}return t}getPropertyArray(e){return super.getData(e,this.count)}}class ya{constructor(){this.fetchOptions={},this.workingPath=""}load(...e){return console.warn('Loader: "load" function has been deprecated in favor of "loadAsync".'),this.loadAsync(...e)}loadAsync(e){return fetch(e,this.fetchOptions).then((t=>{if(!t.ok)throw new Error(`Failed to load file "${e}" with status ${t.status} : ${t.statusText}`);return t.arrayBuffer()})).then((t=>(""===this.workingPath&&(this.workingPath=this.workingPathForURL(e)),this.parse(t))))}resolveExternalURL(e){return/^[^\\/]/.test(e)&&!/^http/.test(e)?this.workingPath+"/"+e:e}workingPathForURL(e){const t=e.split(/[\\/]/g);return t.pop(),t.join("/")+"/"}parse(e){throw new Error("LoaderBase: Parse not implemented.")}}function xa(e){if(null===e||e.byteLength<4)return"";let t;if(t=e instanceof DataView?e:new DataView(e),"{"===String.fromCharCode(t.getUint8(0)))return null;let i="";for(let n=0;n<4;n++)i+=String.fromCharCode(t.getUint8(n));return i}class ba extends ya{parse(e){const t=new DataView(e),i=xa(t);console.assert("b3dm"===i);const n=t.getUint32(4,!0);console.assert(1===n);const s=t.getUint32(8,!0);console.assert(s===e.byteLength);const r=t.getUint32(12,!0),o=t.getUint32(16,!0),a=t.getUint32(20,!0),l=t.getUint32(24,!0),c=e.slice(28,28+r+o),h=new ga(c,0,r,o),u=28+r+o,d=e.slice(u,u+a+l),p=new _a(d,h.getData("BATCH_LENGTH"),0,a,l),m=u+a+l;return{version:n,featureTable:h,batchTable:p,glbBytes:new Uint8Array(e,m,s-m)}}}function wa(e,t){if(t===Wt)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===Kt||t===Xt){let i=e.getIndex();if(null===i){const t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),i=e.getIndex()}const n=i.count-2,s=[];if(t===Kt)for(let e=1;e<=n;e++)s.push(i.getX(0)),s.push(i.getX(e)),s.push(i.getX(e+1));else for(let e=0;e<n;e++)e%2==0?(s.push(i.getX(e)),s.push(i.getX(e+1)),s.push(i.getX(e+2))):(s.push(i.getX(e+2)),s.push(i.getX(e+1)),s.push(i.getX(e)));s.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=e.clone();return r.setIndex(s),r.clearGroups(),r}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}let Ta=class extends nt{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new Ca(e)})),this.register((function(e){return new Ra(e)})),this.register((function(e){return new za(e)})),this.register((function(e){return new Na(e)})),this.register((function(e){return new ja(e)})),this.register((function(e){return new Da(e)})),this.register((function(e){return new Oa(e)})),this.register((function(e){return new ka(e)})),this.register((function(e){return new Ia(e)})),this.register((function(e){return new Pa(e)})),this.register((function(e){return new Fa(e)})),this.register((function(e){return new La(e)})),this.register((function(e){return new Ba(e)})),this.register((function(e){return new Ua(e)})),this.register((function(e){return new Sa(e)})),this.register((function(e){return new Ha(e)})),this.register((function(e){return new Ga(e)}))}load(e,t,i,n){const s=this;let r;if(""!==this.resourcePath)r=this.resourcePath;else if(""!==this.path){const t=st.extractUrlBase(e);r=st.resolveURL(t,this.path)}else r=st.extractUrlBase(e);this.manager.itemStart(e);const o=function(t){n?n(t):console.error(t),s.manager.itemError(e),s.manager.itemEnd(e)},a=new rt(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(i){try{s.parse(i,r,(function(i){t(i),s.manager.itemEnd(e)}),o)}catch(n){o(n)}}),i,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,n){let s;const r={},o={},a=new TextDecoder;if("string"==typeof e)s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(a.decode(new Uint8Array(e,0,4))===Va){try{r[Ma.KHR_BINARY_GLTF]=new Xa(e)}catch(Ls){return void(n&&n(Ls))}s=JSON.parse(r[Ma.KHR_BINARY_GLTF].content)}else s=JSON.parse(a.decode(e));else s=e;if(void 0===s.asset||s.asset.version[0]<2)return void(n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new _l(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const e=this.pluginCallbacks[c](l);e.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[e.name]=e,r[e.name]=!0}if(s.extensionsUsed)for(let c=0;c<s.extensionsUsed.length;++c){const e=s.extensionsUsed[c],t=s.extensionsRequired||[];switch(e){case Ma.KHR_MATERIALS_UNLIT:r[e]=new Ea;break;case Ma.KHR_DRACO_MESH_COMPRESSION:r[e]=new qa(s,this.dracoLoader);break;case Ma.KHR_TEXTURE_TRANSFORM:r[e]=new Ya;break;case Ma.KHR_MESH_QUANTIZATION:r[e]=new Za;break;default:t.indexOf(e)>=0&&void 0===o[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}l.setExtensions(r),l.setPlugins(o),l.parse(i,n)}parseAsync(e,t){const i=this;return new Promise((function(n,s){i.parse(e,t,n,s)}))}};function Aa(){let e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const Ma={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};let Sa=class{constructor(e){this.parser=e,this.name=Ma.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,n=t.length;i<n;i++){const n=t[i];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let n=t.cache.get(i);if(n)return n;const s=t.json,r=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let o;const a=new q(16777215);void 0!==r.color&&a.setRGB(r.color[0],r.color[1],r.color[2],Ee);const l=void 0!==r.range?r.range:0;switch(r.type){case"directional":o=new yt(a),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new _t(a),o.distance=l;break;case"spot":o=new vt(a),o.distance=l,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,o.angle=r.spot.outerConeAngle,o.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return o.position.set(0,0,0),dl(o,r),void 0!==r.intensity&&(o.intensity=r.intensity),o.name=t.createUniqueName(r.name||"light_"+e),n=Promise.resolve(o),t.cache.add(i,n),n}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,n=i.json.nodes[e],s=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===s?null:this._loadLight(s).then((function(e){return i._getNodeRef(t.cache,s,e)}))}},Ea=class{constructor(){this.name=Ma.KHR_MATERIALS_UNLIT}getMaterialType(){return se}extendParams(e,t,i){const n=[];e.color=new q(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const t=s.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],Ee),e.opacity=t[3]}void 0!==s.baseColorTexture&&n.push(i.assignTexture(e,"map",s.baseColorTexture,X))}return Promise.all(n)}},Pa=class{constructor(e){this.parser=e,this.name=Ma.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name].emissiveStrength;return void 0!==n&&(t.emissiveIntensity=n),Promise.resolve()}},Ca=class{constructor(e){this.parser=e,this.name=Ma.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?gt:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];if(void 0!==r.clearcoatFactor&&(t.clearcoat=r.clearcoatFactor),void 0!==r.clearcoatTexture&&s.push(i.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),void 0!==r.clearcoatRoughnessFactor&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),void 0!==r.clearcoatRoughnessTexture&&s.push(i.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),void 0!==r.clearcoatNormalTexture&&(s.push(i.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),void 0!==r.clearcoatNormalTexture.scale)){const e=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new te(e,e)}return Promise.all(s)}},Ra=class{constructor(e){this.parser=e,this.name=Ma.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?gt:null}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name];return t.dispersion=void 0!==n.dispersion?n.dispersion:0,Promise.resolve()}},La=class{constructor(e){this.parser=e,this.name=Ma.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?gt:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return void 0!==r.iridescenceFactor&&(t.iridescence=r.iridescenceFactor),void 0!==r.iridescenceTexture&&s.push(i.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),void 0!==r.iridescenceIor&&(t.iridescenceIOR=r.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==r.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),void 0!==r.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),void 0!==r.iridescenceThicknessTexture&&s.push(i.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(s)}},Da=class{constructor(e){this.parser=e,this.name=Ma.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?gt:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new q(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=n.extensions[this.name];if(void 0!==r.sheenColorFactor){const e=r.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],Ee)}return void 0!==r.sheenRoughnessFactor&&(t.sheenRoughness=r.sheenRoughnessFactor),void 0!==r.sheenColorTexture&&s.push(i.assignTexture(t,"sheenColorMap",r.sheenColorTexture,X)),void 0!==r.sheenRoughnessTexture&&s.push(i.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(s)}},Oa=class{constructor(e){this.parser=e,this.name=Ma.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?gt:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return void 0!==r.transmissionFactor&&(t.transmission=r.transmissionFactor),void 0!==r.transmissionTexture&&s.push(i.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(s)}},ka=class{constructor(e){this.parser=e,this.name=Ma.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?gt:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];t.thickness=void 0!==r.thicknessFactor?r.thicknessFactor:0,void 0!==r.thicknessTexture&&s.push(i.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||1/0;const o=r.attenuationColor||[1,1,1];return t.attenuationColor=(new q).setRGB(o[0],o[1],o[2],Ee),Promise.all(s)}},Ia=class{constructor(e){this.parser=e,this.name=Ma.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?gt:null}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name];return t.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}},Fa=class{constructor(e){this.parser=e,this.name=Ma.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?gt:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];t.specularIntensity=void 0!==r.specularFactor?r.specularFactor:1,void 0!==r.specularTexture&&s.push(i.assignTexture(t,"specularIntensityMap",r.specularTexture));const o=r.specularColorFactor||[1,1,1];return t.specularColor=(new q).setRGB(o[0],o[1],o[2],Ee),void 0!==r.specularColorTexture&&s.push(i.assignTexture(t,"specularColorMap",r.specularColorTexture,X)),Promise.all(s)}},Ua=class{constructor(e){this.parser=e,this.name=Ma.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?gt:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return t.bumpScale=void 0!==r.bumpFactor?r.bumpFactor:1,void 0!==r.bumpTexture&&s.push(i.assignTexture(t,"bumpMap",r.bumpTexture)),Promise.all(s)}},Ba=class{constructor(e){this.parser=e,this.name=Ma.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?gt:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return void 0!==r.anisotropyStrength&&(t.anisotropy=r.anisotropyStrength),void 0!==r.anisotropyRotation&&(t.anisotropyRotation=r.anisotropyRotation),void 0!==r.anisotropyTexture&&s.push(i.assignTexture(t,"anisotropyMap",r.anisotropyTexture)),Promise.all(s)}},za=class{constructor(e){this.parser=e,this.name=Ma.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,n=i.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const s=n.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,r)}},Na=class{constructor(e){this.parser=e,this.name=Ma.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,s=n.textures[e];if(!s.extensions||!s.extensions[t])return null;const r=s.extensions[t],o=n.images[r.source];let a=i.textureLoader;if(o.uri){const e=i.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then((function(s){if(s)return i.loadTextureImage(e,r.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}},ja=class{constructor(e){this.parser=e,this.name=Ma.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,s=n.textures[e];if(!s.extensions||!s.extensions[t])return null;const r=s.extensions[t],o=n.images[r.source];let a=i.textureLoader;if(o.uri){const e=i.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then((function(s){if(s)return i.loadTextureImage(e,r.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}},Ha=class{constructor(e){this.name=Ma.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const e=i.extensions[this.name],n=this.parser.getDependency("buffer",e.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return n.then((function(t){const i=e.byteOffset||0,n=e.byteLength||0,r=e.count,o=e.byteStride,a=new Uint8Array(t,i,n);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(r,o,a,e.mode,e.filter).then((function(e){return e.buffer})):s.ready.then((function(){const t=new ArrayBuffer(r*o);return s.decodeGltfBuffer(new Uint8Array(t),r,o,a,e.mode,e.filter),t}))}))}return null}},Ga=class{constructor(e){this.name=Ma.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||void 0===i.mesh)return null;const n=t.meshes[i.mesh];for(const a of n.primitives)if(a.mode!==el.TRIANGLES&&a.mode!==el.TRIANGLE_STRIP&&a.mode!==el.TRIANGLE_FAN&&void 0!==a.mode)return null;const s=i.extensions[this.name].attributes,r=[],o={};for(const a in s)r.push(this.parser.getDependency("accessor",s[a]).then((e=>(o[a]=e,o[a]))));return r.length<1?null:(r.push(this.parser.createNodeMesh(e)),Promise.all(r).then((e=>{const t=e.pop(),i=t.isGroup?t.children:[t],n=e[0].count,s=[];for(const r of i){const e=new Ne,t=new ie,i=new Ve,a=new ie(1,1,1),l=new at(r.geometry,r.material,n);for(let s=0;s<n;s++)o.TRANSLATION&&t.fromBufferAttribute(o.TRANSLATION,s),o.ROTATION&&i.fromBufferAttribute(o.ROTATION,s),o.SCALE&&a.fromBufferAttribute(o.SCALE,s),l.setMatrixAt(s,e.compose(t,i,a));for(const n in o)if("_COLOR_0"===n){const e=o[n];l.instanceColor=new xt(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==n&&"ROTATION"!==n&&"SCALE"!==n&&r.geometry.setAttribute(n,o[n]);Z.prototype.copy.call(l,r),this.parser.assignFinalMaterial(l),s.push(l)}return t.isGroup?(t.clear(),t.add(...s),t):s[0]})))}};const Va="glTF",Wa=1313821514,Ka=5130562;let Xa=class{constructor(e){this.name=Ma.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Va)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,s=new DataView(e,12);let r=0;for(;r<n;){const t=s.getUint32(r,!0);r+=4;const n=s.getUint32(r,!0);if(r+=4,n===Wa){const n=new Uint8Array(e,12+r,t);this.content=i.decode(n)}else if(n===Ka){const i=12+r;this.body=e.slice(i,i+t)}r+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}},qa=class{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ma.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,n=this.dracoLoader,s=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,o={},a={},l={};for(const c in r){const e=rl[c]||c.toLowerCase();o[e]=r[c]}for(const c in e.attributes){const t=rl[c]||c.toLowerCase();if(void 0!==r[c]){const n=i.accessors[e.attributes[c]],s=tl[n.componentType];l[t]=s.name,a[t]=!0===n.normalized}}return t.getDependency("bufferView",s).then((function(e){return new Promise((function(t,i){n.decodeDracoFile(e,(function(e){for(const t in e.attributes){const i=e.attributes[t],n=a[t];void 0!==n&&(i.normalized=n)}t(e)}),o,l,Ee,i)}))}))}},Ya=class{constructor(){this.name=Ma.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(void 0===t.texCoord||t.texCoord===e.channel)&&void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}},Za=class{constructor(){this.name=Ma.KHR_MESH_QUANTIZATION}},$a=class extends qt{constructor(e,t,i,n){super(e,t,i,n)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,s=e*n*3+n;for(let r=0;r!==n;r++)t[r]=i[s+r];return t}interpolate_(e,t,i,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,c=n-t,h=(i-t)/c,u=h*h,d=u*h,p=e*l,m=p-l,f=-2*d+3*u,g=d-u,v=1-f,_=g-u+h;for(let y=0;y!==o;y++){const e=r[m+y+o],t=r[m+y+a]*c,i=r[p+y+o],n=r[p+y]*c;s[y]=v*e+_*t+f*i+g*n}return s}};const Qa=new Ve;let Ja=class extends $a{interpolate_(e,t,i,n){const s=super.interpolate_(e,t,i,n);return Qa.fromArray(s).normalize().toArray(s),s}};const el={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},tl={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},il={9728:ye,9729:pe,9984:St,9985:Mt,9986:At,9987:Tt},nl={33071:Ct,33648:Pt,10497:Et},sl={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},rl={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ol={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},al={CUBICSPLINE:void 0,LINEAR:Bt,STEP:Ut},ll="OPAQUE",cl="MASK",hl="BLEND";function ul(e,t,i){for(const n in i.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=i.extensions[n])}function dl(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function pl(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let i=0,n=t.weights.length;i<n;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){const i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(let t=0,n=i.length;t<n;t++)e.morphTargetDictionary[i[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ml(e){let t;const i=e.extensions&&e.extensions[Ma.KHR_DRACO_MESH_COMPRESSION];if(t=i?"draco:"+i.bufferView+":"+i.indices+":"+fl(i.attributes):e.indices+":"+fl(e.attributes)+":"+e.mode,void 0!==e.targets)for(let n=0,s=e.targets.length;n<s;n++)t+=":"+fl(e.targets[n]);return t}function fl(e){let t="";const i=Object.keys(e).sort();for(let n=0,s=i.length;n<s;n++)t+=i[n]+":"+e[i[n]]+";";return t}function gl(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const vl=new Ne;let _l=class{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Aa,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,n=-1,s=!1,r=-1;if(typeof navigator<"u"){const e=navigator.userAgent;i=!0===/^((?!chrome|android).)*safari/i.test(e);const t=e.match(/Version\/(\d+)/);n=i&&t?parseInt(t[1],10):-1,s=e.indexOf("Firefox")>-1,r=s?e.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||i&&n<17||s&&r<98?this.textureLoader=new Oe(this.options.manager):this.textureLoader=new bt(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new rt(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,n=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])})).then((function(t){const r={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:i,userData:{}};return ul(s,r,n),dl(r,n),Promise.all(i._invokeAll((function(e){return e.afterRoot&&e.afterRoot(r)}))).then((function(){for(const e of r.scenes)e.updateMatrixWorld();e(r)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let n=0,s=t.length;n<s;n++){const i=t[n].joints;for(let t=0,n=i.length;t<n;t++)e[i[t]].isBone=!0}for(let n=0,s=e.length;n<s;n++){const t=e[n];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(i[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const n=i.clone(),s=(e,t)=>{const i=this.associations.get(e);null!=i&&this.associations.set(t,i);for(const[n,r]of e.children.entries())s(r,t.children[n])};return s(i,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const n=e(t[i]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let n=0;n<t.length;n++){const s=e(t[n]);s&&i.push(s)}return i}getDependency(e,t){const i=e+":"+t;let n=this.cache.get(i);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":n=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":n=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne((function(i){return i!=this&&i.getDependency&&i.getDependency(e,t)})),!n)throw new Error("Unknown type: "+e)}this.cache.add(i,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map((function(t,n){return i.getDependency(e,n)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[Ma.KHR_BINARY_GLTF].body);const n=this.options;return new Promise((function(e,s){i.load(st.resolveURL(t.uri,n.path),e,void 0,(function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const i=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+i)}))}loadAccessor(e){const t=this,i=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse){const e=sl[n.type],t=tl[n.componentType],i=!0===n.normalized,s=new t(n.count*e);return Promise.resolve(new $(s,e,i))}const s=[];return void 0!==n.bufferView?s.push(this.getDependency("bufferView",n.bufferView)):s.push(null),void 0!==n.sparse&&(s.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(s).then((function(e){const s=e[0],r=sl[n.type],o=tl[n.componentType],a=o.BYTES_PER_ELEMENT,l=a*r,c=n.byteOffset||0,h=void 0!==n.bufferView?i.bufferViews[n.bufferView].byteStride:void 0,u=!0===n.normalized;let d,p;if(h&&h!==l){const e=Math.floor(c/h),i="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+e+":"+n.count;let l=t.cache.get(i);l||(d=new o(s,e*h,n.count*h/a),l=new wt(d,h/a),t.cache.add(i,l)),p=new Nt(l,r,c%h/a,u)}else d=null===s?new o(n.count*r):new o(s,c,n.count*r),p=new $(d,r,u);if(void 0!==n.sparse){const t=sl.SCALAR,i=tl[n.sparse.indices.componentType],a=n.sparse.indices.byteOffset||0,l=n.sparse.values.byteOffset||0,c=new i(e[1],a,n.sparse.count*t),h=new o(e[2],l,n.sparse.count*r);null!==s&&(p=new $(p.array.slice(),p.itemSize,p.normalized)),p.normalized=!1;for(let e=0,n=c.length;e<n;e++){const t=c[e];if(p.setX(t,h[e*r]),r>=2&&p.setY(t,h[e*r+1]),r>=3&&p.setZ(t,h[e*r+2]),r>=4&&p.setW(t,h[e*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}p.normalized=u}return p}))}loadTexture(e){const t=this.json,i=this.options,n=t.textures[e].source,s=t.images[n];let r=this.textureLoader;if(s.uri){const e=i.manager.getHandler(s.uri);null!==e&&(r=e)}return this.loadTextureImage(e,n,r)}loadTextureImage(e,t,i){const n=this,s=this.json,r=s.textures[e],o=s.images[t],a=(o.uri||o.bufferView)+":"+r.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(t,i).then((function(t){t.flipY=!1,t.name=r.name||o.name||"",""===t.name&&"string"==typeof o.uri&&!1===o.uri.startsWith("data:image/")&&(t.name=o.uri);const i=(s.samplers||{})[r.sampler]||{};return t.magFilter=il[i.magFilter]||pe,t.minFilter=il[i.minFilter]||Tt,t.wrapS=nl[i.wrapS]||Et,t.wrapT=nl[i.wrapT]||Et,t.generateMipmaps=!t.isCompressedTexture&&t.minFilter!==ye&&t.minFilter!==pe,n.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[a]=l,l}loadImageSource(e,t){const i=this.json,n=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const s=i.images[e],r=self.URL||self.webkitURL;let o=s.uri||"",a=!1;if(void 0!==s.bufferView)o=this.getDependency("bufferView",s.bufferView).then((function(e){a=!0;const t=new Blob([e],{type:s.mimeType});return o=r.createObjectURL(t),o}));else if(void 0===s.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const l=Promise.resolve(o).then((function(e){return new Promise((function(i,s){let r=i;!0===t.isImageBitmapLoader&&(r=function(e){const t=new Ae(e);t.needsUpdate=!0,i(t)}),t.load(st.resolveURL(e,n.path),r,void 0,s)}))})).then((function(e){return!0===a&&r.revokeObjectURL(o),dl(e,s),e.userData.mimeType=s.mimeType||((t=s.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":t.search(/\.ktx2($|\?)/i)>0||0===t.search(/^data\:image\/ktx2/)?"image/ktx2":"image/png"),e;var t})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),e}));return this.sourceCache[e]=l,l}assignTexture(e,t,i,n){const s=this;return this.getDependency("texture",i.index).then((function(r){if(!r)return null;if(void 0!==i.texCoord&&i.texCoord>0&&((r=r.clone()).channel=i.texCoord),s.extensions[Ma.KHR_TEXTURE_TRANSFORM]){const e=void 0!==i.extensions?i.extensions[Ma.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=s.associations.get(r);r=s.extensions[Ma.KHR_TEXTURE_TRANSFORM].extendTexture(r,e),s.associations.set(r,t)}}return void 0!==n&&(r.colorSpace=n),e[t]=r,r}))}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const n=void 0===t.attributes.tangent,s=void 0!==t.attributes.color,r=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+i.uuid;let t=this.cache.get(e);t||(t=new je,Te.prototype.copy.call(t,i),t.color.copy(i.color),t.map=i.map,t.sizeAttenuation=!1,this.cache.add(e,t)),i=t}else if(e.isLine){const e="LineBasicMaterial:"+i.uuid;let t=this.cache.get(e);t||(t=new ct,Te.prototype.copy.call(t,i),t.color.copy(i.color),t.map=i.map,this.cache.add(e,t)),i=t}if(n||s||r){let e="ClonedMaterial:"+i.uuid+":";n&&(e+="derivative-tangents:"),s&&(e+="vertex-colors:"),r&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=i.clone(),s&&(t.vertexColors=!0),r&&(t.flatShading=!0),n&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(i))),i=t}e.material=i}getMaterialType(){return $e}loadMaterial(e){const t=this,i=this.json,n=this.extensions,s=i.materials[e];let r;const o={},a=[];if((s.extensions||{})[Ma.KHR_MATERIALS_UNLIT]){const e=n[Ma.KHR_MATERIALS_UNLIT];r=e.getMaterialType(),a.push(e.extendParams(o,s,t))}else{const i=s.pbrMetallicRoughness||{};if(o.color=new q(1,1,1),o.opacity=1,Array.isArray(i.baseColorFactor)){const e=i.baseColorFactor;o.color.setRGB(e[0],e[1],e[2],Ee),o.opacity=e[3]}void 0!==i.baseColorTexture&&a.push(t.assignTexture(o,"map",i.baseColorTexture,X)),o.metalness=void 0!==i.metallicFactor?i.metallicFactor:1,o.roughness=void 0!==i.roughnessFactor?i.roughnessFactor:1,void 0!==i.metallicRoughnessTexture&&(a.push(t.assignTexture(o,"metalnessMap",i.metallicRoughnessTexture)),a.push(t.assignTexture(o,"roughnessMap",i.metallicRoughnessTexture))),r=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),a.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,o)}))))}!0===s.doubleSided&&(o.side=re);const l=s.alphaMode||ll;if(l===hl?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,l===cl&&(o.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&r!==se&&(a.push(t.assignTexture(o,"normalMap",s.normalTexture)),o.normalScale=new te(1,1),void 0!==s.normalTexture.scale)){const e=s.normalTexture.scale;o.normalScale.set(e,e)}if(void 0!==s.occlusionTexture&&r!==se&&(a.push(t.assignTexture(o,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(o.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&r!==se){const e=s.emissiveFactor;o.emissive=(new q).setRGB(e[0],e[1],e[2],Ee)}return void 0!==s.emissiveTexture&&r!==se&&a.push(t.assignTexture(o,"emissiveMap",s.emissiveTexture,X)),Promise.all(a).then((function(){const i=new r(o);return s.name&&(i.name=s.name),dl(i,s),t.associations.set(i,{materials:e}),s.extensions&&ul(n,i,s),i}))}createUniqueName(e){const t=Rt.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,n=this.primitiveCache;function s(e){return i[Ma.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(i){return yl(i,e,t)}))}const r=[];for(let o=0,a=e.length;o<a;o++){const i=e[o],a=ml(i),l=n[a];if(l)r.push(l.promise);else{let e;e=i.extensions&&i.extensions[Ma.KHR_DRACO_MESH_COMPRESSION]?s(i):yl(new Me,i,t),n[a]={primitive:i,promise:e},r.push(e)}}return Promise.all(r)}loadMesh(e){const t=this,i=this.json,n=this.extensions,s=i.meshes[e],r=s.primitives,o=[];for(let l=0,c=r.length;l<c;l++){const e=void 0===r[l].material?(void 0===(a=this.cache).DefaultMaterial&&(a.DefaultMaterial=new $e({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ve})),a.DefaultMaterial):this.getDependency("material",r[l].material);o.push(e)}var a;return o.push(t.loadGeometries(r)),Promise.all(o).then((function(i){const o=i.slice(0,i.length-1),a=i[i.length-1],l=[];for(let h=0,u=a.length;h<u;h++){const i=a[h],c=r[h];let u;const d=o[h];if(c.mode===el.TRIANGLES||c.mode===el.TRIANGLE_STRIP||c.mode===el.TRIANGLE_FAN||void 0===c.mode)u=!0===s.isSkinnedMesh?new Lt(i,d):new oe(i,d),!0===u.isSkinnedMesh&&u.normalizeSkinWeights(),c.mode===el.TRIANGLE_STRIP?u.geometry=wa(u.geometry,Xt):c.mode===el.TRIANGLE_FAN&&(u.geometry=wa(u.geometry,Kt));else if(c.mode===el.LINES)u=new lt(i,d);else if(c.mode===el.LINE_STRIP)u=new Dt(i,d);else if(c.mode===el.LINE_LOOP)u=new Ot(i,d);else{if(c.mode!==el.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);u=new He(i,d)}Object.keys(u.geometry.morphAttributes).length>0&&pl(u,s),u.name=t.createUniqueName(s.name||"mesh_"+e),dl(u,s),c.extensions&&ul(n,u,c),t.assignFinalMaterial(u),l.push(u)}for(let n=0,s=l.length;n<s;n++)t.associations.set(l[n],{meshes:e,primitives:n});if(1===l.length)return s.extensions&&ul(n,l[0],s),l[0];const c=new Ie;s.extensions&&ul(n,c,s),t.associations.set(c,{meshes:e});for(let e=0,t=l.length;e<t;e++)c.add(l[e]);return c}))}loadCamera(e){let t;const i=this.json.cameras[e],n=i[i.type];if(n)return"perspective"===i.type?t=new j(Y.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===i.type&&(t=new Le(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),dl(t,i),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],i=[];for(let n=0,s=t.joints.length;n<s;n++)i.push(this._loadNodeShallow(t.joints[n]));return void 0!==t.inverseBindMatrices?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then((function(e){const i=e.pop(),n=e,s=[],r=[];for(let o=0,a=n.length;o<a;o++){const e=n[o];if(e){s.push(e);const t=new Ne;null!==i&&t.fromArray(i.array,16*o),r.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}return new kt(s,r)}))}loadAnimation(e){const t=this.json,i=this,n=t.animations[e],s=n.name?n.name:"animation_"+e,r=[],o=[],a=[],l=[],c=[];for(let h=0,u=n.channels.length;h<u;h++){const e=n.channels[h],t=n.samplers[e.sampler],i=e.target,s=i.node,u=void 0!==n.parameters?n.parameters[t.input]:t.input,d=void 0!==n.parameters?n.parameters[t.output]:t.output;void 0!==i.node&&(r.push(this.getDependency("node",s)),o.push(this.getDependency("accessor",u)),a.push(this.getDependency("accessor",d)),l.push(t),c.push(i))}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c)]).then((function(e){const t=e[0],n=e[1],r=e[2],o=e[3],a=e[4],l=[];for(let s=0,c=t.length;s<c;s++){const e=t[s],c=n[s],h=r[s],u=o[s],d=a[s];if(void 0===e)continue;e.updateMatrix&&e.updateMatrix();const p=i._createAnimationTracks(e,c,h,u,d);if(p)for(let t=0;t<p.length;t++)l.push(p[t])}return new It(s,void 0,l)}))}createNodeMesh(e){const t=this.json,i=this,n=t.nodes[e];return void 0===n.mesh?null:i.getDependency("mesh",n.mesh).then((function(e){const t=i._getNodeRef(i.meshCache,n.mesh,e);return void 0!==n.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,i=n.weights.length;t<i;t++)e.morphTargetInfluences[t]=n.weights[t]})),t}))}loadNode(e){const t=this,i=this.json.nodes[e],n=t._loadNodeShallow(e),s=[],r=i.children||[];for(let a=0,l=r.length;a<l;a++)s.push(t.getDependency("node",r[a]));const o=void 0===i.skin?Promise.resolve(null):t.getDependency("skin",i.skin);return Promise.all([n,Promise.all(s),o]).then((function(e){const t=e[0],i=e[1],n=e[2];null!==n&&t.traverse((function(e){e.isSkinnedMesh&&e.bind(n,vl)}));for(let s=0,r=i.length;s<r;s++)t.add(i[s]);return t}))}_loadNodeShallow(e){const t=this.json,i=this.extensions,n=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const s=t.nodes[e],r=s.name?n.createUniqueName(s.name):"",o=[],a=n._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return a&&o.push(a),void 0!==s.camera&&o.push(n.getDependency("camera",s.camera).then((function(e){return n._getNodeRef(n.cameraCache,s.camera,e)}))),n._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){o.push(e)})),this.nodeCache[e]=Promise.all(o).then((function(t){let o;if(o=!0===s.isBone?new Ft:t.length>1?new Ie:1===t.length?t[0]:new Z,o!==t[0])for(let e=0,i=t.length;e<i;e++)o.add(t[e]);if(s.name&&(o.userData.name=s.name,o.name=r),dl(o,s),s.extensions&&ul(i,o,s),void 0!==s.matrix){const e=new Ne;e.fromArray(s.matrix),o.applyMatrix4(e)}else void 0!==s.translation&&o.position.fromArray(s.translation),void 0!==s.rotation&&o.quaternion.fromArray(s.rotation),void 0!==s.scale&&o.scale.fromArray(s.scale);return n.associations.has(o)||n.associations.set(o,{}),n.associations.get(o).nodes=e,o})),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],n=this,s=new Ie;i.name&&(s.name=n.createUniqueName(i.name)),dl(s,i),i.extensions&&ul(t,s,i);const r=i.nodes||[],o=[];for(let a=0,l=r.length;a<l;a++)o.push(n.getDependency("node",r[a]));return Promise.all(o).then((function(e){for(let t=0,i=e.length;t<i;t++)s.add(e[t]);return n.associations=(e=>{const t=new Map;for(const[i,s]of n.associations)(i instanceof Te||i instanceof Ae)&&t.set(i,s);return e.traverse((e=>{const i=n.associations.get(e);null!=i&&t.set(e,i)})),t})(s),s}))}_createAnimationTracks(e,t,i,n,s){const r=[],o=e.name?e.name:e.uuid,a=[];let l;switch(ol[s.path]===ol.weights?e.traverse((function(e){e.morphTargetInfluences&&a.push(e.name?e.name:e.uuid)})):a.push(o),ol[s.path]){case ol.weights:l=Ht;break;case ol.rotation:l=Gt;break;case ol.position:case ol.scale:l=jt;break;default:if(1===i.itemSize)l=Ht;else l=jt}const c=void 0!==n.interpolation?al[n.interpolation]:Bt,h=this._getArrayFromAccessor(i);for(let u=0,d=a.length;u<d;u++){const e=new l(a[u]+"."+ol[s.path],t.array,h,c);"CUBICSPLINE"===n.interpolation&&this._createCubicSplineTrackInterpolant(e),r.push(e)}return r}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=gl(t.constructor),i=new Float32Array(t.length);for(let n=0,s=t.length;n<s;n++)i[n]=t[n]*e;t=i}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof Gt?Ja:$a)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}};function yl(e,t,i){const n=t.attributes,s=[];function r(t,n){return i.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(const o in n){const t=rl[o]||o.toLowerCase();t in e.attributes||s.push(r(n[o],t))}if(void 0!==t.indices&&!e.index){const n=i.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));s.push(n)}return Vt.workingColorSpace!==Ee&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Vt.workingColorSpace}" not supported.`),dl(e,t),function(e,t,i){const n=t.attributes,s=new ft;if(void 0===n.POSITION)return;{const e=i.json.accessors[n.POSITION],t=e.min,r=e.max;if(void 0===t||void 0===r)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(s.set(new ie(t[0],t[1],t[2]),new ie(r[0],r[1],r[2])),e.normalized){const t=gl(tl[e.componentType]);s.min.multiplyScalar(t),s.max.multiplyScalar(t)}}const r=t.targets;if(void 0!==r){const e=new ie,t=new ie;for(let n=0,s=r.length;n<s;n++){const s=r[n];if(void 0!==s.POSITION){const n=i.json.accessors[s.POSITION],r=n.min,o=n.max;if(void 0!==r&&void 0!==o){if(t.setX(Math.max(Math.abs(r[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(r[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(r[2]),Math.abs(o[2]))),n.normalized){const e=gl(tl[n.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(e)}e.boundingBox=s;const o=new Ye;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,e.boundingSphere=o}(e,t,i),Promise.all(s).then((function(){return void 0!==t.targets?function(e,t,i){let n=!1,s=!1,r=!1;for(let c=0,h=t.length;c<h;c++){const e=t[c];if(void 0!==e.POSITION&&(n=!0),void 0!==e.NORMAL&&(s=!0),void 0!==e.COLOR_0&&(r=!0),n&&s&&r)break}if(!n&&!s&&!r)return Promise.resolve(e);const o=[],a=[],l=[];for(let c=0,h=t.length;c<h;c++){const h=t[c];if(n){const t=void 0!==h.POSITION?i.getDependency("accessor",h.POSITION):e.attributes.position;o.push(t)}if(s){const t=void 0!==h.NORMAL?i.getDependency("accessor",h.NORMAL):e.attributes.normal;a.push(t)}if(r){const t=void 0!==h.COLOR_0?i.getDependency("accessor",h.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then((function(t){const i=t[0],o=t[1],a=t[2];return n&&(e.morphAttributes.position=i),s&&(e.morphAttributes.normal=o),r&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,i):e}))}class xl extends ba{constructor(e=ot){super(),this.manager=e,this.adjustmentTransform=new Ne}parse(e){const t=super.parse(e),i=t.glbBytes.slice().buffer;return new Promise(((e,n)=>{const s=this.manager,r=this.fetchOptions,o=s.getHandler("path.gltf")||new Ta(s);"include"===r.credentials&&"cors"===r.mode&&o.setCrossOrigin("use-credentials"),"credentials"in r&&o.setWithCredentials("include"===r.credentials),r.headers&&o.setRequestHeader(r.headers);let a=this.workingPath;!/[\\/]$/.test(a)&&a.length&&(a+="/");const l=this.adjustmentTransform;o.parse(i,a,(i=>{const{batchTable:n,featureTable:s}=t,{scene:r}=i,o=s.getData("RTC_CENTER",1,"FLOAT","VEC3");o&&(r.position.x+=o[0],r.position.y+=o[1],r.position.z+=o[2]),i.scene.updateMatrix(),i.scene.matrix.multiply(l),i.scene.matrix.decompose(i.scene.position,i.scene.quaternion,i.scene.scale),i.batchTable=n,i.featureTable=s,r.batchTable=n,r.featureTable=s,e(i)}),n)}))}}class bl extends ya{parse(e){const t=new DataView(e),i=xa(t);console.assert("pnts"===i);const n=t.getUint32(4,!0);console.assert(1===n);const s=t.getUint32(8,!0);console.assert(s===e.byteLength);const r=t.getUint32(12,!0),o=t.getUint32(16,!0),a=t.getUint32(20,!0),l=t.getUint32(24,!0),c=e.slice(28,28+r+o),h=new ga(c,0,r,o),u=28+r+o,d=e.slice(u,u+a+l),p=new _a(d,h.getData("BATCH_LENGTH")||h.getData("POINTS_LENGTH"),0,a,l);return Promise.resolve({version:n,featureTable:h,batchTable:p})}}function wl(e){const t=e>>11,i=e>>5&63,n=31&e;return[Math.round(t/31*255),Math.round(i/63*255),Math.round(n/31*255)]}const Tl=new te;function Al(e,t,i=new ie){Tl.set(e,t).divideScalar(256).multiplyScalar(2).subScalar(1),i.set(Tl.x,Tl.y,1-Math.abs(Tl.x)-Math.abs(Tl.y));const n=Y.clamp(-i.z,0,1);return i.x>=0?i.setX(i.x-n):i.setX(i.x+n),i.y>=0?i.setY(i.y-n):i.setY(i.y+n),i.normalize(),i}const Ml={RGB:"color",POSITION:"position"};class Sl extends bl{constructor(e=ot){super(),this.manager=e}parse(e){return super.parse(e).then((async e=>{const{featureTable:t,batchTable:i}=e,n=new je,s=t.header.extensions,r=new ie;let o;if(s&&s["3DTILES_draco_point_compression"]){const{byteOffset:e,byteLength:i,properties:r}=s["3DTILES_draco_point_compression"],a=this.manager.getHandler("draco.drc");if(null==a)throw new Error("PNTSLoader: dracoLoader not available.");const l={};for(const t in r)if(t in Ml&&t in r){l[Ml[t]]=r[t]}const c={attributeIDs:l,attributeTypes:{position:"Float32Array",color:"Uint8Array"},useUniqueIDs:!0},h=t.getBuffer(e,i);o=await a.decodeGeometry(h,c),o.attributes.color&&(n.vertexColors=!0)}else{const e=t.getData("POINTS_LENGTH"),i=t.getData("POSITION",e,"FLOAT","VEC3"),s=t.getData("NORMAL",e,"FLOAT","VEC3"),a=t.getData("NORMAL",e,"UNSIGNED_BYTE","VEC2"),l=t.getData("RGB",e,"UNSIGNED_BYTE","VEC3"),c=t.getData("RGBA",e,"UNSIGNED_BYTE","VEC4"),h=t.getData("RGB565",e,"UNSIGNED_SHORT","SCALAR"),u=t.getData("CONSTANT_RGBA",e,"UNSIGNED_BYTE","VEC4"),d=t.getData("POSITION_QUANTIZED",e,"UNSIGNED_SHORT","VEC3"),p=t.getData("QUANTIZED_VOLUME_SCALE",e,"FLOAT","VEC3"),m=t.getData("QUANTIZED_VOLUME_OFFSET",e,"FLOAT","VEC3");if(o=new Me,d){const t=new Float32Array(3*e);for(let i=0;i<e;i++)for(let e=0;e<3;e++){const n=3*i+e;t[n]=d[n]/65535*p[e]}r.x=m[0],r.y=m[1],r.z=m[2],o.setAttribute("position",new $(t,3,!1))}else o.setAttribute("position",new $(i,3,!1));if(null!==s)o.setAttribute("normal",new $(s,3,!1));else if(null!==a){const t=new Float32Array(3*e),i=new ie;for(let n=0;n<e;n++){const e=Al(a[2*n],a[2*n+1],i);t[3*n]=e.x,t[3*n+1]=e.y,t[3*n+2]=e.z}o.setAttribute("normal",new $(t,3,!1))}if(null!==c)o.setAttribute("color",new $(c,4,!0)),n.vertexColors=!0,n.transparent=!0,n.depthWrite=!1;else if(null!==l)o.setAttribute("color",new $(l,3,!0)),n.vertexColors=!0;else if(null!==h){const t=new Uint8Array(3*e);for(let i=0;i<e;i++){const e=wl(h[i]);for(let n=0;n<3;n++){t[3*i+n]=e[n]}}o.setAttribute("color",new $(t,3,!0)),n.vertexColors=!0}else if(null!==u){const e=new q(u[0],u[1],u[2]);n.color=e;const t=u[3]/255;t<1&&(n.opacity=t,n.transparent=!0,n.depthWrite=!1)}}const a=new He(o,n);a.position.copy(r),e.scene=a,e.scene.featureTable=t,e.scene.batchTable=i;const l=t.getData("RTC_CENTER",1,"FLOAT","VEC3");return l&&(e.scene.position.x+=l[0],e.scene.position.y+=l[1],e.scene.position.z+=l[2]),e}))}}class El extends ya{parse(e){const t=new DataView(e),i=xa(t);console.assert("i3dm"===i);const n=t.getUint32(4,!0);console.assert(1===n);const s=t.getUint32(8,!0);console.assert(s===e.byteLength);const r=t.getUint32(12,!0),o=t.getUint32(16,!0),a=t.getUint32(20,!0),l=t.getUint32(24,!0),c=t.getUint32(28,!0),h=e.slice(32,32+r+o),u=new ga(h,0,r,o),d=32+r+o,p=e.slice(d,d+a+l),m=new _a(p,u.getData("INSTANCES_LENGTH"),0,a,l),f=d+a+l,g=new Uint8Array(e,f,s-f);let v=null,_=null,y=null;if(c)v=g,_=Promise.resolve();else{const e=this.resolveExternalURL(ma(g)),t=e.split(/[\\/]/g);t.pop(),y=t.join("/"),_=fetch(e,this.fetchOptions).then((t=>{if(!t.ok)throw new Error(`I3DMLoaderBase : Failed to load file "${e}" with status ${t.status} : ${t.statusText}`);return t.arrayBuffer()})).then((e=>{v=new Uint8Array(e)}))}return _.then((()=>({version:n,featureTable:u,batchTable:m,glbBytes:v,gltfWorkingPath:y})))}}new ie;const Pl=new tt,Cl=new ie,Rl=new ie,Ll=new ie,Dl=new Ne,Ol=new Ne,kl=new Ne,Il=new Ye,Fl=new ze,Ul=new ie,Bl=new ie,zl=new ie,Nl=new ie,jl=new Ge;class Hl{constructor(e=1,t=1,i=1){this.name="",this.radius=new ie(e,t,i)}intersectRay(e,t){return Dl.makeScale(...this.radius).invert(),Il.center.set(0,0,0),Il.radius=1,jl.copy(e).applyMatrix4(Dl),jl.intersectSphere(Il,t)?(Dl.makeScale(...this.radius),t.applyMatrix4(Dl),t):null}getEastNorthUpFrame(e,t,i,n){return i.isMatrix4&&(n=i,i=0,console.warn('Ellipsoid: The signature for "getEastNorthUpFrame" has changed.')),this.getEastNorthUpAxes(e,t,Ul,Bl,zl),this.getCartographicToPosition(e,t,i,Nl),n.makeBasis(Ul,Bl,zl).setPosition(Nl)}getOrientedEastNorthUpFrame(e,t,i,n,s,r,o){return this.getObjectFrame(e,t,i,n,s,r,o,0)}getObjectFrame(e,t,i,n,s,r,o,a=2){return this.getEastNorthUpFrame(e,t,i,Dl),Fl.set(s,r,-n,"ZXY"),o.makeRotationFromEuler(Fl).premultiply(Dl),1===a?(Fl.set(Math.PI/2,0,0,"XYZ"),Ol.makeRotationFromEuler(Fl),o.multiply(Ol)):2===a&&(Fl.set(-Math.PI/2,0,Math.PI,"XYZ"),Ol.makeRotationFromEuler(Fl),o.multiply(Ol)),o}getCartographicFromObjectFrame(e,t,i=2){return 1===i?(Fl.set(-Math.PI/2,0,0,"XYZ"),Ol.makeRotationFromEuler(Fl).premultiply(e)):2===i?(Fl.set(-Math.PI/2,0,Math.PI,"XYZ"),Ol.makeRotationFromEuler(Fl).premultiply(e)):Ol.copy(e),Nl.setFromMatrixPosition(Ol),this.getPositionToCartographic(Nl,t),this.getEastNorthUpFrame(t.lat,t.lon,0,Dl).invert(),Ol.premultiply(Dl),Fl.setFromRotationMatrix(Ol,"ZXY"),t.azimuth=-Fl.z,t.elevation=Fl.x,t.roll=Fl.y,t}getEastNorthUpAxes(e,t,i,n,s,r=Nl){this.getCartographicToPosition(e,t,0,r),this.getCartographicToNormal(e,t,s),i.set(-r.y,r.x,0).normalize(),n.crossVectors(s,i).normalize()}getAzElRollFromRotationMatrix(e,t,i,n,s=0){return console.warn('Ellipsoid: "getAzElRollFromRotationMatrix" is deprecated. Use "getCartographicFromObjectFrame", instead.'),this.getCartographicToPosition(e,t,0,Nl),kl.copy(i).setPosition(Nl),this.getCartographicFromObjectFrame(kl,n,s),delete n.height,delete n.lat,delete n.lon,n}getRotationMatrixFromAzElRoll(e,t,i,n,s,r,o=0){return console.warn('Ellipsoid: "getRotationMatrixFromAzElRoll" function has been deprecated. Use "getObjectFrame", instead.'),this.getObjectFrame(e,t,0,i,n,s,r,o),r.setPosition(0,0,0),r}getFrame(e,t,i,n,s,r,o,a=0){return console.warn('Ellipsoid: "getFrame" function has been deprecated. Use "getObjectFrame", instead.'),this.getObjectFrame(e,t,r,i,n,s,o,a)}getCartographicToPosition(e,t,i,n){this.getCartographicToNormal(e,t,Cl);const s=this.radius;Rl.copy(Cl),Rl.x*=s.x**2,Rl.y*=s.y**2,Rl.z*=s.z**2;const r=Math.sqrt(Cl.dot(Rl));return Rl.divideScalar(r),n.copy(Rl).addScaledVector(Cl,i)}getPositionToCartographic(e,t){this.getPositionToSurfacePoint(e,Rl),this.getPositionToNormal(e,Cl);const i=Ll.subVectors(e,Rl);return t.lon=Math.atan2(Cl.y,Cl.x),t.lat=Math.asin(Cl.z),t.height=Math.sign(i.dot(e))*i.length(),t}getCartographicToNormal(e,t,i){return Pl.set(1,-e+Math.PI/2,t),i.setFromSpherical(Pl).normalize(),function(e){const{x:t,y:i,z:n}=e;e.x=n,e.y=t,e.z=i}(i),i}getPositionToNormal(e,t){const i=this.radius;return t.copy(e),t.x/=i.x**2,t.y/=i.y**2,t.z/=i.z**2,t.normalize(),t}getPositionToSurfacePoint(e,t){const i=this.radius,n=1/i.x**2,s=1/i.y**2,r=1/i.z**2,o=e.x*e.x*n,a=e.y*e.y*s,l=e.z*e.z*r,c=o+a+l,h=Math.sqrt(1/c),u=Rl.copy(e).multiplyScalar(h);if(c<.1)return isFinite(h)?t.copy(u):null;const d=Ll.set(u.x*n*2,u.y*s*2,u.z*r*2);let p,m,f,g,v,_,y,x,b,w,T,A=(1-h)*e.length()/(.5*d.length()),M=0;do{A-=M,f=1/(1+A*n),g=1/(1+A*s),v=1/(1+A*r),_=f*f,y=g*g,x=v*v,b=_*f,w=y*g,T=x*v,p=o*_+a*y+l*x-1,m=o*b*n+a*w*s+l*T*r;M=p/(-2*m)}while(Math.abs(p)>1e-12);return t.set(e.x*f,e.y*g,e.z*v)}calculateHorizonDistance(e,t){const i=this.calculateEffectiveRadius(e);return Math.sqrt(2*i*t+t**2)}calculateEffectiveRadius(e){const t=this.radius.x,i=1-this.radius.z**2/t**2,n=e*Y.DEG2RAD,s=Math.sin(n)**2;return t/Math.sqrt(1-i*s)}getPositionElevation(e){this.getPositionToSurfacePoint(e,Rl);const t=Ll.subVectors(e,Rl);return Math.sign(t.dot(e))*t.length()}copy(e){return this.radius.copy(e.radius),this}clone(){return(new this.constructor).copy(this)}}const Gl=new Hl(Yo,Yo,6356752.314245179);Gl.name="WGS84 Earth";const Vl=new ie,Wl=new ie,Kl=new ie,Xl=new ie,ql=new Ve,Yl=new ie,Zl=new Ne,$l=new Ne,Ql=new ie,Jl=new Ne,ec=new Ve,tc={};class ic extends El{constructor(e=ot){super(),this.manager=e,this.adjustmentTransform=new Ne,this.ellipsoid=Gl.clone()}resolveExternalURL(e){return this.manager.resolveURL(super.resolveExternalURL(e))}parse(e){return super.parse(e).then((e=>{const{featureTable:t,batchTable:i}=e,n=e.glbBytes.slice().buffer;return new Promise(((s,r)=>{const o=this.fetchOptions,a=this.manager,l=a.getHandler("path.gltf")||new Ta(a);"include"===o.credentials&&"cors"===o.mode&&l.setCrossOrigin("use-credentials"),"credentials"in o&&l.setWithCredentials("include"===o.credentials),o.headers&&l.setRequestHeader(o.headers);let c=e.gltfWorkingPath??this.workingPath;/[\\/]$/.test(c)||(c+="/");const h=this.adjustmentTransform;l.parse(n,c,(e=>{const n=t.getData("INSTANCES_LENGTH"),r=t.getData("POSITION",n,"FLOAT","VEC3"),o=t.getData("NORMAL_UP",n,"FLOAT","VEC3"),a=t.getData("NORMAL_RIGHT",n,"FLOAT","VEC3"),l=t.getData("SCALE_NON_UNIFORM",n,"FLOAT","VEC3"),c=t.getData("SCALE",n,"FLOAT","SCALAR"),u=t.getData("RTC_CENTER",1,"FLOAT","VEC3"),d=t.getData("EAST_NORTH_UP");["QUANTIZED_VOLUME_OFFSET","QUANTIZED_VOLUME_SCALE","POSITION_QUANTIZED","NORMAL_UP_OCT32P","NORMAL_RIGHT_OCT32P"].forEach((e=>{e in t.header&&console.warn(`I3DMLoader: Unsupported FeatureTable feature "${e}" detected.`)}));const p=new ie;for(let t=0;t<n;t++)p.x+=r[3*t+0]/n,p.y+=r[3*t+1]/n,p.z+=r[3*t+2]/n;const m=[],f=[];e.scene.updateMatrixWorld(),e.scene.traverse((e=>{if(e.isMesh){f.push(e);const{geometry:t,material:i}=e,s=new at(t,i,n);s.position.copy(p),u&&(s.position.x+=u[0],s.position.y+=u[1],s.position.z+=u[2]),m.push(s)}}));for(let t=0;t<n;t++){Xl.set(r[3*t+0]-p.x,r[3*t+1]-p.y,r[3*t+2]-p.z),ql.identity(),o&&(Wl.set(o[3*t+0],o[3*t+1],o[3*t+2]),Kl.set(a[3*t+0],a[3*t+1],a[3*t+2]),Vl.crossVectors(Kl,Wl).normalize(),Zl.makeBasis(Kl,Wl,Vl),ql.setFromRotationMatrix(Zl)),Yl.set(1,1,1),l&&Yl.set(l[3*t+0],l[3*t+1],l[3*t+2]),c&&Yl.multiplyScalar(c[t]);for(let e=0,i=m.length;e<i;e++){const i=m[e];ec.copy(ql),d&&(i.updateMatrixWorld(),Ql.copy(Xl).applyMatrix4(i.matrixWorld),this.ellipsoid.getPositionToCartographic(Ql,tc),this.ellipsoid.getEastNorthUpFrame(tc.lat,tc.lon,Jl),ec.setFromRotationMatrix(Jl)),Zl.compose(Xl,ec,Yl).multiply(h);const n=f[e];$l.multiplyMatrices(Zl,n.matrixWorld),i.setMatrixAt(t,$l)}}e.scene.clear(),e.scene.add(...m),e.batchTable=i,e.featureTable=t,e.scene.batchTable=i,e.scene.featureTable=t,s(e)}),r)}))}))}}class nc extends ya{parse(e){const t=new DataView(e),i=xa(t);console.assert("cmpt"===i,'CMPTLoader: The magic bytes equal "cmpt".');const n=t.getUint32(4,!0);console.assert(1===n,'CMPTLoader: The version listed in the header is "1".');const s=t.getUint32(8,!0);console.assert(s===e.byteLength,"CMPTLoader: The contents buffer length listed in the header matches the file.");const r=t.getUint32(12,!0),o=[];let a=16;for(let l=0;l<r;l++){const t=new DataView(e,a,12),i=xa(t),n=t.getUint32(4,!0),s=t.getUint32(8,!0),r=new Uint8Array(e,a,s);o.push({type:i,buffer:r,version:n}),a+=s}return{version:n,tiles:o}}}class sc extends nc{constructor(e=ot){super(),this.manager=e,this.adjustmentTransform=new Ne,this.ellipsoid=Gl.clone()}parse(e){const t=super.parse(e),{manager:i,ellipsoid:n,adjustmentTransform:s}=this,r=[];for(const o in t.tiles){const{type:e,buffer:a}=t.tiles[o];switch(e){case"b3dm":{const e=a.slice(),t=new xl(i);t.workingPath=this.workingPath,t.fetchOptions=this.fetchOptions,t.adjustmentTransform.copy(s);const n=t.parse(e.buffer);r.push(n);break}case"pnts":{const e=a.slice(),t=new Sl(i);t.workingPath=this.workingPath,t.fetchOptions=this.fetchOptions;const n=t.parse(e.buffer);r.push(n);break}case"i3dm":{const e=a.slice(),t=new ic(i);t.workingPath=this.workingPath,t.fetchOptions=this.fetchOptions,t.ellipsoid.copy(n),t.adjustmentTransform.copy(s);const o=t.parse(e.buffer);r.push(o);break}}}return Promise.all(r).then((e=>{const t=new Ie;return e.forEach((e=>{t.add(e.scene)})),{tiles:e,scene:t}}))}}const rc=new Ne;class oc extends Ie{constructor(e){super(),this.isTilesGroup=!0,this.name="TilesRenderer.TilesGroup",this.tilesRenderer=e,this.matrixWorldInverse=new Ne}raycast(e,t){return!this.tilesRenderer.optimizeRaycast||(this.tilesRenderer.raycast(e,t),!1)}updateMatrixWorld(e){if(this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldNeedsUpdate||e){null===this.parent?rc.copy(this.matrix):rc.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1;const e=rc.elements,t=this.matrixWorld.elements;let i=!1;for(let n=0;n<16;n++){const s=e[n],r=t[n];if(Math.abs(s-r)>Number.EPSILON){i=!0;break}}if(i){this.matrixWorld.copy(rc),this.matrixWorldInverse.copy(rc).invert();const e=this.children;for(let t=0,i=e.length;t<i;t++)e[t].updateMatrixWorld()}}}updateWorldMatrix(e,t){this.parent&&e&&this.parent.updateWorldMatrix(e,!1),this.updateMatrixWorld(!0)}}const ac=new Ge,lc=new ie,cc=[];function hc(e,t){return e.distance-t.distance}function uc(e,t,i,n){const{scene:s}=e.cached;i.invokeOnePlugin((i=>i.raycastTile&&i.raycastTile(e,s,t,n)))||t.intersectObject(s,!0,n)}function dc(e){return"__used"in e}function pc(e,t,i,n=null){const{group:s,activeTiles:r}=e;null===n&&(n=ac).copy(i.ray).applyMatrix4(s.matrixWorldInverse);const o=[],a=t.children;for(let h=0,u=a.length;h<u;h++){const e=a[h];dc(e)&&e.__used&&(null!==e.cached.boundingVolume.intersectRay(n,lc)&&(lc.applyMatrix4(s.matrixWorld),o.push({distance:lc.distanceToSquared(i.ray.origin),tile:e})))}o.sort(hc);let l=null,c=1/0;if(r.has(t)){const n=function(e,t,i){uc(e,t,i,cc),cc.sort(hc);const n=cc[0]||null;return cc.length=0,n}(t,i,e);n&&(l=n,c=n.distance*n.distance)}for(let h=0,u=o.length;h<u;h++){const t=o[h],s=t.distance,r=t.tile;if(s>c)break;const a=pc(e,r,i,n);if(a){const e=a.distance*a.distance;e<c&&(l=a,c=e)}}return l}function mc(e,t,i,n,s=null){if(!dc(t))return;const{group:r,activeTiles:o}=e,{boundingVolume:a}=t.cached;if(null===s&&(s=ac).copy(i.ray).applyMatrix4(r.matrixWorldInverse),!t.__used||!a.intersectsRay(s))return;o.has(t)&&uc(t,i,e,n);const l=t.children;for(let c=0,h=l.length;c<h;c++)mc(e,l[c],i,n,s)}const fc=new ie,gc=new ie,vc=new ie,_c=new Ge;class yc{constructor(e=new ft,t=new Ne){this.box=e.clone(),this.transform=t.clone(),this.inverseTransform=new Ne,this.points=new Array(8).fill().map((()=>new ie)),this.planes=new Array(6).fill().map((()=>new We))}copy(e){return this.box.copy(e.box),this.transform.copy(e.transform),this.update(),this}clone(){return(new this.constructor).copy(this)}clampPoint(e,t){return t.copy(e).applyMatrix4(this.inverseTransform).clamp(this.box.min,this.box.max).applyMatrix4(this.transform)}distanceToPoint(e){return this.clampPoint(e,vc).distanceTo(e)}containsPoint(e){return vc.copy(e).applyMatrix4(this.inverseTransform),this.box.containsPoint(vc)}intersectsRay(e){return _c.copy(e).applyMatrix4(this.inverseTransform),_c.intersectsBox(this.box)}intersectRay(e,t){return _c.copy(e).applyMatrix4(this.inverseTransform),_c.intersectBox(this.box,t)?(t.applyMatrix4(this.transform),t):null}update(){const{points:e,inverseTransform:t,transform:i,box:n}=this;t.copy(i).invert();const{min:s,max:r}=n;let o=0;for(let a=-1;a<=1;a+=2)for(let t=-1;t<=1;t+=2)for(let n=-1;n<=1;n+=2)e[o].set(a<0?s.x:r.x,t<0?s.y:r.y,n<0?s.z:r.z).applyMatrix4(i),o++;this.updatePlanes()}updatePlanes(){fc.copy(this.box.min).applyMatrix4(this.transform),gc.copy(this.box.max).applyMatrix4(this.transform),vc.set(0,0,1).transformDirection(this.transform),this.planes[0].setFromNormalAndCoplanarPoint(vc,fc),this.planes[1].setFromNormalAndCoplanarPoint(vc,gc).negate(),vc.set(0,1,0).transformDirection(this.transform),this.planes[2].setFromNormalAndCoplanarPoint(vc,fc),this.planes[3].setFromNormalAndCoplanarPoint(vc,gc).negate(),vc.set(1,0,0).transformDirection(this.transform),this.planes[4].setFromNormalAndCoplanarPoint(vc,fc),this.planes[5].setFromNormalAndCoplanarPoint(vc,gc).negate()}intersectsSphere(e){return this.clampPoint(e.center,vc),vc.distanceToSquared(e.center)<=e.radius*e.radius}intersectsFrustum(e){return this._intersectsPlaneShape(e.planes,e.points)}intersectsOBB(e){return this._intersectsPlaneShape(e.planes,e.points)}_intersectsPlaneShape(e,t){const i=this.points,n=this.planes;for(let s=0;s<6;s++){const t=e[s];let n=-1/0;for(let e=0;e<8;e++){const s=i[e],r=t.distanceToPoint(s);n=n<r?r:n}if(n<0)return!1}for(let s=0;s<6;s++){const e=n[s];let i=-1/0;for(let n=0;n<8;n++){const s=t[n],r=e.distanceToPoint(s);i=i<r?r:i}if(i<0)return!1}return!0}}const xc=Math.PI,bc=xc/2,wc=new ie,Tc=new ie,Ac=new ie,Mc=new Ne;let Sc=0;const Ec=[];function Pc(e=!1){return e?(Ec[Sc]||(Ec[Sc]=new ie),Sc++,Ec[Sc-1]):new ie}function Cc(){Sc=0}class Rc extends Hl{constructor(e,t,i,n=-bc,s=bc,r=0,o=2*xc,a=0,l=0){super(e,t,i),this.latStart=n,this.latEnd=s,this.lonStart=r,this.lonEnd=o,this.heightStart=a,this.heightEnd=l}_getPoints(e=!1){const{latStart:t,latEnd:i,lonStart:n,lonEnd:s,heightStart:r,heightEnd:o}=this,a=Y.mapLinear(.5,0,1,t,i),l=Y.mapLinear(.5,0,1,n,s),c=Math.floor(n/bc)*bc,h=[[-xc/2,0],[xc/2,0],[0,c],[0,c+xc/2],[0,c+xc],[0,c+3*xc/2],[t,s],[i,s],[t,n],[i,n],[0,n],[0,s],[a,l],[t,l],[i,l],[a,n],[a,s]],u=[],d=h.length;for(let p=0;p<=1;p++){const a=Y.mapLinear(p,0,1,r,o);for(let r=0,o=d;r<o;r++){const[o,l]=h[r];if(o>=t&&o<=i&&l>=n&&l<=s){const t=Pc(e);u.push(t),this.getCartographicToPosition(o,l,a,t)}}}return u}getBoundingBox(e,t){Cc();const{latStart:i,latEnd:n,lonStart:s,lonEnd:r}=this;if(n-i<xc/2){const e=Y.mapLinear(.5,0,1,i,n),o=Y.mapLinear(.5,0,1,s,r);this.getCartographicToNormal(e,o,Ac),Tc.set(0,0,1),wc.crossVectors(Tc,Ac),Tc.crossVectors(wc,Ac),t.makeBasis(wc,Tc,Ac)}else wc.set(1,0,0),Tc.set(0,1,0),Ac.set(0,0,1),t.makeBasis(wc,Tc,Ac);Mc.copy(t).invert();const o=this._getPoints(!0);for(let a=0,l=o.length;a<l;a++)o[a].applyMatrix4(Mc);e.makeEmpty(),e.setFromPoints(o)}getBoundingSphere(e,t){Cc();const i=this._getPoints(!0);e.makeEmpty(),e.setFromPoints(i,t)}}const Lc=new ie,Dc=new ie,Oc=new ie,kc=new ie,Ic=new ie;class Fc{constructor(){this.sphere=null,this.obb=null,this.region=null,this.regionObb=null}intersectsRay(e){const t=this.sphere,i=this.obb||this.regionObb;return!(t&&!e.intersectsSphere(t)||i&&!i.intersectsRay(e))}intersectRay(e,t=null){const i=this.sphere,n=this.obb||this.regionObb;let s=-1/0,r=-1/0;i&&e.intersectSphere(i,kc)&&(s=i.containsPoint(e.origin)?0:e.origin.distanceToSquared(kc)),n&&n.intersectRay(e,Ic)&&(r=n.containsPoint(e.origin)?0:e.origin.distanceToSquared(Ic));const o=Math.max(s,r);return o===-1/0?null:(e.at(Math.sqrt(o),t),t)}distanceToPoint(e){const t=this.sphere,i=this.obb||this.regionObb;let n=-1/0,s=-1/0;return t&&(n=Math.max(t.distanceToPoint(e),0)),i&&(s=i.distanceToPoint(e)),n>s?n:s}intersectsFrustum(e){const t=this.obb||this.regionObb,i=this.sphere;return!(i&&!e.intersectsSphere(i)||t&&!t.intersectsFrustum(e))&&!(!i&&!t)}intersectsSphere(e){const t=this.obb||this.regionObb,i=this.sphere;return!(i&&!i.intersectsSphere(e)||t&&!t.intersectsSphere(e))&&!(!i&&!t)}intersectsOBB(e){const t=this.obb||this.regionObb,i=this.sphere;return!(i&&!e.intersectsSphere(i)||t&&!t.intersectsOBB(e))&&!(!i&&!t)}getOBB(e,t){const i=this.obb||this.regionObb;i?(e.copy(i.box),t.copy(i.transform)):(this.getAABB(e),t.identity())}getAABB(e){if(this.sphere)this.sphere.getBoundingBox(e);else{const t=this.obb||this.regionObb;e.copy(t.box).applyMatrix4(t.transform)}}getSphere(e){if(this.sphere)e.copy(this.sphere);else if(this.region)this.region.getBoundingSphere(e);else{const t=this.obb||this.regionObb;t.box.getBoundingSphere(e),e.applyMatrix4(t.transform)}}setObbData(e,t){const i=new yc;Lc.set(e[3],e[4],e[5]),Dc.set(e[6],e[7],e[8]),Oc.set(e[9],e[10],e[11]);const n=Lc.length(),s=Dc.length(),r=Oc.length();Lc.normalize(),Dc.normalize(),Oc.normalize(),0===n&&Lc.crossVectors(Dc,Oc),0===s&&Dc.crossVectors(Lc,Oc),0===r&&Oc.crossVectors(Lc,Dc),i.transform.set(Lc.x,Dc.x,Oc.x,e[0],Lc.y,Dc.y,Oc.y,e[1],Lc.z,Dc.z,Oc.z,e[2],0,0,0,1).premultiply(t),i.box.min.set(-n,-s,-r),i.box.max.set(n,s,r),i.update(),this.obb=i}setSphereData(e,t,i,n,s){const r=new Ye;r.center.set(e,t,i),r.radius=n,r.applyMatrix4(s),this.sphere=r}setRegionData(e,t,i,n,s,r,o){const a=new Rc(...e.radius,i,s,t,n,r,o),l=new yc;a.getBoundingBox(l.box,l.transform),l.update(),this.region=a,this.regionObb=l}}const Uc=new mt;class Bc extends it{constructor(){super(),this.points=Array(8).fill().map((()=>new ie))}setFromProjectionMatrix(e,t){return super.setFromProjectionMatrix(e,t),this.calculateFrustumPoints(),this}calculateFrustumPoints(){const{planes:e,points:t}=this;[[e[0],e[3],e[4]],[e[1],e[3],e[4]],[e[0],e[2],e[4]],[e[1],e[2],e[4]],[e[0],e[3],e[5]],[e[1],e[3],e[5]],[e[0],e[2],e[5]],[e[1],e[2],e[5]]].forEach(((e,i)=>{!function(e,t,i,n){const s=Uc.set(e.normal.x,e.normal.y,e.normal.z,t.normal.x,t.normal.y,t.normal.z,i.normal.x,i.normal.y,i.normal.z);n.set(-e.constant,-t.constant,-i.constant),n.applyMatrix3(s.invert())}(e[0],e[1],e[2],t[i])}))}}const zc=new Ne,Nc=new ze,jc=Symbol("INITIAL_FRUSTUM_CULLED"),Hc=new Ne,Gc=new ie,Vc=new te,Wc={inView:!1,error:1/0},Kc=new ie(1,0,0),Xc=new ie(0,1,0);function qc(e,t){e.traverse((e=>{e.frustumCulled=e[jc]&&t}))}class Yc extends da{get autoDisableRendererCulling(){return this._autoDisableRendererCulling}set autoDisableRendererCulling(e){this._autoDisableRendererCulling!==e&&(super._autoDisableRendererCulling=e,this.forEachLoadedModel((t=>{qc(t,!e)})))}get optimizeRaycast(){return this._optimizeRaycast}set optimizeRaycast(e){console.warn('TilesRenderer: The "optimizeRaycast" option has been deprecated.'),this._optimizeRaycast=e}constructor(...e){super(...e),this.group=new oc(this),this.ellipsoid=Gl.clone(),this.cameras=[],this.cameraMap=new Map,this.cameraInfo=[],this._optimizeRaycast=!0,this._upRotationMatrix=new Ne,this.lruCache.computeMemoryUsageCallback=e=>e.cached.bytesUsed??null,this._autoDisableRendererCulling=!0;const t=new qe;t.setURLModifier((e=>this.preprocessURL?this.preprocessURL(e):e)),this.manager=t,this._listeners={}}addEventListener(...e){Se.prototype.addEventListener.call(this,...e)}hasEventListener(...e){Se.prototype.hasEventListener.call(this,...e)}removeEventListener(...e){Se.prototype.removeEventListener.call(this,...e)}dispatchEvent(...e){Se.prototype.dispatchEvent.call(this,...e)}getBoundingBox(e){if(!this.root)return!1;const t=this.root.cached.boundingVolume;return!!t&&(t.getAABB(e),!0)}getOrientedBoundingBox(e,t){if(!this.root)return!1;const i=this.root.cached.boundingVolume;return!!i&&(i.getOBB(e,t),!0)}getBoundingSphere(e){if(!this.root)return!1;const t=this.root.cached.boundingVolume;return!!t&&(t.getSphere(e),!0)}forEachLoadedModel(e){this.traverse((t=>{const i=t.cached&&t.cached.scene;i&&e(i,t)}),null,!1)}raycast(e,t){if(this.root)if(e.firstHitOnly){const i=pc(this,this.root,e);i&&t.push(i)}else mc(this,this.root,e,t)}hasCamera(e){return this.cameraMap.has(e)}setCamera(e){const t=this.cameras,i=this.cameraMap;return!i.has(e)&&(i.set(e,new te),t.push(e),this.dispatchEvent({type:"add-camera",camera:e}),!0)}setResolution(e,t,i){const n=this.cameraMap;if(!n.has(e))return!1;const s=t.isVector2?t.x:t,r=t.isVector2?t.y:i,o=n.get(e);return(o.width!==s||o.height!==r)&&(o.set(s,r),this.dispatchEvent({type:"camera-resolution-change"})),!0}setResolutionFromRenderer(e,t){return t.getSize(Vc),this.setResolution(e,Vc.x,Vc.y)}deleteCamera(e){const t=this.cameras,i=this.cameraMap;if(i.has(e)){const n=t.indexOf(e);return t.splice(n,1),i.delete(e),this.dispatchEvent({type:"delete-camera",camera:e}),!0}return!1}loadRootTileSet(...e){return super.loadRootTileSet(...e).then((e=>{const{asset:t,extensions:i={}}=e;switch((t&&t.gltfUpAxis||"y").toLowerCase()){case"x":this._upRotationMatrix.makeRotationAxis(Xc,-Math.PI/2);break;case"y":this._upRotationMatrix.makeRotationAxis(Kc,Math.PI/2)}if("3DTILES_ellipsoid"in i){const e=i["3DTILES_ellipsoid"],{ellipsoid:t}=this;t.name=e.body,e.radii?t.radius.set(...e.radii):t.radius.set(1,1,1)}return e}))}update(){let e=null;if(this.invokeAllPlugins((t=>{if(t.doTilesNeedUpdate){const i=t.doTilesNeedUpdate();e=null===e?i:!(!e&&!i)}})),!1===e)return this.dispatchEvent({type:"update-before"}),void this.dispatchEvent({type:"update-after"});this.dispatchEvent({type:"update-before"});const t=this.group,i=this.cameras,n=this.cameraMap,s=this.cameraInfo;for(;s.length>i.length;)s.pop();for(;s.length<i.length;)s.push({frustum:new Bc,isOrthographic:!1,sseDenominator:-1,position:new ie,invScale:-1,pixelSize:0});Gc.setFromMatrixScale(t.matrixWorldInverse),Math.abs(Math.max(Gc.x-Gc.y,Gc.x-Gc.z))>1e-6&&console.warn("ThreeTilesRenderer : Non uniform scale used for tile which may cause issues when calculating screen space error.");for(let r=0,o=s.length;r<o;r++){const e=i[r],o=s[r],a=o.frustum,l=o.position,c=n.get(e);(0===c.width||0===c.height)&&console.warn("TilesRenderer: resolution for camera error calculation is not set.");const h=e.projectionMatrix.elements;if(o.isOrthographic=1===h[15],o.isOrthographic){const e=2/h[0],t=2/h[5];o.pixelSize=Math.max(t/c.height,e/c.width)}else o.sseDenominator=2/h[5]/c.height;Hc.copy(t.matrixWorld),Hc.premultiply(e.matrixWorldInverse),Hc.premultiply(e.projectionMatrix),a.setFromProjectionMatrix(Hc),l.set(0,0,0),l.applyMatrix4(e.matrixWorld),l.applyMatrix4(t.matrixWorldInverse)}if(super.update(),this.dispatchEvent({type:"update-after"}),0===i.length&&this.root){let e=!1;this.invokeAllPlugins((t=>e=e||!(t===this||!t.calculateTileViewError))),!1===e&&console.warn("TilesRenderer: no cameras defined. Cannot update 3d tiles.")}}preprocessNode(e,t,i=null){super.preprocessNode(e,t,i);const n=new Ne;if(e.transform){const t=e.transform;for(let e=0;e<16;e++)n.elements[e]=t[e]}i&&n.premultiply(i.cached.transform);const s=(new Ne).copy(n).invert(),r=new Fc;"sphere"in e.boundingVolume&&r.setSphereData(...e.boundingVolume.sphere,n),"box"in e.boundingVolume&&r.setObbData(e.boundingVolume.box,n),"region"in e.boundingVolume&&r.setRegionData(this.ellipsoid,...e.boundingVolume.region),e.cached={transform:n,transformInverse:s,active:!1,boundingVolume:r,metadata:null,scene:null,geometry:null,materials:null,textures:null}}async parseTile(e,t,i,n,s){const r=t.cached,o=n.split(/[\\/]/g);o.pop();const a=o.join("/"),l=this.fetchOptions,c=this.manager;let h=null;const u=r.transform,d=this._upRotationMatrix,p=(xa(e)||i).toLowerCase();switch(p){case"b3dm":{const t=new xl(c);t.workingPath=a,t.fetchOptions=l,t.adjustmentTransform.copy(d),h=t.parse(e);break}case"pnts":{const t=new Sl(c);t.workingPath=a,t.fetchOptions=l,h=t.parse(e);break}case"i3dm":{const t=new ic(c);t.workingPath=a,t.fetchOptions=l,t.adjustmentTransform.copy(d),t.ellipsoid.copy(this.ellipsoid),h=t.parse(e);break}case"cmpt":{const t=new sc(c);t.workingPath=a,t.fetchOptions=l,t.adjustmentTransform.copy(d),t.ellipsoid.copy(this.ellipsoid),h=t.parse(e).then((e=>e.scene));break}case"gltf":case"glb":{const t=c.getHandler("path.gltf")||c.getHandler("path.glb")||new Ta(c);t.setWithCredentials("include"===l.credentials),t.setRequestHeader(l.headers||{}),"include"===l.credentials&&"cors"===l.mode&&t.setCrossOrigin("use-credentials");let i=t.resourcePath||t.path||a;!/[\\/]$/.test(i)&&i.length&&(i+="/"),h=t.parseAsync(e,i).then((e=>{e.scene=e.scene||new Ie;const{scene:t}=e;return t.updateMatrix(),t.matrix.multiply(d).decompose(t.position,t.quaternion,t.scale),e}));break}default:h=this.invokeOnePlugin((r=>r.parseToMesh&&r.parseToMesh(e,t,i,n,s)))}const m=await h;if(null===m)throw new Error(`TilesRenderer: Content type "${p}" not supported.`);let f,g;m.isObject3D?(f=m,g=null):(f=m.scene,g=m),await this.invokeAllPlugins((e=>e.processTileModel&&e.processTileModel(f,t))),f.updateMatrix(),f.matrix.premultiply(u),f.matrix.decompose(f.position,f.quaternion,f.scale),f.traverse((e=>{e[jc]=e.frustumCulled})),qc(f,!this.autoDisableRendererCulling);const v=[],_=[],y=[];if(f.traverse((e=>{if(e.geometry&&_.push(e.geometry),e.material){const t=e.material;v.push(e.material);for(const e in t){const i=t[e];i&&i.isTexture&&y.push(i)}}})),s.aborted)for(let x=0,b=y.length;x<b;x++){const e=y[x];e.image instanceof ImageBitmap&&e.image.close(),e.dispose()}else r.materials=v,r.geometry=_,r.textures=y,r.scene=f,r.metadata=g,r.bytesUsed=function(e){const{TextureUtils:t}=ne;if(!t)return 0;const i=new Set;let n=0;return e.traverse((e=>{if(e.geometry&&!i.has(e.geometry)&&(n+=function(e){let t=0;for(const n in e.attributes){const i=e.getAttribute(n);t+=i.count*i.itemSize*i.array.BYTES_PER_ELEMENT}const i=e.getIndex();return t+=i?i.count*i.itemSize*i.array.BYTES_PER_ELEMENT:0,t}(e.geometry),i.add(e.geometry)),e.material){const s=e.material;for(const e in s){const r=s[e];if(r&&r.isTexture&&!i.has(r)){const{format:e,type:s,image:o}=r,{width:a,height:l}=o,c=t.getByteLength(a,l,e,s);n+=r.generateMipmaps?4*c/3:c,i.add(r)}}}})),n}(f)}disposeTile(e){super.disposeTile(e);const t=e.cached;if(t.scene){const i=t.materials,n=t.geometry,s=t.textures,r=t.scene.parent;t.scene.traverse((e=>{e.userData.meshFeatures&&e.userData.meshFeatures.dispose(),e.userData.structuralMetadata&&e.userData.structuralMetadata.dispose()}));for(let e=0,t=n.length;e<t;e++)n[e].dispose();for(let e=0,t=i.length;e<t;e++)i[e].dispose();for(let e=0,t=s.length;e<t;e++){const t=s[e];t.image instanceof ImageBitmap&&t.image.close(),t.dispose()}r&&r.remove(t.scene),this.dispatchEvent({type:"dispose-model",scene:t.scene,tile:e}),t.scene=null,t.materials=null,t.textures=null,t.geometry=null,t.metadata=null}}setTileVisible(e,t){const i=e.cached.scene,n=this.group;t?i&&(n.add(i),i.updateMatrixWorld(!0)):i&&n.remove(i),super.setTileVisible(e,t),this.dispatchEvent({type:"tile-visibility-change",scene:i,tile:e,visible:t})}calculateTileViewError(e,t){const i=e.cached,n=this.cameras,s=this.cameraInfo,r=i.boundingVolume;let o=!1,a=-1/0,l=1/0,c=-1/0,h=1/0;for(let u=0,d=n.length;u<d;u++){const t=s[u];let i,n;if(t.isOrthographic){const s=t.pixelSize;i=e.geometricError/s,n=1/0}else{const s=t.sseDenominator;n=r.distanceToPoint(t.position),i=e.geometricError/(n*s)}const d=s[u].frustum;r.intersectsFrustum(d)&&(o=!0,a=Math.max(a,i),l=Math.min(l,n)),c=Math.max(c,i),h=Math.min(h,n)}this.invokeAllPlugins((t=>{t!==this&&t.calculateTileViewError&&(t.calculateTileViewError(e,Wc),Wc.inView&&(o=!0,a=Math.max(a,Wc.error)),c=Math.max(c,Wc.error))})),o?(t.inView=!0,t.error=a,t.distanceFromCamera=l):(t.inView=!1,t.error=c,t.distanceFromCamera=h)}setLatLonToYUp(e,t){console.warn("TilesRenderer: setLatLonToYUp is deprecated. Use the ReorientationPlugin, instead.");const{ellipsoid:i,group:n}=this;Nc.set(Math.PI/2,Math.PI/2,0),zc.makeRotationFromEuler(Nc),i.getEastNorthUpFrame(e,t,0,n.matrix).multiply(zc).invert().decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld(!0)}dispose(){super.dispose(),this.group.removeFromParent()}}class Zc extends oe{constructor(){super(new pt(0,0),new $c),this.renderOrder=1/0}onBeforeRender(e){const t=this.material.uniforms;e.getSize(t.resolution.value)}updateMatrixWorld(){this.matrixWorld.makeTranslation(this.position)}dispose(){this.geometry.dispose(),this.material.dispose()}}class $c extends ge{constructor(){super({depthWrite:!1,depthTest:!1,transparent:!0,uniforms:{resolution:{value:new te},size:{value:15},thickness:{value:2},opacity:{value:1}},vertexShader:"\n\n\t\t\t\tuniform float pixelRatio;\n\t\t\t\tuniform float size;\n\t\t\t\tuniform float thickness;\n\t\t\t\tuniform vec2 resolution;\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvUv = uv;\n\n\t\t\t\t\tfloat aspect = resolution.x / resolution.y;\n\t\t\t\t\tvec2 offset = uv * 2.0 - vec2( 1.0 );\n\t\t\t\t\toffset.y *= aspect;\n\n\t\t\t\t\tvec4 screenPoint = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t\tscreenPoint.xy += offset * ( size + thickness ) * screenPoint.w / resolution.x;\n\n\t\t\t\t\tgl_Position = screenPoint;\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform float size;\n\t\t\t\tuniform float thickness;\n\t\t\t\tuniform float opacity;\n\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tfloat ht = 0.5 * thickness;\n\t\t\t\t\tfloat planeDim = size + thickness;\n\t\t\t\t\tfloat offset = ( planeDim - ht - 2.0 ) / planeDim;\n\t\t\t\t\tfloat texelThickness = ht / planeDim;\n\n\t\t\t\t\tvec2 vec = vUv * 2.0 - vec2( 1.0 );\n\t\t\t\t\tfloat dist = abs( length( vec ) - offset );\n\t\t\t\t\tfloat fw = fwidth( dist ) * 0.5;\n\t\t\t\t\tfloat a = smoothstep( texelThickness - fw, texelThickness + fw, dist );\n\n\t\t\t\t\tgl_FragColor = vec4( 1, 1, 1, opacity * ( 1.0 - a ) );\n\n\t\t\t\t}\n\t\t\t"})}}const Qc=new te,Jc=new te;class eh{constructor(){this.domElement=null,this.buttons=0,this.pointerType=null,this.pointerOrder=[],this.previousPositions={},this.pointerPositions={},this.startPositions={},this.pointerSetThisFrame={},this.hoverPosition=new te,this.hoverSet=!1}reset(){this.buttons=0,this.pointerType=null,this.pointerOrder=[],this.previousPositions={},this.pointerPositions={},this.startPositions={},this.pointerSetThisFrame={},this.hoverPosition=new te,this.hoverSet=!1}updateFrame(){const{previousPositions:e,pointerPositions:t}=this;for(const i in t)e[i].copy(t[i])}setHoverEvent(e){("mouse"===e.pointerType||"wheel"===e.type)&&(this.getAdjustedPointer(e,this.hoverPosition),this.hoverSet=!0)}getLatestPoint(e){return null!==this.pointerType?(this.getCenterPoint(e),e):this.hoverSet?(e.copy(this.hoverPosition),e):null}getAdjustedPointer(e,t){const i=(this.domElement?this.domElement:e.target).getBoundingClientRect(),n=e.clientX-i.left,s=e.clientY-i.top;t.set(n,s)}addPointer(e){const t=e.pointerId,i=new te;this.getAdjustedPointer(e,i),this.pointerOrder.push(t),this.pointerPositions[t]=i,this.previousPositions[t]=i.clone(),this.startPositions[t]=i.clone(),1===this.getPointerCount()&&(this.pointerType=e.pointerType,this.buttons=e.buttons)}updatePointer(e){const t=e.pointerId;return t in this.pointerPositions&&(this.getAdjustedPointer(e,this.pointerPositions[t]),!0)}deletePointer(e){const t=e.pointerId,i=this.pointerOrder;i.splice(i.indexOf(t),1),delete this.pointerPositions[t],delete this.previousPositions[t],delete this.startPositions[t],0===this.getPointerCount.length&&(this.buttons=0,this.pointerType=null)}getPointerCount(){return this.pointerOrder.length}getCenterPoint(e,t=this.pointerPositions){const i=this.pointerOrder;if(1===this.getPointerCount()||"mouse"===this.getPointerType()){const n=i[0];return e.copy(t[n]),e}if(2===this.getPointerCount()){const i=this.pointerOrder[0],n=this.pointerOrder[1],s=t[i],r=t[n];return e.addVectors(s,r).multiplyScalar(.5),e}return null}getPreviousCenterPoint(e){return this.getCenterPoint(e,this.previousPositions)}getStartCenterPoint(e){return this.getCenterPoint(e,this.startPositions)}getMoveDistance(){return this.getCenterPoint(Qc),this.getPreviousCenterPoint(Jc),Qc.sub(Jc).length()}getTouchPointerDistance(e=this.pointerPositions){if(this.getPointerCount()<=1||"mouse"===this.getPointerType())return 0;const{pointerOrder:t}=this,i=t[0],n=t[1],s=e[i],r=e[n];return s.distanceTo(r)}getPreviousTouchPointerDistance(){return this.getTouchPointerDistance(this.previousPositions)}getStartTouchPointerDistance(){return this.getTouchPointerDistance(this.startPositions)}getPointerType(){return this.pointerType}isPointerTouch(){return"touch"===this.getPointerType()}getPointerButtons(){return this.buttons}isLeftClicked(){return!!(1&this.buttons)}isRightClicked(){return!!(2&this.buttons)}}const th=new Ne,ih=new Ge,nh=new ie;function sh(e,t,i){return i.makeTranslation(-e.x,-e.y,-e.z),th.makeRotationFromQuaternion(t),i.premultiply(th),th.makeTranslation(e.x,e.y,e.z),i.premultiply(th),i}function rh(e,t,i,n){n.x=(e-i.offsetLeft)/i.clientWidth*2-1,n.y=-(t-i.offsetTop)/i.clientHeight*2+1,n.isVector3&&(n.z=0)}function oh(e,t,i){return t.intersectRay(e,i)?i:(th.makeScale(...t.radius).invert(),ih.copy(e).applyMatrix4(th),nh.set(0,0,0),ih.closestPointToPoint(nh,i).normalize(),th.makeScale(...t.radius),i.applyMatrix4(th))}function ah(e,t,i){const n=e instanceof Ge?e:e.ray,{origin:s,direction:r}=n;s.set(t.x,t.y,-1).unproject(i),r.set(t.x,t.y,1).unproject(i).sub(s),e.isRay||(e.near=0,e.far=r.length(),e.camera=i),r.normalize()}const lh=.05,ch=.025,hh=new Ne,uh=new Ne,dh=new ie,ph=new ie,mh=new ie,fh=new ie,gh=new ie,vh=new ie,_h=new ie,yh=new ie,xh=new Ve,bh=new We,wh=new ie,Th=new ie,Ah=new ie,Mh=new Ve,Sh=new Ge,Eh=new te,Ph=new te,Ch=new te,Rh=new te,Lh=new te,Dh=new te,Oh={type:"change"},kh={type:"start"},Ih={type:"end"};class Fh extends Se{get enabled(){return this._enabled}set enabled(e){e!==this.enabled&&(this._enabled=e,this.resetState(),this.pointerTracker.reset(),this.enabled||(this.dragInertia.set(0,0,0),this.rotationInertia.set(0,0)))}constructor(e=null,t=null,i=null,n=null){super(),this.isEnvironmentControls=!0,this.domElement=null,this.camera=null,this.scene=null,this.tilesRenderer=null,this._enabled=!0,this.cameraRadius=5,this.rotationSpeed=1,this.minAltitude=0,this.maxAltitude=.45*Math.PI,this.minDistance=10,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.zoomSpeed=1,this.adjustHeight=!0,this.enableDamping=!1,this.dampingFactor=.15,this.fallbackPlane=new We(new ie(0,1,0),0),this.useFallbackPlane=!0,this.scaleZoomOrientationAtEdges=!1,this.autoAdjustCameraRotation=!0,this.state=0,this.pointerTracker=new eh,this.needsUpdate=!1,this.actionHeightOffset=0,this.pivotPoint=new ie,this.zoomDirectionSet=!1,this.zoomPointSet=!1,this.zoomDirection=new ie,this.zoomPoint=new ie,this.zoomDelta=0,this.rotationInertiaPivot=new ie,this.rotationInertia=new te,this.dragInertia=new ie,this.inertiaTargetDistance=1/0,this.inertiaStableFrames=0,this.pivotMesh=new Zc,this.pivotMesh.raycast=()=>{},this.pivotMesh.scale.setScalar(.25),this.raycaster=new H,this.raycaster.firstHitOnly=!0,this.up=new ie(0,1,0),this.clock=new z,this._detachCallback=null,this._upInitialized=!1,this._lastUsedState=0,this._zoomPointWasSet=!1,this._tilesOnChangeCallback=()=>this.zoomPointSet=!1,i&&this.attach(i),t&&this.setCamera(t),e&&this.setScene(e),n&&this.setTilesRenderer(n)}setScene(e){this.scene=e}setCamera(e){this.camera=e,this._upInitialized=!1,this.zoomDirectionSet=!1,this.zoomPointSet=!1,this.needsUpdate=!0,this.raycaster.camera=e,this.resetState()}setTilesRenderer(e){console.warn('EnvironmentControls: "setTilesRenderer" has been deprecated. Use "setScene" and "setEllipsoid", instead.'),this.tilesRenderer=e,null!==this.tilesRenderer&&this.setScene(this.tilesRenderer.group)}attach(e){if(this.domElement)throw new Error("EnvironmentControls: Controls already attached to element");this.domElement=e,this.pointerTracker.domElement=e,e.style.touchAction="none";const t=e=>{this.enabled&&e.preventDefault()},i=e=>{if(!this.enabled)return;e.preventDefault();const{camera:t,raycaster:i,domElement:n,up:s,pivotMesh:r,pointerTracker:o,scene:a,pivotPoint:l,enabled:c}=this;if(o.addPointer(e),this.needsUpdate=!0,o.isPointerTouch())if(r.visible=!1,0===o.getPointerCount())n.setPointerCapture(e.pointerId);else if(o.getPointerCount()>2)return void this.resetState();o.getCenterPoint(Ph),rh(Ph.x,Ph.y,n,Ph),ah(i,Ph,t);const h=Math.abs(i.ray.direction.dot(s));if(h<lh||h<ch)return;const u=this._raycast(i);u&&(2===o.getPointerCount()||o.isRightClicked()||o.isLeftClicked()&&e.shiftKey?(this.setState(o.isPointerTouch()?4:2),l.copy(u.point),r.position.copy(u.point),r.visible=!o.isPointerTouch()&&c,r.updateMatrixWorld(),a.add(r)):o.isLeftClicked()&&(this.setState(1),l.copy(u.point),r.position.copy(u.point),r.updateMatrixWorld(),a.add(r)))};let n=!1;const s=e=>{if(!this.enabled)return;e.preventDefault();const{pivotMesh:t,enabled:i}=this;this.zoomDirectionSet=!1,this.zoomPointSet=!1,0!==this.state&&(this.needsUpdate=!0);const{pointerTracker:s}=this;s.setHoverEvent(e),s.updatePointer(e)&&(s.isPointerTouch()&&2===s.getPointerCount()&&(n||(n=!0,queueMicrotask((()=>{n=!1,s.getCenterPoint(Lh);const e=s.getStartTouchPointerDistance(),r=s.getTouchPointerDistance(),o=r-e;if(0===this.state||4===this.state){s.getCenterPoint(Lh),s.getStartCenterPoint(Dh);const e=2*window.devicePixelRatio,t=Lh.distanceTo(Dh);(Math.abs(o)>e||t>e)&&(Math.abs(o)>t?(this.setState(3),this.zoomDirectionSet=!1):this.setState(2))}if(3===this.state){const e=s.getPreviousTouchPointerDistance();this.zoomDelta+=r-e,t.visible=!1}else 2===this.state&&(t.visible=i)})))),this.dispatchEvent(Oh))},r=t=>{if(!this.enabled)return;const{pointerTracker:i}=this;i.deletePointer(t),"touch"===i.getPointerType()&&0===i.getPointerCount()&&e.releasePointerCapture(t.pointerId),this.resetState(),this.needsUpdate=!0},o=e=>{if(!this.enabled)return;e.preventDefault();const{pointerTracker:t}=this;let i;switch(t.setHoverEvent(e),t.updatePointer(e),this.dispatchEvent(kh),e.deltaMode){case 2:i=800*e.deltaY;break;case 1:i=40*e.deltaY;break;case 0:i=e.deltaY}const n=Math.sign(i),s=Math.abs(i);this.zoomDelta-=.25*n*s,this.needsUpdate=!0,this._lastUsedState=3,this.dispatchEvent(Ih)},a=e=>{if(!this.enabled)return;const{pointerTracker:t}=this;e.buttons!==t.getPointerButtons()&&(t.deletePointer(e),this.resetState())};e.addEventListener("contextmenu",t),e.addEventListener("pointerdown",i),e.addEventListener("pointermove",s),e.addEventListener("pointerup",r),e.addEventListener("wheel",o,{passive:!1}),e.addEventListener("pointerenter",a),this._detachCallback=()=>{e.removeEventListener("contextmenu",t),e.removeEventListener("pointerdown",i),e.removeEventListener("pointermove",s),e.removeEventListener("pointerup",r),e.removeEventListener("wheel",o),e.removeEventListener("pointerenter",a)}}detach(){this.domElement=null,this._detachCallback&&(this._detachCallback(),this._detachCallback=null,this.pointerTracker.reset())}getUpDirection(e,t){t.copy(this.up)}getCameraUpDirection(e){this.getUpDirection(this.camera.position,e)}getPivotPoint(e){let t=null;3===this._lastUsedState?this._zoomPointWasSet&&(t=e.copy(this.zoomPoint)):(2===this._lastUsedState||1===this._lastUsedState)&&(t=e.copy(this.pivotPoint));const{camera:i,raycaster:n}=this;null!==t&&(ph.copy(t).project(i),(ph.x<-1||ph.x>1||ph.y<-1||ph.y>1)&&(t=null)),ah(n,{x:0,y:0},i);const s=this._raycast(n);return s&&(null===t||s.distance<t.distanceTo(n.ray.origin))&&(t=e.copy(s.point)),t}resetState(){0!==this.state&&this.dispatchEvent(Ih),this.state=0,this.pivotMesh.removeFromParent(),this.pivotMesh.visible=this.enabled,this.actionHeightOffset=0}setState(e=this.state,t=!0){this.state!==e&&(0===this.state&&t&&this.dispatchEvent(kh),this.pivotMesh.visible=this.enabled,this.dragInertia.set(0,0,0),this.rotationInertia.set(0,0),this.inertiaStableFrames=0,this.state=e,0!==e&&4!==e&&(this._lastUsedState=e))}update(e=Math.min(this.clock.getDelta(),.064)){if(!this.enabled||!this.camera||0===e)return;const{camera:t,cameraRadius:i,pivotPoint:n,up:s,state:r,adjustHeight:o,autoAdjustCameraRotation:a}=this;t.updateMatrixWorld(),this.getCameraUpDirection(wh),this._upInitialized||(this._upInitialized=!0,this.up.copy(wh)),this.zoomPointSet=!1;const l=this._inertiaNeedsUpdate(),c=this.needsUpdate||l;if(this.needsUpdate||l){const i=this.zoomDelta;this._updateZoom(),this._updatePosition(e),this._updateRotation(e),1===r||2===r?(gh.set(0,0,-1).transformDirection(t.matrixWorld),this.inertiaTargetDistance=ph.copy(n).sub(t.position).dot(gh)):0===r&&this._updateInertia(e),(0!==r||0!==i||l)&&this.dispatchEvent(Oh),this.needsUpdate=!1}const h=t.isOrthographicCamera?null:o&&this._getPointBelowCamera()||null;if(this.getCameraUpDirection(wh),this._setFrame(wh),(1===this.state||2===this.state)&&0!==this.actionHeightOffset){const{actionHeightOffset:e}=this;t.position.addScaledVector(s,-e),n.addScaledVector(s,-e),h&&(h.distance-=e)}if(this.actionHeightOffset=0,h){const e=h.distance;if(e<i){const r=i-e;t.position.addScaledVector(s,r),n.addScaledVector(s,r),this.actionHeightOffset=r}}this.pointerTracker.updateFrame(),c&&a&&(this.getCameraUpDirection(wh),this._alignCameraUp(wh,1),this.getCameraUpDirection(wh),this._clampRotation(wh))}adjustCamera(e){const{adjustHeight:t,cameraRadius:i}=this;if(e.isPerspectiveCamera){this.getUpDirection(e.position,wh);const n=t&&this._getPointBelowCamera(e.position,wh)||null;if(n){const t=n.distance;t<i&&e.position.addScaledVector(wh,i-t)}}}dispose(){this.detach()}_updateInertia(e){const{rotationInertia:t,pivotPoint:i,dragInertia:n,enableDamping:s,dampingFactor:r,camera:o,cameraRadius:a,minDistance:l,inertiaTargetDistance:c}=this;if(!this.enableDamping||this.inertiaStableFrames>1)return n.set(0,0,0),void t.set(0,0,0);const h=Math.pow(2,-e/r),u=Math.max(o.near,a,l,c),d=25e-5;if(t.lengthSq()>0){ah(Sh,ph.set(0,0,-1),o),Sh.applyMatrix4(o.matrixWorldInverse),Sh.direction.normalize(),Sh.recast(-Sh.direction.dot(Sh.origin)).at(u/Sh.direction.z,ph),ph.applyMatrix4(o.matrixWorld),ah(Sh,dh.set(d,d,-1),o),Sh.applyMatrix4(o.matrixWorldInverse),Sh.direction.normalize(),Sh.recast(-Sh.direction.dot(Sh.origin)).at(u/Sh.direction.z,dh),dh.applyMatrix4(o.matrixWorld),ph.sub(i).normalize(),dh.sub(i).normalize();const n=ph.angleTo(dh)/e;t.multiplyScalar(h),(t.lengthSq()<n**2||!s)&&t.set(0,0)}if(n.lengthSq()>0){ah(Sh,ph.set(0,0,-1),o),Sh.applyMatrix4(o.matrixWorldInverse),Sh.direction.normalize(),Sh.recast(-Sh.direction.dot(Sh.origin)).at(u/Sh.direction.z,ph),ph.applyMatrix4(o.matrixWorld),ah(Sh,dh.set(d,d,-1),o),Sh.applyMatrix4(o.matrixWorldInverse),Sh.direction.normalize(),Sh.recast(-Sh.direction.dot(Sh.origin)).at(u/Sh.direction.z,dh),dh.applyMatrix4(o.matrixWorld);const t=ph.distanceTo(dh)/e;n.multiplyScalar(h),(n.lengthSq()<t**2||!s)&&n.set(0,0,0)}t.lengthSq()>0&&this._applyRotation(t.x*e,t.y*e,i),n.lengthSq()>0&&(o.position.addScaledVector(n,e),o.updateMatrixWorld())}_inertiaNeedsUpdate(){const{rotationInertia:e,dragInertia:t}=this;return 0!==e.lengthSq()||0!==t.lengthSq()}_updateZoom(){const{zoomPoint:e,zoomDirection:t,camera:i,minDistance:n,maxDistance:s,pointerTracker:r,domElement:o,minZoom:a,maxZoom:l,zoomSpeed:c,state:h}=this;let u=this.zoomDelta;if(this.zoomDelta=0,r.getLatestPoint(Ph)&&(0!==u||3===h))if(this.rotationInertia.set(0,0),this.dragInertia.set(0,0,0),i.isOrthographicCamera){this._updateZoomDirection();const e=this.zoomPointSet||this._updateZoomPoint();Th.unproject(i);const t=Math.pow(.95,Math.abs(.05*u));let n=u>0?1/Math.abs(t):t;n*=c,n>1?l<i.zoom*n&&(n=1):a>i.zoom*n&&(n=1),i.zoom*=n,i.updateProjectionMatrix(),e&&(rh(Ph.x,Ph.y,o,Ah),Ah.unproject(i),i.position.sub(Ah).add(Th),i.updateMatrixWorld())}else{this._updateZoomDirection();const r=ph.copy(t);if(this.zoomPointSet||this._updateZoomPoint()){const r=e.distanceTo(i.position);if(u<0){const e=Math.min(0,r-s);u=u*r*c*.0025,u=Math.max(u,e)}else{const e=Math.max(0,r-n);u=u*Math.max(r-n,0)*c*.0025,u=Math.min(u,e)}i.position.addScaledVector(t,u),i.updateMatrixWorld()}else{const e=this._getPointBelowCamera();if(e){const t=e.distance;r.set(0,0,-1).transformDirection(i.matrixWorld),i.position.addScaledVector(r,u*t*.01),i.updateMatrixWorld()}}}}_updateZoomDirection(){if(this.zoomDirectionSet)return;const{domElement:e,raycaster:t,camera:i,zoomDirection:n,pointerTracker:s}=this;s.getLatestPoint(Ph),rh(Ph.x,Ph.y,e,Th),ah(t,Th,i),n.copy(t.ray.direction).normalize(),this.zoomDirectionSet=!0}_updateZoomPoint(){const{camera:e,zoomDirectionSet:t,zoomDirection:i,raycaster:n,zoomPoint:s,pointerTracker:r,domElement:o}=this;if(this._zoomPointWasSet=!1,!t)return!1;e.isOrthographicCamera&&r.getLatestPoint(Eh)?(rh(Eh.x,Eh.y,o,Eh),ah(n,Eh,e)):(n.ray.origin.copy(e.position),n.ray.direction.copy(i),n.near=0,n.far=1/0);const a=this._raycast(n);return!!a&&(s.copy(a.point),this.zoomPointSet=!0,this._zoomPointWasSet=!0,!0)}_getPointBelowCamera(e=this.camera.position,t=this.up){const{raycaster:i}=this;i.ray.direction.copy(t).multiplyScalar(-1),i.ray.origin.copy(e).addScaledVector(t,1e5),i.near=0,i.far=1/0;const n=this._raycast(i);return n&&(n.distance-=1e5),n}_updatePosition(e){const{raycaster:t,camera:i,pivotPoint:n,up:s,pointerTracker:r,domElement:o,state:a,dragInertia:l}=this;if(1===a){if(r.getCenterPoint(Ph),rh(Ph.x,Ph.y,o,Ph),bh.setFromNormalAndCoplanarPoint(s,n),ah(t,Ph,i),Math.abs(t.ray.direction.dot(s))<lh){const e=Math.acos(lh);yh.crossVectors(t.ray.direction,s).normalize(),t.ray.direction.copy(s).applyAxisAngle(yh,e).multiplyScalar(-1)}if(this.getUpDirection(n,wh),Math.abs(t.ray.direction.dot(wh))<ch){const e=Math.acos(ch);yh.crossVectors(t.ray.direction,wh).normalize(),t.ray.direction.copy(wh).applyAxisAngle(yh,e).multiplyScalar(-1)}t.ray.intersectPlane(bh,ph)&&(dh.subVectors(n,ph),i.position.add(dh),i.updateMatrixWorld(),dh.multiplyScalar(1/e),r.getMoveDistance()/e<2*window.devicePixelRatio?this.inertiaStableFrames++:(l.copy(dh),this.inertiaStableFrames=0))}}_updateRotation(e){const{pivotPoint:t,pointerTracker:i,domElement:n,state:s,rotationInertia:r}=this;2===s&&(i.getCenterPoint(Ph),i.getPreviousCenterPoint(Ch),Rh.subVectors(Ph,Ch).multiplyScalar(2*Math.PI/n.clientHeight),this._applyRotation(Rh.x,Rh.y,t),Rh.multiplyScalar(1/e),i.getMoveDistance()/e<2*window.devicePixelRatio?this.inertiaStableFrames++:(r.copy(Rh),this.inertiaStableFrames=0))}_applyRotation(e,t,i){if(0===e&&0===t)return;const{camera:n,minAltitude:s,maxAltitude:r,rotationSpeed:o}=this,a=-e*o;let l,c=t*o;gh.set(0,0,1).transformDirection(n.matrixWorld),vh.set(1,0,0).transformDirection(n.matrixWorld),this.getUpDirection(i,wh),wh.dot(gh)>1-1e-10?l=0:(ph.crossVectors(wh,gh).normalize(),l=Math.sign(ph.dot(vh))*wh.angleTo(gh)),c>0?(c=Math.min(l-s,c),c=Math.max(0,c)):(c=Math.max(l-r,c),c=Math.min(0,c)),xh.setFromAxisAngle(wh,a),sh(i,xh,hh),n.matrixWorld.premultiply(hh),vh.set(1,0,0).transformDirection(n.matrixWorld),xh.setFromAxisAngle(vh,-c),sh(i,xh,hh),n.matrixWorld.premultiply(hh),n.matrixWorld.decompose(n.position,n.quaternion,ph)}_setFrame(e){const{up:t,camera:i,zoomPoint:n,zoomDirectionSet:s,zoomPointSet:r,scaleZoomOrientationAtEdges:o}=this;if(s&&(r||this._updateZoomPoint())){if(xh.setFromUnitVectors(t,e),o){this.getUpDirection(n,ph);let e=Math.max(ph.dot(t)-.6,0)/.4;e=Y.mapLinear(e,0,.5,0,1),e=Math.min(e,1),i.isOrthographicCamera&&(e*=.1),xh.slerp(Mh,1-e)}sh(n,xh,hh),i.updateMatrixWorld(),i.matrixWorld.premultiply(hh),i.matrixWorld.decompose(i.position,i.quaternion,ph),this.zoomDirectionSet=!1,this._updateZoomDirection()}t.copy(e),i.updateMatrixWorld()}_raycast(e){const{scene:t,useFallbackPlane:i,fallbackPlane:n}=this,s=e.intersectObject(t)[0]||null;if(s)return s;if(i){const t=n;if(e.ray.intersectPlane(t,ph))return{point:ph.clone(),distance:e.ray.origin.distanceTo(ph)}}return null}_alignCameraUp(e,t=1){const{camera:i,state:n,pivotPoint:s,zoomPoint:r,zoomPointSet:o}=this;i.updateMatrixWorld(),gh.set(0,0,-1).transformDirection(i.matrixWorld),vh.set(-1,0,0).transformDirection(i.matrixWorld);let a=Y.mapLinear(1-Math.abs(gh.dot(e)),0,.2,0,1);a=Y.clamp(a,0,1),t*=a,_h.crossVectors(e,gh),_h.lerp(vh,1-t).normalize(),xh.setFromUnitVectors(vh,_h),i.quaternion.premultiply(xh);let l=null;1===n||2===n?l=mh.copy(s):o&&(l=mh.copy(r)),l&&(uh.copy(i.matrixWorld).invert(),ph.copy(l).applyMatrix4(uh),i.updateMatrixWorld(),ph.applyMatrix4(i.matrixWorld),fh.subVectors(l,ph),i.position.add(fh)),i.updateMatrixWorld()}_clampRotation(e){const{camera:t,minAltitude:i,maxAltitude:n,state:s,pivotPoint:r,zoomPoint:o,zoomPointSet:a}=this;let l,c;if(t.updateMatrixWorld(),gh.set(0,0,1).transformDirection(t.matrixWorld),vh.set(1,0,0).transformDirection(t.matrixWorld),e.dot(gh)>1-1e-10?l=0:(ph.crossVectors(e,gh),l=Math.sign(ph.dot(vh))*e.angleTo(gh)),l>n)c=n;else{if(!(l<i))return;c=i}gh.copy(e),xh.setFromAxisAngle(vh,c),gh.applyQuaternion(xh).normalize(),ph.crossVectors(gh,vh).normalize(),hh.makeBasis(vh,ph,gh),t.quaternion.setFromRotationMatrix(hh);let h=null;1===s||2===s?h=mh.copy(r):a&&(h=mh.copy(o)),h&&(uh.copy(t.matrixWorld).invert(),ph.copy(h).applyMatrix4(uh),t.updateMatrixWorld(),ph.applyMatrix4(t.matrixWorld),fh.subVectors(h,ph),t.position.add(fh)),t.updateMatrixWorld()}}const Uh=new Ne,Bh=new Ne,zh=new ie,Nh=new ie,jh=new ie,Hh=new ie,Gh=new ie,Vh=new ie,Wh=new Ve,Kh=new ie,Xh=new ie,qh=new Ge,Yh=new Hl,Zh=new te,$h={};class Qh extends Fh{get tilesGroup(){return console.warn('GlobeControls: "tilesGroup" has been deprecated. Use "ellipsoidGroup", instead.'),this.ellipsoidFrame}get ellipsoidFrame(){return this.ellipsoidGroup.matrixWorld}get ellipsoidFrameInverse(){const{ellipsoidGroup:e,ellipsoidFrame:t,_ellipsoidFrameInverse:i}=this;return e.matrixWorldInverse?e.matrixWorldInverse:i.copy(t).invert()}constructor(e=null,t=null,i=null,n=null){super(e,t,i),this.isGlobeControls=!0,this._dragMode=0,this._rotationMode=0,this.maxZoom=.01,this.nearMargin=.25,this.farMargin=0,this.useFallbackPlane=!1,this.autoAdjustCameraRotation=!1,this.globeInertia=new Ve,this.globeInertiaFactor=0,this.ellipsoid=Gl.clone(),this.ellipsoidGroup=new Ie,this._ellipsoidFrameInverse=new Ne,null!==n&&this.setTilesRenderer(n)}setTilesRenderer(e){super.setTilesRenderer(e),null!==e&&this.setEllipsoid(e.ellipsoid,e.group)}setEllipsoid(e,t){this.ellipsoid=e||Gl.clone(),this.ellipsoidGroup=t||new Ie}getPivotPoint(e){const{camera:t,ellipsoidFrame:i,ellipsoidFrameInverse:n,ellipsoid:s}=this;return Hh.set(0,0,-1).transformDirection(t.matrixWorld),qh.origin.copy(t.position),qh.direction.copy(Hh),qh.applyMatrix4(n),oh(qh,s,Nh),Nh.applyMatrix4(i),(null===super.getPivotPoint(e)||zh.subVectors(e,qh.origin).dot(qh.direction)>zh.subVectors(Nh,qh.origin).dot(qh.direction))&&e.copy(Nh),e}getVectorToCenter(e){const{ellipsoidFrame:t,camera:i}=this;return e.setFromMatrixPosition(t).sub(i.position)}getDistanceToCenter(){return this.getVectorToCenter(Nh).length()}getUpDirection(e,t){const{ellipsoidFrame:i,ellipsoidFrameInverse:n,ellipsoid:s}=this;Nh.copy(e).applyMatrix4(n),s.getPositionToNormal(Nh,t),t.transformDirection(i)}getCameraUpDirection(e){const{ellipsoidFrame:t,ellipsoidFrameInverse:i,ellipsoid:n,camera:s}=this;s.isOrthographicCamera?(this._getVirtualOrthoCameraPosition(Nh),Nh.applyMatrix4(i),n.getPositionToNormal(Nh,e),e.transformDirection(t)):this.getUpDirection(s.position,e)}update(e=Math.min(this.clock.getDelta(),.064)){if(!this.enabled||!this.camera||0===e)return;const{camera:t,pivotMesh:i}=this;this._isNearControls()?this.scaleZoomOrientationAtEdges=this.zoomDelta<0:(0!==this.state&&1!==this._dragMode&&1!==this._rotationMode&&(i.visible=!1),this.scaleZoomOrientationAtEdges=!1);const n=this.needsUpdate||this._inertiaNeedsUpdate();super.update(e),this.adjustCamera(t),n&&this._isNearControls()&&(this.getCameraUpDirection(Vh),this._alignCameraUp(Vh,1),this.getCameraUpDirection(Vh),this._clampRotation(Vh))}adjustCamera(e){super.adjustCamera(e);const{ellipsoidFrame:t,ellipsoidFrameInverse:i,ellipsoid:n,nearMargin:s,farMargin:r}=this,o=Math.max(...n.radius);if(e.isPerspectiveCamera){const a=Nh.setFromMatrixPosition(t).sub(e.position).length(),l=s*o,c=Y.clamp((a-o)/l,0,1),h=Y.lerp(1,1e3,c);e.near=Math.max(h,a-o-l),zh.copy(e.position).applyMatrix4(i),n.getPositionToCartographic(zh,$h);const u=Math.max(n.getPositionElevation(zh),2550),d=n.calculateHorizonDistance($h.lat,u);e.far=d+.1+o*r,e.updateProjectionMatrix()}else{this._getVirtualOrthoCameraPosition(e.position,e),e.updateMatrixWorld(),Uh.copy(e.matrixWorld).invert(),Nh.setFromMatrixPosition(t).applyMatrix4(Uh);const i=-Nh.z;e.near=i-o*(1+s),e.far=i+.1+o*r,e.position.addScaledVector(Hh,e.near),e.far-=e.near,e.near=0,e.updateProjectionMatrix(),e.updateMatrixWorld()}}resetState(){super.resetState(),this._dragMode=0,this._rotationMode=0}_updateInertia(e){super._updateInertia(e);const{globeInertia:t,enableDamping:i,dampingFactor:n,camera:s,cameraRadius:r,minDistance:o,inertiaTargetDistance:a,ellipsoidFrame:l}=this;if(!this.enableDamping||this.inertiaStableFrames>1)return this.globeInertiaFactor=0,void this.globeInertia.identity();const c=Math.pow(2,-e/n),h=Math.max(s.near,r,o,a),u=25e-5;if(jh.setFromMatrixPosition(l),0!==this.globeInertiaFactor){ah(qh,Nh.set(0,0,-1),s),qh.applyMatrix4(s.matrixWorldInverse),qh.direction.normalize(),qh.recast(-qh.direction.dot(qh.origin)).at(h/qh.direction.z,Nh),Nh.applyMatrix4(s.matrixWorld),ah(qh,zh.set(u,u,-1),s),qh.applyMatrix4(s.matrixWorldInverse),qh.direction.normalize(),qh.recast(-qh.direction.dot(qh.origin)).at(h/qh.direction.z,zh),zh.applyMatrix4(s.matrixWorld),Nh.sub(jh).normalize(),zh.sub(jh).normalize(),this.globeInertiaFactor*=c;const n=Nh.angleTo(zh)/e;(2*Math.acos(t.w)*this.globeInertiaFactor<n||!i)&&(this.globeInertiaFactor=0,t.identity())}0!==this.globeInertiaFactor&&(1===t.w&&(0!==t.x||0!==t.y||0!==t.z)&&(t.w=Math.min(t.w,1-1e-9)),jh.setFromMatrixPosition(l),Wh.identity().slerp(t,this.globeInertiaFactor*e),sh(jh,Wh,Bh),s.matrixWorld.premultiply(Bh),s.matrixWorld.decompose(s.position,s.quaternion,Nh))}_inertiaNeedsUpdate(){return super._inertiaNeedsUpdate()||0!==this.globeInertiaFactor}_updatePosition(e){if(1===this.state){0===this._dragMode&&(this._dragMode=this._isNearControls()?1:-1);const{raycaster:t,camera:i,pivotPoint:n,pointerTracker:s,domElement:r,ellipsoidFrame:o,ellipsoidFrameInverse:a}=this,l=zh,c=Gh;s.getCenterPoint(Zh),rh(Zh.x,Zh.y,r,Zh),ah(t,Zh,i),t.ray.applyMatrix4(a);const h=Nh.copy(n).applyMatrix4(a).length();Yh.radius.setScalar(h),i.isPerspectiveCamera?Yh.intersectRay(t.ray,Nh)||function(e,t,i){const n=e.origin.length(),s=Math.acos(t/n);i.copy(e.origin).multiplyScalar(-1).normalize();const r=nh.crossVectors(i,e.direction).normalize();i.multiplyScalar(-1).applyAxisAngle(r,-s).normalize().multiplyScalar(t)}(t.ray,h,Nh):oh(t.ray,Yh,Nh),Nh.applyMatrix4(o),jh.setFromMatrixPosition(o),l.subVectors(n,jh).normalize(),c.subVectors(Nh,jh).normalize(),Wh.setFromUnitVectors(c,l),sh(jh,Wh,Bh),i.matrixWorld.premultiply(Bh),i.matrixWorld.decompose(i.position,i.quaternion,Nh),s.getMoveDistance()/e<2*window.devicePixelRatio?this.inertiaStableFrames++:(this.globeInertia.copy(Wh),this.globeInertiaFactor=1/e,this.inertiaStableFrames=0)}}_updateRotation(...e){1===this._rotationMode||this._isNearControls()?(this._rotationMode=1,super._updateRotation(...e)):(this.pivotMesh.visible=!1,this._rotationMode=-1)}_updateZoom(){const{zoomDelta:e,ellipsoid:t,zoomSpeed:i,zoomPoint:n,camera:s,maxZoom:r,state:o}=this;if(3!==o&&0===e)return;this.rotationInertia.set(0,0),this.dragInertia.set(0,0,0),this.globeInertia.identity(),this.globeInertiaFactor=0;const a=Y.clamp(Y.mapLinear(Math.abs(e),0,20,0,1),0,1);if(this._isNearControls()||e>0){if(this._updateZoomDirection(),e<0&&(this.zoomPointSet||this._updateZoomPoint())){Hh.set(0,0,-1).transformDirection(s.matrixWorld).normalize(),Xh.copy(this.up).multiplyScalar(-1),this.getUpDirection(n,Kh);const e=Y.clamp(Y.mapLinear(-Kh.dot(Xh),1,.95,0,1),0,1),t=1-Hh.dot(Xh),i=s.isOrthographicCamera?.05:1,r=Y.clamp(3*a,0,1),o=Math.min(e*t*i*r,.1);Xh.lerpVectors(Hh,Xh,o).normalize(),Wh.setFromUnitVectors(Hh,Xh),sh(n,Wh,Bh),s.matrixWorld.premultiply(Bh),s.matrixWorld.decompose(s.position,s.quaternion,Xh),this.zoomDirection.subVectors(n,s.position).normalize()}super._updateZoom()}else if(s.isPerspectiveCamera){const n=this._getPerspectiveTransitionDistance(),s=this._getMaxPerspectiveDistance(),r=Y.mapLinear(this.getDistanceToCenter(),n,s,0,1);this._tiltTowardsCenter(Y.lerp(0,.4,r*a)),this._alignCameraUpToNorth(Y.lerp(0,.2,r*a));const o=e*(this.getDistanceToCenter()-t.radius.x)*i*.0025,l=Math.max(o,Math.min(this.getDistanceToCenter()-s,0));this.getVectorToCenter(Nh).normalize(),this.camera.position.addScaledVector(Nh,l),this.camera.updateMatrixWorld(),this.zoomDelta=0}else{const e=this._getOrthographicTransitionZoom(),t=this._getMinOrthographicZoom(),n=Y.mapLinear(s.zoom,e,t,0,1);this._tiltTowardsCenter(Y.lerp(0,.4,n*a)),this._alignCameraUpToNorth(Y.lerp(0,.2,n*a));const o=this.zoomDelta,l=Math.pow(.95,Math.abs(.05*o)),c=o>0?1/Math.abs(l):l,h=t/s.zoom,u=Math.max(c*i,Math.min(h,1));s.zoom=Math.min(r,s.zoom*u),s.updateProjectionMatrix(),this.zoomDelta=0,this.zoomDirectionSet=!1}}_alignCameraUpToNorth(e){const{ellipsoidFrame:t}=this;Vh.set(0,0,1).transformDirection(t),this._alignCameraUp(Vh,e)}_tiltTowardsCenter(e){const{camera:t,ellipsoidFrame:i}=this;Hh.set(0,0,-1).transformDirection(t.matrixWorld).normalize(),Nh.setFromMatrixPosition(i).sub(t.position).normalize(),Nh.lerp(Hh,1-e).normalize(),Wh.setFromUnitVectors(Hh,Nh),t.quaternion.premultiply(Wh),t.updateMatrixWorld()}_getPerspectiveTransitionDistance(){const{camera:e,ellipsoid:t}=this;if(!e.isPerspectiveCamera)throw new Error;const i=Math.max(...t.radius),n=2*Math.atan(Math.tan(Y.DEG2RAD*e.fov*.5)*e.aspect),s=i/Math.tan(Y.DEG2RAD*e.fov*.5),r=i/Math.tan(.5*n);return Math.max(s,r)}_getMaxPerspectiveDistance(){const{camera:e,ellipsoid:t}=this;if(!e.isPerspectiveCamera)throw new Error;const i=Math.max(...t.radius),n=2*Math.atan(Math.tan(Y.DEG2RAD*e.fov*.5)*e.aspect),s=i/Math.tan(Y.DEG2RAD*e.fov*.5),r=i/Math.tan(.5*n);return 2*Math.max(s,r)}_getOrthographicTransitionZoom(){const{camera:e,ellipsoid:t}=this;if(!e.isOrthographicCamera)throw new Error;const i=e.top-e.bottom,n=e.right-e.left;return 2*Math.max(i,n)/(2*Math.max(...t.radius))}_getMinOrthographicZoom(){const{camera:e,ellipsoid:t}=this;if(!e.isOrthographicCamera)throw new Error;const i=e.top-e.bottom,n=e.right-e.left;return.7*Math.min(i,n)/(2*Math.max(...t.radius))}_getVirtualOrthoCameraPosition(e,t=this.camera){const{ellipsoidFrame:i,ellipsoidFrameInverse:n,ellipsoid:s}=this;if(!t.isOrthographicCamera)throw new Error;qh.origin.copy(t.position),qh.direction.set(0,0,-1).transformDirection(t.matrixWorld),qh.applyMatrix4(n),oh(qh,s,zh),zh.applyMatrix4(i);const r=t.top-t.bottom,o=t.right-t.left,a=Math.max(r,o)/t.zoom;Hh.set(0,0,-1).transformDirection(t.matrixWorld);const l=zh.sub(t.position).dot(Hh);e.copy(t.position).addScaledVector(Hh,l-4*a)}_isNearControls(){const{camera:e}=this;return e.isPerspectiveCamera?this.getDistanceToCenter()<this._getPerspectiveTransitionDistance():e.zoom>this._getOrthographicTransitionZoom()}_raycast(e){const t=super._raycast(e);if(null===t){const{ellipsoid:t,ellipsoidFrame:i,ellipsoidFrameInverse:n}=this;qh.copy(e.ray).applyMatrix4(n);const s=t.intersectRay(qh,Nh);return null!==s?{point:s.clone().applyMatrix4(i)}:null}return t}}const Jh=Symbol("TILE_X"),eu=Symbol("TILE_Y"),tu=Symbol("TILE_LEVEL");class iu{get tiling(){return this.imageSource.tiling}constructor(e={}){const{pixelSize:t=.01,center:i=!1,useRecommendedSettings:n=!0,imageSource:s=null}=e;this.priority=-10,this.tiles=null,this.imageSource=s,this.pixelSize=t,this.center=i,this.useRecommendedSettings=n}init(e){this.useRecommendedSettings&&(e.errorTarget=1),this.tiles=e,this.imageSource.fetchOptions=e.fetchOptions,this.imageSource.fetchData=(t,i)=>(e.invokeAllPlugins((e=>t=e.preprocessURL?e.preprocessURL(t,null):t)),e.invokeOnePlugin((e=>e!==this&&e.fetchData&&e.fetchData(t,i))))}async loadRootTileSet(){const{tiles:e,imageSource:t}=this;let i=e.rootURL;return e.invokeAllPlugins((e=>i=e.preprocessURL?e.preprocessURL(i,null):i)),await t.init(i),this.getTileset(i)}async parseToMesh(e,t,i,n,s){if(s.aborted)return null;const r=t[Jh],o=t[eu],a=t[tu],l=await this.imageSource.processBufferToTexture(e);this.imageSource.setData(r,o,a,l);let c=1,h=1,u=0,d=0,p=0;const m=t.boundingVolume.box;m&&([u,d,p]=m,c=m[3],h=m[7]);const f=new oe(new pt(2*c,2*h),new se({map:l,transparent:!0}));return f.position.set(u,d,p),f}preprocessNode(e){const{tiling:t}=this,i=t.maxLevel;e[tu]<i&&null!==e.parent&&this.expandChildren(e)}disposeTile(e){const t=e[Jh],i=e[eu],n=e[tu],{imageSource:s}=this;s.has(t,i,n)&&s.release(t,i,n)}getTileset(e){const{tiling:t,tiles:i}=this,n=t.minLevel,{tileCountX:s,tileCountY:r}=t.getLevel(n),o=[];for(let l=0;l<s;l++)for(let e=0;e<r;e++){const t=this.createChild(l,e,n);null!==t&&o.push(t)}const a={asset:{version:"1.1"},geometricError:1e5,root:{refine:"REPLACE",geometricError:1e5,boundingVolume:this.createBoundingVolume(0,0,-1),children:o,[tu]:-1,[Jh]:0,[eu]:0}};return i.preprocessTileSet(a,e),a}getUrl(e,t,i){return this.imageSource.getUrl(e,t,i)}createBoundingVolume(e,t,i){const{center:n,pixelSize:s,tiling:r}=this,{pixelWidth:o,pixelHeight:a}=r.getLevel(r.maxLevel),[l,c,h,u]=-1===i?r.getFullBounds(!0):r.getTileBounds(e,t,i,!0);let d=(h-l)/2,p=(u-c)/2,m=l+d,f=c+p;return n&&(m-=.5,f-=.5),m*=o*s,d*=o*s,f*=a*s,p*=a*s,{box:[m,f,0,d,0,0,0,p,0,0,0,0]}}createChild(e,t,i){const{pixelSize:n,tiling:s}=this;if(!s.getTileExists(e,t,i))return null;const{pixelWidth:r,pixelHeight:o}=s.getLevel(s.maxLevel),{pixelWidth:a,pixelHeight:l}=s.getLevel(i);return{refine:"REPLACE",geometricError:n*(Math.max(r/a,o/l)-1),boundingVolume:this.createBoundingVolume(e,t,i),content:{uri:this.getUrl(e,t,i)},children:[],[Jh]:e,[eu]:t,[tu]:i}}expandChildren(e){const t=e[tu],i=e[Jh],n=e[eu];for(let s=0;s<2;s++)for(let r=0;r<2;r++){const o=this.createChild(2*i+s,2*n+r,t+1);o&&e.children.push(o)}}}const nu=new ie,su=new ie;const ru=new ie,ou=new ie,au=new te,lu=new Ye;class cu extends iu{get projection(){return this.tiling.projection}constructor(e={}){const{shape:t="planar",endCaps:i=!0,...n}=e;super(n),this.shape=t,this.endCaps=i}async parseToMesh(e,t,...i){const n=await super.parseToMesh(e,t,...i),{shape:s,projection:r,tiles:o,tiling:a}=this;if("ellipsoid"===s){const e=o.ellipsoid,i=t[tu],s=t[Jh],l=t[eu],[c,h,u,d]=a.getTileBounds(s,l,i,!0),[p,m,f,g]=t.boundingVolume.region,v=Math.ceil((g-m)*Y.RAD2DEG*.25),_=Math.ceil((f-p)*Y.RAD2DEG*.25),y=Math.max(15,v),x=Math.max(30,_),b=new pt(1,1,x,y),{position:w,normal:T,uv:A}=b.attributes,M=w.count;t.cached.boundingVolume.getSphere(lu);for(let t=0;t<M;t++){ru.fromBufferAttribute(w,t),ou.fromBufferAttribute(T,t),au.fromBufferAttribute(A,t);const i=Y.mapLinear(au.x,0,1,p,f);let n=Y.mapLinear(au.y,0,1,m,g);if(r.isMercator&&0!==au.y&&1!==au.y){const e=r.convertProjectionToLatitude(1),t=1/y,i=Y.mapLinear(au.y-t,0,1,m,g),s=Y.mapLinear(au.y+t,0,1,m,g);n>e&&i<e&&(n=e),n<-e&&s>-e&&(n=-e)}e.getCartographicToPosition(n,i,0,ru).sub(lu.center),e.getCartographicToNormal(n,i,ou);const s=Y.mapLinear(r.convertLongitudeToProjection(i),c,u,0,1),o=Y.mapLinear(r.convertLatitudeToProjection(n),h,d,0,1);A.setXY(t,s,o),w.setXYZ(t,...ru),T.setXYZ(t,...ou)}n.geometry=b,n.position.copy(lu.center)}return n}createBoundingVolume(e,t,i){if("ellipsoid"===this.shape){const{tiling:n,endCaps:s}=this,r=-1===i,o=r?n.getFullBounds(!0):n.getTileBounds(e,t,i,!0),a=r?n.getFullBounds():n.getTileBounds(e,t,i);return s&&(1===o[3]&&(a[3]=Math.PI/2),0===o[1]&&(a[1]=-Math.PI/2)),{region:[...a,-1,1]}}return super.createBoundingVolume(e,t,i)}preprocessNode(e,...t){super.preprocessNode(e,t);const{shape:i,projection:n,tiling:s}=this;if("ellipsoid"===i){const t=e[tu],i=e[Jh],r=e[eu];if(-1===t)return e.geometricError=1e50,parent;const[o,a,l,c]=s.getTileBounds(i,r,t,!0),{tilePixelWidth:h,tilePixelHeight:u}=s.getLevel(t),{pixelWidth:d,pixelHeight:p}=s.getLevel(s.maxLevel),m=(l-o)/h,f=(c-a)/u,g=1/d,v=1/p,[,_,y,x]=s.getTileBounds(i,r,t),b=_>0!=x>0?0:Math.min(Math.abs(_),Math.abs(x)),w=n.convertLatitudeToProjection(b),T=n.getLongitudeDerivativeAtProjection(o),A=n.getLatitudeDerivativeAtProjection(w),[M,S]=function(e,t,i){const n=i+1e-5;let s=t+1e-5;Math.abs(s)>Math.PI/2&&(s-=1e-5),e.getCartographicToPosition(t,i,0,nu),e.getCartographicToPosition(s,i,0,su);const r=nu.distanceTo(su)/1e-5;return e.getCartographicToPosition(t,n,0,su),[nu.distanceTo(su)/1e-5,r]}(this.tiles.ellipsoid,b,y),E=Math.max(m*T*M,f*A*S),P=Math.max(g*T*M,v*A*S);e.geometricError=E-P,null===e.parent&&(e.geometricError=1e50)}return e}}class hu{get isMercator(){return"EPSG:3857"===this.scheme}constructor(e="EPSG:4326"){this.scheme=e,this.tileCountX=1,this.tileCountY=1,this.setScheme(e)}setScheme(e){switch(this.scheme=e,e){case"EPSG:4326":this.tileCountX=2,this.tileCountY=1;break;case"EPSG:3857":this.tileCountX=1,this.tileCountY=1;break;default:throw new Error}}convertProjectionToLatitude(e){if(this.isMercator){const t=Y.mapLinear(e,0,1,-1,1);return 2*Math.atan(Math.exp(t*Math.PI))-Math.PI/2}return Y.mapLinear(e,0,1,-Math.PI/2,Math.PI/2)}convertProjectionToLongitude(e){return Y.mapLinear(e,0,1,-Math.PI,Math.PI)}convertLatitudeToProjection(e){if(this.isMercator){return.5+1*Math.log(Math.tan(Math.PI/4+e/2))/(2*Math.PI)}return Y.mapLinear(e,-Math.PI/2,Math.PI/2,0,1)}convertLongitudeToProjection(e){return(e+Math.PI)/(2*Math.PI)}getLongitudeDerivativeAtProjection(e){return 2*Math.PI}getLatitudeDerivativeAtProjection(e){let t=e-1e-5;return t<0&&(t=e+1e-5),this.isMercator?Math.abs(this.convertProjectionToLatitude(e)-this.convertProjectionToLatitude(t))/1e-5:Math.PI}getBounds(){return[this.convertProjectionToLongitude(0),this.convertProjectionToLatitude(0),this.convertProjectionToLongitude(1),this.convertProjectionToLatitude(1)]}}function uu(...e){return e.join("_")}class du{constructor(){this.cache={},this.count=0,this.cachedBytes=0}fetchItem(){}disposeItem(){}getMemoryUsage(e){return 0}setData(...e){const{cache:t}=this,i=e.pop(),n=uu(...e);if(n in t)throw new Error(`DataCache: "${n}" is already present.`);return this.cache[n]={abortController:new AbortController,result:i,count:1,bytes:this.getMemoryUsage(i)},this.count++,this.cachedBytes+=this.cache[n].bytes,i}lock(...e){const{cache:t}=this,i=uu(...e);if(i in t)t[i].count++;else{const t=new AbortController,n={abortController:t,result:null,count:1,bytes:0};n.result=this.fetchItem(...e,t.signal),n.result instanceof Promise?n.result.then((e=>(n.result=e,n.bytes=this.getMemoryUsage(e),this.cachedBytes+=n.bytes,e))):(n.bytes=this.getMemoryUsage(n.result),this.cachedBytes+=n.bytes),this.cache[i]=n,this.count++}return t[i].result}release(...e){const t=uu(...e);this.releaseViaFullKey(t)}get(...e){const{cache:t}=this,i=uu(...e);return i in t&&t[i].count>0?t[i].result:null}has(...e){const{cache:t}=this;return uu(...e)in t}dispose(){const{cache:e}=this;for(const t in e){const{abortController:i}=e[t];i.abort(),this.releaseViaFullKey(t,!0)}this.cache={}}releaseViaFullKey(e,t=!1){const{cache:i}=this;if(e in i&&i[e].count>0){const n=i[e];if(n.count--,0===n.count||t){const s=()=>{if(i[e]!==n)return;const{result:t,abortController:s}=n;s.abort(),t instanceof Promise?t.then((e=>this.disposeItem(e))).catch((()=>{})):this.disposeItem(t),delete i[e],this.count--,this.cachedBytes-=n.bytes};t?s():queueMicrotask((()=>{0===n.count&&s()}))}return!0}throw new Error("DataCache: Attempting to release key that does not exist")}}function pu(e,t,i){return Math.min(Math.max(e,t),i)}class mu{get levelCount(){return this._levels.length}get maxLevel(){return this.levelCount-1}get minLevel(){const e=this._levels;for(let t=0;t<e.length;t++)if(null!==e[t])return t;return-1}get rootBounds(){return this._rootBounds??this.projection?.getBounds()??[0,0,1,1]}get rootOrigin(){const e=this.rootBounds;return this._rootOrigin??[e[0],e[1]]}get aspect(){const{pixelWidth:e,pixelHeight:t}=this.getLevel(this.maxLevel);return e/t}constructor(){this.flipY=!1,this.pixelOverlap=0,this._rootBounds=null,this._rootOrigin=null,this.projection=null,this._levels=[]}setLevel(e,t={}){const i=this._levels;for(;i.length<e;)i.push(null);const{tilePixelWidth:n=256,tilePixelHeight:s=256,tileCountX:r=2**e,tileCountY:o=2**e}=t,{pixelWidth:a=n*r,pixelHeight:l=s*o}=t;i[e]={tilePixelWidth:n,tilePixelHeight:s,pixelWidth:a,pixelHeight:l,tileCountX:r,tileCountY:o}}generateLevels(e,t,i,n={}){const{minLevel:s=0,tilePixelWidth:r=256,tilePixelHeight:o=256}=n,a=e-1,{pixelWidth:l=r*t*2**a,pixelHeight:c=o*i*2**a}=n;for(let h=s;h<e;h++){const t=e-h-1,i=Math.ceil(l*2**-t),n=Math.ceil(c*2**-t),s=Math.ceil(i/r),a=Math.ceil(n/o);this.setLevel(h,{tilePixelWidth:r,tilePixelHeight:o,pixelWidth:i,pixelHeight:n,tileCountX:s,tileCountY:a})}}getLevel(e){return this._levels[e]}setOrigin(e,t){this._rootOrigin=[e,t]}setBounds(e,t,i,n){this._rootBounds=[e,t,i,n]}setProjection(e){this.projection=e}getTileAtPoint(e,t,i,n=!1){const{projection:s,flipY:r}=this,{tileCountX:o,tileCountY:a}=this.getLevel(i),l=1/o,c=1/a;s&&!n&&(e=s.convertLongitudeToProjection(e),t=s.convertLatitudeToProjection(t));const h=Math.floor(e/l);let u=Math.floor(t/c);return r&&(u=a-1-u),[h,u]}getTilesInRange(e,t,i,n,s,r=!1){const o=this.getTileAtPoint(e,t,s,r,!1),a=this.getTileAtPoint(i,n,s,r,!1);this.flipY&&([o[1],a[1]]=[a[1],o[1]]);const{tileCountX:l,tileCountY:c}=this.getLevel(s),[h,u]=o,[d,p]=a;return d<0||p<0||h>=l||u>=c?[0,0,-1,-1]:[pu(h,0,l-1),pu(u,0,c-1),pu(d,0,l-1),pu(p,0,c-1)]}getTileExists(e,t,i){const[n,s,r,o]=this.rootBounds,[a,l,c,h]=this.getTileBounds(e,t,i);return!(a>=c||l>=h)&&a<=r&&l<=o&&c>=n&&h>=s}getFullBounds(e=!1){const{projection:t}=this,i=[...this.rootBounds];return t&&e&&(i[0]=t.convertLongitudeToProjection(i[0]),i[1]=t.convertLatitudeToProjection(i[1]),i[2]=t.convertLongitudeToProjection(i[2]),i[3]=t.convertLatitudeToProjection(i[3])),i}getTileBounds(e,t,i,n=!1){const{flipY:s,pixelOverlap:r,projection:o}=this,{tilePixelWidth:a,tilePixelHeight:l,pixelWidth:c,pixelHeight:h}=this.getLevel(i);let u=a*e-r,d=l*t-r,p=u+a+2*r,m=d+l+2*r;if(u=Math.max(u,0),d=Math.max(d,0),p=Math.min(p,c),m=Math.min(m,h),u/=c,p/=c,d/=h,m/=h,s){const e=(m-d)/2,t=1-(d+m)/2;d=t-e,m=t+e}const f=[u,d,p,m];return o&&!n&&(f[0]=o.convertProjectionToLongitude(f[0]),f[1]=o.convertProjectionToLatitude(f[1]),f[2]=o.convertProjectionToLongitude(f[2]),f[3]=o.convertProjectionToLatitude(f[3])),f}toNormalizedPoint(e,t){const{projection:i}=this,n=[e,t];return this.projection&&(n[0]=i.convertLongitudeToProjection(n[0]),n[1]=i.convertLatitudeToProjection(n[1])),n}toNormalizedRange(e){return[...this.toNormalizedPoint(e[0],e[1]),...this.toNormalizedPoint(e[2],e[3])]}clampToBounds(e,t=!1){const i=[...e],{projection:n}=this;if(t||!n)i[0]=pu(i[0],0,1),i[1]=pu(i[1],0,1),i[2]=pu(i[2],0,1),i[3]=pu(i[3],0,1);else{const[e,t,s,r]=n.getBounds();i[0]=pu(i[0],e,s),i[1]=pu(i[1],t,r),i[2]=pu(i[2],e,s),i[3]=pu(i[3],t,r)}return i}}class fu extends du{constructor(){super(),this.tiling=new mu,this.fetchOptions={},this.fetchData=(...e)=>fetch(...e)}init(e){}async processBufferToTexture(e){const t=new Blob([e]),i=await createImageBitmap(t,{premultiplyAlpha:"none",colorSpaceConversion:"none",imageOrientation:"flipY"}),n=new Ae(i);return n.generateMipmaps=!1,n.colorSpace=X,n.needsUpdate=!0,n}getMemoryUsage(e){const{TextureUtils:t}=ne;if(!t)return 0;const{format:i,type:n,image:s,generateMipmaps:r}=e,{width:o,height:a}=s,l=t.getByteLength(o,a,i,n);return r?4*l/3:l}fetchItem(...e){const t=this.getUrl(...e);return this.fetchData(t,this.fetchOptions).then((e=>e.arrayBuffer())).then((e=>this.processBufferToTexture(e)))}disposeItem(e){e.dispose(),e.image instanceof ImageBitmap&&e.image.close()}getUrl(...e){}}class gu extends fu{constructor(e={}){super();const{levels:t=20,tileDimension:i=256}=e;this.tileDimension=i,this.levels=t,this.url=null}getUrl(e,t,i){return this.url.replace("{z}",i).replace("{x}",e).replace("{y}",t)}init(e){const{tiling:t,tileDimension:i,levels:n}=this;return t.flipY=!0,t.setProjection(new hu("EPSG:3857")),t.generateLevels(n,1,1,{tilePixelWidth:i,tilePixelHeight:i}),this.url=e,Promise.resolve()}}class vu extends cu{constructor(e={}){const{levels:t=20,tileDimension:i=256,pixelSize:n=1e-5,...s}=e;super({pixelSize:n,...s}),this.name="XYZ_TILES_PLUGIN",this.imageSource=new gu({levels:t,tileDimension:i})}}const _u=new Ne;class yu{constructor(){this.name="UPDATE_ON_CHANGE_PLUGIN",this.tiles=null,this.needsUpdate=!1,this.cameraMatrices=new Map}init(e){this.tiles=e,this._needsUpdateCallback=()=>{this.needsUpdate=!0},this._onCameraAdd=({camera:e})=>{this.needsUpdate=!0,this.cameraMatrices.set(e,new Ne)},this._onCameraDelete=({camera:e})=>{this.needsUpdate=!0,this.cameraMatrices.delete(e)},e.addEventListener("needs-update",this._needsUpdateCallback),e.addEventListener("add-camera",this._onCameraAdd),e.addEventListener("delete-camera",this._onCameraDelete),e.addEventListener("camera-resolution-change",this._needsUpdateCallback),e.cameras.forEach((e=>{this._onCameraAdd({camera:e})}))}doTilesNeedUpdate(){const e=this.tiles;let t=!1;this.cameraMatrices.forEach(((i,n)=>{_u.copy(e.group.matrixWorld).premultiply(n.matrixWorldInverse).premultiply(n.projectionMatrixInverse),t=t||!_u.equals(i),i.copy(_u)}));const i=this.needsUpdate;return this.needsUpdate=!1,i||t}preprocessNode(){this.needsUpdate=!0}dispose(){const e=this.tiles;e.removeEventListener("camera-resolution-change",this._needsUpdateCallback),e.removeEventListener("load-content",this._needsUpdateCallback),e.removeEventListener("camera-add",this._onCameraAdd),e.removeEventListener("camera-delete",this._onCameraDelete)}}const{clamp:xu}=Y;class bu{constructor(){this.duration=250,this.fadeCount=0,this._lastTick=-1,this._fadeState=new Map,this.onFadeComplete=null,this.onFadeStart=null,this.onFadeSetComplete=null,this.onFadeSetStart=null}deleteObject(e){e&&this.completeFade(e)}guaranteeState(e){const t=this._fadeState;if(t.has(e))return!1;return t.set(e,{fadeInTarget:0,fadeOutTarget:0,fadeIn:0,fadeOut:0}),!0}completeFade(e){const t=this._fadeState;if(!t.has(e))return;const i=0===t.get(e).fadeOutTarget;t.delete(e),this.fadeCount--,this.onFadeComplete&&this.onFadeComplete(e,i),0===this.fadeCount&&this.onFadeSetComplete&&this.onFadeSetComplete()}completeAllFades(){this._fadeState.forEach(((e,t)=>{this.completeFade(t)}))}forEachObject(e){this._fadeState.forEach(((t,i)=>{e(i,t)}))}fadeIn(e){const t=this.guaranteeState(e),i=this._fadeState.get(e);i.fadeInTarget=1,i.fadeOutTarget=0,i.fadeOut=0,t&&(this.fadeCount++,1===this.fadeCount&&this.onFadeSetStart&&this.onFadeSetStart(),this.onFadeStart&&this.onFadeStart(e))}fadeOut(e){const t=this.guaranteeState(e),i=this._fadeState.get(e);i.fadeOutTarget=1,t&&(i.fadeInTarget=1,i.fadeIn=1,this.fadeCount++,1===this.fadeCount&&this.onFadeSetStart&&this.onFadeSetStart(),this.onFadeStart&&this.onFadeStart(e))}isFading(e){return this._fadeState.has(e)}isFadingOut(e){const t=this._fadeState.get(e);return t&&1===t.fadeOutTarget}update(){const e=window.performance.now();-1===this._lastTick&&(this._lastTick=e);const t=xu((e-this._lastTick)/this.duration,0,1);this._lastTick=e,this._fadeState.forEach(((e,i)=>{const{fadeOutTarget:n,fadeInTarget:s}=e;let{fadeOut:r,fadeIn:o}=e;const a=Math.sign(s-o);o=xu(o+a*t,0,1);const l=Math.sign(n-r);r=xu(r+l*t,0,1),e.fadeIn=o,e.fadeOut=r,((1===r||0===r)&&(1===o||0===o)||r>=o)&&this.completeFade(i)}))}}const wu=Symbol("FADE_PARAMS");function Tu(e,t){if(e[wu])return e[wu];const i={fadeIn:{value:0},fadeOut:{value:0},fadeTexture:{value:null}};return e[wu]=i,e.defines={...e.defines||{},FEATURE_FADE:0},e.onBeforeCompile=e=>{t&&t(e),e.uniforms={...e.uniforms,...i},e.vertexShader=e.vertexShader.replace(/void\s+main\(\)\s+{/,(e=>`\n\t\t\t\t\t#ifdef USE_BATCHING_FRAG\n\n\t\t\t\t\tvarying float vBatchId;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\t${e}\n\n\t\t\t\t\t\t#ifdef USE_BATCHING_FRAG\n\n\t\t\t\t\t\t// add 0.5 to the value to avoid floating error that may cause flickering\n\t\t\t\t\t\tvBatchId = getIndirectIndex( gl_DrawID ) + 0.5;\n\n\t\t\t\t\t\t#endif\n\t\t\t\t`)),e.fragmentShader=e.fragmentShader.replace(/void main\(/,(e=>`\n\t\t\t\t#if FEATURE_FADE\n\n\t\t\t\t// adapted from https://www.shadertoy.com/view/Mlt3z8\n\t\t\t\tfloat bayerDither2x2( vec2 v ) {\n\n\t\t\t\t\treturn mod( 3.0 * v.y + 2.0 * v.x, 4.0 );\n\n\t\t\t\t}\n\n\t\t\t\tfloat bayerDither4x4( vec2 v ) {\n\n\t\t\t\t\tvec2 P1 = mod( v, 2.0 );\n\t\t\t\t\tvec2 P2 = floor( 0.5 * mod( v, 4.0 ) );\n\t\t\t\t\treturn 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );\n\n\t\t\t\t}\n\n\t\t\t\t// the USE_BATCHING define is not available in fragment shaders\n\t\t\t\t#ifdef USE_BATCHING_FRAG\n\n\t\t\t\t// functions for reading the fade state of a given batch id\n\t\t\t\tuniform sampler2D fadeTexture;\n\t\t\t\tvarying float vBatchId;\n\t\t\t\tvec2 getFadeValues( const in float i ) {\n\n\t\t\t\t\tint size = textureSize( fadeTexture, 0 ).x;\n\t\t\t\t\tint j = int( i );\n\t\t\t\t\tint x = j % size;\n\t\t\t\t\tint y = j / size;\n\t\t\t\t\treturn texelFetch( fadeTexture, ivec2( x, y ), 0 ).rg;\n\n\t\t\t\t}\n\n\t\t\t\t#else\n\n\t\t\t\tuniform float fadeIn;\n\t\t\t\tuniform float fadeOut;\n\n\t\t\t\t#endif\n\n\t\t\t\t#endif\n\n\t\t\t\t${e}\n\t\t\t`)).replace(/#include <dithering_fragment>/,(e=>`\n\n\t\t\t\t${e}\n\n\t\t\t\t#if FEATURE_FADE\n\n\t\t\t\t#ifdef USE_BATCHING_FRAG\n\n\t\t\t\tvec2 fadeValues = getFadeValues( vBatchId );\n\t\t\t\tfloat fadeIn = fadeValues.r;\n\t\t\t\tfloat fadeOut = fadeValues.g;\n\n\t\t\t\t#endif\n\n\t\t\t\tfloat bayerValue = bayerDither4x4( floor( mod( gl_FragCoord.xy, 4.0 ) ) );\n\t\t\t\tfloat bayerBins = 16.0;\n\t\t\t\tfloat dither = ( 0.5 + bayerValue ) / bayerBins;\n\t\t\t\tif ( dither >= fadeIn ) {\n\n\t\t\t\t\tdiscard;\n\n\t\t\t\t}\n\n\t\t\t\tif ( dither < fadeOut ) {\n\n\t\t\t\t\tdiscard;\n\n\t\t\t\t}\n\n\t\t\t\t#endif\n\n\t\t\t`))},i}class Au{constructor(){this._fadeParams=new WeakMap,this.fading=0}setFade(e,t,i){if(!e)return;const n=this._fadeParams;e.traverse((e=>{const s=e.material;if(s){const e=n.get(s);e.fadeIn.value=t,e.fadeOut.value=i;const r=+(!(0===t||1===t)||!(0===i||1===i));s.defines.FEATURE_FADE!==r&&(this.fading+=1===r?1:-1,s.defines.FEATURE_FADE=r,s.needsUpdate=!0)}}))}prepareScene(e){e.traverse((e=>{e.material&&this.prepareMaterial(e.material)}))}deleteScene(e){if(!e)return;this.setFade(e,1,0);const t=this._fadeParams;e.traverse((e=>{const i=e.material;i&&t.delete(i)}))}prepareMaterial(e){const t=this._fadeParams;t.has(e)||t.set(e,Tu(e,e.onBeforeCompile))}}class Mu{constructor(e,t=new se){this.other=e,this.material=t,this.visible=!0,this.parent=null,this._instanceInfo=[],this._visibilityChanged=!0;const i=new Proxy(this,{get(t,n){if(n in t)return t[n];{const s=e[n];return s instanceof Function?(...e)=>(t.syncInstances(),s.call(i,...e)):e[n]}},set:(t,i,n)=>(i in t?t[i]=n:e[i]=n,!0),deleteProperty:(t,i)=>i in t?delete t[i]:delete e[i]});return i}syncInstances(){const e=this._instanceInfo,t=this.other._instanceInfo;for(;t.length>e.length;){const i=e.length;e.push(new Proxy({visible:!1},{get:(e,n)=>n in e?e[n]:t[i][n],set:(e,n,s)=>(n in e?e[n]=s:t[i][n]=s,!0)}))}}}class Su extends Mu{constructor(...e){super(...e);const t=this.material,i=Tu(t,t.onBeforeCompile);t.defines.FEATURE_FADE=1,t.defines.USE_BATCHING_FRAG=1,t.needsUpdate=!0,this.fadeTexture=null,this._fadeParams=i}setFadeAt(e,t,i){this._initFadeTexture(),this.fadeTexture.setValueAt(e,255*t,255*i)}_initFadeTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=e*e*2,i=this.fadeTexture;if(!i||i.image.data.length!==t){const n=new Uint8Array(t),s=new Eu(n,e,e,dt,ae);if(i){i.dispose();const e=i.image.data,t=this.fadeTexture.image.data,n=Math.min(e.length,t.length);t.set(new e.constructor(e.buffer,0,n))}this.fadeTexture=s,this._fadeParams.fadeTexture.value=s,s.needsUpdate=!0}}dispose(){this.fadeTexture&&this.fadeTexture.dispose()}}class Eu extends zt{setValueAt(e,...t){const{data:i,width:n,height:s}=this.image,r=Math.floor(i.length/(n*s));let o=!1;for(let a=0;a<r;a++){const n=e*r+a,s=i[n],l=t[a]||0;s!==l&&(i[n]=l,o=!0)}o&&(this.needsUpdate=!0)}}const Pu=Symbol("HAS_POPPED_IN"),Cu=new ie,Ru=new ie,Lu=new Ve,Du=new Ve,Ou=new ie;function ku(){const e=this._fadeManager,t=this.tiles;this._fadingBefore=e.fadeCount,this._displayActiveTiles=t.displayActiveTiles,t.displayActiveTiles=!0}function Iu(){const e=this._fadeManager,t=this._fadeMaterialManager,i=this._displayActiveTiles,n=this._fadingBefore,s=this._prevCameraTransforms,{tiles:r,maximumFadeOutTiles:o,batchedMesh:a}=this,{cameras:l}=r;r.displayActiveTiles=i,e.update();const c=e.fadeCount;if(0!==n&&0!==c&&(r.dispatchEvent({type:"fade-change"}),r.dispatchEvent({type:"needs-render"})),i||r.visibleTiles.forEach((e=>{const t=e.cached.scene;t&&(t.visible=e.__inFrustum),this.forEachBatchIds(e,((t,i,n)=>{i.setVisibleAt(t,e.__inFrustum),n.batchedMesh.setVisibleAt(t,e.__inFrustum)}))})),o<this._fadingOutCount){let t=!0;l.forEach((e=>{if(!s.has(e))return;const i=e.matrixWorld,n=s.get(e);i.decompose(Ru,Du,Ou),n.decompose(Cu,Lu,Ou);const r=Du.angleTo(Lu),o=Ru.distanceTo(Cu);t=t&&(r>.25||o>.1)})),t&&e.completeAllFades()}if(l.forEach((e=>{s.get(e).copy(e.matrixWorld)})),e.forEachObject(((i,{fadeIn:n,fadeOut:s})=>{const o=i.cached.scene,a=e.isFadingOut(i);r.markTileUsed(i),o&&(t.setFade(o,n,s),a&&(o.visible=!0)),this.forEachBatchIds(i,((e,t,i)=>{t.setFadeAt(e,n,s),t.setVisibleAt(e,!0),i.batchedMesh.setVisibleAt(e,!1)}))})),a){const e=r.getPluginByName("BATCHED_TILES_PLUGIN").batchedMesh.material;a.material.map=e.map}}class Fu{get fadeDuration(){return this._fadeManager.duration}set fadeDuration(e){this._fadeManager.duration=Number(e)}get fadingTiles(){return this._fadeManager.fadeCount}constructor(e){e={maximumFadeOutTiles:50,fadeRootTiles:!1,fadeDuration:250,...e},this.name="FADE_TILES_PLUGIN",this.priority=-2,this.tiles=null,this.batchedMesh=null,this._fadeManager=new bu,this._fadeMaterialManager=new Au,this._prevCameraTransforms=null,this._fadingOutCount=0,this.maximumFadeOutTiles=e.maximumFadeOutTiles,this.fadeRootTiles=e.fadeRootTiles,this.fadeDuration=e.fadeDuration}init(e){this._onLoadModel=({scene:e})=>{this._fadeMaterialManager.prepareScene(e)},this._onDisposeModel=({tile:e,scene:t})=>{this._fadeManager.deleteObject(e),this._fadeMaterialManager.deleteScene(t)},this._onAddCamera=({camera:e})=>{this._prevCameraTransforms.set(e,new Ne)},this._onDeleteCamera=({camera:e})=>{this._prevCameraTransforms.delete(e)},this._onTileVisibilityChange=({tile:e,visible:t})=>{const i=e.cached.scene;i&&(i.visible=!0),this.forEachBatchIds(e,((e,t,i)=>{t.setFadeAt(e,0,0),t.setVisibleAt(e,!1),i.batchedMesh.setVisibleAt(e,!1)}))},this._onUpdateBefore=()=>{ku.call(this)},this._onUpdateAfter=()=>{Iu.call(this)},e.addEventListener("load-model",this._onLoadModel),e.addEventListener("dispose-model",this._onDisposeModel),e.addEventListener("add-camera",this._onAddCamera),e.addEventListener("delete-camera",this._onDeleteCamera),e.addEventListener("update-before",this._onUpdateBefore),e.addEventListener("update-after",this._onUpdateAfter),e.addEventListener("tile-visibility-change",this._onTileVisibilityChange);const t=this._fadeManager;t.onFadeSetStart=()=>{e.dispatchEvent({type:"fade-start"}),e.dispatchEvent({type:"needs-render"})},t.onFadeSetComplete=()=>{e.dispatchEvent({type:"fade-end"}),e.dispatchEvent({type:"needs-render"})},t.onFadeComplete=(t,i)=>{this._fadeMaterialManager.setFade(t.cached.scene,0,0),this.forEachBatchIds(t,((e,t,n)=>{t.setFadeAt(e,0,0),t.setVisibleAt(e,!1),n.batchedMesh.setVisibleAt(e,i)})),i||(e.invokeOnePlugin((e=>e!==this&&e.setTileVisible&&e.setTileVisible(t,!1))),this._fadingOutCount--)};const i=new Map;e.cameras.forEach((e=>{i.set(e,new Ne)})),e.forEachLoadedModel(((e,t)=>{this._onLoadModel({scene:e})})),this.tiles=e,this._fadeManager=t,this._prevCameraTransforms=i}initBatchedMesh(){const e=this.tiles.getPluginByName("BATCHED_TILES_PLUGIN")?.batchedMesh;if(e){if(null===this.batchedMesh){this._onBatchedMeshDispose=()=>{this.batchedMesh.dispose(),this.batchedMesh.removeFromParent(),this.batchedMesh=null,e.removeEventListener("dispose",this._onBatchedMeshDispose)};const t=e.material.clone();t.onBeforeCompile=e.material.onBeforeCompile,this.batchedMesh=new Su(e,t),this.tiles.group.add(this.batchedMesh)}}else null!==this.batchedMesh&&(this._onBatchedMeshDispose(),this._onBatchedMeshDispose=null)}setTileVisible(e,t){const i=this._fadeManager,n=i.isFading(e);if(i.isFadingOut(e)&&this._fadingOutCount--,t?1===e.__depthFromRenderedParent?((e[Pu]||this.fadeRootTiles)&&this._fadeManager.fadeIn(e),e[Pu]=!0):this._fadeManager.fadeIn(e):(this._fadingOutCount++,i.fadeOut(e)),n)return!0;const s=this._fadeManager.isFading(e);return!(t||!s)}dispose(){const e=this.tiles;this._fadeManager.completeAllFades(),null!==this.batchedMesh&&this._onBatchedMeshDispose(),e.removeEventListener("load-model",this._onLoadModel),e.removeEventListener("dispose-model",this._onDisposeModel),e.removeEventListener("add-camera",this._onAddCamera),e.removeEventListener("delete-camera",this._onDeleteCamera),e.removeEventListener("update-before",this._onUpdateBefore),e.removeEventListener("update-after",this._onUpdateAfter),e.removeEventListener("tile-visibility-change",this._onTileVisibilityChange),e.forEachLoadedModel(((e,t)=>{this._fadeManager.deleteObject(t),e&&(e.visible=!0)}))}forEachBatchIds(e,t){if(this.initBatchedMesh(),this.batchedMesh){const i=this.tiles.getPluginByName("BATCHED_TILES_PLUGIN"),n=i.getTileBatchIds(e);n&&n.forEach((e=>{t(e,this.batchedMesh,i)}))}}}const Uu=new ie,Bu=["x","y","z"];class zu extends lt{constructor(e,t=16776960,i=40){const n=new Me,s=[];for(let r=0;r<3;r++){const e=Bu[r],t=Bu[(r+1)%3];Uu.set(0,0,0);for(let n=0;n<i;n++){let r;r=2*Math.PI*n/(i-1),Uu[e]=Math.sin(r),Uu[t]=Math.cos(r),s.push(Uu.x,Uu.y,Uu.z),r=2*Math.PI*(n+1)/(i-1),Uu[e]=Math.sin(r),Uu[t]=Math.cos(r),s.push(Uu.x,Uu.y,Uu.z)}}n.setAttribute("position",new $(new Float32Array(s),3)),n.computeBoundingSphere(),super(n,new ct({color:t,toneMapped:!1})),this.sphere=e,this.type="SphereHelper"}updateMatrixWorld(e){const t=this.sphere;this.position.copy(t.center),this.scale.setScalar(t.radius),super.updateMatrixWorld(e)}}const Nu=new ie,ju=new ie,Hu=new ie;new ie,new ie;class Gu extends lt{constructor(e=new Rc,t=16776960){super(),this.ellipsoidRegion=e,this.material.color.set(t),this.update()}update(){const e=function(e,{computeNormals:t=!1}={}){const{latStart:i=-Math.PI/2,latEnd:n=Math.PI/2,lonStart:s=0,lonEnd:r=2*Math.PI,heightStart:o=0,heightEnd:a=0}=e,l=new et(1,1,1,32,32),{normal:c,position:h}=l.attributes,u=h.clone();for(let d=0,p=h.count;d<p;d++){Hu.fromBufferAttribute(h,d);const t=Y.mapLinear(Hu.x,-.5,.5,i,n),l=Y.mapLinear(Hu.y,-.5,.5,s,r);let c=o;e.getCartographicToNormal(t,l,Nu),Hu.z<0&&(c=a),e.getCartographicToPosition(t,l,c,Hu),h.setXYZ(d,...Hu)}t&&l.computeVertexNormals();for(let d=0,p=u.count;d<p;d++){Hu.fromBufferAttribute(u,d);const t=Y.mapLinear(Hu.x,-.5,.5,i,n),o=Y.mapLinear(Hu.y,-.5,.5,s,r);Nu.fromBufferAttribute(c,d),e.getCartographicToNormal(t,o,ju),Math.abs(Nu.dot(ju))>.1&&(Hu.z>0&&ju.multiplyScalar(-1),c.setXYZ(d,...ju))}return l}(this.ellipsoidRegion);this.geometry.dispose(),this.geometry=new ht(e,80)}dispose(){this.geometry.dispose(),this.material.dispose()}}const Vu=Symbol("ORIGINAL_MATERIAL"),Wu=Symbol("HAS_RANDOM_COLOR"),Ku=Symbol("HAS_RANDOM_NODE_COLOR"),Xu=Symbol("LOAD_TIME"),qu=Symbol("PARENT_BOUND_REF_COUNT"),Yu=new Ye,Zu=()=>{},$u={};function Qu(e){if(!$u[e]){const t=Math.random(),i=.5+.5*Math.random(),n=.375+.25*Math.random();$u[e]=(new q).setHSL(t,i,n)}return $u[e]}const Ju=Object.freeze({NONE:0,SCREEN_ERROR:1,GEOMETRIC_ERROR:2,DISTANCE:3,DEPTH:4,RELATIVE_DEPTH:5,IS_LEAF:6,RANDOM_COLOR:7,RANDOM_NODE_COLOR:8,CUSTOM_COLOR:9,LOAD_ORDER:10});class ed{static get ColorModes(){return Ju}get unlit(){return this._unlit}set unlit(e){e!==this._unlit&&(this._unlit=e,this.materialsNeedUpdate=!0)}get colorMode(){return this._colorMode}set colorMode(e){e!==this._colorMode&&(this._colorMode=e,this.materialsNeedUpdate=!0)}constructor(e){e={displayParentBounds:!1,displayBoxBounds:!1,displaySphereBounds:!1,displayRegionBounds:!1,colorMode:0,maxDebugDepth:-1,maxDebugDistance:-1,maxDebugError:-1,customColorCallback:null,unlit:!1,enabled:!0,...e},this.name="DEBUG_TILES_PLUGIN",this.tiles=null,this._colorMode=null,this._unlit=null,this.materialsNeedUpdate=!1,this.extremeDebugDepth=-1,this.extremeDebugError=-1,this.boxGroup=null,this.sphereGroup=null,this.regionGroup=null,this._enabled=e.enabled,this._displayParentBounds=e.displayParentBounds,this.displayBoxBounds=e.displayBoxBounds,this.displaySphereBounds=e.displaySphereBounds,this.displayRegionBounds=e.displayRegionBounds,this.colorMode=e.colorMode,this.maxDebugDepth=e.maxDebugDepth,this.maxDebugDistance=e.maxDebugDistance,this.maxDebugError=e.maxDebugError,this.customColorCallback=e.customColorCallback,this.unlit=e.unlit,this.getDebugColor=(e,t)=>{t.setRGB(e,e,e)}}get enabled(){return this._enabled}set enabled(e){e!==this._enabled&&null!==this.tiles&&(e?this.init(this.tiles):this.dispose()),this._enabled=e}get displayParentBounds(){return this._displayParentBounds}set displayParentBounds(e){this._displayParentBounds!==e&&(this._displayParentBounds=e,e?this.tiles.traverse((e=>{e.__visible&&this._onTileVisibilityChange(e,!0)})):sa(this.tiles.root,null,(e=>{e[qu]=null,this._onTileVisibilityChange(e,e.__visible)})))}init(e){if(this.tiles=e,!this.enabled)return;const t=e.group;this.boxGroup=new Ie,this.boxGroup.name="DebugTilesRenderer.boxGroup",t.add(this.boxGroup),this.boxGroup.updateMatrixWorld(),this.sphereGroup=new Ie,this.sphereGroup.name="DebugTilesRenderer.sphereGroup",t.add(this.sphereGroup),this.sphereGroup.updateMatrixWorld(),this.regionGroup=new Ie,this.regionGroup.name="DebugTilesRenderer.regionGroup",t.add(this.regionGroup),this.regionGroup.updateMatrixWorld(),this._onLoadTileSetCB=()=>{this._initExtremes()},this._onLoadModelCB=({scene:e,tile:t})=>{this._onLoadModel(e,t)},this._onDisposeModelCB=({tile:e})=>{this._onDisposeModel(e)},this._onUpdateAfterCB=()=>{this._onUpdateAfter()},this._onTileVisibilityChangeCB=({scene:e,tile:t,visible:i})=>{this._onTileVisibilityChange(t,i)},e.addEventListener("load-tile-set",this._onLoadTileSetCB),e.addEventListener("load-model",this._onLoadModelCB),e.addEventListener("dispose-model",this._onDisposeModelCB),e.addEventListener("update-after",this._onUpdateAfterCB),e.addEventListener("tile-visibility-change",this._onTileVisibilityChangeCB),this._initExtremes(),e.traverse((e=>{e.cached.scene&&this._onLoadModel(e.cached.scene,e)})),e.visibleTiles.forEach((e=>{this._onTileVisibilityChange(e,!0)}))}getTileInformationFromActiveObject(e){let t=null;return this.tiles.activeTiles.forEach((i=>{if(t)return!0;const n=i.cached.scene;n&&n.traverse((n=>{n===e&&(t=i)}))})),t?{distanceToCamera:t.__distanceFromCamera,geometricError:t.geometricError,screenSpaceError:t.__error,depth:t.__depth,isLeaf:t.__isLeaf}:null}_initExtremes(){if(!this.tiles||!this.tiles.root)return;let e=-1,t=-1;sa(this.tiles.root,null,((i,n,s)=>{e=Math.max(e,s),t=Math.max(t,i.geometricError)})),this.extremeDebugDepth=e,this.extremeDebugError=t}_onUpdateAfter(){const{tiles:e,colorMode:t}=this;if(!e.root)return;this.materialsNeedUpdate&&(e.forEachLoadedModel((e=>{this._updateMaterial(e)})),this.materialsNeedUpdate=!1),this.boxGroup.visible=this.displayBoxBounds,this.sphereGroup.visible=this.displaySphereBounds,this.regionGroup.visible=this.displayRegionBounds;let i=-1;i=-1===this.maxDebugDepth?this.extremeDebugDepth:this.maxDebugDepth;let n=-1;n=-1===this.maxDebugError?this.extremeDebugError:this.maxDebugError;let s=-1;-1===this.maxDebugDistance?(e.getBoundingSphere(Yu),s=Yu.radius):s=this.maxDebugDistance;const{errorTarget:r,visibleTiles:o}=e;let a;10===t&&(a=Array.from(o).sort(((e,t)=>e[Xu]-t[Xu]))),o.forEach((e=>{const o=e.cached.scene;let l,c,h;7===t&&(l=Math.random(),c=.5+.5*Math.random(),h=.375+.25*Math.random()),o.traverse((o=>{if(8===t&&(l=Math.random(),c=.5+.5*Math.random(),h=.375+.25*Math.random()),o.material)switch(7!==t&&delete o.material[Wu],8!==t&&delete o.material[Ku],t){case 4:{const t=e.__depth/i;this.getDebugColor(t,o.material.color);break}case 5:{const t=e.__depthFromRenderedParent/i;this.getDebugColor(t,o.material.color);break}case 1:{const t=e.__error/r;t>1?o.material.color.setRGB(1,0,0):this.getDebugColor(t,o.material.color);break}case 2:{const t=Math.min(e.geometricError/n,1);this.getDebugColor(t,o.material.color);break}case 3:{const t=Math.min(e.__distanceFromCamera/s,1);this.getDebugColor(t,o.material.color);break}case 6:e.children&&0!==e.children.length?this.getDebugColor(0,o.material.color):this.getDebugColor(1,o.material.color);break;case 8:o.material[Ku]||(o.material.color.setHSL(l,c,h),o.material[Ku]=!0);break;case 7:o.material[Wu]||(o.material.color.setHSL(l,c,h),o.material[Wu]=!0);break;case 9:this.customColorCallback?this.customColorCallback(e,o):console.warn("DebugTilesRenderer: customColorCallback not defined");break;case 10:{const t=a.indexOf(e);this.getDebugColor(t/(a.length-1),o.material.color);break}}}))}))}_onTileVisibilityChange(e,t){this.displayParentBounds?function(e,t=null){let i=e;for(;i;){const e=i.__depth,n=i.parent;t&&t(i,n,e),i=n}}(e,(i=>{null==i[qu]&&(i[qu]=0),t?i[qu]++:i[qu]>0&&i[qu]--;const n=i===e&&t||this.displayParentBounds&&i[qu]>0;this._updateBoundHelper(i,n)})):this._updateBoundHelper(e,t)}_createBoundHelper(e){const t=this.tiles,i=e.cached,{sphere:n,obb:s,region:r}=i.boundingVolume;if(s){const n=new Ie;n.name="DebugTilesRenderer.boxHelperGroup",n.matrix.copy(s.transform),n.matrixAutoUpdate=!1;const r=new Ze(s.box,Qu(e.__depth));r.raycast=Zu,n.add(r),i.boxHelperGroup=n,t.visibleTiles.has(e)&&this.displayBoxBounds&&(this.boxGroup.add(n),n.updateMatrixWorld(!0))}if(n){const s=new zu(n,Qu(e.__depth));s.raycast=Zu,i.sphereHelper=s,t.visibleTiles.has(e)&&this.displaySphereBounds&&(this.sphereGroup.add(s),s.updateMatrixWorld(!0))}if(r){const n=new Gu(r,Qu(e.__depth));n.raycast=Zu;const s=new Ye;r.getBoundingSphere(s),n.position.copy(s.center),s.center.multiplyScalar(-1),n.geometry.translate(...s.center),i.regionHelper=n,t.visibleTiles.has(e)&&this.displayRegionBounds&&(this.regionGroup.add(n),n.updateMatrixWorld(!0))}}_updateHelperMaterial(e,t){e.__visible||!this.displayParentBounds?t.opacity=1:t.opacity=.2;const i=t.transparent;t.transparent=t.opacity<1,t.transparent!==i&&(t.needsUpdate=!0)}_updateBoundHelper(e,t){const i=e.cached;if(!i)return;const n=this.sphereGroup,s=this.boxGroup,r=this.regionGroup;t&&null==i.boxHelperGroup&&null==i.sphereHelper&&null==i.regionHelper&&this._createBoundHelper(e);const o=i.boxHelperGroup,a=i.sphereHelper,l=i.regionHelper;t?(o&&(s.add(o),o.updateMatrixWorld(!0),this._updateHelperMaterial(e,o.children[0].material)),a&&(n.add(a),a.updateMatrixWorld(!0),this._updateHelperMaterial(e,a.material)),l&&(r.add(l),l.updateMatrixWorld(!0),this._updateHelperMaterial(e,l.material))):(o&&s.remove(o),a&&n.remove(a),l&&r.remove(l))}_updateMaterial(e){const{colorMode:t,unlit:i}=this;e.traverse((e=>{if(!e.material)return;const n=e.material,s=e[Vu];if(n!==s&&n.dispose(),0!==t||i){if(e.isPoints){const t=new je;t.size=s.size,t.sizeAttenuation=s.sizeAttenuation,e.material=t}else i?e.material=new se:(e.material=new $e,e.material.flatShading=!0);0===t&&(e.material.map=s.map,e.material.color.set(s.color))}else e.material=s}))}_onLoadModel(e,t){t[Xu]=performance.now(),e.traverse((e=>{const t=e.material;t&&(e[Vu]=t)})),this._updateMaterial(e)}_onDisposeModel(e){const t=e.cached;t.boxHelperGroup&&(t.boxHelperGroup.children[0].geometry.dispose(),delete t.boxHelperGroup),t.sphereHelper&&(t.sphereHelper.geometry.dispose(),delete t.sphereHelper),t.regionHelper&&(t.regionHelper.geometry.dispose(),delete t.regionHelper)}dispose(){if(!this.enabled)return;const e=this.tiles;e.removeEventListener("load-tile-set",this._onLoadTileSetCB),e.removeEventListener("load-model",this._onLoadModelCB),e.removeEventListener("dispose-model",this._onDisposeModelCB),e.removeEventListener("update-after",this._onUpdateAfterCB),e.removeEventListener("tile-visibility-change",this._onTileVisibilityChangeCB),this.colorMode=0,this.unlit=!1,e.forEachLoadedModel((e=>{this._updateMaterial(e)})),e.traverse((e=>{this._onDisposeModel(e)})),this.boxGroup?.removeFromParent(),this.sphereGroup?.removeFromParent(),this.regionGroup?.removeFromParent()}}const td=["object"],id=e({__name:"XYZTiles",props:{url:{},lruCacheMinSize:{default:900},lruCacheMaxSize:{default:1300},parseQueueMaxJobs:{default:10},errorTarget:{default:10},displayActiveTiles:{type:Boolean,default:!0},autoDisableRendererCulling:{type:Boolean,default:!0},tilesPlugins:{default:()=>({fadePlugin:{maximumFadeOutTiles:200},xyzPlugin:{center:!0,shape:"ellipsoid"}})}},setup(e){const{camera:t,renderer:i}=ln(),n=e;let s=B(new Yc(n.url));function o(){s&&s.dispose(),s=B(new Yc(n.url)),s.registerPlugin(new Fu(n.tilesPlugins.fadePlugin)),s.registerPlugin(new yu),s.registerPlugin(new vu(n.tilesPlugins.xyzPlugin)),s.lruCache.minSize=n.lruCacheMinSize,s.lruCache.maxSize=n.lruCacheMaxSize,s.parseQueue.maxJobs=n.parseQueueMaxJobs,s.setCamera(t.value),s.setResolutionFromRenderer(t.value,i.value),s.errorTarget=n.errorTarget,s.displayActiveTiles=n.displayActiveTiles,s.autoDisableRendererCulling=n.autoDisableRendererCulling}o(),a((()=>n.url),((e,t)=>{e!==t&&o()})),a((()=>n),(()=>{o()}),{deep:!0});const{onBeforeLoop:h}=xn();return h((()=>{s&&(s.setResolutionFromRenderer(t.value,i.value),s.update())})),l((()=>{s&&s.dispose()})),(e,t)=>u(s)?(c(),r("primitive",{key:0,object:u(s).group},null,8,td)):C("",!0)}}),nd=e({__name:"TDTTiles",props:{url:{default:"https://t0.tianditu.gov.cn"},service:{default:"WMTS"},request:{default:"GetTile"},version:{default:"1.0.0"},layer:{default:"vec"},tileStyle:{default:"default"},tileMatrixSet:{default:"w"},format:{default:"tiles"},tk:{default:"您的密钥"}},setup(e){const t=e,i=g((()=>`${t.url}/${t.layer}_${t.tileMatrixSet}/${t.service.toLowerCase()}?SERVICE=${t.service.toUpperCase()}&REQUEST=${t.request}&VERSION=${t.version}&LAYER=${t.layer}&STYLE=${t.tileStyle}&TILEMATRIXSET=${t.tileMatrixSet}&FORMAT=${t.format}&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=${t.tk}`));return(e,t)=>(c(),P(id,{url:i.value},null,8,["url"]))}});function sd(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rd(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t
/*!
 * GSAP 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/}var od,ad,ld,cd,hd,ud,dd,pd,md,fd,gd,vd,_d,yd,xd,bd,wd,Td={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Ad={duration:.5,overwrite:!1,delay:0},Md=1e8,Sd=1e-8,Ed=2*Math.PI,Pd=Ed/4,Cd=0,Rd=Math.sqrt,Ld=Math.cos,Dd=Math.sin,Od=function(e){return"string"==typeof e},kd=function(e){return"function"==typeof e},Id=function(e){return"number"==typeof e},Fd=function(e){return typeof e>"u"},Ud=function(e){return"object"==typeof e},Bd=function(e){return!1!==e},zd=function(){return typeof window<"u"},Nd=function(e){return kd(e)||Od(e)},jd="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},Hd=Array.isArray,Gd=/(?:-?\.?\d|\.)+/gi,Vd=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Wd=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Kd=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,Xd=/[+-]=-?[.\d]+/,qd=/[^,'"\[\]\s]+/gi,Yd=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,Zd={},$d={},Qd=function(e){return($d=Pp(e,Zd))&&Cf},Jd=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},ep=function(e,t){return!t&&console.warn(e)},tp=function(e,t){return e&&(Zd[e]=t)&&$d&&($d[e]=t)||Zd},ip=function(){return 0},np={suppressEvents:!0,isStart:!0,kill:!1},sp={suppressEvents:!0,kill:!1},rp={suppressEvents:!0},op={},ap=[],lp={},cp={},hp={},up=30,dp=[],pp="",mp=function(e){var t,i,n=e[0];if(Ud(n)||kd(n)||(e=[e]),!(t=(n._gsap||{}).harness)){for(i=dp.length;i--&&!dp[i].targetTest(n););t=dp[i]}for(i=e.length;i--;)e[i]&&(e[i]._gsap||(e[i]._gsap=new Hm(e[i],t)))||e.splice(i,1);return e},fp=function(e){return e._gsap||mp(rm(e))[0]._gsap},gp=function(e,t,i){return(i=e[t])&&kd(i)?e[t]():Fd(i)&&e.getAttribute&&e.getAttribute(t)||i},vp=function(e,t){return(e=e.split(",")).forEach(t)||e},_p=function(e){return Math.round(1e5*e)/1e5||0},yp=function(e){return Math.round(1e7*e)/1e7||0},xp=function(e,t){var i=t.charAt(0),n=parseFloat(t.substr(2));return e=parseFloat(e),"+"===i?e+n:"-"===i?e-n:"*"===i?e*n:e/n},bp=function(e,t){for(var i=t.length,n=0;e.indexOf(t[n])<0&&++n<i;);return n<i},wp=function(){var e,t,i=ap.length,n=ap.slice(0);for(lp={},ap.length=0,e=0;e<i;e++)(t=n[e])&&t._lazy&&(t.render(t._lazy[0],t._lazy[1],!0)._lazy=0)},Tp=function(e){return!!(e._initted||e._startAt||e.add)},Ap=function(e,t,i,n){ap.length&&!ad&&wp(),e.render(t,i,!!(ad&&t<0&&Tp(e))),ap.length&&!ad&&wp()},Mp=function(e){var t=parseFloat(e);return(t||0===t)&&(e+"").match(qd).length<2?t:Od(e)?e.trim():e},Sp=function(e){return e},Ep=function(e,t){for(var i in t)i in e||(e[i]=t[i]);return e},Pp=function(e,t){for(var i in t)e[i]=t[i];return e},Cp=function e(t,i){for(var n in i)"__proto__"!==n&&"constructor"!==n&&"prototype"!==n&&(t[n]=Ud(i[n])?e(t[n]||(t[n]={}),i[n]):i[n]);return t},Rp=function(e,t){var i,n={};for(i in e)i in t||(n[i]=e[i]);return n},Lp=function(e){var t=e.parent||cd,i=e.keyframes?function(e){return function(t,i){for(var n in i)n in t||"duration"===n&&e||"ease"===n||(t[n]=i[n])}}(Hd(e.keyframes)):Ep;if(Bd(e.inherit))for(;t;)i(e,t.vars.defaults),t=t.parent||t._dp;return e},Dp=function(e,t,i,n,s){var r,o=e[n];if(s)for(r=t[s];o&&o[s]>r;)o=o._prev;return o?(t._next=o._next,o._next=t):(t._next=e[i],e[i]=t),t._next?t._next._prev=t:e[n]=t,t._prev=o,t.parent=t._dp=e,t},Op=function(e,t,i,n){void 0===i&&(i="_first"),void 0===n&&(n="_last");var s=t._prev,r=t._next;s?s._next=r:e[i]===t&&(e[i]=r),r?r._prev=s:e[n]===t&&(e[n]=s),t._next=t._prev=t.parent=null},kp=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},Ip=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var i=e;i;)i._dirty=1,i=i.parent;return e},Fp=function(e,t,i,n){return e._startAt&&(ad?e._startAt.revert(sp):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,n))},Up=function e(t){return!t||t._ts&&e(t.parent)},Bp=function(e){return e._repeat?zp(e._tTime,e=e.duration()+e._rDelay)*e:0},zp=function(e,t){var i=Math.floor(e=yp(e/t));return e&&i===e?i-1:i},Np=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},jp=function(e){return e._end=yp(e._start+(e._tDur/Math.abs(e._ts||e._rts||Sd)||0))},Hp=function(e,t){var i=e._dp;return i&&i.smoothChildTiming&&e._ts&&(e._start=yp(i._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),jp(e),i._dirty||Ip(i,e)),e},Gp=function(e,t){var i;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(i=Np(e.rawTime(),t),(!t._dur||tm(0,t.totalDuration(),i)-t._tTime>Sd)&&t.render(i,!0)),Ip(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(i=e;i._dp;)i.rawTime()>=0&&i.totalTime(i._tTime),i=i._dp;e._zTime=-1e-8}},Vp=function(e,t,i,n){return t.parent&&kp(t),t._start=yp((Id(i)?i:i||e!==cd?Qp(e,i,t):e._time)+t._delay),t._end=yp(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),Dp(e,t,"_first","_last",e._sort?"_start":0),qp(t)||(e._recent=t),n||Gp(e,t),e._ts<0&&Hp(e,e._tTime),e},Wp=function(e,t){return(Zd.ScrollTrigger||Jd("scrollTrigger",t))&&Zd.ScrollTrigger.create(t,e)},Kp=function(e,t,i,n,s){return Zm(e,t,s),e._initted?!i&&e._pt&&!ad&&(e._dur&&!1!==e.vars.lazy||!e._dur&&e.vars.lazy)&&md!==Cm.frame?(ap.push(e),e._lazy=[s,n],1):void 0:1},Xp=function e(t){var i=t.parent;return i&&i._ts&&i._initted&&!i._lock&&(i.rawTime()<0||e(i))},qp=function(e){var t=e.data;return"isFromStart"===t||"isStart"===t},Yp=function(e,t,i,n){var s=e._repeat,r=yp(t)||0,o=e._tTime/e._tDur;return o&&!n&&(e._time*=r/e._dur),e._dur=r,e._tDur=s?s<0?1e10:yp(r*(s+1)+e._rDelay*s):r,o>0&&!n&&Hp(e,e._tTime=e._tDur*o),e.parent&&jp(e),i||Ip(e.parent,e),e},Zp=function(e){return e instanceof Vm?Ip(e):Yp(e,e._dur)},$p={_start:0,endTime:ip,totalDuration:ip},Qp=function e(t,i,n){var s,r,o,a=t.labels,l=t._recent||$p,c=t.duration()>=Md?l.endTime(!1):t._dur;return Od(i)&&(isNaN(i)||i in a)?(r=i.charAt(0),o="%"===i.substr(-1),s=i.indexOf("="),"<"===r||">"===r?(s>=0&&(i=i.replace(/=/,"")),("<"===r?l._start:l.endTime(l._repeat>=0))+(parseFloat(i.substr(1))||0)*(o?(s<0?l:n).totalDuration()/100:1)):s<0?(i in a||(a[i]=c),a[i]):(r=parseFloat(i.charAt(s-1)+i.substr(s+1)),o&&n&&(r=r/100*(Hd(n)?n[0]:n).totalDuration()),s>1?e(t,i.substr(0,s-1),n)+r:c+r)):null==i?c:+i},Jp=function(e,t,i){var n,s,r=Id(t[1]),o=(r?2:1)+(e<2?0:1),a=t[o];if(r&&(a.duration=t[1]),a.parent=i,e){for(n=a,s=i;s&&!("immediateRender"in n);)n=s.vars.defaults||{},s=Bd(s.vars.inherit)&&s.parent;a.immediateRender=Bd(n.immediateRender),e<2?a.runBackwards=1:a.startAt=t[o-1]}return new tf(t[0],a,t[o+1])},em=function(e,t){return e||0===e?t(e):t},tm=function(e,t,i){return i<e?e:i>t?t:i},im=function(e,t){return Od(e)&&(t=Yd.exec(e))?t[1]:""},nm=[].slice,sm=function(e,t){return e&&Ud(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&Ud(e[0]))&&!e.nodeType&&e!==hd},rm=function(e,t,i){return ld&&!t&&ld.selector?ld.selector(e):!Od(e)||i||!ud&&Rm()?Hd(e)?function(e,t,i){return void 0===i&&(i=[]),e.forEach((function(e){var n;return Od(e)&&!t||sm(e,1)?(n=i).push.apply(n,rm(e)):i.push(e)}))||i}(e,i):sm(e)?nm.call(e,0):e?[e]:[]:nm.call((t||dd).querySelectorAll(e),0)},om=function(e){return e=rm(e)[0]||ep("Invalid scope")||{},function(t){var i=e.current||e.nativeElement||e;return rm(t,i.querySelectorAll?i:i===e?ep("Invalid scope")||dd.createElement("div"):e)}},am=function(e){return e.sort((function(){return.5-Math.random()}))},lm=function(e){if(kd(e))return e;var t=Ud(e)?e:{each:e},i=Um(t.ease),n=t.from||0,s=parseFloat(t.base)||0,r={},o=n>0&&n<1,a=isNaN(n)||o,l=t.axis,c=n,h=n;return Od(n)?c=h={center:.5,edges:.5,end:1}[n]||0:!o&&a&&(c=n[0],h=n[1]),function(e,o,u){var d,p,m,f,g,v,_,y,x,b=(u||t).length,w=r[b];if(!w){if(!(x="auto"===t.grid?0:(t.grid||[1,Md])[1])){for(_=-1e8;_<(_=u[x++].getBoundingClientRect().left)&&x<b;);x<b&&x--}for(w=r[b]=[],d=a?Math.min(x,b)*c-.5:n%x,p=x===Md?0:a?b*h/x-.5:n/x|0,_=0,y=Md,v=0;v<b;v++)m=v%x-d,f=p-(v/x|0),w[v]=g=l?Math.abs("y"===l?f:m):Rd(m*m+f*f),g>_&&(_=g),g<y&&(y=g);"random"===n&&am(w),w.max=_-y,w.min=y,w.v=b=(parseFloat(t.amount)||parseFloat(t.each)*(x>b?b-1:l?"y"===l?b/x:x:Math.max(x,b/x))||0)*("edges"===n?-1:1),w.b=b<0?s-b:s,w.u=im(t.amount||t.each)||0,i=i&&b<0?Im(i):i}return b=(w[e]-w.min)/w.max||0,yp(w.b+(i?i(b):b)*w.v)+w.u}},cm=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(i){var n=yp(Math.round(parseFloat(i)/e)*e*t);return(n-n%1)/t+(Id(i)?0:im(i))}},hm=function(e,t){var i,n,s=Hd(e);return!s&&Ud(e)&&(i=s=e.radius||Md,e.values?(e=rm(e.values),(n=!Id(e[0]))&&(i*=i)):e=cm(e.increment)),em(t,s?kd(e)?function(t){return n=e(t),Math.abs(n-t)<=i?n:t}:function(t){for(var s,r,o=parseFloat(n?t.x:t),a=parseFloat(n?t.y:0),l=Md,c=0,h=e.length;h--;)n?s=(s=e[h].x-o)*s+(r=e[h].y-a)*r:s=Math.abs(e[h]-o),s<l&&(l=s,c=h);return c=!i||l<=i?e[c]:t,n||c===t||Id(t)?c:c+im(t)}:cm(e))},um=function(e,t,i,n){return em(Hd(e)?!t:!0===i?!!(i=0):!n,(function(){return Hd(e)?e[~~(Math.random()*e.length)]:(i=i||1e-5)&&(n=i<1?Math.pow(10,(i+"").length-2):1)&&Math.floor(Math.round((e-i/2+Math.random()*(t-e+.99*i))/i)*i*n)/n}))},dm=function(e,t,i){return em(i,(function(i){return e[~~t(i)]}))},pm=function(e){for(var t,i,n,s,r=0,o="";~(t=e.indexOf("random(",r));)n=e.indexOf(")",t),s="["===e.charAt(t+7),i=e.substr(t+7,n-t-7).match(s?qd:Gd),o+=e.substr(r,t-r)+um(s?i:+i[0],s?0:+i[1],+i[2]||1e-5),r=n+1;return o+e.substr(r,e.length-r)},mm=function(e,t,i,n,s){var r=t-e,o=n-i;return em(s,(function(t){return i+((t-e)/r*o||0)}))},fm=function(e,t,i){var n,s,r,o=e.labels,a=Md;for(n in o)(s=o[n]-t)<0==!!i&&s&&a>(s=Math.abs(s))&&(r=n,a=s);return r},gm=function(e,t,i){var n,s,r,o=e.vars,a=o[t],l=ld,c=e._ctx;if(a)return n=o[t+"Params"],s=o.callbackScope||e,i&&ap.length&&wp(),c&&(ld=c),r=n?a.apply(s,n):a.call(s),ld=l,r},vm=function(e){return kp(e),e.scrollTrigger&&e.scrollTrigger.kill(!!ad),e.progress()<1&&gm(e,"onInterrupt"),e},_m=[],ym=function(e){if(e)if(e=!e.name&&e.default||e,zd()||e.headless){var t=e.name,i=kd(e),n=t&&!i&&e.init?function(){this._props=[]}:e,s={init:ip,render:uf,add:qm,kill:pf,modifier:df,rawVars:0},r={targetTest:0,get:0,getSetter:af,aliases:{},register:0};if(Rm(),e!==n){if(cp[t])return;Ep(n,Ep(Rp(e,s),r)),Pp(n.prototype,Pp(s,Rp(e,r))),cp[n.prop=t]=n,e.targetTest&&(dp.push(n),op[t]=1),t=("css"===t?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}tp(t,n),e.register&&e.register(Cf,n,gf)}else _m.push(e)},xm=255,bm={aqua:[0,xm,xm],lime:[0,xm,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,xm],navy:[0,0,128],white:[xm,xm,xm],olive:[128,128,0],yellow:[xm,xm,0],orange:[xm,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[xm,0,0],pink:[xm,192,203],cyan:[0,xm,xm],transparent:[xm,xm,xm,0]},wm=function(e,t,i){return(6*(e+=e<0?1:e>1?-1:0)<1?t+(i-t)*e*6:e<.5?i:3*e<2?t+(i-t)*(2/3-e)*6:t)*xm+.5|0},Tm=function(e,t,i){var n,s,r,o,a,l,c,h,u,d,p=e?Id(e)?[e>>16,e>>8&xm,e&xm]:0:bm.black;if(!p){if(","===e.substr(-1)&&(e=e.substr(0,e.length-1)),bm[e])p=bm[e];else if("#"===e.charAt(0)){if(e.length<6&&(n=e.charAt(1),s=e.charAt(2),r=e.charAt(3),e="#"+n+n+s+s+r+r+(5===e.length?e.charAt(4)+e.charAt(4):"")),9===e.length)return[(p=parseInt(e.substr(1,6),16))>>16,p>>8&xm,p&xm,parseInt(e.substr(7),16)/255];p=[(e=parseInt(e.substr(1),16))>>16,e>>8&xm,e&xm]}else if("hsl"===e.substr(0,3))if(p=d=e.match(Gd),t){if(~e.indexOf("="))return p=e.match(Vd),i&&p.length<4&&(p[3]=1),p}else o=+p[0]%360/360,a=+p[1]/100,n=2*(l=+p[2]/100)-(s=l<=.5?l*(a+1):l+a-l*a),p.length>3&&(p[3]*=1),p[0]=wm(o+1/3,n,s),p[1]=wm(o,n,s),p[2]=wm(o-1/3,n,s);else p=e.match(Gd)||bm.transparent;p=p.map(Number)}return t&&!d&&(n=p[0]/xm,s=p[1]/xm,r=p[2]/xm,l=((c=Math.max(n,s,r))+(h=Math.min(n,s,r)))/2,c===h?o=a=0:(u=c-h,a=l>.5?u/(2-c-h):u/(c+h),o=c===n?(s-r)/u+(s<r?6:0):c===s?(r-n)/u+2:(n-s)/u+4,o*=60),p[0]=~~(o+.5),p[1]=~~(100*a+.5),p[2]=~~(100*l+.5)),i&&p.length<4&&(p[3]=1),p},Am=function(e){var t=[],i=[],n=-1;return e.split(Sm).forEach((function(e){var s=e.match(Wd)||[];t.push.apply(t,s),i.push(n+=s.length+1)})),t.c=i,t},Mm=function(e,t,i){var n,s,r,o,a="",l=(e+a).match(Sm),c=t?"hsla(":"rgba(",h=0;if(!l)return e;if(l=l.map((function(e){return(e=Tm(e,t,1))&&c+(t?e[0]+","+e[1]+"%,"+e[2]+"%,"+e[3]:e.join(","))+")"})),i&&(r=Am(e),(n=i.c).join(a)!==r.c.join(a)))for(o=(s=e.replace(Sm,"1").split(Wd)).length-1;h<o;h++)a+=s[h]+(~n.indexOf(h)?l.shift()||c+"0,0,0,0)":(r.length?r:l.length?l:i).shift());if(!s)for(o=(s=e.split(Sm)).length-1;h<o;h++)a+=s[h]+l[h];return a+s[o]},Sm=function(){var e,t="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(e in bm)t+="|"+e+"\\b";return new RegExp(t+")","gi")}(),Em=/hsl[a]?\(/,Pm=function(e){var t,i=e.join(" ");if(Sm.lastIndex=0,Sm.test(i))return t=Em.test(i),e[1]=Mm(e[1],t),e[0]=Mm(e[0],t,Am(e[1])),!0},Cm=function(){var e,t,i,n,s,r,o=Date.now,a=500,l=33,c=o(),h=c,u=1e3/240,d=u,p=[],m=function i(m){var f,g,v,_,y=o()-h,x=!0===m;if((y>a||y<0)&&(c+=y-l),((f=(v=(h+=y)-c)-d)>0||x)&&(_=++n.frame,s=v-1e3*n.time,n.time=v/=1e3,d+=f+(f>=u?4:u-f),g=1),x||(e=t(i)),g)for(r=0;r<p.length;r++)p[r](v,s,_,m)};return n={time:0,frame:0,tick:function(){m(!0)},deltaRatio:function(e){return s/(1e3/(e||60))},wake:function(){pd&&(!ud&&zd()&&(hd=ud=window,dd=hd.document||{},Zd.gsap=Cf,(hd.gsapVersions||(hd.gsapVersions=[])).push(Cf.version),Qd($d||hd.GreenSockGlobals||!hd.gsap&&hd||{}),_m.forEach(ym)),i=typeof requestAnimationFrame<"u"&&requestAnimationFrame,e&&n.sleep(),t=i||function(e){return setTimeout(e,d-1e3*n.time+1|0)},gd=1,m(2))},sleep:function(){(i?cancelAnimationFrame:clearTimeout)(e),gd=0,t=ip},lagSmoothing:function(e,t){a=e||1/0,l=Math.min(t||33,a)},fps:function(e){u=1e3/(e||240),d=1e3*n.time+u},add:function(e,t,i){var s=t?function(t,i,r,o){e(t,i,r,o),n.remove(s)}:e;return n.remove(e),p[i?"unshift":"push"](s),Rm(),s},remove:function(e,t){~(t=p.indexOf(e))&&p.splice(t,1)&&r>=t&&r--},_listeners:p},n}(),Rm=function(){return!gd&&Cm.wake()},Lm={},Dm=/^[\d.\-M][\d.\-,\s]/,Om=/["']/g,km=function(e){for(var t,i,n,s={},r=e.substr(1,e.length-3).split(":"),o=r[0],a=1,l=r.length;a<l;a++)i=r[a],t=a!==l-1?i.lastIndexOf(","):i.length,n=i.substr(0,t),s[o]=isNaN(n)?n.replace(Om,"").trim():+n,o=i.substr(t+1).trim();return s},Im=function(e){return function(t){return 1-e(1-t)}},Fm=function e(t,i){for(var n,s=t._first;s;)s instanceof Vm?e(s,i):s.vars.yoyoEase&&(!s._yoyo||!s._repeat)&&s._yoyo!==i&&(s.timeline?e(s.timeline,i):(n=s._ease,s._ease=s._yEase,s._yEase=n,s._yoyo=i)),s=s._next},Um=function(e,t){return e&&(kd(e)?e:Lm[e]||function(e){var t=(e+"").split("("),i=Lm[t[0]];return i&&t.length>1&&i.config?i.config.apply(null,~e.indexOf("{")?[km(t[1])]:function(e){var t=e.indexOf("(")+1,i=e.indexOf(")"),n=e.indexOf("(",t);return e.substring(t,~n&&n<i?e.indexOf(")",i+1):i)}(e).split(",").map(Mp)):Lm._CE&&Dm.test(e)?Lm._CE("",e):i}(e))||t},Bm=function(e,t,i,n){void 0===i&&(i=function(e){return 1-t(1-e)}),void 0===n&&(n=function(e){return e<.5?t(2*e)/2:1-t(2*(1-e))/2});var s,r={easeIn:t,easeOut:i,easeInOut:n};return vp(e,(function(e){for(var t in Lm[e]=Zd[e]=r,Lm[s=e.toLowerCase()]=i,r)Lm[s+("easeIn"===t?".in":"easeOut"===t?".out":".inOut")]=Lm[e+"."+t]=r[t]})),r},zm=function(e){return function(t){return t<.5?(1-e(1-2*t))/2:.5+e(2*(t-.5))/2}},Nm=function e(t,i,n){var s=i>=1?i:1,r=(n||(t?.3:.45))/(i<1?i:1),o=r/Ed*(Math.asin(1/s)||0),a=function(e){return 1===e?1:s*Math.pow(2,-10*e)*Dd((e-o)*r)+1},l="out"===t?a:"in"===t?function(e){return 1-a(1-e)}:zm(a);return r=Ed/r,l.config=function(i,n){return e(t,i,n)},l},jm=function e(t,i){void 0===i&&(i=1.70158);var n=function(e){return e?--e*e*((i+1)*e+i)+1:0},s="out"===t?n:"in"===t?function(e){return 1-n(1-e)}:zm(n);return s.config=function(i){return e(t,i)},s};vp("Linear,Quad,Cubic,Quart,Quint,Strong",(function(e,t){var i=t<5?t+1:t;Bm(e+",Power"+(i-1),t?function(e){return Math.pow(e,i)}:function(e){return e},(function(e){return 1-Math.pow(1-e,i)}),(function(e){return e<.5?Math.pow(2*e,i)/2:1-Math.pow(2*(1-e),i)/2}))})),Lm.Linear.easeNone=Lm.none=Lm.Linear.easeIn,Bm("Elastic",Nm("in"),Nm("out"),Nm()),vd=7.5625,xd=2*(yd=1/(_d=2.75)),bd=2.5*yd,Bm("Bounce",(function(e){return 1-wd(1-e)}),wd=function(e){return e<yd?vd*e*e:e<xd?vd*Math.pow(e-1.5/_d,2)+.75:e<bd?vd*(e-=2.25/_d)*e+.9375:vd*Math.pow(e-2.625/_d,2)+.984375}),Bm("Expo",(function(e){return Math.pow(2,10*(e-1))*e+e*e*e*e*e*e*(1-e)})),Bm("Circ",(function(e){return-(Rd(1-e*e)-1)})),Bm("Sine",(function(e){return 1===e?1:1-Ld(e*Pd)})),Bm("Back",jm("in"),jm("out"),jm()),Lm.SteppedEase=Lm.steps=Zd.SteppedEase={config:function(e,t){void 0===e&&(e=1);var i=1/e,n=e+(t?0:1),s=t?1:0,r=1-Sd;return function(e){return((n*tm(0,r,e)|0)+s)*i}}},Ad.ease=Lm["quad.out"],vp("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",(function(e){return pp+=e+","+e+"Params,"}));var Hm=function(e,t){this.id=Cd++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:gp,this.set=t?t.getSetter:af},Gm=function(){function e(e){this.vars=e,this._delay=+e.delay||0,(this._repeat=e.repeat===1/0?-2:e.repeat||0)&&(this._rDelay=e.repeatDelay||0,this._yoyo=!!e.yoyo||!!e.yoyoEase),this._ts=1,Yp(this,+e.duration,1,1),this.data=e.data,ld&&(this._ctx=ld,ld.data.push(this)),gd||Cm.wake()}var t=e.prototype;return t.delay=function(e){return e||0===e?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+e-this._delay),this._delay=e,this):this._delay},t.duration=function(e){return arguments.length?this.totalDuration(this._repeat>0?e+(e+this._rDelay)*this._repeat:e):this.totalDuration()&&this._dur},t.totalDuration=function(e){return arguments.length?(this._dirty=0,Yp(this,this._repeat<0?e:(e-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},t.totalTime=function(e,t){if(Rm(),!arguments.length)return this._tTime;var i=this._dp;if(i&&i.smoothChildTiming&&this._ts){for(Hp(this,e),!i._dp||i.parent||Gp(i,this);i&&i.parent;)i.parent._time!==i._start+(i._ts>=0?i._tTime/i._ts:(i.totalDuration()-i._tTime)/-i._ts)&&i.totalTime(i._tTime,!0),i=i.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&e<this._tDur||this._ts<0&&e>0||!this._tDur&&!e)&&Vp(this._dp,this,this._start-this._delay)}return(this._tTime!==e||!this._dur&&!t||this._initted&&Math.abs(this._zTime)===Sd||!e&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=e),Ap(this,e,t)),this},t.time=function(e,t){return arguments.length?this.totalTime(Math.min(this.totalDuration(),e+Bp(this))%(this._dur+this._rDelay)||(e?this._dur:0),t):this._time},t.totalProgress=function(e,t){return arguments.length?this.totalTime(this.totalDuration()*e,t):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},t.progress=function(e,t){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?e:1-e)+Bp(this),t):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},t.iteration=function(e,t){var i=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(e-1)*i,t):this._repeat?zp(this._tTime,i)+1:1},t.timeScale=function(e,t){if(!arguments.length)return-1e-8===this._rts?0:this._rts;if(this._rts===e)return this;var i=this.parent&&this._ts?Np(this.parent._time,this):this._tTime;return this._rts=+e||0,this._ts=this._ps||-1e-8===e?0:this._rts,this.totalTime(tm(-Math.abs(this._delay),this.totalDuration(),i),!1!==t),jp(this),function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e}(this)},t.paused=function(e){return arguments.length?(this._ps!==e&&(this._ps=e,e?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Rm(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==Sd&&(this._tTime-=Sd)))),this):this._ps},t.startTime=function(e){if(arguments.length){this._start=e;var t=this.parent||this._dp;return t&&(t._sort||!this.parent)&&Vp(t,this,e-this._delay),this}return this._start},t.endTime=function(e){return this._start+(Bd(e)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},t.rawTime=function(e){var t=this.parent||this._dp;return t?e&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Np(t.rawTime(e),this):this._tTime:this._tTime},t.revert=function(e){void 0===e&&(e=rp);var t=ad;return ad=e,Tp(this)&&(this.timeline&&this.timeline.revert(e),this.totalTime(-.01,e.suppressEvents)),"nested"!==this.data&&!1!==e.kill&&this.kill(),ad=t,this},t.globalTime=function(e){for(var t=this,i=arguments.length?e:t.rawTime();t;)i=t._start+i/(Math.abs(t._ts)||1),t=t._dp;return!this.parent&&this._sat?this._sat.globalTime(e):i},t.repeat=function(e){return arguments.length?(this._repeat=e===1/0?-2:e,Zp(this)):-2===this._repeat?1/0:this._repeat},t.repeatDelay=function(e){if(arguments.length){var t=this._time;return this._rDelay=e,Zp(this),t?this.time(t):this}return this._rDelay},t.yoyo=function(e){return arguments.length?(this._yoyo=e,this):this._yoyo},t.seek=function(e,t){return this.totalTime(Qp(this,e),Bd(t))},t.restart=function(e,t){return this.play().totalTime(e?-this._delay:0,Bd(t)),this._dur||(this._zTime=-1e-8),this},t.play=function(e,t){return null!=e&&this.seek(e,t),this.reversed(!1).paused(!1)},t.reverse=function(e,t){return null!=e&&this.seek(e||this.totalDuration(),t),this.reversed(!0).paused(!1)},t.pause=function(e,t){return null!=e&&this.seek(e,t),this.paused(!0)},t.resume=function(){return this.paused(!1)},t.reversed=function(e){return arguments.length?(!!e!==this.reversed()&&this.timeScale(-this._rts||(e?-1e-8:0)),this):this._rts<0},t.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},t.isActive=function(){var e,t=this.parent||this._dp,i=this._start;return!(t&&!(this._ts&&this._initted&&t.isActive()&&(e=t.rawTime(!0))>=i&&e<this.endTime(!0)-Sd))},t.eventCallback=function(e,t,i){var n=this.vars;return arguments.length>1?(t?(n[e]=t,i&&(n[e+"Params"]=i),"onUpdate"===e&&(this._onUpdate=t)):delete n[e],this):n[e]},t.then=function(e){var t=this;return new Promise((function(i){var n=kd(e)?e:Sp,s=function(){var e=t.then;t.then=null,kd(n)&&(n=n(t))&&(n.then||n===t)&&(t.then=e),i(n),t.then=e};t._initted&&1===t.totalProgress()&&t._ts>=0||!t._tTime&&t._ts<0?s():t._prom=s}))},t.kill=function(){vm(this)},e}();Ep(Gm.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var Vm=function(e){function t(t,i){var n;return void 0===t&&(t={}),(n=e.call(this,t)||this).labels={},n.smoothChildTiming=!!t.smoothChildTiming,n.autoRemoveChildren=!!t.autoRemoveChildren,n._sort=Bd(t.sortChildren),cd&&Vp(t.parent||cd,sd(n),i),t.reversed&&n.reverse(),t.paused&&n.paused(!0),t.scrollTrigger&&Wp(sd(n),t.scrollTrigger),n}rd(t,e);var i=t.prototype;return i.to=function(e,t,i){return Jp(0,arguments,this),this},i.from=function(e,t,i){return Jp(1,arguments,this),this},i.fromTo=function(e,t,i,n){return Jp(2,arguments,this),this},i.set=function(e,t,i){return t.duration=0,t.parent=this,Lp(t).repeatDelay||(t.repeat=0),t.immediateRender=!!t.immediateRender,new tf(e,t,Qp(this,i),1),this},i.call=function(e,t,i){return Vp(this,tf.delayedCall(0,e,t),i)},i.staggerTo=function(e,t,i,n,s,r,o){return i.duration=t,i.stagger=i.stagger||n,i.onComplete=r,i.onCompleteParams=o,i.parent=this,new tf(e,i,Qp(this,s)),this},i.staggerFrom=function(e,t,i,n,s,r,o){return i.runBackwards=1,Lp(i).immediateRender=Bd(i.immediateRender),this.staggerTo(e,t,i,n,s,r,o)},i.staggerFromTo=function(e,t,i,n,s,r,o,a){return n.startAt=i,Lp(n).immediateRender=Bd(n.immediateRender),this.staggerTo(e,t,n,s,r,o,a)},i.render=function(e,t,i){var n,s,r,o,a,l,c,h,u,d,p,m,f=this._time,g=this._dirty?this.totalDuration():this._tDur,v=this._dur,_=e<=0?0:yp(e),y=this._zTime<0!=e<0&&(this._initted||!v);if(this!==cd&&_>g&&e>=0&&(_=g),_!==this._tTime||i||y){if(f!==this._time&&v&&(_+=this._time-f,e+=this._time-f),n=_,u=this._start,l=!(h=this._ts),y&&(v||(f=this._zTime),(e||!t)&&(this._zTime=e)),this._repeat){if(p=this._yoyo,a=v+this._rDelay,this._repeat<-1&&e<0)return this.totalTime(100*a+e,t,i);if(n=yp(_%a),_===g?(o=this._repeat,n=v):((o=~~(d=yp(_/a)))&&o===d&&(n=v,o--),n>v&&(n=v)),d=zp(this._tTime,a),!f&&this._tTime&&d!==o&&this._tTime-d*a-this._dur<=0&&(d=o),p&&1&o&&(n=v-n,m=1),o!==d&&!this._lock){var x=p&&1&d,b=x===(p&&1&o);if(o<d&&(x=!x),f=x?0:_%v?v:_,this._lock=1,this.render(f||(m?0:yp(o*a)),t,!v)._lock=0,this._tTime=_,!t&&this.parent&&gm(this,"onRepeat"),this.vars.repeatRefresh&&!m&&(this.invalidate()._lock=1),f&&f!==this._time||l!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(v=this._dur,g=this._tDur,b&&(this._lock=2,f=x?v:-1e-4,this.render(f,!0),this.vars.repeatRefresh&&!m&&this.invalidate()),this._lock=0,!this._ts&&!l)return this;Fm(this,m)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(c=function(e,t,i){var n;if(i>t)for(n=e._first;n&&n._start<=i;){if("isPause"===n.data&&n._start>t)return n;n=n._next}else for(n=e._last;n&&n._start>=i;){if("isPause"===n.data&&n._start<t)return n;n=n._prev}}(this,yp(f),yp(n)),c&&(_-=n-(n=c._start))),this._tTime=_,this._time=n,this._act=!h,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=e,f=0),!f&&_&&!t&&!d&&(gm(this,"onStart"),this._tTime!==_))return this;if(n>=f&&e>=0)for(s=this._first;s;){if(r=s._next,(s._act||n>=s._start)&&s._ts&&c!==s){if(s.parent!==this)return this.render(e,t,i);if(s.render(s._ts>0?(n-s._start)*s._ts:(s._dirty?s.totalDuration():s._tDur)+(n-s._start)*s._ts,t,i),n!==this._time||!this._ts&&!l){c=0,r&&(_+=this._zTime=-1e-8);break}}s=r}else{s=this._last;for(var w=e<0?e:n;s;){if(r=s._prev,(s._act||w<=s._end)&&s._ts&&c!==s){if(s.parent!==this)return this.render(e,t,i);if(s.render(s._ts>0?(w-s._start)*s._ts:(s._dirty?s.totalDuration():s._tDur)+(w-s._start)*s._ts,t,i||ad&&Tp(s)),n!==this._time||!this._ts&&!l){c=0,r&&(_+=this._zTime=w?-1e-8:Sd);break}}s=r}}if(c&&!t&&(this.pause(),c.render(n>=f?0:-1e-8)._zTime=n>=f?1:-1,this._ts))return this._start=u,jp(this),this.render(e,t,i);this._onUpdate&&!t&&gm(this,"onUpdate",!0),(_===g&&this._tTime>=this.totalDuration()||!_&&f)&&(u===this._start||Math.abs(h)!==Math.abs(this._ts))&&(this._lock||((e||!v)&&(_===g&&this._ts>0||!_&&this._ts<0)&&kp(this,1),!t&&(!(e<0)||f)&&(_||f||!g)&&(gm(this,_===g&&e>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(_<g&&this.timeScale()>0)&&this._prom())))}return this},i.add=function(e,t){var i=this;if(Id(t)||(t=Qp(this,t,e)),!(e instanceof Gm)){if(Hd(e))return e.forEach((function(e){return i.add(e,t)})),this;if(Od(e))return this.addLabel(e,t);if(!kd(e))return this;e=tf.delayedCall(0,e)}return this!==e?Vp(this,e,t):this},i.getChildren=function(e,t,i,n){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===i&&(i=!0),void 0===n&&(n=-1e8);for(var s=[],r=this._first;r;)r._start>=n&&(r instanceof tf?t&&s.push(r):(i&&s.push(r),e&&s.push.apply(s,r.getChildren(!0,t,i)))),r=r._next;return s},i.getById=function(e){for(var t=this.getChildren(1,1,1),i=t.length;i--;)if(t[i].vars.id===e)return t[i]},i.remove=function(e){return Od(e)?this.removeLabel(e):kd(e)?this.killTweensOf(e):(e.parent===this&&Op(this,e),e===this._recent&&(this._recent=this._last),Ip(this))},i.totalTime=function(t,i){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=yp(Cm.time-(this._ts>0?t/this._ts:(this.totalDuration()-t)/-this._ts))),e.prototype.totalTime.call(this,t,i),this._forcing=0,this):this._tTime},i.addLabel=function(e,t){return this.labels[e]=Qp(this,t),this},i.removeLabel=function(e){return delete this.labels[e],this},i.addPause=function(e,t,i){var n=tf.delayedCall(0,t||ip,i);return n.data="isPause",this._hasPause=1,Vp(this,n,Qp(this,e))},i.removePause=function(e){var t=this._first;for(e=Qp(this,e);t;)t._start===e&&"isPause"===t.data&&kp(t),t=t._next},i.killTweensOf=function(e,t,i){for(var n=this.getTweensOf(e,i),s=n.length;s--;)Wm!==n[s]&&n[s].kill(e,t);return this},i.getTweensOf=function(e,t){for(var i,n=[],s=rm(e),r=this._first,o=Id(t);r;)r instanceof tf?bp(r._targets,s)&&(o?(!Wm||r._initted&&r._ts)&&r.globalTime(0)<=t&&r.globalTime(r.totalDuration())>t:!t||r.isActive())&&n.push(r):(i=r.getTweensOf(s,t)).length&&n.push.apply(n,i),r=r._next;return n},i.tweenTo=function(e,t){t=t||{};var i,n=this,s=Qp(n,e),r=t,o=r.startAt,a=r.onStart,l=r.onStartParams,c=r.immediateRender,h=tf.to(n,Ep({ease:t.ease||"none",lazy:!1,immediateRender:!1,time:s,overwrite:"auto",duration:t.duration||Math.abs((s-(o&&"time"in o?o.time:n._time))/n.timeScale())||Sd,onStart:function(){if(n.pause(),!i){var e=t.duration||Math.abs((s-(o&&"time"in o?o.time:n._time))/n.timeScale());h._dur!==e&&Yp(h,e,0,1).render(h._time,!0,!0),i=1}a&&a.apply(h,l||[])}},t));return c?h.render(0):h},i.tweenFromTo=function(e,t,i){return this.tweenTo(t,Ep({startAt:{time:Qp(this,e)}},i))},i.recent=function(){return this._recent},i.nextLabel=function(e){return void 0===e&&(e=this._time),fm(this,Qp(this,e))},i.previousLabel=function(e){return void 0===e&&(e=this._time),fm(this,Qp(this,e),1)},i.currentLabel=function(e){return arguments.length?this.seek(e,!0):this.previousLabel(this._time+Sd)},i.shiftChildren=function(e,t,i){void 0===i&&(i=0);for(var n,s=this._first,r=this.labels;s;)s._start>=i&&(s._start+=e,s._end+=e),s=s._next;if(t)for(n in r)r[n]>=i&&(r[n]+=e);return Ip(this)},i.invalidate=function(t){var i=this._first;for(this._lock=0;i;)i.invalidate(t),i=i._next;return e.prototype.invalidate.call(this,t)},i.clear=function(e){void 0===e&&(e=!0);for(var t,i=this._first;i;)t=i._next,this.remove(i),i=t;return this._dp&&(this._time=this._tTime=this._pTime=0),e&&(this.labels={}),Ip(this)},i.totalDuration=function(e){var t,i,n,s=0,r=this,o=r._last,a=Md;if(arguments.length)return r.timeScale((r._repeat<0?r.duration():r.totalDuration())/(r.reversed()?-e:e));if(r._dirty){for(n=r.parent;o;)t=o._prev,o._dirty&&o.totalDuration(),(i=o._start)>a&&r._sort&&o._ts&&!r._lock?(r._lock=1,Vp(r,o,i-o._delay,1)._lock=0):a=i,i<0&&o._ts&&(s-=i,(!n&&!r._dp||n&&n.smoothChildTiming)&&(r._start+=i/r._ts,r._time-=i,r._tTime-=i),r.shiftChildren(-i,!1,-1/0),a=0),o._end>s&&o._ts&&(s=o._end),o=t;Yp(r,r===cd&&r._time>s?r._time:s,1,1),r._dirty=0}return r._tDur},t.updateRoot=function(e){if(cd._ts&&(Ap(cd,Np(e,cd)),md=Cm.frame),Cm.frame>=up){up+=Td.autoSleep||120;var t=cd._first;if((!t||!t._ts)&&Td.autoSleep&&Cm._listeners.length<2){for(;t&&!t._ts;)t=t._next;t||Cm.sleep()}}},t}(Gm);Ep(Vm.prototype,{_lock:0,_hasPause:0,_forcing:0});var Wm,Km,Xm=function(e,t,i,n,s,r,o){var a,l,c,h,u,d,p,m,f=new gf(this._pt,e,t,0,1,hf,null,s),g=0,v=0;for(f.b=i,f.e=n,i+="",(p=~(n+="").indexOf("random("))&&(n=pm(n)),r&&(r(m=[i,n],e,t),i=m[0],n=m[1]),l=i.match(Kd)||[];a=Kd.exec(n);)h=a[0],u=n.substring(g,a.index),c?c=(c+1)%5:"rgba("===u.substr(-5)&&(c=1),h!==l[v++]&&(d=parseFloat(l[v-1])||0,f._pt={_next:f._pt,p:u||1===v?u:",",s:d,c:"="===h.charAt(1)?xp(d,h)-d:parseFloat(h)-d,m:c&&c<4?Math.round:0},g=Kd.lastIndex);return f.c=g<n.length?n.substring(g,n.length):"",f.fp=o,(Xd.test(n)||p)&&(f.e=0),this._pt=f,f},qm=function(e,t,i,n,s,r,o,a,l,c){kd(n)&&(n=n(s||0,e,r));var h,u=e[t],d="get"!==i?i:kd(u)?l?e[t.indexOf("set")||!kd(e["get"+t.substr(3)])?t:"get"+t.substr(3)](l):e[t]():u,p=kd(u)?l?rf:sf:nf;if(Od(n)&&(~n.indexOf("random(")&&(n=pm(n)),"="===n.charAt(1)&&(((h=xp(d,n)+(im(d)||0))||0===h)&&(n=h))),!c||d!==n||Km)return isNaN(d*n)||""===n?(!u&&!(t in e)&&Jd(t,n),Xm.call(this,e,t,d,n,p,a||Td.stringFilter,l)):(h=new gf(this._pt,e,t,+d||0,n-(d||0),"boolean"==typeof u?cf:lf,0,p),l&&(h.fp=l),o&&h.modifier(o,this,e),this._pt=h)},Ym=function(e,t,i,n,s,r){var o,a,l,c;if(cp[e]&&!1!==(o=new cp[e]).init(s,o.rawVars?t[e]:function(e,t,i,n,s){if(kd(e)&&(e=Qm(e,s,t,i,n)),!Ud(e)||e.style&&e.nodeType||Hd(e)||jd(e))return Od(e)?Qm(e,s,t,i,n):e;var r,o={};for(r in e)o[r]=Qm(e[r],s,t,i,n);return o}(t[e],n,s,r,i),i,n,r)&&(i._pt=a=new gf(i._pt,s,e,0,1,o.render,o,0,o.priority),i!==fd))for(l=i._ptLookup[i._targets.indexOf(s)],c=o._props.length;c--;)l[o._props[c]]=a;return o},Zm=function e(t,i,n){var s,r,o,a,l,c,h,u,d,p,m,f,g,v=t.vars,_=v.ease,y=v.startAt,x=v.immediateRender,b=v.lazy,w=v.onUpdate,T=v.runBackwards,A=v.yoyoEase,M=v.keyframes,S=v.autoRevert,E=t._dur,P=t._startAt,C=t._targets,R=t.parent,L=R&&"nested"===R.data?R.vars.targets:C,D="auto"===t._overwrite&&!od,O=t.timeline;if(O&&(!M||!_)&&(_="none"),t._ease=Um(_,Ad.ease),t._yEase=A?Im(Um(!0===A?_:A,Ad.ease)):0,A&&t._yoyo&&!t._repeat&&(A=t._yEase,t._yEase=t._ease,t._ease=A),t._from=!O&&!!v.runBackwards,!O||M&&!v.stagger){if(f=(u=C[0]?fp(C[0]).harness:0)&&v[u.prop],s=Rp(v,op),P&&(P._zTime<0&&P.progress(1),i<0&&T&&x&&!S?P.render(-1,!0):P.revert(T&&E?sp:np),P._lazy=0),y){if(kp(t._startAt=tf.set(C,Ep({data:"isStart",overwrite:!1,parent:R,immediateRender:!0,lazy:!P&&Bd(b),startAt:null,delay:0,onUpdate:w&&function(){return gm(t,"onUpdate")},stagger:0},y))),t._startAt._dp=0,t._startAt._sat=t,i<0&&(ad||!x&&!S)&&t._startAt.revert(sp),x&&E&&i<=0&&n<=0)return void(i&&(t._zTime=i))}else if(T&&E&&!P)if(i&&(x=!1),o=Ep({overwrite:!1,data:"isFromStart",lazy:x&&!P&&Bd(b),immediateRender:x,stagger:0,parent:R},s),f&&(o[u.prop]=f),kp(t._startAt=tf.set(C,o)),t._startAt._dp=0,t._startAt._sat=t,i<0&&(ad?t._startAt.revert(sp):t._startAt.render(-1,!0)),t._zTime=i,x){if(!i)return}else e(t._startAt,Sd,Sd);for(t._pt=t._ptCache=0,b=E&&Bd(b)||b&&!E,r=0;r<C.length;r++){if(h=(l=C[r])._gsap||mp(C)[r]._gsap,t._ptLookup[r]=p={},lp[h.id]&&ap.length&&wp(),m=L===C?r:L.indexOf(l),u&&!1!==(d=new u).init(l,f||s,t,m,L)&&(t._pt=a=new gf(t._pt,l,d.name,0,1,d.render,d,0,d.priority),d._props.forEach((function(e){p[e]=a})),d.priority&&(c=1)),!u||f)for(o in s)cp[o]&&(d=Ym(o,s,t,m,l,L))?d.priority&&(c=1):p[o]=a=qm.call(t,l,o,"get",s[o],m,L,0,v.stringFilter);t._op&&t._op[r]&&t.kill(l,t._op[r]),D&&t._pt&&(Wm=t,cd.killTweensOf(l,p,t.globalTime(i)),g=!t.parent,Wm=0),t._pt&&b&&(lp[h.id]=1)}c&&ff(t),t._onInit&&t._onInit(t)}t._onUpdate=w,t._initted=(!t._op||t._pt)&&!g,M&&i<=0&&O.render(Md,!0,!0)},$m=function(e,t,i,n){var s,r,o=t.ease||n||"power1.inOut";if(Hd(t))r=i[e]||(i[e]=[]),t.forEach((function(e,i){return r.push({t:i/(t.length-1)*100,v:e,e:o})}));else for(s in t)r=i[s]||(i[s]=[]),"ease"===s||r.push({t:parseFloat(e),v:t[s],e:o})},Qm=function(e,t,i,n,s){return kd(e)?e.call(t,i,n,s):Od(e)&&~e.indexOf("random(")?pm(e):e},Jm=pp+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",ef={};vp(Jm+",id,stagger,delay,duration,paused,scrollTrigger",(function(e){return ef[e]=1}));var tf=function(e){function t(t,i,n,s){var r;"number"==typeof i&&(n.duration=i,i=n,n=null);var o,a,l,c,h,u,d,p,m=(r=e.call(this,s?i:Lp(i))||this).vars,f=m.duration,g=m.delay,v=m.immediateRender,_=m.stagger,y=m.overwrite,x=m.keyframes,b=m.defaults,w=m.scrollTrigger,T=m.yoyoEase,A=i.parent||cd,M=(Hd(t)||jd(t)?Id(t[0]):"length"in i)?[t]:rm(t);if(r._targets=M.length?mp(M):ep("GSAP target "+t+" not found. https://gsap.com",!Td.nullTargetWarn)||[],r._ptLookup=[],r._overwrite=y,x||_||Nd(f)||Nd(g)){if(i=r.vars,(o=r.timeline=new Vm({data:"nested",defaults:b||{},targets:A&&"nested"===A.data?A.vars.targets:M})).kill(),o.parent=o._dp=sd(r),o._start=0,_||Nd(f)||Nd(g)){if(c=M.length,d=_&&lm(_),Ud(_))for(h in _)~Jm.indexOf(h)&&(p||(p={}),p[h]=_[h]);for(a=0;a<c;a++)(l=Rp(i,ef)).stagger=0,T&&(l.yoyoEase=T),p&&Pp(l,p),u=M[a],l.duration=+Qm(f,sd(r),a,u,M),l.delay=(+Qm(g,sd(r),a,u,M)||0)-r._delay,!_&&1===c&&l.delay&&(r._delay=g=l.delay,r._start+=g,l.delay=0),o.to(u,l,d?d(a,u,M):0),o._ease=Lm.none;o.duration()?f=g=0:r.timeline=0}else if(x){Lp(Ep(o.vars.defaults,{ease:"none"})),o._ease=Um(x.ease||i.ease||"none");var S,E,P,C=0;if(Hd(x))x.forEach((function(e){return o.to(M,e,">")})),o.duration();else{for(h in l={},x)"ease"===h||"easeEach"===h||$m(h,x[h],l,x.easeEach);for(h in l)for(S=l[h].sort((function(e,t){return e.t-t.t})),C=0,a=0;a<S.length;a++)(P={ease:(E=S[a]).e,duration:(E.t-(a?S[a-1].t:0))/100*f})[h]=E.v,o.to(M,P,C),C+=P.duration;o.duration()<f&&o.to({},{duration:f-o.duration()})}}f||r.duration(f=o.duration())}else r.timeline=0;return!0===y&&!od&&(Wm=sd(r),cd.killTweensOf(M),Wm=0),Vp(A,sd(r),n),i.reversed&&r.reverse(),i.paused&&r.paused(!0),(v||!f&&!x&&r._start===yp(A._time)&&Bd(v)&&Up(sd(r))&&"nested"!==A.data)&&(r._tTime=-1e-8,r.render(Math.max(0,-g)||0)),w&&Wp(sd(r),w),r}rd(t,e);var i=t.prototype;return i.render=function(e,t,i){var n,s,r,o,a,l,c,h,u,d=this._time,p=this._tDur,m=this._dur,f=e<0,g=e>p-Sd&&!f?p:e<Sd?0:e;if(m){if(g!==this._tTime||!e||i||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==f||this._lazy){if(n=g,h=this.timeline,this._repeat){if(o=m+this._rDelay,this._repeat<-1&&f)return this.totalTime(100*o+e,t,i);if(n=yp(g%o),g===p?(r=this._repeat,n=m):(r=~~(a=yp(g/o)))&&r===a?(n=m,r--):n>m&&(n=m),(l=this._yoyo&&1&r)&&(u=this._yEase,n=m-n),a=zp(this._tTime,o),n===d&&!i&&this._initted&&r===a)return this._tTime=g,this;r!==a&&(h&&this._yEase&&Fm(h,l),this.vars.repeatRefresh&&!l&&!this._lock&&n!==o&&this._initted&&(this._lock=i=1,this.render(yp(o*r),!0).invalidate()._lock=0))}if(!this._initted){if(Kp(this,f?e:n,i,t,g))return this._tTime=0,this;if(!(d===this._time||i&&this.vars.repeatRefresh&&r!==a))return this;if(m!==this._dur)return this.render(e,t,i)}if(this._tTime=g,this._time=n,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=c=(u||this._ease)(n/m),this._from&&(this.ratio=c=1-c),!d&&g&&!t&&!a&&(gm(this,"onStart"),this._tTime!==g))return this;for(s=this._pt;s;)s.r(c,s.d),s=s._next;h&&h.render(e<0?e:h._dur*h._ease(n/this._dur),t,i)||this._startAt&&(this._zTime=e),this._onUpdate&&!t&&(f&&Fp(this,e,0,i),gm(this,"onUpdate")),this._repeat&&r!==a&&this.vars.onRepeat&&!t&&this.parent&&gm(this,"onRepeat"),(g===this._tDur||!g)&&this._tTime===g&&(f&&!this._onUpdate&&Fp(this,e,0,!0),(e||!m)&&(g===this._tDur&&this._ts>0||!g&&this._ts<0)&&kp(this,1),!t&&(!f||d)&&(g||d||l)&&(gm(this,g===p?"onComplete":"onReverseComplete",!0),this._prom&&!(g<p&&this.timeScale()>0)&&this._prom()))}}else!function(e,t,i,n){var s,r,o,a=e.ratio,l=t<0||!t&&(!e._start&&Xp(e)&&(e._initted||!qp(e))||(e._ts<0||e._dp._ts<0)&&!qp(e))?0:1,c=e._rDelay,h=0;if(c&&e._repeat&&(h=tm(0,e._tDur,t),r=zp(h,c),e._yoyo&&1&r&&(l=1-l),r!==zp(e._tTime,c)&&(a=1-l,e.vars.repeatRefresh&&e._initted&&e.invalidate())),l!==a||ad||n||e._zTime===Sd||!t&&e._zTime){if(!e._initted&&Kp(e,t,n,i,h))return;for(o=e._zTime,e._zTime=t||(i?Sd:0),i||(i=t&&!o),e.ratio=l,e._from&&(l=1-l),e._time=0,e._tTime=h,s=e._pt;s;)s.r(l,s.d),s=s._next;t<0&&Fp(e,t,0,!0),e._onUpdate&&!i&&gm(e,"onUpdate"),h&&e._repeat&&!i&&e.parent&&gm(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===l&&(l&&kp(e,1),!i&&!ad&&(gm(e,l?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)}(this,e,t,i);return this},i.targets=function(){return this._targets},i.invalidate=function(t){return(!t||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(t),e.prototype.invalidate.call(this,t)},i.resetTo=function(e,t,i,n,s){gd||Cm.wake(),this._ts||this.play();var r=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||Zm(this,r),function(e,t,i,n,s,r,o,a){var l,c,h,u,d=(e._pt&&e._ptCache||(e._ptCache={}))[t];if(!d)for(d=e._ptCache[t]=[],h=e._ptLookup,u=e._targets.length;u--;){if((l=h[u][t])&&l.d&&l.d._pt)for(l=l.d._pt;l&&l.p!==t&&l.fp!==t;)l=l._next;if(!l)return Km=1,e.vars[t]="+=0",Zm(e,o),Km=0,a?ep(t+" not eligible for reset"):1;d.push(l)}for(u=d.length;u--;)(l=(c=d[u])._pt||c).s=!n&&0!==n||s?l.s+(n||0)+r*l.c:n,l.c=i-l.s,c.e&&(c.e=_p(i)+im(c.e)),c.b&&(c.b=l.s+im(c.b))}(this,e,t,i,n,this._ease(r/this._dur),r,s)?this.resetTo(e,t,i,n,1):(Hp(this,0),this.parent||Dp(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},i.kill=function(e,t){if(void 0===t&&(t="all"),!(e||t&&"all"!==t))return this._lazy=this._pt=0,this.parent?vm(this):this.scrollTrigger&&this.scrollTrigger.kill(!!ad),this;if(this.timeline){var i=this.timeline.totalDuration();return this.timeline.killTweensOf(e,t,Wm&&!0!==Wm.vars.overwrite)._first||vm(this),this.parent&&i!==this.timeline.totalDuration()&&Yp(this,this._dur*this.timeline._tDur/i,0,1),this}var n,s,r,o,a,l,c,h=this._targets,u=e?rm(e):h,d=this._ptLookup,p=this._pt;if((!t||"all"===t)&&function(e,t){for(var i=e.length,n=i===t.length;n&&i--&&e[i]===t[i];);return i<0}(h,u))return"all"===t&&(this._pt=0),vm(this);for(n=this._op=this._op||[],"all"!==t&&(Od(t)&&(a={},vp(t,(function(e){return a[e]=1})),t=a),t=function(e,t){var i,n,s,r,o=e[0]?fp(e[0]).harness:0,a=o&&o.aliases;if(!a)return t;for(n in i=Pp({},t),a)if(n in i)for(s=(r=a[n].split(",")).length;s--;)i[r[s]]=i[n];return i}(h,t)),c=h.length;c--;)if(~u.indexOf(h[c]))for(a in s=d[c],"all"===t?(n[c]=t,o=s,r={}):(r=n[c]=n[c]||{},o=t),o)(l=s&&s[a])&&((!("kill"in l.d)||!0===l.d.kill(a))&&Op(this,l,"_pt"),delete s[a]),"all"!==r&&(r[a]=1);return this._initted&&!this._pt&&p&&vm(this),this},t.to=function(e,i){return new t(e,i,arguments[2])},t.from=function(e,t){return Jp(1,arguments)},t.delayedCall=function(e,i,n,s){return new t(i,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:e,onComplete:i,onReverseComplete:i,onCompleteParams:n,onReverseCompleteParams:n,callbackScope:s})},t.fromTo=function(e,t,i){return Jp(2,arguments)},t.set=function(e,i){return i.duration=0,i.repeatDelay||(i.repeat=0),new t(e,i)},t.killTweensOf=function(e,t,i){return cd.killTweensOf(e,t,i)},t}(Gm);Ep(tf.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),vp("staggerTo,staggerFrom,staggerFromTo",(function(e){tf[e]=function(){var t=new Vm,i=nm.call(arguments,0);return i.splice("staggerFromTo"===e?5:4,0,0),t[e].apply(t,i)}}));var nf=function(e,t,i){return e[t]=i},sf=function(e,t,i){return e[t](i)},rf=function(e,t,i,n){return e[t](n.fp,i)},of=function(e,t,i){return e.setAttribute(t,i)},af=function(e,t){return kd(e[t])?sf:Fd(e[t])&&e.setAttribute?of:nf},lf=function(e,t){return t.set(t.t,t.p,Math.round(1e6*(t.s+t.c*e))/1e6,t)},cf=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},hf=function(e,t){var i=t._pt,n="";if(!e&&t.b)n=t.b;else if(1===e&&t.e)n=t.e;else{for(;i;)n=i.p+(i.m?i.m(i.s+i.c*e):Math.round(1e4*(i.s+i.c*e))/1e4)+n,i=i._next;n+=t.c}t.set(t.t,t.p,n,t)},uf=function(e,t){for(var i=t._pt;i;)i.r(e,i.d),i=i._next},df=function(e,t,i,n){for(var s,r=this._pt;r;)s=r._next,r.p===n&&r.modifier(e,t,i),r=s},pf=function(e){for(var t,i,n=this._pt;n;)i=n._next,n.p===e&&!n.op||n.op===e?Op(this,n,"_pt"):n.dep||(t=1),n=i;return!t},mf=function(e,t,i,n){n.mSet(e,t,n.m.call(n.tween,i,n.mt),n)},ff=function(e){for(var t,i,n,s,r=e._pt;r;){for(t=r._next,i=n;i&&i.pr>r.pr;)i=i._next;(r._prev=i?i._prev:s)?r._prev._next=r:n=r,(r._next=i)?i._prev=r:s=r,r=t}e._pt=n},gf=function(){function e(e,t,i,n,s,r,o,a,l){this.t=t,this.s=n,this.c=s,this.p=i,this.r=r||lf,this.d=o||this,this.set=a||nf,this.pr=l||0,this._next=e,e&&(e._prev=this)}return e.prototype.modifier=function(e,t,i){this.mSet=this.mSet||this.set,this.set=mf,this.m=e,this.mt=i,this.tween=t},e}();vp(pp+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",(function(e){return op[e]=1})),Zd.TweenMax=Zd.TweenLite=tf,Zd.TimelineLite=Zd.TimelineMax=Vm,cd=new Vm({sortChildren:!1,defaults:Ad,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),Td.stringFilter=Pm;var vf=[],_f={},yf=[],xf=0,bf=0,wf=function(e){return(_f[e]||yf).map((function(e){return e()}))},Tf=function(){var e=Date.now(),t=[];e-xf>2&&(wf("matchMediaInit"),vf.forEach((function(e){var i,n,s,r,o=e.queries,a=e.conditions;for(n in o)(i=hd.matchMedia(o[n]).matches)&&(s=1),i!==a[n]&&(a[n]=i,r=1);r&&(e.revert(),s&&t.push(e))})),wf("matchMediaRevert"),t.forEach((function(e){return e.onMatch(e,(function(t){return e.add(null,t)}))})),xf=e,wf("matchMedia"))},Af=function(){function e(e,t){this.selector=t&&om(t),this.data=[],this._r=[],this.isReverted=!1,this.id=bf++,e&&this.add(e)}var t=e.prototype;return t.add=function(e,t,i){kd(e)&&(i=t,t=e,e=kd);var n=this,s=function(){var e,s=ld,r=n.selector;return s&&s!==n&&s.data.push(n),i&&(n.selector=om(i)),ld=n,e=t.apply(n,arguments),kd(e)&&n._r.push(e),ld=s,n.selector=r,n.isReverted=!1,e};return n.last=s,e===kd?s(n,(function(e){return n.add(null,e)})):e?n[e]=s:s},t.ignore=function(e){var t=ld;ld=null,e(this),ld=t},t.getTweens=function(){var t=[];return this.data.forEach((function(i){return i instanceof e?t.push.apply(t,i.getTweens()):i instanceof tf&&!(i.parent&&"nested"===i.parent.data)&&t.push(i)})),t},t.clear=function(){this._r.length=this.data.length=0},t.kill=function(e,t){var i=this;if(e?function(){for(var t,n=i.getTweens(),s=i.data.length;s--;)"isFlip"===(t=i.data[s]).data&&(t.revert(),t.getChildren(!0,!0,!1).forEach((function(e){return n.splice(n.indexOf(e),1)})));for(n.map((function(e){return{g:e._dur||e._delay||e._sat&&!e._sat.vars.immediateRender?e.globalTime(0):-1/0,t:e}})).sort((function(e,t){return t.g-e.g||-1/0})).forEach((function(t){return t.t.revert(e)})),s=i.data.length;s--;)(t=i.data[s])instanceof Vm?"nested"!==t.data&&(t.scrollTrigger&&t.scrollTrigger.revert(),t.kill()):!(t instanceof tf)&&t.revert&&t.revert(e);i._r.forEach((function(t){return t(e,i)})),i.isReverted=!0}():this.data.forEach((function(e){return e.kill&&e.kill()})),this.clear(),t)for(var n=vf.length;n--;)vf[n].id===this.id&&vf.splice(n,1)},t.revert=function(e){this.kill(e||{})},e}(),Mf=function(){function e(e){this.contexts=[],this.scope=e,ld&&ld.data.push(this)}var t=e.prototype;return t.add=function(e,t,i){Ud(e)||(e={matches:e});var n,s,r,o=new Af(0,i||this.scope),a=o.conditions={};for(s in ld&&!o.selector&&(o.selector=ld.selector),this.contexts.push(o),t=o.add("onMatch",t),o.queries=e,e)"all"===s?r=1:(n=hd.matchMedia(e[s]))&&(vf.indexOf(o)<0&&vf.push(o),(a[s]=n.matches)&&(r=1),n.addListener?n.addListener(Tf):n.addEventListener("change",Tf));return r&&t(o,(function(e){return o.add(null,e)})),this},t.revert=function(e){this.kill(e||{})},t.kill=function(e){this.contexts.forEach((function(t){return t.kill(e,!0)}))},e}(),Sf={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach((function(e){return ym(e)}))},timeline:function(e){return new Vm(e)},getTweensOf:function(e,t){return cd.getTweensOf(e,t)},getProperty:function(e,t,i,n){Od(e)&&(e=rm(e)[0]);var s=fp(e||{}).get,r=i?Sp:Mp;return"native"===i&&(i=""),e&&(t?r((cp[t]&&cp[t].get||s)(e,t,i,n)):function(t,i,n){return r((cp[t]&&cp[t].get||s)(e,t,i,n))})},quickSetter:function(e,t,i){if((e=rm(e)).length>1){var n=e.map((function(e){return Cf.quickSetter(e,t,i)})),s=n.length;return function(e){for(var t=s;t--;)n[t](e)}}e=e[0]||{};var r=cp[t],o=fp(e),a=o.harness&&(o.harness.aliases||{})[t]||t,l=r?function(t){var n=new r;fd._pt=0,n.init(e,i?t+i:t,fd,0,[e]),n.render(1,n),fd._pt&&uf(1,fd)}:o.set(e,a);return r?l:function(t){return l(e,a,i?t+i:t,o,1)}},quickTo:function(e,t,i){var n,s=Cf.to(e,Ep(((n={})[t]="+=0.1",n.paused=!0,n.stagger=0,n),i||{})),r=function(e,i,n){return s.resetTo(t,e,i,n)};return r.tween=s,r},isTweening:function(e){return cd.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Um(e.ease,Ad.ease)),Cp(Ad,e||{})},config:function(e){return Cp(Td,e||{})},registerEffect:function(e){var t=e.name,i=e.effect,n=e.plugins,s=e.defaults,r=e.extendTimeline;(n||"").split(",").forEach((function(e){return e&&!cp[e]&&!Zd[e]&&ep(t+" effect requires "+e+" plugin.")})),hp[t]=function(e,t,n){return i(rm(e),Ep(t||{},s),n)},r&&(Vm.prototype[t]=function(e,i,n){return this.add(hp[t](e,Ud(i)?i:(n=i)&&{},this),n)})},registerEase:function(e,t){Lm[e]=Um(t)},parseEase:function(e,t){return arguments.length?Um(e,t):Lm},getById:function(e){return cd.getById(e)},exportRoot:function(e,t){void 0===e&&(e={});var i,n,s=new Vm(e);for(s.smoothChildTiming=Bd(e.smoothChildTiming),cd.remove(s),s._dp=0,s._time=s._tTime=cd._time,i=cd._first;i;)n=i._next,(t||!(!i._dur&&i instanceof tf&&i.vars.onComplete===i._targets[0]))&&Vp(s,i,i._start-i._delay),i=n;return Vp(cd,s,0),s},context:function(e,t){return e?new Af(e,t):ld},matchMedia:function(e){return new Mf(e)},matchMediaRefresh:function(){return vf.forEach((function(e){var t,i,n=e.conditions;for(i in n)n[i]&&(n[i]=!1,t=1);t&&e.revert()}))||Tf()},addEventListener:function(e,t){var i=_f[e]||(_f[e]=[]);~i.indexOf(t)||i.push(t)},removeEventListener:function(e,t){var i=_f[e],n=i&&i.indexOf(t);n>=0&&i.splice(n,1)},utils:{wrap:function e(t,i,n){var s=i-t;return Hd(t)?dm(t,e(0,t.length),i):em(n,(function(e){return(s+(e-t)%s)%s+t}))},wrapYoyo:function e(t,i,n){var s=i-t,r=2*s;return Hd(t)?dm(t,e(0,t.length-1),i):em(n,(function(e){return t+((e=(r+(e-t)%r)%r||0)>s?r-e:e)}))},distribute:lm,random:um,snap:hm,normalize:function(e,t,i){return mm(e,t,0,1,i)},getUnit:im,clamp:function(e,t,i){return em(i,(function(i){return tm(e,t,i)}))},splitColor:Tm,toArray:rm,selector:om,mapRange:mm,pipe:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(e){return t.reduce((function(e,t){return t(e)}),e)}},unitize:function(e,t){return function(i){return e(parseFloat(i))+(t||im(i))}},interpolate:function e(t,i,n,s){var r=isNaN(t+i)?0:function(e){return(1-e)*t+e*i};if(!r){var o,a,l,c,h,u=Od(t),d={};if(!0===n&&(s=1)&&(n=null),u)t={p:t},i={p:i};else if(Hd(t)&&!Hd(i)){for(l=[],c=t.length,h=c-2,a=1;a<c;a++)l.push(e(t[a-1],t[a]));c--,r=function(e){e*=c;var t=Math.min(h,~~e);return l[t](e-t)},n=i}else s||(t=Pp(Hd(t)?[]:{},t));if(!l){for(o in i)qm.call(d,t,o,"get",i[o]);r=function(e){return uf(e,d)||(u?t.p:t)}}}return em(n,r)},shuffle:am},install:Qd,effects:hp,ticker:Cm,updateRoot:Vm.updateRoot,plugins:cp,globalTimeline:cd,core:{PropTween:gf,globals:tp,Tween:tf,Timeline:Vm,Animation:Gm,getCache:fp,_removeLinkedListItem:Op,reverting:function(){return ad},context:function(e){return e&&ld&&(ld.data.push(e),e._ctx=ld),ld},suppressOverwrites:function(e){return od=e}}};vp("to,from,fromTo,delayedCall,set,killTweensOf",(function(e){return Sf[e]=tf[e]})),Cm.add(Vm.updateRoot),fd=Sf.to({},{duration:0});var Ef=function(e,t){for(var i=e._pt;i&&i.p!==t&&i.op!==t&&i.fp!==t;)i=i._next;return i},Pf=function(e,t){return{name:e,headless:1,rawVars:1,init:function(e,i,n){n._onInit=function(e){var n,s;if(Od(i)&&(n={},vp(i,(function(e){return n[e]=1})),i=n),t){for(s in n={},i)n[s]=t(i[s]);i=n}!function(e,t){var i,n,s,r=e._targets;for(i in t)for(n=r.length;n--;)(s=e._ptLookup[n][i])&&(s=s.d)&&(s._pt&&(s=Ef(s,i)),s&&s.modifier&&s.modifier(t[i],e,r[n],i))}(e,i)}}}},Cf=Sf.registerPlugin({name:"attr",init:function(e,t,i,n,s){var r,o,a;for(r in this.tween=i,t)a=e.getAttribute(r)||"",(o=this.add(e,"setAttribute",(a||0)+"",t[r],n,s,0,0,r)).op=r,o.b=a,this._props.push(r)},render:function(e,t){for(var i=t._pt;i;)ad?i.set(i.t,i.p,i.b,i):i.r(e,i.d),i=i._next}},{name:"endArray",headless:1,init:function(e,t){for(var i=t.length;i--;)this.add(e,i,e[i]||0,t[i],0,0,0,0,0,1)}},Pf("roundProps",cm),Pf("modifiers"),Pf("snap",hm))||Sf;tf.version=Vm.version=Cf.version="3.13.0",pd=1,zd()&&Rm(),Lm.Power0,Lm.Power1,Lm.Power2,Lm.Power3,Lm.Power4,Lm.Linear,Lm.Quad,Lm.Cubic,Lm.Quart,Lm.Quint,Lm.Strong,Lm.Elastic,Lm.Back,Lm.SteppedEase,Lm.Bounce,Lm.Sine,Lm.Expo,Lm.Circ;
/*!
 * CSSPlugin 3.13.0
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/
var Rf,Lf,Df,Of,kf,If,Ff,Uf,Bf={},zf=180/Math.PI,Nf=Math.PI/180,jf=Math.atan2,Hf=1e8,Gf=/([A-Z])/g,Vf=/(left|right|width|margin|padding|x)/i,Wf=/[\s,\(]\S/,Kf={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Xf=function(e,t){return t.set(t.t,t.p,Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},qf=function(e,t){return t.set(t.t,t.p,1===e?t.e:Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},Yf=function(e,t){return t.set(t.t,t.p,e?Math.round(1e4*(t.s+t.c*e))/1e4+t.u:t.b,t)},Zf=function(e,t){var i=t.s+t.c*e;t.set(t.t,t.p,~~(i+(i<0?-.5:.5))+t.u,t)},$f=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},Qf=function(e,t){return t.set(t.t,t.p,1!==e?t.b:t.e,t)},Jf=function(e,t,i){return e.style[t]=i},eg=function(e,t,i){return e.style.setProperty(t,i)},tg=function(e,t,i){return e._gsap[t]=i},ig=function(e,t,i){return e._gsap.scaleX=e._gsap.scaleY=i},ng=function(e,t,i,n,s){var r=e._gsap;r.scaleX=r.scaleY=i,r.renderTransform(s,r)},sg=function(e,t,i,n,s){var r=e._gsap;r[t]=i,r.renderTransform(s,r)},rg="transform",og=rg+"Origin",ag=function e(t,i){var n=this,s=this.target,r=s.style,o=s._gsap;if(t in Bf&&r){if(this.tfm=this.tfm||{},"transform"===t)return Kf.transform.split(",").forEach((function(t){return e.call(n,t,i)}));if(~(t=Kf[t]||t).indexOf(",")?t.split(",").forEach((function(e){return n.tfm[e]=Mg(s,e)})):this.tfm[t]=o.x?o[t]:Mg(s,t),t===og&&(this.tfm.zOrigin=o.zOrigin),this.props.indexOf(rg)>=0)return;o.svg&&(this.svgo=s.getAttribute("data-svg-origin"),this.props.push(og,i,"")),t=rg}(r||i)&&this.props.push(t,i,r[t])},lg=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},cg=function(){var e,t,i=this.props,n=this.target,s=n.style,r=n._gsap;for(e=0;e<i.length;e+=3)i[e+1]?2===i[e+1]?n[i[e]](i[e+2]):n[i[e]]=i[e+2]:i[e+2]?s[i[e]]=i[e+2]:s.removeProperty("--"===i[e].substr(0,2)?i[e]:i[e].replace(Gf,"-$1").toLowerCase());if(this.tfm){for(t in this.tfm)r[t]=this.tfm[t];r.svg&&(r.renderTransform(),n.setAttribute("data-svg-origin",this.svgo||"")),(!(e=Ff())||!e.isStart)&&!s[rg]&&(lg(s),r.zOrigin&&s[og]&&(s[og]+=" "+r.zOrigin+"px",r.zOrigin=0,r.renderTransform()),r.uncache=1)}},hg=function(e,t){var i={target:e,props:[],revert:cg,save:ag};return e._gsap||Cf.core.getCache(e),t&&e.style&&e.nodeType&&t.split(",").forEach((function(e){return i.save(e)})),i},ug=function(e,t){var i=Lf.createElementNS?Lf.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Lf.createElement(e);return i&&i.style?i:Lf.createElement(e)},dg=function e(t,i,n){var s=getComputedStyle(t);return s[i]||s.getPropertyValue(i.replace(Gf,"-$1").toLowerCase())||s.getPropertyValue(i)||!n&&e(t,mg(i)||i,1)||""},pg="O,Moz,ms,Ms,Webkit".split(","),mg=function(e,t,i){var n=(t||kf).style,s=5;if(e in n&&!i)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);s--&&!(pg[s]+e in n););return s<0?null:(3===s?"ms":s>=0?pg[s]:"")+e},fg=function(){typeof window<"u"&&window.document&&(Rf=window,Lf=Rf.document,Df=Lf.documentElement,kf=ug("div")||{style:{}},ug("div"),rg=mg(rg),og=rg+"Origin",kf.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",Uf=!!mg("perspective"),Ff=Cf.core.reverting,Of=1)},gg=function(e){var t,i=e.ownerSVGElement,n=ug("svg",i&&i.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),s=e.cloneNode(!0);s.style.display="block",n.appendChild(s),Df.appendChild(n);try{t=s.getBBox()}catch{}return n.removeChild(s),Df.removeChild(n),t},vg=function(e,t){for(var i=t.length;i--;)if(e.hasAttribute(t[i]))return e.getAttribute(t[i])},_g=function(e){var t,i;try{t=e.getBBox()}catch{t=gg(e),i=1}return t&&(t.width||t.height)||i||(t=gg(e)),!t||t.width||t.x||t.y?t:{x:+vg(e,["x","cx","x1"])||0,y:+vg(e,["y","cy","y1"])||0,width:0,height:0}},yg=function(e){return!(!e.getCTM||e.parentNode&&!e.ownerSVGElement||!_g(e))},xg=function(e,t){if(t){var i,n=e.style;t in Bf&&t!==og&&(t=rg),n.removeProperty?(("ms"===(i=t.substr(0,2))||"webkit"===t.substr(0,6))&&(t="-"+t),n.removeProperty("--"===i?t:t.replace(Gf,"-$1").toLowerCase())):n.removeAttribute(t)}},bg=function(e,t,i,n,s,r){var o=new gf(e._pt,t,i,0,1,r?Qf:$f);return e._pt=o,o.b=n,o.e=s,e._props.push(i),o},wg={deg:1,rad:1,turn:1},Tg={grid:1,flex:1},Ag=function e(t,i,n,s){var r,o,a,l,c=parseFloat(n)||0,h=(n+"").trim().substr((c+"").length)||"px",u=kf.style,d=Vf.test(i),p="svg"===t.tagName.toLowerCase(),m=(p?"client":"offset")+(d?"Width":"Height"),f=100,g="px"===s,v="%"===s;if(s===h||!c||wg[s]||wg[h])return c;if("px"!==h&&!g&&(c=e(t,i,n,"px")),l=t.getCTM&&yg(t),(v||"%"===h)&&(Bf[i]||~i.indexOf("adius")))return r=l?t.getBBox()[d?"width":"height"]:t[m],_p(v?c/r*f:c/100*r);if(u[d?"width":"height"]=f+(g?h:s),o="rem"!==s&&~i.indexOf("adius")||"em"===s&&t.appendChild&&!p?t:t.parentNode,l&&(o=(t.ownerSVGElement||{}).parentNode),(!o||o===Lf||!o.appendChild)&&(o=Lf.body),(a=o._gsap)&&v&&a.width&&d&&a.time===Cm.time&&!a.uncache)return _p(c/a.width*f);if(!v||"height"!==i&&"width"!==i)(v||"%"===h)&&!Tg[dg(o,"display")]&&(u.position=dg(t,"position")),o===t&&(u.position="static"),o.appendChild(kf),r=kf[m],o.removeChild(kf),u.position="absolute";else{var _=t.style[i];t.style[i]=f+s,r=t[m],_?t.style[i]=_:xg(t,i)}return d&&v&&((a=fp(o)).time=Cm.time,a.width=o[m]),_p(g?r*c/f:r&&c?f/r*c:0)},Mg=function(e,t,i,n){var s;return Of||fg(),t in Kf&&"transform"!==t&&(~(t=Kf[t]).indexOf(",")&&(t=t.split(",")[0])),Bf[t]&&"transform"!==t?(s=Ug(e,n),s="transformOrigin"!==t?s[t]:s.svg?s.origin:Bg(dg(e,og))+" "+s.zOrigin+"px"):(!(s=e.style[t])||"auto"===s||n||~(s+"").indexOf("calc("))&&(s=Rg[t]&&Rg[t](e,t,i)||dg(e,t)||gp(e,t)||("opacity"===t?1:0)),i&&!~(s+"").trim().indexOf(" ")?Ag(e,t,s,i)+i:s},Sg=function(e,t,i,n){if(!i||"none"===i){var s=mg(t,e,1),r=s&&dg(e,s,1);r&&r!==i?(t=s,i=r):"borderColor"===t&&(i=dg(e,"borderTopColor"))}var o,a,l,c,h,u,d,p,m,f,g,v=new gf(this._pt,e.style,t,0,1,hf),_=0,y=0;if(v.b=i,v.e=n,i+="","var(--"===(n+="").substring(0,6)&&(n=dg(e,n.substring(4,n.indexOf(")")))),"auto"===n&&(u=e.style[t],e.style[t]=n,n=dg(e,t)||n,u?e.style[t]=u:xg(e,t)),Pm(o=[i,n]),n=o[1],l=(i=o[0]).match(Wd)||[],(n.match(Wd)||[]).length){for(;a=Wd.exec(n);)d=a[0],m=n.substring(_,a.index),h?h=(h+1)%5:("rgba("===m.substr(-5)||"hsla("===m.substr(-5))&&(h=1),d!==(u=l[y++]||"")&&(c=parseFloat(u)||0,g=u.substr((c+"").length),"="===d.charAt(1)&&(d=xp(c,d)+g),p=parseFloat(d),f=d.substr((p+"").length),_=Wd.lastIndex-f.length,f||(f=f||Td.units[t]||g,_===n.length&&(n+=f,v.e+=f)),g!==f&&(c=Ag(e,t,u,f)||0),v._pt={_next:v._pt,p:m||1===y?m:",",s:c,c:p-c,m:h&&h<4||"zIndex"===t?Math.round:0});v.c=_<n.length?n.substring(_,n.length):""}else v.r="display"===t&&"none"===n?Qf:$f;return Xd.test(n)&&(v.e=0),this._pt=v,v},Eg={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Pg=function(e){var t=e.split(" "),i=t[0],n=t[1]||"50%";return("top"===i||"bottom"===i||"left"===n||"right"===n)&&(e=i,i=n,n=e),t[0]=Eg[i]||i,t[1]=Eg[n]||n,t.join(" ")},Cg=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var i,n,s,r=t.t,o=r.style,a=t.u,l=r._gsap;if("all"===a||!0===a)o.cssText="",n=1;else for(s=(a=a.split(",")).length;--s>-1;)i=a[s],Bf[i]&&(n=1,i="transformOrigin"===i?og:rg),xg(r,i);n&&(xg(r,rg),l&&(l.svg&&r.removeAttribute("transform"),o.scale=o.rotate=o.translate="none",Ug(r,1),l.uncache=1,lg(o)))}},Rg={clearProps:function(e,t,i,n,s){if("isFromStart"!==s.data){var r=e._pt=new gf(e._pt,t,i,0,0,Cg);return r.u=n,r.pr=-10,r.tween=s,e._props.push(i),1}}},Lg=[1,0,0,1,0,0],Dg={},Og=function(e){return"matrix(1, 0, 0, 1, 0, 0)"===e||"none"===e||!e},kg=function(e){var t=dg(e,rg);return Og(t)?Lg:t.substr(7).match(Vd).map(_p)},Ig=function(e,t){var i,n,s,r,o=e._gsap||fp(e),a=e.style,l=kg(e);return o.svg&&e.getAttribute("transform")?"1,0,0,1,0,0"===(l=[(s=e.transform.baseVal.consolidate().matrix).a,s.b,s.c,s.d,s.e,s.f]).join(",")?Lg:l:(l===Lg&&!e.offsetParent&&e!==Df&&!o.svg&&(s=a.display,a.display="block",(!(i=e.parentNode)||!e.offsetParent&&!e.getBoundingClientRect().width)&&(r=1,n=e.nextElementSibling,Df.appendChild(e)),l=kg(e),s?a.display=s:xg(e,"display"),r&&(n?i.insertBefore(e,n):i?i.appendChild(e):Df.removeChild(e))),t&&l.length>6?[l[0],l[1],l[4],l[5],l[12],l[13]]:l)},Fg=function(e,t,i,n,s,r){var o,a,l,c=e._gsap,h=s||Ig(e,!0),u=c.xOrigin||0,d=c.yOrigin||0,p=c.xOffset||0,m=c.yOffset||0,f=h[0],g=h[1],v=h[2],_=h[3],y=h[4],x=h[5],b=t.split(" "),w=parseFloat(b[0])||0,T=parseFloat(b[1])||0;i?h!==Lg&&(a=f*_-g*v)&&(l=w*(-g/a)+T*(f/a)-(f*x-g*y)/a,w=w*(_/a)+T*(-v/a)+(v*x-_*y)/a,T=l):(w=(o=_g(e)).x+(~b[0].indexOf("%")?w/100*o.width:w),T=o.y+(~(b[1]||b[0]).indexOf("%")?T/100*o.height:T)),n||!1!==n&&c.smooth?(y=w-u,x=T-d,c.xOffset=p+(y*f+x*v)-y,c.yOffset=m+(y*g+x*_)-x):c.xOffset=c.yOffset=0,c.xOrigin=w,c.yOrigin=T,c.smooth=!!n,c.origin=t,c.originIsAbsolute=!!i,e.style[og]="0px 0px",r&&(bg(r,c,"xOrigin",u,w),bg(r,c,"yOrigin",d,T),bg(r,c,"xOffset",p,c.xOffset),bg(r,c,"yOffset",m,c.yOffset)),e.setAttribute("data-svg-origin",w+" "+T)},Ug=function(e,t){var i=e._gsap||new Hm(e);if("x"in i&&!t&&!i.uncache)return i;var n,s,r,o,a,l,c,h,u,d,p,m,f,g,v,_,y,x,b,w,T,A,M,S,E,P,C,R,L,D,O,k,I=e.style,F=i.scaleX<0,U="px",B="deg",z=getComputedStyle(e),N=dg(e,og)||"0";return n=s=r=l=c=h=u=d=p=0,o=a=1,i.svg=!(!e.getCTM||!yg(e)),z.translate&&(("none"!==z.translate||"none"!==z.scale||"none"!==z.rotate)&&(I[rg]=("none"!==z.translate?"translate3d("+(z.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+("none"!==z.rotate?"rotate("+z.rotate+") ":"")+("none"!==z.scale?"scale("+z.scale.split(" ").join(",")+") ":"")+("none"!==z[rg]?z[rg]:"")),I.scale=I.rotate=I.translate="none"),g=Ig(e,i.svg),i.svg&&(i.uncache?(E=e.getBBox(),N=i.xOrigin-E.x+"px "+(i.yOrigin-E.y)+"px",S=""):S=!t&&e.getAttribute("data-svg-origin"),Fg(e,S||N,!!S||i.originIsAbsolute,!1!==i.smooth,g)),m=i.xOrigin||0,f=i.yOrigin||0,g!==Lg&&(x=g[0],b=g[1],w=g[2],T=g[3],n=A=g[4],s=M=g[5],6===g.length?(o=Math.sqrt(x*x+b*b),a=Math.sqrt(T*T+w*w),l=x||b?jf(b,x)*zf:0,(u=w||T?jf(w,T)*zf+l:0)&&(a*=Math.abs(Math.cos(u*Nf))),i.svg&&(n-=m-(m*x+f*w),s-=f-(m*b+f*T))):(k=g[6],D=g[7],C=g[8],R=g[9],L=g[10],O=g[11],n=g[12],s=g[13],r=g[14],c=(v=jf(k,L))*zf,v&&(S=A*(_=Math.cos(-v))+C*(y=Math.sin(-v)),E=M*_+R*y,P=k*_+L*y,C=A*-y+C*_,R=M*-y+R*_,L=k*-y+L*_,O=D*-y+O*_,A=S,M=E,k=P),h=(v=jf(-w,L))*zf,v&&(_=Math.cos(-v),O=T*(y=Math.sin(-v))+O*_,x=S=x*_-C*y,b=E=b*_-R*y,w=P=w*_-L*y),l=(v=jf(b,x))*zf,v&&(S=x*(_=Math.cos(v))+b*(y=Math.sin(v)),E=A*_+M*y,b=b*_-x*y,M=M*_-A*y,x=S,A=E),c&&Math.abs(c)+Math.abs(l)>359.9&&(c=l=0,h=180-h),o=_p(Math.sqrt(x*x+b*b+w*w)),a=_p(Math.sqrt(M*M+k*k)),v=jf(A,M),u=Math.abs(v)>2e-4?v*zf:0,p=O?1/(O<0?-O:O):0),i.svg&&(S=e.getAttribute("transform"),i.forceCSS=e.setAttribute("transform","")||!Og(dg(e,rg)),S&&e.setAttribute("transform",S))),Math.abs(u)>90&&Math.abs(u)<270&&(F?(o*=-1,u+=l<=0?180:-180,l+=l<=0?180:-180):(a*=-1,u+=u<=0?180:-180)),t=t||i.uncache,i.x=n-((i.xPercent=n&&(!t&&i.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-n)?-50:0)))?e.offsetWidth*i.xPercent/100:0)+U,i.y=s-((i.yPercent=s&&(!t&&i.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-s)?-50:0)))?e.offsetHeight*i.yPercent/100:0)+U,i.z=r+U,i.scaleX=_p(o),i.scaleY=_p(a),i.rotation=_p(l)+B,i.rotationX=_p(c)+B,i.rotationY=_p(h)+B,i.skewX=u+B,i.skewY=d+B,i.transformPerspective=p+U,(i.zOrigin=parseFloat(N.split(" ")[2])||!t&&i.zOrigin||0)&&(I[og]=Bg(N)),i.xOffset=i.yOffset=0,i.force3D=Td.force3D,i.renderTransform=i.svg?Wg:Uf?Vg:Ng,i.uncache=0,i},Bg=function(e){return(e=e.split(" "))[0]+" "+e[1]},zg=function(e,t,i){var n=im(t);return _p(parseFloat(t)+parseFloat(Ag(e,"x",i+"px",n)))+n},Ng=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,Vg(e,t)},jg="0deg",Hg="0px",Gg=") ",Vg=function(e,t){var i=t||this,n=i.xPercent,s=i.yPercent,r=i.x,o=i.y,a=i.z,l=i.rotation,c=i.rotationY,h=i.rotationX,u=i.skewX,d=i.skewY,p=i.scaleX,m=i.scaleY,f=i.transformPerspective,g=i.force3D,v=i.target,_=i.zOrigin,y="",x="auto"===g&&e&&1!==e||!0===g;if(_&&(h!==jg||c!==jg)){var b,w=parseFloat(c)*Nf,T=Math.sin(w),A=Math.cos(w);w=parseFloat(h)*Nf,b=Math.cos(w),r=zg(v,r,T*b*-_),o=zg(v,o,-Math.sin(w)*-_),a=zg(v,a,A*b*-_+_)}f!==Hg&&(y+="perspective("+f+Gg),(n||s)&&(y+="translate("+n+"%, "+s+"%) "),(x||r!==Hg||o!==Hg||a!==Hg)&&(y+=a!==Hg||x?"translate3d("+r+", "+o+", "+a+") ":"translate("+r+", "+o+Gg),l!==jg&&(y+="rotate("+l+Gg),c!==jg&&(y+="rotateY("+c+Gg),h!==jg&&(y+="rotateX("+h+Gg),(u!==jg||d!==jg)&&(y+="skew("+u+", "+d+Gg),(1!==p||1!==m)&&(y+="scale("+p+", "+m+Gg),v.style[rg]=y||"translate(0, 0)"},Wg=function(e,t){var i,n,s,r,o,a=t||this,l=a.xPercent,c=a.yPercent,h=a.x,u=a.y,d=a.rotation,p=a.skewX,m=a.skewY,f=a.scaleX,g=a.scaleY,v=a.target,_=a.xOrigin,y=a.yOrigin,x=a.xOffset,b=a.yOffset,w=a.forceCSS,T=parseFloat(h),A=parseFloat(u);d=parseFloat(d),p=parseFloat(p),(m=parseFloat(m))&&(p+=m=parseFloat(m),d+=m),d||p?(d*=Nf,p*=Nf,i=Math.cos(d)*f,n=Math.sin(d)*f,s=Math.sin(d-p)*-g,r=Math.cos(d-p)*g,p&&(m*=Nf,o=Math.tan(p-m),s*=o=Math.sqrt(1+o*o),r*=o,m&&(o=Math.tan(m),i*=o=Math.sqrt(1+o*o),n*=o)),i=_p(i),n=_p(n),s=_p(s),r=_p(r)):(i=f,r=g,n=s=0),(T&&!~(h+"").indexOf("px")||A&&!~(u+"").indexOf("px"))&&(T=Ag(v,"x",h,"px"),A=Ag(v,"y",u,"px")),(_||y||x||b)&&(T=_p(T+_-(_*i+y*s)+x),A=_p(A+y-(_*n+y*r)+b)),(l||c)&&(o=v.getBBox(),T=_p(T+l/100*o.width),A=_p(A+c/100*o.height)),o="matrix("+i+","+n+","+s+","+r+","+T+","+A+")",v.setAttribute("transform",o),w&&(v.style[rg]=o)},Kg=function(e,t,i,n,s){var r,o,a=360,l=Od(s),c=parseFloat(s)*(l&&~s.indexOf("rad")?zf:1)-n,h=n+c+"deg";return l&&("short"===(r=s.split("_")[1])&&((c%=a)!==c%180&&(c+=c<0?a:-360)),"cw"===r&&c<0?c=(c+a*Hf)%a-~~(c/a)*a:"ccw"===r&&c>0&&(c=(c-a*Hf)%a-~~(c/a)*a)),e._pt=o=new gf(e._pt,t,i,n,c,qf),o.e=h,o.u="deg",e._props.push(i),o},Xg=function(e,t){for(var i in t)e[i]=t[i];return e},qg=function(e,t,i){var n,s,r,o,a,l,c,h=Xg({},i._gsap),u=i.style;for(s in h.svg?(r=i.getAttribute("transform"),i.setAttribute("transform",""),u[rg]=t,n=Ug(i,1),xg(i,rg),i.setAttribute("transform",r)):(r=getComputedStyle(i)[rg],u[rg]=t,n=Ug(i,1),u[rg]=r),Bf)(r=h[s])!==(o=n[s])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(s)<0&&(a=im(r)!==(c=im(o))?Ag(i,s,r,c):parseFloat(r),l=parseFloat(o),e._pt=new gf(e._pt,n,s,a,l-a,Xf),e._pt.u=c||0,e._props.push(s));Xg(n,h)};vp("padding,margin,Width,Radius",(function(e,t){var i="Top",n="Right",s="Bottom",r="Left",o=(t<3?[i,n,s,r]:[i+r,i+n,s+n,s+r]).map((function(i){return t<2?e+i:"border"+i+e}));Rg[t>1?"border"+e:e]=function(e,t,i,n,s){var r,a;if(arguments.length<4)return r=o.map((function(t){return Mg(e,t,i)})),5===(a=r.join(" ")).split(r[0]).length?r[0]:a;r=(n+"").split(" "),a={},o.forEach((function(e,t){return a[e]=r[t]=r[t]||r[(t-1)/2|0]})),e.init(t,a,s)}}));var Yg={name:"css",register:fg,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,i,n,s){var r,o,a,l,c,h,u,d,p,m,f,g,v,_,y,x,b=this._props,w=e.style,T=i.vars.startAt;for(u in Of||fg(),this.styles=this.styles||hg(e),x=this.styles.props,this.tween=i,t)if("autoRound"!==u&&(o=t[u],!cp[u]||!Ym(u,t,i,n,e,s)))if(c=typeof o,h=Rg[u],"function"===c&&(c=typeof(o=o.call(i,n,e,s))),"string"===c&&~o.indexOf("random(")&&(o=pm(o)),h)h(this,e,u,o,i)&&(y=1);else if("--"===u.substr(0,2))r=(getComputedStyle(e).getPropertyValue(u)+"").trim(),o+="",Sm.lastIndex=0,Sm.test(r)||(d=im(r),p=im(o)),p?d!==p&&(r=Ag(e,u,r,p)+p):d&&(o+=d),this.add(w,"setProperty",r,o,n,s,0,0,u),b.push(u),x.push(u,0,w[u]);else if("undefined"!==c){if(T&&u in T?(r="function"==typeof T[u]?T[u].call(i,n,e,s):T[u],Od(r)&&~r.indexOf("random(")&&(r=pm(r)),im(r+"")||"auto"===r||(r+=Td.units[u]||im(Mg(e,u))||""),"="===(r+"").charAt(1)&&(r=Mg(e,u))):r=Mg(e,u),l=parseFloat(r),(m="string"===c&&"="===o.charAt(1)&&o.substr(0,2))&&(o=o.substr(2)),a=parseFloat(o),u in Kf&&("autoAlpha"===u&&(1===l&&"hidden"===Mg(e,"visibility")&&a&&(l=0),x.push("visibility",0,w.visibility),bg(this,w,"visibility",l?"inherit":"hidden",a?"inherit":"hidden",!a)),"scale"!==u&&"transform"!==u&&(~(u=Kf[u]).indexOf(",")&&(u=u.split(",")[0]))),f=u in Bf)if(this.styles.save(u),"string"===c&&"var(--"===o.substring(0,6)&&(o=dg(e,o.substring(4,o.indexOf(")"))),a=parseFloat(o)),g||((v=e._gsap).renderTransform&&!t.parseTransform||Ug(e,t.parseTransform),_=!1!==t.smoothOrigin&&v.smooth,(g=this._pt=new gf(this._pt,w,rg,0,1,v.renderTransform,v,0,-1)).dep=1),"scale"===u)this._pt=new gf(this._pt,v,"scaleY",v.scaleY,(m?xp(v.scaleY,m+a):a)-v.scaleY||0,Xf),this._pt.u=0,b.push("scaleY",u),u+="X";else{if("transformOrigin"===u){x.push(og,0,w[og]),o=Pg(o),v.svg?Fg(e,o,0,_,0,this):((p=parseFloat(o.split(" ")[2])||0)!==v.zOrigin&&bg(this,v,"zOrigin",v.zOrigin,p),bg(this,w,u,Bg(r),Bg(o)));continue}if("svgOrigin"===u){Fg(e,o,1,_,0,this);continue}if(u in Dg){Kg(this,v,u,l,m?xp(l,m+o):o);continue}if("smoothOrigin"===u){bg(this,v,"smooth",v.smooth,o);continue}if("force3D"===u){v[u]=o;continue}if("transform"===u){qg(this,o,e);continue}}else u in w||(u=mg(u)||u);if(f||(a||0===a)&&(l||0===l)&&!Wf.test(o)&&u in w)a||(a=0),(d=(r+"").substr((l+"").length))!==(p=im(o)||(u in Td.units?Td.units[u]:d))&&(l=Ag(e,u,r,p)),this._pt=new gf(this._pt,f?v:w,u,l,(m?xp(l,m+a):a)-l,f||"px"!==p&&"zIndex"!==u||!1===t.autoRound?Xf:Zf),this._pt.u=p||0,d!==p&&"%"!==p&&(this._pt.b=r,this._pt.r=Yf);else if(u in w)Sg.call(this,e,u,r,m?m+o:o);else if(u in e)this.add(e,u,r||e[u],m?m+o:o,n,s);else if("parseTransform"!==u){Jd(u,o);continue}f||(u in w?x.push(u,0,w[u]):"function"==typeof e[u]?x.push(u,2,e[u]()):x.push(u,1,r||e[u])),b.push(u)}y&&ff(this)},render:function(e,t){if(t.tween._time||!Ff())for(var i=t._pt;i;)i.r(e,i.d),i=i._next;else t.styles.revert()},get:Mg,aliases:Kf,getSetter:function(e,t,i){var n=Kf[t];return n&&n.indexOf(",")<0&&(t=n),t in Bf&&t!==og&&(e._gsap.x||Mg(e,"x"))?i&&If===i?"scale"===t?ig:tg:(If=i||{})&&("scale"===t?ng:sg):e.style&&!Fd(e.style[t])?Jf:~t.indexOf("-")?eg:af(e,t)},core:{_removeProperty:xg,_getMatrix:Ig}};Cf.utils.checkPrefix=mg,Cf.core.getStyleSaver=hg,function(e,t){var i=vp(e+","+t+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",(function(e){Bf[e]=1}));vp(t,(function(e){Td.units[e]="deg",Dg[e]=1})),Kf[i[13]]=e+","+t,vp("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",(function(e){var t=e.split(":");Kf[t[1]]=i[t[0]]}))}("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY"),vp("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",(function(e){Td.units[e]="px"})),Cf.registerPlugin(Yg);var Zg=Cf.registerPlugin(Yg)||Cf;Zg.core.Tween;const $g={linear:"none",easeInQuad:"power2.in",easeOutQuad:"power2.out"};class Qg{constructor(e,t,i={}){this.target=e,this.toVars=t,this.config=i}tween=null;start(){return new Promise((e=>{this.tween&&this.tween.kill();const{duration:t=.5,easing:i=$g.linear,delay:n=0,repeat:s=0,yoyo:r=!1,onStart:o,onUpdate:a,onComplete:l,onPause:c,onResume:h}=this.config;this.tween=Zg.to(this.target.scale,{...this.toVars,duration:t,ease:i,delay:n,repeat:s,yoyo:r,onStart:()=>{o?.()},onUpdate:()=>{this.target.updateMatrixWorld(!0);const e=this.tween?.progress()||0;a?.(e,this.target)},onComplete:()=>{l?.(),e()},onPause:()=>{c?.()},onResume:()=>{h?.()}})}))}stop(){this.tween&&(this.tween.kill(),this.tween=null)}isRunning(){return!!this.tween&&this.tween.isActive()}pause(){this.tween&&this.tween.pause()}resume(){this.tween&&this.tween.resume()}progress(e){return this.tween?void 0!==e?(this.tween.progress(e),e):this.tween.progress():0}}function Jg(e,t,i,n={}){return function(e,t,i,n={}){return e.scale.copy(t),new Qg(e,{x:i.x,y:i.y,z:i.z},n)}(e,new ie(1,t,1),new ie(1,i,1),n)}class ev{animations=new Map;timeline=null;constructor(){this.timeline=Zg.timeline()}async startAnimation(e,t,i=!0){i&&this.animations.has(e)&&this.stopAnimation(e),this.animations.set(e,t);try{await t.start()}finally{this.animations.delete(e)}}stopAnimation(e){const t=this.animations.get(e);t&&(t.stop(),this.animations.delete(e))}pauseAnimation(e){const t=this.animations.get(e);t&&t.pause()}resumeAnimation(e){const t=this.animations.get(e);t&&t.resume()}setAnimationProgress(e,t){const i=this.animations.get(e);i&&i.progress(t)}stopAllAnimations(){this.animations.forEach((e=>e.stop())),this.animations.clear()}pauseAllAnimations(){this.animations.forEach((e=>e.pause()))}resumeAllAnimations(){this.animations.forEach((e=>e.resume()))}isAnimationRunning(e){const t=this.animations.get(e);return!!t&&t.isRunning()}getRunningAnimationsCount(){return Array.from(this.animations.values()).filter((e=>e.isRunning())).length}getAnimationKeys(){return Array.from(this.animations.keys())}cleanup(){this.stopAllAnimations(),this.timeline&&(this.timeline.kill(),this.timeline=null)}}new ev;const tv={easing:$g.easeOutQuad,duration:.3},iv={easing:$g.easeInQuad,duration:.2},nv=["object"],sv=e({__name:"Tileset",props:{url:{}},setup(e,{expose:t}){const i=e,{camera:n,renderer:s}=ln();let o=B(new Yc(i.url));o.fetchOptions.mode="cors",o.lruCache.minSize=900,o.lruCache.maxSize=1300,o.errorTarget=12,o.registerPlugin(new ed),o.getPluginByName("DEBUG_TILES_PLUGIN").displayBoxBounds=!0;const h=new ev;function d(e){return`tile_${e.uuid}`}a(n,(()=>{n.value&&(o.setCamera(n.value),o.setResolutionFromRenderer(n.value,s.value))}),{immediate:!0}),o.addEventListener("load-model",(({scene:e})=>{e.traverse((e=>{if(e.material){const t=e;Array.isArray(t.material)?t.material.forEach((e=>{e.side=re})):t.material.side=re}}))})),((e,t)=>{e.addEventListener("tile-visibility-change",(({tile:e,visible:i})=>{const n=e.cached.scene;i&&t(n,e)}))})(o,(async(e,t)=>{if(e){const t=e.children[0],i=d(t),n=Jg(t,0,1,{...tv,duration:.2});await h.startAnimation(i,n,!0)}})),((e,t)=>{e.addEventListener("tile-visibility-change",(({tile:i,visible:n})=>{const s=i.cached.scene,r=e.group;n||(s&&(r.add(s),s.updateMatrixWorld(!0)),t(s,i).then((()=>{s&&r.remove(s)})))}))})(o,(async(e,t)=>{if(e){const t=e.children[0],i=d(t),n=Jg(t,1,0,{...iv,duration:.2});await h.startAnimation(i,n,!0)}}));const{onBeforeLoop:p}=xn();return p((()=>{o.update()})),l((()=>{console.log("清理动画管理器"),h.cleanup()})),t({animationManager:h,pauseAllAnimations:()=>h.pauseAllAnimations(),resumeAllAnimations:()=>h.resumeAllAnimations(),stopAllAnimations:()=>h.stopAllAnimations(),getRunningAnimationsCount:()=>h.getRunningAnimationsCount(),getAnimationKeys:()=>h.getAnimationKeys()}),(e,t)=>u(o)?(c(),r("primitive",{key:0,object:u(o)?.group},null,8,nv)):C("",!0)}}),rv=parseInt(J.replace(/\D+/g,""));function ov(e,t){if(t===Wt)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===Kt||t===Xt){let i=e.getIndex();if(null===i){const t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),i=e.getIndex()}const n=i.count-2,s=[];if(i)if(t===Kt)for(let e=1;e<=n;e++)s.push(i.getX(0)),s.push(i.getX(e)),s.push(i.getX(e+1));else for(let e=0;e<n;e++)e%2==0?(s.push(i.getX(e)),s.push(i.getX(e+1)),s.push(i.getX(e+2))):(s.push(i.getX(e+2)),s.push(i.getX(e+1)),s.push(i.getX(e)));s.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=e.clone();return r.setIndex(s),r.clearGroups(),r}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}function av(e){if(typeof TextDecoder<"u")return(new TextDecoder).decode(e);let t="";for(let i=0,n=e.length;i<n;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}const lv="srgb",cv="srgb-linear";class hv extends nt{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new gv(e)})),this.register((function(e){return new vv(e)})),this.register((function(e){return new Sv(e)})),this.register((function(e){return new Ev(e)})),this.register((function(e){return new Pv(e)})),this.register((function(e){return new yv(e)})),this.register((function(e){return new xv(e)})),this.register((function(e){return new bv(e)})),this.register((function(e){return new wv(e)})),this.register((function(e){return new fv(e)})),this.register((function(e){return new Tv(e)})),this.register((function(e){return new _v(e)})),this.register((function(e){return new Mv(e)})),this.register((function(e){return new Av(e)})),this.register((function(e){return new pv(e)})),this.register((function(e){return new Cv(e)})),this.register((function(e){return new Rv(e)}))}load(e,t,i,n){const s=this;let r;if(""!==this.resourcePath)r=this.resourcePath;else if(""!==this.path){const t=st.extractUrlBase(e);r=st.resolveURL(t,this.path)}else r=st.extractUrlBase(e);this.manager.itemStart(e);const o=function(t){n?n(t):console.error(t),s.manager.itemError(e),s.manager.itemEnd(e)},a=new rt(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(i){try{s.parse(i,r,(function(i){t(i),s.manager.itemEnd(e)}),o)}catch(n){o(n)}}),i,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,n){let s;const r={},o={};if("string"==typeof e)s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(av(new Uint8Array(e.slice(0,4)))===Lv){try{r[dv.KHR_BINARY_GLTF]=new kv(e)}catch(l){return void(n&&n(l))}s=JSON.parse(r[dv.KHR_BINARY_GLTF].content)}else s=JSON.parse(av(new Uint8Array(e)));else s=e;if(void 0===s.asset||s.asset.version[0]<2)return void(n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const a=new o_(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});a.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const e=this.pluginCallbacks[c](a);e.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[e.name]=e,r[e.name]=!0}if(s.extensionsUsed)for(let c=0;c<s.extensionsUsed.length;++c){const e=s.extensionsUsed[c],t=s.extensionsRequired||[];switch(e){case dv.KHR_MATERIALS_UNLIT:r[e]=new mv;break;case dv.KHR_DRACO_MESH_COMPRESSION:r[e]=new Iv(s,this.dracoLoader);break;case dv.KHR_TEXTURE_TRANSFORM:r[e]=new Fv;break;case dv.KHR_MESH_QUANTIZATION:r[e]=new Uv;break;default:t.indexOf(e)>=0&&void 0===o[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}a.setExtensions(r),a.setPlugins(o),a.parse(i,n)}parseAsync(e,t){const i=this;return new Promise((function(n,s){i.parse(e,t,n,s)}))}}function uv(){let e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const dv={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class pv{constructor(e){this.parser=e,this.name=dv.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,n=t.length;i<n;i++){const n=t[i];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let n=t.cache.get(i);if(n)return n;const s=t.json,r=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let o;const a=new q(16777215);void 0!==r.color&&a.setRGB(r.color[0],r.color[1],r.color[2],cv);const l=void 0!==r.range?r.range:0;switch(r.type){case"directional":o=new yt(a),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new _t(a),o.distance=l;break;case"spot":o=new vt(a),o.distance=l,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,o.angle=r.spot.outerConeAngle,o.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return o.position.set(0,0,0),o.decay=2,e_(o,r),void 0!==r.intensity&&(o.intensity=r.intensity),o.name=t.createUniqueName(r.name||"light_"+e),n=Promise.resolve(o),t.cache.add(i,n),n}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,n=i.json.nodes[e],s=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===s?null:this._loadLight(s).then((function(e){return i._getNodeRef(t.cache,s,e)}))}}class mv{constructor(){this.name=dv.KHR_MATERIALS_UNLIT}getMaterialType(){return se}extendParams(e,t,i){const n=[];e.color=new q(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const t=s.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],cv),e.opacity=t[3]}void 0!==s.baseColorTexture&&n.push(i.assignTexture(e,"map",s.baseColorTexture,lv))}return Promise.all(n)}}class fv{constructor(e){this.parser=e,this.name=dv.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name].emissiveStrength;return void 0!==n&&(t.emissiveIntensity=n),Promise.resolve()}}class gv{constructor(e){this.parser=e,this.name=dv.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?gt:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];if(void 0!==r.clearcoatFactor&&(t.clearcoat=r.clearcoatFactor),void 0!==r.clearcoatTexture&&s.push(i.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),void 0!==r.clearcoatRoughnessFactor&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),void 0!==r.clearcoatRoughnessTexture&&s.push(i.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),void 0!==r.clearcoatNormalTexture&&(s.push(i.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),void 0!==r.clearcoatNormalTexture.scale)){const e=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new te(e,e)}return Promise.all(s)}}class vv{constructor(e){this.parser=e,this.name=dv.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?gt:null}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name];return t.dispersion=void 0!==n.dispersion?n.dispersion:0,Promise.resolve()}}class _v{constructor(e){this.parser=e,this.name=dv.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?gt:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return void 0!==r.iridescenceFactor&&(t.iridescence=r.iridescenceFactor),void 0!==r.iridescenceTexture&&s.push(i.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),void 0!==r.iridescenceIor&&(t.iridescenceIOR=r.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==r.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),void 0!==r.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),void 0!==r.iridescenceThicknessTexture&&s.push(i.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(s)}}class yv{constructor(e){this.parser=e,this.name=dv.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?gt:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new q(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=n.extensions[this.name];if(void 0!==r.sheenColorFactor){const e=r.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],cv)}return void 0!==r.sheenRoughnessFactor&&(t.sheenRoughness=r.sheenRoughnessFactor),void 0!==r.sheenColorTexture&&s.push(i.assignTexture(t,"sheenColorMap",r.sheenColorTexture,lv)),void 0!==r.sheenRoughnessTexture&&s.push(i.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(s)}}class xv{constructor(e){this.parser=e,this.name=dv.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?gt:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return void 0!==r.transmissionFactor&&(t.transmission=r.transmissionFactor),void 0!==r.transmissionTexture&&s.push(i.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(s)}}class bv{constructor(e){this.parser=e,this.name=dv.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?gt:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];t.thickness=void 0!==r.thicknessFactor?r.thicknessFactor:0,void 0!==r.thicknessTexture&&s.push(i.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||1/0;const o=r.attenuationColor||[1,1,1];return t.attenuationColor=(new q).setRGB(o[0],o[1],o[2],cv),Promise.all(s)}}class wv{constructor(e){this.parser=e,this.name=dv.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?gt:null}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name];return t.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class Tv{constructor(e){this.parser=e,this.name=dv.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?gt:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];t.specularIntensity=void 0!==r.specularFactor?r.specularFactor:1,void 0!==r.specularTexture&&s.push(i.assignTexture(t,"specularIntensityMap",r.specularTexture));const o=r.specularColorFactor||[1,1,1];return t.specularColor=(new q).setRGB(o[0],o[1],o[2],cv),void 0!==r.specularColorTexture&&s.push(i.assignTexture(t,"specularColorMap",r.specularColorTexture,lv)),Promise.all(s)}}class Av{constructor(e){this.parser=e,this.name=dv.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?gt:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return t.bumpScale=void 0!==r.bumpFactor?r.bumpFactor:1,void 0!==r.bumpTexture&&s.push(i.assignTexture(t,"bumpMap",r.bumpTexture)),Promise.all(s)}}class Mv{constructor(e){this.parser=e,this.name=dv.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?gt:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return void 0!==r.anisotropyStrength&&(t.anisotropy=r.anisotropyStrength),void 0!==r.anisotropyRotation&&(t.anisotropyRotation=r.anisotropyRotation),void 0!==r.anisotropyTexture&&s.push(i.assignTexture(t,"anisotropyMap",r.anisotropyTexture)),Promise.all(s)}}class Sv{constructor(e){this.parser=e,this.name=dv.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,n=i.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const s=n.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,r)}}class Ev{constructor(e){this.parser=e,this.name=dv.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,s=n.textures[e];if(!s.extensions||!s.extensions[t])return null;const r=s.extensions[t],o=n.images[r.source];let a=i.textureLoader;if(o.uri){const e=i.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then((function(s){if(s)return i.loadTextureImage(e,r.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class Pv{constructor(e){this.parser=e,this.name=dv.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,s=n.textures[e];if(!s.extensions||!s.extensions[t])return null;const r=s.extensions[t],o=n.images[r.source];let a=i.textureLoader;if(o.uri){const e=i.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then((function(s){if(s)return i.loadTextureImage(e,r.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class Cv{constructor(e){this.name=dv.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const e=i.extensions[this.name],n=this.parser.getDependency("buffer",e.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return n.then((function(t){const i=e.byteOffset||0,n=e.byteLength||0,r=e.count,o=e.byteStride,a=new Uint8Array(t,i,n);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(r,o,a,e.mode,e.filter).then((function(e){return e.buffer})):s.ready.then((function(){const t=new ArrayBuffer(r*o);return s.decodeGltfBuffer(new Uint8Array(t),r,o,a,e.mode,e.filter),t}))}))}return null}}class Rv{constructor(e){this.name=dv.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||void 0===i.mesh)return null;const n=t.meshes[i.mesh];for(const a of n.primitives)if(a.mode!==jv.TRIANGLES&&a.mode!==jv.TRIANGLE_STRIP&&a.mode!==jv.TRIANGLE_FAN&&void 0!==a.mode)return null;const s=i.extensions[this.name].attributes,r=[],o={};for(const a in s)r.push(this.parser.getDependency("accessor",s[a]).then((e=>(o[a]=e,o[a]))));return r.length<1?null:(r.push(this.parser.createNodeMesh(e)),Promise.all(r).then((e=>{const t=e.pop(),i=t.isGroup?t.children:[t],n=e[0].count,s=[];for(const r of i){const e=new Ne,t=new ie,i=new Ve,a=new ie(1,1,1),l=new at(r.geometry,r.material,n);for(let s=0;s<n;s++)o.TRANSLATION&&t.fromBufferAttribute(o.TRANSLATION,s),o.ROTATION&&i.fromBufferAttribute(o.ROTATION,s),o.SCALE&&a.fromBufferAttribute(o.SCALE,s),l.setMatrixAt(s,e.compose(t,i,a));for(const n in o)if("_COLOR_0"===n){const e=o[n];l.instanceColor=new xt(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==n&&"ROTATION"!==n&&"SCALE"!==n&&r.geometry.setAttribute(n,o[n]);Z.prototype.copy.call(l,r),this.parser.assignFinalMaterial(l),s.push(l)}return t.isGroup?(t.clear(),t.add(...s),t):s[0]})))}}const Lv="glTF",Dv=1313821514,Ov=5130562;class kv{constructor(e){this.name=dv.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:av(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Lv)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-12,n=new DataView(e,12);let s=0;for(;s<i;){const t=n.getUint32(s,!0);s+=4;const i=n.getUint32(s,!0);if(s+=4,i===Dv){const i=new Uint8Array(e,12+s,t);this.content=av(i)}else if(i===Ov){const i=12+s;this.body=e.slice(i,i+t)}s+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Iv{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=dv.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,n=this.dracoLoader,s=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,o={},a={},l={};for(const c in r){const e=Kv[c]||c.toLowerCase();o[e]=r[c]}for(const c in e.attributes){const t=Kv[c]||c.toLowerCase();if(void 0!==r[c]){const n=i.accessors[e.attributes[c]],s=Hv[n.componentType];l[t]=s.name,a[t]=!0===n.normalized}}return t.getDependency("bufferView",s).then((function(e){return new Promise((function(t,i){n.decodeDracoFile(e,(function(e){for(const t in e.attributes){const i=e.attributes[t],n=a[t];void 0!==n&&(i.normalized=n)}t(e)}),o,l,cv,i)}))}))}}class Fv{constructor(){this.name=dv.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(void 0===t.texCoord||t.texCoord===e.channel)&&void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Uv{constructor(){this.name=dv.KHR_MESH_QUANTIZATION}}class Bv extends qt{constructor(e,t,i,n){super(e,t,i,n)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,s=e*n*3+n;for(let r=0;r!==n;r++)t[r]=i[s+r];return t}interpolate_(e,t,i,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,c=n-t,h=(i-t)/c,u=h*h,d=u*h,p=e*l,m=p-l,f=-2*d+3*u,g=d-u,v=1-f,_=g-u+h;for(let y=0;y!==o;y++){const e=r[m+y+o],t=r[m+y+a]*c,i=r[p+y+o],n=r[p+y]*c;s[y]=v*e+_*t+f*i+g*n}return s}}const zv=new Ve;class Nv extends Bv{interpolate_(e,t,i,n){const s=super.interpolate_(e,t,i,n);return zv.fromArray(s).normalize().toArray(s),s}}const jv={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Hv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Gv={9728:ye,9729:pe,9984:St,9985:Mt,9986:At,9987:Tt},Vv={33071:Ct,33648:Pt,10497:Et},Wv={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Kv={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...rv>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Xv={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},qv={CUBICSPLINE:void 0,LINEAR:Bt,STEP:Ut},Yv="OPAQUE",Zv="MASK",$v="BLEND";function Qv(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new $e({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ve})),e.DefaultMaterial}function Jv(e,t,i){for(const n in i.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=i.extensions[n])}function e_(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function t_(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let i=0,n=t.weights.length;i<n;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){const i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(let t=0,n=i.length;t<n;t++)e.morphTargetDictionary[i[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function i_(e){let t;const i=e.extensions&&e.extensions[dv.KHR_DRACO_MESH_COMPRESSION];if(t=i?"draco:"+i.bufferView+":"+i.indices+":"+n_(i.attributes):e.indices+":"+n_(e.attributes)+":"+e.mode,void 0!==e.targets)for(let n=0,s=e.targets.length;n<s;n++)t+=":"+n_(e.targets[n]);return t}function n_(e){let t="";const i=Object.keys(e).sort();for(let n=0,s=i.length;n<s;n++)t+=i[n]+":"+e[i[n]]+";";return t}function s_(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const r_=new Ne;class o_{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new uv,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,n=!1,s=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(i=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=navigator.userAgent.indexOf("Firefox")>-1,s=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||n&&s<98?this.textureLoader=new Oe(this.options.manager):this.textureLoader=new bt(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new rt(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,n=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])})).then((function(t){const r={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:i,userData:{}};return Jv(s,r,n),e_(r,n),Promise.all(i._invokeAll((function(e){return e.afterRoot&&e.afterRoot(r)}))).then((function(){for(const e of r.scenes)e.updateMatrixWorld();e(r)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let n=0,s=t.length;n<s;n++){const i=t[n].joints;for(let t=0,n=i.length;t<n;t++)e[i[t]].isBone=!0}for(let n=0,s=e.length;n<s;n++){const t=e[n];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(i[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const n=i.clone(),s=(e,t)=>{const i=this.associations.get(e);null!=i&&this.associations.set(t,i);for(const[n,r]of e.children.entries())s(r,t.children[n])};return s(i,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const n=e(t[i]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let n=0;n<t.length;n++){const s=e(t[n]);s&&i.push(s)}return i}getDependency(e,t){const i=e+":"+t;let n=this.cache.get(i);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":n=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":n=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne((function(i){return i!=this&&i.getDependency&&i.getDependency(e,t)})),!n)throw new Error("Unknown type: "+e)}this.cache.add(i,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map((function(t,n){return i.getDependency(e,n)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[dv.KHR_BINARY_GLTF].body);const n=this.options;return new Promise((function(e,s){i.load(st.resolveURL(t.uri,n.path),e,void 0,(function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const i=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+i)}))}loadAccessor(e){const t=this,i=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse){const e=Wv[n.type],t=Hv[n.componentType],i=!0===n.normalized,s=new t(n.count*e);return Promise.resolve(new $(s,e,i))}const s=[];return void 0!==n.bufferView?s.push(this.getDependency("bufferView",n.bufferView)):s.push(null),void 0!==n.sparse&&(s.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(s).then((function(e){const s=e[0],r=Wv[n.type],o=Hv[n.componentType],a=o.BYTES_PER_ELEMENT,l=a*r,c=n.byteOffset||0,h=void 0!==n.bufferView?i.bufferViews[n.bufferView].byteStride:void 0,u=!0===n.normalized;let d,p;if(h&&h!==l){const e=Math.floor(c/h),i="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+e+":"+n.count;let l=t.cache.get(i);l||(d=new o(s,e*h,n.count*h/a),l=new wt(d,h/a),t.cache.add(i,l)),p=new Nt(l,r,c%h/a,u)}else d=null===s?new o(n.count*r):new o(s,c,n.count*r),p=new $(d,r,u);if(void 0!==n.sparse){const t=Wv.SCALAR,i=Hv[n.sparse.indices.componentType],a=n.sparse.indices.byteOffset||0,l=n.sparse.values.byteOffset||0,c=new i(e[1],a,n.sparse.count*t),h=new o(e[2],l,n.sparse.count*r);null!==s&&(p=new $(p.array.slice(),p.itemSize,p.normalized));for(let e=0,n=c.length;e<n;e++){const t=c[e];if(p.setX(t,h[e*r]),r>=2&&p.setY(t,h[e*r+1]),r>=3&&p.setZ(t,h[e*r+2]),r>=4&&p.setW(t,h[e*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p}))}loadTexture(e){const t=this.json,i=this.options,n=t.textures[e].source,s=t.images[n];let r=this.textureLoader;if(s.uri){const e=i.manager.getHandler(s.uri);null!==e&&(r=e)}return this.loadTextureImage(e,n,r)}loadTextureImage(e,t,i){const n=this,s=this.json,r=s.textures[e],o=s.images[t],a=(o.uri||o.bufferView)+":"+r.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(t,i).then((function(t){t.flipY=!1,t.name=r.name||o.name||"",""===t.name&&"string"==typeof o.uri&&!1===o.uri.startsWith("data:image/")&&(t.name=o.uri);const i=(s.samplers||{})[r.sampler]||{};return t.magFilter=Gv[i.magFilter]||pe,t.minFilter=Gv[i.minFilter]||Tt,t.wrapS=Vv[i.wrapS]||Et,t.wrapT=Vv[i.wrapT]||Et,n.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[a]=l,l}loadImageSource(e,t){const i=this.json,n=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const s=i.images[e],r=self.URL||self.webkitURL;let o=s.uri||"",a=!1;if(void 0!==s.bufferView)o=this.getDependency("bufferView",s.bufferView).then((function(e){a=!0;const t=new Blob([e],{type:s.mimeType});return o=r.createObjectURL(t),o}));else if(void 0===s.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const l=Promise.resolve(o).then((function(e){return new Promise((function(i,s){let r=i;!0===t.isImageBitmapLoader&&(r=function(e){const t=new Ae(e);t.needsUpdate=!0,i(t)}),t.load(st.resolveURL(e,n.path),r,void 0,s)}))})).then((function(e){return!0===a&&r.revokeObjectURL(o),e_(e,s),e.userData.mimeType=s.mimeType||function(e){return e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/)?"image/jpeg":e.search(/\.webp($|\?)/i)>0||0===e.search(/^data\:image\/webp/)?"image/webp":"image/png"}(s.uri),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),e}));return this.sourceCache[e]=l,l}assignTexture(e,t,i,n){const s=this;return this.getDependency("texture",i.index).then((function(r){if(!r)return null;if(void 0!==i.texCoord&&i.texCoord>0&&((r=r.clone()).channel=i.texCoord),s.extensions[dv.KHR_TEXTURE_TRANSFORM]){const e=void 0!==i.extensions?i.extensions[dv.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=s.associations.get(r);r=s.extensions[dv.KHR_TEXTURE_TRANSFORM].extendTexture(r,e),s.associations.set(r,t)}}return void 0!==n&&("number"==typeof n&&(n=3001===n?lv:cv),"colorSpace"in r?r.colorSpace=n:r.encoding=n===lv?3001:3e3),e[t]=r,r}))}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const n=void 0===t.attributes.tangent,s=void 0!==t.attributes.color,r=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+i.uuid;let t=this.cache.get(e);t||(t=new je,Te.prototype.copy.call(t,i),t.color.copy(i.color),t.map=i.map,t.sizeAttenuation=!1,this.cache.add(e,t)),i=t}else if(e.isLine){const e="LineBasicMaterial:"+i.uuid;let t=this.cache.get(e);t||(t=new ct,Te.prototype.copy.call(t,i),t.color.copy(i.color),t.map=i.map,this.cache.add(e,t)),i=t}if(n||s||r){let e="ClonedMaterial:"+i.uuid+":";n&&(e+="derivative-tangents:"),s&&(e+="vertex-colors:"),r&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=i.clone(),s&&(t.vertexColors=!0),r&&(t.flatShading=!0),n&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(i))),i=t}e.material=i}getMaterialType(){return $e}loadMaterial(e){const t=this,i=this.json,n=this.extensions,s=i.materials[e];let r;const o={},a=[];if((s.extensions||{})[dv.KHR_MATERIALS_UNLIT]){const e=n[dv.KHR_MATERIALS_UNLIT];r=e.getMaterialType(),a.push(e.extendParams(o,s,t))}else{const i=s.pbrMetallicRoughness||{};if(o.color=new q(1,1,1),o.opacity=1,Array.isArray(i.baseColorFactor)){const e=i.baseColorFactor;o.color.setRGB(e[0],e[1],e[2],cv),o.opacity=e[3]}void 0!==i.baseColorTexture&&a.push(t.assignTexture(o,"map",i.baseColorTexture,lv)),o.metalness=void 0!==i.metallicFactor?i.metallicFactor:1,o.roughness=void 0!==i.roughnessFactor?i.roughnessFactor:1,void 0!==i.metallicRoughnessTexture&&(a.push(t.assignTexture(o,"metalnessMap",i.metallicRoughnessTexture)),a.push(t.assignTexture(o,"roughnessMap",i.metallicRoughnessTexture))),r=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),a.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,o)}))))}!0===s.doubleSided&&(o.side=re);const l=s.alphaMode||Yv;if(l===$v?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,l===Zv&&(o.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&r!==se&&(a.push(t.assignTexture(o,"normalMap",s.normalTexture)),o.normalScale=new te(1,1),void 0!==s.normalTexture.scale)){const e=s.normalTexture.scale;o.normalScale.set(e,e)}if(void 0!==s.occlusionTexture&&r!==se&&(a.push(t.assignTexture(o,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(o.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&r!==se){const e=s.emissiveFactor;o.emissive=(new q).setRGB(e[0],e[1],e[2],cv)}return void 0!==s.emissiveTexture&&r!==se&&a.push(t.assignTexture(o,"emissiveMap",s.emissiveTexture,lv)),Promise.all(a).then((function(){const i=new r(o);return s.name&&(i.name=s.name),e_(i,s),t.associations.set(i,{materials:e}),s.extensions&&Jv(n,i,s),i}))}createUniqueName(e){const t=Rt.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,n=this.primitiveCache;function s(e){return i[dv.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(i){return a_(i,e,t)}))}const r=[];for(let o=0,a=e.length;o<a;o++){const i=e[o],a=i_(i),l=n[a];if(l)r.push(l.promise);else{let e;e=i.extensions&&i.extensions[dv.KHR_DRACO_MESH_COMPRESSION]?s(i):a_(new Me,i,t),n[a]={primitive:i,promise:e},r.push(e)}}return Promise.all(r)}loadMesh(e){const t=this,i=this.json,n=this.extensions,s=i.meshes[e],r=s.primitives,o=[];for(let a=0,l=r.length;a<l;a++){const e=void 0===r[a].material?Qv(this.cache):this.getDependency("material",r[a].material);o.push(e)}return o.push(t.loadGeometries(r)),Promise.all(o).then((function(i){const o=i.slice(0,i.length-1),a=i[i.length-1],l=[];for(let h=0,u=a.length;h<u;h++){const i=a[h],c=r[h];let u;const d=o[h];if(c.mode===jv.TRIANGLES||c.mode===jv.TRIANGLE_STRIP||c.mode===jv.TRIANGLE_FAN||void 0===c.mode)u=!0===s.isSkinnedMesh?new Lt(i,d):new oe(i,d),!0===u.isSkinnedMesh&&u.normalizeSkinWeights(),c.mode===jv.TRIANGLE_STRIP?u.geometry=ov(u.geometry,Xt):c.mode===jv.TRIANGLE_FAN&&(u.geometry=ov(u.geometry,Kt));else if(c.mode===jv.LINES)u=new lt(i,d);else if(c.mode===jv.LINE_STRIP)u=new Dt(i,d);else if(c.mode===jv.LINE_LOOP)u=new Ot(i,d);else{if(c.mode!==jv.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);u=new He(i,d)}Object.keys(u.geometry.morphAttributes).length>0&&t_(u,s),u.name=t.createUniqueName(s.name||"mesh_"+e),e_(u,s),c.extensions&&Jv(n,u,c),t.assignFinalMaterial(u),l.push(u)}for(let n=0,s=l.length;n<s;n++)t.associations.set(l[n],{meshes:e,primitives:n});if(1===l.length)return s.extensions&&Jv(n,l[0],s),l[0];const c=new Ie;s.extensions&&Jv(n,c,s),t.associations.set(c,{meshes:e});for(let e=0,t=l.length;e<t;e++)c.add(l[e]);return c}))}loadCamera(e){let t;const i=this.json.cameras[e],n=i[i.type];if(n)return"perspective"===i.type?t=new j(Y.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===i.type&&(t=new Le(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),e_(t,i),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],i=[];for(let n=0,s=t.joints.length;n<s;n++)i.push(this._loadNodeShallow(t.joints[n]));return void 0!==t.inverseBindMatrices?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then((function(e){const i=e.pop(),n=e,s=[],r=[];for(let o=0,a=n.length;o<a;o++){const e=n[o];if(e){s.push(e);const t=new Ne;null!==i&&t.fromArray(i.array,16*o),r.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}return new kt(s,r)}))}loadAnimation(e){const t=this.json,i=this,n=t.animations[e],s=n.name?n.name:"animation_"+e,r=[],o=[],a=[],l=[],c=[];for(let h=0,u=n.channels.length;h<u;h++){const e=n.channels[h],t=n.samplers[e.sampler],i=e.target,s=i.node,u=void 0!==n.parameters?n.parameters[t.input]:t.input,d=void 0!==n.parameters?n.parameters[t.output]:t.output;void 0!==i.node&&(r.push(this.getDependency("node",s)),o.push(this.getDependency("accessor",u)),a.push(this.getDependency("accessor",d)),l.push(t),c.push(i))}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c)]).then((function(e){const t=e[0],n=e[1],r=e[2],o=e[3],a=e[4],l=[];for(let s=0,c=t.length;s<c;s++){const e=t[s],c=n[s],h=r[s],u=o[s],d=a[s];if(void 0===e)continue;e.updateMatrix&&e.updateMatrix();const p=i._createAnimationTracks(e,c,h,u,d);if(p)for(let t=0;t<p.length;t++)l.push(p[t])}return new It(s,void 0,l)}))}createNodeMesh(e){const t=this.json,i=this,n=t.nodes[e];return void 0===n.mesh?null:i.getDependency("mesh",n.mesh).then((function(e){const t=i._getNodeRef(i.meshCache,n.mesh,e);return void 0!==n.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,i=n.weights.length;t<i;t++)e.morphTargetInfluences[t]=n.weights[t]})),t}))}loadNode(e){const t=this,i=this.json.nodes[e],n=t._loadNodeShallow(e),s=[],r=i.children||[];for(let a=0,l=r.length;a<l;a++)s.push(t.getDependency("node",r[a]));const o=void 0===i.skin?Promise.resolve(null):t.getDependency("skin",i.skin);return Promise.all([n,Promise.all(s),o]).then((function(e){const t=e[0],i=e[1],n=e[2];null!==n&&t.traverse((function(e){e.isSkinnedMesh&&e.bind(n,r_)}));for(let s=0,r=i.length;s<r;s++)t.add(i[s]);return t}))}_loadNodeShallow(e){const t=this.json,i=this.extensions,n=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const s=t.nodes[e],r=s.name?n.createUniqueName(s.name):"",o=[],a=n._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return a&&o.push(a),void 0!==s.camera&&o.push(n.getDependency("camera",s.camera).then((function(e){return n._getNodeRef(n.cameraCache,s.camera,e)}))),n._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){o.push(e)})),this.nodeCache[e]=Promise.all(o).then((function(t){let o;if(o=!0===s.isBone?new Ft:t.length>1?new Ie:1===t.length?t[0]:new Z,o!==t[0])for(let e=0,i=t.length;e<i;e++)o.add(t[e]);if(s.name&&(o.userData.name=s.name,o.name=r),e_(o,s),s.extensions&&Jv(i,o,s),void 0!==s.matrix){const e=new Ne;e.fromArray(s.matrix),o.applyMatrix4(e)}else void 0!==s.translation&&o.position.fromArray(s.translation),void 0!==s.rotation&&o.quaternion.fromArray(s.rotation),void 0!==s.scale&&o.scale.fromArray(s.scale);return n.associations.has(o)||n.associations.set(o,{}),n.associations.get(o).nodes=e,o})),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],n=this,s=new Ie;i.name&&(s.name=n.createUniqueName(i.name)),e_(s,i),i.extensions&&Jv(t,s,i);const r=i.nodes||[],o=[];for(let a=0,l=r.length;a<l;a++)o.push(n.getDependency("node",r[a]));return Promise.all(o).then((function(e){for(let t=0,i=e.length;t<i;t++)s.add(e[t]);return n.associations=(e=>{const t=new Map;for(const[i,s]of n.associations)(i instanceof Te||i instanceof Ae)&&t.set(i,s);return e.traverse((e=>{const i=n.associations.get(e);null!=i&&t.set(e,i)})),t})(s),s}))}_createAnimationTracks(e,t,i,n,s){const r=[],o=e.name?e.name:e.uuid,a=[];let l;switch(Xv[s.path]===Xv.weights?e.traverse((function(e){e.morphTargetInfluences&&a.push(e.name?e.name:e.uuid)})):a.push(o),Xv[s.path]){case Xv.weights:l=Ht;break;case Xv.rotation:l=Gt;break;case Xv.position:case Xv.scale:l=jt;break;default:if(1===i.itemSize)l=Ht;else l=jt}const c=void 0!==n.interpolation?qv[n.interpolation]:Bt,h=this._getArrayFromAccessor(i);for(let u=0,d=a.length;u<d;u++){const e=new l(a[u]+"."+Xv[s.path],t.array,h,c);"CUBICSPLINE"===n.interpolation&&this._createCubicSplineTrackInterpolant(e),r.push(e)}return r}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=s_(t.constructor),i=new Float32Array(t.length);for(let n=0,s=t.length;n<s;n++)i[n]=t[n]*e;t=i}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof Gt?Nv:Bv)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function a_(e,t,i){const n=t.attributes,s=[];function r(t,n){return i.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(const o in n){const t=Kv[o]||o.toLowerCase();t in e.attributes||s.push(r(n[o],t))}if(void 0!==t.indices&&!e.index){const n=i.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));s.push(n)}return e_(e,t),function(e,t,i){const n=t.attributes,s=new ft;if(void 0===n.POSITION)return;{const e=i.json.accessors[n.POSITION],t=e.min,r=e.max;if(void 0===t||void 0===r)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(s.set(new ie(t[0],t[1],t[2]),new ie(r[0],r[1],r[2])),e.normalized){const t=s_(Hv[e.componentType]);s.min.multiplyScalar(t),s.max.multiplyScalar(t)}}const r=t.targets;if(void 0!==r){const e=new ie,t=new ie;for(let n=0,s=r.length;n<s;n++){const s=r[n];if(void 0!==s.POSITION){const n=i.json.accessors[s.POSITION],r=n.min,o=n.max;if(void 0!==r&&void 0!==o){if(t.setX(Math.max(Math.abs(r[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(r[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(r[2]),Math.abs(o[2]))),n.normalized){const e=s_(Hv[n.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(e)}e.boundingBox=s;const o=new Ye;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,e.boundingSphere=o}(e,t,i),Promise.all(s).then((function(){return void 0!==t.targets?function(e,t,i){let n=!1,s=!1,r=!1;for(let c=0,h=t.length;c<h;c++){const e=t[c];if(void 0!==e.POSITION&&(n=!0),void 0!==e.NORMAL&&(s=!0),void 0!==e.COLOR_0&&(r=!0),n&&s&&r)break}if(!n&&!s&&!r)return Promise.resolve(e);const o=[],a=[],l=[];for(let c=0,h=t.length;c<h;c++){const h=t[c];if(n){const t=void 0!==h.POSITION?i.getDependency("accessor",h.POSITION):e.attributes.position;o.push(t)}if(s){const t=void 0!==h.NORMAL?i.getDependency("accessor",h.NORMAL):e.attributes.normal;a.push(t)}if(r){const t=void 0!==h.COLOR_0?i.getDependency("accessor",h.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then((function(t){const i=t[0],o=t[1],a=t[2];return n&&(e.morphAttributes.position=i),s&&(e.morphAttributes.normal=o),r&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,i):e}))}const l_=new WeakMap;class c_ extends nt{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,n){const s=new rt(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(e=>{const i={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,i).then(t).catch(n)}),i,n)}decodeDracoFile(e,t,i,n){const s={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!i};this.decodeGeometry(e,s).then(t)}decodeGeometry(e,t){for(const a in t.attributeTypes){const e=t.attributeTypes[a];void 0!==e.BYTES_PER_ELEMENT&&(t.attributeTypes[a]=e.name)}const i=JSON.stringify(t);if(l_.has(e)){const t=l_.get(e);if(t.key===i)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const s=this.workerNextTaskID++,r=e.byteLength,o=this._getWorker(s,r).then((i=>(n=i,new Promise(((i,r)=>{n._callbacks[s]={resolve:i,reject:r},n.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return o.catch((()=>!0)).then((()=>{n&&s&&this._releaseTask(n,s)})),l_.set(e,{key:i,promise:o}),o}_createGeometry(e){const t=new Me;e.index&&t.setIndex(new $(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const n=e.attributes[i],s=n.name,r=n.array,o=n.itemSize;t.setAttribute(s,new $(r,o))}return t}_loadLibrary(e,t){const i=new rt(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise(((t,n)=>{i.load(e,t,void 0,n)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{const i=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const n=h_.toString(),s=["/* draco decoder */",i,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([s]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const i=t.data;switch(i.type){case"decode":e._callbacks[i.id].resolve(i);break;case"error":e._callbacks[i.id].reject(i);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function h_(){let e,t;function i(e,t,i,n,s,r){const o=r.num_components(),a=i.num_points()*o,l=a*s.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,s),h=e._malloc(l);t.GetAttributeDataArrayForAllPoints(i,r,c,l,h);const u=new s(e.HEAPF32.buffer,h,a).slice();return e._free(h),{name:n,array:u,itemSize:o}}onmessage=function(n){const s=n.data;switch(s.type){case"init":e=s.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":const n=s.buffer,r=s.taskConfig;t.then((e=>{const t=e.draco,o=new t.Decoder,a=new t.DecoderBuffer;a.Init(new Int8Array(n),n.byteLength);try{const e=function(e,t,n,s){const r=s.attributeIDs,o=s.attributeTypes;let a,l;const c=t.GetEncodedGeometryType(n);if(c===e.TRIANGULAR_MESH)a=new e.Mesh,l=t.DecodeBufferToMesh(n,a);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new e.PointCloud,l=t.DecodeBufferToPointCloud(n,a)}if(!l.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const h={index:null,attributes:[]};for(const u in r){const n=self[o[u]];let l,c;if(s.useUniqueIDs)c=r[u],l=t.GetAttributeByUniqueId(a,c);else{if(c=t.GetAttributeId(a,e[r[u]]),-1===c)continue;l=t.GetAttribute(a,c)}h.attributes.push(i(e,t,a,u,n,l))}return c===e.TRIANGULAR_MESH&&(h.index=function(e,t,i){const n=3*i.num_faces(),s=4*n,r=e._malloc(s);t.GetTrianglesUInt32Array(i,s,r);const o=new Uint32Array(e.HEAPF32.buffer,r,n).slice();return e._free(r),{array:o,itemSize:1}}(e,t,a)),e.destroy(a),h}(t,o,a,r),n=e.attributes.map((e=>e.array.buffer));e.index&&n.push(e.index.array.buffer),self.postMessage({type:"decode",id:s.id,geometry:e},n)}catch(l){console.error(l),self.postMessage({type:"error",id:s.id,error:l.message})}finally{t.destroy(a),t.destroy(o)}}))}}}const u_=class extends nt{gltfLoader;constructor(e){super(e),this.gltfLoader=new hv(e)}load(e,t,i,n){const s=Array.isArray(e)?e[0]:e;this.gltfLoader.load(s,t,i,n)}async loadAsync(e){const t=Array.isArray(e)?e[0]:e;return this.gltfLoader.loadAsync(t)}setDRACOLoader(e){return this.gltfLoader.setDRACOLoader(e)}};async function d_(e,t={draco:!1},i){const{loaderExtension:n,dracoLoader:s}=function(e){let t=null;return{loaderExtension:i=>{e.draco&&(t||(t=new c_),t.setDecoderPath(e.decoderPath||"https://www.gstatic.com/draco/versioned/decoders/1.4.3/"),i.setDRACOLoader&&i.setDRACOLoader(t))},dracoLoader:()=>t}}(t),r=await async function(e,t,i,n){const{logError:s}=Ki(),r=new e;return i&&i(r),await new Promise(((e,i)=>{r.load(t,(t=>{const i=t;i.scene&&Object.assign(i,function(e){const t={nodes:{},materials:{}};return e&&e.traverse((e=>{e.name&&(t.nodes[e.name]=e),e.material&&!t.materials[e.material.name]&&(t.materials[e.material.name]=e.material)})),t}(i.scene)),e(i)}),n,(e=>{s("[useLoader] - Failed to load resource",e),i(e)}))}))}(u_,e,n),o=s();return o&&o.dispose(),r}const p_=["object"],m_=e({__name:"GeoGLTF",props:{url:{},draco:{type:Boolean,default:!1},decoderPath:{default:"./draco/"},renderOrder:{default:1}},setup(e){const t=e,i=s();return o((async()=>{const{scene:e}=await d_(t.url,{draco:t.draco,decoderPath:t.draco?t.decoderPath:void 0});i.value=e,i.value.userData.tiles=[],i.value.renderOrder=t.renderOrder})),(e,t)=>i.value?(c(),r("primitive",{key:0,object:i.value,scale:1,position:[0,0,0]},null,8,p_)):C("",!0)}}),f_=e({__name:"GeoCSS2DRenderer",setup(e){const{camera:t,renderer:i}=ln(),n=s(),r=()=>{n.value?.setSize(window.innerWidth,window.innerHeight)};return o((()=>{t.value&&t.value.layers.enableAll(),n.value=new Hs,n.value.setSize(window.innerWidth,window.innerHeight),n.value.domElement.style.position="fixed",n.value.domElement.style.top="0",n.value.domElement.style.left="0",n.value.domElement.style.pointerEvents="none",i.value.domElement?.parentElement?.appendChild(n.value.domElement);const{onAfterRender:e}=cn();e((({scene:e,camera:t})=>{n.value?.render(e,t)})),window.addEventListener("resize",r)})),M((()=>{window.removeEventListener("resize",r),i.value.domElement?.parentElement?.removeChild(n.value.domElement)})),()=>{}}}),g_=e({__name:"GeoCanvas",props:{canvasConfig:{default:()=>({windowSize:!0,alpha:!0,antialias:!0,shadows:!1,autoClear:!0,disableRender:!0,outputColorSpace:X,toneMapping:V,pixelRatio:1})},cameraConfig:{default:()=>({fov:29,aspect:window.innerWidth/window.innerHeight,near:1,far:1e4,position:[0,0,175e5],lookAt:[0,0,0]})}},setup(e){const t=e,{canvasConfig:i,cameraConfig:s}=t,r=n(null);return o((()=>{const e=r.value?.context?.renderer;e?.value&&(window.devicePixelRatio=i.pixelRatio,e.value.setPixelRatio(window.devicePixelRatio))})),(e,t)=>(c(),P(u(zn),U({clearColor:"#fff"},u(i),{ref_key:"canvasRef",ref:r}),{default:L((()=>[R("TresPerspectiveCamera",I(F(u(s))),null,16),D(f_),T(e.$slots,"default")])),_:3},16))}}),v_={type:"change"},__={type:"start"},y_={type:"end"},x_=new Ge,b_=new We,w_=Math.cos(70*Y.DEG2RAD),T_=new ie,A_=2*Math.PI,M_=-1,S_=0,E_=1,P_=2,C_=3,R_=4,L_=5,D_=6,O_=1e-6;class k_ extends ut{constructor(e,t=null){super(e,t),this.state=M_,this.enabled=!0,this.target=new ie,this.cursor=new ie,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Qe.ROTATE,MIDDLE:Qe.DOLLY,RIGHT:Qe.PAN},this.touches={ONE:Je.ROTATE,TWO:Je.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new ie,this._lastQuaternion=new Ve,this._lastTargetPosition=new ie,this._quat=(new Ve).setFromUnitVectors(e.up,new ie(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new tt,this._sphericalDelta=new tt,this._scale=1,this._panOffset=new ie,this._rotateStart=new te,this._rotateEnd=new te,this._rotateDelta=new te,this._panStart=new te,this._panEnd=new te,this._panDelta=new te,this._dollyStart=new te,this._dollyEnd=new te,this._dollyDelta=new te,this._dollyDirection=new ie,this._mouse=new te,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=F_.bind(this),this._onPointerDown=I_.bind(this),this._onPointerUp=U_.bind(this),this._onContextMenu=V_.bind(this),this._onMouseWheel=N_.bind(this),this._onKeyDown=j_.bind(this),this._onTouchStart=H_.bind(this),this._onTouchMove=G_.bind(this),this._onMouseDown=B_.bind(this),this._onMouseMove=z_.bind(this),this._interceptControlDown=W_.bind(this),this._interceptControlUp=K_.bind(this),null!==this.domElement&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){null!==this._domElementKeyEvents&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(v_),this.update(),this.state=M_}update(e=null){const t=this.object.position;T_.copy(t).sub(this.target),T_.applyQuaternion(this._quat),this._spherical.setFromVector3(T_),this.autoRotate&&this.state===M_&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let i=this.minAzimuthAngle,n=this.maxAzimuthAngle;isFinite(i)&&isFinite(n)&&(i<-Math.PI?i+=A_:i>Math.PI&&(i-=A_),n<-Math.PI?n+=A_:n>Math.PI&&(n-=A_),this._spherical.theta=i<=n?Math.max(i,Math.min(n,this._spherical.theta)):this._spherical.theta>(i+n)/2?Math.max(i,this._spherical.theta):Math.min(n,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),!0===this.enableDamping?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const e=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=e!=this._spherical.radius}if(T_.setFromSpherical(this._spherical),T_.applyQuaternion(this._quatInverse),t.copy(this.target).add(T_),this.object.lookAt(this.target),!0===this.enableDamping?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let e=null;if(this.object.isPerspectiveCamera){const t=T_.length();e=this._clampDistance(t*this._scale);const i=t-e;this.object.position.addScaledVector(this._dollyDirection,i),this.object.updateMatrixWorld(),s=!!i}else if(this.object.isOrthographicCamera){const t=new ie(this._mouse.x,this._mouse.y,0);t.unproject(this.object);const i=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=i!==this.object.zoom;const n=new ie(this._mouse.x,this._mouse.y,0);n.unproject(this.object),this.object.position.sub(n).add(t),this.object.updateMatrixWorld(),e=T_.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;null!==e&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(e).add(this.object.position):(x_.origin.copy(this.object.position),x_.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(x_.direction))<w_?this.object.lookAt(this.target):(b_.setFromNormalAndCoplanarPoint(this.object.up,this.target),x_.intersectPlane(b_,this.target))))}else if(this.object.isOrthographicCamera){const e=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),e!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,!!(s||this._lastPosition.distanceToSquared(this.object.position)>O_||8*(1-this._lastQuaternion.dot(this.object.quaternion))>O_||this._lastTargetPosition.distanceToSquared(this.target)>O_)&&(this.dispatchEvent(v_),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0)}_getAutoRotationAngle(e){return null!==e?A_/60*this.autoRotateSpeed*e:A_/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(.01*e);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){T_.setFromMatrixColumn(t,0),T_.multiplyScalar(-e),this._panOffset.add(T_)}_panUp(e,t){!0===this.screenSpacePanning?T_.setFromMatrixColumn(t,1):(T_.setFromMatrixColumn(t,0),T_.crossVectors(this.object.up,T_)),T_.multiplyScalar(e),this._panOffset.add(T_)}_pan(e,t){const i=this.domElement;if(this.object.isPerspectiveCamera){const n=this.object.position;T_.copy(n).sub(this.target);let s=T_.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*s/i.clientHeight,this.object.matrix),this._panUp(2*t*s/i.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const i=this.domElement.getBoundingClientRect(),n=e-i.left,s=t-i.top,r=i.width,o=i.height;this._mouse.x=n/r*2-1,this._mouse.y=-s/o*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(A_*this._rotateDelta.x/t.clientHeight),this._rotateUp(A_*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(A_*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-A_*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(A_*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-A_*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(1===this._pointers.length)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._rotateStart.set(i,n)}}_handleTouchStartPan(e){if(1===this._pointers.length)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._panStart.set(i,n)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,n=e.pageY-t.y,s=Math.sqrt(i*i+n*n);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(1==this._pointers.length)this._rotateEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._rotateEnd.set(i,n)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(A_*this._rotateDelta.x/t.clientHeight),this._rotateUp(A_*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(1===this._pointers.length)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._panEnd.set(i,n)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,n=e.pageY-t.y,s=Math.sqrt(i*i+n*n);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const r=.5*(e.pageX+t.x),o=.5*(e.pageY+t.y);this._updateZoomParameters(r,o)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return void this._pointers.splice(t,1)}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];void 0===t&&(t=new te,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,i={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:i.deltaY*=16;break;case 2:i.deltaY*=100}return e.ctrlKey&&!this._controlActive&&(i.deltaY*=10),i}}function I_(e){!1!==this.enabled&&(0===this._pointers.length&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(e)&&(this._addPointer(e),"touch"===e.pointerType?this._onTouchStart(e):this._onMouseDown(e)))}function F_(e){!1!==this.enabled&&("touch"===e.pointerType?this._onTouchMove(e):this._onMouseMove(e))}function U_(e){switch(this._removePointer(e),this._pointers.length){case 0:this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(y_),this.state=M_;break;case 1:const t=this._pointers[0],i=this._pointerPositions[t];this._onTouchStart({pointerId:t,pageX:i.x,pageY:i.y})}}function B_(e){let t;switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case Qe.DOLLY:if(!1===this.enableZoom)return;this._handleMouseDownDolly(e),this.state=E_;break;case Qe.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===this.enablePan)return;this._handleMouseDownPan(e),this.state=P_}else{if(!1===this.enableRotate)return;this._handleMouseDownRotate(e),this.state=S_}break;case Qe.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===this.enableRotate)return;this._handleMouseDownRotate(e),this.state=S_}else{if(!1===this.enablePan)return;this._handleMouseDownPan(e),this.state=P_}break;default:this.state=M_}this.state!==M_&&this.dispatchEvent(__)}function z_(e){switch(this.state){case S_:if(!1===this.enableRotate)return;this._handleMouseMoveRotate(e);break;case E_:if(!1===this.enableZoom)return;this._handleMouseMoveDolly(e);break;case P_:if(!1===this.enablePan)return;this._handleMouseMovePan(e)}}function N_(e){!1===this.enabled||!1===this.enableZoom||this.state!==M_||(e.preventDefault(),this.dispatchEvent(__),this._handleMouseWheel(this._customWheelEvent(e)),this.dispatchEvent(y_))}function j_(e){!1!==this.enabled&&this._handleKeyDown(e)}function H_(e){switch(this._trackPointer(e),this._pointers.length){case 1:switch(this.touches.ONE){case Je.ROTATE:if(!1===this.enableRotate)return;this._handleTouchStartRotate(e),this.state=C_;break;case Je.PAN:if(!1===this.enablePan)return;this._handleTouchStartPan(e),this.state=R_;break;default:this.state=M_}break;case 2:switch(this.touches.TWO){case Je.DOLLY_PAN:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchStartDollyPan(e),this.state=L_;break;case Je.DOLLY_ROTATE:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchStartDollyRotate(e),this.state=D_;break;default:this.state=M_}break;default:this.state=M_}this.state!==M_&&this.dispatchEvent(__)}function G_(e){switch(this._trackPointer(e),this.state){case C_:if(!1===this.enableRotate)return;this._handleTouchMoveRotate(e),this.update();break;case R_:if(!1===this.enablePan)return;this._handleTouchMovePan(e),this.update();break;case L_:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchMoveDollyPan(e),this.update();break;case D_:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchMoveDollyRotate(e),this.update();break;default:this.state=M_}}function V_(e){!1!==this.enabled&&e.preventDefault()}function W_(e){"Control"===e.key&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function K_(e){"Control"===e.key&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}class X_ extends k_{constructor(e,t){super(e,t),this.screenSpacePanning=!1,this.mouseButtons={LEFT:Qe.PAN,MIDDLE:Qe.DOLLY,RIGHT:Qe.ROTATE},this.touches={ONE:Je.PAN,TWO:Je.DOLLY_ROTATE}}}const q_={type:"change"},Y_=new Ge,Z_=new We,$_=new ie,Q_=new oe(new et(10,10,10),new se({color:16711680})),J_=Math.cos(70*Y.DEG2RAD),ey=2*Math.PI,ty=-1,iy=1e-6,ny=dr(0,89.99999,0).normalize();console.log(ny);class sy extends X_{_persistentPanOffset=new ie(0,0,0);resetPanOffset(){this._persistentPanOffset.set(0,0,0)}constructor(e,t,i=!1){super(e,t),i&&e.parent?.add(Q_)}targetUp=new ie(0,1,0);_panUp(e,t){$_.setFromMatrixColumn(t,0),$_.crossVectors(this.targetUp,$_),$_.multiplyScalar(e),this._panOffset.add($_)}_panLeft(e,t){$_.setFromMatrixColumn(t,0),$_.projectOnPlane(this.targetUp),$_.normalize(),$_.multiplyScalar(-e),this._panOffset.add($_)}targetPosition={heading:0,pitch:0,distance:0,x:0,y:0};_calculatePersistentPanOffset(e=0,t=0){const i=new ie,n=this.object.matrix;return 0!==e&&($_.setFromMatrixColumn(n,0),$_.projectOnPlane(this.targetUp),$_.normalize(),$_.multiplyScalar(-e),i.add($_)),0!==t&&($_.setFromMatrixColumn(n,0),$_.crossVectors(this.targetUp,$_),$_.multiplyScalar(t),i.add($_)),i}getTarget(){return this._persistentPanOffset?this.target.clone().add(this._persistentPanOffset):this.target}lookAt(){this.object.lookAt(this.getTarget())}invertCameraHPD(){const e=this.object.position,t=this.getTarget(),i=e.distanceTo(t),n=new ie,s=new ie,r=new ie;Ys.WGS84.getEastNorthUpVectors(this.target,n,s,r);const o=(new ie).subVectors(t,e).normalize(),a=(new ie).copy(o);a.projectOnPlane(r).normalize();const l=Math.atan2(a.dot(s),a.dot(n)),c=Y.radToDeg(l),h=Math.asin(-o.dot(r)),u=Y.radToDeg(h);let d=0,p=0;if(this._persistentPanOffset.lengthSq()>0){const e=this.object.matrix;$_.setFromMatrixColumn(e,0),$_.projectOnPlane(this.targetUp),$_.normalize(),d=-this._persistentPanOffset.dot($_),$_.setFromMatrixColumn(e,0),$_.crossVectors(this.targetUp,$_),$_.normalize(),p=this._persistentPanOffset.dot($_)}return{heading:c,pitch:u,distance:i,x:d,y:p}}setCameraPosition(e){this.targetPosition=e;const{heading:t,pitch:i,distance:n,x:s=0,y:r=0}=e;this._persistentPanOffset.copy(this._calculatePersistentPanOffset(s,r));const o=this.getTarget(),a=new ie,l=new ie,c=new ie;Ys.WGS84.getEastNorthUpVectors(this.target,a,l,c);const h=Y.degToRad(t),u=Y.degToRad(i),d=(new ie).copy(a).multiplyScalar(Math.cos(h)).add(l.clone().multiplyScalar(Math.sin(h))),p=(new ie).copy(d).multiplyScalar(Math.cos(u)).add(c.clone().multiplyScalar(Math.sin(-u))).normalize().multiplyScalar(n);this.object.position.copy(o).sub(p),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),Q_.position.copy(this.getTarget())}updateUp(e){this.targetUp.copy(e),this._quat=(new Ve).setFromUnitVectors(e,new ie(0,1,0)),this._quatInverse=this._quat.clone().invert(),this.object?.up.copy(this.targetUp),this.setCameraPosition(this.targetPosition)}update(e){if(!this._persistentPanOffset)return!1;let t;const i=this.object.position;let n=this.getTarget();$_.copy(i).sub(n),$_.applyQuaternion(this._quat),this._spherical.setFromVector3($_),this.autoRotate&&this.state===ty&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let s=this.minAzimuthAngle,r=this.maxAzimuthAngle;isFinite(s)&&isFinite(r)&&(s<-Math.PI?s+=ey:s>Math.PI&&(s-=ey),r<-Math.PI?r+=ey:r>Math.PI&&(r-=ey),this._spherical.theta=s<=r?Math.max(s,Math.min(r,this._spherical.theta)):this._spherical.theta>(s+r)/2?Math.max(s,this._spherical.theta):Math.min(r,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),!0===this.enableDamping?this._persistentPanOffset.addScaledVector(this._panOffset,this.dampingFactor):this._persistentPanOffset.add(this._panOffset),this._persistentPanOffset.sub(this.cursor),this._persistentPanOffset.clampLength(this.minTargetRadius,this.maxTargetRadius),this._persistentPanOffset.add(this.cursor),n.copy(this.getTarget());let o=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const e=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),o=e!=this._spherical.radius}if($_.setFromSpherical(this._spherical),$_.applyQuaternion(this._quatInverse),i.copy(n).add($_),this.object.lookAt(n),Q_.position.copy(this.getTarget()),!0===this.enableDamping?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let e=null;if(this.object.isPerspectiveCamera){const t=$_.length();e=this._clampDistance(t*this._scale);const i=t-e;this.object.position.addScaledVector(this._dollyDirection,i),this.object.updateMatrixWorld(),o=!!i}else if(this.object.isOrthographicCamera){const t=new ie(this._mouse.x,this._mouse.y,0);t.unproject(this.object);const i=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),o=i!==this.object.zoom;const n=new ie(this._mouse.x,this._mouse.y,0);n.unproject(this.object),this.object.position.sub(n).add(t),this.object.updateMatrixWorld(),e=$_.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;null!==e&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(e).add(this.object.position):(Y_.origin.copy(this.object.position),Y_.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(Y_.direction))<J_?this.object.lookAt(n):(Z_.setFromNormalAndCoplanarPoint(this.object.up,this.target),Y_.intersectPlane(Z_,this.target))))}else if(this.object.isOrthographicCamera){const e=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),e!==this.object.zoom&&(this.object.updateProjectionMatrix(),o=!0)}return this._scale=1,this._performCursorZoom=!1,(o||this._lastPosition.distanceToSquared(this.object.position)>iy||8*(1-this._lastQuaternion.dot(this.object.quaternion))>iy||this._lastTargetPosition.distanceToSquared(this.target)>iy)&&(this.dispatchEvent(q_),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),t=!0,this.targetPosition=this.invertCameraHPD(),this.dispatchEvent({type:"target-change"})),t=!1,t}}const ry=new ie,oy=new ie,ay=new Ne,ly={},cy=new ie;class hy extends Qh{isWorldPosition=!1;adjustCamera(e,t){super.adjustCamera(e);const{ellipsoidFrame:i,ellipsoidFrameInverse:n,ellipsoid:s,nearMargin:r,farMargin:o}=this,a=Math.max(...s.radius);if("isPerspectiveCamera"in e){const l=new ie;this.isWorldPosition?e.getWorldPosition(l):l.copy(e.position);const c=ry.setFromMatrixPosition(i).sub(l).length(),h=r*a,u=Y.clamp((c-a)/h,0,1),d=Y.lerp(1,1e3,u);this.isWorldPosition?t&&(e.near=.05*e.position.distanceTo(t)):e.near=Math.max(d,c-a-h),oy.copy(l).applyMatrix4(n),s.getPositionToCartographic(oy,ly);const p=Math.max(s.getPositionElevation(oy),2550),m=s.calculateHorizonDistance(ly.lat,p);e.far=m+.1+a*o,e.updateProjectionMatrix()}else{this._getVirtualOrthoCameraPosition(e.position,e),e.updateMatrixWorld(),ay.copy(e.matrixWorld).invert(),ry.setFromMatrixPosition(i).applyMatrix4(ay);const t=-ry.z;e.near=t-a*(1+r),e.far=t+.1+a*o,e.position.addScaledVector(cy,e.near),e.far-=e.near,e.near=0,e.updateProjectionMatrix(),e.updateMatrixWorld()}}}const uy=e({__name:"GeoControls",props:S({enableDamping:{type:Boolean,default:!0},adjustHeight:{type:Boolean,default:!1},minDistance:{default:150},target:{default:null}},{position:{required:!0},positionModifiers:{},"target-position":{required:!1},"target-positionModifiers":{}}),emits:["update:position","update:target-position"],setup(e){const{scene:t,camera:i,renderer:n}=ln(),r=E(e,"position"),c=E(e,"target-position"),h=(e,t,i)=>{let n;const s=()=>{n=a(e,t,i)};return s(),e=>{n(),e().then((()=>{s()}))}},u=e,{onAfterRender:d}=cn();let p=null,m=s(null);const f=()=>{if(u.target){const e=dr(u.target.lon,u.target.lat,u.target.height||0);m.value?.target.copy(e),m.value?.updateUp((e=>{const t=new ie;return Ys.WGS84.getSurfaceNormal(e,t),t})(e))}},g=h([c],(()=>{c.value&&m.value&&m.value.setCameraPosition(c.value)}));a([m],(()=>{c.value&&m.value&&m.value.setCameraPosition(c.value)}),{immediate:!0});const v=()=>{u.target?(p&&(p.isWorldPosition=!0,p.enabled=!1),!m.value&&i.value&&n.value&&(m.value=new sy(i.value,n.value.domElement),m.value.enableDamping=u.enableDamping,m.value.minDistance=u.minDistance,m.value.addEventListener("target-change",(()=>{g((async()=>{c.value=m.value?.targetPosition||c.value}))}))),m.value&&(m.value.enabled=!0,m.value.resetPanOffset(),f(),m.value)):(p&&(p.isWorldPosition=!1),m.value&&(m.value.enabled=!1),p&&(p.enabled=!0,i.value?.up.set(0,1,0)))};o((()=>{i.value&&n.value&&t.value&&(p=new hy(t.value,i.value,n.value.domElement),p.setTilesRenderer({group:t.value}),p.enableDamping=u.enableDamping,p.adjustHeight=u.adjustHeight,p.minDistance=u.minDistance,v())}));const _=()=>{i.value&&!u.target&&((e,t,i,n,s,r)=>{new cr(t,hr(i),hr(n)).decompose(new Qs(hr(s),hr(r)).toECEF(),e.position,e.quaternion,e.up),e.updateMatrixWorld()})(i.value,r.value.distance,r.value.heading,r.value.pitch,r.value.longitude,r.value.latitude)};a((()=>u.target),(()=>{v(),u.target||_()}),{immediate:!0,deep:!0});const y=h([r,i],(()=>{_()}));return d((()=>{if(u.target&&m.value?.enabled?(m.value.update(),i.value&&p?.adjustCamera(i.value,m.value.target)):u.target||p?.update(),i.value&&!u.target){const e=(e=>{pr.setFromCamera(e);const t=fr.setFromMatrixPosition(e.matrixWorld),i=gr.set(0,0,.5).unproject(e).sub(t).normalize(),n=_r.getIntersection(vr.set(t,i));return n?(mr.setFromECEF(n),{distance:pr.distance,heading:ur(pr.heading),pitch:ur(pr.pitch),longitude:ur(mr.longitude),latitude:ur(mr.latitude)}):null})(i.value);e&&y((async()=>{r.value=e}))}})),l((()=>{p?.dispose(),m.value?.dispose()})),(e,t)=>null}}),dy=["color","intensity"],py=["color","intensity","position"],my=e({__name:"GeoScene",props:{sceneConfig:{default:()=>({effectProps:{enabled:!0,focusArea:.7,feather:.1},ambientLight:{color:"#fff",intensity:1},directionalLight:{color:"#fff",intensity:2,position:[-1500,500,500]},background:"/farm_field_puresky_2k.jpg"})}},setup(e){const t=e,{sceneConfig:i}=t,s=w(i.effectProps),a=w(i.ambientLight),l=w(i.directionalLight),h=n(null),d=n(null),{scene:p}=ln();return o((()=>{const e=new Oe;if(i.background){const t=e.load(i.background);t.mapping=ke,t.colorSpace=X,p.value.background=t}})),(e,t)=>(c(),r("TresGroup",null,[T(e.$slots,"default"),s.enabled?(c(),P(O,{key:0},{default:L((()=>[D(u(Rs),null,{default:L((()=>[D(u(Is),{focusArea:s.focusArea,feather:s.feather},null,8,["focusArea","feather"])])),_:1})])),_:1})):C("",!0),R("TresAmbientLight",{ref_key:"ambientLightRef",ref:h,color:a.color,intensity:a.intensity},null,8,dy),R("TresDirectionalLight",{ref_key:"directionalLightRef",ref:d,color:l.color,intensity:l.intensity,position:l.position},null,8,py)]))}});export{uy as $,nd as H,my as K,f_ as M,m_ as V,g_ as W,Gr as Y,Hr as a,Ur as b,Vr as c,Uo as d,Ho as f,Do as h,Sr as i,sv as j,Go as m,wr as n,Rr as o,zo as p,Pr as r,Ar as s,Co as u,jo as v};
