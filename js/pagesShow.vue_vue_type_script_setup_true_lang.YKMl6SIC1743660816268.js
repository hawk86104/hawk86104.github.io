import{C as e,ab as a,cu as o,cv as t,cw as l,cx as r,n as i,c4 as n,ar as s,at as u}from"./three.2wx8FU0g1743660816268.js";import{P as d,e as p,o as c}from"./@tresjs.zc7faK4J1743660816268.js";import{z as m}from"./three-custom-shader-material.uMc5A1EX1743660816268.js";import{b as f,a as y}from"./buildingsCustomShaderMaterial.hq-IAd4G1743660816268.js";import{d as h,b as w,a2 as g,w as v,o as b,H as C,u as x,r as S,a4 as B,e as T,f as _,g as j,m as M,N as A,j as L,aj as R,ak as O,F as H,M as G,J as W}from"./@vue.B5PFBfKs1743660816268.js";const k=async()=>{const e=await d("./plugins/digitalCity/model/shanghai.FBX");let a=null,o=null,t=null;return e.traverse((e=>{"CITY_UNTRIANGULATED"===e.name&&(a=e),"LANDMASS"===e.name&&(o=e),"ROADS"===e.name&&(t=e)})),{model:e,city:a,land:o,roads:t}},F=["object"],D=h({__name:"buildingsModelCustomShader",props:{model:{},bulidingsColor:{default:"#e523ff"},landColor:{default:"#112233"},topColor:{default:"#ffff00"},opacity:{default:.9},gradient:{type:Boolean,default:!0}},setup(o){const t=o,l=w(0),r=t.model.city;r.renderOrder=1001;const i=t.model.land;(()=>{const{geometry:o}=r;o.computeBoundingBox(),o.computeBoundingSphere();const{max:i,min:n}=o.boundingBox;if(r.material.__csm)return;const s=new m({baseMaterial:r.material,vertexShader:f,fragmentShader:y,silent:!0,uniforms:{uMax:{value:i},uMin:{value:n},uBorderWidth:{value:5},uCircleTime:{value:5},uColor:{value:new e(t.bulidingsColor)},uOpacity:{value:t.opacity},uLightColor:{value:new e("#ffffff")},uTopColor:{value:new e(t.topColor)},uTime:l,uGradient:{value:t.gradient}},depthWrite:!0,depthTest:!0,transparent:!0,side:a});r.material.dispose(),r.material=s})();const{onLoop:n}=p();n((({delta:e})=>{l.value+=e})),g((()=>{t.bulidingsColor&&r.material.uniforms.uColor.value.setStyle(t.bulidingsColor),t.landColor&&((e,o)=>{let l;"cu"===e||"land"===e&&(l=Array.isArray(i.material)?i.material:[i.material],l.forEach((e=>{e[o].setStyle(t.landColor),e.side=a})))})("land","color"),t.opacity&&(r.material.uniforms.uOpacity.value=t.opacity)})),v(t,((e,a)=>{r.material.uniforms.uGradient.value=e.gradient}));const s=t.model.model.clone();return(e,a)=>(b(),C("primitive",{object:x(s)},null,8,F))}}),N=["object"],E=h({__name:"buildingsLines",props:{builds:{},width:{default:1},color:{default:"#FFF"},opacity:{default:1},style:{default:"Wireframe"}},setup(a){const n=a;let s=null,u=null;if("Wireframe"===n.style){const e=new o(n.builds.geometry);let a=(new t).fromEdgesGeometry(e),i=new l({color:n.color,linewidth:n.width,opacity:n.opacity,transparent:!0,depthWrite:!0,depthTest:!0});i.resolution.set(window.innerWidth,window.innerHeight),s=new r(a,i),s.applyMatrix4(n.builds.matrix.clone())}else{u={transparent:!0,uniforms:{uColor:{value:new e(n.color)},uOpacity:{value:n.opacity}},vertexShader:"\n       void main() {\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:" \n        uniform vec3 uColor;\n\t\t\t\tuniform float uOpacity;\n        void main() {\n          gl_FragColor = vec4(uColor, uOpacity);\n        }\n      "};const a=new o(n.builds.geometry),t=new i(u);s=new LineSegments(a,t),s.applyMatrix4(n.builds.matrix.clone()),s.material.linewidth=n.width,s.renderOrder=1e3}return g((()=>{"Shader"===n.style&&(n.color&&(u.uniforms.uColor.value=new e(n.color)),n.opacity&&(u.uniforms.uOpacity.value=n.opacity)),"Wireframe"===n.style&&(n.color&&(s.material.color=new e(n.color)),n.opacity&&(s.material.opacity=n.opacity)),n.width&&(s.material.linewidth=n.width)})),(e,a)=>(b(),C("primitive",{object:x(s)},null,8,N))}}),P={key:1,args:[1e3],position:[0,19,0]},I={key:2,args:[6e3,100],position:[0,19,0]},U=h({__name:"pagesShow",props:{showBuildings:{type:Boolean,default:!0},autoRotate:{type:Boolean,default:!0},showAxesHelper:{type:Boolean,default:!0},showGridHelper:{type:Boolean,default:!0},disableRender:{type:Boolean,default:!1}},async setup(e){let a,o;const t=e,l=S({clearColor:"#000000",shadows:!0,alpha:!1,useLegacyLights:!0,shadowMapType:n,outputColorSpace:s,toneMapping:u,disableRender:t.disableRender}),r=S({autoRotate:t.autoRotate,enableDamping:!0});let i=null;t.showBuildings&&([a,o]=B((()=>k())),a=await a,o(),i=a);const d=w(),p=w();return(e,a)=>{const o=T("TresCanvas");return b(),_(o,M({ref_key:"tcRef",ref:p},l,{"window-size":""}),{default:j((()=>[A("TresPerspectiveCamera",{ref_key:"perspectiveCameraRef",ref:d,position:[600,750,-1221],fov:45,near:1,far:1e5},null,512),L(x(c),R(O(r)),null,16),a[0]||(a[0]=A("TresAmbientLight",{color:"#ffffff"},null,-1)),a[1]||(a[1]=A("TresDirectionalLight",{position:[100,100,0],intensity:.5,color:"#ffffff"},null,-1)),t.showBuildings&&x(i)?(b(),C(H,{key:0},[L(D,{model:x(i)},null,8,["model"]),L(E,{builds:x(i).city,color:"#000"},null,8,["builds"])],64)):G("",!0),W(e.$slots,"ability"),t.showAxesHelper?(b(),C("TresAxesHelper",P)):G("",!0),t.showGridHelper?(b(),C("TresGridHelper",I)):G("",!0)])),_:3},16)}}});export{U as _,D as a,E as b,k as l};
