import{m as e,e as t,D as s,a as o,t as n}from"./@tresjs.CywMBpUh1758259351508.js";import"./@fesjs.uDzWZsaX1758259351508.js";import"./Resource.DDopQ4j61758259351508.js";/* empty css                                                                             */import{_ as a}from"./randomLoading.vue_vue_type_script_setup_true_lang.BVkzOk_B1758259351508.js";import"./three-mesh-ui.module.t9YwAzlx1758259351508.js";import"./global.DmBaWnKd1758259351508.js";/* empty css                                                              */import{o as r,au as i,c as l,bi as u,a as p,M as c,S as m,V as d,B as g,l as v,cw as j}from"./three.CtgP63ME1758259351508.js";import{P as y}from"./tweakpane.C0HtAJSg1758259351508.js";import{I as h,C as f,N as b,c as w,d as _,a as T}from"./three-mesh-bvh.Bx1dVRfz1758259351508.js";import{d as x,aa as M,b as C,a2 as L,G as B,o as z,F as A,I as X,u as k,r as Y,h as S,j as O,f as Z,e as F,m as H,a5 as I}from"./@vue.pEDXJ_3Z1758259351508.js";import"./postprocessing.DJgHFhS91758259351508.js";import"./@vueuse.C5HLo59K1758259351508.js";import"./vue-router.BT0ZZbwZ1758259351508.js";import"./lodash-es.C7pWAXPe1758259351508.js";import"./pinia.C_K98KJs1758259351508.js";import"./@qlin.q6OWdsQV1758259351508.js";import"./@babel.BPq7uOAK1758259351508.js";import"./@floating-ui.BFjFSAYt1758259351508.js";import"./@juggle.CcBCnTIR1758259351508.js";import"./starLoading.DFPZIqgM1758259351508.js";import"./utils.BQV0fxbj1758259351508.js";import"./cssLoaders.CQpM9kUP1758259351508.js";import"./bubbleLoading.DePR09OY1758259351508.js";import"./yangyangLoading.Dr1o3-z41758259351508.js";import"./color.BPoHtV0H1758259351508.js";import"./@amap.CGUF9xH41758259351508.js";import"./color-string.P-yvt9W21758259351508.js";import"./color-name.BQ5IbGbl1758259351508.js";import"./simple-swizzle.Xn8N6iLa1758259351508.js";import"./is-arrayish.CLsR9Wfx1758259351508.js";import"./color-convert.Btfsg-JE1758259351508.js";import"./lodash.Bo0I6nx61758259351508.js";const P=["geometry","material"],R=["geometry"],U=x({__name:"model",props:{controls:{}},async setup(o){let n,a;const x=o;g.prototype.computeBoundsTree=w,g.prototype.disposeBoundsTree=_,v.prototype.raycast=T;const Y=([n,a]=M((()=>s(j,"https://opensource.cdn.icegl.cn/model/industry4/TR12J_OCC.stl"))),n=await n,a(),n),S=new i({color:16777215,roughness:.2,metalness:1,vertexColors:!0}),O=new Uint8Array(3*Y.attributes.position.count);O.fill(255);const Z=new l(O,3,!0);Z.setUsage(u),Y.setAttribute("color",Z);const F=C(null),H=C(null),I=C(!1),U=C(-1),W=C(.2),E=new p,{camera:G,raycaster:J}=e(),q=15/255,D=78/255,N=85/255;let V=null;L((()=>{F.value&&(console.log("targetMesh.value init",F.value),F.value.geometry.computeBoundsTree(),V=Y.boundsTree,((e,t,s,o,n,a)=>{window.addEventListener("pointermove",(s=>{e.x=s.clientX/window.innerWidth*2-1,e.y=-s.clientY/window.innerHeight*2+1,t.value=!0})),window.addEventListener("pointerdown",(i=>{e.x=i.clientX/window.innerWidth*2-1,e.y=-i.clientY/window.innerHeight*2+1,o.value=i.button;const l=new r;l.setFromCamera(e,s.value),l.firstHitOnly=!0;const u=l.intersectObject(n.value,!0);t.value=!0,a.enabled=0===u.length}),!0),window.addEventListener("pointerup",(e=>{o.value=-1,"touch"===e.pointerType&&(t.value=!1)}),!0)})(E,I,G,U,F,x.controls.instance))}));const{onLoop:K}=t();K((()=>{const e=Y.index;if(H.value)if(x.controls.instance.active||!I.value)H.value.visible=!1;else{H.value.scale.setScalar(W.value),J.value.setFromCamera(E,G.value),J.value.firstHitOnly=!0;const t=J.value.intersectObject(F.value,!0);if(t.length){H.value.position.copy(t[0].point),x.controls.instance.enabled=!1,H.value.visible=!0;const s=new c;s.copy(F.value.matrixWorld).invert();const o=new m;o.center.copy(H.value.position).applyMatrix4(s),o.radius=100*W.value;const n=[],a=new d;if(V?.shapecast({intersectsBounds:e=>{const t=o.intersectsBox(e),{min:s,max:n}=e;if(t){for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let r=0;r<=1;r++)if(a.set(0===e?s.x:n.x,0===t?s.y:n.y,0===r?s.z:n.z),!o.containsPoint(a))return h;return f}return t?h:b},intersectsTriangle:(e,t,s)=>{if(s||e.intersectsSphere(o)){const e=3*t;n.push(e,e+1,e+2)}return!1}}),0===U.value||2===U.value){let t=1,s=1,o=1;0===U.value&&(t=q,s=D,o=N);for(let a=0,r=n.length;a<r;a++){const r=e.getX(n[a]);Z.setX(r,t),Z.setY(r,s),Z.setZ(r,o)}Z.needsUpdate=!0}}else H.value.visible=!1,x.controls.instance.enabled=!0}}));const Q=(new y).addButton({title:"点击按钮",label:"生成模型"}),$=new g;return Q.on("click",(()=>{const e=[],t=[];for(let o=0;o<Z.count;o++)Z.getX(o)===q&&Z.getY(o)===D&&Z.getZ(o)===N&&(e.push(Y.attributes.position.getX(o),Y.attributes.position.getY(o),Y.attributes.position.getZ(o)),t.push(Y.attributes.normal.getX(o),Y.attributes.normal.getY(o),Y.attributes.normal.getZ(o)));const s=new Float32Array(e);$.setAttribute("position",new l(s,3)),$.setAttribute("normal",new l(s,3))})),(e,t)=>(z(),B(A,null,[X("TresMesh",{ref_key:"targetMesh",ref:F,geometry:k(Y),scale:.005,material:k(S)},null,8,P),X("TresMesh",{ref_key:"brushMesh",ref:H,visible:!1},t[0]||(t[0]=[X("TresSphereGeometry",{args:[1,40,40]},null,-1),X("TresMeshStandardMaterial",{color:15483002,roughness:.75,metalness:0,transparent:!0,opacity:.5,premultipliedAlpha:!0,emissive:15483002,emissiveIntensity:.5},null,-1)]),512),X("TresMesh",{geometry:k($),position:[-2,-2,2],scale:.005},t[1]||(t[1]=[X("TresMeshStandardMaterial",{color:"#023249",roughness:.2,metalness:0,envMapIntensity:.2},null,-1)]),8,R)],64))}}),W=x({__name:"collectTriangles",setup(e){const t=Y({clearColor:"#999999",antialias:!0}),s=Y({autoRotate:!1}),r=C(null);return(e,i)=>{const l=S("TresCanvas");return z(),B(A,null,[O(k(a)),O(l,H(t,{"window-size":""}),{default:Z((()=>[i[0]||(i[0]=X("TresPerspectiveCamera",{position:[5,1,15],fov:30,near:.1,far:1e3},null,-1)),O(k(o),H({ref_key:"controlsRef",ref:r},s),null,16),i[1]||(i[1]=X("TresAmbientLight",{intensity:1},null,-1)),(z(),F(I,null,{default:Z((()=>[O(U,{controls:r.value},null,8,["controls"])])),_:1})),(z(),F(I,null,{default:Z((()=>[O(k(n),{background:!1,files:["pos-x.jpg","neg-x.jpg","pos-y.jpg","neg-y.jpg","pos-z.jpg","neg-z.jpg"],path:"https://opensource.cdn.icegl.cn/images/skyBox/6jpg/"},null,8,["path"])])),_:1}))])),_:1},16)],64)}}});export{W as default};
