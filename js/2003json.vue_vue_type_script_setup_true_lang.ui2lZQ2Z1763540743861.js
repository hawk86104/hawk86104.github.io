import{u as e}from"./colorList.DbCLsRg71763540743861.js";import{g as a,a as t}from"./generalVolume.Bzkkd-tQ1763540743861.js";import{P as r}from"./tweakpane.CqZAnw7f1763540743861.js";import{u as s}from"./rawData.Bm5IktqG1763540743861.js";import{_ as l}from"./nc2003MapsurfaceSection.vue_vue_type_script_setup_true_lang.D75EQUCR1763540743861.js";import{d as o,a8 as n,a as i,c as u,w as p,H as m,o as d,u as v,J as c,b as h,I as x,m as f}from"./@vue.Co_gxueH1763540743861.js";import{V as g,bL as w,be as y,af as b,b1 as T,aE as j,aG as E,r as _,bK as k,f as B,ae as S}from"./three.rXKzP9fQ1763540743861.js";const F=["position","rotation"],M=["scale","visible"],A=["object"],C=o({__name:"2003json",props:{map:{}},async setup(o){let C,R;const G=o,z=G.map.geo2pos(new g(118.724419,32.010354,18e3));z.applyMatrix4(G.map.matrix);const D=s(),I=([C,R]=n(()=>fetch("./plugins/tvtVolumeRendering/rawData/test.json").then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).catch(e=>{console.error("Fetch error:",e)})),C=await C,R(),C),V=I.datas.reduce((e,a)=>Math.max(e,a)),J=I.datas.reduce((e,a)=>Math.min(e,a)),L=new Float32Array(I.datas.length);for(let e=0;e<I.datas.length;e++)L[e]=(I.datas[e]-J)/(V-J);D.setDataTypeFromJSdata(L),D.byteArray=L,D.xExtent=I.col,D.yExtent=I.row,D.zExtent=I.height;const P=e(),H=new w(new y(new b(1,1,1)),new T({color:10066329})),K=i(I.col),N=i(D.yExtent/D.xExtent*I.row),O=i(D.zExtent/D.xExtent*I.height),U=u(()=>!(K.value<=.01&&K.value>=-.01)&&(!(N.value<=.01&&N.value>=-.01)&&!(O.value<=.01&&O.value>=-.01))),W=new j(D.byteArray,D.xExtent,D.yExtent,D.zExtent);W.format=E,W.type=D.getThreeType(),W.minFilter=_,W.magFilter=_,W.wrapS=k,W.wrapT=k,W.wrapR=k,W.needsUpdate=!0;const q={uniforms:{dataTexture:{value:W},colorTexture:{value:P.updateTransferFunction()},samplingRate:{value:4},threshold:{value:.5},alphaScale:{value:1},invertColor:{value:!1},composeType:{value:1},u_clim:{value:new B(.093,-.001)}},vertexShader:t,fragmentShader:a,side:S,transparent:!0,depthWrite:!1,depthTest:!0,alphaToCoverage:!0},Q=i(!0),X=(new r).addTab({pages:[{title:"三维体"},{title:"面剖"}]}),Y=X.pages[0],Z=i(null);Y.addBlade({view:"list",label:"模式",options:[{text:"maximumIntensity",value:1},{text:"thresholding",value:2},{text:"emissionAbsorption",value:3}],value:q.uniforms.composeType.value}).on("change",e=>{q.uniforms.composeType.value=e.value}),Y.addBinding(q.uniforms.samplingRate,"value",{label:"体积采样率",min:0,max:4,step:.01}),Y.addBinding(q.uniforms.threshold,"value",{label:"体绘制的阈值",min:0,max:1,step:.01}),Y.addBinding(q.uniforms.alphaScale,"value",{label:"透明度",min:0,max:2,step:.01}),Y.addBinding(q.uniforms.invertColor,"value",{label:"是否反色"}),Y.addBinding(Q,"value",{label:"显示边框"}),Y.addBlade({view:"separator"});const $=i(!0);return Y.addBinding($,"value",{label:"显示三维体"}),p(()=>P.colorsStops,()=>{q.uniforms.colorTexture.value=P.updateTransferFunction()},{deep:!0,immediate:!0}),(e,a)=>(d(),m("TresGroup",{position:[...v(z)],rotation:[-Math.PI/2,0,0],scale:1e3},[c("TresMesh",{scale:[K.value,N.value,O.value],visible:U.value&&$.value,renderOrder:99990},[a[0]||(a[0]=c("TresBoxGeometry",{args:[1,1,1]},null,-1)),c("TresShaderMaterial",f(q,{ref_key:"smRef",ref:Z}),null,16),Q.value?(d(),m("primitive",{key:0,object:v(H)},null,8,A)):x("",!0)],8,M),v(D).byteArray?(d(),h(l,{key:0,scale:[K.value,N.value,O.value],paneControl:v(X).pages[1]},null,8,["scale","paneControl"])):x("",!0)],8,F))}});export{C as _};
