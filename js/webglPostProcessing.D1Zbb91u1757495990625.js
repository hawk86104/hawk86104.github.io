import{i as e}from"./ice-utils.DHSeSyjo1757495990625.js";import{P as t}from"./tweakpane.C0HtAJSg1757495990625.js";import{d as n,r as o,s as r,G as i,o as a,I as f,u as m}from"./@vue.pEDXJ_3Z1757495990625.js";import{c as E,o as s,l,t as _,s as u}from"./gl-matrix.DIOSHZud1757495990625.js";const c="\n\nattribute vec3 aPosition;\nattribute vec2 aTexCoords;\n\nuniform mat4 uProjection;\nuniform mat4 uView;\nuniform mat4 uModel;\n\nvarying vec2 texCoords;\n\nvoid main()\n{\n    texCoords=aTexCoords;\n    gl_Position=uProjection*uView*uModel*vec4(aPosition,1.);\n}",d="\nprecision mediump float;\n\nvarying vec2 texCoords;\n\nuniform sampler2D textureSampler;\n\nvoid main()\n{\n    gl_FragColor=texture2D(textureSampler,texCoords);\n}",T={id:"canvaswebgl"},x=["src"],R=n({__name:"webglPostProcessing",setup(n){let R,g,A,F,b,B,U,p,v,P,y,D,C;const h=1,L=.71,w=.76,M=new t({title:"参数"}),S=o({hidden:!0,offset_right_top:{x:.5,y:.5},offset_right_bottom:{x:.5,y:.5},offset_left_top:{x:.5,y:.5},offset_left_bottom:{x:.5,y:.5},overlay:{r:1,g:0,b:.33}});M.addBlade({view:"slider",label:"颜色",min:0,max:1,value:.5}).on("change",(e=>{Y(),g.uniform1f(D,e.value)}));let N=new Float32Array([.5,.5,0,1,1,.5,-.5,0,1,0,-.5,-.5,0,0,0,-.5,.5,0,0,1]);M.addBinding(S,"hidden",{label:"是否后处理"}),M.addBinding(S,"offset_right_top",{picker:"inline",x:{min:0,max:1},y:{min:0,max:1}}).on("change",(e=>{N[0]=S.offset_right_top.x,N[1]=S.offset_right_top.y,Y()})),M.addBinding(S,"offset_right_bottom",{picker:"inline",x:{min:-1,max:1},y:{min:-1,max:1}}).on("change",(e=>{N[5]=S.offset_right_bottom.x,N[6]=S.offset_right_bottom.y,Y()})),M.addBinding(S,"offset_left_bottom",{picker:"inline",x:{min:-1,max:1},y:{min:-1,max:1}}).on("change",(e=>{N[10]=S.offset_left_bottom.x,N[11]=S.offset_left_bottom.y,Y()})),M.addBinding(S,"offset_left_top",{picker:"inline",x:{min:-1,max:1},y:{min:-1,max:1}}).on("change",(e=>{N[15]=S.offset_left_top.x,N[16]=S.offset_left_top.y,Y()})),r((()=>{I()}));const I=function(){R=document.querySelector("#canvaswebgl"),R.width=window.innerWidth,R.height=window.innerHeight,g=R.getContext("webgl"),g&&(!function(){const t=new Float32Array([.5,.5,0,1,1,.5,-.5,0,1,0,-.5,-.5,0,0,0,-.5,.5,0,0,1]),n=new Uint8Array([0,1,2,0,2,3]);F=j(t,n),A=e(g,c,d),v=g.getUniformLocation(A,"uProjection"),P=g.getUniformLocation(A,"uView"),y=g.getUniformLocation(A,"uModel"),C=O(document.getElementById("logo-texture"))}(),Y(),g.enable(g.BLEND),g.blendFunc(g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA),G())};function G(){g.bindFramebuffer(g.FRAMEBUFFER,U),g.clearColor(h,L,w,1),g.clear(g.COLOR_BUFFER_BIT),function(){g.useProgram(A),g.bindBuffer(g.ARRAY_BUFFER,F);const e=E();s(e,0,R.width,R.height,0,.1,100),g.uniformMatrix4fv(v,!1,e);const t=E();l(t,[0,0,1],[0,0,0],[0,1,0]),g.uniformMatrix4fv(P,!1,t),X(C,600,600),X(C,400,400)}(),g.bindFramebuffer(g.FRAMEBUFFER,null),S.hidden&&(g.clear(g.COLOR_BUFFER_BIT),g.clearColor(0,0,1,1),g.bindBuffer(g.ARRAY_BUFFER,b),g.useProgram(B),g.bindTexture(g.TEXTURE_2D,p)),g.drawElements(g.TRIANGLES,6,g.UNSIGNED_BYTE,0),requestAnimationFrame(G)}function X(e,t,n){let o=E();_(o,o,[t,n,0]),u(o,o,[250,250,0]),g.uniformMatrix4fv(y,!1,o),g.bindTexture(g.TEXTURE_2D,e),g.drawElements(g.TRIANGLES,6,g.UNSIGNED_BYTE,0)}function Y(){const t=new Uint8Array([0,1,2,0,2,3]);b=j(N,t),B=e(g,"\n\nattribute vec3 aPosition;\nattribute vec2 aTexCoords;\n\nvarying vec2 texCoords;\n\nvoid main()\n{\n    texCoords=aTexCoords;\n    gl_Position=vec4(aPosition,1.);\n}","\nprecision mediump float;\n\nvarying vec2 texCoords;\n\nuniform sampler2D textureSampler;\nuniform float mixParam;\nvoid main()\n{\n    // float luminance=dot(texture2D(textureSampler,texCoords).rgb,vec3(.3451,.2118,.302));\n    vec4 color=mix(texture2D(textureSampler,texCoords),vec4(.1098,.6784,.1843,1.),mixParam);\n    gl_FragColor=color;\n}"),D=g.getUniformLocation(B,"mixParam"),g.getUniformLocation(B,"color"),p=O(R),U=g.createFramebuffer(),g.bindFramebuffer(g.FRAMEBUFFER,U),g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,p,0),g.bindFramebuffer(g.FRAMEBUFFER,null)}function O(e){const t=g.createTexture();return g.bindTexture(g.TEXTURE_2D,t),e instanceof HTMLImageElement?g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,e):g.texImage2D(g.TEXTURE_2D,0,g.RGBA,e.width,e.height,0,g.RGBA,g.UNSIGNED_BYTE,null),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),t}function j(e,t){const n=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,n),g.bufferData(g.ARRAY_BUFFER,e,g.STATIC_DRAW);const o=3*Float32Array.BYTES_PER_ELEMENT+2*Float32Array.BYTES_PER_ELEMENT;g.vertexAttribPointer(0,3,g.FLOAT,!1,o,0),g.enableVertexAttribArray(0),g.vertexAttribPointer(1,2,g.FLOAT,!1,o,3*Float32Array.BYTES_PER_ELEMENT),g.enableVertexAttribArray(1);const r=g.createBuffer();return g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,r),g.bufferData(g.ELEMENT_ARRAY_BUFFER,t,g.STATIC_DRAW),g.bindBuffer(g.ARRAY_BUFFER,null),n}return(e,t)=>(a(),i("canvas",T,[f("img",{id:"logo-texture",src:m("./")+"/plugins/postProcessing/image/logo.png",style:{display:"none"}},null,8,x)]))}});export{R as default};
