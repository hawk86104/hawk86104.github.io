import{i as e}from"./3d-tiles-renderer.CbgZh8zU1767066396612.js";import{F as t,_ as r,g as o,K as n}from"./@tresjs.B1f7s3pS1767066396612.js";import{l as i}from"./utils.DguR31dd1767066396612.js";import{h as s}from"./customShaderMaterial.vue_vue_type_script_setup_true_lang.DS9PWjZT1767066396612.js";import"./index.vue_vue_type_script_setup_true_lang.iYOGhvYh1767066396612.js";import{c as a}from"./utils.C8p1eAWw1767066396612.js";import{m as p}from"./d3-geo.C51lZA-81767066396612.js";import{c as l,d as c,a as u}from"./three-mesh-bvh.BBErpT9w1767066396612.js";const{withAsyncContext:m}=await e("vue"),{renderList:d,Fragment:h,openBlock:f,createElementBlock:y,toDisplayString:g,createElementVNode:v,unref:w,mergeProps:T,withCtx:_,createBlock:C,createCommentVNode:B}=await e("vue"),M=["position"],j=["blending","map"],S=["name","renderOrder","pCenter"],x=["args"],k=["color","side"],b=["renderOrder","position-z"],E=["position"],L=["renderOrder"],z=["position"],{watchEffect:P,ref:D}=await e("vue"),G=await e("three"),O={__name:"jiangSuMapMesh",async setup(e){let n,O;G.BufferGeometry.prototype.computeBoundsTree=l,G.BufferGeometry.prototype.disposeBoundsTree=c,G.Mesh.prototype.raycast=u;const V=([n,O]=m(()=>i("./plugins/simpleGIS/json/320000_full.json","features")),n=await n,O(),n),F=([n,O]=m(()=>s("./plugins/simpleGIS/image/icon.png")),n=await n,O(),n),H=V[0].properties.centroid,N=p();N.center(H).translate([0,0]);const R=[];V.forEach(e=>{const t=new G.Color(`hsl( 16, ${30*Math.random()+55}%, ${30*Math.random()+55}%)`).getHex(),r=.3*Math.random()+.3,{centroid:o,oneCenter:n,center:i,name:s}=e.properties,{coordinates:a,type:p}=e.geometry,l=o||n||i||[0,0],c=N(l);c[1]=-c[1],c[2]=r,R.push({type:"Html",position:c,name:s});const u=N(l);u[1]=.2-u[1],u[2]=r+.22,R.push({type:"Sprite",position:u}),a.forEach(e=>{function o(e){const o=new G.Shape;e.forEach((e,t)=>{const[r,n]=N(e);0===t?o.moveTo(r,-n):o.lineTo(r,-n)}),R.push({type:"Shape",shape:o,name:s,color:t,depth:r,pCenter:u});const n=[];e.forEach(e=>{const[t,r]=N(e);n.push(t,-r,0)}),R.push({type:"Line",points:new Float32Array(n),depth:r})}"MultiPolygon"===p&&e.forEach(e=>o(e)),"Polygon"===p&&o(e)})});const A=D();P(()=>{A.value&&((e=>{e.rotation.x=-Math.PI/2;const t=(new G.Box3).setFromObject(e).getCenter(new G.Vector3),r=[0,0];e.position.x=e.position.x-t.x-r[0],e.position.z=e.position.z-t.z-r[1]})(A.value),A.value.children.forEach(e=>{"Mesh"===e.type&&e.geometry.computeBoundsTree()}))});const I=e=>{e.object.material.opacity=.4},$=e=>{e.eventObject.material.opacity=1},{camera:K,controls:Q}=t();let q=null;const J=e=>{const t=new G.Vector3;t.x=e.point.x,t.y=e.point.y+10,t.z=e.point.z,q=a(K,t,Q)},{onBeforeRender:U}=r();U(()=>{q?.update()});const W={wrapperClass:"wrapper",as:"div",center:!0,sprite:!0,prepend:!0,transform:!0};return(e,t)=>(f(),y("TresGroup",{ref_key:"tgRef",ref:A},[(f(),y(h,null,d(R,(e,r)=>(f(),y(h,{key:`${r}`},["Html"===e.type?(f(),C(w(o),T({key:0,ref_for:!0},W,{position:e.position}),{default:_(()=>[v("span",null,g(e.name),1)]),_:2},1040,["position"])):B("",!0),"Sprite"===e.type?(f(),y("TresSprite",{key:1,position:e.position,scale:.3,renderOrder:1e3},[v("TresSpriteMaterial",{color:16711680,blending:G.NormalBlending,map:w(F)},null,8,j)],8,M)):B("",!0),"Shape"===e.type?(f(),y("TresMesh",{key:2,name:e.name,renderOrder:r,pCenter:e.pCenter,onPointerenter:I,onPointerleave:$,onClick:J},[v("TresExtrudeGeometry",{args:[e.shape,{depth:e.depth,bevelEnabled:!1}]},null,8,x),v("TresMeshStandardMaterial",{color:e.color,emissive:0,roughness:.45,metalness:.8,transparent:!0,side:G.DoubleSide},null,8,k)],40,S)):B("",!0),"Line"===e.type?(f(),y(h,{key:3},[v("TresLine",{renderOrder:r,"position-z":e.depth+1e-4},[v("TresBufferGeometry",{position:[e.points,3]},null,8,E),t[0]||(t[0]=v("TresLineBasicMaterial",{color:16777215,linewidth:.5},null,-1))],8,b),v("TresLine",{renderOrder:r,"position-z":-1e-4},[v("TresBufferGeometry",{position:[e.points,3]},null,8,z),t[1]||(t[1]=v("TresLineBasicMaterial",{color:0,linewidth:.5},null,-1))],8,L)],64)):B("",!0)],64))),64))],512))}},{defineComponent:V}=await e("vue"),{createElementVNode:F,unref:H,normalizeProps:N,guardReactiveProps:R,createVNode:A,Suspense:I,withCtx:$,openBlock:K,createBlock:Q,resolveComponent:q,mergeProps:J}=await e("vue"),{reactive:U}=await e("vue"),W=V({__name:"jiangSuMap",setup(e){const t=U({clearColor:"#ffdbd1",alpha:!0,antialias:!0}),r=U({enableDamping:!0,dampingFactor:.05,makeDefault:!0});return(e,o)=>{const i=q("TresCanvas");return K(),Q(i,J(t,{"window-size":""}),{default:$(()=>[o[0]||(o[0]=F("TresPerspectiveCamera",{position:[0,12,0],fov:75,near:.1,far:1e3,up:[0,0,-1]},null,-1)),A(H(n),N(R(r)),null,16),o[1]||(o[1]=F("TresAmbientLight",{intensity:8.8},null,-1)),o[2]||(o[2]=F("TresDirectionalLight",{position:[0,10,5],intensity:.2},null,-1)),o[3]||(o[3]=F("TresDirectionalLight",{position:[0,10,-5],intensity:.2},null,-1)),o[4]||(o[4]=F("TresDirectionalLight",{position:[5,10,0],intensity:.2},null,-1)),o[5]||(o[5]=F("TresDirectionalLight",{position:[-5,10,0],intensity:.2},null,-1)),o[6]||(o[6]=F("TresGridHelper",{args:[20,10]},null,-1)),(K(),Q(I,null,{default:$(()=>[A(O)]),_:1}))]),_:1},16)}}});export{W as default};
