import{M as e}from"./mqttTvt.BiJsvMtQ1763540743861.js";import{d as l,a,q as t,W as u,i as s,w as o,H as n,o as i,h as v,u as c,e as r,y as d,J as m}from"./@vue.Co_gxueH1763540743861.js";import{u as p,N as g,d as f,F as h,D as b,g as _,f as T,H as q}from"./naive-ui.qjPOP62h1763540743861.js";const y={class:"w-100 absolute z-99999 mqttdebugger",style:{"margin-top":"40px"}},w=l({__name:"widthMqtt",setup(l){const w=p(),x=a(!1),M=a(!1),$={host:"a5183db3.ala.asia-southeast1.emqxsl.com",port:8084,protocol:"wss",clientId:`tvt-test-client-${Math.random().toString(16).slice(2,8)}`,username:"tvt.js",password:"test",topic:"tvtDevices/#"},j=a(null),k=a(!1),D=a([]);function Q(){j.value&&H(),j.value=new e($),j.value.on("connected",()=>{k.value=!0,console.log("MQTT 连接成功"),function(){if(!j.value)return;j.value.subscribe($.topic,e=>{e?console.error(`订阅失败: ${e.message}`):console.log(`已订阅主题: ${$.topic}`)})}()}),j.value.on("close",()=>{k.value=!1,console.log("MQTT 连接关闭")}),j.value.on("error",e=>{console.error(`MQTT 错误: ${e.message}`)}),j.value.on("message",(e,l)=>{D.value.push(`[${e}] ${JSON.stringify(l)}`),D.value.length>100&&D.value.shift(),!M.value&&l&&l.status&&(x.value="运行"===l.status),l&&l.detail&&w.info("mqtt["+l.deviceId+"] 设备详情："+l.detail+"程序已运行："+l.uptime,{keepAliveOnHover:!0,duration:18e3})}),j.value.connect()}function H(){j.value&&(j.value.removeAllListeners(),j.value.disconnect(),j.value=null,k.value=!1)}t(()=>{Q()}),u(()=>{j.value,H()});let I=null;function J(e){M.value=!0;const l={deviceId:"tvtDevice001",status:e?"运行":"关闭"};j.value.publish("tvtDevices/tvtDevice001/control",l),clearTimeout(I),I=setTimeout(()=>{M.value=!1},1e3)}const N=s("animationPlay");return o(()=>x.value,e=>{N.value=e},{immediate:!0}),(e,l)=>(i(),n("div",y,[v(c(g),{title:"MQTT 调试面板",style:{"background-color":"#d6d0c540"}},{default:r(()=>[v(c(f),{label:"注意："},{default:r(()=>[v(c(h),{style:{padding:"30px 21px","line-height":"21px"},type:"warning"},{default:r(()=>[...l[1]||(l[1]=[d("免费服务每月流量/次数有限",-1),m("br",null,null,-1),d("若连接失败请自行更换自己的mqtt服务",-1)])]),_:1})]),_:1}),v(c(b),{style:{"margin-top":"-10px"}},{default:r(()=>[...l[2]||(l[2]=[d("mqtt配置信息",-1)])]),_:1}),v(c(_),{value:JSON.stringify($,null,2),type:"textarea",rows:9,disabled:""},null,8,["value"]),v(c(b),null,{default:r(()=>[...l[3]||(l[3]=[d("连接状态",-1)])]),_:1}),v(c(f),{label:"mqtt代理通路"},{default:r(()=>[v(c(T),{value:k.value},{checked:r(()=>[...l[4]||(l[4]=[d(" 已连接 ",-1)])]),unchecked:r(()=>[...l[5]||(l[5]=[d(" 连接中 ",-1)])]),_:1},8,["value"])]),_:1}),v(c(f),{label:"订阅主题"},{default:r(()=>[v(c(_),{value:$.topic,disabled:""},null,8,["value"])]),_:1}),v(c(b),null,{default:r(()=>[...l[6]||(l[6]=[d("信息日志列表",-1)])]),_:1}),v(c(q),{log:D.value.join("\n"),rows:12},null,8,["log"]),v(c(b),null,{default:r(()=>[...l[7]||(l[7]=[d("通过mqtt交互状态",-1)])]),_:1}),l[8]||(l[8]=d(" 开关电风扇 : ",-1)),v(c(T),{loading:M.value,round:!1,value:x.value,"onUpdate:value":[l[0]||(l[0]=e=>x.value=e),J]},null,8,["loading","value"])]),_:1})]))}});export{w as _};
