import{F as e,_ as t,K as s,t as o}from"./@tresjs.hGs-POUu1762392119014.js";import"./@fesjs.A8NDsaeg1762392119014.js";import"./Resource.S1Cir9aE1762392119014.js";/* empty css                                                                             */import{_ as n}from"./randomLoading.vue_vue_type_script_setup_true_lang.Cwi20loK1762392119014.js";import"./three-mesh-ui.module.Cd39rfWu1762392119014.js";import"./global.CU8_TnxT1762392119014.js";/* empty css                                                              */import"./shapeConfigurator.vue_vue_type_style_index_1_scoped_abbf0cc1_lang.DZ0IZ-Ox1762392119014.js";import{u as a}from"./useLoader.VuwfYjb91762392119014.js";import{m as r,u as i,j as l,bc as u,d as p,M as c,S as m,V as d,i as g,o as v,cS as j}from"./three.CDsL_76W1762392119014.js";import{P as y}from"./tweakpane.CqZAnw7f1762392119014.js";import{I as h,C as f,N as _,c as b,d as w,a as x}from"./three-mesh-bvh.BCkrv0811762392119014.js";import{d as T,ac as M,a as A,a3 as C,G as L,o as z,F as B,I as k,u as S,r as X,g as F,h as Y,e as O,b as R,m as H,ah as I}from"./@vue.DQUdVfVE1762392119014.js";import"./postprocessing.fZnJ7mZA1762392119014.js";import"./@vueuse.CnFTmRHc1762392119014.js";import"./vue-router.0qiUGQol1762392119014.js";import"./lodash-es.DWe8oqPO1762392119014.js";import"./pinia.CHmD3xPj1762392119014.js";import"./@qlin.y-0Z8WnK1762392119014.js";import"./@babel.BPq7uOAK1762392119014.js";import"./@floating-ui.Bhq4ibgf1762392119014.js";import"./@juggle.Vc7cP4_P1762392119014.js";import"./starLoading.Bd4OAVl31762392119014.js";import"./utils.DCg6fJZE1762392119014.js";import"./cssLoaders.CJJ_23961762392119014.js";import"./bubbleLoading.B68Md2vO1762392119014.js";import"./yangyangLoading.DAKLE7OM1762392119014.js";import"./color.BzrFDef11762392119014.js";import"./color-string.J02Ymfwe1762392119014.js";import"./color-name.gyPnsvCn1762392119014.js";import"./lodash.CUEArUAE1762392119014.js";import"./@amap.fjyZdsU91762392119014.js";import"./object-hash.CF39HzT91762392119014.js";import"./jszip.LyM0NlAT1762392119014.js";const P=["geometry","material"],Z=["geometry"],E=T({__name:"model",props:{controls:{}},async setup(s){let o,n;const T=s;g.prototype.computeBoundsTree=b,g.prototype.disposeBoundsTree=w,v.prototype.raycast=x;const X=([o,n]=M(()=>a(j,"https://opensource.cdn.icegl.cn/model/industry4/TR12J_OCC.stl")),o=await o,n(),o),F=new i({color:16777215,roughness:.2,metalness:1,vertexColors:!0}),Y=new Uint8Array(3*X.attributes.position.count);Y.fill(255);const O=new l(Y,3,!0);O.setUsage(u),X.setAttribute("color",O);const R=A(null),H=A(null),I=A(!1),E=A(-1),G=A(.2),U=new p,{camera:W}=e(),q=A(new r),J=15/255,K=78/255,N=85/255;let V=null;C(()=>{R.value&&(console.log("targetMesh.value init",R.value),R.value.geometry.computeBoundsTree(),V=X.boundsTree,((e,t,s,o,n,a)=>{window.addEventListener("pointermove",s=>{e.x=s.clientX/window.innerWidth*2-1,e.y=-s.clientY/window.innerHeight*2+1,t.value=!0}),window.addEventListener("pointerdown",i=>{e.x=i.clientX/window.innerWidth*2-1,e.y=-i.clientY/window.innerHeight*2+1,o.value=i.button;const l=new r;l.setFromCamera(e,s.value),l.firstHitOnly=!0;const u=l.intersectObject(n.value,!0);t.value=!0,a.enabled=0===u.length},!0),window.addEventListener("pointerup",e=>{o.value=-1,"touch"===e.pointerType&&(t.value=!1)},!0)})(U,I,W,E,R,T.controls.instance))});const{onBeforeRender:$}=t();$(()=>{const e=X.index;if(H.value)if(T.controls.instance.active||!I.value)H.value.visible=!1;else{H.value.scale.setScalar(G.value),q.value.setFromCamera(U,W.value),q.value.firstHitOnly=!0;const t=q.value.intersectObject(R.value,!0);if(t.length){H.value.position.copy(t[0].point),T.controls.instance.enabled=!1,H.value.visible=!0;const s=new c;s.copy(R.value.matrixWorld).invert();const o=new m;o.center.copy(H.value.position).applyMatrix4(s),o.radius=100*G.value;const n=[],a=new d;if(V?.shapecast({intersectsBounds:e=>{const t=o.intersectsBox(e),{min:s,max:n}=e;if(t){for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let r=0;r<=1;r++)if(a.set(0===e?s.x:n.x,0===t?s.y:n.y,0===r?s.z:n.z),!o.containsPoint(a))return h;return f}return t?h:_},intersectsTriangle:(e,t,s)=>{if(s||e.intersectsSphere(o)){const e=3*t;n.push(e,e+1,e+2)}return!1}}),0===E.value||2===E.value){let t=1,s=1,o=1;0===E.value&&(t=J,s=K,o=N);for(let a=0,r=n.length;a<r;a++){const r=e.getX(n[a]);O.setX(r,t),O.setY(r,s),O.setZ(r,o)}O.needsUpdate=!0}}else H.value.visible=!1,T.controls.instance.enabled=!0}});const D=(new y).addButton({title:"点击按钮",label:"生成模型"}),Q=new g;return Q.setAttribute("position",new l(new Float32Array,0)),D.on("click",()=>{const e=[],t=[];for(let o=0;o<O.count;o++)O.getX(o)===J&&O.getY(o)===K&&O.getZ(o)===N&&(e.push(X.attributes.position.getX(o),X.attributes.position.getY(o),X.attributes.position.getZ(o)),t.push(X.attributes.normal.getX(o),X.attributes.normal.getY(o),X.attributes.normal.getZ(o)));const s=new Float32Array(e);Q.setAttribute("position",new l(s,3)),Q.setAttribute("normal",new l(s,3))}),(e,t)=>(z(),L(B,null,[k("TresMesh",{ref_key:"targetMesh",ref:R,geometry:S(X),scale:.005,material:S(F)},null,8,P),k("TresMesh",{ref_key:"brushMesh",ref:H,visible:!1},[...t[0]||(t[0]=[k("TresSphereGeometry",{args:[1,40,40]},null,-1),k("TresMeshStandardMaterial",{color:15483002,roughness:.75,metalness:0,transparent:!0,opacity:.5,premultipliedAlpha:!0,emissive:15483002,emissiveIntensity:.5},null,-1)])],512),k("TresMesh",{geometry:S(Q),position:[-2,-2,2],scale:.005},[...t[1]||(t[1]=[k("TresMeshStandardMaterial",{color:"#023249",roughness:.2,metalness:0,envMapIntensity:.2},null,-1)])],8,Z)],64))}}),G=T({__name:"collectTriangles",setup(e){const t=X({clearColor:"#999999",antialias:!0}),a=X({autoRotate:!1}),r=A(null);return(e,i)=>{const l=F("TresCanvas");return z(),L(B,null,[Y(S(n)),Y(l,H(t,{"window-size":""}),{default:O(()=>[i[0]||(i[0]=k("TresPerspectiveCamera",{position:[5,1,15],fov:30,near:.1,far:1e3},null,-1)),Y(S(s),H({ref_key:"controlsRef",ref:r},a),null,16),i[1]||(i[1]=k("TresAmbientLight",{intensity:1},null,-1)),(z(),R(I,null,{default:O(()=>[Y(E,{controls:r.value},null,8,["controls"])]),_:1})),(z(),R(I,null,{default:O(()=>[Y(S(o),{background:!1,files:["pos-x.jpg","neg-x.jpg","pos-y.jpg","neg-y.jpg","pos-z.jpg","neg-z.jpg"],path:"https://opensource.cdn.icegl.cn/images/skyBox/6jpg/"},null,8,["path"])]),_:1}))]),_:1},16)],64)}}});export{G as default};
