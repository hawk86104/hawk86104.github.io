import"./index.T-vY6kZg1743660816268.js";import"./index.3Nqe-JjN1743660816268.js";import{P as e}from"./tweakpane.ivGeiIdz1743660816268.js";import{_ as r}from"./pagesShow.vue_vue_type_script_setup_true_lang.YKMl6SIC1743660816268.js";import{_ as o}from"./default.vue_vue_type_script_setup_true_lang.GPuSGd7F1743660816268.js";import{m as t,e as i}from"./@tresjs.zc7faK4J1743660816268.js";import"./index.wgv4wbeG1743660816268.js";import{u as a}from"./index.S3VunCT71743660816268.js";import{d as n,a7 as s,w as l,o as u,H as m,N as d,aj as f,ak as p,r as v,v as h,a2 as c,j,u as g,g as C,F as _,m as x}from"./@vue.B5PFBfKs1743660816268.js";import{ct as D,ab as b,V as w,C as y}from"./three.2wx8FU0g1743660816268.js";import"./utils.J8F9Jo-01743660816268.js";import"./@fesjs.9AUNBPBQ1743660816268.js";import"./vue-router.K4ys0Z-O1743660816268.js";import"./lodash-es.IJc9G_SW1743660816268.js";import"./@qlin.o0hjOMCg1743660816268.js";import"./pinia.0dYyFDku1743660816268.js";import"./@floating-ui.HzHndBae1743660816268.js";import"./@juggle.4EyLec-41743660816268.js";import"./three-mesh-ui.module._G62nyeC1743660816268.js";import"./SPE.Ft9s0v3Z1743660816268.js";import"./utils.G6Ajo17E1743660816268.js";import"./three-mesh-bvh.HGLjHqG91743660816268.js";import"./HeightCorrection.yXRAmIAz1743660816268.js";import"./three-custom-shader-material.uMc5A1EX1743660816268.js";import"./buildingsCustomShaderMaterial.hq-IAd4G1743660816268.js";import"./postprocessing.ApTwx-211743660816268.js";import"./@vueuse.jtbb8I7w1743660816268.js";import"./object-hash.6N1Uf8kA1743660816268.js";import"./@amap.c8pGcSIC1743660816268.js";import"./jszip.rGR265Ak1743660816268.js";const z={renderOrder:2200},N=["args"],P=n({__name:"depthBufferDiffuse",props:{radius:{default:100},shieldColor:{default:"#ffff00"},rimColor:{default:"#ffffff"},threshold:{default:.005}},setup(e){const r=e,{sizes:o,camera:n}=t(),v=o.aspectRatio.value,h=o.width.value,c=o.height.value,j=a({height:h*v,width:c*v,depth:!0,isLoop:!0}),g={blending:D,transparent:!0,depthWrite:!1,depthTest:!0,side:b,vertexShader:"\n\tvarying vec2 vUv;\n\tvarying vec3 vNormal;\n\tvarying vec3 vPosition;\n\tvoid main() {\n\t\tvUv = uv;\n\t\tvec4 worldPos = modelMatrix * vec4(position, 1.0);\n\t\tvec4 modelNormal = modelMatrix * vec4(normal, 0.0);\n\t\tvec4 mvPosition = viewMatrix * worldPos;\n\t\tgl_Position = projectionMatrix * mvPosition;\n\t\tvNormal = modelNormal.xyz;\n\t\tvPosition = worldPos.xyz;\n\t}\n  ",fragmentShader:"\nuniform sampler2D uDepthTexture; \nuniform vec2 uResolution;\nuniform float uNear;\nuniform float uFar;\nuniform float uThreshold;\nuniform vec3 uShieldColor;\nuniform vec3 uRimColor;\n\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vPosition;\n\n#include <packing>\n\nfloat LinearizeDepth(float depth) {\n\tfloat zNdc = 2.0 * depth - 1.0;\n\tfloat zEye = (2.0 * uFar * uNear) / ((uFar + uNear) - zNdc * (uFar - uNear));\n\tfloat linearDepth = (zEye - uNear) / (uFar - uNear);\n\treturn linearDepth;\n}\n\nvoid main() {\n\n  vec3 normal = normalize(vNormal);\n  if(gl_FrontFacing) {\n    normal *= -1.0;\n  }\n\n  vec3 viewDirection = normalize(cameraPosition - vPosition);\n  float fresnel = 1. + dot(normal, viewDirection);\n  fresnel = pow(fresnel, 4.0);\n\n  vec2 worldCoords = gl_FragCoord.xy/uResolution;\n\n  float sceneDepth = LinearizeDepth(texture2D(uDepthTexture, worldCoords).r);\n  float bubbleDepth = LinearizeDepth(gl_FragCoord.z);\n\n  float difference = abs( sceneDepth - bubbleDepth);\n  float normalizedDistance = clamp(difference / uThreshold, 0.0, 1.0);\n  vec4 intersection = mix(vec4(1.0), vec4(0.0), normalizedDistance) ;\n  intersection.rgb *= uRimColor;\n  vec4 color = vec4(uShieldColor, 0.3);\n  gl_FragColor = color + intersection + vec4(uRimColor, 1.0) * fresnel ;\n}\n  ",uniforms:{uDepthTexture:{value:s(j?.value?.depthTexture)},uResolution:{value:new w(h,c)},uNear:{value:1},uFar:{value:1e4},uThreshold:{value:.005},uShieldColor:{value:new y(r.shieldColor)},uRimColor:{value:new y(r.rimColor)}}},{onLoop:C}=i();return C((()=>{})),l((()=>[r.rimColor,r.shieldColor,r.threshold]),(([e,r,o])=>{g.uniforms.uRimColor.value.setStyle(e),g.uniforms.uShieldColor.value.setStyle(r),g.uniforms.uThreshold.value=o})),(e,o)=>(u(),m("TresMesh",z,[d("TresSphereGeometry",{args:[r.radius,64,64]},null,8,N),d("TresShaderMaterial",f(p(g)),null,16)]))}}),R=n({__name:"depthBufferDiffuse",setup(t){const i=v({shieldColor:"#ffff00",rimColor:"#ffffff",threshold:.005,radius:100}),a=new e;a.addBinding(i,"shieldColor",{label:"圈颜色"}),a.addBinding(i,"rimColor",{label:"条颜色"}),a.addBinding(i,"threshold",{label:"线条参数",min:1e-5,max:.01,step:1e-5}),a.addBinding(i,"radius",{label:"大小",min:10,max:200,step:1});const n=h(null);return c((()=>{n.value&&(n.value.$refs.tcRef?n.value.$refs.tcRef.context.camera.value.position.set(-135,250,320):n.value.$refs.perspectiveCameraRef&&n.value.$refs.perspectiveCameraRef.position.set(-135,250,320))})),(e,t)=>(u(),m(_,null,[j(g(o)),j(r,{ref_key:"pagesShowRef",ref:n},{ability:C((()=>[j(g(P),x({position:[0,30,0]},i),null,16)])),_:1},512)],64))}});export{R as default};
