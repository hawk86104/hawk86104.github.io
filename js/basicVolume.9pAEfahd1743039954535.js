import{m as n,e as t,o as e}from"./@tresjs.05J-Im0t1743039954535.js";import{_ as r,bt as o,ae as a}from"./three.XuMWWlrU1743039954535.js";import{P as i}from"./tweakpane.ivGeiIdz1743039954535.js";import{d as c,b as l,r as u,w as s,q as p,o as m,H as f,N as v,u as _,e as g,z as d,j as x,g as h,aj as y,ak as b,f as w,al as S,m as z,F as j}from"./@vue.C4dqouNn1743039954535.js";import{_ as I}from"./@fesjs.q_HvOfeM1743039954535.js";import"./postprocessing.YRVqsIkW1743039954535.js";import"./@vueuse.NzAeD-Dt1743039954535.js";import"./vue-router.F5lDLjOj1743039954535.js";import"./lodash-es.p1wj6C0b1743039954535.js";import"./@qlin.o0hjOMCg1743039954535.js";import"./pinia.MiZyWHUj1743039954535.js";import"./@floating-ui.HzHndBae1743039954535.js";import"./@juggle.4EyLec-41743039954535.js";const V=T;!function(n,t){const e=T,r=O();for(;;)try{if(779889===parseInt(e(368))/1+parseInt(e(377))/2*(-parseInt(e(375))/3)+-parseInt(e(398))/4+-parseInt(e(385))/5+-parseInt(e(361))/6*(parseInt(e(408))/7)+-parseInt(e(364))/8*(parseInt(e(387))/9)+parseInt(e(412))/10)break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const D=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[T(392)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();!function(){D(this,(function(){const n=T,t=new RegExp(n(420)),e=new RegExp("\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","i"),r=R("init");t[n(394)](r+n(396))&&e[n(394)](r+n(358))?R():r("0")}))()}();const k=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[T(392)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();k(void 0,(function(){const n=T,t=function(){const n=T;let t;try{t=Function(n(415)+'{}.constructor("return this")( ));')()}catch(e){t=window}return t}(),e=t.console=t.console||{},r=[n(403),n(359),n(405),n(390),n(365),n(411),n(366)];for(let o=0;o<r.length;o++){const t=k[n(378)][n(404)][n(367)](k),a=r[o],i=e[a]||t;t[n(409)]=k[n(367)](k),t[n(416)]=i[n(416)][n(367)](i),e[a]=t}}))();const M=["rotation-x"],F=["uniforms",V(382),V(370)];function O(){const n=["LinearFilter","table","36247420DsBNxO","isoValue","TresMesh","return (function() ","toString","while (true) {}","meshRef","value","function *\\( *\\)","position","input","warn","magFilter","6RqyHYn","expanded","TresShaderMaterial","34304CYWYJV","exception","trace","bind","912658ibIZAv","catch","fragmentShader","format","u_isoValue","u_dt","Clock","12ANDEIj","getElapsedTime","699206RNEebD","constructor","arrayBuffer","Data3DTexture","TresSphereGeometry","vertexShader","Display Settings","u_volume","4250155xtWIZK","addFolder","2601gFjtsV","Cross Section Settings","addBinding","error","innerHeight","apply","Error fetching volume data:","test","Vector3","chain","needsUpdate","481044ClVeqz","minFilter","u_time","then","counter","log","prototype","info","length","string","1047025kmwKwy","__proto__"];return(O=function(){return n})()}function T(n,t){const e=O();return T=function(n,t){return e[n-=357]},T(n,t)}const C=41,P=c({__name:"basicVolumeRendering",setup(e){const c=V,g=window.innerWidth,d=window[c(391)],x=l(null),h=l(null),y=new(r[c(374)]);y.start();const b=(new i)[c(386)]({title:c(383)}),w=b.addFolder({title:c(388)}),S=new(r[c(395)])(.5,.5,.5);w[c(389)](S,"x",{label:"X",min:.02,max:.5,step:.02}),w[c(389)](S,"y",{label:"Y",min:.02,max:.5,step:.02}),w[c(389)](S,"z",{label:"Z",min:.02,max:.5,step:.02}),w[c(362)]=!0;const{camera:z}=n(),j=u({u_camera:{value:z[c(419)]?.[c(357)]},u_resolution:{value:new(r[c(395)])(g,d,1)},u_dt:{value:.004},u_time:{value:0},u_crossSectionSize:{value:S},u_color:{value:1},u_volume:{value:null},u_isoValue:{value:.2},u_alphaVal:{value:.2}}),I=b[c(386)]({title:"Algorithm Settings"});I.addBinding(j[c(373)],c(419),{label:"dt",min:4e-4,max:.016,step:2e-4}),I[c(389)](j.u_color,c(419),{label:"color",min:1,max:3,step:1}),I.addBinding(j.u_alphaVal,c(419),{label:"alphaVal",min:.01,max:1,step:.01}),I[c(389)](j[c(372)],c(419),{label:c(413),min:0,max:1,step:.04}),s(h,(n=>{const t=c;if(n){const e=new(r[t(380)])(n,C,C,C);e[t(371)]=o,e[t(399)]=r[t(410)],e[t(360)]=r[t(410)],e.wrapT=a,e[t(397)]=!0,j[t(384)][t(419)]=e}}));const{onLoop:D}=t();return D((()=>{const n=c;j[n(400)][n(419)]=y[n(376)]()})),p((()=>{(()=>{const n=c;fetch("/plugins/volumeRendering/image/nucleon_41x41x41_uint8.raw")[n(401)]((t=>t[n(379)]()))[n(401)]((t=>{const e=n,r=new Uint8Array(t),o=new Uint8Array(68921);for(let n=0;n<r[e(406)];n++)o[n]=r[n];h[e(419)]=o}))[n(369)]((t=>{const e=n;console.error(e(393),t)}))})()})),(n,t)=>{const e=c;return m(),f(e(414),{ref_key:e(418),ref:x,"rotation-x":Math.PI/-2},[t[0]||(t[0]=v(e(381),{args:[1,16,16]},null,-1)),v(e(363),{uniforms:j,vertexShader:_("precision mediump float;\n\nuniform vec3 u_camera;\nuniform vec3 u_resolution;\nuniform float u_time;\n\nvarying vec3 v_hitPos;\nvarying vec3 v_hitPosWorldSpace;\nvarying vec3 v_cameraObjectSpace;\n\nvoid main() {\n  vec3 pos = position;\n\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\n\n  v_hitPos = position.xyz;\n\n  v_hitPosWorldSpace = (modelMatrix * vec4(position, 1.0)).xyz;\n\n  v_cameraObjectSpace = (inverse(modelMatrix) * vec4(u_camera, 1.0)).xyz;\n}"),fragmentShader:_("precision mediump int;\nprecision mediump float;\n\nuniform vec3 u_camera;\nuniform vec3 u_resolution;\nuniform mediump sampler3D u_volume;\nuniform vec3 u_crossSectionSize;\nuniform float u_dt;\nuniform float u_time;\nuniform float u_color;\nuniform float u_isoValue;\nuniform float u_alphaVal;\n\nvec3 palette(in float t) {\n  vec3 a = vec3(0.5, 0.5, 0.5);\n  vec3 b = vec3(0.5, 0.5, 0.5);\n  vec3 c = vec3(1.0, 1.0, 1.0);\n  vec3 d = vec3(0.00, 0.33, 0.67);\n\n  return a + b * cos(6.28318 * (c * t + d));\n}\n\nvarying vec3 v_hitPos;\nvarying vec3 v_hitPosWorldSpace;\nvarying vec3 v_cameraObjectSpace;\n\nvec2 intersect_box(vec3 orig, vec3 dir) {\n\n  vec3 box_min = vec3(-u_crossSectionSize);\n  vec3 box_max = vec3(u_crossSectionSize);\n  vec3 inv_dir = 1.0 / dir;\n  vec3 tmin_tmp = (box_min - orig) * inv_dir;\n  vec3 tmax_tmp = (box_max - orig) * inv_dir;\n  vec3 tmin = min(tmin_tmp, tmax_tmp);\n  vec3 tmax = max(tmin_tmp, tmax_tmp);\n  float t0 = max(tmin.x, max(tmin.y, tmin.z));\n  float t1 = min(tmax.x, min(tmax.y, tmax.z));\n  return vec2(t0, t1);\n}\n\nvoid main() {\n  vec3 rayOrigin = vec3(0.0, 0.0, -3.0);\n  rayOrigin = v_cameraObjectSpace;\n\n  vec2 uv = 2.0 * gl_FragCoord.xy / u_resolution.xy - 1.0;\n  vec3 rayDir = normalize(vec3(uv, 1.0));\n  rayDir = normalize(v_hitPos - rayOrigin);\n\n  vec2 t_hit = intersect_box(rayOrigin, rayDir);\n  if (t_hit.x > t_hit.y) {\n    discard;\n  }\n\n  t_hit.x = max(t_hit.x, 0.0);\n\n  float dt = u_dt;\n\n  vec4 color = vec4(0.0);\n\n  vec3 p = rayOrigin + t_hit.x * rayDir + 0.5;\n  for (float t = t_hit.x; t < t_hit.y; t += dt) {\n\n    float textureVal = texture(u_volume, p).r;\n\n    vec4 val_color = vec4(0.0);\n    float val_color_alpha = textureVal * 0.1;\n\n    val_color_alpha = smoothstep(0.0, u_alphaVal, val_color_alpha);\n\n    vec3 red = vec3(1.0, 0.0, 0.0);\n    vec3 white = vec3(1.0);\n    if (abs(u_color - 1.0) <= 0.01) {\n      val_color = vec4(white, val_color_alpha);\n    } else if (abs(u_color - 2.0) <= 0.01) {\n      val_color = vec4(mix(red, white, val_color_alpha), val_color_alpha);\n    } else {\n      val_color = vec4(palette(textureVal), val_color_alpha);\n    }\n\n    color.rgb += (1.0 - color.a) * val_color.a * val_color.rgb;\n    color.a += (1.0 - color.a) * val_color.a;\n\n    if (textureVal > u_isoValue) {\n      float gxLess = texture(u_volume, vec3(p.x - rayDir.x * u_dt, p.y, p.z)).r;\n      float gxMore = texture(u_volume, vec3(p.x + rayDir.x * u_dt, p.y, p.z)).r;\n      float dgx = gxMore - gxLess;\n\n      float gyLess = texture(u_volume, vec3(p.x, p.y - rayDir.y * u_dt, p.z)).r;\n      float gyMore = texture(u_volume, vec3(p.x, p.y + rayDir.y * u_dt, p.z)).r;\n      float dgy = gyMore - gyLess;\n\n      float gzLess = texture(u_volume, vec3(p.x, p.y, p.z - rayDir.z * u_dt)).r;\n      float gzMore = texture(u_volume, vec3(p.x, p.y, p.z + rayDir.z * u_dt)).r;\n      float dgz = gzMore - gzLess;\n      vec3 n = normalize(vec3(dgx, dgy, dgz));\n\n      vec3 lightSource = vec3(1.0);\n      vec3 lightDir = normalize(lightSource);\n      float diffuseStrength = max(dot(n, lightDir), 0.0);\n\n      vec3 viewSource = normalize(rayOrigin);\n      vec3 reflectSource = normalize(reflect(-lightSource, n));\n      float specularStrength = max(0.0, dot(viewSource, reflectSource));\n      specularStrength = pow(specularStrength, 64.0);\n\n      color.rgb = diffuseStrength * val_color.rgb + specularStrength * val_color.rgb;\n      color.rgb *= val_color.rgb;\n      color.a = 0.95;\n      break;\n    }\n\n    if (color.a >= 0.95) {\n      break;\n    }\n\n    p += rayDir * dt;\n  }\n\n  gl_FragColor = color;\n}")},null,8,F)],8,M)}}});function R(n){function t(n){const e=T;if(typeof n===e(407))return function(n){}[e(378)](e(417))[e(392)](e(402));1!==(""+n/n)[e(406)]||n%20==0?function(){return!0}[e(378)]("debugger").call("action"):function(){return!1}[e(378)]("debugger").apply("stateObject"),t(++n)}try{if(n)return t;t(0)}catch(e){}}const A=E;!function(n,t){const e=E,r=L();for(;;)try{if(185210===-parseInt(e(480))/1*(-parseInt(e(456))/2)+-parseInt(e(469))/3*(-parseInt(e(485))/4)+parseInt(e(477))/5*(-parseInt(e(450))/6)+-parseInt(e(489))/7+parseInt(e(465))/8+-parseInt(e(468))/9*(parseInt(e(458))/10)+parseInt(e(455))/11*(parseInt(e(476))/12))break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const Z=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[E(460)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();function E(n,t){const e=L();return E=function(n,t){return e[n-=446]},E(n,t)}function L(){const n=["26XLOjWa","log","3521750MtFdIF","table","apply","basicVolume","_blank",'{}.constructor("return this")( )',"https://klacansky.com/open-scivis-datasets/skull/skull_256x256x256_uint8.raw","1565016IqZvez","chain","#201919","9mTwTVC","75BmjaDE","__proto__","TresCanvas","console","warn","call","init","60jkjzVa","2595GfZHXH","TresGridHelper","info","19889uylgfE","toString","length","counter","action","4992qaBVCq","gger","return (function() ","constructor","2401AFfZhg","prototype","bind","function *\\( *\\)"," https://klacansky.com/open-scivis-datasets/skull/skull_256x256x256_uint8.raw ","TresAmbientLight","TresPerspectiveCamera","2874eHoTzT","error","test","debu","stateObject","662079gVgVMD"];return(L=function(){return n})()}!function(){Z(this,(function(){const n=E,t=new RegExp(n(446)),e=new RegExp("\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","i"),r=B(n(475));t[n(452)](r+n(466))&&e.test(r+"input")?B():r("0")}))()}();const q=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[E(460)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();q(void 0,(function(){const n=E,t=function(){const n=E;let t;try{t=Function(n(487)+n(463)+");")()}catch(e){t=window}return t}(),e=t[n(472)]=t[n(472)]||{},r=[n(457),n(473),n(479),n(451),"exception",n(459),"trace"];for(let o=0;o<r[n(482)];o++){const t=q[n(488)][n(490)][n(491)](q),a=r[o],i=e[a]||t;t[n(470)]=q[n(491)](q),t[n(481)]=i[n(481)].bind(i),e[a]=t}}))();function B(n){function t(n){const e=E;if("string"==typeof n)return function(n){}.constructor("while (true) {}")[e(460)](e(483));1!==(""+n/n)[e(482)]||n%20==0?function(){return!0}[e(488)](e(453)+e(486))[e(474)](e(484)):function(){return!1}[e(488)](e(453)+e(486))[e(460)](e(454)),t(++n)}try{if(n)return t;t(0)}catch(e){}}const H=I(c({__name:A(461),setup(n){const t=u({windowSize:!0,alpha:!0,antialias:!0,autoClear:!1,disableRender:!0}),r=u({enableDamping:!0,enableZoom:!0,enablePan:!0,enableRotate:!0,makeDefault:!0});return(n,o)=>{const a=E,i=g(a(471));return m(),f(j,null,[o[3]||(o[3]=v("div",{class:a(479)},[v("a",{href:a(464),target:a(462)},a(447)),v("br"),d(" 请自行下载数据集, 复制到 /plugins/volumeRendering/image/skull_256x256x256_uint8.raw 并更改文件请求指向和 dim 大小 ")],-1)),x(i,z({clearColor:a(467)},t),{default:h((()=>[o[0]||(o[0]=v(a(449),{fov:75,near:.001,far:1e3,position:[-1,.4,-1],"look-at":[0,0,0],up:[0,1,0]},null,-1)),o[1]||(o[1]=v(a(448),{intensity:2},null,-1)),x(_(e),y(b(r)),null,16),(m(),w(S,null,{default:h((()=>[x(P,{position:[0,0,0]})])),_:1})),o[2]||(o[2]=v(a(478),{args:[50,50],position:[0,-5,0]},null,-1))])),_:1},16)],64)}}}),[["__scopeId","data-v-925b4c37"]]);export{H as default};
