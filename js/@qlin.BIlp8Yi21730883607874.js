var t=Object.defineProperty,e=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,a=(e,r,n)=>r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n,i=(t,e)=>{for(var r in e||(e={}))o.call(e,r)&&a(t,r,e[r]);if(n)for(var r of n(e))c.call(e,r)&&a(t,r,e[r]);return t};class s{constructor(){this.middlewares=[]}use(t){return this.middlewares.push(t),this}compose(){return(t,e)=>{let r=-1;const n=o=>{if(o<=r)return Promise.reject(new Error("next() called multiple times"));r=o;let c=this.middlewares[o];if(r===this.middlewares.length&&(c=e),!c)return Promise.resolve();try{return Promise.resolve(c(t,n.bind(null,o+1)))}catch(a){return Promise.reject(a)}};return n(0)}}}const u=async(t,e)=>{t.config.method?t.config.method=t.config.method.toUpperCase():t.config.method="POST",await e()};const f="object"==typeof global&&global&&global.Object===Object&&global;var l="object"==typeof self&&self&&self.Object===Object&&self;const p=f||l||Function("return this")();const y=p.Symbol;var h=Object.prototype,b=h.hasOwnProperty,d=h.toString,g=y?y.toStringTag:void 0;var v=Object.prototype.toString;var j="[object Null]",m="[object Undefined]",_=y?y.toStringTag:void 0;function w(t){return null==t?void 0===t?m:j:_&&_ in Object(t)?function(t){var e=b.call(t,g),r=t[g];try{t[g]=void 0;var n=!0}catch(c){}var o=d.call(t);return n&&(e?t[g]=r:delete t[g]),o}(t):function(t){return v.call(t)}(t)}function O(t){return null!=t&&"object"==typeof t}var A="[object Symbol]";function S(t){return"symbol"==typeof t||O(t)&&w(t)==A}function T(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}const P=Array.isArray;var x=1/0,k=y?y.prototype:void 0,E=k?k.toString:void 0;function I(t){if("string"==typeof t)return t;if(P(t))return T(t,I)+"";if(S(t))return E?E.call(t):"";var e=t+"";return"0"==e&&1/t==-x?"-0":e}function q(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var U="[object AsyncFunction]",z="[object Function]",D="[object GeneratorFunction]",C="[object Proxy]";function M(t){if(!q(t))return!1;var e=w(t);return e==z||e==D||e==U||e==C}const F=p["__core-js_shared__"];var R,B=(R=/[^.]+$/.exec(F&&F.keys&&F.keys.IE_PROTO||""))?"Symbol(src)_1."+R:"";var H=Function.prototype.toString;function $(t){if(null!=t){try{return H.call(t)}catch(e){}try{return t+""}catch(e){}}return""}var L=/^\[object .+?Constructor\]$/,N=Function.prototype,V=Object.prototype,W=N.toString,J=V.hasOwnProperty,G=RegExp("^"+W.call(J).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Q(t){return!(!q(t)||function(t){return!!B&&B in t}(t))&&(M(t)?G:L).test($(t))}function K(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return Q(r)?r:void 0}const X=K(p,"WeakMap");var Y=Date.now;function Z(t){return function(){return t}}var tt=function(){try{var t=K(Object,"defineProperty");return t({},"",{}),t}catch(e){}}();const et=tt;var rt=et?function(t,e){return et(t,"toString",{configurable:!0,enumerable:!1,value:Z(e),writable:!0})}:function(t){return t};var nt=function(t){var e=0,r=0;return function(){var n=Y(),o=16-(n-r);if(r=n,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(rt);const ot=nt;var ct=9007199254740991,at=/^(?:0|[1-9]\d*)$/;function it(t,e){var r=typeof t;return!!(e=null!=e?e:ct)&&("number"==r||"symbol"!=r&&at.test(t))&&t>-1&&t%1==0&&t<e}function st(t,e,r){"__proto__"==e&&et?et(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}function ut(t,e){return t===e||t!=t&&e!=e}var ft=Object.prototype.hasOwnProperty;function lt(t,e,r){var n=t[e];(!ft.call(t,e)||!ut(n,r)||void 0===r&&!(e in t))&&st(t,e,r)}var pt=Math.max;var yt=9007199254740991;function ht(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=yt}var bt=Object.prototype;function dt(t){return O(t)&&"[object Arguments]"==w(t)}var gt=Object.prototype,vt=gt.hasOwnProperty,jt=gt.propertyIsEnumerable,mt=dt(function(){return arguments}())?dt:function(t){return O(t)&&vt.call(t,"callee")&&!jt.call(t,"callee")};const _t=mt;var wt="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ot=wt&&"object"==typeof module&&module&&!module.nodeType&&module,At=Ot&&Ot.exports===wt?p.Buffer:void 0;const St=(At?At.isBuffer:void 0)||function(){return!1};var Tt={};function Pt(t){return function(e){return t(e)}}Tt["[object Float32Array]"]=Tt["[object Float64Array]"]=Tt["[object Int8Array]"]=Tt["[object Int16Array]"]=Tt["[object Int32Array]"]=Tt["[object Uint8Array]"]=Tt["[object Uint8ClampedArray]"]=Tt["[object Uint16Array]"]=Tt["[object Uint32Array]"]=!0,Tt["[object Arguments]"]=Tt["[object Array]"]=Tt["[object ArrayBuffer]"]=Tt["[object Boolean]"]=Tt["[object DataView]"]=Tt["[object Date]"]=Tt["[object Error]"]=Tt["[object Function]"]=Tt["[object Map]"]=Tt["[object Number]"]=Tt["[object Object]"]=Tt["[object RegExp]"]=Tt["[object Set]"]=Tt["[object String]"]=Tt["[object WeakMap]"]=!1;var xt="object"==typeof exports&&exports&&!exports.nodeType&&exports,kt=xt&&"object"==typeof module&&module&&!module.nodeType&&module,Et=kt&&kt.exports===xt&&f.process;const It=function(){try{return kt&&kt.require&&kt.require("util").types||Et&&Et.binding&&Et.binding("util")}catch(t){}}();var qt=It&&It.isTypedArray,Ut=qt?Pt(qt):function(t){return O(t)&&ht(t.length)&&!!Tt[w(t)]};const zt=Ut;function Dt(t,e){var r=P(t),n=!r&&_t(t),o=!r&&!n&&St(t),c=!r&&!n&&!o&&zt(t),a=r||n||o||c,i=a?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],s=i.length;for(var u in t)(!a||!("length"==u||o&&("offset"==u||"parent"==u)||c&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||it(u,s)))&&i.push(u);return i}var Ct=Object.prototype.hasOwnProperty;function Mt(t){if(!q(t))return function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}(t);var e=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||bt)}(t),r=[];for(var n in t)"constructor"==n&&(e||!Ct.call(t,n))||r.push(n);return r}function Ft(t){return function(t){return null!=t&&ht(t.length)&&!M(t)}(t)?Dt(t):Mt(t)}var Rt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Bt=/^\w*$/;const Ht=K(Object,"create");var $t=Object.prototype.hasOwnProperty;var Lt=Object.prototype.hasOwnProperty;function Nt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Vt(t,e){for(var r=t.length;r--;)if(ut(t[r][0],e))return r;return-1}Nt.prototype.clear=function(){this.__data__=Ht?Ht(null):{},this.size=0},Nt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Nt.prototype.get=function(t){var e=this.__data__;if(Ht){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return $t.call(e,t)?e[t]:void 0},Nt.prototype.has=function(t){var e=this.__data__;return Ht?void 0!==e[t]:Lt.call(e,t)},Nt.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Ht&&void 0===e?"__lodash_hash_undefined__":e,this};var Wt=Array.prototype.splice;function Jt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Jt.prototype.clear=function(){this.__data__=[],this.size=0},Jt.prototype.delete=function(t){var e=this.__data__,r=Vt(e,t);return!(r<0)&&(r==e.length-1?e.pop():Wt.call(e,r,1),--this.size,!0)},Jt.prototype.get=function(t){var e=this.__data__,r=Vt(e,t);return r<0?void 0:e[r][1]},Jt.prototype.has=function(t){return Vt(this.__data__,t)>-1},Jt.prototype.set=function(t,e){var r=this.__data__,n=Vt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};const Gt=K(p,"Map");function Qt(t,e){var r=t.__data__;return function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}(e)?r["string"==typeof e?"string":"hash"]:r.map}function Kt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Kt.prototype.clear=function(){this.size=0,this.__data__={hash:new Nt,map:new(Gt||Jt),string:new Nt}},Kt.prototype.delete=function(t){var e=Qt(this,t).delete(t);return this.size-=e?1:0,e},Kt.prototype.get=function(t){return Qt(this,t).get(t)},Kt.prototype.has=function(t){return Qt(this,t).has(t)},Kt.prototype.set=function(t,e){var r=Qt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};var Xt="Expected a function";function Yt(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(Xt);var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],c=r.cache;if(c.has(o))return c.get(o);var a=t.apply(this,n);return r.cache=c.set(o,a)||c,a};return r.cache=new(Yt.Cache||Kt),r}Yt.Cache=Kt;var Zt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,te=/\\(\\)?/g,ee=function(t){var e=Yt(t,(function(t){return 500===r.size&&r.clear(),t})),r=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Zt,(function(t,r,n,o){e.push(n?o.replace(te,"$1"):r||t)})),e}));const re=ee;function ne(t,e){return P(t)?t:function(t,e){if(P(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!S(t))||Bt.test(t)||!Rt.test(t)||null!=e&&t in Object(e)}(t,e)?[t]:re(function(t){return null==t?"":I(t)}(t))}var oe=1/0;function ce(t){if("string"==typeof t||S(t))return t;var e=t+"";return"0"==e&&1/t==-oe?"-0":e}function ae(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}var ie=y?y.isConcatSpreadable:void 0;function se(t){return P(t)||_t(t)||!!(ie&&t&&t[ie])}function ue(t){return(null==t?0:t.length)?function(t,e,r,n,o){var c=-1,a=t.length;for(r||(r=se),o||(o=[]);++c<a;){var i=t[c];r(i)?ae(o,i):o[o.length]=i}return o}(t):[]}var fe=function(t,e){return function(r){return t(e(r))}}(Object.getPrototypeOf,Object);const le=fe;var pe="[object Object]",ye=Function.prototype,he=Object.prototype,be=ye.toString,de=he.hasOwnProperty,ge=be.call(Object);function ve(t){if(!O(t)||w(t)!=pe)return!1;var e=le(t);if(null===e)return!0;var r=de.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&be.call(r)==ge}function je(t){var e=this.__data__=new Jt(t);this.size=e.size}je.prototype.clear=function(){this.__data__=new Jt,this.size=0},je.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},je.prototype.get=function(t){return this.__data__.get(t)},je.prototype.has=function(t){return this.__data__.has(t)},je.prototype.set=function(t,e){var r=this.__data__;if(r instanceof Jt){var n=r.__data__;if(!Gt||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new Kt(n)}return r.set(t,e),this.size=r.size,this};var me="object"==typeof exports&&exports&&!exports.nodeType&&exports,_e=me&&"object"==typeof module&&module&&!module.nodeType&&module,we=_e&&_e.exports===me?p.Buffer:void 0;function Oe(){return[]}we&&we.allocUnsafe;var Ae=Object.prototype.propertyIsEnumerable,Se=Object.getOwnPropertySymbols,Te=Se?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,c=[];++r<n;){var a=t[r];e(a,r,t)&&(c[o++]=a)}return c}(Se(t),(function(e){return Ae.call(t,e)})))}:Oe;const Pe=Te;var xe=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)ae(e,Pe(t)),t=le(t);return e}:Oe;const ke=xe;function Ee(t){return function(t,e,r){var n=e(t);return P(t)?n:ae(n,r(t))}(t,Ft,ke)}const Ie=K(p,"DataView");const qe=K(p,"Promise");const Ue=K(p,"Set");var ze="[object Map]",De="[object Promise]",Ce="[object Set]",Me="[object WeakMap]",Fe="[object DataView]",Re=$(Ie),Be=$(Gt),He=$(qe),$e=$(Ue),Le=$(X),Ne=w;(Ie&&Ne(new Ie(new ArrayBuffer(1)))!=Fe||Gt&&Ne(new Gt)!=ze||qe&&Ne(qe.resolve())!=De||Ue&&Ne(new Ue)!=Ce||X&&Ne(new X)!=Me)&&(Ne=function(t){var e=w(t),r="[object Object]"==e?t.constructor:void 0,n=r?$(r):"";if(n)switch(n){case Re:return Fe;case Be:return ze;case He:return De;case $e:return Ce;case Le:return Me}return e});const Ve=Ne;var We=Object.prototype.hasOwnProperty;const Je=p.Uint8Array;function Ge(t){var e=new t.constructor(t.byteLength);return new Je(e).set(new Je(t)),e}var Qe=/\w*$/;var Ke=y?y.prototype:void 0,Xe=Ke?Ke.valueOf:void 0;var Ye="[object Boolean]",Ze="[object Date]",tr="[object Map]",er="[object Number]",rr="[object RegExp]",nr="[object Set]",or="[object String]",cr="[object Symbol]",ar="[object ArrayBuffer]",ir="[object DataView]",sr="[object Float32Array]",ur="[object Float64Array]",fr="[object Int8Array]",lr="[object Int16Array]",pr="[object Int32Array]",yr="[object Uint8Array]",hr="[object Uint8ClampedArray]",br="[object Uint16Array]",dr="[object Uint32Array]";function gr(t,e,r){var n=t.constructor;switch(e){case ar:return Ge(t);case Ye:case Ze:return new n(+t);case ir:return function(t,e){var r=Ge(t.buffer);return new t.constructor(r,t.byteOffset,t.byteLength)}(t);case sr:case ur:case fr:case lr:case pr:case yr:case hr:case br:case dr:return function(t,e){var r=Ge(t.buffer);return new t.constructor(r,t.byteOffset,t.length)}(t);case tr:return new n;case er:case or:return new n(t);case rr:return function(t){var e=new t.constructor(t.source,Qe.exec(t));return e.lastIndex=t.lastIndex,e}(t);case nr:return new n;case cr:return function(t){return Xe?Object(Xe.call(t)):{}}(t)}}var vr=It&&It.isMap,jr=vr?Pt(vr):function(t){return O(t)&&"[object Map]"==Ve(t)};const mr=jr;var _r=It&&It.isSet,wr=_r?Pt(_r):function(t){return O(t)&&"[object Set]"==Ve(t)};const Or=wr;var Ar="[object Arguments]",Sr="[object Function]",Tr="[object Object]",Pr={};function xr(t,e,r,n,o,c){var a;if(r&&(a=o?r(t,n,o,c):r(t)),void 0!==a)return a;if(!q(t))return t;var i=P(t);if(i)a=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&We.call(t,"index")&&(r.index=t.index,r.input=t.input),r}(t);else{var s=Ve(t),u=s==Sr||"[object GeneratorFunction]"==s;if(St(t))return function(t,e){return t.slice()}(t);if(s==Tr||s==Ar||u&&!o)a={};else{if(!Pr[s])return o?t:{};a=gr(t,s)}}c||(c=new je);var f=c.get(t);if(f)return f;c.set(t,a),Or(t)?t.forEach((function(n){a.add(xr(n,e,r,n,t,c))})):mr(t)&&t.forEach((function(n,o){a.set(o,xr(n,e,r,o,t,c))}));var l=i?void 0:Ee(t);return function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););}(l||t,(function(n,o){l&&(n=t[o=n]),lt(a,o,xr(n,e,r,o,t,c))})),a}Pr[Ar]=Pr["[object Array]"]=Pr["[object ArrayBuffer]"]=Pr["[object DataView]"]=Pr["[object Boolean]"]=Pr["[object Date]"]=Pr["[object Float32Array]"]=Pr["[object Float64Array]"]=Pr["[object Int8Array]"]=Pr["[object Int16Array]"]=Pr["[object Int32Array]"]=Pr["[object Map]"]=Pr["[object Number]"]=Pr[Tr]=Pr["[object RegExp]"]=Pr["[object Set]"]=Pr["[object String]"]=Pr["[object Symbol]"]=Pr["[object Uint8Array]"]=Pr["[object Uint8ClampedArray]"]=Pr["[object Uint16Array]"]=Pr["[object Uint32Array]"]=!0,Pr["[object Error]"]=Pr[Sr]=Pr["[object WeakMap]"]=!1;var kr="[object String]";function Er(t,e){return e.length<2?t:function(t,e){for(var r=0,n=(e=ne(e,t)).length;null!=t&&r<n;)t=t[ce(e[r++])];return r&&r==n?t:void 0}(t,function(t,e,r){var n=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(r=r>o?o:r)<0&&(r+=o),o=e>r?0:r-e>>>0,e>>>=0;for(var c=Array(o);++n<o;)c[n]=t[n+e];return c}(e,0,-1))}function Ir(t,e){return null==(t=Er(t,e=ne(e,t)))||delete t[ce(function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0}(e))]}function qr(t){return ve(t)?void 0:t}var Ur=function(t){return ot(function(t,e,r){return e=pt(void 0===e?t.length-1:e,0),function(){for(var n=arguments,o=-1,c=pt(n.length-e,0),a=Array(c);++o<c;)a[o]=n[e+o];o=-1;for(var i=Array(e+1);++o<e;)i[o]=n[o];return i[e]=r(a),function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}(t,this,i)}}(t,void 0,ue),t+"")}((function(t,e){var r={};if(null==t)return r;var n=!1;e=T(e,(function(e){return e=ne(e,t),n||(n=e.length>1),e})),function(t,e,r,n){var o=!r;r||(r={});for(var c=-1,a=e.length;++c<a;){var i=e[c],s=void 0;void 0===s&&(s=t[i]),o?st(r,i,s):lt(r,i,s)}}(t,Ee(t),r),n&&(r=xr(r,7,qr));for(var o=e.length;o--;)Ir(r,e[o]);return r}));const zr=Ur;function Dr(t){return"[object URLSearchParams]"===Object.prototype.toString.call(t)}function Cr(t){return{GET:{request_body:!1},POST:{request_body:!0},PUT:{request_body:!0},DELETE:{request_body:!0},HEAD:{request_body:!1},OPTIONS:{request_body:!1},PATCH:{request_body:!0}}[t=t.toUpperCase()].request_body}function Mr(t){ve(t)&&Object.entries(t).forEach((([e,r])=>{"string"==typeof r?t[e]=r.trim():ve(r)&&Mr(r)}))}const Fr=async(t,e)=>{Cr(t.config.method)&&Mr(t.config.params),await e()};const Rr=async(t,e)=>{t.reqHeaders=new Headers(t.config.headers),t.reqHeaders.has("Content-Type")||(t.config.params instanceof FormData?function(t){for(const[e,r]of t.entries())if(r instanceof Blob)return!0;return!1}(t.config.params)||t.reqHeaders.set("Content-Type","multipart/form-data"):ve(t.config.params)&&t.reqHeaders.set("Content-Type","application/json")),await e()};const Br=async(t,e)=>{t.config.baseURL&&!function(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}(t.config.url)&&(t.config.url=function(t,e){return e?"".concat(t.replace(/\/+$/,""),"/").concat(e.replace(/^\/+/,"")):t}(t.config.baseURL,t.config.url)),await e()},Hr=t=>Dr(t)?t.toString():"string"==typeof t?t:ve(t)?JSON.stringify(t):"";async function $r(t,e){if(t.config.params){const e=Hr(t.config.params);e&&(t.key="".concat(t.config.url).concat(e).concat(t.config.method))}else t.key="".concat(t.config.url).concat(t.config.method);await e()}const Lr=()=>{const t=new Map,e=new Map,r=new Map;return async(n,o)=>{if(n.key)if(n.config.mergeRequest){const t=await function(t){if(e.get(t.key))return new Promise((e=>{const n=r.get(t.key)||[];r.set(t.key,n.concat(e))}));e.set(t.key,!0)}(n);if(t)return void Object.keys(t).forEach((e=>{n[e]=t[e]}))}else{if(t.get(n.key)&&!n.config.mergeRequest)return void(n.error={type:"REPEAT",msg:"重复请求"});t.set(n.key,!0)}await o(),n.key&&(n.config.mergeRequest?function(t){const n=r.get(t.key);n&&n.length>0&&n.forEach((e=>{t.error?e({error:t.error}):e({response:t.response})})),r.delete(t.key),e.delete(t.key)}(n):t.delete(n.key))}},Nr="__REQUEST_CACHE:",Vr={ram:"ram",session:"sessionStorage",local:"localStorage"},Wr=18e4;function Jr(t,e="ram"){return e!==Vr.ram?"".concat(Nr).concat(t):t}function Gr(t){return ve(t)||function(t){return"string"==typeof t||!P(t)&&O(t)&&w(t)==kr}(t)||Array.isArray(t)||Dr(t)}function Qr({expire:t,cacheTime:e}){return!(!e||t>=Date.now())}class Kr{constructor(){this.data=new Map}get(t){const e=this.data.get(t);return e&&Qr(e)?(this.data.delete(t),null):e?e.data:null}set(t,e){this.data.forEach(((t,e,r)=>{Qr(t)&&r.delete(e)})),this.data.size>1e3?console.warn("Request: raw cache is exceed 1000 item, please check cache size"):this.data.set(t,e)}delete(t){this.data.delete(t)}}const Xr=()=>{const t=new Kr;const e=new Map,r=new Map;return async(n,o)=>{if(function(t){return!(!(t.config.cacheData||t.config.cache&&"string"!=typeof t.config.cache)||!t.key&&(console.warn("request: ".concat(t.config.url," 请求参数无法序列化，无法缓存，请移除相关配置")),1))}(n)){const c=function(t){return"object"==typeof t.config.cacheData?t.config.cacheData:"object"==typeof t.config.cache?t.config.cache:{cacheType:"ram",cacheTime:Wr}}(n),a=function({key:e,cacheType:r="ram"}){const n=Jr(e,r);if(r===Vr.ram)return t.get(n);{const t=window[Vr[r]],e=t.getItem(n)||null;try{const r=JSON.parse(e);return r&&!Qr(r)?r.data:(t.removeItem(n),null)}catch(o){return t.removeItem(n),null}}}({key:n.key,cacheType:c.cacheType});if(a)return void(n.response=a);const s=await function(t,n){const o=Jr(t.key,n.cacheType);if(e.get(o))return new Promise((t=>{const e=r.get(o)||[];r.set(o,e.concat(t))}));e.set(o,!0)}(n,c);if(s)return void Object.keys(s).forEach((t=>{n[t]=s[t]}));await o(),Gr(n.response)||console.warn("request: ".concat(n.config.url," 响应数据无法序列化，无法缓存，请移除相关配置")),!n.error&&n.response&&Gr(n.response)?(function(t,n){const o=Jr(t.key,n.cacheType),c=r.get(o);c&&c.length>0&&c.forEach((e=>{e({response:t.response})})),r.delete(o),e.delete(o)}(n,c),function({key:e,cacheType:r="ram",data:n,cacheTime:o=Wr}){const c=Jr(e,r),a={cacheType:r,data:n,cacheTime:o,expire:Date.now()+o};if(r!==Vr.ram){const t=window[Vr[r]];try{t.setItem(c,JSON.stringify(a))}catch(i){for(const e in t)e.startsWith(Nr)&&Object.prototype.hasOwnProperty.call(t,e)&&t.removeItem(e)}}else t.set(c,a)}(i({key:n.key,data:n.response},c))):function(t,n){const o=Jr(t.key,n.cacheType),c=r.get(o);c&&c.length>0?(c.shift()(),r.set(o,c)):(r.delete(o),e.delete(o))}(n,c)}else await o()}},Yr=t=>new Promise(((e,r)=>{setTimeout((()=>{r({type:"TIMEOUT",msg:"请求超时"})}),t)})),Zr=t=>{if(Cr(t.config.method)){const e=t.config.params;if(ve(e)){if("application/x-www-form-urlencoded"===t.reqHeaders.get("Content-Type")){const t=new URLSearchParams;return Object.keys(e).forEach((r=>{t.set(r,e[r])})),t.toString()}if("multipart/form-data"===t.reqHeaders.get("Content-Type")){const t=new FormData;return Object.keys(e).forEach((r=>{t.append(r,e[r])})),t}return JSON.stringify(e)}return e}},tn=t=>{const e={};return t.forEach(((t,r)=>{e[r]=t})),e},en=t=>{return t.config.cache,fetch((t=>{if(!Cr(t.config.method)){let e;return Dr(t.config.params)&&(e=t.config.params.toString()),ve(t.config.params)&&(e=new URLSearchParams(t.config.params).toString()),e?"".concat(t.config.url,"?").concat(e):t.config.url}return t.config.url})(t),(n=i({},zr(t.config,["baseURL","timeout","requestInterceptor","responseInterceptor","transformData","errorHandler","responseType"])),o={headers:tn(t.reqHeaders),body:Zr(t)},e(n,r(o)))).then((async e=>{if("opaqueredirect"===e.type&&(location.href=e.url),e.ok){const r=e.headers.get("content-type");let n;n=/application\/json/i.test(r)||"json"===t.config.responseType?await e.json():/text|xml/.test(r)||"text"===t.config.responseType?await e.text():"arrayBuffer"===t.config.responseType?await e.arrayBuffer():"formData"===t.config.responseType?await e.formData():(t.config.responseType,await e.blob());let o={status:e.status,data:n,headers:tn(e.headers)};return"function"==typeof t.config.responseInterceptor&&(o=await t.config.responseInterceptor(o)),M(t.config.transformData)&&(o.data=await t.config.transformData(n,o)),o}return Promise.reject({response:{status:e.status,headers:tn(e.headers)}})}));var n,o};async function rn(t,e){await Promise.race([Yr(t.config.timeout),en(t)]).then((e=>{t.response=e})).catch((e=>{t.error=e})),await e()}function nn(t){let e=[];return"function"==typeof t?e=[t]:Array.isArray(t)&&(e=t),e}function on(t){const e=nn(t);return async(t,r)=>{let n=t;for(const o of e)n=await o(n,r);return n}}function cn(t){const e=nn(t);return async(t,r)=>{let n=t;for(const o of e)n=await o(n,r);return n}}function an(t){const e=i({timeout:1e4,credentials:"include"},t),r=(new s).use(u).use(Br).use(Rr).use(Fr).use($r).use(Xr()).use(Lr()).use(rn).compose(),n=on(e.requestInterceptor),o=cn(e.responseInterceptor);return async(t,c,a)=>{const s={config:i(i({url:t,params:c},e),a)};return null!=a&&a.requestInterceptor?s.config=await on(a.requestInterceptor)(s.config,n):e.requestInterceptor&&(s.config=await n(s.config)),null!=a&&a.responseInterceptor&&(s.config.responseInterceptor=t=>cn(a.responseInterceptor)(t,o)),r(s).then((async()=>{var t,e;return s.response?s.response:(s.error.config||(s.error.config=s.config),null==(e=(t=s.config).errorHandler)||e.call(t,s.error),Promise.reject(s.error))}))}}export{an as C};
