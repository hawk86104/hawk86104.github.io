import{_ as t}from"./index.g-rkYs481721048663624.js";import{a5 as e,n,k as r,x as o,be as i,A as a,j as c,V as l,C as s}from"./three.HEgnMaTu1721048663624.js";import{a as u,r as f,N as p,b as v,d}from"./@tresjs.Xiq_TH801721048663624.js";import{_ as m}from"./whiteFloorMesh.vue_vue_type_script_setup_true_lang.yyF0hivw1721048663624.js";import{_ as h}from"./skyBoxAmesh.vue_vue_type_script_setup_true_lang.Gt5gFBQs1721048663624.js";import{P as x}from"./tweakpane.yHWGBmom1721048663624.js";import{d as g,a3 as w,a2 as y,w as b,o as S,D as C,u as _,r as F,e as P,j as I,g as z,f as D,al as j,aj as k,ak as N,m as T,F as M,J as B}from"./@vue.ApkyOKE71721048663624.js";import"./default.vue_vue_type_script_setup_true_lang.XKtYvKWr1721048663624.js";import"./@fesjs.vljLn8mq1721048663624.js";import"./vue-router.v6lvLH0N1721048663624.js";import"./lodash-es.nFpJXAf-1721048663624.js";import"./@vueuse.2IVIyoVR1721048663624.js";import"./@qlin.yHhFDldE1721048663624.js";import"./pinia.gP9-G6bs1721048663624.js";import"./@floating-ui.BPbuo5Gx1721048663624.js";import"./@juggle.7yjBMqoW1721048663624.js";function E(t,e){var n=U();return(E=function(t,e){return n[t-=431]})(t,e)}var W=E;!function(t,e){for(var n=E,r=U();;)try{if(650911===parseInt(n(471))/1*(parseInt(n(482))/2)+-parseInt(n(451))/3*(-parseInt(n(431))/4)+-parseInt(n(476))/5+-parseInt(n(466))/6*(parseInt(n(436))/7)+-parseInt(n(472))/8+-parseInt(n(454))/9+parseInt(n(448))/10*(parseInt(n(459))/11))break;r.push(r.shift())}catch(o){r.push(r.shift())}}();var R=function(){var t=!0;return function(e,n){var r=t?function(){if(n){var t=n.apply(e,arguments);return n=null,t}}:function(){};return t=!1,r}}();!function(){R(this,(function(){var t=E,e=new RegExp("function *\\( *\\)"),n=new RegExp("\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","i"),r=H("init");e[t(452)](r+t(455))&&n[t(452)](r+t(450))?H():r("0")}))()}();var V=function(){var t=!0;return function(e,n){var r=t?function(){if(n){var t=n[E(464)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();V(void 0,(function(){var t,e=E;try{t=Function(e(460)+e(432)+");")()}catch(l){t=window}for(var n=t.console=t.console||{},r=[e(439),e(469),e(438),"error",e(433),e(462),e(449)],o=0;o<r[e(467)];o++){var i=V[e(463)][e(442)][e(475)](V),a=r[o],c=n[a]||i;i.__proto__=V.bind(V),i.toString=c[e(473)][e(475)](c),n[a]=i}}))();class A{constructor(t,n){var r=E;this[r(480)]=new(e[r(434)])({uniforms:{uTexture:{type:"t",value:null}},vertexShader:"\n                varying vec2 vUv;\n\n                void main() {\n                    vUv = uv;\n                    gl_Position = vec4(position.xy, 0.0, 1.0);    \n                }",fragmentShader:"\n                uniform sampler2D uTexture;\n\n                varying vec2 vUv;\n\n                void main() {\n                    "+(n||"gl_FragColor = texture2D(uTexture, vUv);")+r(445),depthTest:!1,depthWrite:!1}),this.mesh=new(e[r(478)])(new(e[r(461)])(2,2),this[r(480)]),this[r(456)]=new(e[r(444)])(45,window[r(458)]/window.innerHeight,1,1e3),this[r(446)]=t,this[r(477)]=new(e[r(437)]),this[r(477)].add(this[r(443)])}[W(440)](t,e){var n=W;this[n(446)].setRenderTarget(e),this[n(480)].uniforms.uTexture[n(457)]=t,this[n(446)][n(468)](this[n(477)],this[n(456)]),this[n(446)][n(474)](null)}}function H(t){function e(t){var n=E;if(typeof t===n(479))return function(t){}.constructor(n(470))[n(464)](n(453));1!==(""+t/t)[n(467)]||t%20==0?function(){return!0}[n(463)](n(481)+"gger")[n(465)](n(447)):function(){return!1}[n(463)](n(481)+n(441))[n(464)](n(435)),e(++t)}try{if(t)return e;e(0)}catch(n){}}function U(){var t=["9122400djIJMb","toString","setRenderTarget","bind","4770585cTUxsL","scene","Mesh","string","material","debu","38qVNnko","8xwBxhr",'{}.constructor("return this")( )',"exception","ShaderMaterial","stateObject","75663UBJzVz","Scene","info","log","blit","gger","prototype","mesh","PerspectiveCamera","  \n                }","renderer","action","2670NqjpjL","trace","input","1322526WMaWDr","test","counter","11578041mDoxrG","chain","camera","value","innerWidth","111177bFQUUA","return (function() ","PlaneGeometry","table","constructor","apply","call","138pSmaKH","length","render","warn","while (true) {}","36849yYqUna"];return(U=function(){return t})()}const O=Z;!function(t,e){const n=Z,r=q();for(;;)try{if(507164===-parseInt(n(414))/1+-parseInt(n(419))/2+parseInt(n(415))/3+-parseInt(n(429))/4+parseInt(n(462))/5+parseInt(n(474))/6*(-parseInt(n(430))/7)+parseInt(n(449))/8)break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const X=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[Z(441)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();!function(){X(this,(function(){const t=Z,e=new RegExp(t(445)),n=new RegExp(t(458),"i"),r=Y(t(420));e[t(411)](r+"chain")&&n.test(r+t(438))?Y():r("0")}))()}();const L=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[Z(441)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();function Z(t,e){const n=q();return(Z=function(t,e){return n[t-=410]})(t,e)}L(void 0,(function(){const t=Z;let e;try{e=Function(t(417)+t(424)+");")()}catch(o){e=window}const n=e[t(432)]=e[t(432)]||{},r=[t(463),t(454),t(473),"error",t(412),t(453),t(475)];for(let i=0;i<r[t(467)];i++){const e=L[t(426)].prototype[t(437)](L),o=r[i],a=n[o]||e;e.__proto__=L.bind(L),e[t(442)]=a.toString[t(437)](a),n[o]=e}}))();class J{constructor(t,i,a){const c=Z;this[c(457)]=t.clone(),this[c(448)]=i,this.renderer=a,this[c(477)]=new(e[c(450)]),this.scene[c(447)](this[c(457)]),this[c(413)]=new A(this[c(416)]),this[c(452)]=new(e[c(466)])(innerWidth,innerHeight,{type:n,depthBuffer:!1,stencilBuffer:!1}),this[c(470)]=new(e[c(466)])(innerWidth,innerHeight,{type:n,depthBuffer:!1,stencilBuffer:!1}),this.frontFaceRT=new(e[c(466)])(innerWidth,innerHeight,{type:e[c(439)]}),this[c(446)]=new r({uniforms:{uCameraFarInverse:{value:1/this.camera[c(459)]}},vertexShader:c(455),fragmentShader:c(431),depthTest:!0,depthWrite:!0,side:o}),this.material=new r({uniforms:{uScreenSize:{value:new(e[c(418)])(innerWidth,innerHeight)},uPrevDepth:{type:"t",value:this[c(452)].texture},uCameraFarInverse:{value:1/this[c(448)][c(459)]},uSample:{value:0}},vertexShader:"\n                varying vec3 vCameraSpacePos;\n                varying vec3 vWorldSpaceNormal;\n\n                void main() {\n                    vCameraSpacePos = (modelViewMatrix * vec4(position, 1.0)).xyz;\n                    vWorldSpaceNormal = normalize((modelMatrix * vec4(normal, 0.0)).xyz);\n\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);    \n                }",fragmentShader:c(471),depthTest:!1,depthWrite:!1,side:e[c(460)]}),this[c(457)][c(428)]((t=>{const n=c;t instanceof e[n(461)]&&(t.material=this[n(434)])}))}compute(t){const n=Z;this.renderer.setRenderTarget(this[n(452)]),this[n(416)][n(436)](),this[n(416)].setRenderTarget(this[n(470)]),this.renderer[n(436)](),this[n(457)][n(428)]((t=>{const r=n;t instanceof e[r(461)]&&(t[r(434)]=this.material)})),this[n(434)][n(435)][n(451)][n(410)]=1/this[n(448)].far;for(let e=0;e<t;e++){let t=e%2==0?this.ping:this[n(470)],r=e%2==0?this[n(470)]:this[n(452)];this[n(434)][n(435)].uPrevDepth.value=t[n(464)],this[n(434)].uniforms[n(456)][n(410)]=e,this[n(416)][n(443)]=!1,this[n(416)][n(421)](r),this[n(416)].render(this[n(477)],this.camera),this.renderer[n(443)]=!0,this[n(413)][n(433)](r[n(464)],t)}this[n(476)]=t%2==0?this[n(452)]:this[n(470)],this[n(457)].traverse((t=>{const r=n;t instanceof e[r(461)]&&(t[r(434)]=this[r(446)])})),this[n(416)][n(421)](this.frontFaceRT),this[n(416)].render(this.scene,this[n(448)])}[O(468)](){const t=O;return this.resultBuffer[t(464)]}getFrontFaceTexture(){return this[O(427)].texture}}function q(){const t=["gger","info","546CMVEUY","trace","resultBuffer","scene","value","test","exception","blitProgram","856098HcZJRg","2242710GgoWMg","renderer","return (function() ","Vector2","1620372PAHJFW","init","setRenderTarget","action","debu",'{}.constructor("return this")( )',"call","constructor","frontFaceRT","traverse","1571308JaJmuB","21469lLAKzS","\n                uniform float uCameraFarInverse;\n\n                varying vec3 vWorldSpaceNormal;\n                varying vec3 vCameraSpacePos;\n\n                void main() {\n                    float currentDepth = abs(vCameraSpacePos.z) * uCameraFarInverse;\n                    gl_FragColor = vec4(vWorldSpaceNormal, currentDepth);    \n                }","console","blit","material","uniforms","clear","bind","input","FloatType","while (true) {}","apply","toString","autoClear","stateObject","function *\\( *\\)","frontFaceMaterial","add","camera","9900280hnthSi","Scene","uCameraFarInverse","ping","table","warn","\n                varying vec3 vCameraSpacePos;\n                varying vec3 vWorldSpaceNormal;\n\n                void main() {\n                    vCameraSpacePos = (modelViewMatrix * vec4(position, 1.0)).xyz;\n                    vWorldSpaceNormal = normal;\n\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);    \n                }","uSample","mesh","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","far","DoubleSide","Mesh","4301335jNcncQ","log","texture","string","WebGLRenderTarget","length","getBackFaceTexture","counter","pong","\n                uniform sampler2D uPrevDepth;\n                uniform float uCameraFarInverse;\n                uniform float uSample;\n                uniform vec2  uScreenSize;\n\n                varying vec3 vWorldSpaceNormal;\n                varying vec3 vCameraSpacePos;\n\n                void main() {\n\n                    vec2 uv = gl_FragCoord.xy / uScreenSize;\n                    float prevRegisteredDepth = texture2D(uPrevDepth, uv).w;\n                    float currentDepth        = abs(vCameraSpacePos.z) * uCameraFarInverse;\n\n                    if(currentDepth <= prevRegisteredDepth) {\n                        discard;\n                    }\n\n                    gl_FragColor = vec4(vWorldSpaceNormal, currentDepth);    \n                }"];return(q=function(){return t})()}function Y(t){function e(t){const n=Z;if(typeof t===n(465))return function(t){}[n(426)](n(440))[n(441)](n(469));1!==(""+t/t).length||t%20==0?function(){return!0}.constructor(n(423)+n(472))[n(425)](n(422)):function(){return!1}.constructor(n(423)+n(472))[n(441)](n(444)),e(++t)}try{if(t)return e;e(0)}catch(n){}}function G(t,e){const n=et();return(G=function(t,e){return n[t-=500]})(t,e)}const $=G;!function(t,e){const n=G,r=et();for(;;)try{if(658565===-parseInt(n(526))/1+-parseInt(n(569))/2*(parseInt(n(568))/3)+parseInt(n(570))/4*(-parseInt(n(562))/5)+-parseInt(n(515))/6*(parseInt(n(554))/7)+-parseInt(n(575))/8+-parseInt(n(532))/9+parseInt(n(566))/10)break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const K=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[G(559)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();!function(){K(this,(function(){const t=G,e=new RegExp(t(518)),n=new RegExp(t(572),"i"),r=rt(t(506));e[t(556)](r+t(563))&&n[t(556)](r+"input")?rt():r("0")}))()}();const Q=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[G(559)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();Q(void 0,(function(){const t=G,e=function(){const t=G;let e;try{e=Function("return (function() "+t(523)+");")()}catch(n){e=window}return e}(),n=e[t(538)]=e[t(538)]||{},r=["log",t(529),t(550),t(531),t(579),"table","trace"];for(let o=0;o<r[t(565)];o++){const e=Q[t(524)][t(557)][t(548)](Q),i=r[o],a=n[i]||e;e[t(510)]=Q[t(548)](Q),e.toString=a[t(514)][t(548)](a),n[i]=e}}))();const tt=["object"];function et(){const t=["chain","Mesh","length","58982650yhBOGr","wrapS","1433745VAULKC","2tuSFtY","4nJyWro","extintionCol1Random","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","rgb(26, 166, 192)","material","8220088UqXkJY","LinearMipmapLinearFilter","setRenderTarget","extintionCol2Random","exception","ShaderMaterial","wrapT","innerWidth","call","uCameraPos","compute","debu","Color","init","extintionColor1","convertLinearToSRGB","counter","__proto__","uBackFaceBuffer","uExtintionFactor","FrontSide","toString","12ODfOzz","uExtinctionFX1","value","function *\\( *\\)","uniforms","modelName","magFilter","position",'{}.constructor("return this")( )',"constructor","Scene","1197738OLWvCf","string","extintionFactor","warn","action","error","10549026lHMeHl","gger","autoClear","#fff","modelPath","getObjectByName","console","ClampToEdgeWrapping","side","innerHeight","uExtintionColor1","uReflectionFactor","far","sub","clone","ssrtGlassMesh","bind","Vector4","info","exposure","reflectionFactor","extintionColor2","3564043rVaijA","uExposure","test","prototype","stateObject","apply","uExtintionColor2","uTime","1730620ebKtwF"];return(et=function(){return t})()}const nt=g({__name:$(547),props:{skyBoxTexture:{},modelPath:{},modelName:{},extintionFactor:{default:5},reflectionFactor:{default:1},exposure:{default:0},extintionColor1:{default:"rgb(192,123,25)"},extintionColor2:{default:$(573)},extintionCol1Random:{type:Boolean,default:!1},extintionCol2Random:{type:Boolean,default:!1}},async setup(t){const n=$;let r,o;const d=t,{map:m}=([r,o]=w((()=>p({map:d.skyBoxTexture}))),r=await r,o(),r);m[n(567)]=i,m[n(581)]=e[n(539)],m[n(521)]=e[n(576)],m.minFilter=a;const{camera:h,renderer:x,scene:g}=u(),F=new(e[n(580)])({uniforms:{uSkybox:{type:"t",value:m},uBackFaceBuffer:{type:"t",value:null},uFrontFaceBuffer:{type:"t",value:null},uCameraFarInverse:{value:1/h[n(517)][n(544)]},uScreenSizeInv:{value:new c(1/window[n(500)],1/window[n(541)])},uCameraPos:{value:new l(0,0,0)},uTime:{value:0},uExtintionColor1:{value:new s(n(535)).sub(new(e[n(505)])(d[n(507)])[n(508)]())},uExtintionColor2:{value:new s(n(535))[n(545)](new(e[n(505)])(d[n(553)]).convertLinearToSRGB())},uExtintionFactor:{value:d.extintionFactor},uExposure:{value:d[n(551)]},uReflectionFactor:{value:d[n(552)]},uExtinctionFX1:{value:new(e[n(549)])(d[n(571)]?1:0,d[n(578)]?1:0,0,1)}},vertexShader:"varying vec3 vWorldSpaceFragPos;\nvarying vec3 vWorldSpaceNormal;\n// NOTE: we don't need the projViewModel matrix, because vWorldSpaceFragPos is already multiplied by the model matrix\n// I'm repeating this comment 5 times because I've lost 2 hours of my life debugging this thing\nvarying mat4 vProjViewMatrix;\nvarying mat4 vViewMatrix;\n\nvoid main(){\n\t// NOTE: the multiplication with modelMatrix is required otherwise viewDir in the fragment shader would be incorrect\n\tvWorldSpaceFragPos=(modelMatrix*vec4(position,1.)).xyz;\n\tvWorldSpaceNormal=normalize((modelMatrix*vec4(normal,0.)).xyz);\n\t\n\tgl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);\n\tvProjViewMatrix=projectionMatrix*viewMatrix;\n\tvViewMatrix=viewMatrix;\n}",fragmentShader:"uniform sampler2D uSkybox;\nuniform sampler2D uBackFaceBuffer;\nuniform sampler2D uFrontFaceBuffer;\n\nuniform vec3 uExtintionColor1;\nuniform vec3 uExtintionColor2;\nuniform float uExtintionFactor;\nuniform float uExposure;\nuniform float uReflectionFactor;\nuniform vec4 uExtinctionFX1;\n\nuniform float uTime;\n\nuniform vec3 uCameraPos;\nuniform vec2 uScreenSizeInv;\nuniform float uCameraFarInverse;\n\nvarying vec3 vWorldSpaceFragPos;\nvarying vec3 vWorldSpaceNormal;\nvarying mat4 vProjViewMatrix;\nvarying mat4 vViewMatrix;\n\nconst float PI=3.14159265359;\nconst float e=2.7182818284590;\n\nconst float planeSize=3.;\nconst vec3 planeColor=pow(vec3(202./255.,205./255.,185./255.),vec3(3.));\n\nfloat mod289(float x){return x-floor(x*(1./289.))*289.;}\nvec4 mod289(vec4 x){return x-floor(x*(1./289.))*289.;}\nvec4 perm(vec4 x){return mod289(((x*34.)+1.)*x);}\n\nfloat noise(vec3 p){\n\tvec3 a=floor(p);\n\tvec3 d=p-a;\n\td=d*d*(3.-2.*d);\n\t\n\tvec4 b=a.xxyy+vec4(0.,1.,0.,1.);\n\tvec4 k1=perm(b.xyxy);\n\tvec4 k2=perm(k1.xyxy+b.zzww);\n\t\n\tvec4 c=k2+a.zzzz;\n\tvec4 k3=perm(c);\n\tvec4 k4=perm(c+1.);\n\t\n\tvec4 o1=fract(k3*(1./41.));\n\tvec4 o2=fract(k4*(1./41.));\n\t\n\tvec4 o3=o2*d.z+o1*(1.-d.z);\n\tvec2 o4=o3.yw*d.x+o3.xz*(1.-d.x);\n\t\n\treturn o4.y*d.y+o4.x*(1.-d.y);\n}\n\nvec3 acesFilm(const vec3 x){\n\tconst float a=2.51;\n\tconst float b=.03;\n\tconst float c=2.43;\n\tconst float d=.59;\n\tconst float e=.14;\n\treturn clamp((x*(a*x+b))/(x*(c*x+d)+e),0.,1.);\n}\n\n// gets the skybox color from a given view direction\nvec3 getSkyboxColor(vec3 viewDir){\n\t// skybox coordinates\n\tvec2 skyboxUV=vec2(\n\t\t(atan(viewDir.x,viewDir.z)+PI)/(PI*2.),\n\t\t(asin(viewDir.y)+PI*.5)/(PI)\n\t);\n\t\n\tvec3 col=texture2D(uSkybox,skyboxUV).xyz;\n\tcol=pow(col,vec3(2.2));\n\treturn col;\n}\n\nbool refract2(vec3 v,vec3 n,float ni_over_nt,inout vec3 refracted){\n\tvec3 uv=normalize(v);\n\tfloat dt=dot(uv,n);\n\tfloat discriminant=1.-ni_over_nt*ni_over_nt*(1.-dt*dt);\n\tif(discriminant>0.){\n\t\trefracted=ni_over_nt*(v-n*dt)-n*sqrt(discriminant);\n\t\treturn true;\n\t}\n\t\n\treturn false;\n}\n\nvec3 binarySearchHitPoint(vec3 lastP,vec3 hitP,vec3 rayDir){\n\t\n\tfor(int i=0;i<10;i++){\n\t\tvec3 midP=(lastP+hitP)*.5;\n\t\t\n\t\t// project midP in uv space\n\t\tvec4 projCoord=vProjViewMatrix*vec4(midP,1.);\n\t\tprojCoord.xyz/=projCoord.w;\n\t\t\n\t\tvec2 midpNDC=projCoord.xy;\n\t\tvec2 midpUV=midpNDC*.5+.5;\n\t\t\n\t\t// get depth at point\n\t\tvec4 backBuffer=texture2D(uBackFaceBuffer,midpUV);\n\t\tfloat depth=backBuffer.w;\n\t\t\n\t\tfloat midpDepth=abs((vViewMatrix*vec4(midP,1.)).z)*uCameraFarInverse;\n\t\tif(midpDepth>depth){\n\t\t\thitP=midP;\n\t\t}else{\n\t\t\tlastP=midP;\n\t\t}\n\t}\n\t\n\treturn hitP;\n}\n\nvec3 getRefractedColor(vec3 refractionDir,vec3 hitPoint,float refractionIndex){\n\t// move the hitpoint inside the mesh with epsilon\n\thitPoint+=refractionDir*.0001;\n\t\n\t// raymarch!\n\tfloat stepSize=.02;\n\tfloat stepMult=1.5;\n\t\n\tvec3 lastP=hitPoint;\n\tvec3 p=hitPoint;\n\tvec3 hitPNormal;\n\tfloat currStepSize=stepSize;\n\tfloat transmissionDistance=0.;\n\tfor(int i=0;i<20;i++){\n\t\tp+=currStepSize*refractionDir;\n\t\t\n\t\t// project p in uv space\n\t\tvec4 projCoord=vProjViewMatrix*vec4(p,1.);\n\t\tprojCoord.xyz/=projCoord.w;\n\t\t\n\t\tvec2 pNDC=projCoord.xy;\n\t\tvec2 pUV=pNDC*.5+.5;\n\t\t\n\t\t// get depth at point\n\t\tvec4 backBuffer=texture2D(uBackFaceBuffer,pUV);\n\t\tfloat depth=backBuffer.w;\n\t\tvec3 norm=backBuffer.xyz;\n\t\t\n\t\t// get p depth\n\t\tfloat pDepth=abs((vViewMatrix*vec4(p,1.)).z)*uCameraFarInverse;\n\t\t\n\t\tif(pDepth>depth){\n\t\t\t\n\t\t\tvec3 hitp=binarySearchHitPoint(lastP,p,refractionDir);\n\t\t\tp=hitp;\n\t\t\t\n\t\t\t// ************ get the hitpoint normal\n\t\t\tvec4 projCoord=vProjViewMatrix*vec4(p,1.);\n\t\t\tprojCoord.xyz/=projCoord.w;\n\t\t\t\n\t\t\tvec2 pNDC=projCoord.xy;\n\t\t\tvec2 pUV=pNDC*.5+.5;\n\t\t\t\n\t\t\t// get depth at point\n\t\t\thitPNormal=texture2D(uBackFaceBuffer,pUV).xyz;\n\t\t\t// ************ get the hitpoint normal - END\n\t\t\t\n\t\t\tbreak;\n\t\t}\n\t\t\n\t\tlastP=p;\n\t\tcurrStepSize*=stepMult;\n\t}\n\t\n\ttransmissionDistance=length(hitPoint-p);\n\t\n\t// ******************** recalc directions\n\tvec3 outward_normal;\n\tvec3 reflected=reflect(refractionDir,hitPNormal);\n\tfloat ni_over_nt;\n\tvec3 refr;\n\t// vec3 refracted;\n\tfloat reflect_prob;\n\tfloat cosine;\n\t\n\tif(dot(refractionDir,hitPNormal)>0.){\n\t\toutward_normal=-hitPNormal;\n\t\tni_over_nt=refractionIndex;\n\t\tcosine=refractionIndex*dot(refractionDir,hitPNormal);\n\t}else{\n\t\toutward_normal=hitPNormal;\n\t\tni_over_nt=1./refractionIndex;\n\t\tcosine=-dot(refractionDir,hitPNormal);\n\t}\n\t\n\t// if (refract2(refractionDir, outward_normal, ni_over_nt, refracted)) {\n\t\tif(refract2(refractionDir,outward_normal,ni_over_nt,refr)){\n\t\t\tfloat r0=(1.-refractionIndex)/(1.+refractionIndex);\n\t\t\tr0*=r0;\n\t\t\treflect_prob=r0+(1.-r0)*pow((1.-cosine),5.);\n\t\t}else{\n\t\t\treflect_prob=1.;\n\t\t}\n\t\t// ******************** recalc directions - END\n\t\t\n\t\t// ******************** get colors\n\t\tvec3 col;\n\t\tvec3 colrefl;\n\t\tvec3 colrefr;\n\t\t// if(refracted.y < 0.0) {\n\t\t\tif(refr.y<0.){\n\t\t\t\t// float t = p.y / abs(refracted.y);\n\t\t\t\t// vec3 planeHitP = p + refracted * t;\n\t\t\t\tfloat t=p.y/abs(refr.y);\n\t\t\t\tvec3 planeHitP=p+refr*t;\n\t\t\t\tif(abs(planeHitP.x)<planeSize&&abs(planeHitP.z)<planeSize){\n\t\t\t\t\tcolrefr=planeColor;\n\t\t\t\t}else{\n\t\t\t\t\t// colrefr = getSkyboxColor(refracted);\n\t\t\t\t\tcolrefr=getSkyboxColor(refr);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\t// colrefr = getSkyboxColor(refracted);\n\t\t\t\tcolrefr=getSkyboxColor(refr);\n\t\t\t}\n\t\t\t\n\t\t\tif(reflected.y<0.){\n\t\t\t\tfloat t=p.y/abs(reflected.y);\n\t\t\t\tvec3 planeHitP=p+reflected*t;\n\t\t\t\tif(abs(planeHitP.x)<planeSize&&abs(planeHitP.z)<planeSize){\n\t\t\t\t\tcolrefl=planeColor;\n\t\t\t\t}else{\n\t\t\t\t\tcolrefl=getSkyboxColor(reflected);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tcolrefl=getSkyboxColor(reflected);\n\t\t\t}\n\t\t\t\n\t\t\tcol=colrefl*(reflect_prob*uReflectionFactor)+colrefr*(1.-reflect_prob);\n\t\t\t// ******************** get colors\n\t\t\t\n\t\t\tvec3 transm=vec3(1.);\n\t\t\t// const int steps = 8;\n\t\t\tconst int steps=15;\n\t\t\tfloat step=transmissionDistance/float(steps);\n\t\t\tfloat fc=uExtintionFactor*.07;\n\t\t\t\n\t\t\t// raymarching transmission color\n\t\t\t\n\t\t\t// float noiseStrength = 0.8;\n\t\t\tfloat noiseSpeed=.5;\n\t\t\tfloat noiseTimeSpeed=.5;\n\t\t\t\n\t\t\tfor(int i=0;i<steps;i++){\n\t\t\t\tvec3 np=hitPoint+refractionDir*float(i)*step;\n\t\t\t\t\n\t\t\t\tvec3 nnp=np;\n\t\t\t\tvec3 w=normalize(np-vec3(.75,1.5,0.));\n\t\t\t\tvec3 u=vec3(0.,0.,1.);\n\t\t\t\t// vec3 timeOffset = uTime * normalize(np - vec3(0.75, 1.5, 0.0));\n\t\t\t\tvec3 timeOffset=cos(uTime)*w+sin(uTime)*u;\n\t\t\t\tfloat colorNoiseX=noise(np*noiseSpeed+timeOffset*noiseTimeSpeed);\n\t\t\t\tfloat colorNoiseY=noise(np*noiseSpeed+timeOffset*noiseTimeSpeed+vec3(15.3278,125.19879,0.));\n\t\t\t\tfloat colorNoiseZ=noise(np*noiseSpeed+timeOffset*noiseTimeSpeed+vec3(2.6008,78.19879,543.12993));\n\t\t\t\t\n\t\t\t\tfloat targ=length(nnp*.8*uExtinctionFX1.w-vec3(.75,1.5,0.));\n\t\t\t\tfloat targAperture=.25;\n\t\t\t\t\n\t\t\t\t// wave raymarch\n\t\t\t\tif(uExtinctionFX1.z>.5){\n\t\t\t\t\tnnp=np+sin(np.x*2.5+uTime*1.5)*.3;\n\t\t\t\t\ttarg=nnp.y-.85*uExtinctionFX1.w;\n\t\t\t\t}else{\n\t\t\t\t\tnnp=np+vec3(colorNoiseX,colorNoiseY,colorNoiseZ)*1.05;\n\t\t\t\t\tvec3 diff=nnp-vec3(3.3,4.5,0.);\n\t\t\t\t\tfloat angle=(atan(diff.x,diff.y)+PI)/(PI*2.);\n\t\t\t\t\ttarg=length(diff)+sin(angle*32.*PI+uTime*1.5)*.4;\n\t\t\t\t\ttarg*=.475;\n\t\t\t\t\ttargAperture=.5+colorNoiseX*.75;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// what's the color at np?\n\t\t\t\tvec3 col1=uExtintionColor1;\n\t\t\t\tvec3 col2=uExtintionColor2;\n\t\t\t\tif(uExtinctionFX1.x>.5){\n\t\t\t\t\tcol1=vec3(colorNoiseX,colorNoiseY,colorNoiseZ)*.85;\n\t\t\t\t}\n\t\t\t\tif(uExtinctionFX1.y>.5){\n\t\t\t\t\tcol2=vec3(colorNoiseX,colorNoiseY,colorNoiseZ)*.85;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(targ<1.){\n\t\t\t\t\t\n\t\t\t\t\ttransm*=exp(-step*col2*fc);\n\t\t\t\t\t\n\t\t\t\t}else if(targ>1.&&targ<1.+targAperture){\n\t\t\t\t\tfloat t=(targ-1.)/targAperture;\n\t\t\t\t\t\n\t\t\t\t\ttransm*=exp(-step*(col1*t+col2*(1.-t))*fc);\n\t\t\t\t\t\n\t\t\t\t}else if(targ<(1.+targAperture)*1.85){\n\t\t\t\t\ttransm*=exp(-step*col1*fc);\n\t\t\t\t\t\n\t\t\t\t}else{\n\t\t\t\t\t// transm = (col1) * targAperture;\n\t\t\t\t\t// transm *= exp(-step * col1 * uExtintionFactor);\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// return col * uExtintionColor2 * transm;\n\t\t\tcol*=transm;\n\t\t\t\n\t\t\treturn col;\n\t\t}\n\t\t\n\t\tvoid main(){\n\t\t\tvec2 screenUV=gl_FragCoord.xy*uScreenSizeInv;\n\t\t\t\n\t\t\tvec3 viewDir=normalize(vWorldSpaceFragPos-uCameraPos);\n\t\t\tvec3 normal=vWorldSpaceNormal;\n\t\t\tfloat refractionIndex=1.5;\n\t\t\t\n\t\t\tvec3 outward_normal;\n\t\t\tvec3 reflected=reflect(viewDir,normal);\n\t\t\tfloat ni_over_nt;\n\t\t\tvec3 refracted;\n\t\t\tfloat reflect_prob;\n\t\t\tfloat cosine;\n\t\t\t\n\t\t\tif(dot(viewDir,normal)>0.){\n\t\t\t\toutward_normal=-normal;\n\t\t\t\tni_over_nt=refractionIndex;\n\t\t\t\tcosine=refractionIndex*dot(viewDir,normal);\n\t\t\t}else{\n\t\t\t\toutward_normal=normal;\n\t\t\t\tni_over_nt=1./refractionIndex;\n\t\t\t\tcosine=-dot(viewDir,normal);\n\t\t\t}\n\t\t\t\n\t\t\tif(refract2(viewDir,outward_normal,ni_over_nt,refracted)){\n\t\t\t\tfloat r0=(1.-refractionIndex)/(1.+refractionIndex);\n\t\t\t\tr0*=r0;\n\t\t\t\treflect_prob=r0+(1.-r0)*pow((1.-cosine),5.);\n\t\t\t}else{\n\t\t\t\treflect_prob=1.;\n\t\t\t}\n\t\t\t\n\t\t\tvec3 reflectedCol;\n\t\t\tif(reflected.y<0.){\n\t\t\t\tfloat t=vWorldSpaceFragPos.y/abs(reflected.y);\n\t\t\t\tvec3 planeHitP=vWorldSpaceFragPos+reflected*t;\n\t\t\t\tif(abs(planeHitP.x)<planeSize&&abs(planeHitP.z)<planeSize){\n\t\t\t\t\treflectedCol=planeColor;\n\t\t\t\t}else{\n\t\t\t\t\treflectedCol=getSkyboxColor(reflected);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\treflectedCol=getSkyboxColor(reflected);\n\t\t\t}\n\t\t\t\n\t\t\tvec3 col=reflectedCol*reflect_prob*uReflectionFactor+getRefractedColor(refracted,vWorldSpaceFragPos,refractionIndex)*(1.-reflect_prob);\n\t\t\t// getRefractedColor(normalize(refracted + vec3(0.0, 0.0, 0.0)), vWorldSpaceFragPos) * (1.0 - reflect_prob) * 0.333 +\n\t\t\t// getRefractedColor(normalize(refracted + vec3(0.0, 0.15, 0.0)), vWorldSpaceFragPos) * (1.0 - reflect_prob) * 0.333 +\n\t\t\t// getRefractedColor(normalize(refracted + vec3(0.0, 0.35, 0.0)), vWorldSpaceFragPos) * (1.0 - reflect_prob) * 0.333;\n\t\t\t\n\t\t\t// col = getRefractedColor(refracted, vWorldSpaceFragPos) * (1.0 - reflect_prob);\n\t\t\t// vec3 col = getRefractedColor(refracted, vWorldSpaceFragPos);\n\t\t\t// col = getSkyboxColor(reflected) * reflect_prob * 1.0;\n\t\t\t\n\t\t\t// vec3 col = viewDir;\n\t\t\t// gl_FragColor = vec4(col, 1.0);\n\t\t\t// return;\n\t\t\t\n\t\t\tcol*=pow(2.,uExposure);\n\t\t\tcol=acesFilm(col);\n\t\t\tcol=pow(col,vec3(1./2.2));\n\t\t\t\n\t\t\tgl_FragColor=vec4(col,1.);\n\t\t\t// gl_FragColor = vec4(getSkyboxColor(viewDir), 1.0) * 0.5 + vec4(viewDir * 0.5 + 0.5, 1.0);\n\t\t}"}),{nodes:P}=([r,o]=w((()=>v(d[n(536)],{draco:!0,decoderPath:"./draco/"}))),r=await r,o(),r),I=P[n(525)][n(537)](d[n(520)]),z=new J(I,h[n(517)],x[n(517)]),D=null==I?void 0:I[n(546)]();null==D||D.traverse((t=>{const r=n;t instanceof e[r(564)]&&(t[r(574)]=F,t[r(574)][r(540)]=e[r(513)])}));const{onAfterLoop:j}=f();return j((({elapsed:t})=>{const e=n;I&&F&&(F.uniforms[e(502)][e(517)]=h[e(517)][e(522)][e(546)](),F[e(519)][e(561)].value=t,z[e(503)](6),F[e(519)][e(511)][e(517)]=z.getBackFaceTexture(),F.uniforms.uFrontFaceBuffer[e(517)]=z.getFrontFaceTexture(),x[e(517)][e(577)](null),x.value[e(534)]=!1)})),y((()=>{const t=n;d[t(528)]&&(F[t(519)][t(512)][t(517)]=d[t(528)]),d[t(552)]&&(F[t(519)][t(543)][t(517)]=d.reflectionFactor),d.exposure&&(F[t(519)][t(555)][t(517)]=d.exposure),d[t(507)]&&(F[t(519)][t(542)][t(517)]=new(e[t(505)])(t(535))[t(545)](new s(d.extintionColor1)[t(508)]())),d[t(553)]&&(F[t(519)][t(560)][t(517)]=new(e[t(505)])(t(535))[t(545)](new(e[t(505)])(d[t(553)])[t(508)]())),d[t(571)]&&(F[t(519)].uExposure[t(517)]=d[t(551)])})),b((()=>d[n(571)]),(t=>{const e=n;F[e(519)][e(516)].value.x=t?1:0}),{immediate:!0}),b((()=>d[n(578)]),(t=>{const e=n;F[e(519)][e(516)].value.y=t?1:0}),{immediate:!0}),(t,e)=>(S(),C("primitive",{object:_(D)},null,8,tt))}});function rt(t){function e(t){const n=G;if(typeof t===n(527))return function(t){}[n(524)]("while (true) {}")[n(559)](n(509));1!==(""+t/t).length||t%20==0?function(){return!0}[n(524)](n(504)+n(533))[n(501)](n(530)):function(){return!1}[n(524)](n(504)+n(533))[n(559)](n(558)),e(++t)}try{if(t)return e;e(0)}catch(n){}}const ot=ct;function it(){const t=["3518560oOsvMw","248sJxEWY","length","addBinding","TresPerspectiveCamera","https://opensource-1314935952.cos.ap-nanjing.myqcloud.com/images/skyBox/workshop_blur.jpg","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","extintionCol1Random","prototype","gger","chain","exposure","input","exception","#cbcb96","随机色2","reflectionFactor","161476PpqNnc","extintionFactor","796LvuWnn","TresAmbientLight","return (function() ","while (true) {}","消光系数","7780vBOWlr","消光颜色一","error","803SSAawR","反射系数","曝光系数","861420wQgvXp","counter","constructor","extintionColor2","apply","test","6789TpzvMC","__proto__","debu","stateObject","log","action","info","warn","table","891eFOCPv","bind","console","call","string","1000960KfJKuE","#b8b59e","init","ACESFilmicToneMapping","toString"];return(it=function(){return t})()}!function(t,e){const n=ct,r=it();for(;;)try{if(221392===parseInt(n(135))/1*(parseInt(n(127))/2)+parseInt(n(144))/3*(-parseInt(n(164))/4)+-parseInt(n(158))/5+-parseInt(n(138))/6+parseInt(n(125))/7+parseInt(n(163))/8+-parseInt(n(153))/9*(parseInt(n(132))/10))break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const at=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[ct(142)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();function ct(t,e){const n=it();return(ct=function(t,e){return n[t-=119]})(t,e)}!function(){at(this,(function(){const t=ct,e=new RegExp("function *\\( *\\)"),n=new RegExp(t(169),"i"),r=pt(t(160));e[t(143)](r+t(173))&&n[t(143)](r+t(120))?pt():r("0")}))()}();const lt=function(){let t=!0;return function(e,n){const r=t?function(){if(n){const t=n[ct(142)](e,arguments);return n=null,t}}:function(){};return t=!1,r}}();lt(void 0,(function(){const t=ct;let e;try{e=Function(t(129)+'{}.constructor("return this")( ));')()}catch(o){e=window}const n=e.console=e[t(155)]||{},r=[t(148),t(151),t(150),t(134),t(121),t(152),"trace"];for(let i=0;i<r[t(165)];i++){const e=lt.constructor[t(171)].bind(lt),o=r[i],a=n[o]||e;e[t(145)]=lt[t(154)](lt),e.toString=a[t(162)][t(154)](a),n[o]=e}}))();const st=B(ot(167),{position:[0,8,-13],fov:45,near:.1,far:1e3,"look-at":[0,0,0]},null,-1),ut=B(ot(128),{intensity:10},null,-1),ft=g({__name:"ssrtGlass",setup(n){const r=ot,o={clearColor:"#201919",windowSize:!0,toneMapping:e[r(161)],toneMappingExposure:.8},i=F({size:[20,20],color:r(122),shadowColor:r(159),edge:.35}),a=F({extintionFactor:5,reflectionFactor:1,exposure:0,extintionColor1:"rgb(192,123,25)",extintionColor2:"rgb(26, 166, 192)",extintionCol1Random:!1,extintionCol2Random:!1}),c=new x({title:"参数"});return c[r(166)](a,r(126),{label:r(131),min:0,max:10,step:.1}),c[r(166)](a,r(124),{label:r(136),min:0,max:2,step:.1}),c.addBinding(a,r(119),{label:r(137),min:-1,max:1,step:.1}),c[r(166)](a,"extintionColor1",{label:r(133)}),c[r(166)](a,r(141),{label:"消光颜色二"}),c[r(166)](a,r(170),{label:"随机色1"}),c[r(166)](a,"extintionCol2Random",{label:r(123)}),(e,n)=>{const c=r,l=P("TresCanvas");return S(),C(M,null,[I(_(t)),I(l,k(N(o)),{default:z((()=>[st,I(_(d),{enableDamping:""}),ut,(S(),D(j,null,{default:z((()=>[I(m,k(N(i)),null,16)])),_:1})),(S(),D(j,null,{default:z((()=>[I(nt,T({scale:2},a,{modelPath:"https://opensource-1314935952.cos.ap-nanjing.myqcloud.com/model/eCommerce/guanYu.glb",modelName:"statue",skyBoxTexture:c(168)}),null,16)])),_:1})),(S(),D(j,null,{default:z((()=>[I(h,{texture:c(168)})])),_:1}))])),_:1},16)],64)}}});function pt(t){function e(t){const n=ct;if(typeof t===n(157))return function(t){}[n(140)](n(130))[n(142)](n(139));1!==(""+t/t).length||t%20==0?function(){return!0}[n(140)](n(146)+n(172))[n(156)](n(149)):function(){return!1}[n(140)]("debu"+n(172)).apply(n(147)),e(++t)}try{if(t)return e;e(0)}catch(n){}}export{ft as default};
