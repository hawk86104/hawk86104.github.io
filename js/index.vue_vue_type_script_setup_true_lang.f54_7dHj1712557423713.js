var ee=Object.defineProperty;var ae=(h,t,n)=>t in h?ee(h,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):h[t]=n;var z=(h,t,n)=>(ae(h,typeof t!="symbol"?t+"":t,n),n);import{cG as re,be as F,as as P,cH as x,aH as Y,aj as J,ca as te,k as C,s as W,cI as ne,w as L,cJ as X,K as U,cK as oe,co as j,cs as se,aE as ie,av as le,a0 as Q,cL as K,cM as ce,cN as ue,aP as de,cO as _e,aC as me,o as I,c as D,$ as pe,Y as he,a8 as ge,ay as fe,a5 as ve,v as Ee,X as Re,ao as ye}from"./vendor.dUBjHEtG1712557423713.js";class q extends re{constructor(t){super(t),this.type=F}parse(t){const _=function(e,o){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(o||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(o||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(o||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(o||""))}return-1},c="\n",E=function(e,o,u){o=o||1024;let l=e.pos,s=-1,a=0,d="",r=String.fromCharCode.apply(null,new Uint16Array(e.subarray(l,l+128)));for(;0>(s=r.indexOf(c))&&a<o&&l<e.byteLength;)d+=r,a+=r.length,l+=128,r+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(l,l+128)));return-1<s?(u!==!1&&(e.pos+=a+s+1),d+r.slice(0,s)):!1},R=function(e){const o=/^#\?(\S+)/,u=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,l=/^\s*FORMAT=(\S+)\s*$/,s=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,a={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let d,r;if(e.pos>=e.byteLength||!(d=E(e)))return _(1,"no header found");if(!(r=d.match(o)))return _(3,"bad initial token");for(a.valid|=1,a.programtype=r[1],a.string+=d+"\n";d=E(e),d!==!1;){if(a.string+=d+"\n",d.charAt(0)==="#"){a.comments+=d+"\n";continue}if((r=d.match(u))&&(a.gamma=parseFloat(r[1])),(r=d.match(i))&&(a.exposure=parseFloat(r[1])),(r=d.match(l))&&(a.valid|=2,a.format=r[1]),(r=d.match(s))&&(a.valid|=4,a.height=parseInt(r[1],10),a.width=parseInt(r[2],10)),a.valid&2&&a.valid&4)break}return a.valid&2?a.valid&4?a:_(3,"missing image size specifier"):_(3,"missing format specifier")},B=function(e,o,u){const i=o;if(i<8||i>32767||e[0]!==2||e[1]!==2||e[2]&128)return new Uint8Array(e);if(i!==(e[2]<<8|e[3]))return _(3,"wrong scanline width");const l=new Uint8Array(4*o*u);if(!l.length)return _(4,"unable to allocate buffer space");let s=0,a=0;const d=4*i,r=new Uint8Array(4),M=new Uint8Array(d);let $=u;for(;$>0&&a<e.byteLength;){if(a+4>e.byteLength)return _(1);if(r[0]=e[a++],r[1]=e[a++],r[2]=e[a++],r[3]=e[a++],r[0]!=2||r[1]!=2||(r[2]<<8|r[3])!=i)return _(3,"bad rgbe scanline format");let A=0,y;for(;A<d&&a<e.byteLength;){y=e[a++];const w=y>128;if(w&&(y-=128),y===0||A+y>d)return _(3,"bad scanline data");if(w){const k=e[a++];for(let O=0;O<y;O++)M[A++]=k}else M.set(e.subarray(a,a+y),A),A+=y,a+=y}const Z=i;for(let w=0;w<Z;w++){let k=0;l[s]=M[w+k],k+=i,l[s+1]=M[w+k],k+=i,l[s+2]=M[w+k],k+=i,l[s+3]=M[w+k],s+=4}$--}return l},G=function(e,o,u,i){const l=e[o+3],s=Math.pow(2,l-128)/255;u[i+0]=e[o+0]*s,u[i+1]=e[o+1]*s,u[i+2]=e[o+2]*s,u[i+3]=1},V=function(e,o,u,i){const l=e[o+3],s=Math.pow(2,l-128)/255;u[i+0]=x.toHalfFloat(Math.min(e[o+0]*s,65504)),u[i+1]=x.toHalfFloat(Math.min(e[o+1]*s,65504)),u[i+2]=x.toHalfFloat(Math.min(e[o+2]*s,65504)),u[i+3]=x.toHalfFloat(1)},N=new Uint8Array(t);N.pos=0;const T=R(N);if(T!==-1){const e=T.width,o=T.height,u=B(N.subarray(N.pos),e,o);if(u!==-1){let i,l,s;switch(this.type){case P:s=u.length/4;const a=new Float32Array(s*4);for(let r=0;r<s;r++)G(u,r*4,a,r*4);i=a,l=P;break;case F:s=u.length/4;const d=new Uint16Array(s*4);for(let r=0;r<s;r++)V(u,r*4,d,r*4);i=d,l=F;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:e,height:o,data:i,header:T.string,gamma:T.gamma,exposure:T.exposure,type:l}}}return null}setDataType(t){return this.type=t,this}load(t,n,g,m){function S(p,_){switch(p.type){case P:case F:"colorSpace"in p?p.colorSpace="srgb-linear":p.encoding=3e3,p.minFilter=Y,p.magFilter=Y,p.generateMipmaps=!1,p.flipY=!0;break}n&&n(p,_)}return super.load(t,S,g,m)}}const H={sunset:"venice/venice_sunset_1k.hdr",studio:"studio/poly_haven_studio_1k.hdr",city:"city/canary_wharf_1k.hdr",umbrellas:"outdoor/outdoor_umbrellas_1k.hdr",night:"outdoor/satara_night_1k.hdr",forest:"outood/mossy_forest_1k.hdr",snow:"outdoor/snowy_forest_path_01_1k.hdr",dawn:"kiara/kiara_1_dawn_1k.hdr",hangar:"indoor/small_hangar_01_1k.hdr",urban:"indoor/abandoned_games_room_02_1k.hdr",modern:"city/modern_buildings_2_1k.hdr",shangai:"city/shanghai_bund_1k.hdr"},we="https://raw.githubusercontent.com/Tresjs/assets/main/textures/hdr/";function ke(h){const{scene:t}=J(),{preset:n,blur:g,files:m=[],path:S="",background:p}=te(h),_=C(),b=W(()=>Array.isArray(m.value)),f=W(()=>b.value?ne:q),v=C(null);return L(()=>[m,S],async([c,E])=>{if(c.value.length>0&&!n.value){try{v.value=await X(U(f),b.value?[U(c)]:U(c),R=>{E.value&&R.setPath(U(E))})}catch(R){throw new Error("Failed to load environment map: ".concat(R))}v.value&&(_.value=b.value?v.value[0]:v.value,_.value.mapping=b.value?oe:j)}},{immediate:!0}),L(()=>_.value,c=>{t.value&&(t.value.environment=c)},{immediate:!0}),L(()=>[p.value,_.value],([c,E])=>{t.value&&(t.value.background=c?E:void 0)},{immediate:!0}),L(()=>g==null?void 0:g.value,c=>{t.value&&(t.value.backgroundBlurriness=c)},{immediate:!0}),L(n,async c=>{if(c&&c in H){const E=we,R=H[c];try{v.value=await X(q,R,B=>{E&&B.setPath(E)})}catch(B){throw new Error("Failed to load environment map: ".concat(B))}v.value&&(_.value=v.value,_.value.mapping=j)}else if(c&&!(c in H))throw new Error("Preset must be one of: ".concat(Object.keys(H).join(", ")))},{immediate:!0}),{texture:_}}class be extends se{constructor(){super();z(this,"virtualScene",null);this.virtualScene=new ie}add(...n){return this.virtualScene.add(...n),this}destructor(){this.virtualScene.traverse(n=>{n instanceof le&&(n.geometry.dispose(),n.material.dispose(),n.material.map&&n.material.map.dispose(),this.virtualScene.remove(n))}),this.virtualScene=null}}const Ie=Q({__name:"component",props:{background:{type:[Boolean,String],default:!1},blur:{default:0},files:{default:[]},path:{default:""},preset:{default:void 0},resolution:{default:256},near:{default:1},far:{default:1e3},frames:{default:1/0}},async setup(h,{expose:t}){let n,g;const m=h,S=C(null);t({texture:S});const{extend:p,renderer:_,scene:b}=J();let f=null,v=null;K().default!==void 0&&(p({EnvSence:be}),K().default(),f=new ce(m.resolution),f.texture.type=F,v=new ue(m.near,m.far,f));const c=C(null);de(()=>{var G;(G=c.value)==null||G.destructor(),f==null||f.dispose()});const{onBeforeLoop:E}=ge();let R=1;E(()=>{v&&c.value&&(m.frames===1/0||R<m.frames)&&(v.update(_.value,_e(c.value.virtualScene)),R++)});const B=([n,g]=me(()=>ke(m).texture),n=await n,g(),n);return L(B,G=>{f&&(b.value.environment=f.texture,m.background&&(b.value.background=f.texture))},{immediate:!0,deep:!0}),S.value=B,(G,V)=>U(f)?(I(),D("TresEnvSence",{key:0,ref_key:"envSence",ref:c},[pe(G.$slots,"default")],512)):he("",!0)}}),Be={key:0,args:[0,1,64]},Se={key:1,args:[.5,1,64]},Ge={key:2},Te=["toneMapped","map","side","color"],Ae=Q({__name:"index",props:{args:{default:null},from:{default:"rect"},toneMapped:{type:Boolean,default:!1},map:{default:null},intensity:{default:1},color:{default:new fe(16777215)}},setup(h){const t=h,n=C();return ve(()=>{n.value&&(n.value.color.multiplyScalar(t.intensity),n.value.needsUpdate=!0)}),(g,m)=>(I(),D("TresMesh",null,[t.from==="circle"?(I(),D("TresRingGeometry",Be)):t.from==="ring"?(I(),D("TresRingGeometry",Se)):t.from==="rect"?(I(),D("TresPlaneGeometry",Ge)):(I(),Ee(t.from,{key:3,args:t})),Re("TresMeshBasicMaterial",{ref_key:"material",ref:n,toneMapped:g.toneMapped,map:g.map,side:ye,color:g.color},null,8,Te)]))}});export{Ae as _,Ie as a};
