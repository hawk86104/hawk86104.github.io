import{importShared as t}from"./3d-tiles-renderer.CPyPbRB51767152766904.js";const{Box2:i,BoxGeometry:a,BufferGeometry:s,Float32BufferAttribute:o,MathUtils:n,Vector3:r}=await t("three");const{GLSL3:e,RawShaderMaterial:_}=await t("three"),{Color:h,GLSL3:l,RawShaderMaterial:c}=await t("three"),{GLSL3:m,RawShaderMaterial:v}=await t("three"),{GLSL3:b,RawShaderMaterial:x}=await t("three"),{GLSL3:p,RawShaderMaterial:f}=await t("three"),{Color:u,GLSL3:y,RawShaderMaterial:d}=await t("three"),{GLSL3:g,NoBlending:X,RawShaderMaterial:z}=await t("three"),{GLSL3:Y,NoBlending:Z,RawShaderMaterial:M}=await t("three"),{GLSL3:I,NoBlending:V,RawShaderMaterial:w}=await t("three"),{GLSL3:L,NoBlending:k,RawShaderMaterial:B}=await t("three"),{GLSL3:A,NoBlending:P,RawShaderMaterial:S,Vector2:T}=await t("three"),{GLSL3:C,NoBlending:j,RawShaderMaterial:R,Vector2:E}=await t("three"),{GLSL3:q,NoBlending:N,RawShaderMaterial:F,Vector2:D}=await t("three"),{GLSL3:G,LinearFilter:W,NearestFilter:J,NoBlending:U,RawShaderMaterial:O,TextureLoader:H,Vector2:Q}=await t("three"),{GLSL3:K,NoBlending:$,RawShaderMaterial:tt}=await t("three"),{GLSL3:it,NoBlending:at,RawShaderMaterial:st}=await t("three"),{GLSL3:ot,NoBlending:nt,RawShaderMaterial:rt,Vector2:et}=await t("three"),{GLSL3:_t,NoBlending:ht,RawShaderMaterial:lt,Vector2:ct}=await t("three"),{GLSL3:mt,NoBlending:vt,RawShaderMaterial:bt}=await t("three"),{GLSL3:xt,NoBlending:pt,RawShaderMaterial:ft,Vector2:ut}=await t("three"),{GLSL3:yt,NoBlending:dt,RawShaderMaterial:gt}=await t("three"),Xt="\n\nfloat random(vec2 co) {\n    float a = 12.9898;\n    float b = 78.233;\n    float c = 43758.5453;\n    float dt = dot(co.xy, vec2(a, b));\n    float sn = mod(dt, 3.14);\n    return fract(sin(sn) * c);\n}\n\n\nvec3 dither(vec3 color) {\n    // Calculate grid position\n    float grid_position = random(gl_FragCoord.xy);\n\n    // Shift the individual colors differently, thus making it even harder to see the dithering pattern\n    vec3 dither_shift_RGB = vec3(0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0);\n\n    // Modify shift acording to grid position\n    dither_shift_RGB = mix(2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position);\n\n    // Shift the color by dither_shift\n    return color + dither_shift_RGB;\n}\n",{GLSL3:zt,NoBlending:Yt,RawShaderMaterial:Zt}=await t("three"),{GLSL3:Mt,NoBlending:It,RawShaderMaterial:Vt}=await t("three"),{GLSL3:wt,NearestFilter:Lt,NoBlending:kt,RawShaderMaterial:Bt,RepeatWrapping:At,TextureLoader:Pt,Vector2:St}=await t("three"),{GLSL3:Tt,Matrix4:Ct,NoBlending:jt,RawShaderMaterial:Rt,Vector3:Et}=await t("three"),{GLSL3:qt,NoBlending:Nt,RawShaderMaterial:Ft,Vector2:Dt}=await t("three"),{GLSL3:Gt,NoBlending:Wt,RawShaderMaterial:Jt,Vector2:Ut}=await t("three"),{GLSL3:Ot,NoBlending:Ht,RawShaderMaterial:Qt,Vector2:Kt}=await t("three"),{GLSL3:$t,NoBlending:ti,RawShaderMaterial:ii,Vector2:ai}=await t("three");class si extends ii{constructor(){super({glslVersion:$t,uniforms:{tMap:{value:null},uDirection:{value:new ai(1,0)},uResolution:{value:new ai}},vertexShader:"\nin vec3 position;\nin vec2 uv;\n\nout vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n\n    gl_Position = vec4(position, 1.0);\n}\n",fragmentShader:"\nprecision highp float;\n\nuniform sampler2D tMap;\nuniform vec2 uDirection;\nuniform vec2 uResolution;\n\nin vec2 vUv;\n\nout vec4 FragColor;\n\n\nfloat smootherstep(float edge0, float edge1, float x) {\n    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);\n}\n\n\nvec4 blur13(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.411764705882353) * direction;\n  vec2 off2 = vec2(3.2941176470588234) * direction;\n  vec2 off3 = vec2(5.176470588235294) * direction;\n  color += texture(image, uv) * 0.1964825501511404;\n  color += texture(image, uv + (off1 / resolution)) * 0.2969069646728344;\n  color += texture(image, uv - (off1 / resolution)) * 0.2969069646728344;\n  color += texture(image, uv + (off2 / resolution)) * 0.09447039785044732;\n  color += texture(image, uv - (off2 / resolution)) * 0.09447039785044732;\n  color += texture(image, uv + (off3 / resolution)) * 0.010381362401148057;\n  color += texture(image, uv - (off3 / resolution)) * 0.010381362401148057;\n  return color;\n}\n\n\nvoid main() {\n    FragColor = blur13(tMap, vUv, uResolution, smootherstep(1.0, 0.0, vUv.y) * uDirection);\n}\n",blending:ti,depthTest:!1,depthWrite:!1})}}const oi=`\nprecision highp float;\n\nuniform sampler2D tReflect;\nuniform vec3 uColor;\nuniform float uReflectivity;\nuniform float uMirror;\nuniform float uMixStrength;\n\n#ifdef USE_MAP\n    uniform sampler2D tMap;\n#endif\n\n#ifdef USE_NORMALMAP\n    uniform sampler2D tNormalMap;\n    uniform vec2 uNormalScale;\n#endif\n\n#ifdef USE_FOG\n    uniform vec3 uFogColor;\n    uniform float uFogNear;\n    uniform float uFogFar;\n#endif\n\nin vec2 vUv;\nin vec4 vCoord;\nin vec3 vNormal;\nin vec3 vToEye;\n\nout vec4 FragColor;\n\n${Xt}\n\nvoid main() {\n    #ifdef USE_MAP\n        vec4 color = texture(tMap, vUv);\n    #else\n        vec4 color = vec4(uColor, 1.0);\n    #endif\n\n    #ifdef USE_NORMALMAP\n        vec4 normalColor = texture(tNormalMap, vUv * uNormalScale);\n        vec3 normal = normalize(vec3(normalColor.r * 2.0 - 1.0, normalColor.b, normalColor.g * 2.0 - 1.0));\n        vec3 coord = vCoord.xyz / vCoord.w;\n        vec2 uv = coord.xy + coord.z * normal.xz * 0.05;\n        vec4 reflectColor = texture(tReflect, uv);\n    #else\n        vec3 normal = vNormal;\n        vec4 reflectColor = textureProj(tReflect, vCoord);\n    #endif\n\n    // Fresnel term\n    vec3 toEye = normalize(vToEye);\n    float theta = max(dot(toEye, normal), 0.0);\n    float reflectance = uReflectivity + (1.0 - uReflectivity) * pow((1.0 - theta), 5.0);\n\n    reflectColor = mix(vec4(0), reflectColor, reflectance);\n\n    FragColor.rgb = color.rgb * ((1.0 - min(1.0, uMirror)) + reflectColor.rgb * uMixStrength);\n\n    #ifdef USE_FOG\n        float fogDepth = gl_FragCoord.z / gl_FragCoord.w;\n        float fogFactor = smoothstep(uFogNear, uFogFar, fogDepth);\n\n        FragColor.rgb = mix(FragColor.rgb, uFogColor, fogFactor);\n    #endif\n\n    #ifdef DITHERING\n        FragColor.rgb = dither(FragColor.rgb);\n    #endif\n\n    FragColor.a = 1.0;\n}\n`,{Color:ni,GLSL3:ri,Matrix3:ei,Matrix4:_i,NoBlending:hi,RawShaderMaterial:li,Vector2:ci}=await t("three");class mi extends li{constructor({color:t=new ni(1052688),map:i=null,normalMap:a=null,normalScale:s=new ci(1,1),reflectivity:o=0,mirror:n=0,mixStrength:r=10,fog:e=null,dithering:_=!1}={}){const h={glslVersion:ri,defines:{},uniforms:{tMap:{value:null},tReflect:{value:null},uMapTransform:{value:new ei},uMatrix:{value:new _i},uColor:{value:t instanceof ni?t:new ni(t)},uReflectivity:{value:o},uMirror:{value:n},uMixStrength:{value:r}},vertexShader:"\nin vec3 position;\nin vec3 normal;\nin vec2 uv;\n\nuniform mat4 modelMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\n\nuniform mat3 uMapTransform;\nuniform mat4 uMatrix;\n\nout vec2 vUv;\nout vec4 vCoord;\nout vec3 vNormal;\nout vec3 vToEye;\n\nvoid main() {\n    vUv = (uMapTransform * vec3(uv, 1.0)).xy;\n    vCoord = uMatrix * vec4(position, 1.0);\n    vNormal = normalMatrix * normal;\n\n    vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n    vToEye = cameraPosition - worldPosition.xyz;\n\n    vec4 mvPosition = viewMatrix * worldPosition;\n    gl_Position = projectionMatrix * mvPosition;\n}\n",fragmentShader:oi,blending:hi};i&&(i.updateMatrix(),h.defines=Object.assign(h.defines,{USE_MAP:""}),h.uniforms=Object.assign(h.uniforms,{tMap:{value:i},uMapTransform:{value:i.matrix}})),a&&(h.defines=Object.assign(h.defines,{USE_NORMALMAP:""}),h.uniforms=Object.assign(h.uniforms,{tNormalMap:{value:a},uNormalScale:{value:s}}),i||(a.updateMatrix(),h.uniforms=Object.assign(h.uniforms,{uMapTransform:{value:a.matrix}}))),e&&(h.defines=Object.assign(h.defines,{USE_FOG:""}),h.uniforms=Object.assign(h.uniforms,{uFogColor:{value:e.color},uFogNear:{value:e.near},uFogFar:{value:e.far}})),_&&(h.defines=Object.assign(h.defines,{DITHERING:""})),super(h)}}const vi=`\nprecision highp float;\n\nuniform sampler2D tMap;\nuniform sampler2D tReflect;\nuniform sampler2D tReflectBlur;\nuniform float uReflectivity;\n\nin vec2 vUv;\nin vec4 vCoord;\nin vec3 vNormal;\nin vec3 vToEye;\n\nout vec4 FragColor;\n\n${Xt}\n\nvoid main() {\n    vec2 reflectionUv = vCoord.xy / vCoord.w;\n\n    vec4 dudv = texture(tMap, vUv);\n    vec4 color = texture(tReflect, reflectionUv);\n\n    vec4 blur;\n\n    blur = texture(tReflectBlur, reflectionUv + dudv.rg / 256.0);\n    color = mix(color, blur, smoothstep(1.0, 0.1, dudv.g));\n\n    blur = texture(tReflectBlur, reflectionUv);\n    color = mix(color, blur, smoothstep(0.5, 1.0, dudv.r));\n\n    FragColor = color * mix(0.6, 0.75, dudv.g);\n\n    // Fresnel term\n    vec3 toEye = normalize(vToEye);\n    float theta = max(dot(toEye, vNormal), 0.0);\n    float reflectance = uReflectivity + (1.0 - uReflectivity) * pow((1.0 - theta), 5.0);\n\n    FragColor = mix(vec4(0), FragColor, reflectance);\n\n    #ifdef DITHERING\n        FragColor.rgb = dither(FragColor.rgb);\n    #endif\n\n    FragColor.a = 1.0;\n}\n`,{GLSL3:bi,Matrix3:xi,Matrix4:pi,NoBlending:fi,RawShaderMaterial:ui}=await t("three");class yi extends ui{constructor({map:t=null,reflectivity:i=0,dithering:a=!1}={}){const s={glslVersion:bi,defines:{DITHERING:a},uniforms:{tMap:{value:null},tReflect:{value:null},tReflectBlur:{value:null},uMapTransform:{value:new xi},uMatrix:{value:new pi},uReflectivity:{value:i}},vertexShader:"\nin vec3 position;\nin vec3 normal;\nin vec2 uv;\n\nuniform mat4 modelMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\n\nuniform mat3 uMapTransform;\nuniform mat4 uMatrix;\n\nout vec2 vUv;\nout vec4 vCoord;\nout vec3 vNormal;\nout vec3 vToEye;\n\nvoid main() {\n    vUv = (uMapTransform * vec3(uv, 1.0)).xy;\n    vCoord = uMatrix * vec4(position, 1.0);\n    vNormal = normalMatrix * normal;\n\n    vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n    vToEye = cameraPosition - worldPosition.xyz;\n\n    vec4 mvPosition = viewMatrix * worldPosition;\n    gl_Position = projectionMatrix * mvPosition;\n}\n",fragmentShader:vi,blending:fi};t&&(t.updateMatrix(),s.uniforms=Object.assign(s.uniforms,{tMap:{value:t},uMapTransform:{value:t.matrix}})),super(s)}}const{GLSL3:di,NoBlending:gi,RawShaderMaterial:Xi}=await t("three"),{GLSL3:zi,NoBlending:Yi,RawShaderMaterial:Zi}=await t("three"),{GLSL3:Mi,NoBlending:Ii,RawShaderMaterial:Vi}=await t("three"),{GLSL3:wi,NoBlending:Li,RawShaderMaterial:ki,Vector2:Bi}=await t("three"),{GLSL3:Ai,NoBlending:Pi,RawShaderMaterial:Si,Vector2:Ti}=await t("three"),{AdditiveBlending:Ci,GLSL3:ji,RawShaderMaterial:Ri,Vector2:Ei}=await t("three"),{GLSL3:qi,NoBlending:Ni,RawShaderMaterial:Fi}=await t("three"),{GLSL3:Di,NoBlending:Gi,RawShaderMaterial:Wi}=await t("three"),{Color:Ji,GLSL3:Ui,RawShaderMaterial:Oi}=await t("three"),{Vector3:Hi}=await t("three"),{GLSL3:Qi,HalfFloatType:Ki,Mesh:$i,NoBlending:ta,OrthographicCamera:ia,RawShaderMaterial:aa,Vector2:sa,WebGLRenderTarget:oa}=await t("three"),{Group:na,Matrix4:ra,Mesh:ea,OrthographicCamera:_a,PerspectiveCamera:ha,Plane:la,Vector3:ca,Vector4:ma,WebGLRenderTarget:va}=await t("three");class ba extends na{constructor({width:t=512,height:i=512,clipBias:a=0,blurIterations:n=8}={}){super(),this.clipBias=a,this.blurIterations=n,this.reflectorPlane=new la,this.normal=new ca,this.reflectorWorldPosition=new ca,this.cameraWorldPosition=new ca,this.rotationMatrix=new ra,this.lookAtPosition=new ca(0,0,-1),this.clipPlane=new ma,this.view=new ca,this.target=new ca,this.q=new ma,this.textureMatrix=new ra,this.virtualCamera=new ha,this.textureMatrixUniform={value:this.textureMatrix},this.renderTarget=new va(t,i,{depthBuffer:!1}),this.renderTargetRead=this.renderTarget.clone(),this.renderTargetWrite=this.renderTarget.clone(),this.renderTarget.depthBuffer=!0,this.renderTargetUniform={value:this.blurIterations>0?this.renderTargetRead.texture:this.renderTarget.texture},this.blurMaterial=new si,this.blurMaterial.uniforms.uResolution.value.set(t,i),this.screenCamera=new _a(-1,1,1,-1,0,1),this.screenTriangle=function(){const t=new s;return t.setAttribute("position",new o([-1,3,0,-1,-1,0,3,-1,0],3)),t.setAttribute("uv",new o([0,2,0,0,2,0],2)),t}(),this.screen=new ea(this.screenTriangle,this.blurMaterial),this.screen.frustumCulled=!1}setSize(t,i){this.renderTarget.setSize(t,i),this.renderTargetRead.setSize(t,i),this.renderTargetWrite.setSize(t,i),this.blurMaterial.uniforms.uResolution.value.set(t,i)}update(t,i,a){if(this.reflectorWorldPosition.setFromMatrixPosition(this.matrixWorld),this.cameraWorldPosition.setFromMatrixPosition(a.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal.set(0,0,1),this.normal.applyMatrix4(this.rotationMatrix),this.view.subVectors(this.reflectorWorldPosition,this.cameraWorldPosition),this.view.dot(this.normal)>0)return;this.view.reflect(this.normal).negate(),this.view.add(this.reflectorWorldPosition),this.rotationMatrix.extractRotation(a.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition),this.target.subVectors(this.reflectorWorldPosition,this.lookAtPosition),this.target.reflect(this.normal).negate(),this.target.add(this.reflectorWorldPosition),this.virtualCamera.position.copy(this.view),this.virtualCamera.up.set(0,1,0),this.virtualCamera.up.applyMatrix4(this.rotationMatrix),this.virtualCamera.up.reflect(this.normal),this.virtualCamera.lookAt(this.target),this.virtualCamera.far=a.far,this.virtualCamera.updateMatrixWorld(),this.virtualCamera.projectionMatrix.copy(a.projectionMatrix),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.virtualCamera.projectionMatrix),this.textureMatrix.multiply(this.virtualCamera.matrixWorldInverse),this.textureMatrix.multiply(this.matrixWorld),this.reflectorPlane.setFromNormalAndCoplanarPoint(this.normal,this.reflectorWorldPosition),this.reflectorPlane.applyMatrix4(this.virtualCamera.matrixWorldInverse),this.clipPlane.set(this.reflectorPlane.normal.x,this.reflectorPlane.normal.y,this.reflectorPlane.normal.z,this.reflectorPlane.constant);const s=this.virtualCamera.projectionMatrix;this.q.x=(Math.sign(this.clipPlane.x)+s.elements[8])/s.elements[0],this.q.y=(Math.sign(this.clipPlane.y)+s.elements[9])/s.elements[5],this.q.z=-1,this.q.w=(1+s.elements[10])/s.elements[14],this.clipPlane.multiplyScalar(2/this.clipPlane.dot(this.q)),s.elements[2]=this.clipPlane.x,s.elements[6]=this.clipPlane.y,s.elements[10]=this.clipPlane.z+1-this.clipBias,s.elements[14]=this.clipPlane.w;const o=t.getRenderTarget(),n=t.xr.enabled,r=t.shadowMap.autoUpdate;t.xr.enabled=!1,t.shadowMap.autoUpdate=!1,t.setRenderTarget(this.renderTarget),t.state.buffers.depth.setMask(!0),!1===t.autoClear&&t.clear(),t.render(i,this.virtualCamera);const e=this.blurIterations;for(let _=0;_<e;_++){this.blurMaterial.uniforms.tMap.value=0===_?this.renderTarget.texture:this.renderTargetRead.texture;const i=.5*(e-_-1);this.blurMaterial.uniforms.uDirection.value.set(_%2==0?i:0,_%2==0?0:i),t.setRenderTarget(this.renderTargetWrite),!1===t.autoClear&&t.clear(),t.render(this.screen,this.screenCamera);const a=this.renderTargetRead;this.renderTargetRead=this.renderTargetWrite,this.renderTargetWrite=a,this.renderTargetUniform.value=this.renderTargetRead.texture}t.xr.enabled=n,t.shadowMap.autoUpdate=r,t.setRenderTarget(o)}destroy(){this.renderTargetWrite.dispose(),this.renderTargetRead.dispose(),this.renderTarget.dispose(),this.blurMaterial.dispose(),this.screenTriangle.dispose();for(const t in this)this[t]=null;return null}}const{ShaderChunk:xa}=await t("three");var pa=pa||{};pa.collision||(pa.collision={}),pa.collision.broadphase||(pa.collision.broadphase={}),pa.collision.broadphase.BroadPhase=class{constructor(t){this._type=t,this._numProxies=0,this._proxyList=null,this._proxyListLast=null,this._proxyPairList=null,this._incremental=!1,this._testCount=0,this._proxyPairPool=null,this._idCount=0,this._convexSweep=new pa.collision.broadphase._BroadPhase.ConvexSweepGeometry,this._aabb=new pa.collision.broadphase._BroadPhase.AabbGeometry,this.identity=new pa.common.Transform,this.zero=new pa.common.Vec3,this.rayCastHit=new pa.collision.geometry.RayCastHit}createProxy(t,i){return null}destroyProxy(t){}moveProxy(t,i,a){}isOverlapping(t,i){return t._aabbMinX<i._aabbMaxX&&t._aabbMaxX>i._aabbMinX&&t._aabbMinY<i._aabbMaxY&&t._aabbMaxY>i._aabbMinY&&t._aabbMinZ<i._aabbMaxZ&&t._aabbMaxZ>i._aabbMinZ}collectPairs(){}getProxyPairList(){return this._proxyPairList}isIncremental(){return this._incremental}getTestCount(){return this._testCount}rayCast(t,i,a){}convexCast(t,i,a,s){}aabbTest(t,i){}},pa.collision.geometry||(pa.collision.geometry={}),pa.collision.geometry.Geometry=class{constructor(t){this._type=t,this._volume=0}_updateMass(){}_computeAabb(t,i){}_rayCastLocal(t,i,a,s,o,n,r){return!1}getType(){return this._type}getVolume(){return this._volume}rayCast(t,i,a,s){var o,n,r,e,_,h,l=t;o=l.x,n=l.y,r=l.z;var c,m,v,b,x,p,f=i;if(e=f.x,_=f.y,h=f.z,o-=a._positionX,n-=a._positionY,r-=a._positionZ,e-=a._positionX,_-=a._positionY,h-=a._positionZ,c=a._rotation00*o+a._rotation10*n+a._rotation20*r,m=a._rotation01*o+a._rotation11*n+a._rotation21*r,v=a._rotation02*o+a._rotation12*n+a._rotation22*r,o=c,n=m,r=v,b=a._rotation00*e+a._rotation10*_+a._rotation20*h,x=a._rotation01*e+a._rotation11*_+a._rotation21*h,p=a._rotation02*e+a._rotation12*_+a._rotation22*h,e=b,_=x,h=p,this._rayCastLocal(o,n,r,e,_,h,s)){var u,y,d,g,X,z,Y=s.position;u=Y.x,y=Y.y,d=Y.z;var Z,M,I,V,w,L,k=s.normal;g=k.x,X=k.y,z=k.z,Z=a._rotation00*u+a._rotation01*y+a._rotation02*d,M=a._rotation10*u+a._rotation11*y+a._rotation12*d,I=a._rotation20*u+a._rotation21*y+a._rotation22*d,u=Z,y=M,d=I,V=a._rotation00*g+a._rotation01*X+a._rotation02*z,w=a._rotation10*g+a._rotation11*X+a._rotation12*z,L=a._rotation20*g+a._rotation21*X+a._rotation22*z,g=V,X=w,z=L,u+=a._positionX,y+=a._positionY,d+=a._positionZ;var B=s.position;B.x=u,B.y=y,B.z=d;var A=s.normal;return A.x=g,A.y=X,A.z=z,!0}return!1}},pa.collision.geometry.ConvexGeometry=class extends pa.collision.geometry.Geometry{constructor(t){super(t),this._gjkMargin=pa.common.Setting.defaultGJKMargin,this._useGjkRayCast=!1}getGjkMergin(){return this._gjkMargin}setGjkMergin(t){t<0&&(t=0),this._gjkMargin=t}computeLocalSupportingVertex(t,i){}rayCast(t,i,a,s){return this._useGjkRayCast?pa.collision.narrowphase.detector.gjkepa.GjkEpa.instance.rayCast(this,a,t,i,s):super.rayCast(t,i,a,s)}},pa.collision.broadphase._BroadPhase||(pa.collision.broadphase._BroadPhase={}),pa.collision.broadphase._BroadPhase.ConvexSweepGeometry=class extends pa.collision.geometry.ConvexGeometry{constructor(){super(-1)}init(t,i,a){var s,o,n;this.c=t;var r,e,_,h=a;s=h.x,o=h.y,n=h.z,r=i._rotation00*s+i._rotation10*o+i._rotation20*n,e=i._rotation01*s+i._rotation11*o+i._rotation21*n,_=i._rotation02*s+i._rotation12*o+i._rotation22*n,this.localTranslation=new pa.common.Vec3;var l=this.localTranslation;l.x=r,l.y=e,l.z=_,this._gjkMargin=t._gjkMargin}computeLocalSupportingVertex(t,i){this.c.computeLocalSupportingVertex(t,i);var a=this.localTranslation;if(t.x*a.x+t.y*a.y+t.z*a.z>0){var s=this.localTranslation,o=i.x+s.x,n=i.y+s.y,r=i.z+s.z;i.x=o,i.y=n,i.z=r}}},pa.collision.broadphase._BroadPhase.AabbGeometry=class extends pa.collision.geometry.ConvexGeometry{constructor(){super(-1),this.min=new pa.common.Vec3,this.max=new pa.common.Vec3}computeLocalSupportingVertex(t,i){i.x=t.x>0?this.max.x:this.min.x,i.y=t.y>0?this.max.y:this.min.y,i.z=t.z>0?this.max.z:this.min.z}},pa.collision.broadphase.BroadPhaseProxyCallback=class{constructor(){}process(t){}},pa.collision.broadphase.BroadPhaseType=class{},pa.collision.broadphase.Proxy=class{constructor(t,i){this.userData=t,this._id=i,this._prev=null,this._next=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}getId(){return this._id}getFatAabb(){var t=new pa.collision.geometry.Aabb;return t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ,t}getFatAabbTo(t){t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ}},pa.collision.broadphase.ProxyPair=class{constructor(){this._p1=null,this._p2=null}getProxy1(){return this._p1}getProxy2(){return this._p2}getNext(){return this._next}},pa.collision.broadphase.bruteforce||(pa.collision.broadphase.bruteforce={}),pa.collision.broadphase.bruteforce.BruteForceBroadPhase=class extends pa.collision.broadphase.BroadPhase{constructor(){super(1),this._incremental=!1}createProxy(t,i){var a=new pa.collision.broadphase.Proxy(t,this._idCount++);return this._numProxies++,null==this._proxyList?(this._proxyList=a,this._proxyListLast=a):(this._proxyListLast._next=a,a._prev=this._proxyListLast,this._proxyListLast=a),a._aabbMinX=i._minX,a._aabbMinY=i._minY,a._aabbMinZ=i._minZ,a._aabbMaxX=i._maxX,a._aabbMaxY=i._maxY,a._aabbMaxZ=i._maxZ,a}destroyProxy(t){this._numProxies--;var i=t._prev,a=t._next;null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null,t.userData=null}moveProxy(t,i,a){t._aabbMinX=i._minX,t._aabbMinY=i._minY,t._aabbMinZ=i._minZ,t._aabbMaxX=i._maxX,t._aabbMaxY=i._maxY,t._aabbMaxZ=i._maxZ}collectPairs(){var t=this._proxyPairList;if(null!=t){for(;t._p1=null,t._p2=null,null!=(t=t._next););this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}this._testCount=0;for(var i=this._proxyList;null!=i;){for(var a=i._next,s=i._next;null!=s;){var o=s._next;if(this._testCount++,i._aabbMinX<s._aabbMaxX&&i._aabbMaxX>s._aabbMinX&&i._aabbMinY<s._aabbMaxY&&i._aabbMaxY>s._aabbMinY&&i._aabbMinZ<s._aabbMaxZ&&i._aabbMaxZ>s._aabbMinZ){var n=this._proxyPairPool;null!=n?(this._proxyPairPool=n._next,n._next=null):n=new pa.collision.broadphase.ProxyPair;var r=n;null==this._proxyPairList||(r._next=this._proxyPairList),this._proxyPairList=r,r._p1=i,r._p2=s}s=o}i=a}}rayCast(t,i,a){var s,o,n,r,e,_,h=t;s=h.x,o=h.y,n=h.z;var l=i;r=l.x,e=l.y,_=l.z;for(var c=this._proxyList;null!=c;){var m,v=c._next,b=s,x=o,p=n,f=r,u=e,y=_,d=b<f?b:f,g=x<u?x:u,X=p<y?p:y,z=b>f?b:f,Y=x>u?x:u,Z=p>y?p:y,M=c._aabbMinX,I=c._aabbMinY,V=c._aabbMinZ,w=c._aabbMaxX,L=c._aabbMaxY,k=c._aabbMaxZ;if(M>z||w<d||I>Y||L<g||V>Z||k<X)m=!1;else{var B,A,P=f-b,S=u-x,T=y-p,C=P<0?-P:P,j=S<0?-S:S,R=T<0?-T:T,E=.5*(w-M),q=.5*(L-I),N=.5*(k-V),F=b-.5*(w+M),D=x-.5*(L+I),G=p-.5*(k+V),W=D*T-G*S;if((W<0?-W:W)-(q*R+N*j)>0)A=!0;else{var J=G*P-F*T;A=(J<0?-J:J)-(N*C+E*R)>0}if(A)B=!0;else{var U=F*S-D*P;B=(U<0?-U:U)-(E*j+q*C)>0}m=!B}m&&a.process(c),c=v}}convexCast(t,i,a,s){for(var o=this._proxyList;null!=o;){var n=o._next,r=this._aabb.min;r.x=o._aabbMinX,r.y=o._aabbMinY,r.z=o._aabbMinZ;var e=this._aabb.max;e.x=o._aabbMaxX,e.y=o._aabbMaxY,e.z=o._aabbMaxZ,this._convexSweep.init(t,i,a);var _=pa.collision.narrowphase.detector.gjkepa.GjkEpa.instance;0==_.computeClosestPointsImpl(this._convexSweep,this._aabb,i,this.identity,null,!1)&&_.distance<=0&&s.process(o),o=n}}aabbTest(t,i){for(var a=this._proxyList;null!=a;){var s=a._next;t._minX<a._aabbMaxX&&t._maxX>a._aabbMinX&&t._minY<a._aabbMaxY&&t._maxY>a._aabbMinY&&t._minZ<a._aabbMaxZ&&t._maxZ>a._aabbMinZ&&i.process(a),a=s}}},pa.collision.broadphase.bvh||(pa.collision.broadphase.bvh={}),pa.collision.broadphase.bvh.BvhBroadPhase=class extends pa.collision.broadphase.BroadPhase{constructor(){super(2),this._incremental=!0,this._tree=new pa.collision.broadphase.bvh.BvhTree;var t=new Array(1024);this.movedProxies=t,this.numMovedProxies=0}collide(t,i){this._testCount++;var a=0==t._height,s=0==i._height;if(t==i){if(a)return;return this.collide(t._children[0],i),void this.collide(t._children[1],i)}if(t._aabbMinX<i._aabbMaxX&&t._aabbMaxX>i._aabbMinX&&t._aabbMinY<i._aabbMaxY&&t._aabbMaxY>i._aabbMinY&&t._aabbMinZ<i._aabbMaxZ&&t._aabbMaxZ>i._aabbMinZ){if(a&&s){var o=t._proxy,n=i._proxy,r=this._proxyPairPool;null!=r?(this._proxyPairPool=r._next,r._next=null):r=new pa.collision.broadphase.ProxyPair;var e=r;return null==this._proxyPairList||(e._next=this._proxyPairList),this._proxyPairList=e,e._p1=o,void(e._p2=n)}s||t._height>i._height?(this.collide(t._children[0],i),this.collide(t._children[1],i)):(this.collide(i._children[0],t),this.collide(i._children[1],t))}}rayCastRecursive(t,i,a,s,o,n,r,e){var _,h,l,c,m,v,b,x=_=i,p=h=a,f=l=s,u=c=o,y=m=n,d=v=r,g=x<u?x:u,X=p<y?p:y,z=f<d?f:d,Y=x>u?x:u,Z=p>y?p:y,M=f>d?f:d,I=t._aabbMinX,V=t._aabbMinY,w=t._aabbMinZ,L=t._aabbMaxX,k=t._aabbMaxY,B=t._aabbMaxZ;if(I>Y||L<g||V>Z||k<X||w>M||B<z)b=!1;else{var A,P,S=u-x,T=y-p,C=d-f,j=S<0?-S:S,R=T<0?-T:T,E=C<0?-C:C,q=.5*(L-I),N=.5*(k-V),F=.5*(B-w),D=x-.5*(L+I),G=p-.5*(k+V),W=f-.5*(B+w),J=G*C-W*T;if((J<0?-J:J)-(N*E+F*R)>0)P=!0;else{var U=W*S-D*C;P=(U<0?-U:U)-(F*j+q*E)>0}if(P)A=!0;else{var O=D*T-G*S;A=(O<0?-O:O)-(q*R+N*j)>0}b=!A}b&&(0!=t._height?(this.rayCastRecursive(t._children[0],_,h,l,c,m,v,e),this.rayCastRecursive(t._children[1],_,h,l,c,m,v,e)):e.process(t._proxy))}convexCastRecursive(t,i,a,s,o){var n=this._aabb.min;n.x=t._aabbMinX,n.y=t._aabbMinY,n.z=t._aabbMinZ;var r=this._aabb.max;r.x=t._aabbMaxX,r.y=t._aabbMaxY,r.z=t._aabbMaxZ,this._convexSweep.init(i,a,s);var e=pa.collision.narrowphase.detector.gjkepa.GjkEpa.instance;0==e.computeClosestPointsImpl(this._convexSweep,this._aabb,a,this.identity,null,!1)&&e.distance<=0&&(0!=t._height?(this.convexCastRecursive(t._children[0],i,a,s,o),this.convexCastRecursive(t._children[1],i,a,s,o)):o.process(t._proxy))}aabbTestRecursive(t,i,a){t._aabbMinX<i._maxX&&t._aabbMaxX>i._minX&&t._aabbMinY<i._maxY&&t._aabbMaxY>i._minY&&t._aabbMinZ<i._maxZ&&t._aabbMaxZ>i._minZ&&(0!=t._height?(this.aabbTestRecursive(t._children[0],i,a),this.aabbTestRecursive(t._children[1],i,a)):a.process(t._proxy))}createProxy(t,i){var a=new pa.collision.broadphase.bvh.BvhProxy(t,this._idCount++);this._numProxies++,null==this._proxyList?(this._proxyList=a,this._proxyListLast=a):(this._proxyListLast._next=a,a._prev=this._proxyListLast,this._proxyListLast=a),a._aabbMinX=i._minX,a._aabbMinY=i._minY,a._aabbMinZ=i._minZ,a._aabbMaxX=i._maxX,a._aabbMaxY=i._maxY,a._aabbMaxZ=i._maxZ;var s,o,n,r=pa.common.Setting.bvhProxyPadding;s=r,o=r,n=r,a._aabbMinX-=s,a._aabbMinY-=o,a._aabbMinZ-=n,a._aabbMaxX+=s,a._aabbMaxY+=o,a._aabbMaxZ+=n;var e=this._tree,_=e._nodePool;null!=_?(e._nodePool=_._next,_._next=null):_=new pa.collision.broadphase.bvh.BvhNode;var h=_;if(h._proxy=a,a._leaf=h,h._aabbMinX=a._aabbMinX,h._aabbMinY=a._aabbMinY,h._aabbMinZ=a._aabbMinZ,h._aabbMaxX=a._aabbMaxX,h._aabbMaxY=a._aabbMaxY,h._aabbMaxZ=a._aabbMaxZ,e._numLeaves++,null==e.leafList?(e.leafList=h,e.leafListLast=h):(e.leafListLast._nextLeaf=h,h._prevLeaf=e.leafListLast,e.leafListLast=h),null==e._root)e._root=h;else{for(var l=e._root;l._height>0;){var c=e._strategy._decideInsertion(l,h);if(-1==c)break;l=l._children[c]}var m=l._parent,v=e._nodePool;null!=v?(e._nodePool=v._next,v._next=null):v=new pa.collision.broadphase.bvh.BvhNode;var b=v;if(null==m)e._root=b;else{var x=l._childIndex;m._children[x]=b,b._parent=m,b._childIndex=x}var p=l._childIndex;b._children[p]=l,l._parent=b,l._childIndex=p;var f=1^l._childIndex;for(b._children[f]=h,h._parent=b,h._childIndex=f;null!=b;){if(e._strategy._balancingEnabled)if(b._height<2);else{var u=b._parent,y=b._children[0],d=b._children[1],g=y._height-d._height,X=b._childIndex;if(g>1){var z=y._children[0],Y=y._children[1];if(z._height>Y._height){y._children[1]=b,b._parent=y,b._childIndex=1,b._children[0]=Y,Y._parent=b,Y._childIndex=0;var Z=y._children[0],M=y._children[1];y._aabbMinX=Z._aabbMinX<M._aabbMinX?Z._aabbMinX:M._aabbMinX,y._aabbMinY=Z._aabbMinY<M._aabbMinY?Z._aabbMinY:M._aabbMinY,y._aabbMinZ=Z._aabbMinZ<M._aabbMinZ?Z._aabbMinZ:M._aabbMinZ,y._aabbMaxX=Z._aabbMaxX>M._aabbMaxX?Z._aabbMaxX:M._aabbMaxX,y._aabbMaxY=Z._aabbMaxY>M._aabbMaxY?Z._aabbMaxY:M._aabbMaxY,y._aabbMaxZ=Z._aabbMaxZ>M._aabbMaxZ?Z._aabbMaxZ:M._aabbMaxZ;var I=y._children[0]._height,V=y._children[1]._height;y._height=(I>V?I:V)+1;var w=b._children[0],L=b._children[1];b._aabbMinX=w._aabbMinX<L._aabbMinX?w._aabbMinX:L._aabbMinX,b._aabbMinY=w._aabbMinY<L._aabbMinY?w._aabbMinY:L._aabbMinY,b._aabbMinZ=w._aabbMinZ<L._aabbMinZ?w._aabbMinZ:L._aabbMinZ,b._aabbMaxX=w._aabbMaxX>L._aabbMaxX?w._aabbMaxX:L._aabbMaxX,b._aabbMaxY=w._aabbMaxY>L._aabbMaxY?w._aabbMaxY:L._aabbMaxY,b._aabbMaxZ=w._aabbMaxZ>L._aabbMaxZ?w._aabbMaxZ:L._aabbMaxZ;var k=b._children[0]._height,B=b._children[1]._height;b._height=(k>B?k:B)+1}else{y._children[0]=b,b._parent=y,b._childIndex=0,b._children[0]=z,z._parent=b,z._childIndex=0;var A=y._children[0],P=y._children[1];y._aabbMinX=A._aabbMinX<P._aabbMinX?A._aabbMinX:P._aabbMinX,y._aabbMinY=A._aabbMinY<P._aabbMinY?A._aabbMinY:P._aabbMinY,y._aabbMinZ=A._aabbMinZ<P._aabbMinZ?A._aabbMinZ:P._aabbMinZ,y._aabbMaxX=A._aabbMaxX>P._aabbMaxX?A._aabbMaxX:P._aabbMaxX,y._aabbMaxY=A._aabbMaxY>P._aabbMaxY?A._aabbMaxY:P._aabbMaxY,y._aabbMaxZ=A._aabbMaxZ>P._aabbMaxZ?A._aabbMaxZ:P._aabbMaxZ;var S=y._children[0]._height,T=y._children[1]._height;y._height=(S>T?S:T)+1;var C=b._children[0],j=b._children[1];b._aabbMinX=C._aabbMinX<j._aabbMinX?C._aabbMinX:j._aabbMinX,b._aabbMinY=C._aabbMinY<j._aabbMinY?C._aabbMinY:j._aabbMinY,b._aabbMinZ=C._aabbMinZ<j._aabbMinZ?C._aabbMinZ:j._aabbMinZ,b._aabbMaxX=C._aabbMaxX>j._aabbMaxX?C._aabbMaxX:j._aabbMaxX,b._aabbMaxY=C._aabbMaxY>j._aabbMaxY?C._aabbMaxY:j._aabbMaxY,b._aabbMaxZ=C._aabbMaxZ>j._aabbMaxZ?C._aabbMaxZ:j._aabbMaxZ;var R=b._children[0]._height,E=b._children[1]._height;b._height=(R>E?R:E)+1}null!=u?(u._children[X]=y,y._parent=u,y._childIndex=X):(e._root=y,y._parent=null),b=y}else if(g<-1){var q=d._children[0],N=d._children[1];if(q._height>N._height){d._children[1]=b,b._parent=d,b._childIndex=1,b._children[1]=N,N._parent=b,N._childIndex=1;var F=d._children[0],D=d._children[1];d._aabbMinX=F._aabbMinX<D._aabbMinX?F._aabbMinX:D._aabbMinX,d._aabbMinY=F._aabbMinY<D._aabbMinY?F._aabbMinY:D._aabbMinY,d._aabbMinZ=F._aabbMinZ<D._aabbMinZ?F._aabbMinZ:D._aabbMinZ,d._aabbMaxX=F._aabbMaxX>D._aabbMaxX?F._aabbMaxX:D._aabbMaxX,d._aabbMaxY=F._aabbMaxY>D._aabbMaxY?F._aabbMaxY:D._aabbMaxY,d._aabbMaxZ=F._aabbMaxZ>D._aabbMaxZ?F._aabbMaxZ:D._aabbMaxZ;var G=d._children[0]._height,W=d._children[1]._height;d._height=(G>W?G:W)+1;var J=b._children[0],U=b._children[1];b._aabbMinX=J._aabbMinX<U._aabbMinX?J._aabbMinX:U._aabbMinX,b._aabbMinY=J._aabbMinY<U._aabbMinY?J._aabbMinY:U._aabbMinY,b._aabbMinZ=J._aabbMinZ<U._aabbMinZ?J._aabbMinZ:U._aabbMinZ,b._aabbMaxX=J._aabbMaxX>U._aabbMaxX?J._aabbMaxX:U._aabbMaxX,b._aabbMaxY=J._aabbMaxY>U._aabbMaxY?J._aabbMaxY:U._aabbMaxY,b._aabbMaxZ=J._aabbMaxZ>U._aabbMaxZ?J._aabbMaxZ:U._aabbMaxZ;var O=b._children[0]._height,H=b._children[1]._height;b._height=(O>H?O:H)+1}else{d._children[0]=b,b._parent=d,b._childIndex=0,b._children[1]=q,q._parent=b,q._childIndex=1;var Q=d._children[0],K=d._children[1];d._aabbMinX=Q._aabbMinX<K._aabbMinX?Q._aabbMinX:K._aabbMinX,d._aabbMinY=Q._aabbMinY<K._aabbMinY?Q._aabbMinY:K._aabbMinY,d._aabbMinZ=Q._aabbMinZ<K._aabbMinZ?Q._aabbMinZ:K._aabbMinZ,d._aabbMaxX=Q._aabbMaxX>K._aabbMaxX?Q._aabbMaxX:K._aabbMaxX,d._aabbMaxY=Q._aabbMaxY>K._aabbMaxY?Q._aabbMaxY:K._aabbMaxY,d._aabbMaxZ=Q._aabbMaxZ>K._aabbMaxZ?Q._aabbMaxZ:K._aabbMaxZ;var $=d._children[0]._height,tt=d._children[1]._height;d._height=($>tt?$:tt)+1;var it=b._children[0],at=b._children[1];b._aabbMinX=it._aabbMinX<at._aabbMinX?it._aabbMinX:at._aabbMinX,b._aabbMinY=it._aabbMinY<at._aabbMinY?it._aabbMinY:at._aabbMinY,b._aabbMinZ=it._aabbMinZ<at._aabbMinZ?it._aabbMinZ:at._aabbMinZ,b._aabbMaxX=it._aabbMaxX>at._aabbMaxX?it._aabbMaxX:at._aabbMaxX,b._aabbMaxY=it._aabbMaxY>at._aabbMaxY?it._aabbMaxY:at._aabbMaxY,b._aabbMaxZ=it._aabbMaxZ>at._aabbMaxZ?it._aabbMaxZ:at._aabbMaxZ;var st=b._children[0]._height,ot=b._children[1]._height;b._height=(st>ot?st:ot)+1}null!=u?(u._children[X]=d,d._parent=u,d._childIndex=X):(e._root=d,d._parent=null),b=d}}var nt=b._children[0]._height,rt=b._children[1]._height;b._height=(nt>rt?nt:rt)+1;var et=b._children[0],_t=b._children[1];b._aabbMinX=et._aabbMinX<_t._aabbMinX?et._aabbMinX:_t._aabbMinX,b._aabbMinY=et._aabbMinY<_t._aabbMinY?et._aabbMinY:_t._aabbMinY,b._aabbMinZ=et._aabbMinZ<_t._aabbMinZ?et._aabbMinZ:_t._aabbMinZ,b._aabbMaxX=et._aabbMaxX>_t._aabbMaxX?et._aabbMaxX:_t._aabbMaxX,b._aabbMaxY=et._aabbMaxY>_t._aabbMaxY?et._aabbMaxY:_t._aabbMaxY,b._aabbMaxZ=et._aabbMaxZ>_t._aabbMaxZ?et._aabbMaxZ:_t._aabbMaxZ,b=b._parent}}if(!a._moved){if(a._moved=!0,this.movedProxies.length==this.numMovedProxies){for(var ht=this.numMovedProxies<<1,lt=new Array(ht),ct=0,mt=this.numMovedProxies;ct<mt;){var vt=ct++;lt[vt]=this.movedProxies[vt],this.movedProxies[vt]=null}this.movedProxies=lt}this.movedProxies[this.numMovedProxies++]=a}return a}destroyProxy(t){this._numProxies--;var i=t._prev,a=t._next;null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null;var s=t,o=this._tree,n=s._leaf;o._numLeaves--;var r=n._prevLeaf,e=n._nextLeaf;if(null!=r&&(r._nextLeaf=e),null!=e&&(e._prevLeaf=r),n==o.leafList&&(o.leafList=o.leafList._nextLeaf),n==o.leafListLast&&(o.leafListLast=o.leafListLast._prevLeaf),n._nextLeaf=null,n._prevLeaf=null,o._root==n)o._root=null;else{var _=n._parent,h=_._children[1^n._childIndex],l=_._parent;if(null==l)h._parent=null,h._childIndex=0,o._root=h,_._next=null,_._childIndex=0,_._children[0]=null,_._children[1]=null,_._childIndex=0,_._parent=null,_._height=0,_._proxy=null,_._next=o._nodePool,o._nodePool=_;else{h._parent=l;var c=_._childIndex;l._children[c]=h,h._parent=l,h._childIndex=c,_._next=null,_._childIndex=0,_._children[0]=null,_._children[1]=null,_._childIndex=0,_._parent=null,_._height=0,_._proxy=null,_._next=o._nodePool,o._nodePool=_;for(var m=l;null!=m;){if(o._strategy._balancingEnabled)if(m._height<2);else{var v=m._parent,b=m._children[0],x=m._children[1],p=b._height-x._height,f=m._childIndex;if(p>1){var u=b._children[0],y=b._children[1];if(u._height>y._height){b._children[1]=m,m._parent=b,m._childIndex=1,m._children[0]=y,y._parent=m,y._childIndex=0;var d=b._children[0],g=b._children[1];b._aabbMinX=d._aabbMinX<g._aabbMinX?d._aabbMinX:g._aabbMinX,b._aabbMinY=d._aabbMinY<g._aabbMinY?d._aabbMinY:g._aabbMinY,b._aabbMinZ=d._aabbMinZ<g._aabbMinZ?d._aabbMinZ:g._aabbMinZ,b._aabbMaxX=d._aabbMaxX>g._aabbMaxX?d._aabbMaxX:g._aabbMaxX,b._aabbMaxY=d._aabbMaxY>g._aabbMaxY?d._aabbMaxY:g._aabbMaxY,b._aabbMaxZ=d._aabbMaxZ>g._aabbMaxZ?d._aabbMaxZ:g._aabbMaxZ;var X=b._children[0]._height,z=b._children[1]._height;b._height=(X>z?X:z)+1;var Y=m._children[0],Z=m._children[1];m._aabbMinX=Y._aabbMinX<Z._aabbMinX?Y._aabbMinX:Z._aabbMinX,m._aabbMinY=Y._aabbMinY<Z._aabbMinY?Y._aabbMinY:Z._aabbMinY,m._aabbMinZ=Y._aabbMinZ<Z._aabbMinZ?Y._aabbMinZ:Z._aabbMinZ,m._aabbMaxX=Y._aabbMaxX>Z._aabbMaxX?Y._aabbMaxX:Z._aabbMaxX,m._aabbMaxY=Y._aabbMaxY>Z._aabbMaxY?Y._aabbMaxY:Z._aabbMaxY,m._aabbMaxZ=Y._aabbMaxZ>Z._aabbMaxZ?Y._aabbMaxZ:Z._aabbMaxZ;var M=m._children[0]._height,I=m._children[1]._height;m._height=(M>I?M:I)+1}else{b._children[0]=m,m._parent=b,m._childIndex=0,m._children[0]=u,u._parent=m,u._childIndex=0;var V=b._children[0],w=b._children[1];b._aabbMinX=V._aabbMinX<w._aabbMinX?V._aabbMinX:w._aabbMinX,b._aabbMinY=V._aabbMinY<w._aabbMinY?V._aabbMinY:w._aabbMinY,b._aabbMinZ=V._aabbMinZ<w._aabbMinZ?V._aabbMinZ:w._aabbMinZ,b._aabbMaxX=V._aabbMaxX>w._aabbMaxX?V._aabbMaxX:w._aabbMaxX,b._aabbMaxY=V._aabbMaxY>w._aabbMaxY?V._aabbMaxY:w._aabbMaxY,b._aabbMaxZ=V._aabbMaxZ>w._aabbMaxZ?V._aabbMaxZ:w._aabbMaxZ;var L=b._children[0]._height,k=b._children[1]._height;b._height=(L>k?L:k)+1;var B=m._children[0],A=m._children[1];m._aabbMinX=B._aabbMinX<A._aabbMinX?B._aabbMinX:A._aabbMinX,m._aabbMinY=B._aabbMinY<A._aabbMinY?B._aabbMinY:A._aabbMinY,m._aabbMinZ=B._aabbMinZ<A._aabbMinZ?B._aabbMinZ:A._aabbMinZ,m._aabbMaxX=B._aabbMaxX>A._aabbMaxX?B._aabbMaxX:A._aabbMaxX,m._aabbMaxY=B._aabbMaxY>A._aabbMaxY?B._aabbMaxY:A._aabbMaxY,m._aabbMaxZ=B._aabbMaxZ>A._aabbMaxZ?B._aabbMaxZ:A._aabbMaxZ;var P=m._children[0]._height,S=m._children[1]._height;m._height=(P>S?P:S)+1}null!=v?(v._children[f]=b,b._parent=v,b._childIndex=f):(o._root=b,b._parent=null),m=b}else if(p<-1){var T=x._children[0],C=x._children[1];if(T._height>C._height){x._children[1]=m,m._parent=x,m._childIndex=1,m._children[1]=C,C._parent=m,C._childIndex=1;var j=x._children[0],R=x._children[1];x._aabbMinX=j._aabbMinX<R._aabbMinX?j._aabbMinX:R._aabbMinX,x._aabbMinY=j._aabbMinY<R._aabbMinY?j._aabbMinY:R._aabbMinY,x._aabbMinZ=j._aabbMinZ<R._aabbMinZ?j._aabbMinZ:R._aabbMinZ,x._aabbMaxX=j._aabbMaxX>R._aabbMaxX?j._aabbMaxX:R._aabbMaxX,x._aabbMaxY=j._aabbMaxY>R._aabbMaxY?j._aabbMaxY:R._aabbMaxY,x._aabbMaxZ=j._aabbMaxZ>R._aabbMaxZ?j._aabbMaxZ:R._aabbMaxZ;var E=x._children[0]._height,q=x._children[1]._height;x._height=(E>q?E:q)+1;var N=m._children[0],F=m._children[1];m._aabbMinX=N._aabbMinX<F._aabbMinX?N._aabbMinX:F._aabbMinX,m._aabbMinY=N._aabbMinY<F._aabbMinY?N._aabbMinY:F._aabbMinY,m._aabbMinZ=N._aabbMinZ<F._aabbMinZ?N._aabbMinZ:F._aabbMinZ,m._aabbMaxX=N._aabbMaxX>F._aabbMaxX?N._aabbMaxX:F._aabbMaxX,m._aabbMaxY=N._aabbMaxY>F._aabbMaxY?N._aabbMaxY:F._aabbMaxY,m._aabbMaxZ=N._aabbMaxZ>F._aabbMaxZ?N._aabbMaxZ:F._aabbMaxZ;var D=m._children[0]._height,G=m._children[1]._height;m._height=(D>G?D:G)+1}else{x._children[0]=m,m._parent=x,m._childIndex=0,m._children[1]=T,T._parent=m,T._childIndex=1;var W=x._children[0],J=x._children[1];x._aabbMinX=W._aabbMinX<J._aabbMinX?W._aabbMinX:J._aabbMinX,x._aabbMinY=W._aabbMinY<J._aabbMinY?W._aabbMinY:J._aabbMinY,x._aabbMinZ=W._aabbMinZ<J._aabbMinZ?W._aabbMinZ:J._aabbMinZ,x._aabbMaxX=W._aabbMaxX>J._aabbMaxX?W._aabbMaxX:J._aabbMaxX,x._aabbMaxY=W._aabbMaxY>J._aabbMaxY?W._aabbMaxY:J._aabbMaxY,x._aabbMaxZ=W._aabbMaxZ>J._aabbMaxZ?W._aabbMaxZ:J._aabbMaxZ;var U=x._children[0]._height,O=x._children[1]._height;x._height=(U>O?U:O)+1;var H=m._children[0],Q=m._children[1];m._aabbMinX=H._aabbMinX<Q._aabbMinX?H._aabbMinX:Q._aabbMinX,m._aabbMinY=H._aabbMinY<Q._aabbMinY?H._aabbMinY:Q._aabbMinY,m._aabbMinZ=H._aabbMinZ<Q._aabbMinZ?H._aabbMinZ:Q._aabbMinZ,m._aabbMaxX=H._aabbMaxX>Q._aabbMaxX?H._aabbMaxX:Q._aabbMaxX,m._aabbMaxY=H._aabbMaxY>Q._aabbMaxY?H._aabbMaxY:Q._aabbMaxY,m._aabbMaxZ=H._aabbMaxZ>Q._aabbMaxZ?H._aabbMaxZ:Q._aabbMaxZ;var K=m._children[0]._height,$=m._children[1]._height;m._height=(K>$?K:$)+1}null!=v?(v._children[f]=x,x._parent=v,x._childIndex=f):(o._root=x,x._parent=null),m=x}}var tt=m._children[0]._height,it=m._children[1]._height;m._height=(tt>it?tt:it)+1;var at=m._children[0],st=m._children[1];m._aabbMinX=at._aabbMinX<st._aabbMinX?at._aabbMinX:st._aabbMinX,m._aabbMinY=at._aabbMinY<st._aabbMinY?at._aabbMinY:st._aabbMinY,m._aabbMinZ=at._aabbMinZ<st._aabbMinZ?at._aabbMinZ:st._aabbMinZ,m._aabbMaxX=at._aabbMaxX>st._aabbMaxX?at._aabbMaxX:st._aabbMaxX,m._aabbMaxY=at._aabbMaxY>st._aabbMaxY?at._aabbMaxY:st._aabbMaxY,m._aabbMaxZ=at._aabbMaxZ>st._aabbMaxZ?at._aabbMaxZ:st._aabbMaxZ,m=m._parent}}}s._leaf=null,n._next=null,n._childIndex=0,n._children[0]=null,n._children[1]=null,n._childIndex=0,n._parent=null,n._height=0,n._proxy=null,n._next=o._nodePool,o._nodePool=n,s.userData=null,s._next=null,s._prev=null,s._moved&&(s._moved=!1)}moveProxy(t,i,a){var s=t;if(!(s._aabbMinX<=i._minX&&s._aabbMaxX>=i._maxX&&s._aabbMinY<=i._minY&&s._aabbMaxY>=i._maxY&&s._aabbMinZ<=i._minZ&&s._aabbMaxZ>=i._maxZ)){s._aabbMinX=i._minX,s._aabbMinY=i._minY,s._aabbMinZ=i._minZ,s._aabbMaxX=i._maxX,s._aabbMaxY=i._maxY,s._aabbMaxZ=i._maxZ;var o,n,r,e=pa.common.Setting.bvhProxyPadding;if(o=e,n=e,r=e,s._aabbMinX-=o,s._aabbMinY-=n,s._aabbMinZ-=r,s._aabbMaxX+=o,s._aabbMaxY+=n,s._aabbMaxZ+=r,null!=a){var _,h,l,c,m,v,b,x,p;0;var f=a;c=0<(_=f.x)?0:_,m=0<(h=f.y)?0:h,v=0<(l=f.z)?0:l,b=0>_?0:_,x=0>h?0:h,p=0>l?0:l,s._aabbMinX+=c,s._aabbMinY+=m,s._aabbMinZ+=v,s._aabbMaxX+=b,s._aabbMaxY+=x,s._aabbMaxZ+=p}if(!s._moved){if(s._moved=!0,this.movedProxies.length==this.numMovedProxies){for(var u=this.numMovedProxies<<1,y=new Array(u),d=0,g=this.numMovedProxies;d<g;){var X=d++;y[X]=this.movedProxies[X],this.movedProxies[X]=null}this.movedProxies=y}this.movedProxies[this.numMovedProxies++]=s}}}collectPairs(){var t=this._proxyPairList;if(null!=t){for(;t._p1=null,t._p2=null,null!=(t=t._next););this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}if(this._testCount=0,!(this._numProxies<2)){for(var i=this.numMovedProxies/this._numProxies<pa.common.Setting.bvhIncrementalCollisionThreshold,a=0,s=this.numMovedProxies;a<s;){var o=a++,n=this.movedProxies[o];if(n._moved){var r=this._tree,e=n._leaf;r._numLeaves--;var _=e._prevLeaf,h=e._nextLeaf;if(null!=_&&(_._nextLeaf=h),null!=h&&(h._prevLeaf=_),e==r.leafList&&(r.leafList=r.leafList._nextLeaf),e==r.leafListLast&&(r.leafListLast=r.leafListLast._prevLeaf),e._nextLeaf=null,e._prevLeaf=null,r._root==e)r._root=null;else{var l=e._parent,c=l._children[1^e._childIndex],m=l._parent;if(null==m)c._parent=null,c._childIndex=0,r._root=c,l._next=null,l._childIndex=0,l._children[0]=null,l._children[1]=null,l._childIndex=0,l._parent=null,l._height=0,l._proxy=null,l._next=r._nodePool,r._nodePool=l;else{c._parent=m;var v=l._childIndex;m._children[v]=c,c._parent=m,c._childIndex=v,l._next=null,l._childIndex=0,l._children[0]=null,l._children[1]=null,l._childIndex=0,l._parent=null,l._height=0,l._proxy=null,l._next=r._nodePool,r._nodePool=l;for(var b=m;null!=b;){if(r._strategy._balancingEnabled)if(b._height<2);else{var x=b._parent,p=b._children[0],f=b._children[1],u=p._height-f._height,y=b._childIndex;if(u>1){var d=p._children[0],g=p._children[1];if(d._height>g._height){p._children[1]=b,b._parent=p,b._childIndex=1,b._children[0]=g,g._parent=b,g._childIndex=0;var X=p._children[0],z=p._children[1];p._aabbMinX=X._aabbMinX<z._aabbMinX?X._aabbMinX:z._aabbMinX,p._aabbMinY=X._aabbMinY<z._aabbMinY?X._aabbMinY:z._aabbMinY,p._aabbMinZ=X._aabbMinZ<z._aabbMinZ?X._aabbMinZ:z._aabbMinZ,p._aabbMaxX=X._aabbMaxX>z._aabbMaxX?X._aabbMaxX:z._aabbMaxX,p._aabbMaxY=X._aabbMaxY>z._aabbMaxY?X._aabbMaxY:z._aabbMaxY,p._aabbMaxZ=X._aabbMaxZ>z._aabbMaxZ?X._aabbMaxZ:z._aabbMaxZ;var Y=p._children[0]._height,Z=p._children[1]._height;p._height=(Y>Z?Y:Z)+1;var M=b._children[0],I=b._children[1];b._aabbMinX=M._aabbMinX<I._aabbMinX?M._aabbMinX:I._aabbMinX,b._aabbMinY=M._aabbMinY<I._aabbMinY?M._aabbMinY:I._aabbMinY,b._aabbMinZ=M._aabbMinZ<I._aabbMinZ?M._aabbMinZ:I._aabbMinZ,b._aabbMaxX=M._aabbMaxX>I._aabbMaxX?M._aabbMaxX:I._aabbMaxX,b._aabbMaxY=M._aabbMaxY>I._aabbMaxY?M._aabbMaxY:I._aabbMaxY,b._aabbMaxZ=M._aabbMaxZ>I._aabbMaxZ?M._aabbMaxZ:I._aabbMaxZ;var V=b._children[0]._height,w=b._children[1]._height;b._height=(V>w?V:w)+1}else{p._children[0]=b,b._parent=p,b._childIndex=0,b._children[0]=d,d._parent=b,d._childIndex=0;var L=p._children[0],k=p._children[1];p._aabbMinX=L._aabbMinX<k._aabbMinX?L._aabbMinX:k._aabbMinX,p._aabbMinY=L._aabbMinY<k._aabbMinY?L._aabbMinY:k._aabbMinY,p._aabbMinZ=L._aabbMinZ<k._aabbMinZ?L._aabbMinZ:k._aabbMinZ,p._aabbMaxX=L._aabbMaxX>k._aabbMaxX?L._aabbMaxX:k._aabbMaxX,p._aabbMaxY=L._aabbMaxY>k._aabbMaxY?L._aabbMaxY:k._aabbMaxY,p._aabbMaxZ=L._aabbMaxZ>k._aabbMaxZ?L._aabbMaxZ:k._aabbMaxZ;var B=p._children[0]._height,A=p._children[1]._height;p._height=(B>A?B:A)+1;var P=b._children[0],S=b._children[1];b._aabbMinX=P._aabbMinX<S._aabbMinX?P._aabbMinX:S._aabbMinX,b._aabbMinY=P._aabbMinY<S._aabbMinY?P._aabbMinY:S._aabbMinY,b._aabbMinZ=P._aabbMinZ<S._aabbMinZ?P._aabbMinZ:S._aabbMinZ,b._aabbMaxX=P._aabbMaxX>S._aabbMaxX?P._aabbMaxX:S._aabbMaxX,b._aabbMaxY=P._aabbMaxY>S._aabbMaxY?P._aabbMaxY:S._aabbMaxY,b._aabbMaxZ=P._aabbMaxZ>S._aabbMaxZ?P._aabbMaxZ:S._aabbMaxZ;var T=b._children[0]._height,C=b._children[1]._height;b._height=(T>C?T:C)+1}null!=x?(x._children[y]=p,p._parent=x,p._childIndex=y):(r._root=p,p._parent=null),b=p}else if(u<-1){var j=f._children[0],R=f._children[1];if(j._height>R._height){f._children[1]=b,b._parent=f,b._childIndex=1,b._children[1]=R,R._parent=b,R._childIndex=1;var E=f._children[0],q=f._children[1];f._aabbMinX=E._aabbMinX<q._aabbMinX?E._aabbMinX:q._aabbMinX,f._aabbMinY=E._aabbMinY<q._aabbMinY?E._aabbMinY:q._aabbMinY,f._aabbMinZ=E._aabbMinZ<q._aabbMinZ?E._aabbMinZ:q._aabbMinZ,f._aabbMaxX=E._aabbMaxX>q._aabbMaxX?E._aabbMaxX:q._aabbMaxX,f._aabbMaxY=E._aabbMaxY>q._aabbMaxY?E._aabbMaxY:q._aabbMaxY,f._aabbMaxZ=E._aabbMaxZ>q._aabbMaxZ?E._aabbMaxZ:q._aabbMaxZ;var N=f._children[0]._height,F=f._children[1]._height;f._height=(N>F?N:F)+1;var D=b._children[0],G=b._children[1];b._aabbMinX=D._aabbMinX<G._aabbMinX?D._aabbMinX:G._aabbMinX,b._aabbMinY=D._aabbMinY<G._aabbMinY?D._aabbMinY:G._aabbMinY,b._aabbMinZ=D._aabbMinZ<G._aabbMinZ?D._aabbMinZ:G._aabbMinZ,b._aabbMaxX=D._aabbMaxX>G._aabbMaxX?D._aabbMaxX:G._aabbMaxX,b._aabbMaxY=D._aabbMaxY>G._aabbMaxY?D._aabbMaxY:G._aabbMaxY,b._aabbMaxZ=D._aabbMaxZ>G._aabbMaxZ?D._aabbMaxZ:G._aabbMaxZ;var W=b._children[0]._height,J=b._children[1]._height;b._height=(W>J?W:J)+1}else{f._children[0]=b,b._parent=f,b._childIndex=0,b._children[1]=j,j._parent=b,j._childIndex=1;var U=f._children[0],O=f._children[1];f._aabbMinX=U._aabbMinX<O._aabbMinX?U._aabbMinX:O._aabbMinX,f._aabbMinY=U._aabbMinY<O._aabbMinY?U._aabbMinY:O._aabbMinY,f._aabbMinZ=U._aabbMinZ<O._aabbMinZ?U._aabbMinZ:O._aabbMinZ,f._aabbMaxX=U._aabbMaxX>O._aabbMaxX?U._aabbMaxX:O._aabbMaxX,f._aabbMaxY=U._aabbMaxY>O._aabbMaxY?U._aabbMaxY:O._aabbMaxY,f._aabbMaxZ=U._aabbMaxZ>O._aabbMaxZ?U._aabbMaxZ:O._aabbMaxZ;var H=f._children[0]._height,Q=f._children[1]._height;f._height=(H>Q?H:Q)+1;var K=b._children[0],$=b._children[1];b._aabbMinX=K._aabbMinX<$._aabbMinX?K._aabbMinX:$._aabbMinX,b._aabbMinY=K._aabbMinY<$._aabbMinY?K._aabbMinY:$._aabbMinY,b._aabbMinZ=K._aabbMinZ<$._aabbMinZ?K._aabbMinZ:$._aabbMinZ,b._aabbMaxX=K._aabbMaxX>$._aabbMaxX?K._aabbMaxX:$._aabbMaxX,b._aabbMaxY=K._aabbMaxY>$._aabbMaxY?K._aabbMaxY:$._aabbMaxY,b._aabbMaxZ=K._aabbMaxZ>$._aabbMaxZ?K._aabbMaxZ:$._aabbMaxZ;var tt=b._children[0]._height,it=b._children[1]._height;b._height=(tt>it?tt:it)+1}null!=x?(x._children[y]=f,f._parent=x,f._childIndex=y):(r._root=f,f._parent=null),b=f}}var at=b._children[0]._height,st=b._children[1]._height;b._height=(at>st?at:st)+1;var ot=b._children[0],nt=b._children[1];b._aabbMinX=ot._aabbMinX<nt._aabbMinX?ot._aabbMinX:nt._aabbMinX,b._aabbMinY=ot._aabbMinY<nt._aabbMinY?ot._aabbMinY:nt._aabbMinY,b._aabbMinZ=ot._aabbMinZ<nt._aabbMinZ?ot._aabbMinZ:nt._aabbMinZ,b._aabbMaxX=ot._aabbMaxX>nt._aabbMaxX?ot._aabbMaxX:nt._aabbMaxX,b._aabbMaxY=ot._aabbMaxY>nt._aabbMaxY?ot._aabbMaxY:nt._aabbMaxY,b._aabbMaxZ=ot._aabbMaxZ>nt._aabbMaxZ?ot._aabbMaxZ:nt._aabbMaxZ,b=b._parent}}}n._leaf=null,e._next=null,e._childIndex=0,e._children[0]=null,e._children[1]=null,e._childIndex=0,e._parent=null,e._height=0,e._proxy=null,e._next=r._nodePool,r._nodePool=e;var rt=this._tree,et=rt._nodePool;null!=et?(rt._nodePool=et._next,et._next=null):et=new pa.collision.broadphase.bvh.BvhNode;var _t=et;if(_t._proxy=n,n._leaf=_t,_t._aabbMinX=n._aabbMinX,_t._aabbMinY=n._aabbMinY,_t._aabbMinZ=n._aabbMinZ,_t._aabbMaxX=n._aabbMaxX,_t._aabbMaxY=n._aabbMaxY,_t._aabbMaxZ=n._aabbMaxZ,rt._numLeaves++,null==rt.leafList?(rt.leafList=_t,rt.leafListLast=_t):(rt.leafListLast._nextLeaf=_t,_t._prevLeaf=rt.leafListLast,rt.leafListLast=_t),null==rt._root)rt._root=_t;else{for(var ht=rt._root;ht._height>0;){var lt=rt._strategy._decideInsertion(ht,_t);if(-1==lt)break;ht=ht._children[lt]}var ct=ht._parent,mt=rt._nodePool;null!=mt?(rt._nodePool=mt._next,mt._next=null):mt=new pa.collision.broadphase.bvh.BvhNode;var vt=mt;if(null==ct)rt._root=vt;else{var bt=ht._childIndex;ct._children[bt]=vt,vt._parent=ct,vt._childIndex=bt}var xt=ht._childIndex;vt._children[xt]=ht,ht._parent=vt,ht._childIndex=xt;var pt=1^ht._childIndex;for(vt._children[pt]=_t,_t._parent=vt,_t._childIndex=pt;null!=vt;){if(rt._strategy._balancingEnabled)if(vt._height<2);else{var ft=vt._parent,ut=vt._children[0],yt=vt._children[1],dt=ut._height-yt._height,gt=vt._childIndex;if(dt>1){var Xt=ut._children[0],zt=ut._children[1];if(Xt._height>zt._height){ut._children[1]=vt,vt._parent=ut,vt._childIndex=1,vt._children[0]=zt,zt._parent=vt,zt._childIndex=0;var Yt=ut._children[0],Zt=ut._children[1];ut._aabbMinX=Yt._aabbMinX<Zt._aabbMinX?Yt._aabbMinX:Zt._aabbMinX,ut._aabbMinY=Yt._aabbMinY<Zt._aabbMinY?Yt._aabbMinY:Zt._aabbMinY,ut._aabbMinZ=Yt._aabbMinZ<Zt._aabbMinZ?Yt._aabbMinZ:Zt._aabbMinZ,ut._aabbMaxX=Yt._aabbMaxX>Zt._aabbMaxX?Yt._aabbMaxX:Zt._aabbMaxX,ut._aabbMaxY=Yt._aabbMaxY>Zt._aabbMaxY?Yt._aabbMaxY:Zt._aabbMaxY,ut._aabbMaxZ=Yt._aabbMaxZ>Zt._aabbMaxZ?Yt._aabbMaxZ:Zt._aabbMaxZ;var Mt=ut._children[0]._height,It=ut._children[1]._height;ut._height=(Mt>It?Mt:It)+1;var Vt=vt._children[0],wt=vt._children[1];vt._aabbMinX=Vt._aabbMinX<wt._aabbMinX?Vt._aabbMinX:wt._aabbMinX,vt._aabbMinY=Vt._aabbMinY<wt._aabbMinY?Vt._aabbMinY:wt._aabbMinY,vt._aabbMinZ=Vt._aabbMinZ<wt._aabbMinZ?Vt._aabbMinZ:wt._aabbMinZ,vt._aabbMaxX=Vt._aabbMaxX>wt._aabbMaxX?Vt._aabbMaxX:wt._aabbMaxX,vt._aabbMaxY=Vt._aabbMaxY>wt._aabbMaxY?Vt._aabbMaxY:wt._aabbMaxY,vt._aabbMaxZ=Vt._aabbMaxZ>wt._aabbMaxZ?Vt._aabbMaxZ:wt._aabbMaxZ;var Lt=vt._children[0]._height,kt=vt._children[1]._height;vt._height=(Lt>kt?Lt:kt)+1}else{ut._children[0]=vt,vt._parent=ut,vt._childIndex=0,vt._children[0]=Xt,Xt._parent=vt,Xt._childIndex=0;var Bt=ut._children[0],At=ut._children[1];ut._aabbMinX=Bt._aabbMinX<At._aabbMinX?Bt._aabbMinX:At._aabbMinX,ut._aabbMinY=Bt._aabbMinY<At._aabbMinY?Bt._aabbMinY:At._aabbMinY,ut._aabbMinZ=Bt._aabbMinZ<At._aabbMinZ?Bt._aabbMinZ:At._aabbMinZ,ut._aabbMaxX=Bt._aabbMaxX>At._aabbMaxX?Bt._aabbMaxX:At._aabbMaxX,ut._aabbMaxY=Bt._aabbMaxY>At._aabbMaxY?Bt._aabbMaxY:At._aabbMaxY,ut._aabbMaxZ=Bt._aabbMaxZ>At._aabbMaxZ?Bt._aabbMaxZ:At._aabbMaxZ;var Pt=ut._children[0]._height,St=ut._children[1]._height;ut._height=(Pt>St?Pt:St)+1;var Tt=vt._children[0],Ct=vt._children[1];vt._aabbMinX=Tt._aabbMinX<Ct._aabbMinX?Tt._aabbMinX:Ct._aabbMinX,vt._aabbMinY=Tt._aabbMinY<Ct._aabbMinY?Tt._aabbMinY:Ct._aabbMinY,vt._aabbMinZ=Tt._aabbMinZ<Ct._aabbMinZ?Tt._aabbMinZ:Ct._aabbMinZ,vt._aabbMaxX=Tt._aabbMaxX>Ct._aabbMaxX?Tt._aabbMaxX:Ct._aabbMaxX,vt._aabbMaxY=Tt._aabbMaxY>Ct._aabbMaxY?Tt._aabbMaxY:Ct._aabbMaxY,vt._aabbMaxZ=Tt._aabbMaxZ>Ct._aabbMaxZ?Tt._aabbMaxZ:Ct._aabbMaxZ;var jt=vt._children[0]._height,Rt=vt._children[1]._height;vt._height=(jt>Rt?jt:Rt)+1}null!=ft?(ft._children[gt]=ut,ut._parent=ft,ut._childIndex=gt):(rt._root=ut,ut._parent=null),vt=ut}else if(dt<-1){var Et=yt._children[0],qt=yt._children[1];if(Et._height>qt._height){yt._children[1]=vt,vt._parent=yt,vt._childIndex=1,vt._children[1]=qt,qt._parent=vt,qt._childIndex=1;var Nt=yt._children[0],Ft=yt._children[1];yt._aabbMinX=Nt._aabbMinX<Ft._aabbMinX?Nt._aabbMinX:Ft._aabbMinX,yt._aabbMinY=Nt._aabbMinY<Ft._aabbMinY?Nt._aabbMinY:Ft._aabbMinY,yt._aabbMinZ=Nt._aabbMinZ<Ft._aabbMinZ?Nt._aabbMinZ:Ft._aabbMinZ,yt._aabbMaxX=Nt._aabbMaxX>Ft._aabbMaxX?Nt._aabbMaxX:Ft._aabbMaxX,yt._aabbMaxY=Nt._aabbMaxY>Ft._aabbMaxY?Nt._aabbMaxY:Ft._aabbMaxY,yt._aabbMaxZ=Nt._aabbMaxZ>Ft._aabbMaxZ?Nt._aabbMaxZ:Ft._aabbMaxZ;var Dt=yt._children[0]._height,Gt=yt._children[1]._height;yt._height=(Dt>Gt?Dt:Gt)+1;var Wt=vt._children[0],Jt=vt._children[1];vt._aabbMinX=Wt._aabbMinX<Jt._aabbMinX?Wt._aabbMinX:Jt._aabbMinX,vt._aabbMinY=Wt._aabbMinY<Jt._aabbMinY?Wt._aabbMinY:Jt._aabbMinY,vt._aabbMinZ=Wt._aabbMinZ<Jt._aabbMinZ?Wt._aabbMinZ:Jt._aabbMinZ,vt._aabbMaxX=Wt._aabbMaxX>Jt._aabbMaxX?Wt._aabbMaxX:Jt._aabbMaxX,vt._aabbMaxY=Wt._aabbMaxY>Jt._aabbMaxY?Wt._aabbMaxY:Jt._aabbMaxY,vt._aabbMaxZ=Wt._aabbMaxZ>Jt._aabbMaxZ?Wt._aabbMaxZ:Jt._aabbMaxZ;var Ut=vt._children[0]._height,Ot=vt._children[1]._height;vt._height=(Ut>Ot?Ut:Ot)+1}else{yt._children[0]=vt,vt._parent=yt,vt._childIndex=0,vt._children[1]=Et,Et._parent=vt,Et._childIndex=1;var Ht=yt._children[0],Qt=yt._children[1];yt._aabbMinX=Ht._aabbMinX<Qt._aabbMinX?Ht._aabbMinX:Qt._aabbMinX,yt._aabbMinY=Ht._aabbMinY<Qt._aabbMinY?Ht._aabbMinY:Qt._aabbMinY,yt._aabbMinZ=Ht._aabbMinZ<Qt._aabbMinZ?Ht._aabbMinZ:Qt._aabbMinZ,yt._aabbMaxX=Ht._aabbMaxX>Qt._aabbMaxX?Ht._aabbMaxX:Qt._aabbMaxX,yt._aabbMaxY=Ht._aabbMaxY>Qt._aabbMaxY?Ht._aabbMaxY:Qt._aabbMaxY,yt._aabbMaxZ=Ht._aabbMaxZ>Qt._aabbMaxZ?Ht._aabbMaxZ:Qt._aabbMaxZ;var Kt=yt._children[0]._height,$t=yt._children[1]._height;yt._height=(Kt>$t?Kt:$t)+1;var ti=vt._children[0],ii=vt._children[1];vt._aabbMinX=ti._aabbMinX<ii._aabbMinX?ti._aabbMinX:ii._aabbMinX,vt._aabbMinY=ti._aabbMinY<ii._aabbMinY?ti._aabbMinY:ii._aabbMinY,vt._aabbMinZ=ti._aabbMinZ<ii._aabbMinZ?ti._aabbMinZ:ii._aabbMinZ,vt._aabbMaxX=ti._aabbMaxX>ii._aabbMaxX?ti._aabbMaxX:ii._aabbMaxX,vt._aabbMaxY=ti._aabbMaxY>ii._aabbMaxY?ti._aabbMaxY:ii._aabbMaxY,vt._aabbMaxZ=ti._aabbMaxZ>ii._aabbMaxZ?ti._aabbMaxZ:ii._aabbMaxZ;var ai=vt._children[0]._height,si=vt._children[1]._height;vt._height=(ai>si?ai:si)+1}null!=ft?(ft._children[gt]=yt,yt._parent=ft,yt._childIndex=gt):(rt._root=yt,yt._parent=null),vt=yt}}var oi=vt._children[0]._height,ni=vt._children[1]._height;vt._height=(oi>ni?oi:ni)+1;var ri=vt._children[0],ei=vt._children[1];vt._aabbMinX=ri._aabbMinX<ei._aabbMinX?ri._aabbMinX:ei._aabbMinX,vt._aabbMinY=ri._aabbMinY<ei._aabbMinY?ri._aabbMinY:ei._aabbMinY,vt._aabbMinZ=ri._aabbMinZ<ei._aabbMinZ?ri._aabbMinZ:ei._aabbMinZ,vt._aabbMaxX=ri._aabbMaxX>ei._aabbMaxX?ri._aabbMaxX:ei._aabbMaxX,vt._aabbMaxY=ri._aabbMaxY>ei._aabbMaxY?ri._aabbMaxY:ei._aabbMaxY,vt._aabbMaxZ=ri._aabbMaxZ>ei._aabbMaxZ?ri._aabbMaxZ:ei._aabbMaxZ,vt=vt._parent}}i&&this.collide(this._tree._root,n._leaf),n._moved=!1}this.movedProxies[o]=null}i||this.collide(this._tree._root,this._tree._root),this.numMovedProxies=0}}rayCast(t,i,a){if(null!=this._tree._root){var s,o,n,r,e,_,h=t;s=h.x,o=h.y,n=h.z;var l=i;r=l.x,e=l.y,_=l.z,this.rayCastRecursive(this._tree._root,s,o,n,r,e,_,a)}}convexCast(t,i,a,s){null!=this._tree._root&&this.convexCastRecursive(this._tree._root,t,i,a,s)}aabbTest(t,i){null!=this._tree._root&&this.aabbTestRecursive(this._tree._root,t,i)}getTreeBalance(){return this._tree._getBalance()}},pa.collision.broadphase.bvh.BvhInsertionStrategy=class{},pa.collision.broadphase.bvh.BvhNode=class{constructor(){this._next=null,this._prevLeaf=null,this._nextLeaf=null;var t=new Array(2);this._children=t,this._childIndex=0,this._parent=null,this._height=0,this._proxy=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}},pa.collision.broadphase.bvh.BvhProxy=class extends pa.collision.broadphase.Proxy{constructor(t,i){super(t,i),this._leaf=null,this._moved=!1}},pa.collision.broadphase.bvh.BvhStrategy=class{constructor(){this._insertionStrategy=0,this._balancingEnabled=!1}_decideInsertion(t,i){switch(this._insertionStrategy){case 0:var a,s,o;a=i._aabbMinX+i._aabbMaxX,s=i._aabbMinY+i._aabbMaxY,o=i._aabbMinZ+i._aabbMaxZ;var n,r,e,_,h,l,c=t._children[0],m=t._children[1];return n=c._aabbMinX+c._aabbMaxX,r=c._aabbMinY+c._aabbMaxY,e=c._aabbMinZ+c._aabbMaxZ,_=m._aabbMinX+m._aabbMaxX,h=m._aabbMinY+m._aabbMaxY,l=m._aabbMinZ+m._aabbMaxZ,(n-=a)*n+(r-=s)*r+(e-=o)*e<(_-=a)*_+(h-=s)*h+(l-=o)*l?0:1;case 1:var v,b,x,p,f,u,y=t._children[0],d=t._children[1],g=t._aabbMaxX-t._aabbMinX,X=t._aabbMaxY-t._aabbMinY,z=t._aabbMaxZ-t._aabbMinZ,Y=2*(g*(X+z)+X*z);v=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,b=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,x=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,p=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX;var Z=(f=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY)-b,M=(u=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ)-x,I=2*((p-v)*(Z+M)+Z*M),V=2*I,w=2*(I-Y),L=w;if(v=y._aabbMinX<i._aabbMinX?y._aabbMinX:i._aabbMinX,b=y._aabbMinY<i._aabbMinY?y._aabbMinY:i._aabbMinY,x=y._aabbMinZ<i._aabbMinZ?y._aabbMinZ:i._aabbMinZ,p=y._aabbMaxX>i._aabbMaxX?y._aabbMaxX:i._aabbMaxX,f=y._aabbMaxY>i._aabbMaxY?y._aabbMaxY:i._aabbMaxY,u=y._aabbMaxZ>i._aabbMaxZ?y._aabbMaxZ:i._aabbMaxZ,0==y._height){var k=f-b,B=u-x;L+=2*((p-v)*(k+B)+k*B)}else{var A=p-v,P=f-b,S=u-x,T=y._aabbMaxX-y._aabbMinX,C=y._aabbMaxY-y._aabbMinY,j=y._aabbMaxZ-y._aabbMinZ;L+=2*(A*(P+S)+P*S)-2*(T*(C+j)+C*j)}var R=w;if(v=d._aabbMinX<i._aabbMinX?d._aabbMinX:i._aabbMinX,b=d._aabbMinY<i._aabbMinY?d._aabbMinY:i._aabbMinY,x=d._aabbMinZ<i._aabbMinZ?d._aabbMinZ:i._aabbMinZ,p=d._aabbMaxX>i._aabbMaxX?d._aabbMaxX:i._aabbMaxX,f=d._aabbMaxY>i._aabbMaxY?d._aabbMaxY:i._aabbMaxY,u=d._aabbMaxZ>i._aabbMaxZ?d._aabbMaxZ:i._aabbMaxZ,0==d._height){var E=f-b,q=u-x;R+=2*((p-v)*(E+q)+E*q)}else{var N=p-v,F=f-b,D=u-x,G=d._aabbMaxX-d._aabbMinX,W=d._aabbMaxY-d._aabbMinY,J=d._aabbMaxZ-d._aabbMinZ;R+=2*(N*(F+D)+F*D)-2*(G*(W+J)+W*J)}return V<L?V<R?-1:1:L<R?0:1;default:return console.log("src/oimo/collision/broadphase/bvh/BvhStrategy.hx:37:","invalid BVH insertion strategy: "+this._insertionStrategy),-1}}_splitLeaves(t,i,a){var s,o,n,r=1/(a-i);s=0,o=0,n=0;for(var e,_,h,l=i,c=a;l<c;){var m=t[l++];m._tmpX=m._aabbMaxX+m._aabbMinX,m._tmpY=m._aabbMaxY+m._aabbMinY,m._tmpZ=m._aabbMaxZ+m._aabbMinZ,s+=m._tmpX,o+=m._tmpY,n+=m._tmpZ}s*=r,o*=r,n*=r,e=0,_=0,h=0;for(var v=i,b=a;v<b;){var x,p,f,u=t[v++];x=u._tmpX-s,p=u._tmpY-o,f=u._tmpZ-n,e+=x*=x,_+=p*=p,h+=f*=f}var y=_,d=h,g=i,X=a-1;if(e>y)if(e>d)for(var z=s;;){for(;;){if(t[g]._tmpX<=z)break;++g}for(;;){if(t[X]._tmpX>=z)break;--X}if(g>=X)break;var Y=t[g];t[g]=t[X],t[X]=Y,++g,--X}else for(var Z=n;;){for(;;){if(t[g]._tmpZ<=Z)break;++g}for(;;){if(t[X]._tmpZ>=Z)break;--X}if(g>=X)break;var M=t[g];t[g]=t[X],t[X]=M,++g,--X}else if(y>d)for(var I=o;;){for(;;){if(t[g]._tmpY<=I)break;++g}for(;;){if(t[X]._tmpY>=I)break;--X}if(g>=X)break;var V=t[g];t[g]=t[X],t[X]=V,++g,--X}else for(var w=n;;){for(;;){if(t[g]._tmpZ<=w)break;++g}for(;;){if(t[X]._tmpZ>=w)break;--X}if(g>=X)break;var L=t[g];t[g]=t[X],t[X]=L,++g,--X}return g}},pa.collision.broadphase.bvh.BvhTree=class{constructor(){this._root=null,this._numLeaves=0,this._strategy=new pa.collision.broadphase.bvh.BvhStrategy,this._nodePool=null,this.leafList=null,this.leafListLast=null;var t=new Array(1024);this.tmp=t}_print(t,i){if(null==i&&(i=""),null!=t)if(0==t._height)console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:39:",i+t._proxy._id);else{var a,s,o,n;this._print(t._children[0],i+"  "),s=t._aabbMaxX-t._aabbMinX;o=t._aabbMaxY-t._aabbMinY,n=t._aabbMaxZ-t._aabbMinZ;if(s*(o+n)+o*n>0){var r,e,_;r=t._aabbMaxX-t._aabbMinX;e=t._aabbMaxY-t._aabbMinY,_=t._aabbMaxZ-t._aabbMinZ;a=(1e3*(r*(e+_)+e*_)+.5|0)/1e3}else{var h,l,c;h=t._aabbMaxX-t._aabbMinX;l=t._aabbMaxY-t._aabbMinY,c=t._aabbMaxZ-t._aabbMinZ;a=(1e3*(h*(l+c)+l*c)-.5|0)/1e3}console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:42:",i+"#"+t._height+", "+a),this._print(t._children[1],i+"  ")}}_getBalance(){return this.getBalanceRecursive(this._root)}deleteRecursive(t){if(0==t._height){var i=t._prevLeaf,a=t._nextLeaf;return null!=i&&(i._nextLeaf=a),null!=a&&(a._prevLeaf=i),t==this.leafList&&(this.leafList=this.leafList._nextLeaf),t==this.leafListLast&&(this.leafListLast=this.leafListLast._prevLeaf),t._nextLeaf=null,t._prevLeaf=null,t._proxy._leaf=null,t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,void(this._nodePool=t)}this.deleteRecursive(t._children[0]),this.deleteRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t}decomposeRecursive(t){if(0==t._height)return t._childIndex=0,void(t._parent=null);this.decomposeRecursive(t._children[0]),this.decomposeRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t}buildTopDownRecursive(t,i,a){if(1==a-i){var s=t[i],o=s._proxy;return s._aabbMinX=o._aabbMinX,s._aabbMinY=o._aabbMinY,s._aabbMinZ=o._aabbMinZ,s._aabbMaxX=o._aabbMaxX,s._aabbMaxY=o._aabbMaxY,s._aabbMaxZ=o._aabbMaxZ,s}var n=this._strategy._splitLeaves(t,i,a),r=this.buildTopDownRecursive(t,i,n),e=this.buildTopDownRecursive(t,n,a),_=this._nodePool;null!=_?(this._nodePool=_._next,_._next=null):_=new pa.collision.broadphase.bvh.BvhNode;var h=_;h._children[0]=r,r._parent=h,r._childIndex=0,h._children[1]=e,e._parent=h,e._childIndex=1;var l=h._children[0],c=h._children[1];h._aabbMinX=l._aabbMinX<c._aabbMinX?l._aabbMinX:c._aabbMinX,h._aabbMinY=l._aabbMinY<c._aabbMinY?l._aabbMinY:c._aabbMinY,h._aabbMinZ=l._aabbMinZ<c._aabbMinZ?l._aabbMinZ:c._aabbMinZ,h._aabbMaxX=l._aabbMaxX>c._aabbMaxX?l._aabbMaxX:c._aabbMaxX,h._aabbMaxY=l._aabbMaxY>c._aabbMaxY?l._aabbMaxY:c._aabbMaxY,h._aabbMaxZ=l._aabbMaxZ>c._aabbMaxZ?l._aabbMaxZ:c._aabbMaxZ;var m=h._children[0]._height,v=h._children[1]._height;return h._height=(m>v?m:v)+1,h}getBalanceRecursive(t){if(null==t||0==t._height)return 0;var i=t._children[0]._height-t._children[1]._height;return i<0&&(i=-i),i+this.getBalanceRecursive(t._children[0])+this.getBalanceRecursive(t._children[1])}},pa.collision.geometry.Aabb=class{constructor(){this._minX=0,this._minY=0,this._minZ=0,this._maxX=0,this._maxY=0,this._maxZ=0}init(t,i){var a=t;this._minX=a.x,this._minY=a.y,this._minZ=a.z;var s=i;return this._maxX=s.x,this._maxY=s.y,this._maxZ=s.z,this}getMin(){var t=new pa.common.Vec3,i=t;return i.x=this._minX,i.y=this._minY,i.z=this._minZ,t}getMinTo(t){var i=t;i.x=this._minX,i.y=this._minY,i.z=this._minZ}setMin(t){var i=t;return this._minX=i.x,this._minY=i.y,this._minZ=i.z,this}getMax(){var t=new pa.common.Vec3,i=t;return i.x=this._maxX,i.y=this._maxY,i.z=this._maxZ,t}getMaxTo(t){var i=t;i.x=this._maxX,i.y=this._maxY,i.z=this._maxZ}setMax(t){var i=t;return this._maxX=i.x,this._maxY=i.y,this._maxZ=i.z,this}getCenter(){var t,i,a,s=new pa.common.Vec3;t=this._minX+this._maxX,i=this._minY+this._maxY,a=this._minZ+this._maxZ,t*=.5,i*=.5,a*=.5;var o=s;return o.x=t,o.y=i,o.z=a,s}getCenterTo(t){var i,a,s;i=this._minX+this._maxX,a=this._minY+this._maxY,s=this._minZ+this._maxZ,i*=.5,a*=.5,s*=.5;var o=t;o.x=i,o.y=a,o.z=s}getExtents(){var t,i,a,s=new pa.common.Vec3;t=this._maxX-this._minX,i=this._maxY-this._minY,a=this._maxZ-this._minZ,t*=.5,i*=.5,a*=.5;var o=s;return o.x=t,o.y=i,o.z=a,s}getExtentsTo(t){var i,a,s;i=this._maxX-this._minX,a=this._maxY-this._minY,s=this._maxZ-this._minZ,i*=.5,a*=.5,s*=.5;var o=t;o.x=i,o.y=a,o.z=s}combine(t){return this._minX=this._minX<t._minX?this._minX:t._minX,this._minY=this._minY<t._minY?this._minY:t._minY,this._minZ=this._minZ<t._minZ?this._minZ:t._minZ,this._maxX=this._maxX>t._maxX?this._maxX:t._maxX,this._maxY=this._maxY>t._maxY?this._maxY:t._maxY,this._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,this}combined(t){var i=new pa.collision.geometry.Aabb;return i._minX=this._minX<t._minX?this._minX:t._minX,i._minY=this._minY<t._minY?this._minY:t._minY,i._minZ=this._minZ<t._minZ?this._minZ:t._minZ,i._maxX=this._maxX>t._maxX?this._maxX:t._maxX,i._maxY=this._maxY>t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,i}overlap(t){return this._minX<t._maxX&&this._maxX>t._minX&&this._minY<t._maxY&&this._maxY>t._minY&&this._minZ<t._maxZ&&this._maxZ>t._minZ}getIntersection(t){var i=new pa.collision.geometry.Aabb;return i._minX=this._minX>t._minX?this._minX:t._minX,i._minY=this._minY>t._minY?this._minY:t._minY,i._minZ=this._minZ>t._minZ?this._minZ:t._minZ,i._maxX=this._maxX<t._maxX?this._maxX:t._maxX,i._maxY=this._maxY<t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ,i}getIntersectionTo(t,i){i._minX=this._minX>t._minX?this._minX:t._minX,i._minY=this._minY>t._minY?this._minY:t._minY,i._minZ=this._minZ>t._minZ?this._minZ:t._minZ,i._maxX=this._maxX<t._maxX?this._maxX:t._maxX,i._maxY=this._maxY<t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ}copyFrom(t){return this._minX=t._minX,this._minY=t._minY,this._minZ=t._minZ,this._maxX=t._maxX,this._maxY=t._maxY,this._maxZ=t._maxZ,this}clone(){var t=new pa.collision.geometry.Aabb;return t._minX=this._minX,t._minY=this._minY,t._minZ=this._minZ,t._maxX=this._maxX,t._maxY=this._maxY,t._maxZ=this._maxZ,t}},pa.collision.geometry.BoxGeometry=class extends pa.collision.geometry.ConvexGeometry{constructor(t){super(1);var i=t;this._halfExtentsX=i.x,this._halfExtentsY=i.y,this._halfExtentsZ=i.z,this._halfAxisXX=t.x,this._halfAxisXY=0,this._halfAxisXZ=0,this._halfAxisYX=0,this._halfAxisYY=t.y,this._halfAxisYZ=0,this._halfAxisZX=0,this._halfAxisZY=0,this._halfAxisZZ=t.z,this._updateMass();var a=t.x<t.y?t.z<t.x?t.z:t.x:t.z<t.y?t.z:t.y;this._gjkMargin>.2*a&&(this._gjkMargin=.2*a)}getHalfExtents(){var t=new pa.common.Vec3,i=t;return i.x=this._halfExtentsX,i.y=this._halfExtentsY,i.z=this._halfExtentsZ,t}getHalfExtentsTo(t){var i=t;i.x=this._halfExtentsX,i.y=this._halfExtentsY,i.z=this._halfExtentsZ}_updateMass(){var t,i,a;this._volume=this._halfExtentsX*this._halfExtentsY*this._halfExtentsZ*8,t=this._halfExtentsX*this._halfExtentsX,i=this._halfExtentsY*this._halfExtentsY,a=this._halfExtentsZ*this._halfExtentsZ,this._inertiaCoeff00=.3333333333333333*(i+a),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(a+t),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(t+i)}_computeAabb(t,i){var a,s,o,n,r,e,_,h,l,c,m,v,b;c=i._rotation00*this._halfAxisXX+i._rotation01*this._halfAxisXY+i._rotation02*this._halfAxisXZ,s=i._rotation10*this._halfAxisXX+i._rotation11*this._halfAxisXY+i._rotation12*this._halfAxisXZ,o=i._rotation20*this._halfAxisXX+i._rotation21*this._halfAxisXY+i._rotation22*this._halfAxisXZ,m=(a=(a=c)<0?-a:a)+(n=(n=i._rotation00*this._halfAxisYX+i._rotation01*this._halfAxisYY+i._rotation02*this._halfAxisYZ)<0?-n:n),v=(s=s<0?-s:s)+(r=(r=i._rotation10*this._halfAxisYX+i._rotation11*this._halfAxisYY+i._rotation12*this._halfAxisYZ)<0?-r:r),b=(o=o<0?-o:o)+(e=(e=i._rotation20*this._halfAxisYX+i._rotation21*this._halfAxisYY+i._rotation22*this._halfAxisYZ)<0?-e:e),m+=_=(_=i._rotation00*this._halfAxisZX+i._rotation01*this._halfAxisZY+i._rotation02*this._halfAxisZZ)<0?-_:_,v+=h=(h=i._rotation10*this._halfAxisZX+i._rotation11*this._halfAxisZY+i._rotation12*this._halfAxisZZ)<0?-h:h,b+=l=(l=i._rotation20*this._halfAxisZX+i._rotation21*this._halfAxisZY+i._rotation22*this._halfAxisZZ)<0?-l:l,t._minX=i._positionX-m,t._minY=i._positionY-v,t._minZ=i._positionZ-b,t._maxX=i._positionX+m,t._maxY=i._positionY+v,t._maxZ=i._positionZ+b}computeLocalSupportingVertex(t,i){var a,s,o,n,r,e;a=this._gjkMargin,s=this._gjkMargin,o=this._gjkMargin,a=a<this._halfExtentsX?a:this._halfExtentsX,s=s<this._halfExtentsY?s:this._halfExtentsY,o=o<this._halfExtentsZ?o:this._halfExtentsZ,n=this._halfExtentsX-a,r=this._halfExtentsY-s,e=this._halfExtentsZ-o,i.x=t.x>0?n:-n,i.y=t.y>0?r:-r,i.z=t.z>0?e:-e}_rayCastLocal(t,i,a,s,o,n,r){var e=t,_=i,h=a,l=s,c=o,m=n,v=this._halfExtentsX,b=this._halfExtentsY,x=this._halfExtentsZ,p=l-e,f=c-_,u=m-h,y=0,d=0,g=0,X=1,z=1,Y=1;if(p>-1e-6&&p<1e-6){if(e<=-v||e>=v)return!1}else{var Z=1/p,M=(-v-e)*Z,I=(v-e)*Z;if(M>I){var V=M;M=I,I=V}M>0&&(y=M),I<1&&(X=I)}if(f>-1e-6&&f<1e-6){if(_<=-b||_>=b)return!1}else{var w=1/f,L=(-b-_)*w,k=(b-_)*w;if(L>k){var B=L;L=k,k=B}L>0&&(d=L),k<1&&(z=k)}if(u>-1e-6&&u<1e-6){if(h<=-x||h>=x)return!1}else{var A=1/u,P=(-x-h)*A,S=(x-h)*A;if(P>S){var T=P;P=S,S=T}P>0&&(g=P),S<1&&(Y=S)}if(y>=1||d>=1||g>=1||X<=0||z<=0||Y<=0)return!1;var C=y,j=X,R=0;if(d>C&&(C=d,R=1),g>C&&(C=g,R=2),z<j&&(j=z),Y<j&&(j=Y),C>j)return!1;if(0==C)return!1;switch(R){case 0:r.normal.init(p>0?-1:1,0,0);break;case 1:r.normal.init(0,f>0?-1:1,0);break;case 2:r.normal.init(0,0,u>0?-1:1)}return r.position.init(e+C*p,_+C*f,h+C*u),r.fraction=C,!0}},pa.collision.geometry.CapsuleGeometry=class extends pa.collision.geometry.ConvexGeometry{constructor(t,i){super(4),this._radius=t,this._halfHeight=i,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){var t=this._radius*this._radius,i=this._halfHeight*this._halfHeight,a=6.28318530717958*t*this._halfHeight,s=3.14159265358979*t*this._radius*4/3;this._volume=a+s;var o=0==this._volume?0:1/this._volume,n=o*(a*t*.5+s*t*.4),r=o*(a*(.25*t+i/3)+s*(.4*t+this._halfHeight*this._radius*.75+i));this._inertiaCoeff00=r,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=n,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=r}_computeAabb(t,i){var a,s,o,n,r,e;a=this._radius,s=this._radius,o=this._radius,n=(n=i._rotation01)<0?-n:n,r=(r=i._rotation11)<0?-r:r,e=(e=i._rotation21)<0?-e:e,a+=n*=this._halfHeight,s+=r*=this._halfHeight,o+=e*=this._halfHeight,t._minX=i._positionX-a,t._minY=i._positionY-s,t._minZ=i._positionZ-o,t._maxX=i._positionX+a,t._maxY=i._positionY+s,t._maxZ=i._positionZ+o}computeLocalSupportingVertex(t,i){t.y>0?i.init(0,this._halfHeight,0):i.init(0,-this._halfHeight,0)}_rayCastLocal(t,i,a,s,o,n,r){var e=t,_=i,h=a,l=s,c=o,m=n,v=this._halfHeight,b=l-e,x=c-_,p=m-h,f=0,u=1,y=b*b+p*p,d=e*b+h*p,g=e*e+h*h-this._radius*this._radius,X=d*d-y*g;if(X<0)return!1;if(y>0){var z=Math.sqrt(X);if(u=(-d+z)/y,(f=(-d-z)/y)>=1||u<=0)return!1}else{if(g>=0)return!1;f=0,u=1}var Y,Z,M,I,V,w,L,k,B=_+x*f;if(B>-v&&B<v){if(f>0){Y=f;var A=r.normal.init(e+b*Y,0,h+p*Y),P=Math.sqrt(A.x*A.x+A.y*A.y+A.z*A.z);P>0&&(P=1/P);var S=A.x*P,T=A.y*P,C=A.z*P;return A.x=S,A.y=T,A.z=C,r.position.init(e+Y*b,B,h+Y*p),r.fraction=Y,!0}return!1}if((X=(d=(M=t-0)*(w=s-t)+(I=i-(Z=B<0?-v:v))*(L=o-i)+(V=a-0)*(k=n-a))*d-(y=w*w+L*L+k*k)*(g=M*M+I*I+V*V-this._radius*this._radius))<0)return!1;var j,R,E,q,N,F,D=(-d-Math.sqrt(X))/y;if(D<0||D>1)return!1;var G=(j=M+w*D)*j+(R=I+L*D)*R+(E=V+k*D)*E;G>0&&(G=1/Math.sqrt(G)),q=j*G,N=R*G,F=E*G,j+=0,R+=Z,E+=0;var W=r.position;W.x=j,W.y=R,W.z=E;var J=r.normal;return J.x=q,J.y=N,J.z=F,r.fraction=D,!0}},pa.collision.geometry.ConeGeometry=class extends pa.collision.geometry.ConvexGeometry{constructor(t,i){super(3),this._radius=t,this._halfHeight=i,this.sinTheta=t/Math.sqrt(t*t+4*i*i),this.cosTheta=2*i/Math.sqrt(t*t+4*i*i),this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){var t=this._radius*this._radius,i=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2/3,this._inertiaCoeff00=.05*(3*t+2*i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.05*(3*t+2*i)}_computeAabb(t,i){var a,s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y,d,g,X,z=(a=i._rotation01)*a,Y=(s=i._rotation11)*s,Z=(o=i._rotation21)*o;_=Math.sqrt(1-z),h=Math.sqrt(1-Y),l=Math.sqrt(1-Z),_*=this._radius,h*=this._radius,l*=this._radius,c=-(n=a*this._halfHeight),m=-(r=s*this._halfHeight),v=-(e=o*this._halfHeight),b=-n,x=-r,p=-e,f=(f=(c-=_)>(b+=_)?c:b)>n?f:n,u=(u=(m-=h)>(x+=h)?m:x)>r?u:r,y=(y=(v-=l)>(p+=l)?v:p)>e?y:e,d=(d=c<b?c:b)<n?d:n,g=(g=m<x?m:x)<r?g:r,X=(X=v<p?v:p)<e?X:e,t._minX=i._positionX+d,t._minY=i._positionY+g,t._minZ=i._positionZ+X,t._maxX=i._positionX+f,t._maxY=i._positionY+u,t._maxZ=i._positionZ+y}computeLocalSupportingVertex(t,i){var a=t.x,s=t.y,o=t.z;if(s>0&&s*s>this.sinTheta*this.sinTheta*(a*a+s*s+o*o))return i.init(0,this._halfHeight-this._gjkMargin/this.sinTheta,0),void(i.y<0&&(i.y=0));var n=t.x,r=t.z,e=n*n+r*r,_=2*this._halfHeight,h=(_-this._gjkMargin)/_*this._radius-this._gjkMargin/this.cosTheta;h<0&&(h=0);var l=e>0?h/Math.sqrt(e):0,c=this._halfHeight-this._gjkMargin;c<0&&(c=0),i.x=n*l,i.y=-c,i.z=r*l}_rayCastLocal(t,i,a,s,o,n,r){var e=t,_=i,h=a,l=s,c=o,m=n,v=this._halfHeight,b=l-e,x=c-_,p=m-h,f=0,u=1;if(x>-1e-6&&x<1e-6){if(_<=-v||_>=v)return!1}else{var y=1/x,d=(-v-_)*y,g=(v-_)*y;if(d>g){var X=d;d=g,g=X}d>0&&(f=d),g<1&&(u=g)}if(f>=1||u<=0)return!1;var z=0,Y=0;_-=v;var Z,M=this.cosTheta*this.cosTheta,I=M*(b*b+x*x+p*p)-x*x,V=M*(e*b+_*x+h*p)-_*x,w=M*(e*e+_*_+h*h)-_*_,L=V*V-I*w;if(0!=I){if(L<0)return!1;var k=Math.sqrt(L);if(I<0){if(x>0){if(z=0,(Y=(-V+k)/I)<=0)return!1}else if(Y=1,(z=(-V-k)/I)>=1)return!1}else if(Y=(-V+k)/I,(z=(-V-k)/I)>=1||Y<=0)return!1}else{var B=-w/(2*V);if(V>0){if(z=0,Y=B,B<=0)return!1}else if(z=B,Y=1,B>=1)return!1}if(_+=v,Y<=f||u<=z)return!1;if(z<f){if(0==(Z=f))return!1;r.normal.init(0,x>0?-1:1,0)}else{if(0==(Z=z))return!1;var A=r.normal.init(e+b*Z,0,h+p*Z),P=Math.sqrt(A.x*A.x+A.y*A.y+A.z*A.z);P>0&&(P=1/P);var S=A.x*P,T=A.y*P,C=A.z*P;A.x=S,A.y=T,A.z=C;var j=A,R=this.cosTheta,E=j.x*R,q=j.y*R,N=j.z*R;j.x=E,j.y=q,j.z=N,r.normal.y+=this.sinTheta}return r.position.init(e+Z*b,_+Z*x,h+Z*p),r.fraction=Z,!0}},pa.collision.geometry.ConvexHullGeometry=class extends pa.collision.geometry.ConvexGeometry{constructor(t){super(5),this._numVertices=t.length;var i=new Array(this._numVertices);this._vertices=i;var a=new Array(this._numVertices);this._tmpVertices=a;for(var s=0,o=this._numVertices;s<o;){var n=s++;this._vertices[n]=t[n],this._tmpVertices[n]=new pa.common.Vec3}this._useGjkRayCast=!0,this._updateMass()}getVertices(){return this._vertices}_updateMass(){this._volume=1,this._inertiaCoeff00=1,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=1,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=1;for(var t=this._vertices[0].x,i=this._vertices[0].y,a=this._vertices[0].z,s=this._vertices[0].x,o=this._vertices[0].y,n=this._vertices[0].z,r=1,e=this._numVertices;r<e;){var _=r++,h=this._vertices[_].x,l=this._vertices[_].y,c=this._vertices[_].z;h<t?t=h:h>s&&(s=h),l<i?i=l:l>o&&(o=l),c<a?a=c:c>n&&(n=c)}var m=s-t,v=o-i,b=n-a;this._volume=m*v*b;var x=.25*((t+s)*(t+s)+(i+o)*(i+o)+(a+n)*(a+n));m=m*m*.25,v=v*v*.25,b=b*b*.25,this._inertiaCoeff00=.3333333333333333*(v+b)+x,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(b+m)+x,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(m+v)+x}_computeAabb(t,i){var a,s,o,n,r,e,_,h,l,c,m,v;_=this._gjkMargin,h=this._gjkMargin,l=this._gjkMargin;var b,x,p,f=this._vertices[0];c=f.x,m=f.y,v=f.z,b=i._rotation00*c+i._rotation01*m+i._rotation02*v,x=i._rotation10*c+i._rotation11*m+i._rotation12*v,p=i._rotation20*c+i._rotation21*m+i._rotation22*v,a=b+=i._positionX,s=x+=i._positionY,o=p+=i._positionZ,n=b,r=x,e=p;for(var u=1,y=this._numVertices;u<y;){var d=u++,g=this._vertices[d];c=g.x,m=g.y,v=g.z,b=i._rotation00*c+i._rotation01*m+i._rotation02*v,x=i._rotation10*c+i._rotation11*m+i._rotation12*v,p=i._rotation20*c+i._rotation21*m+i._rotation22*v,a=a<(b+=i._positionX)?a:b,s=s<(x+=i._positionY)?s:x,o=o<(p+=i._positionZ)?o:p,n=n>b?n:b,r=r>x?r:x,e=e>p?e:p}t._minX=a-_,t._minY=s-h,t._minZ=o-l,t._maxX=n+_,t._maxY=r+h,t._maxZ=e+l}computeLocalSupportingVertex(t,i){for(var a=this._vertices[0],s=a.x*t.x+a.y*t.y+a.z*t.z,o=0,n=1,r=this._numVertices;n<r;){var e=n++,_=this._vertices[e],h=_.x*t.x+_.y*t.y+_.z*t.z;h>s&&(s=h,o=e)}var l=this._vertices[o];i.x=l.x,i.y=l.y,i.z=l.z}},pa.collision.geometry.CylinderGeometry=class extends pa.collision.geometry.ConvexGeometry{constructor(t,i){super(2),this._radius=t,this._halfHeight=i,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){var t=this._radius*this._radius,i=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2,this._inertiaCoeff00=.08333333333333333*(3*t+i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.5*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.08333333333333333*(3*t+i)}_computeAabb(t,i){var a,s,o,n,r,e,_,h,l,c=(a=(a=i._rotation01)<0?-a:a)*a,m=(s=(s=i._rotation11)<0?-s:s)*s,v=(o=(o=i._rotation21)<0?-o:o)*o;n=Math.sqrt(1-c),r=Math.sqrt(1-m),e=Math.sqrt(1-v),n*=this._radius,r*=this._radius,e*=this._radius,_=n+a*this._halfHeight,h=r+s*this._halfHeight,l=e+o*this._halfHeight,t._minX=i._positionX-_,t._minY=i._positionY-h,t._minZ=i._positionZ-l,t._maxX=i._positionX+_,t._maxY=i._positionY+h,t._maxZ=i._positionZ+l}computeLocalSupportingVertex(t,i){var a=t.x,s=t.z,o=a*a+s*s,n=this._radius-this._gjkMargin;n<0&&(n=0);var r=o>0?n/Math.sqrt(o):0,e=this._halfHeight-this._gjkMargin;e<0&&(e=0),i.x=a*r,i.y=t.y>0?e:-e,i.z=s*r}_rayCastLocal(t,i,a,s,o,n,r){var e=t,_=i,h=a,l=s,c=o,m=n,v=this._halfHeight,b=l-e,x=c-_,p=m-h,f=0,u=1;if(x>-1e-6&&x<1e-6){if(_<=-v||_>=v)return!1}else{var y=1/x,d=(-v-_)*y,g=(v-_)*y;if(d>g){var X=d;d=g,g=X}d>0&&(f=d),g<1&&(u=g)}if(f>=1||u<=0)return!1;var z,Y=0,Z=1,M=b*b+p*p,I=e*b+h*p,V=e*e+h*h-this._radius*this._radius,w=I*I-M*V;if(w<0)return!1;if(M>0){var L=Math.sqrt(w);if(Z=(-I+L)/M,(Y=(-I-L)/M)>=1||Z<=0)return!1}else{if(V>=0)return!1;Y=0,Z=1}if(Z<=f||u<=Y)return!1;if(Y<f){if(0==(z=f))return!1;r.normal.init(0,x>0?-1:1,0)}else{if(0==(z=Y))return!1;var k=r.normal.init(e+b*z,0,h+p*z),B=Math.sqrt(k.x*k.x+k.y*k.y+k.z*k.z);B>0&&(B=1/B);var A=k.x*B,P=k.y*B,S=k.z*B;k.x=A,k.y=P,k.z=S}return r.position.init(e+z*b,_+z*x,h+z*p),r.fraction=z,!0}},pa.collision.geometry.GeometryType=class{},pa.collision.geometry.RayCastHit=class{constructor(){this.position=new pa.common.Vec3,this.normal=new pa.common.Vec3,this.fraction=0}},pa.collision.geometry.SphereGeometry=class extends pa.collision.geometry.ConvexGeometry{constructor(t){super(0),this._radius=t,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}_updateMass(){this._volume=4.188790204786386*this._radius*this._radius*this._radius,this._inertiaCoeff00=.4*this._radius*this._radius,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.4*this._radius*this._radius,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.4*this._radius*this._radius}_computeAabb(t,i){var a,s,o;a=this._radius,s=this._radius,o=this._radius,t._minX=i._positionX-a,t._minY=i._positionY-s,t._minZ=i._positionZ-o,t._maxX=i._positionX+a,t._maxY=i._positionY+s,t._maxZ=i._positionZ+o}computeLocalSupportingVertex(t,i){i.zero()}_rayCastLocal(t,i,a,s,o,n,r){var e,_,h,l=(e=s-t)*e+(_=o-i)*_+(h=n-a)*h,c=t*e+i*_+a*h,m=c*c-l*(t*t+i*i+a*a-this._radius*this._radius);if(m<0)return!1;var v,b,x,p,f,u,y=(-c-Math.sqrt(m))/l;if(y<0||y>1)return!1;var d=(v=t+e*y)*v+(b=i+_*y)*b+(x=a+h*y)*x;d>0&&(d=1/Math.sqrt(d)),p=v*d,f=b*d,u=x*d;var g=r.position;g.x=v,g.y=b,g.z=x;var X=r.normal;return X.x=p,X.y=f,X.z=u,r.fraction=y,!0}},pa.collision.narrowphase||(pa.collision.narrowphase={}),pa.collision.narrowphase.CollisionMatrix=class{constructor(){var t=new Array(8);this.detectors=t;var i=this.detectors,a=new Array(8);i[0]=a;var s=this.detectors,o=new Array(8);s[1]=o;var n=this.detectors,r=new Array(8);n[2]=r;var e=this.detectors,_=new Array(8);e[3]=_;var h=this.detectors,l=new Array(8);h[4]=l;var c=this.detectors,m=new Array(8);c[5]=m;var v=new pa.collision.narrowphase.detector.GjkEpaDetector;this.detectors[0][0]=new pa.collision.narrowphase.detector.SphereSphereDetector,this.detectors[0][1]=new pa.collision.narrowphase.detector.SphereBoxDetector(!1),this.detectors[0][2]=v,this.detectors[0][3]=v,this.detectors[0][4]=new pa.collision.narrowphase.detector.SphereCapsuleDetector(!1),this.detectors[0][5]=v,this.detectors[1][0]=new pa.collision.narrowphase.detector.SphereBoxDetector(!0),this.detectors[1][1]=new pa.collision.narrowphase.detector.BoxBoxDetector,this.detectors[1][2]=v,this.detectors[1][3]=v,this.detectors[1][4]=v,this.detectors[1][5]=v,this.detectors[2][0]=v,this.detectors[2][1]=v,this.detectors[2][2]=v,this.detectors[2][3]=v,this.detectors[2][4]=v,this.detectors[2][5]=v,this.detectors[3][0]=v,this.detectors[3][1]=v,this.detectors[3][2]=v,this.detectors[3][3]=v,this.detectors[3][4]=v,this.detectors[3][5]=v,this.detectors[4][0]=new pa.collision.narrowphase.detector.SphereCapsuleDetector(!0),this.detectors[4][1]=v,this.detectors[4][2]=v,this.detectors[4][3]=v,this.detectors[4][4]=new pa.collision.narrowphase.detector.CapsuleCapsuleDetector,this.detectors[4][5]=v,this.detectors[5][0]=v,this.detectors[5][1]=v,this.detectors[5][2]=v,this.detectors[5][3]=v,this.detectors[5][4]=v,this.detectors[5][5]=v}getDetector(t,i){return this.detectors[t][i]}},pa.collision.narrowphase.DetectorResult=class{constructor(){this.numPoints=0,this.normal=new pa.common.Vec3;var t=new Array(pa.common.Setting.maxManifoldPoints);this.points=t,this.incremental=!1;for(var i=0,a=pa.common.Setting.maxManifoldPoints;i<a;){var s=i++;this.points[s]=new pa.collision.narrowphase.DetectorResultPoint}}getMaxDepth(){for(var t=0,i=0,a=this.numPoints;i<a;){var s=i++;this.points[s].depth>t&&(t=this.points[s].depth)}return t}clear(){this.numPoints=0;for(var t=0,i=this.points;t<i.length;){var a=i[t];++t,a.position1.zero(),a.position2.zero(),a.depth=0,a.id=0}this.normal.zero()}},pa.collision.narrowphase.DetectorResultPoint=class{constructor(){this.position1=new pa.common.Vec3,this.position2=new pa.common.Vec3,this.depth=0,this.id=0}},pa.collision.narrowphase.detector||(pa.collision.narrowphase.detector={}),pa.collision.narrowphase.detector.Detector=class{constructor(t){this.swapped=t}setNormal(t,i,a,s){var o=t.normal;if(o.x=i,o.y=a,o.z=s,this.swapped){var n=t.normal,r=-n.x,e=-n.y,_=-n.z;n.x=r,n.y=e,n.z=_}}addPoint(t,i,a,s,o,n,r,e,_){var h=t.points[t.numPoints++];if(h.depth=e,h.id=_,this.swapped){var l=h.position1;l.x=o,l.y=n,l.z=r;var c=h.position2;c.x=i,c.y=a,c.z=s}else{var m=h.position1;m.x=i,m.y=a,m.z=s;var v=h.position2;v.x=o,v.y=n,v.z=r}}detectImpl(t,i,a,s,o,n){}detect(t,i,a,s,o,n){t.numPoints=0;for(var r=0,e=t.points;r<e.length;){var _=e[r];++r,_.position1.zero(),_.position2.zero(),_.depth=0,_.id=0}t.normal.zero(),this.swapped?this.detectImpl(t,a,i,o,s,n):this.detectImpl(t,i,a,s,o,n)}},pa.collision.narrowphase.detector.BoxBoxDetector=class extends pa.collision.narrowphase.detector.Detector{constructor(){super(!1),this.clipper=new pa.collision.narrowphase.detector._BoxBoxDetector.FaceClipper}detectImpl(t,i,a,s,o,n){var r,e,_,h,l,c,m,v,b,x,p,f,u,y,d,g,X,z,Y,Z,M,I,V,w,L,k,B,A=i,P=a;t.incremental=!1,r=s._positionX,e=s._positionY,_=s._positionZ,m=(h=o._positionX)-r,v=(l=o._positionY)-e,b=(c=o._positionZ)-_,x=s._rotation00,p=s._rotation10,f=s._rotation20,u=s._rotation01,y=s._rotation11,d=s._rotation21,g=s._rotation02,X=s._rotation12,z=s._rotation22,Y=o._rotation00,Z=o._rotation10,M=o._rotation20,I=o._rotation01,V=o._rotation11,w=o._rotation21,L=o._rotation02,k=o._rotation12,B=o._rotation22;var S,T,C,j,R,E,q,N,F,D,G,W,J,U,O,H,Q,K,$=A._halfExtentsX,tt=A._halfExtentsY,it=A._halfExtentsZ,at=P._halfExtentsX,st=P._halfExtentsY,ot=P._halfExtentsZ;S=x*$,T=p*$,C=f*$,j=u*tt,R=y*tt,E=d*tt,q=g*it,N=X*it,F=z*it;var nt,rt,et,_t=Infinity,ht=-1,lt=0;nt=0,rt=0,et=0;var ct=$,mt=x*(D=Y*at)+p*(G=Z*at)+f*(W=M*at),vt=x*(J=I*st)+p*(U=V*st)+f*(O=w*st),bt=x*(H=L*ot)+p*(Q=k*ot)+f*(K=B*ot);mt<0&&(mt=-mt),vt<0&&(vt=-vt),bt<0&&(bt=-bt);var xt=mt+vt+bt,pt=x*m+p*v+f*b,ft=ct+xt,ut=pt<0,yt=ut?-pt:pt;if(yt<ft){var dt=ft-yt;dt<_t&&(_t=dt,ht=0,nt=x,rt=p,et=f,lt=ut?-1:1);var gt=u*D+y*G+d*W,Xt=u*J+y*U+d*O,zt=u*H+y*Q+d*K;gt<0&&(gt=-gt),Xt<0&&(Xt=-Xt),zt<0&&(zt=-zt);var Yt=(ct=tt)+(xt=gt+Xt+zt),Zt=(pt=u*m+y*v+d*b)<0,Mt=Zt?-pt:pt;if(Mt<Yt){var It=Yt-Mt;It<_t&&(_t=It,ht=1,nt=u,rt=y,et=d,lt=Zt?-1:1);var Vt=g*D+X*G+z*W,wt=g*J+X*U+z*O,Lt=g*H+X*Q+z*K;Vt<0&&(Vt=-Vt),wt<0&&(wt=-wt),Lt<0&&(Lt=-Lt);var kt=(ct=it)+(xt=Vt+wt+Lt),Bt=(pt=g*m+X*v+z*b)<0,At=Bt?-pt:pt;if(At<kt){var Pt=kt-At;Pt<_t&&(_t=Pt,ht=2,nt=g,rt=X,et=z,lt=Bt?-1:1),_t>pa.common.Setting.linearSlop?_t-=pa.common.Setting.linearSlop:_t=0;var St=Y*S+Z*T+M*C,Tt=Y*j+Z*R+M*E,Ct=Y*q+Z*N+M*F;St<0&&(St=-St),Tt<0&&(Tt=-Tt),Ct<0&&(Ct=-Ct);var jt=(ct=St+Tt+Ct)+(xt=at),Rt=(pt=Y*m+Z*v+M*b)<0,Et=Rt?-pt:pt;if(Et<jt){var qt=jt-Et;qt<_t&&(_t=qt,ht=3,nt=Y,rt=Z,et=M,lt=Rt?-1:1);var Nt=I*S+V*T+w*C,Ft=I*j+V*R+w*E,Dt=I*q+V*N+w*F;Nt<0&&(Nt=-Nt),Ft<0&&(Ft=-Ft),Dt<0&&(Dt=-Dt);var Gt=(ct=Nt+Ft+Dt)+(xt=st),Wt=(pt=I*m+V*v+w*b)<0,Jt=Wt?-pt:pt;if(Jt<Gt){var Ut=Gt-Jt;Ut<_t&&(_t=Ut,ht=4,nt=I,rt=V,et=w,lt=Wt?-1:1);var Ot=L*S+k*T+B*C,Ht=L*j+k*R+B*E,Qt=L*q+k*N+B*F;Ot<0&&(Ot=-Ot),Ht<0&&(Ht=-Ht),Qt<0&&(Qt=-Qt);var Kt=(ct=Ot+Ht+Qt)+(xt=ot),$t=(pt=L*m+k*v+B*b)<0,ti=$t?-pt:pt;if(ti<Kt){var ii,ai,si,oi,ni,ri,ei,_i,hi,li,ci,mi,vi,bi,xi,pi,fi,ui,yi,di,gi,Xi=Kt-ti;if(Xi<_t&&(_t=Xi,ht=5,nt=L,rt=k,et=B,lt=$t?-1:1),_t>pa.common.Setting.linearSlop?_t-=pa.common.Setting.linearSlop:_t=0,ai=f*Y-x*M,si=x*Z-p*Y,0!=(ii=p*M-f*Z)||0!=ai||0!=si){var zi=ii*ii+ai*ai+si*si;zi>0&&(zi=1/Math.sqrt(zi));var Yi=(ii*=zi)*j+(ai*=zi)*R+(si*=zi)*E,Zi=ii*q+ai*N+si*F;Yi<0&&(Yi=-Yi),Zi<0&&(Zi=-Zi);var Mi=ii*J+ai*U+si*O,Ii=ii*H+ai*Q+si*K;Mi<0&&(Mi=-Mi),Ii<0&&(Ii=-Ii);var Vi=(ct=Yi+Zi)+(xt=Mi+Ii),wi=(pt=ii*m+ai*v+si*b)<0,Li=wi?-pt:pt;if(!(Li<Vi))return;var ki=Vi-Li;ki<_t&&(_t=ki,ht=6,nt=ii,rt=ai,et=si,lt=wi?-1:1)}if(ai=f*I-x*w,si=x*V-p*I,0!=(ii=p*w-f*V)||0!=ai||0!=si){var Bi=ii*ii+ai*ai+si*si;Bi>0&&(Bi=1/Math.sqrt(Bi));var Ai=(ii*=Bi)*j+(ai*=Bi)*R+(si*=Bi)*E,Pi=ii*q+ai*N+si*F;Ai<0&&(Ai=-Ai),Pi<0&&(Pi=-Pi);var Si=ii*D+ai*G+si*W,Ti=ii*H+ai*Q+si*K;Si<0&&(Si=-Si),Ti<0&&(Ti=-Ti);var Ci=(ct=Ai+Pi)+(xt=Si+Ti),ji=(pt=ii*m+ai*v+si*b)<0,Ri=ji?-pt:pt;if(!(Ri<Ci))return;var Ei=Ci-Ri;Ei<_t&&(_t=Ei,ht=7,nt=ii,rt=ai,et=si,lt=ji?-1:1)}if(ai=f*L-x*B,si=x*k-p*L,0!=(ii=p*B-f*k)||0!=ai||0!=si){var qi=ii*ii+ai*ai+si*si;qi>0&&(qi=1/Math.sqrt(qi));var Ni=(ii*=qi)*j+(ai*=qi)*R+(si*=qi)*E,Fi=ii*q+ai*N+si*F;Ni<0&&(Ni=-Ni),Fi<0&&(Fi=-Fi);var Di=ii*D+ai*G+si*W,Gi=ii*J+ai*U+si*O;Di<0&&(Di=-Di),Gi<0&&(Gi=-Gi);var Wi=(ct=Ni+Fi)+(xt=Di+Gi),Ji=(pt=ii*m+ai*v+si*b)<0,Ui=Ji?-pt:pt;if(!(Ui<Wi))return;var Oi=Wi-Ui;Oi<_t&&(_t=Oi,ht=8,nt=ii,rt=ai,et=si,lt=Ji?-1:1)}if(ai=d*Y-u*M,si=u*Z-y*Y,0!=(ii=y*M-d*Z)||0!=ai||0!=si){var Hi=ii*ii+ai*ai+si*si;Hi>0&&(Hi=1/Math.sqrt(Hi));var Qi=(ii*=Hi)*S+(ai*=Hi)*T+(si*=Hi)*C,Ki=ii*q+ai*N+si*F;Qi<0&&(Qi=-Qi),Ki<0&&(Ki=-Ki);var $i=ii*J+ai*U+si*O,ta=ii*H+ai*Q+si*K;$i<0&&($i=-$i),ta<0&&(ta=-ta);var ia=(ct=Qi+Ki)+(xt=$i+ta),aa=(pt=ii*m+ai*v+si*b)<0,sa=aa?-pt:pt;if(!(sa<ia))return;var oa=ia-sa;oa<_t&&(_t=oa,ht=9,nt=ii,rt=ai,et=si,lt=aa?-1:1)}if(ai=d*I-u*w,si=u*V-y*I,0!=(ii=y*w-d*V)||0!=ai||0!=si){var na=ii*ii+ai*ai+si*si;na>0&&(na=1/Math.sqrt(na));var ra=(ii*=na)*S+(ai*=na)*T+(si*=na)*C,ea=ii*q+ai*N+si*F;ra<0&&(ra=-ra),ea<0&&(ea=-ea);var _a=ii*D+ai*G+si*W,ha=ii*H+ai*Q+si*K;_a<0&&(_a=-_a),ha<0&&(ha=-ha);var la=(ct=ra+ea)+(xt=_a+ha),ca=(pt=ii*m+ai*v+si*b)<0,ma=ca?-pt:pt;if(!(ma<la))return;var va=la-ma;va<_t&&(_t=va,ht=10,nt=ii,rt=ai,et=si,lt=ca?-1:1)}if(ai=d*L-u*B,si=u*k-y*L,0!=(ii=y*B-d*k)||0!=ai||0!=si){var ba=ii*ii+ai*ai+si*si;ba>0&&(ba=1/Math.sqrt(ba));var xa=(ii*=ba)*S+(ai*=ba)*T+(si*=ba)*C,fa=ii*q+ai*N+si*F;xa<0&&(xa=-xa),fa<0&&(fa=-fa);var ua=ii*D+ai*G+si*W,ya=ii*J+ai*U+si*O;ua<0&&(ua=-ua),ya<0&&(ya=-ya);var da=(ct=xa+fa)+(xt=ua+ya),ga=(pt=ii*m+ai*v+si*b)<0,Xa=ga?-pt:pt;if(!(Xa<da))return;var za=da-Xa;za<_t&&(_t=za,ht=11,nt=ii,rt=ai,et=si,lt=ga?-1:1)}if(ai=z*Y-g*M,si=g*Z-X*Y,0!=(ii=X*M-z*Z)||0!=ai||0!=si){var Ya=ii*ii+ai*ai+si*si;Ya>0&&(Ya=1/Math.sqrt(Ya));var Za=(ii*=Ya)*S+(ai*=Ya)*T+(si*=Ya)*C,Ma=ii*j+ai*R+si*E;Za<0&&(Za=-Za),Ma<0&&(Ma=-Ma);var Ia=ii*J+ai*U+si*O,Va=ii*H+ai*Q+si*K;Ia<0&&(Ia=-Ia),Va<0&&(Va=-Va);var wa=(ct=Za+Ma)+(xt=Ia+Va),La=(pt=ii*m+ai*v+si*b)<0,ka=La?-pt:pt;if(!(ka<wa))return;var Ba=wa-ka;Ba<_t&&(_t=Ba,ht=12,nt=ii,rt=ai,et=si,lt=La?-1:1)}if(ai=z*I-g*w,si=g*V-X*I,0!=(ii=X*w-z*V)||0!=ai||0!=si){var Aa=ii*ii+ai*ai+si*si;Aa>0&&(Aa=1/Math.sqrt(Aa));var Pa=(ii*=Aa)*S+(ai*=Aa)*T+(si*=Aa)*C,Sa=ii*j+ai*R+si*E;Pa<0&&(Pa=-Pa),Sa<0&&(Sa=-Sa);var Ta=ii*D+ai*G+si*W,Ca=ii*H+ai*Q+si*K;Ta<0&&(Ta=-Ta),Ca<0&&(Ca=-Ca);var ja=(ct=Pa+Sa)+(xt=Ta+Ca),Ra=(pt=ii*m+ai*v+si*b)<0,Ea=Ra?-pt:pt;if(!(Ea<ja))return;var qa=ja-Ea;qa<_t&&(_t=qa,ht=13,nt=ii,rt=ai,et=si,lt=Ra?-1:1)}if(ai=z*L-g*B,si=g*k-X*L,0!=(ii=X*B-z*k)||0!=ai||0!=si){var Na=ii*ii+ai*ai+si*si;Na>0&&(Na=1/Math.sqrt(Na));var Fa=(ii*=Na)*S+(ai*=Na)*T+(si*=Na)*C,Da=ii*j+ai*R+si*E;Fa<0&&(Fa=-Fa),Da<0&&(Da=-Da);var Ga=ii*D+ai*G+si*W,Wa=ii*J+ai*U+si*O;Ga<0&&(Ga=-Ga),Wa<0&&(Wa=-Wa);var Ja=(ct=Fa+Da)+(xt=Ga+Wa),Ua=(pt=ii*m+ai*v+si*b)<0,Oa=Ua?-pt:pt;if(!(Oa<Ja))return;var Ha=Ja-Oa;Ha<_t&&(_t=Ha,ht=14,nt=ii,rt=ai,et=si,lt=Ua?-1:1)}if(ht>=6){nt*=lt,rt*=lt,et*=lt;var Qa,Ka,$a,ts,is,as,ss,os,ns,rs,es,_s,hs,ls,cs,ms=(ht-6)/3|0,vs=ht-6-3*ms;switch(ms){case 0:ss=x,os=p,ns=f;var bs=q*nt+N*rt+F*et>0;j*nt+R*rt+E*et>0?bs?(Qa=j+q,Ka=R+N,$a=E+F):(Qa=j-q,Ka=R-N,$a=E-F):bs?(Qa=q-j,Ka=N-R,$a=F-E):(Qa=-(Qa=j+q),Ka=-(Ka=R+N),$a=-($a=E+F));break;case 1:ss=u,os=y,ns=d;var xs=q*nt+N*rt+F*et>0;S*nt+T*rt+C*et>0?xs?(Qa=S+q,Ka=T+N,$a=C+F):(Qa=S-q,Ka=T-N,$a=C-F):xs?(Qa=q-S,Ka=N-T,$a=F-C):(Qa=-(Qa=S+q),Ka=-(Ka=T+N),$a=-($a=C+F));break;default:ss=g,os=X,ns=z;var ps=j*nt+R*rt+E*et>0;S*nt+T*rt+C*et>0?ps?(Qa=S+j,Ka=T+R,$a=C+E):(Qa=S-j,Ka=T-R,$a=C-E):ps?(Qa=j-S,Ka=R-T,$a=E-C):(Qa=-(Qa=S+j),Ka=-(Ka=T+R),$a=-($a=C+E))}switch(Qa=r+Qa,Ka=e+Ka,$a=_+$a,vs){case 0:rs=Y,es=Z,_s=M;var fs=H*nt+Q*rt+K*et>0;J*nt+U*rt+O*et>0?fs?(ts=J+H,is=U+Q,as=O+K):(ts=J-H,is=U-Q,as=O-K):fs?(ts=H-J,is=Q-U,as=K-O):(ts=-(ts=J+H),is=-(is=U+Q),as=-(as=O+K));break;case 1:rs=I,es=V,_s=w;var us=H*nt+Q*rt+K*et>0;D*nt+G*rt+W*et>0?us?(ts=D+H,is=G+Q,as=W+K):(ts=D-H,is=G-Q,as=W-K):us?(ts=H-D,is=Q-G,as=K-W):(ts=-(ts=D+H),is=-(is=G+Q),as=-(as=W+K));break;default:rs=L,es=k,_s=B;var ys=J*nt+U*rt+O*et>0;D*nt+G*rt+W*et>0?ys?(ts=D+J,is=G+U,as=W+O):(ts=D-J,is=G-U,as=W-O):ys?(ts=J-D,is=U-G,as=O-W):(ts=-(ts=D+J),is=-(is=G+U),as=-(as=W+O))}var ds,gs,Xs,zs,Ys,Zs,Ms,Is,Vs,ws=ss*rs+os*es+ns*_s,Ls=ss*(hs=Qa-(ts=h-ts))+os*(ls=Ka-(is=l-is))+ns*(cs=$a-(as=c-as)),ks=rs*hs+es*ls+_s*cs,Bs=1/(1-ws*ws),As=(ws*ks-Ls)*Bs,Ps=(ks-ws*Ls)*Bs;return ds=Qa+ss*As,gs=Ka+os*As,Xs=$a+ns*As,zs=ts+rs*Ps,Ys=is+es*Ps,Zs=as+_s*Ps,Ms=-nt,Is=-rt,Vs=-et,this.setNormal(t,Ms,Is,Vs),void this.addPoint(t,ds,gs,Xs,zs,Ys,Zs,_t,4)}if(ht>=3){lt=-lt,m=-m,v=-v,b=-b;var Ss=A;A=P,P=Ss;var Ts=$;$=at,at=Ts;var Cs=tt;tt=st,st=Cs;var js=it;it=ot,ot=js,oi=r,ni=e,ri=_,r=h,e=l,_=c,h=oi,l=ni,c=ri,oi=x,ni=p,ri=f,x=Y,p=Z,f=M,Y=oi,Z=ni,M=ri,oi=u,ni=y,ri=d,u=I,y=V,d=w,I=oi,V=ni,w=ri,oi=g,ni=X,ri=z,g=L,X=k,z=B,L=oi,k=ni,B=ri,oi=S,ni=T,ri=C,S=D,T=G,C=W,D=oi,G=ni,W=ri,oi=j,ni=R,ri=E,j=J,R=U,E=O,J=oi,U=ni,O=ri,oi=q,ni=N,ri=F,q=H,N=Q,F=K,H=oi,Q=ni,K=ri,ht-=3,ei=!0}else ei=!1;switch(ht){case 0:_i=S,hi=T,li=C,ci=x,mi=p,vi=f,bi=u,xi=y,pi=d,fi=g,ui=X,yi=z,di=tt,gi=it;break;case 1:_i=j,hi=R,li=E,ci=u,mi=y,vi=d,bi=g,xi=X,pi=z,fi=x,ui=p,yi=f,di=it,gi=$;break;default:_i=q,hi=N,li=F,ci=g,mi=X,vi=z,bi=x,xi=p,pi=f,fi=u,ui=y,yi=d,di=$,gi=tt}if(lt<0){_i=-_i,hi=-hi,li=-li,ci=-ci,mi=-mi,vi=-vi,oi=bi,ni=xi,ri=pi,bi=fi,xi=ui,pi=yi,fi=oi,ui=ni,yi=ri;var Rs=di;di=gi,gi=Rs}_i+=r,hi+=e,li+=_;var Es,qs,Ns,Fs,Ds,Gs,Ws,Js,Us,Os,Hs,Qs,Ks=1,$s=0,to=ci*Y+mi*Z+vi*M;switch(to<Ks&&(Ks=to,$s=0),-to<Ks&&(Ks=-to,$s=1),(to=ci*I+mi*V+vi*w)<Ks&&(Ks=to,$s=2),-to<Ks&&(Ks=-to,$s=3),(to=ci*L+mi*k+vi*B)<Ks&&(Ks=to,$s=4),-to<Ks&&(Ks=-to,$s=5),$s){case 0:Es=D+J,qs=G+U,Ns=W+O,Es+=H,qs+=Q,Ns+=K,Fs=D-J,Ds=G-U,Gs=W-O,Fs+=H,Ds+=Q,Gs+=K,Ws=D-J,Js=G-U,Us=W-O,Ws-=H,Js-=Q,Us-=K,Os=D+J,Hs=G+U,Qs=W+O,Os-=H,Hs-=Q,Qs-=K;break;case 1:Es=J-D,qs=U-G,Ns=O-W,Es+=H,qs+=Q,Ns+=K,Fs=J-D,Ds=U-G,Gs=O-W,Fs-=H,Ds-=Q,Gs-=K,Ws=-(Ws=D+J),Js=-(Js=G+U),Us=-(Us=W+O),Ws-=H,Js-=Q,Us-=K,Os=-(Os=D+J),Hs=-(Hs=G+U),Qs=-(Qs=W+O),Os+=H,Hs+=Q,Qs+=K;break;case 2:Es=D+J,qs=G+U,Ns=W+O,Es+=H,qs+=Q,Ns+=K,Fs=D+J,Ds=G+U,Gs=W+O,Fs-=H,Ds-=Q,Gs-=K,Ws=J-D,Js=U-G,Us=O-W,Ws-=H,Js-=Q,Us-=K,Os=J-D,Hs=U-G,Qs=O-W,Os+=H,Hs+=Q,Qs+=K;break;case 3:Es=D-J,qs=G-U,Ns=W-O,Es+=H,qs+=Q,Ns+=K,Fs=-(Fs=D+J),Ds=-(Ds=G+U),Gs=-(Gs=W+O),Fs+=H,Ds+=Q,Gs+=K,Ws=-(Ws=D+J),Js=-(Js=G+U),Us=-(Us=W+O),Ws-=H,Js-=Q,Us-=K,Os=D-J,Hs=G-U,Qs=W-O,Os-=H,Hs-=Q,Qs-=K;break;case 4:Es=D+J,qs=G+U,Ns=W+O,Es+=H,qs+=Q,Ns+=K,Fs=J-D,Ds=U-G,Gs=O-W,Fs+=H,Ds+=Q,Gs+=K,Ws=-(Ws=D+J),Js=-(Js=G+U),Us=-(Us=W+O),Ws+=H,Js+=Q,Us+=K,Os=D-J,Hs=G-U,Qs=W-O,Os+=H,Hs+=Q,Qs+=K;break;default:Es=D+J,qs=G+U,Ns=W+O,Es-=H,qs-=Q,Ns-=K,Fs=D-J,Ds=G-U,Gs=W-O,Fs-=H,Ds-=Q,Gs-=K,Ws=-(Ws=D+J),Js=-(Js=G+U),Us=-(Us=W+O),Ws-=H,Js-=Q,Us-=K,Os=J-D,Hs=U-G,Qs=O-W,Os-=H,Hs-=Q,Qs-=K}Es+=m,qs+=v,Ns+=b,Fs+=m,Ds+=v,Gs+=b,Ws+=m,Js+=v,Us+=b,Os+=m,Hs+=v,Qs+=b;var io=this.clipper;io.w=di,io.h=gi,io.numVertices=0,io.numTmpVertices=0;var ao=this.clipper,so=ao.vertices[ao.numVertices++];so.x=Es*bi+qs*xi+Ns*pi,so.y=Es*fi+qs*ui+Ns*yi,so.wx=Es,so.wy=qs,so.wz=Ns;var oo=this.clipper,no=oo.vertices[oo.numVertices++];no.x=Fs*bi+Ds*xi+Gs*pi,no.y=Fs*fi+Ds*ui+Gs*yi,no.wx=Fs,no.wy=Ds,no.wz=Gs;var ro=this.clipper,eo=ro.vertices[ro.numVertices++];eo.x=Ws*bi+Js*xi+Us*pi,eo.y=Ws*fi+Js*ui+Us*yi,eo.wx=Ws,eo.wy=Js,eo.wz=Us;var _o,ho,lo,co=this.clipper,mo=co.vertices[co.numVertices++];mo.x=Os*bi+Hs*xi+Qs*pi,mo.y=Os*fi+Hs*ui+Qs*yi,mo.wx=Os,mo.wy=Hs,mo.wz=Qs,this.clipper.clip(),this.clipper.reduce(),ei?(_o=ci,ho=mi,lo=vi):(_o=-ci,ho=-mi,lo=-vi),this.setNormal(t,_o,ho,lo);for(var vo=0,bo=this.clipper.numVertices;vo<bo;){var xo,po,fo,uo=vo++,yo=this.clipper.vertices[uo];xo=yo.wx,po=yo.wy,fo=yo.wz;var go,Xo,zo,Yo=(_i-(xo+=r))*ci+(hi-(po+=e))*mi+(li-(fo+=_))*vi;go=xo+ci*Yo,Xo=po+mi*Yo,zo=fo+vi*Yo,Yo>-pa.common.Setting.contactPersistenceThreshold&&(ei?this.addPoint(t,xo,po,fo,go,Xo,zo,Yo,uo):this.addPoint(t,go,Xo,zo,xo,po,fo,Yo,uo))}}}}}}}}},pa.collision.narrowphase.detector._BoxBoxDetector||(pa.collision.narrowphase.detector._BoxBoxDetector={}),pa.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex=class{constructor(){this.x=0,this.y=0,this.wx=0,this.wy=0,this.wz=0}},pa.collision.narrowphase.detector._BoxBoxDetector.FaceClipper=class{constructor(){this.w=0,this.h=0,this.numVertices=0,this.numTmpVertices=0;var t=new Array(8);this.vertices=t;var i=new Array(8);this.tmpVertices=i,this.vertices[0]=new pa.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[0]=new pa.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[1]=new pa.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[1]=new pa.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[2]=new pa.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[2]=new pa.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[3]=new pa.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[3]=new pa.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[4]=new pa.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[4]=new pa.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[5]=new pa.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[5]=new pa.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[6]=new pa.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[6]=new pa.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[7]=new pa.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[7]=new pa.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex}clip(){for(var t=0,i=this.numVertices;t<i;){var a=t++,s=this.vertices[a],o=this.vertices[(a+1)%this.numVertices],n=this.w+s.x,r=this.w+o.x;if(n>0&&r>0){var e=this.tmpVertices[this.numTmpVertices++];e.x=s.x,e.y=s.y,e.wx=s.wx,e.wy=s.wy,e.wz=s.wz}else if(n>0&&r<=0){var _=this.tmpVertices[this.numTmpVertices++];_.x=s.x,_.y=s.y,_.wx=s.wx,_.wy=s.wy,_.wz=s.wz;var h=n/(n-r),l=this.tmpVertices[this.numTmpVertices++];l.x=s.x+(o.x-s.x)*h,l.y=s.y+(o.y-s.y)*h,l.wx=s.wx+(o.wx-s.wx)*h,l.wy=s.wy+(o.wy-s.wy)*h,l.wz=s.wz+(o.wz-s.wz)*h}else if(n<=0&&r>0){var c=n/(n-r),m=this.tmpVertices[this.numTmpVertices++];m.x=s.x+(o.x-s.x)*c,m.y=s.y+(o.y-s.y)*c,m.wx=s.wx+(o.wx-s.wx)*c,m.wy=s.wy+(o.wy-s.wy)*c,m.wz=s.wz+(o.wz-s.wz)*c}}var v=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=v,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var b=0,x=this.numVertices;b<x;){var p=b++,f=this.vertices[p],u=this.vertices[(p+1)%this.numVertices],y=this.w-f.x,d=this.w-u.x;if(y>0&&d>0){var g=this.tmpVertices[this.numTmpVertices++];g.x=f.x,g.y=f.y,g.wx=f.wx,g.wy=f.wy,g.wz=f.wz}else if(y>0&&d<=0){var X=this.tmpVertices[this.numTmpVertices++];X.x=f.x,X.y=f.y,X.wx=f.wx,X.wy=f.wy,X.wz=f.wz;var z=y/(y-d),Y=this.tmpVertices[this.numTmpVertices++];Y.x=f.x+(u.x-f.x)*z,Y.y=f.y+(u.y-f.y)*z,Y.wx=f.wx+(u.wx-f.wx)*z,Y.wy=f.wy+(u.wy-f.wy)*z,Y.wz=f.wz+(u.wz-f.wz)*z}else if(y<=0&&d>0){var Z=y/(y-d),M=this.tmpVertices[this.numTmpVertices++];M.x=f.x+(u.x-f.x)*Z,M.y=f.y+(u.y-f.y)*Z,M.wx=f.wx+(u.wx-f.wx)*Z,M.wy=f.wy+(u.wy-f.wy)*Z,M.wz=f.wz+(u.wz-f.wz)*Z}}var I=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=I,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var V=0,w=this.numVertices;V<w;){var L=V++,k=this.vertices[L],B=this.vertices[(L+1)%this.numVertices],A=this.h+k.y,P=this.h+B.y;if(A>0&&P>0){var S=this.tmpVertices[this.numTmpVertices++];S.x=k.x,S.y=k.y,S.wx=k.wx,S.wy=k.wy,S.wz=k.wz}else if(A>0&&P<=0){var T=this.tmpVertices[this.numTmpVertices++];T.x=k.x,T.y=k.y,T.wx=k.wx,T.wy=k.wy,T.wz=k.wz;var C=A/(A-P),j=this.tmpVertices[this.numTmpVertices++];j.x=k.x+(B.x-k.x)*C,j.y=k.y+(B.y-k.y)*C,j.wx=k.wx+(B.wx-k.wx)*C,j.wy=k.wy+(B.wy-k.wy)*C,j.wz=k.wz+(B.wz-k.wz)*C}else if(A<=0&&P>0){var R=A/(A-P),E=this.tmpVertices[this.numTmpVertices++];E.x=k.x+(B.x-k.x)*R,E.y=k.y+(B.y-k.y)*R,E.wx=k.wx+(B.wx-k.wx)*R,E.wy=k.wy+(B.wy-k.wy)*R,E.wz=k.wz+(B.wz-k.wz)*R}}var q=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=q,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var N=0,F=this.numVertices;N<F;){var D=N++,G=this.vertices[D],W=this.vertices[(D+1)%this.numVertices],J=this.h-G.y,U=this.h-W.y;if(J>0&&U>0){var O=this.tmpVertices[this.numTmpVertices++];O.x=G.x,O.y=G.y,O.wx=G.wx,O.wy=G.wy,O.wz=G.wz}else if(J>0&&U<=0){var H=this.tmpVertices[this.numTmpVertices++];H.x=G.x,H.y=G.y,H.wx=G.wx,H.wy=G.wy,H.wz=G.wz;var Q=J/(J-U),K=this.tmpVertices[this.numTmpVertices++];K.x=G.x+(W.x-G.x)*Q,K.y=G.y+(W.y-G.y)*Q,K.wx=G.wx+(W.wx-G.wx)*Q,K.wy=G.wy+(W.wy-G.wy)*Q,K.wz=G.wz+(W.wz-G.wz)*Q}else if(J<=0&&U>0){var $=J/(J-U),tt=this.tmpVertices[this.numTmpVertices++];tt.x=G.x+(W.x-G.x)*$,tt.y=G.y+(W.y-G.y)*$,tt.wx=G.wx+(W.wx-G.wx)*$,tt.wy=G.wy+(W.wy-G.wy)*$,tt.wz=G.wz+(W.wz-G.wz)*$}}var it=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=it,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}reduce(){if(!(this.numVertices<4)){for(var t=-1/0,i=Infinity,a=-1/0,s=Infinity,o=null,n=null,r=null,e=null,_=0,h=this.numVertices;_<h;){var l=_++,c=this.vertices[l],m=1*c.x+1*c.y,v=-1*c.x+1*c.y;m>t&&(t=m,o=c),m<i&&(i=m,n=c),v>a&&(a=v,r=c),v<s&&(s=v,e=c)}var b=this.tmpVertices[this.numTmpVertices++];b.x=o.x,b.y=o.y,b.wx=o.wx,b.wy=o.wy,b.wz=o.wz;var x=this.tmpVertices[this.numTmpVertices++];x.x=r.x,x.y=r.y,x.wx=r.wx,x.wy=r.wy,x.wz=r.wz;var p=this.tmpVertices[this.numTmpVertices++];p.x=n.x,p.y=n.y,p.wx=n.wx,p.wy=n.wy,p.wz=n.wz;var f=this.tmpVertices[this.numTmpVertices++];f.x=e.x,f.y=e.y,f.wx=e.wx,f.wy=e.wy,f.wz=e.wz;var u=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=u,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}}},pa.collision.narrowphase.detector.BoxBoxDetectorMacro=class{},pa.collision.narrowphase.detector.CachedDetectorData=class{constructor(){}_clear(){null!=this._gjkCache&&this._gjkCache.clear()}},pa.collision.narrowphase.detector.CapsuleCapsuleDetector=class extends pa.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,i,a,s,o,n){var r,e,_,h,l,c,m=i,v=a;t.incremental=!1,r=s._rotation01,e=s._rotation11,_=s._rotation21,h=o._rotation01,l=o._rotation11,c=o._rotation21;var b,x,p,f,u,y,d,g,X,z,Y,Z,M,I,V,w,L,k,B=m._halfHeight,A=v._halfHeight,P=m._radius,S=v._radius;b=s._positionX+r*-B,x=s._positionY+e*-B,p=s._positionZ+_*-B,f=s._positionX+r*B,u=s._positionY+e*B,y=s._positionZ+_*B;var T,C,j,R,E,q,N,F,D,G,W,J=-((z=b-(d=o._positionX+h*-A))*(M=f-b)+(Y=x-(g=o._positionY+l*-A))*(I=u-x)+(Z=p-(X=o._positionZ+c*-A))*(V=y-p)),U=z*(w=o._positionX+h*A-d)+Y*(L=o._positionY+l*A-g)+Z*(k=o._positionZ+c*A-X),O=B*B*4,H=M*w+I*L+V*k,Q=A*A*4;if(0==O&&0==Q)T=0,C=0;else if(0==O)T=0,(C=U)<0?C=0:C>Q?C=1:C/=Q;else if(0==Q)C=0,(T=J)<0?T=0:T>O?T=1:T/=O;else{var K=O*Q-H*H;0==K||(T=H*U+Q*J)<0?T=0:T>K?T=1:T/=K,(C=T*H+U)<0?(C=0,(T=J)<0?T=0:T>O?T=1:T/=O):C>Q?(C=1,(T=H+J)<0?T=0:T>O?T=1:T/=O):C/=Q}var $=(D=(j=b+M*T)-(q=d+w*C))*D+(G=(R=x+I*T)-(N=g+L*C))*G+(W=(E=p+V*T)-(F=X+k*C))*W;if(!($>=(P+S)*(P+S))){var tt,it,at,st,ot,nt,rt,et,_t,ht=Math.sqrt($);ht>0?(tt=D*(1/ht),it=G*(1/ht),at=W*(1/ht)):(tt=1,it=0,at=0),this.setNormal(t,tt,it,at),st=j+tt*-P,ot=R+it*-P,nt=E+at*-P,rt=q+tt*S,et=N+it*S,_t=F+at*S,this.addPoint(t,st,ot,nt,rt,et,_t,P+S-ht,0)}}},pa.collision.narrowphase.detector.GjkEpaDetector=class extends pa.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,i,a,s,o,n){var r=pa.collision.narrowphase.detector.gjkepa.GjkEpa.instance,e=i,_=a,h=r.computeClosestPointsImpl(e,_,s,o,pa.common.Setting.enableGJKCaching?n:null,!0);if(t.incremental=!0,h==pa.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED){var l=e._gjkMargin,c=_._gjkMargin;if(!(r.distance>l+c)){var m,v,b,x,p,f,u=r.closestPoint1;m=u.x,v=u.y,b=u.z;var y,d,g,X=r.closestPoint2;if((y=m-(x=X.x))*y+(d=v-(p=X.y))*d+(g=b-(f=X.z))*g!=0){r.distance<0&&(y=-y,d=-d,g=-g);var z=y*y+d*d+g*g;z>0&&(z=1/Math.sqrt(z)),y*=z,d*=z,g*=z,this.setNormal(t,y,d,g),m+=y*-e._gjkMargin,v+=d*-e._gjkMargin,b+=g*-e._gjkMargin,x+=y*_._gjkMargin,p+=d*_._gjkMargin,f+=g*_._gjkMargin,this.addPoint(t,m,v,b,x,p,f,e._gjkMargin+_._gjkMargin-r.distance,0)}}}else console.log("src/oimo/collision/narrowphase/detector/GjkEpaDetector.hx:28:","GJK/EPA failed: status="+h)}},pa.collision.narrowphase.detector.SphereBoxDetector=class extends pa.collision.narrowphase.detector.Detector{constructor(t){super(t)}detectImpl(t,i,a,s,o,n){var r,e,_,h,l,c,m=i,v=a;t.incremental=!1,h=-(r=v._halfExtentsX),l=-(e=v._halfExtentsY),c=-(_=v._halfExtentsZ);var b,x,p,f,u,y,d,g,X,z,Y=m._radius;if(b=s._positionX-o._positionX,x=s._positionY-o._positionY,p=s._positionZ-o._positionZ,d=o._rotation00*b+o._rotation10*x+o._rotation20*p,u=o._rotation01*b+o._rotation11*x+o._rotation21*p,y=o._rotation02*b+o._rotation12*x+o._rotation22*p,h<(f=d)&&r>f&&l<u&&e>u&&c<y&&_>y){var Z,M,I,V,w,L,k,B,A,P,S,T,C,j,R,E,q,N,F,D,G,W,J,U,O;Z=r-(Z=f<0?-f:f),M=e-(M=u<0?-u:u),I=_-(I=y<0?-y:y);return Z<M?Z<I?(f>0?(V=1,w=0,L=0):(V=-1,w=0,L=0),B=0,A=1,P=1,k=Z):(y>0?(V=0,w=0,L=1):(V=0,w=0,L=-1),B=1,A=1,P=0,k=I):M<I?(u>0?(V=0,w=1,L=0):(V=0,w=-1,L=0),B=1,A=0,P=1,k=M):(y>0?(V=0,w=0,L=1):(V=0,w=0,L=-1),B=1,A=1,P=0,k=I),S=V*r,T=w*e,C=L*_,S+=B*f,T+=A*u,C+=P*y,j=o._rotation00*S+o._rotation01*T+o._rotation02*C,R=o._rotation10*S+o._rotation11*T+o._rotation12*C,E=o._rotation20*S+o._rotation21*T+o._rotation22*C,q=o._rotation00*V+o._rotation01*w+o._rotation02*L,N=o._rotation10*V+o._rotation11*w+o._rotation12*L,F=o._rotation20*V+o._rotation21*w+o._rotation22*L,this.setNormal(t,q,N,F),D=s._positionX+q*-Y,G=s._positionY+N*-Y,W=s._positionZ+F*-Y,J=o._positionX+j,U=o._positionY+R,O=o._positionZ+E,void this.addPoint(t,D,G,W,J,U,O,k,0)}var H,Q,K,$,tt,it,at=1e-9,st=($=f-(g=(g=f<(r-=H=at)?f:r)>(h+=H)?g:h))*$+(tt=u-(X=(X=u<(e-=Q=at)?u:e)>(l+=Q)?X:l))*tt+(it=y-(z=(z=y<(_-=K=at)?y:_)>(c+=K)?z:c))*it;if(!(st>=Y*Y)){var ot,nt,rt,et,_t,ht,lt,ct,mt;st=Math.sqrt(st),ot=o._rotation00*g+o._rotation01*X+o._rotation02*z,nt=o._rotation10*g+o._rotation11*X+o._rotation12*z,rt=o._rotation20*g+o._rotation21*X+o._rotation22*z;var vt,bt,xt,pt,ft,ut,yt=(et=o._rotation00*$+o._rotation01*tt+o._rotation02*it)*et+(_t=o._rotation10*$+o._rotation11*tt+o._rotation12*it)*_t+(ht=o._rotation20*$+o._rotation21*tt+o._rotation22*it)*ht;yt>0&&(yt=1/Math.sqrt(yt)),lt=et*yt,ct=_t*yt,mt=ht*yt,this.setNormal(t,lt,ct,mt),vt=s._positionX+lt*-Y,bt=s._positionY+ct*-Y,xt=s._positionZ+mt*-Y,pt=o._positionX+ot,ft=o._positionY+nt,ut=o._positionZ+rt,this.addPoint(t,vt,bt,xt,pt,ft,ut,Y-st,0)}}},pa.collision.narrowphase.detector.SphereCapsuleDetector=class extends pa.collision.narrowphase.detector.Detector{constructor(t){super(t)}detectImpl(t,i,a,s,o,n){var r=i,e=a;t.incremental=!1;var _,h,l,c,m,v,b,x,p,f,u,y,d=e._halfHeight,g=r._radius,X=e._radius;_=o._rotation01,h=o._rotation11,l=o._rotation21,c=s._positionX,m=s._positionY,v=s._positionZ,b=o._positionX+_*-d,x=o._positionY+h*-d,p=o._positionZ+l*-d;var z,Y,Z,M,I,V,w=d*d*4,L=(c-b)*(f=o._positionX+_*d-b)+(m-x)*(u=o._positionY+h*d-x)+(v-p)*(y=o._positionZ+l*d-p);L<0?L=0:L>w?L=1:L/=w;var k=(M=c-(z=b+f*L))*M+(I=m-(Y=x+u*L))*I+(V=v-(Z=p+y*L))*V;if(!(k>=(g+X)*(g+X))){var B,A,P,S,T,C,j,R,E,q=Math.sqrt(k);q>0?(B=M*(1/q),A=I*(1/q),P=V*(1/q)):(B=1,A=0,P=0),this.setNormal(t,B,A,P),S=c+B*-g,T=m+A*-g,C=v+P*-g,j=z+B*X,R=Y+A*X,E=Z+P*X,this.addPoint(t,S,T,C,j,R,E,g+X-q,0)}}},pa.collision.narrowphase.detector.SphereSphereDetector=class extends pa.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,i,a,s,o,n){var r,e,_,h=i,l=a;t.incremental=!1,r=s._positionX-o._positionX,e=s._positionY-o._positionY,_=s._positionZ-o._positionZ;var c=h._radius,m=l._radius,v=r*r+e*e+_*_;if(!(v>=(c+m)*(c+m))){var b,x,p,f,u,y,d,g,X,z=Math.sqrt(v);z>0?(b=r*(1/z),x=e*(1/z),p=_*(1/z)):(b=1,x=0,p=0),this.setNormal(t,b,x,p),f=s._positionX+b*-c,u=s._positionY+x*-c,y=s._positionZ+p*-c,d=o._positionX+b*m,g=o._positionY+x*m,X=o._positionZ+p*m,this.addPoint(t,f,u,y,d,g,X,c+m-z,0)}}},pa.collision.narrowphase.detector.gjkepa||(pa.collision.narrowphase.detector.gjkepa={}),pa.collision.narrowphase.detector.gjkepa.EpaPolyhedron=class{constructor(){var t=new Array(pa.common.Setting.maxEPAVertices);this._vertices=t,this._center=new pa.common.Vec3,this._numVertices=0,this._triangleList=null,this._triangleListLast=null,this._numTriangles=0,this._trianglePool=null,this._vertexPool=null}dumpHoleEdge(t){}validate(){for(var t=this._triangleList;null!=t;){var i=t._next;if(t._vertices[0]._tmpEdgeLoopOuterTriangle=null,t._vertices[0]._tmpEdgeLoopNext=null,-1==t._adjacentPairIndex[0])return this._status=2,!1;if(null==t._adjacentTriangles[0])return this._status=3,!1;if(t._vertices[1]._tmpEdgeLoopOuterTriangle=null,t._vertices[1]._tmpEdgeLoopNext=null,-1==t._adjacentPairIndex[1])return this._status=2,!1;if(null==t._adjacentTriangles[1])return this._status=3,!1;if(t._vertices[2]._tmpEdgeLoopOuterTriangle=null,t._vertices[2]._tmpEdgeLoopNext=null,-1==t._adjacentPairIndex[2])return this._status=2,!1;if(null==t._adjacentTriangles[2])return this._status=3,!1;t=i}return!0}findEdgeLoop(t,i,a){if(i._tmpDfsId!=t){i._tmpDfsId=t;var s=i.tmp;s.x=a.x,s.y=a.y,s.z=a.z;var o=s,n=i._vertices[0].v,r=o.x-n.x,e=o.y-n.y,_=o.z-n.z;o.x=r,o.y=e,o.z=_;var h=i.tmp,l=i._normal;if(i._tmpDfsVisible=h.x*l.x+h.y*l.y+h.z*l.z>0,i._tmpDfsVisible){for(var c=0;c<3;){var m=c++,v=i._adjacentTriangles[m];if(null!=v){var b=v.tmp;b.x=a.x,b.y=a.y,b.z=a.z;var x=b,p=v._vertices[0].v,f=x.x-p.x,u=x.y-p.y,y=x.z-p.z;x.x=f,x.y=u,x.z=y;var d=v.tmp,g=v._normal;if(v._tmpDfsVisible=d.x*g.x+d.y*g.y+d.z*g.z>0,v._tmpDfsVisible)this.findEdgeLoop(t,v,a);else{var X=i._nextIndex[m],z=i._vertices[m],Y=i._vertices[X];z._tmpEdgeLoopNext=Y,z._tmpEdgeLoopOuterTriangle=v}}}var Z=i._adjacentTriangles[0];if(null!=Z){var M=i._adjacentPairIndex[0];Z._adjacentTriangles[M]=null,Z._adjacentPairIndex[M]=-1,i._adjacentTriangles[0]=null,i._adjacentPairIndex[0]=-1}var I=i._adjacentTriangles[1];if(null!=I){var V=i._adjacentPairIndex[1];I._adjacentTriangles[V]=null,I._adjacentPairIndex[V]=-1,i._adjacentTriangles[1]=null,i._adjacentPairIndex[1]=-1}var w=i._adjacentTriangles[2];if(null!=w){var L=i._adjacentPairIndex[2];w._adjacentTriangles[L]=null,w._adjacentPairIndex[L]=-1,i._adjacentTriangles[2]=null,i._adjacentPairIndex[2]=-1}this._numTriangles--;var k=i._prev,B=i._next;null!=k&&(k._next=B),null!=B&&(B._prev=k),i==this._triangleList&&(this._triangleList=this._triangleList._next),i==this._triangleListLast&&(this._triangleListLast=this._triangleListLast._prev),i._next=null,i._prev=null,i.removeReferences(),i._next=this._trianglePool,this._trianglePool=i}else this._status=6}}_init(t,i,a,s){this._status=0,this._numVertices=4,this._vertices[0]=t,this._vertices[1]=i,this._vertices[2]=a,this._vertices[3]=s;var o=this._center,n=t.v;o.x=n.x,o.y=n.y,o.z=n.z;var r=o,e=i.v,_=r.x+e.x,h=r.y+e.y,l=r.z+e.z;r.x=_,r.y=h,r.z=l;var c=r,m=a.v,v=c.x+m.x,b=c.y+m.y,x=c.z+m.z;c.x=v,c.y=b,c.z=x;var p=c,f=s.v,u=p.x+f.x,y=p.y+f.y,d=p.z+f.z;p.x=u,p.y=y,p.z=d;var g=p,X=.25*g.x,z=.25*g.y,Y=.25*g.z;g.x=X,g.y=z,g.z=Y;var Z=this._trianglePool;null!=Z?(this._trianglePool=Z._next,Z._next=null):Z=new pa.collision.narrowphase.detector.gjkepa.EpaTriangle;var M=Z,I=this._trianglePool;null!=I?(this._trianglePool=I._next,I._next=null):I=new pa.collision.narrowphase.detector.gjkepa.EpaTriangle;var V=I,w=this._trianglePool;null!=w?(this._trianglePool=w._next,w._next=null):w=new pa.collision.narrowphase.detector.gjkepa.EpaTriangle;var L=w,k=this._trianglePool;null!=k?(this._trianglePool=k._next,k._next=null):k=new pa.collision.narrowphase.detector.gjkepa.EpaTriangle;var B=k;M.init(t,i,a,this._center,!0)||(this._status=1);V.init(t,i,s,this._center,!0)||(this._status=1);L.init(t,a,s,this._center,!0)||(this._status=1);return B.init(i,a,s,this._center,!0)||(this._status=1),M.setAdjacentTriangle(V)||(this._status=1),M.setAdjacentTriangle(L)||(this._status=1),M.setAdjacentTriangle(B)||(this._status=1),V.setAdjacentTriangle(L)||(this._status=1),V.setAdjacentTriangle(B)||(this._status=1),L.setAdjacentTriangle(B)||(this._status=1),this._numTriangles++,null==this._triangleList?(this._triangleList=M,this._triangleListLast=M):(this._triangleListLast._next=M,M._prev=this._triangleListLast,this._triangleListLast=M),this._numTriangles++,null==this._triangleList?(this._triangleList=V,this._triangleListLast=V):(this._triangleListLast._next=V,V._prev=this._triangleListLast,this._triangleListLast=V),this._numTriangles++,null==this._triangleList?(this._triangleList=L,this._triangleListLast=L):(this._triangleListLast._next=L,L._prev=this._triangleListLast,this._triangleListLast=L),this._numTriangles++,null==this._triangleList?(this._triangleList=B,this._triangleListLast=B):(this._triangleListLast._next=B,B._prev=this._triangleListLast,this._triangleListLast=B),0==this._status}_addVertex(t,i){this._vertices[this._numVertices++]=t;var a=i._vertices[0];if(this.findEdgeLoop(this._numVertices,i,t.v),0!=this._status)return!1;for(var s=a,o=a,n=null,r=null;;){if(null==s._tmpEdgeLoopNext)return this._dumpAsObjModel(),this._status=4,!1;if(null==s._tmpEdgeLoopOuterTriangle)return this._status=5,!1;var e=this._trianglePool;null!=e?(this._trianglePool=e._next,e._next=null):e=new pa.collision.narrowphase.detector.gjkepa.EpaTriangle;var _=e;if(null==r&&(r=_),_.init(s,s._tmpEdgeLoopNext,t,this._center,!1)||(this._status=1),0!=this._status)return!1;if(this._numTriangles++,null==this._triangleList?(this._triangleList=_,this._triangleListLast=_):(this._triangleListLast._next=_,_._prev=this._triangleListLast,this._triangleListLast=_),_.setAdjacentTriangle(s._tmpEdgeLoopOuterTriangle)||(this._status=1),null!=n&&(_.setAdjacentTriangle(n)||(this._status=1)),n=_,(s=s._tmpEdgeLoopNext)==o)break}return n.setAdjacentTriangle(r)||(this._status=1),0==this._status&&this.validate()}_dumpAsObjModel(){}},pa.collision.narrowphase.detector.gjkepa.EpaPolyhedronState=class{},pa.collision.narrowphase.detector.gjkepa.EpaTriangle=class{constructor(){this.id=++pa.collision.narrowphase.detector.gjkepa.EpaTriangle.count,this._next=null,this._prev=null,this._normal=new pa.common.Vec3,this._distanceSq=0,this._tmpDfsId=0,this._tmpDfsVisible=!1;var t=new Array(3);this._vertices=t;var i=new Array(3);this._adjacentTriangles=i;var a=new Array(3);this._adjacentPairIndex=a,this.tmp=new pa.common.Vec3;var s=new Array(3);this._nextIndex=s,this._nextIndex[0]=1,this._nextIndex[1]=2,this._nextIndex[2]=0}init(t,i,a,s,o){var n,r,e,_,h,l,c,m,v;null==o&&(o=!1);var b=t.v;n=b.x,r=b.y,e=b.z;var x=i.v;_=x.x,h=x.y,l=x.z;var p=a.v;c=p.x,m=p.y,v=p.z;var f,u,y,d,g,X,z,Y,Z,M=s,I=!1;if((n-M.x)*(z=(u=h-r)*(X=v-e)-(y=l-e)*(g=m-r))+(r-M.y)*(Y=y*(d=c-n)-(f=_-n)*X)+(e-M.z)*(Z=f*g-u*d)<0)if(o){var V=i;i=a,a=V,z*=-1,Y*=-1,Z*=-1}else I=!0;this._vertices[0]=t,this._vertices[1]=i,this._vertices[2]=a;var w=this._normal;w.x=z,w.y=Y,w.z=Z;var L,k,B,A,P,S,T,C,j,R,E,q,N,F,D,G,W,J,U=t.v,O=i.v,H=a.v,Q=this.tmp,K=U;L=K.x,k=K.y,B=K.z;var $=O;A=$.x,P=$.y,S=$.z;var tt,it,at,st=H;T=st.x;var ot,nt,rt,et=A*((F=(C=st.y)-P)*(at=(R=A-L)*F-(E=P-k)*(N=T-A))-(D=(j=st.z)-S)*(it=(q=S-B)*N-R*D))+P*(D*(tt=E*D-q*F)-N*at)+S*(N*it-F*tt),_t=T*((W=k-C)*at-(J=B-j)*it)+C*(J*tt-(G=L-T)*at)+j*(G*it-W*tt),ht=-1;if(ot=0,nt=0,rt=0,L*(E*at-q*it)+k*(q*tt-R*at)+B*(R*it-E*tt)<0){var lt,ct,mt,vt,bt,xt,pt=U;lt=pt.x,ct=pt.y,mt=pt.z;var ft,ut,yt,dt=O,gt=(ft=(vt=dt.x)-lt)*lt+(ut=(bt=dt.y)-ct)*ct+(yt=(xt=dt.z)-mt)*mt;if((gt=-gt/(ft*ft+ut*ut+yt*yt))<0){var Xt=Q;Xt.x=lt,Xt.y=ct,Xt.z=mt}else if(gt>1){var zt=Q;zt.x=vt,zt.y=bt,zt.z=xt}else{var Yt,Zt,Mt;Yt=lt+ft*gt,Zt=ct+ut*gt,Mt=mt+yt*gt;var It=Q;It.x=Yt,It.y=Zt,It.z=Mt}ht=Q.x*Q.x+Q.y*Q.y+Q.z*Q.z;var Vt=Q;ot=Vt.x,nt=Vt.y,rt=Vt.z}if(et<0){var wt,Lt,kt,Bt,At,Pt,St=O;wt=St.x,Lt=St.y,kt=St.z;var Tt,Ct,jt,Rt=H,Et=(Tt=(Bt=Rt.x)-wt)*wt+(Ct=(At=Rt.y)-Lt)*Lt+(jt=(Pt=Rt.z)-kt)*kt;if((Et=-Et/(Tt*Tt+Ct*Ct+jt*jt))<0){var qt=Q;qt.x=wt,qt.y=Lt,qt.z=kt}else if(Et>1){var Nt=Q;Nt.x=Bt,Nt.y=At,Nt.z=Pt}else{var Ft,Dt,Gt;Ft=wt+Tt*Et,Dt=Lt+Ct*Et,Gt=kt+jt*Et;var Wt=Q;Wt.x=Ft,Wt.y=Dt,Wt.z=Gt}var Jt=Q.x*Q.x+Q.y*Q.y+Q.z*Q.z;if(ht<0||Jt<ht){ht=Jt;var Ut=Q;ot=Ut.x,nt=Ut.y,rt=Ut.z}}if(_t<0){var Ot,Ht,Qt,Kt,$t,ti,ii=U;Ot=ii.x,Ht=ii.y,Qt=ii.z;var ai,si,oi,ni=H,ri=(ai=(Kt=ni.x)-Ot)*Ot+(si=($t=ni.y)-Ht)*Ht+(oi=(ti=ni.z)-Qt)*Qt;if((ri=-ri/(ai*ai+si*si+oi*oi))<0){var ei=Q;ei.x=Ot,ei.y=Ht,ei.z=Qt}else if(ri>1){var _i=Q;_i.x=Kt,_i.y=$t,_i.z=ti}else{var hi,li,ci;hi=Ot+ai*ri,li=Ht+si*ri,ci=Qt+oi*ri;var mi=Q;mi.x=hi,mi.y=li,mi.z=ci}var vi=Q.x*Q.x+Q.y*Q.y+Q.z*Q.z;if(ht<0||vi<ht){ht=vi;var bi=Q;ot=bi.x,nt=bi.y,rt=bi.z}}if(ht>0){var xi=Q;xi.x=ot,xi.y=nt,xi.z=rt}else{var pi=tt*tt+it*it+at*at;pi>0&&(pi=1/Math.sqrt(pi));var fi=(tt*=pi)*tt+(it*=pi)*it+(at*=pi)*at;ot=tt*(fi=(L*tt+k*it+B*at)/fi),nt=it*fi,rt=at*fi;var ui=Q;ui.x=ot,ui.y=nt,ui.z=rt}var yi=this.tmp;return this._distanceSq=yi.x*yi.x+yi.y*yi.y+yi.z*yi.z,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=-1,this._adjacentPairIndex[1]=-1,this._adjacentPairIndex[2]=-1,!I}setAdjacentTriangle(t){var i=0,a=this._nextIndex[0],s=this._nextIndex[0];this._vertices[0]==t._vertices[s]&&this._vertices[a]==t._vertices[0]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=0,++i);var o=this._nextIndex[0],n=this._nextIndex[1];this._vertices[0]==t._vertices[n]&&this._vertices[o]==t._vertices[1]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=0,++i);var r=this._nextIndex[0],e=this._nextIndex[2];this._vertices[0]==t._vertices[e]&&this._vertices[r]==t._vertices[2]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=0,++i);var _=this._nextIndex[1],h=this._nextIndex[0];this._vertices[1]==t._vertices[h]&&this._vertices[_]==t._vertices[0]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=1,++i);var l=this._nextIndex[1],c=this._nextIndex[1];this._vertices[1]==t._vertices[c]&&this._vertices[l]==t._vertices[1]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=1,++i);var m=this._nextIndex[1],v=this._nextIndex[2];this._vertices[1]==t._vertices[v]&&this._vertices[m]==t._vertices[2]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=1,++i);var b=this._nextIndex[2],x=this._nextIndex[0];this._vertices[2]==t._vertices[x]&&this._vertices[b]==t._vertices[0]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=2,++i);var p=this._nextIndex[2],f=this._nextIndex[1];this._vertices[2]==t._vertices[f]&&this._vertices[p]==t._vertices[1]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=2,++i);var u=this._nextIndex[2],y=this._nextIndex[2];return this._vertices[2]==t._vertices[y]&&this._vertices[u]==t._vertices[2]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=2,++i),1==i}removeAdjacentTriangles(){var t=this._adjacentTriangles[0];if(null!=t){var i=this._adjacentPairIndex[0];t._adjacentTriangles[i]=null,t._adjacentPairIndex[i]=-1,this._adjacentTriangles[0]=null,this._adjacentPairIndex[0]=-1}var a=this._adjacentTriangles[1];if(null!=a){var s=this._adjacentPairIndex[1];a._adjacentTriangles[s]=null,a._adjacentPairIndex[s]=-1,this._adjacentTriangles[1]=null,this._adjacentPairIndex[1]=-1}var o=this._adjacentTriangles[2];if(null!=o){var n=this._adjacentPairIndex[2];o._adjacentTriangles[n]=null,o._adjacentPairIndex[n]=-1,this._adjacentTriangles[2]=null,this._adjacentPairIndex[2]=-1}}removeReferences(){this._next=null,this._prev=null,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._distanceSq=0,this._vertices[0]=null,this._vertices[1]=null,this._vertices[2]=null,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=0,this._adjacentPairIndex[1]=0,this._adjacentPairIndex[2]=0}dump(){}},pa.collision.narrowphase.detector.gjkepa.EpaVertex=class{constructor(){this.randId=1e5*Math.random()|0,this.v=new pa.common.Vec3,this.w1=new pa.common.Vec3,this.w2=new pa.common.Vec3}init(t,i,a){var s=this.v;s.x=t.x,s.y=t.y,s.z=t.z;var o=this.w1;o.x=i.x,o.y=i.y,o.z=i.z;var n=this.w2;return n.x=a.x,n.y=a.y,n.z=a.z,this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null,this}removeReferences(){this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null}},pa.collision.narrowphase.detector.gjkepa.GjkCache=class{constructor(){this.prevClosestDir=new pa.common.Vec3}clear(){this.prevClosestDir.zero()}},pa.common||(pa.common={}),pa.common.Vec3=class{constructor(t,i,a){null==a&&(a=0),null==i&&(i=0),null==t&&(t=0),this.x=t,this.y=i,this.z=a,pa.common.Vec3.numCreations++}init(t,i,a){return this.x=t,this.y=i,this.z=a,this}zero(){return this.x=0,this.y=0,this.z=0,this}add(t){return new pa.common.Vec3(this.x+t.x,this.y+t.y,this.z+t.z)}add3(t,i,a){return new pa.common.Vec3(this.x+t,this.y+i,this.z+a)}addScaled(t,i){return new pa.common.Vec3(this.x+t.x*i,this.y+t.y*i,this.z+t.z*i)}sub(t){return new pa.common.Vec3(this.x-t.x,this.y-t.y,this.z-t.z)}sub3(t,i,a){return new pa.common.Vec3(this.x-t,this.y-i,this.z-a)}scale(t){return new pa.common.Vec3(this.x*t,this.y*t,this.z*t)}scale3(t,i,a){return new pa.common.Vec3(this.x*t,this.y*i,this.z*a)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new pa.common.Vec3(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}addEq(t){var i=this.x+t.x,a=this.y+t.y,s=this.z+t.z;return this.x=i,this.y=a,this.z=s,this}add3Eq(t,i,a){var s=this.x+t,o=this.y+i,n=this.z+a;return this.x=s,this.y=o,this.z=n,this}addScaledEq(t,i){var a=this.x+t.x*i,s=this.y+t.y*i,o=this.z+t.z*i;return this.x=a,this.y=s,this.z=o,this}subEq(t){var i=this.x-t.x,a=this.y-t.y,s=this.z-t.z;return this.x=i,this.y=a,this.z=s,this}sub3Eq(t,i,a){var s=this.x-t,o=this.y-i,n=this.z-a;return this.x=s,this.y=o,this.z=n,this}scaleEq(t){var i=this.x*t,a=this.y*t,s=this.z*t;return this.x=i,this.y=a,this.z=s,this}scale3Eq(t,i,a){var s=this.x*t,o=this.y*i,n=this.z*a;return this.x=s,this.y=o,this.z=n,this}crossEq(t){var i=this.y*t.z-this.z*t.y,a=this.z*t.x-this.x*t.z,s=this.x*t.y-this.y*t.x;return this.x=i,this.y=a,this.z=s,this}mulMat3(t){return new pa.common.Vec3(this.x*t.e00+this.y*t.e01+this.z*t.e02,this.x*t.e10+this.y*t.e11+this.z*t.e12,this.x*t.e20+this.y*t.e21+this.z*t.e22)}mulMat4(t){return new pa.common.Vec3(this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23)}mulTransform(t){var i,a,s,o,n,r,e=this;i=e.x,a=e.y,s=e.z,o=t._rotation00*i+t._rotation01*a+t._rotation02*s,n=t._rotation10*i+t._rotation11*a+t._rotation12*s,r=t._rotation20*i+t._rotation21*a+t._rotation22*s,i=o,a=n,s=r,i+=t._positionX,a+=t._positionY,s+=t._positionZ;var _=new pa.common.Vec3,h=_;return h.x=i,h.y=a,h.z=s,_}mulMat3Eq(t){var i=this.x*t.e00+this.y*t.e01+this.z*t.e02,a=this.x*t.e10+this.y*t.e11+this.z*t.e12,s=this.x*t.e20+this.y*t.e21+this.z*t.e22;return this.x=i,this.y=a,this.z=s,this}mulMat4Eq(t){var i=this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,a=this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,s=this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23;return this.x=i,this.y=a,this.z=s,this}mulTransformEq(t){var i,a,s,o,n,r,e=this;i=e.x,a=e.y,s=e.z,o=t._rotation00*i+t._rotation01*a+t._rotation02*s,n=t._rotation10*i+t._rotation11*a+t._rotation12*s,r=t._rotation20*i+t._rotation21*a+t._rotation22*s,i=o,a=n,s=r,i+=t._positionX,a+=t._positionY,s+=t._positionZ;var _=this;return _.x=i,_.y=a,_.z=s,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}normalized(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t),new pa.common.Vec3(this.x*t,this.y*t,this.z*t)}normalize(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);t>0&&(t=1/t);var i=this.x*t,a=this.y*t,s=this.z*t;return this.x=i,this.y=a,this.z=s,this}negate(){return new pa.common.Vec3(-this.x,-this.y,-this.z)}negateEq(){var t=-this.x,i=-this.y,a=-this.z;return this.x=t,this.y=i,this.z=a,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}clone(){return new pa.common.Vec3(this.x,this.y,this.z)}toString(){return"Vec3["+(this.x>0?(1e7*this.x+.5|0)/1e7:(1e7*this.x-.5|0)/1e7)+", "+(this.y>0?(1e7*this.y+.5|0)/1e7:(1e7*this.y-.5|0)/1e7)+", "+(this.z>0?(1e7*this.z+.5|0)/1e7:(1e7*this.z-.5|0)/1e7)+"]"}},pa.common.Transform=class{constructor(){this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1}identity(){return this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1,this}getPosition(){var t=new pa.common.Vec3,i=t;return i.x=this._positionX,i.y=this._positionY,i.z=this._positionZ,t}getPositionTo(t){var i=t;i.x=this._positionX,i.y=this._positionY,i.z=this._positionZ}setPosition(t){var i=t;return this._positionX=i.x,this._positionY=i.y,this._positionZ=i.z,this}translate(t){var i,a,s,o=t;i=o.x,a=o.y,s=o.z,this._positionX+=i,this._positionY+=a,this._positionZ+=s}getRotation(){var t=new pa.common.Mat3,i=t;return i.e00=this._rotation00,i.e01=this._rotation01,i.e02=this._rotation02,i.e10=this._rotation10,i.e11=this._rotation11,i.e12=this._rotation12,i.e20=this._rotation20,i.e21=this._rotation21,i.e22=this._rotation22,t}getRotationTo(t){var i=t;i.e00=this._rotation00,i.e01=this._rotation01,i.e02=this._rotation02,i.e10=this._rotation10,i.e11=this._rotation11,i.e12=this._rotation12,i.e20=this._rotation20,i.e21=this._rotation21,i.e22=this._rotation22}setRotation(t){var i=t;return this._rotation00=i.e00,this._rotation01=i.e01,this._rotation02=i.e02,this._rotation10=i.e10,this._rotation11=i.e11,this._rotation12=i.e12,this._rotation20=i.e20,this._rotation21=i.e21,this._rotation22=i.e22,this}setRotationXyz(t){var i,a,s,o=t;i=o.x,a=o.y,s=o.z;var n=Math.sin(i),r=Math.sin(a),e=Math.sin(s),_=Math.cos(i),h=Math.cos(a),l=Math.cos(s);this._rotation00=h*l,this._rotation01=-h*e,this._rotation02=r,this._rotation10=_*e+l*n*r,this._rotation11=_*l-n*r*e,this._rotation12=-h*n,this._rotation20=n*e-_*l*r,this._rotation21=l*n+_*r*e,this._rotation22=_*h}rotate(t){var i,a,s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y=t;i=y.e00,a=y.e01,s=y.e02,o=y.e10,n=y.e11,r=y.e12,e=y.e20,_=y.e21,h=y.e22,l=i*this._rotation00+a*this._rotation10+s*this._rotation20,c=i*this._rotation01+a*this._rotation11+s*this._rotation21,m=i*this._rotation02+a*this._rotation12+s*this._rotation22,v=o*this._rotation00+n*this._rotation10+r*this._rotation20,b=o*this._rotation01+n*this._rotation11+r*this._rotation21,x=o*this._rotation02+n*this._rotation12+r*this._rotation22,p=e*this._rotation00+_*this._rotation10+h*this._rotation20,f=e*this._rotation01+_*this._rotation11+h*this._rotation21,u=e*this._rotation02+_*this._rotation12+h*this._rotation22,this._rotation00=l,this._rotation01=c,this._rotation02=m,this._rotation10=v,this._rotation11=b,this._rotation12=x,this._rotation20=p,this._rotation21=f,this._rotation22=u}rotateXyz(t){var i,a,s,o,n,r,e,_,h,l,c,m,v=t;i=v.x,a=v.y,s=v.z;var b,x,p,f,u,y,d,g,X,z=Math.sin(i),Y=Math.sin(a),Z=Math.sin(s),M=Math.cos(i),I=Math.cos(a),V=Math.cos(s);n=-I*Z,r=Y,e=M*Z+V*z*Y,_=M*V-z*Y*Z,h=-I*z,l=z*Z-M*V*Y,c=V*z+M*Y*Z,m=M*I,b=(o=I*V)*this._rotation00+n*this._rotation10+r*this._rotation20,x=o*this._rotation01+n*this._rotation11+r*this._rotation21,p=o*this._rotation02+n*this._rotation12+r*this._rotation22,f=e*this._rotation00+_*this._rotation10+h*this._rotation20,u=e*this._rotation01+_*this._rotation11+h*this._rotation21,y=e*this._rotation02+_*this._rotation12+h*this._rotation22,d=l*this._rotation00+c*this._rotation10+m*this._rotation20,g=l*this._rotation01+c*this._rotation11+m*this._rotation21,X=l*this._rotation02+c*this._rotation12+m*this._rotation22,this._rotation00=b,this._rotation01=x,this._rotation02=p,this._rotation10=f,this._rotation11=u,this._rotation12=y,this._rotation20=d,this._rotation21=g,this._rotation22=X}getOrientation(){var t,i,a,s,o,n=new pa.common.Quat,r=this._rotation00,e=this._rotation11,_=this._rotation22,h=r+e+_;h>0?(s=.5*(o=Math.sqrt(h+1)),o=.5/o,t=(this._rotation21-this._rotation12)*o,i=(this._rotation02-this._rotation20)*o,a=(this._rotation10-this._rotation01)*o):r>e?r>_?(t=.5*(o=Math.sqrt(r-e-_+1)),o=.5/o,i=(this._rotation01+this._rotation10)*o,a=(this._rotation02+this._rotation20)*o,s=(this._rotation21-this._rotation12)*o):(a=.5*(o=Math.sqrt(_-r-e+1)),o=.5/o,t=(this._rotation02+this._rotation20)*o,i=(this._rotation12+this._rotation21)*o,s=(this._rotation10-this._rotation01)*o):e>_?(i=.5*(o=Math.sqrt(e-_-r+1)),o=.5/o,t=(this._rotation01+this._rotation10)*o,a=(this._rotation12+this._rotation21)*o,s=(this._rotation02-this._rotation20)*o):(a=.5*(o=Math.sqrt(_-r-e+1)),o=.5/o,t=(this._rotation02+this._rotation20)*o,i=(this._rotation12+this._rotation21)*o,s=(this._rotation10-this._rotation01)*o);var l=n;return l.x=t,l.y=i,l.z=a,l.w=s,n}getOrientationTo(t){var i,a,s,o,n,r=this._rotation00,e=this._rotation11,_=this._rotation22,h=r+e+_;h>0?(o=.5*(n=Math.sqrt(h+1)),n=.5/n,i=(this._rotation21-this._rotation12)*n,a=(this._rotation02-this._rotation20)*n,s=(this._rotation10-this._rotation01)*n):r>e?r>_?(i=.5*(n=Math.sqrt(r-e-_+1)),n=.5/n,a=(this._rotation01+this._rotation10)*n,s=(this._rotation02+this._rotation20)*n,o=(this._rotation21-this._rotation12)*n):(s=.5*(n=Math.sqrt(_-r-e+1)),n=.5/n,i=(this._rotation02+this._rotation20)*n,a=(this._rotation12+this._rotation21)*n,o=(this._rotation10-this._rotation01)*n):e>_?(a=.5*(n=Math.sqrt(e-_-r+1)),n=.5/n,i=(this._rotation01+this._rotation10)*n,s=(this._rotation12+this._rotation21)*n,o=(this._rotation02-this._rotation20)*n):(s=.5*(n=Math.sqrt(_-r-e+1)),n=.5/n,i=(this._rotation02+this._rotation20)*n,a=(this._rotation12+this._rotation21)*n,o=(this._rotation10-this._rotation01)*n);var l=t;l.x=i,l.y=a,l.z=s,l.w=o}setOrientation(t){var i,a,s,o,n=t,r=(i=n.x,a=n.y,s=n.z,o=n.w,2*i),e=2*a,_=2*s,h=i*r,l=a*e,c=s*_,m=i*e,v=a*_,b=i*_,x=o*r,p=o*e,f=o*_;return this._rotation00=1-l-c,this._rotation01=m-f,this._rotation02=b+p,this._rotation10=m+f,this._rotation11=1-h-c,this._rotation12=v-x,this._rotation20=b-p,this._rotation21=v+x,this._rotation22=1-h-l,this}clone(){var t=new pa.common.Transform;return t._positionX=this._positionX,t._positionY=this._positionY,t._positionZ=this._positionZ,t._rotation00=this._rotation00,t._rotation01=this._rotation01,t._rotation02=this._rotation02,t._rotation10=this._rotation10,t._rotation11=this._rotation11,t._rotation12=this._rotation12,t._rotation20=this._rotation20,t._rotation21=this._rotation21,t._rotation22=this._rotation22,t}copyFrom(t){return this._positionX=t._positionX,this._positionY=t._positionY,this._positionZ=t._positionZ,this._rotation00=t._rotation00,this._rotation01=t._rotation01,this._rotation02=t._rotation02,this._rotation10=t._rotation10,this._rotation11=t._rotation11,this._rotation12=t._rotation12,this._rotation20=t._rotation20,this._rotation21=t._rotation21,this._rotation22=t._rotation22,this}},pa.common.Setting=class{},pa.collision.narrowphase.detector.gjkepa.GjkEpa=class{constructor(){var t=new Array(4);this.s=t;var i=new Array(4);this.w1=i;var a=new Array(4);this.w2=a;var s=new Array(3);this.baseDirs=s,this.baseDirs[0]=new pa.common.Vec3(1,0,0),this.baseDirs[1]=new pa.common.Vec3(0,1,0),this.baseDirs[2]=new pa.common.Vec3(0,0,1),this.tl1=new pa.common.Vec3,this.tl2=new pa.common.Vec3,this.rayX=new pa.common.Vec3,this.rayR=new pa.common.Vec3,this.tempTransform=new pa.common.Transform,this.s[0]=new pa.common.Vec3,this.w1[0]=new pa.common.Vec3,this.w2[0]=new pa.common.Vec3,this.s[1]=new pa.common.Vec3,this.w1[1]=new pa.common.Vec3,this.w2[1]=new pa.common.Vec3,this.s[2]=new pa.common.Vec3,this.w1[2]=new pa.common.Vec3,this.w2[2]=new pa.common.Vec3,this.s[3]=new pa.common.Vec3,this.w1[3]=new pa.common.Vec3,this.w2[3]=new pa.common.Vec3,this.dir=new pa.common.Vec3,this.closest=new pa.common.Vec3,this.closestPoint1=new pa.common.Vec3,this.closestPoint2=new pa.common.Vec3,this.polyhedron=new pa.collision.narrowphase.detector.gjkepa.EpaPolyhedron}computeClosestPointsImpl(t,i,a,s,o,n){this.c1=t,this.c2=i,this.tf1=a,this.tf2=s;var r=this.s,e=this.w1,_=this.w2,h=this.closest,l=this.dir;if(null!=o?(null==o._gjkCache&&(o._gjkCache=new pa.collision.narrowphase.detector.gjkepa.GjkCache),this.loadCache(o._gjkCache)):l.zero(),l.x*l.x+l.y*l.y+l.z*l.z==0){var c,m,v;c=s._positionX-a._positionX,m=s._positionY-a._positionY,v=s._positionZ-a._positionZ;var b=l;b.x=c,b.y=m,b.z=v,l.x*l.x+l.y*l.y+l.z*l.z<1e-6&&l.init(1,0,0)}this.simplexSize=0,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var x=this.s[this.simplexSize],p=this.w1[this.simplexSize];x.x=p.x,x.y=p.y,x.z=p.z;var f=x,u=this.w2[this.simplexSize],y=f.x-u.x,d=f.y-u.y,g=f.z-u.z;f.x=y,f.y=d,f.z=g,this.simplexSize=1;for(var X=0,z=1e-8;X<40;){var Y=0;switch(this.simplexSize){case 1:var Z=r[0];h.x=Z.x,h.y=Z.y,h.z=Z.z,Y=1;break;case 2:var M,I,V,w,L,k,B=r[0];M=B.x,I=B.y,V=B.z;var A,P,S,T=r[1],C=(A=(w=T.x)-M)*M+(P=(L=T.y)-I)*I+(S=(k=T.z)-V)*V;if((C=-C/(A*A+P*P+S*S))<0){var j=h;j.x=M,j.y=I,j.z=V,Y=1}else if(C>1){var R=h;R.x=w,R.y=L,R.z=k,Y=2}else{var E,q,N;E=M+A*C,q=I+P*C,N=V+S*C;var F=h;F.x=E,F.y=q,F.z=N,Y=3}break;case 3:var D,G,W,J,U,O,H,Q,K,$,tt,it,at,st,ot,nt,rt,et,_t=r[0],ht=r[1],lt=r[2],ct=_t;D=ct.x,G=ct.y,W=ct.z;var mt=ht;J=mt.x,U=mt.y,O=mt.z;var vt,bt,xt,pt=lt;H=pt.x;var ft,ut,yt,dt=J*((st=(Q=pt.y)-U)*(xt=($=J-D)*st-(tt=U-G)*(at=H-J))-(ot=(K=pt.z)-O)*(bt=(it=O-W)*at-$*ot))+U*(ot*(vt=tt*ot-it*st)-at*xt)+O*(at*bt-st*vt),gt=H*((rt=G-Q)*xt-(et=W-K)*bt)+Q*(et*vt-(nt=D-H)*xt)+K*(nt*bt-rt*vt),Xt=-1,zt=0;if(ft=0,ut=0,yt=0,D*(tt*xt-it*bt)+G*(it*vt-$*xt)+W*($*bt-tt*vt)<0){var Yt,Zt,Mt,It,Vt,wt,Lt=_t;Yt=Lt.x,Zt=Lt.y,Mt=Lt.z;var kt,Bt,At,Pt,St=ht,Tt=(kt=(It=St.x)-Yt)*Yt+(Bt=(Vt=St.y)-Zt)*Zt+(At=(wt=St.z)-Mt)*Mt;if((Tt=-Tt/(kt*kt+Bt*Bt+At*At))<0){var Ct=h;Ct.x=Yt,Ct.y=Zt,Ct.z=Mt,Pt=1}else if(Tt>1){var jt=h;jt.x=It,jt.y=Vt,jt.z=wt,Pt=2}else{var Rt,Et,qt;Rt=Yt+kt*Tt,Et=Zt+Bt*Tt,qt=Mt+At*Tt;var Nt=h;Nt.x=Rt,Nt.y=Et,Nt.z=qt,Pt=3}zt=Pt,Xt=h.x*h.x+h.y*h.y+h.z*h.z;var Ft=h;ft=Ft.x,ut=Ft.y,yt=Ft.z}if(dt<0){var Dt,Gt,Wt,Jt,Ut,Ot,Ht=ht;Dt=Ht.x,Gt=Ht.y,Wt=Ht.z;var Qt,Kt,$t,ti,ii=lt,ai=(Qt=(Jt=ii.x)-Dt)*Dt+(Kt=(Ut=ii.y)-Gt)*Gt+($t=(Ot=ii.z)-Wt)*Wt;if((ai=-ai/(Qt*Qt+Kt*Kt+$t*$t))<0){var si=h;si.x=Dt,si.y=Gt,si.z=Wt,ti=1}else if(ai>1){var oi=h;oi.x=Jt,oi.y=Ut,oi.z=Ot,ti=2}else{var ni,ri,ei;ni=Dt+Qt*ai,ri=Gt+Kt*ai,ei=Wt+$t*ai;var _i=h;_i.x=ni,_i.y=ri,_i.z=ei,ti=3}var hi=h.x*h.x+h.y*h.y+h.z*h.z;if(Xt<0||hi<Xt){zt=ti<<1,Xt=hi;var li=h;ft=li.x,ut=li.y,yt=li.z}}if(gt<0){var ci,mi,vi,bi,xi,pi,fi=_t;ci=fi.x,mi=fi.y,vi=fi.z;var ui,yi,di,gi,Xi=lt,zi=(ui=(bi=Xi.x)-ci)*ci+(yi=(xi=Xi.y)-mi)*mi+(di=(pi=Xi.z)-vi)*vi;if((zi=-zi/(ui*ui+yi*yi+di*di))<0){var Yi=h;Yi.x=ci,Yi.y=mi,Yi.z=vi,gi=1}else if(zi>1){var Zi=h;Zi.x=bi,Zi.y=xi,Zi.z=pi,gi=2}else{var Mi,Ii,Vi;Mi=ci+ui*zi,Ii=mi+yi*zi,Vi=vi+di*zi;var wi=h;wi.x=Mi,wi.y=Ii,wi.z=Vi,gi=3}var Li=h.x*h.x+h.y*h.y+h.z*h.z;if(Xt<0||Li<Xt){zt=1&gi|(2&gi)<<1,Xt=Li;var ki=h;ft=ki.x,ut=ki.y,yt=ki.z}}if(Xt>0){var Bi=h;Bi.x=ft,Bi.y=ut,Bi.z=yt,Y=zt}else{var Ai=vt*vt+bt*bt+xt*xt;Ai>0&&(Ai=1/Math.sqrt(Ai));var Pi=(vt*=Ai)*vt+(bt*=Ai)*bt+(xt*=Ai)*xt;ft=vt*(Pi=(D*vt+G*bt+W*xt)/Pi),ut=bt*Pi,yt=xt*Pi;var Si=h;Si.x=ft,Si.y=ut,Si.z=yt,Y=7}break;case 4:var Ti,Ci,ji,Ri,Ei,qi,Ni,Fi,Di,Gi,Wi,Ji,Ui,Oi,Hi,Qi,Ki,$i,ta,ia,aa,sa,oa,na,ra,ea,_a,ha=r[0],la=r[1],ca=r[2],ma=r[3],va=ha;Ti=va.x,Ci=va.y,ji=va.z;var ba=la;Ri=ba.x,Ei=ba.y,qi=ba.z;var xa=ca;Ni=xa.x,Fi=xa.y,Di=xa.z;var fa,ua,ya,da=ma;Gi=da.x;var ga,Xa,za,Ya=(Ui=Ri-Ti)*(fa=(ea=(Wi=da.y)-Ei)*(na=Di-qi)-(_a=(Ji=da.z)-qi)*(oa=Fi-Ei))+(Oi=Ei-Ci)*(ua=_a*(sa=Ni-Ri)-(ra=Gi-Ri)*na)+(Hi=qi-ji)*(ya=ra*oa-ea*sa)>0?1:-1,Za=Ti*((Ki=Fi-Ci)*(aa=Ji-ji)-($i=Di-ji)*(ia=Wi-Ci))+Ci*($i*(ta=Gi-Ti)-(Qi=Ni-Ti)*aa)+ji*(Qi*ia-Ki*ta),Ma=Ti*(ia*Hi-aa*Oi)+Ci*(aa*Ui-ta*Hi)+ji*(ta*Oi-ia*Ui),Ia=Ri*fa+Ei*ua+qi*ya,Va=-1,wa=0;if(ga=0,Xa=0,za=0,(Ti*(Oi*$i-Hi*Ki)+Ci*(Hi*Qi-Ui*$i)+ji*(Ui*Ki-Oi*Qi))*Ya<0){var La,ka,Ba,Aa,Pa,Sa,Ta,Ca,ja,Ra,Ea,qa,Na,Fa,Da,Ga,Wa,Ja,Ua=ha;La=Ua.x,ka=Ua.y,Ba=Ua.z;var Oa=la;Aa=Oa.x,Pa=Oa.y,Sa=Oa.z;var Ha,Qa,Ka,$a=ca;Ta=$a.x;var ts,is,as,ss,os=Aa*((Fa=(Ca=$a.y)-Pa)*(Ka=(Ra=Aa-La)*Fa-(Ea=Pa-ka)*(Na=Ta-Aa))-(Da=(ja=$a.z)-Sa)*(Qa=(qa=Sa-Ba)*Na-Ra*Da))+Pa*(Da*(Ha=Ea*Da-qa*Fa)-Na*Ka)+Sa*(Na*Qa-Fa*Ha),ns=Ta*((Wa=ka-Ca)*Ka-(Ja=Ba-ja)*Qa)+Ca*(Ja*Ha-(Ga=La-Ta)*Ka)+ja*(Ga*Qa-Wa*Ha),rs=-1,es=0;if(ts=0,is=0,as=0,La*(Ea*Ka-qa*Qa)+ka*(qa*Ha-Ra*Ka)+Ba*(Ra*Qa-Ea*Ha)<0){var _s,hs,ls,cs,ms,vs,bs=ha;_s=bs.x,hs=bs.y,ls=bs.z;var xs,ps,fs,us,ys=la,ds=(xs=(cs=ys.x)-_s)*_s+(ps=(ms=ys.y)-hs)*hs+(fs=(vs=ys.z)-ls)*ls;if((ds=-ds/(xs*xs+ps*ps+fs*fs))<0){var gs=h;gs.x=_s,gs.y=hs,gs.z=ls,us=1}else if(ds>1){var Xs=h;Xs.x=cs,Xs.y=ms,Xs.z=vs,us=2}else{var zs,Ys,Zs;zs=_s+xs*ds,Ys=hs+ps*ds,Zs=ls+fs*ds;var Ms=h;Ms.x=zs,Ms.y=Ys,Ms.z=Zs,us=3}es=us,rs=h.x*h.x+h.y*h.y+h.z*h.z;var Is=h;ts=Is.x,is=Is.y,as=Is.z}if(os<0){var Vs,ws,Ls,ks,Bs,As,Ps=la;Vs=Ps.x,ws=Ps.y,Ls=Ps.z;var Ss,Ts,Cs,js,Rs=ca,Es=(Ss=(ks=Rs.x)-Vs)*Vs+(Ts=(Bs=Rs.y)-ws)*ws+(Cs=(As=Rs.z)-Ls)*Ls;if((Es=-Es/(Ss*Ss+Ts*Ts+Cs*Cs))<0){var qs=h;qs.x=Vs,qs.y=ws,qs.z=Ls,js=1}else if(Es>1){var Ns=h;Ns.x=ks,Ns.y=Bs,Ns.z=As,js=2}else{var Fs,Ds,Gs;Fs=Vs+Ss*Es,Ds=ws+Ts*Es,Gs=Ls+Cs*Es;var Ws=h;Ws.x=Fs,Ws.y=Ds,Ws.z=Gs,js=3}var Js=h.x*h.x+h.y*h.y+h.z*h.z;if(rs<0||Js<rs){es=js<<1,rs=Js;var Us=h;ts=Us.x,is=Us.y,as=Us.z}}if(ns<0){var Os,Hs,Qs,Ks,$s,to,io=ha;Os=io.x,Hs=io.y,Qs=io.z;var ao,so,oo,no,ro=ca,eo=(ao=(Ks=ro.x)-Os)*Os+(so=($s=ro.y)-Hs)*Hs+(oo=(to=ro.z)-Qs)*Qs;if((eo=-eo/(ao*ao+so*so+oo*oo))<0){var _o=h;_o.x=Os,_o.y=Hs,_o.z=Qs,no=1}else if(eo>1){var ho=h;ho.x=Ks,ho.y=$s,ho.z=to,no=2}else{var lo,co,mo;lo=Os+ao*eo,co=Hs+so*eo,mo=Qs+oo*eo;var vo=h;vo.x=lo,vo.y=co,vo.z=mo,no=3}var bo=h.x*h.x+h.y*h.y+h.z*h.z;if(rs<0||bo<rs){es=1&no|(2&no)<<1,rs=bo;var xo=h;ts=xo.x,is=xo.y,as=xo.z}}if(rs>0){var po=h;po.x=ts,po.y=is,po.z=as,ss=es}else{var fo=Ha*Ha+Qa*Qa+Ka*Ka;fo>0&&(fo=1/Math.sqrt(fo));var uo=(Ha*=fo)*Ha+(Qa*=fo)*Qa+(Ka*=fo)*Ka;ts=Ha*(uo=(La*Ha+ka*Qa+Ba*Ka)/uo),is=Qa*uo,as=Ka*uo;var yo=h;yo.x=ts,yo.y=is,yo.z=as,ss=7}wa=ss,Va=h.x*h.x+h.y*h.y+h.z*h.z;var go=h;ga=go.x,Xa=go.y,za=go.z}if(Za*Ya<0){var Xo,zo,Yo,Zo,Mo,Io,Vo,wo,Lo,ko,Bo,Ao,Po,So,To,Co,jo,Ro,Eo=ha;Xo=Eo.x,zo=Eo.y,Yo=Eo.z;var qo=ca;Zo=qo.x,Mo=qo.y,Io=qo.z;var No,Fo,Do,Go=ma;Vo=Go.x;var Wo,Jo,Uo,Oo,Ho=Zo*((So=(wo=Go.y)-Mo)*(Do=(ko=Zo-Xo)*So-(Bo=Mo-zo)*(Po=Vo-Zo))-(To=(Lo=Go.z)-Io)*(Fo=(Ao=Io-Yo)*Po-ko*To))+Mo*(To*(No=Bo*To-Ao*So)-Po*Do)+Io*(Po*Fo-So*No),Qo=Vo*((jo=zo-wo)*Do-(Ro=Yo-Lo)*Fo)+wo*(Ro*No-(Co=Xo-Vo)*Do)+Lo*(Co*Fo-jo*No),Ko=-1,$o=0;if(Wo=0,Jo=0,Uo=0,Xo*(Bo*Do-Ao*Fo)+zo*(Ao*No-ko*Do)+Yo*(ko*Fo-Bo*No)<0){var tn,an,sn,on,nn,rn,en=ha;tn=en.x,an=en.y,sn=en.z;var _n,hn,ln,cn,mn=ca,vn=(_n=(on=mn.x)-tn)*tn+(hn=(nn=mn.y)-an)*an+(ln=(rn=mn.z)-sn)*sn;if((vn=-vn/(_n*_n+hn*hn+ln*ln))<0){var bn=h;bn.x=tn,bn.y=an,bn.z=sn,cn=1}else if(vn>1){var xn=h;xn.x=on,xn.y=nn,xn.z=rn,cn=2}else{var pn,fn,un;pn=tn+_n*vn,fn=an+hn*vn,un=sn+ln*vn;var yn=h;yn.x=pn,yn.y=fn,yn.z=un,cn=3}$o=cn,Ko=h.x*h.x+h.y*h.y+h.z*h.z;var dn=h;Wo=dn.x,Jo=dn.y,Uo=dn.z}if(Ho<0){var gn,Xn,zn,Yn,Zn,Mn,In=ca;gn=In.x,Xn=In.y,zn=In.z;var Vn,wn,Ln,kn,Bn=ma,An=(Vn=(Yn=Bn.x)-gn)*gn+(wn=(Zn=Bn.y)-Xn)*Xn+(Ln=(Mn=Bn.z)-zn)*zn;if((An=-An/(Vn*Vn+wn*wn+Ln*Ln))<0){var Pn=h;Pn.x=gn,Pn.y=Xn,Pn.z=zn,kn=1}else if(An>1){var Sn=h;Sn.x=Yn,Sn.y=Zn,Sn.z=Mn,kn=2}else{var Tn,Cn,jn;Tn=gn+Vn*An,Cn=Xn+wn*An,jn=zn+Ln*An;var Rn=h;Rn.x=Tn,Rn.y=Cn,Rn.z=jn,kn=3}var En=h.x*h.x+h.y*h.y+h.z*h.z;if(Ko<0||En<Ko){$o=kn<<1,Ko=En;var qn=h;Wo=qn.x,Jo=qn.y,Uo=qn.z}}if(Qo<0){var Nn,Fn,Dn,Gn,Wn,Jn,Un=ha;Nn=Un.x,Fn=Un.y,Dn=Un.z;var On,Hn,Qn,Kn,$n=ma,tr=(On=(Gn=$n.x)-Nn)*Nn+(Hn=(Wn=$n.y)-Fn)*Fn+(Qn=(Jn=$n.z)-Dn)*Dn;if((tr=-tr/(On*On+Hn*Hn+Qn*Qn))<0){var ir=h;ir.x=Nn,ir.y=Fn,ir.z=Dn,Kn=1}else if(tr>1){var ar=h;ar.x=Gn,ar.y=Wn,ar.z=Jn,Kn=2}else{var sr,or,nr;sr=Nn+On*tr,or=Fn+Hn*tr,nr=Dn+Qn*tr;var rr=h;rr.x=sr,rr.y=or,rr.z=nr,Kn=3}var er=h.x*h.x+h.y*h.y+h.z*h.z;if(Ko<0||er<Ko){$o=1&Kn|(2&Kn)<<1,Ko=er;var _r=h;Wo=_r.x,Jo=_r.y,Uo=_r.z}}if(Ko>0){var hr=h;hr.x=Wo,hr.y=Jo,hr.z=Uo,Oo=$o}else{var lr=No*No+Fo*Fo+Do*Do;lr>0&&(lr=1/Math.sqrt(lr));var cr=(No*=lr)*No+(Fo*=lr)*Fo+(Do*=lr)*Do;Wo=No*(cr=(Xo*No+zo*Fo+Yo*Do)/cr),Jo=Fo*cr,Uo=Do*cr;var mr=h;mr.x=Wo,mr.y=Jo,mr.z=Uo,Oo=7}var vr=h.x*h.x+h.y*h.y+h.z*h.z;if(Va<0||vr<Va){wa=1&Oo|(6&Oo)<<1,Va=vr;var br=h;ga=br.x,Xa=br.y,za=br.z}}if(Ma*Ya<0){var xr,pr,fr,ur,yr,dr,gr,Xr,zr,Yr,Zr,Mr,Ir,Vr,wr,Lr,kr,Br,Ar=ha;xr=Ar.x,pr=Ar.y,fr=Ar.z;var Pr=la;ur=Pr.x,yr=Pr.y,dr=Pr.z;var Sr,Tr,Cr,jr=ma;gr=jr.x;var Rr,Er,qr,Nr,Fr=ur*((Vr=(Xr=jr.y)-yr)*(Cr=(Yr=ur-xr)*Vr-(Zr=yr-pr)*(Ir=gr-ur))-(wr=(zr=jr.z)-dr)*(Tr=(Mr=dr-fr)*Ir-Yr*wr))+yr*(wr*(Sr=Zr*wr-Mr*Vr)-Ir*Cr)+dr*(Ir*Tr-Vr*Sr),Dr=gr*((kr=pr-Xr)*Cr-(Br=fr-zr)*Tr)+Xr*(Br*Sr-(Lr=xr-gr)*Cr)+zr*(Lr*Tr-kr*Sr),Gr=-1,Wr=0;if(Rr=0,Er=0,qr=0,xr*(Zr*Cr-Mr*Tr)+pr*(Mr*Sr-Yr*Cr)+fr*(Yr*Tr-Zr*Sr)<0){var Jr,Ur,Or,Hr,Qr,Kr,$r=ha;Jr=$r.x,Ur=$r.y,Or=$r.z;var te,ie,ae,se,oe=la,ne=(te=(Hr=oe.x)-Jr)*Jr+(ie=(Qr=oe.y)-Ur)*Ur+(ae=(Kr=oe.z)-Or)*Or;if((ne=-ne/(te*te+ie*ie+ae*ae))<0){var re=h;re.x=Jr,re.y=Ur,re.z=Or,se=1}else if(ne>1){var ee=h;ee.x=Hr,ee.y=Qr,ee.z=Kr,se=2}else{var _e,he,le;_e=Jr+te*ne,he=Ur+ie*ne,le=Or+ae*ne;var ce=h;ce.x=_e,ce.y=he,ce.z=le,se=3}Wr=se,Gr=h.x*h.x+h.y*h.y+h.z*h.z;var me=h;Rr=me.x,Er=me.y,qr=me.z}if(Fr<0){var ve,be,xe,pe,fe,ue,ye=la;ve=ye.x,be=ye.y,xe=ye.z;var de,ge,Xe,ze,Ye=ma,Ze=(de=(pe=Ye.x)-ve)*ve+(ge=(fe=Ye.y)-be)*be+(Xe=(ue=Ye.z)-xe)*xe;if((Ze=-Ze/(de*de+ge*ge+Xe*Xe))<0){var Me=h;Me.x=ve,Me.y=be,Me.z=xe,ze=1}else if(Ze>1){var Ie=h;Ie.x=pe,Ie.y=fe,Ie.z=ue,ze=2}else{var Ve,we,Le;Ve=ve+de*Ze,we=be+ge*Ze,Le=xe+Xe*Ze;var ke=h;ke.x=Ve,ke.y=we,ke.z=Le,ze=3}var Be=h.x*h.x+h.y*h.y+h.z*h.z;if(Gr<0||Be<Gr){Wr=ze<<1,Gr=Be;var Ae=h;Rr=Ae.x,Er=Ae.y,qr=Ae.z}}if(Dr<0){var Pe,Se,Te,Ce,je,Re,Ee=ha;Pe=Ee.x,Se=Ee.y,Te=Ee.z;var qe,Ne,Fe,De,Ge=ma,We=(qe=(Ce=Ge.x)-Pe)*Pe+(Ne=(je=Ge.y)-Se)*Se+(Fe=(Re=Ge.z)-Te)*Te;if((We=-We/(qe*qe+Ne*Ne+Fe*Fe))<0){var Je=h;Je.x=Pe,Je.y=Se,Je.z=Te,De=1}else if(We>1){var Ue=h;Ue.x=Ce,Ue.y=je,Ue.z=Re,De=2}else{var Oe,He,Qe;Oe=Pe+qe*We,He=Se+Ne*We,Qe=Te+Fe*We;var Ke=h;Ke.x=Oe,Ke.y=He,Ke.z=Qe,De=3}var $e=h.x*h.x+h.y*h.y+h.z*h.z;if(Gr<0||$e<Gr){Wr=1&De|(2&De)<<1,Gr=$e;var t_=h;Rr=t_.x,Er=t_.y,qr=t_.z}}if(Gr>0){var i_=h;i_.x=Rr,i_.y=Er,i_.z=qr,Nr=Wr}else{var a_=Sr*Sr+Tr*Tr+Cr*Cr;a_>0&&(a_=1/Math.sqrt(a_));var s_=(Sr*=a_)*Sr+(Tr*=a_)*Tr+(Cr*=a_)*Cr;Rr=Sr*(s_=(xr*Sr+pr*Tr+fr*Cr)/s_),Er=Tr*s_,qr=Cr*s_;var o_=h;o_.x=Rr,o_.y=Er,o_.z=qr,Nr=7}var n_=h.x*h.x+h.y*h.y+h.z*h.z;if(Va<0||n_<Va){wa=3&Nr|(4&Nr)<<1,Va=n_;var r_=h;ga=r_.x,Xa=r_.y,za=r_.z}}if(Ia*Ya<0){var e_,__,h_,l_,c_,m_,v_,b_,x_,p_,f_,u_,y_,d_,g_,X_,z_,Y_,Z_=la;e_=Z_.x,__=Z_.y,h_=Z_.z;var M_=ca;l_=M_.x,c_=M_.y,m_=M_.z;var I_,V_,w_,L_=ma;v_=L_.x;var k_,B_,A_,P_,S_=l_*((d_=(b_=L_.y)-c_)*(w_=(p_=l_-e_)*d_-(f_=c_-__)*(y_=v_-l_))-(g_=(x_=L_.z)-m_)*(V_=(u_=m_-h_)*y_-p_*g_))+c_*(g_*(I_=f_*g_-u_*d_)-y_*w_)+m_*(y_*V_-d_*I_),T_=v_*((z_=__-b_)*w_-(Y_=h_-x_)*V_)+b_*(Y_*I_-(X_=e_-v_)*w_)+x_*(X_*V_-z_*I_),C_=-1,j_=0;if(k_=0,B_=0,A_=0,e_*(f_*w_-u_*V_)+__*(u_*I_-p_*w_)+h_*(p_*V_-f_*I_)<0){var R_,E_,q_,N_,F_,D_,G_=la;R_=G_.x,E_=G_.y,q_=G_.z;var W_,J_,U_,O_,H_=ca,Q_=(W_=(N_=H_.x)-R_)*R_+(J_=(F_=H_.y)-E_)*E_+(U_=(D_=H_.z)-q_)*q_;if((Q_=-Q_/(W_*W_+J_*J_+U_*U_))<0){var K_=h;K_.x=R_,K_.y=E_,K_.z=q_,O_=1}else if(Q_>1){var $_=h;$_.x=N_,$_.y=F_,$_.z=D_,O_=2}else{var th,ih,ah;th=R_+W_*Q_,ih=E_+J_*Q_,ah=q_+U_*Q_;var sh=h;sh.x=th,sh.y=ih,sh.z=ah,O_=3}j_=O_,C_=h.x*h.x+h.y*h.y+h.z*h.z;var oh=h;k_=oh.x,B_=oh.y,A_=oh.z}if(S_<0){var nh,rh,eh,_h,hh,lh,ch=ca;nh=ch.x,rh=ch.y,eh=ch.z;var mh,vh,bh,xh,ph=ma,fh=(mh=(_h=ph.x)-nh)*nh+(vh=(hh=ph.y)-rh)*rh+(bh=(lh=ph.z)-eh)*eh;if((fh=-fh/(mh*mh+vh*vh+bh*bh))<0){var uh=h;uh.x=nh,uh.y=rh,uh.z=eh,xh=1}else if(fh>1){var yh=h;yh.x=_h,yh.y=hh,yh.z=lh,xh=2}else{var dh,gh,Xh;dh=nh+mh*fh,gh=rh+vh*fh,Xh=eh+bh*fh;var zh=h;zh.x=dh,zh.y=gh,zh.z=Xh,xh=3}var Yh=h.x*h.x+h.y*h.y+h.z*h.z;if(C_<0||Yh<C_){j_=xh<<1,C_=Yh;var Zh=h;k_=Zh.x,B_=Zh.y,A_=Zh.z}}if(T_<0){var Mh,Ih,Vh,wh,Lh,kh,Bh=la;Mh=Bh.x,Ih=Bh.y,Vh=Bh.z;var Ah,Ph,Sh,Th,Ch=ma,jh=(Ah=(wh=Ch.x)-Mh)*Mh+(Ph=(Lh=Ch.y)-Ih)*Ih+(Sh=(kh=Ch.z)-Vh)*Vh;if((jh=-jh/(Ah*Ah+Ph*Ph+Sh*Sh))<0){var Rh=h;Rh.x=Mh,Rh.y=Ih,Rh.z=Vh,Th=1}else if(jh>1){var Eh=h;Eh.x=wh,Eh.y=Lh,Eh.z=kh,Th=2}else{var qh,Nh,Fh;qh=Mh+Ah*jh,Nh=Ih+Ph*jh,Fh=Vh+Sh*jh;var Dh=h;Dh.x=qh,Dh.y=Nh,Dh.z=Fh,Th=3}var Gh=h.x*h.x+h.y*h.y+h.z*h.z;if(C_<0||Gh<C_){j_=1&Th|(2&Th)<<1,C_=Gh;var Wh=h;k_=Wh.x,B_=Wh.y,A_=Wh.z}}if(C_>0){var Jh=h;Jh.x=k_,Jh.y=B_,Jh.z=A_,P_=j_}else{var Uh=I_*I_+V_*V_+w_*w_;Uh>0&&(Uh=1/Math.sqrt(Uh));var Oh=(I_*=Uh)*I_+(V_*=Uh)*V_+(w_*=Uh)*w_;k_=I_*(Oh=(e_*I_+__*V_+h_*w_)/Oh),B_=V_*Oh,A_=w_*Oh;var Hh=h;Hh.x=k_,Hh.y=B_,Hh.z=A_,P_=7}var Qh=h.x*h.x+h.y*h.y+h.z*h.z;if(Va<0||Qh<Va){wa=P_<<1,Va=Qh;var Kh=h;ga=Kh.x,Xa=Kh.y,za=Kh.z}}if(Va>0){var $h=h;$h.x=ga,$h.y=Xa,$h.z=za,Y=wa}else h.zero(),Y=15}if(h.x*h.x+h.y*h.y+h.z*h.z<z){if(!n)return this.distance=0,0;switch(this.simplexSize){case 1:this.pointToTetrahedron();break;case 2:this.lineToTetrahedron();break;case 3:this.triangleToTetrahedron()}if(4==this.simplexSize){var tl=this.computeDepth(t,i,a,s,r,e,_);return 0!=tl?(this.distance=0,tl):(this.distance=-this.depth,0)}return this.distance=0,1}this.shrinkSimplex(Y),l.x=h.x,l.y=h.y,l.z=h.z;var il=l,al=-il.x,sl=-il.y,ol=-il.z;il.x=al,il.y=sl,il.z=ol,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var nl=this.s[this.simplexSize],rl=this.w1[this.simplexSize];nl.x=rl.x,nl.y=rl.y,nl.z=rl.z;var el=nl,_l=this.w2[this.simplexSize],hl=el.x-_l.x,ll=el.y-_l.y,cl=el.z-_l.z;if(el.x=hl,el.y=ll,el.z=cl,l.x*l.x+l.y*l.y+l.z*l.z<z)throw new Error("!?");var ml=h.x*l.x+h.y*l.y+h.z*l.z,vl=r[this.simplexSize];if(vl.x*l.x+vl.y*l.y+vl.z*l.z-ml<z)return this.interpolateClosestPoints(),this.distance=Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z),null!=o&&null!=o._gjkCache&&this.saveCache(o._gjkCache),0;this.simplexSize++,++X}return 2}convexCastImpl(t,i,a,s,o,n,r){this.c1=t,this.c2=i,this.tf1=a,this.tf2=s;var e=this.s;this.w1,this.w2;var _,h,l,c=this.closest,m=this.dir;_=s._positionX-a._positionX,h=s._positionY-a._positionY,l=s._positionZ-a._positionZ;var v=m;if(v.x=_,v.y=h,v.z=l,m.x*m.x+m.y*m.y+m.z*m.z<1e-6&&m.init(1,0,0),this.simplexSize=0,null!=this.c1)this.computeWitnessPoint1(!0);else{var b=this.w1[this.simplexSize];b.x=this.tf1._positionX,b.y=this.tf1._positionY,b.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);var x=this.s[this.simplexSize],p=this.w1[this.simplexSize];x.x=p.x,x.y=p.y,x.z=p.z;var f=x,u=this.w2[this.simplexSize],y=f.x-u.x,d=f.y-u.y,g=f.z-u.z;f.x=y,f.y=d,f.z=g,this.simplexSize=1;var X=0,z=0,Y=this.rayX,Z=this.rayR;Y.zero(),Z.x=n.x,Z.y=n.y,Z.z=n.z;var M=Z,I=M.x-o.x,V=M.y-o.y,w=M.z-o.z;M.x=I,M.y=V,M.z=w;for(var L=1e-8;X<40;){var k=0;switch(this.simplexSize){case 1:var B=e[0];c.x=B.x,c.y=B.y,c.z=B.z,k=1;break;case 2:var A,P,S,T,C,j,R=e[0];A=R.x,P=R.y,S=R.z;var E,q,N,F=e[1],D=(E=(T=F.x)-A)*A+(q=(C=F.y)-P)*P+(N=(j=F.z)-S)*S;if((D=-D/(E*E+q*q+N*N))<0){var G=c;G.x=A,G.y=P,G.z=S,k=1}else if(D>1){var W=c;W.x=T,W.y=C,W.z=j,k=2}else{var J,U,O;J=A+E*D,U=P+q*D,O=S+N*D;var H=c;H.x=J,H.y=U,H.z=O,k=3}break;case 3:var Q,K,$,tt,it,at,st,ot,nt,rt,et,_t,ht,lt,ct,mt,vt,bt,xt=e[0],pt=e[1],ft=e[2],ut=xt;Q=ut.x,K=ut.y,$=ut.z;var yt=pt;tt=yt.x,it=yt.y,at=yt.z;var dt,gt,Xt,zt=ft;st=zt.x;var Yt,Zt,Mt,It=tt*((lt=(ot=zt.y)-it)*(Xt=(rt=tt-Q)*lt-(et=it-K)*(ht=st-tt))-(ct=(nt=zt.z)-at)*(gt=(_t=at-$)*ht-rt*ct))+it*(ct*(dt=et*ct-_t*lt)-ht*Xt)+at*(ht*gt-lt*dt),Vt=st*((vt=K-ot)*Xt-(bt=$-nt)*gt)+ot*(bt*dt-(mt=Q-st)*Xt)+nt*(mt*gt-vt*dt),wt=-1,Lt=0;if(Yt=0,Zt=0,Mt=0,Q*(et*Xt-_t*gt)+K*(_t*dt-rt*Xt)+$*(rt*gt-et*dt)<0){var kt,Bt,At,Pt,St,Tt,Ct=xt;kt=Ct.x,Bt=Ct.y,At=Ct.z;var jt,Rt,Et,qt,Nt=pt,Ft=(jt=(Pt=Nt.x)-kt)*kt+(Rt=(St=Nt.y)-Bt)*Bt+(Et=(Tt=Nt.z)-At)*At;if((Ft=-Ft/(jt*jt+Rt*Rt+Et*Et))<0){var Dt=c;Dt.x=kt,Dt.y=Bt,Dt.z=At,qt=1}else if(Ft>1){var Gt=c;Gt.x=Pt,Gt.y=St,Gt.z=Tt,qt=2}else{var Wt,Jt,Ut;Wt=kt+jt*Ft,Jt=Bt+Rt*Ft,Ut=At+Et*Ft;var Ot=c;Ot.x=Wt,Ot.y=Jt,Ot.z=Ut,qt=3}Lt=qt,wt=c.x*c.x+c.y*c.y+c.z*c.z;var Ht=c;Yt=Ht.x,Zt=Ht.y,Mt=Ht.z}if(It<0){var Qt,Kt,$t,ti,ii,ai,si=pt;Qt=si.x,Kt=si.y,$t=si.z;var oi,ni,ri,ei,_i=ft,hi=(oi=(ti=_i.x)-Qt)*Qt+(ni=(ii=_i.y)-Kt)*Kt+(ri=(ai=_i.z)-$t)*$t;if((hi=-hi/(oi*oi+ni*ni+ri*ri))<0){var li=c;li.x=Qt,li.y=Kt,li.z=$t,ei=1}else if(hi>1){var ci=c;ci.x=ti,ci.y=ii,ci.z=ai,ei=2}else{var mi,vi,bi;mi=Qt+oi*hi,vi=Kt+ni*hi,bi=$t+ri*hi;var xi=c;xi.x=mi,xi.y=vi,xi.z=bi,ei=3}var pi=c.x*c.x+c.y*c.y+c.z*c.z;if(wt<0||pi<wt){Lt=ei<<1,wt=pi;var fi=c;Yt=fi.x,Zt=fi.y,Mt=fi.z}}if(Vt<0){var ui,yi,di,gi,Xi,zi,Yi=xt;ui=Yi.x,yi=Yi.y,di=Yi.z;var Zi,Mi,Ii,Vi,wi=ft,Li=(Zi=(gi=wi.x)-ui)*ui+(Mi=(Xi=wi.y)-yi)*yi+(Ii=(zi=wi.z)-di)*di;if((Li=-Li/(Zi*Zi+Mi*Mi+Ii*Ii))<0){var ki=c;ki.x=ui,ki.y=yi,ki.z=di,Vi=1}else if(Li>1){var Bi=c;Bi.x=gi,Bi.y=Xi,Bi.z=zi,Vi=2}else{var Ai,Pi,Si;Ai=ui+Zi*Li,Pi=yi+Mi*Li,Si=di+Ii*Li;var Ti=c;Ti.x=Ai,Ti.y=Pi,Ti.z=Si,Vi=3}var Ci=c.x*c.x+c.y*c.y+c.z*c.z;if(wt<0||Ci<wt){Lt=1&Vi|(2&Vi)<<1,wt=Ci;var ji=c;Yt=ji.x,Zt=ji.y,Mt=ji.z}}if(wt>0){var Ri=c;Ri.x=Yt,Ri.y=Zt,Ri.z=Mt,k=Lt}else{var Ei=dt*dt+gt*gt+Xt*Xt;Ei>0&&(Ei=1/Math.sqrt(Ei));var qi=(dt*=Ei)*dt+(gt*=Ei)*gt+(Xt*=Ei)*Xt;Yt=dt*(qi=(Q*dt+K*gt+$*Xt)/qi),Zt=gt*qi,Mt=Xt*qi;var Ni=c;Ni.x=Yt,Ni.y=Zt,Ni.z=Mt,k=7}break;case 4:var Fi,Di,Gi,Wi,Ji,Ui,Oi,Hi,Qi,Ki,$i,ta,ia,aa,sa,oa,na,ra,ea,_a,ha,la,ca,ma,va,ba,xa,pa=e[0],fa=e[1],ua=e[2],ya=e[3],da=pa;Fi=da.x,Di=da.y,Gi=da.z;var ga=fa;Wi=ga.x,Ji=ga.y,Ui=ga.z;var Xa=ua;Oi=Xa.x,Hi=Xa.y,Qi=Xa.z;var za,Ya,Za,Ma=ya;Ki=Ma.x;var Ia,Va,wa,La=(ia=Wi-Fi)*(za=(ba=($i=Ma.y)-Ji)*(ma=Qi-Ui)-(xa=(ta=Ma.z)-Ui)*(ca=Hi-Ji))+(aa=Ji-Di)*(Ya=xa*(la=Oi-Wi)-(va=Ki-Wi)*ma)+(sa=Ui-Gi)*(Za=va*ca-ba*la)>0?1:-1,ka=Fi*((na=Hi-Di)*(ha=ta-Gi)-(ra=Qi-Gi)*(_a=$i-Di))+Di*(ra*(ea=Ki-Fi)-(oa=Oi-Fi)*ha)+Gi*(oa*_a-na*ea),Ba=Fi*(_a*sa-ha*aa)+Di*(ha*ia-ea*sa)+Gi*(ea*aa-_a*ia),Aa=Wi*za+Ji*Ya+Ui*Za,Pa=-1,Sa=0;if(Ia=0,Va=0,wa=0,(Fi*(aa*ra-sa*na)+Di*(sa*oa-ia*ra)+Gi*(ia*na-aa*oa))*La<0){var Ta,Ca,ja,Ra,Ea,qa,Na,Fa,Da,Ga,Wa,Ja,Ua,Oa,Ha,Qa,Ka,$a,ts=pa;Ta=ts.x,Ca=ts.y,ja=ts.z;var is=fa;Ra=is.x,Ea=is.y,qa=is.z;var as,ss,os,ns=ua;Na=ns.x;var rs,es,_s,hs,ls=Ra*((Oa=(Fa=ns.y)-Ea)*(os=(Ga=Ra-Ta)*Oa-(Wa=Ea-Ca)*(Ua=Na-Ra))-(Ha=(Da=ns.z)-qa)*(ss=(Ja=qa-ja)*Ua-Ga*Ha))+Ea*(Ha*(as=Wa*Ha-Ja*Oa)-Ua*os)+qa*(Ua*ss-Oa*as),cs=Na*((Ka=Ca-Fa)*os-($a=ja-Da)*ss)+Fa*($a*as-(Qa=Ta-Na)*os)+Da*(Qa*ss-Ka*as),ms=-1,vs=0;if(rs=0,es=0,_s=0,Ta*(Wa*os-Ja*ss)+Ca*(Ja*as-Ga*os)+ja*(Ga*ss-Wa*as)<0){var bs,xs,ps,fs,us,ys,ds=pa;bs=ds.x,xs=ds.y,ps=ds.z;var gs,Xs,zs,Ys,Zs=fa,Ms=(gs=(fs=Zs.x)-bs)*bs+(Xs=(us=Zs.y)-xs)*xs+(zs=(ys=Zs.z)-ps)*ps;if((Ms=-Ms/(gs*gs+Xs*Xs+zs*zs))<0){var Is=c;Is.x=bs,Is.y=xs,Is.z=ps,Ys=1}else if(Ms>1){var Vs=c;Vs.x=fs,Vs.y=us,Vs.z=ys,Ys=2}else{var ws,Ls,ks;ws=bs+gs*Ms,Ls=xs+Xs*Ms,ks=ps+zs*Ms;var Bs=c;Bs.x=ws,Bs.y=Ls,Bs.z=ks,Ys=3}vs=Ys,ms=c.x*c.x+c.y*c.y+c.z*c.z;var As=c;rs=As.x,es=As.y,_s=As.z}if(ls<0){var Ps,Ss,Ts,Cs,js,Rs,Es=fa;Ps=Es.x,Ss=Es.y,Ts=Es.z;var qs,Ns,Fs,Ds,Gs=ua,Ws=(qs=(Cs=Gs.x)-Ps)*Ps+(Ns=(js=Gs.y)-Ss)*Ss+(Fs=(Rs=Gs.z)-Ts)*Ts;if((Ws=-Ws/(qs*qs+Ns*Ns+Fs*Fs))<0){var Js=c;Js.x=Ps,Js.y=Ss,Js.z=Ts,Ds=1}else if(Ws>1){var Us=c;Us.x=Cs,Us.y=js,Us.z=Rs,Ds=2}else{var Os,Hs,Qs;Os=Ps+qs*Ws,Hs=Ss+Ns*Ws,Qs=Ts+Fs*Ws;var Ks=c;Ks.x=Os,Ks.y=Hs,Ks.z=Qs,Ds=3}var $s=c.x*c.x+c.y*c.y+c.z*c.z;if(ms<0||$s<ms){vs=Ds<<1,ms=$s;var to=c;rs=to.x,es=to.y,_s=to.z}}if(cs<0){var io,ao,so,oo,no,ro,eo=pa;io=eo.x,ao=eo.y,so=eo.z;var _o,ho,lo,co,mo=ua,vo=(_o=(oo=mo.x)-io)*io+(ho=(no=mo.y)-ao)*ao+(lo=(ro=mo.z)-so)*so;if((vo=-vo/(_o*_o+ho*ho+lo*lo))<0){var bo=c;bo.x=io,bo.y=ao,bo.z=so,co=1}else if(vo>1){var xo=c;xo.x=oo,xo.y=no,xo.z=ro,co=2}else{var po,fo,uo;po=io+_o*vo,fo=ao+ho*vo,uo=so+lo*vo;var yo=c;yo.x=po,yo.y=fo,yo.z=uo,co=3}var go=c.x*c.x+c.y*c.y+c.z*c.z;if(ms<0||go<ms){vs=1&co|(2&co)<<1,ms=go;var Xo=c;rs=Xo.x,es=Xo.y,_s=Xo.z}}if(ms>0){var zo=c;zo.x=rs,zo.y=es,zo.z=_s,hs=vs}else{var Yo=as*as+ss*ss+os*os;Yo>0&&(Yo=1/Math.sqrt(Yo));var Zo=(as*=Yo)*as+(ss*=Yo)*ss+(os*=Yo)*os;rs=as*(Zo=(Ta*as+Ca*ss+ja*os)/Zo),es=ss*Zo,_s=os*Zo;var Mo=c;Mo.x=rs,Mo.y=es,Mo.z=_s,hs=7}Sa=hs,Pa=c.x*c.x+c.y*c.y+c.z*c.z;var Io=c;Ia=Io.x,Va=Io.y,wa=Io.z}if(ka*La<0){var Vo,wo,Lo,ko,Bo,Ao,Po,So,To,Co,jo,Ro,Eo,qo,No,Fo,Do,Go,Wo=pa;Vo=Wo.x,wo=Wo.y,Lo=Wo.z;var Jo=ua;ko=Jo.x,Bo=Jo.y,Ao=Jo.z;var Uo,Oo,Ho,Qo=ya;Po=Qo.x;var Ko,$o,tn,an,sn=ko*((qo=(So=Qo.y)-Bo)*(Ho=(Co=ko-Vo)*qo-(jo=Bo-wo)*(Eo=Po-ko))-(No=(To=Qo.z)-Ao)*(Oo=(Ro=Ao-Lo)*Eo-Co*No))+Bo*(No*(Uo=jo*No-Ro*qo)-Eo*Ho)+Ao*(Eo*Oo-qo*Uo),on=Po*((Do=wo-So)*Ho-(Go=Lo-To)*Oo)+So*(Go*Uo-(Fo=Vo-Po)*Ho)+To*(Fo*Oo-Do*Uo),nn=-1,rn=0;if(Ko=0,$o=0,tn=0,Vo*(jo*Ho-Ro*Oo)+wo*(Ro*Uo-Co*Ho)+Lo*(Co*Oo-jo*Uo)<0){var en,_n,hn,ln,cn,mn,vn=pa;en=vn.x,_n=vn.y,hn=vn.z;var bn,xn,pn,fn,un=ua,yn=(bn=(ln=un.x)-en)*en+(xn=(cn=un.y)-_n)*_n+(pn=(mn=un.z)-hn)*hn;if((yn=-yn/(bn*bn+xn*xn+pn*pn))<0){var dn=c;dn.x=en,dn.y=_n,dn.z=hn,fn=1}else if(yn>1){var gn=c;gn.x=ln,gn.y=cn,gn.z=mn,fn=2}else{var Xn,zn,Yn;Xn=en+bn*yn,zn=_n+xn*yn,Yn=hn+pn*yn;var Zn=c;Zn.x=Xn,Zn.y=zn,Zn.z=Yn,fn=3}rn=fn,nn=c.x*c.x+c.y*c.y+c.z*c.z;var Mn=c;Ko=Mn.x,$o=Mn.y,tn=Mn.z}if(sn<0){var In,Vn,wn,Ln,kn,Bn,An=ua;In=An.x,Vn=An.y,wn=An.z;var Pn,Sn,Tn,Cn,jn=ya,Rn=(Pn=(Ln=jn.x)-In)*In+(Sn=(kn=jn.y)-Vn)*Vn+(Tn=(Bn=jn.z)-wn)*wn;if((Rn=-Rn/(Pn*Pn+Sn*Sn+Tn*Tn))<0){var En=c;En.x=In,En.y=Vn,En.z=wn,Cn=1}else if(Rn>1){var qn=c;qn.x=Ln,qn.y=kn,qn.z=Bn,Cn=2}else{var Nn,Fn,Dn;Nn=In+Pn*Rn,Fn=Vn+Sn*Rn,Dn=wn+Tn*Rn;var Gn=c;Gn.x=Nn,Gn.y=Fn,Gn.z=Dn,Cn=3}var Wn=c.x*c.x+c.y*c.y+c.z*c.z;if(nn<0||Wn<nn){rn=Cn<<1,nn=Wn;var Jn=c;Ko=Jn.x,$o=Jn.y,tn=Jn.z}}if(on<0){var Un,On,Hn,Qn,Kn,$n,tr=pa;Un=tr.x,On=tr.y,Hn=tr.z;var ir,ar,sr,or,nr=ya,rr=(ir=(Qn=nr.x)-Un)*Un+(ar=(Kn=nr.y)-On)*On+(sr=($n=nr.z)-Hn)*Hn;if((rr=-rr/(ir*ir+ar*ar+sr*sr))<0){var er=c;er.x=Un,er.y=On,er.z=Hn,or=1}else if(rr>1){var _r=c;_r.x=Qn,_r.y=Kn,_r.z=$n,or=2}else{var hr,lr,cr;hr=Un+ir*rr,lr=On+ar*rr,cr=Hn+sr*rr;var mr=c;mr.x=hr,mr.y=lr,mr.z=cr,or=3}var vr=c.x*c.x+c.y*c.y+c.z*c.z;if(nn<0||vr<nn){rn=1&or|(2&or)<<1,nn=vr;var br=c;Ko=br.x,$o=br.y,tn=br.z}}if(nn>0){var xr=c;xr.x=Ko,xr.y=$o,xr.z=tn,an=rn}else{var pr=Uo*Uo+Oo*Oo+Ho*Ho;pr>0&&(pr=1/Math.sqrt(pr));var fr=(Uo*=pr)*Uo+(Oo*=pr)*Oo+(Ho*=pr)*Ho;Ko=Uo*(fr=(Vo*Uo+wo*Oo+Lo*Ho)/fr),$o=Oo*fr,tn=Ho*fr;var ur=c;ur.x=Ko,ur.y=$o,ur.z=tn,an=7}var yr=c.x*c.x+c.y*c.y+c.z*c.z;if(Pa<0||yr<Pa){Sa=1&an|(6&an)<<1,Pa=yr;var dr=c;Ia=dr.x,Va=dr.y,wa=dr.z}}if(Ba*La<0){var gr,Xr,zr,Yr,Zr,Mr,Ir,Vr,wr,Lr,kr,Br,Ar,Pr,Sr,Tr,Cr,jr,Rr=pa;gr=Rr.x,Xr=Rr.y,zr=Rr.z;var Er=fa;Yr=Er.x,Zr=Er.y,Mr=Er.z;var qr,Nr,Fr,Dr=ya;Ir=Dr.x;var Gr,Wr,Jr,Ur,Or=Yr*((Pr=(Vr=Dr.y)-Zr)*(Fr=(Lr=Yr-gr)*Pr-(kr=Zr-Xr)*(Ar=Ir-Yr))-(Sr=(wr=Dr.z)-Mr)*(Nr=(Br=Mr-zr)*Ar-Lr*Sr))+Zr*(Sr*(qr=kr*Sr-Br*Pr)-Ar*Fr)+Mr*(Ar*Nr-Pr*qr),Hr=Ir*((Cr=Xr-Vr)*Fr-(jr=zr-wr)*Nr)+Vr*(jr*qr-(Tr=gr-Ir)*Fr)+wr*(Tr*Nr-Cr*qr),Qr=-1,Kr=0;if(Gr=0,Wr=0,Jr=0,gr*(kr*Fr-Br*Nr)+Xr*(Br*qr-Lr*Fr)+zr*(Lr*Nr-kr*qr)<0){var $r,te,ie,ae,se,oe,ne=pa;$r=ne.x,te=ne.y,ie=ne.z;var re,ee,_e,he,le=fa,ce=(re=(ae=le.x)-$r)*$r+(ee=(se=le.y)-te)*te+(_e=(oe=le.z)-ie)*ie;if((ce=-ce/(re*re+ee*ee+_e*_e))<0){var me=c;me.x=$r,me.y=te,me.z=ie,he=1}else if(ce>1){var ve=c;ve.x=ae,ve.y=se,ve.z=oe,he=2}else{var be,xe,pe;be=$r+re*ce,xe=te+ee*ce,pe=ie+_e*ce;var fe=c;fe.x=be,fe.y=xe,fe.z=pe,he=3}Kr=he,Qr=c.x*c.x+c.y*c.y+c.z*c.z;var ue=c;Gr=ue.x,Wr=ue.y,Jr=ue.z}if(Or<0){var ye,de,ge,Xe,ze,Ye,Ze=fa;ye=Ze.x,de=Ze.y,ge=Ze.z;var Me,Ie,Ve,we,Le=ya,ke=(Me=(Xe=Le.x)-ye)*ye+(Ie=(ze=Le.y)-de)*de+(Ve=(Ye=Le.z)-ge)*ge;if((ke=-ke/(Me*Me+Ie*Ie+Ve*Ve))<0){var Be=c;Be.x=ye,Be.y=de,Be.z=ge,we=1}else if(ke>1){var Ae=c;Ae.x=Xe,Ae.y=ze,Ae.z=Ye,we=2}else{var Pe,Se,Te;Pe=ye+Me*ke,Se=de+Ie*ke,Te=ge+Ve*ke;var Ce=c;Ce.x=Pe,Ce.y=Se,Ce.z=Te,we=3}var je=c.x*c.x+c.y*c.y+c.z*c.z;if(Qr<0||je<Qr){Kr=we<<1,Qr=je;var Re=c;Gr=Re.x,Wr=Re.y,Jr=Re.z}}if(Hr<0){var Ee,qe,Ne,Fe,De,Ge,We=pa;Ee=We.x,qe=We.y,Ne=We.z;var Je,Ue,Oe,He,Qe=ya,Ke=(Je=(Fe=Qe.x)-Ee)*Ee+(Ue=(De=Qe.y)-qe)*qe+(Oe=(Ge=Qe.z)-Ne)*Ne;if((Ke=-Ke/(Je*Je+Ue*Ue+Oe*Oe))<0){var $e=c;$e.x=Ee,$e.y=qe,$e.z=Ne,He=1}else if(Ke>1){var t_=c;t_.x=Fe,t_.y=De,t_.z=Ge,He=2}else{var i_,a_,s_;i_=Ee+Je*Ke,a_=qe+Ue*Ke,s_=Ne+Oe*Ke;var o_=c;o_.x=i_,o_.y=a_,o_.z=s_,He=3}var n_=c.x*c.x+c.y*c.y+c.z*c.z;if(Qr<0||n_<Qr){Kr=1&He|(2&He)<<1,Qr=n_;var r_=c;Gr=r_.x,Wr=r_.y,Jr=r_.z}}if(Qr>0){var e_=c;e_.x=Gr,e_.y=Wr,e_.z=Jr,Ur=Kr}else{var __=qr*qr+Nr*Nr+Fr*Fr;__>0&&(__=1/Math.sqrt(__));var h_=(qr*=__)*qr+(Nr*=__)*Nr+(Fr*=__)*Fr;Gr=qr*(h_=(gr*qr+Xr*Nr+zr*Fr)/h_),Wr=Nr*h_,Jr=Fr*h_;var l_=c;l_.x=Gr,l_.y=Wr,l_.z=Jr,Ur=7}var c_=c.x*c.x+c.y*c.y+c.z*c.z;if(Pa<0||c_<Pa){Sa=3&Ur|(4&Ur)<<1,Pa=c_;var m_=c;Ia=m_.x,Va=m_.y,wa=m_.z}}if(Aa*La<0){var v_,b_,x_,p_,f_,u_,y_,d_,g_,X_,z_,Y_,Z_,M_,I_,V_,w_,L_,k_=fa;v_=k_.x,b_=k_.y,x_=k_.z;var B_=ua;p_=B_.x,f_=B_.y,u_=B_.z;var A_,P_,S_,T_=ya;y_=T_.x;var C_,j_,R_,E_,q_=p_*((M_=(d_=T_.y)-f_)*(S_=(X_=p_-v_)*M_-(z_=f_-b_)*(Z_=y_-p_))-(I_=(g_=T_.z)-u_)*(P_=(Y_=u_-x_)*Z_-X_*I_))+f_*(I_*(A_=z_*I_-Y_*M_)-Z_*S_)+u_*(Z_*P_-M_*A_),N_=y_*((w_=b_-d_)*S_-(L_=x_-g_)*P_)+d_*(L_*A_-(V_=v_-y_)*S_)+g_*(V_*P_-w_*A_),F_=-1,D_=0;if(C_=0,j_=0,R_=0,v_*(z_*S_-Y_*P_)+b_*(Y_*A_-X_*S_)+x_*(X_*P_-z_*A_)<0){var G_,W_,J_,U_,O_,H_,Q_=fa;G_=Q_.x,W_=Q_.y,J_=Q_.z;var K_,$_,th,ih,ah=ua,sh=(K_=(U_=ah.x)-G_)*G_+($_=(O_=ah.y)-W_)*W_+(th=(H_=ah.z)-J_)*J_;if((sh=-sh/(K_*K_+$_*$_+th*th))<0){var oh=c;oh.x=G_,oh.y=W_,oh.z=J_,ih=1}else if(sh>1){var nh=c;nh.x=U_,nh.y=O_,nh.z=H_,ih=2}else{var rh,eh,_h;rh=G_+K_*sh,eh=W_+$_*sh,_h=J_+th*sh;var hh=c;hh.x=rh,hh.y=eh,hh.z=_h,ih=3}D_=ih,F_=c.x*c.x+c.y*c.y+c.z*c.z;var lh=c;C_=lh.x,j_=lh.y,R_=lh.z}if(q_<0){var ch,mh,vh,bh,xh,ph,fh=ua;ch=fh.x,mh=fh.y,vh=fh.z;var uh,yh,dh,gh,Xh=ya,zh=(uh=(bh=Xh.x)-ch)*ch+(yh=(xh=Xh.y)-mh)*mh+(dh=(ph=Xh.z)-vh)*vh;if((zh=-zh/(uh*uh+yh*yh+dh*dh))<0){var Yh=c;Yh.x=ch,Yh.y=mh,Yh.z=vh,gh=1}else if(zh>1){var Zh=c;Zh.x=bh,Zh.y=xh,Zh.z=ph,gh=2}else{var Mh,Ih,Vh;Mh=ch+uh*zh,Ih=mh+yh*zh,Vh=vh+dh*zh;var wh=c;wh.x=Mh,wh.y=Ih,wh.z=Vh,gh=3}var Lh=c.x*c.x+c.y*c.y+c.z*c.z;if(F_<0||Lh<F_){D_=gh<<1,F_=Lh;var kh=c;C_=kh.x,j_=kh.y,R_=kh.z}}if(N_<0){var Bh,Ah,Ph,Sh,Th,Ch,jh=fa;Bh=jh.x,Ah=jh.y,Ph=jh.z;var Rh,Eh,qh,Nh,Fh=ya,Dh=(Rh=(Sh=Fh.x)-Bh)*Bh+(Eh=(Th=Fh.y)-Ah)*Ah+(qh=(Ch=Fh.z)-Ph)*Ph;if((Dh=-Dh/(Rh*Rh+Eh*Eh+qh*qh))<0){var Gh=c;Gh.x=Bh,Gh.y=Ah,Gh.z=Ph,Nh=1}else if(Dh>1){var Wh=c;Wh.x=Sh,Wh.y=Th,Wh.z=Ch,Nh=2}else{var Jh,Uh,Oh;Jh=Bh+Rh*Dh,Uh=Ah+Eh*Dh,Oh=Ph+qh*Dh;var Hh=c;Hh.x=Jh,Hh.y=Uh,Hh.z=Oh,Nh=3}var Qh=c.x*c.x+c.y*c.y+c.z*c.z;if(F_<0||Qh<F_){D_=1&Nh|(2&Nh)<<1,F_=Qh;var Kh=c;C_=Kh.x,j_=Kh.y,R_=Kh.z}}if(F_>0){var $h=c;$h.x=C_,$h.y=j_,$h.z=R_,E_=D_}else{var tl=A_*A_+P_*P_+S_*S_;tl>0&&(tl=1/Math.sqrt(tl));var il=(A_*=tl)*A_+(P_*=tl)*P_+(S_*=tl)*S_;C_=A_*(il=(v_*A_+b_*P_+x_*S_)/il),j_=P_*il,R_=S_*il;var al=c;al.x=C_,al.y=j_,al.z=R_,E_=7}var sl=c.x*c.x+c.y*c.y+c.z*c.z;if(Pa<0||sl<Pa){Sa=E_<<1,Pa=sl;var ol=c;Ia=ol.x,Va=ol.y,wa=ol.z}}if(Pa>0){var nl=c;nl.x=Ia,nl.y=Va,nl.z=wa,k=Sa}else c.zero(),k=15}if(this.shrinkSimplex(k),c.x*c.x+c.y*c.y+c.z*c.z<L){if(0==z||4==this.simplexSize)return r.fraction=z,!1;this.interpolateClosestPoints(),r.fraction=z;var rl=r.normal;rl.x=m.x,rl.y=m.y,rl.z=m.z;var el=rl,_l=Math.sqrt(el.x*el.x+el.y*el.y+el.z*el.z);_l>0&&(_l=1/_l);var hl=el.x*_l,ll=el.y*_l,cl=el.z*_l;el.x=hl,el.y=ll,el.z=cl;var ml=r.position,vl=this.closestPoint1;ml.x=vl.x,ml.y=vl.y,ml.z=vl.z;var bl=ml,xl=bl.x+o.x*z,pl=bl.y+o.y*z,fl=bl.z+o.z*z;return bl.x=xl,bl.y=pl,bl.z=fl,!0}m.x=c.x,m.y=c.y,m.z=c.z;var ul=m,yl=-ul.x,dl=-ul.y,gl=-ul.z;if(ul.x=yl,ul.y=dl,ul.z=gl,null!=this.c1)this.computeWitnessPoint1(!0);else{var Xl=this.w1[this.simplexSize];Xl.x=this.tf1._positionX,Xl.y=this.tf1._positionY,Xl.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);var zl=this.s[this.simplexSize],Yl=this.w1[this.simplexSize];zl.x=Yl.x,zl.y=Yl.y,zl.z=Yl.z;var Zl=zl,Ml=this.w2[this.simplexSize],Il=Zl.x-Ml.x,Vl=Zl.y-Ml.y,wl=Zl.z-Ml.z;Zl.x=Il,Zl.y=Vl,Zl.z=wl;var Ll=e[this.simplexSize],kl=Ll.x-Y.x,Bl=Ll.y-Y.y,Al=Ll.z-Y.z;if(Ll.x=kl,Ll.y=Bl,Ll.z=Al,m.x*m.x+m.y*m.y+m.z*m.z<L)throw new Error("!?");var Pl=e[this.simplexSize],Sl=m,Tl=Pl.x*Sl.x+Pl.y*Sl.y+Pl.z*Sl.z;if(Tl<0){if(Z.x*Sl.x+Z.y*Sl.y+Z.z*Sl.z>=0)return!1;var Cl=Tl/(Z.x*Sl.x+Z.y*Sl.y+Z.z*Sl.z);if((z+=Cl)>=1)return!1;var jl=Y.x+Z.x*Cl,Rl=Y.y+Z.y*Cl,El=Y.z+Z.z*Cl;Y.x=jl,Y.y=Rl,Y.z=El;for(var ql=0,Nl=this.simplexSize+1;ql<Nl;){var Fl=e[ql++],Dl=-Cl,Gl=Fl.x+Z.x*Dl,Wl=Fl.y+Z.y*Dl,Jl=Fl.z+Z.z*Dl;Fl.x=Gl,Fl.y=Wl,Fl.z=Jl}}for(var Ul=!1,Ol=0,Hl=this.simplexSize;Ol<Hl;){var Ql=Ol++,Kl=e[Ql].x-e[this.simplexSize].x,$l=e[Ql].y-e[this.simplexSize].y,tc=e[Ql].z-e[this.simplexSize].z;if(Kl*Kl+$l*$l+tc*tc<L){Ul=!0;break}}Ul||this.simplexSize++,++X}return!1}interpolateClosestPoints(){switch(this.simplexSize){case 1:var t=this.closestPoint1,i=this.w1[0];t.x=i.x,t.y=i.y,t.z=i.z;var a=this.closestPoint2,s=this.w2[0];a.x=s.x,a.y=s.y,a.z=s.z;break;case 2:var o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y,d,g,X,z,Y,Z=this.closest;o=Z.x,n=Z.y,r=Z.z;var M=this.s[0];e=M.x,_=M.y,h=M.z;var I=this.w1[0];l=I.x,c=I.y,m=I.z;var V=this.w2[0];v=V.x,b=V.y,x=V.z;var w=this.s[1];p=w.x,f=w.y,u=w.z;var L=this.w1[1];y=L.x,d=L.y,g=L.z;var k=this.w2[1];X=k.x,z=k.y,Y=k.z;var B=this.s[2];B.x,B.y,B.z;var A=this.w1[2];A.x,A.y,A.z;var P,S,T,C=this.w2[2];C.x,C.y,C.z;var j=(P=p-e)*P+(S=f-_)*S+(T=u-h)*T;0!=j&&(j=1/j);var R,E,q,N,F,D,G=((o-e)*P+(n-_)*S+(r-h)*T)*j;R=l+(y-l)*G,E=c+(d-c)*G,q=m+(g-m)*G,N=v+(X-v)*G,F=b+(z-b)*G,D=x+(Y-x)*G;var W=this.closestPoint1;W.x=R,W.y=E,W.z=q;var J=this.closestPoint2;J.x=N,J.y=F,J.z=D;break;case 3:var U,O,H,Q,K,$,tt,it,at,st,ot,nt,rt,et,_t,ht,lt,ct,mt,vt,bt,xt,pt,ft,ut,yt,dt,gt=this.closest;U=gt.x,O=gt.y,H=gt.z;var Xt=this.s[0];Q=Xt.x,K=Xt.y,$=Xt.z;var zt=this.w1[0];tt=zt.x,it=zt.y,at=zt.z;var Yt=this.w2[0];st=Yt.x,ot=Yt.y,nt=Yt.z;var Zt=this.s[1];rt=Zt.x,et=Zt.y,_t=Zt.z;var Mt=this.w1[1];ht=Mt.x,lt=Mt.y,ct=Mt.z;var It=this.w2[1];mt=It.x,vt=It.y,bt=It.z;var Vt=this.s[2];xt=Vt.x,pt=Vt.y,ft=Vt.z;var wt=this.w1[2];ut=wt.x,yt=wt.y,dt=wt.z;var Lt,kt,Bt,At,Pt,St,Tt,Ct,jt,Rt=this.w2[2],Et=(Lt=rt-Q)*Lt+(kt=et-K)*kt+(Bt=_t-$)*Bt,qt=Lt*(At=xt-Q)+kt*(Pt=pt-K)+Bt*(St=ft-$),Nt=At*At+Pt*Pt+St*St,Ft=Lt*(Tt=U-Q)+kt*(Ct=O-K)+Bt*(jt=H-$),Dt=At*Tt+Pt*Ct+St*jt,Gt=Et*Nt-qt*qt;0!=Gt&&(Gt=1/Gt);var Wt,Jt,Ut,Ot,Ht,Qt,Kt=(Ft*Nt-Dt*qt)*Gt,$t=(-Ft*qt+Dt*Et)*Gt;Wt=tt+(ht-tt)*Kt,Jt=it+(lt-it)*Kt,Ut=at+(ct-at)*Kt,Wt+=(ut-tt)*$t,Jt+=(yt-it)*$t,Ut+=(dt-at)*$t,Ot=st+(mt-st)*Kt,Ht=ot+(vt-ot)*Kt,Qt=nt+(bt-nt)*Kt,Ot+=(Rt.x-st)*$t,Ht+=(Rt.y-ot)*$t,Qt+=(Rt.z-nt)*$t;var ti=this.closestPoint1;ti.x=Wt,ti.y=Jt,ti.z=Ut;var ii=this.closestPoint2;ii.x=Ot,ii.y=Ht,ii.z=Qt;break;default:throw new Error("!?")}}loadCache(t){var i=this.dir,a=t.prevClosestDir;i.x=a.x,i.y=a.y,i.z=a.z}saveCache(t){var i=t.prevClosestDir,a=this.closest;i.x=a.x,i.y=a.y,i.z=a.z;var s=i,o=-s.x,n=-s.y,r=-s.z;s.x=o,s.y=n,s.z=r}shrinkSimplex(t){switch(this.simplexSize=t,this.simplexSize=(5&this.simplexSize)+(this.simplexSize>>1&5),this.simplexSize=(3&this.simplexSize)+(this.simplexSize>>2&3),t){case 2:var i=this.s[0],a=this.s[1];i.x=a.x,i.y=a.y,i.z=a.z;var s=this.w1[0],o=this.w1[1];s.x=o.x,s.y=o.y,s.z=o.z;var n=this.w2[0],r=this.w2[1];n.x=r.x,n.y=r.y,n.z=r.z;break;case 4:var e=this.s[0],_=this.s[2];e.x=_.x,e.y=_.y,e.z=_.z;var h=this.w1[0],l=this.w1[2];h.x=l.x,h.y=l.y,h.z=l.z;var c=this.w2[0],m=this.w2[2];c.x=m.x,c.y=m.y,c.z=m.z;break;case 5:var v=this.s[1],b=this.s[2];v.x=b.x,v.y=b.y,v.z=b.z;var x=this.w1[1],p=this.w1[2];x.x=p.x,x.y=p.y,x.z=p.z;var f=this.w2[1],u=this.w2[2];f.x=u.x,f.y=u.y,f.z=u.z;break;case 6:var y=this.s[0],d=this.s[2];y.x=d.x,y.y=d.y,y.z=d.z;var g=this.w1[0],X=this.w1[2];g.x=X.x,g.y=X.y,g.z=X.z;var z=this.w2[0],Y=this.w2[2];z.x=Y.x,z.y=Y.y,z.z=Y.z;break;case 8:var Z=this.s[0],M=this.s[3];Z.x=M.x,Z.y=M.y,Z.z=M.z;var I=this.w1[0],V=this.w1[3];I.x=V.x,I.y=V.y,I.z=V.z;var w=this.w2[0],L=this.w2[3];w.x=L.x,w.y=L.y,w.z=L.z;break;case 9:var k=this.s[1],B=this.s[3];k.x=B.x,k.y=B.y,k.z=B.z;var A=this.w1[1],P=this.w1[3];A.x=P.x,A.y=P.y,A.z=P.z;var S=this.w2[1],T=this.w2[3];S.x=T.x,S.y=T.y,S.z=T.z;break;case 10:var C=this.s[0],j=this.s[3];C.x=j.x,C.y=j.y,C.z=j.z;var R=this.w1[0],E=this.w1[3];R.x=E.x,R.y=E.y,R.z=E.z;var q=this.w2[0],N=this.w2[3];q.x=N.x,q.y=N.y,q.z=N.z;break;case 11:var F=this.s[2],D=this.s[3];F.x=D.x,F.y=D.y,F.z=D.z;var G=this.w1[2],W=this.w1[3];G.x=W.x,G.y=W.y,G.z=W.z;var J=this.w2[2],U=this.w2[3];J.x=U.x,J.y=U.y,J.z=U.z;break;case 12:var O=this.s[0],H=this.s[2];O.x=H.x,O.y=H.y,O.z=H.z;var Q=this.w1[0],K=this.w1[2];Q.x=K.x,Q.y=K.y,Q.z=K.z;var $=this.w2[0],tt=this.w2[2];$.x=tt.x,$.y=tt.y,$.z=tt.z;var it=this.s[1],at=this.s[3];it.x=at.x,it.y=at.y,it.z=at.z;var st=this.w1[1],ot=this.w1[3];st.x=ot.x,st.y=ot.y,st.z=ot.z;var nt=this.w2[1],rt=this.w2[3];nt.x=rt.x,nt.y=rt.y,nt.z=rt.z;break;case 13:var et=this.s[1],_t=this.s[3];et.x=_t.x,et.y=_t.y,et.z=_t.z;var ht=this.w1[1],lt=this.w1[3];ht.x=lt.x,ht.y=lt.y,ht.z=lt.z;var ct=this.w2[1],mt=this.w2[3];ct.x=mt.x,ct.y=mt.y,ct.z=mt.z;break;case 14:var vt=this.s[0],bt=this.s[3];vt.x=bt.x,vt.y=bt.y,vt.z=bt.z;var xt=this.w1[0],pt=this.w1[3];xt.x=pt.x,xt.y=pt.y,xt.z=pt.z;var ft=this.w2[0],ut=this.w2[3];ft.x=ut.x,ft.y=ut.y,ft.z=ut.z}}computeWitnessPoint1(t){var i,a,s,o,n,r,e,_,h,l,c,m,v=this.dir;o=v.x,n=v.y,r=v.z,e=this.tf1._rotation00*o+this.tf1._rotation10*n+this.tf1._rotation20*r,_=this.tf1._rotation01*o+this.tf1._rotation11*n+this.tf1._rotation21*r,h=this.tf1._rotation02*o+this.tf1._rotation12*n+this.tf1._rotation22*r;var b=this.dir;if(b.x=e,b.y=_,b.z=h,this.c1.computeLocalSupportingVertex(this.dir,this.w1[this.simplexSize]),t){var x=this.dir,p=Math.sqrt(x.x*x.x+x.y*x.y+x.z*x.z);p>0&&(p=1/p);var f=x.x*p,u=x.y*p,y=x.z*p;x.x=f,x.y=u,x.z=y;var d=this.w1[this.simplexSize],g=this.dir,X=this.c1._gjkMargin,z=d.x+g.x*X,Y=d.y+g.y*X,Z=d.z+g.z*X;d.x=z,d.y=Y,d.z=Z}var M=this.w1[this.simplexSize];i=M.x,a=M.y,s=M.z,l=this.tf1._rotation00*i+this.tf1._rotation01*a+this.tf1._rotation02*s,c=this.tf1._rotation10*i+this.tf1._rotation11*a+this.tf1._rotation12*s,m=this.tf1._rotation20*i+this.tf1._rotation21*a+this.tf1._rotation22*s,l+=this.tf1._positionX,c+=this.tf1._positionY,m+=this.tf1._positionZ;var I=this.w1[this.simplexSize];I.x=l,I.y=c,I.z=m;var V=this.dir;V.x=o,V.y=n,V.z=r}computeWitnessPoint2(t){var i,a,s,o,n,r,e,_,h,l,c,m,v=this.dir;o=v.x,n=v.y,r=v.z,e=-(e=this.tf2._rotation00*o+this.tf2._rotation10*n+this.tf2._rotation20*r),_=-(_=this.tf2._rotation01*o+this.tf2._rotation11*n+this.tf2._rotation21*r),h=-(h=this.tf2._rotation02*o+this.tf2._rotation12*n+this.tf2._rotation22*r);var b=this.dir;if(b.x=e,b.y=_,b.z=h,this.c2.computeLocalSupportingVertex(this.dir,this.w2[this.simplexSize]),t){var x=this.dir,p=Math.sqrt(x.x*x.x+x.y*x.y+x.z*x.z);p>0&&(p=1/p);var f=x.x*p,u=x.y*p,y=x.z*p;x.x=f,x.y=u,x.z=y;var d=this.w2[this.simplexSize],g=this.dir,X=this.c2._gjkMargin,z=d.x+g.x*X,Y=d.y+g.y*X,Z=d.z+g.z*X;d.x=z,d.y=Y,d.z=Z}var M=this.w2[this.simplexSize];i=M.x,a=M.y,s=M.z,l=this.tf2._rotation00*i+this.tf2._rotation01*a+this.tf2._rotation02*s,c=this.tf2._rotation10*i+this.tf2._rotation11*a+this.tf2._rotation12*s,m=this.tf2._rotation20*i+this.tf2._rotation21*a+this.tf2._rotation22*s,l+=this.tf2._positionX,c+=this.tf2._positionY,m+=this.tf2._positionZ;var I=this.w2[this.simplexSize];I.x=l,I.y=c,I.z=m;var V=this.dir;V.x=o,V.y=n,V.z=r}pointToTetrahedron(){for(var t=0;t<3;){var i=t++,a=this.dir,s=this.baseDirs[i];a.x=s.x,a.y=s.y,a.z=s.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var o=this.s[this.simplexSize],n=this.w1[this.simplexSize];o.x=n.x,o.y=n.y,o.z=n.z;var r=o,e=this.w2[this.simplexSize],_=r.x-e.x,h=r.y-e.y,l=r.z-e.z;if(r.x=_,r.y=h,r.z=l,this.simplexSize++,this.lineToTetrahedron(),4==this.simplexSize)break;this.simplexSize--;var c=this.dir,m=-c.x,v=-c.y,b=-c.z;c.x=m,c.y=v,c.z=b,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var x=this.s[this.simplexSize],p=this.w1[this.simplexSize];x.x=p.x,x.y=p.y,x.z=p.z;var f=x,u=this.w2[this.simplexSize],y=f.x-u.x,d=f.y-u.y,g=f.z-u.z;if(f.x=y,f.y=d,f.z=g,this.simplexSize++,this.lineToTetrahedron(),4==this.simplexSize)break;this.simplexSize--}}lineToTetrahedron(){var t,i,a,s,o,n,r,e,_,h=this.dir;t=h.x,i=h.y,a=h.z;var l=this.s[0];s=l.x,o=l.y,n=l.z;var c=this.s[1];r=s-c.x,e=o-c.y,_=n-c.z;for(var m=0;m<3;){var v,b,x,p,f,u,y=m++,d=this.baseDirs[y];v=d.x,b=d.y,p=e*(x=d.z)-_*b,f=_*v-r*x,u=r*b-e*v;var g=this.dir;g.x=p,g.y=f,g.z=u,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var X=this.s[this.simplexSize],z=this.w1[this.simplexSize];X.x=z.x,X.y=z.y,X.z=z.z;var Y=X,Z=this.w2[this.simplexSize],M=Y.x-Z.x,I=Y.y-Z.y,V=Y.z-Z.z;if(Y.x=M,Y.y=I,Y.z=V,this.simplexSize++,this.triangleToTetrahedron(),4==this.simplexSize)break;this.simplexSize--;var w=this.dir,L=-w.x,k=-w.y,B=-w.z;w.x=L,w.y=k,w.z=B,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var A=this.s[this.simplexSize],P=this.w1[this.simplexSize];A.x=P.x,A.y=P.y,A.z=P.z;var S=A,T=this.w2[this.simplexSize],C=S.x-T.x,j=S.y-T.y,R=S.z-T.z;if(S.x=C,S.y=j,S.z=R,this.simplexSize++,this.triangleToTetrahedron(),4==this.simplexSize)break;this.simplexSize--}var E=this.dir;E.x=t,E.y=i,E.z=a}triangleToTetrahedron(){var t,i,a,s=this.dir;for(t=s.x,i=s.y,a=s.z;;){var o,n,r,e,_,h,l,c,m,v,b,x,p,f,u=this.s[0];o=u.x,n=u.y,r=u.z;var y=this.s[1];e=y.x,_=y.y,h=y.z;var d,g,X,z=this.s[2];l=z.x,c=z.y,d=(v=_-n)*(f=z.z-r)-(b=h-r)*(p=c-n),g=b*(x=l-o)-(m=e-o)*f,X=m*p-v*x;var Y=this.dir;Y.x=d,Y.y=g,Y.z=X,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var Z=this.s[this.simplexSize],M=this.w1[this.simplexSize];Z.x=M.x,Z.y=M.y,Z.z=M.z;var I=Z,V=this.w2[this.simplexSize],w=I.x-V.x,L=I.y-V.y,k=I.z-V.z;if(I.x=w,I.y=L,I.z=k,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;var B=this.dir,A=-B.x,P=-B.y,S=-B.z;B.x=A,B.y=P,B.z=S,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var T=this.s[this.simplexSize],C=this.w1[this.simplexSize];T.x=C.x,T.y=C.y,T.z=C.z;var j=T,R=this.w2[this.simplexSize],E=j.x-R.x,q=j.y-R.y,N=j.z-R.z;if(j.x=E,j.y=q,j.z=N,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;break}var F=this.dir;F.x=t,F.y=i,F.z=a}isValidTetrahedron(){var t=this.s[1].x-this.s[0].x,i=this.s[1].y-this.s[0].y,a=this.s[1].z-this.s[0].z,s=this.s[2].x-this.s[0].x,o=this.s[2].y-this.s[0].y,n=this.s[2].z-this.s[0].z,r=this.s[3].x-this.s[0].x,e=this.s[3].y-this.s[0].y,_=this.s[3].z-this.s[0].z,h=t*(o*_-n*e)-i*(s*_-n*r)+a*(s*e-o*r);return h>1e-12||h<-1e-12}computeDepth(t,i,a,s,o,n,r){for(var e=this.polyhedron;e._numTriangles>0;){var _=e._triangleList;e._numTriangles--;var h=_._prev,l=_._next;null!=h&&(h._next=l),null!=l&&(l._prev=h),_==e._triangleList&&(e._triangleList=e._triangleList._next),_==e._triangleListLast&&(e._triangleListLast=e._triangleListLast._prev),_._next=null,_._prev=null,_.removeReferences(),_._next=e._trianglePool,e._trianglePool=_}for(;e._numVertices>0;){var c=e._vertices[--e._numVertices];c.removeReferences(),c._next=e._vertexPool,e._vertexPool=c}var m=this.polyhedron,v=this.polyhedron,b=v._vertexPool;null!=b?(v._vertexPool=b._next,b._next=null):b=new pa.collision.narrowphase.detector.gjkepa.EpaVertex;var x=b.init(o[0],n[0],r[0]),p=this.polyhedron,f=p._vertexPool;null!=f?(p._vertexPool=f._next,f._next=null):f=new pa.collision.narrowphase.detector.gjkepa.EpaVertex;var u=f.init(o[1],n[1],r[1]),y=this.polyhedron,d=y._vertexPool;null!=d?(y._vertexPool=d._next,d._next=null):d=new pa.collision.narrowphase.detector.gjkepa.EpaVertex;var g=d.init(o[2],n[2],r[2]),X=this.polyhedron,z=X._vertexPool;if(null!=z?(X._vertexPool=z._next,z._next=null):z=new pa.collision.narrowphase.detector.gjkepa.EpaVertex,!m._init(x,u,g,z.init(o[3],n[3],r[3])))return pa.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT;this.simplexSize=0;for(var Y=this.s[0],Z=this.w1[0],M=this.w2[0],I=0;I<40;){for(var V=this.polyhedron._triangleList,w=Infinity,L=null;null!=V;){var k=V._next;V._distanceSq<w&&(w=V._distanceSq,L=V),V=k}var B=L,A=this.dir,P=B._normal;A.x=P.x,A.y=P.y,A.z=P.z;var S=A,T=Math.sqrt(S.x*S.x+S.y*S.y+S.z*S.z);T>0&&(T=1/T);var C=S.x*T,j=S.y*T,R=S.z*T;S.x=C,S.y=j,S.z=R,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var E=this.s[this.simplexSize],q=this.w1[this.simplexSize];E.x=q.x,E.y=q.y,E.z=q.z;var N=E,F=this.w2[this.simplexSize],D=N.x-F.x,G=N.y-F.y,W=N.z-F.z;N.x=D,N.y=G,N.z=W;var J=B._vertices[0],U=B._vertices[1],O=B._vertices[2],H=J.v,Q=this.dir,K=H.x*Q.x+H.y*Q.y+H.z*Q.z,$=this.dir;if(Y.x*$.x+Y.y*$.y+Y.z*$.z-K<1e-6||39==I){var tt=this.closest,it=this.dir;tt.x=it.x,tt.y=it.y,tt.z=it.z;var at,st,ot,nt=tt,rt=this.dir,et=J.v,_t=this.dir,ht=(rt.x*et.x+rt.y*et.y+rt.z*et.z)/(_t.x*_t.x+_t.y*_t.y+_t.z*_t.z),lt=nt.x*ht,ct=nt.y*ht,mt=nt.z*ht;nt.x=lt,nt.y=ct,nt.z=mt;var vt,bt,xt,pt,ft,ut,yt,dt,gt,Xt,zt,Yt,Zt,Mt,It,Vt,wt,Lt,kt,Bt,At,Pt,St,Tt,Ct=this.closest;at=Ct.x,st=Ct.y,ot=Ct.z;var jt=J.v;vt=jt.x,bt=jt.y,xt=jt.z;var Rt=J.w1;pt=Rt.x,ft=Rt.y,ut=Rt.z;var Et=J.w2;yt=Et.x,dt=Et.y,gt=Et.z;var qt=U.v;Xt=qt.x,zt=qt.y,Yt=qt.z;var Nt=U.w1;Zt=Nt.x,Mt=Nt.y,It=Nt.z;var Ft=U.w2;Vt=Ft.x,wt=Ft.y,Lt=Ft.z;var Dt=O.v;kt=Dt.x,Bt=Dt.y,At=Dt.z;var Gt=O.w1;Pt=Gt.x,St=Gt.y,Tt=Gt.z;var Wt,Jt,Ut,Ot,Ht,Qt,Kt,$t,ti,ii=O.w2,ai=(Wt=Xt-vt)*Wt+(Jt=zt-bt)*Jt+(Ut=Yt-xt)*Ut,si=Wt*(Ot=kt-vt)+Jt*(Ht=Bt-bt)+Ut*(Qt=At-xt),oi=Ot*Ot+Ht*Ht+Qt*Qt,ni=Wt*(Kt=at-vt)+Jt*($t=st-bt)+Ut*(ti=ot-xt),ri=Ot*Kt+Ht*$t+Qt*ti,ei=ai*oi-si*si;0!=ei&&(ei=1/ei);var _i,hi,li,ci,mi,vi,bi=(ni*oi-ri*si)*ei,xi=(-ni*si+ri*ai)*ei;_i=pt+(Zt-pt)*bi,hi=ft+(Mt-ft)*bi,li=ut+(It-ut)*bi,_i+=(Pt-pt)*xi,hi+=(St-ft)*xi,li+=(Tt-ut)*xi,ci=yt+(Vt-yt)*bi,mi=dt+(wt-dt)*bi,vi=gt+(Lt-gt)*bi,ci+=(ii.x-yt)*xi,mi+=(ii.y-dt)*xi,vi+=(ii.z-gt)*xi;var pi=this.closestPoint1;pi.x=_i,pi.y=hi,pi.z=li;var fi=this.closestPoint2;fi.x=ci,fi.y=mi,fi.z=vi;var ui=this.closest;return this.depth=Math.sqrt(ui.x*ui.x+ui.y*ui.y+ui.z*ui.z),pa.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED}var yi=this.polyhedron,di=yi._vertexPool;null!=di?(yi._vertexPool=di._next,di._next=null):di=new pa.collision.narrowphase.detector.gjkepa.EpaVertex;var gi=di.init(Y,Z,M);if(!this.polyhedron._addVertex(gi,B))return pa.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX;++I}return pa.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE}computeClosestPoints(t,i,a,s,o){return this.computeClosestPointsImpl(t,i,a,s,o,!0)}computeDistance(t,i,a,s,o){return this.computeClosestPointsImpl(t,i,a,s,o,!1)}convexCast(t,i,a,s,o,n,r){return this.convexCastImpl(t,i,a,s,o,n,r)}rayCast(t,i,a,s,o){var n=this.tempTransform,r=i,e=a;n._positionX=e.x,n._positionY=e.y,n._positionZ=e.z;var _=this.tl1,h=this.tl2;_.x=s.x,_.y=s.y,_.z=s.z;var l=_,c=l.x-a.x,m=l.y-a.y,v=l.z-a.z;return l.x=c,l.y=m,l.z=v,h.zero(),this.convexCastImpl(null,t,n,r,_,h,o)}static getInstance(){return pa.collision.narrowphase.detector.gjkepa.GjkEpa.instance}},pa.collision.narrowphase.detector.gjkepa.GjkEpaLog=class{},pa.collision.narrowphase.detector.gjkepa.GjkEpaResultState=class{},pa.collision.narrowphase.detector.gjkepa.SimplexUtil=class{static projectOrigin2(t,i,a){var s,o,n,r,e,_,h=t;s=h.x,o=h.y,n=h.z;var l,c,m,v,b,x,p=i,f=(l=(r=p.x)-s)*s+(c=(e=p.y)-o)*o+(m=(_=p.z)-n)*n;if((f=-f/(l*l+c*c+m*m))<0){var u=a;return u.x=s,u.y=o,u.z=n,1}if(f>1){var y=a;return y.x=r,y.y=e,y.z=_,2}v=s+l*f,b=o+c*f,x=n+m*f;var d=a;return d.x=v,d.y=b,d.z=x,3}static projectOrigin3(t,i,a,s){var o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y,d,g,X=t;o=X.x,n=X.y,r=X.z;var z=i;e=z.x,_=z.y,h=z.z;var Y,Z,M,I=a;l=I.x;var V,w,L,k=e*((f=(c=I.y)-_)*(M=(v=e-o)*f-(b=_-n)*(p=l-e))-(u=(m=I.z)-h)*(Z=(x=h-r)*p-v*u))+_*(u*(Y=b*u-x*f)-p*M)+h*(p*Z-f*Y),B=l*((d=n-c)*M-(g=r-m)*Z)+c*(g*Y-(y=o-l)*M)+m*(y*Z-d*Y),A=-1,P=0;if(V=0,w=0,L=0,o*(b*M-x*Z)+n*(x*Y-v*M)+r*(v*Z-b*Y)<0){var S,T,C,j,R,E,q=t;S=q.x,T=q.y,C=q.z;var N,F,D,G,W=i,J=(N=(j=W.x)-S)*S+(F=(R=W.y)-T)*T+(D=(E=W.z)-C)*C;if((J=-J/(N*N+F*F+D*D))<0){var U=s;U.x=S,U.y=T,U.z=C,G=1}else if(J>1){var O=s;O.x=j,O.y=R,O.z=E,G=2}else{var H,Q,K;H=S+N*J,Q=T+F*J,K=C+D*J;var $=s;$.x=H,$.y=Q,$.z=K,G=3}P=G,A=s.x*s.x+s.y*s.y+s.z*s.z;var tt=s;V=tt.x,w=tt.y,L=tt.z}if(k<0){var it,at,st,ot,nt,rt,et=i;it=et.x,at=et.y,st=et.z;var _t,ht,lt,ct,mt=a,vt=(_t=(ot=mt.x)-it)*it+(ht=(nt=mt.y)-at)*at+(lt=(rt=mt.z)-st)*st;if((vt=-vt/(_t*_t+ht*ht+lt*lt))<0){var bt=s;bt.x=it,bt.y=at,bt.z=st,ct=1}else if(vt>1){var xt=s;xt.x=ot,xt.y=nt,xt.z=rt,ct=2}else{var pt,ft,ut;pt=it+_t*vt,ft=at+ht*vt,ut=st+lt*vt;var yt=s;yt.x=pt,yt.y=ft,yt.z=ut,ct=3}var dt=s.x*s.x+s.y*s.y+s.z*s.z;if(A<0||dt<A){P=ct<<1,A=dt;var gt=s;V=gt.x,w=gt.y,L=gt.z}}if(B<0){var Xt,zt,Yt,Zt,Mt,It,Vt=t;Xt=Vt.x,zt=Vt.y,Yt=Vt.z;var wt,Lt,kt,Bt,At=a,Pt=(wt=(Zt=At.x)-Xt)*Xt+(Lt=(Mt=At.y)-zt)*zt+(kt=(It=At.z)-Yt)*Yt;if((Pt=-Pt/(wt*wt+Lt*Lt+kt*kt))<0){var St=s;St.x=Xt,St.y=zt,St.z=Yt,Bt=1}else if(Pt>1){var Tt=s;Tt.x=Zt,Tt.y=Mt,Tt.z=It,Bt=2}else{var Ct,jt,Rt;Ct=Xt+wt*Pt,jt=zt+Lt*Pt,Rt=Yt+kt*Pt;var Et=s;Et.x=Ct,Et.y=jt,Et.z=Rt,Bt=3}var qt=s.x*s.x+s.y*s.y+s.z*s.z;if(A<0||qt<A){P=1&Bt|(2&Bt)<<1,A=qt;var Nt=s;V=Nt.x,w=Nt.y,L=Nt.z}}if(A>0){var Ft=s;return Ft.x=V,Ft.y=w,Ft.z=L,P}var Dt=Y*Y+Z*Z+M*M;Dt>0&&(Dt=1/Math.sqrt(Dt));var Gt=(Y*=Dt)*Y+(Z*=Dt)*Z+(M*=Dt)*M;V=Y*(Gt=(o*Y+n*Z+r*M)/Gt),w=Z*Gt,L=M*Gt;var Wt=s;return Wt.x=V,Wt.y=w,Wt.z=L,7}static projectOrigin4(t,i,a,s,o){var n,r,e,_,h,l,c,m,v,b,x,p,f,u,y,d,g,X,z,Y,Z,M,I,V,w,L,k,B=t;n=B.x,r=B.y,e=B.z;var A=i;_=A.x,h=A.y,l=A.z;var P=a;c=P.x,m=P.y,v=P.z;var S,T,C,j=s;b=j.x;var R,E,q,N=(f=_-n)*(S=(L=(x=j.y)-h)*(V=v-l)-(k=(p=j.z)-l)*(I=m-h))+(u=h-r)*(T=k*(M=c-_)-(w=b-_)*V)+(y=l-e)*(C=w*I-L*M)>0?1:-1,F=n*((g=m-r)*(Z=p-e)-(X=v-e)*(Y=x-r))+r*(X*(z=b-n)-(d=c-n)*Z)+e*(d*Y-g*z),D=n*(Y*y-Z*u)+r*(Z*f-z*y)+e*(z*u-Y*f),G=_*S+h*T+l*C,W=-1,J=0;if(R=0,E=0,q=0,(n*(u*X-y*g)+r*(y*d-f*X)+e*(f*g-u*d))*N<0){var U,O,H,Q,K,$,tt,it,at,st,ot,nt,rt,et,_t,ht,lt,ct,mt=t;U=mt.x,O=mt.y,H=mt.z;var vt=i;Q=vt.x,K=vt.y,$=vt.z;var bt,xt,pt,ft=a;tt=ft.x;var ut,yt,dt,gt,Xt=Q*((et=(it=ft.y)-K)*(pt=(st=Q-U)*et-(ot=K-O)*(rt=tt-Q))-(_t=(at=ft.z)-$)*(xt=(nt=$-H)*rt-st*_t))+K*(_t*(bt=ot*_t-nt*et)-rt*pt)+$*(rt*xt-et*bt),zt=tt*((lt=O-it)*pt-(ct=H-at)*xt)+it*(ct*bt-(ht=U-tt)*pt)+at*(ht*xt-lt*bt),Yt=-1,Zt=0;if(ut=0,yt=0,dt=0,U*(ot*pt-nt*xt)+O*(nt*bt-st*pt)+H*(st*xt-ot*bt)<0){var Mt,It,Vt,wt,Lt,kt,Bt=t;Mt=Bt.x,It=Bt.y,Vt=Bt.z;var At,Pt,St,Tt,Ct=i,jt=(At=(wt=Ct.x)-Mt)*Mt+(Pt=(Lt=Ct.y)-It)*It+(St=(kt=Ct.z)-Vt)*Vt;if((jt=-jt/(At*At+Pt*Pt+St*St))<0){var Rt=o;Rt.x=Mt,Rt.y=It,Rt.z=Vt,Tt=1}else if(jt>1){var Et=o;Et.x=wt,Et.y=Lt,Et.z=kt,Tt=2}else{var qt,Nt,Ft;qt=Mt+At*jt,Nt=It+Pt*jt,Ft=Vt+St*jt;var Dt=o;Dt.x=qt,Dt.y=Nt,Dt.z=Ft,Tt=3}Zt=Tt,Yt=o.x*o.x+o.y*o.y+o.z*o.z;var Gt=o;ut=Gt.x,yt=Gt.y,dt=Gt.z}if(Xt<0){var Wt,Jt,Ut,Ot,Ht,Qt,Kt=i;Wt=Kt.x,Jt=Kt.y,Ut=Kt.z;var $t,ti,ii,ai,si=a,oi=($t=(Ot=si.x)-Wt)*Wt+(ti=(Ht=si.y)-Jt)*Jt+(ii=(Qt=si.z)-Ut)*Ut;if((oi=-oi/($t*$t+ti*ti+ii*ii))<0){var ni=o;ni.x=Wt,ni.y=Jt,ni.z=Ut,ai=1}else if(oi>1){var ri=o;ri.x=Ot,ri.y=Ht,ri.z=Qt,ai=2}else{var ei,_i,hi;ei=Wt+$t*oi,_i=Jt+ti*oi,hi=Ut+ii*oi;var li=o;li.x=ei,li.y=_i,li.z=hi,ai=3}var ci=o.x*o.x+o.y*o.y+o.z*o.z;if(Yt<0||ci<Yt){Zt=ai<<1,Yt=ci;var mi=o;ut=mi.x,yt=mi.y,dt=mi.z}}if(zt<0){var vi,bi,xi,pi,fi,ui,yi=t;vi=yi.x,bi=yi.y,xi=yi.z;var di,gi,Xi,zi,Yi=a,Zi=(di=(pi=Yi.x)-vi)*vi+(gi=(fi=Yi.y)-bi)*bi+(Xi=(ui=Yi.z)-xi)*xi;if((Zi=-Zi/(di*di+gi*gi+Xi*Xi))<0){var Mi=o;Mi.x=vi,Mi.y=bi,Mi.z=xi,zi=1}else if(Zi>1){var Ii=o;Ii.x=pi,Ii.y=fi,Ii.z=ui,zi=2}else{var Vi,wi,Li;Vi=vi+di*Zi,wi=bi+gi*Zi,Li=xi+Xi*Zi;var ki=o;ki.x=Vi,ki.y=wi,ki.z=Li,zi=3}var Bi=o.x*o.x+o.y*o.y+o.z*o.z;if(Yt<0||Bi<Yt){Zt=1&zi|(2&zi)<<1,Yt=Bi;var Ai=o;ut=Ai.x,yt=Ai.y,dt=Ai.z}}if(Yt>0){var Pi=o;Pi.x=ut,Pi.y=yt,Pi.z=dt,gt=Zt}else{var Si=bt*bt+xt*xt+pt*pt;Si>0&&(Si=1/Math.sqrt(Si));var Ti=(bt*=Si)*bt+(xt*=Si)*xt+(pt*=Si)*pt;ut=bt*(Ti=(U*bt+O*xt+H*pt)/Ti),yt=xt*Ti,dt=pt*Ti;var Ci=o;Ci.x=ut,Ci.y=yt,Ci.z=dt,gt=7}J=gt,W=o.x*o.x+o.y*o.y+o.z*o.z;var ji=o;R=ji.x,E=ji.y,q=ji.z}if(F*N<0){var Ri,Ei,qi,Ni,Fi,Di,Gi,Wi,Ji,Ui,Oi,Hi,Qi,Ki,$i,ta,ia,aa,sa=t;Ri=sa.x,Ei=sa.y,qi=sa.z;var oa=a;Ni=oa.x,Fi=oa.y,Di=oa.z;var na,ra,ea,_a=s;Gi=_a.x;var ha,la,ca,ma,va=Ni*((Ki=(Wi=_a.y)-Fi)*(ea=(Ui=Ni-Ri)*Ki-(Oi=Fi-Ei)*(Qi=Gi-Ni))-($i=(Ji=_a.z)-Di)*(ra=(Hi=Di-qi)*Qi-Ui*$i))+Fi*($i*(na=Oi*$i-Hi*Ki)-Qi*ea)+Di*(Qi*ra-Ki*na),ba=Gi*((ia=Ei-Wi)*ea-(aa=qi-Ji)*ra)+Wi*(aa*na-(ta=Ri-Gi)*ea)+Ji*(ta*ra-ia*na),xa=-1,pa=0;if(ha=0,la=0,ca=0,Ri*(Oi*ea-Hi*ra)+Ei*(Hi*na-Ui*ea)+qi*(Ui*ra-Oi*na)<0){var fa,ua,ya,da,ga,Xa,za=t;fa=za.x,ua=za.y,ya=za.z;var Ya,Za,Ma,Ia,Va=a,wa=(Ya=(da=Va.x)-fa)*fa+(Za=(ga=Va.y)-ua)*ua+(Ma=(Xa=Va.z)-ya)*ya;if((wa=-wa/(Ya*Ya+Za*Za+Ma*Ma))<0){var La=o;La.x=fa,La.y=ua,La.z=ya,Ia=1}else if(wa>1){var ka=o;ka.x=da,ka.y=ga,ka.z=Xa,Ia=2}else{var Ba,Aa,Pa;Ba=fa+Ya*wa,Aa=ua+Za*wa,Pa=ya+Ma*wa;var Sa=o;Sa.x=Ba,Sa.y=Aa,Sa.z=Pa,Ia=3}pa=Ia,xa=o.x*o.x+o.y*o.y+o.z*o.z;var Ta=o;ha=Ta.x,la=Ta.y,ca=Ta.z}if(va<0){var Ca,ja,Ra,Ea,qa,Na,Fa=a;Ca=Fa.x,ja=Fa.y,Ra=Fa.z;var Da,Ga,Wa,Ja,Ua=s,Oa=(Da=(Ea=Ua.x)-Ca)*Ca+(Ga=(qa=Ua.y)-ja)*ja+(Wa=(Na=Ua.z)-Ra)*Ra;if((Oa=-Oa/(Da*Da+Ga*Ga+Wa*Wa))<0){var Ha=o;Ha.x=Ca,Ha.y=ja,Ha.z=Ra,Ja=1}else if(Oa>1){var Qa=o;Qa.x=Ea,Qa.y=qa,Qa.z=Na,Ja=2}else{var Ka,$a,ts;Ka=Ca+Da*Oa,$a=ja+Ga*Oa,ts=Ra+Wa*Oa;var is=o;is.x=Ka,is.y=$a,is.z=ts,Ja=3}var as=o.x*o.x+o.y*o.y+o.z*o.z;if(xa<0||as<xa){pa=Ja<<1,xa=as;var ss=o;ha=ss.x,la=ss.y,ca=ss.z}}if(ba<0){var os,ns,rs,es,_s,hs,ls=t;os=ls.x,ns=ls.y,rs=ls.z;var cs,ms,vs,bs,xs=s,ps=(cs=(es=xs.x)-os)*os+(ms=(_s=xs.y)-ns)*ns+(vs=(hs=xs.z)-rs)*rs;if((ps=-ps/(cs*cs+ms*ms+vs*vs))<0){var fs=o;fs.x=os,fs.y=ns,fs.z=rs,bs=1}else if(ps>1){var us=o;us.x=es,us.y=_s,us.z=hs,bs=2}else{var ys,ds,gs;ys=os+cs*ps,ds=ns+ms*ps,gs=rs+vs*ps;var Xs=o;Xs.x=ys,Xs.y=ds,Xs.z=gs,bs=3}var zs=o.x*o.x+o.y*o.y+o.z*o.z;if(xa<0||zs<xa){pa=1&bs|(2&bs)<<1,xa=zs;var Ys=o;ha=Ys.x,la=Ys.y,ca=Ys.z}}if(xa>0){var Zs=o;Zs.x=ha,Zs.y=la,Zs.z=ca,ma=pa}else{var Ms=na*na+ra*ra+ea*ea;Ms>0&&(Ms=1/Math.sqrt(Ms));var Is=(na*=Ms)*na+(ra*=Ms)*ra+(ea*=Ms)*ea;ha=na*(Is=(Ri*na+Ei*ra+qi*ea)/Is),la=ra*Is,ca=ea*Is;var Vs=o;Vs.x=ha,Vs.y=la,Vs.z=ca,ma=7}var ws=o.x*o.x+o.y*o.y+o.z*o.z;if(W<0||ws<W){J=1&ma|(6&ma)<<1,W=ws;var Ls=o;R=Ls.x,E=Ls.y,q=Ls.z}}if(D*N<0){var ks,Bs,As,Ps,Ss,Ts,Cs,js,Rs,Es,qs,Ns,Fs,Ds,Gs,Ws,Js,Us,Os=t;ks=Os.x,Bs=Os.y,As=Os.z;var Hs=i;Ps=Hs.x,Ss=Hs.y,Ts=Hs.z;var Qs,Ks,$s,to=s;Cs=to.x;var io,ao,so,oo,no=Ps*((Ds=(js=to.y)-Ss)*($s=(Es=Ps-ks)*Ds-(qs=Ss-Bs)*(Fs=Cs-Ps))-(Gs=(Rs=to.z)-Ts)*(Ks=(Ns=Ts-As)*Fs-Es*Gs))+Ss*(Gs*(Qs=qs*Gs-Ns*Ds)-Fs*$s)+Ts*(Fs*Ks-Ds*Qs),ro=Cs*((Js=Bs-js)*$s-(Us=As-Rs)*Ks)+js*(Us*Qs-(Ws=ks-Cs)*$s)+Rs*(Ws*Ks-Js*Qs),eo=-1,_o=0;if(io=0,ao=0,so=0,ks*(qs*$s-Ns*Ks)+Bs*(Ns*Qs-Es*$s)+As*(Es*Ks-qs*Qs)<0){var ho,lo,co,mo,vo,bo,xo=t;ho=xo.x,lo=xo.y,co=xo.z;var po,fo,uo,yo,go=i,Xo=(po=(mo=go.x)-ho)*ho+(fo=(vo=go.y)-lo)*lo+(uo=(bo=go.z)-co)*co;if((Xo=-Xo/(po*po+fo*fo+uo*uo))<0){var zo=o;zo.x=ho,zo.y=lo,zo.z=co,yo=1}else if(Xo>1){var Yo=o;Yo.x=mo,Yo.y=vo,Yo.z=bo,yo=2}else{var Zo,Mo,Io;Zo=ho+po*Xo,Mo=lo+fo*Xo,Io=co+uo*Xo;var Vo=o;Vo.x=Zo,Vo.y=Mo,Vo.z=Io,yo=3}_o=yo,eo=o.x*o.x+o.y*o.y+o.z*o.z;var wo=o;io=wo.x,ao=wo.y,so=wo.z}if(no<0){var Lo,ko,Bo,Ao,Po,So,To=i;Lo=To.x,ko=To.y,Bo=To.z;var Co,jo,Ro,Eo,qo=s,No=(Co=(Ao=qo.x)-Lo)*Lo+(jo=(Po=qo.y)-ko)*ko+(Ro=(So=qo.z)-Bo)*Bo;if((No=-No/(Co*Co+jo*jo+Ro*Ro))<0){var Fo=o;Fo.x=Lo,Fo.y=ko,Fo.z=Bo,Eo=1}else if(No>1){var Do=o;Do.x=Ao,Do.y=Po,Do.z=So,Eo=2}else{var Go,Wo,Jo;Go=Lo+Co*No,Wo=ko+jo*No,Jo=Bo+Ro*No;var Uo=o;Uo.x=Go,Uo.y=Wo,Uo.z=Jo,Eo=3}var Oo=o.x*o.x+o.y*o.y+o.z*o.z;if(eo<0||Oo<eo){_o=Eo<<1,eo=Oo;var Ho=o;io=Ho.x,ao=Ho.y,so=Ho.z}}if(ro<0){var Qo,Ko,$o,tn,an,sn,on=t;Qo=on.x,Ko=on.y,$o=on.z;var nn,rn,en,_n,hn=s,ln=(nn=(tn=hn.x)-Qo)*Qo+(rn=(an=hn.y)-Ko)*Ko+(en=(sn=hn.z)-$o)*$o;if((ln=-ln/(nn*nn+rn*rn+en*en))<0){var cn=o;cn.x=Qo,cn.y=Ko,cn.z=$o,_n=1}else if(ln>1){var mn=o;mn.x=tn,mn.y=an,mn.z=sn,_n=2}else{var vn,bn,xn;vn=Qo+nn*ln,bn=Ko+rn*ln,xn=$o+en*ln;var pn=o;pn.x=vn,pn.y=bn,pn.z=xn,_n=3}var fn=o.x*o.x+o.y*o.y+o.z*o.z;if(eo<0||fn<eo){_o=1&_n|(2&_n)<<1,eo=fn;var un=o;io=un.x,ao=un.y,so=un.z}}if(eo>0){var yn=o;yn.x=io,yn.y=ao,yn.z=so,oo=_o}else{var dn=Qs*Qs+Ks*Ks+$s*$s;dn>0&&(dn=1/Math.sqrt(dn));var gn=(Qs*=dn)*Qs+(Ks*=dn)*Ks+($s*=dn)*$s;io=Qs*(gn=(ks*Qs+Bs*Ks+As*$s)/gn),ao=Ks*gn,so=$s*gn;var Xn=o;Xn.x=io,Xn.y=ao,Xn.z=so,oo=7}var zn=o.x*o.x+o.y*o.y+o.z*o.z;if(W<0||zn<W){J=3&oo|(4&oo)<<1,W=zn;var Yn=o;R=Yn.x,E=Yn.y,q=Yn.z}}if(G*N<0){var Zn,Mn,In,Vn,wn,Ln,kn,Bn,An,Pn,Sn,Tn,Cn,jn,Rn,En,qn,Nn,Fn=i;Zn=Fn.x,Mn=Fn.y,In=Fn.z;var Dn=a;Vn=Dn.x,wn=Dn.y,Ln=Dn.z;var Gn,Wn,Jn,Un=s;kn=Un.x;var On,Hn,Qn,Kn,$n=Vn*((jn=(Bn=Un.y)-wn)*(Jn=(Pn=Vn-Zn)*jn-(Sn=wn-Mn)*(Cn=kn-Vn))-(Rn=(An=Un.z)-Ln)*(Wn=(Tn=Ln-In)*Cn-Pn*Rn))+wn*(Rn*(Gn=Sn*Rn-Tn*jn)-Cn*Jn)+Ln*(Cn*Wn-jn*Gn),tr=kn*((qn=Mn-Bn)*Jn-(Nn=In-An)*Wn)+Bn*(Nn*Gn-(En=Zn-kn)*Jn)+An*(En*Wn-qn*Gn),ir=-1,ar=0;if(On=0,Hn=0,Qn=0,Zn*(Sn*Jn-Tn*Wn)+Mn*(Tn*Gn-Pn*Jn)+In*(Pn*Wn-Sn*Gn)<0){var sr,or,nr,rr,er,_r,hr=i;sr=hr.x,or=hr.y,nr=hr.z;var lr,cr,mr,vr,br=a,xr=(lr=(rr=br.x)-sr)*sr+(cr=(er=br.y)-or)*or+(mr=(_r=br.z)-nr)*nr;if((xr=-xr/(lr*lr+cr*cr+mr*mr))<0){var pr=o;pr.x=sr,pr.y=or,pr.z=nr,vr=1}else if(xr>1){var fr=o;fr.x=rr,fr.y=er,fr.z=_r,vr=2}else{var ur,yr,dr;ur=sr+lr*xr,yr=or+cr*xr,dr=nr+mr*xr;var gr=o;gr.x=ur,gr.y=yr,gr.z=dr,vr=3}ar=vr,ir=o.x*o.x+o.y*o.y+o.z*o.z;var Xr=o;On=Xr.x,Hn=Xr.y,Qn=Xr.z}if($n<0){var zr,Yr,Zr,Mr,Ir,Vr,wr=a;zr=wr.x,Yr=wr.y,Zr=wr.z;var Lr,kr,Br,Ar,Pr=s,Sr=(Lr=(Mr=Pr.x)-zr)*zr+(kr=(Ir=Pr.y)-Yr)*Yr+(Br=(Vr=Pr.z)-Zr)*Zr;if((Sr=-Sr/(Lr*Lr+kr*kr+Br*Br))<0){var Tr=o;Tr.x=zr,Tr.y=Yr,Tr.z=Zr,Ar=1}else if(Sr>1){var Cr=o;Cr.x=Mr,Cr.y=Ir,Cr.z=Vr,Ar=2}else{var jr,Rr,Er;jr=zr+Lr*Sr,Rr=Yr+kr*Sr,Er=Zr+Br*Sr;var qr=o;qr.x=jr,qr.y=Rr,qr.z=Er,Ar=3}var Nr=o.x*o.x+o.y*o.y+o.z*o.z;if(ir<0||Nr<ir){ar=Ar<<1,ir=Nr;var Fr=o;On=Fr.x,Hn=Fr.y,Qn=Fr.z}}if(tr<0){var Dr,Gr,Wr,Jr,Ur,Or,Hr=i;Dr=Hr.x,Gr=Hr.y,Wr=Hr.z;var Qr,Kr,$r,te,ie=s,ae=(Qr=(Jr=ie.x)-Dr)*Dr+(Kr=(Ur=ie.y)-Gr)*Gr+($r=(Or=ie.z)-Wr)*Wr;if((ae=-ae/(Qr*Qr+Kr*Kr+$r*$r))<0){var se=o;se.x=Dr,se.y=Gr,se.z=Wr,te=1}else if(ae>1){var oe=o;oe.x=Jr,oe.y=Ur,oe.z=Or,te=2}else{var ne,re,ee;ne=Dr+Qr*ae,re=Gr+Kr*ae,ee=Wr+$r*ae;var _e=o;_e.x=ne,_e.y=re,_e.z=ee,te=3}var he=o.x*o.x+o.y*o.y+o.z*o.z;if(ir<0||he<ir){ar=1&te|(2&te)<<1,ir=he;var le=o;On=le.x,Hn=le.y,Qn=le.z}}if(ir>0){var ce=o;ce.x=On,ce.y=Hn,ce.z=Qn,Kn=ar}else{var me=Gn*Gn+Wn*Wn+Jn*Jn;me>0&&(me=1/Math.sqrt(me));var ve=(Gn*=me)*Gn+(Wn*=me)*Wn+(Jn*=me)*Jn;On=Gn*(ve=(Zn*Gn+Mn*Wn+In*Jn)/ve),Hn=Wn*ve,Qn=Jn*ve;var be=o;be.x=On,be.y=Hn,be.z=Qn,Kn=7}var xe=o.x*o.x+o.y*o.y+o.z*o.z;if(W<0||xe<W){J=Kn<<1,W=xe;var pe=o;R=pe.x,E=pe.y,q=pe.z}}if(W>0){var fe=o;return fe.x=R,fe.y=E,fe.z=q,J}return o.zero(),15}},pa.common.Mat3=class{constructor(t,i,a,s,o,n,r,e,_){null==_&&(_=1),null==e&&(e=0),null==r&&(r=0),null==n&&(n=0),null==o&&(o=1),null==s&&(s=0),null==a&&(a=0),null==i&&(i=0),null==t&&(t=1),this.e00=t,this.e01=i,this.e02=a,this.e10=s,this.e11=o,this.e12=n,this.e20=r,this.e21=e,this.e22=_,pa.common.Mat3.numCreations++}init(t,i,a,s,o,n,r,e,_){return this.e00=t,this.e01=i,this.e02=a,this.e10=s,this.e11=o,this.e12=n,this.e20=r,this.e21=e,this.e22=_,this}identity(){return this.e00=1,this.e01=0,this.e02=0,this.e10=0,this.e11=1,this.e12=0,this.e20=0,this.e21=0,this.e22=1,this}add(t){return new pa.common.Mat3(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22)}sub(t){return new pa.common.Mat3(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22)}scale(t){return new pa.common.Mat3(this.e00*t,this.e01*t,this.e02*t,this.e10*t,this.e11*t,this.e12*t,this.e20*t,this.e21*t,this.e22*t)}mul(t){return new pa.common.Mat3(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22)}addEq(t){var i=this.e00+t.e00,a=this.e01+t.e01,s=this.e02+t.e02,o=this.e10+t.e10,n=this.e11+t.e11,r=this.e12+t.e12,e=this.e20+t.e20,_=this.e21+t.e21,h=this.e22+t.e22;return this.e00=i,this.e01=a,this.e02=s,this.e10=o,this.e11=n,this.e12=r,this.e20=e,this.e21=_,this.e22=h,this}subEq(t){var i=this.e00-t.e00,a=this.e01-t.e01,s=this.e02-t.e02,o=this.e10-t.e10,n=this.e11-t.e11,r=this.e12-t.e12,e=this.e20-t.e20,_=this.e21-t.e21,h=this.e22-t.e22;return this.e00=i,this.e01=a,this.e02=s,this.e10=o,this.e11=n,this.e12=r,this.e20=e,this.e21=_,this.e22=h,this}scaleEq(t){var i=this.e00*t,a=this.e01*t,s=this.e02*t,o=this.e10*t,n=this.e11*t,r=this.e12*t,e=this.e20*t,_=this.e21*t,h=this.e22*t;return this.e00=i,this.e01=a,this.e02=s,this.e10=o,this.e11=n,this.e12=r,this.e20=e,this.e21=_,this.e22=h,this}mulEq(t){var i=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,a=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,s=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,o=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,n=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,r=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,e=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,_=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,h=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22;return this.e00=i,this.e01=a,this.e02=s,this.e10=o,this.e11=n,this.e12=r,this.e20=e,this.e21=_,this.e22=h,this}prependScale(t,i,a){return new pa.common.Mat3(this.e00*t,this.e01*t,this.e02*t,this.e10*i,this.e11*i,this.e12*i,this.e20*a,this.e21*a,this.e22*a)}appendScale(t,i,a){return new pa.common.Mat3(this.e00*t,this.e01*i,this.e02*a,this.e10*t,this.e11*i,this.e12*a,this.e20*t,this.e21*i,this.e22*a)}prependRotation(t,i,a,s){var o=Math.sin(t),n=Math.cos(t),r=1-n,e=i*i*r+n,_=i*a*r-s*o,h=i*s*r+a*o,l=a*i*r+s*o,c=a*a*r+n,m=a*s*r-i*o,v=s*i*r-a*o,b=s*a*r+i*o,x=s*s*r+n;return new pa.common.Mat3(e*this.e00+_*this.e10+h*this.e20,e*this.e01+_*this.e11+h*this.e21,e*this.e02+_*this.e12+h*this.e22,l*this.e00+c*this.e10+m*this.e20,l*this.e01+c*this.e11+m*this.e21,l*this.e02+c*this.e12+m*this.e22,v*this.e00+b*this.e10+x*this.e20,v*this.e01+b*this.e11+x*this.e21,v*this.e02+b*this.e12+x*this.e22)}appendRotation(t,i,a,s){var o=Math.sin(t),n=Math.cos(t),r=1-n,e=i*i*r+n,_=i*a*r-s*o,h=i*s*r+a*o,l=a*i*r+s*o,c=a*a*r+n,m=a*s*r-i*o,v=s*i*r-a*o,b=s*a*r+i*o,x=s*s*r+n;return new pa.common.Mat3(this.e00*e+this.e01*l+this.e02*v,this.e00*_+this.e01*c+this.e02*b,this.e00*h+this.e01*m+this.e02*x,this.e10*e+this.e11*l+this.e12*v,this.e10*_+this.e11*c+this.e12*b,this.e10*h+this.e11*m+this.e12*x,this.e20*e+this.e21*l+this.e22*v,this.e20*_+this.e21*c+this.e22*b,this.e20*h+this.e21*m+this.e22*x)}prependScaleEq(t,i,a){var s=this.e00*t,o=this.e01*t,n=this.e02*t,r=this.e10*i,e=this.e11*i,_=this.e12*i,h=this.e20*a,l=this.e21*a,c=this.e22*a;return this.e00=s,this.e01=o,this.e02=n,this.e10=r,this.e11=e,this.e12=_,this.e20=h,this.e21=l,this.e22=c,this}appendScaleEq(t,i,a){var s=this.e00*t,o=this.e01*i,n=this.e02*a,r=this.e10*t,e=this.e11*i,_=this.e12*a,h=this.e20*t,l=this.e21*i,c=this.e22*a;return this.e00=s,this.e01=o,this.e02=n,this.e10=r,this.e11=e,this.e12=_,this.e20=h,this.e21=l,this.e22=c,this}prependRotationEq(t,i,a,s){var o=Math.sin(t),n=Math.cos(t),r=1-n,e=i*i*r+n,_=i*a*r-s*o,h=i*s*r+a*o,l=a*i*r+s*o,c=a*a*r+n,m=a*s*r-i*o,v=s*i*r-a*o,b=s*a*r+i*o,x=s*s*r+n,p=e*this.e00+_*this.e10+h*this.e20,f=e*this.e01+_*this.e11+h*this.e21,u=e*this.e02+_*this.e12+h*this.e22,y=l*this.e00+c*this.e10+m*this.e20,d=l*this.e01+c*this.e11+m*this.e21,g=l*this.e02+c*this.e12+m*this.e22,X=v*this.e00+b*this.e10+x*this.e20,z=v*this.e01+b*this.e11+x*this.e21,Y=v*this.e02+b*this.e12+x*this.e22;return this.e00=p,this.e01=f,this.e02=u,this.e10=y,this.e11=d,this.e12=g,this.e20=X,this.e21=z,this.e22=Y,this}appendRotationEq(t,i,a,s){var o=Math.sin(t),n=Math.cos(t),r=1-n,e=i*i*r+n,_=i*a*r-s*o,h=i*s*r+a*o,l=a*i*r+s*o,c=a*a*r+n,m=a*s*r-i*o,v=s*i*r-a*o,b=s*a*r+i*o,x=s*s*r+n,p=this.e00*e+this.e01*l+this.e02*v,f=this.e00*_+this.e01*c+this.e02*b,u=this.e00*h+this.e01*m+this.e02*x,y=this.e10*e+this.e11*l+this.e12*v,d=this.e10*_+this.e11*c+this.e12*b,g=this.e10*h+this.e11*m+this.e12*x,X=this.e20*e+this.e21*l+this.e22*v,z=this.e20*_+this.e21*c+this.e22*b,Y=this.e20*h+this.e21*m+this.e22*x;return this.e00=p,this.e01=f,this.e02=u,this.e10=y,this.e11=d,this.e12=g,this.e20=X,this.e21=z,this.e22=Y,this}transpose(){return new pa.common.Mat3(this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22)}transposeEq(){var t=this.e00,i=this.e10,a=this.e20,s=this.e01,o=this.e11,n=this.e21,r=this.e02,e=this.e12,_=this.e22;return this.e00=t,this.e01=i,this.e02=a,this.e10=s,this.e11=o,this.e12=n,this.e20=r,this.e21=e,this.e22=_,this}determinant(){return this.e00*(this.e11*this.e22-this.e12*this.e21)-this.e01*(this.e10*this.e22-this.e12*this.e20)+this.e02*(this.e10*this.e21-this.e11*this.e20)}trace(){return this.e00+this.e11+this.e22}inverse(){var t=this.e11*this.e22-this.e12*this.e21,i=this.e10*this.e22-this.e12*this.e20,a=this.e10*this.e21-this.e11*this.e20,s=this.e01*this.e22-this.e02*this.e21,o=this.e00*this.e22-this.e02*this.e20,n=this.e00*this.e21-this.e01*this.e20,r=this.e01*this.e12-this.e02*this.e11,e=this.e00*this.e12-this.e02*this.e10,_=this.e00*this.e11-this.e01*this.e10,h=this.e00*t-this.e01*i+this.e02*a;return 0!=h&&(h=1/h),new pa.common.Mat3(t*h,-s*h,r*h,-i*h,o*h,-e*h,a*h,-n*h,_*h)}inverseEq(){var t=this.e11*this.e22-this.e12*this.e21,i=this.e10*this.e22-this.e12*this.e20,a=this.e10*this.e21-this.e11*this.e20,s=this.e01*this.e22-this.e02*this.e21,o=this.e00*this.e22-this.e02*this.e20,n=this.e00*this.e21-this.e01*this.e20,r=this.e01*this.e12-this.e02*this.e11,e=this.e00*this.e12-this.e02*this.e10,_=this.e00*this.e11-this.e01*this.e10,h=this.e00*t-this.e01*i+this.e02*a;0!=h&&(h=1/h);var l=t*h,c=-s*h,m=r*h,v=-i*h,b=o*h,x=-e*h,p=a*h,f=-n*h,u=_*h;return this.e00=l,this.e01=c,this.e02=m,this.e10=v,this.e11=b,this.e12=x,this.e20=p,this.e21=f,this.e22=u,this}toArray(t){return null==t&&(t=!1),t?[this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22]:[this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22]}copyFrom(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this}clone(){return new pa.common.Mat3(this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22)}fromQuat(t){var i=t.x,a=t.y,s=t.z,o=t.w,n=2*i,r=2*a,e=2*s,_=i*n,h=a*r,l=s*e,c=i*r,m=a*e,v=i*e,b=o*n,x=o*r,p=o*e;return this.e00=1-h-l,this.e01=c-p,this.e02=v+x,this.e10=c+p,this.e11=1-_-l,this.e12=m-b,this.e20=v-x,this.e21=m+b,this.e22=1-_-h,this}toQuat(){var t,i=new pa.common.Quat,a=this.e00,s=this.e11,o=this.e22,n=a+s+o;return n>0?(t=Math.sqrt(n+1),i.w=.5*t,t=.5/t,i.x=(this.e21-this.e12)*t,i.y=(this.e02-this.e20)*t,i.z=(this.e10-this.e01)*t):a>s?a>o?(t=Math.sqrt(a-s-o+1),i.x=.5*t,t=.5/t,i.y=(this.e01+this.e10)*t,i.z=(this.e02+this.e20)*t,i.w=(this.e21-this.e12)*t):(t=Math.sqrt(o-a-s+1),i.z=.5*t,t=.5/t,i.x=(this.e02+this.e20)*t,i.y=(this.e12+this.e21)*t,i.w=(this.e10-this.e01)*t):s>o?(t=Math.sqrt(s-o-a+1),i.y=.5*t,t=.5/t,i.x=(this.e01+this.e10)*t,i.z=(this.e12+this.e21)*t,i.w=(this.e02-this.e20)*t):(t=Math.sqrt(o-a-s+1),i.z=.5*t,t=.5/t,i.x=(this.e02+this.e20)*t,i.y=(this.e12+this.e21)*t,i.w=(this.e10-this.e01)*t),i}fromEulerXyz(t){var i=Math.sin(t.x),a=Math.sin(t.y),s=Math.sin(t.z),o=Math.cos(t.x),n=Math.cos(t.y),r=Math.cos(t.z),e=n*r,_=-n*s,h=a,l=o*s+r*i*a,c=o*r-i*a*s,m=-n*i,v=i*s-o*r*a,b=r*i+o*a*s,x=o*n;return this.e00=e,this.e01=_,this.e02=h,this.e10=l,this.e11=c,this.e12=m,this.e20=v,this.e21=b,this.e22=x,this}toEulerXyz(){var t=this.e02;if(t<=-1){var i=Math.atan2(this.e21,this.e11);return new pa.common.Vec3(.5*i,-1.570796326794895,.5*-i)}if(t>=1){var a=Math.atan2(this.e21,this.e11);return new pa.common.Vec3(.5*a,1.570796326794895,.5*a)}var s=Math.asin(t),o=Math.atan2(-this.e12,this.e22),n=Math.atan2(-this.e01,this.e00);return new pa.common.Vec3(o,s,n)}getRow(t){return 0==t?new pa.common.Vec3(this.e00,this.e01,this.e02):1==t?new pa.common.Vec3(this.e10,this.e11,this.e12):2==t?new pa.common.Vec3(this.e20,this.e21,this.e22):null}getCol(t){return 0==t?new pa.common.Vec3(this.e00,this.e10,this.e20):1==t?new pa.common.Vec3(this.e01,this.e11,this.e21):2==t?new pa.common.Vec3(this.e02,this.e12,this.e22):null}getRowTo(t,i){0==t?i.init(this.e00,this.e01,this.e02):1==t?i.init(this.e10,this.e11,this.e12):2==t?i.init(this.e20,this.e21,this.e22):i.zero()}getColTo(t,i){0==t?i.init(this.e00,this.e10,this.e20):1==t?i.init(this.e01,this.e11,this.e21):2==t?i.init(this.e02,this.e12,this.e22):i.zero()}fromRows(t,i,a){var s=t.x,o=t.y,n=t.z,r=i.x,e=i.y,_=i.z,h=a.x,l=a.y,c=a.z;return this.e00=s,this.e01=o,this.e02=n,this.e10=r,this.e11=e,this.e12=_,this.e20=h,this.e21=l,this.e22=c,this}fromCols(t,i,a){var s=t.x,o=i.x,n=a.x,r=t.y,e=i.y,_=a.y,h=t.z,l=i.z,c=a.z;return this.e00=s,this.e01=o,this.e02=n,this.e10=r,this.e11=e,this.e12=_,this.e20=h,this.e21=l,this.e22=c,this}toString(){return"Mat3["+(this.e00>0?(1e7*this.e00+.5|0)/1e7:(1e7*this.e00-.5|0)/1e7)+", "+(this.e01>0?(1e7*this.e01+.5|0)/1e7:(1e7*this.e01-.5|0)/1e7)+", "+(this.e02>0?(1e7*this.e02+.5|0)/1e7:(1e7*this.e02-.5|0)/1e7)+",\n     "+(this.e10>0?(1e7*this.e10+.5|0)/1e7:(1e7*this.e10-.5|0)/1e7)+", "+(this.e11>0?(1e7*this.e11+.5|0)/1e7:(1e7*this.e11-.5|0)/1e7)+", "+(this.e12>0?(1e7*this.e12+.5|0)/1e7:(1e7*this.e12-.5|0)/1e7)+",\n     "+(this.e20>0?(1e7*this.e20+.5|0)/1e7:(1e7*this.e20-.5|0)/1e7)+", "+(this.e21>0?(1e7*this.e21+.5|0)/1e7:(1e7*this.e21-.5|0)/1e7)+", "+(this.e22>0?(1e7*this.e22+.5|0)/1e7:(1e7*this.e22-.5|0)/1e7)+"]"}},pa.common.Mat4=class{constructor(t,i,a,s,o,n,r,e,_,h,l,c,m,v,b,x){null==x&&(x=1),null==b&&(b=0),null==v&&(v=0),null==m&&(m=0),null==c&&(c=0),null==l&&(l=1),null==h&&(h=0),null==_&&(_=0),null==e&&(e=0),null==r&&(r=0),null==n&&(n=1),null==o&&(o=0),null==s&&(s=0),null==a&&(a=0),null==i&&(i=0),null==t&&(t=1),this.e00=t,this.e01=i,this.e02=a,this.e03=s,this.e10=o,this.e11=n,this.e12=r,this.e13=e,this.e20=_,this.e21=h,this.e22=l,this.e23=c,this.e30=m,this.e31=v,this.e32=b,this.e33=x,pa.common.Mat4.numCreations++}init(t,i,a,s,o,n,r,e,_,h,l,c,m,v,b,x){return this.e00=t,this.e01=i,this.e02=a,this.e03=s,this.e10=o,this.e11=n,this.e12=r,this.e13=e,this.e20=_,this.e21=h,this.e22=l,this.e23=c,this.e30=m,this.e31=v,this.e32=b,this.e33=x,this}identity(){return this.e00=1,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=1,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=1,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}add(t){return new pa.common.Mat4(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e03+t.e03,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e13+t.e13,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22,this.e23+t.e23,this.e30+t.e30,this.e31+t.e31,this.e32+t.e32,this.e33+t.e33)}sub(t){return new pa.common.Mat4(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e03-t.e03,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e13-t.e13,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22,this.e23-t.e23,this.e30-t.e30,this.e31-t.e31,this.e32-t.e32,this.e33-t.e33)}scale(t){return new pa.common.Mat4(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*t,this.e11*t,this.e12*t,this.e13*t,this.e20*t,this.e21*t,this.e22*t,this.e23*t,this.e30*t,this.e31*t,this.e32*t,this.e33*t)}mul(t){return new pa.common.Mat4(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33)}addEq(t){var i=this.e00+t.e00,a=this.e01+t.e01,s=this.e02+t.e02,o=this.e03+t.e03,n=this.e10+t.e10,r=this.e11+t.e11,e=this.e12+t.e12,_=this.e13+t.e13,h=this.e20+t.e20,l=this.e21+t.e21,c=this.e22+t.e22,m=this.e23+t.e23,v=this.e30+t.e30,b=this.e31+t.e31,x=this.e32+t.e32,p=this.e33+t.e33;return this.e00=i,this.e01=a,this.e02=s,this.e03=o,this.e10=n,this.e11=r,this.e12=e,this.e13=_,this.e20=h,this.e21=l,this.e22=c,this.e23=m,this.e30=v,this.e31=b,this.e32=x,this.e33=p,this}subEq(t){var i=this.e00-t.e00,a=this.e01-t.e01,s=this.e02-t.e02,o=this.e03-t.e03,n=this.e10-t.e10,r=this.e11-t.e11,e=this.e12-t.e12,_=this.e13-t.e13,h=this.e20-t.e20,l=this.e21-t.e21,c=this.e22-t.e22,m=this.e23-t.e23,v=this.e30-t.e30,b=this.e31-t.e31,x=this.e32-t.e32,p=this.e33-t.e33;return this.e00=i,this.e01=a,this.e02=s,this.e03=o,this.e10=n,this.e11=r,this.e12=e,this.e13=_,this.e20=h,this.e21=l,this.e22=c,this.e23=m,this.e30=v,this.e31=b,this.e32=x,this.e33=p,this}scaleEq(t){var i=this.e00*t,a=this.e01*t,s=this.e02*t,o=this.e03*t,n=this.e10*t,r=this.e11*t,e=this.e12*t,_=this.e13*t,h=this.e20*t,l=this.e21*t,c=this.e22*t,m=this.e23*t,v=this.e30*t,b=this.e31*t,x=this.e32*t,p=this.e33*t;return this.e00=i,this.e01=a,this.e02=s,this.e03=o,this.e10=n,this.e11=r,this.e12=e,this.e13=_,this.e20=h,this.e21=l,this.e22=c,this.e23=m,this.e30=v,this.e31=b,this.e32=x,this.e33=p,this}mulEq(t){var i=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,a=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,s=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,o=this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,n=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,r=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,e=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,_=this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,h=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,l=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,c=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,m=this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,v=this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,b=this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,x=this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,p=this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33;return this.e00=i,this.e01=a,this.e02=s,this.e03=o,this.e10=n,this.e11=r,this.e12=e,this.e13=_,this.e20=h,this.e21=l,this.e22=c,this.e23=m,this.e30=v,this.e31=b,this.e32=x,this.e33=p,this}prependScale(t,i,a){return new pa.common.Mat4(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*i,this.e11*i,this.e12*i,this.e13*i,this.e20*a,this.e21*a,this.e22*a,this.e23*a,this.e30,this.e31,this.e32,this.e33)}appendScale(t,i,a){return new pa.common.Mat4(this.e00*t,this.e01*i,this.e02*a,this.e03,this.e10*t,this.e11*i,this.e12*a,this.e13,this.e20*t,this.e21*i,this.e22*a,this.e23,this.e30*t,this.e31*i,this.e32*a,this.e33)}prependRotation(t,i,a,s){var o=Math.sin(t),n=Math.cos(t),r=1-n,e=i*i*r+n,_=i*a*r-s*o,h=i*s*r+a*o,l=a*i*r+s*o,c=a*a*r+n,m=a*s*r-i*o,v=s*i*r-a*o,b=s*a*r+i*o,x=s*s*r+n;return new pa.common.Mat4(e*this.e00+_*this.e10+h*this.e20,e*this.e01+_*this.e11+h*this.e21,e*this.e02+_*this.e12+h*this.e22,e*this.e03+_*this.e13+h*this.e23,l*this.e00+c*this.e10+m*this.e20,l*this.e01+c*this.e11+m*this.e21,l*this.e02+c*this.e12+m*this.e22,l*this.e03+c*this.e13+m*this.e23,v*this.e00+b*this.e10+x*this.e20,v*this.e01+b*this.e11+x*this.e21,v*this.e02+b*this.e12+x*this.e22,v*this.e03+b*this.e13+x*this.e23,this.e30,this.e31,this.e32,this.e33)}appendRotation(t,i,a,s){var o=Math.sin(t),n=Math.cos(t),r=1-n,e=i*i*r+n,_=i*a*r-s*o,h=i*s*r+a*o,l=a*i*r+s*o,c=a*a*r+n,m=a*s*r-i*o,v=s*i*r-a*o,b=s*a*r+i*o,x=s*s*r+n;return new pa.common.Mat4(this.e00*e+this.e01*l+this.e02*v,this.e00*_+this.e01*c+this.e02*b,this.e00*h+this.e01*m+this.e02*x,this.e03,this.e10*e+this.e11*l+this.e12*v,this.e10*_+this.e11*c+this.e12*b,this.e10*h+this.e11*m+this.e12*x,this.e13,this.e20*e+this.e21*l+this.e22*v,this.e20*_+this.e21*c+this.e22*b,this.e20*h+this.e21*m+this.e22*x,this.e23,this.e30*e+this.e31*l+this.e32*v,this.e30*_+this.e31*c+this.e32*b,this.e30*h+this.e31*m+this.e32*x,this.e33)}prependTranslation(t,i,a){return new pa.common.Mat4(this.e00+t*this.e30,this.e01+t*this.e31,this.e02+t*this.e32,this.e03+t*this.e33,this.e10+i*this.e30,this.e11+i*this.e31,this.e12+i*this.e32,this.e13+i*this.e33,this.e20+a*this.e30,this.e21+a*this.e31,this.e22+a*this.e32,this.e23+a*this.e33,this.e30,this.e31,this.e32,this.e33)}appendTranslation(t,i,a){return new pa.common.Mat4(this.e00,this.e01,this.e02,this.e00*t+this.e01*i+this.e02*a+this.e03,this.e10,this.e11,this.e12,this.e10*t+this.e11*i+this.e12*a+this.e13,this.e20,this.e21,this.e22,this.e20*t+this.e21*i+this.e22*a+this.e23,this.e30,this.e31,this.e32,this.e30*t+this.e31*i+this.e32*a+this.e33)}prependScaleEq(t,i,a){var s=this.e00*t,o=this.e01*t,n=this.e02*t,r=this.e03*t,e=this.e10*i,_=this.e11*i,h=this.e12*i,l=this.e13*i,c=this.e20*a,m=this.e21*a,v=this.e22*a,b=this.e23*a,x=this.e30,p=this.e31,f=this.e32,u=this.e33;return this.e00=s,this.e01=o,this.e02=n,this.e03=r,this.e10=e,this.e11=_,this.e12=h,this.e13=l,this.e20=c,this.e21=m,this.e22=v,this.e23=b,this.e30=x,this.e31=p,this.e32=f,this.e33=u,this}appendScaleEq(t,i,a){var s=this.e00*t,o=this.e01*i,n=this.e02*a,r=this.e03,e=this.e10*t,_=this.e11*i,h=this.e12*a,l=this.e13,c=this.e20*t,m=this.e21*i,v=this.e22*a,b=this.e23,x=this.e30*t,p=this.e31*i,f=this.e32*a,u=this.e33;return this.e00=s,this.e01=o,this.e02=n,this.e03=r,this.e10=e,this.e11=_,this.e12=h,this.e13=l,this.e20=c,this.e21=m,this.e22=v,this.e23=b,this.e30=x,this.e31=p,this.e32=f,this.e33=u,this}prependRotationEq(t,i,a,s){var o=Math.sin(t),n=Math.cos(t),r=1-n,e=i*i*r+n,_=i*a*r-s*o,h=i*s*r+a*o,l=a*i*r+s*o,c=a*a*r+n,m=a*s*r-i*o,v=s*i*r-a*o,b=s*a*r+i*o,x=s*s*r+n,p=e*this.e00+_*this.e10+h*this.e20,f=e*this.e01+_*this.e11+h*this.e21,u=e*this.e02+_*this.e12+h*this.e22,y=e*this.e03+_*this.e13+h*this.e23,d=l*this.e00+c*this.e10+m*this.e20,g=l*this.e01+c*this.e11+m*this.e21,X=l*this.e02+c*this.e12+m*this.e22,z=l*this.e03+c*this.e13+m*this.e23,Y=v*this.e00+b*this.e10+x*this.e20,Z=v*this.e01+b*this.e11+x*this.e21,M=v*this.e02+b*this.e12+x*this.e22,I=v*this.e03+b*this.e13+x*this.e23,V=this.e30,w=this.e31,L=this.e32,k=this.e33;return this.e00=p,this.e01=f,this.e02=u,this.e03=y,this.e10=d,this.e11=g,this.e12=X,this.e13=z,this.e20=Y,this.e21=Z,this.e22=M,this.e23=I,this.e30=V,this.e31=w,this.e32=L,this.e33=k,this}appendRotationEq(t,i,a,s){var o=Math.sin(t),n=Math.cos(t),r=1-n,e=i*i*r+n,_=i*a*r-s*o,h=i*s*r+a*o,l=a*i*r+s*o,c=a*a*r+n,m=a*s*r-i*o,v=s*i*r-a*o,b=s*a*r+i*o,x=s*s*r+n,p=this.e00*e+this.e01*l+this.e02*v,f=this.e00*_+this.e01*c+this.e02*b,u=this.e00*h+this.e01*m+this.e02*x,y=this.e03,d=this.e10*e+this.e11*l+this.e12*v,g=this.e10*_+this.e11*c+this.e12*b,X=this.e10*h+this.e11*m+this.e12*x,z=this.e13,Y=this.e20*e+this.e21*l+this.e22*v,Z=this.e20*_+this.e21*c+this.e22*b,M=this.e20*h+this.e21*m+this.e22*x,I=this.e23,V=this.e30*e+this.e31*l+this.e32*v,w=this.e30*_+this.e31*c+this.e32*b,L=this.e30*h+this.e31*m+this.e32*x,k=this.e33;return this.e00=p,this.e01=f,this.e02=u,this.e03=y,this.e10=d,this.e11=g,this.e12=X,this.e13=z,this.e20=Y,this.e21=Z,this.e22=M,this.e23=I,this.e30=V,this.e31=w,this.e32=L,this.e33=k,this}prependTranslationEq(t,i,a){var s=this.e00+t*this.e30,o=this.e01+t*this.e31,n=this.e02+t*this.e32,r=this.e03+t*this.e33,e=this.e10+i*this.e30,_=this.e11+i*this.e31,h=this.e12+i*this.e32,l=this.e13+i*this.e33,c=this.e20+a*this.e30,m=this.e21+a*this.e31,v=this.e22+a*this.e32,b=this.e23+a*this.e33,x=this.e30,p=this.e31,f=this.e32,u=this.e33;return this.e00=s,this.e01=o,this.e02=n,this.e03=r,this.e10=e,this.e11=_,this.e12=h,this.e13=l,this.e20=c,this.e21=m,this.e22=v,this.e23=b,this.e30=x,this.e31=p,this.e32=f,this.e33=u,this}appendTranslationEq(t,i,a){var s=this.e00,o=this.e01,n=this.e02,r=this.e00*t+this.e01*i+this.e02*a+this.e03,e=this.e10,_=this.e11,h=this.e12,l=this.e10*t+this.e11*i+this.e12*a+this.e13,c=this.e20,m=this.e21,v=this.e22,b=this.e20*t+this.e21*i+this.e22*a+this.e23,x=this.e30,p=this.e31,f=this.e32,u=this.e30*t+this.e31*i+this.e32*a+this.e33;return this.e00=s,this.e01=o,this.e02=n,this.e03=r,this.e10=e,this.e11=_,this.e12=h,this.e13=l,this.e20=c,this.e21=m,this.e22=v,this.e23=b,this.e30=x,this.e31=p,this.e32=f,this.e33=u,this}transpose(){return new pa.common.Mat4(this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33)}transposeEq(){var t=this.e00,i=this.e10,a=this.e20,s=this.e30,o=this.e01,n=this.e11,r=this.e21,e=this.e31,_=this.e02,h=this.e12,l=this.e22,c=this.e32,m=this.e03,v=this.e13,b=this.e23,x=this.e33;return this.e00=t,this.e01=i,this.e02=a,this.e03=s,this.e10=o,this.e11=n,this.e12=r,this.e13=e,this.e20=_,this.e21=h,this.e22=l,this.e23=c,this.e30=m,this.e31=v,this.e32=b,this.e33=x,this}determinant(){var t=this.e20*this.e31-this.e21*this.e30,i=this.e20*this.e32-this.e22*this.e30,a=this.e20*this.e33-this.e23*this.e30,s=this.e21*this.e32-this.e22*this.e31,o=this.e21*this.e33-this.e23*this.e31,n=this.e22*this.e33-this.e23*this.e32;return this.e00*(this.e11*n-this.e12*o+this.e13*s)-this.e01*(this.e10*n-this.e12*a+this.e13*i)+this.e02*(this.e10*o-this.e11*a+this.e13*t)-this.e03*(this.e10*s-this.e11*i+this.e12*t)}trace(){return this.e00+this.e11+this.e22+this.e33}inverse(){var t=this.e00*this.e11-this.e01*this.e10,i=this.e00*this.e12-this.e02*this.e10,a=this.e00*this.e13-this.e03*this.e10,s=this.e01*this.e12-this.e02*this.e11,o=this.e01*this.e13-this.e03*this.e11,n=this.e02*this.e13-this.e03*this.e12,r=this.e20*this.e31-this.e21*this.e30,e=this.e20*this.e32-this.e22*this.e30,_=this.e20*this.e33-this.e23*this.e30,h=this.e21*this.e32-this.e22*this.e31,l=this.e21*this.e33-this.e23*this.e31,c=this.e22*this.e33-this.e23*this.e32,m=this.e11*c-this.e12*l+this.e13*h,v=this.e10*c-this.e12*_+this.e13*e,b=this.e10*l-this.e11*_+this.e13*r,x=this.e10*h-this.e11*e+this.e12*r,p=this.e01*c-this.e02*l+this.e03*h,f=this.e00*c-this.e02*_+this.e03*e,u=this.e00*l-this.e01*_+this.e03*r,y=this.e00*h-this.e01*e+this.e02*r,d=this.e31*n-this.e32*o+this.e33*s,g=this.e30*n-this.e32*a+this.e33*i,X=this.e30*o-this.e31*a+this.e33*t,z=this.e30*s-this.e31*i+this.e32*t,Y=this.e21*n-this.e22*o+this.e23*s,Z=this.e20*n-this.e22*a+this.e23*i,M=this.e20*o-this.e21*a+this.e23*t,I=this.e20*s-this.e21*i+this.e22*t,V=this.e00*m-this.e01*v+this.e02*b-this.e03*x;return 0!=V&&(V=1/V),new pa.common.Mat4(m*V,-p*V,d*V,-Y*V,-v*V,f*V,-g*V,Z*V,b*V,-u*V,X*V,-M*V,-x*V,y*V,-z*V,I*V)}inverseEq(){var t=this.e00*this.e11-this.e01*this.e10,i=this.e00*this.e12-this.e02*this.e10,a=this.e00*this.e13-this.e03*this.e10,s=this.e01*this.e12-this.e02*this.e11,o=this.e01*this.e13-this.e03*this.e11,n=this.e02*this.e13-this.e03*this.e12,r=this.e20*this.e31-this.e21*this.e30,e=this.e20*this.e32-this.e22*this.e30,_=this.e20*this.e33-this.e23*this.e30,h=this.e21*this.e32-this.e22*this.e31,l=this.e21*this.e33-this.e23*this.e31,c=this.e22*this.e33-this.e23*this.e32,m=this.e11*c-this.e12*l+this.e13*h,v=this.e10*c-this.e12*_+this.e13*e,b=this.e10*l-this.e11*_+this.e13*r,x=this.e10*h-this.e11*e+this.e12*r,p=this.e01*c-this.e02*l+this.e03*h,f=this.e00*c-this.e02*_+this.e03*e,u=this.e00*l-this.e01*_+this.e03*r,y=this.e00*h-this.e01*e+this.e02*r,d=this.e31*n-this.e32*o+this.e33*s,g=this.e30*n-this.e32*a+this.e33*i,X=this.e30*o-this.e31*a+this.e33*t,z=this.e30*s-this.e31*i+this.e32*t,Y=this.e21*n-this.e22*o+this.e23*s,Z=this.e20*n-this.e22*a+this.e23*i,M=this.e20*o-this.e21*a+this.e23*t,I=this.e20*s-this.e21*i+this.e22*t,V=this.e00*m-this.e01*v+this.e02*b-this.e03*x;0!=V&&(V=1/V);var w=m*V,L=-p*V,k=d*V,B=-Y*V,A=-v*V,P=f*V,S=-g*V,T=Z*V,C=b*V,j=-u*V,R=X*V,E=-M*V,q=-x*V,N=y*V,F=-z*V,D=I*V;return this.e00=w,this.e01=L,this.e02=k,this.e03=B,this.e10=A,this.e11=P,this.e12=S,this.e13=T,this.e20=C,this.e21=j,this.e22=R,this.e23=E,this.e30=q,this.e31=N,this.e32=F,this.e33=D,this}lookAt(t,i,a,s,o,n,r,e,_){var h=t-s,l=i-o,c=a-n,m=1/Math.sqrt(h*h+l*l+c*c),v=e*(c*=m)-_*(l*=m),b=_*(h*=m)-r*c,x=r*l-e*h,p=l*(x*=m=1/Math.sqrt(v*v+b*b+x*x))-c*(b*=m),f=c*(v*=m)-h*x,u=h*b-l*v;return this.e00=v,this.e01=b,this.e02=x,this.e03=-(v*t+b*i+x*a),this.e10=p,this.e11=f,this.e12=u,this.e13=-(p*t+f*i+u*a),this.e20=h,this.e21=l,this.e22=c,this.e23=-(h*t+l*i+c*a),this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}perspective(t,i,a,s){var o=1/Math.tan(.5*t),n=s/(a-s);return this.e00=o/i,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=o,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=n,this.e23=a*n,this.e30=0,this.e31=0,this.e32=-1,this.e33=0,this}ortho(t,i,a,s){var o=1/(a-s);return this.e00=2/t,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=2/i,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=o,this.e23=a*o,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}toArray(t){return null==t&&(t=!1),t?[this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33]:[this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33]}copyFrom(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e03=t.e03,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e13=t.e13,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this.e23=t.e23,this.e30=t.e30,this.e31=t.e31,this.e32=t.e32,this.e33=t.e33,this}fromMat3(t){var i=t.e00,a=t.e01,s=t.e02,o=t.e10,n=t.e11,r=t.e12,e=t.e20,_=t.e21,h=t.e22;return this.e00=i,this.e01=a,this.e02=s,this.e03=0,this.e10=o,this.e11=n,this.e12=r,this.e13=0,this.e20=e,this.e21=_,this.e22=h,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}fromTransform(t){var i=this;return i.e00=t._rotation00,i.e01=t._rotation01,i.e02=t._rotation02,i.e10=t._rotation10,i.e11=t._rotation11,i.e12=t._rotation12,i.e20=t._rotation20,i.e21=t._rotation21,i.e22=t._rotation22,i.e03=t._positionX,i.e13=t._positionY,i.e23=t._positionZ,i.e30=0,i.e31=0,i.e32=0,i.e33=1,this}clone(){return new pa.common.Mat4(this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33)}toString(){return"Mat4["+(this.e00>0?(1e7*this.e00+.5|0)/1e7:(1e7*this.e00-.5|0)/1e7)+", "+(this.e01>0?(1e7*this.e01+.5|0)/1e7:(1e7*this.e01-.5|0)/1e7)+", "+(this.e02>0?(1e7*this.e02+.5|0)/1e7:(1e7*this.e02-.5|0)/1e7)+", "+(this.e03>0?(1e7*this.e03+.5|0)/1e7:(1e7*this.e03-.5|0)/1e7)+",\n    "+(this.e10>0?(1e7*this.e10+.5|0)/1e7:(1e7*this.e10-.5|0)/1e7)+", "+(this.e11>0?(1e7*this.e11+.5|0)/1e7:(1e7*this.e11-.5|0)/1e7)+", "+(this.e12>0?(1e7*this.e12+.5|0)/1e7:(1e7*this.e12-.5|0)/1e7)+", "+(this.e13>0?(1e7*this.e13+.5|0)/1e7:(1e7*this.e13-.5|0)/1e7)+",\n    "+(this.e20>0?(1e7*this.e20+.5|0)/1e7:(1e7*this.e20-.5|0)/1e7)+", "+(this.e21>0?(1e7*this.e21+.5|0)/1e7:(1e7*this.e21-.5|0)/1e7)+", "+(this.e22>0?(1e7*this.e22+.5|0)/1e7:(1e7*this.e22-.5|0)/1e7)+", "+(this.e23>0?(1e7*this.e23+.5|0)/1e7:(1e7*this.e23-.5|0)/1e7)+",\n    "+(this.e30>0?(1e7*this.e30+.5|0)/1e7:(1e7*this.e30-.5|0)/1e7)+", "+(this.e31>0?(1e7*this.e31+.5|0)/1e7:(1e7*this.e31-.5|0)/1e7)+", "+(this.e32>0?(1e7*this.e32+.5|0)/1e7:(1e7*this.e32-.5|0)/1e7)+", "+(this.e33>0?(1e7*this.e33+.5|0)/1e7:(1e7*this.e33-.5|0)/1e7)+"]"}},pa.common.MathUtil=class{static abs(t){return t>0?t:-t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static tan(t){return Math.tan(t)}static asin(t){return Math.asin(t)}static acos(t){return Math.acos(t)}static atan(t){return Math.atan(t)}static safeAsin(t){return t<=-1?-1.570796326794895:t>=1?1.570796326794895:Math.asin(t)}static safeAcos(t){return t<=-1?3.14159265358979:t>=1?0:Math.acos(t)}static atan2(t,i){return Math.atan2(t,i)}static sqrt(t){return Math.sqrt(t)}static clamp(t,i,a){return t<i?i:t>a?a:t}static rand(){return Math.random()}static randIn(t,i){return t+Math.random()*(i-t)}static randVec3In(t,i){return new pa.common.Vec3(t+Math.random()*(i-t),t+Math.random()*(i-t),t+Math.random()*(i-t))}static randVec3(){return new pa.common.Vec3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1)}},pa.common.Pool=class{constructor(){var t=new Array(256);this.stackVec3=t,this.sizeVec3=0;var i=new Array(256);this.stackMat3=i,this.sizeMat3=0;var a=new Array(256);this.stackMat4=a,this.sizeMat4=0;var s=new Array(256);this.stackQuat=s,this.sizeQuat=0}vec3(){return 0==this.sizeVec3?new pa.common.Vec3:this.stackVec3[--this.sizeVec3]}mat3(){return 0==this.sizeMat3?new pa.common.Mat3:this.stackMat3[--this.sizeMat3]}mat4(){return 0==this.sizeMat4?new pa.common.Mat4:this.stackMat4[--this.sizeMat4]}quat(){return 0==this.sizeQuat?new pa.common.Quat:this.stackQuat[--this.sizeQuat]}dispose(t,i,a,s){if(null!=t){if(t.zero(),this.sizeVec3==this.stackVec3.length){for(var o=this.sizeVec3<<1,n=new Array(o),r=0,e=this.sizeVec3;r<e;){var _=r++;n[_]=this.stackVec3[_],this.stackVec3[_]=null}this.stackVec3=n}this.stackVec3[this.sizeVec3++]=t}if(null!=i){if(i.e00=1,i.e01=0,i.e02=0,i.e10=0,i.e11=1,i.e12=0,i.e20=0,i.e21=0,i.e22=1,this.sizeMat3==this.stackMat3.length){for(var h=this.sizeMat3<<1,l=new Array(h),c=0,m=this.sizeMat3;c<m;){var v=c++;l[v]=this.stackMat3[v],this.stackMat3[v]=null}this.stackMat3=l}this.stackMat3[this.sizeMat3++]=i}if(null!=a){if(a.e00=1,a.e01=0,a.e02=0,a.e03=0,a.e10=0,a.e11=1,a.e12=0,a.e13=0,a.e20=0,a.e21=0,a.e22=1,a.e23=0,a.e30=0,a.e31=0,a.e32=0,a.e33=1,this.sizeMat4==this.stackMat4.length){for(var b=this.sizeMat4<<1,x=new Array(b),p=0,f=this.sizeMat4;p<f;){var u=p++;x[u]=this.stackMat4[u],this.stackMat4[u]=null}this.stackMat4=x}this.stackMat4[this.sizeMat4++]=a}if(null!=s){if(s.x=0,s.y=0,s.z=0,s.w=1,this.sizeQuat==this.stackQuat.length){for(var y=this.sizeQuat<<1,d=new Array(y),g=0,X=this.sizeQuat;g<X;){var z=g++;d[z]=this.stackQuat[z],this.stackQuat[z]=null}this.stackQuat=d}this.stackQuat[this.sizeQuat++]=s}}disposeVec3(t){if(t.zero(),this.sizeVec3==this.stackVec3.length){for(var i=this.sizeVec3<<1,a=new Array(i),s=0,o=this.sizeVec3;s<o;){var n=s++;a[n]=this.stackVec3[n],this.stackVec3[n]=null}this.stackVec3=a}this.stackVec3[this.sizeVec3++]=t}disposeMat3(t){if(t.e00=1,t.e01=0,t.e02=0,t.e10=0,t.e11=1,t.e12=0,t.e20=0,t.e21=0,t.e22=1,this.sizeMat3==this.stackMat3.length){for(var i=this.sizeMat3<<1,a=new Array(i),s=0,o=this.sizeMat3;s<o;){var n=s++;a[n]=this.stackMat3[n],this.stackMat3[n]=null}this.stackMat3=a}this.stackMat3[this.sizeMat3++]=t}disposeMat4(t){if(t.e00=1,t.e01=0,t.e02=0,t.e03=0,t.e10=0,t.e11=1,t.e12=0,t.e13=0,t.e20=0,t.e21=0,t.e22=1,t.e23=0,t.e30=0,t.e31=0,t.e32=0,t.e33=1,this.sizeMat4==this.stackMat4.length){for(var i=this.sizeMat4<<1,a=new Array(i),s=0,o=this.sizeMat4;s<o;){var n=s++;a[n]=this.stackMat4[n],this.stackMat4[n]=null}this.stackMat4=a}this.stackMat4[this.sizeMat4++]=t}disposeQuat(t){if(t.x=0,t.y=0,t.z=0,t.w=1,this.sizeQuat==this.stackQuat.length){for(var i=this.sizeQuat<<1,a=new Array(i),s=0,o=this.sizeQuat;s<o;){var n=s++;a[n]=this.stackQuat[n],this.stackQuat[n]=null}this.stackQuat=a}this.stackQuat[this.sizeQuat++]=t}},pa.common.Quat=class{constructor(t,i,a,s){null==s&&(s=1),null==a&&(a=0),null==i&&(i=0),null==t&&(t=0),this.x=t,this.y=i,this.z=a,this.w=s,pa.common.Quat.numCreations++}identity(){return this.x=0,this.y=0,this.z=0,this.w=1,this}init(t,i,a,s){return this.x=t,this.y=i,this.z=a,this.w=s,this}add(t){return new pa.common.Quat(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}sub(t){return new pa.common.Quat(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}scale(t){return new pa.common.Quat(this.x*t,this.y*t,this.z*t,this.w*t)}addEq(t){var i=this.x+t.x,a=this.y+t.y,s=this.z+t.z,o=this.w+t.w;return this.x=i,this.y=a,this.z=s,this.w=o,this}subEq(t){var i=this.x-t.x,a=this.y-t.y,s=this.z-t.z,o=this.w-t.w;return this.x=i,this.y=a,this.z=s,this.w=o,this}scaleEq(t){var i=this.x*t,a=this.y*t,s=this.z*t,o=this.w*t;return this.x=i,this.y=a,this.z=s,this.w=o,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}normalized(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t>0&&(t=1/t),new pa.common.Quat(this.x*t,this.y*t,this.z*t,this.w*t)}normalize(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);t>0&&(t=1/t);var i=this.x*t,a=this.y*t,s=this.z*t,o=this.w*t;return this.x=i,this.y=a,this.z=s,this.w=o,this}setArc(t,i){var a=t.x,s=t.y,o=t.z,n=i.x,r=i.y,e=i.z,_=a*n+s*r+o*e;if(this.w=Math.sqrt(.5*(1+_)),0==this.w)return e=o*o,(n=a*a)<(r=s*s)?n<e?(_=1/Math.sqrt(r+e),this.x=0,this.y=o*_,this.z=-s*_):(_=1/Math.sqrt(n+r),this.z=0,this.x=s*_,this.y=-a*_):r<e?(_=1/Math.sqrt(e+n),this.y=0,this.z=a*_,this.x=-o*_):(_=1/Math.sqrt(n+r),this.z=0,this.x=s*_,this.y=-a*_),this;_=.5/this.w;var h=s*e-o*r,l=o*n-a*e,c=a*r-s*n;return this.x=h*_,this.y=l*_,this.z=c*_,this}slerp(t,i){var a,s,o,n,r=this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w;if(r<0?(r=-r,a=-t.x,s=-t.y,o=-t.z,n=-t.w):(a=t.x,s=t.y,o=t.z,n=t.w),r>.999999){var e=new pa.common.Quat(this.x+(a-this.x)*i,this.y+(s-this.y)*i,this.z+(o-this.z)*i,this.w+(n-this.w)*i),_=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w);_>0&&(_=1/_);var h=e.x*_,l=e.y*_,c=e.z*_,m=e.w*_;return e.x=h,e.y=l,e.z=c,e.w=m,e}var v=i*Math.acos(r);a-=this.x*r,s-=this.y*r,o-=this.z*r,n-=this.w*r;var b=1/Math.sqrt(a*a+s*s+o*o+n*n);a*=b,s*=b,o*=b,n*=b;var x=Math.sin(v),p=Math.cos(v);return new pa.common.Quat(this.x*p+a*x,this.y*p+s*x,this.z*p+o*x,this.w*p+n*x)}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}clone(){return new pa.common.Quat(this.x,this.y,this.z,this.w)}fromMat3(t){var i,a=t.e00,s=t.e11,o=t.e22,n=a+s+o;return n>0?(i=Math.sqrt(n+1),this.w=.5*i,i=.5/i,this.x=(t.e21-t.e12)*i,this.y=(t.e02-t.e20)*i,this.z=(t.e10-t.e01)*i):a>s?a>o?(i=Math.sqrt(a-s-o+1),this.x=.5*i,i=.5/i,this.y=(t.e01+t.e10)*i,this.z=(t.e02+t.e20)*i,this.w=(t.e21-t.e12)*i):(i=Math.sqrt(o-a-s+1),this.z=.5*i,i=.5/i,this.x=(t.e02+t.e20)*i,this.y=(t.e12+t.e21)*i,this.w=(t.e10-t.e01)*i):s>o?(i=Math.sqrt(s-o-a+1),this.y=.5*i,i=.5/i,this.x=(t.e01+t.e10)*i,this.z=(t.e12+t.e21)*i,this.w=(t.e02-t.e20)*i):(i=Math.sqrt(o-a-s+1),this.z=.5*i,i=.5/i,this.x=(t.e02+t.e20)*i,this.y=(t.e12+t.e21)*i,this.w=(t.e10-t.e01)*i),this}toMat3(){var t=new pa.common.Mat3,i=this.x,a=this.y,s=this.z,o=this.w,n=2*i,r=2*a,e=2*s,_=i*n,h=a*r,l=s*e,c=i*r,m=a*e,v=i*e,b=o*n,x=o*r,p=o*e;return t.e00=1-h-l,t.e01=c-p,t.e02=v+x,t.e10=c+p,t.e11=1-_-l,t.e12=m-b,t.e20=v-x,t.e21=m+b,t.e22=1-_-h,t}toString(){return"Quat["+(this.x>0?(1e7*this.x+.5|0)/1e7:(1e7*this.x-.5|0)/1e7)+" i,\n    "+(this.y>0?(1e7*this.y+.5|0)/1e7:(1e7*this.y-.5|0)/1e7)+" j,\n    "+(this.z>0?(1e7*this.z+.5|0)/1e7:(1e7*this.z-.5|0)/1e7)+" k,\n    "+(this.w>0?(1e7*this.w+.5|0)/1e7:(1e7*this.w-.5|0)/1e7)+"]"}},pa.dynamics||(pa.dynamics={}),pa.dynamics.Contact=class{constructor(){this._next=null,this._prev=null,this._link1=new pa.dynamics.ContactLink,this._link2=new pa.dynamics.ContactLink,this._s1=null,this._s2=null,this._b1=null,this._b2=null,this._detector=null,this._cachedDetectorData=new pa.collision.narrowphase.detector.CachedDetectorData,this._detectorResult=new pa.collision.narrowphase.DetectorResult,this._latest=!1,this._shouldBeSkipped=!1,this._manifold=new pa.dynamics.constraint.contact.Manifold,this._updater=new pa.dynamics.constraint.contact.ManifoldUpdater(this._manifold),this._contactConstraint=new pa.dynamics.constraint.contact.ContactConstraint(this._manifold),this._touching=!1}_updateManifold(){if(null!=this._detector){var t=this._touching,i=this._detectorResult;this._detector.detect(i,this._s1._geom,this._s2._geom,this._s1._transform,this._s2._transform,this._cachedDetectorData);var a=i.numPoints;if(this._touching=a>0,this._touching?(this._manifold._buildBasis(i.normal),i.getMaxDepth()>pa.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold?this._contactConstraint._positionCorrectionAlgorithm=pa.common.Setting.alternativeContactPositionCorrectionAlgorithm:this._contactConstraint._positionCorrectionAlgorithm=pa.common.Setting.defaultContactPositionCorrectionAlgorithm,i.incremental?this._updater.incrementalUpdate(i,this._b1._transform,this._b2._transform):this._updater.totalUpdate(i,this._b1._transform,this._b2._transform)):this._manifold._clear(),this._touching&&!t){var s=this._s1._contactCallback,o=this._s2._contactCallback;s==o&&(o=null),null!=s&&s.beginContact(this),null!=o&&o.beginContact(this)}if(!this._touching&&t){var n=this._s1._contactCallback,r=this._s2._contactCallback;n==r&&(r=null),null!=n&&n.endContact(this),null!=r&&r.endContact(this)}if(this._touching){var e=this._s1._contactCallback,_=this._s2._contactCallback;e==_&&(_=null),null!=e&&e.preSolve(this),null!=_&&_.preSolve(this)}}}_postSolve(){var t=this._s1._contactCallback,i=this._s2._contactCallback;t==i&&(i=null),null!=t&&t.postSolve(this),null!=i&&i.postSolve(this)}getShape1(){return this._s1}getShape2(){return this._s2}isTouching(){return this._touching}getManifold(){return this._manifold}getContactConstraint(){return this._contactConstraint}getPrev(){return this._prev}getNext(){return this._next}},pa.dynamics.ContactLink=class{constructor(){this._prev=null,this._next=null,this._contact=null,this._other=null}getContact(){return this._contact}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}},pa.dynamics.ContactManager=class{constructor(t){this._broadPhase=t,this._collisionMatrix=new pa.collision.narrowphase.CollisionMatrix,this._numContacts=0}createContacts(){for(var t=this._broadPhase._proxyPairList;null!=t;){for(var i=t._next;;){var a,s;if(t._p1._id<t._p2._id?(a=t._p1.userData,s=t._p2.userData):(a=t._p2.userData,s=t._p1.userData),!this.shouldCollide(a,s))break;var o,n=a._rigidBody,r=s._rigidBody;o=n._numContactLinks<r._numContactLinks?n._contactLinkList:r._contactLinkList;for(var e=a._id,_=s._id,h=!1;null!=o;){var l=o._next,c=o._contact;if(c._s1._id==e&&c._s2._id==_){c._latest=!0,h=!0;break}o=l}if(!h){var m=this._contactPool;null!=m?(this._contactPool=m._next,m._next=null):m=new pa.dynamics.Contact;var v=m;null==this._contactList?(this._contactList=v,this._contactListLast=v):(this._contactListLast._next=v,v._prev=this._contactListLast,this._contactListLast=v),v._latest=!0;var b=this._collisionMatrix.detectors[a._geom._type][s._geom._type];v._s1=a,v._s2=s,v._b1=a._rigidBody,v._b2=s._rigidBody,v._touching=!1,null==v._b1._contactLinkList?(v._b1._contactLinkList=v._link1,v._b1._contactLinkListLast=v._link1):(v._b1._contactLinkListLast._next=v._link1,v._link1._prev=v._b1._contactLinkListLast,v._b1._contactLinkListLast=v._link1),null==v._b2._contactLinkList?(v._b2._contactLinkList=v._link2,v._b2._contactLinkListLast=v._link2):(v._b2._contactLinkListLast._next=v._link2,v._link2._prev=v._b2._contactLinkListLast,v._b2._contactLinkListLast=v._link2),v._b1._numContactLinks++,v._b2._numContactLinks++,v._link1._other=v._b2,v._link2._other=v._b1,v._link1._contact=v,v._link2._contact=v,v._detector=b;var x=v._contactConstraint;x._s1=a,x._s2=s,x._b1=x._s1._rigidBody,x._b2=x._s2._rigidBody,x._tf1=x._b1._transform,x._tf2=x._b2._transform,this._numContacts++}break}t=i}}destroyOutdatedContacts(){for(var t=this._broadPhase._incremental,i=this._contactList;null!=i;){for(var a=i._next;;){if(i._latest){i._latest=!1,i._shouldBeSkipped=!1;break}if(!t){var s=i._prev,o=i._next;if(null!=s&&(s._next=o),null!=o&&(o._prev=s),i==this._contactList&&(this._contactList=this._contactList._next),i==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),i._next=null,i._prev=null,i._touching){var n=i._s1._contactCallback,r=i._s2._contactCallback;n==r&&(r=null),null!=n&&n.endContact(i),null!=r&&r.endContact(i)}var e=i._link1._prev,_=i._link1._next;null!=e&&(e._next=_),null!=_&&(_._prev=e),i._link1==i._b1._contactLinkList&&(i._b1._contactLinkList=i._b1._contactLinkList._next),i._link1==i._b1._contactLinkListLast&&(i._b1._contactLinkListLast=i._b1._contactLinkListLast._prev),i._link1._next=null,i._link1._prev=null;var h=i._link2._prev,l=i._link2._next;null!=h&&(h._next=l),null!=l&&(l._prev=h),i._link2==i._b2._contactLinkList&&(i._b2._contactLinkList=i._b2._contactLinkList._next),i._link2==i._b2._contactLinkListLast&&(i._b2._contactLinkListLast=i._b2._contactLinkListLast._prev),i._link2._next=null,i._link2._prev=null,i._b1._numContactLinks--,i._b2._numContactLinks--,i._link1._other=null,i._link2._other=null,i._link1._contact=null,i._link2._contact=null,i._s1=null,i._s2=null,i._b1=null,i._b2=null,i._touching=!1,i._cachedDetectorData._clear(),i._manifold._clear(),i._detector=null;var c=i._contactConstraint;c._s1=null,c._s2=null,c._b1=null,c._b2=null,c._tf1=null,c._tf2=null,i._next=this._contactPool,this._contactPool=i,this._numContacts--;break}var m=i._s1,v=i._s2,b=m._rigidBody,x=v._rigidBody,p=!b._sleeping&&1!=b._type,f=!x._sleeping&&1!=x._type;if(!p&&!f){i._shouldBeSkipped=!0;break}var u=m._aabb,y=v._aabb,d=m._proxy,g=v._proxy;if(!(d._aabbMinX<g._aabbMaxX&&d._aabbMaxX>g._aabbMinX&&d._aabbMinY<g._aabbMaxY&&d._aabbMaxY>g._aabbMinY&&d._aabbMinZ<g._aabbMaxZ&&d._aabbMaxZ>g._aabbMinZ&&this.shouldCollide(m,v))){var X=i._prev,z=i._next;if(null!=X&&(X._next=z),null!=z&&(z._prev=X),i==this._contactList&&(this._contactList=this._contactList._next),i==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),i._next=null,i._prev=null,i._touching){var Y=i._s1._contactCallback,Z=i._s2._contactCallback;Y==Z&&(Z=null),null!=Y&&Y.endContact(i),null!=Z&&Z.endContact(i)}var M=i._link1._prev,I=i._link1._next;null!=M&&(M._next=I),null!=I&&(I._prev=M),i._link1==i._b1._contactLinkList&&(i._b1._contactLinkList=i._b1._contactLinkList._next),i._link1==i._b1._contactLinkListLast&&(i._b1._contactLinkListLast=i._b1._contactLinkListLast._prev),i._link1._next=null,i._link1._prev=null;var V=i._link2._prev,w=i._link2._next;null!=V&&(V._next=w),null!=w&&(w._prev=V),i._link2==i._b2._contactLinkList&&(i._b2._contactLinkList=i._b2._contactLinkList._next),i._link2==i._b2._contactLinkListLast&&(i._b2._contactLinkListLast=i._b2._contactLinkListLast._prev),i._link2._next=null,i._link2._prev=null,i._b1._numContactLinks--,i._b2._numContactLinks--,i._link1._other=null,i._link2._other=null,i._link1._contact=null,i._link2._contact=null,i._s1=null,i._s2=null,i._b1=null,i._b2=null,i._touching=!1,i._cachedDetectorData._clear(),i._manifold._clear(),i._detector=null;var L=i._contactConstraint;L._s1=null,L._s2=null,L._b1=null,L._b2=null,L._tf1=null,L._tf2=null,i._next=this._contactPool,this._contactPool=i,this._numContacts--;break}var k=u._minX<y._maxX&&u._maxX>y._minX&&u._minY<y._maxY&&u._maxY>y._minY&&u._minZ<y._maxZ&&u._maxZ>y._minZ;i._shouldBeSkipped=!k;break}i=a}}shouldCollide(t,i){var a,s,o=t._rigidBody,n=i._rigidBody;if(o==n)return!1;if(0!=o._type&&0!=n._type)return!1;if(0==(t._collisionGroup&i._collisionMask)||0==(i._collisionGroup&t._collisionMask))return!1;for(o._numJointLinks<n._numJointLinks?(a=o._jointLinkList,s=n):(a=n._jointLinkList,s=o);null!=a;){var r=a._next;if(a._other==s&&!a._joint._allowCollision)return!1;a=r}return!0}_updateContacts(){this._broadPhase.collectPairs(),this.createContacts(),this.destroyOutdatedContacts()}_postSolve(){for(var t=this._contactList;null!=t;){var i=t._next;t._touching&&t._postSolve(),t=i}}getNumContacts(){return this._numContacts}getContactList(){return this._contactList}},pa.dynamics.Island=class{constructor(){var t=new Array(pa.common.Setting.islandInitialRigidBodyArraySize);this.rigidBodies=t;var i=new Array(pa.common.Setting.islandInitialConstraintArraySize);this.solvers=i;var a=new Array(pa.common.Setting.islandInitialConstraintArraySize);this.solversSi=a;var s=new Array(pa.common.Setting.islandInitialConstraintArraySize);this.solversNgs=s,this.numRigidBodies=0,this.numSolvers=0,this.numSolversSi=0,this.numSolversNgs=0}_clear(){for(;this.numRigidBodies>0;)this.rigidBodies[--this.numRigidBodies]=null;for(;this.numSolvers>0;)this.solvers[--this.numSolvers]=null;for(;this.numSolversSi>0;)this.solversSi[--this.numSolversSi]=null;for(;this.numSolversNgs>0;)this.solversNgs[--this.numSolversNgs]=null}_addRigidBody(t){if(this.numRigidBodies==this.rigidBodies.length){for(var i=this.numRigidBodies<<1,a=new Array(i),s=0,o=this.numRigidBodies;s<o;){var n=s++;a[n]=this.rigidBodies[n],this.rigidBodies[n]=null}this.rigidBodies=a}t._addedToIsland=!0,this.rigidBodies[this.numRigidBodies++]=t}_addConstraintSolver(t,i){if(this.numSolvers==this.solvers.length){for(var a=this.numSolvers<<1,s=new Array(a),o=0,n=this.numSolvers;o<n;){var r=o++;s[r]=this.solvers[r],this.solvers[r]=null}this.solvers=s}if(t._addedToIsland=!0,this.solvers[this.numSolvers++]=t,i==pa.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE){if(this.numSolversSi==this.solversSi.length){for(var e=this.numSolversSi<<1,_=new Array(e),h=0,l=this.numSolversSi;h<l;){var c=h++;_[c]=this.solversSi[c],this.solversSi[c]=null}this.solversSi=_}this.solversSi[this.numSolversSi++]=t}if(i==pa.dynamics.constraint.PositionCorrectionAlgorithm.NGS){if(this.numSolversNgs==this.solversNgs.length){for(var m=this.numSolversNgs<<1,v=new Array(m),b=0,x=this.numSolversNgs;b<x;){var p=b++;v[p]=this.solversNgs[p],this.solversNgs[p]=null}this.solversNgs=v}this.solversNgs[this.numSolversNgs++]=t}}_stepSingleRigidBody(t,i){var a=t.dt,s=i._ptransform,o=i._transform;if(s._positionX=o._positionX,s._positionY=o._positionY,s._positionZ=o._positionZ,s._rotation00=o._rotation00,s._rotation01=o._rotation01,s._rotation02=o._rotation02,s._rotation10=o._rotation10,s._rotation11=o._rotation11,s._rotation12=o._rotation12,s._rotation20=o._rotation20,s._rotation21=o._rotation21,s._rotation22=o._rotation22,i._linearContactImpulseX=0,i._linearContactImpulseY=0,i._linearContactImpulseZ=0,i._angularContactImpulseX=0,i._angularContactImpulseY=0,i._angularContactImpulseZ=0,i._autoSleep&&i._velX*i._velX+i._velY*i._velY+i._velZ*i._velZ<pa.common.Setting.sleepingVelocityThreshold*pa.common.Setting.sleepingVelocityThreshold&&i._angVelX*i._angVelX+i._angVelY*i._angVelY+i._angVelZ*i._angVelZ<pa.common.Setting.sleepingAngularVelocityThreshold*pa.common.Setting.sleepingAngularVelocityThreshold?(i._sleepTime+=a,i._sleepTime>pa.common.Setting.sleepingTimeThreshold&&(i._sleeping=!0,i._sleepTime=0)):i._sleepTime=0,!i._sleeping){if(0==i._type){var n,r,e,_,h,l,c=a*i._linearDamping,m=c*c,v=1/(1+c+m*(.5+.16666666666666666*c+.041666666666666664*m)),b=a*i._angularDamping,x=b*b,p=1/(1+b+x*(.5+.16666666666666666*b+.041666666666666664*x));n=this.gravityX*i._gravityScale,r=this.gravityY*i._gravityScale,e=this.gravityZ*i._gravityScale,n+=i._forceX*i._invMass,r+=i._forceY*i._invMass,e+=i._forceZ*i._invMass,_=i._invInertia00*i._torqueX+i._invInertia01*i._torqueY+i._invInertia02*i._torqueZ,h=i._invInertia10*i._torqueX+i._invInertia11*i._torqueY+i._invInertia12*i._torqueZ,l=i._invInertia20*i._torqueX+i._invInertia21*i._torqueY+i._invInertia22*i._torqueZ,i._velX+=n*a,i._velY+=r*a,i._velZ+=e*a,i._velX*=v,i._velY*=v,i._velZ*=v,i._angVelX+=_*a,i._angVelY+=h*a,i._angVelZ+=l*a,i._angVelX*=p,i._angVelY*=p,i._angVelZ*=p}i._integrate(a);for(var f=i._shapeList;null!=f;){var u,y,d,g,X,z,Y,Z,M,I,V,w,L=f._next,k=f._ptransform,B=f._localTransform,A=i._ptransform;u=A._rotation00*B._rotation00+A._rotation01*B._rotation10+A._rotation02*B._rotation20,y=A._rotation00*B._rotation01+A._rotation01*B._rotation11+A._rotation02*B._rotation21,d=A._rotation00*B._rotation02+A._rotation01*B._rotation12+A._rotation02*B._rotation22,g=A._rotation10*B._rotation00+A._rotation11*B._rotation10+A._rotation12*B._rotation20,X=A._rotation10*B._rotation01+A._rotation11*B._rotation11+A._rotation12*B._rotation21,z=A._rotation10*B._rotation02+A._rotation11*B._rotation12+A._rotation12*B._rotation22,Y=A._rotation20*B._rotation00+A._rotation21*B._rotation10+A._rotation22*B._rotation20,Z=A._rotation20*B._rotation01+A._rotation21*B._rotation11+A._rotation22*B._rotation21,M=A._rotation20*B._rotation02+A._rotation21*B._rotation12+A._rotation22*B._rotation22,k._rotation00=u,k._rotation01=y,k._rotation02=d,k._rotation10=g,k._rotation11=X,k._rotation12=z,k._rotation20=Y,k._rotation21=Z,k._rotation22=M,I=A._rotation00*B._positionX+A._rotation01*B._positionY+A._rotation02*B._positionZ,V=A._rotation10*B._positionX+A._rotation11*B._positionY+A._rotation12*B._positionZ,w=A._rotation20*B._positionX+A._rotation21*B._positionY+A._rotation22*B._positionZ,k._positionX=I,k._positionY=V,k._positionZ=w,k._positionX+=A._positionX,k._positionY+=A._positionY,k._positionZ+=A._positionZ;var P,S,T,C,j,R,E,q,N,F,D,G,W,J,U,O,H,Q,K=f._transform,$=f._localTransform,tt=i._transform;if(P=tt._rotation00*$._rotation00+tt._rotation01*$._rotation10+tt._rotation02*$._rotation20,S=tt._rotation00*$._rotation01+tt._rotation01*$._rotation11+tt._rotation02*$._rotation21,T=tt._rotation00*$._rotation02+tt._rotation01*$._rotation12+tt._rotation02*$._rotation22,C=tt._rotation10*$._rotation00+tt._rotation11*$._rotation10+tt._rotation12*$._rotation20,j=tt._rotation10*$._rotation01+tt._rotation11*$._rotation11+tt._rotation12*$._rotation21,R=tt._rotation10*$._rotation02+tt._rotation11*$._rotation12+tt._rotation12*$._rotation22,E=tt._rotation20*$._rotation00+tt._rotation21*$._rotation10+tt._rotation22*$._rotation20,q=tt._rotation20*$._rotation01+tt._rotation21*$._rotation11+tt._rotation22*$._rotation21,N=tt._rotation20*$._rotation02+tt._rotation21*$._rotation12+tt._rotation22*$._rotation22,K._rotation00=P,K._rotation01=S,K._rotation02=T,K._rotation10=C,K._rotation11=j,K._rotation12=R,K._rotation20=E,K._rotation21=q,K._rotation22=N,F=tt._rotation00*$._positionX+tt._rotation01*$._positionY+tt._rotation02*$._positionZ,D=tt._rotation10*$._positionX+tt._rotation11*$._positionY+tt._rotation12*$._positionZ,G=tt._rotation20*$._positionX+tt._rotation21*$._positionY+tt._rotation22*$._positionZ,K._positionX=F,K._positionY=D,K._positionZ=G,K._positionX+=tt._positionX,K._positionY+=tt._positionY,K._positionZ+=tt._positionZ,f._geom._computeAabb(f._aabb,f._ptransform),W=f._aabb._minX,J=f._aabb._minY,U=f._aabb._minZ,O=f._aabb._maxX,H=f._aabb._maxY,Q=f._aabb._maxZ,f._geom._computeAabb(f._aabb,f._transform),f._aabb._minX=W<f._aabb._minX?W:f._aabb._minX,f._aabb._minY=J<f._aabb._minY?J:f._aabb._minY,f._aabb._minZ=U<f._aabb._minZ?U:f._aabb._minZ,f._aabb._maxX=O>f._aabb._maxX?O:f._aabb._maxX,f._aabb._maxY=H>f._aabb._maxY?H:f._aabb._maxY,f._aabb._maxZ=Q>f._aabb._maxZ?Q:f._aabb._maxZ,null!=f._proxy){var it,at,st;it=f._transform._positionX-f._ptransform._positionX,at=f._transform._positionY-f._ptransform._positionY,st=f._transform._positionZ-f._ptransform._positionZ;var ot=f.displacement;ot.x=it,ot.y=at,ot.z=st,f._rigidBody._world._broadPhase.moveProxy(f._proxy,f._aabb,f.displacement)}f=L}}}_step(t,i,a){for(var s=t.dt,o=!0,n=0,r=this.numRigidBodies;n<r;){var e=n++,_=this.rigidBodies[e],h=_._ptransform,l=_._transform;if(h._positionX=l._positionX,h._positionY=l._positionY,h._positionZ=l._positionZ,h._rotation00=l._rotation00,h._rotation01=l._rotation01,h._rotation02=l._rotation02,h._rotation10=l._rotation10,h._rotation11=l._rotation11,h._rotation12=l._rotation12,h._rotation20=l._rotation20,h._rotation21=l._rotation21,h._rotation22=l._rotation22,_._linearContactImpulseX=0,_._linearContactImpulseY=0,_._linearContactImpulseZ=0,_._angularContactImpulseX=0,_._angularContactImpulseY=0,_._angularContactImpulseZ=0,_._sleeping=!1,_._autoSleep&&_._velX*_._velX+_._velY*_._velY+_._velZ*_._velZ<pa.common.Setting.sleepingVelocityThreshold*pa.common.Setting.sleepingVelocityThreshold&&_._angVelX*_._angVelX+_._angVelY*_._angVelY+_._angVelZ*_._angVelZ<pa.common.Setting.sleepingAngularVelocityThreshold*pa.common.Setting.sleepingAngularVelocityThreshold?_._sleepTime+=s:_._sleepTime=0,_._sleepTime<pa.common.Setting.sleepingTimeThreshold&&(o=!1),0==_._type){var c,m,v,b,x,p,f=s*_._linearDamping,u=f*f,y=1/(1+f+u*(.5+.16666666666666666*f+.041666666666666664*u)),d=s*_._angularDamping,g=d*d,X=1/(1+d+g*(.5+.16666666666666666*d+.041666666666666664*g));c=this.gravityX*_._gravityScale,m=this.gravityY*_._gravityScale,v=this.gravityZ*_._gravityScale,c+=_._forceX*_._invMass,m+=_._forceY*_._invMass,v+=_._forceZ*_._invMass,b=_._invInertia00*_._torqueX+_._invInertia01*_._torqueY+_._invInertia02*_._torqueZ,x=_._invInertia10*_._torqueX+_._invInertia11*_._torqueY+_._invInertia12*_._torqueZ,p=_._invInertia20*_._torqueX+_._invInertia21*_._torqueY+_._invInertia22*_._torqueZ,_._velX+=c*s,_._velY+=m*s,_._velZ+=v*s,_._velX*=y,_._velY*=y,_._velZ*=y,_._angVelX+=b*s,_._angVelY+=x*s,_._angVelZ+=p*s,_._angVelX*=X,_._angVelY*=X,_._angVelZ*=X}}if(o)for(var z=0,Y=this.numRigidBodies;z<Y;){var Z=z++,M=this.rigidBodies[Z];M._sleeping=!0,M._sleepTime=0}else{for(var I=0,V=this.numSolvers;I<V;){var w=I++;this.solvers[w].preSolveVelocity(t)}for(var L=0,k=this.numSolvers;L<k;){var B=L++;this.solvers[B].warmStart(t)}for(var A=0,P=i;A<P;){A++;for(var S=0,T=this.numSolvers;S<T;){var C=S++;this.solvers[C].solveVelocity()}}for(var j=0,R=this.numSolvers;j<R;){var E=j++;this.solvers[E].postSolveVelocity(t)}for(var q=0,N=this.numRigidBodies;q<N;){var F=q++;this.rigidBodies[F]._integrate(s)}for(var D=0,G=this.numSolversSi;D<G;){var W=D++;this.solversSi[W].preSolvePosition(t)}for(var J=0,U=a;J<U;){J++;for(var O=0,H=this.numSolversSi;O<H;){var Q=O++;this.solversSi[Q].solvePositionSplitImpulse()}}for(var K=0,$=this.numRigidBodies;K<$;){var tt=K++;this.rigidBodies[tt]._integratePseudoVelocity()}for(var it=0,at=this.numSolversNgs;it<at;){var st=it++;this.solversNgs[st].preSolvePosition(t)}for(var ot=0,nt=a;ot<nt;){ot++;for(var rt=0,et=this.numSolversNgs;rt<et;){var _t=rt++;this.solversNgs[_t].solvePositionNgs(t)}}for(var ht=0,lt=this.numSolvers;ht<lt;){var ct=ht++;this.solvers[ct].postSolve()}for(var mt=0,vt=this.numRigidBodies;mt<vt;)for(var bt=mt++,xt=this.rigidBodies[bt],pt=xt._shapeList;null!=pt;){var ft,ut,yt,dt,gt,Xt,zt,Yt,Zt,Mt,It,Vt,wt=pt._next,Lt=pt._ptransform,kt=pt._localTransform,Bt=xt._ptransform;ft=Bt._rotation00*kt._rotation00+Bt._rotation01*kt._rotation10+Bt._rotation02*kt._rotation20,ut=Bt._rotation00*kt._rotation01+Bt._rotation01*kt._rotation11+Bt._rotation02*kt._rotation21,yt=Bt._rotation00*kt._rotation02+Bt._rotation01*kt._rotation12+Bt._rotation02*kt._rotation22,dt=Bt._rotation10*kt._rotation00+Bt._rotation11*kt._rotation10+Bt._rotation12*kt._rotation20,gt=Bt._rotation10*kt._rotation01+Bt._rotation11*kt._rotation11+Bt._rotation12*kt._rotation21,Xt=Bt._rotation10*kt._rotation02+Bt._rotation11*kt._rotation12+Bt._rotation12*kt._rotation22,zt=Bt._rotation20*kt._rotation00+Bt._rotation21*kt._rotation10+Bt._rotation22*kt._rotation20,Yt=Bt._rotation20*kt._rotation01+Bt._rotation21*kt._rotation11+Bt._rotation22*kt._rotation21,Zt=Bt._rotation20*kt._rotation02+Bt._rotation21*kt._rotation12+Bt._rotation22*kt._rotation22,Lt._rotation00=ft,Lt._rotation01=ut,Lt._rotation02=yt,Lt._rotation10=dt,Lt._rotation11=gt,Lt._rotation12=Xt,Lt._rotation20=zt,Lt._rotation21=Yt,Lt._rotation22=Zt,Mt=Bt._rotation00*kt._positionX+Bt._rotation01*kt._positionY+Bt._rotation02*kt._positionZ,It=Bt._rotation10*kt._positionX+Bt._rotation11*kt._positionY+Bt._rotation12*kt._positionZ,Vt=Bt._rotation20*kt._positionX+Bt._rotation21*kt._positionY+Bt._rotation22*kt._positionZ,Lt._positionX=Mt,Lt._positionY=It,Lt._positionZ=Vt,Lt._positionX+=Bt._positionX,Lt._positionY+=Bt._positionY,Lt._positionZ+=Bt._positionZ;var At,Pt,St,Tt,Ct,jt,Rt,Et,qt,Nt,Ft,Dt,Gt,Wt,Jt,Ut,Ot,Ht,Qt=pt._transform,Kt=pt._localTransform,$t=xt._transform;if(At=$t._rotation00*Kt._rotation00+$t._rotation01*Kt._rotation10+$t._rotation02*Kt._rotation20,Pt=$t._rotation00*Kt._rotation01+$t._rotation01*Kt._rotation11+$t._rotation02*Kt._rotation21,St=$t._rotation00*Kt._rotation02+$t._rotation01*Kt._rotation12+$t._rotation02*Kt._rotation22,Tt=$t._rotation10*Kt._rotation00+$t._rotation11*Kt._rotation10+$t._rotation12*Kt._rotation20,Ct=$t._rotation10*Kt._rotation01+$t._rotation11*Kt._rotation11+$t._rotation12*Kt._rotation21,jt=$t._rotation10*Kt._rotation02+$t._rotation11*Kt._rotation12+$t._rotation12*Kt._rotation22,Rt=$t._rotation20*Kt._rotation00+$t._rotation21*Kt._rotation10+$t._rotation22*Kt._rotation20,Et=$t._rotation20*Kt._rotation01+$t._rotation21*Kt._rotation11+$t._rotation22*Kt._rotation21,qt=$t._rotation20*Kt._rotation02+$t._rotation21*Kt._rotation12+$t._rotation22*Kt._rotation22,Qt._rotation00=At,Qt._rotation01=Pt,Qt._rotation02=St,Qt._rotation10=Tt,Qt._rotation11=Ct,Qt._rotation12=jt,Qt._rotation20=Rt,Qt._rotation21=Et,Qt._rotation22=qt,Nt=$t._rotation00*Kt._positionX+$t._rotation01*Kt._positionY+$t._rotation02*Kt._positionZ,Ft=$t._rotation10*Kt._positionX+$t._rotation11*Kt._positionY+$t._rotation12*Kt._positionZ,Dt=$t._rotation20*Kt._positionX+$t._rotation21*Kt._positionY+$t._rotation22*Kt._positionZ,Qt._positionX=Nt,Qt._positionY=Ft,Qt._positionZ=Dt,Qt._positionX+=$t._positionX,Qt._positionY+=$t._positionY,Qt._positionZ+=$t._positionZ,pt._geom._computeAabb(pt._aabb,pt._ptransform),Gt=pt._aabb._minX,Wt=pt._aabb._minY,Jt=pt._aabb._minZ,Ut=pt._aabb._maxX,Ot=pt._aabb._maxY,Ht=pt._aabb._maxZ,pt._geom._computeAabb(pt._aabb,pt._transform),pt._aabb._minX=Gt<pt._aabb._minX?Gt:pt._aabb._minX,pt._aabb._minY=Wt<pt._aabb._minY?Wt:pt._aabb._minY,pt._aabb._minZ=Jt<pt._aabb._minZ?Jt:pt._aabb._minZ,pt._aabb._maxX=Ut>pt._aabb._maxX?Ut:pt._aabb._maxX,pt._aabb._maxY=Ot>pt._aabb._maxY?Ot:pt._aabb._maxY,pt._aabb._maxZ=Ht>pt._aabb._maxZ?Ht:pt._aabb._maxZ,null!=pt._proxy){var ti,ii,ai;ti=pt._transform._positionX-pt._ptransform._positionX,ii=pt._transform._positionY-pt._ptransform._positionY,ai=pt._transform._positionZ-pt._ptransform._positionZ;var si=pt.displacement;si.x=ti,si.y=ii,si.z=ai,pt._rigidBody._world._broadPhase.moveProxy(pt._proxy,pt._aabb,pt.displacement)}pt=wt}}}},pa.dynamics.TimeStep=class{constructor(){this.dt=0,this.invDt=0,this.dtRatio=1}},pa.dynamics.World=class{constructor(t,i){switch(null==t&&(t=2),t){case 1:this._broadPhase=new pa.collision.broadphase.bruteforce.BruteForceBroadPhase;break;case 2:this._broadPhase=new pa.collision.broadphase.bvh.BvhBroadPhase}this._contactManager=new pa.dynamics.ContactManager(this._broadPhase),null==i&&(i=new pa.common.Vec3(0,-9.80665,0)),this._gravity=new pa.common.Vec3(i.x,i.y,i.z),this._rigidBodyList=null,this._rigidBodyListLast=null,this._jointList=null,this._jointListLast=null,this._numRigidBodies=0,this._numShapes=0,this._numJoints=0,this._numIslands=0,this._numVelocityIterations=10,this._numPositionIterations=5,this._rayCastWrapper=new pa.dynamics._World.RayCastWrapper,this._convexCastWrapper=new pa.dynamics._World.ConvexCastWrapper,this._aabbTestWrapper=new pa.dynamics._World.AabbTestWrapper,this._island=new pa.dynamics.Island;var a=new Array(pa.common.Setting.islandInitialConstraintArraySize);this._solversInIslands=a;var s=new Array(pa.common.Setting.islandInitialRigidBodyArraySize);this._rigidBodyStack=s,this._timeStep=new pa.dynamics.TimeStep,this._pool=new pa.common.Pool,this._shapeIdCount=0}_updateContacts(){var t=Date.now()/1e3;this._contactManager._updateContacts();var i=Date.now()/1e3;pa.dynamics.common.Performance.broadPhaseCollisionTime=1e3*(i-t);for(var a=Date.now()/1e3,s=this._contactManager._contactList;null!=s;){var o=s._next;s._shouldBeSkipped||s._updateManifold(),s=o}var n=Date.now()/1e3;pa.dynamics.common.Performance.narrowPhaseCollisionTime=1e3*(n-a)}_solveIslands(){var t=Date.now()/1e3;if(pa.common.Setting.disableSleeping)for(var i=this._rigidBodyList;null!=i;){var a=i._next;i._sleeping=!1,i._sleepTime=0,i=a}if(this._rigidBodyStack.length<this._numRigidBodies){for(var s=this._rigidBodyStack.length<<1;s<this._numRigidBodies;)s<<=1;var o=new Array(s);this._rigidBodyStack=o}this._numIslands=0;var n=this._island,r=this._gravity;n.gravityX=r.x,n.gravityY=r.y,n.gravityZ=r.z;var e=this._rigidBodyList;for(this._numSolversInIslands=0;null!=e;){for(var _=e._next;!e._addedToIsland&&!e._sleeping&&1!=e._type;){if(0==e._numContactLinks&&0==e._numJointLinks){this._island._stepSingleRigidBody(this._timeStep,e),this._numIslands++;break}this.buildIsland(e),this._island._step(this._timeStep,this._numVelocityIterations,this._numPositionIterations),this._island._clear(),this._numIslands++;break}e=_}for(this._contactManager._postSolve(),e=this._rigidBodyList;null!=e;){var h=e._next;e._addedToIsland=!1,e=h}for(e=this._rigidBodyList;null!=e;){var l=e._next;e._forceX=0,e._forceY=0,e._forceZ=0,e._torqueX=0,e._torqueY=0,e._torqueZ=0,e=l}for(;this._numSolversInIslands>0;)this._solversInIslands[--this._numSolversInIslands]._addedToIsland=!1,this._solversInIslands[this._numSolversInIslands]=null;var c=Date.now()/1e3;pa.dynamics.common.Performance.dynamicsTime=1e3*(c-t)}buildIsland(t){var i=1;for(this._island._addRigidBody(t),this._rigidBodyStack[0]=t;i>0;){var a=this._rigidBodyStack[--i];if(this._rigidBodyStack[i]=null,1!=a._type){for(var s=a._contactLinkList;null!=s;){var o=s._next,n=s._contact._contactConstraint,r=s._contact._contactConstraint._solver;if(n.isTouching()&&!r._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){for(var e=this._numSolversInIslands<<1,_=new Array(e),h=0,l=this._numSolversInIslands;h<l;){var c=h++;_[c]=this._solversInIslands[c],this._solversInIslands[c]=null}this._solversInIslands=_}this._solversInIslands[this._numSolversInIslands++]=r,this._island._addConstraintSolver(r,n._positionCorrectionAlgorithm);var m=s._other;m._addedToIsland||(this._island._addRigidBody(m),this._rigidBodyStack[i++]=m)}s=o}for(var v=a._jointLinkList;null!=v;){var b=v._next,x=v._joint,p=x._solver;if(!p._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){for(var f=this._numSolversInIslands<<1,u=new Array(f),y=0,d=this._numSolversInIslands;y<d;){var g=y++;u[g]=this._solversInIslands[g],this._solversInIslands[g]=null}this._solversInIslands=u}this._solversInIslands[this._numSolversInIslands++]=p,this._island._addConstraintSolver(p,x._positionCorrectionAlgorithm);var X=v._other;X._addedToIsland||(this._island._addRigidBody(X),this._rigidBodyStack[i++]=X)}v=b}}}}_drawBvh(t,i){t.drawBvh&&this._drawBvhNode(t,i._root,0,t.style.bvhNodeColor)}_drawBvhNode(t,i,a,s){if(null!=i){if(a>=t.drawBvhMinLevel&&a<=t.drawBvhMaxLevel){var o=this._pool,n=0==o.sizeVec3?new pa.common.Vec3:o.stackVec3[--o.sizeVec3],r=this._pool,e=0==r.sizeVec3?new pa.common.Vec3:r.stackVec3[--r.sizeVec3],_=n;_.x=i._aabbMinX,_.y=i._aabbMinY,_.z=i._aabbMinZ;var h=e;h.x=i._aabbMaxX,h.y=i._aabbMaxY,h.z=i._aabbMaxZ,t.aabb(n,e,s);var l=this._pool;if(null!=n){if(n.zero(),l.sizeVec3==l.stackVec3.length){for(var c=l.sizeVec3<<1,m=new Array(c),v=0,b=l.sizeVec3;v<b;){var x=v++;m[x]=l.stackVec3[x],l.stackVec3[x]=null}l.stackVec3=m}l.stackVec3[l.sizeVec3++]=n}var p=this._pool;if(null!=e){if(e.zero(),p.sizeVec3==p.stackVec3.length){for(var f=p.sizeVec3<<1,u=new Array(f),y=0,d=p.sizeVec3;y<d;){var g=y++;u[g]=p.stackVec3[g],p.stackVec3[g]=null}p.stackVec3=u}p.stackVec3[p.sizeVec3++]=e}}this._drawBvhNode(t,i._children[0],a+1,s),this._drawBvhNode(t,i._children[1],a+1,s)}}_drawRigidBodies(t){for(var i=t.style,a=this._rigidBodyList;null!=a;){var s=a._next;if(t.drawBases){var o=t.style;t.basis(a._transform,o.basisLength,o.basisColorX,o.basisColorY,o.basisColorZ)}var n=null,r=0==a._type;r||(n=2==a._type?i.kinematicShapeColor:i.staticShapeColor);for(var e=a._shapeList;null!=e;){var _=e._next;if(r&&(n=1&e._id?a._sleeping?i.sleepingShapeColor2:a._sleepTime>pa.common.Setting.sleepingTimeThreshold?i.sleepyShapeColor2:i.shapeColor2:a._sleeping?i.sleepingShapeColor1:a._sleepTime>pa.common.Setting.sleepingTimeThreshold?i.sleepyShapeColor1:i.shapeColor1),t.drawShapes){var h=e._geom,l=e._transform;switch(h._type){case 0:t.sphere(l,h._radius,n);break;case 1:var c=h,m=this._pool,v=0==m.sizeVec3?new pa.common.Vec3:m.stackVec3[--m.sizeVec3],b=v;b.x=c._halfExtentsX,b.y=c._halfExtentsY,b.z=c._halfExtentsZ,t.box(l,v,n);var x=this._pool;if(null!=v){if(v.zero(),x.sizeVec3==x.stackVec3.length){for(var p=x.sizeVec3<<1,f=new Array(p),u=0,y=x.sizeVec3;u<y;){var d=u++;f[d]=x.stackVec3[d],x.stackVec3[d]=null}x.stackVec3=f}x.stackVec3[x.sizeVec3++]=v}break;case 2:var g=h;t.cylinder(l,g._radius,g._halfHeight,n);break;case 3:var X=h;t.cone(l,X._radius,X._halfHeight,n);break;case 4:var z=h;t.capsule(l,z._radius,z._halfHeight,n);break;case 5:var Y=h,Z=Y._numVertices,M=this._pool,I=0==M.sizeVec3?new pa.common.Vec3:M.stackVec3[--M.sizeVec3],V=this._pool,w=0==V.sizeVec3?new pa.common.Vec3:V.stackVec3[--V.sizeVec3],L=this._pool,k=0==L.sizeVec3?new pa.common.Vec3:L.stackVec3[--L.sizeVec3],B=this._pool,A=0==B.sizeVec3?new pa.common.Vec3:B.stackVec3[--B.sizeVec3],P=this._pool,S=0==P.sizeVec3?new pa.common.Vec3:P.stackVec3[--P.sizeVec3],T=this._pool,C=0==T.sizeVec3?new pa.common.Vec3:T.stackVec3[--T.sizeVec3],j=this._pool,R=0==j.sizeMat3?new pa.common.Mat3:j.stackMat3[--j.sizeMat3],E=this._pool,q=0==E.sizeVec3?new pa.common.Vec3:E.stackVec3[--E.sizeVec3],N=R;N.e00=l._rotation00,N.e01=l._rotation01,N.e02=l._rotation02,N.e10=l._rotation10,N.e11=l._rotation11,N.e12=l._rotation12,N.e20=l._rotation20,N.e21=l._rotation21,N.e22=l._rotation22;var F=q;F.x=l._positionX,F.y=l._positionY,F.z=l._positionZ;for(var D=0,G=Z;D<G;){var W=D++,J=Y._tmpVertices[W],U=Y._vertices[W];J.x=U.x,J.y=U.y,J.z=U.z;var O=J,H=O.x*R.e00+O.y*R.e01+O.z*R.e02,Q=O.x*R.e10+O.y*R.e11+O.z*R.e12,K=O.x*R.e20+O.y*R.e21+O.z*R.e22;O.x=H,O.y=Q,O.z=K;var $=O,tt=$.x+q.x,it=$.y+q.y,at=$.z+q.z;$.x=tt,$.y=it,$.z=at}if(Z>30)for(var st=0,ot=Z;st<ot;){var nt=st++,rt=Y._tmpVertices[nt];I.x=rt.x,I.y=rt.y,I.z=rt.z;var et=Y._tmpVertices[(nt+1)%Z];w.x=et.x,w.y=et.y,w.z=et.z,t.line(I,w,n)}else if(this._debugDraw.wireframe||Z>10)for(var _t=0,ht=Z;_t<ht;){var lt=_t++,ct=Y._tmpVertices[lt];I.x=ct.x,I.y=ct.y,I.z=ct.z;for(var mt=0,vt=lt;mt<vt;){var bt=mt++,xt=Y._tmpVertices[bt];w.x=xt.x,w.y=xt.y,w.z=xt.z,t.line(I,w,n)}}else for(var pt=0,ft=Z;pt<ft;){var ut=pt++,yt=Y._tmpVertices[ut];I.x=yt.x,I.y=yt.y,I.z=yt.z;for(var dt=0,gt=ut;dt<gt;){var Xt=dt++,zt=Y._tmpVertices[Xt];w.x=zt.x,w.y=zt.y,w.z=zt.z;for(var Yt=0,Zt=Xt;Yt<Zt;){var Mt=Yt++,It=Y._tmpVertices[Mt];k.x=It.x,k.y=It.y,k.z=It.z,A.x=w.x,A.y=w.y,A.z=w.z;var Vt=A,wt=Vt.x-I.x,Lt=Vt.y-I.y,kt=Vt.z-I.z;Vt.x=wt,Vt.y=Lt,Vt.z=kt,S.x=k.x,S.y=k.y,S.z=k.z;var Bt=S,At=Bt.x-I.x,Pt=Bt.y-I.y,St=Bt.z-I.z;Bt.x=At,Bt.y=Pt,Bt.z=St,C.x=A.x,C.y=A.y,C.z=A.z;var Tt=C,Ct=Tt.y*S.z-Tt.z*S.y,jt=Tt.z*S.x-Tt.x*S.z,Rt=Tt.x*S.y-Tt.y*S.x;Tt.x=Ct,Tt.y=jt,Tt.z=Rt;var Et=Tt,qt=Math.sqrt(Et.x*Et.x+Et.y*Et.y+Et.z*Et.z);qt>0&&(qt=1/qt);var Nt=Et.x*qt,Ft=Et.y*qt,Dt=Et.z*qt;Et.x=Nt,Et.y=Ft,Et.z=Dt,t.triangle(I,w,k,C,C,C,n);var Gt=-C.x,Wt=-C.y,Jt=-C.z;C.x=Gt,C.y=Wt,C.z=Jt,t.triangle(I,k,w,C,C,C,n)}}}var Ut=this._pool;if(null!=I){if(I.zero(),Ut.sizeVec3==Ut.stackVec3.length){for(var Ot=Ut.sizeVec3<<1,Ht=new Array(Ot),Qt=0,Kt=Ut.sizeVec3;Qt<Kt;){var $t=Qt++;Ht[$t]=Ut.stackVec3[$t],Ut.stackVec3[$t]=null}Ut.stackVec3=Ht}Ut.stackVec3[Ut.sizeVec3++]=I}var ti=this._pool;if(null!=w){if(w.zero(),ti.sizeVec3==ti.stackVec3.length){for(var ii=ti.sizeVec3<<1,ai=new Array(ii),si=0,oi=ti.sizeVec3;si<oi;){var ni=si++;ai[ni]=ti.stackVec3[ni],ti.stackVec3[ni]=null}ti.stackVec3=ai}ti.stackVec3[ti.sizeVec3++]=w}var ri=this._pool;if(null!=k){if(k.zero(),ri.sizeVec3==ri.stackVec3.length){for(var ei=ri.sizeVec3<<1,_i=new Array(ei),hi=0,li=ri.sizeVec3;hi<li;){var ci=hi++;_i[ci]=ri.stackVec3[ci],ri.stackVec3[ci]=null}ri.stackVec3=_i}ri.stackVec3[ri.sizeVec3++]=k}var mi=this._pool;if(null!=A){if(A.zero(),mi.sizeVec3==mi.stackVec3.length){for(var vi=mi.sizeVec3<<1,bi=new Array(vi),xi=0,pi=mi.sizeVec3;xi<pi;){var fi=xi++;bi[fi]=mi.stackVec3[fi],mi.stackVec3[fi]=null}mi.stackVec3=bi}mi.stackVec3[mi.sizeVec3++]=A}var ui=this._pool;if(null!=S){if(S.zero(),ui.sizeVec3==ui.stackVec3.length){for(var yi=ui.sizeVec3<<1,di=new Array(yi),gi=0,Xi=ui.sizeVec3;gi<Xi;){var zi=gi++;di[zi]=ui.stackVec3[zi],ui.stackVec3[zi]=null}ui.stackVec3=di}ui.stackVec3[ui.sizeVec3++]=S}var Yi=this._pool;if(null!=C){if(C.zero(),Yi.sizeVec3==Yi.stackVec3.length){for(var Zi=Yi.sizeVec3<<1,Mi=new Array(Zi),Ii=0,Vi=Yi.sizeVec3;Ii<Vi;){var wi=Ii++;Mi[wi]=Yi.stackVec3[wi],Yi.stackVec3[wi]=null}Yi.stackVec3=Mi}Yi.stackVec3[Yi.sizeVec3++]=C}var Li=this._pool;if(null!=R){if(R.e00=1,R.e01=0,R.e02=0,R.e10=0,R.e11=1,R.e12=0,R.e20=0,R.e21=0,R.e22=1,Li.sizeMat3==Li.stackMat3.length){for(var ki=Li.sizeMat3<<1,Bi=new Array(ki),Ai=0,Pi=Li.sizeMat3;Ai<Pi;){var Si=Ai++;Bi[Si]=Li.stackMat3[Si],Li.stackMat3[Si]=null}Li.stackMat3=Bi}Li.stackMat3[Li.sizeMat3++]=R}var Ti=this._pool;if(null!=q){if(q.zero(),Ti.sizeVec3==Ti.stackVec3.length){for(var Ci=Ti.sizeVec3<<1,ji=new Array(Ci),Ri=0,Ei=Ti.sizeVec3;Ri<Ei;){var qi=Ri++;ji[qi]=Ti.stackVec3[qi],Ti.stackVec3[qi]=null}Ti.stackVec3=ji}Ti.stackVec3[Ti.sizeVec3++]=q}}}if(t.drawAabbs){var Ni=e._aabb,Fi=i.aabbColor,Di=this._pool,Gi=0==Di.sizeVec3?new pa.common.Vec3:Di.stackVec3[--Di.sizeVec3],Wi=this._pool,Ji=0==Wi.sizeVec3?new pa.common.Vec3:Wi.stackVec3[--Wi.sizeVec3],Ui=Gi;Ui.x=Ni._minX,Ui.y=Ni._minY,Ui.z=Ni._minZ;var Oi=Ji;Oi.x=Ni._maxX,Oi.y=Ni._maxY,Oi.z=Ni._maxZ,t.aabb(Gi,Ji,Fi);var Hi=this._pool;if(null!=Gi){if(Gi.zero(),Hi.sizeVec3==Hi.stackVec3.length){for(var Qi=Hi.sizeVec3<<1,Ki=new Array(Qi),$i=0,ta=Hi.sizeVec3;$i<ta;){var ia=$i++;Ki[ia]=Hi.stackVec3[ia],Hi.stackVec3[ia]=null}Hi.stackVec3=Ki}Hi.stackVec3[Hi.sizeVec3++]=Gi}var aa=this._pool;if(null!=Ji){if(Ji.zero(),aa.sizeVec3==aa.stackVec3.length){for(var sa=aa.sizeVec3<<1,oa=new Array(sa),na=0,ra=aa.sizeVec3;na<ra;){var ea=na++;oa[ea]=aa.stackVec3[ea],aa.stackVec3[ea]=null}aa.stackVec3=oa}aa.stackVec3[aa.sizeVec3++]=Ji}}e=_}a=s}}_drawConstraints(t){var i=t.style;if(t.drawPairs||t.drawContacts)for(var a=this._contactManager._contactList;null!=a;){var s=a._next;if(t.drawPairs){var o=i.pairColor,n=this._pool,r=0==n.sizeVec3?new pa.common.Vec3:n.stackVec3[--n.sizeVec3],e=this._pool,_=0==e.sizeVec3?new pa.common.Vec3:e.stackVec3[--e.sizeVec3],h=r;h.x=a._s1._transform._positionX,h.y=a._s1._transform._positionY,h.z=a._s1._transform._positionZ;var l=_;l.x=a._s2._transform._positionX,l.y=a._s2._transform._positionY,l.z=a._s2._transform._positionZ,t.line(r,_,o);var c=this._pool;if(null!=r){if(r.zero(),c.sizeVec3==c.stackVec3.length){for(var m=c.sizeVec3<<1,v=new Array(m),b=0,x=c.sizeVec3;b<x;){var p=b++;v[p]=c.stackVec3[p],c.stackVec3[p]=null}c.stackVec3=v}c.stackVec3[c.sizeVec3++]=r}var f=this._pool;if(null!=_){if(_.zero(),f.sizeVec3==f.stackVec3.length){for(var u=f.sizeVec3<<1,y=new Array(u),d=0,g=f.sizeVec3;d<g;){var X=d++;y[X]=f.stackVec3[X],f.stackVec3[X]=null}f.stackVec3=y}f.stackVec3[f.sizeVec3++]=_}}if(t.drawContacts)for(var z=a._contactConstraint,Y=a._contactConstraint._manifold._points,Z=0,M=a._contactConstraint._manifold._numPoints;Z<M;){var I=Y[Z++],V=t.style;z._s1._transform,z._s2._transform;var w=this._pool,L=0==w.sizeVec3?new pa.common.Vec3:w.stackVec3[--w.sizeVec3],k=this._pool,B=0==k.sizeVec3?new pa.common.Vec3:k.stackVec3[--k.sizeVec3],A=this._pool,P=0==A.sizeVec3?new pa.common.Vec3:A.stackVec3[--A.sizeVec3],S=this._pool,T=0==S.sizeVec3?new pa.common.Vec3:S.stackVec3[--S.sizeVec3],C=this._pool,j=0==C.sizeVec3?new pa.common.Vec3:C.stackVec3[--C.sizeVec3],R=L;R.x=I._pos1X,R.y=I._pos1Y,R.z=I._pos1Z;var E=B;E.x=I._pos2X,E.y=I._pos2Y,E.z=I._pos2Z;var q=P;q.x=z._manifold._normalX,q.y=z._manifold._normalY,q.z=z._manifold._normalZ;var N=T;N.x=z._manifold._tangentX,N.y=z._manifold._tangentY,N.z=z._manifold._tangentZ;var F=j;if(F.x=z._manifold._binormalX,F.y=z._manifold._binormalY,F.z=z._manifold._binormalZ,I._disabled)t.point(L,V.disabledContactColor),t.point(B,V.disabledContactColor),t.line(L,B,V.disabledContactColor);else if(I._warmStarted){var D;switch(3&I._id){case 0:D=V.contactColor;break;case 1:D=V.contactColor2;break;case 2:D=V.contactColor3;break;default:D=V.contactColor4}t.point(L,D),t.point(B,D),t.line(L,B,V.contactColor)}else t.point(L,V.newContactColor),t.point(B,V.newContactColor),t.line(L,B,V.newContactColor);B.x=L.x,B.y=L.y,B.z=L.z;var G=B,W=V.contactNormalLength,J=G.x+P.x*W,U=G.y+P.y*W,O=G.z+P.z*W;if(G.x=J,G.y=U,G.z=O,t.line(L,B,V.contactNormalColor),t.drawContactBases){B.x=L.x,B.y=L.y,B.z=L.z;var H=B,Q=V.contactTangentLength,K=H.x+T.x*Q,$=H.y+T.y*Q,tt=H.z+T.z*Q;H.x=K,H.y=$,H.z=tt,t.line(L,B,V.contactTangentColor),B.x=L.x,B.y=L.y,B.z=L.z;var it=B,at=V.contactBinormalLength,st=it.x+j.x*at,ot=it.y+j.y*at,nt=it.z+j.z*at;it.x=st,it.y=ot,it.z=nt,t.line(L,B,V.contactBinormalColor)}var rt=this._pool;if(null!=L){if(L.zero(),rt.sizeVec3==rt.stackVec3.length){for(var et=rt.sizeVec3<<1,_t=new Array(et),ht=0,lt=rt.sizeVec3;ht<lt;){var ct=ht++;_t[ct]=rt.stackVec3[ct],rt.stackVec3[ct]=null}rt.stackVec3=_t}rt.stackVec3[rt.sizeVec3++]=L}var mt=this._pool;if(null!=B){if(B.zero(),mt.sizeVec3==mt.stackVec3.length){for(var vt=mt.sizeVec3<<1,bt=new Array(vt),xt=0,pt=mt.sizeVec3;xt<pt;){var ft=xt++;bt[ft]=mt.stackVec3[ft],mt.stackVec3[ft]=null}mt.stackVec3=bt}mt.stackVec3[mt.sizeVec3++]=B}var ut=this._pool;if(null!=P){if(P.zero(),ut.sizeVec3==ut.stackVec3.length){for(var yt=ut.sizeVec3<<1,dt=new Array(yt),gt=0,Xt=ut.sizeVec3;gt<Xt;){var zt=gt++;dt[zt]=ut.stackVec3[zt],ut.stackVec3[zt]=null}ut.stackVec3=dt}ut.stackVec3[ut.sizeVec3++]=P}var Yt=this._pool;if(null!=T){if(T.zero(),Yt.sizeVec3==Yt.stackVec3.length){for(var Zt=Yt.sizeVec3<<1,Mt=new Array(Zt),It=0,Vt=Yt.sizeVec3;It<Vt;){var wt=It++;Mt[wt]=Yt.stackVec3[wt],Yt.stackVec3[wt]=null}Yt.stackVec3=Mt}Yt.stackVec3[Yt.sizeVec3++]=T}var Lt=this._pool;if(null!=j){if(j.zero(),Lt.sizeVec3==Lt.stackVec3.length){for(var kt=Lt.sizeVec3<<1,Bt=new Array(kt),At=0,Pt=Lt.sizeVec3;At<Pt;){var St=At++;Bt[St]=Lt.stackVec3[St],Lt.stackVec3[St]=null}Lt.stackVec3=Bt}Lt.stackVec3[Lt.sizeVec3++]=j}}a=s}if(t.drawJoints)for(var Tt=this._jointList;null!=Tt;){var Ct=Tt._next,jt=this._pool,Rt=0==jt.sizeVec3?new pa.common.Vec3:jt.stackVec3[--jt.sizeVec3],Et=this._pool,qt=0==Et.sizeVec3?new pa.common.Vec3:Et.stackVec3[--Et.sizeVec3],Nt=Rt;Nt.x=Tt._b1._transform._positionX,Nt.y=Tt._b1._transform._positionY,Nt.z=Tt._b1._transform._positionZ;var Ft=qt;Ft.x=Tt._b2._transform._positionX,Ft.y=Tt._b2._transform._positionY,Ft.z=Tt._b2._transform._positionZ;var Dt=this._pool,Gt=0==Dt.sizeVec3?new pa.common.Vec3:Dt.stackVec3[--Dt.sizeVec3],Wt=this._pool,Jt=0==Wt.sizeVec3?new pa.common.Vec3:Wt.stackVec3[--Wt.sizeVec3],Ut=this._pool,Ot=0==Ut.sizeVec3?new pa.common.Vec3:Ut.stackVec3[--Ut.sizeVec3],Ht=this._pool,Qt=0==Ht.sizeVec3?new pa.common.Vec3:Ht.stackVec3[--Ht.sizeVec3],Kt=this._pool,$t=0==Kt.sizeVec3?new pa.common.Vec3:Kt.stackVec3[--Kt.sizeVec3],ti=this._pool,ii=0==ti.sizeVec3?new pa.common.Vec3:ti.stackVec3[--ti.sizeVec3],ai=this._pool,si=0==ai.sizeVec3?new pa.common.Vec3:ai.stackVec3[--ai.sizeVec3],oi=this._pool,ni=0==oi.sizeVec3?new pa.common.Vec3:oi.stackVec3[--oi.sizeVec3],ri=Gt;ri.x=Tt._anchor1X,ri.y=Tt._anchor1Y,ri.z=Tt._anchor1Z;var ei=Jt;ei.x=Tt._anchor2X,ei.y=Tt._anchor2Y,ei.z=Tt._anchor2Z;var _i=Ot;_i.x=Tt._basisX1X,_i.y=Tt._basisX1Y,_i.z=Tt._basisX1Z;var hi=Qt;hi.x=Tt._basisY1X,hi.y=Tt._basisY1Y,hi.z=Tt._basisY1Z;var li=$t;li.x=Tt._basisZ1X,li.y=Tt._basisZ1Y,li.z=Tt._basisZ1Z;var ci=ii;ci.x=Tt._basisX2X,ci.y=Tt._basisX2Y,ci.z=Tt._basisX2Z;var mi=si;mi.x=Tt._basisY2X,mi.y=Tt._basisY2Y,mi.z=Tt._basisY2Z;var vi=ni;if(vi.x=Tt._basisZ2X,vi.y=Tt._basisZ2Y,vi.z=Tt._basisZ2Z,t.line(Rt,Gt,t.style.jointLineColor),t.line(qt,Jt,t.style.jointLineColor),t.drawJointLimits)switch(Tt._type){case 0:break;case 1:var bi=t.style.jointRotationalConstraintRadius,xi=t.style.jointLineColor,pi=Tt._lm;this._drawRotationalLimit(t,Gt,Qt,$t,si,bi,pi.lowerLimit,pi.upperLimit,xi);break;case 2:var fi=Tt,ui=t.style.jointRotationalConstraintRadius,yi=t.style.jointLineColor,di=fi._rotLm,gi=fi._translLm;this._drawRotationalLimit(t,Jt,Qt,$t,si,ui,di.lowerLimit,di.upperLimit,yi),this._drawTranslationalLimit(t,Gt,Ot,gi.lowerLimit,gi.upperLimit,yi);break;case 3:t.style.jointRotationalConstraintRadius;var Xi=t.style.jointLineColor,zi=Tt._lm;this._drawTranslationalLimit(t,Gt,Ot,zi.lowerLimit,zi.upperLimit,Xi);break;case 4:var Yi=Tt,Zi=t.style.jointRotationalConstraintRadius,Mi=t.style.jointLineColor,Ii=Yi._lm1,Vi=Yi._lm2;this._drawRotationalLimit(t,Gt,Qt,$t,Qt,Zi,Yi._angleX-Ii.upperLimit,Yi._angleX-Ii.lowerLimit,Mi),this._drawRotationalLimit(t,Jt,ii,si,ii,Zi,Vi.lowerLimit-Yi._angleZ,Vi.upperLimit-Yi._angleZ,Mi);break;case 5:var wi=Tt,Li=t.style.jointRotationalConstraintRadius,ki=t.style.jointLineColor,Bi=wi._twistLm;this._drawRotationalLimit(t,Jt,si,ni,si,Li,Bi.lowerLimit-wi._twistAngle,Bi.upperLimit-wi._twistAngle,ki),this._drawEllipseOnSphere(t,Gt,Ot,Qt,$t,wi._maxSwingAngle1,wi._maxSwingAngle2,Li,ki);var Ai=this._pool,Pi=0==Ai.sizeVec3?new pa.common.Vec3:Ai.stackVec3[--Ai.sizeVec3];Pi.x=Jt.x,Pi.y=Jt.y,Pi.z=Jt.z;var Si=Pi,Ti=Si.x+ii.x*Li,Ci=Si.y+ii.y*Li,ji=Si.z+ii.z*Li;Si.x=Ti,Si.y=Ci,Si.z=ji;var Ri=Si;t.line(Jt,Ri,ki);var Ei=this._pool;if(null!=Ri){if(Ri.zero(),Ei.sizeVec3==Ei.stackVec3.length){for(var qi=Ei.sizeVec3<<1,Ni=new Array(qi),Fi=0,Di=Ei.sizeVec3;Fi<Di;){var Gi=Fi++;Ni[Gi]=Ei.stackVec3[Gi],Ei.stackVec3[Gi]=null}Ei.stackVec3=Ni}Ei.stackVec3[Ei.sizeVec3++]=Ri}break;case 6:var Wi=Tt,Ji=t.style.jointRotationalConstraintRadius,Ui=t.style.jointLineColor,Oi=Wi._translLms[0],Hi=Wi._translLms[1],Qi=Wi._translLms[2],Ki=Wi._rotLms[0],$i=Wi._rotLms[1],ta=Wi._rotLms[2];this._drawTranslationalLimit3D(t,Gt,Ot,Qt,$t,Oi,Hi,Qi,Ui);var ia=this._pool,aa=0==ia.sizeVec3?new pa.common.Vec3:ia.stackVec3[--ia.sizeVec3],sa=aa;sa.x=Wi._axisYX,sa.y=Wi._axisYY,sa.z=Wi._axisYZ;var oa=this._pool,na=0==oa.sizeVec3?new pa.common.Vec3:oa.stackVec3[--oa.sizeVec3];na.x=Ot.x,na.y=Ot.y,na.z=Ot.z;var ra=na,ea=this._pool,_a=0==ea.sizeVec3?new pa.common.Vec3:ea.stackVec3[--ea.sizeVec3];_a.x=Ot.x,_a.y=Ot.y,_a.z=Ot.z;var ha=_a,la=ha.y*aa.z-ha.z*aa.y,ca=ha.z*aa.x-ha.x*aa.z,ma=ha.x*aa.y-ha.y*aa.x;ha.x=la,ha.y=ca,ha.z=ma;var va=ha;this._drawRotationalLimit(t,Jt,Qt,$t,Qt,Ji,Wi._angleX-Ki.upperLimit,Wi._angleX-Ki.lowerLimit,Ui),this._drawRotationalLimit(t,Jt,ra,va,ra,Ji,$i.lowerLimit-Wi._angleY,$i.upperLimit-Wi._angleY,Ui),this._drawRotationalLimit(t,Jt,ii,si,ii,Ji,ta.lowerLimit-Wi._angleZ,ta.upperLimit-Wi._angleZ,Ui)}t.line(Gt,Jt,t.style.jointErrorColor);var ba=this._pool;if(null!=Rt){if(Rt.zero(),ba.sizeVec3==ba.stackVec3.length){for(var xa=ba.sizeVec3<<1,fa=new Array(xa),ua=0,ya=ba.sizeVec3;ua<ya;){var da=ua++;fa[da]=ba.stackVec3[da],ba.stackVec3[da]=null}ba.stackVec3=fa}ba.stackVec3[ba.sizeVec3++]=Rt}var ga=this._pool;if(null!=qt){if(qt.zero(),ga.sizeVec3==ga.stackVec3.length){for(var Xa=ga.sizeVec3<<1,za=new Array(Xa),Ya=0,Za=ga.sizeVec3;Ya<Za;){var Ma=Ya++;za[Ma]=ga.stackVec3[Ma],ga.stackVec3[Ma]=null}ga.stackVec3=za}ga.stackVec3[ga.sizeVec3++]=qt}var Ia=this._pool;if(null!=Gt){if(Gt.zero(),Ia.sizeVec3==Ia.stackVec3.length){for(var Va=Ia.sizeVec3<<1,wa=new Array(Va),La=0,ka=Ia.sizeVec3;La<ka;){var Ba=La++;wa[Ba]=Ia.stackVec3[Ba],Ia.stackVec3[Ba]=null}Ia.stackVec3=wa}Ia.stackVec3[Ia.sizeVec3++]=Gt}var Aa=this._pool;if(null!=Jt){if(Jt.zero(),Aa.sizeVec3==Aa.stackVec3.length){for(var Pa=Aa.sizeVec3<<1,Sa=new Array(Pa),Ta=0,Ca=Aa.sizeVec3;Ta<Ca;){var ja=Ta++;Sa[ja]=Aa.stackVec3[ja],Aa.stackVec3[ja]=null}Aa.stackVec3=Sa}Aa.stackVec3[Aa.sizeVec3++]=Jt}var Ra=this._pool;if(null!=Ot){if(Ot.zero(),Ra.sizeVec3==Ra.stackVec3.length){for(var Ea=Ra.sizeVec3<<1,qa=new Array(Ea),Na=0,Fa=Ra.sizeVec3;Na<Fa;){var Da=Na++;qa[Da]=Ra.stackVec3[Da],Ra.stackVec3[Da]=null}Ra.stackVec3=qa}Ra.stackVec3[Ra.sizeVec3++]=Ot}var Ga=this._pool;if(null!=Qt){if(Qt.zero(),Ga.sizeVec3==Ga.stackVec3.length){for(var Wa=Ga.sizeVec3<<1,Ja=new Array(Wa),Ua=0,Oa=Ga.sizeVec3;Ua<Oa;){var Ha=Ua++;Ja[Ha]=Ga.stackVec3[Ha],Ga.stackVec3[Ha]=null}Ga.stackVec3=Ja}Ga.stackVec3[Ga.sizeVec3++]=Qt}var Qa=this._pool;if(null!=$t){if($t.zero(),Qa.sizeVec3==Qa.stackVec3.length){for(var Ka=Qa.sizeVec3<<1,$a=new Array(Ka),ts=0,is=Qa.sizeVec3;ts<is;){var as=ts++;$a[as]=Qa.stackVec3[as],Qa.stackVec3[as]=null}Qa.stackVec3=$a}Qa.stackVec3[Qa.sizeVec3++]=$t}var ss=this._pool;if(null!=ii){if(ii.zero(),ss.sizeVec3==ss.stackVec3.length){for(var os=ss.sizeVec3<<1,ns=new Array(os),rs=0,es=ss.sizeVec3;rs<es;){var _s=rs++;ns[_s]=ss.stackVec3[_s],ss.stackVec3[_s]=null}ss.stackVec3=ns}ss.stackVec3[ss.sizeVec3++]=ii}var hs=this._pool;if(null!=si){if(si.zero(),hs.sizeVec3==hs.stackVec3.length){for(var ls=hs.sizeVec3<<1,cs=new Array(ls),ms=0,vs=hs.sizeVec3;ms<vs;){var bs=ms++;cs[bs]=hs.stackVec3[bs],hs.stackVec3[bs]=null}hs.stackVec3=cs}hs.stackVec3[hs.sizeVec3++]=si}var xs=this._pool;if(null!=ni){if(ni.zero(),xs.sizeVec3==xs.stackVec3.length){for(var ps=xs.sizeVec3<<1,fs=new Array(ps),us=0,ys=xs.sizeVec3;us<ys;){var ds=us++;fs[ds]=xs.stackVec3[ds],xs.stackVec3[ds]=null}xs.stackVec3=fs}xs.stackVec3[xs.sizeVec3++]=ni}Tt=Ct}}_drawRotationalLimit(t,i,a,s,o,n,r,e,_){if(r!=e){var h=this._pool,l=0==h.sizeVec3?new pa.common.Vec3:h.stackVec3[--h.sizeVec3];l.x=i.x,l.y=i.y,l.z=i.z;var c=l,m=c.x+o.x*n,v=c.y+o.y*n,b=c.z+o.z*n;c.x=m,c.y=v,c.z=b;var x=c;t.line(i,x,_);var p=this._pool;if(null!=x){if(x.zero(),p.sizeVec3==p.stackVec3.length){for(var f=p.sizeVec3<<1,u=new Array(f),y=0,d=p.sizeVec3;y<d;){var g=y++;u[g]=p.stackVec3[g],p.stackVec3[g]=null}p.stackVec3=u}p.stackVec3[p.sizeVec3++]=x}r>e?t.ellipse(i,a,s,n,n,_):t.arc(i,a,s,n,n,r,e,!0,_)}}_drawTranslationalLimit(t,i,a,s,o,n){if(s<o){var r=this._pool,e=0==r.sizeVec3?new pa.common.Vec3:r.stackVec3[--r.sizeVec3];e.x=i.x,e.y=i.y,e.z=i.z;var _=e,h=_.x+a.x*s,l=_.y+a.y*s,c=_.z+a.z*s;_.x=h,_.y=l,_.z=c;var m=_,v=this._pool,b=0==v.sizeVec3?new pa.common.Vec3:v.stackVec3[--v.sizeVec3];b.x=i.x,b.y=i.y,b.z=i.z;var x=b,p=x.x+a.x*o,f=x.y+a.y*o,u=x.z+a.z*o;x.x=p,x.y=f,x.z=u;var y=x;t.line(m,y,n);var d=this._pool;if(null!=m){if(m.zero(),d.sizeVec3==d.stackVec3.length){for(var g=d.sizeVec3<<1,X=new Array(g),z=0,Y=d.sizeVec3;z<Y;){var Z=z++;X[Z]=d.stackVec3[Z],d.stackVec3[Z]=null}d.stackVec3=X}d.stackVec3[d.sizeVec3++]=m}var M=this._pool;if(null!=y){if(y.zero(),M.sizeVec3==M.stackVec3.length){for(var I=M.sizeVec3<<1,V=new Array(I),w=0,L=M.sizeVec3;w<L;){var k=w++;V[k]=M.stackVec3[k],M.stackVec3[k]=null}M.stackVec3=V}M.stackVec3[M.sizeVec3++]=y}}}_drawTranslationalLimit3D(t,i,a,s,o,n,r,e,_){var h=n.lowerLimit,l=n.upperLimit,c=r.lowerLimit,m=r.upperLimit,v=e.lowerLimit,b=e.upperLimit,x=this._pool;0==x.sizeVec3?new pa.common.Vec3:x.stackVec3[--x.sizeVec3];var p=this._pool;0==p.sizeVec3?new pa.common.Vec3:p.stackVec3[--p.sizeVec3];var f=this._pool,u=0==f.sizeVec3?new pa.common.Vec3:f.stackVec3[--f.sizeVec3];u.x=i.x,u.y=i.y,u.z=i.z;var y=u,d=y.x+a.x*h,g=y.y+a.y*h,X=y.z+a.z*h;y.x=d,y.y=g,y.z=X;var z=y,Y=z.x+s.x*c,Z=z.y+s.y*c,M=z.z+s.z*c;z.x=Y,z.y=Z,z.z=M;var I=z,V=I.x+o.x*v,w=I.y+o.y*v,L=I.z+o.z*v;I.x=V,I.y=w,I.z=L;var k=I,B=this._pool,A=0==B.sizeVec3?new pa.common.Vec3:B.stackVec3[--B.sizeVec3];A.x=i.x,A.y=i.y,A.z=i.z;var P=A,S=P.x+a.x*h,T=P.y+a.y*h,C=P.z+a.z*h;P.x=S,P.y=T,P.z=C;var j=P,R=j.x+s.x*c,E=j.y+s.y*c,q=j.z+s.z*c;j.x=R,j.y=E,j.z=q;var N=j,F=N.x+o.x*b,D=N.y+o.y*b,G=N.z+o.z*b;N.x=F,N.y=D,N.z=G;var W=N,J=this._pool,U=0==J.sizeVec3?new pa.common.Vec3:J.stackVec3[--J.sizeVec3];U.x=i.x,U.y=i.y,U.z=i.z;var O=U,H=O.x+a.x*h,Q=O.y+a.y*h,K=O.z+a.z*h;O.x=H,O.y=Q,O.z=K;var $=O,tt=$.x+s.x*m,it=$.y+s.y*m,at=$.z+s.z*m;$.x=tt,$.y=it,$.z=at;var st=$,ot=st.x+o.x*v,nt=st.y+o.y*v,rt=st.z+o.z*v;st.x=ot,st.y=nt,st.z=rt;var et=st,_t=this._pool,ht=0==_t.sizeVec3?new pa.common.Vec3:_t.stackVec3[--_t.sizeVec3];ht.x=i.x,ht.y=i.y,ht.z=i.z;var lt=ht,ct=lt.x+a.x*h,mt=lt.y+a.y*h,vt=lt.z+a.z*h;lt.x=ct,lt.y=mt,lt.z=vt;var bt=lt,xt=bt.x+s.x*m,pt=bt.y+s.y*m,ft=bt.z+s.z*m;bt.x=xt,bt.y=pt,bt.z=ft;var ut=bt,yt=ut.x+o.x*b,dt=ut.y+o.y*b,gt=ut.z+o.z*b;ut.x=yt,ut.y=dt,ut.z=gt;var Xt=ut,zt=this._pool,Yt=0==zt.sizeVec3?new pa.common.Vec3:zt.stackVec3[--zt.sizeVec3];Yt.x=i.x,Yt.y=i.y,Yt.z=i.z;var Zt=Yt,Mt=Zt.x+a.x*l,It=Zt.y+a.y*l,Vt=Zt.z+a.z*l;Zt.x=Mt,Zt.y=It,Zt.z=Vt;var wt=Zt,Lt=wt.x+s.x*c,kt=wt.y+s.y*c,Bt=wt.z+s.z*c;wt.x=Lt,wt.y=kt,wt.z=Bt;var At=wt,Pt=At.x+o.x*v,St=At.y+o.y*v,Tt=At.z+o.z*v;At.x=Pt,At.y=St,At.z=Tt;var Ct=At,jt=this._pool,Rt=0==jt.sizeVec3?new pa.common.Vec3:jt.stackVec3[--jt.sizeVec3];Rt.x=i.x,Rt.y=i.y,Rt.z=i.z;var Et=Rt,qt=Et.x+a.x*l,Nt=Et.y+a.y*l,Ft=Et.z+a.z*l;Et.x=qt,Et.y=Nt,Et.z=Ft;var Dt=Et,Gt=Dt.x+s.x*c,Wt=Dt.y+s.y*c,Jt=Dt.z+s.z*c;Dt.x=Gt,Dt.y=Wt,Dt.z=Jt;var Ut=Dt,Ot=Ut.x+o.x*b,Ht=Ut.y+o.y*b,Qt=Ut.z+o.z*b;Ut.x=Ot,Ut.y=Ht,Ut.z=Qt;var Kt=Ut,$t=this._pool,ti=0==$t.sizeVec3?new pa.common.Vec3:$t.stackVec3[--$t.sizeVec3];ti.x=i.x,ti.y=i.y,ti.z=i.z;var ii=ti,ai=ii.x+a.x*l,si=ii.y+a.y*l,oi=ii.z+a.z*l;ii.x=ai,ii.y=si,ii.z=oi;var ni=ii,ri=ni.x+s.x*m,ei=ni.y+s.y*m,_i=ni.z+s.z*m;ni.x=ri,ni.y=ei,ni.z=_i;var hi=ni,li=hi.x+o.x*v,ci=hi.y+o.y*v,mi=hi.z+o.z*v;hi.x=li,hi.y=ci,hi.z=mi;var vi=hi,bi=this._pool,xi=0==bi.sizeVec3?new pa.common.Vec3:bi.stackVec3[--bi.sizeVec3];xi.x=i.x,xi.y=i.y,xi.z=i.z;var pi=xi,fi=pi.x+a.x*l,ui=pi.y+a.y*l,yi=pi.z+a.z*l;pi.x=fi,pi.y=ui,pi.z=yi;var di=pi,gi=di.x+s.x*m,Xi=di.y+s.y*m,zi=di.z+s.z*m;di.x=gi,di.y=Xi,di.z=zi;var Yi=di,Zi=Yi.x+o.x*b,Mi=Yi.y+o.y*b,Ii=Yi.z+o.z*b;Yi.x=Zi,Yi.y=Mi,Yi.z=Ii;var Vi=Yi;t.line(k,Ct,_),t.line(et,vi,_),t.line(W,Kt,_),t.line(Xt,Vi,_),t.line(k,et,_),t.line(Ct,vi,_),t.line(W,Xt,_),t.line(Kt,Vi,_),t.line(k,W,_),t.line(Ct,Kt,_),t.line(et,Xt,_),t.line(vi,Vi,_);var wi=this._pool;if(null!=k){if(k.zero(),wi.sizeVec3==wi.stackVec3.length){for(var Li=wi.sizeVec3<<1,ki=new Array(Li),Bi=0,Ai=wi.sizeVec3;Bi<Ai;){var Pi=Bi++;ki[Pi]=wi.stackVec3[Pi],wi.stackVec3[Pi]=null}wi.stackVec3=ki}wi.stackVec3[wi.sizeVec3++]=k}var Si=this._pool;if(null!=W){if(W.zero(),Si.sizeVec3==Si.stackVec3.length){for(var Ti=Si.sizeVec3<<1,Ci=new Array(Ti),ji=0,Ri=Si.sizeVec3;ji<Ri;){var Ei=ji++;Ci[Ei]=Si.stackVec3[Ei],Si.stackVec3[Ei]=null}Si.stackVec3=Ci}Si.stackVec3[Si.sizeVec3++]=W}var qi=this._pool;if(null!=et){if(et.zero(),qi.sizeVec3==qi.stackVec3.length){for(var Ni=qi.sizeVec3<<1,Fi=new Array(Ni),Di=0,Gi=qi.sizeVec3;Di<Gi;){var Wi=Di++;Fi[Wi]=qi.stackVec3[Wi],qi.stackVec3[Wi]=null}qi.stackVec3=Fi}qi.stackVec3[qi.sizeVec3++]=et}var Ji=this._pool;if(null!=Xt){if(Xt.zero(),Ji.sizeVec3==Ji.stackVec3.length){for(var Ui=Ji.sizeVec3<<1,Oi=new Array(Ui),Hi=0,Qi=Ji.sizeVec3;Hi<Qi;){var Ki=Hi++;Oi[Ki]=Ji.stackVec3[Ki],Ji.stackVec3[Ki]=null}Ji.stackVec3=Oi}Ji.stackVec3[Ji.sizeVec3++]=Xt}var $i=this._pool;if(null!=Ct){if(Ct.zero(),$i.sizeVec3==$i.stackVec3.length){for(var ta=$i.sizeVec3<<1,ia=new Array(ta),aa=0,sa=$i.sizeVec3;aa<sa;){var oa=aa++;ia[oa]=$i.stackVec3[oa],$i.stackVec3[oa]=null}$i.stackVec3=ia}$i.stackVec3[$i.sizeVec3++]=Ct}var na=this._pool;if(null!=Kt){if(Kt.zero(),na.sizeVec3==na.stackVec3.length){for(var ra=na.sizeVec3<<1,ea=new Array(ra),_a=0,ha=na.sizeVec3;_a<ha;){var la=_a++;ea[la]=na.stackVec3[la],na.stackVec3[la]=null}na.stackVec3=ea}na.stackVec3[na.sizeVec3++]=Kt}var ca=this._pool;if(null!=vi){if(vi.zero(),ca.sizeVec3==ca.stackVec3.length){for(var ma=ca.sizeVec3<<1,va=new Array(ma),ba=0,xa=ca.sizeVec3;ba<xa;){var fa=ba++;va[fa]=ca.stackVec3[fa],ca.stackVec3[fa]=null}ca.stackVec3=va}ca.stackVec3[ca.sizeVec3++]=vi}var ua=this._pool;if(null!=Vi){if(Vi.zero(),ua.sizeVec3==ua.stackVec3.length){for(var ya=ua.sizeVec3<<1,da=new Array(ya),ga=0,Xa=ua.sizeVec3;ga<Xa;){var za=ga++;da[za]=ua.stackVec3[za],ua.stackVec3[za]=null}ua.stackVec3=da}ua.stackVec3[ua.sizeVec3++]=Vi}}_drawEllipseOnSphere(t,i,a,s,o,n,r,e,_){for(var h=0,l=this._pool,c=0==l.sizeVec3?new pa.common.Vec3:l.stackVec3[--l.sizeVec3],m=this._pool,v=0==m.sizeQuat?new pa.common.Quat:m.stackQuat[--m.sizeQuat],b=this._pool,x=0==b.sizeMat3?new pa.common.Mat3:b.stackMat3[--b.sizeMat3],p=this._pool,f=0==p.sizeVec3?new pa.common.Vec3:p.stackVec3[--p.sizeVec3],u=0;u<17;){var y=u++,d=Math.cos(h)*n,g=Math.sin(h)*r,X=Math.sqrt(d*d+g*g),z=Math.sin(.5*X),Y=Math.cos(.5*X),Z=c.zero(),M=Z.x+s.x*d,I=Z.y+s.y*d,V=Z.z+s.z*d;Z.x=M,Z.y=I,Z.z=V;var w=Z,L=w.x+o.x*g,k=w.y+o.y*g,B=w.z+o.z*g;w.x=L,w.y=k,w.z=B;var A=1/X*z,P=c.x*A,S=c.y*A,T=c.z*A;c.x=P,c.y=S,c.z=T,v.x=c.x,v.y=c.y,v.z=c.z,v.w=Y;var C=v.x,j=v.y,R=v.z,E=v.w,q=2*C,N=2*j,F=2*R,D=C*q,G=j*N,W=R*F,J=C*N,U=j*F,O=C*F,H=E*q,Q=E*N,K=E*F;x.e00=1-G-W,x.e01=J-K,x.e02=O+Q,x.e10=J+K,x.e11=1-D-W,x.e12=U-H,x.e20=O-Q,x.e21=U+H,x.e22=1-D-G;var $=this._pool,tt=0==$.sizeVec3?new pa.common.Vec3:$.stackVec3[--$.sizeVec3],it=tt.x+a.x*e,at=tt.y+a.y*e,st=tt.z+a.z*e;tt.x=it,tt.y=at,tt.z=st;var ot=tt,nt=ot.x*x.e00+ot.y*x.e01+ot.z*x.e02,rt=ot.x*x.e10+ot.y*x.e11+ot.z*x.e12,et=ot.x*x.e20+ot.y*x.e21+ot.z*x.e22;ot.x=nt,ot.y=rt,ot.z=et;var _t=ot,ht=_t.x+i.x,lt=_t.y+i.y,ct=_t.z+i.z;_t.x=ht,_t.y=lt,_t.z=ct,y>=1&&t.line(f,ot,_);var mt=this._pool;if(null!=f){if(f.zero(),mt.sizeVec3==mt.stackVec3.length){for(var vt=mt.sizeVec3<<1,bt=new Array(vt),xt=0,pt=mt.sizeVec3;xt<pt;){var ft=xt++;bt[ft]=mt.stackVec3[ft],mt.stackVec3[ft]=null}mt.stackVec3=bt}mt.stackVec3[mt.sizeVec3++]=f}f=ot,h+=.39269908169872375}var ut=this._pool;if(null!=c){if(c.zero(),ut.sizeVec3==ut.stackVec3.length){for(var yt=ut.sizeVec3<<1,dt=new Array(yt),gt=0,Xt=ut.sizeVec3;gt<Xt;){var zt=gt++;dt[zt]=ut.stackVec3[zt],ut.stackVec3[zt]=null}ut.stackVec3=dt}ut.stackVec3[ut.sizeVec3++]=c}var Yt=this._pool;if(null!=v){if(v.x=0,v.y=0,v.z=0,v.w=1,Yt.sizeQuat==Yt.stackQuat.length){for(var Zt=Yt.sizeQuat<<1,Mt=new Array(Zt),It=0,Vt=Yt.sizeQuat;It<Vt;){var wt=It++;Mt[wt]=Yt.stackQuat[wt],Yt.stackQuat[wt]=null}Yt.stackQuat=Mt}Yt.stackQuat[Yt.sizeQuat++]=v}var Lt=this._pool;if(null!=x){if(x.e00=1,x.e01=0,x.e02=0,x.e10=0,x.e11=1,x.e12=0,x.e20=0,x.e21=0,x.e22=1,Lt.sizeMat3==Lt.stackMat3.length){for(var kt=Lt.sizeMat3<<1,Bt=new Array(kt),At=0,Pt=Lt.sizeMat3;At<Pt;){var St=At++;Bt[St]=Lt.stackMat3[St],Lt.stackMat3[St]=null}Lt.stackMat3=Bt}Lt.stackMat3[Lt.sizeMat3++]=x}var Tt=this._pool;if(null!=f){if(f.zero(),Tt.sizeVec3==Tt.stackVec3.length){for(var Ct=Tt.sizeVec3<<1,jt=new Array(Ct),Rt=0,Et=Tt.sizeVec3;Rt<Et;){var qt=Rt++;jt[qt]=Tt.stackVec3[qt],Tt.stackVec3[qt]=null}Tt.stackVec3=jt}Tt.stackVec3[Tt.sizeVec3++]=f}}step(t){this._timeStep.dt>0&&(this._timeStep.dtRatio=t/this._timeStep.dt),this._timeStep.dt=t,this._timeStep.invDt=1/t;var i=Date.now()/1e3;this._updateContacts(),this._solveIslands();var a=Date.now()/1e3;pa.dynamics.common.Performance.totalTime=1e3*(a-i)}addRigidBody(t){if(null!=t._world)throw new Error("A rigid body cannot belong to multiple worlds.");null==this._rigidBodyList?(this._rigidBodyList=t,this._rigidBodyListLast=t):(this._rigidBodyListLast._next=t,t._prev=this._rigidBodyListLast,this._rigidBodyListLast=t),t._world=this;for(var i=t._shapeList;null!=i;){var a=i._next;i._proxy=this._broadPhase.createProxy(i,i._aabb),i._id=this._shapeIdCount++,this._numShapes++,i=a}this._numRigidBodies++}removeRigidBody(t){if(t._world!=this)throw new Error("The rigid body doesn't belong to the world.");var i=t._prev,a=t._next;null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._rigidBodyList&&(this._rigidBodyList=this._rigidBodyList._next),t==this._rigidBodyListLast&&(this._rigidBodyListLast=this._rigidBodyListLast._prev),t._next=null,t._prev=null,t._world=null;for(var s=t._shapeList;null!=s;){var o=s._next;this._broadPhase.destroyProxy(s._proxy),s._proxy=null,s._id=-1;for(var n=s._rigidBody._contactLinkList;null!=n;){var r=n._next,e=n._contact;if(e._s1==s||e._s2==s){var _=n._other;_._sleeping=!1,_._sleepTime=0;var h=this._contactManager,l=e._prev,c=e._next;if(null!=l&&(l._next=c),null!=c&&(c._prev=l),e==h._contactList&&(h._contactList=h._contactList._next),e==h._contactListLast&&(h._contactListLast=h._contactListLast._prev),e._next=null,e._prev=null,e._touching){var m=e._s1._contactCallback,v=e._s2._contactCallback;m==v&&(v=null),null!=m&&m.endContact(e),null!=v&&v.endContact(e)}var b=e._link1._prev,x=e._link1._next;null!=b&&(b._next=x),null!=x&&(x._prev=b),e._link1==e._b1._contactLinkList&&(e._b1._contactLinkList=e._b1._contactLinkList._next),e._link1==e._b1._contactLinkListLast&&(e._b1._contactLinkListLast=e._b1._contactLinkListLast._prev),e._link1._next=null,e._link1._prev=null;var p=e._link2._prev,f=e._link2._next;null!=p&&(p._next=f),null!=f&&(f._prev=p),e._link2==e._b2._contactLinkList&&(e._b2._contactLinkList=e._b2._contactLinkList._next),e._link2==e._b2._contactLinkListLast&&(e._b2._contactLinkListLast=e._b2._contactLinkListLast._prev),e._link2._next=null,e._link2._prev=null,e._b1._numContactLinks--,e._b2._numContactLinks--,e._link1._other=null,e._link2._other=null,e._link1._contact=null,e._link2._contact=null,e._s1=null,e._s2=null,e._b1=null,e._b2=null,e._touching=!1,e._cachedDetectorData._clear(),e._manifold._clear(),e._detector=null;var u=e._contactConstraint;u._s1=null,u._s2=null,u._b1=null,u._b2=null,u._tf1=null,u._tf2=null,e._next=h._contactPool,h._contactPool=e,h._numContacts--}n=r}this._numShapes--,s=o}this._numRigidBodies--}addJoint(t){if(null!=t._world)throw new Error("A joint cannot belong to multiple worlds.");null==this._jointList?(this._jointList=t,this._jointListLast=t):(this._jointListLast._next=t,t._prev=this._jointListLast,this._jointListLast=t),t._world=this,t._link1._other=t._b2,t._link2._other=t._b1,null==t._b1._jointLinkList?(t._b1._jointLinkList=t._link1,t._b1._jointLinkListLast=t._link1):(t._b1._jointLinkListLast._next=t._link1,t._link1._prev=t._b1._jointLinkListLast,t._b1._jointLinkListLast=t._link1),null==t._b2._jointLinkList?(t._b2._jointLinkList=t._link2,t._b2._jointLinkListLast=t._link2):(t._b2._jointLinkListLast._next=t._link2,t._link2._prev=t._b2._jointLinkListLast,t._b2._jointLinkListLast=t._link2),t._b1._numJointLinks++,t._b2._numJointLinks++;var i=t._b1;i._sleeping=!1,i._sleepTime=0;var a=t._b2;a._sleeping=!1,a._sleepTime=0,t._syncAnchors(),this._numJoints++}removeJoint(t){if(t._world!=this)throw new Error("The joint doesn't belong to the world.");var i=t._prev,a=t._next;null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._jointList&&(this._jointList=this._jointList._next),t==this._jointListLast&&(this._jointListLast=this._jointListLast._prev),t._next=null,t._prev=null,t._world=null;var s=t._link1._prev,o=t._link1._next;null!=s&&(s._next=o),null!=o&&(o._prev=s),t._link1==t._b1._jointLinkList&&(t._b1._jointLinkList=t._b1._jointLinkList._next),t._link1==t._b1._jointLinkListLast&&(t._b1._jointLinkListLast=t._b1._jointLinkListLast._prev),t._link1._next=null,t._link1._prev=null;var n=t._link2._prev,r=t._link2._next;null!=n&&(n._next=r),null!=r&&(r._prev=n),t._link2==t._b2._jointLinkList&&(t._b2._jointLinkList=t._b2._jointLinkList._next),t._link2==t._b2._jointLinkListLast&&(t._b2._jointLinkListLast=t._b2._jointLinkListLast._prev),t._link2._next=null,t._link2._prev=null,t._link1._other=null,t._link2._other=null,t._b1._numJointLinks--,t._b2._numJointLinks--;var e=t._b1;e._sleeping=!1,e._sleepTime=0;var _=t._b2;_._sleeping=!1,_._sleepTime=0,this._numJoints--}setDebugDraw(t){this._debugDraw=t}getDebugDraw(){return this._debugDraw}debugDraw(){if(null!=this._debugDraw){if(2==this._broadPhase._type){var t=this._broadPhase;this._drawBvh(this._debugDraw,t._tree)}this._drawRigidBodies(this._debugDraw),this._drawConstraints(this._debugDraw)}}rayCast(t,i,a){var s=this._rayCastWrapper.begin;s.x=t.x,s.y=t.y,s.z=t.z;var o=this._rayCastWrapper.end;o.x=i.x,o.y=i.y,o.z=i.z,this._rayCastWrapper.callback=a,this._broadPhase.rayCast(t,i,this._rayCastWrapper)}convexCast(t,i,a,s){this._convexCastWrapper.convex=t;var o=this._convexCastWrapper.begin;o._positionX=i._positionX,o._positionY=i._positionY,o._positionZ=i._positionZ,o._rotation00=i._rotation00,o._rotation01=i._rotation01,o._rotation02=i._rotation02,o._rotation10=i._rotation10,o._rotation11=i._rotation11,o._rotation12=i._rotation12,o._rotation20=i._rotation20,o._rotation21=i._rotation21,o._rotation22=i._rotation22;var n=this._convexCastWrapper.translation;n.x=a.x,n.y=a.y,n.z=a.z,this._convexCastWrapper.callback=s,this._broadPhase.convexCast(t,i,a,this._convexCastWrapper)}aabbTest(t,i){this._aabbTestWrapper._aabb.copyFrom(t),this._aabbTestWrapper._callback=i,this._broadPhase.aabbTest(t,this._aabbTestWrapper)}getRigidBodyList(){return this._rigidBodyList}getJointList(){return this._jointList}getBroadPhase(){return this._broadPhase}getContactManager(){return this._contactManager}getNumRigidBodies(){return this._numRigidBodies}getNumJoints(){return this._numJoints}getNumShapes(){return this._numShapes}getNumIslands(){return this._numIslands}getNumVelocityIterations(){return this._numVelocityIterations}setNumVelocityIterations(t){this._numVelocityIterations=t}getNumPositionIterations(){return this._numPositionIterations}setNumPositionIterations(t){this._numPositionIterations=t}getGravity(){return this._gravity}setGravity(t){var i=this._gravity;i.x=t.x,i.y=t.y,i.z=t.z}},pa.dynamics._World||(pa.dynamics._World={}),pa.dynamics._World.RayCastWrapper=class extends pa.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new pa.collision.geometry.RayCastHit,this.begin=new pa.common.Vec3,this.end=new pa.common.Vec3,this.callback=null}process(t){var i=t.userData;i._geom.rayCast(this.begin,this.end,i._transform,this.rayCastHit)&&this.callback.process(i,this.rayCastHit)}},pa.dynamics._World.ConvexCastWrapper=class extends pa.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new pa.collision.geometry.RayCastHit,this.begin=new pa.common.Transform,this.translation=new pa.common.Vec3,this.zero=new pa.common.Vec3,this.callback=null,this.convex=null}process(t){var i=t.userData,a=i._geom._type;if(!(a<0||a>5)){var s=i._geom;pa.collision.narrowphase.detector.gjkepa.GjkEpa.instance.convexCast(this.convex,s,this.begin,i._transform,this.translation,this.zero,this.rayCastHit)&&this.callback.process(i,this.rayCastHit)}}},pa.dynamics._World.AabbTestWrapper=class extends pa.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this._aabb=new pa.collision.geometry.Aabb,this._callback=null}process(t){var i=t.userData,a=i._aabb;a._minX<this._aabb._maxX&&a._maxX>this._aabb._minX&&a._minY<this._aabb._maxY&&a._maxY>this._aabb._minY&&a._minZ<this._aabb._maxZ&&a._maxZ>this._aabb._minZ&&this._callback.process(i)}},pa.dynamics.callback||(pa.dynamics.callback={}),pa.dynamics.callback.AabbTestCallback=class{constructor(){}process(t){}},pa.dynamics.callback.ContactCallback=class{constructor(){}beginContact(t){}preSolve(t){}postSolve(t){}endContact(t){}},pa.dynamics.callback.RayCastCallback=class{constructor(){}process(t,i){}},pa.dynamics.callback.RayCastClosest=class extends pa.dynamics.callback.RayCastCallback{constructor(){super(),this.position=new pa.common.Vec3,this.normal=new pa.common.Vec3,this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}clear(){this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}process(t,i){if(i.fraction<this.fraction){this.shape=t,this.hit=!0,this.fraction=i.fraction;var a=this.position,s=i.position;a.x=s.x,a.y=s.y,a.z=s.z;var o=this.normal,n=i.normal;o.x=n.x,o.y=n.y,o.z=n.z}}},pa.dynamics.common||(pa.dynamics.common={}),pa.dynamics.common.DebugDraw=class{constructor(){this.p=new pa.common.Pool,this.wireframe=!1,this.drawShapes=!0,this.drawBvh=!1,this.drawBvhMinLevel=0,this.drawBvhMaxLevel=65536,this.drawAabbs=!1,this.drawBases=!1,this.drawPairs=!1,this.drawContacts=!1,this.drawJoints=!0,this.drawJointLimits=!1;var t=new Array(5);this.sphereCoords=t;var i=new Array(5);this.tmpSphereVerts=i;var a=new Array(5);this.tmpSphereNorms=a;for(var s=0;s<5;){var o=s++,n=0==o||4==o?1:8,r=this.sphereCoords,e=new Array(n);r[o]=e;var _=this.tmpSphereVerts,h=new Array(n);_[o]=h;var l=this.tmpSphereNorms,c=new Array(n);l[o]=c;for(var m=0;m<8;){var v=m++,b=.7853981633974475*o,x=.7853981633974475*v;this.sphereCoords[o][v]=new pa.common.Vec3(Math.sin(b)*Math.cos(x),Math.cos(b),-Math.sin(b)*Math.sin(x)),this.tmpSphereVerts[o][v]=new pa.common.Vec3,this.tmpSphereNorms[o][v]=new pa.common.Vec3}}var p=new Array(8);this.circleCoords=p;var f=new Array(8);this.circleCoordsShift=f;var u=new Array(8);this.tmpCircleVerts1=u;var y=new Array(8);this.tmpCircleVerts2=y;var d=new Array(8);this.tmpCircleNorms=d;for(var g=.7853981633974475,X=0;X<8;){var z=X++;this.circleCoords[z]=new pa.common.Vec3(Math.cos(z*g),0,-Math.sin(z*g)),this.circleCoordsShift[z]=new pa.common.Vec3(Math.cos((z+.5)*g),0,-Math.sin((z+.5)*g)),this.tmpCircleVerts1[z]=new pa.common.Vec3,this.tmpCircleVerts2[z]=new pa.common.Vec3,this.tmpCircleNorms[z]=new pa.common.Vec3}this.style=new pa.dynamics.common.DebugDrawStyle}aabb(t,i,a){var s=this.p,o=(0==s.sizeVec3?new pa.common.Vec3:s.stackVec3[--s.sizeVec3]).init(t.x,t.y,t.z),n=this.p,r=(0==n.sizeVec3?new pa.common.Vec3:n.stackVec3[--n.sizeVec3]).init(t.x,t.y,i.z),e=this.p,_=(0==e.sizeVec3?new pa.common.Vec3:e.stackVec3[--e.sizeVec3]).init(t.x,i.y,t.z),h=this.p,l=(0==h.sizeVec3?new pa.common.Vec3:h.stackVec3[--h.sizeVec3]).init(t.x,i.y,i.z),c=this.p,m=(0==c.sizeVec3?new pa.common.Vec3:c.stackVec3[--c.sizeVec3]).init(i.x,t.y,t.z),v=this.p,b=(0==v.sizeVec3?new pa.common.Vec3:v.stackVec3[--v.sizeVec3]).init(i.x,t.y,i.z),x=this.p,p=(0==x.sizeVec3?new pa.common.Vec3:x.stackVec3[--x.sizeVec3]).init(i.x,i.y,t.z),f=this.p,u=(0==f.sizeVec3?new pa.common.Vec3:f.stackVec3[--f.sizeVec3]).init(i.x,i.y,i.z);this.line(o,r,a),this.line(_,l,a),this.line(m,b,a),this.line(p,u,a),this.line(o,_,a),this.line(r,l,a),this.line(m,p,a),this.line(b,u,a),this.line(o,m,a),this.line(r,b,a),this.line(_,p,a),this.line(l,u,a);var y=this.p;if(null!=o){if(o.zero(),y.sizeVec3==y.stackVec3.length){for(var d=y.sizeVec3<<1,g=new Array(d),X=0,z=y.sizeVec3;X<z;){var Y=X++;g[Y]=y.stackVec3[Y],y.stackVec3[Y]=null}y.stackVec3=g}y.stackVec3[y.sizeVec3++]=o}var Z=this.p;if(null!=r){if(r.zero(),Z.sizeVec3==Z.stackVec3.length){for(var M=Z.sizeVec3<<1,I=new Array(M),V=0,w=Z.sizeVec3;V<w;){var L=V++;I[L]=Z.stackVec3[L],Z.stackVec3[L]=null}Z.stackVec3=I}Z.stackVec3[Z.sizeVec3++]=r}var k=this.p;if(null!=_){if(_.zero(),k.sizeVec3==k.stackVec3.length){for(var B=k.sizeVec3<<1,A=new Array(B),P=0,S=k.sizeVec3;P<S;){var T=P++;A[T]=k.stackVec3[T],k.stackVec3[T]=null}k.stackVec3=A}k.stackVec3[k.sizeVec3++]=_}var C=this.p;if(null!=l){if(l.zero(),C.sizeVec3==C.stackVec3.length){for(var j=C.sizeVec3<<1,R=new Array(j),E=0,q=C.sizeVec3;E<q;){var N=E++;R[N]=C.stackVec3[N],C.stackVec3[N]=null}C.stackVec3=R}C.stackVec3[C.sizeVec3++]=l}var F=this.p;if(null!=m){if(m.zero(),F.sizeVec3==F.stackVec3.length){for(var D=F.sizeVec3<<1,G=new Array(D),W=0,J=F.sizeVec3;W<J;){var U=W++;G[U]=F.stackVec3[U],F.stackVec3[U]=null}F.stackVec3=G}F.stackVec3[F.sizeVec3++]=m}var O=this.p;if(null!=b){if(b.zero(),O.sizeVec3==O.stackVec3.length){for(var H=O.sizeVec3<<1,Q=new Array(H),K=0,$=O.sizeVec3;K<$;){var tt=K++;Q[tt]=O.stackVec3[tt],O.stackVec3[tt]=null}O.stackVec3=Q}O.stackVec3[O.sizeVec3++]=b}var it=this.p;if(null!=p){if(p.zero(),it.sizeVec3==it.stackVec3.length){for(var at=it.sizeVec3<<1,st=new Array(at),ot=0,nt=it.sizeVec3;ot<nt;){var rt=ot++;st[rt]=it.stackVec3[rt],it.stackVec3[rt]=null}it.stackVec3=st}it.stackVec3[it.sizeVec3++]=p}var et=this.p;if(null!=u){if(u.zero(),et.sizeVec3==et.stackVec3.length){for(var _t=et.sizeVec3<<1,ht=new Array(_t),lt=0,ct=et.sizeVec3;lt<ct;){var mt=lt++;ht[mt]=et.stackVec3[mt],et.stackVec3[mt]=null}et.stackVec3=ht}et.stackVec3[et.sizeVec3++]=u}}basis(t,i,a,s,o){var n=this.p,r=0==n.sizeVec3?new pa.common.Vec3:n.stackVec3[--n.sizeVec3],e=this.p,_=0==e.sizeMat3?new pa.common.Mat3:e.stackMat3[--e.sizeMat3],h=this.p,l=0==h.sizeVec3?new pa.common.Vec3:h.stackVec3[--h.sizeVec3],c=this.p,m=0==c.sizeVec3?new pa.common.Vec3:c.stackVec3[--c.sizeVec3],v=this.p,b=0==v.sizeVec3?new pa.common.Vec3:v.stackVec3[--v.sizeVec3],x=r;x.x=t._positionX,x.y=t._positionY,x.z=t._positionZ;var p=_;p.e00=t._rotation00,p.e01=t._rotation01,p.e02=t._rotation02,p.e10=t._rotation10,p.e11=t._rotation11,p.e12=t._rotation12,p.e20=t._rotation20,p.e21=t._rotation21,p.e22=t._rotation22,l.init(_.e00,_.e10,_.e20),m.init(_.e01,_.e11,_.e21),b.init(_.e02,_.e12,_.e22);var f=l.x*i,u=l.y*i,y=l.z*i;l.x=f,l.y=u,l.z=y;var d=l,g=d.x+r.x,X=d.y+r.y,z=d.z+r.z;d.x=g,d.y=X,d.z=z;var Y=m.x*i,Z=m.y*i,M=m.z*i;m.x=Y,m.y=Z,m.z=M;var I=m,V=I.x+r.x,w=I.y+r.y,L=I.z+r.z;I.x=V,I.y=w,I.z=L;var k=b.x*i,B=b.y*i,A=b.z*i;b.x=k,b.y=B,b.z=A;var P=b,S=P.x+r.x,T=P.y+r.y,C=P.z+r.z;P.x=S,P.y=T,P.z=C,this.line(r,l,a),this.line(r,m,s),this.line(r,b,o);var j=this.p;if(null!=r){if(r.zero(),j.sizeVec3==j.stackVec3.length){for(var R=j.sizeVec3<<1,E=new Array(R),q=0,N=j.sizeVec3;q<N;){var F=q++;E[F]=j.stackVec3[F],j.stackVec3[F]=null}j.stackVec3=E}j.stackVec3[j.sizeVec3++]=r}var D=this.p;if(null!=_){if(_.e00=1,_.e01=0,_.e02=0,_.e10=0,_.e11=1,_.e12=0,_.e20=0,_.e21=0,_.e22=1,D.sizeMat3==D.stackMat3.length){for(var G=D.sizeMat3<<1,W=new Array(G),J=0,U=D.sizeMat3;J<U;){var O=J++;W[O]=D.stackMat3[O],D.stackMat3[O]=null}D.stackMat3=W}D.stackMat3[D.sizeMat3++]=_}var H=this.p;if(null!=l){if(l.zero(),H.sizeVec3==H.stackVec3.length){for(var Q=H.sizeVec3<<1,K=new Array(Q),$=0,tt=H.sizeVec3;$<tt;){var it=$++;K[it]=H.stackVec3[it],H.stackVec3[it]=null}H.stackVec3=K}H.stackVec3[H.sizeVec3++]=l}var at=this.p;if(null!=m){if(m.zero(),at.sizeVec3==at.stackVec3.length){for(var st=at.sizeVec3<<1,ot=new Array(st),nt=0,rt=at.sizeVec3;nt<rt;){var et=nt++;ot[et]=at.stackVec3[et],at.stackVec3[et]=null}at.stackVec3=ot}at.stackVec3[at.sizeVec3++]=m}var _t=this.p;if(null!=b){if(b.zero(),_t.sizeVec3==_t.stackVec3.length){for(var ht=_t.sizeVec3<<1,lt=new Array(ht),ct=0,mt=_t.sizeVec3;ct<mt;){var vt=ct++;lt[vt]=_t.stackVec3[vt],_t.stackVec3[vt]=null}_t.stackVec3=lt}_t.stackVec3[_t.sizeVec3++]=b}}ellipse(t,i,a,s,o,n){this.arc(t,i,a,s,o,0,6.28318530717958,!1,n)}arc(t,i,a,s,o,n,r,e,_){var h=this.p,l=0==h.sizeVec3?new pa.common.Vec3:h.stackVec3[--h.sizeVec3];l.x=i.x,l.y=i.y,l.z=i.z;var c=l,m=c.x*s,v=c.y*s,b=c.z*s;c.x=m,c.y=v,c.z=b,i=c;var x=this.p,p=0==x.sizeVec3?new pa.common.Vec3:x.stackVec3[--x.sizeVec3];p.x=a.x,p.y=a.y,p.z=a.z;var f=p,u=f.x*o,y=f.y*o,d=f.z*o;f.x=u,f.y=y,f.z=d,a=f;var g=r-n;g<0&&(g=-g);var X=g/.5235987755982984+.5|0;0==X&&(X=1);var z=n,Y=(r-n)/X,Z=this.p,M=0==Z.sizeVec3?new pa.common.Vec3:Z.stackVec3[--Z.sizeVec3];M.x=t.x,M.y=t.y,M.z=t.z;var I=M,V=Math.cos(z),w=I.x+i.x*V,L=I.y+i.y*V,k=I.z+i.z*V;I.x=w,I.y=L,I.z=k;var B=I,A=Math.sin(z),P=B.x+a.x*A,S=B.y+a.y*A,T=B.z+a.z*A;B.x=P,B.y=S,B.z=T;var C=B;e&&this.line(t,C,_);for(var j=0,R=X;j<R;){j++,z+=Y;var E=this.p,q=0==E.sizeVec3?new pa.common.Vec3:E.stackVec3[--E.sizeVec3];q.x=t.x,q.y=t.y,q.z=t.z;var N=q,F=Math.cos(z),D=N.x+i.x*F,G=N.y+i.y*F,W=N.z+i.z*F;N.x=D,N.y=G,N.z=W;var J=N,U=Math.sin(z),O=J.x+a.x*U,H=J.y+a.y*U,Q=J.z+a.z*U;J.x=O,J.y=H,J.z=Q;var K=J;this.line(C,K,_);var $=this.p;if(null!=C){if(C.zero(),$.sizeVec3==$.stackVec3.length){for(var tt=$.sizeVec3<<1,it=new Array(tt),at=0,st=$.sizeVec3;at<st;){var ot=at++;it[ot]=$.stackVec3[ot],$.stackVec3[ot]=null}$.stackVec3=it}$.stackVec3[$.sizeVec3++]=C}C=K}e&&this.line(t,C,_);var nt=this.p;if(null!=C){if(C.zero(),nt.sizeVec3==nt.stackVec3.length){for(var rt=nt.sizeVec3<<1,et=new Array(rt),_t=0,ht=nt.sizeVec3;_t<ht;){var lt=_t++;et[lt]=nt.stackVec3[lt],nt.stackVec3[lt]=null}nt.stackVec3=et}nt.stackVec3[nt.sizeVec3++]=C}var ct=this.p;if(null!=i){if(i.zero(),ct.sizeVec3==ct.stackVec3.length){for(var mt=ct.sizeVec3<<1,vt=new Array(mt),bt=0,xt=ct.sizeVec3;bt<xt;){var pt=bt++;vt[pt]=ct.stackVec3[pt],ct.stackVec3[pt]=null}ct.stackVec3=vt}ct.stackVec3[ct.sizeVec3++]=i}var ft=this.p;if(null!=a){if(a.zero(),ft.sizeVec3==ft.stackVec3.length){for(var ut=ft.sizeVec3<<1,yt=new Array(ut),dt=0,gt=ft.sizeVec3;dt<gt;){var Xt=dt++;yt[Xt]=ft.stackVec3[Xt],ft.stackVec3[Xt]=null}ft.stackVec3=yt}ft.stackVec3[ft.sizeVec3++]=a}}cone(t,i,a,s){var o=this.p,n=0==o.sizeVec3?new pa.common.Vec3:o.stackVec3[--o.sizeVec3],r=this.p,e=0==r.sizeVec3?new pa.common.Vec3:r.stackVec3[--r.sizeVec3],_=this.p,h=0==_.sizeVec3?new pa.common.Vec3:_.stackVec3[--_.sizeVec3],l=this.p,c=0==l.sizeVec3?new pa.common.Vec3:l.stackVec3[--l.sizeVec3],m=this.p,v=0==m.sizeMat3?new pa.common.Mat3:m.stackMat3[--m.sizeMat3],b=c;b.x=t._positionX,b.y=t._positionY,b.z=t._positionZ;var x=v;x.e00=t._rotation00,x.e01=t._rotation01,x.e02=t._rotation02,x.e10=t._rotation10,x.e11=t._rotation11,x.e12=t._rotation12,x.e20=t._rotation20,x.e21=t._rotation21,x.e22=t._rotation22,n.init(v.e00,v.e10,v.e20),e.init(v.e01,v.e11,v.e21),h.init(v.e02,v.e12,v.e22);var p=this.p,f=0==p.sizeVec3?new pa.common.Vec3:p.stackVec3[--p.sizeVec3];f.x=c.x,f.y=c.y,f.z=c.z;var u=f,y=u.x+e.x*a,d=u.y+e.y*a,g=u.z+e.z*a;u.x=y,u.y=d,u.z=g;var X=u,z=this.p,Y=0==z.sizeVec3?new pa.common.Vec3:z.stackVec3[--z.sizeVec3];Y.x=c.x,Y.y=c.y,Y.z=c.z;var Z=Y,M=-a,I=Z.x+e.x*M,V=Z.y+e.y*M,w=Z.z+e.z*M;Z.x=I,Z.y=V,Z.z=w;var L=Z;if(this.wireframe){var k=this.p,B=0==k.sizeVec3?new pa.common.Vec3:k.stackVec3[--k.sizeVec3];B.x=L.x,B.y=L.y,B.z=L.z;var A=B,P=-i,S=A.x+n.x*P,T=A.y+n.y*P,C=A.z+n.z*P;A.x=S,A.y=T,A.z=C;var j=A,R=j.x+0*h.x,E=j.y+0*h.y,q=j.z+0*h.z;j.x=R,j.y=E,j.z=q;var N=j,F=this.p,D=0==F.sizeVec3?new pa.common.Vec3:F.stackVec3[--F.sizeVec3];D.x=L.x,D.y=L.y,D.z=L.z;var G=D,W=G.x+n.x*i,J=G.y+n.y*i,U=G.z+n.z*i;G.x=W,G.y=J,G.z=U;var O=G,H=O.x+0*h.x,Q=O.y+0*h.y,K=O.z+0*h.z;O.x=H,O.y=Q,O.z=K;var $=O,tt=this.p,it=0==tt.sizeVec3?new pa.common.Vec3:tt.stackVec3[--tt.sizeVec3];it.x=L.x,it.y=L.y,it.z=L.z;var at=it,st=at.x+0*n.x,ot=at.y+0*n.y,nt=at.z+0*n.z;at.x=st,at.y=ot,at.z=nt;var rt=at,et=-i,_t=rt.x+h.x*et,ht=rt.y+h.y*et,lt=rt.z+h.z*et;rt.x=_t,rt.y=ht,rt.z=lt;var ct=rt,mt=this.p,vt=0==mt.sizeVec3?new pa.common.Vec3:mt.stackVec3[--mt.sizeVec3];vt.x=L.x,vt.y=L.y,vt.z=L.z;var bt=vt,xt=bt.x+0*n.x,pt=bt.y+0*n.y,ft=bt.z+0*n.z;bt.x=xt,bt.y=pt,bt.z=ft;var ut=bt,yt=ut.x+h.x*i,dt=ut.y+h.y*i,gt=ut.z+h.z*i;ut.x=yt,ut.y=dt,ut.z=gt;var Xt=ut;this.ellipse(L,n,h,i,i,s),this.line(X,N,s),this.line(X,$,s),this.line(X,ct,s),this.line(X,Xt,s);var zt=this.p;if(null!=N){if(N.zero(),zt.sizeVec3==zt.stackVec3.length){for(var Yt=zt.sizeVec3<<1,Zt=new Array(Yt),Mt=0,It=zt.sizeVec3;Mt<It;){var Vt=Mt++;Zt[Vt]=zt.stackVec3[Vt],zt.stackVec3[Vt]=null}zt.stackVec3=Zt}zt.stackVec3[zt.sizeVec3++]=N}var wt=this.p;if(null!=$){if($.zero(),wt.sizeVec3==wt.stackVec3.length){for(var Lt=wt.sizeVec3<<1,kt=new Array(Lt),Bt=0,At=wt.sizeVec3;Bt<At;){var Pt=Bt++;kt[Pt]=wt.stackVec3[Pt],wt.stackVec3[Pt]=null}wt.stackVec3=kt}wt.stackVec3[wt.sizeVec3++]=$}var St=this.p;if(null!=ct){if(ct.zero(),St.sizeVec3==St.stackVec3.length){for(var Tt=St.sizeVec3<<1,Ct=new Array(Tt),jt=0,Rt=St.sizeVec3;jt<Rt;){var Et=jt++;Ct[Et]=St.stackVec3[Et],St.stackVec3[Et]=null}St.stackVec3=Ct}St.stackVec3[St.sizeVec3++]=ct}var qt=this.p;if(null!=Xt){if(Xt.zero(),qt.sizeVec3==qt.stackVec3.length){for(var Nt=qt.sizeVec3<<1,Ft=new Array(Nt),Dt=0,Gt=qt.sizeVec3;Dt<Gt;){var Wt=Dt++;Ft[Wt]=qt.stackVec3[Wt],qt.stackVec3[Wt]=null}qt.stackVec3=Ft}qt.stackVec3[qt.sizeVec3++]=Xt}}else{for(var Jt=1/Math.sqrt(i*i+4*a*a),Ut=2*a*Jt,Ot=i*Jt,Ht=0;Ht<8;){var Qt=Ht++,Kt=this.tmpCircleNorms[Qt],$t=this.circleCoords[Qt];Kt.x=$t.x,Kt.y=$t.y,Kt.z=$t.z;var ti=Kt,ii=ti.x*Ut,ai=ti.y*Ut,si=ti.z*Ut;ti.x=ii,ti.y=ai,ti.z=si,ti.y+=Ot;var oi=this.tmpCircleNorms[Qt],ni=oi.x*v.e00+oi.y*v.e01+oi.z*v.e02,ri=oi.x*v.e10+oi.y*v.e11+oi.z*v.e12,ei=oi.x*v.e20+oi.y*v.e21+oi.z*v.e22;oi.x=ni,oi.y=ri,oi.z=ei;var _i=this.tmpCircleVerts1[Qt],hi=this.circleCoordsShift[Qt];_i.x=hi.x,_i.y=hi.y,_i.z=hi.z;var li=_i,ci=li.x*Ut,mi=li.y*Ut,vi=li.z*Ut;li.x=ci,li.y=mi,li.z=vi,li.y+=Ot;var bi=this.tmpCircleVerts1[Qt],xi=bi.x*v.e00+bi.y*v.e01+bi.z*v.e02,pi=bi.x*v.e10+bi.y*v.e11+bi.z*v.e12,fi=bi.x*v.e20+bi.y*v.e21+bi.z*v.e22;bi.x=xi,bi.y=pi,bi.z=fi;var ui=this.tmpCircleVerts2[Qt],yi=this.circleCoords[Qt];ui.x=yi.x,ui.y=yi.y,ui.z=yi.z;var di=ui,gi=di.x*v.e00+di.y*v.e01+di.z*v.e02,Xi=di.x*v.e10+di.y*v.e11+di.z*v.e12,zi=di.x*v.e20+di.y*v.e21+di.z*v.e22;di.x=gi,di.y=Xi,di.z=zi;var Yi=di,Zi=Yi.x*i,Mi=Yi.y*i,Ii=Yi.z*i;Yi.x=Zi,Yi.y=Mi,Yi.z=Ii;var Vi=Yi,wi=Vi.x+c.x,Li=Vi.y+c.y,ki=Vi.z+c.z;Vi.x=wi,Vi.y=Li,Vi.z=ki;var Bi=this.tmpCircleVerts2[Qt],Ai=-a,Pi=Bi.x+e.x*Ai,Si=Bi.y+e.y*Ai,Ti=Bi.z+e.z*Ai;Bi.x=Pi,Bi.y=Si,Bi.z=Ti}for(var Ci=0;Ci<8;){var ji=Ci++,Ri=X,Ei=this.tmpCircleVerts2[ji],qi=this.tmpCircleVerts2[(ji+1)%8],Ni=this.tmpCircleVerts1[ji],Fi=this.tmpCircleNorms[ji],Di=this.tmpCircleNorms[(ji+1)%8];this.triangle(Ri,Ei,qi,Ni,Fi,Di,s),Ri=L,Ei=this.tmpCircleVerts2[(ji+1)%8],qi=this.tmpCircleVerts2[ji];var Gi=this.p,Wi=0==Gi.sizeVec3?new pa.common.Vec3:Gi.stackVec3[--Gi.sizeVec3];Wi.x=e.x,Wi.y=e.y,Wi.z=e.z;var Ji=Wi,Ui=-Ji.x,Oi=-Ji.y,Hi=-Ji.z;Ji.x=Ui,Ji.y=Oi,Ji.z=Hi,Ni=Ji,this.triangle(Ri,Ei,qi,Ni,Ni,Ni,s);var Qi=this.p;if(null!=Ni){if(Ni.zero(),Qi.sizeVec3==Qi.stackVec3.length){for(var Ki=Qi.sizeVec3<<1,$i=new Array(Ki),ta=0,ia=Qi.sizeVec3;ta<ia;){var aa=ta++;$i[aa]=Qi.stackVec3[aa],Qi.stackVec3[aa]=null}Qi.stackVec3=$i}Qi.stackVec3[Qi.sizeVec3++]=Ni}}}var sa=this.p;if(null!=X){if(X.zero(),sa.sizeVec3==sa.stackVec3.length){for(var oa=sa.sizeVec3<<1,na=new Array(oa),ra=0,ea=sa.sizeVec3;ra<ea;){var _a=ra++;na[_a]=sa.stackVec3[_a],sa.stackVec3[_a]=null}sa.stackVec3=na}sa.stackVec3[sa.sizeVec3++]=X}var ha=this.p;if(null!=L){if(L.zero(),ha.sizeVec3==ha.stackVec3.length){for(var la=ha.sizeVec3<<1,ca=new Array(la),ma=0,va=ha.sizeVec3;ma<va;){var ba=ma++;ca[ba]=ha.stackVec3[ba],ha.stackVec3[ba]=null}ha.stackVec3=ca}ha.stackVec3[ha.sizeVec3++]=L}var xa=this.p;if(null!=c){if(c.zero(),xa.sizeVec3==xa.stackVec3.length){for(var fa=xa.sizeVec3<<1,ua=new Array(fa),ya=0,da=xa.sizeVec3;ya<da;){var ga=ya++;ua[ga]=xa.stackVec3[ga],xa.stackVec3[ga]=null}xa.stackVec3=ua}xa.stackVec3[xa.sizeVec3++]=c}var Xa=this.p;if(null!=v){if(v.e00=1,v.e01=0,v.e02=0,v.e10=0,v.e11=1,v.e12=0,v.e20=0,v.e21=0,v.e22=1,Xa.sizeMat3==Xa.stackMat3.length){for(var za=Xa.sizeMat3<<1,Ya=new Array(za),Za=0,Ma=Xa.sizeMat3;Za<Ma;){var Ia=Za++;Ya[Ia]=Xa.stackMat3[Ia],Xa.stackMat3[Ia]=null}Xa.stackMat3=Ya}Xa.stackMat3[Xa.sizeMat3++]=v}var Va=this.p;if(null!=n){if(n.zero(),Va.sizeVec3==Va.stackVec3.length){for(var wa=Va.sizeVec3<<1,La=new Array(wa),ka=0,Ba=Va.sizeVec3;ka<Ba;){var Aa=ka++;La[Aa]=Va.stackVec3[Aa],Va.stackVec3[Aa]=null}Va.stackVec3=La}Va.stackVec3[Va.sizeVec3++]=n}var Pa=this.p;if(null!=e){if(e.zero(),Pa.sizeVec3==Pa.stackVec3.length){for(var Sa=Pa.sizeVec3<<1,Ta=new Array(Sa),Ca=0,ja=Pa.sizeVec3;Ca<ja;){var Ra=Ca++;Ta[Ra]=Pa.stackVec3[Ra],Pa.stackVec3[Ra]=null}Pa.stackVec3=Ta}Pa.stackVec3[Pa.sizeVec3++]=e}var Ea=this.p;if(null!=h){if(h.zero(),Ea.sizeVec3==Ea.stackVec3.length){for(var qa=Ea.sizeVec3<<1,Na=new Array(qa),Fa=0,Da=Ea.sizeVec3;Fa<Da;){var Ga=Fa++;Na[Ga]=Ea.stackVec3[Ga],Ea.stackVec3[Ga]=null}Ea.stackVec3=Na}Ea.stackVec3[Ea.sizeVec3++]=h}}cylinder(t,i,a,s){var o=this.p,n=0==o.sizeVec3?new pa.common.Vec3:o.stackVec3[--o.sizeVec3],r=this.p,e=0==r.sizeVec3?new pa.common.Vec3:r.stackVec3[--r.sizeVec3],_=this.p,h=0==_.sizeVec3?new pa.common.Vec3:_.stackVec3[--_.sizeVec3],l=this.p,c=0==l.sizeVec3?new pa.common.Vec3:l.stackVec3[--l.sizeVec3],m=this.p,v=0==m.sizeMat3?new pa.common.Mat3:m.stackMat3[--m.sizeMat3],b=c;b.x=t._positionX,b.y=t._positionY,b.z=t._positionZ;var x=v;x.e00=t._rotation00,x.e01=t._rotation01,x.e02=t._rotation02,x.e10=t._rotation10,x.e11=t._rotation11,x.e12=t._rotation12,x.e20=t._rotation20,x.e21=t._rotation21,x.e22=t._rotation22,n.init(v.e00,v.e10,v.e20),e.init(v.e01,v.e11,v.e21),h.init(v.e02,v.e12,v.e22);var p=this.p,f=0==p.sizeVec3?new pa.common.Vec3:p.stackVec3[--p.sizeVec3];f.x=c.x,f.y=c.y,f.z=c.z;var u=f,y=u.x+e.x*a,d=u.y+e.y*a,g=u.z+e.z*a;u.x=y,u.y=d,u.z=g;var X=u,z=this.p,Y=0==z.sizeVec3?new pa.common.Vec3:z.stackVec3[--z.sizeVec3];Y.x=c.x,Y.y=c.y,Y.z=c.z;var Z=Y,M=-a,I=Z.x+e.x*M,V=Z.y+e.y*M,w=Z.z+e.z*M;Z.x=I,Z.y=V,Z.z=w;var L=Z;if(this.wireframe){var k=this.p,B=0==k.sizeVec3?new pa.common.Vec3:k.stackVec3[--k.sizeVec3];B.x=X.x,B.y=X.y,B.z=X.z;var A=B,P=-i,S=A.x+n.x*P,T=A.y+n.y*P,C=A.z+n.z*P;A.x=S,A.y=T,A.z=C;var j=A,R=j.x+0*h.x,E=j.y+0*h.y,q=j.z+0*h.z;j.x=R,j.y=E,j.z=q;var N=j,F=this.p,D=0==F.sizeVec3?new pa.common.Vec3:F.stackVec3[--F.sizeVec3];D.x=X.x,D.y=X.y,D.z=X.z;var G=D,W=G.x+n.x*i,J=G.y+n.y*i,U=G.z+n.z*i;G.x=W,G.y=J,G.z=U;var O=G,H=O.x+0*h.x,Q=O.y+0*h.y,K=O.z+0*h.z;O.x=H,O.y=Q,O.z=K;var $=O,tt=this.p,it=0==tt.sizeVec3?new pa.common.Vec3:tt.stackVec3[--tt.sizeVec3];it.x=X.x,it.y=X.y,it.z=X.z;var at=it,st=at.x+0*n.x,ot=at.y+0*n.y,nt=at.z+0*n.z;at.x=st,at.y=ot,at.z=nt;var rt=at,et=-i,_t=rt.x+h.x*et,ht=rt.y+h.y*et,lt=rt.z+h.z*et;rt.x=_t,rt.y=ht,rt.z=lt;var ct=rt,mt=this.p,vt=0==mt.sizeVec3?new pa.common.Vec3:mt.stackVec3[--mt.sizeVec3];vt.x=X.x,vt.y=X.y,vt.z=X.z;var bt=vt,xt=bt.x+0*n.x,pt=bt.y+0*n.y,ft=bt.z+0*n.z;bt.x=xt,bt.y=pt,bt.z=ft;var ut=bt,yt=ut.x+h.x*i,dt=ut.y+h.y*i,gt=ut.z+h.z*i;ut.x=yt,ut.y=dt,ut.z=gt;var Xt=ut,zt=this.p,Yt=0==zt.sizeVec3?new pa.common.Vec3:zt.stackVec3[--zt.sizeVec3];Yt.x=L.x,Yt.y=L.y,Yt.z=L.z;var Zt=Yt,Mt=-i,It=Zt.x+n.x*Mt,Vt=Zt.y+n.y*Mt,wt=Zt.z+n.z*Mt;Zt.x=It,Zt.y=Vt,Zt.z=wt;var Lt=Zt,kt=Lt.x+0*h.x,Bt=Lt.y+0*h.y,At=Lt.z+0*h.z;Lt.x=kt,Lt.y=Bt,Lt.z=At;var Pt=Lt,St=this.p,Tt=0==St.sizeVec3?new pa.common.Vec3:St.stackVec3[--St.sizeVec3];Tt.x=L.x,Tt.y=L.y,Tt.z=L.z;var Ct=Tt,jt=Ct.x+n.x*i,Rt=Ct.y+n.y*i,Et=Ct.z+n.z*i;Ct.x=jt,Ct.y=Rt,Ct.z=Et;var qt=Ct,Nt=qt.x+0*h.x,Ft=qt.y+0*h.y,Dt=qt.z+0*h.z;qt.x=Nt,qt.y=Ft,qt.z=Dt;var Gt=qt,Wt=this.p,Jt=0==Wt.sizeVec3?new pa.common.Vec3:Wt.stackVec3[--Wt.sizeVec3];Jt.x=L.x,Jt.y=L.y,Jt.z=L.z;var Ut=Jt,Ot=Ut.x+0*n.x,Ht=Ut.y+0*n.y,Qt=Ut.z+0*n.z;Ut.x=Ot,Ut.y=Ht,Ut.z=Qt;var Kt=Ut,$t=-i,ti=Kt.x+h.x*$t,ii=Kt.y+h.y*$t,ai=Kt.z+h.z*$t;Kt.x=ti,Kt.y=ii,Kt.z=ai;var si=Kt,oi=this.p,ni=0==oi.sizeVec3?new pa.common.Vec3:oi.stackVec3[--oi.sizeVec3];ni.x=L.x,ni.y=L.y,ni.z=L.z;var ri=ni,ei=ri.x+0*n.x,_i=ri.y+0*n.y,hi=ri.z+0*n.z;ri.x=ei,ri.y=_i,ri.z=hi;var li=ri,ci=li.x+h.x*i,mi=li.y+h.y*i,vi=li.z+h.z*i;li.x=ci,li.y=mi,li.z=vi;var bi=li;this.ellipse(X,n,h,i,i,s),this.ellipse(L,n,h,i,i,s),this.line(N,Pt,s),this.line($,Gt,s),this.line(ct,si,s),this.line(Xt,bi,s);var xi=this.p;if(null!=N){if(N.zero(),xi.sizeVec3==xi.stackVec3.length){for(var pi=xi.sizeVec3<<1,fi=new Array(pi),ui=0,yi=xi.sizeVec3;ui<yi;){var di=ui++;fi[di]=xi.stackVec3[di],xi.stackVec3[di]=null}xi.stackVec3=fi}xi.stackVec3[xi.sizeVec3++]=N}var gi=this.p;if(null!=$){if($.zero(),gi.sizeVec3==gi.stackVec3.length){for(var Xi=gi.sizeVec3<<1,zi=new Array(Xi),Yi=0,Zi=gi.sizeVec3;Yi<Zi;){var Mi=Yi++;zi[Mi]=gi.stackVec3[Mi],gi.stackVec3[Mi]=null}gi.stackVec3=zi}gi.stackVec3[gi.sizeVec3++]=$}var Ii=this.p;if(null!=ct){if(ct.zero(),Ii.sizeVec3==Ii.stackVec3.length){for(var Vi=Ii.sizeVec3<<1,wi=new Array(Vi),Li=0,ki=Ii.sizeVec3;Li<ki;){var Bi=Li++;wi[Bi]=Ii.stackVec3[Bi],Ii.stackVec3[Bi]=null}Ii.stackVec3=wi}Ii.stackVec3[Ii.sizeVec3++]=ct}var Ai=this.p;if(null!=Xt){if(Xt.zero(),Ai.sizeVec3==Ai.stackVec3.length){for(var Pi=Ai.sizeVec3<<1,Si=new Array(Pi),Ti=0,Ci=Ai.sizeVec3;Ti<Ci;){var ji=Ti++;Si[ji]=Ai.stackVec3[ji],Ai.stackVec3[ji]=null}Ai.stackVec3=Si}Ai.stackVec3[Ai.sizeVec3++]=Xt}var Ri=this.p;if(null!=Pt){if(Pt.zero(),Ri.sizeVec3==Ri.stackVec3.length){for(var Ei=Ri.sizeVec3<<1,qi=new Array(Ei),Ni=0,Fi=Ri.sizeVec3;Ni<Fi;){var Di=Ni++;qi[Di]=Ri.stackVec3[Di],Ri.stackVec3[Di]=null}Ri.stackVec3=qi}Ri.stackVec3[Ri.sizeVec3++]=Pt}var Gi=this.p;if(null!=Gt){if(Gt.zero(),Gi.sizeVec3==Gi.stackVec3.length){for(var Wi=Gi.sizeVec3<<1,Ji=new Array(Wi),Ui=0,Oi=Gi.sizeVec3;Ui<Oi;){var Hi=Ui++;Ji[Hi]=Gi.stackVec3[Hi],Gi.stackVec3[Hi]=null}Gi.stackVec3=Ji}Gi.stackVec3[Gi.sizeVec3++]=Gt}var Qi=this.p;if(null!=si){if(si.zero(),Qi.sizeVec3==Qi.stackVec3.length){for(var Ki=Qi.sizeVec3<<1,$i=new Array(Ki),ta=0,ia=Qi.sizeVec3;ta<ia;){var aa=ta++;$i[aa]=Qi.stackVec3[aa],Qi.stackVec3[aa]=null}Qi.stackVec3=$i}Qi.stackVec3[Qi.sizeVec3++]=si}var sa=this.p;if(null!=bi){if(bi.zero(),sa.sizeVec3==sa.stackVec3.length){for(var oa=sa.sizeVec3<<1,na=new Array(oa),ra=0,ea=sa.sizeVec3;ra<ea;){var _a=ra++;na[_a]=sa.stackVec3[_a],sa.stackVec3[_a]=null}sa.stackVec3=na}sa.stackVec3[sa.sizeVec3++]=bi}}else{for(var ha=0;ha<8;){var la=ha++,ca=this.tmpCircleNorms[la],ma=this.circleCoords[la];ca.x=ma.x,ca.y=ma.y,ca.z=ma.z;var va=ca,ba=va.x*v.e00+va.y*v.e01+va.z*v.e02,xa=va.x*v.e10+va.y*v.e11+va.z*v.e12,fa=va.x*v.e20+va.y*v.e21+va.z*v.e22;va.x=ba,va.y=xa,va.z=fa;var ua=this.tmpCircleVerts1[la],ya=this.tmpCircleNorms[la];ua.x=ya.x,ua.y=ya.y,ua.z=ya.z;var da=ua,ga=da.x*i,Xa=da.y*i,za=da.z*i;da.x=ga,da.y=Xa,da.z=za;var Ya=da,Za=Ya.x+c.x,Ma=Ya.y+c.y,Ia=Ya.z+c.z;Ya.x=Za,Ya.y=Ma,Ya.z=Ia;var Va=this.tmpCircleVerts2[la],wa=this.tmpCircleVerts1[la];Va.x=wa.x,Va.y=wa.y,Va.z=wa.z;var La=this.tmpCircleVerts1[la],ka=La.x+e.x*a,Ba=La.y+e.y*a,Aa=La.z+e.z*a;La.x=ka,La.y=Ba,La.z=Aa;var Pa=this.tmpCircleVerts2[la],Sa=-a,Ta=Pa.x+e.x*Sa,Ca=Pa.y+e.y*Sa,ja=Pa.z+e.z*Sa;Pa.x=Ta,Pa.y=Ca,Pa.z=ja}for(var Ra=0;Ra<8;){var Ea=Ra++,qa=X,Na=this.tmpCircleVerts1[Ea],Fa=this.tmpCircleVerts1[(Ea+1)%8],Da=e;this.triangle(qa,Na,Fa,Da,Da,Da,s),qa=L,Na=this.tmpCircleVerts2[(Ea+1)%8],Fa=this.tmpCircleVerts2[Ea];var Ga=this.p,Wa=0==Ga.sizeVec3?new pa.common.Vec3:Ga.stackVec3[--Ga.sizeVec3];Wa.x=e.x,Wa.y=e.y,Wa.z=e.z;var Ja=Wa,Ua=-Ja.x,Oa=-Ja.y,Ha=-Ja.z;Ja.x=Ua,Ja.y=Oa,Ja.z=Ha,Da=Ja,this.triangle(qa,Na,Fa,Da,Da,Da,s);var Qa=this.p;if(null!=Da){if(Da.zero(),Qa.sizeVec3==Qa.stackVec3.length){for(var Ka=Qa.sizeVec3<<1,$a=new Array(Ka),ts=0,is=Qa.sizeVec3;ts<is;){var as=ts++;$a[as]=Qa.stackVec3[as],Qa.stackVec3[as]=null}Qa.stackVec3=$a}Qa.stackVec3[Qa.sizeVec3++]=Da}qa=this.tmpCircleVerts1[Ea],Na=this.tmpCircleVerts2[Ea],Fa=this.tmpCircleVerts2[(Ea+1)%8];var ss=this.tmpCircleVerts1[(Ea+1)%8];Da=this.tmpCircleNorms[Ea];var os=this.tmpCircleNorms[(Ea+1)%8];this.rect(qa,Na,Fa,ss,Da,Da,os,os,s)}}var ns=this.p;if(null!=X){if(X.zero(),ns.sizeVec3==ns.stackVec3.length){for(var rs=ns.sizeVec3<<1,es=new Array(rs),_s=0,hs=ns.sizeVec3;_s<hs;){var ls=_s++;es[ls]=ns.stackVec3[ls],ns.stackVec3[ls]=null}ns.stackVec3=es}ns.stackVec3[ns.sizeVec3++]=X}var cs=this.p;if(null!=L){if(L.zero(),cs.sizeVec3==cs.stackVec3.length){for(var ms=cs.sizeVec3<<1,vs=new Array(ms),bs=0,xs=cs.sizeVec3;bs<xs;){var ps=bs++;vs[ps]=cs.stackVec3[ps],cs.stackVec3[ps]=null}cs.stackVec3=vs}cs.stackVec3[cs.sizeVec3++]=L}var fs=this.p;if(null!=c){if(c.zero(),fs.sizeVec3==fs.stackVec3.length){for(var us=fs.sizeVec3<<1,ys=new Array(us),ds=0,gs=fs.sizeVec3;ds<gs;){var Xs=ds++;ys[Xs]=fs.stackVec3[Xs],fs.stackVec3[Xs]=null}fs.stackVec3=ys}fs.stackVec3[fs.sizeVec3++]=c}var zs=this.p;if(null!=v){if(v.e00=1,v.e01=0,v.e02=0,v.e10=0,v.e11=1,v.e12=0,v.e20=0,v.e21=0,v.e22=1,zs.sizeMat3==zs.stackMat3.length){for(var Ys=zs.sizeMat3<<1,Zs=new Array(Ys),Ms=0,Is=zs.sizeMat3;Ms<Is;){var Vs=Ms++;Zs[Vs]=zs.stackMat3[Vs],zs.stackMat3[Vs]=null}zs.stackMat3=Zs}zs.stackMat3[zs.sizeMat3++]=v}var ws=this.p;if(null!=n){if(n.zero(),ws.sizeVec3==ws.stackVec3.length){for(var Ls=ws.sizeVec3<<1,ks=new Array(Ls),Bs=0,As=ws.sizeVec3;Bs<As;){var Ps=Bs++;ks[Ps]=ws.stackVec3[Ps],ws.stackVec3[Ps]=null}ws.stackVec3=ks}ws.stackVec3[ws.sizeVec3++]=n}var Ss=this.p;if(null!=e){if(e.zero(),Ss.sizeVec3==Ss.stackVec3.length){for(var Ts=Ss.sizeVec3<<1,Cs=new Array(Ts),js=0,Rs=Ss.sizeVec3;js<Rs;){var Es=js++;Cs[Es]=Ss.stackVec3[Es],Ss.stackVec3[Es]=null}Ss.stackVec3=Cs}Ss.stackVec3[Ss.sizeVec3++]=e}var qs=this.p;if(null!=h){if(h.zero(),qs.sizeVec3==qs.stackVec3.length){for(var Ns=qs.sizeVec3<<1,Fs=new Array(Ns),Ds=0,Gs=qs.sizeVec3;Ds<Gs;){var Ws=Ds++;Fs[Ws]=qs.stackVec3[Ws],qs.stackVec3[Ws]=null}qs.stackVec3=Fs}qs.stackVec3[qs.sizeVec3++]=h}}capsule(t,i,a,s){var o=this.p,n=0==o.sizeVec3?new pa.common.Vec3:o.stackVec3[--o.sizeVec3],r=this.p,e=0==r.sizeVec3?new pa.common.Vec3:r.stackVec3[--r.sizeVec3],_=this.p,h=0==_.sizeVec3?new pa.common.Vec3:_.stackVec3[--_.sizeVec3],l=this.p,c=0==l.sizeVec3?new pa.common.Vec3:l.stackVec3[--l.sizeVec3],m=this.p,v=0==m.sizeMat3?new pa.common.Mat3:m.stackMat3[--m.sizeMat3],b=c;b.x=t._positionX,b.y=t._positionY,b.z=t._positionZ;var x=v;x.e00=t._rotation00,x.e01=t._rotation01,x.e02=t._rotation02,x.e10=t._rotation10,x.e11=t._rotation11,x.e12=t._rotation12,x.e20=t._rotation20,x.e21=t._rotation21,x.e22=t._rotation22,n.init(v.e00,v.e10,v.e20),e.init(v.e01,v.e11,v.e21),h.init(v.e02,v.e12,v.e22);for(var p=this.tmpSphereVerts,f=this.tmpSphereNorms,u=0;u<5;)for(var y=u++,d=0,g=this.tmpSphereVerts[y].length;d<g;){var X=d++,z=f[y][X],Y=this.sphereCoords[y][X];z.x=Y.x,z.y=Y.y,z.z=Y.z;var Z=z,M=Z.x*v.e00+Z.y*v.e01+Z.z*v.e02,I=Z.x*v.e10+Z.y*v.e11+Z.z*v.e12,V=Z.x*v.e20+Z.y*v.e21+Z.z*v.e22;Z.x=M,Z.y=I,Z.z=V}for(var w=0;w<4;){var L=w++;if(0==L)for(var k=0;k<3;)for(var B=k++,A=0,P=this.tmpSphereVerts[B].length;A<P;){var S=A++,T=p[B][S],C=f[B][S];T.x=C.x,T.y=C.y,T.z=C.z;var j=T,R=j.x*i,E=j.y*i,q=j.z*i;j.x=R,j.y=E,j.z=q;var N=j,F=N.x+c.x,D=N.y+c.y,G=N.z+c.z;N.x=F,N.y=D,N.z=G;var W=N,J=W.x+e.x*a,U=W.y+e.y*a,O=W.z+e.z*a;W.x=J,W.y=U,W.z=O}if(2==L)for(var H=2;H<5;)for(var Q=H++,K=0,$=this.tmpSphereVerts[Q].length;K<$;){var tt=K++,it=p[Q][tt],at=f[Q][tt];it.x=at.x,it.y=at.y,it.z=at.z;var st=it,ot=st.x*i,nt=st.y*i,rt=st.z*i;st.x=ot,st.y=nt,st.z=rt;var et=st,_t=et.x+c.x,ht=et.y+c.y,lt=et.z+c.z;et.x=_t,et.y=ht,et.z=lt;var ct=et,mt=-a,vt=ct.x+e.x*mt,bt=ct.y+e.y*mt,xt=ct.z+e.z*mt;ct.x=vt,ct.y=bt,ct.z=xt}for(var pt=0;pt<8;){var ft,ut,yt,dt,gt,Xt,zt,Yt,Zt=pt++;0==L?this.wireframe?(ft=p[0][0],ut=p[1][Zt],this.line(ft,ut,s)):(ft=p[0][0],ut=p[1][Zt],yt=p[1][(Zt+1)%8],gt=f[0][0],Xt=f[1][Zt],zt=f[1][(Zt+1)%8],this.triangle(ft,ut,yt,gt,Xt,zt,s)):3==L?this.wireframe?(ft=p[4][0],ut=p[L][(Zt+1)%8],yt=p[L][Zt],this.line(ft,ut,s),this.line(ut,yt,s)):(ft=p[4][0],ut=p[L][(Zt+1)%8],yt=p[L][Zt],gt=f[4][0],Xt=f[L][(Zt+1)%8],zt=f[L][Zt],this.triangle(ft,ut,yt,gt,Xt,zt,s)):this.wireframe?(ft=p[L][Zt],ut=p[L][(Zt+1)%8],yt=p[L+1][Zt],this.line(ft,ut,s),this.line(ft,yt,s)):(ft=p[L][Zt],ut=p[L][(Zt+1)%8],yt=p[L+1][Zt],dt=p[L+1][(Zt+1)%8],gt=f[L][Zt],Xt=f[L][(Zt+1)%8],zt=f[L+1][Zt],Yt=f[L+1][(Zt+1)%8],this.rect(ft,yt,dt,ut,gt,zt,Yt,Xt,s))}}var Mt=this.p,It=0==Mt.sizeVec3?new pa.common.Vec3:Mt.stackVec3[--Mt.sizeVec3];It.x=c.x,It.y=c.y,It.z=c.z;var Vt=It,wt=Vt.x+e.x*a,Lt=Vt.y+e.y*a,kt=Vt.z+e.z*a;Vt.x=wt,Vt.y=Lt,Vt.z=kt;var Bt=Vt,At=this.p,Pt=0==At.sizeVec3?new pa.common.Vec3:At.stackVec3[--At.sizeVec3];Pt.x=c.x,Pt.y=c.y,Pt.z=c.z;var St=Pt,Tt=-a,Ct=St.x+e.x*Tt,jt=St.y+e.y*Tt,Rt=St.z+e.z*Tt;St.x=Ct,St.y=jt,St.z=Rt;var Et=St;if(this.wireframe){var qt=this.p,Nt=0==qt.sizeVec3?new pa.common.Vec3:qt.stackVec3[--qt.sizeVec3];Nt.x=Bt.x,Nt.y=Bt.y,Nt.z=Bt.z;var Ft=Nt,Dt=-i,Gt=Ft.x+n.x*Dt,Wt=Ft.y+n.y*Dt,Jt=Ft.z+n.z*Dt;Ft.x=Gt,Ft.y=Wt,Ft.z=Jt;var Ut=Ft,Ot=Ut.x+0*h.x,Ht=Ut.y+0*h.y,Qt=Ut.z+0*h.z;Ut.x=Ot,Ut.y=Ht,Ut.z=Qt;var Kt=Ut,$t=this.p,ti=0==$t.sizeVec3?new pa.common.Vec3:$t.stackVec3[--$t.sizeVec3];ti.x=Bt.x,ti.y=Bt.y,ti.z=Bt.z;var ii=ti,ai=ii.x+n.x*i,si=ii.y+n.y*i,oi=ii.z+n.z*i;ii.x=ai,ii.y=si,ii.z=oi;var ni=ii,ri=ni.x+0*h.x,ei=ni.y+0*h.y,_i=ni.z+0*h.z;ni.x=ri,ni.y=ei,ni.z=_i;var hi=ni,li=this.p,ci=0==li.sizeVec3?new pa.common.Vec3:li.stackVec3[--li.sizeVec3];ci.x=Bt.x,ci.y=Bt.y,ci.z=Bt.z;var mi=ci,vi=mi.x+0*n.x,bi=mi.y+0*n.y,xi=mi.z+0*n.z;mi.x=vi,mi.y=bi,mi.z=xi;var pi=mi,fi=-i,ui=pi.x+h.x*fi,yi=pi.y+h.y*fi,di=pi.z+h.z*fi;pi.x=ui,pi.y=yi,pi.z=di;var gi=pi,Xi=this.p,zi=0==Xi.sizeVec3?new pa.common.Vec3:Xi.stackVec3[--Xi.sizeVec3];zi.x=Bt.x,zi.y=Bt.y,zi.z=Bt.z;var Yi=zi,Zi=Yi.x+0*n.x,Mi=Yi.y+0*n.y,Ii=Yi.z+0*n.z;Yi.x=Zi,Yi.y=Mi,Yi.z=Ii;var Vi=Yi,wi=Vi.x+h.x*i,Li=Vi.y+h.y*i,ki=Vi.z+h.z*i;Vi.x=wi,Vi.y=Li,Vi.z=ki;var Bi=Vi,Ai=this.p,Pi=0==Ai.sizeVec3?new pa.common.Vec3:Ai.stackVec3[--Ai.sizeVec3];Pi.x=Et.x,Pi.y=Et.y,Pi.z=Et.z;var Si=Pi,Ti=-i,Ci=Si.x+n.x*Ti,ji=Si.y+n.y*Ti,Ri=Si.z+n.z*Ti;Si.x=Ci,Si.y=ji,Si.z=Ri;var Ei=Si,qi=Ei.x+0*h.x,Ni=Ei.y+0*h.y,Fi=Ei.z+0*h.z;Ei.x=qi,Ei.y=Ni,Ei.z=Fi;var Di=Ei,Gi=this.p,Wi=0==Gi.sizeVec3?new pa.common.Vec3:Gi.stackVec3[--Gi.sizeVec3];Wi.x=Et.x,Wi.y=Et.y,Wi.z=Et.z;var Ji=Wi,Ui=Ji.x+n.x*i,Oi=Ji.y+n.y*i,Hi=Ji.z+n.z*i;Ji.x=Ui,Ji.y=Oi,Ji.z=Hi;var Qi=Ji,Ki=Qi.x+0*h.x,$i=Qi.y+0*h.y,ta=Qi.z+0*h.z;Qi.x=Ki,Qi.y=$i,Qi.z=ta;var ia=Qi,aa=this.p,sa=0==aa.sizeVec3?new pa.common.Vec3:aa.stackVec3[--aa.sizeVec3];sa.x=Et.x,sa.y=Et.y,sa.z=Et.z;var oa=sa,na=oa.x+0*n.x,ra=oa.y+0*n.y,ea=oa.z+0*n.z;oa.x=na,oa.y=ra,oa.z=ea;var _a=oa,ha=-i,la=_a.x+h.x*ha,ca=_a.y+h.y*ha,ma=_a.z+h.z*ha;_a.x=la,_a.y=ca,_a.z=ma;var va=_a,ba=this.p,xa=0==ba.sizeVec3?new pa.common.Vec3:ba.stackVec3[--ba.sizeVec3];xa.x=Et.x,xa.y=Et.y,xa.z=Et.z;var fa=xa,ua=fa.x+0*n.x,ya=fa.y+0*n.y,da=fa.z+0*n.z;fa.x=ua,fa.y=ya,fa.z=da;var ga=fa,Xa=ga.x+h.x*i,za=ga.y+h.y*i,Ya=ga.z+h.z*i;ga.x=Xa,ga.y=za,ga.z=Ya;var Za=ga;this.ellipse(Bt,n,h,i,i,s),this.ellipse(Et,n,h,i,i,s),this.line(Kt,Di,s),this.line(hi,ia,s),this.line(gi,va,s),this.line(Bi,Za,s);var Ma=this.p;if(null!=Kt){if(Kt.zero(),Ma.sizeVec3==Ma.stackVec3.length){for(var Ia=Ma.sizeVec3<<1,Va=new Array(Ia),wa=0,La=Ma.sizeVec3;wa<La;){var ka=wa++;Va[ka]=Ma.stackVec3[ka],Ma.stackVec3[ka]=null}Ma.stackVec3=Va}Ma.stackVec3[Ma.sizeVec3++]=Kt}var Ba=this.p;if(null!=hi){if(hi.zero(),Ba.sizeVec3==Ba.stackVec3.length){for(var Aa=Ba.sizeVec3<<1,Pa=new Array(Aa),Sa=0,Ta=Ba.sizeVec3;Sa<Ta;){var Ca=Sa++;Pa[Ca]=Ba.stackVec3[Ca],Ba.stackVec3[Ca]=null}Ba.stackVec3=Pa}Ba.stackVec3[Ba.sizeVec3++]=hi}var ja=this.p;if(null!=gi){if(gi.zero(),ja.sizeVec3==ja.stackVec3.length){for(var Ra=ja.sizeVec3<<1,Ea=new Array(Ra),qa=0,Na=ja.sizeVec3;qa<Na;){var Fa=qa++;Ea[Fa]=ja.stackVec3[Fa],ja.stackVec3[Fa]=null}ja.stackVec3=Ea}ja.stackVec3[ja.sizeVec3++]=gi}var Da=this.p;if(null!=Bi){if(Bi.zero(),Da.sizeVec3==Da.stackVec3.length){for(var Ga=Da.sizeVec3<<1,Wa=new Array(Ga),Ja=0,Ua=Da.sizeVec3;Ja<Ua;){var Oa=Ja++;Wa[Oa]=Da.stackVec3[Oa],Da.stackVec3[Oa]=null}Da.stackVec3=Wa}Da.stackVec3[Da.sizeVec3++]=Bi}var Ha=this.p;if(null!=Di){if(Di.zero(),Ha.sizeVec3==Ha.stackVec3.length){for(var Qa=Ha.sizeVec3<<1,Ka=new Array(Qa),$a=0,ts=Ha.sizeVec3;$a<ts;){var is=$a++;Ka[is]=Ha.stackVec3[is],Ha.stackVec3[is]=null}Ha.stackVec3=Ka}Ha.stackVec3[Ha.sizeVec3++]=Di}var as=this.p;if(null!=ia){if(ia.zero(),as.sizeVec3==as.stackVec3.length){for(var ss=as.sizeVec3<<1,os=new Array(ss),ns=0,rs=as.sizeVec3;ns<rs;){var es=ns++;os[es]=as.stackVec3[es],as.stackVec3[es]=null}as.stackVec3=os}as.stackVec3[as.sizeVec3++]=ia}var _s=this.p;if(null!=va){if(va.zero(),_s.sizeVec3==_s.stackVec3.length){for(var hs=_s.sizeVec3<<1,ls=new Array(hs),cs=0,ms=_s.sizeVec3;cs<ms;){var vs=cs++;ls[vs]=_s.stackVec3[vs],_s.stackVec3[vs]=null}_s.stackVec3=ls}_s.stackVec3[_s.sizeVec3++]=va}var bs=this.p;if(null!=Za){if(Za.zero(),bs.sizeVec3==bs.stackVec3.length){for(var xs=bs.sizeVec3<<1,ps=new Array(xs),fs=0,us=bs.sizeVec3;fs<us;){var ys=fs++;ps[ys]=bs.stackVec3[ys],bs.stackVec3[ys]=null}bs.stackVec3=ps}bs.stackVec3[bs.sizeVec3++]=Za}}else{for(var ds=0;ds<8;){var gs=ds++,Xs=this.tmpCircleNorms[gs],zs=this.circleCoords[gs];Xs.x=zs.x,Xs.y=zs.y,Xs.z=zs.z;var Ys=Xs,Zs=Ys.x*v.e00+Ys.y*v.e01+Ys.z*v.e02,Ms=Ys.x*v.e10+Ys.y*v.e11+Ys.z*v.e12,Is=Ys.x*v.e20+Ys.y*v.e21+Ys.z*v.e22;Ys.x=Zs,Ys.y=Ms,Ys.z=Is;var Vs=this.tmpCircleVerts1[gs],ws=this.tmpCircleNorms[gs];Vs.x=ws.x,Vs.y=ws.y,Vs.z=ws.z;var Ls=Vs,ks=Ls.x*i,Bs=Ls.y*i,As=Ls.z*i;Ls.x=ks,Ls.y=Bs,Ls.z=As;var Ps=Ls,Ss=Ps.x+c.x,Ts=Ps.y+c.y,Cs=Ps.z+c.z;Ps.x=Ss,Ps.y=Ts,Ps.z=Cs;var js=this.tmpCircleVerts2[gs],Rs=this.tmpCircleVerts1[gs];js.x=Rs.x,js.y=Rs.y,js.z=Rs.z;var Es=this.tmpCircleVerts1[gs],qs=Es.x+e.x*a,Ns=Es.y+e.y*a,Fs=Es.z+e.z*a;Es.x=qs,Es.y=Ns,Es.z=Fs;var Ds=this.tmpCircleVerts2[gs],Gs=-a,Ws=Ds.x+e.x*Gs,Js=Ds.y+e.y*Gs,Us=Ds.z+e.z*Gs;Ds.x=Ws,Ds.y=Js,Ds.z=Us}for(var Os=0;Os<8;){var Hs=Os++,Qs=this.tmpCircleVerts1[Hs],Ks=this.tmpCircleVerts2[Hs],$s=this.tmpCircleVerts2[(Hs+1)%8],to=this.tmpCircleVerts1[(Hs+1)%8],io=this.tmpCircleNorms[Hs],ao=this.tmpCircleNorms[(Hs+1)%8];this.rect(Qs,Ks,$s,to,io,io,ao,ao,s)}}var so=this.p;if(null!=Bt){if(Bt.zero(),so.sizeVec3==so.stackVec3.length){for(var oo=so.sizeVec3<<1,no=new Array(oo),ro=0,eo=so.sizeVec3;ro<eo;){var _o=ro++;no[_o]=so.stackVec3[_o],so.stackVec3[_o]=null}so.stackVec3=no}so.stackVec3[so.sizeVec3++]=Bt}var ho=this.p;if(null!=Et){if(Et.zero(),ho.sizeVec3==ho.stackVec3.length){for(var lo=ho.sizeVec3<<1,co=new Array(lo),mo=0,vo=ho.sizeVec3;mo<vo;){var bo=mo++;co[bo]=ho.stackVec3[bo],ho.stackVec3[bo]=null}ho.stackVec3=co}ho.stackVec3[ho.sizeVec3++]=Et}var xo=this.p;if(null!=c){if(c.zero(),xo.sizeVec3==xo.stackVec3.length){for(var po=xo.sizeVec3<<1,fo=new Array(po),uo=0,yo=xo.sizeVec3;uo<yo;){var go=uo++;fo[go]=xo.stackVec3[go],xo.stackVec3[go]=null}xo.stackVec3=fo}xo.stackVec3[xo.sizeVec3++]=c}var Xo=this.p;if(null!=v){if(v.e00=1,v.e01=0,v.e02=0,v.e10=0,v.e11=1,v.e12=0,v.e20=0,v.e21=0,v.e22=1,Xo.sizeMat3==Xo.stackMat3.length){for(var zo=Xo.sizeMat3<<1,Yo=new Array(zo),Zo=0,Mo=Xo.sizeMat3;Zo<Mo;){var Io=Zo++;Yo[Io]=Xo.stackMat3[Io],Xo.stackMat3[Io]=null}Xo.stackMat3=Yo}Xo.stackMat3[Xo.sizeMat3++]=v}var Vo=this.p;if(null!=n){if(n.zero(),Vo.sizeVec3==Vo.stackVec3.length){for(var wo=Vo.sizeVec3<<1,Lo=new Array(wo),ko=0,Bo=Vo.sizeVec3;ko<Bo;){var Ao=ko++;Lo[Ao]=Vo.stackVec3[Ao],Vo.stackVec3[Ao]=null}Vo.stackVec3=Lo}Vo.stackVec3[Vo.sizeVec3++]=n}var Po=this.p;if(null!=e){if(e.zero(),Po.sizeVec3==Po.stackVec3.length){for(var So=Po.sizeVec3<<1,To=new Array(So),Co=0,jo=Po.sizeVec3;Co<jo;){var Ro=Co++;To[Ro]=Po.stackVec3[Ro],Po.stackVec3[Ro]=null}Po.stackVec3=To}Po.stackVec3[Po.sizeVec3++]=e}var Eo=this.p;if(null!=h){if(h.zero(),Eo.sizeVec3==Eo.stackVec3.length){for(var qo=Eo.sizeVec3<<1,No=new Array(qo),Fo=0,Do=Eo.sizeVec3;Fo<Do;){var Go=Fo++;No[Go]=Eo.stackVec3[Go],Eo.stackVec3[Go]=null}Eo.stackVec3=No}Eo.stackVec3[Eo.sizeVec3++]=h}}sphere(t,i,a){var s=this.p,o=0==s.sizeVec3?new pa.common.Vec3:s.stackVec3[--s.sizeVec3],n=this.p,r=0==n.sizeMat3?new pa.common.Mat3:n.stackMat3[--n.sizeMat3],e=o;e.x=t._positionX,e.y=t._positionY,e.z=t._positionZ;var _=r;_.e00=t._rotation00,_.e01=t._rotation01,_.e02=t._rotation02,_.e10=t._rotation10,_.e11=t._rotation11,_.e12=t._rotation12,_.e20=t._rotation20,_.e21=t._rotation21,_.e22=t._rotation22;for(var h=this.tmpSphereVerts,l=this.tmpSphereNorms,c=0;c<5;)for(var m=c++,v=0,b=this.tmpSphereVerts[m].length;v<b;){var x=v++,p=l[m][x],f=this.sphereCoords[m][x];p.x=f.x,p.y=f.y,p.z=f.z;var u=p,y=u.x*r.e00+u.y*r.e01+u.z*r.e02,d=u.x*r.e10+u.y*r.e11+u.z*r.e12,g=u.x*r.e20+u.y*r.e21+u.z*r.e22;u.x=y,u.y=d,u.z=g;var X=h[m][x],z=l[m][x];X.x=z.x,X.y=z.y,X.z=z.z;var Y=X,Z=Y.x*i,M=Y.y*i,I=Y.z*i;Y.x=Z,Y.y=M,Y.z=I;var V=Y,w=V.x+o.x,L=V.y+o.y,k=V.z+o.z;V.x=w,V.y=L,V.z=k}for(var B=0;B<4;)for(var A=B++,P=0;P<8;){var S,T,C,j,R,E,q,N,F=P++;0==A?this.wireframe?(S=h[0][0],T=h[1][F],this.line(S,T,a)):(S=h[0][0],T=h[1][F],C=h[1][(F+1)%8],R=l[0][0],E=l[1][F],q=l[1][(F+1)%8],this.triangle(S,T,C,R,E,q,a)):3==A?this.wireframe?(S=h[4][0],T=h[A][(F+1)%8],C=h[A][F],this.line(S,T,a),this.line(T,C,a)):(S=h[4][0],T=h[A][(F+1)%8],C=h[A][F],R=l[4][0],E=l[A][(F+1)%8],q=l[A][F],this.triangle(S,T,C,R,E,q,a)):this.wireframe?(S=h[A][F],T=h[A][(F+1)%8],C=h[A+1][F],this.line(S,T,a),this.line(S,C,a)):(S=h[A][F],T=h[A][(F+1)%8],C=h[A+1][F],j=h[A+1][(F+1)%8],R=l[A][F],E=l[A][(F+1)%8],q=l[A+1][F],N=l[A+1][(F+1)%8],this.rect(S,C,j,T,R,q,N,E,a))}var D=this.p;if(null!=o){if(o.zero(),D.sizeVec3==D.stackVec3.length){for(var G=D.sizeVec3<<1,W=new Array(G),J=0,U=D.sizeVec3;J<U;){var O=J++;W[O]=D.stackVec3[O],D.stackVec3[O]=null}D.stackVec3=W}D.stackVec3[D.sizeVec3++]=o}var H=this.p;if(null!=r){if(r.e00=1,r.e01=0,r.e02=0,r.e10=0,r.e11=1,r.e12=0,r.e20=0,r.e21=0,r.e22=1,H.sizeMat3==H.stackMat3.length){for(var Q=H.sizeMat3<<1,K=new Array(Q),$=0,tt=H.sizeMat3;$<tt;){var it=$++;K[it]=H.stackMat3[it],H.stackMat3[it]=null}H.stackMat3=K}H.stackMat3[H.sizeMat3++]=r}}box(t,i,a){var s=this.p,o=0==s.sizeVec3?new pa.common.Vec3:s.stackVec3[--s.sizeVec3],n=this.p,r=0==n.sizeVec3?new pa.common.Vec3:n.stackVec3[--n.sizeVec3],e=this.p,_=0==e.sizeVec3?new pa.common.Vec3:e.stackVec3[--e.sizeVec3],h=this.p,l=0==h.sizeVec3?new pa.common.Vec3:h.stackVec3[--h.sizeVec3],c=this.p,m=0==c.sizeMat3?new pa.common.Mat3:c.stackMat3[--c.sizeMat3],v=l;v.x=t._positionX,v.y=t._positionY,v.z=t._positionZ;var b=m;b.e00=t._rotation00,b.e01=t._rotation01,b.e02=t._rotation02,b.e10=t._rotation10,b.e11=t._rotation11,b.e12=t._rotation12,b.e20=t._rotation20,b.e21=t._rotation21,b.e22=t._rotation22,o.init(m.e00,m.e10,m.e20),r.init(m.e01,m.e11,m.e21),_.init(m.e02,m.e12,m.e22);var x=i.x,p=i.y,f=i.z,u=this.p,y=0==u.sizeVec3?new pa.common.Vec3:u.stackVec3[--u.sizeVec3];y.x=l.x,y.y=l.y,y.z=l.z;var d=y,g=-x,X=d.x+o.x*g,z=d.y+o.y*g,Y=d.z+o.z*g;d.x=X,d.y=z,d.z=Y;var Z=d,M=-p,I=Z.x+r.x*M,V=Z.y+r.y*M,w=Z.z+r.z*M;Z.x=I,Z.y=V,Z.z=w;var L=Z,k=-f,B=L.x+_.x*k,A=L.y+_.y*k,P=L.z+_.z*k;L.x=B,L.y=A,L.z=P;var S=L,T=this.p,C=0==T.sizeVec3?new pa.common.Vec3:T.stackVec3[--T.sizeVec3];C.x=l.x,C.y=l.y,C.z=l.z;var j=C,R=-x,E=j.x+o.x*R,q=j.y+o.y*R,N=j.z+o.z*R;j.x=E,j.y=q,j.z=N;var F=j,D=-p,G=F.x+r.x*D,W=F.y+r.y*D,J=F.z+r.z*D;F.x=G,F.y=W,F.z=J;var U=F,O=U.x+_.x*f,H=U.y+_.y*f,Q=U.z+_.z*f;U.x=O,U.y=H,U.z=Q;var K=U,$=this.p,tt=0==$.sizeVec3?new pa.common.Vec3:$.stackVec3[--$.sizeVec3];tt.x=l.x,tt.y=l.y,tt.z=l.z;var it=tt,at=-x,st=it.x+o.x*at,ot=it.y+o.y*at,nt=it.z+o.z*at;it.x=st,it.y=ot,it.z=nt;var rt=it,et=rt.x+r.x*p,_t=rt.y+r.y*p,ht=rt.z+r.z*p;rt.x=et,rt.y=_t,rt.z=ht;var lt=rt,ct=-f,mt=lt.x+_.x*ct,vt=lt.y+_.y*ct,bt=lt.z+_.z*ct;lt.x=mt,lt.y=vt,lt.z=bt;var xt=lt,pt=this.p,ft=0==pt.sizeVec3?new pa.common.Vec3:pt.stackVec3[--pt.sizeVec3];ft.x=l.x,ft.y=l.y,ft.z=l.z;var ut=ft,yt=-x,dt=ut.x+o.x*yt,gt=ut.y+o.y*yt,Xt=ut.z+o.z*yt;ut.x=dt,ut.y=gt,ut.z=Xt;var zt=ut,Yt=zt.x+r.x*p,Zt=zt.y+r.y*p,Mt=zt.z+r.z*p;zt.x=Yt,zt.y=Zt,zt.z=Mt;var It=zt,Vt=It.x+_.x*f,wt=It.y+_.y*f,Lt=It.z+_.z*f;It.x=Vt,It.y=wt,It.z=Lt;var kt=It,Bt=this.p,At=0==Bt.sizeVec3?new pa.common.Vec3:Bt.stackVec3[--Bt.sizeVec3];At.x=l.x,At.y=l.y,At.z=l.z;var Pt=At,St=Pt.x+o.x*x,Tt=Pt.y+o.y*x,Ct=Pt.z+o.z*x;Pt.x=St,Pt.y=Tt,Pt.z=Ct;var jt=Pt,Rt=-p,Et=jt.x+r.x*Rt,qt=jt.y+r.y*Rt,Nt=jt.z+r.z*Rt;jt.x=Et,jt.y=qt,jt.z=Nt;var Ft=jt,Dt=-f,Gt=Ft.x+_.x*Dt,Wt=Ft.y+_.y*Dt,Jt=Ft.z+_.z*Dt;Ft.x=Gt,Ft.y=Wt,Ft.z=Jt;var Ut=Ft,Ot=this.p,Ht=0==Ot.sizeVec3?new pa.common.Vec3:Ot.stackVec3[--Ot.sizeVec3];Ht.x=l.x,Ht.y=l.y,Ht.z=l.z;var Qt=Ht,Kt=Qt.x+o.x*x,$t=Qt.y+o.y*x,ti=Qt.z+o.z*x;Qt.x=Kt,Qt.y=$t,Qt.z=ti;var ii=Qt,ai=-p,si=ii.x+r.x*ai,oi=ii.y+r.y*ai,ni=ii.z+r.z*ai;ii.x=si,ii.y=oi,ii.z=ni;var ri=ii,ei=ri.x+_.x*f,_i=ri.y+_.y*f,hi=ri.z+_.z*f;ri.x=ei,ri.y=_i,ri.z=hi;var li=ri,ci=this.p,mi=0==ci.sizeVec3?new pa.common.Vec3:ci.stackVec3[--ci.sizeVec3];mi.x=l.x,mi.y=l.y,mi.z=l.z;var vi=mi,bi=vi.x+o.x*x,xi=vi.y+o.y*x,pi=vi.z+o.z*x;vi.x=bi,vi.y=xi,vi.z=pi;var fi=vi,ui=fi.x+r.x*p,yi=fi.y+r.y*p,di=fi.z+r.z*p;fi.x=ui,fi.y=yi,fi.z=di;var gi=fi,Xi=-f,zi=gi.x+_.x*Xi,Yi=gi.y+_.y*Xi,Zi=gi.z+_.z*Xi;gi.x=zi,gi.y=Yi,gi.z=Zi;var Mi=gi,Ii=this.p,Vi=0==Ii.sizeVec3?new pa.common.Vec3:Ii.stackVec3[--Ii.sizeVec3];Vi.x=l.x,Vi.y=l.y,Vi.z=l.z;var wi=Vi,Li=wi.x+o.x*x,ki=wi.y+o.y*x,Bi=wi.z+o.z*x;wi.x=Li,wi.y=ki,wi.z=Bi;var Ai=wi,Pi=Ai.x+r.x*p,Si=Ai.y+r.y*p,Ti=Ai.z+r.z*p;Ai.x=Pi,Ai.y=Si,Ai.z=Ti;var Ci=Ai,ji=Ci.x+_.x*f,Ri=Ci.y+_.y*f,Ei=Ci.z+_.z*f;Ci.x=ji,Ci.y=Ri,Ci.z=Ei;var qi=Ci;if(this.wireframe)this.line(S,K,a),this.line(xt,kt,a),this.line(Ut,li,a),this.line(Mi,qi,a),this.line(S,xt,a),this.line(K,kt,a),this.line(Ut,Mi,a),this.line(li,qi,a),this.line(S,Ut,a),this.line(K,li,a),this.line(xt,Mi,a),this.line(kt,qi,a);else{var Ni=this.p,Fi=0==Ni.sizeVec3?new pa.common.Vec3:Ni.stackVec3[--Ni.sizeVec3];Fi.x=o.x,Fi.y=o.y,Fi.z=o.z;var Di=Fi,Gi=-Di.x,Wi=-Di.y,Ji=-Di.z;Di.x=Gi,Di.y=Wi,Di.z=Ji;var Ui=Di,Oi=this.p,Hi=0==Oi.sizeVec3?new pa.common.Vec3:Oi.stackVec3[--Oi.sizeVec3];Hi.x=r.x,Hi.y=r.y,Hi.z=r.z;var Qi=Hi,Ki=-Qi.x,$i=-Qi.y,ta=-Qi.z;Qi.x=Ki,Qi.y=$i,Qi.z=ta;var ia=Qi,aa=this.p,sa=0==aa.sizeVec3?new pa.common.Vec3:aa.stackVec3[--aa.sizeVec3];sa.x=_.x,sa.y=_.y,sa.z=_.z;var oa=sa,na=-oa.x,ra=-oa.y,ea=-oa.z;oa.x=na,oa.y=ra,oa.z=ea;var _a=oa;this.rect(S,K,kt,xt,Ui,Ui,Ui,Ui,a),this.rect(Ut,Mi,qi,li,o,o,o,o,a),this.rect(S,Ut,li,K,ia,ia,ia,ia,a),this.rect(xt,kt,qi,Mi,r,r,r,r,a),this.rect(S,xt,Mi,Ut,_a,_a,_a,_a,a),this.rect(K,li,qi,kt,_,_,_,_,a);var ha=this.p;if(null!=Ui){if(Ui.zero(),ha.sizeVec3==ha.stackVec3.length){for(var la=ha.sizeVec3<<1,ca=new Array(la),ma=0,va=ha.sizeVec3;ma<va;){var ba=ma++;ca[ba]=ha.stackVec3[ba],ha.stackVec3[ba]=null}ha.stackVec3=ca}ha.stackVec3[ha.sizeVec3++]=Ui}var xa=this.p;if(null!=ia){if(ia.zero(),xa.sizeVec3==xa.stackVec3.length){for(var fa=xa.sizeVec3<<1,ua=new Array(fa),ya=0,da=xa.sizeVec3;ya<da;){var ga=ya++;ua[ga]=xa.stackVec3[ga],xa.stackVec3[ga]=null}xa.stackVec3=ua}xa.stackVec3[xa.sizeVec3++]=ia}var Xa=this.p;if(null!=_a){if(_a.zero(),Xa.sizeVec3==Xa.stackVec3.length){for(var za=Xa.sizeVec3<<1,Ya=new Array(za),Za=0,Ma=Xa.sizeVec3;Za<Ma;){var Ia=Za++;Ya[Ia]=Xa.stackVec3[Ia],Xa.stackVec3[Ia]=null}Xa.stackVec3=Ya}Xa.stackVec3[Xa.sizeVec3++]=_a}}var Va=this.p;if(null!=S){if(S.zero(),Va.sizeVec3==Va.stackVec3.length){for(var wa=Va.sizeVec3<<1,La=new Array(wa),ka=0,Ba=Va.sizeVec3;ka<Ba;){var Aa=ka++;La[Aa]=Va.stackVec3[Aa],Va.stackVec3[Aa]=null}Va.stackVec3=La}Va.stackVec3[Va.sizeVec3++]=S}var Pa=this.p;if(null!=K){if(K.zero(),Pa.sizeVec3==Pa.stackVec3.length){for(var Sa=Pa.sizeVec3<<1,Ta=new Array(Sa),Ca=0,ja=Pa.sizeVec3;Ca<ja;){var Ra=Ca++;Ta[Ra]=Pa.stackVec3[Ra],Pa.stackVec3[Ra]=null}Pa.stackVec3=Ta}Pa.stackVec3[Pa.sizeVec3++]=K}var Ea=this.p;if(null!=xt){if(xt.zero(),Ea.sizeVec3==Ea.stackVec3.length){for(var qa=Ea.sizeVec3<<1,Na=new Array(qa),Fa=0,Da=Ea.sizeVec3;Fa<Da;){var Ga=Fa++;Na[Ga]=Ea.stackVec3[Ga],Ea.stackVec3[Ga]=null}Ea.stackVec3=Na}Ea.stackVec3[Ea.sizeVec3++]=xt}var Wa=this.p;if(null!=kt){if(kt.zero(),Wa.sizeVec3==Wa.stackVec3.length){for(var Ja=Wa.sizeVec3<<1,Ua=new Array(Ja),Oa=0,Ha=Wa.sizeVec3;Oa<Ha;){var Qa=Oa++;Ua[Qa]=Wa.stackVec3[Qa],Wa.stackVec3[Qa]=null}Wa.stackVec3=Ua}Wa.stackVec3[Wa.sizeVec3++]=kt}var Ka=this.p;if(null!=Ut){if(Ut.zero(),Ka.sizeVec3==Ka.stackVec3.length){for(var $a=Ka.sizeVec3<<1,ts=new Array($a),is=0,as=Ka.sizeVec3;is<as;){var ss=is++;ts[ss]=Ka.stackVec3[ss],Ka.stackVec3[ss]=null}Ka.stackVec3=ts}Ka.stackVec3[Ka.sizeVec3++]=Ut}var os=this.p;if(null!=li){if(li.zero(),os.sizeVec3==os.stackVec3.length){for(var ns=os.sizeVec3<<1,rs=new Array(ns),es=0,_s=os.sizeVec3;es<_s;){var hs=es++;rs[hs]=os.stackVec3[hs],os.stackVec3[hs]=null}os.stackVec3=rs}os.stackVec3[os.sizeVec3++]=li}var ls=this.p;if(null!=Mi){if(Mi.zero(),ls.sizeVec3==ls.stackVec3.length){for(var cs=ls.sizeVec3<<1,ms=new Array(cs),vs=0,bs=ls.sizeVec3;vs<bs;){var xs=vs++;ms[xs]=ls.stackVec3[xs],ls.stackVec3[xs]=null}ls.stackVec3=ms}ls.stackVec3[ls.sizeVec3++]=Mi}var ps=this.p;if(null!=qi){if(qi.zero(),ps.sizeVec3==ps.stackVec3.length){for(var fs=ps.sizeVec3<<1,us=new Array(fs),ys=0,ds=ps.sizeVec3;ys<ds;){var gs=ys++;us[gs]=ps.stackVec3[gs],ps.stackVec3[gs]=null}ps.stackVec3=us}ps.stackVec3[ps.sizeVec3++]=qi}var Xs=this.p;if(null!=l){if(l.zero(),Xs.sizeVec3==Xs.stackVec3.length){for(var zs=Xs.sizeVec3<<1,Ys=new Array(zs),Zs=0,Ms=Xs.sizeVec3;Zs<Ms;){var Is=Zs++;Ys[Is]=Xs.stackVec3[Is],Xs.stackVec3[Is]=null}Xs.stackVec3=Ys}Xs.stackVec3[Xs.sizeVec3++]=l}var Vs=this.p;if(null!=m){if(m.e00=1,m.e01=0,m.e02=0,m.e10=0,m.e11=1,m.e12=0,m.e20=0,m.e21=0,m.e22=1,Vs.sizeMat3==Vs.stackMat3.length){for(var ws=Vs.sizeMat3<<1,Ls=new Array(ws),ks=0,Bs=Vs.sizeMat3;ks<Bs;){var As=ks++;Ls[As]=Vs.stackMat3[As],Vs.stackMat3[As]=null}Vs.stackMat3=Ls}Vs.stackMat3[Vs.sizeMat3++]=m}var Ps=this.p;if(null!=o){if(o.zero(),Ps.sizeVec3==Ps.stackVec3.length){for(var Ss=Ps.sizeVec3<<1,Ts=new Array(Ss),Cs=0,js=Ps.sizeVec3;Cs<js;){var Rs=Cs++;Ts[Rs]=Ps.stackVec3[Rs],Ps.stackVec3[Rs]=null}Ps.stackVec3=Ts}Ps.stackVec3[Ps.sizeVec3++]=o}var Es=this.p;if(null!=r){if(r.zero(),Es.sizeVec3==Es.stackVec3.length){for(var qs=Es.sizeVec3<<1,Ns=new Array(qs),Fs=0,Ds=Es.sizeVec3;Fs<Ds;){var Gs=Fs++;Ns[Gs]=Es.stackVec3[Gs],Es.stackVec3[Gs]=null}Es.stackVec3=Ns}Es.stackVec3[Es.sizeVec3++]=r}var Ws=this.p;if(null!=_){if(_.zero(),Ws.sizeVec3==Ws.stackVec3.length){for(var Js=Ws.sizeVec3<<1,Us=new Array(Js),Os=0,Hs=Ws.sizeVec3;Os<Hs;){var Qs=Os++;Us[Qs]=Ws.stackVec3[Qs],Ws.stackVec3[Qs]=null}Ws.stackVec3=Us}Ws.stackVec3[Ws.sizeVec3++]=_}}rect(t,i,a,s,o,n,r,e,_){this.triangle(t,i,a,o,n,r,_),this.triangle(t,a,s,o,r,e,_)}point(t,i){}triangle(t,i,a,s,o,n,r){}line(t,i,a){}},pa.dynamics.common.DebugDrawStyle=class{constructor(){this.basisColorZ=new pa.common.Vec3(0,0,1),this.basisColorY=new pa.common.Vec3(0,1,0),this.basisColorX=new pa.common.Vec3(1,0,0),this.basisLength=.5,this.jointRotationalConstraintRadius=.3,this.jointErrorColor=new pa.common.Vec3(1,.1,.1),this.jointLineColor=new pa.common.Vec3(.8,.8,.8),this.contactBinormalLength=.5,this.contactTangentLength=.5,this.contactNormalLength=.5,this.contactBinormalColor=new pa.common.Vec3(.2,.2,1),this.contactTangentColor=new pa.common.Vec3(.1,.8,.1),this.contactNormalColor=new pa.common.Vec3(1,.1,.1),this.disabledContactColor=new pa.common.Vec3(.5,.1,.1),this.newContactColor=new pa.common.Vec3(1,1,.1),this.contactColor4=new pa.common.Vec3(.8,.1,1),this.contactColor3=new pa.common.Vec3(.1,.8,.6),this.contactColor2=new pa.common.Vec3(1,.6,.1),this.contactColor=new pa.common.Vec3(1,.1,.1),this.pairColor=new pa.common.Vec3(1,1,.1),this.bvhNodeColor=new pa.common.Vec3(.4,.4,.4),this.aabbColor=new pa.common.Vec3(1,.1,.1),this.kinematicShapeColor=new pa.common.Vec3(1,.5,.1),this.staticShapeColor=new pa.common.Vec3(.7,.7,.7),this.sleepingShapeColor2=new pa.common.Vec3(.2,.8,.5),this.sleepingShapeColor1=new pa.common.Vec3(.3,.3,.8),this.sleepyShapeColor2=new pa.common.Vec3(.6,.8,.3),this.sleepyShapeColor1=new pa.common.Vec3(.5,.25,.6),this.shapeColor2=new pa.common.Vec3(1,.8,.1),this.shapeColor1=new pa.common.Vec3(.7,.2,.4)}},pa.dynamics.common.Performance=class{},pa.dynamics.constraint||(pa.dynamics.constraint={}),pa.dynamics.constraint.ConstraintSolver=class{constructor(){this._b1=null,this._b2=null,this._addedToIsland=!1}preSolveVelocity(t){}warmStart(t){}solveVelocity(){}postSolveVelocity(t){}preSolvePosition(t){}solvePositionSplitImpulse(){}solvePositionNgs(t){}postSolve(){}},pa.dynamics.constraint.PositionCorrectionAlgorithm=class{},pa.dynamics.constraint.contact||(pa.dynamics.constraint.contact={}),pa.dynamics.constraint.contact.ContactConstraint=class{constructor(t){this._solver=new pa.dynamics.constraint.solver.pgs.PgsContactConstraintSolver(this),this._manifold=t}_getVelocitySolverInfo(t,i){var a,s,o,n,r,e,_,h,l;i.b1=this._b1,i.b2=this._b2,a=this._manifold._normalX,s=this._manifold._normalY,o=this._manifold._normalZ,n=this._manifold._tangentX,r=this._manifold._tangentY,e=this._manifold._tangentZ,_=this._manifold._binormalX,h=this._manifold._binormalY,l=this._manifold._binormalZ;var c=Math.sqrt(this._s1._friction*this._s2._friction),m=Math.sqrt(this._s1._restitution*this._s2._restitution),v=this._manifold._numPoints;i.numRows=0,this._tf1._positionX,this._tf2._positionX,this._tf1._positionY,this._tf2._positionY,this._tf1._positionZ,this._tf2._positionZ;for(var b=0,x=v;b<x;){var p=b++,f=this._manifold._points[p];if(f._depth<0){f._disabled=!0;var u=f._impulse;u.impulseN=0,u.impulseT=0,u.impulseB=0,u.impulseP=0,u.impulseLX=0,u.impulseLY=0,u.impulseLZ=0}else{f._disabled=!1;var y=i.rows[i.numRows++];y.friction=c,y.cfm=0;var d=y.jacobianN;d.lin1X=a,d.lin1Y=s,d.lin1Z=o,d.lin2X=a,d.lin2Y=s,d.lin2Z=o,d.ang1X=f._relPos1Y*o-f._relPos1Z*s,d.ang1Y=f._relPos1Z*a-f._relPos1X*o,d.ang1Z=f._relPos1X*s-f._relPos1Y*a,d.ang2X=f._relPos2Y*o-f._relPos2Z*s,d.ang2Y=f._relPos2Z*a-f._relPos2X*o,d.ang2Z=f._relPos2X*s-f._relPos2Y*a,(d=y.jacobianT).lin1X=n,d.lin1Y=r,d.lin1Z=e,d.lin2X=n,d.lin2Y=r,d.lin2Z=e,d.ang1X=f._relPos1Y*e-f._relPos1Z*r,d.ang1Y=f._relPos1Z*n-f._relPos1X*e,d.ang1Z=f._relPos1X*r-f._relPos1Y*n,d.ang2X=f._relPos2Y*e-f._relPos2Z*r,d.ang2Y=f._relPos2Z*n-f._relPos2X*e,d.ang2Z=f._relPos2X*r-f._relPos2Y*n,(d=y.jacobianB).lin1X=_,d.lin1Y=h,d.lin1Z=l,d.lin2X=_,d.lin2Y=h,d.lin2Z=l,d.ang1X=f._relPos1Y*l-f._relPos1Z*h,d.ang1Y=f._relPos1Z*_-f._relPos1X*l,d.ang1Z=f._relPos1X*h-f._relPos1Y*_,d.ang2X=f._relPos2Y*l-f._relPos2Z*h,d.ang2Y=f._relPos2Z*_-f._relPos2X*l,d.ang2Z=f._relPos2X*h-f._relPos2Y*_;var g=(d=y.jacobianN).lin1X*this._b1._velX+d.lin1Y*this._b1._velY+d.lin1Z*this._b1._velZ+(d.ang1X*this._b1._angVelX+d.ang1Y*this._b1._angVelY+d.ang1Z*this._b1._angVelZ)-(d.lin2X*this._b2._velX+d.lin2Y*this._b2._velY+d.lin2Z*this._b2._velZ+(d.ang2X*this._b2._angVelX+d.ang2Y*this._b2._angVelY+d.ang2Z*this._b2._angVelZ));if(g<-pa.common.Setting.contactEnableBounceThreshold&&!f._warmStarted?y.rhs=-g*m:y.rhs=0,this._positionCorrectionAlgorithm==pa.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE&&f._depth>pa.common.Setting.linearSlop){var X=(f._depth-pa.common.Setting.linearSlop)*pa.common.Setting.velocityBaumgarte*t.invDt;y.rhs<X&&(y.rhs=X)}if(!f._warmStarted){var z=f._impulse;z.impulseN=0,z.impulseT=0,z.impulseB=0,z.impulseP=0,z.impulseLX=0,z.impulseLY=0,z.impulseLZ=0}y.impulse=f._impulse}}}_getPositionSolverInfo(t){var i,a,s;t.b1=this._b1,t.b2=this._b2,i=this._manifold._normalX,a=this._manifold._normalY,s=this._manifold._normalZ;var o=this._manifold._numPoints;t.numRows=0;for(var n=0,r=o;n<r;){var e=n++,_=this._manifold._points[e];if(!_._disabled){var h=t.rows[t.numRows++],l=h.jacobianN;l.lin1X=i,l.lin1Y=a,l.lin1Z=s,l.lin2X=i,l.lin2Y=a,l.lin2Z=s,l.ang1X=_._relPos1Y*s-_._relPos1Z*a,l.ang1Y=_._relPos1Z*i-_._relPos1X*s,l.ang1Z=_._relPos1X*a-_._relPos1Y*i,l.ang2X=_._relPos2Y*s-_._relPos2Z*a,l.ang2Y=_._relPos2Z*i-_._relPos2X*s,l.ang2Z=_._relPos2X*a-_._relPos2Y*i,h.rhs=_._depth-pa.common.Setting.linearSlop,h.rhs<0&&(h.rhs=0),h.impulse=_._impulse}}}_syncManifold(){this._manifold._updateDepthsAndPositions(this._tf1,this._tf2)}getShape1(){return this._s1}getShape2(){return this._s2}getManifold(){return this._manifold}isTouching(){for(var t=0,i=this._manifold._numPoints;t<i;){var a=t++;if(this._manifold._points[a]._depth>=0)return!0}return!1}},pa.dynamics.constraint.contact.ContactImpulse=class{constructor(){this.impulseN=0,this.impulseT=0,this.impulseB=0,this.impulseP=0,this.impulseLX=0,this.impulseLY=0,this.impulseLZ=0}copyFrom(t){this.impulseN=t.impulseN,this.impulseT=t.impulseT,this.impulseB=t.impulseB,this.impulseLX=t.impulseLX,this.impulseLY=t.impulseLY,this.impulseLZ=t.impulseLZ}},pa.dynamics.constraint.contact.Manifold=class{constructor(){this._normalX=0,this._normalY=0,this._normalZ=0,this._tangentX=0,this._tangentY=0,this._tangentZ=0,this._binormalX=0,this._binormalY=0,this._binormalZ=0,this._numPoints=0;var t=new Array(pa.common.Setting.maxManifoldPoints);this._points=t;for(var i=0,a=pa.common.Setting.maxManifoldPoints;i<a;){var s=i++;this._points[s]=new pa.dynamics.constraint.contact.ManifoldPoint}}_clear(){for(var t=0,i=this._numPoints;t<i;){var a=t++,s=this._points[a];s._localPos1X=0,s._localPos1Y=0,s._localPos1Z=0,s._localPos2X=0,s._localPos2Y=0,s._localPos2Z=0,s._relPos1X=0,s._relPos1Y=0,s._relPos1Z=0,s._relPos2X=0,s._relPos2Y=0,s._relPos2Z=0,s._pos1X=0,s._pos1Y=0,s._pos1Z=0,s._pos2X=0,s._pos2Y=0,s._pos2Z=0,s._depth=0;var o=s._impulse;o.impulseN=0,o.impulseT=0,o.impulseB=0,o.impulseP=0,o.impulseLX=0,o.impulseLY=0,o.impulseLZ=0,s._warmStarted=!1,s._disabled=!1,s._id=-1}this._numPoints=0}_buildBasis(t){var i=t;this._normalX=i.x,this._normalY=i.y,this._normalZ=i.z;var a,s,o,n,r,e,_=t.x,h=t.y,l=t.z,c=_*_,m=h*h,v=l*l;if(c<m)if(c<v){var b=1/Math.sqrt(m+v);a=0,n=h*(o=h*b)-l*(s=-l*b),r=-_*o,e=_*s}else{var x=1/Math.sqrt(c+m);o=0,n=-l*(s=_*x),r=l*(a=-h*x),e=_*s-h*a}else if(m<v){var p=1/Math.sqrt(c+v);s=0,n=h*(o=-_*p),r=l*(a=l*p)-_*o,e=-h*a}else{var f=1/Math.sqrt(c+m);o=0,n=-l*(s=_*f),r=l*(a=-h*f),e=_*s-h*a}this._tangentX=a,this._tangentY=s,this._tangentZ=o,this._binormalX=n,this._binormalY=r,this._binormalZ=e}_updateDepthsAndPositions(t,i){for(var a=0,s=this._numPoints;a<s;){var o,n,r,e,_,h,l,c,m,v=a++,b=this._points[v];o=t._rotation00*b._localPos1X+t._rotation01*b._localPos1Y+t._rotation02*b._localPos1Z,n=t._rotation10*b._localPos1X+t._rotation11*b._localPos1Y+t._rotation12*b._localPos1Z,r=t._rotation20*b._localPos1X+t._rotation21*b._localPos1Y+t._rotation22*b._localPos1Z,b._relPos1X=o,b._relPos1Y=n,b._relPos1Z=r,e=i._rotation00*b._localPos2X+i._rotation01*b._localPos2Y+i._rotation02*b._localPos2Z,_=i._rotation10*b._localPos2X+i._rotation11*b._localPos2Y+i._rotation12*b._localPos2Z,h=i._rotation20*b._localPos2X+i._rotation21*b._localPos2Y+i._rotation22*b._localPos2Z,b._relPos2X=e,b._relPos2Y=_,b._relPos2Z=h,b._pos1X=b._relPos1X+t._positionX,b._pos1Y=b._relPos1Y+t._positionY,b._pos1Z=b._relPos1Z+t._positionZ,b._pos2X=b._relPos2X+i._positionX,b._pos2Y=b._relPos2Y+i._positionY,b._pos2Z=b._relPos2Z+i._positionZ,l=b._pos1X-b._pos2X,c=b._pos1Y-b._pos2Y,m=b._pos1Z-b._pos2Z;var x=l*this._normalX+c*this._normalY+m*this._normalZ;b._depth=-x}}getNormal(){var t=new pa.common.Vec3,i=t;return i.x=this._normalX,i.y=this._normalY,i.z=this._normalZ,t}getNormalTo(t){var i=t;i.x=this._normalX,i.y=this._normalY,i.z=this._normalZ}getTangent(){var t=new pa.common.Vec3,i=t;return i.x=this._tangentX,i.y=this._tangentY,i.z=this._tangentZ,t}getTangentTo(t){var i=t;i.x=this._tangentX,i.y=this._tangentY,i.z=this._tangentZ}getBinormal(){var t=new pa.common.Vec3,i=t;return i.x=this._binormalX,i.y=this._binormalY,i.z=this._binormalZ,t}getBinormalTo(t){var i=t;i.x=this._binormalX,i.y=this._binormalY,i.z=this._binormalZ}getPoints(){return this._points}getNumPoints(){return this._numPoints}},pa.dynamics.constraint.contact.ManifoldPoint=class{constructor(){this._localPos1X=0,this._localPos1Y=0,this._localPos1Z=0,this._localPos2X=0,this._localPos2Y=0,this._localPos2Z=0,this._relPos1X=0,this._relPos1Y=0,this._relPos1Z=0,this._relPos2X=0,this._relPos2Y=0,this._relPos2Z=0,this._pos1X=0,this._pos1Y=0,this._pos1Z=0,this._pos2X=0,this._pos2Y=0,this._pos2Z=0,this._depth=0,this._impulse=new pa.dynamics.constraint.contact.ContactImpulse,this._warmStarted=!1,this._disabled=!1,this._id=-1}getPosition1(){var t=new pa.common.Vec3,i=t;return i.x=this._pos1X,i.y=this._pos1Y,i.z=this._pos1Z,t}getPosition1To(t){var i=t;i.x=this._pos1X,i.y=this._pos1Y,i.z=this._pos1Z}getPosition2(){var t=new pa.common.Vec3,i=t;return i.x=this._pos2X,i.y=this._pos2Y,i.z=this._pos2Z,t}getPosition2To(t){var i=t;i.x=this._pos2X,i.y=this._pos2Y,i.z=this._pos2Z}getDepth(){return this._depth}isWarmStarted(){return this._warmStarted}getNormalImpulse(){return this._impulse.impulseN}getTangentImpulse(){return this._impulse.impulseT}getBinormalImpulse(){return this._impulse.impulseB}isEnabled(){return!this._disabled}},pa.dynamics.constraint.contact.ManifoldUpdater=class{constructor(t){this._manifold=t,this.numOldPoints=0;var i=new Array(pa.common.Setting.maxManifoldPoints);this.oldPoints=i;for(var a=0,s=pa.common.Setting.maxManifoldPoints;a<s;){var o=a++;this.oldPoints[o]=new pa.dynamics.constraint.contact.ManifoldPoint}}removeOutdatedPoints(){for(var t=this._manifold._numPoints;--t>=0;){var i,a,s,o=this._manifold._points[t];i=o._pos1X-o._pos2X,a=o._pos1Y-o._pos2Y,s=o._pos1Z-o._pos2Z;var n=this._manifold._normalX*i+this._manifold._normalY*a+this._manifold._normalZ*s;n>pa.common.Setting.contactPersistenceThreshold?this.removeManifoldPoint(t):(i+=this._manifold._normalX*-n)*i+(a+=this._manifold._normalY*-n)*a+(s+=this._manifold._normalZ*-n)*s>pa.common.Setting.contactPersistenceThreshold*pa.common.Setting.contactPersistenceThreshold&&this.removeManifoldPoint(t)}}removeManifoldPoint(t){var i=--this._manifold._numPoints;if(t!=i){var a=this._manifold._points[t];this._manifold._points[t]=this._manifold._points[i],this._manifold._points[i]=a}var s=this._manifold._points[i];s._localPos1X=0,s._localPos1Y=0,s._localPos1Z=0,s._localPos2X=0,s._localPos2Y=0,s._localPos2Z=0,s._relPos1X=0,s._relPos1Y=0,s._relPos1Z=0,s._relPos2X=0,s._relPos2Y=0,s._relPos2Z=0,s._pos1X=0,s._pos1Y=0,s._pos1Z=0,s._pos2X=0,s._pos2Y=0,s._pos2Z=0,s._depth=0;var o=s._impulse;o.impulseN=0,o.impulseT=0,o.impulseB=0,o.impulseP=0,o.impulseLX=0,o.impulseLY=0,o.impulseLZ=0,s._warmStarted=!1,s._disabled=!1,s._id=-1}addManifoldPoint(t,i,a){var s=this._manifold._numPoints;if(s==pa.common.Setting.maxManifoldPoints){var o=this.computeTargetIndex(t,i,a),n=this._manifold._points[o],r=t.position1;n._pos1X=r.x,n._pos1Y=r.y,n._pos1Z=r.z;var e,_,h,l,c,m,v=t.position2;n._pos2X=v.x,n._pos2Y=v.y,n._pos2Z=v.z,n._relPos1X=n._pos1X-i._positionX,n._relPos1Y=n._pos1Y-i._positionY,n._relPos1Z=n._pos1Z-i._positionZ,n._relPos2X=n._pos2X-a._positionX,n._relPos2Y=n._pos2Y-a._positionY,n._relPos2Z=n._pos2Z-a._positionZ,e=i._rotation00*n._relPos1X+i._rotation10*n._relPos1Y+i._rotation20*n._relPos1Z,_=i._rotation01*n._relPos1X+i._rotation11*n._relPos1Y+i._rotation21*n._relPos1Z,h=i._rotation02*n._relPos1X+i._rotation12*n._relPos1Y+i._rotation22*n._relPos1Z,n._localPos1X=e,n._localPos1Y=_,n._localPos1Z=h,l=a._rotation00*n._relPos2X+a._rotation10*n._relPos2Y+a._rotation20*n._relPos2Z,c=a._rotation01*n._relPos2X+a._rotation11*n._relPos2Y+a._rotation21*n._relPos2Z,m=a._rotation02*n._relPos2X+a._rotation12*n._relPos2Y+a._rotation22*n._relPos2Z,n._localPos2X=l,n._localPos2Y=c,n._localPos2Z=m,n._depth=t.depth;var b=n._impulse;return b.impulseN=0,b.impulseT=0,b.impulseB=0,b.impulseP=0,b.impulseLX=0,b.impulseLY=0,b.impulseLZ=0,n._id=t.id,n._warmStarted=!1,void(n._disabled=!1)}var x=this._manifold._points[s],p=t.position1;x._pos1X=p.x,x._pos1Y=p.y,x._pos1Z=p.z;var f,u,y,d,g,X,z=t.position2;x._pos2X=z.x,x._pos2Y=z.y,x._pos2Z=z.z,x._relPos1X=x._pos1X-i._positionX,x._relPos1Y=x._pos1Y-i._positionY,x._relPos1Z=x._pos1Z-i._positionZ,x._relPos2X=x._pos2X-a._positionX,x._relPos2Y=x._pos2Y-a._positionY,x._relPos2Z=x._pos2Z-a._positionZ,f=i._rotation00*x._relPos1X+i._rotation10*x._relPos1Y+i._rotation20*x._relPos1Z,u=i._rotation01*x._relPos1X+i._rotation11*x._relPos1Y+i._rotation21*x._relPos1Z,y=i._rotation02*x._relPos1X+i._rotation12*x._relPos1Y+i._rotation22*x._relPos1Z,x._localPos1X=f,x._localPos1Y=u,x._localPos1Z=y,d=a._rotation00*x._relPos2X+a._rotation10*x._relPos2Y+a._rotation20*x._relPos2Z,g=a._rotation01*x._relPos2X+a._rotation11*x._relPos2Y+a._rotation21*x._relPos2Z,X=a._rotation02*x._relPos2X+a._rotation12*x._relPos2Y+a._rotation22*x._relPos2Z,x._localPos2X=d,x._localPos2Y=g,x._localPos2Z=X,x._depth=t.depth;var Y=x._impulse;Y.impulseN=0,Y.impulseT=0,Y.impulseB=0,Y.impulseP=0,Y.impulseLX=0,Y.impulseLY=0,Y.impulseLZ=0,x._id=t.id,x._warmStarted=!1,x._disabled=!1,this._manifold._numPoints++}computeTargetIndex(t,i,a){var s,o,n,r=this._manifold._points[0],e=this._manifold._points[1],_=this._manifold._points[2],h=this._manifold._points[3],l=r._depth,c=0;e._depth>l&&(l=e._depth,c=1),_._depth>l&&(l=_._depth,c=2),h._depth>l&&(l=h._depth,c=3);var m=t.position1;s=m.x,o=m.y,n=m.z,s-=i._positionX,o-=i._positionY,n-=i._positionZ;var v,b,x,p,f,u,y,d,g,X,z,Y,Z,M,I,V,w,L,k,B,A,P,S,T,C,j,R,E,q,N,F,D,G,W,J,U,O,H,Q,K,$,tt,it,at,st,ot,nt,rt,et,_t,ht,lt,ct,mt,vt,bt,xt,pt,ft,ut,yt,dt,gt,Xt,zt,Yt,Zt,Mt,It,Vt,wt,Lt,kt,Bt,At,Pt,St,Tt,Ct,jt,Rt,Et,qt,Nt,Ft,Dt,Gt,Wt,Jt,Ut,Ot,Ht,Qt,Kt,$t,ti,ii,ai,si,oi,ni,ri,ei,_i,hi,li,ci,mi,vi=e._relPos1X,bi=e._relPos1Y,xi=e._relPos1Z,pi=_._relPos1X,fi=_._relPos1Y,ui=_._relPos1Z,yi=h._relPos1X,di=h._relPos1Y,gi=h._relPos1Z,Xi=(k=(b=fi-bi)*(u=n-gi)-(x=ui-xi)*(f=o-di))*k+(B=x*(p=s-yi)-(v=pi-vi)*u)*B+(A=v*f-b*p)*A,zi=(P=(d=di-bi)*(Y=n-ui)-(g=gi-xi)*(z=o-fi))*P+(S=g*(X=s-pi)-(y=yi-vi)*Y)*S+(T=y*z-d*X)*T,Yi=(C=(M=o-bi)*(L=gi-ui)-(I=n-xi)*(w=di-fi))*C+(j=I*(V=yi-pi)-(Z=s-vi)*L)*j+(R=Z*w-M*V)*R,Zi=Xi>zi?Xi>Yi?Xi:Yi:zi>Yi?zi:Yi,Mi=r._relPos1X,Ii=r._relPos1Y,Vi=r._relPos1Z,wi=_._relPos1X,Li=_._relPos1Y,ki=_._relPos1Z,Bi=h._relPos1X,Ai=h._relPos1Y,Pi=h._relPos1Z,Si=(ot=(q=Li-Ii)*(G=n-Pi)-(N=ki-Vi)*(D=o-Ai))*ot+(nt=N*(F=s-Bi)-(E=wi-Mi)*G)*nt+(rt=E*D-q*F)*rt,Ti=(et=(J=Ai-Ii)*(Q=n-ki)-(U=Pi-Vi)*(H=o-Li))*et+(_t=U*(O=s-wi)-(W=Bi-Mi)*Q)*_t+(ht=W*H-J*O)*ht,Ci=(lt=($=o-Ii)*(st=Pi-ki)-(tt=n-Vi)*(at=Ai-Li))*lt+(ct=tt*(it=Bi-wi)-(K=s-Mi)*st)*ct+(mt=K*at-$*it)*mt,ji=Si>Ti?Si>Ci?Si:Ci:Ti>Ci?Ti:Ci,Ri=r._relPos1X,Ei=r._relPos1Y,qi=r._relPos1Z,Ni=e._relPos1X,Fi=e._relPos1Y,Di=e._relPos1Z,Gi=h._relPos1X,Wi=h._relPos1Y,Ji=h._relPos1Z,Ui=(kt=(bt=Fi-Ei)*(ut=n-Ji)-(xt=Di-qi)*(ft=o-Wi))*kt+(Bt=xt*(pt=s-Gi)-(vt=Ni-Ri)*ut)*Bt+(At=vt*ft-bt*pt)*At,Oi=(Pt=(dt=Wi-Ei)*(Yt=n-Di)-(gt=Ji-qi)*(zt=o-Fi))*Pt+(St=gt*(Xt=s-Ni)-(yt=Gi-Ri)*Yt)*St+(Tt=yt*zt-dt*Xt)*Tt,Hi=(Ct=(Mt=o-Ei)*(Lt=Ji-Di)-(It=n-qi)*(wt=Wi-Fi))*Ct+(jt=It*(Vt=Gi-Ni)-(Zt=s-Ri)*Lt)*jt+(Rt=Zt*wt-Mt*Vt)*Rt,Qi=Ui>Oi?Ui>Hi?Ui:Hi:Oi>Hi?Oi:Hi,Ki=r._relPos1X,$i=r._relPos1Y,ta=r._relPos1Z,ia=e._relPos1X,aa=e._relPos1Y,sa=e._relPos1Z,oa=_._relPos1X,na=_._relPos1Y,ra=_._relPos1Z,ea=(oi=(qt=aa-$i)*(Gt=n-ra)-(Nt=sa-ta)*(Dt=o-na))*oi+(ni=Nt*(Ft=s-oa)-(Et=ia-Ki)*Gt)*ni+(ri=Et*Dt-qt*Ft)*ri,_a=(ei=(Jt=na-$i)*(Qt=n-sa)-(Ut=ra-ta)*(Ht=o-aa))*ei+(_i=Ut*(Ot=s-ia)-(Wt=oa-Ki)*Qt)*_i+(hi=Wt*Ht-Jt*Ot)*hi,ha=(li=($t=o-$i)*(si=ra-sa)-(ti=n-ta)*(ai=na-aa))*li+(ci=ti*(ii=oa-ia)-(Kt=s-Ki)*si)*ci+(mi=Kt*ai-$t*ii)*mi,la=ea>_a?ea>ha?ea:ha:_a>ha?_a:ha,ca=Zi,ma=0;return(ji>ca&&1!=c||0==c)&&(ca=ji,ma=1),Qi>ca&&2!=c&&(ca=Qi,ma=2),la>ca&&3!=c&&(ca=la,ma=3),ma}computeRelativePositions(t,i){for(var a=0,s=this._manifold._numPoints;a<s;){var o,n,r,e,_,h,l=a++,c=this._manifold._points[l];o=t._rotation00*c._localPos1X+t._rotation01*c._localPos1Y+t._rotation02*c._localPos1Z,n=t._rotation10*c._localPos1X+t._rotation11*c._localPos1Y+t._rotation12*c._localPos1Z,r=t._rotation20*c._localPos1X+t._rotation21*c._localPos1Y+t._rotation22*c._localPos1Z,c._relPos1X=o,c._relPos1Y=n,c._relPos1Z=r,e=i._rotation00*c._localPos2X+i._rotation01*c._localPos2Y+i._rotation02*c._localPos2Z,_=i._rotation10*c._localPos2X+i._rotation11*c._localPos2Y+i._rotation12*c._localPos2Z,h=i._rotation20*c._localPos2X+i._rotation21*c._localPos2Y+i._rotation22*c._localPos2Z,c._relPos2X=e,c._relPos2Y=_,c._relPos2Z=h,c._warmStarted=!0}}findNearestContactPointIndex(t,i,a){for(var s=pa.common.Setting.contactPersistenceThreshold*pa.common.Setting.contactPersistenceThreshold,o=-1,n=0,r=this._manifold._numPoints;n<r;){var e,_,h,l,c,m,v=n++,b=this._manifold._points[v],x=t.position1;e=x.x,_=x.y,h=x.z;var p,f,u,y,d,g,X=t.position2;l=X.x,c=X.y,m=X.z,e-=i._positionX,_-=i._positionY,h-=i._positionZ,l-=a._positionX,c-=a._positionY,m-=a._positionZ;var z=(p=b._relPos1X-e)*p+(f=b._relPos1Y-_)*f+(u=b._relPos1Z-h)*u,Y=(y=b._relPos2X-l)*y+(d=b._relPos2Y-c)*d+(g=b._relPos2Z-m)*g,Z=z<Y?z:Y;Z<s&&(s=Z,o=v)}return o}totalUpdate(t,i,a){this.numOldPoints=this._manifold._numPoints;for(var s=0,o=this.numOldPoints;s<o;){var n=s++,r=this.oldPoints[n],e=this._manifold._points[n];r._localPos1X=e._localPos1X,r._localPos1Y=e._localPos1Y,r._localPos1Z=e._localPos1Z,r._localPos2X=e._localPos2X,r._localPos2Y=e._localPos2Y,r._localPos2Z=e._localPos2Z,r._relPos1X=e._relPos1X,r._relPos1Y=e._relPos1Y,r._relPos1Z=e._relPos1Z,r._relPos2X=e._relPos2X,r._relPos2Y=e._relPos2Y,r._relPos2Z=e._relPos2Z,r._pos1X=e._pos1X,r._pos1Y=e._pos1Y,r._pos1Z=e._pos1Z,r._pos2X=e._pos2X,r._pos2Y=e._pos2Y,r._pos2Z=e._pos2Z,r._depth=e._depth,r._impulse.copyFrom(e._impulse),r._id=e._id,r._warmStarted=e._warmStarted,r._disabled=!1}var _=t.numPoints;this._manifold._numPoints=_;for(var h=0,l=_;h<l;){var c=h++,m=this._manifold._points[c],v=t.points[c],b=v.position1;m._pos1X=b.x,m._pos1Y=b.y,m._pos1Z=b.z;var x,p,f,u,y,d,g=v.position2;m._pos2X=g.x,m._pos2Y=g.y,m._pos2Z=g.z,m._relPos1X=m._pos1X-i._positionX,m._relPos1Y=m._pos1Y-i._positionY,m._relPos1Z=m._pos1Z-i._positionZ,m._relPos2X=m._pos2X-a._positionX,m._relPos2Y=m._pos2Y-a._positionY,m._relPos2Z=m._pos2Z-a._positionZ,x=i._rotation00*m._relPos1X+i._rotation10*m._relPos1Y+i._rotation20*m._relPos1Z,p=i._rotation01*m._relPos1X+i._rotation11*m._relPos1Y+i._rotation21*m._relPos1Z,f=i._rotation02*m._relPos1X+i._rotation12*m._relPos1Y+i._rotation22*m._relPos1Z,m._localPos1X=x,m._localPos1Y=p,m._localPos1Z=f,u=a._rotation00*m._relPos2X+a._rotation10*m._relPos2Y+a._rotation20*m._relPos2Z,y=a._rotation01*m._relPos2X+a._rotation11*m._relPos2Y+a._rotation21*m._relPos2Z,d=a._rotation02*m._relPos2X+a._rotation12*m._relPos2Y+a._rotation22*m._relPos2Z,m._localPos2X=u,m._localPos2Y=y,m._localPos2Z=d,m._depth=v.depth;var X=m._impulse;X.impulseN=0,X.impulseT=0,X.impulseB=0,X.impulseP=0,X.impulseLX=0,X.impulseLY=0,X.impulseLZ=0,m._id=v.id,m._warmStarted=!1,m._disabled=!1;for(var z=0,Y=this.numOldPoints;z<Y;){var Z=z++,M=this.oldPoints[Z];if(m._id==M._id){m._impulse.copyFrom(M._impulse),m._warmStarted=!0;break}}}}incrementalUpdate(t,i,a){this._manifold._updateDepthsAndPositions(i,a);for(var s=0,o=this._manifold._numPoints;s<o;){var n=s++;this._manifold._points[n]._warmStarted=!0}var r=t.points[0],e=this.findNearestContactPointIndex(r,i,a);if(-1==e)this.addManifoldPoint(r,i,a);else{var _=this._manifold._points[e],h=r.position1;_._pos1X=h.x,_._pos1Y=h.y,_._pos1Z=h.z;var l,c,m,v,b,x,p=r.position2;_._pos2X=p.x,_._pos2Y=p.y,_._pos2Z=p.z,_._relPos1X=_._pos1X-i._positionX,_._relPos1Y=_._pos1Y-i._positionY,_._relPos1Z=_._pos1Z-i._positionZ,_._relPos2X=_._pos2X-a._positionX,_._relPos2Y=_._pos2Y-a._positionY,_._relPos2Z=_._pos2Z-a._positionZ,l=i._rotation00*_._relPos1X+i._rotation10*_._relPos1Y+i._rotation20*_._relPos1Z,c=i._rotation01*_._relPos1X+i._rotation11*_._relPos1Y+i._rotation21*_._relPos1Z,m=i._rotation02*_._relPos1X+i._rotation12*_._relPos1Y+i._rotation22*_._relPos1Z,_._localPos1X=l,_._localPos1Y=c,_._localPos1Z=m,v=a._rotation00*_._relPos2X+a._rotation10*_._relPos2Y+a._rotation20*_._relPos2Z,b=a._rotation01*_._relPos2X+a._rotation11*_._relPos2Y+a._rotation21*_._relPos2Z,x=a._rotation02*_._relPos2X+a._rotation12*_._relPos2Y+a._rotation22*_._relPos2Z,_._localPos2X=v,_._localPos2Y=b,_._localPos2Z=x,_._depth=r.depth}this.removeOutdatedPoints()}},pa.dynamics.constraint.info||(pa.dynamics.constraint.info={}),pa.dynamics.constraint.info.JacobianRow=class{constructor(){this.lin1X=0,this.lin1Y=0,this.lin1Z=0,this.lin2X=0,this.lin2Y=0,this.lin2Z=0,this.ang1X=0,this.ang1Y=0,this.ang1Z=0,this.ang2X=0,this.ang2Y=0,this.ang2Z=0,this.flag=0}updateSparsity(){this.flag=0,0==this.lin1X&&0==this.lin1Y&&0==this.lin1Z&&0==this.lin2X&&0==this.lin2Y&&0==this.lin2Z||(this.flag|=1),0==this.ang1X&&0==this.ang1Y&&0==this.ang1Z&&0==this.ang2X&&0==this.ang2Y&&0==this.ang2Z||(this.flag|=2)}},pa.dynamics.constraint.info.contact||(pa.dynamics.constraint.info.contact={}),pa.dynamics.constraint.info.contact.ContactSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0;var t=new Array(pa.common.Setting.maxManifoldPoints);this.rows=t;for(var i=0,a=this.rows.length;i<a;){var s=i++;this.rows[s]=new pa.dynamics.constraint.info.contact.ContactSolverInfoRow}}},pa.dynamics.constraint.info.contact.ContactSolverInfoRow=class{constructor(){this.jacobianN=new pa.dynamics.constraint.info.JacobianRow,this.jacobianT=new pa.dynamics.constraint.info.JacobianRow,this.jacobianB=new pa.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.friction=0,this.impulse=null}},pa.dynamics.constraint.info.joint||(pa.dynamics.constraint.info.joint={}),pa.dynamics.constraint.info.joint.JointSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0;var t=new Array(pa.common.Setting.maxJacobianRows);this.rows=t;for(var i=0,a=this.rows.length;i<a;){var s=i++;this.rows[s]=new pa.dynamics.constraint.info.joint.JointSolverInfoRow}}},pa.dynamics.constraint.info.joint.JointSolverInfoRow=class{constructor(){this.jacobian=new pa.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.minImpulse=0,this.maxImpulse=0,this.motorSpeed=0,this.motorMaxImpulse=0,this.impulse=null}},pa.dynamics.constraint.joint||(pa.dynamics.constraint.joint={}),pa.dynamics.constraint.joint.BasisTracker=class{constructor(t){this.joint=t,this.xX=0,this.xY=0,this.xZ=0,this.yX=0,this.yY=0,this.yZ=0,this.zX=0,this.zY=0,this.zZ=0}},pa.dynamics.constraint.joint.Joint=class{constructor(t,i){switch(this._link1=new pa.dynamics.constraint.joint.JointLink(this),this._link2=new pa.dynamics.constraint.joint.JointLink(this),this._positionCorrectionAlgorithm=pa.common.Setting.defaultJointPositionCorrectionAlgorithm,this._type=i,this._world=null,this._b1=t.rigidBody1,this._b2=t.rigidBody2,this._allowCollision=t.allowCollision,this._breakForce=t.breakForce,this._breakTorque=t.breakTorque,t.solverType){case 0:this._solver=new pa.dynamics.constraint.solver.pgs.PgsJointConstraintSolver(this);break;case 1:this._solver=new pa.dynamics.constraint.solver.direct.DirectJointConstraintSolver(this)}var a=t.localAnchor1;this._localAnchor1X=a.x,this._localAnchor1Y=a.y,this._localAnchor1Z=a.z;var s=t.localAnchor2;this._localAnchor2X=s.x,this._localAnchor2Y=s.y,this._localAnchor2Z=s.z,this._relativeAnchor1X=0,this._relativeAnchor1Y=0,this._relativeAnchor1Z=0,this._relativeAnchor2X=0,this._relativeAnchor2Y=0,this._relativeAnchor2Z=0,this._anchor1X=0,this._anchor1Y=0,this._anchor1Z=0,this._anchor2X=0,this._anchor2Y=0,this._anchor2Z=0,this._localBasisX1X=0,this._localBasisX1Y=0,this._localBasisX1Z=0,this._localBasisY1X=0,this._localBasisY1Y=0,this._localBasisY1Z=0,this._localBasisZ1X=0,this._localBasisZ1Y=0,this._localBasisZ1Z=0,this._localBasisX2X=0,this._localBasisX2Y=0,this._localBasisX2Z=0,this._localBasisY2X=0,this._localBasisY2Y=0,this._localBasisY2Z=0,this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=0;var o=new Array(pa.common.Setting.maxJacobianRows);this._impulses=o;for(var n=0,r=pa.common.Setting.maxJacobianRows;n<r;){var e=n++;this._impulses[e]=new pa.dynamics.constraint.joint.JointImpulse}}buildLocalBasesFromX(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{var i=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;i>0&&(i=1/Math.sqrt(i)),this._localBasisX2X*=i,this._localBasisX2Y*=i,this._localBasisX2Z*=i}var a,s,o,n,r,e,_,h,l,c,m,v,b,x=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(x<-.999999999){var p,f,u,y,d=this._localBasisX1X,g=this._localBasisX1Y,X=this._localBasisX1Z,z=d*d,Y=g*g,Z=X*X;z<Y?z<Z?(p=0,f=X*(y=1/Math.sqrt(Y+Z)),u=-g*y):(p=g*(y=1/Math.sqrt(z+Y)),f=-d*y,u=0):Y<Z?(p=-X*(y=1/Math.sqrt(Z+z)),f=0,u=d*y):(p=g*(y=1/Math.sqrt(z+Y)),f=-d*y,u=0),a=p,s=f,o=u,n=0}else{var M,I,V;M=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,I=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,V=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var w=Math.sqrt(.5*(1+x));a=M*=x=.5/w,s=I*=x,o=V*=x,n=w}var L=2*a,k=2*s,B=2*o,A=a*L,P=s*k,S=o*B,T=a*k,C=s*B,j=a*B,R=n*L,E=n*k,q=n*B;r=1-P-S,e=T-q,_=j+E,h=T+q,l=1-A-S,c=C-R,m=j-E,v=C+R,b=1-A-P;var N,F,D,G,W,J,U,O,H,Q,K=this._localBasisX1X,$=this._localBasisX1Y,tt=this._localBasisX1Z,it=K*K,at=$*$,st=tt*tt;it<at?it<st?(N=1/Math.sqrt(at+st),this._localBasisY1X=0,this._localBasisY1Y=tt*N,this._localBasisY1Z=-$*N):(N=1/Math.sqrt(it+at),this._localBasisY1X=$*N,this._localBasisY1Y=-K*N,this._localBasisY1Z=0):at<st?(N=1/Math.sqrt(st+it),this._localBasisY1X=-tt*N,this._localBasisY1Y=0,this._localBasisY1Z=K*N):(N=1/Math.sqrt(it+at),this._localBasisY1X=$*N,this._localBasisY1Y=-K*N,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,F=r*this._localBasisX1X+e*this._localBasisX1Y+_*this._localBasisX1Z,D=h*this._localBasisX1X+l*this._localBasisX1Y+c*this._localBasisX1Z,G=m*this._localBasisX1X+v*this._localBasisX1Y+b*this._localBasisX1Z,this._localBasisX2X=F,this._localBasisX2Y=D,this._localBasisX2Z=G,W=r*this._localBasisY1X+e*this._localBasisY1Y+_*this._localBasisY1Z,J=h*this._localBasisY1X+l*this._localBasisY1Y+c*this._localBasisY1Z,U=m*this._localBasisY1X+v*this._localBasisY1Y+b*this._localBasisY1Z,this._localBasisY2X=W,this._localBasisY2Y=J,this._localBasisY2Z=U,O=r*this._localBasisZ1X+e*this._localBasisZ1Y+_*this._localBasisZ1Z,H=h*this._localBasisZ1X+l*this._localBasisZ1Y+c*this._localBasisZ1Z,Q=m*this._localBasisZ1X+v*this._localBasisZ1Y+b*this._localBasisZ1Z,this._localBasisZ2X=O,this._localBasisZ2Y=H,this._localBasisZ2Z=Q}buildLocalBasesFromXY(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{var i=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;i>0&&(i=1/Math.sqrt(i)),this._localBasisX2X*=i,this._localBasisX2Y*=i,this._localBasisX2Z*=i}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){var a,s=this._localBasisX1X,o=this._localBasisX1Y,n=this._localBasisX1Z,r=s*s,e=o*o,_=n*n;r<e?r<_?(a=1/Math.sqrt(e+_),this._localBasisY1X=0,this._localBasisY1Y=n*a,this._localBasisY1Z=-o*a):(a=1/Math.sqrt(r+e),this._localBasisY1X=o*a,this._localBasisY1Y=-s*a,this._localBasisY1Z=0):e<_?(a=1/Math.sqrt(_+r),this._localBasisY1X=-n*a,this._localBasisY1Y=0,this._localBasisY1Z=s*a):(a=1/Math.sqrt(r+e),this._localBasisY1X=o*a,this._localBasisY1Y=-s*a,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{var h=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;h>0&&(h=1/Math.sqrt(h)),this._localBasisZ1X*=h,this._localBasisZ1Y*=h,this._localBasisZ1Z*=h,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0){var l,c=this._localBasisX2X,m=this._localBasisX2Y,v=this._localBasisX2Z,b=c*c,x=m*m,p=v*v;b<x?b<p?(l=1/Math.sqrt(x+p),this._localBasisY2X=0,this._localBasisY2Y=v*l,this._localBasisY2Z=-m*l):(l=1/Math.sqrt(b+x),this._localBasisY2X=m*l,this._localBasisY2Y=-c*l,this._localBasisY2Z=0):x<p?(l=1/Math.sqrt(p+b),this._localBasisY2X=-v*l,this._localBasisY2Y=0,this._localBasisY2Z=c*l):(l=1/Math.sqrt(b+x),this._localBasisY2X=m*l,this._localBasisY2Y=-c*l,this._localBasisY2Z=0),this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X}else{var f=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;f>0&&(f=1/Math.sqrt(f)),this._localBasisZ2X*=f,this._localBasisZ2Y*=f,this._localBasisZ2Z*=f,this._localBasisY2X=this._localBasisZ2Y*this._localBasisX2Z-this._localBasisZ2Z*this._localBasisX2Y,this._localBasisY2Y=this._localBasisZ2Z*this._localBasisX2X-this._localBasisZ2X*this._localBasisX2Z,this._localBasisY2Z=this._localBasisZ2X*this._localBasisX2Y-this._localBasisZ2Y*this._localBasisX2X}}buildLocalBasesFromX1Z2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0)this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=1;else{var i=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;i>0&&(i=1/Math.sqrt(i)),this._localBasisZ2X*=i,this._localBasisZ2Y*=i,this._localBasisZ2Z*=i}var a,s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y,d,g,X,z,Y,Z,M,I,V,w,L,k,B,A,P,S,T=this._b1._transform,C=this._b2._transform;if(a=T._rotation00*this._localBasisX1X+T._rotation01*this._localBasisX1Y+T._rotation02*this._localBasisX1Z,s=T._rotation10*this._localBasisX1X+T._rotation11*this._localBasisX1Y+T._rotation12*this._localBasisX1Z,o=T._rotation20*this._localBasisX1X+T._rotation21*this._localBasisX1Y+T._rotation22*this._localBasisX1Z,f=C._rotation00*this._localBasisZ2X+C._rotation01*this._localBasisZ2Y+C._rotation02*this._localBasisZ2Z,(_=(x=C._rotation10*this._localBasisZ2X+C._rotation11*this._localBasisZ2Y+C._rotation12*this._localBasisZ2Z)*o-(p=C._rotation20*this._localBasisZ2X+C._rotation21*this._localBasisZ2Y+C._rotation22*this._localBasisZ2Z)*s)*_+(h=p*a-(b=f)*o)*h+(l=b*s-x*a)*l==0){var j,R=a,E=s,q=o,N=R*R,F=E*E,D=q*q;N<F?N<D?(_=0,h=q*(j=1/Math.sqrt(F+D)),l=-E*j):(_=E*(j=1/Math.sqrt(N+F)),h=-R*j,l=0):F<D?(_=-q*(j=1/Math.sqrt(D+N)),h=0,l=R*j):(_=E*(j=1/Math.sqrt(N+F)),h=-R*j,l=0)}n=s*l-o*h,r=o*_-a*l,e=a*h-s*_,c=h*p-l*x,m=l*b-_*p,v=_*x-h*b,u=T._rotation00*a+T._rotation10*s+T._rotation20*o,y=T._rotation01*a+T._rotation11*s+T._rotation21*o,d=T._rotation02*a+T._rotation12*s+T._rotation22*o,this._localBasisX1X=u,this._localBasisX1Y=y,this._localBasisX1Z=d,g=T._rotation00*_+T._rotation10*h+T._rotation20*l,X=T._rotation01*_+T._rotation11*h+T._rotation21*l,z=T._rotation02*_+T._rotation12*h+T._rotation22*l,this._localBasisY1X=g,this._localBasisY1Y=X,this._localBasisY1Z=z,Y=T._rotation00*n+T._rotation10*r+T._rotation20*e,Z=T._rotation01*n+T._rotation11*r+T._rotation21*e,M=T._rotation02*n+T._rotation12*r+T._rotation22*e,this._localBasisZ1X=Y,this._localBasisZ1Y=Z,this._localBasisZ1Z=M,I=C._rotation00*c+C._rotation10*m+C._rotation20*v,V=C._rotation01*c+C._rotation11*m+C._rotation21*v,w=C._rotation02*c+C._rotation12*m+C._rotation22*v,this._localBasisX2X=I,this._localBasisX2Y=V,this._localBasisX2Z=w,L=C._rotation00*_+C._rotation10*h+C._rotation20*l,k=C._rotation01*_+C._rotation11*h+C._rotation21*l,B=C._rotation02*_+C._rotation12*h+C._rotation22*l,this._localBasisY2X=L,this._localBasisY2Y=k,this._localBasisY2Z=B,A=C._rotation00*b+C._rotation10*x+C._rotation20*p,P=C._rotation01*b+C._rotation11*x+C._rotation21*p,S=C._rotation02*b+C._rotation12*x+C._rotation22*p,this._localBasisZ2X=A,this._localBasisZ2Y=P,this._localBasisZ2Z=S}buildLocalBasesFromXY1X2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){var i,a=this._localBasisX1X,s=this._localBasisX1Y,o=this._localBasisX1Z,n=a*a,r=s*s,e=o*o;n<r?n<e?(i=1/Math.sqrt(r+e),this._localBasisY1X=0,this._localBasisY1Y=o*i,this._localBasisY1Z=-s*i):(i=1/Math.sqrt(n+r),this._localBasisY1X=s*i,this._localBasisY1Y=-a*i,this._localBasisY1Z=0):r<e?(i=1/Math.sqrt(e+n),this._localBasisY1X=-o*i,this._localBasisY1Y=0,this._localBasisY1Z=a*i):(i=1/Math.sqrt(n+r),this._localBasisY1X=s*i,this._localBasisY1Y=-a*i,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{var _=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;_>0&&(_=1/Math.sqrt(_)),this._localBasisZ1X*=_,this._localBasisZ1Y*=_,this._localBasisZ1Z*=_,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}var h,l,c,m,v,b,x,p,f,u,y,d,g,X=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(X<-.999999999){var z,Y,Z,M,I=this._localBasisX1X,V=this._localBasisX1Y,w=this._localBasisX1Z,L=I*I,k=V*V,B=w*w;L<k?L<B?(z=0,Y=w*(M=1/Math.sqrt(k+B)),Z=-V*M):(z=V*(M=1/Math.sqrt(L+k)),Y=-I*M,Z=0):k<B?(z=-w*(M=1/Math.sqrt(B+L)),Y=0,Z=I*M):(z=V*(M=1/Math.sqrt(L+k)),Y=-I*M,Z=0),h=z,l=Y,c=Z,m=0}else{var A,P,S;A=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,P=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,S=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var T=Math.sqrt(.5*(1+X));h=A*=X=.5/T,l=P*=X,c=S*=X,m=T}var C,j,R,E,q,N,F,D,G,W=2*h,J=2*l,U=2*c,O=h*W,H=l*J,Q=c*U,K=h*J,$=l*U,tt=h*U,it=m*W,at=m*J,st=m*U;b=K-st,x=tt+at,p=K+st,f=1-O-Q,u=$-it,y=tt-at,d=$+it,g=1-O-H,C=(v=1-H-Q)*this._localBasisX1X+b*this._localBasisX1Y+x*this._localBasisX1Z,j=p*this._localBasisX1X+f*this._localBasisX1Y+u*this._localBasisX1Z,R=y*this._localBasisX1X+d*this._localBasisX1Y+g*this._localBasisX1Z,this._localBasisX2X=C,this._localBasisX2Y=j,this._localBasisX2Z=R,E=v*this._localBasisY1X+b*this._localBasisY1Y+x*this._localBasisY1Z,q=p*this._localBasisY1X+f*this._localBasisY1Y+u*this._localBasisY1Z,N=y*this._localBasisY1X+d*this._localBasisY1Y+g*this._localBasisY1Z,this._localBasisY2X=E,this._localBasisY2Y=q,this._localBasisY2Z=N,F=v*this._localBasisZ1X+b*this._localBasisZ1Y+x*this._localBasisZ1Z,D=p*this._localBasisZ1X+f*this._localBasisZ1Y+u*this._localBasisZ1Z,G=y*this._localBasisZ1X+d*this._localBasisZ1Y+g*this._localBasisZ1Z,this._localBasisZ2X=F,this._localBasisZ2Y=D,this._localBasisZ2Z=G}setSolverInfoRowLinear(t,i,a,s,o,n,r){var e,_,h=pa.common.Setting.linearSlop;if(r)e=0,_=1;else{if(o.frequency>0){h=0;var l=6.28318530717958*o.frequency,c=o.dampingRatio;c<pa.common.Setting.minSpringDamperDampingRatio&&(c=pa.common.Setting.minSpringDamperDampingRatio);var m=n.dt,v=2*c*l,b=l*l;o.useSymplecticEuler?(e=1/(m*v),_=b/v):(e=1/(m*(m*b+v)),_=b/(m*b+v))}else e=0,_=this.getErp(n,!1);a.motorForce>0?(t.motorSpeed=a.motorSpeed,t.motorMaxImpulse=a.motorForce*n.dt):(t.motorSpeed=0,t.motorMaxImpulse=0)}var x,p,f,u=a.lowerLimit,y=a.upperLimit;u>y?(x=0,p=0,f=0):u==y?(x=-1/0,p=Infinity,f=i-u):i<u?(x=-1/0,p=0,(f=i-u+h)>0&&(f=0)):i>y?(x=0,p=Infinity,(f=i-y-h)<0&&(f=0)):(x=0,p=0,f=0);var d=0==s?0:1/s;t.minImpulse=x,t.maxImpulse=p,t.cfm=e*d,t.rhs=f*_}setSolverInfoRowAngular(t,i,a,s,o,n,r){var e,_,h=pa.common.Setting.angularSlop;if(r)e=0,_=1;else{if(o.frequency>0){h=0;var l=6.28318530717958*o.frequency,c=o.dampingRatio;c<pa.common.Setting.minSpringDamperDampingRatio&&(c=pa.common.Setting.minSpringDamperDampingRatio);var m=n.dt,v=2*c*l,b=l*l;o.useSymplecticEuler?(e=1/(m*v),_=b/v):(e=1/(m*(m*b+v)),_=b/(m*b+v))}else e=0,_=this.getErp(n,!1);a.motorTorque>0?(t.motorSpeed=a.motorSpeed,t.motorMaxImpulse=a.motorTorque*n.dt):(t.motorSpeed=0,t.motorMaxImpulse=0)}var x,p,f,u=a.lowerLimit,y=a.upperLimit,d=.5*(u+y);i=(((i-=d)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,i+=d,u>y?(x=0,p=0,f=0):u==y?(x=-1/0,p=Infinity,f=i-u):i<u?(x=-1/0,p=0,(f=i-u+h)>0&&(f=0)):i>y?(x=0,p=Infinity,(f=i-y-h)<0&&(f=0)):(x=0,p=0,f=0);var g=0==s?0:1/s;t.minImpulse=x,t.maxImpulse=p,t.cfm=e*g,t.rhs=f*_}getErp(t,i){return i?1:this._positionCorrectionAlgorithm==pa.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*pa.common.Setting.velocityBaumgarte:0}computeEffectiveInertiaMoment(t,i,a){var s=(this._b1._invInertia00*t+this._b1._invInertia01*i+this._b1._invInertia02*a)*t+(this._b1._invInertia10*t+this._b1._invInertia11*i+this._b1._invInertia12*a)*i+(this._b1._invInertia20*t+this._b1._invInertia21*i+this._b1._invInertia22*a)*a,o=(this._b2._invInertia00*t+this._b2._invInertia01*i+this._b2._invInertia02*a)*t+(this._b2._invInertia10*t+this._b2._invInertia11*i+this._b2._invInertia12*a)*i+(this._b2._invInertia20*t+this._b2._invInertia21*i+this._b2._invInertia22*a)*a;if(s>0){var n=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,r=t*this._relativeAnchor1X+i*this._relativeAnchor1Y+a*this._relativeAnchor1Z,e=n-r*r;e>0&&(s=this._b1._invMass>0?1/(1/s+this._b1._mass*e):0)}if(o>0){var _=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,h=t*this._relativeAnchor2X+i*this._relativeAnchor2Y+a*this._relativeAnchor2Z,l=_-h*h;l>0&&(o=this._b2._invMass>0?1/(1/o+this._b2._mass*l):0)}return s+o==0?0:1/(s+o)}computeEffectiveInertiaMoment2(t,i,a,s,o,n){var r=(this._b1._invInertia00*t+this._b1._invInertia01*i+this._b1._invInertia02*a)*t+(this._b1._invInertia10*t+this._b1._invInertia11*i+this._b1._invInertia12*a)*i+(this._b1._invInertia20*t+this._b1._invInertia21*i+this._b1._invInertia22*a)*a,e=(this._b2._invInertia00*s+this._b2._invInertia01*o+this._b2._invInertia02*n)*s+(this._b2._invInertia10*s+this._b2._invInertia11*o+this._b2._invInertia12*n)*o+(this._b2._invInertia20*s+this._b2._invInertia21*o+this._b2._invInertia22*n)*n;if(r>0){var _=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,h=t*this._relativeAnchor1X+i*this._relativeAnchor1Y+a*this._relativeAnchor1Z,l=_*_-h*h;l>0&&(r=this._b1._invMass>0?1/(1/r+this._b1._mass*l):0)}if(e>0){var c=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,m=s*this._relativeAnchor2X+o*this._relativeAnchor2Y+n*this._relativeAnchor2Z,v=c*c-m*m;v>0&&(e=this._b2._invMass>0?1/(1/e+this._b2._mass*v):0)}return r+e==0?0:1/(r+e)}_syncAnchors(){var t,i,a,s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y,d,g,X,z,Y=this._b1._transform,Z=this._b2._transform;t=Y._rotation00*this._localAnchor1X+Y._rotation01*this._localAnchor1Y+Y._rotation02*this._localAnchor1Z,i=Y._rotation10*this._localAnchor1X+Y._rotation11*this._localAnchor1Y+Y._rotation12*this._localAnchor1Z,a=Y._rotation20*this._localAnchor1X+Y._rotation21*this._localAnchor1Y+Y._rotation22*this._localAnchor1Z,this._relativeAnchor1X=t,this._relativeAnchor1Y=i,this._relativeAnchor1Z=a,s=Z._rotation00*this._localAnchor2X+Z._rotation01*this._localAnchor2Y+Z._rotation02*this._localAnchor2Z,o=Z._rotation10*this._localAnchor2X+Z._rotation11*this._localAnchor2Y+Z._rotation12*this._localAnchor2Z,n=Z._rotation20*this._localAnchor2X+Z._rotation21*this._localAnchor2Y+Z._rotation22*this._localAnchor2Z,this._relativeAnchor2X=s,this._relativeAnchor2Y=o,this._relativeAnchor2Z=n,this._anchor1X=this._relativeAnchor1X+Y._positionX,this._anchor1Y=this._relativeAnchor1Y+Y._positionY,this._anchor1Z=this._relativeAnchor1Z+Y._positionZ,this._anchor2X=this._relativeAnchor2X+Z._positionX,this._anchor2Y=this._relativeAnchor2Y+Z._positionY,this._anchor2Z=this._relativeAnchor2Z+Z._positionZ,r=Y._rotation00*this._localBasisX1X+Y._rotation01*this._localBasisX1Y+Y._rotation02*this._localBasisX1Z,e=Y._rotation10*this._localBasisX1X+Y._rotation11*this._localBasisX1Y+Y._rotation12*this._localBasisX1Z,_=Y._rotation20*this._localBasisX1X+Y._rotation21*this._localBasisX1Y+Y._rotation22*this._localBasisX1Z,this._basisX1X=r,this._basisX1Y=e,this._basisX1Z=_,h=Y._rotation00*this._localBasisY1X+Y._rotation01*this._localBasisY1Y+Y._rotation02*this._localBasisY1Z,l=Y._rotation10*this._localBasisY1X+Y._rotation11*this._localBasisY1Y+Y._rotation12*this._localBasisY1Z,c=Y._rotation20*this._localBasisY1X+Y._rotation21*this._localBasisY1Y+Y._rotation22*this._localBasisY1Z,this._basisY1X=h,this._basisY1Y=l,this._basisY1Z=c,m=Y._rotation00*this._localBasisZ1X+Y._rotation01*this._localBasisZ1Y+Y._rotation02*this._localBasisZ1Z,v=Y._rotation10*this._localBasisZ1X+Y._rotation11*this._localBasisZ1Y+Y._rotation12*this._localBasisZ1Z,b=Y._rotation20*this._localBasisZ1X+Y._rotation21*this._localBasisZ1Y+Y._rotation22*this._localBasisZ1Z,this._basisZ1X=m,this._basisZ1Y=v,this._basisZ1Z=b,x=Z._rotation00*this._localBasisX2X+Z._rotation01*this._localBasisX2Y+Z._rotation02*this._localBasisX2Z,p=Z._rotation10*this._localBasisX2X+Z._rotation11*this._localBasisX2Y+Z._rotation12*this._localBasisX2Z,f=Z._rotation20*this._localBasisX2X+Z._rotation21*this._localBasisX2Y+Z._rotation22*this._localBasisX2Z,this._basisX2X=x,this._basisX2Y=p,this._basisX2Z=f,u=Z._rotation00*this._localBasisY2X+Z._rotation01*this._localBasisY2Y+Z._rotation02*this._localBasisY2Z,y=Z._rotation10*this._localBasisY2X+Z._rotation11*this._localBasisY2Y+Z._rotation12*this._localBasisY2Z,d=Z._rotation20*this._localBasisY2X+Z._rotation21*this._localBasisY2Y+Z._rotation22*this._localBasisY2Z,this._basisY2X=u,this._basisY2Y=y,this._basisY2Z=d,g=Z._rotation00*this._localBasisZ2X+Z._rotation01*this._localBasisZ2Y+Z._rotation02*this._localBasisZ2Z,X=Z._rotation10*this._localBasisZ2X+Z._rotation11*this._localBasisZ2Y+Z._rotation12*this._localBasisZ2Z,z=Z._rotation20*this._localBasisZ2X+Z._rotation21*this._localBasisZ2Y+Z._rotation22*this._localBasisZ2Z,this._basisZ2X=g,this._basisZ2Y=X,this._basisZ2Z=z}_getVelocitySolverInfo(t,i){i.b1=this._b1,i.b2=this._b2,i.numRows=0}_getPositionSolverInfo(t){t.b1=this._b1,t.b2=this._b2,t.numRows=0}_checkDestruction(){var t=this._appliedForceX*this._appliedForceX+this._appliedForceY*this._appliedForceY+this._appliedForceZ*this._appliedForceZ,i=this._appliedTorqueX*this._appliedTorqueX+this._appliedTorqueY*this._appliedTorqueY+this._appliedTorqueZ*this._appliedTorqueZ;(this._breakForce>0&&t>this._breakForce*this._breakForce||this._breakTorque>0&&i>this._breakTorque*this._breakTorque)&&this._world.removeJoint(this)}getRigidBody1(){return this._b1}getRigidBody2(){return this._b2}getType(){return this._type}getAnchor1(){var t=new pa.common.Vec3,i=t;return i.x=this._anchor1X,i.y=this._anchor1Y,i.z=this._anchor1Z,t}getAnchor2(){var t=new pa.common.Vec3,i=t;return i.x=this._anchor2X,i.y=this._anchor2Y,i.z=this._anchor2Z,t}getAnchor1To(t){var i=t;i.x=this._anchor1X,i.y=this._anchor1Y,i.z=this._anchor1Z}getAnchor2To(t){var i=t;i.x=this._anchor2X,i.y=this._anchor2Y,i.z=this._anchor2Z}getLocalAnchor1(){var t=new pa.common.Vec3,i=t;return i.x=this._localAnchor1X,i.y=this._localAnchor1Y,i.z=this._localAnchor1Z,t}getLocalAnchor2(){var t=new pa.common.Vec3,i=t;return i.x=this._localAnchor2X,i.y=this._localAnchor2Y,i.z=this._localAnchor2Z,t}getLocalAnchor1To(t){var i=t;i.x=this._localAnchor1X,i.y=this._localAnchor1Y,i.z=this._localAnchor1Z}getLocalAnchor2To(t){var i=t;i.x=this._localAnchor2X,i.y=this._localAnchor2Y,i.z=this._localAnchor2Z}getBasis1(){var t,i,a,s,o,n,r,e,_,h=new pa.common.Mat3;t=this._basisX1X,i=this._basisY1X,a=this._basisZ1X,s=this._basisX1Y,o=this._basisY1Y,n=this._basisZ1Y,r=this._basisX1Z,e=this._basisY1Z,_=this._basisZ1Z;var l=h;return l.e00=t,l.e01=i,l.e02=a,l.e10=s,l.e11=o,l.e12=n,l.e20=r,l.e21=e,l.e22=_,h}getBasis2(){var t,i,a,s,o,n,r,e,_,h=new pa.common.Mat3;t=this._basisX2X,i=this._basisY2X,a=this._basisZ2X,s=this._basisX2Y,o=this._basisY2Y,n=this._basisZ2Y,r=this._basisX2Z,e=this._basisY2Z,_=this._basisZ2Z;var l=h;return l.e00=t,l.e01=i,l.e02=a,l.e10=s,l.e11=o,l.e12=n,l.e20=r,l.e21=e,l.e22=_,h}getBasis1To(t){var i,a,s,o,n,r,e,_,h;i=this._basisX1X,a=this._basisY1X,s=this._basisZ1X,o=this._basisX1Y,n=this._basisY1Y,r=this._basisZ1Y,e=this._basisX1Z,_=this._basisY1Z,h=this._basisZ1Z;var l=t;l.e00=i,l.e01=a,l.e02=s,l.e10=o,l.e11=n,l.e12=r,l.e20=e,l.e21=_,l.e22=h}getBasis2To(t){var i,a,s,o,n,r,e,_,h;i=this._basisX2X,a=this._basisY2X,s=this._basisZ2X,o=this._basisX2Y,n=this._basisY2Y,r=this._basisZ2Y,e=this._basisX2Z,_=this._basisY2Z,h=this._basisZ2Z;var l=t;l.e00=i,l.e01=a,l.e02=s,l.e10=o,l.e11=n,l.e12=r,l.e20=e,l.e21=_,l.e22=h}getAllowCollision(){return this._allowCollision}setAllowCollision(t){this._allowCollision=t}getBreakForce(){return this._breakForce}setBreakForce(t){this._breakForce=t}getBreakTorque(){return this._breakTorque}setBreakTorque(t){this._breakTorque=t}getPositionCorrectionAlgorithm(){return this._positionCorrectionAlgorithm}setPositionCorrectionAlgorithm(t){switch(t){case 0:case 1:case 2:break;default:throw new Error("invalid position correction algorithm id: "+t)}this._positionCorrectionAlgorithm=t}getAppliedForce(){var t=new pa.common.Vec3,i=t;return i.x=this._appliedForceX,i.y=this._appliedForceY,i.z=this._appliedForceZ,t}getAppliedForceTo(t){var i=t;i.x=this._appliedForceX,i.y=this._appliedForceY,i.z=this._appliedForceZ}getAppliedTorque(){var t=new pa.common.Vec3,i=t;return i.x=this._appliedTorqueX,i.y=this._appliedTorqueY,i.z=this._appliedTorqueZ,t}getAppliedTorqueTo(t){var i=t;i.x=this._appliedTorqueX,i.y=this._appliedTorqueY,i.z=this._appliedTorqueZ}getPrev(){return this._prev}getNext(){return this._next}},pa.dynamics.constraint.joint.CylindricalJoint=class extends pa.dynamics.constraint.joint.Joint{constructor(t){super(t,2);var i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;var a=t.localAxis2;this._localBasisX2X=a.x,this._localBasisX2Y=a.y,this._localBasisX2Z=a.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this._basis=new pa.dynamics.constraint.joint.BasisTracker(this),this._translSd=t.translationalSpringDamper.clone(),this._translLm=t.translationalLimitMotor.clone(),this._rotSd=t.rotationalSpringDamper.clone(),this._rotLm=t.rotationalLimitMotor.clone()}getInfo(t,i,a){var s,o,n=this.getErp(i,a),r=this.linearErrorY*n,e=this.linearErrorZ*n,_=this.angularErrorY*n,h=this.angularErrorZ*n,l=1/(this._b1._invMass+this._b2._invMass),c=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ);if(this._translSd.frequency<=0||!a){var m=this._impulses[0],v=t.rows[t.numRows++],b=v.jacobian;b.lin1X=0,b.lin1Y=0,b.lin1Z=0,b.lin2X=0,b.lin2Y=0,b.lin2Z=0,b.ang1X=0,b.ang1Y=0,b.ang1Z=0,b.ang2X=0,b.ang2Y=0,b.ang2Z=0,v.rhs=0,v.cfm=0,v.minImpulse=0,v.maxImpulse=0,v.motorSpeed=0,v.motorMaxImpulse=0,v.impulse=null,v.impulse=m,s=v,this.setSolverInfoRowLinear(s,this.translation,this._translLm,l,this._translSd,i,a),(o=s.jacobian).lin1X=this._basis.xX,o.lin1Y=this._basis.xY,o.lin1Z=this._basis.xZ,o.lin2X=this._basis.xX,o.lin2Y=this._basis.xY,o.lin2Z=this._basis.xZ,o.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,o.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,o.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,o.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,o.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,o.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}var x=this._impulses[1],p=t.rows[t.numRows++],f=p.jacobian;f.lin1X=0,f.lin1Y=0,f.lin1Z=0,f.lin2X=0,f.lin2Y=0,f.lin2Z=0,f.ang1X=0,f.ang1Y=0,f.ang1Z=0,f.ang2X=0,f.ang2Y=0,f.ang2Z=0,p.rhs=0,p.cfm=0,p.minImpulse=0,p.maxImpulse=0,p.motorSpeed=0,p.motorMaxImpulse=0,p.impulse=null,p.impulse=x,(s=p).rhs=r,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=Infinity,(o=s.jacobian).lin1X=this._basis.yX,o.lin1Y=this._basis.yY,o.lin1Z=this._basis.yZ,o.lin2X=this._basis.yX,o.lin2Y=this._basis.yY,o.lin2Z=this._basis.yZ,o.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,o.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,o.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,o.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,o.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,o.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;var u=this._impulses[2],y=t.rows[t.numRows++],d=y.jacobian;if(d.lin1X=0,d.lin1Y=0,d.lin1Z=0,d.lin2X=0,d.lin2Y=0,d.lin2Z=0,d.ang1X=0,d.ang1Y=0,d.ang1Z=0,d.ang2X=0,d.ang2Y=0,d.ang2Z=0,y.rhs=0,y.cfm=0,y.minImpulse=0,y.maxImpulse=0,y.motorSpeed=0,y.motorMaxImpulse=0,y.impulse=null,y.impulse=u,(s=y).rhs=e,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=Infinity,(o=s.jacobian).lin1X=this._basis.zX,o.lin1Y=this._basis.zY,o.lin1Z=this._basis.zZ,o.lin2X=this._basis.zX,o.lin2Y=this._basis.zY,o.lin2Z=this._basis.zZ,o.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,o.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,o.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,o.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,o.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,o.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX,this._rotSd.frequency<=0||!a){var g=this._impulses[3],X=t.rows[t.numRows++],z=X.jacobian;z.lin1X=0,z.lin1Y=0,z.lin1Z=0,z.lin2X=0,z.lin2Y=0,z.lin2Z=0,z.ang1X=0,z.ang1Y=0,z.ang1Z=0,z.ang2X=0,z.ang2Y=0,z.ang2Z=0,X.rhs=0,X.cfm=0,X.minImpulse=0,X.maxImpulse=0,X.motorSpeed=0,X.motorMaxImpulse=0,X.impulse=null,X.impulse=g,s=X,this.setSolverInfoRowAngular(s,this.angle,this._rotLm,c,this._rotSd,i,a),(o=s.jacobian).ang1X=this._basis.xX,o.ang1Y=this._basis.xY,o.ang1Z=this._basis.xZ,o.ang2X=this._basis.xX,o.ang2Y=this._basis.xY,o.ang2Z=this._basis.xZ}var Y=this._impulses[4],Z=t.rows[t.numRows++],M=Z.jacobian;M.lin1X=0,M.lin1Y=0,M.lin1Z=0,M.lin2X=0,M.lin2Y=0,M.lin2Z=0,M.ang1X=0,M.ang1Y=0,M.ang1Z=0,M.ang2X=0,M.ang2Y=0,M.ang2Z=0,Z.rhs=0,Z.cfm=0,Z.minImpulse=0,Z.maxImpulse=0,Z.motorSpeed=0,Z.motorMaxImpulse=0,Z.impulse=null,Z.impulse=Y,(s=Z).rhs=_,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=Infinity,(o=s.jacobian).ang1X=this._basis.yX,o.ang1Y=this._basis.yY,o.ang1Z=this._basis.yZ,o.ang2X=this._basis.yX,o.ang2Y=this._basis.yY,o.ang2Z=this._basis.yZ;var I=this._impulses[5],V=t.rows[t.numRows++],w=V.jacobian;w.lin1X=0,w.lin1Y=0,w.lin1Z=0,w.lin2X=0,w.lin2Y=0,w.lin2Z=0,w.ang1X=0,w.ang1Y=0,w.ang1Z=0,w.ang2X=0,w.ang2Y=0,w.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=I,(s=V).rhs=h,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=Infinity,(o=s.jacobian).ang1X=this._basis.zX,o.ang1Y=this._basis.zY,o.ang1Z=this._basis.zZ,o.ang2X=this._basis.zX,o.ang2Y=this._basis.zY,o.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();var t,i,a,s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y,d,g,X,z,Y,Z,M,I,V,w,L,k,B,A,P,S,T,C,j,R=this._basis,E=R.joint._b1._invMass,q=R.joint._b2._invMass,N=R.joint._basisX1X*R.joint._basisX2X+R.joint._basisX1Y*R.joint._basisX2Y+R.joint._basisX1Z*R.joint._basisX2Z;if(N<-.999999999){var F,D,G,W,J=R.joint._basisX1X,U=R.joint._basisX1Y,O=R.joint._basisX1Z,H=J*J,Q=U*U,K=O*O;H<Q?H<K?(F=0,D=O*(W=1/Math.sqrt(Q+K)),G=-U*W):(F=U*(W=1/Math.sqrt(H+Q)),D=-J*W,G=0):Q<K?(F=-O*(W=1/Math.sqrt(K+H)),D=0,G=J*W):(F=U*(W=1/Math.sqrt(H+Q)),D=-J*W,G=0),t=F,i=D,a=G,s=0}else{var $,tt,it;$=R.joint._basisX1Y*R.joint._basisX2Z-R.joint._basisX1Z*R.joint._basisX2Y,tt=R.joint._basisX1Z*R.joint._basisX2X-R.joint._basisX1X*R.joint._basisX2Z,it=R.joint._basisX1X*R.joint._basisX2Y-R.joint._basisX1Y*R.joint._basisX2X;var at=Math.sqrt(.5*(1+N));t=$*=N=.5/at,i=tt*=N,a=it*=N,s=at}var st=(k=0)*(S=t)+(B=0)*(T=i)+(A=0)*(C=a)+(P=1)*(j=s);if(st<0&&(st=-st,S=-S,T=-T,C=-C,j=-j),st>.999999){var ot=(S=k+(S-k)*(E/(E+q)))*S+(T=B+(T-B)*(E/(E+q)))*T+(C=A+(C-A)*(E/(E+q)))*C+(j=P+(j-P)*(E/(E+q)))*j;ot>1e-32&&(ot=1/Math.sqrt(ot)),o=S*ot,n=T*ot,r=C*ot,e=j*ot}else{var nt=E/(E+q)*Math.acos(st),rt=(S+=k*-st)*S+(T+=B*-st)*T+(C+=A*-st)*C+(j+=P*-st)*j;rt>1e-32&&(rt=1/Math.sqrt(rt)),S*=rt,T*=rt,C*=rt,j*=rt;var et=Math.sin(nt),_t=Math.cos(nt);o=(k*=_t)+S*et,n=(B*=_t)+T*et,r=(A*=_t)+C*et,e=(P*=_t)+j*et}var ht=2*o,lt=2*n,ct=2*r,mt=o*ht,vt=n*lt,bt=r*ct,xt=o*lt,pt=n*ct,ft=o*ct,ut=e*ht,yt=e*lt,dt=e*ct;_=xt-dt,h=ft+yt,l=xt+dt,c=1-mt-bt,m=pt-ut,v=ft-yt,b=pt+ut,x=1-mt-vt,p=(1-vt-bt)*R.joint._basisX1X+_*R.joint._basisX1Y+h*R.joint._basisX1Z,f=l*R.joint._basisX1X+c*R.joint._basisX1Y+m*R.joint._basisX1Z,u=v*R.joint._basisX1X+b*R.joint._basisX1Y+x*R.joint._basisX1Z,Z=R.xX,M=R.xY,I=R.xZ,V=R.yX,w=R.yY,L=R.yZ;var gt=Z*p+M*f+I*u;if(gt<-.999999999){var Xt,zt,Yt,Zt,Mt=Z,It=M,Vt=I,wt=Mt*Mt,Lt=It*It,kt=Vt*Vt;wt<Lt?wt<kt?(Xt=0,zt=Vt*(Zt=1/Math.sqrt(Lt+kt)),Yt=-It*Zt):(Xt=It*(Zt=1/Math.sqrt(wt+Lt)),zt=-Mt*Zt,Yt=0):Lt<kt?(Xt=-Vt*(Zt=1/Math.sqrt(kt+wt)),zt=0,Yt=Mt*Zt):(Xt=It*(Zt=1/Math.sqrt(wt+Lt)),zt=-Mt*Zt,Yt=0),o=Xt,n=zt,r=Yt,e=0}else{var Bt,At,Pt;Bt=M*u-I*f,At=I*p-Z*u,Pt=Z*f-M*p;var St=Math.sqrt(.5*(1+gt));o=Bt*=gt=.5/St,n=At*=gt,r=Pt*=gt,e=St}var Tt,Ct,jt,Rt=2*o,Et=2*n,qt=2*r,Nt=o*Rt,Ft=n*Et,Dt=r*qt,Gt=o*Et,Wt=n*qt,Jt=o*qt,Ut=e*Rt,Ot=e*Et,Ht=e*qt;if((X=f*(g=(v=Jt-Ot)*V+(b=Wt+Ut)*w+(x=1-Nt-Ft)*L)-u*(d=(l=Gt+Ht)*V+(c=1-Nt-Dt)*w+(m=Wt-Ut)*L))*X+(z=u*(y=(1-Ft-Dt)*V+(_=Gt-Ht)*w+(h=Jt+Ot)*L)-p*g)*z+(Y=p*d-f*y)*Y>1e-6){var Qt=X*X+z*z+Y*Y;Qt>0&&(Qt=1/Math.sqrt(Qt)),X*=Qt,z*=Qt,Y*=Qt}else{var Kt,$t=p,ti=f,ii=u,ai=$t*$t,si=ti*ti,oi=ii*ii;ai<si?ai<oi?(X=0,z=ii*(Kt=1/Math.sqrt(si+oi)),Y=-ti*Kt):(X=ti*(Kt=1/Math.sqrt(ai+si)),z=-$t*Kt,Y=0):si<oi?(X=-ii*(Kt=1/Math.sqrt(oi+ai)),z=0,Y=$t*Kt):(X=ti*(Kt=1/Math.sqrt(ai+si)),z=-$t*Kt,Y=0)}y=z*u-Y*f,d=Y*p-X*u,g=X*f-z*p,R.xX=p,R.xY=f,R.xZ=u,R.yX=y,R.yY=d,R.yZ=g,R.zX=X,R.zY=z,R.zZ=Y,Tt=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,Ct=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,jt=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;var ni,ri,ei,_i,hi,li,ci=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,mi=ci<=-1?3.14159265358979:ci>=1?0:Math.acos(ci),vi=Tt*Tt+Ct*Ct+jt*jt;vi>0&&(vi=1/Math.sqrt(vi)),Tt*=vi,Ct*=vi,jt*=vi,Tt*=mi,Ct*=mi,jt*=mi,this.angularErrorY=Tt*this._basis.yX+Ct*this._basis.yY+jt*this._basis.yZ,this.angularErrorZ=Tt*this._basis.zX+Ct*this._basis.zY+jt*this._basis.zZ,ni=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,ri=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,ei=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,ci=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=ci<=-1?3.14159265358979:ci>=1?0:Math.acos(ci),ni*this._basis.xX+ri*this._basis.xY+ei*this._basis.xZ<0&&(this.angle=-this.angle),_i=this._anchor2X-this._anchor1X,hi=this._anchor2Y-this._anchor1Y,li=this._anchor2Z-this._anchor1Z,this.translation=_i*this._basis.xX+hi*this._basis.xY+li*this._basis.xZ,this.linearErrorY=_i*this._basis.yX+hi*this._basis.yY+li*this._basis.yZ,this.linearErrorZ=_i*this._basis.zX+hi*this._basis.zY+li*this._basis.zZ}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){var t=new pa.common.Vec3,i=t;return i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z,t}getAxis2(){var t=new pa.common.Vec3,i=t;return i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z,t}getAxis1To(t){var i=t;i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z}getAxis2To(t){var i=t;i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z}getLocalAxis1(){var t=new pa.common.Vec3,i=t;return i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z,t}getLocalAxis2(){var t=new pa.common.Vec3,i=t;return i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z,t}getLocalAxis1To(t){var i=t;i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z}getLocalAxis2To(t){var i=t;i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z}getTranslationalSpringDamper(){return this._translSd}getRotationalSpringDamper(){return this._rotSd}getTranslationalLimitMotor(){return this._translLm}getRotationalLimitMotor(){return this._rotLm}getAngle(){return this.angle}getTranslation(){return this.translation}},pa.dynamics.constraint.joint.JointConfig=class{constructor(){this.rigidBody1=null,this.rigidBody2=null,this.localAnchor1=new pa.common.Vec3,this.localAnchor2=new pa.common.Vec3,this.allowCollision=!1,this.solverType=pa.common.Setting.defaultJointConstraintSolverType,this.positionCorrectionAlgorithm=pa.common.Setting.defaultJointPositionCorrectionAlgorithm,this.breakForce=0,this.breakTorque=0}_init(t,i,a){this.rigidBody1=t,this.rigidBody2=i;var s,o,n,r,e,_,h=this.rigidBody1,l=a;s=l.x,o=l.y,n=l.z,s-=h._transform._positionX,o-=h._transform._positionY,n-=h._transform._positionZ,r=h._transform._rotation00*s+h._transform._rotation10*o+h._transform._rotation20*n,e=h._transform._rotation01*s+h._transform._rotation11*o+h._transform._rotation21*n,_=h._transform._rotation02*s+h._transform._rotation12*o+h._transform._rotation22*n,s=r,o=e,n=_;var c=this.localAnchor1;c.x=s,c.y=o,c.z=n;var m,v,b,x,p,f,u=this.rigidBody2,y=a;m=y.x,v=y.y,b=y.z,m-=u._transform._positionX,v-=u._transform._positionY,b-=u._transform._positionZ,x=u._transform._rotation00*m+u._transform._rotation10*v+u._transform._rotation20*b,p=u._transform._rotation01*m+u._transform._rotation11*v+u._transform._rotation21*b,f=u._transform._rotation02*m+u._transform._rotation12*v+u._transform._rotation22*b,m=x,v=p,b=f;var d=this.localAnchor2;d.x=m,d.y=v,d.z=b}},pa.dynamics.constraint.joint.CylindricalJointConfig=class extends pa.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new pa.common.Vec3(1,0,0),this.localAxis2=new pa.common.Vec3(1,0,0),this.translationalLimitMotor=new pa.dynamics.constraint.joint.TranslationalLimitMotor,this.translationalSpringDamper=new pa.dynamics.constraint.joint.SpringDamper,this.rotationalLimitMotor=new pa.dynamics.constraint.joint.RotationalLimitMotor,this.rotationalSpringDamper=new pa.dynamics.constraint.joint.SpringDamper}init(t,i,a,s){var o,n,r;this._init(t,i,a);var e,_,h,l=s;o=l.x,n=l.y,r=l.z,e=t._transform._rotation00*o+t._transform._rotation10*n+t._transform._rotation20*r,_=t._transform._rotation01*o+t._transform._rotation11*n+t._transform._rotation21*r,h=t._transform._rotation02*o+t._transform._rotation12*n+t._transform._rotation22*r,o=e,n=_,r=h;var c,m,v,b=this.localAxis1;b.x=o,b.y=n,b.z=r;var x,p,f,u=s;c=u.x,m=u.y,v=u.z,x=i._transform._rotation00*c+i._transform._rotation10*m+i._transform._rotation20*v,p=i._transform._rotation01*c+i._transform._rotation11*m+i._transform._rotation21*v,f=i._transform._rotation02*c+i._transform._rotation12*m+i._transform._rotation22*v,c=x,m=p,v=f;var y=this.localAxis2;return y.x=c,y.y=m,y.z=v,this}},pa.dynamics.constraint.joint.GenericJoint=class extends pa.dynamics.constraint.joint.Joint{constructor(t){var i;super(t,pa.dynamics.constraint.joint.JointType.GENERIC);var a,s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y,d=t.localBasis1;if(d.e00*(d.e11*d.e22-d.e12*d.e21)-d.e01*(d.e10*d.e22-d.e12*d.e20)+d.e02*(d.e10*d.e21-d.e11*d.e20)<0)i=!0;else{var g=t.localBasis2;i=g.e00*(g.e11*g.e22-g.e12*g.e21)-g.e01*(g.e10*g.e22-g.e12*g.e20)+g.e02*(g.e10*g.e21-g.e11*g.e20)<0}i&&console.log("src/oimo/dynamics/constraint/joint/GenericJoint.hx:50:","[warning] joint basis must be right handed");var X=t.localBasis1;a=X.e00,s=X.e01,o=X.e02,n=X.e10,r=X.e11,e=X.e12,_=X.e20,h=X.e21,l=X.e22;var z=t.localBasis2;c=z.e00,m=z.e01,v=z.e02,b=z.e10,x=z.e11,p=z.e12,f=z.e20,u=z.e21,y=z.e22,this._localBasisX1X=a,this._localBasisX1Y=n,this._localBasisX1Z=_,this._localBasisY1X=s,this._localBasisY1Y=r,this._localBasisY1Z=h,this._localBasisZ1X=o,this._localBasisZ1Y=e,this._localBasisZ1Z=l,this._localBasisX2X=c,this._localBasisX2Y=b,this._localBasisX2Z=f,this._localBasisY2X=m,this._localBasisY2Y=x,this._localBasisY2Z=u,this._localBasisZ2X=v,this._localBasisZ2Y=p,this._localBasisZ2Z=y,this._angleX=0,this._angleY=0,this._angleZ=0,this.translationX=0,this.translationY=0,this.translationZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1;var Y=new Array(3);this._translLms=Y;var Z=new Array(3);this._translSds=Z;var M=new Array(3);this._rotLms=M;var I=new Array(3);this._rotSds=I,this._translLms[0]=t.translationalLimitMotors[0].clone(),this._translLms[1]=t.translationalLimitMotors[1].clone(),this._translLms[2]=t.translationalLimitMotors[2].clone(),this._translSds[0]=t.translationalSpringDampers[0].clone(),this._translSds[1]=t.translationalSpringDampers[1].clone(),this._translSds[2]=t.translationalSpringDampers[2].clone(),this._rotLms[0]=t.rotationalLimitMotors[0].clone(),this._rotLms[1]=t.rotationalLimitMotors[1].clone(),this._rotLms[2]=t.rotationalLimitMotors[2].clone(),this._rotSds[0]=t.rotationalSpringDampers[0].clone(),this._rotSds[1]=t.rotationalSpringDampers[1].clone(),this._rotSds[2]=t.rotationalSpringDampers[2].clone()}getInfo(t,i,a){var s,o,n=1/(this._b1._invMass+this._b2._invMass),r=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),e=this.computeEffectiveInertiaMoment(this._axisYX,this._axisYY,this._axisYZ),_=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ);if(this._translSds[0].frequency<=0||!a){var h=this._impulses[0],l=t.rows[t.numRows++],c=l.jacobian;c.lin1X=0,c.lin1Y=0,c.lin1Z=0,c.lin2X=0,c.lin2Y=0,c.lin2Z=0,c.ang1X=0,c.ang1Y=0,c.ang1Z=0,c.ang2X=0,c.ang2Y=0,c.ang2Z=0,l.rhs=0,l.cfm=0,l.minImpulse=0,l.maxImpulse=0,l.motorSpeed=0,l.motorMaxImpulse=0,l.impulse=null,l.impulse=h,s=l,this.setSolverInfoRowLinear(s,this.translationX,this._translLms[0],n,this._translSds[0],i,a),(o=s.jacobian).lin1X=this._basisX1X,o.lin1Y=this._basisX1Y,o.lin1Z=this._basisX1Z,o.lin2X=this._basisX1X,o.lin2Y=this._basisX1Y,o.lin2Z=this._basisX1Z,o.ang1X=this._relativeAnchor1Y*this._basisX1Z-this._relativeAnchor1Z*this._basisX1Y,o.ang1Y=this._relativeAnchor1Z*this._basisX1X-this._relativeAnchor1X*this._basisX1Z,o.ang1Z=this._relativeAnchor1X*this._basisX1Y-this._relativeAnchor1Y*this._basisX1X,o.ang2X=this._relativeAnchor2Y*this._basisX1Z-this._relativeAnchor2Z*this._basisX1Y,o.ang2Y=this._relativeAnchor2Z*this._basisX1X-this._relativeAnchor2X*this._basisX1Z,o.ang2Z=this._relativeAnchor2X*this._basisX1Y-this._relativeAnchor2Y*this._basisX1X}if(this._translSds[1].frequency<=0||!a){var m=this._impulses[1],v=t.rows[t.numRows++],b=v.jacobian;b.lin1X=0,b.lin1Y=0,b.lin1Z=0,b.lin2X=0,b.lin2Y=0,b.lin2Z=0,b.ang1X=0,b.ang1Y=0,b.ang1Z=0,b.ang2X=0,b.ang2Y=0,b.ang2Z=0,v.rhs=0,v.cfm=0,v.minImpulse=0,v.maxImpulse=0,v.motorSpeed=0,v.motorMaxImpulse=0,v.impulse=null,v.impulse=m,s=v,this.setSolverInfoRowLinear(s,this.translationY,this._translLms[1],n,this._translSds[1],i,a),(o=s.jacobian).lin1X=this._basisY1X,o.lin1Y=this._basisY1Y,o.lin1Z=this._basisY1Z,o.lin2X=this._basisY1X,o.lin2Y=this._basisY1Y,o.lin2Z=this._basisY1Z,o.ang1X=this._relativeAnchor1Y*this._basisY1Z-this._relativeAnchor1Z*this._basisY1Y,o.ang1Y=this._relativeAnchor1Z*this._basisY1X-this._relativeAnchor1X*this._basisY1Z,o.ang1Z=this._relativeAnchor1X*this._basisY1Y-this._relativeAnchor1Y*this._basisY1X,o.ang2X=this._relativeAnchor2Y*this._basisY1Z-this._relativeAnchor2Z*this._basisY1Y,o.ang2Y=this._relativeAnchor2Z*this._basisY1X-this._relativeAnchor2X*this._basisY1Z,o.ang2Z=this._relativeAnchor2X*this._basisY1Y-this._relativeAnchor2Y*this._basisY1X}if(this._translSds[2].frequency<=0||!a){var x=this._impulses[2],p=t.rows[t.numRows++],f=p.jacobian;f.lin1X=0,f.lin1Y=0,f.lin1Z=0,f.lin2X=0,f.lin2Y=0,f.lin2Z=0,f.ang1X=0,f.ang1Y=0,f.ang1Z=0,f.ang2X=0,f.ang2Y=0,f.ang2Z=0,p.rhs=0,p.cfm=0,p.minImpulse=0,p.maxImpulse=0,p.motorSpeed=0,p.motorMaxImpulse=0,p.impulse=null,p.impulse=x,s=p,this.setSolverInfoRowLinear(s,this.translationZ,this._translLms[2],n,this._translSds[2],i,a),(o=s.jacobian).lin1X=this._basisZ1X,o.lin1Y=this._basisZ1Y,o.lin1Z=this._basisZ1Z,o.lin2X=this._basisZ1X,o.lin2Y=this._basisZ1Y,o.lin2Z=this._basisZ1Z,o.ang1X=this._relativeAnchor1Y*this._basisZ1Z-this._relativeAnchor1Z*this._basisZ1Y,o.ang1Y=this._relativeAnchor1Z*this._basisZ1X-this._relativeAnchor1X*this._basisZ1Z,o.ang1Z=this._relativeAnchor1X*this._basisZ1Y-this._relativeAnchor1Y*this._basisZ1X,o.ang2X=this._relativeAnchor2Y*this._basisZ1Z-this._relativeAnchor2Z*this._basisZ1Y,o.ang2Y=this._relativeAnchor2Z*this._basisZ1X-this._relativeAnchor2X*this._basisZ1Z,o.ang2Z=this._relativeAnchor2X*this._basisZ1Y-this._relativeAnchor2Y*this._basisZ1X}if(!this.xSingular&&(this._rotSds[0].frequency<=0||!a)){var u=this._impulses[3],y=t.rows[t.numRows++],d=y.jacobian;d.lin1X=0,d.lin1Y=0,d.lin1Z=0,d.lin2X=0,d.lin2Y=0,d.lin2Z=0,d.ang1X=0,d.ang1Y=0,d.ang1Z=0,d.ang2X=0,d.ang2Y=0,d.ang2Z=0,y.rhs=0,y.cfm=0,y.minImpulse=0,y.maxImpulse=0,y.motorSpeed=0,y.motorMaxImpulse=0,y.impulse=null,y.impulse=u,s=y,this.setSolverInfoRowAngular(s,this._angleX,this._rotLms[0],r,this._rotSds[0],i,a),(o=s.jacobian).ang1X=this._axisXX,o.ang1Y=this._axisXY,o.ang1Z=this._axisXZ,o.ang2X=this._axisXX,o.ang2Y=this._axisXY,o.ang2Z=this._axisXZ}if(!this.ySingular&&(this._rotSds[1].frequency<=0||!a)){var g=this._impulses[4],X=t.rows[t.numRows++],z=X.jacobian;z.lin1X=0,z.lin1Y=0,z.lin1Z=0,z.lin2X=0,z.lin2Y=0,z.lin2Z=0,z.ang1X=0,z.ang1Y=0,z.ang1Z=0,z.ang2X=0,z.ang2Y=0,z.ang2Z=0,X.rhs=0,X.cfm=0,X.minImpulse=0,X.maxImpulse=0,X.motorSpeed=0,X.motorMaxImpulse=0,X.impulse=null,X.impulse=g,s=X,this.setSolverInfoRowAngular(s,this._angleY,this._rotLms[1],e,this._rotSds[1],i,a),(o=s.jacobian).ang1X=this._axisYX,o.ang1Y=this._axisYY,o.ang1Z=this._axisYZ,o.ang2X=this._axisYX,o.ang2Y=this._axisYY,o.ang2Z=this._axisYZ}if(!this.zSingular&&(this._rotSds[2].frequency<=0||!a)){var Y=this._impulses[5],Z=t.rows[t.numRows++],M=Z.jacobian;M.lin1X=0,M.lin1Y=0,M.lin1Z=0,M.lin2X=0,M.lin2Y=0,M.lin2Z=0,M.ang1X=0,M.ang1Y=0,M.ang1Z=0,M.ang2X=0,M.ang2Y=0,M.ang2Z=0,Z.rhs=0,Z.cfm=0,Z.minImpulse=0,Z.maxImpulse=0,Z.motorSpeed=0,Z.motorMaxImpulse=0,Z.impulse=null,Z.impulse=Y,s=Z,this.setSolverInfoRowAngular(s,this._angleZ,this._rotLms[2],_,this._rotSds[2],i,a),(o=s.jacobian).ang1X=this._axisZX,o.ang1Y=this._axisZY,o.ang1Z=this._axisZZ,o.ang2X=this._axisZX,o.ang2Y=this._axisZY,o.ang2Z=this._axisZZ}}_syncAnchors(){var t,i,a,s,o,n,r,e,_;super._syncAnchors(),this._basisX1X,this._basisY1X,this._basisZ1X,this._basisX1Y,this._basisY1Y,this._basisZ1Y,this._basisX1Z,this._basisY1Z,this._basisZ1Z,this._basisX2X,this._basisY2X,this._basisZ2X,this._basisX2Y,this._basisY2Y,this._basisZ2Y,this._basisX2Z,this._basisY2Z,this._basisZ2Z,t=this._basisX1X,i=this._basisX1Y,a=this._basisX1Z,r=this._basisZ2X,s=(e=this._basisZ2Y)*a-(_=this._basisZ2Z)*i,o=_*t-r*a,n=r*i-e*t,this._axisXX=o*_-n*e,this._axisXY=n*r-s*_,this._axisXZ=s*e-o*r,this._axisYX=s,this._axisYY=o,this._axisYZ=n,this._axisZX=i*n-a*o,this._axisZY=a*s-t*n,this._axisZZ=t*o-i*s;var h=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;h>0&&(h=1/Math.sqrt(h)),this._axisXX*=h,this._axisXY*=h,this._axisXZ*=h;var l=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;l>0&&(l=1/Math.sqrt(l)),this._axisYX*=l,this._axisYY*=l,this._axisYZ*=l;var c,m,v,b,x,p,f,u,y,d,g,X,z,Y,Z,M,I,V,w,L,k,B,A,P,S,T,C=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;C>0&&(C=1/Math.sqrt(C)),this._axisZX*=C,this._axisZY*=C,this._axisZZ*=C,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0,c=this._basisX1X,m=this._basisY1X,v=this._basisZ1X,b=this._basisX1Y,x=this._basisY1Y,p=this._basisZ1Y,f=this._basisX1Z,u=this._basisY1Z,y=this._basisZ1Z,d=this._basisX2X,g=this._basisY2X,X=this._basisZ2X,z=this._basisX2Y,Y=this._basisY2Y,Z=this._basisZ2Y,V=c*d+b*z+f*this._basisX2Z,w=c*g+b*Y+f*(M=this._basisY2Z),L=m*g+x*Y+u*M,k=m*X+x*Z+u*(I=this._basisZ2Z),B=v*g+p*Y+y*M,A=v*X+p*Z+y*I;var j,R,E,q=c*X+b*Z+f*I;if(q<=-1){var N=Math.atan2(B,L);P=.5*N,S=-1.570796326794895,T=.5*-N}else if(q>=1){var F=Math.atan2(B,L);P=.5*F,S=1.570796326794895,T=.5*F}else{var D=Math.asin(q);P=Math.atan2(-k,A),S=D,T=Math.atan2(-w,V)}this._angleX=P,this._angleY=S,this._angleZ=T,j=this._anchor2X-this._anchor1X,R=this._anchor2Y-this._anchor1Y,E=this._anchor2Z-this._anchor1Z,this.translationX=j*this._basisX1X+R*this._basisX1Y+E*this._basisX1Z,this.translationY=j*this._basisY1X+R*this._basisY1Y+E*this._basisY1Z,this.translationZ=j*this._basisZ1X+R*this._basisZ1Y+E*this._basisZ1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxisX(){var t=new pa.common.Vec3,i=t;return i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z,t}getAxisY(){var t=new pa.common.Vec3,i=t;return i.x=this._axisYX,i.y=this._axisYY,i.z=this._axisYZ,t}getAxisZ(){var t=new pa.common.Vec3,i=t;return i.x=this._basisZ2X,i.y=this._basisZ2Y,i.z=this._basisZ2Z,t}getTranslationalSpringDampers(){return this._translSds.slice(0)}getRotationalSpringDampers(){return this._translSds.slice(0)}getTranslationalLimitMotors(){return this._translLms.slice(0)}getRotationalLimitMotors(){return this._rotLms.slice(0)}getAngles(){return new pa.common.Vec3(this._angleX,this._angleY,this._angleZ)}getTranslations(){return new pa.common.Vec3(this.translationX,this.translationY,this.translationZ)}},pa.dynamics.constraint.joint.GenericJointConfig=class extends pa.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localBasis1=new pa.common.Mat3,this.localBasis2=new pa.common.Mat3;var t=[];t.push((new pa.dynamics.constraint.joint.TranslationalLimitMotor).setLimits(0,0)),t.push((new pa.dynamics.constraint.joint.TranslationalLimitMotor).setLimits(0,0)),t.push((new pa.dynamics.constraint.joint.TranslationalLimitMotor).setLimits(0,0)),this.translationalLimitMotors=t;var i=[];i.push((new pa.dynamics.constraint.joint.RotationalLimitMotor).setLimits(0,0)),i.push((new pa.dynamics.constraint.joint.RotationalLimitMotor).setLimits(0,0)),i.push((new pa.dynamics.constraint.joint.RotationalLimitMotor).setLimits(0,0)),this.rotationalLimitMotors=i,this.translationalSpringDampers=[new pa.dynamics.constraint.joint.SpringDamper,new pa.dynamics.constraint.joint.SpringDamper,new pa.dynamics.constraint.joint.SpringDamper],this.rotationalSpringDampers=[new pa.dynamics.constraint.joint.SpringDamper,new pa.dynamics.constraint.joint.SpringDamper,new pa.dynamics.constraint.joint.SpringDamper]}init(t,i,a,s,o){this._init(t,i,a);var n,r,e,_,h,l,c,m,v,b,x,p,f,u,y,d,g,X,z,Y,Z,M,I,V,w,L,k,B,A,P,S,T,C,j,R,E,q=t._transform,N=i._transform,F=s;n=F.e00,r=F.e01,e=F.e02,_=F.e10,h=F.e11,l=F.e12,c=F.e20,m=F.e21,v=F.e22;var D=o;b=D.e00,x=D.e01,p=D.e02,f=D.e10,u=D.e11,y=D.e12,d=D.e20,g=D.e21,X=D.e22,z=q._rotation00*n+q._rotation10*_+q._rotation20*c,Y=q._rotation00*r+q._rotation10*h+q._rotation20*m,Z=q._rotation00*e+q._rotation10*l+q._rotation20*v,M=q._rotation01*n+q._rotation11*_+q._rotation21*c,I=q._rotation01*r+q._rotation11*h+q._rotation21*m,V=q._rotation01*e+q._rotation11*l+q._rotation21*v,w=q._rotation02*n+q._rotation12*_+q._rotation22*c,L=q._rotation02*r+q._rotation12*h+q._rotation22*m,k=q._rotation02*e+q._rotation12*l+q._rotation22*v,B=N._rotation00*b+N._rotation10*f+N._rotation20*d,A=N._rotation00*x+N._rotation10*u+N._rotation20*g,P=N._rotation00*p+N._rotation10*y+N._rotation20*X,S=N._rotation01*b+N._rotation11*f+N._rotation21*d,T=N._rotation01*x+N._rotation11*u+N._rotation21*g,C=N._rotation01*p+N._rotation11*y+N._rotation21*X,j=N._rotation02*b+N._rotation12*f+N._rotation22*d,R=N._rotation02*x+N._rotation12*u+N._rotation22*g,E=N._rotation02*p+N._rotation12*y+N._rotation22*X;var G=this.localBasis1;G.e00=z,G.e01=Y,G.e02=Z,G.e10=M,G.e11=I,G.e12=V,G.e20=w,G.e21=L,G.e22=k;var W=this.localBasis2;return W.e00=B,W.e01=A,W.e02=P,W.e10=S,W.e11=T,W.e12=C,W.e20=j,W.e21=R,W.e22=E,this}},pa.dynamics.constraint.joint.JointImpulse=class{constructor(){this.impulse=0,this.impulseM=0,this.impulseP=0}},pa.dynamics.constraint.joint.JointLink=class{constructor(t){this._joint=t}getContact(){return this._joint}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}},pa.dynamics.constraint.joint.JointMacro=class{},pa.dynamics.constraint.joint.JointType=class{},pa.dynamics.constraint.joint.PrismaticJoint=class extends pa.dynamics.constraint.joint.Joint{constructor(t){super(t,pa.dynamics.constraint.joint.JointType.PRISMATIC);var i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;var a=t.localAxis2;this._localBasisX2X=a.x,this._localBasisX2Y=a.y,this._localBasisX2Z=a.z,this.buildLocalBasesFromX(),this._basis=new pa.dynamics.constraint.joint.BasisTracker(this),this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this.angularErrorX=0,this.angularErrorY=0,this.angularErrorZ=0,this._sd=t.springDamper.clone(),this._lm=t.limitMotor.clone()}getInfo(t,i,a){var s,o,n=this.getErp(i,a),r=this.linearErrorY*n,e=this.linearErrorZ*n,_=this.angularErrorX*n,h=this.angularErrorY*n,l=this.angularErrorZ*n,c=1/(this._b1._invMass+this._b2._invMass);if(this._sd.frequency<=0||!a){var m=this._impulses[0],v=t.rows[t.numRows++],b=v.jacobian;b.lin1X=0,b.lin1Y=0,b.lin1Z=0,b.lin2X=0,b.lin2Y=0,b.lin2Z=0,b.ang1X=0,b.ang1Y=0,b.ang1Z=0,b.ang2X=0,b.ang2Y=0,b.ang2Z=0,v.rhs=0,v.cfm=0,v.minImpulse=0,v.maxImpulse=0,v.motorSpeed=0,v.motorMaxImpulse=0,v.impulse=null,v.impulse=m,s=v,this.setSolverInfoRowLinear(s,this.translation,this._lm,c,this._sd,i,a),(o=s.jacobian).lin1X=this._basis.xX,o.lin1Y=this._basis.xY,o.lin1Z=this._basis.xZ,o.lin2X=this._basis.xX,o.lin2Y=this._basis.xY,o.lin2Z=this._basis.xZ,o.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,o.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,o.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,o.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,o.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,o.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}var x=this._impulses[1],p=t.rows[t.numRows++],f=p.jacobian;f.lin1X=0,f.lin1Y=0,f.lin1Z=0,f.lin2X=0,f.lin2Y=0,f.lin2Z=0,f.ang1X=0,f.ang1Y=0,f.ang1Z=0,f.ang2X=0,f.ang2Y=0,f.ang2Z=0,p.rhs=0,p.cfm=0,p.minImpulse=0,p.maxImpulse=0,p.motorSpeed=0,p.motorMaxImpulse=0,p.impulse=null,p.impulse=x,(s=p).rhs=r,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=Infinity,(o=s.jacobian).lin1X=this._basis.yX,o.lin1Y=this._basis.yY,o.lin1Z=this._basis.yZ,o.lin2X=this._basis.yX,o.lin2Y=this._basis.yY,o.lin2Z=this._basis.yZ,o.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,o.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,o.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,o.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,o.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,o.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;var u=this._impulses[2],y=t.rows[t.numRows++],d=y.jacobian;d.lin1X=0,d.lin1Y=0,d.lin1Z=0,d.lin2X=0,d.lin2Y=0,d.lin2Z=0,d.ang1X=0,d.ang1Y=0,d.ang1Z=0,d.ang2X=0,d.ang2Y=0,d.ang2Z=0,y.rhs=0,y.cfm=0,y.minImpulse=0,y.maxImpulse=0,y.motorSpeed=0,y.motorMaxImpulse=0,y.impulse=null,y.impulse=u,(s=y).rhs=e,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=Infinity,(o=s.jacobian).lin1X=this._basis.zX,o.lin1Y=this._basis.zY,o.lin1Z=this._basis.zZ,o.lin2X=this._basis.zX,o.lin2Y=this._basis.zY,o.lin2Z=this._basis.zZ,o.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,o.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,o.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,o.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,o.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,o.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX;var g=this._impulses[3],X=t.rows[t.numRows++],z=X.jacobian;z.lin1X=0,z.lin1Y=0,z.lin1Z=0,z.lin2X=0,z.lin2Y=0,z.lin2Z=0,z.ang1X=0,z.ang1Y=0,z.ang1Z=0,z.ang2X=0,z.ang2Y=0,z.ang2Z=0,X.rhs=0,X.cfm=0,X.minImpulse=0,X.maxImpulse=0,X.motorSpeed=0,X.motorMaxImpulse=0,X.impulse=null,X.impulse=g,(s=X).rhs=_,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=Infinity,(o=s.jacobian).ang1X=1,o.ang1Y=0,o.ang1Z=0,o.ang2X=1,o.ang2Y=0,o.ang2Z=0;var Y=this._impulses[4],Z=t.rows[t.numRows++],M=Z.jacobian;M.lin1X=0,M.lin1Y=0,M.lin1Z=0,M.lin2X=0,M.lin2Y=0,M.lin2Z=0,M.ang1X=0,M.ang1Y=0,M.ang1Z=0,M.ang2X=0,M.ang2Y=0,M.ang2Z=0,Z.rhs=0,Z.cfm=0,Z.minImpulse=0,Z.maxImpulse=0,Z.motorSpeed=0,Z.motorMaxImpulse=0,Z.impulse=null,Z.impulse=Y,(s=Z).rhs=h,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=Infinity,(o=s.jacobian).ang1X=0,o.ang1Y=1,o.ang1Z=0,o.ang2X=0,o.ang2Y=1,o.ang2Z=0;var I=this._impulses[5],V=t.rows[t.numRows++],w=V.jacobian;w.lin1X=0,w.lin1Y=0,w.lin1Z=0,w.lin2X=0,w.lin2Y=0,w.lin2Z=0,w.ang1X=0,w.ang1Y=0,w.ang1Z=0,w.ang2X=0,w.ang2Y=0,w.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=I,(s=V).rhs=l,s.cfm=0,s.minImpulse=-1/0,s.maxImpulse=Infinity,(o=s.jacobian).ang1X=0,o.ang1Y=0,o.ang1Z=1,o.ang2X=0,o.ang2Y=0,o.ang2Z=1}_syncAnchors(){super._syncAnchors();var t,i,a,s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y,d,g,X,z,Y,Z,M,I,V,w,L,k,B,A,P,S,T,C,j,R=this._basis,E=R.joint._b1._invMass,q=R.joint._b2._invMass,N=R.joint._basisX1X*R.joint._basisX2X+R.joint._basisX1Y*R.joint._basisX2Y+R.joint._basisX1Z*R.joint._basisX2Z;if(N<-.999999999){var F,D,G,W,J=R.joint._basisX1X,U=R.joint._basisX1Y,O=R.joint._basisX1Z,H=J*J,Q=U*U,K=O*O;H<Q?H<K?(F=0,D=O*(W=1/Math.sqrt(Q+K)),G=-U*W):(F=U*(W=1/Math.sqrt(H+Q)),D=-J*W,G=0):Q<K?(F=-O*(W=1/Math.sqrt(K+H)),D=0,G=J*W):(F=U*(W=1/Math.sqrt(H+Q)),D=-J*W,G=0),t=F,i=D,a=G,s=0}else{var $,tt,it;$=R.joint._basisX1Y*R.joint._basisX2Z-R.joint._basisX1Z*R.joint._basisX2Y,tt=R.joint._basisX1Z*R.joint._basisX2X-R.joint._basisX1X*R.joint._basisX2Z,it=R.joint._basisX1X*R.joint._basisX2Y-R.joint._basisX1Y*R.joint._basisX2X;var at=Math.sqrt(.5*(1+N));t=$*=N=.5/at,i=tt*=N,a=it*=N,s=at}var st=(k=0)*(S=t)+(B=0)*(T=i)+(A=0)*(C=a)+(P=1)*(j=s);if(st<0&&(st=-st,S=-S,T=-T,C=-C,j=-j),st>.999999){var ot=(S=k+(S-k)*(E/(E+q)))*S+(T=B+(T-B)*(E/(E+q)))*T+(C=A+(C-A)*(E/(E+q)))*C+(j=P+(j-P)*(E/(E+q)))*j;ot>1e-32&&(ot=1/Math.sqrt(ot)),o=S*ot,n=T*ot,r=C*ot,e=j*ot}else{var nt=E/(E+q)*Math.acos(st),rt=(S+=k*-st)*S+(T+=B*-st)*T+(C+=A*-st)*C+(j+=P*-st)*j;rt>1e-32&&(rt=1/Math.sqrt(rt)),S*=rt,T*=rt,C*=rt,j*=rt;var et=Math.sin(nt),_t=Math.cos(nt);o=(k*=_t)+S*et,n=(B*=_t)+T*et,r=(A*=_t)+C*et,e=(P*=_t)+j*et}var ht=2*o,lt=2*n,ct=2*r,mt=o*ht,vt=n*lt,bt=r*ct,xt=o*lt,pt=n*ct,ft=o*ct,ut=e*ht,yt=e*lt,dt=e*ct;_=xt-dt,h=ft+yt,l=xt+dt,c=1-mt-bt,m=pt-ut,v=ft-yt,b=pt+ut,x=1-mt-vt,p=(1-vt-bt)*R.joint._basisX1X+_*R.joint._basisX1Y+h*R.joint._basisX1Z,f=l*R.joint._basisX1X+c*R.joint._basisX1Y+m*R.joint._basisX1Z,u=v*R.joint._basisX1X+b*R.joint._basisX1Y+x*R.joint._basisX1Z,Z=R.xX,M=R.xY,I=R.xZ,V=R.yX,w=R.yY,L=R.yZ;var gt=Z*p+M*f+I*u;if(gt<-.999999999){var Xt,zt,Yt,Zt,Mt=Z,It=M,Vt=I,wt=Mt*Mt,Lt=It*It,kt=Vt*Vt;wt<Lt?wt<kt?(Xt=0,zt=Vt*(Zt=1/Math.sqrt(Lt+kt)),Yt=-It*Zt):(Xt=It*(Zt=1/Math.sqrt(wt+Lt)),zt=-Mt*Zt,Yt=0):Lt<kt?(Xt=-Vt*(Zt=1/Math.sqrt(kt+wt)),zt=0,Yt=Mt*Zt):(Xt=It*(Zt=1/Math.sqrt(wt+Lt)),zt=-Mt*Zt,Yt=0),o=Xt,n=zt,r=Yt,e=0}else{var Bt,At,Pt;Bt=M*u-I*f,At=I*p-Z*u,Pt=Z*f-M*p;var St=Math.sqrt(.5*(1+gt));o=Bt*=gt=.5/St,n=At*=gt,r=Pt*=gt,e=St}var Tt,Ct,jt,Rt,Et,qt,Nt,Ft,Dt,Gt,Wt,Jt,Ut,Ot,Ht,Qt,Kt,$t,ti,ii,ai,si,oi,ni,ri,ei,_i,hi,li=2*o,ci=2*n,mi=2*r,vi=o*li,bi=n*ci,xi=r*mi,pi=o*ci,fi=n*mi,ui=o*mi,yi=e*li,di=e*ci,gi=e*mi;if((X=f*(g=(v=ui-di)*V+(b=fi+yi)*w+(x=1-vi-bi)*L)-u*(d=(l=pi+gi)*V+(c=1-vi-xi)*w+(m=fi-yi)*L))*X+(z=u*(y=(1-bi-xi)*V+(_=pi-gi)*w+(h=ui+di)*L)-p*g)*z+(Y=p*d-f*y)*Y>1e-6){var Xi=X*X+z*z+Y*Y;Xi>0&&(Xi=1/Math.sqrt(Xi)),X*=Xi,z*=Xi,Y*=Xi}else{var zi,Yi=p,Zi=f,Mi=u,Ii=Yi*Yi,Vi=Zi*Zi,wi=Mi*Mi;Ii<Vi?Ii<wi?(X=0,z=Mi*(zi=1/Math.sqrt(Vi+wi)),Y=-Zi*zi):(X=Zi*(zi=1/Math.sqrt(Ii+Vi)),z=-Yi*zi,Y=0):Vi<wi?(X=-Mi*(zi=1/Math.sqrt(wi+Ii)),z=0,Y=Yi*zi):(X=Zi*(zi=1/Math.sqrt(Ii+Vi)),z=-Yi*zi,Y=0)}y=z*u-Y*f,d=Y*p-X*u,g=X*f-z*p,R.xX=p,R.xY=f,R.xZ=u,R.yX=y,R.yY=d,R.yZ=g,R.zX=X,R.zY=z,R.zZ=Y,Tt=this._basisX1X,Ct=this._basisY1X,jt=this._basisZ1X,Rt=this._basisX1Y,Et=this._basisY1Y,qt=this._basisZ1Y,Nt=this._basisX1Z,Ft=this._basisY1Z,Dt=this._basisZ1Z,ti=(Gt=this._basisX2X)*Rt+(Wt=this._basisY2X)*Et+(Jt=this._basisZ2X)*qt,ii=Gt*Nt+Wt*Ft+Jt*Dt,ai=(Ut=this._basisX2Y)*Tt+(Ot=this._basisY2Y)*Ct+(Ht=this._basisZ2Y)*jt,si=Ut*Nt+Ot*Ft+Ht*Dt,oi=(Qt=this._basisX2Z)*Tt+(Kt=this._basisY2Z)*Ct+($t=this._basisZ2Z)*jt,ni=Qt*Rt+Kt*Et+$t*qt;var Li,ki=Gt*Tt+Wt*Ct+Jt*jt,Bi=Ut*Rt+Ot*Et+Ht*qt,Ai=Qt*Nt+Kt*Ft+$t*Dt,Pi=ki+Bi+Ai;Pi>0?(hi=.5*(Li=Math.sqrt(Pi+1)),ri=(ni-si)*(Li=.5/Li),ei=(ii-oi)*Li,_i=(ai-ti)*Li):ki>Bi?ki>Ai?(ri=.5*(Li=Math.sqrt(ki-Bi-Ai+1)),ei=(ti+ai)*(Li=.5/Li),_i=(ii+oi)*Li,hi=(ni-si)*Li):(_i=.5*(Li=Math.sqrt(Ai-ki-Bi+1)),ri=(ii+oi)*(Li=.5/Li),ei=(si+ni)*Li,hi=(ai-ti)*Li):Bi>Ai?(ei=.5*(Li=Math.sqrt(Bi-Ai-ki+1)),ri=(ti+ai)*(Li=.5/Li),_i=(si+ni)*Li,hi=(ii-oi)*Li):(_i=.5*(Li=Math.sqrt(Ai-ki-Bi+1)),ri=(ii+oi)*(Li=.5/Li),ei=(si+ni)*Li,hi=(ai-ti)*Li);var Si=hi,Ti=2*(Si<=-1?3.14159265358979:Si>=1?0:Math.acos(Si));this.angularErrorX=ri,this.angularErrorY=ei,this.angularErrorZ=_i;var Ci,ji,Ri,Ei=this.angularErrorX*this.angularErrorX+this.angularErrorY*this.angularErrorY+this.angularErrorZ*this.angularErrorZ;Ei>0&&(Ei=1/Math.sqrt(Ei)),this.angularErrorX*=Ei,this.angularErrorY*=Ei,this.angularErrorZ*=Ei,this.angularErrorX*=Ti,this.angularErrorY*=Ti,this.angularErrorZ*=Ti,Ci=this._anchor2X-this._anchor1X,ji=this._anchor2Y-this._anchor1Y,Ri=this._anchor2Z-this._anchor1Z,this.translation=Ci*this._basis.xX+ji*this._basis.xY+Ri*this._basis.xZ,this.linearErrorY=Ci*this._basis.yX+ji*this._basis.yY+Ri*this._basis.yZ,this.linearErrorZ=Ci*this._basis.zX+ji*this._basis.zY+Ri*this._basis.zZ}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){var t=new pa.common.Vec3,i=t;return i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z,t}getAxis2(){var t=new pa.common.Vec3,i=t;return i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z,t}getAxis1To(t){var i=t;i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z}getAxis2To(t){var i=t;i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z}getLocalAxis1(){var t=new pa.common.Vec3,i=t;return i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z,t}getLocalAxis2(){var t=new pa.common.Vec3,i=t;return i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z,t}getLocalAxis1To(t){var i=t;i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z}getLocalAxis2To(t){var i=t;i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getTranslation(){return this.translation}},pa.dynamics.constraint.joint.PrismaticJointConfig=class extends pa.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new pa.common.Vec3(1,0,0),this.localAxis2=new pa.common.Vec3(1,0,0),this.limitMotor=new pa.dynamics.constraint.joint.TranslationalLimitMotor,this.springDamper=new pa.dynamics.constraint.joint.SpringDamper}init(t,i,a,s){var o,n,r;this._init(t,i,a);var e,_,h,l=s;o=l.x,n=l.y,r=l.z,e=t._transform._rotation00*o+t._transform._rotation10*n+t._transform._rotation20*r,_=t._transform._rotation01*o+t._transform._rotation11*n+t._transform._rotation21*r,h=t._transform._rotation02*o+t._transform._rotation12*n+t._transform._rotation22*r,o=e,n=_,r=h;var c,m,v,b=this.localAxis1;b.x=o,b.y=n,b.z=r;var x,p,f,u=s;c=u.x,m=u.y,v=u.z,x=i._transform._rotation00*c+i._transform._rotation10*m+i._transform._rotation20*v,p=i._transform._rotation01*c+i._transform._rotation11*m+i._transform._rotation21*v,f=i._transform._rotation02*c+i._transform._rotation12*m+i._transform._rotation22*v,c=x,m=p,v=f;var y=this.localAxis2;return y.x=c,y.y=m,y.z=v,this}},pa.dynamics.constraint.joint.RagdollJoint=class extends pa.dynamics.constraint.joint.Joint{constructor(t){super(t,pa.dynamics.constraint.joint.JointType.RAGDOLL);var i=t.localTwistAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;var a=t.localSwingAxis1;this._localBasisY1X=a.x,this._localBasisY1Y=a.y,this._localBasisY1Z=a.z;var s=t.localTwistAxis2;this._localBasisX2X=s.x,this._localBasisX2Y=s.y,this._localBasisX2Z=s.z,this.buildLocalBasesFromXY1X2(),this._twistSd=t.twistSpringDamper.clone(),this._twistLm=t.twistLimitMotor.clone(),this._swingSd=t.swingSpringDamper.clone(),this._maxSwingAngle1=t.maxSwingAngle1,this._maxSwingAngle2=t.maxSwingAngle2,this._maxSwingAngle1<pa.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle1=pa.common.Setting.minRagdollMaxSwingAngle),this._maxSwingAngle2<pa.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle2=pa.common.Setting.minRagdollMaxSwingAngle),this.dummySwingLm=new pa.dynamics.constraint.joint.RotationalLimitMotor,this.dummySwingLm.lowerLimit=-1,this.dummySwingLm.upperLimit=0,this._swingAngle=0,this._twistAngle=0,this.swingError=0,this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.twistAxisX=0,this.twistAxisY=0,this.twistAxisZ=0}getInfo(t,i,a){var s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y,d,g=this.getErp(i,a),X=this.linearErrorX*g,z=this.linearErrorY*g,Y=this.linearErrorZ*g;s=-(s=0),o=-(o=-this._relativeAnchor1Z),n=-(n=this._relativeAnchor1Y),r=-(r=this._relativeAnchor1Z),e=-(e=0),_=-(_=-this._relativeAnchor1X),h=-(h=-this._relativeAnchor1Y),l=-(l=this._relativeAnchor1X),c=-(c=0),m=-(m=0),v=-(v=-this._relativeAnchor2Z),b=-(b=this._relativeAnchor2Y),x=-(x=this._relativeAnchor2Z),p=-(p=0),f=-(f=-this._relativeAnchor2X),u=-(u=-this._relativeAnchor2Y),y=-(y=this._relativeAnchor2X),d=-(d=0);var Z=this.computeEffectiveInertiaMoment(this.swingAxisX,this.swingAxisY,this.swingAxisZ),M=this.computeEffectiveInertiaMoment(this._basisX2X,this._basisX2Y,this._basisX2Z),I=this._impulses[0],V=t.rows[t.numRows++],w=V.jacobian;w.lin1X=0,w.lin1Y=0,w.lin1Z=0,w.lin2X=0,w.lin2Y=0,w.lin2Z=0,w.ang1X=0,w.ang1Y=0,w.ang1Z=0,w.ang2X=0,w.ang2Y=0,w.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=I;var L=V;L.rhs=X,L.cfm=0,L.minImpulse=-1/0,L.maxImpulse=Infinity;var k=L.jacobian;k.lin1X=1,k.lin1Y=0,k.lin1Z=0,k.lin2X=1,k.lin2Y=0,k.lin2Z=0,k.ang1X=s,k.ang1Y=o,k.ang1Z=n,k.ang2X=m,k.ang2Y=v,k.ang2Z=b;var B=this._impulses[1],A=t.rows[t.numRows++],P=A.jacobian;P.lin1X=0,P.lin1Y=0,P.lin1Z=0,P.lin2X=0,P.lin2Y=0,P.lin2Z=0,P.ang1X=0,P.ang1Y=0,P.ang1Z=0,P.ang2X=0,P.ang2Y=0,P.ang2Z=0,A.rhs=0,A.cfm=0,A.minImpulse=0,A.maxImpulse=0,A.motorSpeed=0,A.motorMaxImpulse=0,A.impulse=null,A.impulse=B,(L=A).rhs=z,L.cfm=0,L.minImpulse=-1/0,L.maxImpulse=Infinity,(k=L.jacobian).lin1X=0,k.lin1Y=1,k.lin1Z=0,k.lin2X=0,k.lin2Y=1,k.lin2Z=0,k.ang1X=r,k.ang1Y=e,k.ang1Z=_,k.ang2X=x,k.ang2Y=p,k.ang2Z=f;var S=this._impulses[2],T=t.rows[t.numRows++],C=T.jacobian;if(C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,T.rhs=0,T.cfm=0,T.minImpulse=0,T.maxImpulse=0,T.motorSpeed=0,T.motorMaxImpulse=0,T.impulse=null,T.impulse=S,(L=T).rhs=Y,L.cfm=0,L.minImpulse=-1/0,L.maxImpulse=Infinity,(k=L.jacobian).lin1X=0,k.lin1Y=0,k.lin1Z=1,k.lin2X=0,k.lin2Y=0,k.lin2Z=1,k.ang1X=h,k.ang1Y=l,k.ang1Z=c,k.ang2X=u,k.ang2Y=y,k.ang2Z=d,this.swingError>0&&(this._swingSd.frequency<=0||!a)){var j=this._impulses[3],R=t.rows[t.numRows++],E=R.jacobian;E.lin1X=0,E.lin1Y=0,E.lin1Z=0,E.lin2X=0,E.lin2Y=0,E.lin2Z=0,E.ang1X=0,E.ang1Y=0,E.ang1Z=0,E.ang2X=0,E.ang2Y=0,E.ang2Z=0,R.rhs=0,R.cfm=0,R.minImpulse=0,R.maxImpulse=0,R.motorSpeed=0,R.motorMaxImpulse=0,R.impulse=null,R.impulse=j,L=R,this.setSolverInfoRowAngular(L,this.swingError,this.dummySwingLm,Z,this._swingSd,i,a),(k=L.jacobian).ang1X=this.swingAxisX,k.ang1Y=this.swingAxisY,k.ang1Z=this.swingAxisZ,k.ang2X=this.swingAxisX,k.ang2Y=this.swingAxisY,k.ang2Z=this.swingAxisZ}if(this._twistSd.frequency<=0||!a){var q=this._impulses[4],N=t.rows[t.numRows++],F=N.jacobian;F.lin1X=0,F.lin1Y=0,F.lin1Z=0,F.lin2X=0,F.lin2Y=0,F.lin2Z=0,F.ang1X=0,F.ang1Y=0,F.ang1Z=0,F.ang2X=0,F.ang2Y=0,F.ang2Z=0,N.rhs=0,N.cfm=0,N.minImpulse=0,N.maxImpulse=0,N.motorSpeed=0,N.motorMaxImpulse=0,N.impulse=null,N.impulse=q,L=N,this.setSolverInfoRowAngular(L,this._twistAngle,this._twistLm,M,this._twistSd,i,a),(k=L.jacobian).ang1X=this.twistAxisX,k.ang1Y=this.twistAxisY,k.ang1Z=this.twistAxisZ,k.ang2X=this.twistAxisX,k.ang2Y=this.twistAxisY,k.ang2Z=this.twistAxisZ}}_syncAnchors(){var t,i,a,s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y,d,g,X,z,Y,Z,M,I,V,w,L;super._syncAnchors(),this._b1._transform,this._b2._transform,t=this._basisX1X,i=this._basisX1Y,a=this._basisX1Z,s=this._basisX2X,o=this._basisX2Y,n=this._basisX2Z,r=this._basisX1X,e=this._basisY1X,_=this._basisZ1X,h=this._basisX1Y,l=this._basisY1Y,c=this._basisZ1Y,m=this._basisX1Z,v=this._basisY1Z,b=this._basisZ1Z,this._basisX2X,this._basisY2X,this._basisZ2X,this._basisX2Y,this._basisY2Y,this._basisZ2Y,this._basisX2Z,this._basisY2Z,this._basisZ2Z;var k=t*s+i*o+a*n;if(k<-.999999999){var B,A,P,S,T=t,C=i,j=a,R=T*T,E=C*C,q=j*j;R<E?R<q?(B=0,A=j*(S=1/Math.sqrt(E+q)),P=-C*S):(B=C*(S=1/Math.sqrt(R+E)),A=-T*S,P=0):E<q?(B=-j*(S=1/Math.sqrt(q+R)),A=0,P=T*S):(B=C*(S=1/Math.sqrt(R+E)),A=-T*S,P=0),x=B,p=A,f=P,u=0}else{var N,F,D;N=i*n-a*o,F=a*s-t*n,D=t*o-i*s;var G=Math.sqrt(.5*(1+k));x=N*=k=.5/G,p=F*=k,f=D*=k,u=G}var W,J,U,O=2*x,H=2*p,Q=2*f,K=x*O,$=p*H,tt=f*Q,it=x*H,at=p*Q,st=x*Q,ot=u*O,nt=u*H,rt=u*Q;y=1-$-tt,d=it-rt,g=st+nt,X=it+rt,z=1-K-tt,Y=at-ot,Z=st-nt,M=at+ot,I=1-K-$,this._swingAngle=2*(u<=-1?3.14159265358979:u>=1?0:Math.acos(u)),V=x,w=p,L=f,W=y*this._basisY2X+X*this._basisY2Y+Z*this._basisY2Z,J=d*this._basisY2X+z*this._basisY2Y+M*this._basisY2Z,U=g*this._basisY2X+Y*this._basisY2Y+I*this._basisY2Z;var et=this._basisY1X*W+this._basisY1Y*J+this._basisY1Z*U,_t=this._basisZ1X*W+this._basisZ1Y*J+this._basisZ1Z*U;this._twistAngle=Math.atan2(_t,et),this.twistAxisX=this._basisX1X+this._basisX2X,this.twistAxisY=this._basisX1Y+this._basisX2Y,this.twistAxisZ=this._basisX1Z+this._basisX2Z;var ht=this.twistAxisX*this.twistAxisX+this.twistAxisY*this.twistAxisY+this.twistAxisZ*this.twistAxisZ;ht>0&&(ht=1/Math.sqrt(ht)),this.twistAxisX*=ht,this.twistAxisY*=ht,this.twistAxisZ*=ht;var lt,ct,mt=Math.sqrt(V*V+w*w+L*L);mt>0&&(mt=1/mt),lt=e*(V*=mt*this._swingAngle)+l*(w*=mt*this._swingAngle)+v*(L*=mt*this._swingAngle),ct=_*V+c*w+b*L,V=r*V+h*w+m*L;var vt=w=lt,bt=L=ct,xt=this._maxSwingAngle1,pt=this._maxSwingAngle2,ft=1/(xt*xt),ut=1/(pt*pt),yt=vt*vt*ft+bt*bt*ut;if(0==yt)this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.swingError=0;else{var dt,gt,Xt,zt,Yt,Zt,Mt=Math.sqrt(1/yt),It=vt*Mt,Vt=bt*Mt,wt=It*ft,Lt=Vt*ut,kt=(vt-It)*(wt*=mt=1/Math.sqrt(wt*wt+Lt*Lt))+(bt-Vt)*(Lt*=mt);if(kt>0)this.swingError=kt,this.swingAxisX=0,this.swingAxisY=wt,this.swingAxisZ=Lt,dt=r*this.swingAxisX+e*this.swingAxisY+_*this.swingAxisZ,gt=h*this.swingAxisX+l*this.swingAxisY+c*this.swingAxisZ,Xt=m*this.swingAxisX+v*this.swingAxisY+b*this.swingAxisZ,this.swingAxisX=dt,this.swingAxisY=gt,this.swingAxisZ=Xt,zt=y*this.swingAxisX+d*this.swingAxisY+g*this.swingAxisZ,Yt=X*this.swingAxisX+z*this.swingAxisY+Y*this.swingAxisZ,Zt=Z*this.swingAxisX+M*this.swingAxisY+I*this.swingAxisZ,this.swingAxisX=zt,this.swingAxisY=Yt,this.swingAxisZ=Zt;else this.swingError=0}this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){var t=new pa.common.Vec3,i=t;return i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z,t}getAxis2(){var t=new pa.common.Vec3,i=t;return i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z,t}getAxis1To(t){var i=t;i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z}getAxis2To(t){var i=t;i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z}getLocalAxis1(){var t=new pa.common.Vec3,i=t;return i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z,t}getLocalAxis2(){var t=new pa.common.Vec3,i=t;return i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z,t}getLocalAxis1To(t){var i=t;i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z}getLocalAxis2To(t){var i=t;i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z}getTwistSpringDamper(){return this._twistSd}getTwistLimitMotor(){return this._twistLm}getSwingSpringDamper(){return this._swingSd}getSwingAxis(){var t=new pa.common.Vec3,i=t;return i.x=this.swingAxisX,i.y=this.swingAxisY,i.z=this.swingAxisZ,t}getSwingAxisTo(t){var i=t;i.x=this.swingAxisX,i.y=this.swingAxisY,i.z=this.swingAxisZ}getSwingAngle(){return this._swingAngle}getTwistAngle(){return this._twistAngle}},pa.dynamics.constraint.joint.RagdollJointConfig=class extends pa.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localTwistAxis1=new pa.common.Vec3(1,0,0),this.localTwistAxis2=new pa.common.Vec3(1,0,0),this.localSwingAxis1=new pa.common.Vec3(0,1,0),this.twistSpringDamper=new pa.dynamics.constraint.joint.SpringDamper,this.swingSpringDamper=new pa.dynamics.constraint.joint.SpringDamper,this.twistLimitMotor=new pa.dynamics.constraint.joint.RotationalLimitMotor,this.maxSwingAngle1=3.14159265358979,this.maxSwingAngle2=3.14159265358979}init(t,i,a,s,o){var n,r,e;this._init(t,i,a);var _,h,l,c=s;n=c.x,r=c.y,e=c.z,_=t._transform._rotation00*n+t._transform._rotation10*r+t._transform._rotation20*e,h=t._transform._rotation01*n+t._transform._rotation11*r+t._transform._rotation21*e,l=t._transform._rotation02*n+t._transform._rotation12*r+t._transform._rotation22*e,n=_,r=h,e=l;var m,v,b,x=this.localTwistAxis1;x.x=n,x.y=r,x.z=e;var p,f,u,y=s;m=y.x,v=y.y,b=y.z,p=i._transform._rotation00*m+i._transform._rotation10*v+i._transform._rotation20*b,f=i._transform._rotation01*m+i._transform._rotation11*v+i._transform._rotation21*b,u=i._transform._rotation02*m+i._transform._rotation12*v+i._transform._rotation22*b,m=p,v=f,b=u;var d,g,X,z=this.localTwistAxis2;z.x=m,z.y=v,z.z=b;var Y,Z,M,I=o;d=I.x,g=I.y,X=I.z,Y=t._transform._rotation00*d+t._transform._rotation10*g+t._transform._rotation20*X,Z=t._transform._rotation01*d+t._transform._rotation11*g+t._transform._rotation21*X,M=t._transform._rotation02*d+t._transform._rotation12*g+t._transform._rotation22*X,d=Y,g=Z,X=M;var V=this.localSwingAxis1;return V.x=d,V.y=g,V.z=X,this}},pa.dynamics.constraint.joint.RevoluteJoint=class extends pa.dynamics.constraint.joint.Joint{constructor(t){super(t,1);var i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;var a=t.localAxis2;this._localBasisX2X=a.x,this._localBasisX2Y=a.y,this._localBasisX2Z=a.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this._basis=new pa.dynamics.constraint.joint.BasisTracker(this),this._sd=t.springDamper.clone(),this._lm=t.limitMotor.clone()}getInfo(t,i,a){var s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y,d,g=this.getErp(i,a),X=this.linearErrorX*g,z=this.linearErrorY*g,Y=this.linearErrorZ*g,Z=this.angularErrorY*g,M=this.angularErrorZ*g;s=-(s=0),o=-(o=-this._relativeAnchor1Z),n=-(n=this._relativeAnchor1Y),r=-(r=this._relativeAnchor1Z),e=-(e=0),_=-(_=-this._relativeAnchor1X),h=-(h=-this._relativeAnchor1Y),l=-(l=this._relativeAnchor1X),c=-(c=0),m=-(m=0),v=-(v=-this._relativeAnchor2Z),b=-(b=this._relativeAnchor2Y),x=-(x=this._relativeAnchor2Z),p=-(p=0),f=-(f=-this._relativeAnchor2X),u=-(u=-this._relativeAnchor2Y),y=-(y=this._relativeAnchor2X),d=-(d=0);var I=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ),V=this._impulses[0],w=t.rows[t.numRows++],L=w.jacobian;L.lin1X=0,L.lin1Y=0,L.lin1Z=0,L.lin2X=0,L.lin2Y=0,L.lin2Z=0,L.ang1X=0,L.ang1Y=0,L.ang1Z=0,L.ang2X=0,L.ang2Y=0,L.ang2Z=0,w.rhs=0,w.cfm=0,w.minImpulse=0,w.maxImpulse=0,w.motorSpeed=0,w.motorMaxImpulse=0,w.impulse=null,w.impulse=V;var k=w;k.rhs=X,k.cfm=0,k.minImpulse=-1/0,k.maxImpulse=Infinity;var B=k.jacobian;B.lin1X=1,B.lin1Y=0,B.lin1Z=0,B.lin2X=1,B.lin2Y=0,B.lin2Z=0,B.ang1X=s,B.ang1Y=o,B.ang1Z=n,B.ang2X=m,B.ang2Y=v,B.ang2Z=b;var A=this._impulses[1],P=t.rows[t.numRows++],S=P.jacobian;S.lin1X=0,S.lin1Y=0,S.lin1Z=0,S.lin2X=0,S.lin2Y=0,S.lin2Z=0,S.ang1X=0,S.ang1Y=0,S.ang1Z=0,S.ang2X=0,S.ang2Y=0,S.ang2Z=0,P.rhs=0,P.cfm=0,P.minImpulse=0,P.maxImpulse=0,P.motorSpeed=0,P.motorMaxImpulse=0,P.impulse=null,P.impulse=A,(k=P).rhs=z,k.cfm=0,k.minImpulse=-1/0,k.maxImpulse=Infinity,(B=k.jacobian).lin1X=0,B.lin1Y=1,B.lin1Z=0,B.lin2X=0,B.lin2Y=1,B.lin2Z=0,B.ang1X=r,B.ang1Y=e,B.ang1Z=_,B.ang2X=x,B.ang2Y=p,B.ang2Z=f;var T=this._impulses[2],C=t.rows[t.numRows++],j=C.jacobian;if(j.lin1X=0,j.lin1Y=0,j.lin1Z=0,j.lin2X=0,j.lin2Y=0,j.lin2Z=0,j.ang1X=0,j.ang1Y=0,j.ang1Z=0,j.ang2X=0,j.ang2Y=0,j.ang2Z=0,C.rhs=0,C.cfm=0,C.minImpulse=0,C.maxImpulse=0,C.motorSpeed=0,C.motorMaxImpulse=0,C.impulse=null,C.impulse=T,(k=C).rhs=Y,k.cfm=0,k.minImpulse=-1/0,k.maxImpulse=Infinity,(B=k.jacobian).lin1X=0,B.lin1Y=0,B.lin1Z=1,B.lin2X=0,B.lin2Y=0,B.lin2Z=1,B.ang1X=h,B.ang1Y=l,B.ang1Z=c,B.ang2X=u,B.ang2Y=y,B.ang2Z=d,this._sd.frequency<=0||!a){var R=this._impulses[3],E=t.rows[t.numRows++],q=E.jacobian;q.lin1X=0,q.lin1Y=0,q.lin1Z=0,q.lin2X=0,q.lin2Y=0,q.lin2Z=0,q.ang1X=0,q.ang1Y=0,q.ang1Z=0,q.ang2X=0,q.ang2Y=0,q.ang2Z=0,E.rhs=0,E.cfm=0,E.minImpulse=0,E.maxImpulse=0,E.motorSpeed=0,E.motorMaxImpulse=0,E.impulse=null,E.impulse=R,k=E,this.setSolverInfoRowAngular(k,this.angle,this._lm,I,this._sd,i,a),(B=k.jacobian).ang1X=this._basis.xX,B.ang1Y=this._basis.xY,B.ang1Z=this._basis.xZ,B.ang2X=this._basis.xX,B.ang2Y=this._basis.xY,B.ang2Z=this._basis.xZ}var N=this._impulses[4],F=t.rows[t.numRows++],D=F.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,F.rhs=0,F.cfm=0,F.minImpulse=0,F.maxImpulse=0,F.motorSpeed=0,F.motorMaxImpulse=0,F.impulse=null,F.impulse=N,(k=F).rhs=Z,k.cfm=0,k.minImpulse=-1/0,k.maxImpulse=Infinity,(B=k.jacobian).ang1X=this._basis.yX,B.ang1Y=this._basis.yY,B.ang1Z=this._basis.yZ,B.ang2X=this._basis.yX,B.ang2Y=this._basis.yY,B.ang2Z=this._basis.yZ;var G=this._impulses[5],W=t.rows[t.numRows++],J=W.jacobian;J.lin1X=0,J.lin1Y=0,J.lin1Z=0,J.lin2X=0,J.lin2Y=0,J.lin2Z=0,J.ang1X=0,J.ang1Y=0,J.ang1Z=0,J.ang2X=0,J.ang2Y=0,J.ang2Z=0,W.rhs=0,W.cfm=0,W.minImpulse=0,W.maxImpulse=0,W.motorSpeed=0,W.motorMaxImpulse=0,W.impulse=null,W.impulse=G,(k=W).rhs=M,k.cfm=0,k.minImpulse=-1/0,k.maxImpulse=Infinity,(B=k.jacobian).ang1X=this._basis.zX,B.ang1Y=this._basis.zY,B.ang1Z=this._basis.zZ,B.ang2X=this._basis.zX,B.ang2Y=this._basis.zY,B.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();var t,i,a,s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y,d,g,X,z,Y,Z,M,I,V,w,L,k,B,A,P,S,T,C,j,R=this._basis,E=R.joint._b1._invMass,q=R.joint._b2._invMass,N=R.joint._basisX1X*R.joint._basisX2X+R.joint._basisX1Y*R.joint._basisX2Y+R.joint._basisX1Z*R.joint._basisX2Z;if(N<-.999999999){var F,D,G,W,J=R.joint._basisX1X,U=R.joint._basisX1Y,O=R.joint._basisX1Z,H=J*J,Q=U*U,K=O*O;H<Q?H<K?(F=0,D=O*(W=1/Math.sqrt(Q+K)),G=-U*W):(F=U*(W=1/Math.sqrt(H+Q)),D=-J*W,G=0):Q<K?(F=-O*(W=1/Math.sqrt(K+H)),D=0,G=J*W):(F=U*(W=1/Math.sqrt(H+Q)),D=-J*W,G=0),t=F,i=D,a=G,s=0}else{var $,tt,it;$=R.joint._basisX1Y*R.joint._basisX2Z-R.joint._basisX1Z*R.joint._basisX2Y,tt=R.joint._basisX1Z*R.joint._basisX2X-R.joint._basisX1X*R.joint._basisX2Z,it=R.joint._basisX1X*R.joint._basisX2Y-R.joint._basisX1Y*R.joint._basisX2X;var at=Math.sqrt(.5*(1+N));t=$*=N=.5/at,i=tt*=N,a=it*=N,s=at}var st=(k=0)*(S=t)+(B=0)*(T=i)+(A=0)*(C=a)+(P=1)*(j=s);if(st<0&&(st=-st,S=-S,T=-T,C=-C,j=-j),st>.999999){var ot=(S=k+(S-k)*(E/(E+q)))*S+(T=B+(T-B)*(E/(E+q)))*T+(C=A+(C-A)*(E/(E+q)))*C+(j=P+(j-P)*(E/(E+q)))*j;ot>1e-32&&(ot=1/Math.sqrt(ot)),o=S*ot,n=T*ot,r=C*ot,e=j*ot}else{var nt=E/(E+q)*Math.acos(st),rt=(S+=k*-st)*S+(T+=B*-st)*T+(C+=A*-st)*C+(j+=P*-st)*j;rt>1e-32&&(rt=1/Math.sqrt(rt)),S*=rt,T*=rt,C*=rt,j*=rt;var et=Math.sin(nt),_t=Math.cos(nt);o=(k*=_t)+S*et,n=(B*=_t)+T*et,r=(A*=_t)+C*et,e=(P*=_t)+j*et}var ht=2*o,lt=2*n,ct=2*r,mt=o*ht,vt=n*lt,bt=r*ct,xt=o*lt,pt=n*ct,ft=o*ct,ut=e*ht,yt=e*lt,dt=e*ct;_=xt-dt,h=ft+yt,l=xt+dt,c=1-mt-bt,m=pt-ut,v=ft-yt,b=pt+ut,x=1-mt-vt,p=(1-vt-bt)*R.joint._basisX1X+_*R.joint._basisX1Y+h*R.joint._basisX1Z,f=l*R.joint._basisX1X+c*R.joint._basisX1Y+m*R.joint._basisX1Z,u=v*R.joint._basisX1X+b*R.joint._basisX1Y+x*R.joint._basisX1Z,Z=R.xX,M=R.xY,I=R.xZ,V=R.yX,w=R.yY,L=R.yZ;var gt=Z*p+M*f+I*u;if(gt<-.999999999){var Xt,zt,Yt,Zt,Mt=Z,It=M,Vt=I,wt=Mt*Mt,Lt=It*It,kt=Vt*Vt;wt<Lt?wt<kt?(Xt=0,zt=Vt*(Zt=1/Math.sqrt(Lt+kt)),Yt=-It*Zt):(Xt=It*(Zt=1/Math.sqrt(wt+Lt)),zt=-Mt*Zt,Yt=0):Lt<kt?(Xt=-Vt*(Zt=1/Math.sqrt(kt+wt)),zt=0,Yt=Mt*Zt):(Xt=It*(Zt=1/Math.sqrt(wt+Lt)),zt=-Mt*Zt,Yt=0),o=Xt,n=zt,r=Yt,e=0}else{var Bt,At,Pt;Bt=M*u-I*f,At=I*p-Z*u,Pt=Z*f-M*p;var St=Math.sqrt(.5*(1+gt));o=Bt*=gt=.5/St,n=At*=gt,r=Pt*=gt,e=St}var Tt,Ct,jt,Rt=2*o,Et=2*n,qt=2*r,Nt=o*Rt,Ft=n*Et,Dt=r*qt,Gt=o*Et,Wt=n*qt,Jt=o*qt,Ut=e*Rt,Ot=e*Et,Ht=e*qt;if((X=f*(g=(v=Jt-Ot)*V+(b=Wt+Ut)*w+(x=1-Nt-Ft)*L)-u*(d=(l=Gt+Ht)*V+(c=1-Nt-Dt)*w+(m=Wt-Ut)*L))*X+(z=u*(y=(1-Ft-Dt)*V+(_=Gt-Ht)*w+(h=Jt+Ot)*L)-p*g)*z+(Y=p*d-f*y)*Y>1e-6){var Qt=X*X+z*z+Y*Y;Qt>0&&(Qt=1/Math.sqrt(Qt)),X*=Qt,z*=Qt,Y*=Qt}else{var Kt,$t=p,ti=f,ii=u,ai=$t*$t,si=ti*ti,oi=ii*ii;ai<si?ai<oi?(X=0,z=ii*(Kt=1/Math.sqrt(si+oi)),Y=-ti*Kt):(X=ti*(Kt=1/Math.sqrt(ai+si)),z=-$t*Kt,Y=0):si<oi?(X=-ii*(Kt=1/Math.sqrt(oi+ai)),z=0,Y=$t*Kt):(X=ti*(Kt=1/Math.sqrt(ai+si)),z=-$t*Kt,Y=0)}y=z*u-Y*f,d=Y*p-X*u,g=X*f-z*p,R.xX=p,R.xY=f,R.xZ=u,R.yX=y,R.yY=d,R.yZ=g,R.zX=X,R.zY=z,R.zZ=Y,Tt=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,Ct=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,jt=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;var ni,ri,ei,_i=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,hi=_i<=-1?3.14159265358979:_i>=1?0:Math.acos(_i),li=Tt*Tt+Ct*Ct+jt*jt;li>0&&(li=1/Math.sqrt(li)),Tt*=li,Ct*=li,jt*=li,Tt*=hi,Ct*=hi,jt*=hi,this.angularErrorY=Tt*this._basis.yX+Ct*this._basis.yY+jt*this._basis.yZ,this.angularErrorZ=Tt*this._basis.zX+Ct*this._basis.zY+jt*this._basis.zZ,ni=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,ri=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,ei=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,_i=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=_i<=-1?3.14159265358979:_i>=1?0:Math.acos(_i),ni*this._basis.xX+ri*this._basis.xY+ei*this._basis.xZ<0&&(this.angle=-this.angle),this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){var t=new pa.common.Vec3,i=t;return i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z,t}getAxis2(){var t=new pa.common.Vec3,i=t;return i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z,t}getAxis1To(t){var i=t;i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z}getAxis2To(t){var i=t;i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z}getLocalAxis1(){var t=new pa.common.Vec3,i=t;return i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z,t}getLocalAxis2(){var t=new pa.common.Vec3,i=t;return i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z,t}getLocalAxis1To(t){var i=t;i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z}getLocalAxis2To(t){var i=t;i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getAngle(){return this.angle}},pa.dynamics.constraint.joint.RevoluteJointConfig=class extends pa.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new pa.common.Vec3(1,0,0),this.localAxis2=new pa.common.Vec3(1,0,0),this.springDamper=new pa.dynamics.constraint.joint.SpringDamper,this.limitMotor=new pa.dynamics.constraint.joint.RotationalLimitMotor}init(t,i,a,s){var o,n,r;this._init(t,i,a);var e,_,h,l=s;o=l.x,n=l.y,r=l.z,e=t._transform._rotation00*o+t._transform._rotation10*n+t._transform._rotation20*r,_=t._transform._rotation01*o+t._transform._rotation11*n+t._transform._rotation21*r,h=t._transform._rotation02*o+t._transform._rotation12*n+t._transform._rotation22*r,o=e,n=_,r=h;var c,m,v,b=this.localAxis1;b.x=o,b.y=n,b.z=r;var x,p,f,u=s;c=u.x,m=u.y,v=u.z,x=i._transform._rotation00*c+i._transform._rotation10*m+i._transform._rotation20*v,p=i._transform._rotation01*c+i._transform._rotation11*m+i._transform._rotation21*v,f=i._transform._rotation02*c+i._transform._rotation12*m+i._transform._rotation22*v,c=x,m=p,v=f;var y=this.localAxis2;return y.x=c,y.y=m,y.z=v,this}},pa.dynamics.constraint.joint.RotationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorTorque=0}setLimits(t,i){return this.lowerLimit=t,this.upperLimit=i,this}setMotor(t,i){return this.motorSpeed=t,this.motorTorque=i,this}clone(){var t=new pa.dynamics.constraint.joint.RotationalLimitMotor;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorTorque=this.motorTorque,t}},pa.dynamics.constraint.joint.SphericalJoint=class extends pa.dynamics.constraint.joint.Joint{constructor(t){super(t,0),this._sd=t.springDamper.clone()}getInfo(t,i,a){if(!(this._sd.frequency>0&&a)){var s,o,n,r,e;if(s=this._anchor2X-this._anchor1X,o=this._anchor2Y-this._anchor1Y,n=this._anchor2Z-this._anchor1Z,this._sd.frequency>0){var _=6.28318530717958*this._sd.frequency,h=this._sd.dampingRatio;h<pa.common.Setting.minSpringDamperDampingRatio&&(h=pa.common.Setting.minSpringDamperDampingRatio);var l=i.dt,c=2*h*_,m=_*_;this._sd.useSymplecticEuler?(r=1/(l*c),e=m/c):(r=1/(l*(l*m+c)),e=m/(l*m+c)),r*=this._b1._invMass+this._b2._invMass}else r=0,e=this.getErp(i,a);var v,b,x,p,f,u,y,d,g,X,z,Y,Z,M,I,V,w,L,k=s*e,B=o*e,A=n*e;v=-(v=0),b=-(b=-this._relativeAnchor1Z),x=-(x=this._relativeAnchor1Y),p=-(p=this._relativeAnchor1Z),f=-(f=0),u=-(u=-this._relativeAnchor1X),y=-(y=-this._relativeAnchor1Y),d=-(d=this._relativeAnchor1X),g=-(g=0),X=-(X=0),z=-(z=-this._relativeAnchor2Z),Y=-(Y=this._relativeAnchor2Y),Z=-(Z=this._relativeAnchor2Z),M=-(M=0),I=-(I=-this._relativeAnchor2X),V=-(V=-this._relativeAnchor2Y),w=-(w=this._relativeAnchor2X),L=-(L=0);var P=this._impulses[0],S=t.rows[t.numRows++],T=S.jacobian;T.lin1X=0,T.lin1Y=0,T.lin1Z=0,T.lin2X=0,T.lin2Y=0,T.lin2Z=0,T.ang1X=0,T.ang1Y=0,T.ang1Z=0,T.ang2X=0,T.ang2Y=0,T.ang2Z=0,S.rhs=0,S.cfm=0,S.minImpulse=0,S.maxImpulse=0,S.motorSpeed=0,S.motorMaxImpulse=0,S.impulse=null,S.impulse=P;var C=S;C.rhs=k,C.cfm=r,C.minImpulse=-1/0,C.maxImpulse=Infinity;var j=C.jacobian;j.lin1X=1,j.lin1Y=0,j.lin1Z=0,j.lin2X=1,j.lin2Y=0,j.lin2Z=0,j.ang1X=v,j.ang1Y=b,j.ang1Z=x,j.ang2X=X,j.ang2Y=z,j.ang2Z=Y;var R=this._impulses[1],E=t.rows[t.numRows++],q=E.jacobian;q.lin1X=0,q.lin1Y=0,q.lin1Z=0,q.lin2X=0,q.lin2Y=0,q.lin2Z=0,q.ang1X=0,q.ang1Y=0,q.ang1Z=0,q.ang2X=0,q.ang2Y=0,q.ang2Z=0,E.rhs=0,E.cfm=0,E.minImpulse=0,E.maxImpulse=0,E.motorSpeed=0,E.motorMaxImpulse=0,E.impulse=null,E.impulse=R,(C=E).rhs=B,C.cfm=r,C.minImpulse=-1/0,C.maxImpulse=Infinity,(j=C.jacobian).lin1X=0,j.lin1Y=1,j.lin1Z=0,j.lin2X=0,j.lin2Y=1,j.lin2Z=0,j.ang1X=p,j.ang1Y=f,j.ang1Z=u,j.ang2X=Z,j.ang2Y=M,j.ang2Z=I;var N=this._impulses[2],F=t.rows[t.numRows++],D=F.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,F.rhs=0,F.cfm=0,F.minImpulse=0,F.maxImpulse=0,F.motorSpeed=0,F.motorMaxImpulse=0,F.impulse=null,F.impulse=N,(C=F).rhs=A,C.cfm=r,C.minImpulse=-1/0,C.maxImpulse=Infinity,(j=C.jacobian).lin1X=0,j.lin1Y=0,j.lin1Z=1,j.lin2X=0,j.lin2Y=0,j.lin2Z=1,j.ang1X=y,j.ang1Y=d,j.ang1Z=g,j.ang2X=V,j.ang2Y=w,j.ang2Z=L}}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getSpringDamper(){return this._sd}},pa.dynamics.constraint.joint.SphericalJointConfig=class extends pa.dynamics.constraint.joint.JointConfig{constructor(){super(),this.springDamper=new pa.dynamics.constraint.joint.SpringDamper}init(t,i,a){return this._init(t,i,a),this}},pa.dynamics.constraint.joint.SpringDamper=class{constructor(){this.frequency=0,this.dampingRatio=0,this.useSymplecticEuler=!1}setSpring(t,i){return this.frequency=t,this.dampingRatio=i,this}setSymplecticEuler(t){return this.useSymplecticEuler=t,this}clone(){var t=new pa.dynamics.constraint.joint.SpringDamper;return t.frequency=this.frequency,t.dampingRatio=this.dampingRatio,t.useSymplecticEuler=this.useSymplecticEuler,t}},pa.dynamics.constraint.joint.TranslationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorForce=0}setLimits(t,i){return this.lowerLimit=t,this.upperLimit=i,this}setMotor(t,i){return this.motorSpeed=t,this.motorForce=i,this}clone(){var t=new pa.dynamics.constraint.joint.TranslationalLimitMotor;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorForce=this.motorForce,t}},pa.dynamics.constraint.joint.UniversalJoint=class extends pa.dynamics.constraint.joint.Joint{constructor(t){super(t,pa.dynamics.constraint.joint.JointType.UNIVERSAL);var i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;var a=t.localAxis2;this._localBasisZ2X=a.x,this._localBasisZ2Y=a.y,this._localBasisZ2Z=a.z,this.buildLocalBasesFromX1Z2(),this._angleX=0,this._angleY=0,this._angleZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._sd1=t.springDamper1.clone(),this._sd2=t.springDamper2.clone(),this._lm1=t.limitMotor1.clone(),this._lm2=t.limitMotor2.clone()}getInfo(t,i,a){var s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y,d,g=this.getErp(i,a),X=this.linearErrorX*g,z=this.linearErrorY*g,Y=this.linearErrorZ*g,Z=this._angleY*g;s=-(s=0),o=-(o=-this._relativeAnchor1Z),n=-(n=this._relativeAnchor1Y),r=-(r=this._relativeAnchor1Z),e=-(e=0),_=-(_=-this._relativeAnchor1X),h=-(h=-this._relativeAnchor1Y),l=-(l=this._relativeAnchor1X),c=-(c=0),m=-(m=0),v=-(v=-this._relativeAnchor2Z),b=-(b=this._relativeAnchor2Y),x=-(x=this._relativeAnchor2Z),p=-(p=0),f=-(f=-this._relativeAnchor2X),u=-(u=-this._relativeAnchor2Y),y=-(y=this._relativeAnchor2X),d=-(d=0);var M=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),I=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ),V=this._impulses[0],w=t.rows[t.numRows++],L=w.jacobian;L.lin1X=0,L.lin1Y=0,L.lin1Z=0,L.lin2X=0,L.lin2Y=0,L.lin2Z=0,L.ang1X=0,L.ang1Y=0,L.ang1Z=0,L.ang2X=0,L.ang2Y=0,L.ang2Z=0,w.rhs=0,w.cfm=0,w.minImpulse=0,w.maxImpulse=0,w.motorSpeed=0,w.motorMaxImpulse=0,w.impulse=null,w.impulse=V;var k=w;k.rhs=X,k.cfm=0,k.minImpulse=-1/0,k.maxImpulse=Infinity;var B=k.jacobian;B.lin1X=1,B.lin1Y=0,B.lin1Z=0,B.lin2X=1,B.lin2Y=0,B.lin2Z=0,B.ang1X=s,B.ang1Y=o,B.ang1Z=n,B.ang2X=m,B.ang2Y=v,B.ang2Z=b;var A=this._impulses[1],P=t.rows[t.numRows++],S=P.jacobian;S.lin1X=0,S.lin1Y=0,S.lin1Z=0,S.lin2X=0,S.lin2Y=0,S.lin2Z=0,S.ang1X=0,S.ang1Y=0,S.ang1Z=0,S.ang2X=0,S.ang2Y=0,S.ang2Z=0,P.rhs=0,P.cfm=0,P.minImpulse=0,P.maxImpulse=0,P.motorSpeed=0,P.motorMaxImpulse=0,P.impulse=null,P.impulse=A,(k=P).rhs=z,k.cfm=0,k.minImpulse=-1/0,k.maxImpulse=Infinity,(B=k.jacobian).lin1X=0,B.lin1Y=1,B.lin1Z=0,B.lin2X=0,B.lin2Y=1,B.lin2Z=0,B.ang1X=r,B.ang1Y=e,B.ang1Z=_,B.ang2X=x,B.ang2Y=p,B.ang2Z=f;var T=this._impulses[2],C=t.rows[t.numRows++],j=C.jacobian;if(j.lin1X=0,j.lin1Y=0,j.lin1Z=0,j.lin2X=0,j.lin2Y=0,j.lin2Z=0,j.ang1X=0,j.ang1Y=0,j.ang1Z=0,j.ang2X=0,j.ang2Y=0,j.ang2Z=0,C.rhs=0,C.cfm=0,C.minImpulse=0,C.maxImpulse=0,C.motorSpeed=0,C.motorMaxImpulse=0,C.impulse=null,C.impulse=T,(k=C).rhs=Y,k.cfm=0,k.minImpulse=-1/0,k.maxImpulse=Infinity,(B=k.jacobian).lin1X=0,B.lin1Y=0,B.lin1Z=1,B.lin2X=0,B.lin2Y=0,B.lin2Z=1,B.ang1X=h,B.ang1Y=l,B.ang1Z=c,B.ang2X=u,B.ang2Y=y,B.ang2Z=d,!this.xSingular&&(this._sd1.frequency<=0||!a)){var R=this._impulses[3],E=t.rows[t.numRows++],q=E.jacobian;q.lin1X=0,q.lin1Y=0,q.lin1Z=0,q.lin2X=0,q.lin2Y=0,q.lin2Z=0,q.ang1X=0,q.ang1Y=0,q.ang1Z=0,q.ang2X=0,q.ang2Y=0,q.ang2Z=0,E.rhs=0,E.cfm=0,E.minImpulse=0,E.maxImpulse=0,E.motorSpeed=0,E.motorMaxImpulse=0,E.impulse=null,E.impulse=R,k=E,this.setSolverInfoRowAngular(k,this._angleX,this._lm1,M,this._sd1,i,a),(B=k.jacobian).ang1X=this._axisXX,B.ang1Y=this._axisXY,B.ang1Z=this._axisXZ,B.ang2X=this._axisXX,B.ang2Y=this._axisXY,B.ang2Z=this._axisXZ}if(!this.ySingular){var N=this._impulses[4],F=t.rows[t.numRows++],D=F.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,F.rhs=0,F.cfm=0,F.minImpulse=0,F.maxImpulse=0,F.motorSpeed=0,F.motorMaxImpulse=0,F.impulse=null,F.impulse=N,(k=F).rhs=Z,k.cfm=0,k.minImpulse=-1/0,k.maxImpulse=Infinity,(B=k.jacobian).ang1X=this._axisYX,B.ang1Y=this._axisYY,B.ang1Z=this._axisYZ,B.ang2X=this._axisYX,B.ang2Y=this._axisYY,B.ang2Z=this._axisYZ}if(!this.zSingular&&(this._sd2.frequency<=0||!a)){var G=this._impulses[5],W=t.rows[t.numRows++],J=W.jacobian;J.lin1X=0,J.lin1Y=0,J.lin1Z=0,J.lin2X=0,J.lin2Y=0,J.lin2Z=0,J.ang1X=0,J.ang1Y=0,J.ang1Z=0,J.ang2X=0,J.ang2Y=0,J.ang2Z=0,W.rhs=0,W.cfm=0,W.minImpulse=0,W.maxImpulse=0,W.motorSpeed=0,W.motorMaxImpulse=0,W.impulse=null,W.impulse=G,k=W,this.setSolverInfoRowAngular(k,this._angleZ,this._lm2,I,this._sd2,i,a),(B=k.jacobian).ang1X=this._axisZX,B.ang1Y=this._axisZY,B.ang1Z=this._axisZZ,B.ang2X=this._axisZX,B.ang2Y=this._axisZY,B.ang2Z=this._axisZZ}}_syncAnchors(){var t,i,a,s,o,n,r,e,_;super._syncAnchors(),this._basisX1X,this._basisY1X,this._basisZ1X,this._basisX1Y,this._basisY1Y,this._basisZ1Y,this._basisX1Z,this._basisY1Z,this._basisZ1Z,this._basisX2X,this._basisY2X,this._basisZ2X,this._basisX2Y,this._basisY2Y,this._basisZ2Y,this._basisX2Z,this._basisY2Z,this._basisZ2Z,t=this._basisX1X,i=this._basisX1Y,a=this._basisX1Z,r=this._basisZ2X,s=(e=this._basisZ2Y)*a-(_=this._basisZ2Z)*i,o=_*t-r*a,n=r*i-e*t,this._axisXX=o*_-n*e,this._axisXY=n*r-s*_,this._axisXZ=s*e-o*r,this._axisYX=s,this._axisYY=o,this._axisYZ=n,this._axisZX=i*n-a*o,this._axisZY=a*s-t*n,this._axisZZ=t*o-i*s;var h=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;h>0&&(h=1/Math.sqrt(h)),this._axisXX*=h,this._axisXY*=h,this._axisXZ*=h;var l=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;l>0&&(l=1/Math.sqrt(l)),this._axisYX*=l,this._axisYY*=l,this._axisYZ*=l;var c,m,v,b,x,p,f,u,y,d,g,X,z,Y,Z,M,I,V,w,L,k,B,A,P,S,T,C=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;C>0&&(C=1/Math.sqrt(C)),this._axisZX*=C,this._axisZY*=C,this._axisZZ*=C,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0,c=this._basisX1X,m=this._basisY1X,v=this._basisZ1X,b=this._basisX1Y,x=this._basisY1Y,p=this._basisZ1Y,f=this._basisX1Z,u=this._basisY1Z,y=this._basisZ1Z,d=this._basisX2X,g=this._basisY2X,X=this._basisZ2X,z=this._basisX2Y,Y=this._basisY2Y,Z=this._basisZ2Y,V=c*d+b*z+f*this._basisX2Z,w=c*g+b*Y+f*(M=this._basisY2Z),L=m*g+x*Y+u*M,k=m*X+x*Z+u*(I=this._basisZ2Z),B=v*g+p*Y+y*M,A=v*X+p*Z+y*I;var j=c*X+b*Z+f*I;if(j<=-1){var R=Math.atan2(B,L);P=.5*R,S=-1.570796326794895,T=.5*-R}else if(j>=1){var E=Math.atan2(B,L);P=.5*E,S=1.570796326794895,T=.5*E}else{var q=Math.asin(j);P=Math.atan2(-k,A),S=q,T=Math.atan2(-w,V)}this._angleX=P,this._angleY=S,this._angleZ=T,this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){var t=new pa.common.Vec3,i=t;return i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z,t}getAxis2(){var t=new pa.common.Vec3,i=t;return i.x=this._basisZ2X,i.y=this._basisZ2Y,i.z=this._basisZ2Z,t}getAxis1To(t){var i=t;i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z}getAxis2To(t){var i=t;i.x=this._basisZ2X,i.y=this._basisZ2Y,i.z=this._basisZ2Z}getLocalAxis1(){var t=new pa.common.Vec3,i=t;return i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z,t}getLocalAxis2(){var t=new pa.common.Vec3,i=t;return i.x=this._localBasisZ2X,i.y=this._localBasisZ2Y,i.z=this._localBasisZ2Z,t}getLocalAxis1To(t){var i=t;i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z}getLocalAxis2To(t){var i=t;i.x=this._localBasisZ2X,i.y=this._localBasisZ2Y,i.z=this._localBasisZ2Z}getSpringDamper1(){return this._sd1}getSpringDamper2(){return this._sd2}getLimitMotor1(){return this._lm1}getLimitMotor2(){return this._lm2}getAngle1(){return this._angleX}getAngle2(){return this._angleZ}},pa.dynamics.constraint.joint.UniversalJointConfig=class extends pa.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new pa.common.Vec3(1,0,0),this.localAxis2=new pa.common.Vec3(1,0,0),this.springDamper1=new pa.dynamics.constraint.joint.SpringDamper,this.springDamper2=new pa.dynamics.constraint.joint.SpringDamper,this.limitMotor1=new pa.dynamics.constraint.joint.RotationalLimitMotor,this.limitMotor2=new pa.dynamics.constraint.joint.RotationalLimitMotor}init(t,i,a,s,o){var n,r,e;this._init(t,i,a);var _,h,l,c=s;n=c.x,r=c.y,e=c.z,_=t._transform._rotation00*n+t._transform._rotation10*r+t._transform._rotation20*e,h=t._transform._rotation01*n+t._transform._rotation11*r+t._transform._rotation21*e,l=t._transform._rotation02*n+t._transform._rotation12*r+t._transform._rotation22*e,n=_,r=h,e=l;var m,v,b,x=this.localAxis1;x.x=n,x.y=r,x.z=e;var p,f,u,y=o;m=y.x,v=y.y,b=y.z,p=i._transform._rotation00*m+i._transform._rotation10*v+i._transform._rotation20*b,f=i._transform._rotation01*m+i._transform._rotation11*v+i._transform._rotation21*b,u=i._transform._rotation02*m+i._transform._rotation12*v+i._transform._rotation22*b,m=p,v=f,b=u;var d=this.localAxis2;return d.x=m,d.y=v,d.z=b,this}},pa.dynamics.constraint.solver||(pa.dynamics.constraint.solver={}),pa.dynamics.constraint.solver.ConstraintSolverType=class{},pa.dynamics.constraint.solver.common||(pa.dynamics.constraint.solver.common={}),pa.dynamics.constraint.solver.common.ContactSolverMassDataRow=class{constructor(){this.invMLinN1X=0,this.invMLinN1Y=0,this.invMLinN1Z=0,this.invMLinN2X=0,this.invMLinN2Y=0,this.invMLinN2Z=0,this.invMAngN1X=0,this.invMAngN1Y=0,this.invMAngN1Z=0,this.invMAngN2X=0,this.invMAngN2Y=0,this.invMAngN2Z=0,this.invMLinT1X=0,this.invMLinT1Y=0,this.invMLinT1Z=0,this.invMLinT2X=0,this.invMLinT2Y=0,this.invMLinT2Z=0,this.invMAngT1X=0,this.invMAngT1Y=0,this.invMAngT1Z=0,this.invMAngT2X=0,this.invMAngT2Y=0,this.invMAngT2Z=0,this.invMLinB1X=0,this.invMLinB1Y=0,this.invMLinB1Z=0,this.invMLinB2X=0,this.invMLinB2Y=0,this.invMLinB2Z=0,this.invMAngB1X=0,this.invMAngB1Y=0,this.invMAngB1Z=0,this.invMAngB2X=0,this.invMAngB2Y=0,this.invMAngB2Z=0,this.massN=0,this.massTB00=0,this.massTB01=0,this.massTB10=0,this.massTB11=0}},pa.dynamics.constraint.solver.common.JointSolverMassDataRow=class{constructor(){this.invMLin1X=0,this.invMLin1Y=0,this.invMLin1Z=0,this.invMLin2X=0,this.invMLin2Y=0,this.invMLin2Z=0,this.invMAng1X=0,this.invMAng1Y=0,this.invMAng1Z=0,this.invMAng2X=0,this.invMAng2Y=0,this.invMAng2Z=0,this.mass=0,this.massWithoutCfm=0}},pa.dynamics.constraint.solver.direct||(pa.dynamics.constraint.solver.direct={}),pa.dynamics.constraint.solver.direct.Boundary=class{constructor(t){var i=new Array(t);this.iBounded=i;var a=new Array(t);this.iUnbounded=a;var s=new Array(t);this.signs=s;var o=new Array(t);this.b=o,this.numBounded=0,this.numUnbounded=0,this.matrixId=0}init(t){this.numBounded=t.numBounded;for(var i=0,a=this.numBounded;i<a;){var s=i++;this.iBounded[s]=t.iBounded[s],this.signs[s]=t.signs[s]}this.numUnbounded=t.numUnbounded,this.matrixId=0;for(var o=0,n=this.numUnbounded;o<n;){var r=o++,e=t.iUnbounded[r];this.iUnbounded[r]=e,this.matrixId|=1<<e}}computeImpulses(t,i,a,s,o,n,r){for(var e=0,_=this.numUnbounded;e<_;){var h=e++,l=this.iUnbounded[h],c=t.rows[l],m=a[l];this.b[l]=c.rhs*n-m-c.cfm*s[l]}for(var v=i._invMassWithoutCfm,b=0,x=this.numBounded;b<x;){var p=b++,f=this.iBounded[p],u=this.signs[p],y=t.rows[f],d=s[f],g=(u<0?y.minImpulse:u>0?y.maxImpulse:0)-d;if(o[f]=g,0!=g)for(var X=0,z=this.numUnbounded;X<z;){var Y=X++,Z=this.iUnbounded[Y],M=v[f][Z]*g,I=Z,V=this.b;V[I]=V[I]-M}}for(var w,L=this.iUnbounded,k=this.numUnbounded,B=0,A=0,P=k;A<P;){B|=1<<L[A++]}i._cacheComputed[B]||(i.computeSubmatrix(B,L,k),i._cacheComputed[B]=!0),w=i._cachedSubmatrices[B];for(var S=!0,T=0,C=this.numUnbounded;T<C;){for(var j=T++,R=this.iUnbounded[j],E=t.rows[R],q=s[R],N=q,F=0,D=this.numUnbounded;F<D;){var G=F++,W=this.iUnbounded[G];N+=this.b[W]*w[j][G]}if(N<E.minImpulse-pa.common.Setting.directMlcpSolverEps||N>E.maxImpulse+pa.common.Setting.directMlcpSolverEps){S=!1;break}o[R]=N-q}if(r)return!0;if(!S)return!1;for(var J=0,U=this.numBounded;J<U;){for(var O,H=J++,Q=this.iBounded[H],K=t.rows[Q],$=this.signs[H],tt=s[Q]+o[Q],it=a[Q],at=0,st=t.numRows;at<st;){var ot=at++;it+=v[Q][ot]*o[ot]}if(O=K.rhs*n-it-K.cfm*tt,$<0&&O>pa.common.Setting.directMlcpSolverEps||$>0&&O<-pa.common.Setting.directMlcpSolverEps){S=!1;break}}return S}},pa.dynamics.constraint.solver.direct.BoundaryBuildInfo=class{constructor(t){this.size=t,this.numBounded=0;var i=new Array(t);this.iBounded=i;var a=new Array(t);this.signs=a,this.numUnbounded=0;var s=new Array(t);this.iUnbounded=s}},pa.dynamics.constraint.solver.direct.BoundaryBuilder=class{constructor(t){this.maxRows=t,this.numBoundaries=0;var i=new Array(1<<t);this.boundaries=i,this.bbInfo=new pa.dynamics.constraint.solver.direct.BoundaryBuildInfo(t)}buildBoundariesRecursive(t,i){if(i==t.numRows)return null==this.boundaries[this.numBoundaries]&&(this.boundaries[this.numBoundaries]=new pa.dynamics.constraint.solver.direct.Boundary(this.maxRows)),void this.boundaries[this.numBoundaries++].init(this.bbInfo);var a=t.rows[i],s=a.minImpulse>-1/0,o=a.maxImpulse<Infinity;if(0==a.minImpulse&&0==a.maxImpulse){var n=this.bbInfo;return n.iBounded[n.numBounded]=i,n.signs[n.numBounded]=0,n.numBounded++,this.buildBoundariesRecursive(t,i+1),void this.bbInfo.numBounded--}var r=this.bbInfo;if(r.iUnbounded[r.numUnbounded]=i,r.numUnbounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numUnbounded--,s){var e=this.bbInfo;e.iBounded[e.numBounded]=i,e.signs[e.numBounded]=-1,e.numBounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numBounded--}if(o){var _=this.bbInfo;_.iBounded[_.numBounded]=i,_.signs[_.numBounded]=1,_.numBounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numBounded--}}buildBoundaries(t){this.numBoundaries=0;var i=this.bbInfo;i.numBounded=0,i.numUnbounded=0,this.buildBoundariesRecursive(t,0)}},pa.dynamics.constraint.solver.direct.BoundarySelector=class{constructor(t){this.n=t;var i=new Array(t);this.indices=i;var a=new Array(t);this.tmpIndices=a;for(var s=0,o=t;s<o;){var n=s++;this.indices[n]=n}}getIndex(t){return this.indices[t]}select(t){for(var i=0;this.indices[i]!=t;)++i;for(;i>0;){var a=this.indices[i];this.indices[i]=this.indices[i-1],this.indices[i-1]=a,--i}}setSize(t){for(var i=0,a=0,s=0,o=this.n;s<o;){var n=s++,r=this.indices[n];r<t?(this.tmpIndices[i]=r,++i):(this.tmpIndices[t+a]=r,++a)}var e=this.indices;this.indices=this.tmpIndices,this.tmpIndices=e}},pa.dynamics.constraint.solver.direct.DirectJointConstraintSolver=class extends pa.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.joint=t,this.info=new pa.dynamics.constraint.info.joint.JointSolverInfo;var i=pa.common.Setting.maxJacobianRows;this.massMatrix=new pa.dynamics.constraint.solver.direct.MassMatrix(i),this.boundaryBuilder=new pa.dynamics.constraint.solver.direct.BoundaryBuilder(i);var a=new Array(i);this.massData=a;for(var s=0,o=this.massData.length;s<o;){var n=s++;this.massData[n]=new pa.dynamics.constraint.solver.common.JointSolverMassDataRow}var r=this.boundaryBuilder.boundaries.length;this.velBoundarySelector=new pa.dynamics.constraint.solver.direct.BoundarySelector(r),this.posBoundarySelector=new pa.dynamics.constraint.solver.direct.BoundarySelector(r);var e=new Array(i);this.relVels=e;var _=new Array(i);this.impulses=_;var h=new Array(i);this.dImpulses=h;var l=new Array(i);this.dTotalImpulses=l;for(var c=0,m=i;c<m;){var v=c++;this.relVels[v]=0,this.impulses[v]=0,this.dImpulses[v]=0,this.dTotalImpulses[v]=0}}preSolveVelocity(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var i=this.boundaryBuilder;i.numBoundaries=0;var a=i.bbInfo;a.numBounded=0,a.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);for(var s=this.velBoundarySelector,o=this.boundaryBuilder.numBoundaries,n=0,r=0,e=0,_=s.n;e<_;){var h=e++,l=s.indices[h];l<o?(s.tmpIndices[n]=l,++n):(s.tmpIndices[o+r]=l,++r)}var c=s.indices;s.indices=s.tmpIndices,s.tmpIndices=c}warmStart(t){var i=this.joint._positionCorrectionAlgorithm==pa.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?pa.common.Setting.jointWarmStartingFactorForBaungarte:pa.common.Setting.jointWarmStartingFactor;if((i*=t.dtRatio)<=0)for(var a=0,s=this.info.numRows;a<s;){var o=a++,n=this.info.rows[o].impulse;n.impulse=0,n.impulseM=0,n.impulseP=0}else{for(var r=0,e=this.info.numRows;r<e;){var _=r++,h=this.info.rows[_],l=h.impulse,c=l.impulse*i;if(c<h.minImpulse?c=h.minImpulse:c>h.maxImpulse&&(c=h.maxImpulse),l.impulse=c,h.motorMaxImpulse>0){var m=l.impulseM*i,v=h.motorMaxImpulse;m<-v?m=-v:m>v&&(m=v),l.impulseM=m}else l.impulseM=0;this.dImpulses[_]=l.impulse+l.impulseM}var b,x,p,f,u,y,d,g,X,z,Y,Z,M=this.dImpulses,I=!1,V=!1;b=this._b1._velX,x=this._b1._velY,p=this._b1._velZ,f=this._b2._velX,u=this._b2._velY,y=this._b2._velZ,d=this._b1._angVelX,g=this._b1._angVelY,X=this._b1._angVelZ,z=this._b2._angVelX,Y=this._b2._angVelY,Z=this._b2._angVelZ;for(var w=0,L=this.info.numRows;w<L;){var k=w++,B=this.info.rows[k].jacobian,A=this.massData[k],P=M[k];1&B.flag&&(b+=A.invMLin1X*P,x+=A.invMLin1Y*P,p+=A.invMLin1Z*P,f+=A.invMLin2X*-P,u+=A.invMLin2Y*-P,y+=A.invMLin2Z*-P,I=!0),2&B.flag&&(d+=A.invMAng1X*P,g+=A.invMAng1Y*P,X+=A.invMAng1Z*P,z+=A.invMAng2X*-P,Y+=A.invMAng2Y*-P,Z+=A.invMAng2Z*-P,V=!0)}I&&(this._b1._velX=b,this._b1._velY=x,this._b1._velZ=p,this._b2._velX=f,this._b2._velY=u,this._b2._velZ=y),V&&(this._b1._angVelX=d,this._b1._angVelY=g,this._b1._angVelZ=X,this._b2._angVelX=z,this._b2._angVelY=Y,this._b2._angVelZ=Z)}}solveVelocity(){var t,i,a,s,o,n,r,e,_,h,l,c,m=this.info.numRows;t=this._b1._velX,i=this._b1._velY,a=this._b1._velZ,s=this._b2._velX,o=this._b2._velY,n=this._b2._velZ,r=this._b1._angVelX,e=this._b1._angVelY,_=this._b1._angVelZ,h=this._b2._angVelX,l=this._b2._angVelY,c=this._b2._angVelZ;for(var v=0,b=m;v<b;){var x=v++,p=this.info.rows[x],f=p.impulse,u=p.jacobian,y=0;y+=t*u.lin1X+i*u.lin1Y+a*u.lin1Z,y-=s*u.lin2X+o*u.lin2Y+n*u.lin2Z,y+=r*u.ang1X+e*u.ang1Y+_*u.ang1Z,y-=h*u.ang2X+l*u.ang2Y+c*u.ang2Z,this.relVels[x]=y,this.impulses[x]=f.impulse,this.dTotalImpulses[x]=0}for(var d=this.massMatrix._invMassWithoutCfm,g=0,X=m;g<X;){var z=g++,Y=this.info.rows[z],Z=Y.impulse,M=this.massData[z];if(Y.motorMaxImpulse>0){var I=Z.impulseM,V=I+M.massWithoutCfm*(-Y.motorSpeed-this.relVels[z]),w=Y.motorMaxImpulse;V<-w?V=-w:V>w&&(V=w),Z.impulseM=V;var L=V-I;this.dTotalImpulses[z]=L;for(var k=0,B=m;k<B;){var A=k++,P=A,S=this.relVels;S[P]=S[P]+L*d[z][A]}}}for(var T=!1,C=0,j=this.boundaryBuilder.numBoundaries;C<j;){var R=C++,E=this.velBoundarySelector.indices[R];if(this.boundaryBuilder.boundaries[E].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,1,!1)){for(var q=0,N=m;q<N;){var F=q++,D=this.info.rows[F].impulse,G=this.dImpulses[F];D.impulse+=G;var W=F,J=this.dTotalImpulses;J[W]=J[W]+G}var U,O,H,Q,K,$,tt,it,at,st,ot,nt,rt=this.dTotalImpulses,et=!1,_t=!1;U=this._b1._velX,O=this._b1._velY,H=this._b1._velZ,Q=this._b2._velX,K=this._b2._velY,$=this._b2._velZ,tt=this._b1._angVelX,it=this._b1._angVelY,at=this._b1._angVelZ,st=this._b2._angVelX,ot=this._b2._angVelY,nt=this._b2._angVelZ;for(var ht=0,lt=this.info.numRows;ht<lt;){var ct=ht++,mt=this.info.rows[ct].jacobian,vt=this.massData[ct],bt=rt[ct];1&mt.flag&&(U+=vt.invMLin1X*bt,O+=vt.invMLin1Y*bt,H+=vt.invMLin1Z*bt,Q+=vt.invMLin2X*-bt,K+=vt.invMLin2Y*-bt,$+=vt.invMLin2Z*-bt,et=!0),2&mt.flag&&(tt+=vt.invMAng1X*bt,it+=vt.invMAng1Y*bt,at+=vt.invMAng1Z*bt,st+=vt.invMAng2X*-bt,ot+=vt.invMAng2Y*-bt,nt+=vt.invMAng2Z*-bt,_t=!0)}et&&(this._b1._velX=U,this._b1._velY=O,this._b1._velZ=H,this._b2._velX=Q,this._b2._velY=K,this._b2._velZ=$),_t&&(this._b1._angVelX=tt,this._b1._angVelY=it,this._b1._angVelZ=at,this._b2._angVelX=st,this._b2._angVelY=ot,this._b2._angVelZ=nt);for(var xt=this.velBoundarySelector,pt=0;xt.indices[pt]!=E;)++pt;for(;pt>0;){var ft=xt.indices[pt];xt.indices[pt]=xt.indices[pt-1],xt.indices[pt-1]=ft,--pt}T=!0;break}}T||console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:335:","could not find solution. (velocity)")}postSolveVelocity(t){var i,a,s,o,n,r;i=0,a=0,s=0,o=0,n=0,r=0;for(var e=0,_=this.info.numRows;e<_;){var h=e++,l=this.info.rows[h],c=l.impulse,m=l.jacobian;1&m.flag?(i+=m.lin1X*c.impulse,a+=m.lin1Y*c.impulse,s+=m.lin1Z*c.impulse):2&m.flag&&(o+=m.ang1X*c.impulse,n+=m.ang1Y*c.impulse,r+=m.ang1Z*c.impulse)}this.joint._appliedForceX=i*t.invDt,this.joint._appliedForceY=a*t.invDt,this.joint._appliedForceZ=s*t.invDt,this.joint._appliedTorqueX=o*t.invDt,this.joint._appliedTorqueY=n*t.invDt,this.joint._appliedTorqueZ=r*t.invDt}preSolvePosition(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var i=this.boundaryBuilder;i.numBoundaries=0;var a=i.bbInfo;a.numBounded=0,a.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);for(var s=this.posBoundarySelector,o=this.boundaryBuilder.numBoundaries,n=0,r=0,e=0,_=s.n;e<_;){var h=e++,l=s.indices[h];l<o?(s.tmpIndices[n]=l,++n):(s.tmpIndices[o+r]=l,++r)}var c=s.indices;s.indices=s.tmpIndices,s.tmpIndices=c;for(var m=0,v=this.info.numRows;m<v;){var b=m++;this.info.rows[b].impulse.impulseP=0}}solvePositionSplitImpulse(){var t,i,a,s,o,n,r,e,_,h,l,c,m=this.info.numRows;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,a=this._b1._pseudoVelZ,s=this._b2._pseudoVelX,o=this._b2._pseudoVelY,n=this._b2._pseudoVelZ,r=this._b1._angPseudoVelX,e=this._b1._angPseudoVelY,_=this._b1._angPseudoVelZ,h=this._b2._angPseudoVelX,l=this._b2._angPseudoVelY,c=this._b2._angPseudoVelZ;for(var v=0,b=m;v<b;){var x=v++,p=this.info.rows[x],f=p.impulse,u=p.jacobian,y=0;y+=t*u.lin1X+i*u.lin1Y+a*u.lin1Z,y-=s*u.lin2X+o*u.lin2Y+n*u.lin2Z,y+=r*u.ang1X+e*u.ang1Y+_*u.ang1Z,y-=h*u.ang2X+l*u.ang2Y+c*u.ang2Z,this.relVels[x]=y,this.impulses[x]=f.impulseP}for(var d=!1,g=0,X=this.boundaryBuilder.numBoundaries;g<X;){var z=g++,Y=this.posBoundarySelector.indices[z];if(this.boundaryBuilder.boundaries[Y].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,pa.common.Setting.positionSplitImpulseBaumgarte,!1)){for(var Z=0,M=m;Z<M;){var I=Z++,V=this.info.rows[I].impulse,w=this.dImpulses[I];V.impulseP+=w}var L,k,B,A,P,S,T,C,j,R,E,q,N=this.dImpulses,F=!1,D=!1;L=this._b1._pseudoVelX,k=this._b1._pseudoVelY,B=this._b1._pseudoVelZ,A=this._b2._pseudoVelX,P=this._b2._pseudoVelY,S=this._b2._pseudoVelZ,T=this._b1._angPseudoVelX,C=this._b1._angPseudoVelY,j=this._b1._angPseudoVelZ,R=this._b2._angPseudoVelX,E=this._b2._angPseudoVelY,q=this._b2._angPseudoVelZ;for(var G=0,W=this.info.numRows;G<W;){var J=G++,U=this.info.rows[J].jacobian,O=this.massData[J],H=N[J];1&U.flag&&(L+=O.invMLin1X*H,k+=O.invMLin1Y*H,B+=O.invMLin1Z*H,A+=O.invMLin2X*-H,P+=O.invMLin2Y*-H,S+=O.invMLin2Z*-H,F=!0),2&U.flag&&(T+=O.invMAng1X*H,C+=O.invMAng1Y*H,j+=O.invMAng1Z*H,R+=O.invMAng2X*-H,E+=O.invMAng2Y*-H,q+=O.invMAng2Z*-H,D=!0)}F&&(this._b1._pseudoVelX=L,this._b1._pseudoVelY=k,this._b1._pseudoVelZ=B,this._b2._pseudoVelX=A,this._b2._pseudoVelY=P,this._b2._pseudoVelZ=S),D&&(this._b1._angPseudoVelX=T,this._b1._angPseudoVelY=C,this._b1._angPseudoVelZ=j,this._b2._angPseudoVelX=R,this._b2._angPseudoVelY=E,this._b2._angPseudoVelZ=q);for(var Q=this.posBoundarySelector,K=0;Q.indices[K]!=Y;)++K;for(;K>0;){var $=Q.indices[K];Q.indices[K]=Q.indices[K-1],Q.indices[K-1]=$,--K}d=!0;break}}d||console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:450:","could not find solution. (split impulse)")}solvePositionNgs(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var i=this.boundaryBuilder;i.numBoundaries=0;var a=i.bbInfo;a.numBounded=0,a.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);for(var s=this.posBoundarySelector,o=this.boundaryBuilder.numBoundaries,n=0,r=0,e=0,_=s.n;e<_;){var h=e++,l=s.indices[h];l<o?(s.tmpIndices[n]=l,++n):(s.tmpIndices[o+r]=l,++r)}var c=s.indices;s.indices=s.tmpIndices,s.tmpIndices=c;for(var m=this.info.numRows,v=0,b=m;v<b;){var x=v++,p=this.info.rows[x],f=p.impulse;p.jacobian,this.relVels[x]=0,this.impulses[x]=f.impulseP}for(var u=!1,y=0,d=this.boundaryBuilder.numBoundaries;y<d;){var g=y++,X=this.posBoundarySelector.indices[g];if(this.boundaryBuilder.boundaries[X].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,pa.common.Setting.positionNgsBaumgarte,!1)){for(var z=0,Y=m;z<Y;){var Z=z++,M=this.info.rows[Z].impulse,I=this.dImpulses[Z];M.impulseP+=I}var V,w,L,k,B,A,P,S,T,C,j,R,E=this.dImpulses,q=!1,N=!1;V=0,w=0,L=0,k=0,B=0,A=0,P=0,S=0,T=0,C=0,j=0,R=0;for(var F=0,D=this.info.numRows;F<D;){var G=F++,W=this.info.rows[G].jacobian,J=this.massData[G],U=E[G];1&W.flag&&(V+=J.invMLin1X*U,w+=J.invMLin1Y*U,L+=J.invMLin1Z*U,k+=J.invMLin2X*-U,B+=J.invMLin2Y*-U,A+=J.invMLin2Z*-U,q=!0),2&W.flag&&(P+=J.invMAng1X*U,S+=J.invMAng1Y*U,T+=J.invMAng1Z*U,C+=J.invMAng2X*-U,j+=J.invMAng2Y*-U,R+=J.invMAng2Z*-U,N=!0)}if(q){var O=this._b1;O._transform._positionX+=V,O._transform._positionY+=w,O._transform._positionZ+=L;var H=this._b2;H._transform._positionX+=k,H._transform._positionY+=B,H._transform._positionZ+=A}if(N){var Q,K,$,tt,it,at,st,ot,nt,rt,et=this._b1,_t=Math.sqrt(P*P+S*S+T*T),ht=.5*_t;if(ht<.5){var lt=ht*ht;Q=.5*(1-.16666666666666666*lt+lt*lt*.008333333333333333),K=1-.5*lt+lt*lt*.041666666666666664}else Q=Math.sin(ht)/_t,K=Math.cos(ht);$=P*Q,tt=S*Q,it=T*Q,at=K;var ct,mt=et._transform._rotation00,vt=et._transform._rotation11,bt=et._transform._rotation22,xt=mt+vt+bt;xt>0?(rt=.5*(ct=Math.sqrt(xt+1)),ct=.5/ct,st=(et._transform._rotation21-et._transform._rotation12)*ct,ot=(et._transform._rotation02-et._transform._rotation20)*ct,nt=(et._transform._rotation10-et._transform._rotation01)*ct):mt>vt?mt>bt?(st=.5*(ct=Math.sqrt(mt-vt-bt+1)),ct=.5/ct,ot=(et._transform._rotation01+et._transform._rotation10)*ct,nt=(et._transform._rotation02+et._transform._rotation20)*ct,rt=(et._transform._rotation21-et._transform._rotation12)*ct):(nt=.5*(ct=Math.sqrt(bt-mt-vt+1)),ct=.5/ct,st=(et._transform._rotation02+et._transform._rotation20)*ct,ot=(et._transform._rotation12+et._transform._rotation21)*ct,rt=(et._transform._rotation10-et._transform._rotation01)*ct):vt>bt?(ot=.5*(ct=Math.sqrt(vt-bt-mt+1)),ct=.5/ct,st=(et._transform._rotation01+et._transform._rotation10)*ct,nt=(et._transform._rotation12+et._transform._rotation21)*ct,rt=(et._transform._rotation02-et._transform._rotation20)*ct):(nt=.5*(ct=Math.sqrt(bt-mt-vt+1)),ct=.5/ct,st=(et._transform._rotation02+et._transform._rotation20)*ct,ot=(et._transform._rotation12+et._transform._rotation21)*ct,rt=(et._transform._rotation10-et._transform._rotation01)*ct);var pt=(st=at*st+$*rt+tt*nt-it*ot)*st+(ot=at*ot-$*nt+tt*rt+it*st)*ot+(nt=at*nt+$*ot-tt*st+it*rt)*nt+(rt=at*rt-$*st-tt*ot-it*nt)*rt;pt>1e-32&&(pt=1/Math.sqrt(pt));st*=pt,ot*=pt,nt*=pt,rt*=pt;var ft,ut,yt,dt,gt,Xt,zt,Yt,Zt,Mt,It,Vt,wt,Lt,kt,Bt,At,Pt,St=2*st,Tt=2*ot,Ct=2*nt,jt=st*St,Rt=ot*Tt,Et=nt*Ct,qt=st*Tt,Nt=ot*Ct,Ft=st*Ct,Dt=rt*St,Gt=rt*Tt,Wt=rt*Ct;et._transform._rotation00=1-Rt-Et,et._transform._rotation01=qt-Wt,et._transform._rotation02=Ft+Gt,et._transform._rotation10=qt+Wt,et._transform._rotation11=1-jt-Et,et._transform._rotation12=Nt-Dt,et._transform._rotation20=Ft-Gt,et._transform._rotation21=Nt+Dt,et._transform._rotation22=1-jt-Rt,ft=et._transform._rotation00*et._invLocalInertia00+et._transform._rotation01*et._invLocalInertia10+et._transform._rotation02*et._invLocalInertia20,ut=et._transform._rotation00*et._invLocalInertia01+et._transform._rotation01*et._invLocalInertia11+et._transform._rotation02*et._invLocalInertia21,yt=et._transform._rotation00*et._invLocalInertia02+et._transform._rotation01*et._invLocalInertia12+et._transform._rotation02*et._invLocalInertia22,dt=et._transform._rotation10*et._invLocalInertia00+et._transform._rotation11*et._invLocalInertia10+et._transform._rotation12*et._invLocalInertia20,gt=et._transform._rotation10*et._invLocalInertia01+et._transform._rotation11*et._invLocalInertia11+et._transform._rotation12*et._invLocalInertia21,Xt=et._transform._rotation10*et._invLocalInertia02+et._transform._rotation11*et._invLocalInertia12+et._transform._rotation12*et._invLocalInertia22,zt=et._transform._rotation20*et._invLocalInertia00+et._transform._rotation21*et._invLocalInertia10+et._transform._rotation22*et._invLocalInertia20,Yt=et._transform._rotation20*et._invLocalInertia01+et._transform._rotation21*et._invLocalInertia11+et._transform._rotation22*et._invLocalInertia21,Zt=et._transform._rotation20*et._invLocalInertia02+et._transform._rotation21*et._invLocalInertia12+et._transform._rotation22*et._invLocalInertia22,et._invInertia00=ft,et._invInertia01=ut,et._invInertia02=yt,et._invInertia10=dt,et._invInertia11=gt,et._invInertia12=Xt,et._invInertia20=zt,et._invInertia21=Yt,et._invInertia22=Zt,Mt=et._invInertia00*et._transform._rotation00+et._invInertia01*et._transform._rotation01+et._invInertia02*et._transform._rotation02,It=et._invInertia00*et._transform._rotation10+et._invInertia01*et._transform._rotation11+et._invInertia02*et._transform._rotation12,Vt=et._invInertia00*et._transform._rotation20+et._invInertia01*et._transform._rotation21+et._invInertia02*et._transform._rotation22,wt=et._invInertia10*et._transform._rotation00+et._invInertia11*et._transform._rotation01+et._invInertia12*et._transform._rotation02,Lt=et._invInertia10*et._transform._rotation10+et._invInertia11*et._transform._rotation11+et._invInertia12*et._transform._rotation12,kt=et._invInertia10*et._transform._rotation20+et._invInertia11*et._transform._rotation21+et._invInertia12*et._transform._rotation22,Bt=et._invInertia20*et._transform._rotation00+et._invInertia21*et._transform._rotation01+et._invInertia22*et._transform._rotation02,At=et._invInertia20*et._transform._rotation10+et._invInertia21*et._transform._rotation11+et._invInertia22*et._transform._rotation12,Pt=et._invInertia20*et._transform._rotation20+et._invInertia21*et._transform._rotation21+et._invInertia22*et._transform._rotation22,et._invInertia00=Mt,et._invInertia01=It,et._invInertia02=Vt,et._invInertia10=wt,et._invInertia11=Lt,et._invInertia12=kt,et._invInertia20=Bt,et._invInertia21=At,et._invInertia22=Pt,et._invInertia00*=et._rotFactor.x,et._invInertia01*=et._rotFactor.x,et._invInertia02*=et._rotFactor.x,et._invInertia10*=et._rotFactor.y,et._invInertia11*=et._rotFactor.y,et._invInertia12*=et._rotFactor.y,et._invInertia20*=et._rotFactor.z,et._invInertia21*=et._rotFactor.z,et._invInertia22*=et._rotFactor.z;var Jt,Ut,Ot,Ht,Qt,Kt,$t,ti,ii,ai,si=this._b2,oi=Math.sqrt(C*C+j*j+R*R),ni=.5*oi;if(ni<.5){var ri=ni*ni;Jt=.5*(1-.16666666666666666*ri+ri*ri*.008333333333333333),Ut=1-.5*ri+ri*ri*.041666666666666664}else Jt=Math.sin(ni)/oi,Ut=Math.cos(ni);Ot=C*Jt,Ht=j*Jt,Qt=R*Jt,Kt=Ut;var ei,_i=si._transform._rotation00,hi=si._transform._rotation11,li=si._transform._rotation22,ci=_i+hi+li;ci>0?(ai=.5*(ei=Math.sqrt(ci+1)),ei=.5/ei,$t=(si._transform._rotation21-si._transform._rotation12)*ei,ti=(si._transform._rotation02-si._transform._rotation20)*ei,ii=(si._transform._rotation10-si._transform._rotation01)*ei):_i>hi?_i>li?($t=.5*(ei=Math.sqrt(_i-hi-li+1)),ei=.5/ei,ti=(si._transform._rotation01+si._transform._rotation10)*ei,ii=(si._transform._rotation02+si._transform._rotation20)*ei,ai=(si._transform._rotation21-si._transform._rotation12)*ei):(ii=.5*(ei=Math.sqrt(li-_i-hi+1)),ei=.5/ei,$t=(si._transform._rotation02+si._transform._rotation20)*ei,ti=(si._transform._rotation12+si._transform._rotation21)*ei,ai=(si._transform._rotation10-si._transform._rotation01)*ei):hi>li?(ti=.5*(ei=Math.sqrt(hi-li-_i+1)),ei=.5/ei,$t=(si._transform._rotation01+si._transform._rotation10)*ei,ii=(si._transform._rotation12+si._transform._rotation21)*ei,ai=(si._transform._rotation02-si._transform._rotation20)*ei):(ii=.5*(ei=Math.sqrt(li-_i-hi+1)),ei=.5/ei,$t=(si._transform._rotation02+si._transform._rotation20)*ei,ti=(si._transform._rotation12+si._transform._rotation21)*ei,ai=(si._transform._rotation10-si._transform._rotation01)*ei);var mi=($t=Kt*$t+Ot*ai+Ht*ii-Qt*ti)*$t+(ti=Kt*ti-Ot*ii+Ht*ai+Qt*$t)*ti+(ii=Kt*ii+Ot*ti-Ht*$t+Qt*ai)*ii+(ai=Kt*ai-Ot*$t-Ht*ti-Qt*ii)*ai;mi>1e-32&&(mi=1/Math.sqrt(mi));$t*=mi,ti*=mi,ii*=mi,ai*=mi;var vi,bi,xi,pi,fi,ui,yi,di,gi,Xi,zi,Yi,Zi,Mi,Ii,Vi,wi,Li,ki=2*$t,Bi=2*ti,Ai=2*ii,Pi=$t*ki,Si=ti*Bi,Ti=ii*Ai,Ci=$t*Bi,ji=ti*Ai,Ri=$t*Ai,Ei=ai*ki,qi=ai*Bi,Ni=ai*Ai;si._transform._rotation00=1-Si-Ti,si._transform._rotation01=Ci-Ni,si._transform._rotation02=Ri+qi,si._transform._rotation10=Ci+Ni,si._transform._rotation11=1-Pi-Ti,si._transform._rotation12=ji-Ei,si._transform._rotation20=Ri-qi,si._transform._rotation21=ji+Ei,si._transform._rotation22=1-Pi-Si,vi=si._transform._rotation00*si._invLocalInertia00+si._transform._rotation01*si._invLocalInertia10+si._transform._rotation02*si._invLocalInertia20,bi=si._transform._rotation00*si._invLocalInertia01+si._transform._rotation01*si._invLocalInertia11+si._transform._rotation02*si._invLocalInertia21,xi=si._transform._rotation00*si._invLocalInertia02+si._transform._rotation01*si._invLocalInertia12+si._transform._rotation02*si._invLocalInertia22,pi=si._transform._rotation10*si._invLocalInertia00+si._transform._rotation11*si._invLocalInertia10+si._transform._rotation12*si._invLocalInertia20,fi=si._transform._rotation10*si._invLocalInertia01+si._transform._rotation11*si._invLocalInertia11+si._transform._rotation12*si._invLocalInertia21,ui=si._transform._rotation10*si._invLocalInertia02+si._transform._rotation11*si._invLocalInertia12+si._transform._rotation12*si._invLocalInertia22,yi=si._transform._rotation20*si._invLocalInertia00+si._transform._rotation21*si._invLocalInertia10+si._transform._rotation22*si._invLocalInertia20,di=si._transform._rotation20*si._invLocalInertia01+si._transform._rotation21*si._invLocalInertia11+si._transform._rotation22*si._invLocalInertia21,gi=si._transform._rotation20*si._invLocalInertia02+si._transform._rotation21*si._invLocalInertia12+si._transform._rotation22*si._invLocalInertia22,si._invInertia00=vi,si._invInertia01=bi,si._invInertia02=xi,si._invInertia10=pi,si._invInertia11=fi,si._invInertia12=ui,si._invInertia20=yi,si._invInertia21=di,si._invInertia22=gi,Xi=si._invInertia00*si._transform._rotation00+si._invInertia01*si._transform._rotation01+si._invInertia02*si._transform._rotation02,zi=si._invInertia00*si._transform._rotation10+si._invInertia01*si._transform._rotation11+si._invInertia02*si._transform._rotation12,Yi=si._invInertia00*si._transform._rotation20+si._invInertia01*si._transform._rotation21+si._invInertia02*si._transform._rotation22,Zi=si._invInertia10*si._transform._rotation00+si._invInertia11*si._transform._rotation01+si._invInertia12*si._transform._rotation02,Mi=si._invInertia10*si._transform._rotation10+si._invInertia11*si._transform._rotation11+si._invInertia12*si._transform._rotation12,Ii=si._invInertia10*si._transform._rotation20+si._invInertia11*si._transform._rotation21+si._invInertia12*si._transform._rotation22,Vi=si._invInertia20*si._transform._rotation00+si._invInertia21*si._transform._rotation01+si._invInertia22*si._transform._rotation02,wi=si._invInertia20*si._transform._rotation10+si._invInertia21*si._transform._rotation11+si._invInertia22*si._transform._rotation12,Li=si._invInertia20*si._transform._rotation20+si._invInertia21*si._transform._rotation21+si._invInertia22*si._transform._rotation22,si._invInertia00=Xi,si._invInertia01=zi,si._invInertia02=Yi,si._invInertia10=Zi,si._invInertia11=Mi,si._invInertia12=Ii,si._invInertia20=Vi,si._invInertia21=wi,si._invInertia22=Li,si._invInertia00*=si._rotFactor.x,si._invInertia01*=si._rotFactor.x,si._invInertia02*=si._rotFactor.x,si._invInertia10*=si._rotFactor.y,si._invInertia11*=si._rotFactor.y,si._invInertia12*=si._rotFactor.y,si._invInertia20*=si._rotFactor.z,si._invInertia21*=si._rotFactor.z,si._invInertia22*=si._rotFactor.z}for(var Fi=this.posBoundarySelector,Di=0;Fi.indices[Di]!=X;)++Di;for(;Di>0;){var Gi=Fi.indices[Di];Fi.indices[Di]=Fi.indices[Di-1],Fi.indices[Di-1]=Gi,--Di}u=!0;break}}u||console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:502:","could not find solution. (NGS)")}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}},pa.dynamics.constraint.solver.direct.MassMatrix=class{constructor(t){this._size=t;var i=new Array(this._size);this.tmpMatrix=i;var a=new Array(this._size);this._invMass=a;var s=new Array(this._size);this._invMassWithoutCfm=s;for(var o=0,n=this._size;o<n;){var r=o++,e=this.tmpMatrix,_=new Array(this._size);e[r]=_;var h=this._invMass,l=new Array(this._size);h[r]=l;var c=this._invMassWithoutCfm,m=new Array(this._size);c[r]=m;for(var v=0,b=this._size;v<b;){var x=v++;this.tmpMatrix[r][x]=0,this._invMass[r][x]=0,this._invMassWithoutCfm[r][x]=0}}this._maxSubmatrixId=1<<this._size;var p=new Array(this._maxSubmatrixId);this._cacheComputed=p;var f=new Array(this._maxSubmatrixId);this._cachedSubmatrices=f;for(var u=0,y=this._maxSubmatrixId;u<y;){for(var d=u++,g=d,X=g=(15&(g=(51&(g=(85&g)+(g>>1&85)))+(g>>2&51)))+(g>>4&15),z=new Array(X),Y=0,Z=X;Y<Z;){var M=Y++,I=new Array(X);z[M]=I;for(var V=0,w=X;V<w;){var L=V++;z[M][L]=0}}this._cacheComputed[d]=!1,this._cachedSubmatrices[d]=z}}computeSubmatrix(t,i,a){for(var s=0,o=a;s<o;)for(var n=s++,r=i[n],e=0,_=a;e<_;){var h=e++;this.tmpMatrix[n][h]=this._invMass[r][i[h]]}var l,c,m,v,b,x=this.tmpMatrix,p=this._cachedSubmatrices[t];switch(a){case 4:l=x[0],c=p[0],b=1/l[0],c[0]=b,l[1]=l[1]*b,l[2]=l[2]*b,l[3]=l[3]*b,m=x[1],(v=p[1])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],m=x[2],(v=p[2])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],m=x[3],(v=p[3])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],l=x[1],c=p[1],b=1/l[1],c[1]=b,c[0]=c[0]*b,l[2]=l[2]*b,l[3]=l[3]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],m=x[2],(v=p[2])[0]=v[0]-c[0]*m[1],v[1]=-b*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],m=x[3],(v=p[3])[0]=v[0]-c[0]*m[1],v[1]=-b*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],l=x[2],c=p[2],b=1/l[2],c[2]=b,c[0]=c[0]*b,c[1]=c[1]*b,l[3]=l[3]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[2],m[3]=m[3]-l[3]*m[2],m=x[1],(v=p[1])[0]=v[0]-c[0]*m[2],v[1]=v[1]-c[1]*m[2],m[3]=m[3]-l[3]*m[2],m=x[3],(v=p[3])[0]=v[0]-c[0]*m[2],v[1]=v[1]-c[1]*m[2],v[2]=-b*m[2],m[3]=m[3]-l[3]*m[2],l=x[3],c=p[3],b=1/l[3],c[3]=b,c[0]=c[0]*b,c[1]=c[1]*b,c[2]=c[2]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[3],m=x[1],(v=p[1])[0]=v[0]-c[0]*m[3],v[1]=v[1]-c[1]*m[3],m=x[2],(v=p[2])[0]=v[0]-c[0]*m[3],v[1]=v[1]-c[1]*m[3],v[2]=v[2]-c[2]*m[3],c=p[1],p[0][1]=c[0],c=p[2],p[0][2]=c[0],p[1][2]=c[1],c=p[3],p[0][3]=c[0],p[1][3]=c[1],p[2][3]=c[2];break;case 5:l=x[0],c=p[0],b=1/l[0],c[0]=b,l[1]=l[1]*b,l[2]=l[2]*b,l[3]=l[3]*b,l[4]=l[4]*b,m=x[1],(v=p[1])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],m[4]=m[4]-l[4]*m[0],m=x[2],(v=p[2])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],m[4]=m[4]-l[4]*m[0],m=x[3],(v=p[3])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],m[4]=m[4]-l[4]*m[0],m=x[4],(v=p[4])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],m[4]=m[4]-l[4]*m[0],l=x[1],c=p[1],b=1/l[1],c[1]=b,c[0]=c[0]*b,l[2]=l[2]*b,l[3]=l[3]*b,l[4]=l[4]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],m[4]=m[4]-l[4]*m[1],m=x[2],(v=p[2])[0]=v[0]-c[0]*m[1],v[1]=-b*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],m[4]=m[4]-l[4]*m[1],m=x[3],(v=p[3])[0]=v[0]-c[0]*m[1],v[1]=-b*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],m[4]=m[4]-l[4]*m[1],m=x[4],(v=p[4])[0]=v[0]-c[0]*m[1],v[1]=-b*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],m[4]=m[4]-l[4]*m[1],l=x[2],c=p[2],b=1/l[2],c[2]=b,c[0]=c[0]*b,c[1]=c[1]*b,l[3]=l[3]*b,l[4]=l[4]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[2],m[3]=m[3]-l[3]*m[2],m[4]=m[4]-l[4]*m[2],m=x[1],(v=p[1])[0]=v[0]-c[0]*m[2],v[1]=v[1]-c[1]*m[2],m[3]=m[3]-l[3]*m[2],m[4]=m[4]-l[4]*m[2],m=x[3],(v=p[3])[0]=v[0]-c[0]*m[2],v[1]=v[1]-c[1]*m[2],v[2]=-b*m[2],m[3]=m[3]-l[3]*m[2],m[4]=m[4]-l[4]*m[2],m=x[4],(v=p[4])[0]=v[0]-c[0]*m[2],v[1]=v[1]-c[1]*m[2],v[2]=-b*m[2],m[3]=m[3]-l[3]*m[2],m[4]=m[4]-l[4]*m[2],l=x[3],c=p[3],b=1/l[3],c[3]=b,c[0]=c[0]*b,c[1]=c[1]*b,c[2]=c[2]*b,l[4]=l[4]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[3],m[4]=m[4]-l[4]*m[3],m=x[1],(v=p[1])[0]=v[0]-c[0]*m[3],v[1]=v[1]-c[1]*m[3],m[4]=m[4]-l[4]*m[3],m=x[2],(v=p[2])[0]=v[0]-c[0]*m[3],v[1]=v[1]-c[1]*m[3],v[2]=v[2]-c[2]*m[3],m[4]=m[4]-l[4]*m[3],m=x[4],(v=p[4])[0]=v[0]-c[0]*m[3],v[1]=v[1]-c[1]*m[3],v[2]=v[2]-c[2]*m[3],v[3]=-b*m[3],m[4]=m[4]-l[4]*m[3],l=x[4],c=p[4],b=1/l[4],c[4]=b,c[0]=c[0]*b,c[1]=c[1]*b,c[2]=c[2]*b,c[3]=c[3]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[4],m=x[1],(v=p[1])[0]=v[0]-c[0]*m[4],v[1]=v[1]-c[1]*m[4],m=x[2],(v=p[2])[0]=v[0]-c[0]*m[4],v[1]=v[1]-c[1]*m[4],v[2]=v[2]-c[2]*m[4],m=x[3],(v=p[3])[0]=v[0]-c[0]*m[4],v[1]=v[1]-c[1]*m[4],v[2]=v[2]-c[2]*m[4],v[3]=v[3]-c[3]*m[4],c=p[1],p[0][1]=c[0],c=p[2],p[0][2]=c[0],p[1][2]=c[1],c=p[3],p[0][3]=c[0],p[1][3]=c[1],p[2][3]=c[2],c=p[4],p[0][4]=c[0],p[1][4]=c[1],p[2][4]=c[2],p[3][4]=c[3];break;case 6:l=x[0],c=p[0],b=1/l[0],c[0]=b,l[1]=l[1]*b,l[2]=l[2]*b,l[3]=l[3]*b,l[4]=l[4]*b,l[5]=l[5]*b,m=x[1],(v=p[1])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],m[4]=m[4]-l[4]*m[0],m[5]=m[5]-l[5]*m[0],m=x[2],(v=p[2])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],m[4]=m[4]-l[4]*m[0],m[5]=m[5]-l[5]*m[0],m=x[3],(v=p[3])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],m[4]=m[4]-l[4]*m[0],m[5]=m[5]-l[5]*m[0],m=x[4],(v=p[4])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],m[4]=m[4]-l[4]*m[0],m[5]=m[5]-l[5]*m[0],m=x[5],(v=p[5])[0]=-b*m[0],m[1]=m[1]-l[1]*m[0],m[2]=m[2]-l[2]*m[0],m[3]=m[3]-l[3]*m[0],m[4]=m[4]-l[4]*m[0],m[5]=m[5]-l[5]*m[0],l=x[1],c=p[1],b=1/l[1],c[1]=b,c[0]=c[0]*b,l[2]=l[2]*b,l[3]=l[3]*b,l[4]=l[4]*b,l[5]=l[5]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],m[4]=m[4]-l[4]*m[1],m[5]=m[5]-l[5]*m[1],m=x[2],(v=p[2])[0]=v[0]-c[0]*m[1],v[1]=-b*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],m[4]=m[4]-l[4]*m[1],m[5]=m[5]-l[5]*m[1],m=x[3],(v=p[3])[0]=v[0]-c[0]*m[1],v[1]=-b*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],m[4]=m[4]-l[4]*m[1],m[5]=m[5]-l[5]*m[1],m=x[4],(v=p[4])[0]=v[0]-c[0]*m[1],v[1]=-b*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],m[4]=m[4]-l[4]*m[1],m[5]=m[5]-l[5]*m[1],m=x[5],(v=p[5])[0]=v[0]-c[0]*m[1],v[1]=-b*m[1],m[2]=m[2]-l[2]*m[1],m[3]=m[3]-l[3]*m[1],m[4]=m[4]-l[4]*m[1],m[5]=m[5]-l[5]*m[1],l=x[2],c=p[2],b=1/l[2],c[2]=b,c[0]=c[0]*b,c[1]=c[1]*b,l[3]=l[3]*b,l[4]=l[4]*b,l[5]=l[5]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[2],m[3]=m[3]-l[3]*m[2],m[4]=m[4]-l[4]*m[2],m[5]=m[5]-l[5]*m[2],m=x[1],(v=p[1])[0]=v[0]-c[0]*m[2],v[1]=v[1]-c[1]*m[2],m[3]=m[3]-l[3]*m[2],m[4]=m[4]-l[4]*m[2],m[5]=m[5]-l[5]*m[2],m=x[3],(v=p[3])[0]=v[0]-c[0]*m[2],v[1]=v[1]-c[1]*m[2],v[2]=-b*m[2],m[3]=m[3]-l[3]*m[2],m[4]=m[4]-l[4]*m[2],m[5]=m[5]-l[5]*m[2],m=x[4],(v=p[4])[0]=v[0]-c[0]*m[2],v[1]=v[1]-c[1]*m[2],v[2]=-b*m[2],m[3]=m[3]-l[3]*m[2],m[4]=m[4]-l[4]*m[2],m[5]=m[5]-l[5]*m[2],m=x[5],(v=p[5])[0]=v[0]-c[0]*m[2],v[1]=v[1]-c[1]*m[2],v[2]=-b*m[2],m[3]=m[3]-l[3]*m[2],m[4]=m[4]-l[4]*m[2],m[5]=m[5]-l[5]*m[2],l=x[3],c=p[3],b=1/l[3],c[3]=b,c[0]=c[0]*b,c[1]=c[1]*b,c[2]=c[2]*b,l[4]=l[4]*b,l[5]=l[5]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[3],m[4]=m[4]-l[4]*m[3],m[5]=m[5]-l[5]*m[3],m=x[1],(v=p[1])[0]=v[0]-c[0]*m[3],v[1]=v[1]-c[1]*m[3],m[4]=m[4]-l[4]*m[3],m[5]=m[5]-l[5]*m[3],m=x[2],(v=p[2])[0]=v[0]-c[0]*m[3],v[1]=v[1]-c[1]*m[3],v[2]=v[2]-c[2]*m[3],m[4]=m[4]-l[4]*m[3],m[5]=m[5]-l[5]*m[3],m=x[4],(v=p[4])[0]=v[0]-c[0]*m[3],v[1]=v[1]-c[1]*m[3],v[2]=v[2]-c[2]*m[3],v[3]=-b*m[3],m[4]=m[4]-l[4]*m[3],m[5]=m[5]-l[5]*m[3],m=x[5],(v=p[5])[0]=v[0]-c[0]*m[3],v[1]=v[1]-c[1]*m[3],v[2]=v[2]-c[2]*m[3],v[3]=-b*m[3],m[4]=m[4]-l[4]*m[3],m[5]=m[5]-l[5]*m[3],l=x[4],c=p[4],b=1/l[4],c[4]=b,c[0]=c[0]*b,c[1]=c[1]*b,c[2]=c[2]*b,c[3]=c[3]*b,l[5]=l[5]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[4],m[5]=m[5]-l[5]*m[4],m=x[1],(v=p[1])[0]=v[0]-c[0]*m[4],v[1]=v[1]-c[1]*m[4],m[5]=m[5]-l[5]*m[4],m=x[2],(v=p[2])[0]=v[0]-c[0]*m[4],v[1]=v[1]-c[1]*m[4],v[2]=v[2]-c[2]*m[4],m[5]=m[5]-l[5]*m[4],m=x[3],(v=p[3])[0]=v[0]-c[0]*m[4],v[1]=v[1]-c[1]*m[4],v[2]=v[2]-c[2]*m[4],v[3]=v[3]-c[3]*m[4],m[5]=m[5]-l[5]*m[4],m=x[5],(v=p[5])[0]=v[0]-c[0]*m[4],v[1]=v[1]-c[1]*m[4],v[2]=v[2]-c[2]*m[4],v[3]=v[3]-c[3]*m[4],v[4]=-b*m[4],m[5]=m[5]-l[5]*m[4],l=x[5],c=p[5],b=1/l[5],c[5]=b,c[0]=c[0]*b,c[1]=c[1]*b,c[2]=c[2]*b,c[3]=c[3]*b,c[4]=c[4]*b,m=x[0],(v=p[0])[0]=v[0]-c[0]*m[5],m=x[1],(v=p[1])[0]=v[0]-c[0]*m[5],v[1]=v[1]-c[1]*m[5],m=x[2],(v=p[2])[0]=v[0]-c[0]*m[5],v[1]=v[1]-c[1]*m[5],v[2]=v[2]-c[2]*m[5],m=x[3],(v=p[3])[0]=v[0]-c[0]*m[5],v[1]=v[1]-c[1]*m[5],v[2]=v[2]-c[2]*m[5],v[3]=v[3]-c[3]*m[5],m=x[4],(v=p[4])[0]=v[0]-c[0]*m[5],v[1]=v[1]-c[1]*m[5],v[2]=v[2]-c[2]*m[5],v[3]=v[3]-c[3]*m[5],v[4]=v[4]-c[4]*m[5],c=p[1],p[0][1]=c[0],c=p[2],p[0][2]=c[0],p[1][2]=c[1],c=p[3],p[0][3]=c[0],p[1][3]=c[1],p[2][3]=c[2],c=p[4],p[0][4]=c[0],p[1][4]=c[1],p[2][4]=c[2],p[3][4]=c[3],c=p[5],p[0][5]=c[0],p[1][5]=c[1],p[2][5]=c[2],p[3][5]=c[3],p[4][5]=c[4];break;default:for(var f=0,u=a;f<u;){var y=f++;l=x[y],c=p[y];var d=1/l[y];c[y]=d;for(var g=0,X=y;g<X;){var z=g++;c[z]=c[z]*d}for(var Y=y+1,Z=a;Y<Z;){var M=Y++;l[M]=l[M]*d}for(var I=0,V=y;I<V;){var w=I++;m=x[w],v=p[w];for(var L=0,k=w+1;L<k;){var B=L++;v[B]=v[B]-c[B]*m[y]}for(var A=y+1,P=a;A<P;){var S=A++;m[S]=m[S]-l[S]*m[y]}}for(var T=y+1,C=a;T<C;){var j=T++;m=x[j],v=p[j];for(var R=0,E=y;R<E;){var q=R++;v[q]=v[q]-c[q]*m[y]}v[y]=-d*m[y];for(var N=y+1,F=a;N<F;){var D=N++;m[D]=m[D]-l[D]*m[y]}}}for(var G=1,W=a;G<W;){var J=G++;c=p[J];for(var U=0,O=J;U<O;){var H=U++;p[H][J]=c[H]}}}}computeInvMass(t,i){var a,s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y,d=this._invMass,g=this._invMassWithoutCfm,X=t.numRows,z=t.b1,Y=t.b2,Z=z._invMass,M=Y._invMass;a=z._invInertia00,s=z._invInertia01,o=z._invInertia02,n=z._invInertia10,r=z._invInertia11,e=z._invInertia12,_=z._invInertia20,h=z._invInertia21,l=z._invInertia22,c=Y._invInertia00,m=Y._invInertia01,v=Y._invInertia02,b=Y._invInertia10,x=Y._invInertia11,p=Y._invInertia12,f=Y._invInertia20,u=Y._invInertia21,y=Y._invInertia22;for(var I=0,V=X;I<V;){var w,L,k,B,A,P,S=I++,T=t.rows[S].jacobian,C=i[S];if(T.updateSparsity(),1&T.flag?(C.invMLin1X=T.lin1X*Z,C.invMLin1Y=T.lin1Y*Z,C.invMLin1Z=T.lin1Z*Z,C.invMLin2X=T.lin2X*M,C.invMLin2Y=T.lin2Y*M,C.invMLin2Z=T.lin2Z*M):(C.invMLin1X=0,C.invMLin1Y=0,C.invMLin1Z=0,C.invMLin2X=0,C.invMLin2Y=0,C.invMLin2Z=0),2&T.flag)w=a*T.ang1X+s*T.ang1Y+o*T.ang1Z,L=n*T.ang1X+r*T.ang1Y+e*T.ang1Z,k=_*T.ang1X+h*T.ang1Y+l*T.ang1Z,C.invMAng1X=w,C.invMAng1Y=L,C.invMAng1Z=k,B=c*T.ang2X+m*T.ang2Y+v*T.ang2Z,A=b*T.ang2X+x*T.ang2Y+p*T.ang2Z,P=f*T.ang2X+u*T.ang2Y+y*T.ang2Z,C.invMAng2X=B,C.invMAng2Y=A,C.invMAng2Z=P;else C.invMAng1X=0,C.invMAng1Y=0,C.invMAng1Z=0,C.invMAng2X=0,C.invMAng2Y=0,C.invMAng2Z=0}for(var j=0,R=X;j<R;)for(var E=j++,q=t.rows[E].jacobian,N=E,F=X;N<F;){var D=N++;t.rows[D].jacobian;var G=i[D],W=q.lin1X*G.invMLin1X+q.lin1Y*G.invMLin1Y+q.lin1Z*G.invMLin1Z+(q.ang1X*G.invMAng1X+q.ang1Y*G.invMAng1Y+q.ang1Z*G.invMAng1Z)+(q.lin2X*G.invMLin2X+q.lin2Y*G.invMLin2Y+q.lin2Z*G.invMLin2Z)+(q.ang2X*G.invMAng2X+q.ang2Y*G.invMAng2Y+q.ang2Z*G.invMAng2Z);E==D?(d[E][D]=W+t.rows[E].cfm,g[E][D]=W,G.mass=W+t.rows[E].cfm,G.massWithoutCfm=W,0!=G.mass&&(G.mass=1/G.mass),0!=G.massWithoutCfm&&(G.massWithoutCfm=1/G.massWithoutCfm)):(d[E][D]=W,d[D][E]=W,g[E][D]=W,g[D][E]=W)}for(var J=0,U=this._maxSubmatrixId;J<U;){var O=J++;this._cacheComputed[O]=!1}}},pa.dynamics.constraint.solver.pgs||(pa.dynamics.constraint.solver.pgs={}),pa.dynamics.constraint.solver.pgs.PgsContactConstraintSolver=class extends pa.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.constraint=t,this.info=new pa.dynamics.constraint.info.contact.ContactSolverInfo;var i=new Array(pa.common.Setting.maxManifoldPoints);this.massData=i;for(var a=0,s=this.massData.length;a<s;){var o=a++;this.massData[o]=new pa.dynamics.constraint.solver.common.ContactSolverMassDataRow}}preSolveVelocity(t){this.constraint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;var i,a,s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y=this._b1._invMass,d=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,s=this._b1._invInertia02,o=this._b1._invInertia10,n=this._b1._invInertia11,r=this._b1._invInertia12,e=this._b1._invInertia20,_=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,v=this._b2._invInertia10,b=this._b2._invInertia11,x=this._b2._invInertia12,p=this._b2._invInertia20,f=this._b2._invInertia21,u=this._b2._invInertia22;for(var g=0,X=this.info.numRows;g<X;){var z,Y,Z,M,I,V,w=g++,L=this.info.rows[w],k=this.massData[w],B=L.jacobianN;k.invMLinN1X=B.lin1X*y,k.invMLinN1Y=B.lin1Y*y,k.invMLinN1Z=B.lin1Z*y,k.invMLinN2X=B.lin2X*d,k.invMLinN2Y=B.lin2Y*d,k.invMLinN2Z=B.lin2Z*d,z=i*B.ang1X+a*B.ang1Y+s*B.ang1Z,Y=o*B.ang1X+n*B.ang1Y+r*B.ang1Z,Z=e*B.ang1X+_*B.ang1Y+h*B.ang1Z,k.invMAngN1X=z,k.invMAngN1Y=Y,k.invMAngN1Z=Z,M=l*B.ang2X+c*B.ang2Y+m*B.ang2Z,I=v*B.ang2X+b*B.ang2Y+x*B.ang2Z,V=p*B.ang2X+f*B.ang2Y+u*B.ang2Z,k.invMAngN2X=M,k.invMAngN2Y=I,k.invMAngN2Z=V,k.massN=y+d+(k.invMAngN1X*B.ang1X+k.invMAngN1Y*B.ang1Y+k.invMAngN1Z*B.ang1Z)+(k.invMAngN2X*B.ang2X+k.invMAngN2Y*B.ang2Y+k.invMAngN2Z*B.ang2Z),0!=k.massN&&(k.massN=1/k.massN);var A,P,S,T,C,j,R,E,q,N,F,D,G=L.jacobianT,W=L.jacobianB;k.invMLinT1X=G.lin1X*y,k.invMLinT1Y=G.lin1Y*y,k.invMLinT1Z=G.lin1Z*y,k.invMLinT2X=G.lin2X*d,k.invMLinT2Y=G.lin2Y*d,k.invMLinT2Z=G.lin2Z*d,k.invMLinB1X=W.lin1X*y,k.invMLinB1Y=W.lin1Y*y,k.invMLinB1Z=W.lin1Z*y,k.invMLinB2X=W.lin2X*d,k.invMLinB2Y=W.lin2Y*d,k.invMLinB2Z=W.lin2Z*d,A=i*G.ang1X+a*G.ang1Y+s*G.ang1Z,P=o*G.ang1X+n*G.ang1Y+r*G.ang1Z,S=e*G.ang1X+_*G.ang1Y+h*G.ang1Z,k.invMAngT1X=A,k.invMAngT1Y=P,k.invMAngT1Z=S,T=l*G.ang2X+c*G.ang2Y+m*G.ang2Z,C=v*G.ang2X+b*G.ang2Y+x*G.ang2Z,j=p*G.ang2X+f*G.ang2Y+u*G.ang2Z,k.invMAngT2X=T,k.invMAngT2Y=C,k.invMAngT2Z=j,R=i*W.ang1X+a*W.ang1Y+s*W.ang1Z,E=o*W.ang1X+n*W.ang1Y+r*W.ang1Z,q=e*W.ang1X+_*W.ang1Y+h*W.ang1Z,k.invMAngB1X=R,k.invMAngB1Y=E,k.invMAngB1Z=q,N=l*W.ang2X+c*W.ang2Y+m*W.ang2Z,F=v*W.ang2X+b*W.ang2Y+x*W.ang2Z,D=p*W.ang2X+f*W.ang2Y+u*W.ang2Z,k.invMAngB2X=N,k.invMAngB2Y=F,k.invMAngB2Z=D;var J=y+d+(k.invMAngT1X*G.ang1X+k.invMAngT1Y*G.ang1Y+k.invMAngT1Z*G.ang1Z)+(k.invMAngT2X*G.ang2X+k.invMAngT2Y*G.ang2Y+k.invMAngT2Z*G.ang2Z),U=k.invMAngT1X*W.ang1X+k.invMAngT1Y*W.ang1Y+k.invMAngT1Z*W.ang1Z+(k.invMAngT2X*W.ang2X+k.invMAngT2Y*W.ang2Y+k.invMAngT2Z*W.ang2Z),O=U,H=y+d+(k.invMAngB1X*W.ang1X+k.invMAngB1Y*W.ang1Y+k.invMAngB1Z*W.ang1Z)+(k.invMAngB2X*W.ang2X+k.invMAngB2Y*W.ang2Y+k.invMAngB2Z*W.ang2Z),Q=J*H-U*O;0!=Q&&(Q=1/Q),k.massTB00=H*Q,k.massTB01=-U*Q,k.massTB10=-O*Q,k.massTB11=J*Q}}warmStart(t){var i,a,s,o,n,r,e,_,h,l,c,m;i=this._b1._velX,a=this._b1._velY,s=this._b1._velZ,o=this._b2._velX,n=this._b2._velY,r=this._b2._velZ,e=this._b1._angVelX,_=this._b1._angVelY,h=this._b1._angVelZ,l=this._b2._angVelX,c=this._b2._angVelY,m=this._b2._angVelZ;for(var v=0,b=this.info.numRows;v<b;){var x=v++,p=this.info.rows[x],f=p.impulse,u=this.massData[x],y=p.jacobianT,d=p.jacobianB,g=f.impulseN,X=f.impulseLX*y.lin1X+f.impulseLY*y.lin1Y+f.impulseLZ*y.lin1Z,z=f.impulseLX*d.lin1X+f.impulseLY*d.lin1Y+f.impulseLZ*d.lin1Z;f.impulseT=X,f.impulseB=z,f.impulseN*=t.dtRatio,f.impulseT*=t.dtRatio,f.impulseB*=t.dtRatio,i+=u.invMLinN1X*g,a+=u.invMLinN1Y*g,s+=u.invMLinN1Z*g,i+=u.invMLinT1X*X,a+=u.invMLinT1Y*X,s+=u.invMLinT1Z*X,i+=u.invMLinB1X*z,a+=u.invMLinB1Y*z,s+=u.invMLinB1Z*z,o+=u.invMLinN2X*-g,n+=u.invMLinN2Y*-g,r+=u.invMLinN2Z*-g,o+=u.invMLinT2X*-X,n+=u.invMLinT2Y*-X,r+=u.invMLinT2Z*-X,o+=u.invMLinB2X*-z,n+=u.invMLinB2Y*-z,r+=u.invMLinB2Z*-z,e+=u.invMAngN1X*g,_+=u.invMAngN1Y*g,h+=u.invMAngN1Z*g,e+=u.invMAngT1X*X,_+=u.invMAngT1Y*X,h+=u.invMAngT1Z*X,e+=u.invMAngB1X*z,_+=u.invMAngB1Y*z,h+=u.invMAngB1Z*z,l+=u.invMAngN2X*-g,c+=u.invMAngN2Y*-g,m+=u.invMAngN2Z*-g,l+=u.invMAngT2X*-X,c+=u.invMAngT2Y*-X,m+=u.invMAngT2Z*-X,l+=u.invMAngB2X*-z,c+=u.invMAngB2Y*-z,m+=u.invMAngB2Z*-z}this._b1._velX=i,this._b1._velY=a,this._b1._velZ=s,this._b2._velX=o,this._b2._velY=n,this._b2._velZ=r,this._b1._angVelX=e,this._b1._angVelY=_,this._b1._angVelZ=h,this._b2._angVelX=l,this._b2._angVelY=c,this._b2._angVelZ=m}solveVelocity(){var t,i,a,s,o,n,r,e,_,h,l,c;t=this._b1._velX,i=this._b1._velY,a=this._b1._velZ,s=this._b2._velX,o=this._b2._velY,n=this._b2._velZ,r=this._b1._angVelX,e=this._b1._angVelY,_=this._b1._angVelZ,h=this._b2._angVelX,l=this._b2._angVelY,c=this._b2._angVelZ;for(var m=0,v=this.info.numRows;m<v;){var b=m++,x=this.info.rows[b],p=this.massData[b],f=x.impulse,u=0,y=x.jacobianT;u+=t*y.lin1X+i*y.lin1Y+a*y.lin1Z,u-=s*y.lin2X+o*y.lin2Y+n*y.lin2Z,u+=r*y.ang1X+e*y.ang1Y+_*y.ang1Z,u-=h*y.ang2X+l*y.ang2Y+c*y.ang2Z;var d=0;d+=t*(y=x.jacobianB).lin1X+i*y.lin1Y+a*y.lin1Z,d-=s*y.lin2X+o*y.lin2Y+n*y.lin2Z,d+=r*y.ang1X+e*y.ang1Y+_*y.ang1Z,d-=h*y.ang2X+l*y.ang2Y+c*y.ang2Z;var g=-(u*p.massTB00+d*p.massTB01),X=-(u*p.massTB10+d*p.massTB11),z=f.impulseT,Y=f.impulseB;f.impulseT+=g,f.impulseB+=X;var Z=x.friction*f.impulseN;if(0==Z)f.impulseT=0,f.impulseB=0;else{var M=f.impulseT*f.impulseT+f.impulseB*f.impulseB;if(M>Z*Z){var I=Z/Math.sqrt(M);f.impulseT*=I,f.impulseB*=I}}g=f.impulseT-z,X=f.impulseB-Y,t+=p.invMLinT1X*g,i+=p.invMLinT1Y*g,a+=p.invMLinT1Z*g,t+=p.invMLinB1X*X,i+=p.invMLinB1Y*X,a+=p.invMLinB1Z*X,s+=p.invMLinT2X*-g,o+=p.invMLinT2Y*-g,n+=p.invMLinT2Z*-g,s+=p.invMLinB2X*-X,o+=p.invMLinB2Y*-X,n+=p.invMLinB2Z*-X,r+=p.invMAngT1X*g,e+=p.invMAngT1Y*g,_+=p.invMAngT1Z*g,r+=p.invMAngB1X*X,e+=p.invMAngB1Y*X,_+=p.invMAngB1Z*X,h+=p.invMAngT2X*-g,l+=p.invMAngT2Y*-g,c+=p.invMAngT2Z*-g,h+=p.invMAngB2X*-X,l+=p.invMAngB2Y*-X,c+=p.invMAngB2Z*-X}for(var V=0,w=this.info.numRows;V<w;){var L=V++,k=this.info.rows[L],B=this.massData[L],A=k.impulse,P=0,S=k.jacobianN;P+=t*S.lin1X+i*S.lin1Y+a*S.lin1Z,P-=s*S.lin2X+o*S.lin2Y+n*S.lin2Z,P+=r*S.ang1X+e*S.ang1Y+_*S.ang1Z,P-=h*S.ang2X+l*S.ang2Y+c*S.ang2Z;var T=(k.rhs-P)*B.massN,C=A.impulseN;A.impulseN+=T,A.impulseN<0&&(A.impulseN=0),T=A.impulseN-C,t+=B.invMLinN1X*T,i+=B.invMLinN1Y*T,a+=B.invMLinN1Z*T,s+=B.invMLinN2X*-T,o+=B.invMLinN2Y*-T,n+=B.invMLinN2Z*-T,r+=B.invMAngN1X*T,e+=B.invMAngN1Y*T,_+=B.invMAngN1Z*T,h+=B.invMAngN2X*-T,l+=B.invMAngN2Y*-T,c+=B.invMAngN2Z*-T}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=a,this._b2._velX=s,this._b2._velY=o,this._b2._velZ=n,this._b1._angVelX=r,this._b1._angVelY=e,this._b1._angVelZ=_,this._b2._angVelX=h,this._b2._angVelY=l,this._b2._angVelZ=c}preSolvePosition(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);var i,a,s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y=this._b1._invMass,d=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,s=this._b1._invInertia02,o=this._b1._invInertia10,n=this._b1._invInertia11,r=this._b1._invInertia12,e=this._b1._invInertia20,_=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,v=this._b2._invInertia10,b=this._b2._invInertia11,x=this._b2._invInertia12,p=this._b2._invInertia20,f=this._b2._invInertia21,u=this._b2._invInertia22;for(var g=0,X=this.info.numRows;g<X;){var z,Y,Z,M,I,V,w=g++,L=this.info.rows[w],k=this.massData[w],B=L.jacobianN;k.invMLinN1X=B.lin1X*y,k.invMLinN1Y=B.lin1Y*y,k.invMLinN1Z=B.lin1Z*y,k.invMLinN2X=B.lin2X*d,k.invMLinN2Y=B.lin2Y*d,k.invMLinN2Z=B.lin2Z*d,z=i*B.ang1X+a*B.ang1Y+s*B.ang1Z,Y=o*B.ang1X+n*B.ang1Y+r*B.ang1Z,Z=e*B.ang1X+_*B.ang1Y+h*B.ang1Z,k.invMAngN1X=z,k.invMAngN1Y=Y,k.invMAngN1Z=Z,M=l*B.ang2X+c*B.ang2Y+m*B.ang2Z,I=v*B.ang2X+b*B.ang2Y+x*B.ang2Z,V=p*B.ang2X+f*B.ang2Y+u*B.ang2Z,k.invMAngN2X=M,k.invMAngN2Y=I,k.invMAngN2Z=V,k.massN=y+d+(k.invMAngN1X*B.ang1X+k.invMAngN1Y*B.ang1Y+k.invMAngN1Z*B.ang1Z)+(k.invMAngN2X*B.ang2X+k.invMAngN2Y*B.ang2Y+k.invMAngN2Z*B.ang2Z),0!=k.massN&&(k.massN=1/k.massN)}for(var A=0,P=this.info.numRows;A<P;){var S=A++;this.info.rows[S].impulse.impulseP=0}}solvePositionSplitImpulse(){var t,i,a,s,o,n,r,e,_,h,l,c;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,a=this._b1._pseudoVelZ,s=this._b2._pseudoVelX,o=this._b2._pseudoVelY,n=this._b2._pseudoVelZ,r=this._b1._angPseudoVelX,e=this._b1._angPseudoVelY,_=this._b1._angPseudoVelZ,h=this._b2._angPseudoVelX,l=this._b2._angPseudoVelY,c=this._b2._angPseudoVelZ;for(var m=0,v=this.info.numRows;m<v;){var b=m++,x=this.info.rows[b],p=this.massData[b],f=x.impulse,u=x.jacobianN,y=0;y+=t*u.lin1X+i*u.lin1Y+a*u.lin1Z,y-=s*u.lin2X+o*u.lin2Y+n*u.lin2Z,y+=r*u.ang1X+e*u.ang1Y+_*u.ang1Z,y-=h*u.ang2X+l*u.ang2Y+c*u.ang2Z;var d=(x.rhs-y)*p.massN*pa.common.Setting.positionSplitImpulseBaumgarte,g=f.impulseP;f.impulseP+=d,f.impulseP<0&&(f.impulseP=0),d=f.impulseP-g,t+=p.invMLinN1X*d,i+=p.invMLinN1Y*d,a+=p.invMLinN1Z*d,s+=p.invMLinN2X*-d,o+=p.invMLinN2Y*-d,n+=p.invMLinN2Z*-d,r+=p.invMAngN1X*d,e+=p.invMAngN1Y*d,_+=p.invMAngN1Z*d,h+=p.invMAngN2X*-d,l+=p.invMAngN2Y*-d,c+=p.invMAngN2Z*-d}this._b1._pseudoVelX=t,this._b1._pseudoVelY=i,this._b1._pseudoVelZ=a,this._b2._pseudoVelX=s,this._b2._pseudoVelY=o,this._b2._pseudoVelZ=n,this._b1._angPseudoVelX=r,this._b1._angPseudoVelY=e,this._b1._angPseudoVelZ=_,this._b2._angPseudoVelX=h,this._b2._angPseudoVelY=l,this._b2._angPseudoVelZ=c}solvePositionNgs(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);var i,a,s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y=this._b1._invMass,d=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,s=this._b1._invInertia02,o=this._b1._invInertia10,n=this._b1._invInertia11,r=this._b1._invInertia12,e=this._b1._invInertia20,_=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,v=this._b2._invInertia10,b=this._b2._invInertia11,x=this._b2._invInertia12,p=this._b2._invInertia20,f=this._b2._invInertia21,u=this._b2._invInertia22;for(var g,X,z,Y,Z,M,I,V,w,L,k,B,A=0,P=this.info.numRows;A<P;){var S,T,C,j,R,E,q=A++,N=this.info.rows[q],F=this.massData[q],D=N.jacobianN;F.invMLinN1X=D.lin1X*y,F.invMLinN1Y=D.lin1Y*y,F.invMLinN1Z=D.lin1Z*y,F.invMLinN2X=D.lin2X*d,F.invMLinN2Y=D.lin2Y*d,F.invMLinN2Z=D.lin2Z*d,S=i*D.ang1X+a*D.ang1Y+s*D.ang1Z,T=o*D.ang1X+n*D.ang1Y+r*D.ang1Z,C=e*D.ang1X+_*D.ang1Y+h*D.ang1Z,F.invMAngN1X=S,F.invMAngN1Y=T,F.invMAngN1Z=C,j=l*D.ang2X+c*D.ang2Y+m*D.ang2Z,R=v*D.ang2X+b*D.ang2Y+x*D.ang2Z,E=p*D.ang2X+f*D.ang2Y+u*D.ang2Z,F.invMAngN2X=j,F.invMAngN2Y=R,F.invMAngN2Z=E,F.massN=y+d+(F.invMAngN1X*D.ang1X+F.invMAngN1Y*D.ang1Y+F.invMAngN1Z*D.ang1Z)+(F.invMAngN2X*D.ang2X+F.invMAngN2Y*D.ang2Y+F.invMAngN2Z*D.ang2Z),0!=F.massN&&(F.massN=1/F.massN)}g=0,X=0,z=0,Y=0,Z=0,M=0,I=0,V=0,w=0,L=0,k=0,B=0;for(var G=0,W=this.info.numRows;G<W;){var J=G++,U=this.info.rows[J],O=this.massData[J],H=U.impulse,Q=U.jacobianN,K=0;K+=g*Q.lin1X+X*Q.lin1Y+z*Q.lin1Z,K-=Y*Q.lin2X+Z*Q.lin2Y+M*Q.lin2Z,K+=I*Q.ang1X+V*Q.ang1Y+w*Q.ang1Z,K-=L*Q.ang2X+k*Q.ang2Y+B*Q.ang2Z;var $=(U.rhs-K)*O.massN*pa.common.Setting.positionNgsBaumgarte,tt=H.impulseP;H.impulseP+=$,H.impulseP<0&&(H.impulseP=0),$=H.impulseP-tt,g+=O.invMLinN1X*$,X+=O.invMLinN1Y*$,z+=O.invMLinN1Z*$,Y+=O.invMLinN2X*-$,Z+=O.invMLinN2Y*-$,M+=O.invMLinN2Z*-$,I+=O.invMAngN1X*$,V+=O.invMAngN1Y*$,w+=O.invMAngN1Z*$,L+=O.invMAngN2X*-$,k+=O.invMAngN2Y*-$,B+=O.invMAngN2Z*-$}var it=this._b1;it._transform._positionX+=g,it._transform._positionY+=X,it._transform._positionZ+=z;var at=this._b2;at._transform._positionX+=Y,at._transform._positionY+=Z,at._transform._positionZ+=M;var st,ot,nt,rt,et,_t,ht,lt,ct,mt,vt=this._b1,bt=Math.sqrt(I*I+V*V+w*w),xt=.5*bt;if(xt<.5){var pt=xt*xt;st=.5*(1-.16666666666666666*pt+pt*pt*.008333333333333333),ot=1-.5*pt+pt*pt*.041666666666666664}else st=Math.sin(xt)/bt,ot=Math.cos(xt);nt=I*st,rt=V*st,et=w*st,_t=ot;var ft,ut=vt._transform._rotation00,yt=vt._transform._rotation11,dt=vt._transform._rotation22,gt=ut+yt+dt;gt>0?(mt=.5*(ft=Math.sqrt(gt+1)),ft=.5/ft,ht=(vt._transform._rotation21-vt._transform._rotation12)*ft,lt=(vt._transform._rotation02-vt._transform._rotation20)*ft,ct=(vt._transform._rotation10-vt._transform._rotation01)*ft):ut>yt?ut>dt?(ht=.5*(ft=Math.sqrt(ut-yt-dt+1)),ft=.5/ft,lt=(vt._transform._rotation01+vt._transform._rotation10)*ft,ct=(vt._transform._rotation02+vt._transform._rotation20)*ft,mt=(vt._transform._rotation21-vt._transform._rotation12)*ft):(ct=.5*(ft=Math.sqrt(dt-ut-yt+1)),ft=.5/ft,ht=(vt._transform._rotation02+vt._transform._rotation20)*ft,lt=(vt._transform._rotation12+vt._transform._rotation21)*ft,mt=(vt._transform._rotation10-vt._transform._rotation01)*ft):yt>dt?(lt=.5*(ft=Math.sqrt(yt-dt-ut+1)),ft=.5/ft,ht=(vt._transform._rotation01+vt._transform._rotation10)*ft,ct=(vt._transform._rotation12+vt._transform._rotation21)*ft,mt=(vt._transform._rotation02-vt._transform._rotation20)*ft):(ct=.5*(ft=Math.sqrt(dt-ut-yt+1)),ft=.5/ft,ht=(vt._transform._rotation02+vt._transform._rotation20)*ft,lt=(vt._transform._rotation12+vt._transform._rotation21)*ft,mt=(vt._transform._rotation10-vt._transform._rotation01)*ft);var Xt=(ht=_t*ht+nt*mt+rt*ct-et*lt)*ht+(lt=_t*lt-nt*ct+rt*mt+et*ht)*lt+(ct=_t*ct+nt*lt-rt*ht+et*mt)*ct+(mt=_t*mt-nt*ht-rt*lt-et*ct)*mt;Xt>1e-32&&(Xt=1/Math.sqrt(Xt));ht*=Xt,lt*=Xt,ct*=Xt,mt*=Xt;var zt,Yt,Zt,Mt,It,Vt,wt,Lt,kt,Bt,At,Pt,St,Tt,Ct,jt,Rt,Et,qt=2*ht,Nt=2*lt,Ft=2*ct,Dt=ht*qt,Gt=lt*Nt,Wt=ct*Ft,Jt=ht*Nt,Ut=lt*Ft,Ot=ht*Ft,Ht=mt*qt,Qt=mt*Nt,Kt=mt*Ft;vt._transform._rotation00=1-Gt-Wt,vt._transform._rotation01=Jt-Kt,vt._transform._rotation02=Ot+Qt,vt._transform._rotation10=Jt+Kt,vt._transform._rotation11=1-Dt-Wt,vt._transform._rotation12=Ut-Ht,vt._transform._rotation20=Ot-Qt,vt._transform._rotation21=Ut+Ht,vt._transform._rotation22=1-Dt-Gt,zt=vt._transform._rotation00*vt._invLocalInertia00+vt._transform._rotation01*vt._invLocalInertia10+vt._transform._rotation02*vt._invLocalInertia20,Yt=vt._transform._rotation00*vt._invLocalInertia01+vt._transform._rotation01*vt._invLocalInertia11+vt._transform._rotation02*vt._invLocalInertia21,Zt=vt._transform._rotation00*vt._invLocalInertia02+vt._transform._rotation01*vt._invLocalInertia12+vt._transform._rotation02*vt._invLocalInertia22,Mt=vt._transform._rotation10*vt._invLocalInertia00+vt._transform._rotation11*vt._invLocalInertia10+vt._transform._rotation12*vt._invLocalInertia20,It=vt._transform._rotation10*vt._invLocalInertia01+vt._transform._rotation11*vt._invLocalInertia11+vt._transform._rotation12*vt._invLocalInertia21,Vt=vt._transform._rotation10*vt._invLocalInertia02+vt._transform._rotation11*vt._invLocalInertia12+vt._transform._rotation12*vt._invLocalInertia22,wt=vt._transform._rotation20*vt._invLocalInertia00+vt._transform._rotation21*vt._invLocalInertia10+vt._transform._rotation22*vt._invLocalInertia20,Lt=vt._transform._rotation20*vt._invLocalInertia01+vt._transform._rotation21*vt._invLocalInertia11+vt._transform._rotation22*vt._invLocalInertia21,kt=vt._transform._rotation20*vt._invLocalInertia02+vt._transform._rotation21*vt._invLocalInertia12+vt._transform._rotation22*vt._invLocalInertia22,vt._invInertia00=zt,vt._invInertia01=Yt,vt._invInertia02=Zt,vt._invInertia10=Mt,vt._invInertia11=It,vt._invInertia12=Vt,vt._invInertia20=wt,vt._invInertia21=Lt,vt._invInertia22=kt,Bt=vt._invInertia00*vt._transform._rotation00+vt._invInertia01*vt._transform._rotation01+vt._invInertia02*vt._transform._rotation02,At=vt._invInertia00*vt._transform._rotation10+vt._invInertia01*vt._transform._rotation11+vt._invInertia02*vt._transform._rotation12,Pt=vt._invInertia00*vt._transform._rotation20+vt._invInertia01*vt._transform._rotation21+vt._invInertia02*vt._transform._rotation22,St=vt._invInertia10*vt._transform._rotation00+vt._invInertia11*vt._transform._rotation01+vt._invInertia12*vt._transform._rotation02,Tt=vt._invInertia10*vt._transform._rotation10+vt._invInertia11*vt._transform._rotation11+vt._invInertia12*vt._transform._rotation12,Ct=vt._invInertia10*vt._transform._rotation20+vt._invInertia11*vt._transform._rotation21+vt._invInertia12*vt._transform._rotation22,jt=vt._invInertia20*vt._transform._rotation00+vt._invInertia21*vt._transform._rotation01+vt._invInertia22*vt._transform._rotation02,Rt=vt._invInertia20*vt._transform._rotation10+vt._invInertia21*vt._transform._rotation11+vt._invInertia22*vt._transform._rotation12,Et=vt._invInertia20*vt._transform._rotation20+vt._invInertia21*vt._transform._rotation21+vt._invInertia22*vt._transform._rotation22,vt._invInertia00=Bt,vt._invInertia01=At,vt._invInertia02=Pt,vt._invInertia10=St,vt._invInertia11=Tt,vt._invInertia12=Ct,vt._invInertia20=jt,vt._invInertia21=Rt,vt._invInertia22=Et,vt._invInertia00*=vt._rotFactor.x,vt._invInertia01*=vt._rotFactor.x,vt._invInertia02*=vt._rotFactor.x,vt._invInertia10*=vt._rotFactor.y,vt._invInertia11*=vt._rotFactor.y,vt._invInertia12*=vt._rotFactor.y,vt._invInertia20*=vt._rotFactor.z,vt._invInertia21*=vt._rotFactor.z,vt._invInertia22*=vt._rotFactor.z;var $t,ti,ii,ai,si,oi,ni,ri,ei,_i,hi=this._b2,li=Math.sqrt(L*L+k*k+B*B),ci=.5*li;if(ci<.5){var mi=ci*ci;$t=.5*(1-.16666666666666666*mi+mi*mi*.008333333333333333),ti=1-.5*mi+mi*mi*.041666666666666664}else $t=Math.sin(ci)/li,ti=Math.cos(ci);ii=L*$t,ai=k*$t,si=B*$t,oi=ti;var vi,bi=hi._transform._rotation00,xi=hi._transform._rotation11,pi=hi._transform._rotation22,fi=bi+xi+pi;fi>0?(_i=.5*(vi=Math.sqrt(fi+1)),vi=.5/vi,ni=(hi._transform._rotation21-hi._transform._rotation12)*vi,ri=(hi._transform._rotation02-hi._transform._rotation20)*vi,ei=(hi._transform._rotation10-hi._transform._rotation01)*vi):bi>xi?bi>pi?(ni=.5*(vi=Math.sqrt(bi-xi-pi+1)),vi=.5/vi,ri=(hi._transform._rotation01+hi._transform._rotation10)*vi,ei=(hi._transform._rotation02+hi._transform._rotation20)*vi,_i=(hi._transform._rotation21-hi._transform._rotation12)*vi):(ei=.5*(vi=Math.sqrt(pi-bi-xi+1)),vi=.5/vi,ni=(hi._transform._rotation02+hi._transform._rotation20)*vi,ri=(hi._transform._rotation12+hi._transform._rotation21)*vi,_i=(hi._transform._rotation10-hi._transform._rotation01)*vi):xi>pi?(ri=.5*(vi=Math.sqrt(xi-pi-bi+1)),vi=.5/vi,ni=(hi._transform._rotation01+hi._transform._rotation10)*vi,ei=(hi._transform._rotation12+hi._transform._rotation21)*vi,_i=(hi._transform._rotation02-hi._transform._rotation20)*vi):(ei=.5*(vi=Math.sqrt(pi-bi-xi+1)),vi=.5/vi,ni=(hi._transform._rotation02+hi._transform._rotation20)*vi,ri=(hi._transform._rotation12+hi._transform._rotation21)*vi,_i=(hi._transform._rotation10-hi._transform._rotation01)*vi);var ui=(ni=oi*ni+ii*_i+ai*ei-si*ri)*ni+(ri=oi*ri-ii*ei+ai*_i+si*ni)*ri+(ei=oi*ei+ii*ri-ai*ni+si*_i)*ei+(_i=oi*_i-ii*ni-ai*ri-si*ei)*_i;ui>1e-32&&(ui=1/Math.sqrt(ui));ni*=ui,ri*=ui,ei*=ui,_i*=ui;var yi,di,gi,Xi,zi,Yi,Zi,Mi,Ii,Vi,wi,Li,ki,Bi,Ai,Pi,Si,Ti,Ci=2*ni,ji=2*ri,Ri=2*ei,Ei=ni*Ci,qi=ri*ji,Ni=ei*Ri,Fi=ni*ji,Di=ri*Ri,Gi=ni*Ri,Wi=_i*Ci,Ji=_i*ji,Ui=_i*Ri;hi._transform._rotation00=1-qi-Ni,hi._transform._rotation01=Fi-Ui,hi._transform._rotation02=Gi+Ji,hi._transform._rotation10=Fi+Ui,hi._transform._rotation11=1-Ei-Ni,hi._transform._rotation12=Di-Wi,hi._transform._rotation20=Gi-Ji,hi._transform._rotation21=Di+Wi,hi._transform._rotation22=1-Ei-qi,yi=hi._transform._rotation00*hi._invLocalInertia00+hi._transform._rotation01*hi._invLocalInertia10+hi._transform._rotation02*hi._invLocalInertia20,di=hi._transform._rotation00*hi._invLocalInertia01+hi._transform._rotation01*hi._invLocalInertia11+hi._transform._rotation02*hi._invLocalInertia21,gi=hi._transform._rotation00*hi._invLocalInertia02+hi._transform._rotation01*hi._invLocalInertia12+hi._transform._rotation02*hi._invLocalInertia22,Xi=hi._transform._rotation10*hi._invLocalInertia00+hi._transform._rotation11*hi._invLocalInertia10+hi._transform._rotation12*hi._invLocalInertia20,zi=hi._transform._rotation10*hi._invLocalInertia01+hi._transform._rotation11*hi._invLocalInertia11+hi._transform._rotation12*hi._invLocalInertia21,Yi=hi._transform._rotation10*hi._invLocalInertia02+hi._transform._rotation11*hi._invLocalInertia12+hi._transform._rotation12*hi._invLocalInertia22,Zi=hi._transform._rotation20*hi._invLocalInertia00+hi._transform._rotation21*hi._invLocalInertia10+hi._transform._rotation22*hi._invLocalInertia20,Mi=hi._transform._rotation20*hi._invLocalInertia01+hi._transform._rotation21*hi._invLocalInertia11+hi._transform._rotation22*hi._invLocalInertia21,Ii=hi._transform._rotation20*hi._invLocalInertia02+hi._transform._rotation21*hi._invLocalInertia12+hi._transform._rotation22*hi._invLocalInertia22,hi._invInertia00=yi,hi._invInertia01=di,hi._invInertia02=gi,hi._invInertia10=Xi,hi._invInertia11=zi,hi._invInertia12=Yi,hi._invInertia20=Zi,hi._invInertia21=Mi,hi._invInertia22=Ii,Vi=hi._invInertia00*hi._transform._rotation00+hi._invInertia01*hi._transform._rotation01+hi._invInertia02*hi._transform._rotation02,wi=hi._invInertia00*hi._transform._rotation10+hi._invInertia01*hi._transform._rotation11+hi._invInertia02*hi._transform._rotation12,Li=hi._invInertia00*hi._transform._rotation20+hi._invInertia01*hi._transform._rotation21+hi._invInertia02*hi._transform._rotation22,ki=hi._invInertia10*hi._transform._rotation00+hi._invInertia11*hi._transform._rotation01+hi._invInertia12*hi._transform._rotation02,Bi=hi._invInertia10*hi._transform._rotation10+hi._invInertia11*hi._transform._rotation11+hi._invInertia12*hi._transform._rotation12,Ai=hi._invInertia10*hi._transform._rotation20+hi._invInertia11*hi._transform._rotation21+hi._invInertia12*hi._transform._rotation22,Pi=hi._invInertia20*hi._transform._rotation00+hi._invInertia21*hi._transform._rotation01+hi._invInertia22*hi._transform._rotation02,Si=hi._invInertia20*hi._transform._rotation10+hi._invInertia21*hi._transform._rotation11+hi._invInertia22*hi._transform._rotation12,Ti=hi._invInertia20*hi._transform._rotation20+hi._invInertia21*hi._transform._rotation21+hi._invInertia22*hi._transform._rotation22,hi._invInertia00=Vi,hi._invInertia01=wi,hi._invInertia02=Li,hi._invInertia10=ki,hi._invInertia11=Bi,hi._invInertia12=Ai,hi._invInertia20=Pi,hi._invInertia21=Si,hi._invInertia22=Ti,hi._invInertia00*=hi._rotFactor.x,hi._invInertia01*=hi._rotFactor.x,hi._invInertia02*=hi._rotFactor.x,hi._invInertia10*=hi._rotFactor.y,hi._invInertia11*=hi._rotFactor.y,hi._invInertia12*=hi._rotFactor.y,hi._invInertia20*=hi._rotFactor.z,hi._invInertia21*=hi._rotFactor.z,hi._invInertia22*=hi._rotFactor.z}postSolve(){var t,i,a,s,o,n,r,e,_;t=0,i=0,a=0,s=0,o=0,n=0,r=0,e=0,_=0;for(var h=0,l=this.info.numRows;h<l;){var c,m,v,b=h++,x=this.info.rows[b],p=x.impulse,f=x.jacobianN,u=x.jacobianT,y=x.jacobianB,d=p.impulseN,g=p.impulseT,X=p.impulseB;c=0,m=0,v=0,c+=u.lin1X*g,m+=u.lin1Y*g,v+=u.lin1Z*g,c+=y.lin1X*X,m+=y.lin1Y*X,v+=y.lin1Z*X,p.impulseLX=c,p.impulseLY=m,p.impulseLZ=v,t+=f.lin1X*d,i+=f.lin1Y*d,a+=f.lin1Z*d,s+=f.ang1X*d,o+=f.ang1Y*d,n+=f.ang1Z*d,r+=f.ang2X*d,e+=f.ang2Y*d,_+=f.ang2Z*d,t+=u.lin1X*g,i+=u.lin1Y*g,a+=u.lin1Z*g,s+=u.ang1X*g,o+=u.ang1Y*g,n+=u.ang1Z*g,r+=u.ang2X*g,e+=u.ang2Y*g,_+=u.ang2Z*g,t+=y.lin1X*X,i+=y.lin1Y*X,a+=y.lin1Z*X,s+=y.ang1X*X,o+=y.ang1Y*X,n+=y.ang1Z*X,r+=y.ang2X*X,e+=y.ang2Y*X,_+=y.ang2Z*X}this._b1._linearContactImpulseX+=t,this._b1._linearContactImpulseY+=i,this._b1._linearContactImpulseZ+=a,this._b1._angularContactImpulseX+=s,this._b1._angularContactImpulseY+=o,this._b1._angularContactImpulseZ+=n,this._b2._linearContactImpulseX-=t,this._b2._linearContactImpulseY-=i,this._b2._linearContactImpulseZ-=a,this._b2._angularContactImpulseX-=r,this._b2._angularContactImpulseY-=e,this._b2._angularContactImpulseZ-=_,this.constraint._syncManifold()}},pa.dynamics.constraint.solver.pgs.PgsJointConstraintSolver=class extends pa.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.joint=t,this.info=new pa.dynamics.constraint.info.joint.JointSolverInfo;var i=new Array(pa.common.Setting.maxJacobianRows);this.massData=i;for(var a=0,s=this.massData.length;a<s;){var o=a++;this.massData[o]=new pa.dynamics.constraint.solver.common.JointSolverMassDataRow}}preSolveVelocity(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;var i,a,s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y=this._b1._invMass,d=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,s=this._b1._invInertia02,o=this._b1._invInertia10,n=this._b1._invInertia11,r=this._b1._invInertia12,e=this._b1._invInertia20,_=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,v=this._b2._invInertia10,b=this._b2._invInertia11,x=this._b2._invInertia12,p=this._b2._invInertia20,f=this._b2._invInertia21,u=this._b2._invInertia22;for(var g=0,X=this.info.numRows;g<X;){var z,Y,Z,M,I,V,w=g++,L=this.info.rows[w],k=this.massData[w],B=L.jacobian;if(B.updateSparsity(),1&B.flag?(k.invMLin1X=B.lin1X*y,k.invMLin1Y=B.lin1Y*y,k.invMLin1Z=B.lin1Z*y,k.invMLin2X=B.lin2X*d,k.invMLin2Y=B.lin2Y*d,k.invMLin2Z=B.lin2Z*d):(k.invMLin1X=0,k.invMLin1Y=0,k.invMLin1Z=0,k.invMLin2X=0,k.invMLin2Y=0,k.invMLin2Z=0),2&B.flag)z=i*B.ang1X+a*B.ang1Y+s*B.ang1Z,Y=o*B.ang1X+n*B.ang1Y+r*B.ang1Z,Z=e*B.ang1X+_*B.ang1Y+h*B.ang1Z,k.invMAng1X=z,k.invMAng1Y=Y,k.invMAng1Z=Z,M=l*B.ang2X+c*B.ang2Y+m*B.ang2Z,I=v*B.ang2X+b*B.ang2Y+x*B.ang2Z,V=p*B.ang2X+f*B.ang2Y+u*B.ang2Z,k.invMAng2X=M,k.invMAng2Y=I,k.invMAng2Z=V;else k.invMAng1X=0,k.invMAng1Y=0,k.invMAng1Z=0,k.invMAng2X=0,k.invMAng2Y=0,k.invMAng2Z=0;k.massWithoutCfm=k.invMLin1X*B.lin1X+k.invMLin1Y*B.lin1Y+k.invMLin1Z*B.lin1Z+(k.invMLin2X*B.lin2X+k.invMLin2Y*B.lin2Y+k.invMLin2Z*B.lin2Z)+(k.invMAng1X*B.ang1X+k.invMAng1Y*B.ang1Y+k.invMAng1Z*B.ang1Z)+(k.invMAng2X*B.ang2X+k.invMAng2Y*B.ang2Y+k.invMAng2Z*B.ang2Z),k.mass=k.massWithoutCfm+L.cfm,0!=k.massWithoutCfm&&(k.massWithoutCfm=1/k.massWithoutCfm),0!=k.mass&&(k.mass=1/k.mass)}}warmStart(t){var i=this.joint._positionCorrectionAlgorithm==pa.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?pa.common.Setting.jointWarmStartingFactorForBaungarte:pa.common.Setting.jointWarmStartingFactor;if((i*=t.dtRatio)<=0)for(var a=0,s=this.info.numRows;a<s;){var o=a++,n=this.info.rows[o].impulse;n.impulse=0,n.impulseM=0,n.impulseP=0}else{var r,e,_,h,l,c,m,v,b,x,p,f;r=this._b1._velX,e=this._b1._velY,_=this._b1._velZ,h=this._b2._velX,l=this._b2._velY,c=this._b2._velZ,m=this._b1._angVelX,v=this._b1._angVelY,b=this._b1._angVelZ,x=this._b2._angVelX,p=this._b2._angVelY,f=this._b2._angVelZ;for(var u=0,y=this.info.numRows;u<y;){var d=u++,g=this.info.rows[d],X=this.massData[d],z=g.impulse;g.jacobian,z.impulse*=i,z.impulseM*=i;var Y=z.impulse+z.impulseM;r+=X.invMLin1X*Y,e+=X.invMLin1Y*Y,_+=X.invMLin1Z*Y,h+=X.invMLin2X*-Y,l+=X.invMLin2Y*-Y,c+=X.invMLin2Z*-Y,m+=X.invMAng1X*Y,v+=X.invMAng1Y*Y,b+=X.invMAng1Z*Y,x+=X.invMAng2X*-Y,p+=X.invMAng2Y*-Y,f+=X.invMAng2Z*-Y}this._b1._velX=r,this._b1._velY=e,this._b1._velZ=_,this._b2._velX=h,this._b2._velY=l,this._b2._velZ=c,this._b1._angVelX=m,this._b1._angVelY=v,this._b1._angVelZ=b,this._b2._angVelX=x,this._b2._angVelY=p,this._b2._angVelZ=f}}solveVelocity(){var t,i,a,s,o,n,r,e,_,h,l,c;t=this._b1._velX,i=this._b1._velY,a=this._b1._velZ,s=this._b2._velX,o=this._b2._velY,n=this._b2._velZ,r=this._b1._angVelX,e=this._b1._angVelY,_=this._b1._angVelZ,h=this._b2._angVelX,l=this._b2._angVelY,c=this._b2._angVelZ;for(var m=0,v=this.info.numRows;m<v;){var b=m++,x=this.info.rows[b],p=this.massData[b],f=x.impulse,u=x.jacobian;if(0!=x.motorMaxImpulse){var y=0;y+=t*u.lin1X+i*u.lin1Y+a*u.lin1Z,y-=s*u.lin2X+o*u.lin2Y+n*u.lin2Z,y+=r*u.ang1X+e*u.ang1Y+_*u.ang1Z,y-=h*u.ang2X+l*u.ang2Y+c*u.ang2Z;var d=(-x.motorSpeed-y)*p.massWithoutCfm,g=f.impulseM;f.impulseM+=d,f.impulseM<-x.motorMaxImpulse?f.impulseM=-x.motorMaxImpulse:f.impulseM>x.motorMaxImpulse&&(f.impulseM=x.motorMaxImpulse),d=f.impulseM-g,1&u.flag&&(t+=p.invMLin1X*d,i+=p.invMLin1Y*d,a+=p.invMLin1Z*d,s+=p.invMLin2X*-d,o+=p.invMLin2Y*-d,n+=p.invMLin2Z*-d),2&u.flag&&(r+=p.invMAng1X*d,e+=p.invMAng1Y*d,_+=p.invMAng1Z*d,h+=p.invMAng2X*-d,l+=p.invMAng2Y*-d,c+=p.invMAng2Z*-d)}}for(var X=0,z=this.info.numRows;X<z;){var Y=X++,Z=this.info.rows[Y],M=this.massData[Y],I=Z.impulse,V=Z.jacobian,w=0;w+=t*V.lin1X+i*V.lin1Y+a*V.lin1Z,w-=s*V.lin2X+o*V.lin2Y+n*V.lin2Z,w+=r*V.ang1X+e*V.ang1Y+_*V.ang1Z,w-=h*V.ang2X+l*V.ang2Y+c*V.ang2Z;var L=(Z.rhs-w-I.impulse*Z.cfm)*M.mass,k=I.impulse;I.impulse+=L,I.impulse<Z.minImpulse?I.impulse=Z.minImpulse:I.impulse>Z.maxImpulse&&(I.impulse=Z.maxImpulse),L=I.impulse-k,1&V.flag&&(t+=M.invMLin1X*L,i+=M.invMLin1Y*L,a+=M.invMLin1Z*L,s+=M.invMLin2X*-L,o+=M.invMLin2Y*-L,n+=M.invMLin2Z*-L),2&V.flag&&(r+=M.invMAng1X*L,e+=M.invMAng1Y*L,_+=M.invMAng1Z*L,h+=M.invMAng2X*-L,l+=M.invMAng2Y*-L,c+=M.invMAng2Z*-L)}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=a,this._b2._velX=s,this._b2._velY=o,this._b2._velZ=n,this._b1._angVelX=r,this._b1._angVelY=e,this._b1._angVelZ=_,this._b2._angVelX=h,this._b2._angVelY=l,this._b2._angVelZ=c}postSolveVelocity(t){var i,a,s,o,n,r;i=0,a=0,s=0,o=0,n=0,r=0;for(var e=0,_=this.info.numRows;e<_;){var h=e++,l=this.info.rows[h],c=l.impulse,m=l.jacobian;1&m.flag?(i+=m.lin1X*c.impulse,a+=m.lin1Y*c.impulse,s+=m.lin1Z*c.impulse):2&m.flag&&(o+=m.ang1X*c.impulse,n+=m.ang1Y*c.impulse,r+=m.ang1Z*c.impulse)}this.joint._appliedForceX=i*t.invDt,this.joint._appliedForceY=a*t.invDt,this.joint._appliedForceZ=s*t.invDt,this.joint._appliedTorqueX=o*t.invDt,this.joint._appliedTorqueY=n*t.invDt,this.joint._appliedTorqueZ=r*t.invDt}preSolvePosition(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;var i,a,s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y=this._b1._invMass,d=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,s=this._b1._invInertia02,o=this._b1._invInertia10,n=this._b1._invInertia11,r=this._b1._invInertia12,e=this._b1._invInertia20,_=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,v=this._b2._invInertia10,b=this._b2._invInertia11,x=this._b2._invInertia12,p=this._b2._invInertia20,f=this._b2._invInertia21,u=this._b2._invInertia22;for(var g=0,X=this.info.numRows;g<X;){var z=g++,Y=this.info.rows[z],Z=this.massData[z];Y.impulse;var M,I,V,w,L,k,B=Y.jacobian;Z.invMLin1X=B.lin1X*y,Z.invMLin1Y=B.lin1Y*y,Z.invMLin1Z=B.lin1Z*y,Z.invMLin2X=B.lin2X*d,Z.invMLin2Y=B.lin2Y*d,Z.invMLin2Z=B.lin2Z*d,M=i*B.ang1X+a*B.ang1Y+s*B.ang1Z,I=o*B.ang1X+n*B.ang1Y+r*B.ang1Z,V=e*B.ang1X+_*B.ang1Y+h*B.ang1Z,Z.invMAng1X=M,Z.invMAng1Y=I,Z.invMAng1Z=V,w=l*B.ang2X+c*B.ang2Y+m*B.ang2Z,L=v*B.ang2X+b*B.ang2Y+x*B.ang2Z,k=p*B.ang2X+f*B.ang2Y+u*B.ang2Z,Z.invMAng2X=w,Z.invMAng2Y=L,Z.invMAng2Z=k,Z.mass=Z.invMLin1X*B.lin1X+Z.invMLin1Y*B.lin1Y+Z.invMLin1Z*B.lin1Z+(Z.invMLin2X*B.lin2X+Z.invMLin2Y*B.lin2Y+Z.invMLin2Z*B.lin2Z)+(Z.invMAng1X*B.ang1X+Z.invMAng1Y*B.ang1Y+Z.invMAng1Z*B.ang1Z)+(Z.invMAng2X*B.ang2X+Z.invMAng2Y*B.ang2Y+Z.invMAng2Z*B.ang2Z),0!=Z.mass&&(Z.mass=1/Z.mass)}for(var A=0,P=this.info.numRows;A<P;){var S=A++;this.info.rows[S].impulse.impulseP=0}}solvePositionSplitImpulse(){var t,i,a,s,o,n,r,e,_,h,l,c;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,a=this._b1._pseudoVelZ,s=this._b2._pseudoVelX,o=this._b2._pseudoVelY,n=this._b2._pseudoVelZ,r=this._b1._angPseudoVelX,e=this._b1._angPseudoVelY,_=this._b1._angPseudoVelZ,h=this._b2._angPseudoVelX,l=this._b2._angPseudoVelY,c=this._b2._angPseudoVelZ;for(var m=0,v=this.info.numRows;m<v;){var b=m++,x=this.info.rows[b],p=this.massData[b],f=x.impulse,u=x.jacobian,y=0;y+=t*u.lin1X+i*u.lin1Y+a*u.lin1Z,y-=s*u.lin2X+o*u.lin2Y+n*u.lin2Z,y+=r*u.ang1X+e*u.ang1Y+_*u.ang1Z,y-=h*u.ang2X+l*u.ang2Y+c*u.ang2Z;var d=(x.rhs*pa.common.Setting.positionSplitImpulseBaumgarte-y)*p.mass,g=f.impulseP;f.impulseP+=d,f.impulseP<x.minImpulse?f.impulseP=x.minImpulse:f.impulseP>x.maxImpulse&&(f.impulseP=x.maxImpulse),d=f.impulseP-g,t+=p.invMLin1X*d,i+=p.invMLin1Y*d,a+=p.invMLin1Z*d,s+=p.invMLin2X*-d,o+=p.invMLin2Y*-d,n+=p.invMLin2Z*-d,r+=p.invMAng1X*d,e+=p.invMAng1Y*d,_+=p.invMAng1Z*d,h+=p.invMAng2X*-d,l+=p.invMAng2Y*-d,c+=p.invMAng2Z*-d}this._b1._pseudoVelX=t,this._b1._pseudoVelY=i,this._b1._pseudoVelZ=a,this._b2._pseudoVelX=s,this._b2._pseudoVelY=o,this._b2._pseudoVelZ=n,this._b1._angPseudoVelX=r,this._b1._angPseudoVelY=e,this._b1._angPseudoVelZ=_,this._b2._angPseudoVelX=h,this._b2._angPseudoVelY=l,this._b2._angPseudoVelZ=c}solvePositionNgs(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;var i,a,s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y=this._b1._invMass,d=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,s=this._b1._invInertia02,o=this._b1._invInertia10,n=this._b1._invInertia11,r=this._b1._invInertia12,e=this._b1._invInertia20,_=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,v=this._b2._invInertia10,b=this._b2._invInertia11,x=this._b2._invInertia12,p=this._b2._invInertia20,f=this._b2._invInertia21,u=this._b2._invInertia22;for(var g,X,z,Y,Z,M,I,V,w,L,k,B,A=0,P=this.info.numRows;A<P;){var S=A++,T=this.info.rows[S],C=this.massData[S];T.impulse;var j,R,E,q,N,F,D=T.jacobian;C.invMLin1X=D.lin1X*y,C.invMLin1Y=D.lin1Y*y,C.invMLin1Z=D.lin1Z*y,C.invMLin2X=D.lin2X*d,C.invMLin2Y=D.lin2Y*d,C.invMLin2Z=D.lin2Z*d,j=i*D.ang1X+a*D.ang1Y+s*D.ang1Z,R=o*D.ang1X+n*D.ang1Y+r*D.ang1Z,E=e*D.ang1X+_*D.ang1Y+h*D.ang1Z,C.invMAng1X=j,C.invMAng1Y=R,C.invMAng1Z=E,q=l*D.ang2X+c*D.ang2Y+m*D.ang2Z,N=v*D.ang2X+b*D.ang2Y+x*D.ang2Z,F=p*D.ang2X+f*D.ang2Y+u*D.ang2Z,C.invMAng2X=q,C.invMAng2Y=N,C.invMAng2Z=F,C.mass=C.invMLin1X*D.lin1X+C.invMLin1Y*D.lin1Y+C.invMLin1Z*D.lin1Z+(C.invMLin2X*D.lin2X+C.invMLin2Y*D.lin2Y+C.invMLin2Z*D.lin2Z)+(C.invMAng1X*D.ang1X+C.invMAng1Y*D.ang1Y+C.invMAng1Z*D.ang1Z)+(C.invMAng2X*D.ang2X+C.invMAng2Y*D.ang2Y+C.invMAng2Z*D.ang2Z),0!=C.mass&&(C.mass=1/C.mass)}g=0,X=0,z=0,Y=0,Z=0,M=0,I=0,V=0,w=0,L=0,k=0,B=0;for(var G=0,W=this.info.numRows;G<W;){var J=G++,U=this.info.rows[J],O=this.massData[J],H=U.impulse,Q=U.jacobian,K=0;K+=g*Q.lin1X+X*Q.lin1Y+z*Q.lin1Z,K-=Y*Q.lin2X+Z*Q.lin2Y+M*Q.lin2Z,K+=I*Q.ang1X+V*Q.ang1Y+w*Q.ang1Z,K-=L*Q.ang2X+k*Q.ang2Y+B*Q.ang2Z;var $=(U.rhs*pa.common.Setting.positionNgsBaumgarte-K)*O.mass,tt=H.impulseP;H.impulseP+=$,H.impulseP<U.minImpulse?H.impulseP=U.minImpulse:H.impulseP>U.maxImpulse&&(H.impulseP=U.maxImpulse),$=H.impulseP-tt,g+=O.invMLin1X*$,X+=O.invMLin1Y*$,z+=O.invMLin1Z*$,Y+=O.invMLin2X*-$,Z+=O.invMLin2Y*-$,M+=O.invMLin2Z*-$,I+=O.invMAng1X*$,V+=O.invMAng1Y*$,w+=O.invMAng1Z*$,L+=O.invMAng2X*-$,k+=O.invMAng2Y*-$,B+=O.invMAng2Z*-$}var it=this._b1;it._transform._positionX+=g,it._transform._positionY+=X,it._transform._positionZ+=z;var at=this._b2;at._transform._positionX+=Y,at._transform._positionY+=Z,at._transform._positionZ+=M;var st,ot,nt,rt,et,_t,ht,lt,ct,mt,vt=this._b1,bt=Math.sqrt(I*I+V*V+w*w),xt=.5*bt;if(xt<.5){var pt=xt*xt;st=.5*(1-.16666666666666666*pt+pt*pt*.008333333333333333),ot=1-.5*pt+pt*pt*.041666666666666664}else st=Math.sin(xt)/bt,ot=Math.cos(xt);nt=I*st,rt=V*st,et=w*st,_t=ot;var ft,ut=vt._transform._rotation00,yt=vt._transform._rotation11,dt=vt._transform._rotation22,gt=ut+yt+dt;gt>0?(mt=.5*(ft=Math.sqrt(gt+1)),ft=.5/ft,ht=(vt._transform._rotation21-vt._transform._rotation12)*ft,lt=(vt._transform._rotation02-vt._transform._rotation20)*ft,ct=(vt._transform._rotation10-vt._transform._rotation01)*ft):ut>yt?ut>dt?(ht=.5*(ft=Math.sqrt(ut-yt-dt+1)),ft=.5/ft,lt=(vt._transform._rotation01+vt._transform._rotation10)*ft,ct=(vt._transform._rotation02+vt._transform._rotation20)*ft,mt=(vt._transform._rotation21-vt._transform._rotation12)*ft):(ct=.5*(ft=Math.sqrt(dt-ut-yt+1)),ft=.5/ft,ht=(vt._transform._rotation02+vt._transform._rotation20)*ft,lt=(vt._transform._rotation12+vt._transform._rotation21)*ft,mt=(vt._transform._rotation10-vt._transform._rotation01)*ft):yt>dt?(lt=.5*(ft=Math.sqrt(yt-dt-ut+1)),ft=.5/ft,ht=(vt._transform._rotation01+vt._transform._rotation10)*ft,ct=(vt._transform._rotation12+vt._transform._rotation21)*ft,mt=(vt._transform._rotation02-vt._transform._rotation20)*ft):(ct=.5*(ft=Math.sqrt(dt-ut-yt+1)),ft=.5/ft,ht=(vt._transform._rotation02+vt._transform._rotation20)*ft,lt=(vt._transform._rotation12+vt._transform._rotation21)*ft,mt=(vt._transform._rotation10-vt._transform._rotation01)*ft);var Xt=(ht=_t*ht+nt*mt+rt*ct-et*lt)*ht+(lt=_t*lt-nt*ct+rt*mt+et*ht)*lt+(ct=_t*ct+nt*lt-rt*ht+et*mt)*ct+(mt=_t*mt-nt*ht-rt*lt-et*ct)*mt;Xt>1e-32&&(Xt=1/Math.sqrt(Xt));ht*=Xt,lt*=Xt,ct*=Xt,mt*=Xt;var zt,Yt,Zt,Mt,It,Vt,wt,Lt,kt,Bt,At,Pt,St,Tt,Ct,jt,Rt,Et,qt=2*ht,Nt=2*lt,Ft=2*ct,Dt=ht*qt,Gt=lt*Nt,Wt=ct*Ft,Jt=ht*Nt,Ut=lt*Ft,Ot=ht*Ft,Ht=mt*qt,Qt=mt*Nt,Kt=mt*Ft;vt._transform._rotation00=1-Gt-Wt,vt._transform._rotation01=Jt-Kt,vt._transform._rotation02=Ot+Qt,vt._transform._rotation10=Jt+Kt,vt._transform._rotation11=1-Dt-Wt,vt._transform._rotation12=Ut-Ht,vt._transform._rotation20=Ot-Qt,vt._transform._rotation21=Ut+Ht,vt._transform._rotation22=1-Dt-Gt,zt=vt._transform._rotation00*vt._invLocalInertia00+vt._transform._rotation01*vt._invLocalInertia10+vt._transform._rotation02*vt._invLocalInertia20,Yt=vt._transform._rotation00*vt._invLocalInertia01+vt._transform._rotation01*vt._invLocalInertia11+vt._transform._rotation02*vt._invLocalInertia21,Zt=vt._transform._rotation00*vt._invLocalInertia02+vt._transform._rotation01*vt._invLocalInertia12+vt._transform._rotation02*vt._invLocalInertia22,Mt=vt._transform._rotation10*vt._invLocalInertia00+vt._transform._rotation11*vt._invLocalInertia10+vt._transform._rotation12*vt._invLocalInertia20,It=vt._transform._rotation10*vt._invLocalInertia01+vt._transform._rotation11*vt._invLocalInertia11+vt._transform._rotation12*vt._invLocalInertia21,Vt=vt._transform._rotation10*vt._invLocalInertia02+vt._transform._rotation11*vt._invLocalInertia12+vt._transform._rotation12*vt._invLocalInertia22,wt=vt._transform._rotation20*vt._invLocalInertia00+vt._transform._rotation21*vt._invLocalInertia10+vt._transform._rotation22*vt._invLocalInertia20,Lt=vt._transform._rotation20*vt._invLocalInertia01+vt._transform._rotation21*vt._invLocalInertia11+vt._transform._rotation22*vt._invLocalInertia21,kt=vt._transform._rotation20*vt._invLocalInertia02+vt._transform._rotation21*vt._invLocalInertia12+vt._transform._rotation22*vt._invLocalInertia22,vt._invInertia00=zt,vt._invInertia01=Yt,vt._invInertia02=Zt,vt._invInertia10=Mt,vt._invInertia11=It,vt._invInertia12=Vt,vt._invInertia20=wt,vt._invInertia21=Lt,vt._invInertia22=kt,Bt=vt._invInertia00*vt._transform._rotation00+vt._invInertia01*vt._transform._rotation01+vt._invInertia02*vt._transform._rotation02,At=vt._invInertia00*vt._transform._rotation10+vt._invInertia01*vt._transform._rotation11+vt._invInertia02*vt._transform._rotation12,Pt=vt._invInertia00*vt._transform._rotation20+vt._invInertia01*vt._transform._rotation21+vt._invInertia02*vt._transform._rotation22,St=vt._invInertia10*vt._transform._rotation00+vt._invInertia11*vt._transform._rotation01+vt._invInertia12*vt._transform._rotation02,Tt=vt._invInertia10*vt._transform._rotation10+vt._invInertia11*vt._transform._rotation11+vt._invInertia12*vt._transform._rotation12,Ct=vt._invInertia10*vt._transform._rotation20+vt._invInertia11*vt._transform._rotation21+vt._invInertia12*vt._transform._rotation22,jt=vt._invInertia20*vt._transform._rotation00+vt._invInertia21*vt._transform._rotation01+vt._invInertia22*vt._transform._rotation02,Rt=vt._invInertia20*vt._transform._rotation10+vt._invInertia21*vt._transform._rotation11+vt._invInertia22*vt._transform._rotation12,Et=vt._invInertia20*vt._transform._rotation20+vt._invInertia21*vt._transform._rotation21+vt._invInertia22*vt._transform._rotation22,vt._invInertia00=Bt,vt._invInertia01=At,vt._invInertia02=Pt,vt._invInertia10=St,vt._invInertia11=Tt,vt._invInertia12=Ct,vt._invInertia20=jt,vt._invInertia21=Rt,vt._invInertia22=Et,vt._invInertia00*=vt._rotFactor.x,vt._invInertia01*=vt._rotFactor.x,vt._invInertia02*=vt._rotFactor.x,vt._invInertia10*=vt._rotFactor.y,vt._invInertia11*=vt._rotFactor.y,vt._invInertia12*=vt._rotFactor.y,vt._invInertia20*=vt._rotFactor.z,vt._invInertia21*=vt._rotFactor.z,vt._invInertia22*=vt._rotFactor.z;var $t,ti,ii,ai,si,oi,ni,ri,ei,_i,hi=this._b2,li=Math.sqrt(L*L+k*k+B*B),ci=.5*li;if(ci<.5){var mi=ci*ci;$t=.5*(1-.16666666666666666*mi+mi*mi*.008333333333333333),ti=1-.5*mi+mi*mi*.041666666666666664}else $t=Math.sin(ci)/li,ti=Math.cos(ci);ii=L*$t,ai=k*$t,si=B*$t,oi=ti;var vi,bi=hi._transform._rotation00,xi=hi._transform._rotation11,pi=hi._transform._rotation22,fi=bi+xi+pi;fi>0?(_i=.5*(vi=Math.sqrt(fi+1)),vi=.5/vi,ni=(hi._transform._rotation21-hi._transform._rotation12)*vi,ri=(hi._transform._rotation02-hi._transform._rotation20)*vi,ei=(hi._transform._rotation10-hi._transform._rotation01)*vi):bi>xi?bi>pi?(ni=.5*(vi=Math.sqrt(bi-xi-pi+1)),vi=.5/vi,ri=(hi._transform._rotation01+hi._transform._rotation10)*vi,ei=(hi._transform._rotation02+hi._transform._rotation20)*vi,_i=(hi._transform._rotation21-hi._transform._rotation12)*vi):(ei=.5*(vi=Math.sqrt(pi-bi-xi+1)),vi=.5/vi,ni=(hi._transform._rotation02+hi._transform._rotation20)*vi,ri=(hi._transform._rotation12+hi._transform._rotation21)*vi,_i=(hi._transform._rotation10-hi._transform._rotation01)*vi):xi>pi?(ri=.5*(vi=Math.sqrt(xi-pi-bi+1)),vi=.5/vi,ni=(hi._transform._rotation01+hi._transform._rotation10)*vi,ei=(hi._transform._rotation12+hi._transform._rotation21)*vi,_i=(hi._transform._rotation02-hi._transform._rotation20)*vi):(ei=.5*(vi=Math.sqrt(pi-bi-xi+1)),vi=.5/vi,ni=(hi._transform._rotation02+hi._transform._rotation20)*vi,ri=(hi._transform._rotation12+hi._transform._rotation21)*vi,_i=(hi._transform._rotation10-hi._transform._rotation01)*vi);var ui=(ni=oi*ni+ii*_i+ai*ei-si*ri)*ni+(ri=oi*ri-ii*ei+ai*_i+si*ni)*ri+(ei=oi*ei+ii*ri-ai*ni+si*_i)*ei+(_i=oi*_i-ii*ni-ai*ri-si*ei)*_i;ui>1e-32&&(ui=1/Math.sqrt(ui));ni*=ui,ri*=ui,ei*=ui,_i*=ui;var yi,di,gi,Xi,zi,Yi,Zi,Mi,Ii,Vi,wi,Li,ki,Bi,Ai,Pi,Si,Ti,Ci=2*ni,ji=2*ri,Ri=2*ei,Ei=ni*Ci,qi=ri*ji,Ni=ei*Ri,Fi=ni*ji,Di=ri*Ri,Gi=ni*Ri,Wi=_i*Ci,Ji=_i*ji,Ui=_i*Ri;hi._transform._rotation00=1-qi-Ni,hi._transform._rotation01=Fi-Ui,hi._transform._rotation02=Gi+Ji,hi._transform._rotation10=Fi+Ui,hi._transform._rotation11=1-Ei-Ni,hi._transform._rotation12=Di-Wi,hi._transform._rotation20=Gi-Ji,hi._transform._rotation21=Di+Wi,hi._transform._rotation22=1-Ei-qi,yi=hi._transform._rotation00*hi._invLocalInertia00+hi._transform._rotation01*hi._invLocalInertia10+hi._transform._rotation02*hi._invLocalInertia20,di=hi._transform._rotation00*hi._invLocalInertia01+hi._transform._rotation01*hi._invLocalInertia11+hi._transform._rotation02*hi._invLocalInertia21,gi=hi._transform._rotation00*hi._invLocalInertia02+hi._transform._rotation01*hi._invLocalInertia12+hi._transform._rotation02*hi._invLocalInertia22,Xi=hi._transform._rotation10*hi._invLocalInertia00+hi._transform._rotation11*hi._invLocalInertia10+hi._transform._rotation12*hi._invLocalInertia20,zi=hi._transform._rotation10*hi._invLocalInertia01+hi._transform._rotation11*hi._invLocalInertia11+hi._transform._rotation12*hi._invLocalInertia21,Yi=hi._transform._rotation10*hi._invLocalInertia02+hi._transform._rotation11*hi._invLocalInertia12+hi._transform._rotation12*hi._invLocalInertia22,Zi=hi._transform._rotation20*hi._invLocalInertia00+hi._transform._rotation21*hi._invLocalInertia10+hi._transform._rotation22*hi._invLocalInertia20,Mi=hi._transform._rotation20*hi._invLocalInertia01+hi._transform._rotation21*hi._invLocalInertia11+hi._transform._rotation22*hi._invLocalInertia21,Ii=hi._transform._rotation20*hi._invLocalInertia02+hi._transform._rotation21*hi._invLocalInertia12+hi._transform._rotation22*hi._invLocalInertia22,hi._invInertia00=yi,hi._invInertia01=di,hi._invInertia02=gi,hi._invInertia10=Xi,hi._invInertia11=zi,hi._invInertia12=Yi,hi._invInertia20=Zi,hi._invInertia21=Mi,hi._invInertia22=Ii,Vi=hi._invInertia00*hi._transform._rotation00+hi._invInertia01*hi._transform._rotation01+hi._invInertia02*hi._transform._rotation02,wi=hi._invInertia00*hi._transform._rotation10+hi._invInertia01*hi._transform._rotation11+hi._invInertia02*hi._transform._rotation12,Li=hi._invInertia00*hi._transform._rotation20+hi._invInertia01*hi._transform._rotation21+hi._invInertia02*hi._transform._rotation22,ki=hi._invInertia10*hi._transform._rotation00+hi._invInertia11*hi._transform._rotation01+hi._invInertia12*hi._transform._rotation02,Bi=hi._invInertia10*hi._transform._rotation10+hi._invInertia11*hi._transform._rotation11+hi._invInertia12*hi._transform._rotation12,Ai=hi._invInertia10*hi._transform._rotation20+hi._invInertia11*hi._transform._rotation21+hi._invInertia12*hi._transform._rotation22,Pi=hi._invInertia20*hi._transform._rotation00+hi._invInertia21*hi._transform._rotation01+hi._invInertia22*hi._transform._rotation02,Si=hi._invInertia20*hi._transform._rotation10+hi._invInertia21*hi._transform._rotation11+hi._invInertia22*hi._transform._rotation12,Ti=hi._invInertia20*hi._transform._rotation20+hi._invInertia21*hi._transform._rotation21+hi._invInertia22*hi._transform._rotation22,hi._invInertia00=Vi,hi._invInertia01=wi,hi._invInertia02=Li,hi._invInertia10=ki,hi._invInertia11=Bi,hi._invInertia12=Ai,hi._invInertia20=Pi,hi._invInertia21=Si,hi._invInertia22=Ti,hi._invInertia00*=hi._rotFactor.x,hi._invInertia01*=hi._rotFactor.x,hi._invInertia02*=hi._rotFactor.x,hi._invInertia10*=hi._rotFactor.y,hi._invInertia11*=hi._rotFactor.y,hi._invInertia12*=hi._rotFactor.y,hi._invInertia20*=hi._rotFactor.z,hi._invInertia21*=hi._rotFactor.z,hi._invInertia22*=hi._rotFactor.z}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}},pa.dynamics.rigidbody||(pa.dynamics.rigidbody={}),pa.dynamics.rigidbody.MassData=class{constructor(){this.mass=0,this.localInertia=new pa.common.Mat3}},pa.dynamics.rigidbody.RigidBody=class{constructor(t){this._next=null,this._prev=null,this._shapeList=null,this._shapeListLast=null,this._numShapes=0,this._contactLinkList=null,this._contactLinkListLast=null,this._numContactLinks=0,this._jointLinkList=null,this._jointLinkListLast=null,this._numJointLinks=0;var i=t.linearVelocity;this._velX=i.x,this._velY=i.y,this._velZ=i.z;var a=t.angularVelocity;this._angVelX=a.x,this._angVelY=a.y,this._angVelZ=a.z,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._ptransform=new pa.common.Transform,this._transform=new pa.common.Transform;var s=t.position;this._ptransform._positionX=s.x,this._ptransform._positionY=s.y,this._ptransform._positionZ=s.z;var o=t.rotation;this._ptransform._rotation00=o.e00,this._ptransform._rotation01=o.e01,this._ptransform._rotation02=o.e02,this._ptransform._rotation10=o.e10,this._ptransform._rotation11=o.e11,this._ptransform._rotation12=o.e12,this._ptransform._rotation20=o.e20,this._ptransform._rotation21=o.e21,this._ptransform._rotation22=o.e22;var n=this._transform,r=this._ptransform;n._positionX=r._positionX,n._positionY=r._positionY,n._positionZ=r._positionZ,n._rotation00=r._rotation00,n._rotation01=r._rotation01,n._rotation02=r._rotation02,n._rotation10=r._rotation10,n._rotation11=r._rotation11,n._rotation12=r._rotation12,n._rotation20=r._rotation20,n._rotation21=r._rotation21,n._rotation22=r._rotation22,this._type=t.type,this._sleepTime=0,this._sleeping=!1,this._autoSleep=t.autoSleep,this._mass=0,this._invMass=0,this._localInertia00=0,this._localInertia01=0,this._localInertia02=0,this._localInertia10=0,this._localInertia11=0,this._localInertia12=0,this._localInertia20=0,this._localInertia21=0,this._localInertia22=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._invInertia00=0,this._invInertia01=0,this._invInertia02=0,this._invInertia10=0,this._invInertia11=0,this._invInertia12=0,this._invInertia20=0,this._invInertia21=0,this._invInertia22=0,this._linearDamping=t.linearDamping,this._angularDamping=t.angularDamping,this._forceX=0,this._forceY=0,this._forceZ=0,this._torqueX=0,this._torqueY=0,this._torqueZ=0,this._linearContactImpulseX=0,this._linearContactImpulseY=0,this._linearContactImpulseZ=0,this._angularContactImpulseX=0,this._angularContactImpulseY=0,this._angularContactImpulseZ=0,this._rotFactor=new pa.common.Vec3(1,1,1),this._addedToIsland=!1,this._gravityScale=1,this._world=null}_integrate(t){switch(this._type){case 1:this._velX=0,this._velY=0,this._velZ=0,this._angVelX=0,this._angVelY=0,this._angVelZ=0,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:var i,a,s,o,n,r,e=(i=this._velX*t)*i+(a=this._velY*t)*a+(s=this._velZ*t)*s,_=(o=this._angVelX*t)*o+(n=this._angVelY*t)*n+(r=this._angVelZ*t)*r;if(0==e&&0==_)return;if(e>pa.common.Setting.maxTranslationPerStep*pa.common.Setting.maxTranslationPerStep){var h=pa.common.Setting.maxTranslationPerStep/Math.sqrt(e);this._velX*=h,this._velY*=h,this._velZ*=h,i*=h,a*=h,s*=h}if(_>pa.common.Setting.maxRotationPerStep*pa.common.Setting.maxRotationPerStep){var l=pa.common.Setting.maxRotationPerStep/Math.sqrt(_);this._angVelX*=l,this._angVelY*=l,this._angVelZ*=l,o*=l,n*=l,r*=l}this._transform._positionX+=i,this._transform._positionY+=a,this._transform._positionZ+=s;var c,m,v,b,x,p,f,u,y,d,g=Math.sqrt(o*o+n*n+r*r),X=.5*g;if(X<.5){var z=X*X;c=.5*(1-.16666666666666666*z+z*z*.008333333333333333),m=1-.5*z+z*z*.041666666666666664}else c=Math.sin(X)/g,m=Math.cos(X);v=o*c,b=n*c,x=r*c,p=m;var Y,Z=this._transform._rotation00,M=this._transform._rotation11,I=this._transform._rotation22,V=Z+M+I;V>0?(d=.5*(Y=Math.sqrt(V+1)),Y=.5/Y,f=(this._transform._rotation21-this._transform._rotation12)*Y,u=(this._transform._rotation02-this._transform._rotation20)*Y,y=(this._transform._rotation10-this._transform._rotation01)*Y):Z>M?Z>I?(f=.5*(Y=Math.sqrt(Z-M-I+1)),Y=.5/Y,u=(this._transform._rotation01+this._transform._rotation10)*Y,y=(this._transform._rotation02+this._transform._rotation20)*Y,d=(this._transform._rotation21-this._transform._rotation12)*Y):(y=.5*(Y=Math.sqrt(I-Z-M+1)),Y=.5/Y,f=(this._transform._rotation02+this._transform._rotation20)*Y,u=(this._transform._rotation12+this._transform._rotation21)*Y,d=(this._transform._rotation10-this._transform._rotation01)*Y):M>I?(u=.5*(Y=Math.sqrt(M-I-Z+1)),Y=.5/Y,f=(this._transform._rotation01+this._transform._rotation10)*Y,y=(this._transform._rotation12+this._transform._rotation21)*Y,d=(this._transform._rotation02-this._transform._rotation20)*Y):(y=.5*(Y=Math.sqrt(I-Z-M+1)),Y=.5/Y,f=(this._transform._rotation02+this._transform._rotation20)*Y,u=(this._transform._rotation12+this._transform._rotation21)*Y,d=(this._transform._rotation10-this._transform._rotation01)*Y);var w=(f=p*f+v*d+b*y-x*u)*f+(u=p*u-v*y+b*d+x*f)*u+(y=p*y+v*u-b*f+x*d)*y+(d=p*d-v*f-b*u-x*y)*d;w>1e-32&&(w=1/Math.sqrt(w));f*=w,u*=w,y*=w,d*=w;var L,k,B,A,P,S,T,C,j,R,E,q,N,F,D,G,W,J,U=2*f,O=2*u,H=2*y,Q=f*U,K=u*O,$=y*H,tt=f*O,it=u*H,at=f*H,st=d*U,ot=d*O,nt=d*H;this._transform._rotation00=1-K-$,this._transform._rotation01=tt-nt,this._transform._rotation02=at+ot,this._transform._rotation10=tt+nt,this._transform._rotation11=1-Q-$,this._transform._rotation12=it-st,this._transform._rotation20=at-ot,this._transform._rotation21=it+st,this._transform._rotation22=1-Q-K,L=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,k=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,B=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,A=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,P=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,S=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,T=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,C=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,j=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=L,this._invInertia01=k,this._invInertia02=B,this._invInertia10=A,this._invInertia11=P,this._invInertia12=S,this._invInertia20=T,this._invInertia21=C,this._invInertia22=j,R=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,E=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,q=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,N=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,F=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,D=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,G=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,W=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,J=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=R,this._invInertia01=E,this._invInertia02=q,this._invInertia10=N,this._invInertia11=F,this._invInertia12=D,this._invInertia20=G,this._invInertia21=W,this._invInertia22=J,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z}}_integratePseudoVelocity(){var t=this._pseudoVelX*this._pseudoVelX+this._pseudoVelY*this._pseudoVelY+this._pseudoVelZ*this._pseudoVelZ,i=this._angPseudoVelX*this._angPseudoVelX+this._angPseudoVelY*this._angPseudoVelY+this._angPseudoVelZ*this._angPseudoVelZ;if(0!=t||0!=i)switch(this._type){case 1:this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:var a,s,o,n,r,e;a=this._pseudoVelX,s=this._pseudoVelY,o=this._pseudoVelZ,n=this._angPseudoVelX,r=this._angPseudoVelY,e=this._angPseudoVelZ,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._transform._positionX+=a,this._transform._positionY+=s,this._transform._positionZ+=o;var _,h,l,c,m,v,b,x,p,f,u=Math.sqrt(n*n+r*r+e*e),y=.5*u;if(y<.5){var d=y*y;_=.5*(1-.16666666666666666*d+d*d*.008333333333333333),h=1-.5*d+d*d*.041666666666666664}else _=Math.sin(y)/u,h=Math.cos(y);l=n*_,c=r*_,m=e*_,v=h;var g,X=this._transform._rotation00,z=this._transform._rotation11,Y=this._transform._rotation22,Z=X+z+Y;Z>0?(f=.5*(g=Math.sqrt(Z+1)),g=.5/g,b=(this._transform._rotation21-this._transform._rotation12)*g,x=(this._transform._rotation02-this._transform._rotation20)*g,p=(this._transform._rotation10-this._transform._rotation01)*g):X>z?X>Y?(b=.5*(g=Math.sqrt(X-z-Y+1)),g=.5/g,x=(this._transform._rotation01+this._transform._rotation10)*g,p=(this._transform._rotation02+this._transform._rotation20)*g,f=(this._transform._rotation21-this._transform._rotation12)*g):(p=.5*(g=Math.sqrt(Y-X-z+1)),g=.5/g,b=(this._transform._rotation02+this._transform._rotation20)*g,x=(this._transform._rotation12+this._transform._rotation21)*g,f=(this._transform._rotation10-this._transform._rotation01)*g):z>Y?(x=.5*(g=Math.sqrt(z-Y-X+1)),g=.5/g,b=(this._transform._rotation01+this._transform._rotation10)*g,p=(this._transform._rotation12+this._transform._rotation21)*g,f=(this._transform._rotation02-this._transform._rotation20)*g):(p=.5*(g=Math.sqrt(Y-X-z+1)),g=.5/g,b=(this._transform._rotation02+this._transform._rotation20)*g,x=(this._transform._rotation12+this._transform._rotation21)*g,f=(this._transform._rotation10-this._transform._rotation01)*g);var M=(b=v*b+l*f+c*p-m*x)*b+(x=v*x-l*p+c*f+m*b)*x+(p=v*p+l*x-c*b+m*f)*p+(f=v*f-l*b-c*x-m*p)*f;M>1e-32&&(M=1/Math.sqrt(M));b*=M,x*=M,p*=M,f*=M;var I,V,w,L,k,B,A,P,S,T,C,j,R,E,q,N,F,D,G=2*b,W=2*x,J=2*p,U=b*G,O=x*W,H=p*J,Q=b*W,K=x*J,$=b*J,tt=f*G,it=f*W,at=f*J;this._transform._rotation00=1-O-H,this._transform._rotation01=Q-at,this._transform._rotation02=$+it,this._transform._rotation10=Q+at,this._transform._rotation11=1-U-H,this._transform._rotation12=K-tt,this._transform._rotation20=$-it,this._transform._rotation21=K+tt,this._transform._rotation22=1-U-O,I=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,V=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,w=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,L=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,k=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,B=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,A=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,P=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,S=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=I,this._invInertia01=V,this._invInertia02=w,this._invInertia10=L,this._invInertia11=k,this._invInertia12=B,this._invInertia20=A,this._invInertia21=P,this._invInertia22=S,T=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,C=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,j=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,R=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,E=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,q=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,N=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,F=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,D=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=T,this._invInertia01=C,this._invInertia02=j,this._invInertia10=R,this._invInertia11=E,this._invInertia12=q,this._invInertia20=N,this._invInertia21=F,this._invInertia22=D,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z}}updateMass(){var t,i,a,s,o,n,r,e,_;t=0,i=0,a=0,s=0,o=0,n=0,r=0,e=0,_=0;for(var h=0,l=this._shapeList;null!=l;){var c=l._next,m=l._geom;m._updateMass();var v,b,x,p,f,u,y,d,g,X,z,Y,Z,M,I,V,w,L,k,B=l._density*m._volume;X=l._localTransform._rotation00*m._inertiaCoeff00+l._localTransform._rotation01*m._inertiaCoeff10+l._localTransform._rotation02*m._inertiaCoeff20,b=l._localTransform._rotation00*m._inertiaCoeff01+l._localTransform._rotation01*m._inertiaCoeff11+l._localTransform._rotation02*m._inertiaCoeff21,x=l._localTransform._rotation00*m._inertiaCoeff02+l._localTransform._rotation01*m._inertiaCoeff12+l._localTransform._rotation02*m._inertiaCoeff22,p=l._localTransform._rotation10*m._inertiaCoeff00+l._localTransform._rotation11*m._inertiaCoeff10+l._localTransform._rotation12*m._inertiaCoeff20,f=l._localTransform._rotation10*m._inertiaCoeff01+l._localTransform._rotation11*m._inertiaCoeff11+l._localTransform._rotation12*m._inertiaCoeff21,u=l._localTransform._rotation10*m._inertiaCoeff02+l._localTransform._rotation11*m._inertiaCoeff12+l._localTransform._rotation12*m._inertiaCoeff22,y=l._localTransform._rotation20*m._inertiaCoeff00+l._localTransform._rotation21*m._inertiaCoeff10+l._localTransform._rotation22*m._inertiaCoeff20,d=l._localTransform._rotation20*m._inertiaCoeff01+l._localTransform._rotation21*m._inertiaCoeff11+l._localTransform._rotation22*m._inertiaCoeff21,g=l._localTransform._rotation20*m._inertiaCoeff02+l._localTransform._rotation21*m._inertiaCoeff12+l._localTransform._rotation22*m._inertiaCoeff22,z=(v=X)*l._localTransform._rotation00+b*l._localTransform._rotation01+x*l._localTransform._rotation02,Y=v*l._localTransform._rotation10+b*l._localTransform._rotation11+x*l._localTransform._rotation12,Z=v*l._localTransform._rotation20+b*l._localTransform._rotation21+x*l._localTransform._rotation22,M=p*l._localTransform._rotation00+f*l._localTransform._rotation01+u*l._localTransform._rotation02,I=p*l._localTransform._rotation10+f*l._localTransform._rotation11+u*l._localTransform._rotation12,V=p*l._localTransform._rotation20+f*l._localTransform._rotation21+u*l._localTransform._rotation22,w=y*l._localTransform._rotation00+d*l._localTransform._rotation01+g*l._localTransform._rotation02,L=y*l._localTransform._rotation10+d*l._localTransform._rotation11+g*l._localTransform._rotation12,k=y*l._localTransform._rotation20+d*l._localTransform._rotation21+g*l._localTransform._rotation22,v=z,b=Y,x=Z,p=M,f=I,u=V,y=w,d=L,g=k,v*=B,b*=B,x*=B,p*=B,f*=B,u*=B,y*=B,d*=B,g*=B;var A=l._localTransform._positionX*l._localTransform._positionX,P=l._localTransform._positionY*l._localTransform._positionY,S=l._localTransform._positionZ*l._localTransform._positionZ,T=-l._localTransform._positionX*l._localTransform._positionY,C=-l._localTransform._positionY*l._localTransform._positionZ,j=-l._localTransform._positionZ*l._localTransform._positionX;h+=B,t+=v+=(P+S)*B,i+=b+=T*B,a+=x+=j*B,s+=p+=T*B,o+=f+=(A+S)*B,n+=u+=C*B,r+=y+=j*B,e+=d+=C*B,_+=g+=(A+P)*B,l=c}this._mass=h,this._localInertia00=t,this._localInertia01=i,this._localInertia02=a,this._localInertia10=s,this._localInertia11=o,this._localInertia12=n,this._localInertia20=r,this._localInertia21=e,this._localInertia22=_;var R,E,q,N,F,D,G,W,J,U,O,H,Q,K,$,tt,it,at,st=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,ot=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,nt=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,rt=this._localInertia00*st-this._localInertia01*ot+this._localInertia02*nt;if(this._mass>0&&rt>0&&0==this._type){this._invMass=1/this._mass;var et=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,_t=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,ht=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,lt=this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21,ct=this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20,mt=this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20,vt=this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11,bt=this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10,xt=this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10,pt=this._localInertia00*et-this._localInertia01*_t+this._localInertia02*ht;(pt<-1e-32||pt>1e-32)&&(pt=1/pt),this._invLocalInertia00=et*pt,this._invLocalInertia01=-lt*pt,this._invLocalInertia02=vt*pt,this._invLocalInertia10=-_t*pt,this._invLocalInertia11=ct*pt,this._invLocalInertia12=-bt*pt,this._invLocalInertia20=ht*pt,this._invLocalInertia21=-mt*pt,this._invLocalInertia22=xt*pt,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,0==this._type&&(this._type=1);R=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,E=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,q=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,N=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,F=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,D=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,G=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,W=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,J=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=R,this._invInertia01=E,this._invInertia02=q,this._invInertia10=N,this._invInertia11=F,this._invInertia12=D,this._invInertia20=G,this._invInertia21=W,this._invInertia22=J,U=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,O=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,H=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,Q=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,K=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,$=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,tt=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,it=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,at=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=U,this._invInertia01=O,this._invInertia02=H,this._invInertia10=Q,this._invInertia11=K,this._invInertia12=$,this._invInertia20=tt,this._invInertia21=it,this._invInertia22=at,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getPosition(){var t=new pa.common.Vec3,i=t;return i.x=this._transform._positionX,i.y=this._transform._positionY,i.z=this._transform._positionZ,t}getPositionTo(t){var i=t;i.x=this._transform._positionX,i.y=this._transform._positionY,i.z=this._transform._positionZ}setPosition(t){var i=t;this._transform._positionX=i.x,this._transform._positionY=i.y,this._transform._positionZ=i.z;var a=this._ptransform,s=this._transform;a._positionX=s._positionX,a._positionY=s._positionY,a._positionZ=s._positionZ,a._rotation00=s._rotation00,a._rotation01=s._rotation01,a._rotation02=s._rotation02,a._rotation10=s._rotation10,a._rotation11=s._rotation11,a._rotation12=s._rotation12,a._rotation20=s._rotation20,a._rotation21=s._rotation21,a._rotation22=s._rotation22;for(var o=this._shapeList;null!=o;){var n,r,e,_,h,l,c,m,v,b,x,p,f=o._next,u=o._ptransform,y=o._localTransform,d=this._ptransform;n=d._rotation00*y._rotation00+d._rotation01*y._rotation10+d._rotation02*y._rotation20,r=d._rotation00*y._rotation01+d._rotation01*y._rotation11+d._rotation02*y._rotation21,e=d._rotation00*y._rotation02+d._rotation01*y._rotation12+d._rotation02*y._rotation22,_=d._rotation10*y._rotation00+d._rotation11*y._rotation10+d._rotation12*y._rotation20,h=d._rotation10*y._rotation01+d._rotation11*y._rotation11+d._rotation12*y._rotation21,l=d._rotation10*y._rotation02+d._rotation11*y._rotation12+d._rotation12*y._rotation22,c=d._rotation20*y._rotation00+d._rotation21*y._rotation10+d._rotation22*y._rotation20,m=d._rotation20*y._rotation01+d._rotation21*y._rotation11+d._rotation22*y._rotation21,v=d._rotation20*y._rotation02+d._rotation21*y._rotation12+d._rotation22*y._rotation22,u._rotation00=n,u._rotation01=r,u._rotation02=e,u._rotation10=_,u._rotation11=h,u._rotation12=l,u._rotation20=c,u._rotation21=m,u._rotation22=v,b=d._rotation00*y._positionX+d._rotation01*y._positionY+d._rotation02*y._positionZ,x=d._rotation10*y._positionX+d._rotation11*y._positionY+d._rotation12*y._positionZ,p=d._rotation20*y._positionX+d._rotation21*y._positionY+d._rotation22*y._positionZ,u._positionX=b,u._positionY=x,u._positionZ=p,u._positionX+=d._positionX,u._positionY+=d._positionY,u._positionZ+=d._positionZ;var g,X,z,Y,Z,M,I,V,w,L,k,B,A,P,S,T,C,j,R=o._transform,E=o._localTransform,q=this._transform;if(g=q._rotation00*E._rotation00+q._rotation01*E._rotation10+q._rotation02*E._rotation20,X=q._rotation00*E._rotation01+q._rotation01*E._rotation11+q._rotation02*E._rotation21,z=q._rotation00*E._rotation02+q._rotation01*E._rotation12+q._rotation02*E._rotation22,Y=q._rotation10*E._rotation00+q._rotation11*E._rotation10+q._rotation12*E._rotation20,Z=q._rotation10*E._rotation01+q._rotation11*E._rotation11+q._rotation12*E._rotation21,M=q._rotation10*E._rotation02+q._rotation11*E._rotation12+q._rotation12*E._rotation22,I=q._rotation20*E._rotation00+q._rotation21*E._rotation10+q._rotation22*E._rotation20,V=q._rotation20*E._rotation01+q._rotation21*E._rotation11+q._rotation22*E._rotation21,w=q._rotation20*E._rotation02+q._rotation21*E._rotation12+q._rotation22*E._rotation22,R._rotation00=g,R._rotation01=X,R._rotation02=z,R._rotation10=Y,R._rotation11=Z,R._rotation12=M,R._rotation20=I,R._rotation21=V,R._rotation22=w,L=q._rotation00*E._positionX+q._rotation01*E._positionY+q._rotation02*E._positionZ,k=q._rotation10*E._positionX+q._rotation11*E._positionY+q._rotation12*E._positionZ,B=q._rotation20*E._positionX+q._rotation21*E._positionY+q._rotation22*E._positionZ,R._positionX=L,R._positionY=k,R._positionZ=B,R._positionX+=q._positionX,R._positionY+=q._positionY,R._positionZ+=q._positionZ,o._geom._computeAabb(o._aabb,o._ptransform),A=o._aabb._minX,P=o._aabb._minY,S=o._aabb._minZ,T=o._aabb._maxX,C=o._aabb._maxY,j=o._aabb._maxZ,o._geom._computeAabb(o._aabb,o._transform),o._aabb._minX=A<o._aabb._minX?A:o._aabb._minX,o._aabb._minY=P<o._aabb._minY?P:o._aabb._minY,o._aabb._minZ=S<o._aabb._minZ?S:o._aabb._minZ,o._aabb._maxX=T>o._aabb._maxX?T:o._aabb._maxX,o._aabb._maxY=C>o._aabb._maxY?C:o._aabb._maxY,o._aabb._maxZ=j>o._aabb._maxZ?j:o._aabb._maxZ,null!=o._proxy){var N,F,D;N=o._transform._positionX-o._ptransform._positionX,F=o._transform._positionY-o._ptransform._positionY,D=o._transform._positionZ-o._ptransform._positionZ;var G=o.displacement;G.x=N,G.y=F,G.z=D,o._rigidBody._world._broadPhase.moveProxy(o._proxy,o._aabb,o.displacement)}o=f}this._sleeping=!1,this._sleepTime=0}translate(t){var i,a,s,o=t;i=o.x,a=o.y,s=o.z,this._transform._positionX+=i,this._transform._positionY+=a,this._transform._positionZ+=s;var n=this._ptransform,r=this._transform;n._positionX=r._positionX,n._positionY=r._positionY,n._positionZ=r._positionZ,n._rotation00=r._rotation00,n._rotation01=r._rotation01,n._rotation02=r._rotation02,n._rotation10=r._rotation10,n._rotation11=r._rotation11,n._rotation12=r._rotation12,n._rotation20=r._rotation20,n._rotation21=r._rotation21,n._rotation22=r._rotation22;for(var e=this._shapeList;null!=e;){var _,h,l,c,m,v,b,x,p,f,u,y,d=e._next,g=e._ptransform,X=e._localTransform,z=this._ptransform;_=z._rotation00*X._rotation00+z._rotation01*X._rotation10+z._rotation02*X._rotation20,h=z._rotation00*X._rotation01+z._rotation01*X._rotation11+z._rotation02*X._rotation21,l=z._rotation00*X._rotation02+z._rotation01*X._rotation12+z._rotation02*X._rotation22,c=z._rotation10*X._rotation00+z._rotation11*X._rotation10+z._rotation12*X._rotation20,m=z._rotation10*X._rotation01+z._rotation11*X._rotation11+z._rotation12*X._rotation21,v=z._rotation10*X._rotation02+z._rotation11*X._rotation12+z._rotation12*X._rotation22,b=z._rotation20*X._rotation00+z._rotation21*X._rotation10+z._rotation22*X._rotation20,x=z._rotation20*X._rotation01+z._rotation21*X._rotation11+z._rotation22*X._rotation21,p=z._rotation20*X._rotation02+z._rotation21*X._rotation12+z._rotation22*X._rotation22,g._rotation00=_,g._rotation01=h,g._rotation02=l,g._rotation10=c,g._rotation11=m,g._rotation12=v,g._rotation20=b,g._rotation21=x,g._rotation22=p,f=z._rotation00*X._positionX+z._rotation01*X._positionY+z._rotation02*X._positionZ,u=z._rotation10*X._positionX+z._rotation11*X._positionY+z._rotation12*X._positionZ,y=z._rotation20*X._positionX+z._rotation21*X._positionY+z._rotation22*X._positionZ,g._positionX=f,g._positionY=u,g._positionZ=y,g._positionX+=z._positionX,g._positionY+=z._positionY,g._positionZ+=z._positionZ;var Y,Z,M,I,V,w,L,k,B,A,P,S,T,C,j,R,E,q,N=e._transform,F=e._localTransform,D=this._transform;if(Y=D._rotation00*F._rotation00+D._rotation01*F._rotation10+D._rotation02*F._rotation20,Z=D._rotation00*F._rotation01+D._rotation01*F._rotation11+D._rotation02*F._rotation21,M=D._rotation00*F._rotation02+D._rotation01*F._rotation12+D._rotation02*F._rotation22,I=D._rotation10*F._rotation00+D._rotation11*F._rotation10+D._rotation12*F._rotation20,V=D._rotation10*F._rotation01+D._rotation11*F._rotation11+D._rotation12*F._rotation21,w=D._rotation10*F._rotation02+D._rotation11*F._rotation12+D._rotation12*F._rotation22,L=D._rotation20*F._rotation00+D._rotation21*F._rotation10+D._rotation22*F._rotation20,k=D._rotation20*F._rotation01+D._rotation21*F._rotation11+D._rotation22*F._rotation21,B=D._rotation20*F._rotation02+D._rotation21*F._rotation12+D._rotation22*F._rotation22,N._rotation00=Y,N._rotation01=Z,N._rotation02=M,N._rotation10=I,N._rotation11=V,N._rotation12=w,N._rotation20=L,N._rotation21=k,N._rotation22=B,A=D._rotation00*F._positionX+D._rotation01*F._positionY+D._rotation02*F._positionZ,P=D._rotation10*F._positionX+D._rotation11*F._positionY+D._rotation12*F._positionZ,S=D._rotation20*F._positionX+D._rotation21*F._positionY+D._rotation22*F._positionZ,N._positionX=A,N._positionY=P,N._positionZ=S,N._positionX+=D._positionX,N._positionY+=D._positionY,N._positionZ+=D._positionZ,e._geom._computeAabb(e._aabb,e._ptransform),T=e._aabb._minX,C=e._aabb._minY,j=e._aabb._minZ,R=e._aabb._maxX,E=e._aabb._maxY,q=e._aabb._maxZ,e._geom._computeAabb(e._aabb,e._transform),e._aabb._minX=T<e._aabb._minX?T:e._aabb._minX,e._aabb._minY=C<e._aabb._minY?C:e._aabb._minY,e._aabb._minZ=j<e._aabb._minZ?j:e._aabb._minZ,e._aabb._maxX=R>e._aabb._maxX?R:e._aabb._maxX,e._aabb._maxY=E>e._aabb._maxY?E:e._aabb._maxY,e._aabb._maxZ=q>e._aabb._maxZ?q:e._aabb._maxZ,null!=e._proxy){var G,W,J;G=e._transform._positionX-e._ptransform._positionX,W=e._transform._positionY-e._ptransform._positionY,J=e._transform._positionZ-e._ptransform._positionZ;var U=e.displacement;U.x=G,U.y=W,U.z=J,e._rigidBody._world._broadPhase.moveProxy(e._proxy,e._aabb,e.displacement)}e=d}this._sleeping=!1,this._sleepTime=0}getRotation(){var t=new pa.common.Mat3,i=t;return i.e00=this._transform._rotation00,i.e01=this._transform._rotation01,i.e02=this._transform._rotation02,i.e10=this._transform._rotation10,i.e11=this._transform._rotation11,i.e12=this._transform._rotation12,i.e20=this._transform._rotation20,i.e21=this._transform._rotation21,i.e22=this._transform._rotation22,t}getRotationTo(t){var i=t;i.e00=this._transform._rotation00,i.e01=this._transform._rotation01,i.e02=this._transform._rotation02,i.e10=this._transform._rotation10,i.e11=this._transform._rotation11,i.e12=this._transform._rotation12,i.e20=this._transform._rotation20,i.e21=this._transform._rotation21,i.e22=this._transform._rotation22}setRotation(t){var i,a,s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y=t;this._transform._rotation00=y.e00,this._transform._rotation01=y.e01,this._transform._rotation02=y.e02,this._transform._rotation10=y.e10,this._transform._rotation11=y.e11,this._transform._rotation12=y.e12,this._transform._rotation20=y.e20,this._transform._rotation21=y.e21,this._transform._rotation22=y.e22,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,a=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,s=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,n=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,e=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=a,this._invInertia02=s,this._invInertia10=o,this._invInertia11=n,this._invInertia12=r,this._invInertia20=e,this._invInertia21=_,this._invInertia22=h,l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,v=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,b=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,x=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,p=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,f=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,u=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=c,this._invInertia02=m,this._invInertia10=v,this._invInertia11=b,this._invInertia12=x,this._invInertia20=p,this._invInertia21=f,this._invInertia22=u,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var d=this._ptransform,g=this._transform;d._positionX=g._positionX,d._positionY=g._positionY,d._positionZ=g._positionZ,d._rotation00=g._rotation00,d._rotation01=g._rotation01,d._rotation02=g._rotation02,d._rotation10=g._rotation10,d._rotation11=g._rotation11,d._rotation12=g._rotation12,d._rotation20=g._rotation20,d._rotation21=g._rotation21,d._rotation22=g._rotation22;for(var X=this._shapeList;null!=X;){var z,Y,Z,M,I,V,w,L,k,B,A,P,S=X._next,T=X._ptransform,C=X._localTransform,j=this._ptransform;z=j._rotation00*C._rotation00+j._rotation01*C._rotation10+j._rotation02*C._rotation20,Y=j._rotation00*C._rotation01+j._rotation01*C._rotation11+j._rotation02*C._rotation21,Z=j._rotation00*C._rotation02+j._rotation01*C._rotation12+j._rotation02*C._rotation22,M=j._rotation10*C._rotation00+j._rotation11*C._rotation10+j._rotation12*C._rotation20,I=j._rotation10*C._rotation01+j._rotation11*C._rotation11+j._rotation12*C._rotation21,V=j._rotation10*C._rotation02+j._rotation11*C._rotation12+j._rotation12*C._rotation22,w=j._rotation20*C._rotation00+j._rotation21*C._rotation10+j._rotation22*C._rotation20,L=j._rotation20*C._rotation01+j._rotation21*C._rotation11+j._rotation22*C._rotation21,k=j._rotation20*C._rotation02+j._rotation21*C._rotation12+j._rotation22*C._rotation22,T._rotation00=z,T._rotation01=Y,T._rotation02=Z,T._rotation10=M,T._rotation11=I,T._rotation12=V,T._rotation20=w,T._rotation21=L,T._rotation22=k,B=j._rotation00*C._positionX+j._rotation01*C._positionY+j._rotation02*C._positionZ,A=j._rotation10*C._positionX+j._rotation11*C._positionY+j._rotation12*C._positionZ,P=j._rotation20*C._positionX+j._rotation21*C._positionY+j._rotation22*C._positionZ,T._positionX=B,T._positionY=A,T._positionZ=P,T._positionX+=j._positionX,T._positionY+=j._positionY,T._positionZ+=j._positionZ;var R,E,q,N,F,D,G,W,J,U,O,H,Q,K,$,tt,it,at,st=X._transform,ot=X._localTransform,nt=this._transform;if(R=nt._rotation00*ot._rotation00+nt._rotation01*ot._rotation10+nt._rotation02*ot._rotation20,E=nt._rotation00*ot._rotation01+nt._rotation01*ot._rotation11+nt._rotation02*ot._rotation21,q=nt._rotation00*ot._rotation02+nt._rotation01*ot._rotation12+nt._rotation02*ot._rotation22,N=nt._rotation10*ot._rotation00+nt._rotation11*ot._rotation10+nt._rotation12*ot._rotation20,F=nt._rotation10*ot._rotation01+nt._rotation11*ot._rotation11+nt._rotation12*ot._rotation21,D=nt._rotation10*ot._rotation02+nt._rotation11*ot._rotation12+nt._rotation12*ot._rotation22,G=nt._rotation20*ot._rotation00+nt._rotation21*ot._rotation10+nt._rotation22*ot._rotation20,W=nt._rotation20*ot._rotation01+nt._rotation21*ot._rotation11+nt._rotation22*ot._rotation21,J=nt._rotation20*ot._rotation02+nt._rotation21*ot._rotation12+nt._rotation22*ot._rotation22,st._rotation00=R,st._rotation01=E,st._rotation02=q,st._rotation10=N,st._rotation11=F,st._rotation12=D,st._rotation20=G,st._rotation21=W,st._rotation22=J,U=nt._rotation00*ot._positionX+nt._rotation01*ot._positionY+nt._rotation02*ot._positionZ,O=nt._rotation10*ot._positionX+nt._rotation11*ot._positionY+nt._rotation12*ot._positionZ,H=nt._rotation20*ot._positionX+nt._rotation21*ot._positionY+nt._rotation22*ot._positionZ,st._positionX=U,st._positionY=O,st._positionZ=H,st._positionX+=nt._positionX,st._positionY+=nt._positionY,st._positionZ+=nt._positionZ,X._geom._computeAabb(X._aabb,X._ptransform),Q=X._aabb._minX,K=X._aabb._minY,$=X._aabb._minZ,tt=X._aabb._maxX,it=X._aabb._maxY,at=X._aabb._maxZ,X._geom._computeAabb(X._aabb,X._transform),X._aabb._minX=Q<X._aabb._minX?Q:X._aabb._minX,X._aabb._minY=K<X._aabb._minY?K:X._aabb._minY,X._aabb._minZ=$<X._aabb._minZ?$:X._aabb._minZ,X._aabb._maxX=tt>X._aabb._maxX?tt:X._aabb._maxX,X._aabb._maxY=it>X._aabb._maxY?it:X._aabb._maxY,X._aabb._maxZ=at>X._aabb._maxZ?at:X._aabb._maxZ,null!=X._proxy){var rt,et,_t;rt=X._transform._positionX-X._ptransform._positionX,et=X._transform._positionY-X._ptransform._positionY,_t=X._transform._positionZ-X._ptransform._positionZ;var ht=X.displacement;ht.x=rt,ht.y=et,ht.z=_t,X._rigidBody._world._broadPhase.moveProxy(X._proxy,X._aabb,X.displacement)}X=S}this._sleeping=!1,this._sleepTime=0}setRotationXyz(t){var i,a,s,o=t;i=o.x,a=o.y,s=o.z;var n,r,e,_,h,l,c,m,v,b,x,p,f,u,y,d,g,X,z=Math.sin(i),Y=Math.sin(a),Z=Math.sin(s),M=Math.cos(i),I=Math.cos(a),V=Math.cos(s);this._transform._rotation00=I*V,this._transform._rotation01=-I*Z,this._transform._rotation02=Y,this._transform._rotation10=M*Z+V*z*Y,this._transform._rotation11=M*V-z*Y*Z,this._transform._rotation12=-I*z,this._transform._rotation20=z*Z-M*V*Y,this._transform._rotation21=V*z+M*Y*Z,this._transform._rotation22=M*I,n=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,r=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,e=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,_=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,h=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,l=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,c=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,m=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,v=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=n,this._invInertia01=r,this._invInertia02=e,this._invInertia10=_,this._invInertia11=h,this._invInertia12=l,this._invInertia20=c,this._invInertia21=m,this._invInertia22=v,b=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,x=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,p=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,f=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,u=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,y=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,d=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,g=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,X=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=b,this._invInertia01=x,this._invInertia02=p,this._invInertia10=f,this._invInertia11=u,this._invInertia12=y,this._invInertia20=d,this._invInertia21=g,this._invInertia22=X,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var w=this._ptransform,L=this._transform;w._positionX=L._positionX,w._positionY=L._positionY,w._positionZ=L._positionZ,w._rotation00=L._rotation00,w._rotation01=L._rotation01,w._rotation02=L._rotation02,w._rotation10=L._rotation10,w._rotation11=L._rotation11,w._rotation12=L._rotation12,w._rotation20=L._rotation20,w._rotation21=L._rotation21,w._rotation22=L._rotation22;for(var k=this._shapeList;null!=k;){var B,A,P,S,T,C,j,R,E,q,N,F,D=k._next,G=k._ptransform,W=k._localTransform,J=this._ptransform;B=J._rotation00*W._rotation00+J._rotation01*W._rotation10+J._rotation02*W._rotation20,A=J._rotation00*W._rotation01+J._rotation01*W._rotation11+J._rotation02*W._rotation21,P=J._rotation00*W._rotation02+J._rotation01*W._rotation12+J._rotation02*W._rotation22,S=J._rotation10*W._rotation00+J._rotation11*W._rotation10+J._rotation12*W._rotation20,T=J._rotation10*W._rotation01+J._rotation11*W._rotation11+J._rotation12*W._rotation21,C=J._rotation10*W._rotation02+J._rotation11*W._rotation12+J._rotation12*W._rotation22,j=J._rotation20*W._rotation00+J._rotation21*W._rotation10+J._rotation22*W._rotation20,R=J._rotation20*W._rotation01+J._rotation21*W._rotation11+J._rotation22*W._rotation21,E=J._rotation20*W._rotation02+J._rotation21*W._rotation12+J._rotation22*W._rotation22,G._rotation00=B,G._rotation01=A,G._rotation02=P,G._rotation10=S,G._rotation11=T,G._rotation12=C,G._rotation20=j,G._rotation21=R,G._rotation22=E,q=J._rotation00*W._positionX+J._rotation01*W._positionY+J._rotation02*W._positionZ,N=J._rotation10*W._positionX+J._rotation11*W._positionY+J._rotation12*W._positionZ,F=J._rotation20*W._positionX+J._rotation21*W._positionY+J._rotation22*W._positionZ,G._positionX=q,G._positionY=N,G._positionZ=F,G._positionX+=J._positionX,G._positionY+=J._positionY,G._positionZ+=J._positionZ;var U,O,H,Q,K,$,tt,it,at,st,ot,nt,rt,et,_t,ht,lt,ct,mt=k._transform,vt=k._localTransform,bt=this._transform;if(U=bt._rotation00*vt._rotation00+bt._rotation01*vt._rotation10+bt._rotation02*vt._rotation20,O=bt._rotation00*vt._rotation01+bt._rotation01*vt._rotation11+bt._rotation02*vt._rotation21,H=bt._rotation00*vt._rotation02+bt._rotation01*vt._rotation12+bt._rotation02*vt._rotation22,Q=bt._rotation10*vt._rotation00+bt._rotation11*vt._rotation10+bt._rotation12*vt._rotation20,K=bt._rotation10*vt._rotation01+bt._rotation11*vt._rotation11+bt._rotation12*vt._rotation21,$=bt._rotation10*vt._rotation02+bt._rotation11*vt._rotation12+bt._rotation12*vt._rotation22,tt=bt._rotation20*vt._rotation00+bt._rotation21*vt._rotation10+bt._rotation22*vt._rotation20,it=bt._rotation20*vt._rotation01+bt._rotation21*vt._rotation11+bt._rotation22*vt._rotation21,at=bt._rotation20*vt._rotation02+bt._rotation21*vt._rotation12+bt._rotation22*vt._rotation22,mt._rotation00=U,mt._rotation01=O,mt._rotation02=H,mt._rotation10=Q,mt._rotation11=K,mt._rotation12=$,mt._rotation20=tt,mt._rotation21=it,mt._rotation22=at,st=bt._rotation00*vt._positionX+bt._rotation01*vt._positionY+bt._rotation02*vt._positionZ,ot=bt._rotation10*vt._positionX+bt._rotation11*vt._positionY+bt._rotation12*vt._positionZ,nt=bt._rotation20*vt._positionX+bt._rotation21*vt._positionY+bt._rotation22*vt._positionZ,mt._positionX=st,mt._positionY=ot,mt._positionZ=nt,mt._positionX+=bt._positionX,mt._positionY+=bt._positionY,mt._positionZ+=bt._positionZ,k._geom._computeAabb(k._aabb,k._ptransform),rt=k._aabb._minX,et=k._aabb._minY,_t=k._aabb._minZ,ht=k._aabb._maxX,lt=k._aabb._maxY,ct=k._aabb._maxZ,k._geom._computeAabb(k._aabb,k._transform),k._aabb._minX=rt<k._aabb._minX?rt:k._aabb._minX,k._aabb._minY=et<k._aabb._minY?et:k._aabb._minY,k._aabb._minZ=_t<k._aabb._minZ?_t:k._aabb._minZ,k._aabb._maxX=ht>k._aabb._maxX?ht:k._aabb._maxX,k._aabb._maxY=lt>k._aabb._maxY?lt:k._aabb._maxY,k._aabb._maxZ=ct>k._aabb._maxZ?ct:k._aabb._maxZ,null!=k._proxy){var xt,pt,ft;xt=k._transform._positionX-k._ptransform._positionX,pt=k._transform._positionY-k._ptransform._positionY,ft=k._transform._positionZ-k._ptransform._positionZ;var ut=k.displacement;ut.x=xt,ut.y=pt,ut.z=ft,k._rigidBody._world._broadPhase.moveProxy(k._proxy,k._aabb,k.displacement)}k=D}this._sleeping=!1,this._sleepTime=0}rotate(t){var i,a,s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y,d,g,X,z,Y,Z,M,I,V,w,L,k,B,A,P,S,T,C=t;i=C.e00,a=C.e01,s=C.e02,o=C.e10,n=C.e11,r=C.e12,e=C.e20,_=C.e21,h=C.e22,l=i*this._transform._rotation00+a*this._transform._rotation10+s*this._transform._rotation20,c=i*this._transform._rotation01+a*this._transform._rotation11+s*this._transform._rotation21,m=i*this._transform._rotation02+a*this._transform._rotation12+s*this._transform._rotation22,v=o*this._transform._rotation00+n*this._transform._rotation10+r*this._transform._rotation20,b=o*this._transform._rotation01+n*this._transform._rotation11+r*this._transform._rotation21,x=o*this._transform._rotation02+n*this._transform._rotation12+r*this._transform._rotation22,p=e*this._transform._rotation00+_*this._transform._rotation10+h*this._transform._rotation20,f=e*this._transform._rotation01+_*this._transform._rotation11+h*this._transform._rotation21,u=e*this._transform._rotation02+_*this._transform._rotation12+h*this._transform._rotation22,this._transform._rotation00=l,this._transform._rotation01=c,this._transform._rotation02=m,this._transform._rotation10=v,this._transform._rotation11=b,this._transform._rotation12=x,this._transform._rotation20=p,this._transform._rotation21=f,this._transform._rotation22=u,y=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,d=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,g=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,X=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,z=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,Y=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,Z=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,M=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,I=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=y,this._invInertia01=d,this._invInertia02=g,this._invInertia10=X,this._invInertia11=z,this._invInertia12=Y,this._invInertia20=Z,this._invInertia21=M,this._invInertia22=I,V=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,w=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,L=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,k=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,B=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,A=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,P=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,S=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,T=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=V,this._invInertia01=w,this._invInertia02=L,this._invInertia10=k,this._invInertia11=B,this._invInertia12=A,this._invInertia20=P,this._invInertia21=S,this._invInertia22=T,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var j=this._ptransform,R=this._transform;j._positionX=R._positionX,j._positionY=R._positionY,j._positionZ=R._positionZ,j._rotation00=R._rotation00,j._rotation01=R._rotation01,j._rotation02=R._rotation02,j._rotation10=R._rotation10,j._rotation11=R._rotation11,j._rotation12=R._rotation12,j._rotation20=R._rotation20,j._rotation21=R._rotation21,j._rotation22=R._rotation22;for(var E=this._shapeList;null!=E;){var q,N,F,D,G,W,J,U,O,H,Q,K,$=E._next,tt=E._ptransform,it=E._localTransform,at=this._ptransform;q=at._rotation00*it._rotation00+at._rotation01*it._rotation10+at._rotation02*it._rotation20,N=at._rotation00*it._rotation01+at._rotation01*it._rotation11+at._rotation02*it._rotation21,F=at._rotation00*it._rotation02+at._rotation01*it._rotation12+at._rotation02*it._rotation22,D=at._rotation10*it._rotation00+at._rotation11*it._rotation10+at._rotation12*it._rotation20,G=at._rotation10*it._rotation01+at._rotation11*it._rotation11+at._rotation12*it._rotation21,W=at._rotation10*it._rotation02+at._rotation11*it._rotation12+at._rotation12*it._rotation22,J=at._rotation20*it._rotation00+at._rotation21*it._rotation10+at._rotation22*it._rotation20,U=at._rotation20*it._rotation01+at._rotation21*it._rotation11+at._rotation22*it._rotation21,O=at._rotation20*it._rotation02+at._rotation21*it._rotation12+at._rotation22*it._rotation22,tt._rotation00=q,tt._rotation01=N,tt._rotation02=F,tt._rotation10=D,tt._rotation11=G,tt._rotation12=W,tt._rotation20=J,tt._rotation21=U,tt._rotation22=O,H=at._rotation00*it._positionX+at._rotation01*it._positionY+at._rotation02*it._positionZ,Q=at._rotation10*it._positionX+at._rotation11*it._positionY+at._rotation12*it._positionZ,K=at._rotation20*it._positionX+at._rotation21*it._positionY+at._rotation22*it._positionZ,tt._positionX=H,tt._positionY=Q,tt._positionZ=K,tt._positionX+=at._positionX,tt._positionY+=at._positionY,tt._positionZ+=at._positionZ;var st,ot,nt,rt,et,_t,ht,lt,ct,mt,vt,bt,xt,pt,ft,ut,yt,dt,gt=E._transform,Xt=E._localTransform,zt=this._transform;if(st=zt._rotation00*Xt._rotation00+zt._rotation01*Xt._rotation10+zt._rotation02*Xt._rotation20,ot=zt._rotation00*Xt._rotation01+zt._rotation01*Xt._rotation11+zt._rotation02*Xt._rotation21,nt=zt._rotation00*Xt._rotation02+zt._rotation01*Xt._rotation12+zt._rotation02*Xt._rotation22,rt=zt._rotation10*Xt._rotation00+zt._rotation11*Xt._rotation10+zt._rotation12*Xt._rotation20,et=zt._rotation10*Xt._rotation01+zt._rotation11*Xt._rotation11+zt._rotation12*Xt._rotation21,_t=zt._rotation10*Xt._rotation02+zt._rotation11*Xt._rotation12+zt._rotation12*Xt._rotation22,ht=zt._rotation20*Xt._rotation00+zt._rotation21*Xt._rotation10+zt._rotation22*Xt._rotation20,lt=zt._rotation20*Xt._rotation01+zt._rotation21*Xt._rotation11+zt._rotation22*Xt._rotation21,ct=zt._rotation20*Xt._rotation02+zt._rotation21*Xt._rotation12+zt._rotation22*Xt._rotation22,gt._rotation00=st,gt._rotation01=ot,gt._rotation02=nt,gt._rotation10=rt,gt._rotation11=et,gt._rotation12=_t,gt._rotation20=ht,gt._rotation21=lt,gt._rotation22=ct,mt=zt._rotation00*Xt._positionX+zt._rotation01*Xt._positionY+zt._rotation02*Xt._positionZ,vt=zt._rotation10*Xt._positionX+zt._rotation11*Xt._positionY+zt._rotation12*Xt._positionZ,bt=zt._rotation20*Xt._positionX+zt._rotation21*Xt._positionY+zt._rotation22*Xt._positionZ,gt._positionX=mt,gt._positionY=vt,gt._positionZ=bt,gt._positionX+=zt._positionX,gt._positionY+=zt._positionY,gt._positionZ+=zt._positionZ,E._geom._computeAabb(E._aabb,E._ptransform),xt=E._aabb._minX,pt=E._aabb._minY,ft=E._aabb._minZ,ut=E._aabb._maxX,yt=E._aabb._maxY,dt=E._aabb._maxZ,E._geom._computeAabb(E._aabb,E._transform),E._aabb._minX=xt<E._aabb._minX?xt:E._aabb._minX,E._aabb._minY=pt<E._aabb._minY?pt:E._aabb._minY,E._aabb._minZ=ft<E._aabb._minZ?ft:E._aabb._minZ,E._aabb._maxX=ut>E._aabb._maxX?ut:E._aabb._maxX,E._aabb._maxY=yt>E._aabb._maxY?yt:E._aabb._maxY,E._aabb._maxZ=dt>E._aabb._maxZ?dt:E._aabb._maxZ,null!=E._proxy){var Yt,Zt,Mt;Yt=E._transform._positionX-E._ptransform._positionX,Zt=E._transform._positionY-E._ptransform._positionY,Mt=E._transform._positionZ-E._ptransform._positionZ;var It=E.displacement;It.x=Yt,It.y=Zt,It.z=Mt,E._rigidBody._world._broadPhase.moveProxy(E._proxy,E._aabb,E.displacement)}E=$}this._sleeping=!1,this._sleepTime=0}rotateXyz(t){var i,a,s,o,n,r,e,_,h,l,c,m,v=t;i=v.x,a=v.y,s=v.z;var b,x,p,f,u,y,d,g,X,z,Y,Z,M,I,V,w,L,k,B,A,P,S,T,C,j,R,E,q=Math.sin(i),N=Math.sin(a),F=Math.sin(s),D=Math.cos(i),G=Math.cos(a),W=Math.cos(s);n=-G*F,r=N,e=D*F+W*q*N,_=D*W-q*N*F,h=-G*q,l=q*F-D*W*N,c=W*q+D*N*F,m=D*G,b=(o=G*W)*this._transform._rotation00+n*this._transform._rotation10+r*this._transform._rotation20,x=o*this._transform._rotation01+n*this._transform._rotation11+r*this._transform._rotation21,p=o*this._transform._rotation02+n*this._transform._rotation12+r*this._transform._rotation22,f=e*this._transform._rotation00+_*this._transform._rotation10+h*this._transform._rotation20,u=e*this._transform._rotation01+_*this._transform._rotation11+h*this._transform._rotation21,y=e*this._transform._rotation02+_*this._transform._rotation12+h*this._transform._rotation22,d=l*this._transform._rotation00+c*this._transform._rotation10+m*this._transform._rotation20,g=l*this._transform._rotation01+c*this._transform._rotation11+m*this._transform._rotation21,X=l*this._transform._rotation02+c*this._transform._rotation12+m*this._transform._rotation22,this._transform._rotation00=b,this._transform._rotation01=x,this._transform._rotation02=p,this._transform._rotation10=f,this._transform._rotation11=u,this._transform._rotation12=y,this._transform._rotation20=d,this._transform._rotation21=g,this._transform._rotation22=X,z=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,Y=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,Z=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,M=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,I=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,V=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,w=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,L=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,k=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=z,this._invInertia01=Y,this._invInertia02=Z,this._invInertia10=M,this._invInertia11=I,this._invInertia12=V,this._invInertia20=w,this._invInertia21=L,this._invInertia22=k,B=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,A=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,P=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,S=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,T=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,C=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,j=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,R=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,E=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=B,this._invInertia01=A,this._invInertia02=P,this._invInertia10=S,this._invInertia11=T,this._invInertia12=C,this._invInertia20=j,this._invInertia21=R,this._invInertia22=E,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var J=this._ptransform,U=this._transform;J._positionX=U._positionX,J._positionY=U._positionY,J._positionZ=U._positionZ,J._rotation00=U._rotation00,J._rotation01=U._rotation01,J._rotation02=U._rotation02,J._rotation10=U._rotation10,J._rotation11=U._rotation11,J._rotation12=U._rotation12,J._rotation20=U._rotation20,J._rotation21=U._rotation21,J._rotation22=U._rotation22;for(var O=this._shapeList;null!=O;){var H,Q,K,$,tt,it,at,st,ot,nt,rt,et,_t=O._next,ht=O._ptransform,lt=O._localTransform,ct=this._ptransform;H=ct._rotation00*lt._rotation00+ct._rotation01*lt._rotation10+ct._rotation02*lt._rotation20,Q=ct._rotation00*lt._rotation01+ct._rotation01*lt._rotation11+ct._rotation02*lt._rotation21,K=ct._rotation00*lt._rotation02+ct._rotation01*lt._rotation12+ct._rotation02*lt._rotation22,$=ct._rotation10*lt._rotation00+ct._rotation11*lt._rotation10+ct._rotation12*lt._rotation20,tt=ct._rotation10*lt._rotation01+ct._rotation11*lt._rotation11+ct._rotation12*lt._rotation21,it=ct._rotation10*lt._rotation02+ct._rotation11*lt._rotation12+ct._rotation12*lt._rotation22,at=ct._rotation20*lt._rotation00+ct._rotation21*lt._rotation10+ct._rotation22*lt._rotation20,st=ct._rotation20*lt._rotation01+ct._rotation21*lt._rotation11+ct._rotation22*lt._rotation21,ot=ct._rotation20*lt._rotation02+ct._rotation21*lt._rotation12+ct._rotation22*lt._rotation22,ht._rotation00=H,ht._rotation01=Q,ht._rotation02=K,ht._rotation10=$,ht._rotation11=tt,ht._rotation12=it,ht._rotation20=at,ht._rotation21=st,ht._rotation22=ot,nt=ct._rotation00*lt._positionX+ct._rotation01*lt._positionY+ct._rotation02*lt._positionZ,rt=ct._rotation10*lt._positionX+ct._rotation11*lt._positionY+ct._rotation12*lt._positionZ,et=ct._rotation20*lt._positionX+ct._rotation21*lt._positionY+ct._rotation22*lt._positionZ,ht._positionX=nt,ht._positionY=rt,ht._positionZ=et,ht._positionX+=ct._positionX,ht._positionY+=ct._positionY,ht._positionZ+=ct._positionZ;var mt,vt,bt,xt,pt,ft,ut,yt,dt,gt,Xt,zt,Yt,Zt,Mt,It,Vt,wt,Lt=O._transform,kt=O._localTransform,Bt=this._transform;if(mt=Bt._rotation00*kt._rotation00+Bt._rotation01*kt._rotation10+Bt._rotation02*kt._rotation20,vt=Bt._rotation00*kt._rotation01+Bt._rotation01*kt._rotation11+Bt._rotation02*kt._rotation21,bt=Bt._rotation00*kt._rotation02+Bt._rotation01*kt._rotation12+Bt._rotation02*kt._rotation22,xt=Bt._rotation10*kt._rotation00+Bt._rotation11*kt._rotation10+Bt._rotation12*kt._rotation20,pt=Bt._rotation10*kt._rotation01+Bt._rotation11*kt._rotation11+Bt._rotation12*kt._rotation21,ft=Bt._rotation10*kt._rotation02+Bt._rotation11*kt._rotation12+Bt._rotation12*kt._rotation22,ut=Bt._rotation20*kt._rotation00+Bt._rotation21*kt._rotation10+Bt._rotation22*kt._rotation20,yt=Bt._rotation20*kt._rotation01+Bt._rotation21*kt._rotation11+Bt._rotation22*kt._rotation21,dt=Bt._rotation20*kt._rotation02+Bt._rotation21*kt._rotation12+Bt._rotation22*kt._rotation22,Lt._rotation00=mt,Lt._rotation01=vt,Lt._rotation02=bt,Lt._rotation10=xt,Lt._rotation11=pt,Lt._rotation12=ft,Lt._rotation20=ut,Lt._rotation21=yt,Lt._rotation22=dt,gt=Bt._rotation00*kt._positionX+Bt._rotation01*kt._positionY+Bt._rotation02*kt._positionZ,Xt=Bt._rotation10*kt._positionX+Bt._rotation11*kt._positionY+Bt._rotation12*kt._positionZ,zt=Bt._rotation20*kt._positionX+Bt._rotation21*kt._positionY+Bt._rotation22*kt._positionZ,Lt._positionX=gt,Lt._positionY=Xt,Lt._positionZ=zt,Lt._positionX+=Bt._positionX,Lt._positionY+=Bt._positionY,Lt._positionZ+=Bt._positionZ,O._geom._computeAabb(O._aabb,O._ptransform),Yt=O._aabb._minX,Zt=O._aabb._minY,Mt=O._aabb._minZ,It=O._aabb._maxX,Vt=O._aabb._maxY,wt=O._aabb._maxZ,O._geom._computeAabb(O._aabb,O._transform),O._aabb._minX=Yt<O._aabb._minX?Yt:O._aabb._minX,O._aabb._minY=Zt<O._aabb._minY?Zt:O._aabb._minY,O._aabb._minZ=Mt<O._aabb._minZ?Mt:O._aabb._minZ,O._aabb._maxX=It>O._aabb._maxX?It:O._aabb._maxX,O._aabb._maxY=Vt>O._aabb._maxY?Vt:O._aabb._maxY,O._aabb._maxZ=wt>O._aabb._maxZ?wt:O._aabb._maxZ,null!=O._proxy){var At,Pt,St;At=O._transform._positionX-O._ptransform._positionX,Pt=O._transform._positionY-O._ptransform._positionY,St=O._transform._positionZ-O._ptransform._positionZ;var Tt=O.displacement;Tt.x=At,Tt.y=Pt,Tt.z=St,O._rigidBody._world._broadPhase.moveProxy(O._proxy,O._aabb,O.displacement)}O=_t}this._sleeping=!1,this._sleepTime=0}getOrientation(){var t,i,a,s,o,n=new pa.common.Quat,r=this._transform._rotation00,e=this._transform._rotation11,_=this._transform._rotation22,h=r+e+_;h>0?(s=.5*(o=Math.sqrt(h+1)),o=.5/o,t=(this._transform._rotation21-this._transform._rotation12)*o,i=(this._transform._rotation02-this._transform._rotation20)*o,a=(this._transform._rotation10-this._transform._rotation01)*o):r>e?r>_?(t=.5*(o=Math.sqrt(r-e-_+1)),o=.5/o,i=(this._transform._rotation01+this._transform._rotation10)*o,a=(this._transform._rotation02+this._transform._rotation20)*o,s=(this._transform._rotation21-this._transform._rotation12)*o):(a=.5*(o=Math.sqrt(_-r-e+1)),o=.5/o,t=(this._transform._rotation02+this._transform._rotation20)*o,i=(this._transform._rotation12+this._transform._rotation21)*o,s=(this._transform._rotation10-this._transform._rotation01)*o):e>_?(i=.5*(o=Math.sqrt(e-_-r+1)),o=.5/o,t=(this._transform._rotation01+this._transform._rotation10)*o,a=(this._transform._rotation12+this._transform._rotation21)*o,s=(this._transform._rotation02-this._transform._rotation20)*o):(a=.5*(o=Math.sqrt(_-r-e+1)),o=.5/o,t=(this._transform._rotation02+this._transform._rotation20)*o,i=(this._transform._rotation12+this._transform._rotation21)*o,s=(this._transform._rotation10-this._transform._rotation01)*o);var l=n;return l.x=t,l.y=i,l.z=a,l.w=s,n}getOrientationTo(t){var i,a,s,o,n,r=this._transform._rotation00,e=this._transform._rotation11,_=this._transform._rotation22,h=r+e+_;h>0?(o=.5*(n=Math.sqrt(h+1)),n=.5/n,i=(this._transform._rotation21-this._transform._rotation12)*n,a=(this._transform._rotation02-this._transform._rotation20)*n,s=(this._transform._rotation10-this._transform._rotation01)*n):r>e?r>_?(i=.5*(n=Math.sqrt(r-e-_+1)),n=.5/n,a=(this._transform._rotation01+this._transform._rotation10)*n,s=(this._transform._rotation02+this._transform._rotation20)*n,o=(this._transform._rotation21-this._transform._rotation12)*n):(s=.5*(n=Math.sqrt(_-r-e+1)),n=.5/n,i=(this._transform._rotation02+this._transform._rotation20)*n,a=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation10-this._transform._rotation01)*n):e>_?(a=.5*(n=Math.sqrt(e-_-r+1)),n=.5/n,i=(this._transform._rotation01+this._transform._rotation10)*n,s=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation02-this._transform._rotation20)*n):(s=.5*(n=Math.sqrt(_-r-e+1)),n=.5/n,i=(this._transform._rotation02+this._transform._rotation20)*n,a=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation10-this._transform._rotation01)*n);var l=t;l.x=i,l.y=a,l.z=s,l.w=o}setOrientation(t){var i,a,s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y,d,g,X,z=t,Y=(i=z.x,a=z.y,s=z.z,o=z.w,2*i),Z=2*a,M=2*s,I=i*Y,V=a*Z,w=s*M,L=i*Z,k=a*M,B=i*M,A=o*Y,P=o*Z,S=o*M;this._transform._rotation00=1-V-w,this._transform._rotation01=L-S,this._transform._rotation02=B+P,this._transform._rotation10=L+S,this._transform._rotation11=1-I-w,this._transform._rotation12=k-A,this._transform._rotation20=B-P,this._transform._rotation21=k+A,this._transform._rotation22=1-I-V,n=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,r=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,e=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,_=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,h=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,l=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,c=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,m=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,v=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=n,this._invInertia01=r,this._invInertia02=e,this._invInertia10=_,this._invInertia11=h,this._invInertia12=l,this._invInertia20=c,this._invInertia21=m,this._invInertia22=v,b=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,x=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,p=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,f=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,u=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,y=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,d=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,g=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,X=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=b,this._invInertia01=x,this._invInertia02=p,this._invInertia10=f,this._invInertia11=u,this._invInertia12=y,this._invInertia20=d,this._invInertia21=g,this._invInertia22=X,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var T=this._ptransform,C=this._transform;T._positionX=C._positionX,T._positionY=C._positionY,T._positionZ=C._positionZ,T._rotation00=C._rotation00,T._rotation01=C._rotation01,T._rotation02=C._rotation02,T._rotation10=C._rotation10,T._rotation11=C._rotation11,T._rotation12=C._rotation12,T._rotation20=C._rotation20,T._rotation21=C._rotation21,T._rotation22=C._rotation22;for(var j=this._shapeList;null!=j;){var R,E,q,N,F,D,G,W,J,U,O,H,Q=j._next,K=j._ptransform,$=j._localTransform,tt=this._ptransform;R=tt._rotation00*$._rotation00+tt._rotation01*$._rotation10+tt._rotation02*$._rotation20,E=tt._rotation00*$._rotation01+tt._rotation01*$._rotation11+tt._rotation02*$._rotation21,q=tt._rotation00*$._rotation02+tt._rotation01*$._rotation12+tt._rotation02*$._rotation22,N=tt._rotation10*$._rotation00+tt._rotation11*$._rotation10+tt._rotation12*$._rotation20,F=tt._rotation10*$._rotation01+tt._rotation11*$._rotation11+tt._rotation12*$._rotation21,D=tt._rotation10*$._rotation02+tt._rotation11*$._rotation12+tt._rotation12*$._rotation22,G=tt._rotation20*$._rotation00+tt._rotation21*$._rotation10+tt._rotation22*$._rotation20,W=tt._rotation20*$._rotation01+tt._rotation21*$._rotation11+tt._rotation22*$._rotation21,J=tt._rotation20*$._rotation02+tt._rotation21*$._rotation12+tt._rotation22*$._rotation22,K._rotation00=R,K._rotation01=E,K._rotation02=q,K._rotation10=N,K._rotation11=F,K._rotation12=D,K._rotation20=G,K._rotation21=W,K._rotation22=J,U=tt._rotation00*$._positionX+tt._rotation01*$._positionY+tt._rotation02*$._positionZ,O=tt._rotation10*$._positionX+tt._rotation11*$._positionY+tt._rotation12*$._positionZ,H=tt._rotation20*$._positionX+tt._rotation21*$._positionY+tt._rotation22*$._positionZ,K._positionX=U,K._positionY=O,K._positionZ=H,K._positionX+=tt._positionX,K._positionY+=tt._positionY,K._positionZ+=tt._positionZ;var it,at,st,ot,nt,rt,et,_t,ht,lt,ct,mt,vt,bt,xt,pt,ft,ut,yt=j._transform,dt=j._localTransform,gt=this._transform;if(it=gt._rotation00*dt._rotation00+gt._rotation01*dt._rotation10+gt._rotation02*dt._rotation20,at=gt._rotation00*dt._rotation01+gt._rotation01*dt._rotation11+gt._rotation02*dt._rotation21,st=gt._rotation00*dt._rotation02+gt._rotation01*dt._rotation12+gt._rotation02*dt._rotation22,ot=gt._rotation10*dt._rotation00+gt._rotation11*dt._rotation10+gt._rotation12*dt._rotation20,nt=gt._rotation10*dt._rotation01+gt._rotation11*dt._rotation11+gt._rotation12*dt._rotation21,rt=gt._rotation10*dt._rotation02+gt._rotation11*dt._rotation12+gt._rotation12*dt._rotation22,et=gt._rotation20*dt._rotation00+gt._rotation21*dt._rotation10+gt._rotation22*dt._rotation20,_t=gt._rotation20*dt._rotation01+gt._rotation21*dt._rotation11+gt._rotation22*dt._rotation21,ht=gt._rotation20*dt._rotation02+gt._rotation21*dt._rotation12+gt._rotation22*dt._rotation22,yt._rotation00=it,yt._rotation01=at,yt._rotation02=st,yt._rotation10=ot,yt._rotation11=nt,yt._rotation12=rt,yt._rotation20=et,yt._rotation21=_t,yt._rotation22=ht,lt=gt._rotation00*dt._positionX+gt._rotation01*dt._positionY+gt._rotation02*dt._positionZ,ct=gt._rotation10*dt._positionX+gt._rotation11*dt._positionY+gt._rotation12*dt._positionZ,mt=gt._rotation20*dt._positionX+gt._rotation21*dt._positionY+gt._rotation22*dt._positionZ,yt._positionX=lt,yt._positionY=ct,yt._positionZ=mt,yt._positionX+=gt._positionX,yt._positionY+=gt._positionY,yt._positionZ+=gt._positionZ,j._geom._computeAabb(j._aabb,j._ptransform),vt=j._aabb._minX,bt=j._aabb._minY,xt=j._aabb._minZ,pt=j._aabb._maxX,ft=j._aabb._maxY,ut=j._aabb._maxZ,j._geom._computeAabb(j._aabb,j._transform),j._aabb._minX=vt<j._aabb._minX?vt:j._aabb._minX,j._aabb._minY=bt<j._aabb._minY?bt:j._aabb._minY,j._aabb._minZ=xt<j._aabb._minZ?xt:j._aabb._minZ,j._aabb._maxX=pt>j._aabb._maxX?pt:j._aabb._maxX,j._aabb._maxY=ft>j._aabb._maxY?ft:j._aabb._maxY,j._aabb._maxZ=ut>j._aabb._maxZ?ut:j._aabb._maxZ,null!=j._proxy){var Xt,zt,Yt;Xt=j._transform._positionX-j._ptransform._positionX,zt=j._transform._positionY-j._ptransform._positionY,Yt=j._transform._positionZ-j._ptransform._positionZ;var Zt=j.displacement;Zt.x=Xt,Zt.y=zt,Zt.z=Yt,j._rigidBody._world._broadPhase.moveProxy(j._proxy,j._aabb,j.displacement)}j=Q}this._sleeping=!1,this._sleepTime=0}getTransform(){var t=this._transform,i=new pa.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i}getTransformTo(t){var i=this._transform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}setTransform(t){var i,a,s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u;this._transform._positionX=t._positionX,this._transform._positionY=t._positionY,this._transform._positionZ=t._positionZ,this._transform._rotation00=t._rotation00,this._transform._rotation01=t._rotation01,this._transform._rotation02=t._rotation02,this._transform._rotation10=t._rotation10,this._transform._rotation11=t._rotation11,this._transform._rotation12=t._rotation12,this._transform._rotation20=t._rotation20,this._transform._rotation21=t._rotation21,this._transform._rotation22=t._rotation22,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,a=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,s=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,n=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,e=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=a,this._invInertia02=s,this._invInertia10=o,this._invInertia11=n,this._invInertia12=r,this._invInertia20=e,this._invInertia21=_,this._invInertia22=h,l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,v=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,b=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,x=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,p=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,f=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,u=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=c,this._invInertia02=m,this._invInertia10=v,this._invInertia11=b,this._invInertia12=x,this._invInertia20=p,this._invInertia21=f,this._invInertia22=u,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var y=this._ptransform,d=this._transform;y._positionX=d._positionX,y._positionY=d._positionY,y._positionZ=d._positionZ,y._rotation00=d._rotation00,y._rotation01=d._rotation01,y._rotation02=d._rotation02,y._rotation10=d._rotation10,y._rotation11=d._rotation11,y._rotation12=d._rotation12,y._rotation20=d._rotation20,y._rotation21=d._rotation21,y._rotation22=d._rotation22;for(var g=this._shapeList;null!=g;){var X,z,Y,Z,M,I,V,w,L,k,B,A,P=g._next,S=g._ptransform,T=g._localTransform,C=this._ptransform;X=C._rotation00*T._rotation00+C._rotation01*T._rotation10+C._rotation02*T._rotation20,z=C._rotation00*T._rotation01+C._rotation01*T._rotation11+C._rotation02*T._rotation21,Y=C._rotation00*T._rotation02+C._rotation01*T._rotation12+C._rotation02*T._rotation22,Z=C._rotation10*T._rotation00+C._rotation11*T._rotation10+C._rotation12*T._rotation20,M=C._rotation10*T._rotation01+C._rotation11*T._rotation11+C._rotation12*T._rotation21,I=C._rotation10*T._rotation02+C._rotation11*T._rotation12+C._rotation12*T._rotation22,V=C._rotation20*T._rotation00+C._rotation21*T._rotation10+C._rotation22*T._rotation20,w=C._rotation20*T._rotation01+C._rotation21*T._rotation11+C._rotation22*T._rotation21,L=C._rotation20*T._rotation02+C._rotation21*T._rotation12+C._rotation22*T._rotation22,S._rotation00=X,S._rotation01=z,S._rotation02=Y,S._rotation10=Z,S._rotation11=M,S._rotation12=I,S._rotation20=V,S._rotation21=w,S._rotation22=L,k=C._rotation00*T._positionX+C._rotation01*T._positionY+C._rotation02*T._positionZ,B=C._rotation10*T._positionX+C._rotation11*T._positionY+C._rotation12*T._positionZ,A=C._rotation20*T._positionX+C._rotation21*T._positionY+C._rotation22*T._positionZ,S._positionX=k,S._positionY=B,S._positionZ=A,S._positionX+=C._positionX,S._positionY+=C._positionY,S._positionZ+=C._positionZ;var j,R,E,q,N,F,D,G,W,J,U,O,H,Q,K,$,tt,it,at=g._transform,st=g._localTransform,ot=this._transform;if(j=ot._rotation00*st._rotation00+ot._rotation01*st._rotation10+ot._rotation02*st._rotation20,R=ot._rotation00*st._rotation01+ot._rotation01*st._rotation11+ot._rotation02*st._rotation21,E=ot._rotation00*st._rotation02+ot._rotation01*st._rotation12+ot._rotation02*st._rotation22,q=ot._rotation10*st._rotation00+ot._rotation11*st._rotation10+ot._rotation12*st._rotation20,N=ot._rotation10*st._rotation01+ot._rotation11*st._rotation11+ot._rotation12*st._rotation21,F=ot._rotation10*st._rotation02+ot._rotation11*st._rotation12+ot._rotation12*st._rotation22,D=ot._rotation20*st._rotation00+ot._rotation21*st._rotation10+ot._rotation22*st._rotation20,G=ot._rotation20*st._rotation01+ot._rotation21*st._rotation11+ot._rotation22*st._rotation21,W=ot._rotation20*st._rotation02+ot._rotation21*st._rotation12+ot._rotation22*st._rotation22,at._rotation00=j,at._rotation01=R,at._rotation02=E,at._rotation10=q,at._rotation11=N,at._rotation12=F,at._rotation20=D,at._rotation21=G,at._rotation22=W,J=ot._rotation00*st._positionX+ot._rotation01*st._positionY+ot._rotation02*st._positionZ,U=ot._rotation10*st._positionX+ot._rotation11*st._positionY+ot._rotation12*st._positionZ,O=ot._rotation20*st._positionX+ot._rotation21*st._positionY+ot._rotation22*st._positionZ,at._positionX=J,at._positionY=U,at._positionZ=O,at._positionX+=ot._positionX,at._positionY+=ot._positionY,at._positionZ+=ot._positionZ,g._geom._computeAabb(g._aabb,g._ptransform),H=g._aabb._minX,Q=g._aabb._minY,K=g._aabb._minZ,$=g._aabb._maxX,tt=g._aabb._maxY,it=g._aabb._maxZ,g._geom._computeAabb(g._aabb,g._transform),g._aabb._minX=H<g._aabb._minX?H:g._aabb._minX,g._aabb._minY=Q<g._aabb._minY?Q:g._aabb._minY,g._aabb._minZ=K<g._aabb._minZ?K:g._aabb._minZ,g._aabb._maxX=$>g._aabb._maxX?$:g._aabb._maxX,g._aabb._maxY=tt>g._aabb._maxY?tt:g._aabb._maxY,g._aabb._maxZ=it>g._aabb._maxZ?it:g._aabb._maxZ,null!=g._proxy){var nt,rt,et;nt=g._transform._positionX-g._ptransform._positionX,rt=g._transform._positionY-g._ptransform._positionY,et=g._transform._positionZ-g._ptransform._positionZ;var _t=g.displacement;_t.x=nt,_t.y=rt,_t.z=et,g._rigidBody._world._broadPhase.moveProxy(g._proxy,g._aabb,g.displacement)}g=P}this._sleeping=!1,this._sleepTime=0}getMass(){return this._mass}getLocalInertia(){var t=new pa.common.Mat3,i=t;return i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22,t}getLocalInertiaTo(t){var i=t;i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22}getMassData(){var t=new pa.dynamics.rigidbody.MassData;t.mass=this._mass;var i=t.localInertia;return i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22,t}getMassDataTo(t){t.mass=this._mass;var i=t.localInertia;i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22}setMassData(t){this._mass=t.mass;var i=t.localInertia;this._localInertia00=i.e00,this._localInertia01=i.e01,this._localInertia02=i.e02,this._localInertia10=i.e10,this._localInertia11=i.e11,this._localInertia12=i.e12,this._localInertia20=i.e20,this._localInertia21=i.e21,this._localInertia22=i.e22;var a,s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y,d=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,g=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,X=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,z=this._localInertia00*d-this._localInertia01*g+this._localInertia02*X;if(this._mass>0&&z>0&&0==this._type){this._invMass=1/this._mass;var Y=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,Z=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,M=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,I=this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21,V=this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20,w=this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20,L=this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11,k=this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10,B=this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10,A=this._localInertia00*Y-this._localInertia01*Z+this._localInertia02*M;(A<-1e-32||A>1e-32)&&(A=1/A),this._invLocalInertia00=Y*A,this._invLocalInertia01=-I*A,this._invLocalInertia02=L*A,this._invLocalInertia10=-Z*A,this._invLocalInertia11=V*A,this._invLocalInertia12=-k*A,this._invLocalInertia20=M*A,this._invLocalInertia21=-w*A,this._invLocalInertia22=B*A,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,0==this._type&&(this._type=1);a=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,s=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,o=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,n=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,r=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,e=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,_=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,h=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=a,this._invInertia01=s,this._invInertia02=o,this._invInertia10=n,this._invInertia11=r,this._invInertia12=e,this._invInertia20=_,this._invInertia21=h,this._invInertia22=l,c=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,m=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,v=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,b=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,x=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,p=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,f=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,u=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,y=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=c,this._invInertia01=m,this._invInertia02=v,this._invInertia10=b,this._invInertia11=x,this._invInertia12=p,this._invInertia20=f,this._invInertia21=u,this._invInertia22=y,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getRotationFactor(){var t=this._rotFactor;return new pa.common.Vec3(t.x,t.y,t.z)}setRotationFactor(t){var i,a,s,o,n,r,e,_,h,l,c,m,v,b,x,p,f,u,y=this._rotFactor;y.x=t.x,y.y=t.y,y.z=t.z,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,a=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,s=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,n=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,e=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=a,this._invInertia02=s,this._invInertia10=o,this._invInertia11=n,this._invInertia12=r,this._invInertia20=e,this._invInertia21=_,this._invInertia22=h,l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,v=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,b=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,x=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,p=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,f=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,u=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=c,this._invInertia02=m,this._invInertia10=v,this._invInertia11=b,this._invInertia12=x,this._invInertia20=p,this._invInertia21=f,this._invInertia22=u,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getLinearVelocity(){var t=new pa.common.Vec3,i=t;return i.x=this._velX,i.y=this._velY,i.z=this._velZ,t}getLinearVelocityTo(t){var i=t;i.x=this._velX,i.y=this._velY,i.z=this._velZ}setLinearVelocity(t){if(1==this._type)this._velX=0,this._velY=0,this._velZ=0;else{var i=t;this._velX=i.x,this._velY=i.y,this._velZ=i.z}this._sleeping=!1,this._sleepTime=0}getAngularVelocity(){var t=new pa.common.Vec3,i=t;return i.x=this._angVelX,i.y=this._angVelY,i.z=this._angVelZ,t}getAngularVelocityTo(t){var i=t;i.x=this._velX,i.y=this._velY,i.z=this._velZ}setAngularVelocity(t){if(1==this._type)this._angVelX=0,this._angVelY=0,this._angVelZ=0;else{var i=t;this._angVelX=i.x,this._angVelY=i.y,this._angVelZ=i.z}this._sleeping=!1,this._sleepTime=0}addLinearVelocity(t){if(1!=this._type){var i,a,s,o=t;i=o.x,a=o.y,s=o.z,this._velX+=i,this._velY+=a,this._velZ+=s}this._sleeping=!1,this._sleepTime=0}addAngularVelocity(t){if(1!=this._type){var i,a,s,o=t;i=o.x,a=o.y,s=o.z,this._angVelX+=i,this._angVelY+=a,this._angVelZ+=s}this._sleeping=!1,this._sleepTime=0}applyImpulse(t,i){var a,s,o,n,r,e,_,h,l,c=t;a=c.x,s=c.y,o=c.z,this._velX+=a*this._invMass,this._velY+=s*this._invMass,this._velZ+=o*this._invMass;var m,v,b,x=i;_=x.x,h=x.y,l=x.z,_-=this._transform._positionX,n=(h-=this._transform._positionY)*o-(l-=this._transform._positionZ)*s,r=l*a-_*o,e=_*s-h*a,m=this._invInertia00*n+this._invInertia01*r+this._invInertia02*e,v=this._invInertia10*n+this._invInertia11*r+this._invInertia12*e,b=this._invInertia20*n+this._invInertia21*r+this._invInertia22*e,n=m,r=v,e=b,this._angVelX+=n,this._angVelY+=r,this._angVelZ+=e,this._sleeping=!1,this._sleepTime=0}applyLinearImpulse(t){var i,a,s,o=t;i=o.x,a=o.y,s=o.z,this._velX+=i*this._invMass,this._velY+=a*this._invMass,this._velZ+=s*this._invMass,this._sleeping=!1,this._sleepTime=0}applyAngularImpulse(t){var i,a,s,o,n,r,e=t;i=e.x,a=e.y,s=e.z,o=this._invInertia00*i+this._invInertia01*a+this._invInertia02*s,n=this._invInertia10*i+this._invInertia11*a+this._invInertia12*s,r=this._invInertia20*i+this._invInertia21*a+this._invInertia22*s,i=o,a=n,s=r,this._angVelX+=i,this._angVelY+=a,this._angVelZ+=s,this._sleeping=!1,this._sleepTime=0}applyForce(t,i){var a,s,o,n,r,e,_,h,l,c=t;a=c.x,s=c.y,o=c.z,this._forceX+=a,this._forceY+=s,this._forceZ+=o;var m=i;_=m.x,h=m.y,l=m.z,_-=this._transform._positionX,n=(h-=this._transform._positionY)*o-(l-=this._transform._positionZ)*s,r=l*a-_*o,e=_*s-h*a,this._torqueX+=n,this._torqueY+=r,this._torqueZ+=e,this._sleeping=!1,this._sleepTime=0}applyForceToCenter(t){var i,a,s,o=t;i=o.x,a=o.y,s=o.z,this._forceX+=i,this._forceY+=a,this._forceZ+=s,this._sleeping=!1,this._sleepTime=0}applyTorque(t){var i,a,s,o=t;i=o.x,a=o.y,s=o.z,this._torqueX+=i,this._torqueY+=a,this._torqueZ+=s,this._sleeping=!1,this._sleepTime=0}getLinearContactImpulse(){var t=new pa.common.Vec3,i=t;return i.x=this._linearContactImpulseX,i.y=this._linearContactImpulseY,i.z=this._linearContactImpulseZ,t}getLinearContactImpulseTo(t){var i=t;i.x=this._linearContactImpulseX,i.y=this._linearContactImpulseY,i.z=this._linearContactImpulseZ}getAngularContactImpulse(){var t=new pa.common.Vec3,i=t;return i.x=this._angularContactImpulseX,i.y=this._angularContactImpulseY,i.z=this._angularContactImpulseZ,t}getAngularContactImpulseTo(t){var i=t;i.x=this._angularContactImpulseX,i.y=this._angularContactImpulseY,i.z=this._angularContactImpulseZ}getGravityScale(){return this._gravityScale}setGravityScale(t){this._gravityScale=t,this._sleeping=!1,this._sleepTime=0}getLocalPoint(t){var i,a,s,o,n,r,e=t;i=e.x,a=e.y,s=e.z,i-=this._transform._positionX,a-=this._transform._positionY,s-=this._transform._positionZ,o=this._transform._rotation00*i+this._transform._rotation10*a+this._transform._rotation20*s,n=this._transform._rotation01*i+this._transform._rotation11*a+this._transform._rotation21*s,r=this._transform._rotation02*i+this._transform._rotation12*a+this._transform._rotation22*s,i=o,a=n,s=r;var _=new pa.common.Vec3,h=_;return h.x=i,h.y=a,h.z=s,_}getLocalPointTo(t,i){var a,s,o,n,r,e,_=t;a=_.x,s=_.y,o=_.z,a-=this._transform._positionX,s-=this._transform._positionY,o-=this._transform._positionZ,n=this._transform._rotation00*a+this._transform._rotation10*s+this._transform._rotation20*o,r=this._transform._rotation01*a+this._transform._rotation11*s+this._transform._rotation21*o,e=this._transform._rotation02*a+this._transform._rotation12*s+this._transform._rotation22*o,a=n,s=r,o=e;var h=i;h.x=a,h.y=s,h.z=o}getLocalVector(t){var i,a,s,o,n,r,e=t;i=e.x,a=e.y,s=e.z,o=this._transform._rotation00*i+this._transform._rotation10*a+this._transform._rotation20*s,n=this._transform._rotation01*i+this._transform._rotation11*a+this._transform._rotation21*s,r=this._transform._rotation02*i+this._transform._rotation12*a+this._transform._rotation22*s,i=o,a=n,s=r;var _=new pa.common.Vec3,h=_;return h.x=i,h.y=a,h.z=s,_}getLocalVectorTo(t,i){var a,s,o,n,r,e,_=t;a=_.x,s=_.y,o=_.z,n=this._transform._rotation00*a+this._transform._rotation10*s+this._transform._rotation20*o,r=this._transform._rotation01*a+this._transform._rotation11*s+this._transform._rotation21*o,e=this._transform._rotation02*a+this._transform._rotation12*s+this._transform._rotation22*o,a=n,s=r,o=e;var h=i;h.x=a,h.y=s,h.z=o}getWorldPoint(t){var i,a,s,o,n,r,e=t;i=e.x,a=e.y,s=e.z,o=this._transform._rotation00*i+this._transform._rotation01*a+this._transform._rotation02*s,n=this._transform._rotation10*i+this._transform._rotation11*a+this._transform._rotation12*s,r=this._transform._rotation20*i+this._transform._rotation21*a+this._transform._rotation22*s,i=o,a=n,s=r,i+=this._transform._positionX,a+=this._transform._positionY,s+=this._transform._positionZ;var _=new pa.common.Vec3,h=_;return h.x=i,h.y=a,h.z=s,_}getWorldPointTo(t,i){var a,s,o,n,r,e,_=t;a=_.x,s=_.y,o=_.z,n=this._transform._rotation00*a+this._transform._rotation01*s+this._transform._rotation02*o,r=this._transform._rotation10*a+this._transform._rotation11*s+this._transform._rotation12*o,e=this._transform._rotation20*a+this._transform._rotation21*s+this._transform._rotation22*o,a=n,s=r,o=e,a+=this._transform._positionX,s+=this._transform._positionY,o+=this._transform._positionZ;var h=i;h.x=a,h.y=s,h.z=o}getWorldVector(t){var i,a,s,o,n,r,e=t;i=e.x,a=e.y,s=e.z,o=this._transform._rotation00*i+this._transform._rotation01*a+this._transform._rotation02*s,n=this._transform._rotation10*i+this._transform._rotation11*a+this._transform._rotation12*s,r=this._transform._rotation20*i+this._transform._rotation21*a+this._transform._rotation22*s,i=o,a=n,s=r;var _=new pa.common.Vec3,h=_;return h.x=i,h.y=a,h.z=s,_}getWorldVectorTo(t,i){var a,s,o,n,r,e,_=t;a=_.x,s=_.y,o=_.z,n=this._transform._rotation00*a+this._transform._rotation01*s+this._transform._rotation02*o,r=this._transform._rotation10*a+this._transform._rotation11*s+this._transform._rotation12*o,e=this._transform._rotation20*a+this._transform._rotation21*s+this._transform._rotation22*o,a=n,s=r,o=e;var h=i;h.x=a,h.y=s,h.z=o}getNumShapes(){return this._numShapes}getShapeList(){return this._shapeList}getNumContectLinks(){return this._numContactLinks}getContactLinkList(){return this._contactLinkList}getNumJointLinks(){return this._numJointLinks}getJointLinkList(){return this._jointLinkList}addShape(t){if(null==this._shapeList?(this._shapeList=t,this._shapeListLast=t):(this._shapeListLast._next=t,t._prev=this._shapeListLast,this._shapeListLast=t),this._numShapes++,t._rigidBody=this,null!=this._world){var i=this._world;t._proxy=i._broadPhase.createProxy(t,t._aabb),t._id=i._shapeIdCount++,i._numShapes++}this.updateMass();for(var a=this._shapeList;null!=a;){var s,o,n,r,e,_,h,l,c,m,v,b,x=a._next,p=a._ptransform,f=a._localTransform,u=this._ptransform;s=u._rotation00*f._rotation00+u._rotation01*f._rotation10+u._rotation02*f._rotation20,o=u._rotation00*f._rotation01+u._rotation01*f._rotation11+u._rotation02*f._rotation21,n=u._rotation00*f._rotation02+u._rotation01*f._rotation12+u._rotation02*f._rotation22,r=u._rotation10*f._rotation00+u._rotation11*f._rotation10+u._rotation12*f._rotation20,e=u._rotation10*f._rotation01+u._rotation11*f._rotation11+u._rotation12*f._rotation21,_=u._rotation10*f._rotation02+u._rotation11*f._rotation12+u._rotation12*f._rotation22,h=u._rotation20*f._rotation00+u._rotation21*f._rotation10+u._rotation22*f._rotation20,l=u._rotation20*f._rotation01+u._rotation21*f._rotation11+u._rotation22*f._rotation21,c=u._rotation20*f._rotation02+u._rotation21*f._rotation12+u._rotation22*f._rotation22,p._rotation00=s,p._rotation01=o,p._rotation02=n,p._rotation10=r,p._rotation11=e,p._rotation12=_,p._rotation20=h,p._rotation21=l,p._rotation22=c,m=u._rotation00*f._positionX+u._rotation01*f._positionY+u._rotation02*f._positionZ,v=u._rotation10*f._positionX+u._rotation11*f._positionY+u._rotation12*f._positionZ,b=u._rotation20*f._positionX+u._rotation21*f._positionY+u._rotation22*f._positionZ,p._positionX=m,p._positionY=v,p._positionZ=b,p._positionX+=u._positionX,p._positionY+=u._positionY,p._positionZ+=u._positionZ;var y,d,g,X,z,Y,Z,M,I,V,w,L,k,B,A,P,S,T,C=a._transform,j=a._localTransform,R=this._transform;if(y=R._rotation00*j._rotation00+R._rotation01*j._rotation10+R._rotation02*j._rotation20,d=R._rotation00*j._rotation01+R._rotation01*j._rotation11+R._rotation02*j._rotation21,g=R._rotation00*j._rotation02+R._rotation01*j._rotation12+R._rotation02*j._rotation22,X=R._rotation10*j._rotation00+R._rotation11*j._rotation10+R._rotation12*j._rotation20,z=R._rotation10*j._rotation01+R._rotation11*j._rotation11+R._rotation12*j._rotation21,Y=R._rotation10*j._rotation02+R._rotation11*j._rotation12+R._rotation12*j._rotation22,Z=R._rotation20*j._rotation00+R._rotation21*j._rotation10+R._rotation22*j._rotation20,M=R._rotation20*j._rotation01+R._rotation21*j._rotation11+R._rotation22*j._rotation21,I=R._rotation20*j._rotation02+R._rotation21*j._rotation12+R._rotation22*j._rotation22,C._rotation00=y,C._rotation01=d,C._rotation02=g,C._rotation10=X,C._rotation11=z,C._rotation12=Y,C._rotation20=Z,C._rotation21=M,C._rotation22=I,V=R._rotation00*j._positionX+R._rotation01*j._positionY+R._rotation02*j._positionZ,w=R._rotation10*j._positionX+R._rotation11*j._positionY+R._rotation12*j._positionZ,L=R._rotation20*j._positionX+R._rotation21*j._positionY+R._rotation22*j._positionZ,C._positionX=V,C._positionY=w,C._positionZ=L,C._positionX+=R._positionX,C._positionY+=R._positionY,C._positionZ+=R._positionZ,a._geom._computeAabb(a._aabb,a._ptransform),k=a._aabb._minX,B=a._aabb._minY,A=a._aabb._minZ,P=a._aabb._maxX,S=a._aabb._maxY,T=a._aabb._maxZ,a._geom._computeAabb(a._aabb,a._transform),a._aabb._minX=k<a._aabb._minX?k:a._aabb._minX,a._aabb._minY=B<a._aabb._minY?B:a._aabb._minY,a._aabb._minZ=A<a._aabb._minZ?A:a._aabb._minZ,a._aabb._maxX=P>a._aabb._maxX?P:a._aabb._maxX,a._aabb._maxY=S>a._aabb._maxY?S:a._aabb._maxY,a._aabb._maxZ=T>a._aabb._maxZ?T:a._aabb._maxZ,null!=a._proxy){var E,q,N;E=a._transform._positionX-a._ptransform._positionX,q=a._transform._positionY-a._ptransform._positionY,N=a._transform._positionZ-a._ptransform._positionZ;var F=a.displacement;F.x=E,F.y=q,F.z=N,a._rigidBody._world._broadPhase.moveProxy(a._proxy,a._aabb,a.displacement)}a=x}}removeShape(t){var i=t._prev,a=t._next;if(null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._shapeList&&(this._shapeList=this._shapeList._next),t==this._shapeListLast&&(this._shapeListLast=this._shapeListLast._prev),t._next=null,t._prev=null,this._numShapes--,t._rigidBody=null,null!=this._world){var s=this._world;s._broadPhase.destroyProxy(t._proxy),t._proxy=null,t._id=-1;for(var o=t._rigidBody._contactLinkList;null!=o;){var n=o._next,r=o._contact;if(r._s1==t||r._s2==t){var e=o._other;e._sleeping=!1,e._sleepTime=0;var _=s._contactManager,h=r._prev,l=r._next;if(null!=h&&(h._next=l),null!=l&&(l._prev=h),r==_._contactList&&(_._contactList=_._contactList._next),r==_._contactListLast&&(_._contactListLast=_._contactListLast._prev),r._next=null,r._prev=null,r._touching){var c=r._s1._contactCallback,m=r._s2._contactCallback;c==m&&(m=null),null!=c&&c.endContact(r),null!=m&&m.endContact(r)}var v=r._link1._prev,b=r._link1._next;null!=v&&(v._next=b),null!=b&&(b._prev=v),r._link1==r._b1._contactLinkList&&(r._b1._contactLinkList=r._b1._contactLinkList._next),r._link1==r._b1._contactLinkListLast&&(r._b1._contactLinkListLast=r._b1._contactLinkListLast._prev),r._link1._next=null,r._link1._prev=null;var x=r._link2._prev,p=r._link2._next;null!=x&&(x._next=p),null!=p&&(p._prev=x),r._link2==r._b2._contactLinkList&&(r._b2._contactLinkList=r._b2._contactLinkList._next),r._link2==r._b2._contactLinkListLast&&(r._b2._contactLinkListLast=r._b2._contactLinkListLast._prev),r._link2._next=null,r._link2._prev=null,r._b1._numContactLinks--,r._b2._numContactLinks--,r._link1._other=null,r._link2._other=null,r._link1._contact=null,r._link2._contact=null,r._s1=null,r._s2=null,r._b1=null,r._b2=null,r._touching=!1,r._cachedDetectorData._clear(),r._manifold._clear(),r._detector=null;var f=r._contactConstraint;f._s1=null,f._s2=null,f._b1=null,f._b2=null,f._tf1=null,f._tf2=null,r._next=_._contactPool,_._contactPool=r,_._numContacts--}o=n}s._numShapes--}this.updateMass();for(var u=this._shapeList;null!=u;){var y,d,g,X,z,Y,Z,M,I,V,w,L,k=u._next,B=u._ptransform,A=u._localTransform,P=this._ptransform;y=P._rotation00*A._rotation00+P._rotation01*A._rotation10+P._rotation02*A._rotation20,d=P._rotation00*A._rotation01+P._rotation01*A._rotation11+P._rotation02*A._rotation21,g=P._rotation00*A._rotation02+P._rotation01*A._rotation12+P._rotation02*A._rotation22,X=P._rotation10*A._rotation00+P._rotation11*A._rotation10+P._rotation12*A._rotation20,z=P._rotation10*A._rotation01+P._rotation11*A._rotation11+P._rotation12*A._rotation21,Y=P._rotation10*A._rotation02+P._rotation11*A._rotation12+P._rotation12*A._rotation22,Z=P._rotation20*A._rotation00+P._rotation21*A._rotation10+P._rotation22*A._rotation20,M=P._rotation20*A._rotation01+P._rotation21*A._rotation11+P._rotation22*A._rotation21,I=P._rotation20*A._rotation02+P._rotation21*A._rotation12+P._rotation22*A._rotation22,B._rotation00=y,B._rotation01=d,B._rotation02=g,B._rotation10=X,B._rotation11=z,B._rotation12=Y,B._rotation20=Z,B._rotation21=M,B._rotation22=I,V=P._rotation00*A._positionX+P._rotation01*A._positionY+P._rotation02*A._positionZ,w=P._rotation10*A._positionX+P._rotation11*A._positionY+P._rotation12*A._positionZ,L=P._rotation20*A._positionX+P._rotation21*A._positionY+P._rotation22*A._positionZ,B._positionX=V,B._positionY=w,B._positionZ=L,B._positionX+=P._positionX,B._positionY+=P._positionY,B._positionZ+=P._positionZ;var S,T,C,j,R,E,q,N,F,D,G,W,J,U,O,H,Q,K,$=u._transform,tt=u._localTransform,it=this._transform;if(S=it._rotation00*tt._rotation00+it._rotation01*tt._rotation10+it._rotation02*tt._rotation20,T=it._rotation00*tt._rotation01+it._rotation01*tt._rotation11+it._rotation02*tt._rotation21,C=it._rotation00*tt._rotation02+it._rotation01*tt._rotation12+it._rotation02*tt._rotation22,j=it._rotation10*tt._rotation00+it._rotation11*tt._rotation10+it._rotation12*tt._rotation20,R=it._rotation10*tt._rotation01+it._rotation11*tt._rotation11+it._rotation12*tt._rotation21,E=it._rotation10*tt._rotation02+it._rotation11*tt._rotation12+it._rotation12*tt._rotation22,q=it._rotation20*tt._rotation00+it._rotation21*tt._rotation10+it._rotation22*tt._rotation20,N=it._rotation20*tt._rotation01+it._rotation21*tt._rotation11+it._rotation22*tt._rotation21,F=it._rotation20*tt._rotation02+it._rotation21*tt._rotation12+it._rotation22*tt._rotation22,$._rotation00=S,$._rotation01=T,$._rotation02=C,$._rotation10=j,$._rotation11=R,$._rotation12=E,$._rotation20=q,$._rotation21=N,$._rotation22=F,D=it._rotation00*tt._positionX+it._rotation01*tt._positionY+it._rotation02*tt._positionZ,G=it._rotation10*tt._positionX+it._rotation11*tt._positionY+it._rotation12*tt._positionZ,W=it._rotation20*tt._positionX+it._rotation21*tt._positionY+it._rotation22*tt._positionZ,$._positionX=D,$._positionY=G,$._positionZ=W,$._positionX+=it._positionX,$._positionY+=it._positionY,$._positionZ+=it._positionZ,u._geom._computeAabb(u._aabb,u._ptransform),J=u._aabb._minX,U=u._aabb._minY,O=u._aabb._minZ,H=u._aabb._maxX,Q=u._aabb._maxY,K=u._aabb._maxZ,u._geom._computeAabb(u._aabb,u._transform),u._aabb._minX=J<u._aabb._minX?J:u._aabb._minX,u._aabb._minY=U<u._aabb._minY?U:u._aabb._minY,u._aabb._minZ=O<u._aabb._minZ?O:u._aabb._minZ,u._aabb._maxX=H>u._aabb._maxX?H:u._aabb._maxX,u._aabb._maxY=Q>u._aabb._maxY?Q:u._aabb._maxY,u._aabb._maxZ=K>u._aabb._maxZ?K:u._aabb._maxZ,null!=u._proxy){var at,st,ot;at=u._transform._positionX-u._ptransform._positionX,st=u._transform._positionY-u._ptransform._positionY,ot=u._transform._positionZ-u._ptransform._positionZ;var nt=u.displacement;nt.x=at,nt.y=st,nt.z=ot,u._rigidBody._world._broadPhase.moveProxy(u._proxy,u._aabb,u.displacement)}u=k}}getType(){return this._type}setType(t){this._type=t,this.updateMass()}wakeUp(){this._sleeping=!1,this._sleepTime=0}sleep(){this._sleeping=!0,this._sleepTime=0}isSleeping(){return this._sleeping}getSleepTime(){return this._sleepTime}setAutoSleep(t){this._autoSleep=t,this._sleeping=!1,this._sleepTime=0}getLinearDamping(){return this._linearDamping}setLinearDamping(t){this._linearDamping=t}getAngularDamping(){return this._angularDamping}setAngularDamping(t){this._angularDamping=t}getPrev(){return this._prev}getNext(){return this._next}},pa.dynamics.rigidbody.RigidBodyConfig=class{constructor(){this.position=new pa.common.Vec3,this.rotation=new pa.common.Mat3,this.linearVelocity=new pa.common.Vec3,this.angularVelocity=new pa.common.Vec3,this.type=0,this.autoSleep=!0,this.linearDamping=0,this.angularDamping=0}},pa.dynamics.rigidbody.RigidBodyType=class{},pa.dynamics.rigidbody.Shape=class{constructor(t){this._id=-1,this._localTransform=new pa.common.Transform,this._ptransform=new pa.common.Transform,this._transform=new pa.common.Transform;var i=t.position;this._localTransform._positionX=i.x,this._localTransform._positionY=i.y,this._localTransform._positionZ=i.z;var a=t.rotation;this._localTransform._rotation00=a.e00,this._localTransform._rotation01=a.e01,this._localTransform._rotation02=a.e02,this._localTransform._rotation10=a.e10,this._localTransform._rotation11=a.e11,this._localTransform._rotation12=a.e12,this._localTransform._rotation20=a.e20,this._localTransform._rotation21=a.e21,this._localTransform._rotation22=a.e22;var s=this._ptransform,o=this._localTransform;s._positionX=o._positionX,s._positionY=o._positionY,s._positionZ=o._positionZ,s._rotation00=o._rotation00,s._rotation01=o._rotation01,s._rotation02=o._rotation02,s._rotation10=o._rotation10,s._rotation11=o._rotation11,s._rotation12=o._rotation12,s._rotation20=o._rotation20,s._rotation21=o._rotation21,s._rotation22=o._rotation22;var n=this._transform,r=this._localTransform;n._positionX=r._positionX,n._positionY=r._positionY,n._positionZ=r._positionZ,n._rotation00=r._rotation00,n._rotation01=r._rotation01,n._rotation02=r._rotation02,n._rotation10=r._rotation10,n._rotation11=r._rotation11,n._rotation12=r._rotation12,n._rotation20=r._rotation20,n._rotation21=r._rotation21,n._rotation22=r._rotation22,this._restitution=t.restitution,this._friction=t.friction,this._density=t.density,this._geom=t.geometry,this._collisionGroup=t.collisionGroup,this._collisionMask=t.collisionMask,this._contactCallback=t.contactCallback,this._aabb=new pa.collision.geometry.Aabb,this._proxy=null,this.displacement=new pa.common.Vec3}getFriction(){return this._friction}setFriction(t){this._friction=t}getRestitution(){return this._restitution}setRestitution(t){this._restitution=t}getLocalTransform(){var t=this._localTransform,i=new pa.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i}getLocalTransformTo(t){var i=this._localTransform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}getTransform(){var t=this._transform,i=new pa.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i}getTransformTo(t){var i=this._transform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}setLocalTransform(t){var i=this._localTransform;if(i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,null!=this._rigidBody){var a=this._rigidBody;a.updateMass();for(var s=a._shapeList;null!=s;){var o,n,r,e,_,h,l,c,m,v,b,x,p=s._next,f=s._ptransform,u=s._localTransform,y=a._ptransform;o=y._rotation00*u._rotation00+y._rotation01*u._rotation10+y._rotation02*u._rotation20,n=y._rotation00*u._rotation01+y._rotation01*u._rotation11+y._rotation02*u._rotation21,r=y._rotation00*u._rotation02+y._rotation01*u._rotation12+y._rotation02*u._rotation22,e=y._rotation10*u._rotation00+y._rotation11*u._rotation10+y._rotation12*u._rotation20,_=y._rotation10*u._rotation01+y._rotation11*u._rotation11+y._rotation12*u._rotation21,h=y._rotation10*u._rotation02+y._rotation11*u._rotation12+y._rotation12*u._rotation22,l=y._rotation20*u._rotation00+y._rotation21*u._rotation10+y._rotation22*u._rotation20,c=y._rotation20*u._rotation01+y._rotation21*u._rotation11+y._rotation22*u._rotation21,m=y._rotation20*u._rotation02+y._rotation21*u._rotation12+y._rotation22*u._rotation22,f._rotation00=o,f._rotation01=n,f._rotation02=r,f._rotation10=e,f._rotation11=_,f._rotation12=h,f._rotation20=l,f._rotation21=c,f._rotation22=m,v=y._rotation00*u._positionX+y._rotation01*u._positionY+y._rotation02*u._positionZ,b=y._rotation10*u._positionX+y._rotation11*u._positionY+y._rotation12*u._positionZ,x=y._rotation20*u._positionX+y._rotation21*u._positionY+y._rotation22*u._positionZ,f._positionX=v,f._positionY=b,f._positionZ=x,f._positionX+=y._positionX,f._positionY+=y._positionY,f._positionZ+=y._positionZ;var d,g,X,z,Y,Z,M,I,V,w,L,k,B,A,P,S,T,C,j=s._transform,R=s._localTransform,E=a._transform;if(d=E._rotation00*R._rotation00+E._rotation01*R._rotation10+E._rotation02*R._rotation20,g=E._rotation00*R._rotation01+E._rotation01*R._rotation11+E._rotation02*R._rotation21,X=E._rotation00*R._rotation02+E._rotation01*R._rotation12+E._rotation02*R._rotation22,z=E._rotation10*R._rotation00+E._rotation11*R._rotation10+E._rotation12*R._rotation20,Y=E._rotation10*R._rotation01+E._rotation11*R._rotation11+E._rotation12*R._rotation21,Z=E._rotation10*R._rotation02+E._rotation11*R._rotation12+E._rotation12*R._rotation22,M=E._rotation20*R._rotation00+E._rotation21*R._rotation10+E._rotation22*R._rotation20,I=E._rotation20*R._rotation01+E._rotation21*R._rotation11+E._rotation22*R._rotation21,V=E._rotation20*R._rotation02+E._rotation21*R._rotation12+E._rotation22*R._rotation22,j._rotation00=d,j._rotation01=g,j._rotation02=X,j._rotation10=z,j._rotation11=Y,j._rotation12=Z,j._rotation20=M,j._rotation21=I,j._rotation22=V,w=E._rotation00*R._positionX+E._rotation01*R._positionY+E._rotation02*R._positionZ,L=E._rotation10*R._positionX+E._rotation11*R._positionY+E._rotation12*R._positionZ,k=E._rotation20*R._positionX+E._rotation21*R._positionY+E._rotation22*R._positionZ,j._positionX=w,j._positionY=L,j._positionZ=k,j._positionX+=E._positionX,j._positionY+=E._positionY,j._positionZ+=E._positionZ,s._geom._computeAabb(s._aabb,s._ptransform),B=s._aabb._minX,A=s._aabb._minY,P=s._aabb._minZ,S=s._aabb._maxX,T=s._aabb._maxY,C=s._aabb._maxZ,s._geom._computeAabb(s._aabb,s._transform),s._aabb._minX=B<s._aabb._minX?B:s._aabb._minX,s._aabb._minY=A<s._aabb._minY?A:s._aabb._minY,s._aabb._minZ=P<s._aabb._minZ?P:s._aabb._minZ,s._aabb._maxX=S>s._aabb._maxX?S:s._aabb._maxX,s._aabb._maxY=T>s._aabb._maxY?T:s._aabb._maxY,s._aabb._maxZ=C>s._aabb._maxZ?C:s._aabb._maxZ,null!=s._proxy){var q,N,F;q=s._transform._positionX-s._ptransform._positionX,N=s._transform._positionY-s._ptransform._positionY,F=s._transform._positionZ-s._ptransform._positionZ;var D=s.displacement;D.x=q,D.y=N,D.z=F,s._rigidBody._world._broadPhase.moveProxy(s._proxy,s._aabb,s.displacement)}s=p}}}getDensity(){return this._density}setDensity(t){if(this._density=t,null!=this._rigidBody){var i=this._rigidBody;i.updateMass();for(var a=i._shapeList;null!=a;){var s,o,n,r,e,_,h,l,c,m,v,b,x=a._next,p=a._ptransform,f=a._localTransform,u=i._ptransform;s=u._rotation00*f._rotation00+u._rotation01*f._rotation10+u._rotation02*f._rotation20,o=u._rotation00*f._rotation01+u._rotation01*f._rotation11+u._rotation02*f._rotation21,n=u._rotation00*f._rotation02+u._rotation01*f._rotation12+u._rotation02*f._rotation22,r=u._rotation10*f._rotation00+u._rotation11*f._rotation10+u._rotation12*f._rotation20,e=u._rotation10*f._rotation01+u._rotation11*f._rotation11+u._rotation12*f._rotation21,_=u._rotation10*f._rotation02+u._rotation11*f._rotation12+u._rotation12*f._rotation22,h=u._rotation20*f._rotation00+u._rotation21*f._rotation10+u._rotation22*f._rotation20,l=u._rotation20*f._rotation01+u._rotation21*f._rotation11+u._rotation22*f._rotation21,c=u._rotation20*f._rotation02+u._rotation21*f._rotation12+u._rotation22*f._rotation22,p._rotation00=s,p._rotation01=o,p._rotation02=n,p._rotation10=r,p._rotation11=e,p._rotation12=_,p._rotation20=h,p._rotation21=l,p._rotation22=c,m=u._rotation00*f._positionX+u._rotation01*f._positionY+u._rotation02*f._positionZ,v=u._rotation10*f._positionX+u._rotation11*f._positionY+u._rotation12*f._positionZ,b=u._rotation20*f._positionX+u._rotation21*f._positionY+u._rotation22*f._positionZ,p._positionX=m,p._positionY=v,p._positionZ=b,p._positionX+=u._positionX,p._positionY+=u._positionY,p._positionZ+=u._positionZ;var y,d,g,X,z,Y,Z,M,I,V,w,L,k,B,A,P,S,T,C=a._transform,j=a._localTransform,R=i._transform;if(y=R._rotation00*j._rotation00+R._rotation01*j._rotation10+R._rotation02*j._rotation20,d=R._rotation00*j._rotation01+R._rotation01*j._rotation11+R._rotation02*j._rotation21,g=R._rotation00*j._rotation02+R._rotation01*j._rotation12+R._rotation02*j._rotation22,X=R._rotation10*j._rotation00+R._rotation11*j._rotation10+R._rotation12*j._rotation20,z=R._rotation10*j._rotation01+R._rotation11*j._rotation11+R._rotation12*j._rotation21,Y=R._rotation10*j._rotation02+R._rotation11*j._rotation12+R._rotation12*j._rotation22,Z=R._rotation20*j._rotation00+R._rotation21*j._rotation10+R._rotation22*j._rotation20,M=R._rotation20*j._rotation01+R._rotation21*j._rotation11+R._rotation22*j._rotation21,I=R._rotation20*j._rotation02+R._rotation21*j._rotation12+R._rotation22*j._rotation22,C._rotation00=y,C._rotation01=d,C._rotation02=g,C._rotation10=X,C._rotation11=z,C._rotation12=Y,C._rotation20=Z,C._rotation21=M,C._rotation22=I,V=R._rotation00*j._positionX+R._rotation01*j._positionY+R._rotation02*j._positionZ,w=R._rotation10*j._positionX+R._rotation11*j._positionY+R._rotation12*j._positionZ,L=R._rotation20*j._positionX+R._rotation21*j._positionY+R._rotation22*j._positionZ,C._positionX=V,C._positionY=w,C._positionZ=L,C._positionX+=R._positionX,C._positionY+=R._positionY,C._positionZ+=R._positionZ,a._geom._computeAabb(a._aabb,a._ptransform),k=a._aabb._minX,B=a._aabb._minY,A=a._aabb._minZ,P=a._aabb._maxX,S=a._aabb._maxY,T=a._aabb._maxZ,a._geom._computeAabb(a._aabb,a._transform),a._aabb._minX=k<a._aabb._minX?k:a._aabb._minX,a._aabb._minY=B<a._aabb._minY?B:a._aabb._minY,a._aabb._minZ=A<a._aabb._minZ?A:a._aabb._minZ,a._aabb._maxX=P>a._aabb._maxX?P:a._aabb._maxX,a._aabb._maxY=S>a._aabb._maxY?S:a._aabb._maxY,a._aabb._maxZ=T>a._aabb._maxZ?T:a._aabb._maxZ,null!=a._proxy){var E,q,N;E=a._transform._positionX-a._ptransform._positionX,q=a._transform._positionY-a._ptransform._positionY,N=a._transform._positionZ-a._ptransform._positionZ;var F=a.displacement;F.x=E,F.y=q,F.z=N,a._rigidBody._world._broadPhase.moveProxy(a._proxy,a._aabb,a.displacement)}a=x}}}getAabb(){return this._aabb.clone()}getAabbTo(t){t.copyFrom(this._aabb)}getGeometry(){return this._geom}getRigidBody(){return this._rigidBody}getCollisionGroup(){return this._collisionGroup}setCollisionGroup(t){this._collisionGroup=t}getCollisionMask(){return this._collisionMask}setCollisionMask(t){this._collisionMask=t}getContactCallback(){return this._contactCallback}setContactCallback(t){this._contactCallback=t}getPrev(){return this._prev}getNext(){return this._next}},pa.dynamics.rigidbody.ShapeConfig=class{constructor(){this.position=new pa.common.Vec3,this.rotation=new pa.common.Mat3,this.friction=pa.common.Setting.defaultFriction,this.restitution=pa.common.Setting.defaultRestitution,this.density=pa.common.Setting.defaultDensity,this.collisionGroup=pa.common.Setting.defaultCollisionGroup,this.collisionMask=pa.common.Setting.defaultCollisionMask,this.geometry=null,this.contactCallback=null}},pa.m||(pa.m={}),pa.m.M=class{},pa.collision.broadphase.BroadPhaseType._BRUTE_FORCE=1,pa.collision.broadphase.BroadPhaseType._BVH=2,pa.collision.broadphase.BroadPhaseType.BRUTE_FORCE=1,pa.collision.broadphase.BroadPhaseType.BVH=2,pa.collision.broadphase.bvh.BvhInsertionStrategy.SIMPLE=0,pa.collision.broadphase.bvh.BvhInsertionStrategy.MINIMIZE_SURFACE_AREA=1,pa.collision.geometry.GeometryType._SPHERE=0,pa.collision.geometry.GeometryType._BOX=1,pa.collision.geometry.GeometryType._CYLINDER=2,pa.collision.geometry.GeometryType._CONE=3,pa.collision.geometry.GeometryType._CAPSULE=4,pa.collision.geometry.GeometryType._CONVEX_HULL=5,pa.collision.geometry.GeometryType._CONVEX_MIN=0,pa.collision.geometry.GeometryType._CONVEX_MAX=5,pa.collision.geometry.GeometryType.SPHERE=0,pa.collision.geometry.GeometryType.BOX=1,pa.collision.geometry.GeometryType.CYLINDER=2,pa.collision.geometry.GeometryType.CONE=3,pa.collision.geometry.GeometryType.CAPSULE=4,pa.collision.geometry.GeometryType.CONVEX_HULL=5,pa.collision.narrowphase.detector.BoxBoxDetector.EDGE_BIAS_MULT=1,pa.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.OK=0,pa.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.INVALID_TRIANGLE=1,pa.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_PAIR_INDEX=2,pa.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_TRIANGLE=3,pa.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.EDGE_LOOP_BROKEN=4,pa.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_OUTER_TRIANGLE=5,pa.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.TRIANGLE_INVISIBLE=6,pa.collision.narrowphase.detector.gjkepa.EpaTriangle.count=0,pa.common.Vec3.numCreations=0,pa.common.Setting.defaultFriction=.2,pa.common.Setting.defaultRestitution=.2,pa.common.Setting.defaultDensity=1,pa.common.Setting.defaultCollisionGroup=1,pa.common.Setting.defaultCollisionMask=1,pa.common.Setting.maxTranslationPerStep=20,pa.common.Setting.maxRotationPerStep=3.14159265358979,pa.common.Setting.bvhProxyPadding=.1,pa.common.Setting.bvhIncrementalCollisionThreshold=.45,pa.common.Setting.defaultGJKMargin=.05,pa.common.Setting.enableGJKCaching=!0,pa.common.Setting.maxEPAVertices=128,pa.common.Setting.maxEPAPolyhedronFaces=128,pa.common.Setting.contactEnableBounceThreshold=.5,pa.common.Setting.velocityBaumgarte=.2,pa.common.Setting.positionSplitImpulseBaumgarte=.4,pa.common.Setting.positionNgsBaumgarte=1,pa.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold=.05,pa.common.Setting.defaultContactPositionCorrectionAlgorithm=0,pa.common.Setting.alternativeContactPositionCorrectionAlgorithm=1,pa.common.Setting.contactPersistenceThreshold=.05,pa.common.Setting.maxManifoldPoints=4,pa.common.Setting.defaultJointConstraintSolverType=0,pa.common.Setting.defaultJointPositionCorrectionAlgorithm=0,pa.common.Setting.jointWarmStartingFactorForBaungarte=.8,pa.common.Setting.jointWarmStartingFactor=.95,pa.common.Setting.minSpringDamperDampingRatio=1e-6,pa.common.Setting.minRagdollMaxSwingAngle=1e-6,pa.common.Setting.maxJacobianRows=6,pa.common.Setting.directMlcpSolverEps=1e-9,pa.common.Setting.islandInitialRigidBodyArraySize=128,pa.common.Setting.islandInitialConstraintArraySize=128,pa.common.Setting.sleepingVelocityThreshold=.2,pa.common.Setting.sleepingAngularVelocityThreshold=.5,pa.common.Setting.sleepingTimeThreshold=1,pa.common.Setting.disableSleeping=!1,pa.common.Setting.linearSlop=.005,pa.common.Setting.angularSlop=.017453292519943278,pa.collision.narrowphase.detector.gjkepa.GjkEpa.instance=new pa.collision.narrowphase.detector.gjkepa.GjkEpa,pa.collision.narrowphase.detector.gjkepa.GjkEpaResultState._SUCCEEDED=0,pa.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_FAILED_TO_MAKE_TETRAHEDRON=1,pa.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_DID_NOT_CONVERGE=2,pa.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_INIT=257,pa.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_ADD_VERTEX=258,pa.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_DID_NOT_CONVERGE=259,pa.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED=0,pa.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_FAILED_TO_MAKE_TETRAHEDRON=1,pa.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_DID_NOT_CONVERGE=2,pa.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT=257,pa.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX=258,pa.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE=259,pa.common.Mat3.numCreations=0,pa.common.Mat4.numCreations=0,pa.common.MathUtil.POSITIVE_INFINITY=Infinity,pa.common.MathUtil.NEGATIVE_INFINITY=-1/0,pa.common.MathUtil.PI=3.14159265358979,pa.common.MathUtil.TWO_PI=6.28318530717958,pa.common.MathUtil.HALF_PI=1.570796326794895,pa.common.MathUtil.TO_RADIANS=.017453292519943278,pa.common.MathUtil.TO_DEGREES=57.29577951308238,pa.common.Quat.numCreations=0,pa.dynamics.common.DebugDraw.SPHERE_PHI_DIVISION=8,pa.dynamics.common.DebugDraw.SPHERE_THETA_DIVISION=4,pa.dynamics.common.DebugDraw.CIRCLE_THETA_DIVISION=8,pa.dynamics.common.Performance.broadPhaseCollisionTime=0,pa.dynamics.common.Performance.narrowPhaseCollisionTime=0,pa.dynamics.common.Performance.dynamicsTime=0,pa.dynamics.common.Performance.totalTime=0,pa.dynamics.constraint.PositionCorrectionAlgorithm._BAUMGARTE=0,pa.dynamics.constraint.PositionCorrectionAlgorithm._SPLIT_IMPULSE=1,pa.dynamics.constraint.PositionCorrectionAlgorithm._NGS=2,pa.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE=0,pa.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE=1,pa.dynamics.constraint.PositionCorrectionAlgorithm.NGS=2,pa.dynamics.constraint.info.JacobianRow.BIT_LINEAR_SET=1,pa.dynamics.constraint.info.JacobianRow.BIT_ANGULAR_SET=2,pa.dynamics.constraint.joint.JointType._SPHERICAL=0,pa.dynamics.constraint.joint.JointType._REVOLUTE=1,pa.dynamics.constraint.joint.JointType._CYLINDRICAL=2,pa.dynamics.constraint.joint.JointType._PRISMATIC=3,pa.dynamics.constraint.joint.JointType._UNIVERSAL=4,pa.dynamics.constraint.joint.JointType._RAGDOLL=5,pa.dynamics.constraint.joint.JointType._GENERIC=6,pa.dynamics.constraint.joint.JointType.SPHERICAL=0,pa.dynamics.constraint.joint.JointType.REVOLUTE=1,pa.dynamics.constraint.joint.JointType.CYLINDRICAL=2,pa.dynamics.constraint.joint.JointType.PRISMATIC=3,pa.dynamics.constraint.joint.JointType.UNIVERSAL=4,pa.dynamics.constraint.joint.JointType.RAGDOLL=5,pa.dynamics.constraint.joint.JointType.GENERIC=6,pa.dynamics.constraint.solver.ConstraintSolverType._ITERATIVE=0,pa.dynamics.constraint.solver.ConstraintSolverType._DIRECT=1,pa.dynamics.constraint.solver.ConstraintSolverType.ITERATIVE=0,pa.dynamics.constraint.solver.ConstraintSolverType.DIRECT=1,pa.dynamics.rigidbody.RigidBodyType._DYNAMIC=0,pa.dynamics.rigidbody.RigidBodyType._STATIC=1,pa.dynamics.rigidbody.RigidBodyType._KINEMATIC=2,pa.dynamics.rigidbody.RigidBodyType.DYNAMIC=0,pa.dynamics.rigidbody.RigidBodyType.STATIC=1,pa.dynamics.rigidbody.RigidBodyType.KINEMATIC=2;const{Group:fa,Matrix4:ua,Vector3:ya}=await t("three");pa.dynamics.World,pa.dynamics.rigidbody.RigidBodyType,pa.dynamics.rigidbody.RigidBodyConfig,pa.dynamics.rigidbody.RigidBody,pa.dynamics.rigidbody.ShapeConfig,pa.dynamics.rigidbody.Shape,pa.dynamics.constraint.joint.SphericalJointConfig,pa.dynamics.constraint.joint.SphericalJoint,pa.dynamics.constraint.joint.RevoluteJointConfig,pa.dynamics.constraint.joint.RevoluteJoint,pa.dynamics.constraint.joint.CylindricalJointConfig,pa.dynamics.constraint.joint.CylindricalJoint,pa.dynamics.constraint.joint.PrismaticJointConfig,pa.dynamics.constraint.joint.PrismaticJoint,pa.dynamics.constraint.joint.UniversalJointConfig,pa.dynamics.constraint.joint.UniversalJoint,pa.dynamics.constraint.joint.RagdollJointConfig,pa.dynamics.constraint.joint.RagdollJoint,pa.dynamics.constraint.joint.GenericJointConfig,pa.dynamics.constraint.joint.GenericJoint,pa.dynamics.constraint.joint.JointConfig,pa.dynamics.constraint.joint.Joint,pa.dynamics.constraint.joint.SpringDamper,pa.dynamics.constraint.joint.TranslationalLimitMotor,pa.dynamics.constraint.joint.RotationalLimitMotor,pa.common.Vec3,pa.common.Quat,pa.common.Mat3,pa.common.MathUtil,pa.common.Transform;const da=pa.common.Setting;pa.collision.geometry.BoxGeometry,pa.collision.geometry.SphereGeometry,pa.collision.geometry.ConeGeometry,pa.collision.geometry.CylinderGeometry,pa.collision.geometry.CapsuleGeometry,pa.collision.geometry.ConvexHullGeometry,pa.collision.geometry.Geometry,pa.dynamics.callback.RayCastClosest,pa.dynamics.callback.ContactCallback,da.defaultGJKMargin=1e-4,pa.dynamics.World,pa.dynamics.rigidbody.RigidBodyType,pa.dynamics.rigidbody.RigidBodyConfig,pa.dynamics.rigidbody.RigidBody,pa.dynamics.rigidbody.ShapeConfig,pa.dynamics.rigidbody.Shape,pa.dynamics.constraint.joint.SphericalJointConfig,pa.dynamics.constraint.joint.SphericalJoint,pa.dynamics.constraint.joint.RevoluteJointConfig,pa.dynamics.constraint.joint.RevoluteJoint,pa.dynamics.constraint.joint.CylindricalJointConfig,pa.dynamics.constraint.joint.CylindricalJoint,pa.dynamics.constraint.joint.PrismaticJointConfig,pa.dynamics.constraint.joint.PrismaticJoint,pa.dynamics.constraint.joint.UniversalJointConfig,pa.dynamics.constraint.joint.UniversalJoint,pa.dynamics.constraint.joint.RagdollJointConfig,pa.dynamics.constraint.joint.RagdollJoint,pa.dynamics.constraint.joint.GenericJointConfig,pa.dynamics.constraint.joint.GenericJoint,pa.dynamics.constraint.joint.Joint,pa.common.Vec3,pa.common.Quat;const ga=pa.common.Setting;pa.collision.geometry.BoxGeometry,pa.collision.geometry.SphereGeometry,pa.collision.geometry.ConeGeometry,pa.collision.geometry.CylinderGeometry,pa.collision.geometry.CapsuleGeometry,pa.collision.geometry.ConvexHullGeometry,pa.dynamics.callback.ContactCallback,ga.defaultGJKMargin=1e-4;const{Group:Xa,MathUtils:za,Matrix4:Ya}=await t("three");export{ba as Reflector,yi as ReflectorDudvMaterial,mi as ReflectorMaterial};
