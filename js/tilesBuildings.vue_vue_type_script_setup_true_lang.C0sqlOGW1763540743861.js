import{F as e,_ as o}from"./@tresjs.BCHtwiaC1763540743861.js";import{A as t}from"./3d-tiles-renderer.C21jgnK51763540743861.js";import{B as a,S as r,M as n,V as i,Q as s,be as l,df as u,cY as d,dg as p,ae as c,l as m,bY as g}from"./three.rXKzP9fQ1763540743861.js";import{B as w}from"./three-custom-shader-material.C6taB_aY1763540743861.js";import{b as f,a as h}from"./buildingsShaderMaterial.CQxYsEgR1763540743861.js";import{d as v,a as y,a6 as x,H as B,o as S,J as j,u as z}from"./@vue.Co_gxueH1763540743861.js";const b=e=>{e.onLoadTileSet=o=>{const t=new a,l=new r,u=new n;let d=null,p=0;e.getOrientedBounds(t,u)?(d=(new i).setFromMatrixPosition(u),p=d.length()):e.getBoundingSphere(l)&&(d=l.center.clone(),p=d.length());const c=d?.normalize(),m=((e,o)=>{const t=new s,a=(new i).crossVectors(e,o);return t.x=a.x,t.y=a.y,t.z=a.z,t.w=1+e.clone().dot(o),t.normalize(),t})(c,new i(0,1,0));e.group.quaternion.x=m.x,e.group.quaternion.y=m.y,e.group.quaternion.z=m.z,e.group.quaternion.w=m.w,e.group.position.z=-p}},C=["object","rotation"],M=v({__name:"tilesBuildings",props:{bulidingsColor:{default:"#e523ff"},topColor:{default:"#ffff00"},opacity:{default:.8},gradient:{type:Boolean,default:!0},camera:{}},setup(n){const i=n,s=y(0),v=new t("https://jdvop.oss-cn-qingdao.aliyuncs.com/mapv-data/titleset/sz_ns/no.json");v.errorTarget=2,v.addEventListener("load-model",({scene:e})=>{e.traverse(e=>{if(e.isMesh){(e=>{const{geometry:o}=e;o.computeBoundingBox(),o.computeBoundingSphere();const{max:t,min:a}=o.boundingBox,r=new w({baseMaterial:new g,vertexShader:h,fragmentShader:f,silent:!0,uniforms:{uMax:{value:t},uMin:{value:a},uBorderWidth:{value:5},uCircleTime:{value:5},uColor:{value:new m(i.bulidingsColor)},uOpacity:{value:i.opacity},uLightColor:{value:new m("#ffffff")},uTopColor:{value:new m(i.topColor)},uTime:s,uGradient:{value:i.gradient}},depthWrite:!0,depthTest:!0,transparent:!0,side:c});e.material.dispose(),e.material=r})(e),e.receiveShadow=!1,e.castShadow=!1;const o=new l(e.geometry.clone());let t=(new u).fromEdgesGeometry(o),a=new d({color:0,linewidth:1,opacity:1,transparent:!0,depthWrite:!0,depthTest:!0});a.resolution.set(window.innerWidth,window.innerHeight);const r=new p(t,a);r.applyMatrix4(e.matrix.clone()),e.parent.add(r)}});const o=new a,t=new r;v.getBoundingBox(o)?(o.getCenter(v.group.position),v.group.position.multiplyScalar(-1)):v.getBoundingSphere(t)&&(v.group.position.copy(t.center),v.group.position.multiplyScalar(-1))}),b(v);const{renderer:M,sizes:T}=e();x(()=>{T.width.value&&(v.setCamera(i.camera),v.setResolutionFromRenderer(i.camera,M))});const{onBeforeRender:q}=o();return q(({delta:e})=>{s.value+=2*e,i.camera&&T.width.value&&(i.camera.updateMatrixWorld(),v.update())}),(e,o)=>(S(),B("TresGroup",null,[j("primitive",{object:z(v).group,rotation:[-Math.PI/2,0,0]},null,8,C)]))}});export{M as _};
