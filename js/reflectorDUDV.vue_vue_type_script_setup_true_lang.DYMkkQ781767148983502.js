import{importShared as l}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{qiankunWindow_1 as c,no as g}from"./index.DTe2qqjO1767148983502.js";import{Reflector as U,ReflectorDudvMaterial as h}from"./OimoPhysicsController.C1pzCmuS1767148983502.js";import{fixSpritesForMirror as p}from"./utils.sbhH34FI1767148983502.js";const{defineComponent:R}=await l("vue"),{unref:f,createElementVNode:m,openBlock:C,createElementBlock:I,createCommentVNode:T}=await l("vue"),y=["scale"],M=["object"],H=["object"],P=await l("three"),{Mesh:j,PlaneGeometry:A,RepeatWrapping:v,GridHelper:k}=await l("three"),{watchEffect:x,watch:d,ref:D,toRaw:G}=await l("vue"),K=R({__name:"reflectorDUDV",props:{reflectivity:{default:.8},showGridHelper:{type:Boolean,default:!0},scale:{default:1},ignoreObjects:{default:()=>[]},size:{default:()=>[10,10]},mapUrl:{default:"./plugins/floor/image/waterdudv.jpg"}},setup(w,{expose:E}){const e=w,a=new U,s=new k(e.size[0]-.5,e.size[1]);s.visible=e.showGridHelper;let n=e.mapUrl;c.__POWERED_BY_QIANKUN__&&(n=c.__INJECTED_PUBLIC_PATH_BY_QIANKUN__+n,console.log("qiankunWindow.__INJECTED_PUBLIC_PATH_BY_QIANKUN__",c.__INJECTED_PUBLIC_PATH_BY_QIANKUN__),console.log("process.env.BASE_URL","./"));let i=null,o=D(null);const{state:B,isLoading:b}=g(n);return d(()=>B.value,t=>{t&&(t.wrapS=v,t.wrapT=v,t.colorSpace=P.SRGBColorSpace,t.repeat.set(6,3),i=new h({map:t,reflectivity:e.reflectivity}),i.uniforms.tReflect={value:a.renderTarget.texture},i.uniforms.tReflectBlur=a.renderTargetUniform,i.uniforms.uMatrix=a.textureMatrixUniform,o.value=new j(new A(e.size[0],e.size[1]),void 0),o.value.material=i,o.value.rotation.x=-Math.PI/2,o.value.add(a),o.value.onBeforeRender=(_,u,N)=>{o.value.visible=!1,e.ignoreObjects.forEach(r=>{r.isMesh&&(r.visible=!1),r.value&&r.value.isMesh&&(r.value.visible=!1)}),p(u),a.update(_,u,N),p(u,!1),e.ignoreObjects.forEach(r=>{r.isMesh&&(r.visible=!0),r.value&&r.value.isMesh&&(r.value.visible=!0)}),o.value.visible=!0})}),x(()=>{e.reflectivity&&i&&(i.uniforms.uReflectivity.value=e.reflectivity)}),d(()=>e.showGridHelper,t=>{s.visible=t}),E({reflector:a}),(t,_)=>f(b)?T("",!0):(C(),I("TresGroup",{key:0,scale:[t.scale,1,t.scale]},[m("primitive",{object:G(f(o)),"position-y":-.01},null,8,M),m("primitive",{object:f(s)},null,8,H)],8,y))}});export{K as _sfc_main};
