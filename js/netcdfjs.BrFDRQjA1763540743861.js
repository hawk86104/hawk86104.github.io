import{I as e}from"./iobuffer.DivSMyia1763540743861.js";const t=1,r=2,n=3,i=4,s=5,a=6;function o(e){switch(Number(e)){case t:return"byte";case r:return"char";case n:return"short";case i:return"int";case s:return"float";case a:return"double";default:return"undefined"}}function u(e){switch(Number(e)){case t:case r:return 1;case n:return 2;case i:case s:return 4;case a:return 8;default:return-1}}function d(e){switch(String(e)){case"byte":return t;case"char":return r;case"short":return n;case"int":return i;case"float":return s;case"double":return a;default:return-1}}function c(e,t){if(1!==e){const r=new Array(e);for(let n=0;n<e;n++)r[n]=t();return r}return t()}function f(e,o,u){switch(o){case t:return Array.from(e.readBytes(u));case r:return function(e){if(0===e.charCodeAt(e.length-1))return e.substring(0,e.length-1);return e}(e.readChars(u));case n:return c(u,e.readInt16.bind(e));case i:return c(u,e.readInt32.bind(e));case s:return c(u,e.readFloat32.bind(e));case a:return c(u,e.readFloat64.bind(e));default:throw new Error(`non valid type ${o}`)}}function l(e,t){if(e)throw new TypeError(`Not a valid NetCDF v3.x file: ${t}`)}function h(e){e.offset%4!=0&&e.skip(4-e.offset%4)}function b(e){const t=e.readUint32(),r=e.readChars(t);return h(e),r}function g(e,t){const r={version:t},n={length:e.readUint32()},i=function(e){const t={};let r,n;const i=e.readUint32();let s;if(0===i)return l(0!==e.readUint32(),"wrong empty tag for list of dimensions"),[];{l(10!==i,"wrong tag for list of dimensions");const t=e.readUint32();s=new Array(t);for(let i=0;i<t;i++){const t=b(e),a=e.readUint32();0===a&&(r=i,n=t),s[i]={name:t,size:a}}}void 0!==r&&(t.recordId=r);void 0!==n&&(t.recordName=n);return t.dimensions=s,t}(e);Array.isArray(i)||(n.id=i.recordId,n.name=i.recordName,r.dimensions=i.dimensions),r.globalAttributes=m(e);const s=function(e,t,r){const n=e.readUint32();let i,s=0;if(0===n)return l(0!==e.readUint32(),"wrong empty tag for list of variables"),[];{l(11!==n,"wrong tag for list of variables");const a=e.readUint32();i=new Array(a);for(let n=0;n<a;n++){const a=b(e),u=e.readUint32(),d=new Array(u);for(let t=0;t<u;t++)d[t]=e.readUint32();const c=m(e),f=e.readUint32();l(f<1&&f>6,`non valid type ${f}`);const h=e.readUint32();let g=e.readUint32();2===r&&(l(g>0,"offsets larger than 4GB not supported"),g=e.readUint32());let v=!1;void 0!==t&&d[0]===t&&(s+=h,v=!0),i[n]={name:a,dimensions:d,attributes:c,type:o(f),size:h,offset:g,record:v}}}return{variables:i,recordStep:s}}(e,n?.id,t);return Array.isArray(s)||(r.variables=s.variables,n.recordStep=s.recordStep),r.recordDimension=n,r}function m(e){const t=e.readUint32();let r;if(0===t)return l(0!==e.readUint32(),"wrong empty tag for list of attributes"),[];{l(12!==t,"wrong tag for list of attributes");const n=e.readUint32();r=new Array(n);for(let t=0;t<n;t++){const n=b(e),i=e.readUint32();l(i<1||i>6,`non valid type ${i}`);const s=e.readUint32(),a=f(e,i,s);h(e),r[t]={name:n,type:o(i),value:a}}}return r}function v(){const e=[];e.push("DIMENSIONS");for(const r of this.dimensions)e.push(`  ${r.name.padEnd(30)} = size: ${r.size}`);e.push(""),e.push("GLOBAL ATTRIBUTES");for(const r of this.globalAttributes)e.push(`  ${r.name.padEnd(30)} = ${r.value}`);const t=JSON.parse(JSON.stringify(this.variables));e.push(""),e.push("VARIABLES:");for(const r of t){r.value=this.getDataVariable(r);let t=JSON.stringify(r.value);t.length>50&&(t=t.substring(0,50)),isNaN(r.value.length)||(t+=` (length: ${r.value.length})`),e.push(`  ${r.name.padEnd(30)} = ${t}`)}return e.join("\n")}class p{constructor(t){this.toString=v;const r=new e(t);r.setBigEndian(),l("CDF"!==r.readChars(3),"should start with CDF");const n=r.readByte();l(n>2,"unknown version"),this.header=g(r,n),this.buffer=r}get version(){return 1===this.header.version?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}getAttribute(e){const t=this.globalAttributes.find(t=>t.name===e);return t?t.value:null}getDataVariableAsString(e){const t=this.getDataVariable(e);return t?t.join(""):null}get variables(){return this.header.variables}getDataVariable(e){let t;if(t="string"==typeof e?this.header.variables.find(t=>t.name===e):e,void 0===t)throw new Error("Not a valid NetCDF v3.x file: variable not found");return this.buffer.seek(t.offset),t.record?function(e,t,r){const n=d(t.type),i=t.size?t.size/u(n):1,s=r.length,a=new Array(s),o=r.recordStep;if(!o)throw new Error("recordDimension.recordStep is undefined");for(let u=0;u<s;u++){const t=e.offset;a[u]=f(e,n,i),e.seek(t+o)}return a}(this.buffer,t,this.header.recordDimension):function(e,t){const r=d(t.type),n=t.size/u(r),i=new Array(n);for(let s=0;s<n;s++)i[s]=f(e,r,1);return i}(this.buffer,t)}dataVariableExists(e){return void 0!==this.header.variables.find(t=>t.name===e)}attributeExists(e){return void 0!==this.globalAttributes.find(t=>t.name===e)}}export{p as N};
