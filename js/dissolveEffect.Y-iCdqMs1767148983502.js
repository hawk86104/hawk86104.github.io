import{importShared as f}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{_l as D,Kk as I}from"./index.DTe2qqjO1767148983502.js";import{useTexture$1 as W,_sfc_main as F,_sfc_main$1 as d}from"./customShaderMaterial.vue_vue_type_script_setup_true_lang.B7dQ_CiZ1767148983502.js";import"./index.vue_vue_type_script_setup_true_lang.CjsHShHS1767148983502.js";import{loading$1 as G}from"./generalFont.vue_vue_type_script_setup_true_lang.Cx7Vff0m1767148983502.js";import"./default.vue_vue_type_script_setup_true_lang.Bjy6WD1C1767148983502.js";import"./three-mesh-ui.module.Cv5lk1vQ1767148983502.js";import"./domPanel.vue_vue_type_style_index_0_lang.DqrQKbSz1767148983502.js";import"./reflectorDiffuse.vue_vue_type_script_setup_true_lang.Cxj_Ip691767148983502.js";import{_sfc_main as j}from"./reflectorDUDV.vue_vue_type_script_setup_true_lang.DYMkkQ781767148983502.js";import"./reflectorShaderMesh.vue_vue_type_script_setup_true_lang.T7UkXoyg1767148983502.js";import"./dynamicRotatingBase.vue_vue_type_script_setup_true_lang.BVQWYa0i1767148983502.js";import"./whiteFloorMesh.vue_vue_type_script_setup_true_lang.BCd7Uxt-1767148983502.js";import"./gridPlusCom.vue_vue_type_script_setup_true_lang.x_N2tft71767148983502.js";import"./videoFloor.vue_vue_type_script_setup_true_lang.Xg1Eqw4f1767148983502.js";import"./digitalGround.vue_vue_type_script_setup_true_lang.DBVFezcY1767148983502.js";import"./imgFloor.vue_vue_type_script_setup_true_lang.BPVumalx1767148983502.js";import"./reflectorRoundedBox.vue_vue_type_script_setup_true_lang.BOdU7iQo1767148983502.js";import"./particleBase.vue_vue_type_script_setup_true_lang.CIf_5jma1767148983502.js";import"./rippleFloor.vue_vue_type_script_setup_true_lang.BmWDhTNl1767148983502.js";import{Pane as V}from"./tweakpane.BQRZXf8M1767148983502.js";import{_sfc_main as N}from"./lamboEffect.vue_vue_type_script_setup_true_lang.CRR-Y-kD1767148983502.js";import{useGLTF as O}from"./index.Bk2zy1aS1767148983502.js";const{withAsyncContext:b}=await f("vue"),{unref:U,openBlock:H,createElementBlock:z}=await f("vue"),A=["object","rotation"],{watchEffect:L,ref:be,toRaw:K}=await f("vue"),m=await f("three"),q={__name:"dissolveEffectModel",props:{edgeColor:{default:1118481},edgeWidth:{default:.03},dissolveSpeed:{default:.003},funRef:{appear:null,disappear:null}},async setup(M,{expose:x}){let l,u;const o=M,{scene:C,nodes:n,materials:s}=([l,u]=b(()=>O("https://opensource.cdn.icegl.cn/model/industry4/lambo.glb",{draco:!0,decoderPath:"./draco/"})),l=await l,u(),l);Object.values(n).forEach(e=>{e.isMesh&&(e.name.startsWith("glass")&&e.geometry.computeVertexNormals(),e.name==="silver_001_BreakDiscs_0"&&(e.material=s.BreakDiscs.clone(),e.material.color=new m.Color("#ddd")))}),n.glass_003.scale.setScalar(2.7),s.FrameBlack.color=new m.Color("black"),s.FrameBlack.roughness=0,s.FrameBlack.metalness=.75,s.Chrome.color=new m.Color("#333"),s.Chrome.metalness=1,s.Chrome.roughness=0,s.BreakDiscs.color=new m.Color("#555"),s.BreakDiscs.metalness=.2,s.BreakDiscs.roughness=.2,s.TiresGum.color=new m.Color("#181818"),s.TiresGum.metalness=0,s.TiresGum.roughness=.4,s.GreyElements.color=new m.Color("#292929"),s.GreyElements.metalness=0,n.yellow_WhiteCar_0.material=new m.MeshPhysicalMaterial({roughness:.3,metalness:.05,color:"#111",envMapIntensity:.75,clearcoatRoughness:0,clearcoat:1});const y=([l,u]=b(()=>W(["./plugins/digitalCity/image/smokeparticle.png","./plugins/industry4/image/dissolve.jpg"])),l=await l,u(),l),i=[];let c=!1;const S={dissolveProgress:0,noiseTexture:y[0],edgeColorTexture:y[1]};let _=o.dissolveSpeed;const B=()=>{if(!c){c=!0,_=o.dissolveSpeed;for(const e of i)e.uniforms.dissolveSpeed={value:_},e.uniforms.dissolveProgress={value:0}}},k=()=>{if(!c){c=!0,_=-o.dissolveSpeed;for(const e of i)e.uniforms.dissolveSpeed={value:_},e.uniforms.dissolveProgress={value:1}}};o.funRef.appear=B,o.funRef.disappear=k,x({appear:B,disappear:k}),Object.values(n).forEach(e=>{if(e.isMesh){e.frustumCulled=!1;const g=e.material;g.transparent=!0,g.onBeforeCompile=t=>{i.push(t),t.uniforms.edgeColor={value:new m.Color(o.edgeColor)},t.uniforms.edgeWidth={value:o.edgeWidth},t.uniforms.dissolveSpeed={value:o.dissolveSpeed},t.uniforms.dissolveProgress={value:S.dissolveProgress},t.uniforms.noiseTexture={value:S.noiseTexture},t.uniforms.edgeColorTexture={value:S.edgeColorTexture},t.vertexShader=t.vertexShader.replace("#include <common>",["varying vec2 xUv;","#include <common>"].join(`
`)),t.vertexShader=t.vertexShader.replace("#include <uv_vertex>",["xUv = uv;","#include <uv_vertex>"].join(`
`)),t.fragmentShader=t.fragmentShader.replace("#include <common>",`#include <common>
             uniform float dissolveProgress;
             uniform float edgeWidth;
             uniform vec3 edgeColor;
             uniform sampler2D noiseTexture;
             uniform sampler2D edgeColorTexture;
             varying vec2 xUv;
            `),t.fragmentShader=t.fragmentShader.replace("#include <dithering_fragment>",`#include <dithering_fragment>
                float noiseValue = texture2D(noiseTexture, xUv).r;
              	vec4 finalColor = texture2D(edgeColorTexture, xUv);

								vec3 mixedColor = mix(finalColor.rgb, edgeColor, 0.5);
								finalColor.rgb = mixedColor;

                // vec4 finalColor = linearToOutputTexel( vec4(edgeColor, gl_FragColor.a) );
								float alpha = step(noiseValue - edgeWidth, dissolveProgress);
                gl_FragColor.a = alpha;
								float useOrigin = step(noiseValue, dissolveProgress);
								gl_FragColor.rgb = mix(finalColor.rgb, gl_FragColor.rgb, useOrigin);`)}}});const{onBeforeRender:$}=D();return $(()=>{if(c)for(const e of i){const{dissolveProgress:g,dissolveSpeed:t}=e.uniforms;g.value+=t.value,g.value<0&&(c=!1),g.value>1&&(c=!1)}}),L(()=>{if(o.dissolveSpeed)for(const e of i)e.uniforms.dissolveSpeed.value=o.dissolveSpeed;if(o.edgeColor)for(const e of i)e.uniforms.edgeColor.value=new m.Color(o.edgeColor);if(o.edgeWidth)for(const e of i)e.uniforms.edgeWidth.value=o.edgeWidth}),(e,g)=>(H(),z("primitive",{object:K(U(C)),scale:.015,rotation:[0,Math.PI/1.5,0]},null,8,A))}},{defineComponent:J}=await f("vue"),{unref:a,createVNode:r,createElementVNode:p,normalizeProps:Q,guardReactiveProps:X,mergeProps:E,Suspense:w,withCtx:v,openBlock:h,createBlock:P,resolveComponent:Y,Fragment:Z,createElementBlock:ee}=await f("vue"),oe=["rotation"],te=["side"],re=["rotation"],se=["side"],{reactive:T,ref:ie}=await f("vue"),R=await f("three"),Ee=J({__name:"dissolveEffect",setup(M){const x=T({clearColor:"#15151a",antialias:!1,logarithmicDepthBuffer:!0,renderMode:"manual"}),l=T({autoRotate:!0}),u=new V({title:"溶解参数",expanded:!0}),o=T({edgeColor:"#111111",edgeWidth:.03,dissolveSpeed:.003,funRef:{appear:null,disappear:null}});u.addBinding(o,"edgeColor",{label:"颜色"}),u.addBinding(o,"edgeWidth",{label:"宽度",min:0,max:.13,step:.01}),u.addBinding(o,"dissolveSpeed",{label:"速度",min:.001,max:.01,step:.001});const C=u.addButton({title:"显示",label:"模型"}),n=ie(null);return C.on("click",()=>{n.value.appear?n.value.appear():n.value.funRef.appear()}),u.addButton({title:"消失",label:"模型"}).on("click",()=>{n.value.appear?n.value.disappear():n.value.funRef.disappear()}),(y,i)=>{const c=Y("TresCanvas");return h(),ee(Z,null,[r(a(G)),r(c,E(x,{"window-size":""}),{default:v(()=>[i[2]||(i[2]=p("TresPerspectiveCamera",{position:[0,10,15],fov:25,near:.1,far:1e4},null,-1)),r(a(I),Q(X(l)),null,16),i[3]||(i[3]=p("TresHemisphereLight",{intensity:.5},null,-1)),(h(),P(w,null,{default:v(()=>[r(q,E(o,{ref_key:"dissolveEffectModelRef",ref:n}),null,16)]),_:1})),(h(),P(w,null,{default:v(()=>[r(a(j),{position:[0,-1.562,0],reflectivity:2.6,showGridHelper:!1,scale:1.5})]),_:1})),p("TresMesh",{scale:4,position:[3,-1.161,-1.5],rotation:[-Math.PI/2,0,Math.PI/2.5]},[i[0]||(i[0]=p("TresRingGeometry",{args:[.9,1,4,1]},null,-1)),p("TresMeshStandardMaterial",{color:"white",roughness:.75,side:R.DoubleSide},null,8,te)],8,oe),p("TresMesh",{scale:4,position:[-3,-1.161,-1],rotation:[-Math.PI/2,0,Math.PI/2.5]},[i[1]||(i[1]=p("TresRingGeometry",{args:[.9,1,3,1]},null,-1)),p("TresMeshStandardMaterial",{color:"white",roughness:.75,side:R.DoubleSide},null,8,se)],8,re),(h(),P(w,null,{default:v(()=>[r(a(F),{resolution:512},{default:v(()=>[r(a(d),{intensity:2,position:[0,1,3],scale:[10,1,1]}),r(a(d),{intensity:2,"rotation-x":Math.PI/2,position:[0,4,-6],scale:[10,1,1]},null,8,["rotation-x"]),r(a(d),{intensity:2,"rotation-x":Math.PI/2,position:[0,4,-3],scale:[10,1,1]},null,8,["rotation-x"]),r(a(d),{intensity:2,"rotation-x":Math.PI/2,position:[0,4,0],scale:[10,1,1]},null,8,["rotation-x"]),r(a(d),{intensity:2,"rotation-x":Math.PI/2,position:[0,4,3],scale:[10,1,1]},null,8,["rotation-x"]),r(a(d),{intensity:2,"rotation-x":Math.PI/2,position:[0,4,6],scale:[10,1,1]},null,8,["rotation-x"]),r(a(d),{intensity:2,"rotation-x":Math.PI/2,position:[0,4,9],scale:[10,1,1]},null,8,["rotation-x"]),r(a(d),{intensity:2,"rotation-y":Math.PI/2,position:[-50,2,0],scale:[100,2,1]},null,8,["rotation-y"]),r(a(d),{intensity:2,"rotation-y":-Math.PI/2,position:[50,2,0],scale:[100,2,1]},null,8,["rotation-y"]),r(a(d),{form:"ring",color:"red",intensity:10,scale:2,position:[10,5,10]})]),_:1})]),_:1})),r(N)]),_:1},16)],64)}}});export{Ee as default};
