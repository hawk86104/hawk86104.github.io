import{a2 as e,a1 as a,o as t,bx as r,bR as s,a9 as u,b3 as n,bs as l,bt as o,U as i,aD as d}from"./three.Db7Elb4U1762224880399.js";import{F as v,_ as c}from"./@tresjs.DqjiY1SI1762224880399.js";import{R as m}from"./three-stdlib.I6Yjb5dQ1762224880399.js";import"./shapeConfigurator.vue_vue_type_style_index_1_scoped_abbf0cc1_lang.Cr5LsbwT1762224880399.js";import"./Resource.BurM_iz61762224880399.js";import{u as p}from"./useLoader.VuwfYjb91762224880399.js";import{w as h,_,a as f,c as y,u as b,d as g,V as k,ac as w,a4 as x,G as S,H as j,o as A,L as D,ad as E}from"./@vue.DQUdVfVE1762224880399.js";class F extends e{constructor(){super(),this.virtualScene=null,this.virtualScene=new a}add(...e){return this.virtualScene.add(...e),this}destructor(){this.virtualScene.traverse(e=>{e instanceof t&&(e.geometry.dispose(),e.material.dispose(),e.material.map&&e.material.map.dispose(),this.virtualScene.remove(e))}),this.virtualScene=null}}const B={sunset:"venice/venice_sunset_1k.hdr",studio:"studio/poly_haven_studio_1k.hdr",city:"city/canary_wharf_1k.hdr",umbrellas:"outdoor/outdoor_umbrellas_1k.hdr",night:"outdoor/satara_night_1k.hdr",forest:"outood/mossy_forest_1k.hdr",snow:"outdoor/snowy_forest_path_01_1k.hdr",dawn:"kiara/kiara_1_dawn_1k.hdr",hangar:"indoor/small_hangar_01_1k.hdr",urban:"indoor/abandoned_games_room_02_1k.hdr",modern:"city/modern_buildings_2_1k.hdr",shangai:"city/shanghai_bund_1k.hdr"};const P=g({__name:"component",props:{background:{type:[Boolean,String],default:!1},blur:{default:0},files:{default:[]},path:{default:""},preset:{default:void 0},resolution:{default:256},near:{default:1},far:{default:1e3},frames:{default:1/0},useDefaultScene:{type:Boolean,default:!1}},async setup(e,{expose:a}){let t,g;const P=e,R=f(null);a({texture:R});const{extend:$,renderer:C,scene:L}=v();let T=null,G=f(null),H=null;const M=f(null);k(()=>{M.value?.destructor(),G.value?.dispose()});const{onBeforeRender:O}=c();let U=1;O(()=>{H&&M.value&&G.value&&(P.frames===1/0||U<P.frames)&&(P.useDefaultScene?H.update(C,L.value):H.update(C,E(M.value.virtualScene)),U++)});const V=([t,g]=w(()=>async function(e,a){const{scene:t,invalidate:n}=v();h(e,()=>{n()});const{preset:l,blur:o,files:i=f([]),path:d=f(""),background:c}=_(e),g=f(null),k=y(()=>Array.isArray(i.value)),w=y(()=>k.value?r:m);return h([i,d],async([e,a])=>{if(e&&e.length>0&&!l?.value){try{g.value=await p(w.value,k.value?[...b(e)]:b(e),e=>{a&&e.setPath(b(a))})}catch(t){throw new Error(`Failed to load environment map: ${t}`)}g.value&&(g.value.mapping=k.value?s:u),n()}},{immediate:!0}),h(g,e=>{t.value&&e&&(t.value.environment=e)},{immediate:!0}),h([c,g],([e,r])=>{if(t.value){let s=a?.value?a.value.texture:r,u=t.value.background;u?.isColor||(u=void 0),t.value.background=e?s:u}},{immediate:!0}),h(()=>o?.value,e=>{t.value&&e&&(t.value.backgroundBlurriness=e)},{immediate:!0}),h(()=>l?.value,async e=>{if(e&&e in B){const t="https://raw.githubusercontent.com/Tresjs/assets/main/textures/hdr/",r=B[e];try{g.value=await p(m,r,e=>{t&&e.setPath(t)})}catch(a){throw new Error(`Failed to load environment map: ${a}`)}g.value&&g.value&&(g.value.mapping=u),n()}else if(e&&!(e in B))throw new Error(`Preset must be one of: ${Object.keys(B).join(", ")}`)},{immediate:!0}),g}(P,G)),t=await t,g(),t),q=e=>{e?(L.value.environment=e.texture,P.background&&(L.value.background=e.texture)):(L.value.environment=V.value,P.background&&(L.value.background=V.value))};h(V,e=>{G.value&&q(G.value)},{immediate:!0,deep:!0}),$({EnvSence:F});const z=()=>{G.value?.dispose(),G.value=new l(P.resolution),H=new o(P.near,P.far,G.value),P.useDefaultScene?(G.value.texture.type=i,G.value.texture.generateMipmaps=!1,G.value.texture.minFilter=d,G.value.texture.magFilter=d):G.value.texture.type=n,q(G.value)};return h(()=>x().default,e=>{e&&(!G.value||G.value.texture.type!==n)&&(T=e(),Array.isArray(T)&&T.length>0&&"symbol"!=typeof T[0]?.type)?z():(G.value?.dispose(),G.value=null,q(null))},{immediate:!0,deep:!0}),R.value=V,h(()=>P.useDefaultScene,e=>{G.value&&z()}),(e,a)=>b(G)?(A(),S("TresEnvSence",{key:0,ref_key:"envSence",ref:M},[D(e.$slots,"default")],512)):j("",!0)}});export{P as _};
