import{l as e}from"./localforage.DDqgAo791763540743861.js";import{b as t,s as o}from"./index.vue_vue_type_script_setup_true_lang.YCkLl6gI1763540743861.js";import{s as n,u as a,L as r,B as i,i as s}from"./naive-ui.qjPOP62h1763540743861.js";import{F as l}from"./@vicons.DhSiG_AT1763540743861.js";import{d as c,a as u,b as g,o as p,u as d,e as f,h as m,y as v}from"./@vue.Co_gxueH1763540743861.js";const y=c({__name:"ConfigBar",setup(c){const y=n(),x=a(),b=u(null),h=async n=>{if("import"===n){console.log("Importing configuration...");const t=await e.getItem("tvt-zone-3Deditor");if(t){const e=JSON.parse(t);e.history[e.currentIndex].label="配置导入";!function(e){const t=new Date,o=e=>e.toString().padStart(2,"0"),n=`TvTzone3Deditor-${t.getFullYear()}${o(t.getMonth()+1)}${o(t.getDate())}-${o(t.getHours())}${o(t.getMinutes())}${o(t.getSeconds())}.json`,a=JSON.stringify(e,null,2),r=new Blob([a],{type:"application/json"}),i=document.createElement("a");i.href=URL.createObjectURL(r),i.download=n,i.click(),URL.revokeObjectURL(i.href)}({history:[e.history[e.currentIndex]],currentIndex:0}),x.success("配置导出成功")}else x.warning("场景没有任何操作，无法导出")}else"export"===n?(console.log("Exporting configuration..."),y.warning({title:"此操作会清空当前场景以及历史记录",content:"是否确认导入配置？",positiveText:"确定",negativeText:"取消",draggable:!0,onPositiveClick:()=>{const o=document.createElement("input");o.type="file",o.accept="application/json",o.onchange=async o=>{if(o.target){const a=o.target.files[0];if(!a)return;const r=await a.text();try{const o=x.loading("场景配置载入中",{duration:0});await t(r),o.destroy(),await e.setItem("tvt-zone-3Deditor",r),x.success("配置导入成功，请继续编辑")}catch(n){console.error("JSON 解析失败:",n),x.error("导入配置失败，您是否启动了模型服务？请检查网络连接或模型服务地址是否正确。",{closable:!0,duration:8666})}}},o.click()}})):"exportSimple"===n&&(console.log("Exporting configuration..."),y.warning({title:"此操作会清空当前场景以及历史记录",content:"是否确认导入例子配置？",positiveText:"确定",negativeText:"取消",draggable:!0,onPositiveClick:async()=>{if(b.value)return!1;try{b.value=x.loading("远程配置载入中",{duration:0});const t=await o("https://oss.icegl.cn/p/zone3Deditor/plugins/zone3Deditor/TvTzone3Deditor.json");b.value.destroy(),b.value=null,await e.setItem("tvt-zone-3Deditor",t),x.success("远程配置导入成功，请继续编辑")}catch(t){console.error("远程 JSON 解析失败:",t),x.error("远程 JSON 解析失败")}}}))};return(e,t)=>(p(),g(d(r),{trigger:"hover",options:[{label:"导出配置",key:"import"},{label:"导入配置",key:"export"},{label:"快速导入例子",key:"exportSimple"}],onSelect:h},{default:f(()=>[m(d(i),null,{icon:f(()=>[m(d(s),null,{default:f(()=>[m(d(l))]),_:1})]),default:f(()=>[t[0]||(t[0]=v(" 配置文件 ",-1))]),_:1})]),_:1}))}});export{y as _};
