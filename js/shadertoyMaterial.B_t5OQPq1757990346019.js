import{e,a,b as t}from"./@tresjs.PrijCSbN1757990346019.js";import{a3 as s,aE as r,f as i,a as o,ax as n,m as l,cK as v,l as u}from"./three.DHXbQd-f1757990346019.js";import{z as m}from"./three-custom-shader-material.Ch8Q9dJf1757990346019.js";import{P as c}from"./tweakpane.C0HtAJSg1757990346019.js";import{a as p}from"./axios.DLTVXJci1757990346019.js";import{d,r as h,aa as f,s as g,h as w,e as y,o as C,f as x,I as j,j as T,u as b,a7 as U,a8 as D,m as _}from"./@vue.pEDXJ_3Z1757990346019.js";import"./postprocessing.BxUQ5pTE1757990346019.js";import"./@vueuse.D19fGRfI1757990346019.js";class A{constructor(e,a){const t=A.replaceVariable(e),i=new m({baseMaterial:r,vertexShader:"\t\n            varying vec2 vUv;\n            void main() {\n                csm_Position = position * vec3(1.0);\n                vUv = uv;\n            } ",fragmentShader:t,side:s,uniforms:a.material.uniforms});this.material=i,console.log(this.material)}static replaceVariable(e){if(/iTime|iTimeDelta/g.test(e="varying vec2 vUv;\n"+e)){let a=e.split("varying vec2 vUv;\n");e=(e="varying vec2 vUv;\nuniform float utime;\n"+a[1]).replace(/iTime|iTimeDelta/g,"utime")}if(/iResolution\.[a-zA-Z_]+/g.test(e)){let a=e.split("varying vec2 vUv;\n");e=(e=(e="varying vec2 vUv;\nuniform vec2 uresolution;\n"+a[1]).replace(/iResolution\.[a-zA-Z_]+/g,"1.")).replace(/iResolution/g,"1.")}if(/iChannel0|iChannel1|iChannel2|iChannel3/g.test(e)){let a=e.split("varying vec2 vUv;\n");e=(e="varying vec2 vUv;\nuniform sampler2D  utexture;\n"+a[1]).replace(/iChannel0|iChannel1|iChannel2|iChannel3/g,"utexture")}return e.replace(/iMouse/g,"umouse"),e.replace(/void mainImage\( out vec4 fragColor, in vec2 fragCoord \)/g,"void main()").replace(/fragColor/g,"csm_DiffuseColor").replace(/fragCoord/g,"vUv")}}const G={ref:"perspectiveCameraRef",position:[300,250,-122],fov:45,near:1,far:1e4},L=["object","side"],R=d({__name:"shadertoyMaterial",async setup(r){let m,d;const R={clearColor:"#000000",shadows:!0,alpha:!1,useLegacyLights:!0},S={autoRotate:!0,enableDamping:!0},B=new c({title:"参数"}),H=h({addres:"https://www.shadertoy.com/view/mtyGWy",shadervalue:""});let P=([m,d]=f((()=>t(["./plugins/earthSample/image/earthA/moon_ring.png"]))),m=await m,d(),m),z=new i,E=h({material:{uniforms:{utime:{value:0},uresolution:{value:new o(40,40)},utexture:{value:P}}}}),I=new n(100,100,100);B.addBlade({view:"list",label:"shadertoy在线地址",parse:e=>String(e),options:[{text:"1",value:"https://www.shadertoy.com/view/mtyGWy"},{text:"2",value:"https://www.shadertoy.com/view/tlVGDt"},{text:"3",value:"https://www.shadertoy.com/view/ttKGDt"}],value:"https://www.shadertoy.com/view/mtyGWy"}).on("change",(e=>{H.addres=e.value,W(I)}));let K=new n(100,100,100),M=new l(100,100),V=new v(100,10,100,16);B.addBlade({view:"list",label:"几何体",options:[{text:"BOX",value:K},{text:"Plane",value:M},{text:"TorusKnot",value:V}],value:K}).on("change",(e=>{I=e.value,W(I)}));const W=e=>{let a="https://www.shadertoy.com/api/v1/shaders/"+H.addres.split("https://www.shadertoy.com/view/")[1]+"?key=BdHlhH";p.get(a).then((function(a){a.data.Error&&alert(a.data.Error),H.shadervalue=a.data.Shader.renderpass[0].code;let t=new A(H.shadervalue,E);z.clear();let s=new u(e,t.material);z.add(s),k(z,e)})).catch((function(e){console.log(e)}))},k=(e,a)=>{e.children[0].geometry.dispose(),e.children[0].geometry=a},{onLoop:Z}=e();return Z((({delta:e})=>{E.material.uniforms.utime.value+=e})),g((()=>{let e=new n(100,100,100);W(e)})),(e,t)=>{const r=w("TresCanvas");return C(),y(r,_(R,{"window-size":""}),{default:x((()=>[j("TresPerspectiveCamera",G,null,512),T(b(a),U(D(S)),null,16),t[0]||(t[0]=j("TresAmbientLight",{color:"#ffffff"},null,-1)),t[1]||(t[1]=j("TresDirectionalLight",{position:[100,100,0],intensity:.5,color:"#ffffff"},null,-1)),j("primitive",{object:b(z),side:b(s)},null,8,L),t[2]||(t[2]=j("TresAxesHelper",{args:[1e3],position:[0,19,0]},null,-1)),t[3]||(t[3]=j("TresGridHelper",{args:[6e3,100],position:[0,19,0]},null,-1))])),_:1},16)}}});export{R as default};
