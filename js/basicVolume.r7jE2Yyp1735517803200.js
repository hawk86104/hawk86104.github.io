import{m as n,e as t,U as e}from"./@tresjs.0qL_P2CE1735517803200.js";import{_ as r,n as o}from"./three.-uH5I3Xp1735517803200.js";import{P as a}from"./tweakpane.yHWGBmom1735517803200.js";import{d as i,b as c,r as l,w as u,q as s,o as p,D as m,J as v,u as f,e as _,x as d,j as g,g as x,aj as h,ak as y,f as b,al as S,m as w,F as z}from"./@vue.-THQH3GC1735517803200.js";import{_ as j}from"./@fesjs.2Oz5LDgh1735517803200.js";import"./@vueuse.oT9wchAS1735517803200.js";import"./vue-router.alj9m51K1735517803200.js";import"./lodash-es.kYt-_xTG1735517803200.js";import"./@qlin.yHhFDldE1735517803200.js";import"./pinia.7wRRlR_11735517803200.js";import"./vue-demi.C4xddsk91735517803200.js";import"./@floating-ui.BPbuo5Gx1735517803200.js";import"./@juggle.7yjBMqoW1735517803200.js";const D=T;!function(n,t){const e=T,r=k();for(;;)try{if(861015===parseInt(e(438))/1+-parseInt(e(439))/2+-parseInt(e(433))/3*(-parseInt(e(400))/4)+-parseInt(e(432))/5+-parseInt(e(446))/6+-parseInt(e(424))/7+parseInt(e(423))/8)break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const I=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[T(403)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();function k(){const n=["exception","rotation-x","while (true) {}","then","u_color","LinearFilter","action","info","error","color","chain","u_volume","expanded","u_isoValue","value","52HHqJDv","addBinding","Display Settings","apply","arrayBuffer","trace","table","toString","gger","function *\\( *\\)","init","innerWidth","return (function() ","test","addFolder","format","Algorithm Settings","start","log","Error fetching volume data:","needsUpdate","RepeatWrapping",'{}.constructor("return this")( )',"17542024fcThEe","9247119SIktIT","counter","stateObject","u_time","call","catch","constructor","length","5665870OTDqSL","156984UEzxot","bind","uniforms","fragmentShader","isoValue","1679596TxnAcn","555868shDriL","Data3DTexture","vertexShader","Clock","console","position","minFilter","5756838UiYoWc","input","debu","wrapT","magFilter","meshRef","alphaVal","RedFormat","u_dt","basicVolumeRendering","Vector3","innerHeight"];return(k=function(){return n})()}!function(){I(this,(function(){const n=T,t=new RegExp(n(409)),e=new RegExp("\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","i"),r=A(n(410));t.test(r+n(468))&&e[n(413)](r+n(447))?A():r("0")}))()}();const V=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[T(403)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();function T(n,t){const e=k();return(T=function(n,t){return e[n-=397]})(n,t)}V(void 0,(function(){const n=T;let t;try{t=Function(n(412)+n(422)+");")()}catch(o){t=window}const e=t[n(443)]=t[n(443)]||{},r=[n(418),"warn",n(465),n(466),n(458),n(406),n(405)];for(let a=0;a<r.length;a++){const t=V.constructor.prototype[n(434)](V),o=r[a],i=e[o]||t;t.__proto__=V[n(434)](V),t[n(407)]=i[n(407)].bind(i),e[o]=t}}))();const M=[D(459)],P=[D(435),D(441),D(436)],L=41,O=i({__name:D(455),setup(e){var i;const _=D,d=window[_(411)],g=window[_(457)],x=c(null),h=c(null),y=new(r[_(442)]);y[_(417)]();const b=(new a).addFolder({title:_(402)}),S=b[_(414)]({title:"Cross Section Settings"}),w=new(r[_(456)])(.5,.5,.5);S[_(401)](w,"x",{label:"X",min:.02,max:.5,step:.02}),S[_(401)](w,"y",{label:"Y",min:.02,max:.5,step:.02}),S.addBinding(w,"z",{label:"Z",min:.02,max:.5,step:.02}),S[_(397)]=!0;const{camera:z}=n(),j=l({u_camera:{value:null==(i=z[_(399)])?void 0:i[_(444)]},u_resolution:{value:new(r[_(456)])(d,g,1)},u_dt:{value:.004},u_time:{value:0},u_crossSectionSize:{value:w},u_color:{value:1},u_volume:{value:null},u_isoValue:{value:.2},u_alphaVal:{value:.2}}),I=b[_(414)]({title:_(416)});I[_(401)](j[_(454)],_(399),{label:"dt",min:4e-4,max:.016,step:2e-4}),I[_(401)](j[_(462)],_(399),{label:_(467),min:1,max:3,step:1}),I.addBinding(j.u_alphaVal,_(399),{label:_(452),min:.01,max:1,step:.01}),I[_(401)](j[_(398)],_(399),{label:_(437),min:0,max:1,step:.04}),u(h,(n=>{const t=_;if(n){const e=new(r[t(440)])(n,L,L,L);e[t(415)]=r[t(453)],e[t(445)]=o,e[t(450)]=r[t(463)],e[t(449)]=r[t(421)],e[t(420)]=!0,j[t(469)][t(399)]=e}}));const{onLoop:k}=t();return k((()=>{const n=_;j[n(427)][n(399)]=y.getElapsedTime()})),s((()=>{(()=>{const n=_;fetch("/plugins/volumeRendering/image/nucleon_41x41x41_uint8.raw")[n(461)]((t=>t[n(404)]()))[n(461)]((t=>{const e=n,r=new Uint8Array(t),o=new Uint8Array(68921);for(let n=0;n<r[e(431)];n++)o[n]=r[n];h[e(399)]=o}))[n(429)]((t=>{const e=n;console[e(466)](e(419),t)}))})()})),(n,t)=>{const e=_;return p(),m("TresMesh",{ref_key:e(451),ref:x,"rotation-x":Math.PI/-2},[t[0]||(t[0]=v("TresSphereGeometry",{args:[1,16,16]},null,-1)),v("TresShaderMaterial",{uniforms:j,vertexShader:f("precision mediump float;\n\nuniform vec3 u_camera;\nuniform vec3 u_resolution;\nuniform float u_time;\n\nvarying vec3 v_hitPos;\nvarying vec3 v_hitPosWorldSpace;\nvarying vec3 v_cameraObjectSpace;\n\nvoid main() {\n  vec3 pos = position;\n\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\n\n  v_hitPos = position.xyz;\n\n  v_hitPosWorldSpace = (modelMatrix * vec4(position, 1.0)).xyz;\n\n  v_cameraObjectSpace = (inverse(modelMatrix) * vec4(u_camera, 1.0)).xyz;\n}"),fragmentShader:f("precision mediump int;\nprecision mediump float;\n\nuniform vec3 u_camera;\nuniform vec3 u_resolution;\nuniform mediump sampler3D u_volume;\nuniform vec3 u_crossSectionSize;\nuniform float u_dt;\nuniform float u_time;\nuniform float u_color;\nuniform float u_isoValue;\nuniform float u_alphaVal;\n\nvec3 palette(in float t) {\n  vec3 a = vec3(0.5, 0.5, 0.5);\n  vec3 b = vec3(0.5, 0.5, 0.5);\n  vec3 c = vec3(1.0, 1.0, 1.0);\n  vec3 d = vec3(0.00, 0.33, 0.67);\n\n  return a + b * cos(6.28318 * (c * t + d));\n}\n\nvarying vec3 v_hitPos;\nvarying vec3 v_hitPosWorldSpace;\nvarying vec3 v_cameraObjectSpace;\n\nvec2 intersect_box(vec3 orig, vec3 dir) {\n\n  vec3 box_min = vec3(-u_crossSectionSize);\n  vec3 box_max = vec3(u_crossSectionSize);\n  vec3 inv_dir = 1.0 / dir;\n  vec3 tmin_tmp = (box_min - orig) * inv_dir;\n  vec3 tmax_tmp = (box_max - orig) * inv_dir;\n  vec3 tmin = min(tmin_tmp, tmax_tmp);\n  vec3 tmax = max(tmin_tmp, tmax_tmp);\n  float t0 = max(tmin.x, max(tmin.y, tmin.z));\n  float t1 = min(tmax.x, min(tmax.y, tmax.z));\n  return vec2(t0, t1);\n}\n\nvoid main() {\n  vec3 rayOrigin = vec3(0.0, 0.0, -3.0);\n  rayOrigin = v_cameraObjectSpace;\n\n  vec2 uv = 2.0 * gl_FragCoord.xy / u_resolution.xy - 1.0;\n  vec3 rayDir = normalize(vec3(uv, 1.0));\n  rayDir = normalize(v_hitPos - rayOrigin);\n\n  vec2 t_hit = intersect_box(rayOrigin, rayDir);\n  if (t_hit.x > t_hit.y) {\n    discard;\n  }\n\n  t_hit.x = max(t_hit.x, 0.0);\n\n  float dt = u_dt;\n\n  vec4 color = vec4(0.0);\n\n  vec3 p = rayOrigin + t_hit.x * rayDir + 0.5;\n  for (float t = t_hit.x; t < t_hit.y; t += dt) {\n\n    float textureVal = texture(u_volume, p).r;\n\n    vec4 val_color = vec4(0.0);\n    float val_color_alpha = textureVal * 0.1;\n\n    val_color_alpha = smoothstep(0.0, u_alphaVal, val_color_alpha);\n\n    vec3 red = vec3(1.0, 0.0, 0.0);\n    vec3 white = vec3(1.0);\n    if (abs(u_color - 1.0) <= 0.01) {\n      val_color = vec4(white, val_color_alpha);\n    } else if (abs(u_color - 2.0) <= 0.01) {\n      val_color = vec4(mix(red, white, val_color_alpha), val_color_alpha);\n    } else {\n      val_color = vec4(palette(textureVal), val_color_alpha);\n    }\n\n    color.rgb += (1.0 - color.a) * val_color.a * val_color.rgb;\n    color.a += (1.0 - color.a) * val_color.a;\n\n    if (textureVal > u_isoValue) {\n      float gxLess = texture(u_volume, vec3(p.x - rayDir.x * u_dt, p.y, p.z)).r;\n      float gxMore = texture(u_volume, vec3(p.x + rayDir.x * u_dt, p.y, p.z)).r;\n      float dgx = gxMore - gxLess;\n\n      float gyLess = texture(u_volume, vec3(p.x, p.y - rayDir.y * u_dt, p.z)).r;\n      float gyMore = texture(u_volume, vec3(p.x, p.y + rayDir.y * u_dt, p.z)).r;\n      float dgy = gyMore - gyLess;\n\n      float gzLess = texture(u_volume, vec3(p.x, p.y, p.z - rayDir.z * u_dt)).r;\n      float gzMore = texture(u_volume, vec3(p.x, p.y, p.z + rayDir.z * u_dt)).r;\n      float dgz = gzMore - gzLess;\n      vec3 n = normalize(vec3(dgx, dgy, dgz));\n\n      vec3 lightSource = vec3(1.0);\n      vec3 lightDir = normalize(lightSource);\n      float diffuseStrength = max(dot(n, lightDir), 0.0);\n\n      vec3 viewSource = normalize(rayOrigin);\n      vec3 reflectSource = normalize(reflect(-lightSource, n));\n      float specularStrength = max(0.0, dot(viewSource, reflectSource));\n      specularStrength = pow(specularStrength, 64.0);\n\n      color.rgb = diffuseStrength * val_color.rgb + specularStrength * val_color.rgb;\n      color.rgb *= val_color.rgb;\n      color.a = 0.95;\n      break;\n    }\n\n    if (color.a >= 0.95) {\n      break;\n    }\n\n    p += rayDir * dt;\n  }\n\n  gl_FragColor = color;\n}")},null,8,P)],8,M)}}});function A(n){function t(n){const e=T;if("string"==typeof n)return function(n){}.constructor(e(460))[e(403)](e(425));1!==(""+n/n).length||n%20==0?function(){return!0}[e(430)](e(448)+e(408))[e(428)](e(464)):function(){return!1}[e(430)](e(448)+e(408)).apply(e(426)),t(++n)}try{if(n)return t;t(0)}catch(e){}}const R=C;!function(n,t){const e=C,r=q();for(;;)try{if(705740===parseInt(e(309))/1+parseInt(e(278))/2+parseInt(e(269))/3*(-parseInt(e(297))/4)+-parseInt(e(296))/5*(-parseInt(e(285))/6)+parseInt(e(281))/7*(parseInt(e(268))/8)+parseInt(e(289))/9*(-parseInt(e(290))/10)+-parseInt(e(288))/11*(parseInt(e(300))/12))break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const F=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[C(303)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();!function(){F(this,(function(){const n=C,t=new RegExp(n(304)),e=new RegExp(n(277),"i"),r=U(n(284));t[n(305)](r+n(295))&&e[n(305)](r+"input")?U():r("0")}))()}();const E=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e.apply(t,arguments);return e=null,n}}:function(){};return n=!1,r}}();function C(n,t){const e=q();return(C=function(n,t){return e[n-=268]})(n,t)}function q(){const n=["stateObject","gger","1507EnJhtl","189rlELdO","389190rPBoGR","constructor","action","TresCanvas","div","chain","495MjLqqq","65292NHQMAt","basicVolume","#201919","45132gPLaUK","toString","log","apply","function *\\( *\\)","test","counter","while (true) {}","console","636789WlkucC","1514416jXBPAG","9vdKJVA","__proto__","length",'{}.constructor("return this")( )',"bind","TresGridHelper","call","https://klacansky.com/open-scivis-datasets/skull/skull_256x256x256_uint8.raw","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","40250TTpJgF","table","info","49amDykY","debu","error","init","6378dnANxQ"];return(q=function(){return n})()}E(void 0,(function(){const n=C;let t;try{t=Function("return (function() "+n(272)+");")()}catch(o){t=window}const e=t[n(308)]=t[n(308)]||{},r=[n(302),"warn",n(280),n(283),"exception",n(279),"trace"];for(let a=0;a<r[n(271)];a++){const t=E.constructor.prototype[n(273)](E),o=r[a],i=e[o]||t;t[n(270)]=E[n(273)](E),t[n(301)]=i.toString[n(273)](i),e[o]=t}}))();function U(n){function t(n){const e=C;if("string"==typeof n)return function(n){}[e(291)](e(307))[e(303)](e(306));1!==(""+n/n)[e(271)]||n%20==0?function(){return!0}[e(291)](e(282)+"gger")[e(275)](e(292)):function(){return!1}[e(291)]("debu"+e(287))[e(303)](e(286)),t(++n)}try{if(n)return t;t(0)}catch(e){}}const W=j(i({__name:R(298),setup(n){const t=l({windowSize:!0,alpha:!0,antialias:!0,autoClear:!1,disableRender:!0}),r=l({enableDamping:!0,enableZoom:!0,enablePan:!0,enableRotate:!0,makeDefault:!0});return(n,o)=>{const a=C,i=_(a(293));return p(),m(z,null,[o[3]||(o[3]=v(a(294),{class:a(280)},[v("a",{href:a(276),target:"_blank"}," https://klacansky.com/open-scivis-datasets/skull/skull_256x256x256_uint8.raw "),v("br"),d(" 请自行下载数据集, 复制到 /plugins/volumeRendering/image/skull_256x256x256_uint8.raw 并更改文件请求指向和 dim 大小 ")],-1)),g(i,w({clearColor:a(299)},t),{default:x((()=>[o[0]||(o[0]=v("TresPerspectiveCamera",{fov:75,near:.001,far:1e3,position:[-1,.4,-1],"look-at":[0,0,0],up:[0,1,0]},null,-1)),o[1]||(o[1]=v("TresAmbientLight",{intensity:2},null,-1)),g(f(e),h(y(r)),null,16),(p(),b(S,null,{default:x((()=>[g(O,{position:[0,0,0]})])),_:1})),o[2]||(o[2]=v(a(274),{args:[50,50],position:[0,-5,0]},null,-1))])),_:1},16)],64)}}}),[["__scopeId","data-v-925b4c37"]]);export{W as default};
