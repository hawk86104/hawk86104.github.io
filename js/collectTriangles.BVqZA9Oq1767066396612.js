import{i as e}from"./3d-tiles-renderer.CbgZh8zU1767066396612.js";import{F as t,_ as n,K as r,t as s}from"./@tresjs.B1f7s3pS1767066396612.js";import{f as o}from"./generalFont.vue_vue_type_script_setup_true_lang.Z5LxGLZ21767066396612.js";import"./default.vue_vue_type_script_setup_true_lang.VHSeCGYE1767066396612.js";import"./three-mesh-ui.module.dA3oDDhS1767066396612.js";import"./domPanel.vue_vue_type_style_index_0_lang.D11M9pLL1767066396612.js";import{j as a}from"./customShaderMaterial.vue_vue_type_script_setup_true_lang.DS9PWjZT1767066396612.js";import"./index.vue_vue_type_script_setup_true_lang.iYOGhvYh1767066396612.js";import{P as l}from"./three.BD1hRFgo1767066396612.js";import{P as i}from"./tweakpane.CqZAnw7f1767066396612.js";import{I as u,C as c,N as p,c as m,d as v,a as d}from"./three-mesh-bvh.BBErpT9w1767066396612.js";const f=await e("three"),{withAsyncContext:g,defineComponent:y}=await e("vue"),{unref:h,createElementVNode:w,Fragment:_,openBlock:b,createElementBlock:j}=await e("vue"),B=["geometry","material"],x=["geometry"],M=await e("three"),{ref:T,watchEffect:A}=await e("vue"),C=y({__name:"model",props:{controls:{}},async setup(e){let r,s;const o=e;M.BufferGeometry.prototype.computeBoundsTree=m,M.BufferGeometry.prototype.disposeBoundsTree=v,M.Mesh.prototype.raycast=d;const y=([r,s]=g(()=>a(l,"https://opensource.cdn.icegl.cn/model/industry4/TR12J_OCC.stl")),r=await r,s(),r),C=new M.MeshStandardMaterial({color:16777215,roughness:.2,metalness:1,vertexColors:!0}),k=new Uint8Array(3*y.attributes.position.count);k.fill(255);const S=new M.BufferAttribute(k,3,!0);S.setUsage(M.DynamicDrawUsage),y.setAttribute("color",S);const E=T(null),F=T(null),R=T(!1),X=T(-1),P=T(.2),Y=new M.Vector2,{camera:z}=t(),O=T(new M.Raycaster),V=15/255,G=78/255,H=85/255;let L=null;A(()=>{E.value&&(console.log("targetMesh.value init",E.value),E.value.geometry.computeBoundsTree(),L=y.boundsTree,((e,t,n,r,s,o)=>{window.addEventListener("pointermove",n=>{e.x=n.clientX/window.innerWidth*2-1,e.y=-n.clientY/window.innerHeight*2+1,t.value=!0}),window.addEventListener("pointerdown",a=>{e.x=a.clientX/window.innerWidth*2-1,e.y=-a.clientY/window.innerHeight*2+1,r.value=a.button;const l=new f.Raycaster;l.setFromCamera(e,n.value),l.firstHitOnly=!0;const i=l.intersectObject(s.value,!0);t.value=!0,o.enabled=0===i.length},!0),window.addEventListener("pointerup",e=>{r.value=-1,"touch"===e.pointerType&&(t.value=!1)},!0)})(Y,R,z,X,E,o.controls.instance))});const{onBeforeRender:N}=n();N(()=>{const e=y.index;if(F.value)if(o.controls.instance.active||!R.value)F.value.visible=!1;else{F.value.scale.setScalar(P.value),O.value.setFromCamera(Y,z.value),O.value.firstHitOnly=!0;const t=O.value.intersectObject(E.value,!0);if(t.length){F.value.position.copy(t[0].point),o.controls.instance.enabled=!1,F.value.visible=!0;const n=new M.Matrix4;n.copy(E.value.matrixWorld).invert();const r=new M.Sphere;r.center.copy(F.value.position).applyMatrix4(n),r.radius=100*P.value;const s=[],a=new M.Vector3;if(L?.shapecast({intersectsBounds:e=>{const t=r.intersectsBox(e),{min:n,max:s}=e;if(t){for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let o=0;o<=1;o++)if(a.set(0===e?n.x:s.x,0===t?n.y:s.y,0===o?n.z:s.z),!r.containsPoint(a))return u;return c}return t?u:p},intersectsTriangle:(e,t,n)=>{if(n||e.intersectsSphere(r)){const e=3*t;s.push(e,e+1,e+2)}return!1}}),0===X.value||2===X.value){let t=1,n=1,r=1;0===X.value&&(t=V,n=G,r=H);for(let o=0,a=s.length;o<a;o++){const a=e.getX(s[o]);S.setX(a,t),S.setY(a,n),S.setZ(a,r)}S.needsUpdate=!0}}else F.value.visible=!1,o.controls.instance.enabled=!0}});const U=(new i).addButton({title:"点击按钮",label:"生成模型"}),Z=new M.BufferGeometry;return Z.setAttribute("position",new M.BufferAttribute(new Float32Array,0)),U.on("click",()=>{const e=[],t=[];for(let r=0;r<S.count;r++)S.getX(r)===V&&S.getY(r)===G&&S.getZ(r)===H&&(e.push(y.attributes.position.getX(r),y.attributes.position.getY(r),y.attributes.position.getZ(r)),t.push(y.attributes.normal.getX(r),y.attributes.normal.getY(r),y.attributes.normal.getZ(r)));const n=new Float32Array(e);Z.setAttribute("position",new M.BufferAttribute(n,3)),Z.setAttribute("normal",new M.BufferAttribute(n,3))}),(e,t)=>(b(),j(_,null,[w("TresMesh",{ref_key:"targetMesh",ref:E,geometry:h(y),scale:.005,material:h(C)},null,8,B),w("TresMesh",{ref_key:"brushMesh",ref:F,visible:!1},[...t[0]||(t[0]=[w("TresSphereGeometry",{args:[1,40,40]},null,-1),w("TresMeshStandardMaterial",{color:15483002,roughness:.75,metalness:0,transparent:!0,opacity:.5,premultipliedAlpha:!0,emissive:15483002,emissiveIntensity:.5},null,-1)])],512),w("TresMesh",{geometry:h(Z),position:[-2,-2,2],scale:.005},[...t[1]||(t[1]=[w("TresMeshStandardMaterial",{color:"#023249",roughness:.2,metalness:0,envMapIntensity:.2},null,-1)])],8,x)],64))}}),{defineComponent:k}=await e("vue"),{unref:S,createVNode:E,createElementVNode:F,mergeProps:R,Suspense:X,withCtx:P,openBlock:Y,createBlock:z,resolveComponent:O,Fragment:V,createElementBlock:G}=await e("vue"),{reactive:H,ref:L}=await e("vue"),N=k({__name:"collectTriangles",setup(e){const t=H({clearColor:"#999999",antialias:!0}),n=H({autoRotate:!1}),a=L(null);return(e,l)=>{const i=O("TresCanvas");return Y(),G(V,null,[E(S(o)),E(i,R(t,{"window-size":""}),{default:P(()=>[l[0]||(l[0]=F("TresPerspectiveCamera",{position:[5,1,15],fov:30,near:.1,far:1e3},null,-1)),E(S(r),R({ref_key:"controlsRef",ref:a},n),null,16),l[1]||(l[1]=F("TresAmbientLight",{intensity:1},null,-1)),(Y(),z(X,null,{default:P(()=>[E(C,{controls:a.value},null,8,["controls"])]),_:1})),(Y(),z(X,null,{default:P(()=>[E(S(s),{background:!1,files:["pos-x.jpg","neg-x.jpg","pos-y.jpg","neg-y.jpg","pos-z.jpg","neg-z.jpg"],path:"https://opensource.cdn.icegl.cn/images/skyBox/6jpg/"},null,8,["path"])]),_:1}))]),_:1},16)],64)}}});export{N as default};
