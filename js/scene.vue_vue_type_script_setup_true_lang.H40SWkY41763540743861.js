import{B as e}from"./three-custom-shader-material.C6taB_aY1763540743861.js";import{bL as a,be as n,af as i,b1 as t,am as r,ae as s,ei as l,M as o}from"./three.rXKzP9fQ1763540743861.js";import{P as m}from"./tweakpane.CqZAnw7f1763540743861.js";import{u as d}from"./colorList.DbCLsRg71763540743861.js";import{u as h}from"./rawData.Bm5IktqG1763540743861.js";import{d as u,a as p,c,r as x,w as g,H as w,o as v,J as b,u as f}from"./@vue.Co_gxueH1763540743861.js";const T=["scale","visible"],y=["scale"],L=["object"],S=["object"],j=["object"],M=["object"],A=u({__name:"scene",setup(u){const A=p(-1),D=p(-1),z=p(.6),B=c(()=>!(A.value<=.01&&A.value>=-.01)&&(!(D.value<=.01&&D.value>=-.01)&&!(z.value<=.01&&z.value>=-.01))),R=d(),_=h(),H=(()=>{const e=new l(_.xExtent,_.yExtent,_.zExtent,_.dataType[_.selectDataType].title,_.byteArray);e.spacing=[1,1,1],e.RASDimensions=[Math.floor(e.xLength),Math.floor(e.yLength),Math.floor(e.zLength)],e.matrix=new o,e.inverseMatrix=new o,e.inverseMatrix.copy(e.matrix).invert();const a=e.computeMinMax(),n=a[0],i=a[1];return e.windowLow=n,e.windowHigh=i,e.lowerThreshold=n,e.upperThreshold=i,e})(_.byteArray),F=new a(new n(new i(H.xLength,H.yLength,H.zLength)),new t({color:6710886})),k=x({x:Math.floor(H.RASDimensions[0]/2),y:Math.floor(H.RASDimensions[1]/2),z:Math.floor(H.RASDimensions[2]/4)});H.windowHigh=136;const E=H.extractSlice("x",k.x),O=H.extractSlice("y",k.y),C=H.extractSlice("z",k.z),G={vertexShader:"\n\t\tvoid main() {\n\t\t\tcsm_Position = position * vec3(1.0);\n\t\t}\n\t\t",fragmentShader:"\n        uniform sampler2D eTexture;     //纹理图像\n        void main() {\n            csm_DiffuseColor = texture2D( eTexture, vec2(csm_DiffuseColor.r*1.,0.5));\n        }\n    ",uniforms:{eTexture:{value:R.updateTransferFunction()}},silent:!0,flatShading:!0,side:s,transparent:!0,depthTest:!0,depthWrite:!1,blending:r};E.mesh.material=new e({baseMaterial:E.mesh.material,...G}),O.mesh.material=new e({baseMaterial:O.mesh.material,...G}),C.mesh.material=new e({baseMaterial:C.mesh.material,...G});const P=new m;return P.addBinding(A,"value",{label:"x轴缩放",min:-2,max:2,step:.01}),P.addBinding(D,"value",{label:"y轴缩放",min:-2,max:2,step:.01}),P.addBinding(z,"value",{label:"z轴缩放",min:-2,max:2,step:.01}),P.addBinding(k,"x",{label:"x剖面",min:0,max:H.RASDimensions[0],step:1}),P.addBinding(k,"y",{label:"y剖面",min:0,max:H.RASDimensions[1],step:1}),P.addBinding(k,"z",{label:"z剖面",min:0,max:H.RASDimensions[2],step:1}),P.addBinding(H,"lowerThreshold",{label:"lowerThreshold",min:H.min,max:H.max,step:1}).on("change",()=>{H.repaintAllSlices()}),P.addBinding(H,"upperThreshold",{label:"upperThreshold",min:H.min,max:H.max,step:1}).on("change",()=>{H.repaintAllSlices()}),P.addBinding(H,"windowLow",{label:"windowLow",min:H.min,max:H.max,step:1}).on("change",()=>{H.repaintAllSlices()}),P.addBinding(H,"windowHigh",{label:"windowHigh",min:H.min,max:H.max,step:1}).on("change",()=>{H.repaintAllSlices()}),g(()=>k,e=>{E.index=e.x,E.repaint.call(E),O.index=e.y,O.repaint.call(O),C.index=e.z,C.repaint.call(C)},{deep:!0}),g(()=>R.colorsStops,()=>{E.mesh.material.uniforms.eTexture.value=R.updateTransferFunction(),O.mesh.material.uniforms.eTexture.value=R.updateTransferFunction(),C.mesh.material.uniforms.eTexture.value=R.updateTransferFunction()},{deep:!0,immediate:!0}),(e,a)=>(v(),w("TresGroup",{scale:[A.value,D.value,z.value],visible:B.value},[b("TresGroup",{scale:[1/f(H).xLength,1/f(H).xLength*f(H).xLength/f(H).yLength,1/f(H).xLength*f(H).xLength/f(H).zLength]},[b("primitive",{object:f(E).mesh,renderOrder:1},null,8,L),b("primitive",{object:f(O).mesh,renderOrder:2},null,8,S),b("primitive",{object:f(C).mesh,renderOrder:3},null,8,j),b("primitive",{object:f(F)},null,8,M)],8,y)],8,T))}});export{A as _};
