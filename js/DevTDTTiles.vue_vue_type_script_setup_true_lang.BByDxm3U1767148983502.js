import{importShared as Vt}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";const{shallowRef:tp,watchEffect:EA,readonly:AA,watch:Ri,customRef:PA,getCurrentScope:Rg,onScopeDispose:Og,effectScope:MA,getCurrentInstance:ql,hasInjectionContext:kg,inject:Lg,provide:Ig,ref:Dg,isRef:np,unref:SA,toValue:Nt,computed:Ng,reactive:CA,toRefs:RA,toRef:OA,shallowReadonly:Xl,onBeforeMount:kA,nextTick:Ja,onBeforeUnmount:LA,onMounted:Fg,onUnmounted:IA,isReactive:DA}=await Vt("vue");function Mn(n){return Rg()?(Og(n),!0):!1}function Oi(){const n=new Set,e=s=>{n.delete(s)};return{on:s=>{n.add(s);const o=()=>e(s);return Mn(o),{off:o}},off:e,trigger:(...s)=>Promise.all(Array.from(n).map(o=>o(...s))),clear:()=>{n.clear()}}}const xr=new WeakMap,rp=(...n)=>{var e;const t=n[0],r=(e=ql())==null?void 0:e.proxy;if(r==null&&!kg())throw new Error("injectLocal must be called in setup");return r&&xr.has(r)&&t in xr.get(r)?xr.get(r)[t]:Lg(...n)};function Ug(n,e){var t;const r=(t=ql())==null?void 0:t.proxy;if(r==null)throw new Error("provideLocal must be called in setup");xr.has(r)||xr.set(r,Object.create(null));const i=xr.get(r);return i[n]=e,Ig(n,e)}function jg(n,e){const t=e?.injectionKey||Symbol(n.name||"InjectionState"),r=e?.defaultValue;return[(...o)=>{const a=n(...o);return Ug(t,a),a},()=>rp(t,r)]}const Ws=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Bg=Object.prototype.toString,zg=n=>Bg.call(n)==="[object Object]",kr=()=>{};function Vg(n,e){function t(...r){return new Promise((i,s)=>{Promise.resolve(n(()=>e.apply(this,r),{fn:e,thisArg:this,args:r})).then(i).catch(s)})}return t}function $g(n,e={}){let t,r,i=kr;const s=l=>{clearTimeout(l),i(),i=kr};let o;return l=>{const c=Nt(n),u=Nt(e.maxWait);return t&&s(t),c<=0||u!==void 0&&u<=0?(r&&(s(r),r=void 0),Promise.resolve(l())):new Promise((h,d)=>{i=e.rejectOnCancel?d:h,o=l,u&&!r&&(r=setTimeout(()=>{t&&s(t),r=void 0,h(o())},u)),t=setTimeout(()=>{r&&s(r),r=void 0,h(l())},c)})}}function Ks(n,e=!1,t="Timeout"){return new Promise((r,i)=>{setTimeout(e?()=>i(t):r,n)})}function eu(n){return n.endsWith("rem")?Number.parseFloat(n)*16:Number.parseFloat(n)}function Us(n){return Array.isArray(n)?n:[n]}function Hg(n){return ql()}function Gg(n,e=200,t={}){return Vg($g(e,t),n)}function tu(n,e=200,t={}){const r=Dg(Nt(n)),i=Gg(()=>{r.value=n.value},e,t);return Ri(n,()=>i()),Xl(r)}function ip(n,e=!0,t){Hg()?Fg(n,t):e?n():Ja(n)}function el(n,e=!1){function t(h,{flush:d="sync",deep:f=!1,timeout:p,throwOnTimeout:m}={}){let g=null;const v=[new Promise(y=>{g=Ri(n,T=>{h(T)!==e&&(g?g():Ja(()=>g?.()),y(T))},{flush:d,deep:f,immediate:!0})})];return p!=null&&v.push(Ks(p,m).then(()=>Nt(n)).finally(()=>g?.())),Promise.race(v)}function r(h,d){if(!np(h))return t(T=>T===h,d);const{flush:f="sync",deep:p=!1,timeout:m,throwOnTimeout:g}=d??{};let _=null;const y=[new Promise(T=>{_=Ri([n,h],([A,w])=>{e!==(A===w)&&(_?_():Ja(()=>_?.()),T(A))},{flush:f,deep:p,immediate:!0})})];return m!=null&&y.push(Ks(m,g).then(()=>Nt(n)).finally(()=>(_?.(),Nt(n)))),Promise.race(y)}function i(h){return t(d=>!!d,h)}function s(h){return r(null,h)}function o(h){return r(void 0,h)}function a(h){return t(Number.isNaN,h)}function l(h,d){return t(f=>{const p=Array.from(f);return p.includes(h)||p.includes(Nt(h))},d)}function c(h){return u(1,h)}function u(h=1,d){let f=-1;return t(()=>(f+=1,f>=h),d)}return Array.isArray(Nt(n))?{toMatch:t,toContains:l,changed:c,changedTimes:u,get not(){return el(n,!e)}}:{toMatch:t,toBe:r,toBeTruthy:i,toBeNull:s,toBeNaN:a,toBeUndefined:o,changed:c,changedTimes:u,get not(){return el(n,!e)}}}function Wg(n){return el(n)}function Kg(n,e=1e3,t={}){const{immediate:r=!0,immediateCallback:i=!1}=t;let s=null;const o=tp(!1);function a(){s&&(clearInterval(s),s=null)}function l(){o.value=!1,a()}function c(){const u=Nt(e);u<=0||(o.value=!0,i&&n(),a(),o.value&&(s=setInterval(n,u)))}if(r&&Ws&&c(),np(e)||typeof e=="function"){const u=Ri(e,()=>{o.value&&Ws&&c()});Mn(u)}return Mn(l),{isActive:Xl(o),pause:l,resume:c}}function qg(n,e,t={}){const{immediate:r=!0,immediateCallback:i=!1}=t,s=tp(!1);let o;function a(){o&&(clearTimeout(o),o=void 0)}function l(){s.value=!1,a()}function c(...u){i&&n(),a(),s.value=!0,o=setTimeout(()=>{s.value=!1,o=void 0,n(...u)},Nt(e))}return r&&(s.value=!0,Ws&&c()),Mn(l),{isPending:Xl(s),start:c,stop:l}}function Xg(n=1e3,e={}){const{controls:t=!1,callback:r}=e,i=qg(r??kr,n,e),s=Ng(()=>!i.isPending.value);return t?{ready:s,...i}:s}function sp(n,e,t){return Ri(n,e,{...t,immediate:!0})}const{isRef:NA,shallowRef:Ve,ref:op,watchEffect:Yg,computed:Zr,inject:FA,defineComponent:UA,h:jA,TransitionGroup:BA,Fragment:zA,shallowReactive:VA,toValue:tn,unref:Zg,getCurrentInstance:Qg,onMounted:Jg,watch:Yl,customRef:$A,onUpdated:HA,readonly:ap,reactive:GA,hasInjectionContext:e_,toRaw:WA,shallowReadonly:KA,nextTick:qA,markRaw:XA,getCurrentScope:YA,isReadonly:ZA,onBeforeUpdate:QA}=await Vt("vue"),ir=Ws?window:void 0;function vn(n){var e;const t=tn(n);return(e=t?.$el)!=null?e:t}function tl(...n){const e=[],t=()=>{e.forEach(a=>a()),e.length=0},r=(a,l,c,u)=>(a.addEventListener(l,c,u),()=>a.removeEventListener(l,c,u)),i=Zr(()=>{const a=Us(tn(n[0])).filter(l=>l!=null);return a.every(l=>typeof l!="string")?a:void 0}),s=sp(()=>{var a,l;return[(l=(a=i.value)==null?void 0:a.map(c=>vn(c)))!=null?l:[ir].filter(c=>c!=null),Us(tn(i.value?n[1]:n[0])),Us(Zg(i.value?n[2]:n[1])),tn(i.value?n[3]:n[2])]},([a,l,c,u])=>{if(t(),!a?.length||!l?.length||!c?.length)return;const h=zg(u)?{...u}:u;e.push(...a.flatMap(d=>l.flatMap(f=>c.map(p=>r(d,f,p,h)))))},{flush:"post"}),o=()=>{s(),t()};return Mn(t),o}function t_(){const n=Ve(!1),e=Qg();return e&&Jg(()=>{n.value=!0},e),n}function Zl(n){const e=t_();return Zr(()=>(e.value,!!n()))}function Ql(n,e={}){const{immediate:t=!0,fpsLimit:r=void 0,window:i=ir,once:s=!1}=e,o=Ve(!1),a=Zr(()=>r?1e3/tn(r):null);let l=0,c=null;function u(f){if(!o.value||!i)return;l||(l=f);const p=f-l;if(a.value&&p<a.value){c=i.requestAnimationFrame(u);return}if(l=f,n({delta:p,timestamp:f}),s){o.value=!1,c=null;return}c=i.requestAnimationFrame(u)}function h(){!o.value&&i&&(o.value=!0,l=0,c=i.requestAnimationFrame(u))}function d(){o.value=!1,c!=null&&i&&(i.cancelAnimationFrame(c),c=null)}return t&&h(),Mn(d),{isActive:ap(o),pause:d,resume:h}}function n_(n,e,t){var r;const{immediate:i=!0,delay:s=0,onError:o=(r=globalThis.reportError)!=null?r:kr,onSuccess:a=kr,resetOnExecute:l=!0,shallow:c=!0,throwError:u}=t??{},h=c?Ve(e):op(e),d=Ve(!1),f=Ve(!1),p=Ve(void 0);async function m(v=0,...y){l&&(h.value=tn(e)),p.value=void 0,d.value=!1,f.value=!0,v>0&&await Ks(v);const T=typeof n=="function"?n(...y):n;try{const A=await T;h.value=A,d.value=!0,a(A)}catch(A){if(p.value=A,o(A),u)throw A}finally{f.value=!1}return h.value}i&&m(s);const g={state:h,isReady:d,isLoading:f,error:p,execute:m,executeImmediate:(...v)=>m(0,...v)};function _(){return new Promise((v,y)=>{Wg(f).toBe(!1).then(()=>v(g)).catch(y)})}return{...g,then(v,y){return _().then(v,y)}}}const r_=Symbol("vueuse-ssr-width");function i_(){const n=e_()?rp(r_,null):null;return typeof n=="number"?n:void 0}function lp(n,e={}){const{window:t=ir,ssrWidth:r=i_()}=e,i=Zl(()=>t&&"matchMedia"in t&&typeof t.matchMedia=="function"),s=Ve(typeof r=="number"),o=Ve(),a=Ve(!1),l=c=>{a.value=c.matches};return Yg(()=>{if(s.value){s.value=!i.value;const c=tn(n).split(",");a.value=c.some(u=>{const h=u.includes("not all"),d=u.match(/\(\s*min-width:\s*(-?\d+(?:\.\d*)?[a-z]+\s*)\)/),f=u.match(/\(\s*max-width:\s*(-?\d+(?:\.\d*)?[a-z]+\s*)\)/);let p=!!(d||f);return d&&p&&(p=r>=eu(d[1])),f&&p&&(p=r<=eu(f[1])),h?!p:p});return}i.value&&(o.value=t.matchMedia(tn(n)),a.value=o.value.matches)}),tl(o,"change",l,{passive:!0}),Zr(()=>a.value)}function s_(n={}){const{window:e=ir}=n,t=Ve(1),r=lp(()=>`(resolution: ${t.value}dppx)`,n);let i=kr;return e&&(i=sp(r,()=>t.value=e.devicePixelRatio)),{pixelRatio:ap(t),stop:i}}function o_(n,e,t={}){const{window:r=ir,...i}=t;let s;const o=Zl(()=>r&&"ResizeObserver"in r),a=()=>{s&&(s.disconnect(),s=void 0)},l=Zr(()=>{const h=tn(n);return Array.isArray(h)?h.map(d=>vn(d)):[vn(h)]}),c=Yl(l,h=>{if(a(),o.value&&r){s=new ResizeObserver(e);for(const d of h)d&&s.observe(d,i)}},{immediate:!0,flush:"post"}),u=()=>{a(),c()};return Mn(u),{isSupported:o,stop:u}}function a_(n,e={width:0,height:0},t={}){const{window:r=ir,box:i="content-box"}=t,s=Zr(()=>{var h,d;return(d=(h=vn(n))==null?void 0:h.namespaceURI)==null?void 0:d.includes("svg")}),o=Ve(e.width),a=Ve(e.height),{stop:l}=o_(n,([h])=>{const d=i==="border-box"?h.borderBoxSize:i==="content-box"?h.contentBoxSize:h.devicePixelContentBoxSize;if(r&&s.value){const f=vn(n);if(f){const p=f.getBoundingClientRect();o.value=p.width,a.value=p.height}}else if(d){const f=Us(d);o.value=f.reduce((p,{inlineSize:m})=>p+m,0),a.value=f.reduce((p,{blockSize:m})=>p+m,0)}else o.value=h.contentRect.width,a.value=h.contentRect.height},t);ip(()=>{const h=vn(n);h&&(o.value="offsetWidth"in h?h.offsetWidth:e.width,a.value="offsetHeight"in h?h.offsetHeight:e.height)});const c=Yl(()=>vn(n),h=>{o.value=h?e.width:0,a.value=h?e.height:0});function u(){l(),c()}return{width:o,height:a,stop:u}}function l_(n){var e;const t=Ve(0);if(typeof performance>"u")return t;const r=(e=n?.every)!=null?e:10;let i=performance.now(),s=0;return Ql(()=>{if(s+=1,s>=r){const o=performance.now(),a=o-i;t.value=Math.round(1e3/(a/s)),i=o,s=0}}),t}function c_(n={}){const e=op(),t=Zl(()=>typeof performance<"u"&&"memory"in performance);if(t.value){const{interval:r=1e3}=n;Kg(()=>{e.value=performance.memory},r,{immediate:n.immediate,immediateCallback:n.immediateCallback})}return{isSupported:t,memory:e}}function u_(n={}){const{window:e=ir,initialWidth:t=Number.POSITIVE_INFINITY,initialHeight:r=Number.POSITIVE_INFINITY,listenOrientation:i=!0,includeScrollbar:s=!0,type:o="inner"}=n,a=Ve(t),l=Ve(r),c=()=>{if(e)if(o==="outer")a.value=e.outerWidth,l.value=e.outerHeight;else if(o==="visual"&&e.visualViewport){const{width:h,height:d,scale:f}=e.visualViewport;a.value=Math.round(h*f),l.value=Math.round(d*f)}else s?(a.value=e.innerWidth,l.value=e.innerHeight):(a.value=e.document.documentElement.clientWidth,l.value=e.document.documentElement.clientHeight)};c(),ip(c);const u={passive:!0};if(tl("resize",c,u),e&&o==="visual"&&e.visualViewport&&tl(e.visualViewport,"resize",c,u),i){const h=lp("(orientation: portrait)");Yl(h,()=>c())}return{width:a,height:l}}const{reactive:h_,toValue:me,watch:Jl,onUnmounted:Lr,defineComponent:nu,renderSlot:JA,unref:d_,ref:qi,computed:Er,watchEffect:Zt,readonly:ru,shallowRef:nl,isRef:Ei,useSlots:p_,getCurrentInstance:iu,onMounted:su,createElementBlock:f_,openBlock:m_,normalizeStyle:g_,normalizeClass:__,createRenderer:v_,h:ou,provide:No,Fragment:y_}=await Vt("vue"),cp=await Vt("three"),{Layers:b_,Scene:up,MathUtils:w_,Clock:T_,WebGLRenderer:hp,Mesh:ec,Material:x_,Vector3:Te,Vector2:kn,Ray:rl,SphereGeometry:E_,Object3D:_o,Matrix4:Xi,BufferAttribute:dp,Triangle:pp,Line3:A_,Plane:vo,Raycaster:P_,Quaternion:il,Sphere:M_,MeshBasicMaterial:S_,DoubleSide:C_,Color:R_,PCFSoftShadowMap:O_,ACESFilmicToneMapping:k_,PerspectiveCamera:L_,ArrowHelper:eP,Line:tP,BufferGeometry:nP,Float32BufferAttribute:rP,LineBasicMaterial:iP,BackSide:sP,HemisphereLightHelper:oP,SpotLightHelper:aP,PointLightHelper:lP,DirectionalLightHelper:cP}=await Vt("three"),I_="@tresjs/core",D_="module",N_="5.0.2",F_="pnpm@10.17.0",U_="Declarative ThreeJS using Vue Components",j_="Alvaro Saburido <hola@alvarosaburido.dev> (https://github.com/alvarosabu/)",B_="MIT",z_={type:"git",url:"git+https://github.com/Tresjs/tres.git"},V_=["vue","3d","threejs","three","threejs-vue"],$_=!1,H_={".":{types:"./dist/index.d.ts",import:"./dist/tres.js",default:"./dist/tres.js"},"./components":{types:"./dist/src/components/index.d.ts"},"./composables":{types:"./dist/src/composables/index.d.ts"},"./types":{types:"./dist/src/types/index.d.ts"},"./utils":{types:"./dist/src/utils/index.d.ts"},"./*":"./*"},G_="./dist/tres.js",W_="./dist/index.d.ts",K_=["*.d.ts","dist"],q_={access:"public"},X_={dev:"pnpm --filter='./playground/vue' dev","dev:nuxt":"pnpm --filter='./playground/nuxt' dev",build:"vite build",test:"vitest","test:ci":"vitest run","test:ui":"vitest --ui --coverage.enabled=true",release:"release-it",coverage:"vitest run --coverage",lint:"eslint .","lint:fix":"eslint . --fix",typecheck:"vue-tsc --noEmit","docs:dev":"pnpm --filter='./docs' dev","docs:generate":"pnpm --filter='./docs' generate","docs:prepare":"pnpm --filter='./docs' prepare","docs:lint":"pnpm --filter='./docs' lint","docs:typecheck":"pnpm --filter='./docs' typecheck"},Y_={three:">=0.133",vue:">=3.4"},Z_={"@pmndrs/pointer-events":"^6.6.17","@vue/devtools-api":"^7.7.2","@vueuse/core":"^13.9.0",radashi:"^12.6.2"},Q_={"@release-it/conventional-changelog":"^10.0.0","@stackblitz/sdk":"^1.11.0","@tresjs/cientos":"5.0.0-alpha.1","@tresjs/eslint-config":"^1.4.0","@tresjs/leches":"1.0.0-next.0","@types/three":"^0.180.0","@typescript-eslint/eslint-plugin":"^8.42.0","@typescript-eslint/parser":"^8.42.0","@vitejs/plugin-vue":"^6.0.1","@vitest/coverage-c8":"^0.33.0","@vitest/coverage-v8":"^3.2.4","@vitest/ui":"^3.2.4","@vue/test-utils":"^2.4.6",eslint:"^9.34.0","eslint-plugin-vue":"^10.4.0",esno:"^4.8.0",gsap:"^3.13.0",jsdom:"^27.0.0",kolorist:"^1.8.0",ohmyfetch:"^0.4.21",pathe:"^2.0.3","release-it":"^19.0.4","rollup-plugin-analyzer":"^4.0.0","rollup-plugin-copy":"^3.5.0","rollup-plugin-visualizer":"^6.0.3",sponsorkit:"^17.0.0",three:"^0.180.0",unocss:"^65.5.0",unplugin:"^2.3.10","unplugin-vue-components":"^29.0.0",vite:"^7.1.6","vite-plugin-banner":"^0.8.1","vite-plugin-dts":"4.5.4","vite-plugin-inspect":"^11.3.3","vite-plugin-require-transform":"^1.0.21","vite-svg-loader":"^5.1.0",vitepress:"1.6.4",vitest:"3.2.4",vue:"3.5.21","vue-demi":"^0.14.10","vue-tsc":"^3.0.6"},J_={onlyBuiltDependencies:["better-sqlite3"],ignoredBuiltDependencies:["vue-demi"],overrides:{ipx:"^3.0.3",vue:"^3.5.21","vue-router":"^4.5.1"}},ev={unimport:"4.1.1"},tv={name:I_,type:D_,version:N_,packageManager:F_,description:U_,author:j_,license:B_,repository:z_,keywords:V_,sideEffects:$_,exports:H_,module:G_,types:W_,files:K_,publishConfig:q_,scripts:X_,peerDependencies:Y_,dependencies:Z_,devDependencies:Q_,pnpm:J_,resolutions:ev};/*! #__NO_SIDE_EFFECTS__ */function nv(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const rv="html,body,base,head,link,meta,style,title,address,article,aside,footer,header,hgroup,h1,h2,h3,h4,h5,h6,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,summary,template,blockquote,iframe,tfoot",iv=nv(rv);function au(n){var e;const t=((e=n?.replace(/([A-Z])+/g,sv))==null?void 0:e.split(/(?=[A-Z])|[\.\-\s_]/).map(r=>r.toLowerCase()))??[];return t.length===0?"":t.length===1?t[0]:t.reduce((r,i)=>`${r}${i.charAt(0).toUpperCase()}${i.slice(1)}`)}function sv(n){if(!n||n.length===0)return"";const e=n.toLowerCase();return e.substring(0,1).toUpperCase()+e.substring(1,e.length)}function fp(n,e){if(Object.is(n,e))return!0;if(n instanceof Date&&e instanceof Date)return n.getTime()===e.getTime();if(n instanceof RegExp&&e instanceof RegExp)return n.toString()===e.toString();if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;const t=Reflect.ownKeys(n),r=Reflect.ownKeys(e);if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(!Reflect.has(e,t[i])||!fp(n[t[i]],e[t[i]]))return!1;return!0}function Hn(n){return typeof n=="function"}function mp(n){return typeof n=="number"&&!Number.isNaN(n)}function tc(n){return ov(n,"[object Object]")}function nc(n){return typeof n=="string"}function ov(n,e){return Object.prototype.toString.call(n)===e}function sl(n){return typeof n>"u"}const Et=n=>e=>tc(e)&&n in e&&!!e[n],ol=Et("isObject3D"),gp=Et("isMesh"),_p=Et("isCamera"),av=Et("isOrthographicCamera"),vp=Et("isPerspectiveCamera"),yp=Et("isColor"),lv=n=>nc(n)||mp(n)||yp(n),lu=n=>n instanceof b_,bp=Et("isBufferGeometry"),wp=Et("isMaterial"),cv=Et("isLight"),Tp=Et("isFog"),xp=Et("isScene"),al=n=>n!==null&&typeof n=="object"&&"set"in n&&typeof n.set=="function",uv=n=>al(n)&&"copy"in n&&typeof n.copy=="function",hv=n=>!!n?.constructor,gr=n=>_p(n)||av(n)||vp(n),dv=n=>ol(n)||bp(n)||wp(n)||Tp(n),pv=Et("isPrimitive"),fv=n=>dv(n)&&"__tres"in n,mv=(n,e)=>{let t=0;for(let r=0;r<n.length;r++)e(n[r],r)&&(n[t]=n[r],t++);return n.length=t,n},qs="[TresJS ▲ ■ ●] ";function cu(...n){typeof n[0]=="string"?n[0]=qs+n[0]:n.unshift(qs),console.error(...n)}function gv(...n){typeof n[0]=="string"?n[0]=qs+n[0]:n.unshift(qs),console.warn(...n)}function uu(n){(e=>"map"in e&&!!e.map)(n)&&n.map.dispose(),n.dispose()}function Xs(n){if(n.parent&&n.removeFromParent?.(),delete n.__tres,[...n.children].forEach(e=>Xs(e)),!(n instanceof up)){const e=n;n&&n.dispose?.(),e.geometry&&e.geometry.dispose(),Array.isArray(e.material)?e.material.forEach(t=>uu(t)):e.material&&uu(e.material)}}function Ys(n,e){let t=n;if(e.includes("-")){const r=e.split("-");let i=r.shift();for(;t&&r.length;)i in t?(t=t[i],i=r.shift()):i=hu(i,r.shift());return{target:t,key:hu(i,...r)}}else return{target:t,key:e}}function hu(...n){return n.map((e,t)=>t===0?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")}function _v(n,e,t){const r=/-\d+$/;if(nc(t)){if(r.test(t)){const o=t.replace(r,""),{target:a,key:l}=Ys(n,o);if(!Array.isArray(a[l])){const c=a[l],u=[];u.__tresDetach=()=>{u.every(h=>sl(h))&&(a[l]=c)},a[l]=u}}const{target:i,key:s}=Ys(n,t);e.__tres.previousAttach=i[s],i[s]=Ir(e)}else e.__tres.previousAttach=t(n,e)}function vv(n,e,t){if(nc(t)){const{target:r,key:i}=Ys(n,t),s=e.__tres.previousAttach;s===void 0?delete r[i]:r[i]=s,"__tresDetach"in r&&r.__tresDetach()}else e.__tres?.previousAttach?.(n,e);delete e.__tres?.previousAttach}function Vn(n,e,t){const r=n;return r.__tres={type:"unknown",root:t,memoizedProps:{},objects:[],parent:null,previousAttach:null,...e},r.__tres.attach||(wp(r)?r.__tres.attach="material":bp(r)?r.__tres.attach="geometry":Tp(r)&&(r.__tres.attach="fog")),r}function ll(n){const e=n?.__tres?.root;e?.renderer&&e.renderer.canBeInvalidated.value&&e.renderer.invalidate()}function yv(n,e,t,r,i){const s=[...e.__tres.objects],o=Ir(e);if(n=Ir(n),o===n)return!0;const a=Vn(n,e.__tres??{},i),l=e.parent??e.__tres.parent??null,c={...e.__tres.memoizedProps};delete c.object;for(const u of s)Ep(u,i),Ap(u,i);o.__tres.objects=[],r.remove(e);for(const[u,h]of Object.entries(c))r.patchProp(a,u,a[u],h);t(n),r.insert(e,l);for(const u of s)r.insert(u,e);return!0}function Ir(n){if(pv(n)){const e=n;return e.object.__tres=e.__tres,e.object}else return n}function Ep(n,e){const t=n.__tres?.parent||e.scene.value;n.__tres&&(n.__tres.parent=null),t&&t.__tres&&"objects"in t.__tres&&mv(t.__tres.objects,r=>r!==n),n.__tres?.attach?vv(t,n,n.__tres.attach):(n.parent?.remove?.(Ir(n)),n.parent=null)}function Ap(n,e){n.traverse?.(t=>{gr(t)&&e.camera.deregisterCamera(t)}),gr(n)&&e.camera.deregisterCamera(n),ll(n)}function bv(n,e,t){const r=new n(t?.manager),i=h_({loaded:0,total:0,percentage:0});t?.extensions&&t.extensions(r);const s=me(e),o=n_(l=>new Promise((c,u)=>{const h=l||s||"";r.load(h,d=>{c(d)},d=>{i.loaded=d.loaded,i.total=d.total,i.percentage=i.loaded/i.total*100},d=>{u(d)})}),t?.initialValue??null,{...t?.asyncOptions,immediate:t?.asyncOptions?.immediate??!0}),a=Jl(()=>me(e),l=>{if(l){const c=o.state.value;c&&typeof c=="object"&&"scene"in c&&c.scene&&Xs(c.scene),o.execute(0,l)}});return Lr(()=>{a();const l=o.state.value;l&&typeof l=="object"&&"scene"in l&&l.scene&&Xs(l.scene)}),{...o,load:l=>{o.execute(0,l)},progress:i}}const wv=({sizes:n})=>{const e=qi([]),t=Er(()=>e.value[0]),r=o=>{const a=_p(o)?o:e.value.find(c=>c.uuid===o);if(!a)return;const l=e.value.filter(({uuid:c})=>c!==a.uuid);e.value=[a,...l]},i=(o,a=!1)=>{e.value.some(({uuid:l})=>l===o.uuid)||(e.value.push(o),a&&r(o.uuid))},s=o=>{e.value=e.value.filter(({uuid:a})=>a!==o.uuid)};return Zt(()=>{n.aspectRatio.value&&e.value.forEach(o=>{vp(o)&&(o.aspect=n.aspectRatio.value,o.updateProjectionMatrix())})}),{activeCamera:t,cameras:e,registerCamera:i,deregisterCamera:s,setActiveCamera:r}};function du(){const n=new Map,e=new Set;let t=0,r=!1;const i=()=>{const o=Array.from(n.entries()).sort((a,l)=>{const c=a[1].priority-l[1].priority;return c===0?a[1].addI-l[1].addI:c});e.clear(),o.forEach(a=>e.add(a[0]))},s=o=>{n.delete(o),e.delete(o)};return{on:(o,a=0)=>{n.set(o,{priority:a,addI:t++});const l=()=>s(o);return Mn(l),r=!0,{off:l}},off:s,trigger:(...o)=>(r&&(i(),r=!1),Promise.all(Array.from(e).map(a=>a(...o)))),dispose:()=>{n.clear(),e.clear()},get count(){return n.size}}}const cl=qi({}),ul=n=>Object.assign(cl.value,n),Tv=(n,e,t)=>{if(!Hn(n.setPixelRatio))return;let r=0;if(t&&Array.isArray(t)&&t.length>=2){const[i,s]=t;r=w_.clamp(e,i,s)}else mp(t)?r=t:r=e;r!==n.getPixelRatio?.()&&n.setPixelRatio(r)},xv=n=>{const e=new T_,t={before:Oi(),after:Oi()},{pause:r,resume:i,isActive:s}=Ql(()=>{const o=()=>({delta:e.getDelta(),elapsed:e.elapsedTime});t.before.trigger(o()),n(),t.after.trigger(o())},{immediate:!1});return{start:()=>{e.start(),i()},stop:()=>{e.stop(),r()},isActive:s,onBeforeLoop:t.before.on,onLoop:t.after.on}};function Ev({scene:n,canvas:e,options:t,contextParts:{sizes:r,camera:i}}){const s=Hn(t.renderer)?t.renderer({sizes:r,scene:n,camera:i,canvas:e}):new hp({...t,canvas:vn(e)}),o=qi(me(t.renderMode)==="manual"?0:1),a=60,l=Er(()=>me(t.renderMode)==="on-demand"&&o.value===0),c=()=>n.value.traverse(b=>{b instanceof ec&&b.material instanceof x_&&(b.material.needsUpdate=!0)}),u=(b=1)=>{l.value&&(o.value=Math.min(a,o.value+b))},h=()=>{if(me(t.renderMode)!=="manual")throw new Error("advance can only be called in manual render mode.");o.value=1},d=()=>{me(t.renderMode)==="on-demand"&&u()},f=Er(()=>me(t.renderMode)==="always"),p=b=>tc(b)&&"isRenderer"in b&&!!b.isRenderer,m=Oi();let g=!1;p(s)&&(s.init(),m.trigger(s));const _=Oi(),v=()=>{o.value=f.value?1:Math.max(0,o.value-1),_.trigger(s)};let y=b=>{i.activeCamera.value&&(s.render(n.value,i.activeCamera.value),b())};const T=b=>{y=b},A=xv(()=>{o.value&&y(v)});m.on(A.start),Jl([r.width,r.height],()=>{s.setSize(r.width.value,r.height.value),!g&&s.domElement.width&&s.domElement.height&&(m.trigger(s),g=!0),d()},{immediate:!0});const{pixelRatio:w}=s_();Zt(()=>{Tv(s,w.value,me(t.dpr))}),me(t.renderMode)==="on-demand"&&u(),me(t.renderMode)==="manual"&&Xg(100,{callback:h});const x=Er(()=>{const b=me(t.clearColor),E=me(t.clearAlpha),M=typeof b=="string"&&b.length===9&&b.startsWith("#");return M&&E!==void 0&&gv(`clearColor with alpha (e.g. ${b}) and clearAlpha cannot both be set, using clearColor as source of truth`),M?{alpha:Number.parseInt(b.slice(7,9),16)/255,color:b.slice(0,7)}:{alpha:E,color:b}});return Zt(()=>{const b=x.value;b.color===void 0||b.alpha===void 0||s.setClearColor(b.color,b.alpha)}),Zt(()=>{const b=t.toneMapping;b&&(s.toneMapping=b)}),Zt(()=>{const b=t.toneMappingExposure;b&&(s.toneMappingExposure=b)}),Zt(()=>{const b=t.outputColorSpace;b&&(s.outputColorSpace=b)}),Zt(()=>{const b=t.shadows;b!==void 0&&(s.shadowMap.enabled=b,c())}),Zt(()=>{const b=t.shadowMapType;b!==void 0&&(s.shadowMap.type=b,c())}),Lr(()=>{s.dispose(),"forceContextLoss"in s&&s.forceContextLoss()}),{loop:A,instance:s,advance:h,onReady:m.on,onRender:_.on,invalidate:u,canBeInvalidated:l,mode:me(t.renderMode),replaceRenderFunction:T}}function Av(n,e,t=10){const r=me(n)?u_():a_(Er(()=>me(e).parentElement)),i=ru(tu(r.width,t)),s=ru(tu(r.height,t)),o=Er(()=>i.value/s.value);return{height:s,width:i,aspectRatio:o}}let Pv=class{nativeEvent;NONE=0;CAPTURING_PHASE=1;AT_TARGET=2;BUBBLING_PHASE=3;relatedTarget=null;get altKey(){return this.getFromNative("altKey",!1)}get button(){return this.getFromNative("button",0)}get buttons(){return this.getFromNative("buttons",0)}get clientX(){return this.getFromNative("clientX",0)}get clientY(){return this.getFromNative("clientY",0)}get ctrlKey(){return this.getFromNative("ctrlKey",!1)}get layerX(){return this.getFromNative("layerX",0)}get layerY(){return this.getFromNative("layerY",0)}get metaKey(){return this.getFromNative("metaKey",!1)}get movementX(){return this.getFromNative("movementX",0)}get movementY(){return this.getFromNative("movementY",0)}get offsetX(){return this.getFromNative("offsetX",0)}get offsetY(){return this.getFromNative("offsetY",0)}get pageX(){return this.getFromNative("pageX",0)}get pageY(){return this.getFromNative("pageY",0)}get screenX(){return this.getFromNative("screenX",0)}get screenY(){return this.getFromNative("screenY",0)}get shiftKey(){return this.getFromNative("shiftKey",!1)}get x(){return this.getFromNative("x",0)}get y(){return this.getFromNative("y",0)}get detail(){return this.getFromNative("detail",0)}get view(){return this.getFromNative("view",null)}get which(){return this.getFromNative("which",0)}get cancelBubble(){return this.getFromNative("cancelBubble",!1)}get composed(){return this.getFromNative("composed",!1)}get eventPhase(){return this.getFromNative("eventPhase",0)}get isTrusted(){return this.getFromNative("isTrusted",!1)}get returnValue(){return this.getFromNative("returnValue",!1)}get timeStamp(){return this.getFromNative("timeStamp",0)}get cancelable(){return this.getFromNative("cancelable",!1)}get defaultPrevented(){return this.getFromNative("defaultPrevented",!1)}constructor(e){this.nativeEvent=e}getFromNative(e,t){return e in this.nativeEvent?this.nativeEvent[e]:t}};const Fo=new Te;class je extends Pv{type;bubbles;internalPointer;intersection;camera;currentObject;object;propagationState;get pointerId(){return this.internalPointer.id}get pointerType(){return this.internalPointer.type}get pointerState(){return this.internalPointer.state}get distance(){return this.intersection.distance}get distanceToRay(){return this.intersection.distanceToRay}get point(){return this.intersection.point}get index(){return this.intersection.index}get face(){return this.intersection.face}get faceIndex(){return this.intersection.faceIndex}get uv(){return this.intersection.uv}get uv1(){return this.intersection.uv1}get normal(){return this.intersection.normal}get instanceId(){return this.intersection.instanceId}get pointOnLine(){return this.intersection.pointOnLine}get batchId(){return this.intersection.batchId}get pointerPosition(){return this.intersection.pointerPosition}get pointerQuaternion(){return this.intersection.pointerQuaternion}get pointOnFace(){return this.intersection.pointOnFace}get localPoint(){return this.intersection.localPoint}get details(){return this.intersection.details}get target(){return this.object}get currentTarget(){return this.currentObject}get eventObject(){return this.currentObject}get srcElement(){return this.currentObject}_pointer;get pointer(){return this._pointer==null&&(Fo.copy(this.intersection.point).project(this.camera),this._pointer=new kn(Fo.x,Fo.y)),this._pointer}_ray;get ray(){if(this._ray!=null)return this._ray;switch(this.intersection.details.type){case"screen-ray":case"ray":case"sphere":return this._ray=new rl(this.intersection.pointerPosition,new Te(0,0,-1).applyQuaternion(this.intersection.pointerQuaternion));case"lines":return this._ray=new rl(this.intersection.details.line.start,this.intersection.details.line.end.clone().sub(this.intersection.details.line.start).normalize())}}_intersections=[];get intersections(){return this._intersections==null&&(this._intersections=[{...this.intersection,eventObject:this.currentObject}]),this._intersections}_unprojectedPoint;get unprojectedPoint(){if(this._unprojectedPoint==null){const e=this.pointer;this._unprojectedPoint=new Te(e.x,e.y,0).unproject(this.camera)}return this._unprojectedPoint}get stopped(){return this.propagationState.stoppedImmediate||this.propagationState.stopped}get stoppedImmediate(){return this.propagationState.stoppedImmediate}get delta(){throw new Error("not supported")}constructor(e,t,r,i,s,o,a=s.object,l=a,c={stopped:!t,stoppedImmediate:!1}){super(r),this.type=e,this.bubbles=t,this.internalPointer=i,this.intersection=s,this.camera=o,this.currentObject=a,this.object=l,this.propagationState=c}stopPropagation(){this.propagationState.stopped=!0}stopImmediatePropagation(){this.propagationState.stoppedImmediate=!0}retarget(e){return new je(this.type,this.bubbles,this.nativeEvent,this.internalPointer,this.intersection,this.camera,e,this.target,this.propagationState)}}let pu=class Pp extends je{get deltaX(){return this.nativeEvent.deltaX}get deltaY(){return this.nativeEvent.deltaY}get deltaZ(){return this.nativeEvent.deltaZ}constructor(e,t,r,i,s,o){super("wheel",!0,e,t,r,i,s,o)}retarget(e){return new Pp(this.nativeEvent,this.internalPointer,this.intersection,this.camera,e,this.target)}};function Ge(n){Mp(n,n.currentObject)}function Mp(n,e){if(e==null)return;const t=Sv(e,n.type);if(t!=null&&t.length>0){const r=n.retarget(e),i=t.length;for(let s=0;s<i&&!r.stoppedImmediate;s++)t[s](r)}n.stopped||Mp(n,e.parent)}const Sp={click:"onClick",contextmenu:"onContextMenu",dblclick:"onDoubleClick",pointercancel:"onPointerCancel",pointerdown:"onPointerDown",pointerenter:"onPointerEnter",pointerleave:"onPointerLeave",pointermove:"onPointerMove",pointerout:"onPointerOut",pointerover:"onPointerOver",pointerup:"onPointerUp",wheel:"onWheel"},Mv=Object.keys(Sp);function Sv(n,e){if(n._listeners!=null&&e in n._listeners)return n._listeners[e];let t;if(n.isVoidObject&&e==="click"&&n.parent?.__r3f!=null&&(t=n.parent.__r3f.root.getState().onPointerMissed),n.__r3f!=null&&(t=n.__r3f.handlers[Sp[e]]),t!=null)return[t]}const Cv=1e10,Rv=new E_(Cv),fu=new Map;function Cp(n){let e=fu.get(n);return e==null&&(e=new ec(Rv),e.isVoidObject=!0,e.parent=n,e.pointerEventsOrder=-1/0,fu.set(n,e)),e}function Ov(n,e,t){const r=e.normal??e.face?.normal;return r==null?!1:(n.setFromNormalAndCoplanarPoint(r,e.localPoint),n.applyMatrix4(t),!0)}function kv(n,e,t){if(e==="none"||e==="listener"&&!n)return!1;if(t==="all")return!0;if(typeof t=="function")return({id:s,type:o,state:a})=>t(s,o,a);let r,i;return"deny"in t?(i=!0,r=t.deny):(i=!1,r=t.allow),Array.isArray(r)?s=>mu(r.includes(s.type),i):s=>mu(r===s.type,i)}function mu(n,e){return e?!n:n}function Rp(n,e,t,r=!1,i,s,o){const a=r||Lv(n,e),l=e.pointerEvents??i,c=l??e.defaultPointerEvents??"listener",u=e.pointerEventsType??s??"all",h=e.pointerEventsOrder??o??0,d=kv(a,c,u),f=t.length;if(f===1)(d===!0||typeof d=="function"&&d(t[0]))&&Uo(t[0],e,c,u,h);else if(d===!0)for(let g=0;g<f;g++)Uo(t[g],e,c,u,h);else if(typeof d=="function")for(let g=0;g<f;g++){const _=t[g];d(_)&&Uo(_,e,c,u,h)}if(e.children.length===0||e.intersectChildren===!1)return;const p=e.interactableDescendants??e.children,m=p.length;for(let g=0;g<m;g++)Rp(n,p[g],t,a,l,u,h)}function Lv(n,e){if(e.ancestorsHaveListeners||n==="pointer"&&e.ancestorsHavePointerListeners||n==="wheel"&&e.ancestorsHaveWheelListeners||e.__r3f!=null&&e.__r3f?.eventCount>0&&(n==="wheel"&&e.__r3f.handlers.onWheel!=null||n==="pointer"&&Object.keys(e.__r3f.handlers).some(i=>i!="onWheel")))return!0;if(e._listeners==null)return!1;if(n==="wheel"){const i=e._listeners.wheel;return i!=null&&i.length>0}const t=Object.entries(e._listeners),r=t.length;for(let i=0;i<r;i++){const s=t[i];if(s[0]!=="wheel"&&Mv.includes(s[0])&&s[1]!=null&&s[1].length>0)return!0}return!1}function Uo({intersector:n,options:e},t,r,i,s){e.filter?.(t,r,i,s)!==!1&&n.executeIntersection(t,s)}function Iv(n,e,{customSort:t=Dv}={},r){let i,s,o;const a=n.length;for(let l=0;l<a;l++){const c=n[l],u=e?.[l];(i==null||t(c,u,i,s)<0)&&(o=l,i=c,s=u)}return o}function Dv(n,e=0,t,r=0){return e!=r?r-e:n.distance-t.distance}const gu=1e7;function Nv(n,e,t,r,i,s=0){const o=e.direction.clone().multiplyScalar(gu),a=gu;return{distance:a+s,object:Cp(n),point:o,normal:e.origin.clone().sub(o).normalize(),details:t(o,a),pointerPosition:r,pointerQuaternion:i,pointOnFace:o,localPoint:o}}function Fv(n,e,t){for(;t>0;)n.push(e),--t}const jo=Symbol("buttonsDownTime"),Uv=Symbol("buttonsClickTime");globalThis.pointerEventspointerMap??=new Map;_o.prototype.setPointerCapture=function(n){rc(n)?.setCapture(this)};_o.prototype.releasePointerCapture=function(n){const e=rc(n);e==null||!e.hasCaptured(this)||e.setCapture(void 0)};_o.prototype.hasPointerCapture=function(n){return rc(n)?.hasCaptured(this)??!1};function rc(n){return globalThis.pointerEventspointerMap?.get(n)}let jv=class{id;type;state;intersector;getCamera;onMoveCommited;parentSetPointerCapture;parentReleasePointerCapture;options;prevIntersection;intersection;prevEnabled=!0;enabled=!0;wheelIntersection;pointerEntered=[];pointerEnteredHelper=[];pointerCapture;buttonsDownTime=new Map;buttonsDown=new Set;wasMoved=!1;onFirstMove=[];constructor(e,t,r,i,s,o,a,l,c={}){this.id=e,this.type=t,this.state=r,this.intersector=i,this.getCamera=s,this.onMoveCommited=o,this.parentSetPointerCapture=a,this.parentReleasePointerCapture=l,this.options=c,globalThis.pointerEventspointerMap?.set(e,this)}getPointerCapture(){return this.pointerCapture}hasCaptured(e){return this.pointerCapture?.object===e}setCapture(e){this.pointerCapture?.object!==e&&(this.pointerCapture!=null&&(this.parentReleasePointerCapture?.(),this.pointerCapture=void 0),e!=null&&this.intersection!=null&&(this.pointerCapture={object:e,intersection:this.intersection},this.parentSetPointerCapture?.()))}getButtonsDown(){return this.buttonsDown}getIntersection(){return this.intersection}getEnabled(){return this.enabled}setEnabled(e,t,r=!0){this.enabled!==e&&(!e&&this.pointerCapture!=null&&(this.parentReleasePointerCapture?.(),this.pointerCapture=void 0),this.enabled=e,r&&this.commit(t,!1))}computeIntersection(e,t,r){return this.pointerCapture!=null?this.intersector.intersectPointerCapture(this.pointerCapture,r):(this.intersector.startIntersection(r),Rp(e,t,[this]),this.intersector.finalizeIntersection(t))}setIntersection(e){this.intersection=e}commit(e,t){const r=this.getCamera(),i=this.prevEnabled?this.prevIntersection:void 0,s=this.enabled?this.intersection:void 0;i!=null&&i.object!=s?.object&&Ge(new je("pointerout",!0,e,this,i,r));const o=this.pointerEntered;this.pointerEntered=[],this.pointerEnteredHelper.length=0,Op(s?.object,this.pointerEntered,o,this.pointerEnteredHelper);const a=o.length;for(let l=0;l<a;l++){const c=o[l];Ge(new je("pointerleave",!1,e,this,i,r,c))}s!=null&&i?.object!=s.object&&Ge(new je("pointerover",!0,e,this,s,r));for(let l=this.pointerEnteredHelper.length-1;l>=0;l--){const c=this.pointerEnteredHelper[l];Ge(new je("pointerenter",!1,e,this,s,r,c))}if(t&&s!=null&&Ge(new je("pointermove",!0,e,this,s,r)),this.prevIntersection=this.intersection,this.prevEnabled=this.enabled,!this.wasMoved&&this.intersector.isReady()){this.wasMoved=!0;const l=this.onFirstMove.length;for(let c=0;c<l;c++)this.onFirstMove[c](r);this.onFirstMove.length=0}this.onMoveCommited?.(this)}move(e,t){this.intersection=this.computeIntersection("pointer",e,t),this.commit(t,!0)}emitMove(e){this.intersection!=null&&Ge(new je("pointermove",!0,e,this,this.intersection,this.getCamera()))}down(e){if(this.buttonsDown.add(e.button),!this.enabled)return;if(!this.wasMoved){this.onFirstMove.push(this.down.bind(this,e));return}if(this.intersection==null)return;Ge(new je("pointerdown",!0,e,this,this.intersection,this.getCamera()));const{object:t}=this.intersection;t[jo]??=new Map,t[jo].set(e.button,e.timeStamp),this.buttonsDownTime.set(e.button,e.timeStamp)}up(e){if(this.buttonsDown.delete(e.button),!this.enabled)return;if(!this.wasMoved){this.onFirstMove.push(this.up.bind(this,e));return}if(this.intersection==null)return;const{clickThesholdMs:t,contextMenuButton:r=2,dblClickThresholdMs:i=500,clickThresholdMs:s=t??300}=this.options;this.pointerCapture=void 0;const o=Bv(this.buttonsDownTime,this.intersection.object[jo],e.button,e.timeStamp,s),a=this.getCamera();if(o&&e.button===r&&Ge(new je("contextmenu",!0,e,this,this.intersection,a)),Ge(new je("pointerup",!0,e,this,this.intersection,a)),!o||e.button===r)return;Ge(new je("click",!0,e,this,this.intersection,a));const{object:l}=this.intersection,c=l[Uv]??=new Map,u=c.get(e.button);if(u==null||e.timeStamp-u>i){c.set(e.button,e.timeStamp);return}Ge(new je("dblclick",!0,e,this,this.intersection,a)),c.delete(e.button)}cancel(e){if(this.enabled){if(!this.wasMoved){this.onFirstMove.push(this.cancel.bind(this,e));return}this.intersection!=null&&Ge(new je("pointercancel",!0,e,this,this.intersection,this.getCamera()))}}wheel(e,t,r=!1){if(!this.enabled)return;if(!this.wasMoved&&r){this.onFirstMove.push(this.wheel.bind(this,e,t,r));return}r||(this.wheelIntersection=this.computeIntersection("wheel",e,t));const i=r?this.intersection:this.wheelIntersection;i!=null&&Ge(new pu(t,this,i,this.getCamera()))}emitWheel(e,t=!1){if(!this.enabled)return;if(!this.wasMoved&&t){this.onFirstMove.push(this.emitWheel.bind(this,e,t));return}const r=t?this.intersection:this.wheelIntersection;r!=null&&Ge(new pu(e,this,r,this.getCamera()))}exit(e){this.wasMoved&&(this.pointerCapture!=null&&(this.parentReleasePointerCapture?.(),this.pointerCapture=void 0),this.intersection=void 0,this.commit(e,!1)),this.onFirstMove.length=0,this.wasMoved=!1}};function Op(n,e,t,r){if(n==null)return;const i=t.indexOf(n);i!=-1?t.splice(i,1):r.push(n),e.push(n),Op(n.parent,e,t,r)}function Bv(n,e,t,r,i){if(e==null)return!1;const s=e.get(t);return!(s==null||r-s>i||s!=n.get(t))}const ri=new pp,Bo=new pp,_u=new kn,vu=new kn,yu=new kn,zo=new Te,zv=new Xi,ss=new Te;function Vv(n,e,t){ss.copy(e).applyMatrix4(zv.copy(t.matrixWorld).invert());const r=t.geometry.attributes.uv;if(r==null||!(r instanceof dp))return!1;let i;return $v(t,(s,o,a)=>{t.getVertexPosition(s,ri.a),t.getVertexPosition(o,ri.b),t.getVertexPosition(a,ri.c);const l=ri.closestPointToPoint(ss,zo).distanceTo(ss);i!=null&&l>=i||(i=l,Bo.copy(ri),_u.fromBufferAttribute(r,s),vu.fromBufferAttribute(r,o),yu.fromBufferAttribute(r,a))}),i==null?!1:(Bo.closestPointToPoint(ss,zo),Bo.getInterpolation(zo,_u,vu,yu,n),!0)}function $v(n,e){const t=n.geometry.drawRange;if(n.geometry.index!=null){const o=n.geometry.index,a=Math.max(0,t.start),l=Math.min(o.count,t.start+t.count);for(let c=a;c<l;c+=3)e(o.getX(c),o.getX(c+1),o.getX(c+2));return}const r=n.geometry.attributes.position;if(r==null)return;const i=Math.max(0,t.start),s=Math.min(r.count,t.start+t.count);for(let o=i;o<s;o+=3)e(o,o+1,o+2)}new Xi;new A_;new Te;new vo;new rl;new kn;new Te(0,0,0),new Te(0,0,1);const bu=new Xi,Hv=new Te;new Te(0,0,-1);new vo;const wu=new kn,Gv=new Te;let Wv=class{prepareTransformation;options;raycaster=new P_;cameraQuaternion=new il;fromPosition=new Te;fromQuaternion=new il;coords=new kn;viewPlane=new vo;intersects=[];pointerEventsOrders=[];constructor(e,t){this.prepareTransformation=e,this.options=t}isReady(){return!0}intersectPointerCapture({intersection:e,object:t},r){const i=e.details;if(i.type!="screen-ray")throw new Error(`unable to process a pointer capture of type "${e.details.type}" with a camera ray intersector`);if(!this.startIntersection(r))return e;this.viewPlane.constant-=i.distanceViewPlane;const s=this.raycaster.ray.intersectPlane(this.viewPlane,new Te);if(s==null)return e;e.object.updateWorldMatrix(!0,!1),Ov(this.viewPlane,e,e.object.matrixWorld);let o=e.uv;return e.object instanceof ec&&Vv(wu,s,e.object)&&(o=wu.clone()),{...e,details:{...i,direction:this.raycaster.ray.direction.clone(),screenPoint:this.coords.clone()},uv:o,object:t,point:s,pointOnFace:s,pointerPosition:this.raycaster.ray.origin.clone(),pointerQuaternion:this.cameraQuaternion.clone()}}startIntersection(e){const t=this.prepareTransformation(e,this.coords);return t==null?!1:(t.updateWorldMatrix(!0,!1),t.matrixWorld.decompose(this.fromPosition,this.fromQuaternion,Hv),this.raycaster.setFromCamera(this.coords,t),this.viewPlane.setFromNormalAndCoplanarPoint(t.getWorldDirection(Gv),this.raycaster.ray.origin),!0)}executeIntersection(e,t){const r=this.intersects.length;e.raycast(this.raycaster,this.intersects),Fv(this.pointerEventsOrders,t,this.intersects.length-r)}finalizeIntersection(e){const t=this.fromPosition.clone(),r=this.cameraQuaternion.clone(),i=this.raycaster.ray.direction.clone(),s=Iv(this.intersects,this.pointerEventsOrders,this.options),o=s==null?void 0:this.intersects[s];return this.intersects.length=0,this.pointerEventsOrders.length=0,o==null?Nv(e,this.raycaster.ray,(a,l)=>({type:"screen-ray",distanceViewPlane:l,screenPoint:this.coords.clone(),direction:i}),t,r):(o.object.updateWorldMatrix(!0,!1),bu.copy(o.object.matrixWorld).invert(),Object.assign(o,{details:{type:"screen-ray",distanceViewPlane:this.viewPlane.distanceToPoint(o.point),screenPoint:this.coords.clone(),direction:i},pointOnFace:o.point,pointerPosition:t,pointerQuaternion:r,localPoint:o.point.clone().applyMatrix4(bu)}))}};new Te;new kn;new Xi;new Te;new il;new vo;new M_;new Te;new Te;new Te;new Te(1e-4,1e-4,1e-4);new Xi;let Kv=23412;function qv(){return Kv++}function Xv(n,e,t){if(!(e instanceof globalThis.MouseEvent))return t.set(0,0);const{width:r,height:i,top:s,left:o}=n.getBoundingClientRect(),a=e.clientX-o,l=e.clientY-s;return t.set(a/r*2-1,-(l/i)*2+1)}function Yv(n,e,t,r){return Zv(n,typeof e=="function"?e:()=>e,t,Xv.bind(null,n),n.setPointerCapture.bind(n),i=>{n.hasPointerCapture(i)&&n.releasePointerCapture(i)},{pointerTypePrefix:"screen-",...r})}function Zv(n,e,t,r,i,s,o={}){const a=o?.forwardPointerCapture??!0,l=new Map,c=o.pointerTypePrefix??"forward-",u=(x,b)=>{let E=l.get(x.pointerId);return E!=null||(E=new jv(qv(),`${c}${x.pointerType}`,x.pointerState,new Wv((M,S)=>(r(M,S),e()),o),e,void 0,a?i.bind(null,x.pointerId):void 0,a?s.bind(null,x.pointerId):void 0,o),b!="move"&&b!="wheel"&&(E.setIntersection(E.computeIntersection("pointer",t,x)),E.commit(x,!1)),l.set(x.pointerId,E)),E},h=new Map,d=new Map,f=[],p=[],m=(x,b,E)=>{switch(x){case"move":E.move(t,b);return;case"wheel":E.wheel(t,b);return;case"cancel":E.cancel(b);return;case"down":if(!Tu(b))return;E.down(b);return;case"up":if(!Tu(b))return;E.up(b);return;case"exit":d.delete(E),h.delete(E),E.exit(b);return}},g=(x,b)=>{const E=u(b,x);x==="move"&&d.set(E,b),x==="wheel"&&h.set(E,b),o.batchEvents??!0?p.push({type:x,event:b}):m(x,b,E)},_=g.bind(null,"move"),v=g.bind(null,"cancel"),y=g.bind(null,"down"),T=g.bind(null,"up"),A=g.bind(null,"wheel"),w=g.bind(null,"exit");return n.addEventListener("pointermove",_),n.addEventListener("pointercancel",v),n.addEventListener("pointerdown",y),n.addEventListener("pointerup",T),n.addEventListener("wheel",A),n.addEventListener("pointerleave",w),{destroy(){n.removeEventListener("pointermove",_),n.removeEventListener("pointercancel",v),n.removeEventListener("pointerdown",y),n.removeEventListener("pointerup",T),n.removeEventListener("wheel",A),n.removeEventListener("pointerleave",w),d.clear(),h.clear()},update(){const x=p.length;for(let b=0;b<x;b++){const{type:E,event:M}=p[b],S=u(M,E);if(E==="move"&&(f.push(S),d.get(S)!=M)){S.emitMove(M);continue}if(E==="wheel"&&h.get(S)!=M){S.emitWheel(M);continue}m(E,M,S)}if(p.length=0,o.intersectEveryFrame??!1)for(const[b,E]of d.entries())f.includes(b)||b.move(t,E);f.length=0}}}function Tu(n){return n.button!=null}function Qv({canvas:n,contextParts:{scene:e,camera:t,renderer:r}}){const{update:i,destroy:s}=Yv(me(n),()=>me(t.activeCamera),e.value),{off:o}=r.loop.onLoop(i);Lr(s),Lr(o);const a=Cp(e.value),l=Oi();return a.addEventListener("click",l.trigger),{onPointerMissed:l.on}}const Jv="useTres",[ey,ty]=jg(({scene:n,canvas:e,windowSize:t,rendererOptions:r})=>{const i=nl(n),s=Av(t,e),o=wv({sizes:s}),a=Ev({scene:i,canvas:e,options:r,contextParts:{sizes:s,camera:o}}),l=Qv({canvas:e,contextParts:{scene:i,camera:o,renderer:a}}),c={sizes:s,scene:i,camera:o,renderer:a,controls:qi(null),extend:ul,events:l};return c.scene.value.__tres={root:c},c},{injectionKey:"useTres"}),kp=()=>{const n=ty();if(!n)throw new Error(`useTresContext must be used together with useTresContextProvider.
 You probably tried to use it above or on the same level as a TresCanvas component.
 It should be used in child components of a TresCanvas instance.`);return n};function Qr(){const{scene:n,renderer:e,camera:t,sizes:r,controls:i,extend:s,events:o}=kp();return{scene:n,renderer:e.instance,camera:t.activeCamera,sizes:r,controls:i,extend:s,events:o,invalidate:e.invalidate,advance:e.advance}}const Yi=()=>{const n=Qr(),{renderer:e}=kp(),t=du(),r=du();e.loop.onBeforeLoop(s=>{t.trigger({...n,...s})}),e.loop.onLoop(s=>{r.trigger({...n,...s})});const i=e.replaceRenderFunction;return{stop:e.loop.stop,start:e.loop.start,isActive:e.loop.isActive,onBeforeRender:t.on,onRender:r.on,render:i}};function ny(n,e={},t={}){let r=n;const i=a=>{r=a};let s=new Proxy({},{});const o={has(a,l){return l in e||l in r},get(a,l,c){return l in e?e[l](r):r[l]},set(a,l,c){return t[l]?t[l](c,r,s,i):r[l]=c,!0}};return s=new Proxy({},o),s}const ry=["onClick","onContextmenu","onPointermove","onPointerenter","onPointerleave","onPointerover","onPointerout","onDblclick","onPointerdown","onPointerup","onPointercancel","onLostpointercapture","onWheel"],iy={onClick:"click",onContextmenu:"contextmenu",onPointermove:"pointermove",onPointerenter:"pointerenter",onPointerleave:"pointerleave",onPointerover:"pointerover",onPointerout:"pointerout",onDblclick:"dblclick",onPointerdown:"pointerdown",onPointerup:"pointerup",onPointercancel:"pointercancel",onLostpointercapture:"lostpointercapture",onWheel:"wheel"},xu=n=>ry.includes(n),sy=n=>{const e=n.scene.value;function t(u,h,d,f){if(f||(f={}),f.args||(f.args=[]),iv(u))return null;let p=u.replace("Tres",""),m;if(u==="primitive"){(!tc(f.object)||Ei(f.object))&&cu("Tres primitives need an 'object' prop, whose value is an object or shallowRef<object>"),p=f.object.type;const g={};m=ny(f.object,{object:_=>_,isPrimitive:()=>!0,__tres:()=>g},{object:(_,v,y,T)=>{yv(_,y,T,{patchProp:s,remove:i,insert:r},n)},__tres:_=>{Object.assign(g,_)}})}else{const g=cl.value[p];g||cu(`${p} is not defined on the THREE namespace. Use extend to add it to the catalog.`),m=new g(...f.args)}return m?(gr(m)&&(f?.position||m.position.set(3,3,3),f?.lookAt||m.lookAt(0,0,0)),m=Vn(m,{...fv(m)?m.__tres:{},type:p,memoizedProps:f,primitive:u==="primitive",attach:f.attach},n),m):null}function r(u,h){if(!u)return;h=h||e;const d=u.__tres?u:Vn(u,{},n),f=h.__tres?h:Vn(h,{},n);u=Ir(d),h=Ir(f),gr(u)&&n.camera?.registerCamera(u),d.__tres.attach?_v(f,d,d.__tres.attach):ol(u)&&ol(f)&&(f.add(u),u.dispatchEvent({type:"added"})),d.__tres.parent=f,f.__tres.objects&&!f.__tres.objects.includes(d)&&f.__tres.objects.push(d)}function i(u,h){if(!u)return;h=sl(h)?"default":h;const d=u.__tres?.dispose;sl(d)||(d===null?h=!1:h=d);const f=u.__tres?.primitive,p=h==="default"?!f:!!h;if(u.__tres&&"objects"in u.__tres&&[...u.__tres.objects].forEach(m=>i(m,h)),p&&u.children&&[...u.children].forEach(m=>i(m,h)),Ep(u,n),Ap(u,n),p&&!xp(u)){if(Hn(h))h(u);else if(Hn(u.dispose))try{u.dispose()}catch{}}"__tres"in u&&delete u.__tres}function s(u,h,d,f){if(!u)return;let p=u;const m=h;if(u.__tres&&(u.__tres.memoizedProps[h]=f),h==="attach"){const y=u.__tres?.parent||u.parent;i(u),Vn(u,{attach:f},n),y&&r(u,y);return}if(h==="dispose"){u.__tres||(u=Vn(u,{},n)),u.__tres.dispose=f;return}xu(h)&&Hn(f)&&u.addEventListener(iy[h],f);let g=au(m),_=p?.[g];if(m==="args"){const y=u,T=d??[],A=f??[],w=u.__tres?.type||u.type;if(w&&T.length&&!fp(T,A)){const x=new cl.value[w](...f),b=Object.getOwnPropertyDescriptors(x);Object.entries(b).forEach(([E,M])=>{if(!(!M.writable&&!M.set)&&E in y)try{y[E]=x[E]}catch(S){console.warn(`Could not set property ${E} on ${w}:`,S)}}),p=y}return}if(p.type==="BufferGeometry"){if(m==="args")return;p.setAttribute(au(m),new dp(...f));return}if(m.includes("-")&&_===void 0){const y=Ys(p,m);if(_=y.target,p=y.target,g=y.key,_&&g){_[g]=f,gr(u)&&u.updateProjectionMatrix(),ll(u);return}}let v=f;if(v===""&&(v=!0),Hn(_)){xu(h)||(Array.isArray(v)?u[g](...v):u[g](v)),g.startsWith("on")&&Hn(v)&&(p[g]=v);return}lu(_)&&lu(v)?_.mask=v.mask:yp(_)&&lv(v)?_.set(v):uv(_)&&hv(v)&&_.constructor===v.constructor?_.copy(v):al(_)&&Array.isArray(v)?"fromArray"in _&&typeof _.fromArray=="function"?_.fromArray(v):_.set(...v):al(_)&&typeof v=="number"?"setScalar"in _&&typeof _.setScalar=="function"?_.setScalar(v):_.set(v):p[g]=v,gr(u)&&u.updateProjectionMatrix(),ll(u)}function o(u){return u?.__tres?.parent||null}function a(u){const h=Vn(new _o,{type:"Comment"},n);return h.name=u,h}function l(u){const h=o(u)?.__tres?.objects||[],d=h.indexOf(u);return d<0||d>=h.length-1?null:h[d+1]}const c=()=>{};return{insert:r,remove:i,createElement:t,patchProp:s,parentNode:o,createText:c,createComment:a,setText:c,setElementText:c,nextSibling:l,querySelector:c,setScopeId:c,cloneNode:c,insertStaticContent:c}},oy=["asset-load"];let ay=class{subscribers=new Set;messageQueue=[];maxQueueSize=100;send(e,t){const r={type:e,data:t,timestamp:Date.now()};this.subscribers.size>0?this.subscribers.forEach(i=>i(r)):oy.includes(e)&&this.queueMessage(r)}queueMessage(e){this.messageQueue.push(e),this.messageQueue.length>this.maxQueueSize&&this.messageQueue.shift()}flushQueue(){this.messageQueue.length===0||this.subscribers.size===0||(this.messageQueue.forEach(e=>{this.subscribers.forEach(t=>t(e))}),this.messageQueue=[])}subscribe(e){return this.subscribers.add(e),this.flushQueue(),()=>{this.subscribers.delete(e)}}get hasSubscribers(){return this.subscribers.size>0}get queueSize(){return this.messageQueue.length}clearQueue(){this.messageQueue=[]}};var ly=Object.create,Lp=Object.defineProperty,cy=Object.getOwnPropertyDescriptor,ic=Object.getOwnPropertyNames,uy=Object.getPrototypeOf,hy=Object.prototype.hasOwnProperty,dy=(n,e)=>function(){return n&&(e=(0,n[ic(n)[0]])(n=0)),e},py=(n,e)=>function(){return e||(0,n[ic(n)[0]])((e={exports:{}}).exports,e),e.exports},fy=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ic(e))!hy.call(n,i)&&i!==t&&Lp(n,i,{get:()=>e[i],enumerable:!(r=cy(e,i))||r.enumerable});return n},my=(n,e,t)=>(t=n!=null?ly(uy(n)):{},fy(Lp(t,"default",{value:n,enumerable:!0}),n)),Zi=dy({"../../node_modules/.pnpm/tsup@8.4.0_@microsoft+api-extractor@7.51.1_@types+node@22.13.14__jiti@2.4.2_postcss@8.5_96eb05a9d65343021e53791dd83f3773/node_modules/tsup/assets/esm_shims.js"(){}}),gy=py({"../../node_modules/.pnpm/rfdc@1.4.1/node_modules/rfdc/index.js"(n,e){Zi(),e.exports=r;function t(s){return s instanceof Buffer?Buffer.from(s):new s.constructor(s.buffer.slice(),s.byteOffset,s.length)}function r(s){if(s=s||{},s.circles)return i(s);const o=new Map;if(o.set(Date,h=>new Date(h)),o.set(Map,(h,d)=>new Map(l(Array.from(h),d))),o.set(Set,(h,d)=>new Set(l(Array.from(h),d))),s.constructorHandlers)for(const h of s.constructorHandlers)o.set(h[0],h[1]);let a=null;return s.proto?u:c;function l(h,d){const f=Object.keys(h),p=new Array(f.length);for(let m=0;m<f.length;m++){const g=f[m],_=h[g];typeof _!="object"||_===null?p[g]=_:_.constructor!==Object&&(a=o.get(_.constructor))?p[g]=a(_,d):ArrayBuffer.isView(_)?p[g]=t(_):p[g]=d(_)}return p}function c(h){if(typeof h!="object"||h===null)return h;if(Array.isArray(h))return l(h,c);if(h.constructor!==Object&&(a=o.get(h.constructor)))return a(h,c);const d={};for(const f in h){if(Object.hasOwnProperty.call(h,f)===!1)continue;const p=h[f];typeof p!="object"||p===null?d[f]=p:p.constructor!==Object&&(a=o.get(p.constructor))?d[f]=a(p,c):ArrayBuffer.isView(p)?d[f]=t(p):d[f]=c(p)}return d}function u(h){if(typeof h!="object"||h===null)return h;if(Array.isArray(h))return l(h,u);if(h.constructor!==Object&&(a=o.get(h.constructor)))return a(h,u);const d={};for(const f in h){const p=h[f];typeof p!="object"||p===null?d[f]=p:p.constructor!==Object&&(a=o.get(p.constructor))?d[f]=a(p,u):ArrayBuffer.isView(p)?d[f]=t(p):d[f]=u(p)}return d}}function i(s){const o=[],a=[],l=new Map;if(l.set(Date,f=>new Date(f)),l.set(Map,(f,p)=>new Map(u(Array.from(f),p))),l.set(Set,(f,p)=>new Set(u(Array.from(f),p))),s.constructorHandlers)for(const f of s.constructorHandlers)l.set(f[0],f[1]);let c=null;return s.proto?d:h;function u(f,p){const m=Object.keys(f),g=new Array(m.length);for(let _=0;_<m.length;_++){const v=m[_],y=f[v];if(typeof y!="object"||y===null)g[v]=y;else if(y.constructor!==Object&&(c=l.get(y.constructor)))g[v]=c(y,p);else if(ArrayBuffer.isView(y))g[v]=t(y);else{const T=o.indexOf(y);T!==-1?g[v]=a[T]:g[v]=p(y)}}return g}function h(f){if(typeof f!="object"||f===null)return f;if(Array.isArray(f))return u(f,h);if(f.constructor!==Object&&(c=l.get(f.constructor)))return c(f,h);const p={};o.push(f),a.push(p);for(const m in f){if(Object.hasOwnProperty.call(f,m)===!1)continue;const g=f[m];if(typeof g!="object"||g===null)p[m]=g;else if(g.constructor!==Object&&(c=l.get(g.constructor)))p[m]=c(g,h);else if(ArrayBuffer.isView(g))p[m]=t(g);else{const _=o.indexOf(g);_!==-1?p[m]=a[_]:p[m]=h(g)}}return o.pop(),a.pop(),p}function d(f){if(typeof f!="object"||f===null)return f;if(Array.isArray(f))return u(f,d);if(f.constructor!==Object&&(c=l.get(f.constructor)))return c(f,d);const p={};o.push(f),a.push(p);for(const m in f){const g=f[m];if(typeof g!="object"||g===null)p[m]=g;else if(g.constructor!==Object&&(c=l.get(g.constructor)))p[m]=c(g,d);else if(ArrayBuffer.isView(g))p[m]=t(g);else{const _=o.indexOf(g);_!==-1?p[m]=a[_]:p[m]=d(g)}}return o.pop(),a.pop(),p}}}});Zi();Zi();Zi();var Ip=typeof navigator<"u",D=typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof global<"u"?global:{};typeof D.chrome<"u"&&D.chrome.devtools;Ip&&(D.self,D.top);var Eu;typeof navigator<"u"&&((Eu=navigator.userAgent)==null||Eu.toLowerCase().includes("electron"));Zi();var _y=my(gy()),vy=/(?:^|[-_/])(\w)/g;function yy(n,e){return e?e.toUpperCase():""}function by(n){return n&&`${n}`.replace(vy,yy)}function wy(n,e){let t=n.replace(/^[a-z]:/i,"").replace(/\\/g,"/");t.endsWith(`index${e}`)&&(t=t.replace(`/index${e}`,e));const r=t.lastIndexOf("/"),i=t.substring(r+1);{const s=i.lastIndexOf(e);return i.substring(0,s)}}var Au=(0,_y.default)({circles:!0});const Ty={trailing:!0};function Dr(n,e=25,t={}){if(t={...Ty,...t},!Number.isFinite(e))throw new TypeError("Expected `wait` to be a finite number");let r,i,s=[],o,a;const l=(c,u)=>(o=xy(n,c,u),o.finally(()=>{if(o=null,t.trailing&&a&&!i){const h=l(c,a);return a=null,h}}),o);return function(...c){return o?(t.trailing&&(a=c),o):new Promise(u=>{const h=!i&&t.leading;clearTimeout(i),i=setTimeout(()=>{i=null;const d=t.leading?r:l(this,c);for(const f of s)f(d);s=[]},e),h?(r=l(this,c),u(r)):s.push(u)})}}async function xy(n,e,t){return await n.apply(e,t)}function hl(n,e={},t){for(const r in n){const i=n[r],s=t?`${t}:${r}`:r;typeof i=="object"&&i!==null?hl(i,e,s):typeof i=="function"&&(e[s]=i)}return e}const Ey={run:n=>n()},Ay=()=>Ey,Dp=typeof console.createTask<"u"?console.createTask:Ay;function Py(n,e){const t=e.shift(),r=Dp(t);return n.reduce((i,s)=>i.then(()=>r.run(()=>s(...e))),Promise.resolve())}function My(n,e){const t=e.shift(),r=Dp(t);return Promise.all(n.map(i=>r.run(()=>i(...e))))}function Vo(n,e){for(const t of[...n])t(e)}let Sy=class{constructor(){this._hooks={},this._before=void 0,this._after=void 0,this._deprecatedMessages=void 0,this._deprecatedHooks={},this.hook=this.hook.bind(this),this.callHook=this.callHook.bind(this),this.callHookWith=this.callHookWith.bind(this)}hook(e,t,r={}){if(!e||typeof t!="function")return()=>{};const i=e;let s;for(;this._deprecatedHooks[e];)s=this._deprecatedHooks[e],e=s.to;if(s&&!r.allowDeprecated){let o=s.message;o||(o=`${i} hook has been deprecated`+(s.to?`, please use ${s.to}`:"")),this._deprecatedMessages||(this._deprecatedMessages=new Set),this._deprecatedMessages.has(o)||(console.warn(o),this._deprecatedMessages.add(o))}if(!t.name)try{Object.defineProperty(t,"name",{get:()=>"_"+e.replace(/\W+/g,"_")+"_hook_cb",configurable:!0})}catch{}return this._hooks[e]=this._hooks[e]||[],this._hooks[e].push(t),()=>{t&&(this.removeHook(e,t),t=void 0)}}hookOnce(e,t){let r,i=(...s)=>(typeof r=="function"&&r(),r=void 0,i=void 0,t(...s));return r=this.hook(e,i),r}removeHook(e,t){if(this._hooks[e]){const r=this._hooks[e].indexOf(t);r!==-1&&this._hooks[e].splice(r,1),this._hooks[e].length===0&&delete this._hooks[e]}}deprecateHook(e,t){this._deprecatedHooks[e]=typeof t=="string"?{to:t}:t;const r=this._hooks[e]||[];delete this._hooks[e];for(const i of r)this.hook(e,i)}deprecateHooks(e){Object.assign(this._deprecatedHooks,e);for(const t in e)this.deprecateHook(t,e[t])}addHooks(e){const t=hl(e),r=Object.keys(t).map(i=>this.hook(i,t[i]));return()=>{for(const i of r.splice(0,r.length))i()}}removeHooks(e){const t=hl(e);for(const r in t)this.removeHook(r,t[r])}removeAllHooks(){for(const e in this._hooks)delete this._hooks[e]}callHook(e,...t){return t.unshift(e),this.callHookWith(Py,e,...t)}callHookParallel(e,...t){return t.unshift(e),this.callHookWith(My,e,...t)}callHookWith(e,t,...r){const i=this._before||this._after?{name:t,args:r,context:{}}:void 0;this._before&&Vo(this._before,i);const s=e(t in this._hooks?[...this._hooks[t]]:[],r);return s instanceof Promise?s.finally(()=>{this._after&&i&&Vo(this._after,i)}):(this._after&&i&&Vo(this._after,i),s)}beforeEach(e){return this._before=this._before||[],this._before.push(e),()=>{if(this._before!==void 0){const t=this._before.indexOf(e);t!==-1&&this._before.splice(t,1)}}}afterEach(e){return this._after=this._after||[],this._after.push(e),()=>{if(this._after!==void 0){const t=this._after.indexOf(e);t!==-1&&this._after.splice(t,1)}}}};function Np(){return new Sy}var Cy=Object.create,Fp=Object.defineProperty,Ry=Object.getOwnPropertyDescriptor,sc=Object.getOwnPropertyNames,Oy=Object.getPrototypeOf,ky=Object.prototype.hasOwnProperty,Ly=(n,e)=>function(){return n&&(e=(0,n[sc(n)[0]])(n=0)),e},Up=(n,e)=>function(){return e||(0,n[sc(n)[0]])((e={exports:{}}).exports,e),e.exports},Iy=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of sc(e))!ky.call(n,i)&&i!==t&&Fp(n,i,{get:()=>e[i],enumerable:!(r=Ry(e,i))||r.enumerable});return n},Dy=(n,e,t)=>(t=n!=null?Cy(Oy(n)):{},Iy(Fp(t,"default",{value:n,enumerable:!0}),n)),k=Ly({"../../node_modules/.pnpm/tsup@8.4.0_@microsoft+api-extractor@7.51.1_@types+node@22.13.14__jiti@2.4.2_postcss@8.5_96eb05a9d65343021e53791dd83f3773/node_modules/tsup/assets/esm_shims.js"(){}}),Ny=Up({"../../node_modules/.pnpm/speakingurl@14.0.1/node_modules/speakingurl/lib/speakingurl.js"(n,e){k(),function(t){var r={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"Ae",Å:"A",Æ:"AE",Ç:"C",È:"E",É:"E",Ê:"E",Ë:"E",Ì:"I",Í:"I",Î:"I",Ï:"I",Ð:"D",Ñ:"N",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"Oe",Ő:"O",Ø:"O",Ù:"U",Ú:"U",Û:"U",Ü:"Ue",Ű:"U",Ý:"Y",Þ:"TH",ß:"ss",à:"a",á:"a",â:"a",ã:"a",ä:"ae",å:"a",æ:"ae",ç:"c",è:"e",é:"e",ê:"e",ë:"e",ì:"i",í:"i",î:"i",ï:"i",ð:"d",ñ:"n",ò:"o",ó:"o",ô:"o",õ:"o",ö:"oe",ő:"o",ø:"o",ù:"u",ú:"u",û:"u",ü:"ue",ű:"u",ý:"y",þ:"th",ÿ:"y","ẞ":"SS",ا:"a",أ:"a",إ:"i",آ:"aa",ؤ:"u",ئ:"e",ء:"a",ب:"b",ت:"t",ث:"th",ج:"j",ح:"h",خ:"kh",د:"d",ذ:"th",ر:"r",ز:"z",س:"s",ش:"sh",ص:"s",ض:"dh",ط:"t",ظ:"z",ع:"a",غ:"gh",ف:"f",ق:"q",ك:"k",ل:"l",م:"m",ن:"n",ه:"h",و:"w",ي:"y",ى:"a",ة:"h",ﻻ:"la",ﻷ:"laa",ﻹ:"lai",ﻵ:"laa",گ:"g",چ:"ch",پ:"p",ژ:"zh",ک:"k",ی:"y","َ":"a","ً":"an","ِ":"e","ٍ":"en","ُ":"u","ٌ":"on","ْ":"","٠":"0","١":"1","٢":"2","٣":"3","٤":"4","٥":"5","٦":"6","٧":"7","٨":"8","٩":"9","۰":"0","۱":"1","۲":"2","۳":"3","۴":"4","۵":"5","۶":"6","۷":"7","۸":"8","۹":"9",က:"k",ခ:"kh",ဂ:"g",ဃ:"ga",င:"ng",စ:"s",ဆ:"sa",ဇ:"z","စျ":"za",ည:"ny",ဋ:"t",ဌ:"ta",ဍ:"d",ဎ:"da",ဏ:"na",တ:"t",ထ:"ta",ဒ:"d",ဓ:"da",န:"n",ပ:"p",ဖ:"pa",ဗ:"b",ဘ:"ba",မ:"m",ယ:"y",ရ:"ya",လ:"l",ဝ:"w",သ:"th",ဟ:"h",ဠ:"la",အ:"a","ြ":"y","ျ":"ya","ွ":"w","ြွ":"yw","ျွ":"ywa","ှ":"h",ဧ:"e","၏":"-e",ဣ:"i",ဤ:"-i",ဉ:"u",ဦ:"-u",ဩ:"aw","သြော":"aw",ဪ:"aw","၀":"0","၁":"1","၂":"2","၃":"3","၄":"4","၅":"5","၆":"6","၇":"7","၈":"8","၉":"9","္":"","့":"","း":"",č:"c",ď:"d",ě:"e",ň:"n",ř:"r",š:"s",ť:"t",ů:"u",ž:"z",Č:"C",Ď:"D",Ě:"E",Ň:"N",Ř:"R",Š:"S",Ť:"T",Ů:"U",Ž:"Z",ހ:"h",ށ:"sh",ނ:"n",ރ:"r",ބ:"b",ޅ:"lh",ކ:"k",އ:"a",ވ:"v",މ:"m",ފ:"f",ދ:"dh",ތ:"th",ލ:"l",ގ:"g",ޏ:"gn",ސ:"s",ޑ:"d",ޒ:"z",ޓ:"t",ޔ:"y",ޕ:"p",ޖ:"j",ޗ:"ch",ޘ:"tt",ޙ:"hh",ޚ:"kh",ޛ:"th",ޜ:"z",ޝ:"sh",ޞ:"s",ޟ:"d",ޠ:"t",ޡ:"z",ޢ:"a",ޣ:"gh",ޤ:"q",ޥ:"w","ަ":"a","ާ":"aa","ި":"i","ީ":"ee","ު":"u","ޫ":"oo","ެ":"e","ޭ":"ey","ޮ":"o","ޯ":"oa","ް":"",ა:"a",ბ:"b",გ:"g",დ:"d",ე:"e",ვ:"v",ზ:"z",თ:"t",ი:"i",კ:"k",ლ:"l",მ:"m",ნ:"n",ო:"o",პ:"p",ჟ:"zh",რ:"r",ს:"s",ტ:"t",უ:"u",ფ:"p",ქ:"k",ღ:"gh",ყ:"q",შ:"sh",ჩ:"ch",ც:"ts",ძ:"dz",წ:"ts",ჭ:"ch",ხ:"kh",ჯ:"j",ჰ:"h",α:"a",β:"v",γ:"g",δ:"d",ε:"e",ζ:"z",η:"i",θ:"th",ι:"i",κ:"k",λ:"l",μ:"m",ν:"n",ξ:"ks",ο:"o",π:"p",ρ:"r",σ:"s",τ:"t",υ:"y",φ:"f",χ:"x",ψ:"ps",ω:"o",ά:"a",έ:"e",ί:"i",ό:"o",ύ:"y",ή:"i",ώ:"o",ς:"s",ϊ:"i",ΰ:"y",ϋ:"y",ΐ:"i",Α:"A",Β:"B",Γ:"G",Δ:"D",Ε:"E",Ζ:"Z",Η:"I",Θ:"TH",Ι:"I",Κ:"K",Λ:"L",Μ:"M",Ν:"N",Ξ:"KS",Ο:"O",Π:"P",Ρ:"R",Σ:"S",Τ:"T",Υ:"Y",Φ:"F",Χ:"X",Ψ:"PS",Ω:"O",Ά:"A",Έ:"E",Ί:"I",Ό:"O",Ύ:"Y",Ή:"I",Ώ:"O",Ϊ:"I",Ϋ:"Y",ā:"a",ē:"e",ģ:"g",ī:"i",ķ:"k",ļ:"l",ņ:"n",ū:"u",Ā:"A",Ē:"E",Ģ:"G",Ī:"I",Ķ:"k",Ļ:"L",Ņ:"N",Ū:"U",Ќ:"Kj",ќ:"kj",Љ:"Lj",љ:"lj",Њ:"Nj",њ:"nj",Тс:"Ts",тс:"ts",ą:"a",ć:"c",ę:"e",ł:"l",ń:"n",ś:"s",ź:"z",ż:"z",Ą:"A",Ć:"C",Ę:"E",Ł:"L",Ń:"N",Ś:"S",Ź:"Z",Ż:"Z",Є:"Ye",І:"I",Ї:"Yi",Ґ:"G",є:"ye",і:"i",ї:"yi",ґ:"g",ă:"a",Ă:"A",ș:"s",Ș:"S",ț:"t",Ț:"T",ţ:"t",Ţ:"T",а:"a",б:"b",в:"v",г:"g",д:"d",е:"e",ё:"yo",ж:"zh",з:"z",и:"i",й:"i",к:"k",л:"l",м:"m",н:"n",о:"o",п:"p",р:"r",с:"s",т:"t",у:"u",ф:"f",х:"kh",ц:"c",ч:"ch",ш:"sh",щ:"sh",ъ:"",ы:"y",ь:"",э:"e",ю:"yu",я:"ya",А:"A",Б:"B",В:"V",Г:"G",Д:"D",Е:"E",Ё:"Yo",Ж:"Zh",З:"Z",И:"I",Й:"I",К:"K",Л:"L",М:"M",Н:"N",О:"O",П:"P",Р:"R",С:"S",Т:"T",У:"U",Ф:"F",Х:"Kh",Ц:"C",Ч:"Ch",Ш:"Sh",Щ:"Sh",Ъ:"",Ы:"Y",Ь:"",Э:"E",Ю:"Yu",Я:"Ya",ђ:"dj",ј:"j",ћ:"c",џ:"dz",Ђ:"Dj",Ј:"j",Ћ:"C",Џ:"Dz",ľ:"l",ĺ:"l",ŕ:"r",Ľ:"L",Ĺ:"L",Ŕ:"R",ş:"s",Ş:"S",ı:"i",İ:"I",ğ:"g",Ğ:"G",ả:"a",Ả:"A",ẳ:"a",Ẳ:"A",ẩ:"a",Ẩ:"A",đ:"d",Đ:"D",ẹ:"e",Ẹ:"E",ẽ:"e",Ẽ:"E",ẻ:"e",Ẻ:"E",ế:"e",Ế:"E",ề:"e",Ề:"E",ệ:"e",Ệ:"E",ễ:"e",Ễ:"E",ể:"e",Ể:"E",ỏ:"o",ọ:"o",Ọ:"o",ố:"o",Ố:"O",ồ:"o",Ồ:"O",ổ:"o",Ổ:"O",ộ:"o",Ộ:"O",ỗ:"o",Ỗ:"O",ơ:"o",Ơ:"O",ớ:"o",Ớ:"O",ờ:"o",Ờ:"O",ợ:"o",Ợ:"O",ỡ:"o",Ỡ:"O",Ở:"o",ở:"o",ị:"i",Ị:"I",ĩ:"i",Ĩ:"I",ỉ:"i",Ỉ:"i",ủ:"u",Ủ:"U",ụ:"u",Ụ:"U",ũ:"u",Ũ:"U",ư:"u",Ư:"U",ứ:"u",Ứ:"U",ừ:"u",Ừ:"U",ự:"u",Ự:"U",ữ:"u",Ữ:"U",ử:"u",Ử:"ư",ỷ:"y",Ỷ:"y",ỳ:"y",Ỳ:"Y",ỵ:"y",Ỵ:"Y",ỹ:"y",Ỹ:"Y",ạ:"a",Ạ:"A",ấ:"a",Ấ:"A",ầ:"a",Ầ:"A",ậ:"a",Ậ:"A",ẫ:"a",Ẫ:"A",ắ:"a",Ắ:"A",ằ:"a",Ằ:"A",ặ:"a",Ặ:"A",ẵ:"a",Ẵ:"A","⓪":"0","①":"1","②":"2","③":"3","④":"4","⑤":"5","⑥":"6","⑦":"7","⑧":"8","⑨":"9","⑩":"10","⑪":"11","⑫":"12","⑬":"13","⑭":"14","⑮":"15","⑯":"16","⑰":"17","⑱":"18","⑲":"18","⑳":"18","⓵":"1","⓶":"2","⓷":"3","⓸":"4","⓹":"5","⓺":"6","⓻":"7","⓼":"8","⓽":"9","⓾":"10","⓿":"0","⓫":"11","⓬":"12","⓭":"13","⓮":"14","⓯":"15","⓰":"16","⓱":"17","⓲":"18","⓳":"19","⓴":"20","Ⓐ":"A","Ⓑ":"B","Ⓒ":"C","Ⓓ":"D","Ⓔ":"E","Ⓕ":"F","Ⓖ":"G","Ⓗ":"H","Ⓘ":"I","Ⓙ":"J","Ⓚ":"K","Ⓛ":"L","Ⓜ":"M","Ⓝ":"N","Ⓞ":"O","Ⓟ":"P","Ⓠ":"Q","Ⓡ":"R","Ⓢ":"S","Ⓣ":"T","Ⓤ":"U","Ⓥ":"V","Ⓦ":"W","Ⓧ":"X","Ⓨ":"Y","Ⓩ":"Z","ⓐ":"a","ⓑ":"b","ⓒ":"c","ⓓ":"d","ⓔ":"e","ⓕ":"f","ⓖ":"g","ⓗ":"h","ⓘ":"i","ⓙ":"j","ⓚ":"k","ⓛ":"l","ⓜ":"m","ⓝ":"n","ⓞ":"o","ⓟ":"p","ⓠ":"q","ⓡ":"r","ⓢ":"s","ⓣ":"t","ⓤ":"u","ⓦ":"v","ⓥ":"w","ⓧ":"x","ⓨ":"y","ⓩ":"z","“":'"',"”":'"',"‘":"'","’":"'","∂":"d",ƒ:"f","™":"(TM)","©":"(C)",œ:"oe",Œ:"OE","®":"(R)","†":"+","℠":"(SM)","…":"...","˚":"o",º:"o",ª:"a","•":"*","၊":",","။":".",$:"USD","€":"EUR","₢":"BRN","₣":"FRF","£":"GBP","₤":"ITL","₦":"NGN","₧":"ESP","₩":"KRW","₪":"ILS","₫":"VND","₭":"LAK","₮":"MNT","₯":"GRD","₱":"ARS","₲":"PYG","₳":"ARA","₴":"UAH","₵":"GHS","¢":"cent","¥":"CNY",元:"CNY",円:"YEN","﷼":"IRR","₠":"EWE","฿":"THB","₨":"INR","₹":"INR","₰":"PF","₺":"TRY","؋":"AFN","₼":"AZN",лв:"BGN","៛":"KHR","₡":"CRC","₸":"KZT",ден:"MKD",zł:"PLN","₽":"RUB","₾":"GEL"},i=["်","ް"],s={"ာ":"a","ါ":"a","ေ":"e","ဲ":"e","ိ":"i","ီ":"i","ို":"o","ု":"u","ူ":"u","ေါင်":"aung","ော":"aw","ော်":"aw","ေါ":"aw","ေါ်":"aw","်":"်","က်":"et","ိုက်":"aik","ောက်":"auk","င်":"in","ိုင်":"aing","ောင်":"aung","စ်":"it","ည်":"i","တ်":"at","ိတ်":"eik","ုတ်":"ok","ွတ်":"ut","ေတ်":"it","ဒ်":"d","ိုဒ်":"ok","ုဒ်":"ait","န်":"an","ာန်":"an","ိန်":"ein","ုန်":"on","ွန်":"un","ပ်":"at","ိပ်":"eik","ုပ်":"ok","ွပ်":"ut","န်ုပ်":"nub","မ်":"an","ိမ်":"ein","ုမ်":"on","ွမ်":"un","ယ်":"e","ိုလ်":"ol","ဉ်":"in","ံ":"an","ိံ":"ein","ုံ":"on","ައް":"ah","ަށް":"ah"},o={en:{},az:{ç:"c",ə:"e",ğ:"g",ı:"i",ö:"o",ş:"s",ü:"u",Ç:"C",Ə:"E",Ğ:"G",İ:"I",Ö:"O",Ş:"S",Ü:"U"},cs:{č:"c",ď:"d",ě:"e",ň:"n",ř:"r",š:"s",ť:"t",ů:"u",ž:"z",Č:"C",Ď:"D",Ě:"E",Ň:"N",Ř:"R",Š:"S",Ť:"T",Ů:"U",Ž:"Z"},fi:{ä:"a",Ä:"A",ö:"o",Ö:"O"},hu:{ä:"a",Ä:"A",ö:"o",Ö:"O",ü:"u",Ü:"U",ű:"u",Ű:"U"},lt:{ą:"a",č:"c",ę:"e",ė:"e",į:"i",š:"s",ų:"u",ū:"u",ž:"z",Ą:"A",Č:"C",Ę:"E",Ė:"E",Į:"I",Š:"S",Ų:"U",Ū:"U"},lv:{ā:"a",č:"c",ē:"e",ģ:"g",ī:"i",ķ:"k",ļ:"l",ņ:"n",š:"s",ū:"u",ž:"z",Ā:"A",Č:"C",Ē:"E",Ģ:"G",Ī:"i",Ķ:"k",Ļ:"L",Ņ:"N",Š:"S",Ū:"u",Ž:"Z"},pl:{ą:"a",ć:"c",ę:"e",ł:"l",ń:"n",ó:"o",ś:"s",ź:"z",ż:"z",Ą:"A",Ć:"C",Ę:"e",Ł:"L",Ń:"N",Ó:"O",Ś:"S",Ź:"Z",Ż:"Z"},sv:{ä:"a",Ä:"A",ö:"o",Ö:"O"},sk:{ä:"a",Ä:"A"},sr:{љ:"lj",њ:"nj",Љ:"Lj",Њ:"Nj",đ:"dj",Đ:"Dj"},tr:{Ü:"U",Ö:"O",ü:"u",ö:"o"}},a={ar:{"∆":"delta","∞":"la-nihaya","♥":"hob","&":"wa","|":"aw","<":"aqal-men",">":"akbar-men","∑":"majmou","¤":"omla"},az:{},ca:{"∆":"delta","∞":"infinit","♥":"amor","&":"i","|":"o","<":"menys que",">":"mes que","∑":"suma dels","¤":"moneda"},cs:{"∆":"delta","∞":"nekonecno","♥":"laska","&":"a","|":"nebo","<":"mensi nez",">":"vetsi nez","∑":"soucet","¤":"mena"},de:{"∆":"delta","∞":"unendlich","♥":"Liebe","&":"und","|":"oder","<":"kleiner als",">":"groesser als","∑":"Summe von","¤":"Waehrung"},dv:{"∆":"delta","∞":"kolunulaa","♥":"loabi","&":"aai","|":"noonee","<":"ah vure kuda",">":"ah vure bodu","∑":"jumula","¤":"faisaa"},en:{"∆":"delta","∞":"infinity","♥":"love","&":"and","|":"or","<":"less than",">":"greater than","∑":"sum","¤":"currency"},es:{"∆":"delta","∞":"infinito","♥":"amor","&":"y","|":"u","<":"menos que",">":"mas que","∑":"suma de los","¤":"moneda"},fa:{"∆":"delta","∞":"bi-nahayat","♥":"eshgh","&":"va","|":"ya","<":"kamtar-az",">":"bishtar-az","∑":"majmooe","¤":"vahed"},fi:{"∆":"delta","∞":"aarettomyys","♥":"rakkaus","&":"ja","|":"tai","<":"pienempi kuin",">":"suurempi kuin","∑":"summa","¤":"valuutta"},fr:{"∆":"delta","∞":"infiniment","♥":"Amour","&":"et","|":"ou","<":"moins que",">":"superieure a","∑":"somme des","¤":"monnaie"},ge:{"∆":"delta","∞":"usasruloba","♥":"siqvaruli","&":"da","|":"an","<":"naklebi",">":"meti","∑":"jami","¤":"valuta"},gr:{},hu:{"∆":"delta","∞":"vegtelen","♥":"szerelem","&":"es","|":"vagy","<":"kisebb mint",">":"nagyobb mint","∑":"szumma","¤":"penznem"},it:{"∆":"delta","∞":"infinito","♥":"amore","&":"e","|":"o","<":"minore di",">":"maggiore di","∑":"somma","¤":"moneta"},lt:{"∆":"delta","∞":"begalybe","♥":"meile","&":"ir","|":"ar","<":"maziau nei",">":"daugiau nei","∑":"suma","¤":"valiuta"},lv:{"∆":"delta","∞":"bezgaliba","♥":"milestiba","&":"un","|":"vai","<":"mazak neka",">":"lielaks neka","∑":"summa","¤":"valuta"},my:{"∆":"kwahkhyaet","∞":"asaonasme","♥":"akhyait","&":"nhin","|":"tho","<":"ngethaw",">":"kyithaw","∑":"paungld","¤":"ngwekye"},mk:{},nl:{"∆":"delta","∞":"oneindig","♥":"liefde","&":"en","|":"of","<":"kleiner dan",">":"groter dan","∑":"som","¤":"valuta"},pl:{"∆":"delta","∞":"nieskonczonosc","♥":"milosc","&":"i","|":"lub","<":"mniejsze niz",">":"wieksze niz","∑":"suma","¤":"waluta"},pt:{"∆":"delta","∞":"infinito","♥":"amor","&":"e","|":"ou","<":"menor que",">":"maior que","∑":"soma","¤":"moeda"},ro:{"∆":"delta","∞":"infinit","♥":"dragoste","&":"si","|":"sau","<":"mai mic ca",">":"mai mare ca","∑":"suma","¤":"valuta"},ru:{"∆":"delta","∞":"beskonechno","♥":"lubov","&":"i","|":"ili","<":"menshe",">":"bolshe","∑":"summa","¤":"valjuta"},sk:{"∆":"delta","∞":"nekonecno","♥":"laska","&":"a","|":"alebo","<":"menej ako",">":"viac ako","∑":"sucet","¤":"mena"},sr:{},tr:{"∆":"delta","∞":"sonsuzluk","♥":"ask","&":"ve","|":"veya","<":"kucuktur",">":"buyuktur","∑":"toplam","¤":"para birimi"},uk:{"∆":"delta","∞":"bezkinechnist","♥":"lubov","&":"i","|":"abo","<":"menshe",">":"bilshe","∑":"suma","¤":"valjuta"},vn:{"∆":"delta","∞":"vo cuc","♥":"yeu","&":"va","|":"hoac","<":"nho hon",">":"lon hon","∑":"tong","¤":"tien te"}},l=[";","?",":","@","&","=","+","$",",","/"].join(""),c=[";","?",":","@","&","=","+","$",","].join(""),u=[".","!","~","*","'","(",")"].join(""),h=function(m,g){var _="-",v="",y="",T=!0,A={},w,x,b,E,M,S,O,L,I,N,R,z,F,$,B="";if(typeof m!="string")return"";if(typeof g=="string"&&(_=g),O=a.en,L=o.en,typeof g=="object"){w=g.maintainCase||!1,A=g.custom&&typeof g.custom=="object"?g.custom:A,b=+g.truncate>1&&g.truncate||!1,E=g.uric||!1,M=g.uricNoSlash||!1,S=g.mark||!1,T=!(g.symbols===!1||g.lang===!1),_=g.separator||_,E&&(B+=l),M&&(B+=c),S&&(B+=u),O=g.lang&&a[g.lang]&&T?a[g.lang]:T?a.en:{},L=g.lang&&o[g.lang]?o[g.lang]:g.lang===!1||g.lang===!0?{}:o.en,g.titleCase&&typeof g.titleCase.length=="number"&&Array.prototype.toString.call(g.titleCase)?(g.titleCase.forEach(function(G){A[G+""]=G+""}),x=!0):x=!!g.titleCase,g.custom&&typeof g.custom.length=="number"&&Array.prototype.toString.call(g.custom)&&g.custom.forEach(function(G){A[G+""]=G+""}),Object.keys(A).forEach(function(G){var ye;G.length>1?ye=new RegExp("\\b"+f(G)+"\\b","gi"):ye=new RegExp(f(G),"gi"),m=m.replace(ye,A[G])});for(R in A)B+=R}for(B+=_,B=f(B),m=m.replace(/(^\s+|\s+$)/g,""),F=!1,$=!1,N=0,z=m.length;N<z;N++)R=m[N],p(R,A)?F=!1:L[R]?(R=F&&L[R].match(/[A-Za-z0-9]/)?" "+L[R]:L[R],F=!1):R in r?(N+1<z&&i.indexOf(m[N+1])>=0?(y+=R,R=""):$===!0?(R=s[y]+r[R],y=""):R=F&&r[R].match(/[A-Za-z0-9]/)?" "+r[R]:r[R],F=!1,$=!1):R in s?(y+=R,R="",N===z-1&&(R=s[y]),$=!0):O[R]&&!(E&&l.indexOf(R)!==-1)&&!(M&&c.indexOf(R)!==-1)?(R=F||v.substr(-1).match(/[A-Za-z0-9]/)?_+O[R]:O[R],R+=m[N+1]!==void 0&&m[N+1].match(/[A-Za-z0-9]/)?_:"",F=!0):($===!0?(R=s[y]+R,y="",$=!1):F&&(/[A-Za-z0-9]/.test(R)||v.substr(-1).match(/A-Za-z0-9]/))&&(R=" "+R),F=!1),v+=R.replace(new RegExp("[^\\w\\s"+B+"_-]","g"),_);return x&&(v=v.replace(/(\w)(\S*)/g,function(G,ye,Y){var he=ye.toUpperCase()+(Y!==null?Y:"");return Object.keys(A).indexOf(he.toLowerCase())<0?he:he.toLowerCase()})),v=v.replace(/\s+/g,_).replace(new RegExp("\\"+_+"+","g"),_).replace(new RegExp("(^\\"+_+"+|\\"+_+"+$)","g"),""),b&&v.length>b&&(I=v.charAt(b)===_,v=v.slice(0,b),I||(v=v.slice(0,v.lastIndexOf(_)))),!w&&!x&&(v=v.toLowerCase()),v},d=function(m){return function(g){return h(g,m)}},f=function(m){return m.replace(/[-\\^$*+?.()|[\]{}\/]/g,"\\$&")},p=function(m,g){for(var _ in g)if(g[_]===m)return!0};if(typeof e<"u"&&e.exports)e.exports=h,e.exports.createSlug=d;else if(typeof define<"u"&&define.amd)define([],function(){return h});else try{if(t.getSlug||t.createSlug)throw"speakingurl: globals exists /(getSlug|createSlug)/";t.getSlug=h,t.createSlug=d}catch{}}(n)}}),Fy=Up({"../../node_modules/.pnpm/speakingurl@14.0.1/node_modules/speakingurl/index.js"(n,e){k(),e.exports=Ny()}});k();k();k();k();k();k();k();k();function Uy(n){var e;const t=n.name||n._componentTag||n.__VUE_DEVTOOLS_COMPONENT_GUSSED_NAME__||n.__name;return t==="index"&&(e=n.__file)!=null&&e.endsWith("index.vue")?"":t}function jy(n){const e=n.__file;if(e)return by(wy(e,".vue"))}function Pu(n,e){return n.type.__VUE_DEVTOOLS_COMPONENT_GUSSED_NAME__=e,e}function oc(n){if(n.__VUE_DEVTOOLS_NEXT_APP_RECORD__)return n.__VUE_DEVTOOLS_NEXT_APP_RECORD__;if(n.root)return n.appContext.app.__VUE_DEVTOOLS_NEXT_APP_RECORD__}function jp(n){var e,t;const r=(e=n.subTree)==null?void 0:e.type,i=oc(n);return i?((t=i?.types)==null?void 0:t.Fragment)===r:!1}function yo(n){var e,t,r;const i=Uy(n?.type||{});if(i)return i;if(n?.root===n)return"Root";for(const o in(t=(e=n.parent)==null?void 0:e.type)==null?void 0:t.components)if(n.parent.type.components[o]===n?.type)return Pu(n,o);for(const o in(r=n.appContext)==null?void 0:r.components)if(n.appContext.components[o]===n?.type)return Pu(n,o);return jy(n?.type||{})||"Anonymous Component"}function By(n){var e,t,r;const i=(r=(t=(e=n?.appContext)==null?void 0:e.app)==null?void 0:t.__VUE_DEVTOOLS_NEXT_APP_RECORD_ID__)!=null?r:0,s=n===n?.root?"root":n.uid;return`${i}:${s}`}function dl(n,e){return e=e||`${n.id}:root`,n.instanceMap.get(e)||n.instanceMap.get(":root")}function zy(){const n={top:0,bottom:0,left:0,right:0,get width(){return n.right-n.left},get height(){return n.bottom-n.top}};return n}var os;function Vy(n){return os||(os=document.createRange()),os.selectNode(n),os.getBoundingClientRect()}function $y(n){const e=zy();if(!n.children)return e;for(let t=0,r=n.children.length;t<r;t++){const i=n.children[t];let s;if(i.component)s=tr(i.component);else if(i.el){const o=i.el;o.nodeType===1||o.getBoundingClientRect?s=o.getBoundingClientRect():o.nodeType===3&&o.data.trim()&&(s=Vy(o))}s&&Hy(e,s)}return e}function Hy(n,e){return(!n.top||e.top<n.top)&&(n.top=e.top),(!n.bottom||e.bottom>n.bottom)&&(n.bottom=e.bottom),(!n.left||e.left<n.left)&&(n.left=e.left),(!n.right||e.right>n.right)&&(n.right=e.right),n}var Mu={top:0,left:0,right:0,bottom:0,width:0,height:0};function tr(n){const e=n.subTree.el;return typeof window>"u"?Mu:jp(n)?$y(n.subTree):e?.nodeType===1?e?.getBoundingClientRect():n.subTree.component?tr(n.subTree.component):Mu}k();function ac(n){return jp(n)?Gy(n.subTree):n.subTree?[n.subTree.el]:[]}function Gy(n){if(!n.children)return[];const e=[];return n.children.forEach(t=>{t.component?e.push(...ac(t.component)):t?.el&&e.push(t.el)}),e}var Bp="__vue-devtools-component-inspector__",zp="__vue-devtools-component-inspector__card__",Vp="__vue-devtools-component-inspector__name__",$p="__vue-devtools-component-inspector__indicator__",Hp={display:"block",zIndex:2147483640,position:"fixed",backgroundColor:"#42b88325",border:"1px solid #42b88350",borderRadius:"5px",transition:"all 0.1s ease-in",pointerEvents:"none"},Wy={fontFamily:"Arial, Helvetica, sans-serif",padding:"5px 8px",borderRadius:"4px",textAlign:"left",position:"absolute",left:0,color:"#e9e9e9",fontSize:"14px",fontWeight:600,lineHeight:"24px",backgroundColor:"#42b883",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1)"},Ky={display:"inline-block",fontWeight:400,fontStyle:"normal",fontSize:"12px",opacity:.7};function Jr(){return document.getElementById(Bp)}function qy(){return document.getElementById(zp)}function Xy(){return document.getElementById($p)}function Yy(){return document.getElementById(Vp)}function lc(n){return{left:`${Math.round(n.left*100)/100}px`,top:`${Math.round(n.top*100)/100}px`,width:`${Math.round(n.width*100)/100}px`,height:`${Math.round(n.height*100)/100}px`}}function cc(n){var e;const t=document.createElement("div");t.id=(e=n.elementId)!=null?e:Bp,Object.assign(t.style,{...Hp,...lc(n.bounds),...n.style});const r=document.createElement("span");r.id=zp,Object.assign(r.style,{...Wy,top:n.bounds.top<35?0:"-35px"});const i=document.createElement("span");i.id=Vp,i.innerHTML=`&lt;${n.name}&gt;&nbsp;&nbsp;`;const s=document.createElement("i");return s.id=$p,s.innerHTML=`${Math.round(n.bounds.width*100)/100} x ${Math.round(n.bounds.height*100)/100}`,Object.assign(s.style,Ky),r.appendChild(i),r.appendChild(s),t.appendChild(r),document.body.appendChild(t),t}function uc(n){const e=Jr(),t=qy(),r=Yy(),i=Xy();e&&(Object.assign(e.style,{...Hp,...lc(n.bounds)}),Object.assign(t.style,{top:n.bounds.top<35?0:"-35px"}),r.innerHTML=`&lt;${n.name}&gt;&nbsp;&nbsp;`,i.innerHTML=`${Math.round(n.bounds.width*100)/100} x ${Math.round(n.bounds.height*100)/100}`)}function Zy(n){const e=tr(n);if(!e.width&&!e.height)return;const t=yo(n);Jr()?uc({bounds:e,name:t}):cc({bounds:e,name:t})}function Gp(){const n=Jr();n&&(n.style.display="none")}var pl=null;function fl(n){const e=n.target;if(e){const t=e.__vueParentComponent;if(t&&(pl=t,t.vnode.el)){const r=tr(t),i=yo(t);Jr()?uc({bounds:r,name:i}):cc({bounds:r,name:i})}}}function Qy(n,e){if(n.preventDefault(),n.stopPropagation(),pl){const t=By(pl);e(t)}}var Zs=null;function Jy(){Gp(),window.removeEventListener("mouseover",fl),window.removeEventListener("click",Zs,!0),Zs=null}function e0(){return window.addEventListener("mouseover",fl),new Promise(n=>{function e(t){t.preventDefault(),t.stopPropagation(),Qy(t,r=>{window.removeEventListener("click",e,!0),Zs=null,window.removeEventListener("mouseover",fl);const i=Jr();i&&(i.style.display="none"),n(JSON.stringify({id:r}))})}Zs=e,window.addEventListener("click",e,!0)})}function t0(n){const e=dl(Be.value,n.id);if(e){const[t]=ac(e);if(typeof t.scrollIntoView=="function")t.scrollIntoView({behavior:"smooth"});else{const r=tr(e),i=document.createElement("div"),s={...lc(r),position:"absolute"};Object.assign(i.style,s),document.body.appendChild(i),i.scrollIntoView({behavior:"smooth"}),setTimeout(()=>{document.body.removeChild(i)},2e3)}setTimeout(()=>{const r=tr(e);if(r.width||r.height){const i=yo(e),s=Jr();s?uc({...n,name:i,bounds:r}):cc({...n,name:i,bounds:r}),setTimeout(()=>{s&&(s.style.display="none")},1500)}},1200)}}k();var Su;(Su=D).__VUE_DEVTOOLS_COMPONENT_INSPECTOR_ENABLED__!=null||(Su.__VUE_DEVTOOLS_COMPONENT_INSPECTOR_ENABLED__=!0);function n0(n){let e=0;const t=setInterval(()=>{D.__VUE_INSPECTOR__&&(clearInterval(t),e+=30,n()),e>=5e3&&clearInterval(t)},30)}function r0(){const n=D.__VUE_INSPECTOR__,e=n.openInEditor;n.openInEditor=async(...t)=>{n.disable(),e(...t)}}function i0(){return new Promise(n=>{function e(){r0(),n(D.__VUE_INSPECTOR__)}D.__VUE_INSPECTOR__?e():n0(()=>{e()})})}k();k();function s0(n){return!!(n&&n.__v_isReadonly)}function Wp(n){return s0(n)?Wp(n.__v_raw):!!(n&&n.__v_isReactive)}function $o(n){return!!(n&&n.__v_isRef===!0)}function vi(n){const e=n&&n.__v_raw;return e?vi(e):n}var o0=class{constructor(){this.refEditor=new a0}set(e,t,r,i){const s=Array.isArray(t)?t:t.split(".");for(;s.length>1;){const l=s.shift();e instanceof Map?e=e.get(l):e instanceof Set?e=Array.from(e.values())[l]:e=e[l],this.refEditor.isRef(e)&&(e=this.refEditor.get(e))}const o=s[0],a=this.refEditor.get(e)[o];i?i(e,o,r):this.refEditor.isRef(a)?this.refEditor.set(a,r):e[o]=r}get(e,t){const r=Array.isArray(t)?t:t.split(".");for(let i=0;i<r.length;i++)if(e instanceof Map?e=e.get(r[i]):e=e[r[i]],this.refEditor.isRef(e)&&(e=this.refEditor.get(e)),!e)return;return e}has(e,t,r=!1){if(typeof e>"u")return!1;const i=Array.isArray(t)?t.slice():t.split("."),s=r?2:1;for(;e&&i.length>s;){const o=i.shift();e=e[o],this.refEditor.isRef(e)&&(e=this.refEditor.get(e))}return e!=null&&Object.prototype.hasOwnProperty.call(e,i[0])}createDefaultSetCallback(e){return(t,r,i)=>{if((e.remove||e.newKey)&&(Array.isArray(t)?t.splice(r,1):vi(t)instanceof Map?t.delete(r):vi(t)instanceof Set?t.delete(Array.from(t.values())[r]):Reflect.deleteProperty(t,r)),!e.remove){const s=t[e.newKey||r];this.refEditor.isRef(s)?this.refEditor.set(s,i):vi(t)instanceof Map?t.set(e.newKey||r,i):vi(t)instanceof Set?t.add(i):t[e.newKey||r]=i}}}},a0=class{set(e,t){if($o(e))e.value=t;else{if(e instanceof Set&&Array.isArray(t)){e.clear(),t.forEach(s=>e.add(s));return}const r=Object.keys(t);if(e instanceof Map){const s=new Set(e.keys());r.forEach(o=>{e.set(o,Reflect.get(t,o)),s.delete(o)}),s.forEach(o=>e.delete(o));return}const i=new Set(Object.keys(e));r.forEach(s=>{Reflect.set(e,s,Reflect.get(t,s)),i.delete(s)}),i.forEach(s=>Reflect.deleteProperty(e,s))}}get(e){return $o(e)?e.value:e}isRef(e){return $o(e)||Wp(e)}};k();k();k();var l0="__VUE_DEVTOOLS_KIT_TIMELINE_LAYERS_STATE__";function c0(){if(!Ip||typeof localStorage>"u"||localStorage===null)return{recordingState:!1,mouseEventEnabled:!1,keyboardEventEnabled:!1,componentEventEnabled:!1,performanceEventEnabled:!1,selected:""};const n=localStorage.getItem(l0);return n?JSON.parse(n):{recordingState:!1,mouseEventEnabled:!1,keyboardEventEnabled:!1,componentEventEnabled:!1,performanceEventEnabled:!1,selected:""}}k();k();k();var Cu;(Cu=D).__VUE_DEVTOOLS_KIT_TIMELINE_LAYERS!=null||(Cu.__VUE_DEVTOOLS_KIT_TIMELINE_LAYERS=[]);var u0=new Proxy(D.__VUE_DEVTOOLS_KIT_TIMELINE_LAYERS,{get(n,e,t){return Reflect.get(n,e,t)}});function h0(n,e){we.timelineLayersState[e.id]=!1,u0.push({...n,descriptorId:e.id,appRecord:oc(e.app)})}var Ru;(Ru=D).__VUE_DEVTOOLS_KIT_INSPECTOR__!=null||(Ru.__VUE_DEVTOOLS_KIT_INSPECTOR__=[]);var hc=new Proxy(D.__VUE_DEVTOOLS_KIT_INSPECTOR__,{get(n,e,t){return Reflect.get(n,e,t)}}),Kp=Dr(()=>{ei.hooks.callHook("sendInspectorToClient",qp())});function d0(n,e){var t,r;hc.push({options:n,descriptor:e,treeFilterPlaceholder:(t=n.treeFilterPlaceholder)!=null?t:"Search tree...",stateFilterPlaceholder:(r=n.stateFilterPlaceholder)!=null?r:"Search state...",treeFilter:"",selectedNodeId:"",appRecord:oc(e.app)}),Kp()}function qp(){return hc.filter(n=>n.descriptor.app===Be.value.app).filter(n=>n.descriptor.id!=="components").map(n=>{var e;const t=n.descriptor,r=n.options;return{id:r.id,label:r.label,logo:t.logo,icon:`custom-ic-baseline-${(e=r?.icon)==null?void 0:e.replace(/_/g,"-")}`,packageName:t.packageName,homepage:t.homepage,pluginId:t.id}})}function js(n,e){return hc.find(t=>t.options.id===n&&(e?t.descriptor.app===e:!0))}function p0(){const n=Np();n.hook("addInspector",({inspector:r,plugin:i})=>{d0(r,i.descriptor)});const e=Dr(async({inspectorId:r,plugin:i})=>{var s;if(!r||!((s=i?.descriptor)!=null&&s.app)||we.highPerfModeEnabled)return;const o=js(r,i.descriptor.app),a={app:i.descriptor.app,inspectorId:r,filter:o?.treeFilter||"",rootNodes:[]};await new Promise(l=>{n.callHookWith(async c=>{await Promise.all(c.map(u=>u(a))),l()},"getInspectorTree")}),n.callHookWith(async l=>{await Promise.all(l.map(c=>c({inspectorId:r,rootNodes:a.rootNodes})))},"sendInspectorTreeToClient")},120);n.hook("sendInspectorTree",e);const t=Dr(async({inspectorId:r,plugin:i})=>{var s;if(!r||!((s=i?.descriptor)!=null&&s.app)||we.highPerfModeEnabled)return;const o=js(r,i.descriptor.app),a={app:i.descriptor.app,inspectorId:r,nodeId:o?.selectedNodeId||"",state:null},l={currentTab:`custom-inspector:${r}`};a.nodeId&&await new Promise(c=>{n.callHookWith(async u=>{await Promise.all(u.map(h=>h(a,l))),c()},"getInspectorState")}),n.callHookWith(async c=>{await Promise.all(c.map(u=>u({inspectorId:r,nodeId:a.nodeId,state:a.state})))},"sendInspectorStateToClient")},120);return n.hook("sendInspectorState",t),n.hook("customInspectorSelectNode",({inspectorId:r,nodeId:i,plugin:s})=>{const o=js(r,s.descriptor.app);o&&(o.selectedNodeId=i)}),n.hook("timelineLayerAdded",({options:r,plugin:i})=>{h0(r,i.descriptor)}),n.hook("timelineEventAdded",({options:r,plugin:i})=>{var s;const o=["performance","component-event","keyboard","mouse"];we.highPerfModeEnabled||!((s=we.timelineLayersState)!=null&&s[i.descriptor.id])&&!o.includes(r.layerId)||n.callHookWith(async a=>{await Promise.all(a.map(l=>l(r)))},"sendTimelineEventToClient")}),n.hook("getComponentInstances",async({app:r})=>{const i=r.__VUE_DEVTOOLS_NEXT_APP_RECORD__;if(!i)return null;const s=i.id.toString();return[...i.instanceMap].filter(([o])=>o.split(":")[0]===s).map(([,o])=>o)}),n.hook("getComponentBounds",async({instance:r})=>tr(r)),n.hook("getComponentName",({instance:r})=>yo(r)),n.hook("componentHighlight",({uid:r})=>{const i=Be.value.instanceMap.get(r);i&&Zy(i)}),n.hook("componentUnhighlight",()=>{Gp()}),n}var Ou;(Ou=D).__VUE_DEVTOOLS_KIT_APP_RECORDS__!=null||(Ou.__VUE_DEVTOOLS_KIT_APP_RECORDS__=[]);var ku;(ku=D).__VUE_DEVTOOLS_KIT_ACTIVE_APP_RECORD__!=null||(ku.__VUE_DEVTOOLS_KIT_ACTIVE_APP_RECORD__={});var Lu;(Lu=D).__VUE_DEVTOOLS_KIT_ACTIVE_APP_RECORD_ID__!=null||(Lu.__VUE_DEVTOOLS_KIT_ACTIVE_APP_RECORD_ID__="");var Iu;(Iu=D).__VUE_DEVTOOLS_KIT_CUSTOM_TABS__!=null||(Iu.__VUE_DEVTOOLS_KIT_CUSTOM_TABS__=[]);var Du;(Du=D).__VUE_DEVTOOLS_KIT_CUSTOM_COMMANDS__!=null||(Du.__VUE_DEVTOOLS_KIT_CUSTOM_COMMANDS__=[]);var Kn="__VUE_DEVTOOLS_KIT_GLOBAL_STATE__";function f0(){return{connected:!1,clientConnected:!1,vitePluginDetected:!0,appRecords:[],activeAppRecordId:"",tabs:[],commands:[],highPerfModeEnabled:!0,devtoolsClientDetected:{},perfUniqueGroupId:0,timelineLayersState:c0()}}var Nu;(Nu=D)[Kn]!=null||(Nu[Kn]=f0());var m0=Dr(n=>{ei.hooks.callHook("devtoolsStateUpdated",{state:n})});Dr((n,e)=>{ei.hooks.callHook("devtoolsConnectedUpdated",{state:n,oldState:e})});var bo=new Proxy(D.__VUE_DEVTOOLS_KIT_APP_RECORDS__,{get(n,e,t){return e==="value"?D.__VUE_DEVTOOLS_KIT_APP_RECORDS__:D.__VUE_DEVTOOLS_KIT_APP_RECORDS__[e]}}),Be=new Proxy(D.__VUE_DEVTOOLS_KIT_ACTIVE_APP_RECORD__,{get(n,e,t){return e==="value"?D.__VUE_DEVTOOLS_KIT_ACTIVE_APP_RECORD__:e==="id"?D.__VUE_DEVTOOLS_KIT_ACTIVE_APP_RECORD_ID__:D.__VUE_DEVTOOLS_KIT_ACTIVE_APP_RECORD__[e]}});function Xp(){m0({...D[Kn],appRecords:bo.value,activeAppRecordId:Be.id,tabs:D.__VUE_DEVTOOLS_KIT_CUSTOM_TABS__,commands:D.__VUE_DEVTOOLS_KIT_CUSTOM_COMMANDS__})}function g0(n){D.__VUE_DEVTOOLS_KIT_ACTIVE_APP_RECORD__=n,Xp()}function _0(n){D.__VUE_DEVTOOLS_KIT_ACTIVE_APP_RECORD_ID__=n,Xp()}var we=new Proxy(D[Kn],{get(n,e){return e==="appRecords"?bo:e==="activeAppRecordId"?Be.id:e==="tabs"?D.__VUE_DEVTOOLS_KIT_CUSTOM_TABS__:e==="commands"?D.__VUE_DEVTOOLS_KIT_CUSTOM_COMMANDS__:D[Kn][e]},deleteProperty(n,e){return delete n[e],!0},set(n,e,t){return{...D[Kn]},n[e]=t,D[Kn][e]=t,!0}});function v0(n={}){var e,t,r;const{file:i,host:s,baseUrl:o=window.location.origin,line:a=0,column:l=0}=n;if(i){if(s==="chrome-extension"){const c=i.replace(/\\/g,"\\\\"),u=(t=(e=window.VUE_DEVTOOLS_CONFIG)==null?void 0:e.openInEditorHost)!=null?t:"/";fetch(`${u}__open-in-editor?file=${encodeURI(i)}`).then(h=>{if(!h.ok){const d=`Opening component ${c} failed`;console.log(`%c${d}`,"color:red")}})}else if(we.vitePluginDetected){const c=(r=D.__VUE_DEVTOOLS_OPEN_IN_EDITOR_BASE_URL__)!=null?r:o;D.__VUE_INSPECTOR__.openInEditor(c,i,a,l)}}}k();k();k();k();k();var Fu;(Fu=D).__VUE_DEVTOOLS_KIT_PLUGIN_BUFFER__!=null||(Fu.__VUE_DEVTOOLS_KIT_PLUGIN_BUFFER__=[]);var dc=new Proxy(D.__VUE_DEVTOOLS_KIT_PLUGIN_BUFFER__,{get(n,e,t){return Reflect.get(n,e,t)}});function ml(n){const e={};return Object.keys(n).forEach(t=>{e[t]=n[t].defaultValue}),e}function pc(n){return`__VUE_DEVTOOLS_NEXT_PLUGIN_SETTINGS__${n}__`}function y0(n){var e,t,r;return(r=((t=(e=dc.find(s=>{var o;return s[0].id===n&&!!((o=s[0])!=null&&o.settings)}))==null?void 0:e[0])!=null?t:null)?.settings)!=null?r:null}function Yp(n,e){var t,r,i;const s=pc(n);if(s){const o=localStorage.getItem(s);if(o)return JSON.parse(o)}if(n){const o=(r=(t=dc.find(a=>a[0].id===n))==null?void 0:t[0])!=null?r:null;return ml((i=o?.settings)!=null?i:{})}return ml(e)}function b0(n,e){const t=pc(n);localStorage.getItem(t)||localStorage.setItem(t,JSON.stringify(ml(e)))}function w0(n,e,t){const r=pc(n),i=localStorage.getItem(r),s=JSON.parse(i||"{}"),o={...s,[e]:t};localStorage.setItem(r,JSON.stringify(o)),ei.hooks.callHookWith(a=>{a.forEach(l=>l({pluginId:n,key:e,oldValue:s[e],newValue:t,settings:o}))},"setPluginSettings")}k();k();k();k();k();k();k();k();k();k();k();var Uu,ju,it=(ju=(Uu=D).__VUE_DEVTOOLS_HOOK)!=null?ju:Uu.__VUE_DEVTOOLS_HOOK=Np(),T0={vueAppInit(n){it.hook("app:init",n)},vueAppUnmount(n){it.hook("app:unmount",n)},vueAppConnected(n){it.hook("app:connected",n)},componentAdded(n){return it.hook("component:added",n)},componentEmit(n){return it.hook("component:emit",n)},componentUpdated(n){return it.hook("component:updated",n)},componentRemoved(n){return it.hook("component:removed",n)},setupDevtoolsPlugin(n){it.hook("devtools-plugin:setup",n)},perfStart(n){return it.hook("perf:start",n)},perfEnd(n){return it.hook("perf:end",n)}},Zp={on:T0,setupDevToolsPlugin(n,e){return it.callHook("devtools-plugin:setup",n,e)}},x0=class{constructor({plugin:e,ctx:t}){this.hooks=t.hooks,this.plugin=e}get on(){return{visitComponentTree:e=>{this.hooks.hook("visitComponentTree",e)},inspectComponent:e=>{this.hooks.hook("inspectComponent",e)},editComponentState:e=>{this.hooks.hook("editComponentState",e)},getInspectorTree:e=>{this.hooks.hook("getInspectorTree",e)},getInspectorState:e=>{this.hooks.hook("getInspectorState",e)},editInspectorState:e=>{this.hooks.hook("editInspectorState",e)},inspectTimelineEvent:e=>{this.hooks.hook("inspectTimelineEvent",e)},timelineCleared:e=>{this.hooks.hook("timelineCleared",e)},setPluginSettings:e=>{this.hooks.hook("setPluginSettings",e)}}}notifyComponentUpdate(e){var t;if(we.highPerfModeEnabled)return;const r=qp().find(i=>i.packageName===this.plugin.descriptor.packageName);if(r?.id){if(e){const i=[e.appContext.app,e.uid,(t=e.parent)==null?void 0:t.uid,e];it.callHook("component:updated",...i)}else it.callHook("component:updated");this.hooks.callHook("sendInspectorState",{inspectorId:r.id,plugin:this.plugin})}}addInspector(e){this.hooks.callHook("addInspector",{inspector:e,plugin:this.plugin}),this.plugin.descriptor.settings&&b0(e.id,this.plugin.descriptor.settings)}sendInspectorTree(e){we.highPerfModeEnabled||this.hooks.callHook("sendInspectorTree",{inspectorId:e,plugin:this.plugin})}sendInspectorState(e){we.highPerfModeEnabled||this.hooks.callHook("sendInspectorState",{inspectorId:e,plugin:this.plugin})}selectInspectorNode(e,t){this.hooks.callHook("customInspectorSelectNode",{inspectorId:e,nodeId:t,plugin:this.plugin})}visitComponentTree(e){return this.hooks.callHook("visitComponentTree",e)}now(){return we.highPerfModeEnabled?0:Date.now()}addTimelineLayer(e){this.hooks.callHook("timelineLayerAdded",{options:e,plugin:this.plugin})}addTimelineEvent(e){we.highPerfModeEnabled||this.hooks.callHook("timelineEventAdded",{options:e,plugin:this.plugin})}getSettings(e){return Yp(e??this.plugin.descriptor.id,this.plugin.descriptor.settings)}getComponentInstances(e){return this.hooks.callHook("getComponentInstances",{app:e})}getComponentBounds(e){return this.hooks.callHook("getComponentBounds",{instance:e})}getComponentName(e){return this.hooks.callHook("getComponentName",{instance:e})}highlightElement(e){const t=e.__VUE_DEVTOOLS_NEXT_UID__;return this.hooks.callHook("componentHighlight",{uid:t})}unhighlightElement(){return this.hooks.callHook("componentUnhighlight")}},E0=x0;k();k();k();k();var A0="__vue_devtool_undefined__",P0="__vue_devtool_infinity__",M0="__vue_devtool_negative_infinity__",S0="__vue_devtool_nan__";k();k();var C0={[A0]:"undefined",[S0]:"NaN",[P0]:"Infinity",[M0]:"-Infinity"};Object.entries(C0).reduce((n,[e,t])=>(n[t]=e,n),{});k();k();k();k();k();var Bu;(Bu=D).__VUE_DEVTOOLS_KIT__REGISTERED_PLUGIN_APPS__!=null||(Bu.__VUE_DEVTOOLS_KIT__REGISTERED_PLUGIN_APPS__=new Set);function R0(n,e){return Zp.setupDevToolsPlugin(n,e)}function O0(n,e){const[t,r]=n;if(t.app!==e)return;const i=new E0({plugin:{setupFn:r,descriptor:t},ctx:ei});t.packageName==="vuex"&&i.on.editInspectorState(s=>{i.sendInspectorState(s.inspectorId)}),r(i)}function Qp(n,e){D.__VUE_DEVTOOLS_KIT__REGISTERED_PLUGIN_APPS__.has(n)||we.highPerfModeEnabled&&!e?.inspectingComponent||(D.__VUE_DEVTOOLS_KIT__REGISTERED_PLUGIN_APPS__.add(n),dc.forEach(t=>{O0(t,n)}))}k();k();var ki="__VUE_DEVTOOLS_ROUTER__",Nr="__VUE_DEVTOOLS_ROUTER_INFO__",zu;(zu=D)[Nr]!=null||(zu[Nr]={currentRoute:null,routes:[]});var Vu;(Vu=D)[ki]!=null||(Vu[ki]={});new Proxy(D[Nr],{get(n,e){return D[Nr][e]}});new Proxy(D[ki],{get(n,e){if(e==="value")return D[ki]}});function k0(n){const e=new Map;return(n?.getRoutes()||[]).filter(t=>!e.has(t.path)&&e.set(t.path,1))}function fc(n){return n.map(e=>{let{path:t,name:r,children:i,meta:s}=e;return i?.length&&(i=fc(i)),{path:t,name:r,children:i,meta:s}})}function L0(n){if(n){const{fullPath:e,hash:t,href:r,path:i,name:s,matched:o,params:a,query:l}=n;return{fullPath:e,hash:t,href:r,path:i,name:s,params:a,query:l,matched:fc(o)}}return n}function I0(n,e){function t(){var r;const i=(r=n.app)==null?void 0:r.config.globalProperties.$router,s=L0(i?.currentRoute.value),o=fc(k0(i)),a=console.warn;console.warn=()=>{},D[Nr]={currentRoute:s?Au(s):{},routes:Au(o)},D[ki]=i,console.warn=a}t(),Zp.on.componentUpdated(Dr(()=>{var r;((r=e.value)==null?void 0:r.app)===n.app&&(t(),!we.highPerfModeEnabled&&ei.hooks.callHook("routerInfoUpdated",{state:D[Nr]}))},200))}function D0(n){return{async getInspectorTree(e){const t={...e,app:Be.value.app,rootNodes:[]};return await new Promise(r=>{n.callHookWith(async i=>{await Promise.all(i.map(s=>s(t))),r()},"getInspectorTree")}),t.rootNodes},async getInspectorState(e){const t={...e,app:Be.value.app,state:null},r={currentTab:`custom-inspector:${e.inspectorId}`};return await new Promise(i=>{n.callHookWith(async s=>{await Promise.all(s.map(o=>o(t,r))),i()},"getInspectorState")}),t.state},editInspectorState(e){const t=new o0,r={...e,app:Be.value.app,set:(i,s=e.path,o=e.state.value,a)=>{t.set(i,s,o,a||t.createDefaultSetCallback(e.state))}};n.callHookWith(i=>{i.forEach(s=>s(r))},"editInspectorState")},sendInspectorState(e){const t=js(e);n.callHook("sendInspectorState",{inspectorId:e,plugin:{descriptor:t.descriptor,setupFn:()=>({})}})},inspectComponentInspector(){return e0()},cancelInspectComponentInspector(){return Jy()},getComponentRenderCode(e){const t=dl(Be.value,e);if(t)return typeof t?.type!="function"?t.render.toString():t.type.toString()},scrollToComponent(e){return t0({id:e})},openInEditor:v0,getVueInspector:i0,toggleApp(e,t){const r=bo.value.find(i=>i.id===e);r&&(_0(e),g0(r),I0(r,Be),Kp(),Qp(r.app,t))},inspectDOM(e){const t=dl(Be.value,e);if(t){const[r]=ac(t);r&&(D.__VUE_DEVTOOLS_INSPECT_DOM_TARGET__=r)}},updatePluginSettings(e,t,r){w0(e,t,r)},getPluginSettings(e){return{options:y0(e),values:Yp(e)}}}}k();var $u;($u=D).__VUE_DEVTOOLS_ENV__!=null||($u.__VUE_DEVTOOLS_ENV__={vitePluginDetected:!1});var Hu=p0(),Gu;(Gu=D).__VUE_DEVTOOLS_KIT_CONTEXT__!=null||(Gu.__VUE_DEVTOOLS_KIT_CONTEXT__={hooks:Hu,get state(){return{...we,activeAppRecordId:Be.id,activeAppRecord:Be.value,appRecords:bo.value}},api:D0(Hu)});var ei=D.__VUE_DEVTOOLS_KIT_CONTEXT__;k();Dy(Fy());var Wu;(Wu=D).__VUE_DEVTOOLS_NEXT_APP_RECORD_INFO__!=null||(Wu.__VUE_DEVTOOLS_NEXT_APP_RECORD_INFO__={id:0,appIds:new Set});k();k();function N0(n){we.highPerfModeEnabled=n??!we.highPerfModeEnabled,!n&&Be.value&&Qp(Be.value.app)}k();k();k();function F0(n){we.devtoolsClientDetected={...we.devtoolsClientDetected,...n};const e=Object.values(we.devtoolsClientDetected).some(Boolean);N0(!e)}var Ku;(Ku=D).__VUE_DEVTOOLS_UPDATE_CLIENT_DETECTED__!=null||(Ku.__VUE_DEVTOOLS_UPDATE_CLIENT_DETECTED__=F0);k();k();k();k();k();k();k();var U0=class{constructor(){this.keyToValue=new Map,this.valueToKey=new Map}set(e,t){this.keyToValue.set(e,t),this.valueToKey.set(t,e)}getByKey(e){return this.keyToValue.get(e)}getByValue(e){return this.valueToKey.get(e)}clear(){this.keyToValue.clear(),this.valueToKey.clear()}},Jp=class{constructor(e){this.generateIdentifier=e,this.kv=new U0}register(e,t){this.kv.getByValue(e)||(t||(t=this.generateIdentifier(e)),this.kv.set(t,e))}clear(){this.kv.clear()}getIdentifier(e){return this.kv.getByValue(e)}getValue(e){return this.kv.getByKey(e)}},j0=class extends Jp{constructor(){super(e=>e.name),this.classToAllowedProps=new Map}register(e,t){typeof t=="object"?(t.allowProps&&this.classToAllowedProps.set(e,t.allowProps),super.register(e,t.identifier)):super.register(e,t)}getAllowedProps(e){return this.classToAllowedProps.get(e)}};k();k();function B0(n){if("values"in Object)return Object.values(n);const e=[];for(const t in n)n.hasOwnProperty(t)&&e.push(n[t]);return e}function z0(n,e){const t=B0(n);if("find"in t)return t.find(e);const r=t;for(let i=0;i<r.length;i++){const s=r[i];if(e(s))return s}}function Fr(n,e){Object.entries(n).forEach(([t,r])=>e(r,t))}function Bs(n,e){return n.indexOf(e)!==-1}function qu(n,e){for(let t=0;t<n.length;t++){const r=n[t];if(e(r))return r}}var V0=class{constructor(){this.transfomers={}}register(e){this.transfomers[e.name]=e}findApplicable(e){return z0(this.transfomers,t=>t.isApplicable(e))}findByName(e){return this.transfomers[e]}};k();k();var $0=n=>Object.prototype.toString.call(n).slice(8,-1),ef=n=>typeof n>"u",H0=n=>n===null,Li=n=>typeof n!="object"||n===null||n===Object.prototype?!1:Object.getPrototypeOf(n)===null?!0:Object.getPrototypeOf(n)===Object.prototype,gl=n=>Li(n)&&Object.keys(n).length===0,Sn=n=>Array.isArray(n),G0=n=>typeof n=="string",W0=n=>typeof n=="number"&&!isNaN(n),K0=n=>typeof n=="boolean",q0=n=>n instanceof RegExp,Ii=n=>n instanceof Map,Di=n=>n instanceof Set,tf=n=>$0(n)==="Symbol",X0=n=>n instanceof Date&&!isNaN(n.valueOf()),Y0=n=>n instanceof Error,Xu=n=>typeof n=="number"&&isNaN(n),Z0=n=>K0(n)||H0(n)||ef(n)||W0(n)||G0(n)||tf(n),Q0=n=>typeof n=="bigint",J0=n=>n===1/0||n===-1/0,eb=n=>ArrayBuffer.isView(n)&&!(n instanceof DataView),tb=n=>n instanceof URL;k();var nf=n=>n.replace(/\./g,"\\."),Ho=n=>n.map(String).map(nf).join("."),Ai=n=>{const e=[];let t="";for(let i=0;i<n.length;i++){let s=n.charAt(i);if(s==="\\"&&n.charAt(i+1)==="."){t+=".",i++;continue}if(s==="."){e.push(t),t="";continue}t+=s}const r=t;return e.push(r),e};k();function Ot(n,e,t,r){return{isApplicable:n,annotation:e,transform:t,untransform:r}}var rf=[Ot(ef,"undefined",()=>null,()=>{}),Ot(Q0,"bigint",n=>n.toString(),n=>typeof BigInt<"u"?BigInt(n):(console.error("Please add a BigInt polyfill."),n)),Ot(X0,"Date",n=>n.toISOString(),n=>new Date(n)),Ot(Y0,"Error",(n,e)=>{const t={name:n.name,message:n.message};return e.allowedErrorProps.forEach(r=>{t[r]=n[r]}),t},(n,e)=>{const t=new Error(n.message);return t.name=n.name,t.stack=n.stack,e.allowedErrorProps.forEach(r=>{t[r]=n[r]}),t}),Ot(q0,"regexp",n=>""+n,n=>{const e=n.slice(1,n.lastIndexOf("/")),t=n.slice(n.lastIndexOf("/")+1);return new RegExp(e,t)}),Ot(Di,"set",n=>[...n.values()],n=>new Set(n)),Ot(Ii,"map",n=>[...n.entries()],n=>new Map(n)),Ot(n=>Xu(n)||J0(n),"number",n=>Xu(n)?"NaN":n>0?"Infinity":"-Infinity",Number),Ot(n=>n===0&&1/n===-1/0,"number",()=>"-0",Number),Ot(tb,"URL",n=>n.toString(),n=>new URL(n))];function wo(n,e,t,r){return{isApplicable:n,annotation:e,transform:t,untransform:r}}var sf=wo((n,e)=>tf(n)?!!e.symbolRegistry.getIdentifier(n):!1,(n,e)=>["symbol",e.symbolRegistry.getIdentifier(n)],n=>n.description,(n,e,t)=>{const r=t.symbolRegistry.getValue(e[1]);if(!r)throw new Error("Trying to deserialize unknown symbol");return r}),nb=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,Uint8ClampedArray].reduce((n,e)=>(n[e.name]=e,n),{}),of=wo(eb,n=>["typed-array",n.constructor.name],n=>[...n],(n,e)=>{const t=nb[e[1]];if(!t)throw new Error("Trying to deserialize unknown typed array");return new t(n)});function af(n,e){return n?.constructor?!!e.classRegistry.getIdentifier(n.constructor):!1}var lf=wo(af,(n,e)=>["class",e.classRegistry.getIdentifier(n.constructor)],(n,e)=>{const t=e.classRegistry.getAllowedProps(n.constructor);if(!t)return{...n};const r={};return t.forEach(i=>{r[i]=n[i]}),r},(n,e,t)=>{const r=t.classRegistry.getValue(e[1]);if(!r)throw new Error(`Trying to deserialize unknown class '${e[1]}' - check https://github.com/blitz-js/superjson/issues/116#issuecomment-773996564`);return Object.assign(Object.create(r.prototype),n)}),cf=wo((n,e)=>!!e.customTransformerRegistry.findApplicable(n),(n,e)=>["custom",e.customTransformerRegistry.findApplicable(n).name],(n,e)=>e.customTransformerRegistry.findApplicable(n).serialize(n),(n,e,t)=>{const r=t.customTransformerRegistry.findByName(e[1]);if(!r)throw new Error("Trying to deserialize unknown custom value");return r.deserialize(n)}),rb=[lf,sf,cf,of],Yu=(n,e)=>{const t=qu(rb,i=>i.isApplicable(n,e));if(t)return{value:t.transform(n,e),type:t.annotation(n,e)};const r=qu(rf,i=>i.isApplicable(n,e));if(r)return{value:r.transform(n,e),type:r.annotation}},uf={};rf.forEach(n=>{uf[n.annotation]=n});var ib=(n,e,t)=>{if(Sn(e))switch(e[0]){case"symbol":return sf.untransform(n,e,t);case"class":return lf.untransform(n,e,t);case"custom":return cf.untransform(n,e,t);case"typed-array":return of.untransform(n,e,t);default:throw new Error("Unknown transformation: "+e)}else{const r=uf[e];if(!r)throw new Error("Unknown transformation: "+e);return r.untransform(n,t)}};k();var _r=(n,e)=>{if(e>n.size)throw new Error("index out of bounds");const t=n.keys();for(;e>0;)t.next(),e--;return t.next().value};function hf(n){if(Bs(n,"__proto__"))throw new Error("__proto__ is not allowed as a property");if(Bs(n,"prototype"))throw new Error("prototype is not allowed as a property");if(Bs(n,"constructor"))throw new Error("constructor is not allowed as a property")}var sb=(n,e)=>{hf(e);for(let t=0;t<e.length;t++){const r=e[t];if(Di(n))n=_r(n,+r);else if(Ii(n)){const i=+r,s=+e[++t]==0?"key":"value",o=_r(n,i);switch(s){case"key":n=o;break;case"value":n=n.get(o);break}}else n=n[r]}return n},_l=(n,e,t)=>{if(hf(e),e.length===0)return t(n);let r=n;for(let s=0;s<e.length-1;s++){const o=e[s];if(Sn(r)){const a=+o;r=r[a]}else if(Li(r))r=r[o];else if(Di(r)){const a=+o;r=_r(r,a)}else if(Ii(r)){if(s===e.length-2)break;const a=+o,l=+e[++s]==0?"key":"value",c=_r(r,a);switch(l){case"key":r=c;break;case"value":r=r.get(c);break}}}const i=e[e.length-1];if(Sn(r)?r[+i]=t(r[+i]):Li(r)&&(r[i]=t(r[i])),Di(r)){const s=_r(r,+i),o=t(s);s!==o&&(r.delete(s),r.add(o))}if(Ii(r)){const s=+e[e.length-2],o=_r(r,s);switch(+i==0?"key":"value"){case"key":{const a=t(o);r.set(a,r.get(o)),a!==o&&r.delete(o);break}case"value":{r.set(o,t(r.get(o)));break}}}return n};function vl(n,e,t=[]){if(!n)return;if(!Sn(n)){Fr(n,(s,o)=>vl(s,e,[...t,...Ai(o)]));return}const[r,i]=n;i&&Fr(i,(s,o)=>{vl(s,e,[...t,...Ai(o)])}),e(r,t)}function ob(n,e,t){return vl(e,(r,i)=>{n=_l(n,i,s=>ib(s,r,t))}),n}function ab(n,e){function t(r,i){const s=sb(n,Ai(i));r.map(Ai).forEach(o=>{n=_l(n,o,()=>s)})}if(Sn(e)){const[r,i]=e;r.forEach(s=>{n=_l(n,Ai(s),()=>n)}),i&&Fr(i,t)}else Fr(e,t);return n}var lb=(n,e)=>Li(n)||Sn(n)||Ii(n)||Di(n)||af(n,e);function cb(n,e,t){const r=t.get(n);r?r.push(e):t.set(n,[e])}function ub(n,e){const t={};let r;return n.forEach(i=>{if(i.length<=1)return;e||(i=i.map(a=>a.map(String)).sort((a,l)=>a.length-l.length));const[s,...o]=i;s.length===0?r=o.map(Ho):t[Ho(s)]=o.map(Ho)}),r?gl(t)?[r]:[r,t]:gl(t)?void 0:t}var df=(n,e,t,r,i=[],s=[],o=new Map)=>{var a;const l=Z0(n);if(!l){cb(n,i,e);const p=o.get(n);if(p)return r?{transformedValue:null}:p}if(!lb(n,t)){const p=Yu(n,t),m=p?{transformedValue:p.value,annotations:[p.type]}:{transformedValue:n};return l||o.set(n,m),m}if(Bs(s,n))return{transformedValue:null};const c=Yu(n,t),u=(a=c?.value)!=null?a:n,h=Sn(u)?[]:{},d={};Fr(u,(p,m)=>{if(m==="__proto__"||m==="constructor"||m==="prototype")throw new Error(`Detected property ${m}. This is a prototype pollution risk, please remove it from your object.`);const g=df(p,e,t,r,[...i,m],[...s,n],o);h[m]=g.transformedValue,Sn(g.annotations)?d[m]=g.annotations:Li(g.annotations)&&Fr(g.annotations,(_,v)=>{d[nf(m)+"."+v]=_})});const f=gl(d)?{transformedValue:h,annotations:c?[c.type]:void 0}:{transformedValue:h,annotations:c?[c.type,d]:d};return l||o.set(n,f),f};k();k();function pf(n){return Object.prototype.toString.call(n).slice(8,-1)}function Zu(n){return pf(n)==="Array"}function hb(n){if(pf(n)!=="Object")return!1;const e=Object.getPrototypeOf(n);return!!e&&e.constructor===Object&&e===Object.prototype}function db(n,e,t,r,i){const s={}.propertyIsEnumerable.call(r,e)?"enumerable":"nonenumerable";s==="enumerable"&&(n[e]=t),i&&s==="nonenumerable"&&Object.defineProperty(n,e,{value:t,enumerable:!1,writable:!0,configurable:!0})}function yl(n,e={}){if(Zu(n))return n.map(i=>yl(i,e));if(!hb(n))return n;const t=Object.getOwnPropertyNames(n),r=Object.getOwnPropertySymbols(n);return[...t,...r].reduce((i,s)=>{if(Zu(e.props)&&!e.props.includes(s))return i;const o=n[s],a=yl(o,e);return db(i,s,a,n,e.nonenumerable),i},{})}var oe=class{constructor({dedupe:n=!1}={}){this.classRegistry=new j0,this.symbolRegistry=new Jp(e=>{var t;return(t=e.description)!=null?t:""}),this.customTransformerRegistry=new V0,this.allowedErrorProps=[],this.dedupe=n}serialize(n){const e=new Map,t=df(n,e,this,this.dedupe),r={json:t.transformedValue};t.annotations&&(r.meta={...r.meta,values:t.annotations});const i=ub(e,this.dedupe);return i&&(r.meta={...r.meta,referentialEqualities:i}),r}deserialize(n){const{json:e,meta:t}=n;let r=yl(e);return t?.values&&(r=ob(r,t.values,this)),t?.referentialEqualities&&(r=ab(r,t.referentialEqualities)),r}stringify(n){return JSON.stringify(this.serialize(n))}parse(n){return this.deserialize(JSON.parse(n))}registerClass(n,e){this.classRegistry.register(n,e)}registerSymbol(n,e){this.symbolRegistry.register(n,e)}registerCustom(n,e){this.customTransformerRegistry.register({name:e,...n})}allowErrorProps(...n){this.allowedErrorProps.push(...n)}};oe.defaultInstance=new oe;oe.serialize=oe.defaultInstance.serialize.bind(oe.defaultInstance);oe.deserialize=oe.defaultInstance.deserialize.bind(oe.defaultInstance);oe.stringify=oe.defaultInstance.stringify.bind(oe.defaultInstance);oe.parse=oe.defaultInstance.parse.bind(oe.defaultInstance);oe.registerClass=oe.defaultInstance.registerClass.bind(oe.defaultInstance);oe.registerSymbol=oe.defaultInstance.registerSymbol.bind(oe.defaultInstance);oe.registerCustom=oe.defaultInstance.registerCustom.bind(oe.defaultInstance);oe.allowErrorProps=oe.defaultInstance.allowErrorProps.bind(oe.defaultInstance);k();k();k();k();k();k();k();k();k();k();k();k();k();k();k();k();k();k();k();k();k();k();k();var Qu;(Qu=D).__VUE_DEVTOOLS_KIT_MESSAGE_CHANNELS__!=null||(Qu.__VUE_DEVTOOLS_KIT_MESSAGE_CHANNELS__=[]);var Ju;(Ju=D).__VUE_DEVTOOLS_KIT_RPC_CLIENT__!=null||(Ju.__VUE_DEVTOOLS_KIT_RPC_CLIENT__=null);var eh;(eh=D).__VUE_DEVTOOLS_KIT_RPC_SERVER__!=null||(eh.__VUE_DEVTOOLS_KIT_RPC_SERVER__=null);var th;(th=D).__VUE_DEVTOOLS_KIT_VITE_RPC_CLIENT__!=null||(th.__VUE_DEVTOOLS_KIT_VITE_RPC_CLIENT__=null);var nh;(nh=D).__VUE_DEVTOOLS_KIT_VITE_RPC_SERVER__!=null||(nh.__VUE_DEVTOOLS_KIT_VITE_RPC_SERVER__=null);var rh;(rh=D).__VUE_DEVTOOLS_KIT_BROADCAST_RPC_SERVER__!=null||(rh.__VUE_DEVTOOLS_KIT_BROADCAST_RPC_SERVER__=null);k();k();k();k();k();k();k();function pb(n,e){const t=`▲ ■ ●${n}`;typeof ih=="function"?ih(t,e):console.log(t)}function ih(n,e){throw new Error(n+e)}function mc(n){let e=0;return n.traverse(t=>{if(gp(t)&&t.type!=="HightlightMesh"){const r=t.geometry,i=r.attributes.position.count*3*Float32Array.BYTES_PER_ELEMENT,s=r.index?r.index.count*Uint32Array.BYTES_PER_ELEMENT:0,o=r.attributes.normal?r.attributes.normal.count*3*Float32Array.BYTES_PER_ELEMENT:0,a=r.attributes.uv?r.attributes.uv.count*2*Float32Array.BYTES_PER_ELEMENT:0,l=i+s+o+a;e+=l}}),e}function sh(n,e,t){n.push(e),n.length>t&&n.shift()}function fb(n){return(n/1024).toFixed(2)}function mb(n){if(!n)return;typeof window<"u"&&!window.__TRES__DEVTOOLS__&&(window.__TRES__DEVTOOLS__=new ay);const e={maxFrames:160,fps:{value:0,accumulator:[]},memory:{currentMem:0,allocatedMem:0,accumulator:[]}},t=100,r=l_({every:t}),{isSupported:i,memory:s}=c_({interval:t}),o=160;let a=performance.now(),l=0;const c=1,u=({timestamp:d})=>{n.scene.value&&(e.memory.allocatedMem=mc(n.scene.value)),d-a>=t&&(a=d,sh(e.fps.accumulator,r.value,o),e.fps.value=r.value,i.value&&s.value?.usedJSHeapSize&&(sh(e.memory.accumulator,s.value.usedJSHeapSize/1024/1024,o),e.memory.accumulator.length>0&&(e.memory.currentMem=e.memory.accumulator.reduce((f,p)=>f+p,0)/e.memory.accumulator.length)))},{pause:h}=Ql(({delta:d})=>{window.__TRES__DEVTOOLS__&&(u({timestamp:performance.now()}),l+=d,l>=c&&(window.__TRES__DEVTOOLS__.send("context",n),window.__TRES__DEVTOOLS__.send("performance",e),l=0))},{immediate:!0});Lr(()=>{h()})}const ff=(n,e)=>{if(n.uuid===e)return n;for(const t of n.children){const r=ff(t,e);if(r)return r}};let gb=class extends cp.Mesh{type="HightlightMesh";createTime;constructor(...e){super(...e),this.createTime=Date.now()}onBeforeRender(){const e=(Date.now()-this.createTime)/1e3,t=1+.07*Math.sin(2.5*e);this.scale.set(t,t,t)}};const mf=n=>{const e={id:`scene-${n.uuid}`,label:n.type,children:[],tags:[]};n.name!==""&&e.tags.push({label:n.name,textColor:5750629,backgroundColor:15793395});const t=mc(n);return t>0&&e.tags.push({label:`${fb(t)} KB`,textColor:15707189,backgroundColor:16775644,tooltip:"Memory usage"}),n.type.includes("Light")&&(cv(n)&&e.tags.push({label:`${n.intensity}`,textColor:9738662,backgroundColor:16316922,tooltip:"Intensity"}),e.tags.push({label:`#${new R_(n.color).getHexString()}`,textColor:9738662,backgroundColor:16316922,tooltip:"Color"})),n.type.includes("Camera")&&(e.tags.push({label:`${n.fov}°`,textColor:9738662,backgroundColor:16316922,tooltip:"Field of view"}),e.tags.push({label:`x: ${Math.round(n.position.x)} y: ${Math.round(n.position.y)} z: ${Math.round(n.position.z)}`,textColor:9738662,backgroundColor:16316922,tooltip:"Position"})),e};function _b(n,e,t=""){const r=t?`${t}.${n}`:n;return{id:`context-${e}-${r}`,label:n,children:[],tags:[]}}function gf(n,e,t=""){n.children.forEach(r=>{if(r.type==="HightlightMesh"||t&&!r.type.includes(t)&&!r.name.includes(t))return;const i=mf(r);e.children.push(i),gf(r,i,t)})}function bl(n,e,t=new WeakSet,r=0,i=4,s,o=""){if(r>=i||!n||t.has(n))return;const a=r===0?n?.scene?.value?.uuid||Math.random().toString(36).slice(2,11):s;t.add(n),Object.entries(n).forEach(([l,c])=>{if(l.startsWith("_")||typeof c=="function")return;const u=o?`${o}.${l}`:l,h=_b(l,a,o);l!=="scene"&&(Ei(c)?(h.tags.push({label:`Ref<${typeof c.value}>`,textColor:4372611,backgroundColor:15793395}),c.value&&typeof c.value=="object"?bl(c.value,h,t,r+1,i,a,u):h.label=`${l}: ${JSON.stringify(c.value)}`):c&&typeof c=="object"&&!Array.isArray(c)?Object.keys(c).length>0?t.has(c)?h.tags.push({label:"Circular",textColor:16711680,backgroundColor:16773360}):bl(c,h,t,r+1,i,a,u):h.label=`${l}: {}`:Array.isArray(c)?(h.label=`${l}: Array(${c.length})`,h.tags.push({label:`length: ${c.length}`,textColor:9738662,backgroundColor:16316922})):h.label=`${l}: ${JSON.stringify(c)}`,e.children.push(h))})}const vb=n=>e=>{if(e.inspectorId===Ni){const t=mf(n.scene.value);gf(n.scene.value,t,e.filter);const r={id:"context-root",label:"Context",children:[],tags:[]};bl(n,r),e.rootNodes=[t,r]}},yb=(n,{highlightMesh:e,prevInstance:t})=>r=>{if(r.inspectorId!==Ni)return;const i=new S_({color:11003607,transparent:!0,opacity:.2,depthTest:!1,side:C_});if(r.nodeId.includes("scene")){const s=r.nodeId.match(/^scene-(.+)$/),o=s?s[1]:null;if(!o)return;const[a]=n.scene.value.getObjectsByProperty("uuid",o);if(!a)return;if(t&&e&&e.parent&&t.remove(e),gp(a)){const l=new gb(a.geometry.clone(),i);a.add(l),e=l,t=a}if(r.state={object:Object.entries(a).map(([l,c])=>l==="children"?{key:l,value:c.filter(u=>u.type!=="HightlightMesh")}:{key:l,value:c,editable:!0}).filter(({key:l})=>l!=="parent")},xp(a)){const l={...r.state,state:[{key:"Scene Info",value:{objects:a.children.length,memory:mc(a),calls:n.renderer.instance.info.render.calls,triangles:n.renderer.instance.info.render.triangles,points:n.renderer.instance.info.render.points,lines:n.renderer.instance.info.render.lines}}]};"programs"in n.renderer.instance.info&&l.state.push({key:"Programs",value:n.renderer.instance.info.programs?.map(c=>({...c,programName:c.name}))}),r.state=l}}else if(r.nodeId.includes("context")){const s=r.nodeId.match(/^context-([^-]+(?:-[^-]+)*)-(.+)$/),o=s?s[2]:"context";if(!o||o==="context"){r.state={object:Object.entries(n).filter(([c])=>!c.startsWith("_")&&c!=="parent").map(([c,u])=>({key:c,value:Ei(u)?u.value:u,editable:!1}))};return}const a=o.split(".");let l=n;for(const c of a){if(!l||typeof l!="object")break;l=Ei(l[c])?l[c].value:l[c]}l!==void 0&&(r.state={object:Object.entries(l).filter(([c])=>!c.startsWith("_")&&c!=="parent").map(([c,u])=>Ei(u)?{key:c,value:u.value,editable:!1}:typeof u=="function"?{key:c,value:"ƒ()",editable:!1}:u&&typeof u=="object"?{key:c,value:Array.isArray(u)?`Array(${u.length})`:"Object",editable:!1}:{key:c,value:u,editable:!1})})}},bb=(n,e,t,r)=>{const i=ff(n,e);if(!i){console.warn("Object with UUID not found in the scene.");return}let s=i;for(let a=0;a<t.length-1;a++)if(s[t[a]]!==void 0)s=s[t[a]];else{console.warn(`Property path is not valid: ${t.join(".")}`);return}const o=t[t.length-1];s[o]!==void 0?s[o]=r:console.warn(`Property path is not valid: ${t.join(".")}`)},wb=n=>e=>{if(e.inspectorId===Ni&&e.nodeId.includes("scene")){const t=e.nodeId.match(/^scene-(.+)$/),r=t?t[1]:null;if(!r)return;bb(n.scene.value,r,e.path,e.state.value)}},Ni="tres:inspector";function Tb(n,e){const t={id:"dev.esm.tres",label:"TresJS 🪐",logo:"https://raw.githubusercontent.com/Tresjs/tres/main/public/favicon.svg",packageName:"tresjs",homepage:"https://docs.tresjs.org",app:n},r=null,i=null;mb(e),R0(t,s=>{typeof s.now!="function"&&pb("You seem to be using an outdated version of Vue Devtools. Are you still using the Beta release instead of the stable one? You can find the links at https://devtools.vuejs.org/guide/installation.html."),s.addInspector({id:Ni,label:"TresJS 🪐",icon:"account_tree",treeFilterPlaceholder:"Search instances"}),setInterval(()=>{s.sendInspectorTree(Ni)},1e3),setInterval(()=>{s.notifyComponentUpdate()},5e3),s.on.getInspectorTree(vb(e)),s.on.getInspectorState(yb(e,{highlightMesh:r,prevInstance:i})),s.on.editInspectorState(wb(e))})}const xb=["data-scene","data-tres"],Eb=nu({__name:"TresCanvas",props:{camera:{},windowSize:{type:Boolean,default:void 0},enableProvideBridge:{type:Boolean,default:!0},antialias:{type:Boolean,default:!0},stencil:{type:Boolean,default:void 0},depth:{type:Boolean,default:void 0},precision:{},logarithmicDepthBuffer:{type:Boolean,default:void 0},preserveDrawingBuffer:{type:Boolean,default:void 0},powerPreference:{},alpha:{type:Boolean,default:void 0},premultipliedAlpha:{type:Boolean},failIfMajorPerformanceCaveat:{type:Boolean,default:void 0},clearColor:{default:"#000000"},clearAlpha:{default:1},shadows:{type:Boolean,default:void 0},toneMapping:{default:k_},shadowMapType:{default:O_},useLegacyLights:{type:Boolean,default:void 0},outputColorSpace:{},toneMappingExposure:{},renderMode:{default:"always"},dpr:{},renderer:{}},emits:["ready","pointermissed","render","beforeLoop","loop","click","contextmenu","pointermove","pointerenter","pointerleave","pointerover","pointerout","dblclick","pointerdown","pointerup","pointercancel","lostpointercapture","wheel"],setup(n,{expose:e,emit:t}){const r=n,i=t,s=p_(),o=qi(),a=nl(new up),l=iu();ul(cp);const c=(p,m=!1)=>nu({setup(){const g=iu()?.appContext;g&&(g.app=l?.appContext.app);const _={};function v(y){y&&(y.parent&&v(y.parent),y.provides&&Object.assign(_,y.provides))}return l?.parent&&r.enableProvideBridge&&(v(l.parent),Reflect.ownKeys(_).forEach(y=>{No(y,_[y])})),No(Jv,p),No("extend",ul),typeof window<"u"&&g?.app&&Tb(g?.app,p),()=>ou(y_,null,m?[]:s.default())}}),u=(p,m=!1)=>{const g=c(p,m),{render:_}=v_(sy(p));_(ou(g),a.value)},h=(p,m=!1)=>{Xs(p.scene.value),m&&(p.renderer.instance.dispose(),p.renderer.instance instanceof hp&&(p.renderer.instance.renderLists.dispose(),p.renderer.instance.forceContextLoss())),a.value.__tres={root:p}},d=nl(null);e({context:d,dispose:()=>h(d.value,!0)});const f=()=>{h(d.value),u(d.value,!0)};return su(()=>{const p=o;d.value=ey({scene:a.value,canvas:p,windowSize:r.windowSize??!1,rendererOptions:r});const{camera:m,renderer:g}=d.value,{registerCamera:_,cameras:v,activeCamera:y,deregisterCamera:T}=m;u(d.value);const A=()=>{const w=new L_(45,window.innerWidth/window.innerHeight,.1,1e3);w.position.set(3,3,3),w.lookAt(0,0,0),_(w);const x=Zt(()=>{v.value.length>=2&&(w.removeFromParent(),T(w),x?.())})};d.value.events.onPointerMissed(w=>{i("pointermissed",w)}),Jl(()=>r.camera,(w,x)=>{w&&_(me(w),!0),x&&(me(x).removeFromParent(),T(me(x)))},{immediate:!0}),y.value||A(),g.onRender(()=>{d.value&&i("render",d.value)}),g.loop.onLoop(w=>{d.value&&i("loop",{...d.value,...w})}),g.loop.onBeforeLoop(w=>{d.value&&i("beforeLoop",{...d.value,...w})}),g.onReady(()=>{i("ready",d.value)})}),su(async()=>{await Ks(3e3),d.value&&(!d.value.sizes.width||!d.value.sizes.height.value)&&console.warn("TresCanvas: The canvas has no area, so nothing can be rendered. Set it manually on the parent element or use the prop windowSize.")}),Lr(f),(p,m)=>(m_(),f_("canvas",{ref_key:"canvasRef",ref:o,"data-scene":a.value.uuid,class:__(p.$attrs.class),"data-tres":`tresjs ${d_(tv).version}`,style:g_({display:"block",width:"100%",height:"100%",position:p.windowSize?"fixed":"relative",top:0,left:0,pointerEvents:"auto",touchAction:"none",...p.$attrs.style})},null,14,xb))}}),{defineComponent:ue,useSlots:Ab,watch:U,onMounted:Me,onUnmounted:tt,createElementBlock:Ee,openBlock:re,unref:C,render:Pb,watchEffect:_f,createBlock:Ft,withCtx:Qi,createElementVNode:nr,shallowRef:Re,ref:Ne,createCommentVNode:at,inject:Fi,renderSlot:Ct,provide:oh,computed:gc,Fragment:Mb,markRaw:wl,onBeforeUnmount:Sb,mergeProps:Cb,createVNode:Rb,normalizeProps:Ob,guardReactiveProps:kb,mergeModels:Lb,useModel:ah,reactive:lh}=await Vt("vue"),V=await Vt("three"),{Object3D:ti,Vector2:Z,Vector3:P,Matrix4:H,MathUtils:j,Quaternion:Fe,Ray:Rt,Group:Ae,PointsMaterial:ni,TextureLoader:To,BufferGeometry:xt,Float32BufferAttribute:St,Points:Ji,Color:ke,LineBasicMaterial:_c,Line:vf,CurvePath:ch,LineCurve3:uh,TubeGeometry:hh,MeshBasicMaterial:$e,DoubleSide:vc,Mesh:Tt,BufferAttribute:Ce,Euler:yc,TrianglesDrawMode:yf,TriangleFanDrawMode:Ur,TriangleStripDrawMode:xo,Loader:Eo,LoaderUtils:Bt,FileLoader:jr,MeshPhysicalMaterial:ve,LinearSRGBColorSpace:on,SRGBColorSpace:Br,SpotLight:bf,PointLight:wf,DirectionalLight:Tf,InstancedMesh:bc,InstancedBufferAttribute:xf,ImageBitmapLoader:Ef,InterleavedBuffer:Af,InterleavedBufferAttribute:Pf,LinearMipmapLinearFilter:Ao,NearestMipmapLinearFilter:Mf,LinearMipmapNearestFilter:Sf,NearestMipmapNearestFilter:Cf,LinearFilter:Ui,NearestFilter:wc,RepeatWrapping:zr,MirroredRepeatWrapping:Rf,ClampToEdgeWrapping:Of,Material:Ar,MeshStandardMaterial:es,PropertyBinding:kf,SkinnedMesh:Lf,LineSegments:Po,LineLoop:If,PerspectiveCamera:Df,OrthographicCamera:Nf,Skeleton:Ff,AnimationClip:Uf,Bone:jf,InterpolateDiscrete:Bf,InterpolateLinear:Mo,Texture:ji,VectorKeyframeTrack:Qs,NumberKeyframeTrack:Js,QuaternionKeyframeTrack:eo,ColorManagement:dh,FrontSide:zf,Interpolant:Vf,Box3:Tc,Sphere:sr,DefaultLoadingManager:So,Spherical:to,Plane:ts,Frustum:Ib,Matrix3:Db,LoadingManager:Nb,EventDispatcher:yi,PlaneGeometry:xc,ShaderMaterial:Fb,Raycaster:Ub,Clock:jb,RGFormat:Bb,UnsignedByteType:zb,DataTexture:Vb,EdgesGeometry:$b,BoxGeometry:$f,Box3Helper:Hb,REVISION:Gb,Controls:Wb,MOUSE:nn,TOUCH:yn}=await Vt("three");class Ec extends ti{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Z(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof t.element.ownerDocument.defaultView.Element&&t.element.parentNode!==null&&t.element.remove()})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const ar=new P,ph=new H,fh=new H,mh=new P,gh=new P;class Kb{constructor(e={}){const t=this;let r,i,s,o;const a={objects:new WeakMap},l=e.element!==void 0?e.element:document.createElement("div");l.style.overflow="hidden",this.domElement=l,this.getSize=function(){return{width:r,height:i}},this.render=function(p,m){p.matrixWorldAutoUpdate===!0&&p.updateMatrixWorld(),m.parent===null&&m.matrixWorldAutoUpdate===!0&&m.updateMatrixWorld(),ph.copy(m.matrixWorldInverse),fh.multiplyMatrices(m.projectionMatrix,ph),u(p,p,m),f(p)},this.setSize=function(p,m){r=p,i=m,s=r/2,o=i/2,l.style.width=p+"px",l.style.height=m+"px"};function c(p){p.isCSS2DObject&&(p.element.style.display="none");for(let m=0,g=p.children.length;m<g;m++)c(p.children[m])}function u(p,m,g){if(p.visible===!1){c(p);return}if(p.isCSS2DObject){ar.setFromMatrixPosition(p.matrixWorld),ar.applyMatrix4(fh);const _=ar.z>=-1&&ar.z<=1&&p.layers.test(g.layers)===!0,v=p.element;v.style.display=_===!0?"":"none",_===!0&&(p.onBeforeRender(t,m,g),v.style.transform="translate("+-100*p.center.x+"%,"+-100*p.center.y+"%)translate("+(ar.x*s+s)+"px,"+(-ar.y*o+o)+"px)",v.parentNode!==l&&l.appendChild(v),p.onAfterRender(t,m,g));const y={distanceToCameraSquared:h(g,p)};a.objects.set(p,y)}for(let _=0,v=p.children.length;_<v;_++)u(p.children[_],m,g)}function h(p,m){return mh.setFromMatrixPosition(p.matrixWorld),gh.setFromMatrixPosition(m.matrixWorld),mh.distanceToSquared(gh)}function d(p){const m=[];return p.traverseVisible(function(g){g.isCSS2DObject&&m.push(g)}),m}function f(p){const m=d(p).sort(function(_,v){if(_.renderOrder!==v.renderOrder)return v.renderOrder-_.renderOrder;const y=a.objects.get(_).distanceToCameraSquared,T=a.objects.get(v).distanceToCameraSquared;return y-T}),g=m.length;for(let _=0,v=m.length;_<v;_++)m[_].element.style.zIndex=g-_}}}var qb="Invariant failed";function _h(n,e){if(!n)throw new Error(qb)}const Xb=new P;function Hf(n,e,t=new P,r){const{x:i,y:s,z:o}=n,a=e.x,l=e.y,c=e.z,u=i*i*a,h=s*s*l,d=o*o*c,f=u+h+d,p=Math.sqrt(1/f);if(!Number.isFinite(p))return;const m=Xb.copy(n).multiplyScalar(p);if(f<(r?.centerTolerance??.1))return t.copy(m);const g=m.multiply(e).multiplyScalar(2);let _=(1-p)*n.length()/(g.length()/2),v=0,y,T,A,w;do{_-=v,y=1/(1+_*a),T=1/(1+_*l),A=1/(1+_*c);const x=y*y,b=T*T,E=A*A,M=x*y,S=b*T,O=E*A;w=u*x+h*b+d*E-1,v=w/((u*M*a+h*S*l+d*O*c)*-2)}while(Math.abs(w)>1e-12);return t.set(i*y,s*T,o*A)}const ii=new P,vh=new P,yh=new P;let Cn=class Gf{static WGS84=new Gf(6378137,6378137,6356752314245179e-9);radii;constructor(e,t,r){this.radii=new P(e,t,r)}get minimumRadius(){return Math.min(this.radii.x,this.radii.y,this.radii.z)}get maximumRadius(){return Math.max(this.radii.x,this.radii.y,this.radii.z)}reciprocalRadii(e=new P){const{x:t,y:r,z:i}=this.radii;return e.set(1/t,1/r,1/i)}reciprocalRadiiSquared(e=new P){const{x:t,y:r,z:i}=this.radii;return e.set(1/t**2,1/r**2,1/i**2)}projectOnSurface(e,t=new P,r){return Hf(e,this.reciprocalRadiiSquared(),t,r)}getSurfaceNormal(e,t=new P){return t.multiplyVectors(this.reciprocalRadiiSquared(ii),e).normalize()}getEastNorthUpVectors(e,t=new P,r=new P,i=new P){this.getSurfaceNormal(e,i),t.set(-e.y,e.x,0).normalize(),r.crossVectors(i,t).normalize()}getEastNorthUpFrame(e,t=new H){const r=ii,i=vh,s=yh;return this.getEastNorthUpVectors(e,r,i,s),t.makeBasis(r,i,s).setPosition(e)}getIntersection(e,t=new P){const r=this.reciprocalRadii(ii),i=vh.copy(r).multiply(e.origin),s=yh.copy(r).multiply(e.direction),o=i.lengthSq(),a=s.lengthSq(),l=i.dot(s),c=l**2-a*(o-1);if(o===1)return t.copy(e.origin);if(o>1){if(l>=0||c<0)return;const u=Math.sqrt(c),h=(-l-u)/a,d=(-l+u)/a;return e.at(Math.min(h,d),t)}if(o<1){const u=l**2-a*(o-1),h=Math.sqrt(u),d=(-l+h)/a;return e.at(d,t)}if(l<0)return e.at(-l/a,t)}getOsculatingSphereCenter(e,t,r=new P){_h(this.radii.x===this.radii.y);const i=this.radii.x**2,s=this.radii.z**2,o=ii.set(e.x/i,e.y/i,e.z/s).normalize();return r.copy(o.multiplyScalar(-t).add(e))}getNormalAtHorizon(e,t,r=new P){_h(this.radii.x===this.radii.y);const i=this.radii.x**2,s=this.radii.z**2,o=e,a=t;let l=(o.x*a.x+o.y*a.y)/i+o.z*a.z/s;l/=(o.x**2+o.y**2)/i+o.z**2/s;const c=ii.copy(a).multiplyScalar(-l).add(e);return r.set(c.x/i,c.y/i,c.z/s).normalize()}};const as=new P,bh=new P;class Vr{constructor(e=0,t=0,r=0){this.longitude=e,this.latitude=t,this.height=r}static MIN_LONGITUDE=-Math.PI;static MAX_LONGITUDE=Math.PI;static MIN_LATITUDE=-Math.PI/2;static MAX_LATITUDE=Math.PI/2;set(e,t,r){return this.longitude=e,this.latitude=t,r!=null&&(this.height=r),this}clone(){return new Vr(this.longitude,this.latitude,this.height)}copy(e){return this.longitude=e.longitude,this.latitude=e.latitude,this.height=e.height,this}equals(e){return e.longitude===this.longitude&&e.latitude===this.latitude&&e.height===this.height}setLongitude(e){return this.longitude=e,this}setLatitude(e){return this.latitude=e,this}setHeight(e){return this.height=e,this}normalize(){return this.longitude<Vr.MIN_LONGITUDE&&(this.longitude+=Math.PI*2),this}setFromECEF(e,t){const r=(t?.ellipsoid??Cn.WGS84).reciprocalRadiiSquared(as),i=Hf(e,r,bh,t);if(i==null)throw new Error(`Could not project position to ellipsoid surface: ${e.toArray()}`);const s=as.multiplyVectors(i,r).normalize();this.longitude=Math.atan2(s.y,s.x),this.latitude=Math.asin(s.z);const o=as.subVectors(e,i);return this.height=Math.sign(o.dot(e))*o.length(),this}toECEF(e=new P,t){const r=t?.ellipsoid??Cn.WGS84,i=as.multiplyVectors(r.radii,r.radii),s=Math.cos(this.latitude),o=bh.set(s*Math.cos(this.longitude),s*Math.sin(this.longitude),Math.sin(this.latitude)).normalize();return e.multiplyVectors(i,o),e.divideScalar(Math.sqrt(o.dot(e))).add(o.multiplyScalar(this.height))}fromArray(e,t=0){return this.longitude=e[t],this.latitude=e[t+1],this.height=e[t+2],this}toArray(e=[],t=0){return e[t]=this.longitude,e[t+1]=this.latitude,e[t+2]=this.height,e}*[Symbol.iterator](){yield this.longitude,yield this.latitude,yield this.height}}const Go=1e-6,ls=new P,cs=new P,$t=new P,si=new P,Wo=new P,Yb=new P,Zb=new H,Qb=new Fe,Jb=new Rt;class Co{_distance;heading;_pitch;roll;constructor(e=0,t=0,r=0,i=0){this.distance=e,this.heading=t,this.pitch=r,this.roll=i}get distance(){return this._distance}set distance(e){this._distance=Math.max(e,Go)}get pitch(){return this._pitch}set pitch(e){this._pitch=j.clamp(e,-Math.PI/2+Go,Math.PI/2-Go)}set(e,t,r,i){return this.distance=e,this.heading=t,this.pitch=r,i!=null&&(this.roll=i),this}clone(){return new Co(this.distance,this.heading,this.pitch,this.roll)}copy(e){return this.distance=e.distance,this.heading=e.heading,this.pitch=e.pitch,this.roll=e.roll,this}equals(e){return e.distance===this.distance&&e.heading===this.heading&&e.pitch===this.pitch&&e.roll===this.roll}decompose(e,t,r,i,s=Cn.WGS84){s.getEastNorthUpVectors(e,ls,cs,$t),i?.copy($t);const o=si.copy(ls).multiplyScalar(Math.cos(this.heading)).add(Wo.copy(cs).multiplyScalar(Math.sin(this.heading))).multiplyScalar(Math.cos(this.pitch)).add(Wo.copy($t).multiplyScalar(Math.sin(this.pitch))).normalize().multiplyScalar(this.distance);if(t.copy(e).sub(o),this.roll!==0){const a=si.copy(e).sub(t).normalize();$t.applyQuaternion(Qb.setFromAxisAngle(a,this.roll))}r.setFromRotationMatrix(Zb.lookAt(t,e,$t))}setFromCamera(e,t=Cn.WGS84){const r=si.setFromMatrixPosition(e.matrixWorld),i=Wo.set(0,0,.5).unproject(e).sub(r).normalize(),s=t.getIntersection(Jb.set(r,i));if(s==null)return;this.distance=r.distanceTo(s),t.getEastNorthUpVectors(s,ls,cs,$t),this.heading=Math.atan2(cs.dot(i),ls.dot(i)),this.pitch=Math.asin($t.dot(i));const o=si.copy(e.up).applyQuaternion(e.quaternion),a=Yb.copy(i).multiplyScalar(-o.dot(i)).add(o).normalize(),l=si.copy(i).multiplyScalar(-$t.dot(i)).add($t).normalize(),c=l.dot(a),u=i.dot(l.cross(a));return this.roll=Math.atan2(u,c),this}}const vr=j.degToRad,us=j.radToDeg,ew=(n,e,t,r,i,s)=>{new Co(e,vr(t),vr(r)).decompose(new Vr(vr(i),vr(s)).toECEF(),n.position,n.quaternion,n.up),n.updateMatrixWorld()},He=(n,e,t)=>new Vr(vr(n),vr(e),t).toECEF(),hs=new Co,Ko=new Vr,tw=new P,nw=new P,rw=new Rt,iw=Cn.WGS84,sw=n=>{hs.setFromCamera(n);const e=tw.setFromMatrixPosition(n.matrixWorld),t=nw.set(0,0,.5).unproject(n).sub(e).normalize(),r=iw.getIntersection(rw.set(e,t));return r?(Ko.setFromECEF(r),{distance:hs.distance,heading:us(hs.heading),pitch:us(hs.pitch),longitude:us(Ko.longitude),latitude:us(Ko.latitude)}):null};function Ac(n,e,t){const r=i=>s=>{const o=[{...s,index:0},e,0];n(i,...o)};return{click:r("click"),doubleclick:r("doubleclick"),contextmenu:r("contextmenu"),pointerenter:r("pointerenter"),pointerleave:r("pointerleave"),pointerover:r("pointerover"),pointerdown:r("pointerdown"),pointerup:r("pointerup"),wheel:r("wheel")}}function Pc(n,e){n.removeEventListener("click",e.click),n.removeEventListener("dblclick",e.doubleclick),n.removeEventListener("contextmenu",e.contextmenu),n.removeEventListener("pointerenter",e.pointerenter),n.removeEventListener("pointerleave",e.pointerleave),n.removeEventListener("pointerover",e.pointerover),n.removeEventListener("pointerdown",e.pointerdown),n.removeEventListener("pointerup",e.pointerup),n.removeEventListener("wheel",e.wheel)}const ow=["object"],xP=ue({__name:"GeoCSS2D",props:{point:{},renderOrder:{default:1},id:{}},emits:["click","doubleclick","contextmenu","pointerenter","pointerleave","pointerover","pointerdown","pointerup","wheel"],setup(n,{expose:e,emit:t}){const r=document.createElement("div"),i=n,s=Ab(),o=t,a=()=>{Pb(s.default()[0],r)},l=new Ec(r),c=new Ae;c.layers.enableAll(),c.add(l),l.layers.set(1),l.renderOrder=i.renderOrder;const u=()=>{const d=He(i.point.lon,i.point.lat,i.point.height);l.position.copy(d)},h=Ac(o,i);return U([()=>i.point.lon,()=>i.point.lat,()=>i.point.height],()=>{u()}),Me(()=>{u(),a(),r.addEventListener("click",h.click),r.addEventListener("dblclick",h.doubleclick),r.addEventListener("contextmenu",h.contextmenu),r.addEventListener("pointerenter",h.pointerenter),r.addEventListener("pointerleave",h.pointerleave),r.addEventListener("pointerover",h.pointerover),r.addEventListener("pointerdown",h.pointerdown),r.addEventListener("pointerup",h.pointerup),r.addEventListener("wheel",h.wheel)}),tt(()=>{Pc(r,h),c.clear()}),e({update:a}),(d,f)=>(re(),Ee("primitive",{object:C(c)},null,8,ow))}}),aw=["object"],EP=ue({__name:"GeoText",props:{point:{},fontSize:{default:16},color:{default:"#333"},text:{},renderOrder:{default:1},align:{default:"left"},id:{}},emits:["click","doubleclick","contextmenu","pointerenter","pointerleave","pointerover","pointerdown","pointerup","wheel"],setup(n,{emit:e}){const t=document.createElement("div"),r=n,i=e,s=()=>{switch(t.innerText=r.text,t.style.fontSize=r.fontSize+"px",t.style.color=r.color,t.style.pointerEvents="auto",t.style.userSelect="none",r.align){case"center":t.style.transform="translateX(-50%)",t.style.textAlign="center";break;case"right":t.style.transform="translateX(-100%)",t.style.textAlign="right";break;case"left":default:t.style.transform="translateX(0)",t.style.textAlign="left";break}},o=new Ec(t);o.renderOrder=r.renderOrder;const a=Ac(i,r);return Me(()=>{s(),t.addEventListener("click",a.click),t.addEventListener("dblclick",a.doubleclick),t.addEventListener("contextmenu",a.contextmenu),t.addEventListener("pointerenter",a.pointerenter),t.addEventListener("pointerleave",a.pointerleave),t.addEventListener("pointerover",a.pointerover),t.addEventListener("pointerdown",a.pointerdown),t.addEventListener("pointerup",a.pointerup),t.addEventListener("wheel",a.wheel)}),_f(()=>{s()}),tt(()=>{Pc(t,a),t.remove()}),(l,c)=>(re(),Ft(C(Sc),{point:r.point},{default:Qi(()=>[nr("primitive",{object:C(o)},null,8,aw)]),_:1},8,["point"]))}}),lw=["object"],AP=ue({__name:"GeoIcon",props:{point:{},size:{},icon:{},renderOrder:{default:1},id:{}},emits:["click","doubleclick","contextmenu","pointerenter","pointerleave","pointerover","pointerdown","pointerup","wheel"],setup(n,{emit:e}){const t=document.createElement("img"),r=n,i=e,s=()=>{t.src=r.icon,t.style.width=r.size+"px",t.style.height=r.size+"px",t.style.left="0",t.style.top="0",t.style.pointerEvents="all"},o=new Ec(t);o.renderOrder=r.renderOrder;const a=Ac(i,r);return Me(()=>{s(),t.addEventListener("click",a.click),t.addEventListener("dblclick",a.doubleclick),t.addEventListener("contextmenu",a.contextmenu),t.addEventListener("pointerenter",a.pointerenter),t.addEventListener("pointerleave",a.pointerleave),t.addEventListener("pointerover",a.pointerover),t.addEventListener("pointerdown",a.pointerdown),t.addEventListener("pointerup",a.pointerup),t.addEventListener("wheel",a.wheel)}),_f(()=>{s()}),tt(()=>{Pc(t,a),t.remove()}),(l,c)=>(re(),Ft(C(Sc),{point:r.point},{default:Qi(()=>[nr("primitive",{object:C(o)},null,8,lw)]),_:1},8,["point"]))}}),cw=["object"],PP=ue({__name:"GeoParticle",props:{points:{},size:{},icon:{},color:{},renderOrder:{default:1},raycastActive:{type:Boolean},raycastMultiplier:{default:1},sizeAttenuation:{type:Boolean,default:!0}},emits:["click","doubleclick","contextmenu","pointerenter","pointerleave","pointerover","pointerdown","pointerup","wheel"],setup(n,{emit:e}){const t=n,r=e,i=Re(),s=Ne([]),o=Ne(new P),a=w=>{const x=w.raycast;w.raycast=function(b,E){const M=b.params.Points?.threshold||1;b.params.Points?b.params.Points.threshold=M*t.raycastMultiplier:b.params.Points={threshold:M*t.raycastMultiplier};const S=x.call(this,b,E);return b.params.Points.threshold=M,S}},l=w=>{if(w.length===0)return new P;const x=new P;return w.forEach(b=>x.add(b)),x.divideScalar(w.length),x},c=(w,x)=>w.map(b=>b.clone().sub(x)),u=()=>{const w=new ni({size:t.size||32,transparent:!0,sizeAttenuation:t.sizeAttenuation,vertexColors:!0});if(t.icon){const M=new To().load(t.icon);w.map=M,w.needsUpdate=!0}const x=new xt,b=new Float32Array(t.points.length*3),E=new Float32Array(t.points.length*3);x.setAttribute("position",new St(b,3)),x.setAttribute("color",new St(E,3)),i.value=new Ji(x,w),i.value.renderOrder=t.renderOrder,a(i.value)},h=()=>{if(i.value){const w=i.value.geometry,x=w.getAttribute("position"),b=w.getAttribute("color");s.value=t.points.map(E=>He(E.lon,E.lat,E.height||0)),o.value=l(s.value),c(s.value,o.value).forEach((E,M)=>{x.setXYZ(M,E.x,E.y,E.z);const S=t.points[M].color||t.color||"#ffffff",O=new ke(S);b.setXYZ(M,O.r,O.g,O.b)}),x.needsUpdate=!0,b.needsUpdate=!0,i.value.position.copy(o.value)}};U(()=>t.points,()=>{h()},{immediate:!0}),U(()=>t.size,()=>{i.value&&(i.value.material.size=t.size||32,i.value.material.needsUpdate=!0)}),U(()=>t.raycastMultiplier,w=>{i.value&&a(i.value)});const d=w=>x=>{if(!(!i.value||!t.raycastActive)&&x.index!==void 0&&x.index<t.points.length){const b=t.points[x.index];r(w,x,b,x.index)}},f=d("click"),p=d("doubleclick"),m=d("contextmenu"),g=d("pointerenter"),_=d("pointerleave"),v=d("pointerover"),y=d("pointerdown"),T=d("pointerup"),A=d("wheel");return Me(()=>{u(),h()}),tt(()=>{if(i.value){i.value.geometry.dispose();const w=i.value.material;w.map?.dispose(),w.dispose()}}),(w,x)=>i.value?(re(),Ee("primitive",{key:0,object:i.value,onClick:x[0]||(x[0]=(...b)=>C(f)&&C(f)(...b)),onDoubleclick:x[1]||(x[1]=(...b)=>C(p)&&C(p)(...b)),onContextmenu:x[2]||(x[2]=(...b)=>C(m)&&C(m)(...b)),onPointerenter:x[3]||(x[3]=(...b)=>C(g)&&C(g)(...b)),onPointerleave:x[4]||(x[4]=(...b)=>C(_)&&C(_)(...b)),onPointerover:x[5]||(x[5]=(...b)=>C(v)&&C(v)(...b)),onPointerdown:x[6]||(x[6]=(...b)=>C(y)&&C(y)(...b)),onPointerup:x[7]||(x[7]=(...b)=>C(T)&&C(T)(...b)),onWheel:x[8]||(x[8]=(...b)=>C(A)&&C(A)(...b))},null,40,cw)):at("",!0)}}),uw=["object"],MP=ue({__name:"GeoPoint",props:{point:{},color:{},size:{},icon:{},renderOrder:{default:1},raycastActive:{type:Boolean},raycastMultiplier:{default:1},sizeAttenuation:{type:Boolean,default:!0},id:{}},emits:["click","doubleclick","contextmenu","pointerenter","pointerleave","pointerover","pointerdown","pointerup","wheel"],setup(n,{emit:e}){const t=n,r=e,i=Re(),s=_=>{const v=_.raycast;_.raycast=function(y,T){const A=y.params.Points?.threshold||1;y.params.Points?y.params.Points.threshold=A*t.raycastMultiplier:y.params.Points={threshold:A*t.raycastMultiplier};const w=v.call(this,y,T);return y.params.Points.threshold=A,w}},o=()=>{const _=new xt;_.setAttribute("position",new St([0,0,0],3));const v=new ni({size:t.size||32,transparent:!0,sizeAttenuation:t.sizeAttenuation,color:t.color||"#ffffff"});if(t.icon){const y=new To;v.map=y.load(t.icon),v.needsUpdate=!0}i.value=new Ji(_,v),i.value.renderOrder=t.renderOrder,s(i.value)};U(()=>t.size,_=>{i.value&&(i.value.material.size=_||32,i.value.material.needsUpdate=!0)});const a=_=>v=>{!i.value||!t.raycastActive||v.index!==void 0&&r(_,v,t,0)},l=a("click"),c=a("doubleclick"),u=a("contextmenu"),h=a("pointerenter"),d=a("pointerleave"),f=a("pointerover"),p=a("pointerdown"),m=a("pointerup"),g=a("wheel");return Me(o),tt(()=>{if(i.value){i.value.geometry.dispose();const _=i.value.material;_.map?.dispose(),_.dispose()}}),(_,v)=>(re(),Ft(C(Sc),{point:t.point},{default:Qi(()=>[i.value?(re(),Ee("primitive",{key:0,object:i.value,onClick:v[0]||(v[0]=(...y)=>C(l)&&C(l)(...y)),onDoubleclick:v[1]||(v[1]=(...y)=>C(c)&&C(c)(...y)),onContextmenu:v[2]||(v[2]=(...y)=>C(u)&&C(u)(...y)),onPointerenter:v[3]||(v[3]=(...y)=>C(h)&&C(h)(...y)),onPointerleave:v[4]||(v[4]=(...y)=>C(d)&&C(d)(...y)),onPointerover:v[5]||(v[5]=(...y)=>C(f)&&C(f)(...y)),onPointerdown:v[6]||(v[6]=(...y)=>C(p)&&C(p)(...y)),onPointerup:v[7]||(v[7]=(...y)=>C(m)&&C(m)(...y)),onWheel:v[8]||(v[8]=(...y)=>C(g)&&C(g)(...y))},null,40,uw)):at("",!0)]),_:1},8,["point"]))}}),no=n=>{if(n.length===0)return new P;const e=new P;return n.forEach(t=>e.add(t)),e.divideScalar(n.length),e},ro=(n,e)=>n.map(t=>t.clone().sub(e)),io=n=>n.map(e=>He(e.lon,e.lat,e.height||0)),hw=n=>{n.startTime=0,n.isAnimating=!0},dw=n=>{n.isAnimating=!1},pw=(n,e,t,r,i=!1,s=1)=>{r.startTime===0&&(r.startTime=e);let o=(e-r.startTime)*Math.max(0,s)%t/t;i&&(o=1-o),n.offset.x=-o,n.needsUpdate=!0},fw=(n,e,t,r,i=!1,s=1)=>{r.startTime===0&&(r.startTime=e);let o=(e-r.startTime)*Math.max(0,s)%t/t;i&&(o=1-o),n.uniforms&&n.uniforms.offset&&(n.uniforms.offset.value.x=-o)},ns=(n,e,t=!0,r)=>{const i=s=>o=>{if(!t)return;const a=o.index!==void 0?o.index:0;n(s,o,e,a)};return{handleClick:i("click"),handleDoubleClick:i("doubleclick"),handleContextMenu:i("contextmenu"),handlePointerEnter:i("pointerenter"),handlePointerLeave:i("pointerleave"),handlePointerOver:i("pointerover"),handlePointerDown:i("pointerdown"),handlePointerUp:i("pointerup"),handleWheel:i("wheel")}},Yn=(n,e=1)=>{if(!n||!n.raycast)return;const t=n.raycast;n.raycast=function(r,i){const s=r.params.Points?.threshold||1;r.params.Points?r.params.Points.threshold=s*e:n.type==="Points"&&(r.params.Points={threshold:s*e});const o=t.call(this,r,i);return r.params.Points&&(r.params.Points.threshold=s),o}},mw=["object"],wh=ue({__name:"GeoTubeline",props:{points:{},color:{},width:{},tubularSegments:{},map:{},renderOrder:{default:1},opacity:{default:1},repeat:{default:()=>[1,1]},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","doubleclick","contextmenu","pointerenter","pointerleave","pointerover","pointerdown","pointerup","wheel"],setup(n,{emit:e}){const t=n,r=e,i=Re(),s=Re(),o=Ne([]),a=Ne(new P),l=ns(r,t,t.raycastActive),c=Fi("registerAnimationTarget"),u=Fi("unregisterAnimationTarget"),h=()=>(t.width||2)*.3,d=()=>{i.value=new Ae,o.value=io(t.points),a.value=no(o.value);const p=ro(o.value,a.value),m=new ch;for(let y=0;y<p.length-1;y++){const T=new uh(p[y],p[y+1]);m.add(T)}const g=new hh(m,t.tubularSegments||64,h(),8,!1),_={color:t.color||"#ffffff",transparent:!0,side:vc,opacity:t.opacity!==void 0?t.opacity:1};t.map&&(_.map=t.map,t.repeat&&t.repeat.length>=2&&(t.map.repeat.set(t.repeat[0],t.repeat[1]),t.map.needsUpdate=!0));const v=new $e(_);s.value=new Tt(g,v),s.value.renderOrder=t.renderOrder,t.raycastActive&&Yn(s.value,t.raycastMultiplier),i.value.add(s.value),i.value.position.copy(a.value),c&&c(s.value,"texture",t.map)},f=()=>{if(s.value){s.value.geometry.dispose(),o.value=io(t.points),a.value=no(o.value);const p=ro(o.value,a.value),m=new ch;for(let _=0;_<p.length-1;_++){const v=new uh(p[_],p[_+1]);m.add(v)}const g=new hh(m,t.tubularSegments||64,h(),8,!1);s.value.geometry=g,i.value.position.copy(a.value)}};return U(()=>t.points,()=>{f()},{immediate:!0}),U(()=>t.color,p=>{s.value&&(s.value.material.color.set(p||"#ffffff"),s.value.material.needsUpdate=!0)}),U(()=>t.opacity,p=>{s.value&&(s.value.material.opacity=p!==void 0?p:1,s.value.material.needsUpdate=!0)}),U(()=>t.repeat,p=>{s.value&&s.value.material.map&&p&&p.length>=2&&(s.value.material.map.repeat.set(p[0],p[1]),s.value.material.map.needsUpdate=!0)},{deep:!0}),U(()=>[t.width,t.tubularSegments],()=>{f()}),U(()=>t.map,p=>{s.value&&(p?(s.value.material.map=p,t.repeat&&t.repeat.length>=2&&(p.repeat.set(t.repeat[0],t.repeat[1]),p.needsUpdate=!0),s.value.material.needsUpdate=!0,c&&c(s.value,"texture",p)):(s.value.material.map=null,s.value.material.needsUpdate=!0,c&&c(s.value,"texture",void 0)))}),Me(()=>{d()}),tt(()=>{s.value&&(u&&u(s.value),s.value.geometry.dispose(),s.value.material.dispose()),i.value&&i.value.clear()}),(p,m)=>i.value?(re(),Ee("primitive",{key:0,object:i.value,onClick:m[0]||(m[0]=(...g)=>C(l).handleClick&&C(l).handleClick(...g)),onDoubleclick:m[1]||(m[1]=(...g)=>C(l).handleDoubleClick&&C(l).handleDoubleClick(...g)),onContextmenu:m[2]||(m[2]=(...g)=>C(l).handleContextMenu&&C(l).handleContextMenu(...g)),onPointerenter:m[3]||(m[3]=(...g)=>C(l).handlePointerEnter&&C(l).handlePointerEnter(...g)),onPointerleave:m[4]||(m[4]=(...g)=>C(l).handlePointerLeave&&C(l).handlePointerLeave(...g)),onPointerover:m[5]||(m[5]=(...g)=>C(l).handlePointerOver&&C(l).handlePointerOver(...g)),onPointerdown:m[6]||(m[6]=(...g)=>C(l).handlePointerDown&&C(l).handlePointerDown(...g)),onPointerup:m[7]||(m[7]=(...g)=>C(l).handlePointerUp&&C(l).handlePointerUp(...g)),onWheel:m[8]||(m[8]=(...g)=>C(l).handleWheel&&C(l).handleWheel(...g))},null,40,mw)):at("",!0)}});class cn extends V.BufferGeometry{constructor(){super(),this.isMeshLine=!0,this.type="MeshLine",this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this._points=[],this._geom=null,this.widthCallback=null,this.matrixWorld=new V.Matrix4,Object.defineProperties(this,{geometry:{enumerable:!0,get:function(){return this}},geom:{enumerable:!0,get:function(){return this._geom},set:function(e){this.setGeometry(e,this.widthCallback)}},points:{enumerable:!0,get:function(){return this._points},set:function(e){this.setPoints(e,this.widthCallback)}}})}}cn.prototype.setMatrixWorld=function(n){this.matrixWorld=n};cn.prototype.setGeometry=function(n,e){this._geometry=n,this.setPoints(n.getAttribute("position").array,e)};cn.prototype.setPoints=function(n,e){if(!(n instanceof Float32Array)&&!(n instanceof Array)){console.error("ERROR: The BufferArray of points is not instancied correctly.");return}if(this._points=n,this.widthCallback=e,this.positions=[],this.counters=[],n.length&&n[0]instanceof V.Vector3)for(var t=0;t<n.length;t++){var r=n[t],i=t/n.length;this.positions.push(r.x,r.y,r.z),this.positions.push(r.x,r.y,r.z),this.counters.push(i),this.counters.push(i)}else for(var t=0;t<n.length;t+=3){var i=t/n.length;this.positions.push(n[t],n[t+1],n[t+2]),this.positions.push(n[t],n[t+1],n[t+2]),this.counters.push(i),this.counters.push(i)}this.process()};function gw(n,e){var t=new V.Matrix4,r=new V.Ray,i=new V.Sphere,s=new V.Vector3,o=this.geometry;if(o.boundingSphere||o.computeBoundingSphere(),i.copy(o.boundingSphere),i.applyMatrix4(this.matrixWorld),n.ray.intersectSphere(i,s)!==!1){t.copy(this.matrixWorld).invert(),r.copy(n.ray).applyMatrix4(t);var a=new V.Vector3,l=new V.Vector3,c=new V.Vector3,u=this instanceof V.LineSegments?2:1,h=o.index,d=o.attributes;if(h!==null)for(var f=h.array,p=d.position.array,m=d.width.array,g=0,_=f.length-1;g<_;g+=u){var v=f[g],y=f[g+1];a.fromArray(p,v*3),l.fromArray(p,y*3);var T=m[Math.floor(g/3)]!==void 0?m[Math.floor(g/3)]:1,A=n.params.Line.threshold+this.material.lineWidth*T/2,w=A*A,x=r.distanceSqToSegment(a,l,s,c);if(!(x>w)){s.applyMatrix4(this.matrixWorld);var b=n.ray.origin.distanceTo(s);b<n.near||b>n.far||(e.push({distance:b,point:c.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}),g=_)}}}}cn.prototype.raycast=gw;cn.prototype.compareV3=function(n,e){var t=n*6,r=e*6;return this.positions[t]===this.positions[r]&&this.positions[t+1]===this.positions[r+1]&&this.positions[t+2]===this.positions[r+2]};cn.prototype.copyV3=function(n){var e=n*6;return[this.positions[e],this.positions[e+1],this.positions[e+2]]};cn.prototype.process=function(){var n=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];var e,t;this.compareV3(0,n-1)?t=this.copyV3(n-2):t=this.copyV3(0),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);for(var r=0;r<n;r++){if(this.side.push(1),this.side.push(-1),this.widthCallback?e=this.widthCallback(r/(n-1)):e=1,this.width.push(e),this.width.push(e),this.uvs.push(r/(n-1),0),this.uvs.push(r/(n-1),1),r<n-1){t=this.copyV3(r),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);var i=r*2;this.indices_array.push(i,i+1,i+2),this.indices_array.push(i+2,i+1,i+3)}r>0&&(t=this.copyV3(r),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]))}this.compareV3(n-1,0)?t=this.copyV3(1):t=this.copyV3(n-1),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]),!this._attributes||this._attributes.position.count!==this.positions.length?this._attributes={position:new V.BufferAttribute(new Float32Array(this.positions),3),previous:new V.BufferAttribute(new Float32Array(this.previous),3),next:new V.BufferAttribute(new Float32Array(this.next),3),side:new V.BufferAttribute(new Float32Array(this.side),1),width:new V.BufferAttribute(new Float32Array(this.width),1),uv:new V.BufferAttribute(new Float32Array(this.uvs),2),index:new V.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new V.BufferAttribute(new Float32Array(this.counters),1)}:(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox(),this._geometry.attributes=this.attributes,this._geometry.index=this.index,this._geometry.computeBoundingSphere(),this._geometry.computeBoundingBox()};function qo(n,e,t,r,i){var s;if(n=n.subarray||n.slice?n:n.buffer,t=t.subarray||t.slice?t:t.buffer,n=e?n.subarray?n.subarray(e,i&&e+i):n.slice(e,i&&e+i):n,t.set)t.set(n,r);else for(s=0;s<n.length;s++)t[s+r]=n[s];return t}cn.prototype.advance=function(n){var e=this._attributes.position.array,t=this._attributes.previous.array,r=this._attributes.next.array,i=e.length;qo(e,0,t,0,i),qo(e,6,e,0,i-6),e[i-6]=n.x,e[i-5]=n.y,e[i-4]=n.z,e[i-3]=n.x,e[i-2]=n.y,e[i-1]=n.z,qo(e,6,r,0,i-6),r[i-6]=n.x,r[i-5]=n.y,r[i-4]=n.z,r[i-3]=n.x,r[i-2]=n.y,r[i-1]=n.z,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0};V.ShaderChunk.meshline_vert=["",V.ShaderChunk.logdepthbuf_pars_vertex,V.ShaderChunk.fog_pars_vertex,"","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute float counters;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float near;","uniform float far;","uniform float sizeAttenuation;","uniform vec2 offset;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","	 vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","    float pixelWidthRatio = 1. / (resolution.x * projectionMatrix[0][0]);","","    vColor = vec4( color, opacity );","    vUV = uv + offset;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float pixelWidth = finalPosition.w * pixelWidthRatio;","    float w = 1.8 * pixelWidth * lineWidth * width;","","    if( sizeAttenuation == 1. ) {","        w = 1.8 * lineWidth * width;","    }","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec2 normal = vec2( -dir.y, dir.x );","    normal.x /= aspect;","    normal *= .5 * w;","","    vec4 offset = vec4( normal * side, 0.0, 1.0 );","    finalPosition.xy += offset.xy;","","    gl_Position = finalPosition;","",V.ShaderChunk.logdepthbuf_vertex,V.ShaderChunk.fog_vertex&&"    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",V.ShaderChunk.fog_vertex,"}"].join(`\r
`);V.ShaderChunk.meshline_frag=["",V.ShaderChunk.fog_pars_fragment,V.ShaderChunk.logdepthbuf_pars_fragment,"","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform float dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","void main() {","",V.ShaderChunk.logdepthbuf_fragment,"","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","    if( c.a < alphaTest ) discard;","    if( useDash == 1. ){","        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));","    }","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","",V.ShaderChunk.fog_fragment,"}"].join(`\r
`);class Wf extends V.ShaderMaterial{constructor(e){super({uniforms:Object.assign({},V.UniformsLib.fog,{lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new V.Color(16777215)},opacity:{value:1},resolution:{value:new V.Vector2(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new V.Vector2(1,1)},offset:{value:new V.Vector2(1,1)}}),depthWrite:e.depthWrite!==void 0?e.depthWrite:!0,depthTest:e.depthTest!==void 0?e.depthTest:!0,transparent:e.transparent!==void 0?e.transparent:!0,vertexShader:V.ShaderChunk.meshline_vert,fragmentShader:V.ShaderChunk.meshline_frag}),this.isMeshLineMaterial=!0,this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(t){this.uniforms.lineWidth.value=t}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(t){this.uniforms.map.value=t}},useMap:{enumerable:!0,get:function(){return this.uniforms.useMap.value},set:function(t){this.uniforms.useMap.value=t}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(t){this.uniforms.alphaMap.value=t}},useAlphaMap:{enumerable:!0,get:function(){return this.uniforms.useAlphaMap.value},set:function(t){this.uniforms.useAlphaMap.value=t}},color:{enumerable:!0,get:function(){return this.uniforms.color.value},set:function(t){this.uniforms.color.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(t){this.uniforms.sizeAttenuation.value=t}},dashArray:{enumerable:!0,get:function(){return this.uniforms.dashArray.value},set:function(t){this.uniforms.dashArray.value=t,this.useDash=t!==0?1:0}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},dashRatio:{enumerable:!0,get:function(){return this.uniforms.dashRatio.value},set:function(t){this.uniforms.dashRatio.value=t}},useDash:{enumerable:!0,get:function(){return this.uniforms.useDash.value},set:function(t){this.uniforms.useDash.value=t}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(t){this.uniforms.visibility.value=t}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(t){this.uniforms.alphaTest.value=t}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(t){this.uniforms.repeat.value.copy(t)}},offset:{enumerable:!0,get:function(){return this.uniforms.offset.value},set:function(t){this.uniforms.offset.value.copy(t)}}}),this.setValues(e)}}Wf.prototype.copy=function(n){return V.ShaderMaterial.prototype.copy.call(this,n),this.lineWidth=n.lineWidth,this.map=n.map,this.useMap=n.useMap,this.alphaMap=n.alphaMap,this.useAlphaMap=n.useAlphaMap,this.color.copy(n.color),this.opacity=n.opacity,this.resolution.copy(n.resolution),this.sizeAttenuation=n.sizeAttenuation,this.dashArray.copy(n.dashArray),this.dashOffset.copy(n.dashOffset),this.dashRatio.copy(n.dashRatio),this.useDash=n.useDash,this.visibility=n.visibility,this.alphaTest=n.alphaTest,this.repeat.copy(n.repeat),this};const _w=["object"],Th=ue({__name:"GeoMeshline",props:{points:{},color:{},width:{},sizeAttenuation:{type:Boolean,default:!0},dashArray:{},dashRatio:{},dashOffset:{},map:{},renderOrder:{default:1},opacity:{default:1},repeat:{default:()=>[1,1]},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","doubleclick","contextmenu","pointerenter","pointerleave","pointerover","pointerdown","pointerup","wheel"],setup(n,{emit:e}){const t=n,r=e,i=Re(),s=Re(),o=Re(),a=Ne([]),l=Ne(new P),c=ns(r,t,t.raycastActive),u=Fi("registerAnimationTarget"),h=Fi("unregisterAnimationTarget"),d=m=>{const g=new xt,_=new Float32Array(m.length*3);return m.forEach((v,y)=>{_[y*3]=v.x,_[y*3+1]=v.y,_[y*3+2]=v.z}),g.setAttribute("position",new Ce(_,3)),g},f=()=>{if(t.points.length<2)return;i.value=new Ae,a.value=io(t.points),l.value=no(a.value);const m=ro(a.value,l.value),g=d(m);s.value=new cn,s.value.setGeometry(g);const _={color:t.color||"#ffffff",lineWidth:t.width||1,dashArray:0,dashRatio:0,dashOffset:0,useDash:0,sizeAttenuation:t.sizeAttenuation?1:0,transparent:!0,depthTest:!1,depthWrite:!1,repeat:new Z(...t.repeat)};t.map&&(_.map=t.map,_.useMap=1);const v=new Wf(_);o.value=new Tt(s.value.geometry,v),o.value.renderOrder=t.renderOrder,t.raycastActive&&Yn(o.value,t.raycastMultiplier),i.value.add(o.value),i.value.position.copy(l.value),u&&u(o.value,"meshline",t.map)};U(()=>t.repeat,m=>{if(o.value&&o.value.material){const g=o.value.material;g.uniforms.repeat.value.set(m[0],m[1]),g.needsUpdate=!0}},{immediate:!0}),U(()=>t.opacity,m=>{if(o.value&&o.value.material){const g=o.value.material;g.opacity=m!==void 0?m:1,g.needsUpdate=!0}},{immediate:!0});const p=()=>{if(!s.value||!o.value||t.points.length<2)return;a.value=io(t.points),l.value=no(a.value);const m=ro(a.value,l.value),g=d(m);s.value.setGeometry(g),i.value.position.copy(l.value)};return U(()=>t.points,()=>{t.points.length>=2&&p()},{deep:!0}),U(()=>[t.color,t.width],()=>{if(o.value){const m=o.value.material;m.uniforms&&(m.uniforms.color&&m.uniforms.color.value.set(t.color||"#ffffff"),m.uniforms.lineWidth&&(m.uniforms.lineWidth.value=t.width||1),m.uniforms.useDash&&(m.uniforms.useDash.value=0),m.uniforms.dashArray&&(m.uniforms.dashArray.value=0))}}),U(()=>t.map,m=>{if(o.value){const g=o.value.material;m?(g.uniforms&&(g.uniforms.map.value=m,g.uniforms.useMap.value=1),u&&u(o.value,"meshline",m)):(g.uniforms&&(g.uniforms.map.value=null,g.uniforms.useMap.value=0),u&&u(o.value,"meshline",void 0))}}),Me(()=>{f()}),tt(()=>{if(o.value&&(h&&h(o.value),o.value.geometry&&o.value.geometry.dispose(),o.value.material)){const m=o.value.material;m.dispose&&m.dispose()}i.value&&i.value.clear()}),(m,g)=>i.value?(re(),Ee("primitive",{key:0,object:i.value,onClick:g[0]||(g[0]=(..._)=>C(c).handleClick&&C(c).handleClick(..._)),onDoubleclick:g[1]||(g[1]=(..._)=>C(c).handleDoubleClick&&C(c).handleDoubleClick(..._)),onContextmenu:g[2]||(g[2]=(..._)=>C(c).handleContextMenu&&C(c).handleContextMenu(..._)),onPointerenter:g[3]||(g[3]=(..._)=>C(c).handlePointerEnter&&C(c).handlePointerEnter(..._)),onPointerleave:g[4]||(g[4]=(..._)=>C(c).handlePointerLeave&&C(c).handlePointerLeave(..._)),onPointerover:g[5]||(g[5]=(..._)=>C(c).handlePointerOver&&C(c).handlePointerOver(..._)),onPointerdown:g[6]||(g[6]=(..._)=>C(c).handlePointerDown&&C(c).handlePointerDown(..._)),onPointerup:g[7]||(g[7]=(..._)=>C(c).handlePointerUp&&C(c).handlePointerUp(..._)),onWheel:g[8]||(g[8]=(..._)=>C(c).handleWheel&&C(c).handleWheel(..._))},[Ct(m.$slots,"default")],40,_w)):at("",!0)}}),vw=ue({__name:"GeoLineAnimation",props:{texture:{},autoStart:{type:Boolean,default:!0},duration:{default:1e3},reverse:{type:Boolean,default:!1},speed:{default:1}},setup(n,{expose:e}){const t=n,r=Ne({startTime:0,isAnimating:!1}),i=Ne([]),{onRender:s}=Yi();oh("registerAnimationTarget",(l,c,u)=>{const h=i.value.findIndex(d=>d.target===l);h>=0?i.value[h]={target:l,type:c,texture:u}:i.value.push({target:l,type:c,texture:u})}),oh("unregisterAnimationTarget",l=>{const c=i.value.findIndex(u=>u.target===l);c>=0&&i.value.splice(c,1)}),s(({elapsed:l})=>{!t.autoStart||!t.duration||!r.value.isAnimating||i.value.length!==0&&i.value.forEach(({target:c,type:u,texture:h})=>{if(c){if(u==="meshline")fw(c.material,l*1e3,t.duration,r.value,t.reverse,t.speed);else if(u==="texture"){const d=h||t.texture;d&&pw(d,l*1e3,t.duration,r.value,t.reverse,t.speed)}}})});const o=()=>{t.duration&&hw(r.value)},a=()=>{dw(r.value)};return U(()=>t.duration,l=>{l&&t.autoStart&&i.value.length>0?o():a()}),U(()=>t.texture,l=>{l&&t.duration&&t.autoStart&&i.value.length>0?o():a()}),U(()=>t.reverse,()=>{t.autoStart&&t.duration&&i.value.length>0&&(a(),setTimeout(()=>{o()},10))}),Me(()=>{t.autoStart&&t.duration&&setTimeout(()=>{i.value.length>0&&o()},100)}),tt(()=>{a()}),e({start:o,stop:a,isAnimating:()=>r.value.isAnimating,getAnimationTargets:()=>i.value,getTargetCount:()=>i.value.length}),(l,c)=>Ct(l.$slots,"default")}}),SP=ue({__name:"GeoFlyline",props:{start:{},end:{},type:{default:"mesh"},color:{default:"#ffffff"},width:{default:1},map:{},autoStart:{type:Boolean,default:!0},arcHeight:{default:0},segments:{default:20},tubularSegments:{},renderOrder:{default:1},duration:{default:2e3},reverse:{type:Boolean,default:!1},opacity:{default:1},repeat:{default:()=>[1,1]},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","doubleclick","contextmenu","pointerenter","pointerleave","pointerover","pointerdown","pointerup","wheel"],setup(n,{expose:e,emit:t}){const r=n,i=t,s=Ne([]),o=Ne(),a=Fi("registerAnimationTarget",null),l=gc(()=>a!==null),c=(h,d)=>{const f=d.lon-h.lon,p=d.lat-h.lat;return Math.sqrt(f*f+p*p)},u=()=>{const{start:h,end:d,arcHeight:f,segments:p}=r,m=[],g=c(h,d),_=f||g*.2,v=h.height||0,y=d.height||0;for(let T=0;T<=p;T++){const A=T/p,w=h.lon+(d.lon-h.lon)*A,x=h.lat+(d.lat-h.lat)*A,b=v+(y-v)*A,E=4*_*A*(1-A);m.push({lon:w,lat:x,height:b+E})}s.value=m};return U(()=>[r.start,r.end,r.arcHeight,r.segments],()=>{u()},{deep:!0,immediate:!0}),Me(()=>{u()}),e({startAnimation:()=>{if(l.value){console.warn("GeoFlyline is wrapped by GeoLineAnimation, please control animation through parent component");return}return o.value?.start()},stopAnimation:()=>{if(l.value){console.warn("GeoFlyline is wrapped by GeoLineAnimation, please control animation through parent component");return}return o.value?.stop()},isAnimating:()=>l.value?!1:o.value?.isAnimating()||!1}),(h,d)=>l.value?(re(),Ee(Mb,{key:1},[r.type==="tube"?(re(),Ft(wh,{key:0,points:s.value,color:r.color,width:r.width,map:r.map,tubularSegments:r.tubularSegments,renderOrder:r.renderOrder,opacity:r.opacity,repeat:r.repeat,id:r.id,raycastActive:r.raycastActive,raycastMultiplier:r.raycastMultiplier,onClick:d[18]||(d[18]=(...f)=>i("click",...f)),onDoubleclick:d[19]||(d[19]=(...f)=>i("doubleclick",...f)),onContextmenu:d[20]||(d[20]=(...f)=>i("contextmenu",...f)),onPointerenter:d[21]||(d[21]=(...f)=>i("pointerenter",...f)),onPointerleave:d[22]||(d[22]=(...f)=>i("pointerleave",...f)),onPointerover:d[23]||(d[23]=(...f)=>i("pointerover",...f)),onPointerdown:d[24]||(d[24]=(...f)=>i("pointerdown",...f)),onPointerup:d[25]||(d[25]=(...f)=>i("pointerup",...f)),onWheel:d[26]||(d[26]=(...f)=>i("wheel",...f))},null,8,["points","color","width","map","tubularSegments","renderOrder","opacity","repeat","id","raycastActive","raycastMultiplier"])):(re(),Ft(Th,{key:1,points:s.value,color:r.color,width:r.width,map:r.map,renderOrder:r.renderOrder,opacity:r.opacity,repeat:r.repeat,id:r.id,raycastActive:r.raycastActive,raycastMultiplier:r.raycastMultiplier,onClick:d[27]||(d[27]=(...f)=>i("click",...f)),onDoubleclick:d[28]||(d[28]=(...f)=>i("doubleclick",...f)),onContextmenu:d[29]||(d[29]=(...f)=>i("contextmenu",...f)),onPointerenter:d[30]||(d[30]=(...f)=>i("pointerenter",...f)),onPointerleave:d[31]||(d[31]=(...f)=>i("pointerleave",...f)),onPointerover:d[32]||(d[32]=(...f)=>i("pointerover",...f)),onPointerdown:d[33]||(d[33]=(...f)=>i("pointerdown",...f)),onPointerup:d[34]||(d[34]=(...f)=>i("pointerup",...f)),onWheel:d[35]||(d[35]=(...f)=>i("wheel",...f))},null,8,["points","color","width","map","renderOrder","opacity","repeat","id","raycastActive","raycastMultiplier"]))],64)):(re(),Ft(vw,{key:0,ref_key:"animationRef",ref:o,texture:r.map,autoStart:r.autoStart,duration:r.duration,reverse:r.reverse},{default:Qi(()=>[r.type==="tube"?(re(),Ft(wh,{key:0,points:s.value,color:r.color,width:r.width,map:r.map,tubularSegments:r.tubularSegments,renderOrder:r.renderOrder,opacity:r.opacity,repeat:r.repeat,id:r.id,raycastActive:r.raycastActive,raycastMultiplier:r.raycastMultiplier,onClick:d[0]||(d[0]=(...f)=>i("click",...f)),onDoubleclick:d[1]||(d[1]=(...f)=>i("doubleclick",...f)),onContextmenu:d[2]||(d[2]=(...f)=>i("contextmenu",...f)),onPointerenter:d[3]||(d[3]=(...f)=>i("pointerenter",...f)),onPointerleave:d[4]||(d[4]=(...f)=>i("pointerleave",...f)),onPointerover:d[5]||(d[5]=(...f)=>i("pointerover",...f)),onPointerdown:d[6]||(d[6]=(...f)=>i("pointerdown",...f)),onPointerup:d[7]||(d[7]=(...f)=>i("pointerup",...f)),onWheel:d[8]||(d[8]=(...f)=>i("wheel",...f))},null,8,["points","color","width","map","tubularSegments","renderOrder","opacity","repeat","id","raycastActive","raycastMultiplier"])):(re(),Ft(Th,{key:1,points:s.value,color:r.color,width:r.width,map:r.map,renderOrder:r.renderOrder,opacity:r.opacity,repeat:r.repeat,id:r.id,raycastActive:r.raycastActive,raycastMultiplier:r.raycastMultiplier,onClick:d[9]||(d[9]=(...f)=>i("click",...f)),onDoubleclick:d[10]||(d[10]=(...f)=>i("doubleclick",...f)),onContextmenu:d[11]||(d[11]=(...f)=>i("contextmenu",...f)),onPointerenter:d[12]||(d[12]=(...f)=>i("pointerenter",...f)),onPointerleave:d[13]||(d[13]=(...f)=>i("pointerleave",...f)),onPointerover:d[14]||(d[14]=(...f)=>i("pointerover",...f)),onPointerdown:d[15]||(d[15]=(...f)=>i("pointerdown",...f)),onPointerup:d[16]||(d[16]=(...f)=>i("pointerup",...f)),onWheel:d[17]||(d[17]=(...f)=>i("wheel",...f))},null,8,["points","color","width","map","renderOrder","opacity","repeat","id","raycastActive","raycastMultiplier"]))]),_:1},8,["texture","autoStart","duration","reverse"]))}}),rn=11102230246251565e-32,Le=134217729,yw=(3+8*rn)*rn;function Xo(n,e,t,r,i){let s,o,a,l,c=e[0],u=r[0],h=0,d=0;u>c==u>-c?(s=c,c=e[++h]):(s=u,u=r[++d]);let f=0;if(h<n&&d<t)for(u>c==u>-c?(o=c+s,a=s-(o-c),c=e[++h]):(o=u+s,a=s-(o-u),u=r[++d]),s=o,a!==0&&(i[f++]=a);h<n&&d<t;)u>c==u>-c?(o=s+c,l=o-s,a=s-(o-l)+(c-l),c=e[++h]):(o=s+u,l=o-s,a=s-(o-l)+(u-l),u=r[++d]),s=o,a!==0&&(i[f++]=a);for(;h<n;)o=s+c,l=o-s,a=s-(o-l)+(c-l),c=e[++h],s=o,a!==0&&(i[f++]=a);for(;d<t;)o=s+u,l=o-s,a=s-(o-l)+(u-l),u=r[++d],s=o,a!==0&&(i[f++]=a);return(s!==0||f===0)&&(i[f++]=s),f}function bw(n,e){let t=e[0];for(let r=1;r<n;r++)t+=e[r];return t}function rs(n){return new Float64Array(n)}const ww=(3+16*rn)*rn,Tw=(2+12*rn)*rn,xw=(9+64*rn)*rn*rn,lr=rs(4),xh=rs(8),Eh=rs(12),Ah=rs(16),Ue=rs(4);function Ew(n,e,t,r,i,s,o){let a,l,c,u,h,d,f,p,m,g,_,v,y,T,A,w,x,b;const E=n-i,M=t-i,S=e-s,O=r-s;T=E*O,d=Le*E,f=d-(d-E),p=E-f,d=Le*O,m=d-(d-O),g=O-m,A=p*g-(T-f*m-p*m-f*g),w=S*M,d=Le*S,f=d-(d-S),p=S-f,d=Le*M,m=d-(d-M),g=M-m,x=p*g-(w-f*m-p*m-f*g),_=A-x,h=A-_,lr[0]=A-(_+h)+(h-x),v=T+_,h=v-T,y=T-(v-h)+(_-h),_=y-w,h=y-_,lr[1]=y-(_+h)+(h-w),b=v+_,h=b-v,lr[2]=v-(b-h)+(_-h),lr[3]=b;let L=bw(4,lr),I=Tw*o;if(L>=I||-L>=I||(h=n-E,a=n-(E+h)+(h-i),h=t-M,c=t-(M+h)+(h-i),h=e-S,l=e-(S+h)+(h-s),h=r-O,u=r-(O+h)+(h-s),a===0&&l===0&&c===0&&u===0)||(I=xw*o+yw*Math.abs(L),L+=E*u+O*a-(S*c+M*l),L>=I||-L>=I))return L;T=a*O,d=Le*a,f=d-(d-a),p=a-f,d=Le*O,m=d-(d-O),g=O-m,A=p*g-(T-f*m-p*m-f*g),w=l*M,d=Le*l,f=d-(d-l),p=l-f,d=Le*M,m=d-(d-M),g=M-m,x=p*g-(w-f*m-p*m-f*g),_=A-x,h=A-_,Ue[0]=A-(_+h)+(h-x),v=T+_,h=v-T,y=T-(v-h)+(_-h),_=y-w,h=y-_,Ue[1]=y-(_+h)+(h-w),b=v+_,h=b-v,Ue[2]=v-(b-h)+(_-h),Ue[3]=b;const N=Xo(4,lr,4,Ue,xh);T=E*u,d=Le*E,f=d-(d-E),p=E-f,d=Le*u,m=d-(d-u),g=u-m,A=p*g-(T-f*m-p*m-f*g),w=S*c,d=Le*S,f=d-(d-S),p=S-f,d=Le*c,m=d-(d-c),g=c-m,x=p*g-(w-f*m-p*m-f*g),_=A-x,h=A-_,Ue[0]=A-(_+h)+(h-x),v=T+_,h=v-T,y=T-(v-h)+(_-h),_=y-w,h=y-_,Ue[1]=y-(_+h)+(h-w),b=v+_,h=b-v,Ue[2]=v-(b-h)+(_-h),Ue[3]=b;const R=Xo(N,xh,4,Ue,Eh);T=a*u,d=Le*a,f=d-(d-a),p=a-f,d=Le*u,m=d-(d-u),g=u-m,A=p*g-(T-f*m-p*m-f*g),w=l*c,d=Le*l,f=d-(d-l),p=l-f,d=Le*c,m=d-(d-c),g=c-m,x=p*g-(w-f*m-p*m-f*g),_=A-x,h=A-_,Ue[0]=A-(_+h)+(h-x),v=T+_,h=v-T,y=T-(v-h)+(_-h),_=y-w,h=y-_,Ue[1]=y-(_+h)+(h-w),b=v+_,h=b-v,Ue[2]=v-(b-h)+(_-h),Ue[3]=b;const z=Xo(R,Eh,4,Ue,Ah);return Ah[z-1]}function ds(n,e,t,r,i,s){const o=(e-s)*(t-i),a=(n-i)*(r-s),l=o-a,c=Math.abs(o+a);return Math.abs(l)>=ww*c?l:-Ew(n,e,t,r,i,s,c)}const Ph=Math.pow(2,-52),ps=new Uint32Array(512);class Mc{static from(e,t=Cw,r=Rw){const i=e.length,s=new Float64Array(i*2);for(let o=0;o<i;o++){const a=e[o];s[2*o]=t(a),s[2*o+1]=r(a)}return new Mc(s)}constructor(e){const t=e.length>>1;if(t>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const r=Math.max(2*t-5,0);this._triangles=new Uint32Array(r*3),this._halfedges=new Int32Array(r*3),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:r,_hullTri:i,_hullHash:s}=this,o=e.length>>1;let a=1/0,l=1/0,c=-1/0,u=-1/0;for(let E=0;E<o;E++){const M=e[2*E],S=e[2*E+1];M<a&&(a=M),S<l&&(l=S),M>c&&(c=M),S>u&&(u=S),this._ids[E]=E}const h=(a+c)/2,d=(l+u)/2;let f,p,m;for(let E=0,M=1/0;E<o;E++){const S=Yo(h,d,e[2*E],e[2*E+1]);S<M&&(f=E,M=S)}const g=e[2*f],_=e[2*f+1];for(let E=0,M=1/0;E<o;E++){if(E===f)continue;const S=Yo(g,_,e[2*E],e[2*E+1]);S<M&&S>0&&(p=E,M=S)}let v=e[2*p],y=e[2*p+1],T=1/0;for(let E=0;E<o;E++){if(E===f||E===p)continue;const M=Mw(g,_,v,y,e[2*E],e[2*E+1]);M<T&&(m=E,T=M)}let A=e[2*m],w=e[2*m+1];if(T===1/0){for(let S=0;S<o;S++)this._dists[S]=e[2*S]-e[0]||e[2*S+1]-e[1];yr(this._ids,this._dists,0,o-1);const E=new Uint32Array(o);let M=0;for(let S=0,O=-1/0;S<o;S++){const L=this._ids[S],I=this._dists[L];I>O&&(E[M++]=L,O=I)}this.hull=E.subarray(0,M),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(ds(g,_,v,y,A,w)<0){const E=p,M=v,S=y;p=m,v=A,y=w,m=E,A=M,w=S}const x=Sw(g,_,v,y,A,w);this._cx=x.x,this._cy=x.y;for(let E=0;E<o;E++)this._dists[E]=Yo(e[2*E],e[2*E+1],x.x,x.y);yr(this._ids,this._dists,0,o-1),this._hullStart=f;let b=3;r[f]=t[m]=p,r[p]=t[f]=m,r[m]=t[p]=f,i[f]=0,i[p]=1,i[m]=2,s.fill(-1),s[this._hashKey(g,_)]=f,s[this._hashKey(v,y)]=p,s[this._hashKey(A,w)]=m,this.trianglesLen=0,this._addTriangle(f,p,m,-1,-1,-1);for(let E=0,M,S;E<this._ids.length;E++){const O=this._ids[E],L=e[2*O],I=e[2*O+1];if(E>0&&Math.abs(L-M)<=Ph&&Math.abs(I-S)<=Ph||(M=L,S=I,O===f||O===p||O===m))continue;let N=0;for(let B=0,G=this._hashKey(L,I);B<this._hashSize&&(N=s[(G+B)%this._hashSize],!(N!==-1&&N!==r[N]));B++);N=t[N];let R=N,z;for(;z=r[R],ds(L,I,e[2*R],e[2*R+1],e[2*z],e[2*z+1])>=0;)if(R=z,R===N){R=-1;break}if(R===-1)continue;let F=this._addTriangle(R,O,r[R],-1,-1,i[R]);i[O]=this._legalize(F+2),i[R]=F,b++;let $=r[R];for(;z=r[$],ds(L,I,e[2*$],e[2*$+1],e[2*z],e[2*z+1])<0;)F=this._addTriangle($,O,z,i[O],-1,i[$]),i[O]=this._legalize(F+2),r[$]=$,b--,$=z;if(R===N)for(;z=t[R],ds(L,I,e[2*z],e[2*z+1],e[2*R],e[2*R+1])<0;)F=this._addTriangle(z,O,R,-1,i[R],i[z]),this._legalize(F+2),i[z]=F,r[R]=R,b--,R=z;this._hullStart=t[O]=R,r[R]=t[$]=O,r[O]=$,s[this._hashKey(L,I)]=O,s[this._hashKey(e[2*R],e[2*R+1])]=R}this.hull=new Uint32Array(b);for(let E=0,M=this._hullStart;E<b;E++)this.hull[E]=M,M=r[M];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(Aw(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:r,coords:i}=this;let s=0,o=0;for(;;){const a=r[e],l=e-e%3;if(o=l+(e+2)%3,a===-1){if(s===0)break;e=ps[--s];continue}const c=a-a%3,u=l+(e+1)%3,h=c+(a+2)%3,d=t[o],f=t[e],p=t[u],m=t[h];if(Pw(i[2*d],i[2*d+1],i[2*f],i[2*f+1],i[2*p],i[2*p+1],i[2*m],i[2*m+1])){t[e]=m,t[a]=d;const g=r[h];if(g===-1){let v=this._hullStart;do{if(this._hullTri[v]===h){this._hullTri[v]=e;break}v=this._hullPrev[v]}while(v!==this._hullStart)}this._link(e,g),this._link(a,r[o]),this._link(o,h);const _=c+(a+1)%3;s<ps.length&&(ps[s++]=_)}else{if(s===0)break;e=ps[--s]}}return o}_link(e,t){this._halfedges[e]=t,t!==-1&&(this._halfedges[t]=e)}_addTriangle(e,t,r,i,s,o){const a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=t,this._triangles[a+2]=r,this._link(a,i),this._link(a+1,s),this._link(a+2,o),this.trianglesLen+=3,a}}function Aw(n,e){const t=n/(Math.abs(n)+Math.abs(e));return(e>0?3-t:1+t)/4}function Yo(n,e,t,r){const i=n-t,s=e-r;return i*i+s*s}function Pw(n,e,t,r,i,s,o,a){const l=n-o,c=e-a,u=t-o,h=r-a,d=i-o,f=s-a,p=l*l+c*c,m=u*u+h*h,g=d*d+f*f;return l*(h*g-m*f)-c*(u*g-m*d)+p*(u*f-h*d)<0}function Mw(n,e,t,r,i,s){const o=t-n,a=r-e,l=i-n,c=s-e,u=o*o+a*a,h=l*l+c*c,d=.5/(o*c-a*l),f=(c*u-a*h)*d,p=(o*h-l*u)*d;return f*f+p*p}function Sw(n,e,t,r,i,s){const o=t-n,a=r-e,l=i-n,c=s-e,u=o*o+a*a,h=l*l+c*c,d=.5/(o*c-a*l),f=n+(c*u-a*h)*d,p=e+(o*h-l*u)*d;return{x:f,y:p}}function yr(n,e,t,r){if(r-t<=20)for(let i=t+1;i<=r;i++){const s=n[i],o=e[s];let a=i-1;for(;a>=t&&e[n[a]]>o;)n[a+1]=n[a--];n[a+1]=s}else{const i=t+r>>1;let s=t+1,o=r;oi(n,i,s),e[n[t]]>e[n[r]]&&oi(n,t,r),e[n[s]]>e[n[r]]&&oi(n,s,r),e[n[t]]>e[n[s]]&&oi(n,t,s);const a=n[s],l=e[a];for(;;){do s++;while(e[n[s]]<l);do o--;while(e[n[o]]>l);if(o<s)break;oi(n,s,o)}n[t+1]=n[o],n[o]=a,r-s+1>=o-t?(yr(n,e,s,r),yr(n,e,t,o-1)):(yr(n,e,t,o-1),yr(n,e,s,r))}}function oi(n,e,t){const r=n[e];n[e]=n[t],n[t]=r}function Cw(n){return n[0]}function Rw(n){return n[1]}const Pi=(n,e)=>{let t=!1;const r=n[0],i=n[1];let s=e.length-1;for(let o=0;o<e.length;o++){const a=e[o][0],l=e[o][1],c=e[s][0],u=e[s][1];l>i!=u>i&&r<(c-a)*(i-l)/(u-l)+a&&(t=!t),s=o}return t},Tl=(n,e)=>{for(const t of e)if(Pi(n,t))return!0;return!1},so=n=>{let e=0;for(let t=0,r=n.length;t<r;t++){const i=(t+1)%r;e+=n[t][0]*n[i][1],e-=n[i][0]*n[t][1]}return e<0},oo=n=>{const e=10000000000000001e-36;let t=n[0];for(let r=1;r<=n.length;r++){const i=r%n.length,s=n[i],o=s[0]-t[0],a=s[1]-t[1],l=o*o+a*a,c=Math.max(Math.abs(s[0]),Math.abs(s[1]),Math.abs(t[0]),Math.abs(t[1])),u=e*c*c;if(l<=u){n.splice(i,1),r--;continue}t=s}},ao=(n,e)=>{if(e<=1)return[...n];const t=[];let r=0;for(let s=0;s<n.length;s++){const o=n[s],a=n[(s+1)%n.length],l=a[0]-o[0],c=a[1]-o[1];r+=Math.sqrt(l*l+c*c)}const i=r/(e*50);for(let s=0;s<n.length;s++){const o=n[s],a=n[(s+1)%n.length];t.push(o);const l=a[0]-o[0],c=a[1]-o[1],u=Math.sqrt(l*l+c*c),h=Math.max(1,Math.ceil(u/i));for(let d=1;d<h;d++){const f=d/h,p=[o[0]+f*l,o[1]+f*c];t.push(p)}}return t},Mh=(n,e,t=1e-10)=>{const[r,i]=n;for(let s=0;s<e.length;s++){const o=(s+1)%e.length,[a,l]=e[s],[c,u]=e[o],h=(i-l)*(c-a)-(r-a)*(u-l);if(Math.abs(h)<t){const d=(r-a)*(c-a)+(i-l)*(u-l),f=(c-a)*(c-a)+(u-l)*(u-l);if(d>=0&&d<=f)return!0}}return!1},Ow=(n,e,t,r)=>{const i=n[0],s=n[1],o=e[0],a=e[1],l=t[0],c=t[1],u=r[0],h=r[1],d=(i-o)*(c-h)-(s-a)*(l-u);if(Math.abs(d)<1e-10)return!1;const f=((i-l)*(c-h)-(s-c)*(l-u))/d,p=-((i-o)*(s-c)-(s-a)*(i-l))/d;return f>=0&&f<=1&&p>=0&&p<=1},kw=(n,e,t)=>{for(let r=0;r<t.length;r++){const i=(r+1)%t.length,s=t[r],o=t[i],a=Math.abs(n[0]-s[0])<1e-10&&Math.abs(n[1]-s[1])<1e-10,l=Math.abs(n[0]-o[0])<1e-10&&Math.abs(n[1]-o[1])<1e-10,c=Math.abs(e[0]-s[0])<1e-10&&Math.abs(e[1]-s[1])<1e-10,u=Math.abs(e[0]-o[0])<1e-10&&Math.abs(e[1]-o[1])<1e-10;if(!(a||l||c||u)&&Ow(n,e,s,o))return!0}return!1},Lw=(n,e,t,r,i)=>{const s=[(n[0]+e[0]+t[0])/3,(n[1]+e[1]+t[1])/3];if(!Pi(s,r)||Tl(s,i))return!1;const o=[[n,e],[e,t],[t,n]];for(const l of i)for(const c of o)if(kw(c[0],c[1],l))return!1;const a=[n,e,t];for(const l of a)if(!Pi(l,r)||Tl(l,i)){let c=!1;for(const u of i)if(Mh(l,u)){c=!0;break}if(!c&&!Mh(l,r))return!1}return!i.some(l=>a.every(c=>Pi(c,l)))},Kf=(n,e,t)=>{const r=[...n];for(const o of e)r.push(...o);r.push(...t);const i=Mc.from(r).triangles,s=[];for(let o=0;o<i.length;o+=3){const a=r[i[o]],l=r[i[o+1]],c=r[i[o+2]];Lw(a,l,c,n,e)&&s.push(a,l,c)}return s},qf=(n,e,t)=>{const r=[];if(t<=1)return r;const i=n.map(p=>p[0]),s=n.map(p=>p[1]),o=Math.min.apply(null,i),a=Math.max.apply(null,i),l=Math.min.apply(null,s),c=Math.max.apply(null,s),u=a-o,h=c-l,d=u/(t*10),f=h/(t*10);for(let p=o+d;p<a;p+=d)for(let m=l+f;m<c;m+=f){const g=[p,m];Pi(g,n)&&!Tl(g,e)&&r.push(g)}return r},Iw=["position"],Dw=["object"],CP=ue({__name:"GeoPolygon",props:{geometry:{},subdivisions:{default:2},height:{default:30},renderOrder:{default:1},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","doubleclick","contextmenu","pointerenter","pointerleave","pointerover","pointerdown","pointerup","wheel"],setup(n,{emit:e}){const t=n,r=e,i=Re(),s=Ne(new P),o=ns(r,t,t.raycastActive),a=f=>f.map(([p,m,g=t.height])=>({lon:p,lat:m,height:g})),l=f=>{let p;if(f.type==="Polygon")p=[f.coordinates];else if(f.type==="MultiPolygon")p=f.coordinates;else throw new Error("不支持的几何类型，仅支持Polygon和MultiPolygon");const m=[],g=[];return p.forEach(_=>{if(_.length===0)return;const v=a(_[0]);m.push(v);const y=[];for(let T=1;T<_.length;T++){const A=a(_[T]);y.push(A)}g.push(y)}),{contours:m,holes:g}},c=f=>{const{contours:p,holes:m}=l(t.geometry);if(p.length===0)throw new Error("没有有效的多边形轮廓");const g=[],_=[];p.forEach((y,T)=>{if(y.length<3){console.warn(`多边形${T}的顶点数少于3，跳过`);return}const A=m[T]||[];let w=y.map(B=>[B.lon,B.lat]),x=A.map(B=>B.map(G=>[G.lon,G.lat]));!so(w)&&w.reverse();for(let B=0;B<x.length;B++){const G=x[B];so(G)&&(x[B]=G.reverse())}oo(w),x.forEach(B=>oo(B));const b=Math.max(1,t.subdivisions);w=ao(w,b),x=x.map(B=>ao(B,b));const E=qf(w,x,b),M=Kf(w,x,E),S=t.height??0,O=M.map(B=>B[0]),L=M.map(B=>B[1]),I=Math.min.apply(null,O),N=Math.max.apply(null,O),R=Math.min.apply(null,L),z=Math.max.apply(null,L),F=N-I,$=z-R;M.forEach(([B,G])=>{const ye=He(B,G,S);g.push(ye.x-f.x,ye.y-f.y,ye.z-f.z);const Y=F>0?(B-I)/F:0,he=$>0?1-(G-R)/$:0;_.push(Y,he)})});const v=new xt;return v.setAttribute("position",new St(g,3)),v.setAttribute("uv",new St(_,2)),v.computeVertexNormals(),v},u=()=>{try{const{contours:f}=l(t.geometry);if(f.length===0||f[0].length<3){console.warn("多边形至少需要3个点");return}const p=d(t.geometry);s.value=p;const m=c(p);i.value=new Tt(m),i.value.renderOrder=t.renderOrder,t.raycastActive&&Yn(i.value,t.raycastMultiplier)}catch(f){console.error("创建多边形失败:",f)}},h=()=>{if(i.value)try{const{contours:f}=l(t.geometry);if(f.length===0||f[0].length<3)return;const p=i.value.geometry,m=d(t.geometry);s.value=m;const g=c(m);i.value.geometry=g,p.dispose()}catch(f){console.error("更新几何体失败:",f)}};U(()=>t.geometry,()=>{h()},{deep:!0}),U(()=>t.subdivisions,()=>{h()}),U(()=>t.height,()=>{h()});const d=f=>{const{contours:p}=l(f);if(p.length===0)return new P;let m=0,g=0,_=0;if(p.forEach(A=>{A.forEach(w=>{m+=w.lon,g+=w.lat,_++})}),_===0)return new P;const v=m/_,y=g/_,T=t.height??0;return new P(...He(v,y,T))};return Me(()=>{u()}),tt(()=>{i.value&&i.value.geometry?.dispose?.()}),(f,p)=>i.value?(re(),Ee("TresGroup",{key:0,position:s.value},[nr("primitive",{object:i.value,onClick:p[0]||(p[0]=(...m)=>C(o).handleClick&&C(o).handleClick(...m)),onDoubleclick:p[1]||(p[1]=(...m)=>C(o).handleDoubleClick&&C(o).handleDoubleClick(...m)),onContextmenu:p[2]||(p[2]=(...m)=>C(o).handleContextMenu&&C(o).handleContextMenu(...m)),onPointerenter:p[3]||(p[3]=(...m)=>C(o).handlePointerEnter&&C(o).handlePointerEnter(...m)),onPointerleave:p[4]||(p[4]=(...m)=>C(o).handlePointerLeave&&C(o).handlePointerLeave(...m)),onPointerover:p[5]||(p[5]=(...m)=>C(o).handlePointerOver&&C(o).handlePointerOver(...m)),onPointerdown:p[6]||(p[6]=(...m)=>C(o).handlePointerDown&&C(o).handlePointerDown(...m)),onPointerup:p[7]||(p[7]=(...m)=>C(o).handlePointerUp&&C(o).handlePointerUp(...m)),onWheel:p[8]||(p[8]=(...m)=>C(o).handleWheel&&C(o).handleWheel(...m))},[Ct(f.$slots,"default")],40,Dw)],8,Iw)):at("",!0)}}),Nw=["position"],Fw=["object"],RP=ue({__name:"GeoWall",props:{geometry:{},height:{default:100},baseHeight:{default:0},renderOrder:{default:1},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","doubleclick","contextmenu","pointerenter","pointerleave","pointerover","pointerdown","pointerup","wheel"],setup(n,{emit:e}){const t=n,r=e,i=Re(),s=Ne(new P),o=ns(r,t,t.raycastActive),a=f=>f.map(([p,m,g=0])=>({lon:p,lat:m,height:g})),l=f=>{const p=[];switch(f.type){case"LineString":p.push(a(f.coordinates));break;case"MultiLineString":f.coordinates.forEach(m=>{p.push(a(m))});break;case"Polygon":f.coordinates.forEach(m=>{p.push(a(m))});break;case"MultiPolygon":f.coordinates.forEach(m=>{m.forEach(g=>{p.push(a(g))})});break;default:throw new Error(`不支持的几何类型: ${f.type}`)}return p},c=(f,p)=>{if(f.length===0)throw new Error("没有有效的线段数据");const m=[],g=[],_=[];let v=0;f.forEach(T=>{if(T.length<2){console.warn("线段至少需要2个点，跳过");return}const A=[...T],w=[],x=[];A.forEach(S=>{const O=He(S.lon,S.lat,t.baseHeight);w.push(new P(O.x-p.x,O.y-p.y,O.z-p.z));const L=He(S.lon,S.lat,t.baseHeight+t.height);x.push(new P(L.x-p.x,L.y-p.y,L.z-p.z))});const b=[0];let E=0;for(let S=1;S<w.length;S++){const O=w[S-1].distanceTo(w[S]);E+=O,b.push(E)}w.forEach((S,O)=>{m.push(S.x,S.y,S.z);const L=E>0?b[O]/E:0;_.push(L,0)}),x.forEach((S,O)=>{m.push(S.x,S.y,S.z);const L=E>0?b[O]/E:0;_.push(L,1)});const M=w.length;for(let S=0;S<M-1;S++){const O=v+S,L=v+S+1,I=v+S+M,N=v+S+1+M;g.push(O,L,I),g.push(L,N,I)}v+=M*2});const y=new xt;return y.setAttribute("position",new St(m,3)),y.setAttribute("uv",new St(_,2)),y.setIndex(g),y.computeVertexNormals(),y},u=()=>{try{const f=l(t.geometry);if(f.length===0){console.warn("没有有效的线段数据");return}const p=d(t.geometry);s.value=p;const m=c(f,p);i.value=new Tt(m),i.value.renderOrder=t.renderOrder,t.raycastActive&&Yn(i.value,t.raycastMultiplier)}catch(f){console.error("创建墙体失败:",f)}},h=()=>{if(i.value)try{const f=l(t.geometry);if(f.length===0){console.warn("没有有效的线段数据");return}const p=i.value.geometry,m=d(t.geometry);s.value=m;const g=c(f,m);i.value.geometry=g,p.dispose()}catch(f){console.error("更新几何体失败:",f)}};U(()=>t.geometry,()=>{h()},{deep:!0}),U(()=>t.height,()=>{h()}),U(()=>t.baseHeight,()=>{h()});const d=f=>{const p=l(f);if(p.length===0)return new P;let m=0,g=0,_=0;if(p.forEach(A=>{A.forEach(w=>{m+=w.lon,g+=w.lat,_++})}),_===0)return new P;const v=m/_,y=g/_,T=t.baseHeight+t.height/2;return new P(...He(v,y,T))};return Me(()=>{u()}),tt(()=>{i.value&&i.value.geometry.dispose()}),(f,p)=>i.value?(re(),Ee("TresGroup",{key:0,position:s.value},[nr("primitive",{object:i.value,onClick:p[0]||(p[0]=(...m)=>C(o).handleClick&&C(o).handleClick(...m)),onDoubleclick:p[1]||(p[1]=(...m)=>C(o).handleDoubleClick&&C(o).handleDoubleClick(...m)),onContextmenu:p[2]||(p[2]=(...m)=>C(o).handleContextMenu&&C(o).handleContextMenu(...m)),onPointerenter:p[3]||(p[3]=(...m)=>C(o).handlePointerEnter&&C(o).handlePointerEnter(...m)),onPointerleave:p[4]||(p[4]=(...m)=>C(o).handlePointerLeave&&C(o).handlePointerLeave(...m)),onPointerover:p[5]||(p[5]=(...m)=>C(o).handlePointerOver&&C(o).handlePointerOver(...m)),onPointerdown:p[6]||(p[6]=(...m)=>C(o).handlePointerDown&&C(o).handlePointerDown(...m)),onPointerup:p[7]||(p[7]=(...m)=>C(o).handlePointerUp&&C(o).handlePointerUp(...m)),onWheel:p[8]||(p[8]=(...m)=>C(o).handleWheel&&C(o).handleWheel(...m))},[Ct(f.$slots,"default")],40,Fw)],8,Nw)):at("",!0)}}),Uw=["position"],jw=["object"],Bw=["object"],zw=["object"],OP=ue({__name:"GeoBuilding",props:{geometry:{},subdivisions:{default:2},height:{default:100},baseHeight:{default:0},showTop:{type:Boolean,default:!0},showBottom:{type:Boolean,default:!1},showWalls:{type:Boolean,default:!0},renderOrder:{default:1},id:{},raycastActive:{type:Boolean,default:!0},raycastMultiplier:{default:1}},emits:["click","doubleclick","contextmenu","pointerenter","pointerleave","pointerover","pointerdown","pointerup","wheel"],setup(n,{emit:e}){const t=n,r=e,i=Re(),s=Re(),o=Re(),a=Ne(new P),l=ns(r,t,t.raycastActive),c=g=>g.map(([_,v,y=t.baseHeight])=>({lon:_,lat:v,height:y})),u=g=>{let _;if(g.type==="Polygon")_=[g.coordinates];else if(g.type==="MultiPolygon")_=g.coordinates;else throw new Error("GeoBuilding 只支持 Polygon 和 MultiPolygon 类型");const v=[],y=[];return _.forEach(T=>{if(T.length===0)return;const A=c(T[0]);v.push(A);const w=[];for(let x=1;x<T.length;x++){const b=c(T[x]);w.push(b)}y.push(w)}),{contours:v,holes:y}},h=(g,_)=>{const{contours:v,holes:y}=u(t.geometry);if(v.length===0)throw new Error("没有有效的多边形轮廓");const T=[],A=[];v.forEach((x,b)=>{if(x.length<3){console.warn(`多边形${b}的顶点数少于3，跳过`);return}const E=y[b]||[];let M=x.map(Y=>[Y.lon,Y.lat]),S=E.map(Y=>Y.map(he=>[he.lon,he.lat]));!so(M)&&M.reverse();for(let Y=0;Y<S.length;Y++){const he=S[Y];so(he)&&(S[Y]=he.reverse())}oo(M),S.forEach(Y=>oo(Y));const O=Math.min(Math.max(1,t.subdivisions),5);M=ao(M,O),S=S.map(Y=>ao(Y,O));const L=qf(M,S,O),I=Kf(M,S,L);I.length>1e4&&console.warn(`多边形${b}顶点数过多(${I.length})，建议减少subdivisions`);const N=I.map(Y=>Y[0]),R=I.map(Y=>Y[1]),z=Math.min.apply(null,N),F=Math.max.apply(null,N),$=Math.min.apply(null,R),B=Math.max.apply(null,R),G=F-z,ye=B-$;I.forEach(([Y,he])=>{const Do=He(Y,he,t.baseHeight+g);T.push(Do.x-_.x,Do.y-_.y,Do.z-_.z);const Sg=G>0?(Y-z)/G:0,Cg=ye>0?1-(he-$)/ye:0;A.push(Sg,Cg)})});const w=new xt;return w.setAttribute("position",new St(T,3)),w.setAttribute("uv",new St(A,2)),w.computeVertexNormals(),w},d=g=>{const{contours:_,holes:v}=u(t.geometry);if(_.length===0)throw new Error("没有有效的多边形轮廓");const y=[],T=[],A=[];let w=0;_.forEach((b,E)=>{const M=v[E]||[],S=O=>{if(O.length<3)return;const L=[],I=[];O.forEach(F=>{const $=He(F.lon,F.lat,t.baseHeight);L.push(new P($.x-g.x,$.y-g.y,$.z-g.z));const B=He(F.lon,F.lat,t.baseHeight+t.height);I.push(new P(B.x-g.x,B.y-g.y,B.z-g.z))});const N=[0];let R=0;for(let F=1;F<L.length;F++){const $=L[F-1].distanceTo(L[F]);R+=$,N.push(R)}L.forEach((F,$)=>{y.push(F.x,F.y,F.z);const B=R>0?N[$]/R:0;A.push(B,0)}),I.forEach((F,$)=>{y.push(F.x,F.y,F.z);const B=R>0?N[$]/R:0;A.push(B,1)});const z=L.length;for(let F=0;F<z-1;F++){const $=w+F,B=w+F+1,G=w+F+z,ye=w+F+1+z;T.push($,B,G),T.push(B,ye,G)}w+=z*2};S(b),M.forEach(O=>{S(O)})});const x=new xt;return x.setAttribute("position",new St(y,3)),x.setAttribute("uv",new St(A,2)),x.setIndex(T),x.computeVertexNormals(),x},f=()=>{try{const{contours:g}=u(t.geometry);if(g.length===0||g[0].length<3){console.warn("多边形至少需要3个点");return}const _=m(t.geometry);if(a.value=_,t.showBottom){const v=h(0,_);s.value=new Tt(v),s.value.renderOrder=t.renderOrder,t.raycastActive&&Yn(s.value,t.raycastMultiplier)}if(t.showTop){const v=h(t.height,_);i.value=new Tt(v),i.value.renderOrder=t.renderOrder,t.raycastActive&&Yn(i.value,t.raycastMultiplier)}if(t.showWalls){const v=d(_);o.value=new Tt(v),o.value.renderOrder=t.renderOrder,t.raycastActive&&Yn(o.value,t.raycastMultiplier)}}catch(g){console.error("创建建筑失败:",g)}},p=()=>{i.value&&i.value.geometry.dispose(),s.value&&s.value.geometry.dispose(),o.value&&o.value.geometry.dispose(),f()};U(()=>t.geometry,()=>{p()},{deep:!0}),U(()=>[t.subdivisions,t.height,t.baseHeight,t.showTop,t.showBottom,t.showWalls],()=>{p()});const m=g=>{const{contours:_}=u(g);if(_.length===0)return new P;let v=0,y=0,T=0;if(_.forEach(b=>{b.forEach(E=>{v+=E.lon,y+=E.lat,T++})}),T===0)return new P;const A=v/T,w=y/T,x=t.baseHeight+t.height/2;return new P(...He(A,w,x))};return Me(()=>{f()}),tt(()=>{i.value&&i.value.geometry.dispose(),s.value&&s.value.geometry.dispose(),o.value&&o.value.geometry.dispose()}),(g,_)=>s.value||i.value||o.value?(re(),Ee("TresGroup",{key:0,position:a.value,onClick:_[0]||(_[0]=(...v)=>C(l).handleClick&&C(l).handleClick(...v)),onDoubleclick:_[1]||(_[1]=(...v)=>C(l).handleDoubleClick&&C(l).handleDoubleClick(...v)),onContextmenu:_[2]||(_[2]=(...v)=>C(l).handleContextMenu&&C(l).handleContextMenu(...v)),onPointerenter:_[3]||(_[3]=(...v)=>C(l).handlePointerEnter&&C(l).handlePointerEnter(...v)),onPointerleave:_[4]||(_[4]=(...v)=>C(l).handlePointerLeave&&C(l).handlePointerLeave(...v)),onPointerover:_[5]||(_[5]=(...v)=>C(l).handlePointerOver&&C(l).handlePointerOver(...v)),onPointerdown:_[6]||(_[6]=(...v)=>C(l).handlePointerDown&&C(l).handlePointerDown(...v)),onPointerup:_[7]||(_[7]=(...v)=>C(l).handlePointerUp&&C(l).handlePointerUp(...v)),onWheel:_[8]||(_[8]=(...v)=>C(l).handleWheel&&C(l).handleWheel(...v))},[g.showBottom?(re(),Ee("primitive",{key:0,object:s.value},[Ct(g.$slots,"bottom")],8,jw)):at("",!0),g.showTop?(re(),Ee("primitive",{key:1,object:i.value},[Ct(g.$slots,"top")],8,Bw)):at("",!0),g.showWalls?(re(),Ee("primitive",{key:2,object:o.value},[Ct(g.$slots,"walls")],8,zw)):at("",!0)],40,Uw)):at("",!0)}}),Vw=["rotation-y"],kP=ue({__name:"GeoRotate",props:{rotate:{default:0}},setup(n){const e=n,t=gc(()=>e.rotate?e.rotate*(Math.PI/180):0);return(r,i)=>(re(),Ee("TresGroup",{"rotation-y":t.value},[Ct(r.$slots,"default")],8,Vw))}}),$w=["position","rotation"],Sc=ue({__name:"GeoPosition",props:{point:{}},setup(n){const e=n,t=Re(new P),r=Re(new yc),i=()=>{const s=He(e.point?.lon,e.point?.lat,e.point?.height||0);t.value=s;const o=s.clone().normalize(),a=new P(0,0,1),l=a.clone().sub(o.clone().multiplyScalar(a.dot(o))).normalize(),c=l.clone().cross(o).normalize();l.copy(o.clone().cross(c)).normalize();const u=new H;u.makeBasis(c,o,l);const h=new ti;h.matrix.copy(u),h.matrix.decompose(h.position,h.quaternion,h.scale),r.value.setFromQuaternion(h.quaternion),r.value=r.value.clone()};return U([()=>e.point?.lon,()=>e.point?.lat,()=>e.point?.height],()=>{i()}),Me(()=>{i()}),(s,o)=>(re(),Ee("TresGroup",{position:t.value,rotation:r.value},[Ct(s.$slots,"default")],8,$w))}}),LP=ue({__name:"GeoTextureProps",props:{texture:{},center:{},rotation:{},scale:{},repeat:{},offset:{},wrapS:{},wrapT:{},magFilter:{},minFilter:{},flipY:{type:Boolean},format:{},type:{},colorSpace:{},generateMipmaps:{type:Boolean},premultiplyAlpha:{type:Boolean},unpackAlignment:{},anisotropy:{},encoding:{},matrixAutoUpdate:{type:Boolean},userData:{},name:{}},setup(n){const e=n;function t(o,a){return o.x===a[0]&&o.y===a[1]}function r(o,a,l){a!==void 0&&o!==a&&l(a)}function i(o,a){a&&!t(o,a)&&(o.x=a[0],o.y=a[1])}function s(){e.texture&&(e.center&&(e.texture.center.x=e.center[0],e.texture.center.y=e.center[1]),e.rotation!==void 0&&(e.texture.rotation=e.rotation),e.scale&&(e.texture.repeat.x=e.scale[0],e.texture.repeat.y=e.scale[1]),e.repeat&&(e.texture.repeat.x=e.repeat[0],e.texture.repeat.y=e.repeat[1]),e.offset&&(e.texture.offset.x=e.offset[0],e.texture.offset.y=e.offset[1]),e.wrapS!==void 0&&(e.texture.wrapS=e.wrapS),e.wrapT!==void 0&&(e.texture.wrapT=e.wrapT),e.magFilter!==void 0&&(e.texture.magFilter=e.magFilter),e.minFilter!==void 0&&(e.texture.minFilter=e.minFilter),e.flipY!==void 0&&(e.texture.flipY=e.flipY),e.format!==void 0&&(e.texture.format=e.format),e.type!==void 0&&(e.texture.type=e.type),e.colorSpace!==void 0&&(e.texture.colorSpace=e.colorSpace),e.generateMipmaps!==void 0&&(e.texture.generateMipmaps=e.generateMipmaps),e.premultiplyAlpha!==void 0&&(e.texture.premultiplyAlpha=e.premultiplyAlpha),e.unpackAlignment!==void 0&&(e.texture.unpackAlignment=e.unpackAlignment),e.anisotropy!==void 0&&(e.texture.anisotropy=e.anisotropy),e.encoding!==void 0&&(e.texture.encoding=e.encoding),e.userData!==void 0&&(e.texture.userData=e.userData),e.name!==void 0&&(e.texture.name=e.name))}return U(()=>e.texture,o=>{o&&s()},{immediate:!0}),U(()=>e.center,o=>{e.texture&&o&&i(e.texture.center,o)},{deep:!0}),U(()=>e.rotation,o=>{e.texture&&r(e.texture.rotation,o,a=>{e.texture.rotation=a})}),U(()=>e.scale,o=>{e.texture&&o&&i(e.texture.repeat,o)},{deep:!0}),U(()=>e.repeat,o=>{e.texture&&o&&i(e.texture.repeat,o)},{deep:!0}),U(()=>e.offset,o=>{e.texture&&o&&i(e.texture.offset,o)},{deep:!0}),U(()=>e.wrapS,o=>{e.texture&&r(e.texture.wrapS,o,a=>{e.texture.wrapS=a})}),U(()=>e.wrapT,o=>{e.texture&&r(e.texture.wrapT,o,a=>{e.texture.wrapT=a})}),U(()=>e.magFilter,o=>{e.texture&&r(e.texture.magFilter,o,a=>{e.texture.magFilter=a})}),U(()=>e.minFilter,o=>{e.texture&&r(e.texture.minFilter,o,a=>{e.texture.minFilter=a})}),U(()=>e.flipY,o=>{e.texture&&r(e.texture.flipY,o,a=>{e.texture.flipY=a})}),U(()=>e.format,o=>{e.texture&&r(e.texture.format,o,a=>{e.texture.format=a})}),U(()=>e.type,o=>{e.texture&&r(e.texture.type,o,a=>{e.texture.type=a})}),U(()=>e.colorSpace,o=>{e.texture&&r(e.texture.colorSpace,o,a=>{e.texture.colorSpace=a})}),U(()=>e.generateMipmaps,o=>{e.texture&&r(e.texture.generateMipmaps,o,a=>{e.texture.generateMipmaps=a})}),U(()=>e.premultiplyAlpha,o=>{e.texture&&r(e.texture.premultiplyAlpha,o,a=>{e.texture.premultiplyAlpha=a})}),U(()=>e.unpackAlignment,o=>{e.texture&&r(e.texture.unpackAlignment,o,a=>{e.texture.unpackAlignment=a})}),U(()=>e.anisotropy,o=>{e.texture&&r(e.texture.anisotropy,o,a=>{e.texture.anisotropy=a})}),U(()=>e.encoding,o=>{e.texture&&r(e.texture.encoding,o,a=>{e.texture.encoding=a})}),U(()=>e.matrixAutoUpdate,o=>{e.texture&&r(e.texture.matrixAutoUpdate,o,a=>{e.texture.matrixAutoUpdate=a})}),U(()=>e.userData,o=>{e.texture&&r(e.texture.userData,o,a=>{e.texture.userData=a})},{deep:!0}),U(()=>e.name,o=>{e.texture&&r(e.texture.name,o,a=>{e.texture.name=a})}),(o,a)=>null}});function Sh(n){if(!n)return null;const e=n.replace(/[a-z]+:\/\/[^/]+/i,"").replace(/\?.*$/i,"").replace(/.*\//g,""),t=e.lastIndexOf(".");return t===-1?null:e.substring(t+1)||null}const Ch=2**30;class Hw{get unloadPriorityCallback(){return this._unloadPriorityCallback}set unloadPriorityCallback(e){e.length===1?(console.warn('LRUCache: "unloadPriorityCallback" function has been changed to take two arguments.'),this._unloadPriorityCallback=(t,r)=>{const i=e(t),s=e(r);return i<s?-1:i>s?1:0}):this._unloadPriorityCallback=e}constructor(){this.minSize=6e3,this.maxSize=8e3,this.minBytesSize=.3*Ch,this.maxBytesSize=.4*Ch,this.unloadPercent=.05,this.autoMarkUnused=!0,this.itemSet=new Map,this.itemList=[],this.usedSet=new Set,this.callbacks=new Map,this.unloadingHandle=-1,this.cachedBytes=0,this.bytesMap=new Map,this.loadedSet=new Set,this._unloadPriorityCallback=null,this.computeMemoryUsageCallback=()=>null;const e=this.itemSet;this.defaultPriorityCallback=t=>e.get(t)}isFull(){return this.itemSet.size>=this.maxSize||this.cachedBytes>=this.maxBytesSize}getMemoryUsage(e){return this.bytesMap.get(e)??null}add(e,t){const r=this.itemSet;if(r.has(e)||this.isFull())return!1;const i=this.usedSet,s=this.itemList,o=this.callbacks,a=this.bytesMap;s.push(e),i.add(e),r.set(e,Date.now()),o.set(e,t);const l=this.computeMemoryUsageCallback(e);return this.cachedBytes+=l||0,a.set(e,l),!0}has(e){return this.itemSet.has(e)}remove(e){const t=this.usedSet,r=this.itemSet,i=this.itemList,s=this.bytesMap,o=this.callbacks,a=this.loadedSet;if(r.has(e)){this.cachedBytes-=s.get(e)||0,s.delete(e),o.get(e)(e);const l=i.indexOf(e);return i.splice(l,1),t.delete(e),r.delete(e),o.delete(e),a.delete(e),!0}return!1}setLoaded(e,t){const{itemSet:r,loadedSet:i}=this;r.has(e)&&(t===!0?i.add(e):i.delete(e))}updateMemoryUsage(e){const t=this.itemSet,r=this.bytesMap;if(!t.has(e))return;this.cachedBytes-=r.get(e)||0;const i=this.computeMemoryUsageCallback(e);r.set(e,i),this.cachedBytes+=i}markUsed(e){const t=this.itemSet,r=this.usedSet;t.has(e)&&!r.has(e)&&(t.set(e,Date.now()),r.add(e))}markUnused(e){this.usedSet.delete(e)}markAllUnused(){this.usedSet.clear()}unloadUnusedContent(){const{unloadPercent:e,minSize:t,maxSize:r,itemList:i,itemSet:s,usedSet:o,loadedSet:a,callbacks:l,bytesMap:c,minBytesSize:u,maxBytesSize:h}=this,d=i.length-o.size,f=i.length-a.size,p=Math.max(Math.min(i.length-t,d),0),m=this.cachedBytes-u,g=this.unloadPriorityCallback||this.defaultPriorityCallback;let _=!1;const v=p>0&&d>0||f&&i.length>r;if(d&&this.cachedBytes>u||f&&this.cachedBytes>h||v){i.sort((E,M)=>{const S=o.has(E),O=o.has(M);if(S===O){const L=a.has(E),I=a.has(M);return L===I?-g(E,M):L?1:-1}else return S?1:-1});const y=Math.max(t*e,p*e),T=Math.ceil(Math.min(y,d,p)),A=Math.max(e*m,e*u),w=Math.min(A,m);let x=0,b=0;for(;this.cachedBytes-b>h||i.length-x>r;){const E=i[x],M=c.get(E)||0;if(o.has(E)&&a.has(E)||this.cachedBytes-b-M<h&&i.length-x<=r)break;b+=M,x++}for(;b<w||x<T;){const E=i[x],M=c.get(E)||0;if(o.has(E)||this.cachedBytes-b-M<u&&x>=T)break;b+=M,x++}i.splice(0,x).forEach(E=>{this.cachedBytes-=c.get(E)||0,l.get(E)(E),c.delete(E),s.delete(E),l.delete(E),a.delete(E),o.delete(E)}),_=x<p||b<m&&x<d,_=_&&x>0}_&&(this.unloadingHandle=requestAnimationFrame(()=>this.scheduleUnload()))}scheduleUnload(){cancelAnimationFrame(this.unloadingHandle),this.scheduled||(this.scheduled=!0,queueMicrotask(()=>{this.scheduled=!1,this.unloadUnusedContent()}))}}class Zo{get running(){return this.items.length!==0||this.currJobs!==0}constructor(){this.maxJobs=6,this.items=[],this.callbacks=new Map,this.currJobs=0,this.scheduled=!1,this.autoUpdate=!0,this.priorityCallback=()=>{throw new Error("PriorityQueue: PriorityCallback function not defined.")},this.schedulingCallback=e=>{requestAnimationFrame(e)},this._runjobs=()=>{this.scheduled=!1,this.tryRunJobs()}}sort(){const e=this.priorityCallback;this.items.sort(e)}has(e){return this.callbacks.has(e)}add(e,t){const r={callback:t,reject:null,resolve:null,promise:null};return r.promise=new Promise((i,s)=>{const o=this.items,a=this.callbacks;r.resolve=i,r.reject=s,o.push(e),a.set(e,r),this.autoUpdate&&this.scheduleJobRun()}),r.promise}remove(e){const t=this.items,r=this.callbacks,i=t.indexOf(e);if(i!==-1){const s=r.get(e);s.promise.catch(()=>{}),s.reject(new Error("PriorityQueue: Item removed.")),t.splice(i,1),r.delete(e)}}removeByFilter(e){const{items:t}=this;for(let r=0;r<t.length;r++){const i=t[r];e(i)&&this.remove(i)}}tryRunJobs(){this.sort();const e=this.items,t=this.callbacks,r=this.maxJobs;let i=0;const s=()=>{this.currJobs--,this.autoUpdate&&this.scheduleJobRun()};for(;r>this.currJobs&&e.length>0&&i<r;){this.currJobs++,i++;const o=e.pop(),{callback:a,resolve:l,reject:c}=t.get(o);t.delete(o);let u;try{u=a(o)}catch(h){c(h),s()}u instanceof Promise?u.then(l).catch(c).finally(s):(l(u),s())}}scheduleJobRun(){this.scheduled||(this.schedulingCallback(this._runjobs),this.scheduled=!0)}}const br=-1,Yt=0,fs=1,Qo=2,Bi=3,Rh=6378137,Gw=6356752314245179e-9,ms={inView:!1,error:1/0,distanceFromCamera:1/0};function Xf(n){return n===Bi||n===br}function En(n,e){return n.__lastFrameVisited===e&&n.__used}function Cc(n){return n.__childrenProcessed===n.children.length}function Rc(n,e){n.__lastFrameVisited!==e.frameCount&&(n.__lastFrameVisited=e.frameCount,n.__used=!1,n.__inFrustum=!1,n.__isLeaf=!1,n.__visible=!1,n.__active=!1,n.__error=1/0,n.__distanceFromCamera=1/0,n.__childrenWereVisible=!1,n.__allChildrenLoaded=!1,e.calculateTileViewError(n,ms),n.__inFrustum=ms.inView,n.__error=ms.error,n.__distanceFromCamera=ms.distanceFromCamera)}function Yf(n,e){if(e.ensureChildrenArePreprocessed(n),Rc(n,e),xl(n,e),!n.__hasRenderableContent&&Cc(n)){const t=n.children;for(let r=0,i=t.length;r<i;r++)Yf(t[r],e)}}function Zf(n,e){if(e.ensureChildrenArePreprocessed(n),En(n,e.frameCount)&&(n.__hasContent&&n.__loadingState===Yt&&!e.lruCache.isFull()&&e.queueTileForDownload(n),Cc(n))){const t=n.children;for(let r=0,i=t.length;r<i;r++)Zf(t[r],e)}}function xl(n,e){n.__used||(n.__used=!0,e.markTileUsed(n),e.stats.used++,n.__inFrustum===!0&&e.stats.inFrustum++)}function Ww(n,e){return!(n.__error<=e.errorTarget||e.maxDepth>0&&n.__depth+1>=e.maxDepth||!Cc(n))}function El(n,e=null,t=null){const r=[];for(r.push(n),r.push(null),r.push(0);r.length>0;){const i=r.pop(),s=r.pop(),o=r.pop();if(e&&e(o,s,i)){t&&t(o,s,i);return}const a=o.children;if(a)for(let l=a.length-1;l>=0;l--)r.push(a[l]),r.push(o),r.push(i+1);t&&t(o,s,i)}}function Qf(n,e){if(e.ensureChildrenArePreprocessed(n),Rc(n,e),!n.__inFrustum)return;if(!Ww(n,e)){xl(n,e);return}let t=!1,r=!1;const i=n.children;for(let s=0,o=i.length;s<o;s++){const a=i[s];Qf(a,e),t=t||En(a,e.frameCount),r=r||a.__inFrustum}if(xl(n,e),t&&n.refine==="REPLACE")for(let s=0,o=i.length;s<o;s++){const a=i[s];Yf(a,e)}}function Jf(n,e){const t=e.frameCount;if(!En(n,t))return;const r=n.children;let i=!1;for(let s=0,o=r.length;s<o;s++){const a=r[s];i=i||En(a,t)}if(!i)n.__isLeaf=!0;else{let s=!1,o=!0;for(let a=0,l=r.length;a<l;a++){const c=r[a];if(Jf(c,e),s=s||c.__wasSetVisible||c.__childrenWereVisible,En(c,t)){const u=c.__allChildrenLoaded||c.__hasRenderableContent&&Xf(c.__loadingState)||!c.__hasContent&&c.children.length===0||c.__hasUnrenderableContent&&c.__loadingState===br;o=o&&u}}n.__childrenWereVisible=s,n.__allChildrenLoaded=o}}function em(n,e){const t=e.stats;if(!En(n,e.frameCount))return;const r=e.lruCache;if(n.__isLeaf){n.__loadingState===Bi?(n.__inFrustum&&(n.__visible=!0,t.visible++),n.__active=!0,t.active++):!r.isFull()&&n.__hasContent&&e.queueTileForDownload(n);return}const i=n.children,s=n.__hasContent,o=Xf(n.__loadingState)&&s,a=(e.errorTarget+1)*e.errorThreshold,l=n.__error<=a,c=n.__childrenWereVisible,u=n.__allChildrenLoaded;if((l||n.refine==="ADD")&&!o&&!r.isFull()&&s&&e.queueTileForDownload(n),(l&&!u&&!c&&o||n.refine==="ADD"&&o)&&(n.__inFrustum&&(n.__visible=!0,t.visible++),n.__active=!0,t.active++),n.refine==="REPLACE"&&l&&!u)for(let h=0,d=i.length;h<d;h++){const f=i[h];En(f,e.frameCount)&&Zf(f,e)}else for(let h=0,d=i.length;h<d;h++)em(i[h],e)}function tm(n,e){const t=En(n,e.frameCount);if(t||n.__usedLastFrame){let r=!1,i=!1;t?(r=n.__active,e.displayActiveTiles?i=n.__active||n.__visible:i=n.__visible):Rc(n,e),n.__hasRenderableContent&&n.__loadingState===Bi&&(n.__wasSetActive!==r&&e.invokeOnePlugin(o=>o.setTileActive&&o.setTileActive(n,r)),n.__wasSetVisible!==i&&e.invokeOnePlugin(o=>o.setTileVisible&&o.setTileVisible(n,i))),n.__wasSetActive=r,n.__wasSetVisible=i,n.__usedLastFrame=t;const s=n.children;for(let o=0,a=s.length;o<a;o++){const l=s[o];tm(l,e)}}}function Kw(n,e=null){let t=n;for(;t;){const r=t.__depth,i=t.parent;e&&e(t,i,r),t=i}}function qw(n){let e=null;return()=>{e===null&&(e=requestAnimationFrame(()=>{e=null,n()}))}}const Oh=Symbol("PLUGIN_REGISTERED"),Jo=(n,e)=>n.__depthFromRenderedParent!==e.__depthFromRenderedParent?n.__depthFromRenderedParent>e.__depthFromRenderedParent?-1:1:n.__inFrustum!==e.__inFrustum?n.__inFrustum?1:-1:n.__used!==e.__used?n.__used?1:-1:n.__error!==e.__error?n.__error>e.__error?1:-1:n.__distanceFromCamera!==e.__distanceFromCamera?n.__distanceFromCamera>e.__distanceFromCamera?-1:1:0,Xw=(n,e)=>n.__depthFromRenderedParent!==e.__depthFromRenderedParent?n.__depthFromRenderedParent>e.__depthFromRenderedParent?1:-1:n.__loadingState!==e.__loadingState?n.__loadingState>e.__loadingState?-1:1:n.__lastFrameVisited!==e.__lastFrameVisited?n.__lastFrameVisited>e.__lastFrameVisited?-1:1:n.__hasUnrenderableContent!==e.__hasUnrenderableContent?n.__hasUnrenderableContent?-1:1:n.__error!==e.__error?n.__error>e.__error?-1:1:0;class Yw{get root(){const e=this.rootTileSet;return e?e.root:null}get loadProgress(){const{stats:e,isLoading:t}=this,r=e.downloading+e.parsing,i=e.inCacheSinceLoad+(t?1:0);return i===0?1:1-r/i}get errorThreshold(){return this._errorThreshold}set errorThreshold(e){console.warn('TilesRenderer: The "errorThreshold" option has been deprecated.'),this._errorThreshold=e}constructor(e=null){this.rootLoadingState=Yt,this.rootTileSet=null,this.rootURL=e,this.fetchOptions={},this.plugins=[],this.queuedTiles=[],this.cachedSinceLoadComplete=new Set,this.isLoading=!1;const t=new Hw;t.unloadPriorityCallback=Xw;const r=new Zo;r.maxJobs=10,r.priorityCallback=Jo;const i=new Zo;i.maxJobs=1,i.priorityCallback=Jo;const s=new Zo;s.maxJobs=25,s.priorityCallback=Jo,s.log=!0,this.visibleTiles=new Set,this.activeTiles=new Set,this.usedSet=new Set,this.lruCache=t,this.downloadQueue=r,this.parseQueue=i,this.processNodeQueue=s,this.stats={inCacheSinceLoad:0,inCache:0,parsing:0,downloading:0,failed:0,inFrustum:0,used:0,active:0,visible:0},this.frameCount=0,this._dispatchNeedsUpdateEvent=qw(()=>{this.dispatchEvent({type:"needs-update"})}),this.errorTarget=16,this._errorThreshold=1/0,this.displayActiveTiles=!1,this.maxDepth=1/0}registerPlugin(e){if(e[Oh]===!0)throw new Error("TilesRendererBase: A plugin can only be registered to a single tile set");const t=this.plugins,r=e.priority||0;let i=t.length;for(let s=0;s<t.length;s++)if((t[s].priority||0)>r){i=s;break}t.splice(i,0,e),e[Oh]=!0,e.init&&e.init(this)}unregisterPlugin(e){const t=this.plugins;if(typeof e=="string"&&(e=this.getPluginByName(name)),t.includes(e)){const r=t.indexOf(e);return t.splice(r,1),e.dispose&&e.dispose(),!0}return!1}getPluginByName(e){return this.plugins.find(t=>t.name===e)||null}traverse(e,t,r=!0){this.root&&El(this.root,(i,...s)=>(r&&this.ensureChildrenArePreprocessed(i,!0),e?e(i,...s):!1),t)}queueTileForDownload(e){e.__loadingState===Yt&&this.queuedTiles.push(e)}markTileUsed(e){this.usedSet.add(e),this.lruCache.markUsed(e)}update(){const{lruCache:e,usedSet:t,stats:r,root:i,downloadQueue:s,parseQueue:o,processNodeQueue:a}=this;if(this.rootLoadingState===Yt&&(this.rootLoadingState=fs,this.invokeOnePlugin(c=>c.loadRootTileSet&&c.loadRootTileSet()).then(c=>{let u=this.rootURL;u!==null&&this.invokeAllPlugins(h=>u=h.preprocessURL?h.preprocessURL(u,null):u),this.rootLoadingState=Bi,this.rootTileSet=c,this.dispatchEvent({type:"needs-update"}),this.dispatchEvent({type:"load-content"}),this.dispatchEvent({type:"load-tile-set",tileSet:c,url:u})}).catch(c=>{this.rootLoadingState=br,console.error(c),this.rootTileSet=null,this.dispatchEvent({type:"load-error",tile:null,error:c,url:this.rootURL})})),!i)return;r.inFrustum=0,r.used=0,r.active=0,r.visible=0,this.frameCount++,t.forEach(c=>e.markUnused(c)),t.clear(),Qf(i,this),Jf(i,this),em(i,this),tm(i,this);const l=this.queuedTiles;l.sort(e.unloadPriorityCallback);for(let c=0,u=l.length;c<u&&!e.isFull();c++)this.requestTileContents(l[c]);l.length=0,e.scheduleUnload(),(s.running||o.running||a.running)===!1&&this.isLoading===!0&&(this.cachedSinceLoadComplete.clear(),r.inCacheSinceLoad=0,this.dispatchEvent({type:"tiles-load-end"}),this.isLoading=!1)}resetFailedTiles(){this.rootLoadingState===br&&(this.rootLoadingState=Yt);const e=this.stats;e.failed!==0&&(this.traverse(t=>{t.__loadingState===br&&(t.__loadingState=Yt)},null,!1),e.failed=0)}dispose(){[...this.plugins].forEach(r=>{this.unregisterPlugin(r)});const e=this.lruCache,t=[];this.traverse(r=>(t.push(r),!1),null,!1);for(let r=0,i=t.length;r<i;r++)e.remove(t[r]);this.stats={parsing:0,downloading:0,failed:0,inFrustum:0,used:0,active:0,visible:0},this.frameCount=0}dispatchEvent(e){}fetchData(e,t){return fetch(e,t)}parseTile(e,t,r){return null}disposeTile(e){e.__visible&&(this.invokeOnePlugin(t=>t.setTileVisible&&t.setTileVisible(e,!1)),e.__visible=!1),e.__active&&(this.invokeOnePlugin(t=>t.setTileActive&&t.setTileActive(e,!1)),e.__active=!1)}preprocessNode(e,t,r=null){if(e.content&&(!("uri"in e.content)&&"url"in e.content&&(e.content.uri=e.content.url,delete e.content.url),e.content.boundingVolume&&!("box"in e.content.boundingVolume||"sphere"in e.content.boundingVolume||"region"in e.content.boundingVolume)&&delete e.content.boundingVolume),e.parent=r,e.children=e.children||[],e.content?.uri){const i=Sh(e.content.uri);e.__hasContent=!0,e.__hasUnrenderableContent=!!(i&&/json$/.test(i)),e.__hasRenderableContent=!e.__hasUnrenderableContent}else e.__hasContent=!1,e.__hasUnrenderableContent=!1,e.__hasRenderableContent=!1;e.__childrenProcessed=0,r&&r.__childrenProcessed++,e.__distanceFromCamera=1/0,e.__error=1/0,e.__inFrustum=!1,e.__isLeaf=!1,e.__usedLastFrame=!1,e.__used=!1,e.__wasSetVisible=!1,e.__visible=!1,e.__childrenWereVisible=!1,e.__allChildrenLoaded=!1,e.__wasSetActive=!1,e.__active=!1,e.__loadingState=Yt,r===null?(e.__depth=0,e.__depthFromRenderedParent=e.__hasRenderableContent?1:0,e.refine=e.refine||"REPLACE"):(e.__depth=r.__depth+1,e.__depthFromRenderedParent=r.__depthFromRenderedParent+(e.__hasRenderableContent?1:0),e.refine=e.refine||r.refine),e.__basePath=t,e.__lastFrameVisited=-1,this.invokeAllPlugins(i=>{i!==this&&i.preprocessNode&&i.preprocessNode(e,t,r)})}setTileActive(e,t){t?this.activeTiles.add(e):this.activeTiles.delete(e)}setTileVisible(e,t){t?this.visibleTiles.add(e):this.visibleTiles.delete(e)}calculateTileViewError(e,t){}ensureChildrenArePreprocessed(e,t=!1){const r=e.children;for(let i=0,s=r.length;i<s;i++){const o=r[i];if("__depth"in o)break;t?(this.processNodeQueue.remove(o),this.preprocessNode(o,e.__basePath,e)):this.processNodeQueue.has(o)||this.processNodeQueue.add(o,a=>{this.preprocessNode(a,e.__basePath,e),this._dispatchNeedsUpdateEvent()})}}preprocessTileSet(e,t,r=null){const i=e.asset.version,[s,o]=i.split(".").map(l=>parseInt(l));console.assert(s<=1,"TilesRenderer: asset.version is expected to be a 1.x or a compatible version."),s===1&&o>0&&console.warn("TilesRenderer: tiles versions at 1.1 or higher have limited support. Some new extensions and features may not be supported.");let a=t.replace(/\/[^/]*$/,"");a=new URL(a,window.location.href).toString(),this.preprocessNode(e.root,a,r)}loadRootTileSet(){let e=this.rootURL;return this.invokeAllPlugins(t=>e=t.preprocessURL?t.preprocessURL(e,null):e),this.invokeOnePlugin(t=>t.fetchData&&t.fetchData(e,this.fetchOptions)).then(t=>{if(t instanceof Response){if(t.ok)return t.json();throw new Error(`TilesRenderer: Failed to load tileset "${e}" with status ${t.status} : ${t.statusText}`)}else return t}).then(t=>(this.preprocessTileSet(t,e),t))}requestTileContents(e){if(e.__loadingState!==Yt)return;let t=!1,r=null,i=new URL(e.content.uri,e.__basePath+"/").toString();this.invokeAllPlugins(d=>i=d.preprocessURL?d.preprocessURL(i,e):i);const s=this.stats,o=this.lruCache,a=this.downloadQueue,l=this.parseQueue,c=Sh(i),u=new AbortController,h=u.signal;if(o.add(e,d=>{u.abort(),t?(d.children.length=0,d.__childrenProcessed=0):this.invokeAllPlugins(f=>{f.disposeTile&&f.disposeTile(d)}),s.inCache--,this.cachedSinceLoadComplete.has(e)&&(this.cachedSinceLoadComplete.delete(e),s.inCacheSinceLoad--),d.__loadingState===fs?s.downloading--:d.__loadingState===Qo&&s.parsing--,d.__loadingState=Yt,l.remove(d),a.remove(d)}))return this.isLoading||(this.isLoading=!0,this.dispatchEvent({type:"tiles-load-start"})),this.cachedSinceLoadComplete.add(e),s.inCacheSinceLoad++,s.inCache++,s.downloading++,e.__loadingState=fs,a.add(e,d=>{if(h.aborted)return Promise.resolve();const f=this.invokeOnePlugin(p=>p.fetchData&&p.fetchData(i,{...this.fetchOptions,signal:h}));return this.dispatchEvent({type:"tile-download-start",tile:e}),f}).then(d=>{if(!h.aborted)if(d instanceof Response){if(d.ok)return c==="json"?d.json():d.arrayBuffer();throw new Error(`Failed to load model with error code ${d.status}`)}else return d}).then(d=>{if(!h.aborted)return s.downloading--,s.parsing++,e.__loadingState=Qo,l.add(e,f=>h.aborted?Promise.resolve():c==="json"&&d.root?(this.preprocessTileSet(d,i,e),e.children.push(d.root),r=d,t=!0,Promise.resolve()):this.invokeOnePlugin(p=>p.parseTile&&p.parseTile(d,f,c,i,h)))}).then(()=>{h.aborted||(s.parsing--,e.__loadingState=Bi,o.setLoaded(e,!0),o.getMemoryUsage(e)===null&&(o.isFull()&&o.computeMemoryUsageCallback(e)>0?o.remove(e):o.updateMemoryUsage(e)),this.dispatchEvent({type:"needs-update"}),this.dispatchEvent({type:"load-content"}),t&&this.dispatchEvent({type:"load-tile-set",tileSet:r,url:i}),e.cached.scene&&this.dispatchEvent({type:"load-model",scene:e.cached.scene,tile:e}))}).catch(d=>{h.aborted||(d.name!=="AbortError"?(l.remove(e),a.remove(e),e.__loadingState===Qo?s.parsing--:e.__loadingState===fs&&s.downloading--,s.failed++,console.error(`TilesRenderer : Failed to load tile at url "${e.content.uri}".`),console.error(d),e.__loadingState=br,o.setLoaded(e,!0),this.dispatchEvent({type:"load-error",tile:e,error:d,url:i})):o.remove(e))})}getAttributions(e=[]){return this.invokeAllPlugins(t=>t!==this&&t.getAttributions&&t.getAttributions(e)),e}invokeOnePlugin(e){const t=[...this.plugins,this];for(let r=0;r<t.length;r++){const i=e(t[r]);if(i)return i}return null}invokeAllPlugins(e){const t=[...this.plugins,this],r=[];for(let i=0;i<t.length;i++){const s=e(t[i]);s&&r.push(s)}return r.length===0?null:Promise.all(r)}}const Zw=new TextDecoder;function nm(n){return Zw.decode(n)}function rm(n,e,t,r,i,s){let o;switch(r){case"SCALAR":o=1;break;case"VEC2":o=2;break;case"VEC3":o=3;break;case"VEC4":o=4;break;default:throw new Error(`FeatureTable : Feature type not provided for "${s}".`)}let a;const l=t*o;switch(i){case"BYTE":a=new Int8Array(n,e,l);break;case"UNSIGNED_BYTE":a=new Uint8Array(n,e,l);break;case"SHORT":a=new Int16Array(n,e,l);break;case"UNSIGNED_SHORT":a=new Uint16Array(n,e,l);break;case"INT":a=new Int32Array(n,e,l);break;case"UNSIGNED_INT":a=new Uint32Array(n,e,l);break;case"FLOAT":a=new Float32Array(n,e,l);break;case"DOUBLE":a=new Float64Array(n,e,l);break;default:throw new Error(`FeatureTable : Feature component type not provided for "${s}".`)}return a}class Ro{constructor(e,t,r,i){this.buffer=e,this.binOffset=t+r,this.binLength=i;let s=null;if(r!==0){const o=new Uint8Array(e,t,r);s=JSON.parse(nm(o))}else s={};this.header=s}getKeys(){return Object.keys(this.header)}getData(e,t,r=null,i=null){const s=this.header;if(!(e in s))return null;const o=s[e];if(o instanceof Object){if(Array.isArray(o))return o;{const{buffer:a,binOffset:l,binLength:c}=this,u=o.byteOffset||0,h=o.type||i,d=o.componentType||r;if("type"in o&&i&&o.type!==i)throw new Error("FeatureTable: Specified type does not match expected type.");const f=l+u,p=rm(a,f,t,h,d,e);if(f+p.byteLength>l+c)throw new Error("FeatureTable: Feature data read outside binary body length.");return p}}else return o}getBuffer(e,t){const{buffer:r,binOffset:i}=this;return r.slice(i+e,i+e+t)}}class Qw{constructor(e){this.batchTable=e;const t=e.header.extensions["3DTILES_batch_table_hierarchy"];this.classes=t.classes;for(const i of this.classes){const s=i.instances;for(const o in s)i.instances[o]=this._parseProperty(s[o],i.length,o)}if(this.instancesLength=t.instancesLength,this.classIds=this._parseProperty(t.classIds,this.instancesLength,"classIds"),t.parentCounts?this.parentCounts=this._parseProperty(t.parentCounts,this.instancesLength,"parentCounts"):this.parentCounts=new Array(this.instancesLength).fill(1),t.parentIds){const i=this.parentCounts.reduce((s,o)=>s+o,0);this.parentIds=this._parseProperty(t.parentIds,i,"parentIds")}else this.parentIds=null;this.instancesIds=[];const r={};for(const i of this.classIds)r[i]=r[i]??0,this.instancesIds.push(r[i]),r[i]++}_parseProperty(e,t,r){if(Array.isArray(e))return e;{const{buffer:i,binOffset:s}=this.batchTable,o=e.byteOffset,a=e.componentType||"UNSIGNED_SHORT",l=s+o;return rm(i,l,t,"SCALAR",a,r)}}getDataFromId(e,t={}){const r=this.parentCounts[e];if(this.parentIds&&r>0){let l=0;for(let c=0;c<e;c++)l+=this.parentCounts[c];for(let c=0;c<r;c++){const u=this.parentIds[l+c];u!==e&&this.getDataFromId(u,t)}}const i=this.classIds[e],s=this.classes[i].instances,o=this.classes[i].name,a=this.instancesIds[e];for(const l in s)t[o]=t[o]||{},t[o][l]=s[l][a];return t}}class Oc extends Ro{get batchSize(){return console.warn("BatchTable.batchSize has been deprecated and replaced with BatchTable.count."),this.count}constructor(e,t,r,i,s){super(e,r,i,s),this.count=t,this.extensions={};const o=this.header.extensions;o&&o["3DTILES_batch_table_hierarchy"]&&(this.extensions["3DTILES_batch_table_hierarchy"]=new Qw(this))}getData(e,t=null,r=null){return console.warn("BatchTable: BatchTable.getData is deprecated. Use BatchTable.getDataFromId to get allproperties for an id or BatchTable.getPropertyArray for getting an array of value for a property."),super.getData(e,this.count,t,r)}getDataFromId(e,t={}){if(e<0||e>=this.count)throw new Error(`BatchTable: id value "${e}" out of bounds for "${this.count}" features number.`);for(const r of this.getKeys())r!=="extensions"&&(t[r]=super.getData(r,this.count)[e]);for(const r in this.extensions){const i=this.extensions[r];i.getDataFromId instanceof Function&&(t[r]=t[r]||{},i.getDataFromId(e,t[r]))}return t}getPropertyArray(e){return super.getData(e,this.count)}}class Oo{constructor(){this.fetchOptions={},this.workingPath=""}load(...e){return console.warn('Loader: "load" function has been deprecated in favor of "loadAsync".'),this.loadAsync(...e)}loadAsync(e){return fetch(e,this.fetchOptions).then(t=>{if(!t.ok)throw new Error(`Failed to load file "${e}" with status ${t.status} : ${t.statusText}`);return t.arrayBuffer()}).then(t=>(this.workingPath===""&&(this.workingPath=this.workingPathForURL(e)),this.parse(t)))}resolveExternalURL(e){return/^[^\\/]/.test(e)&&!/^http/.test(e)?this.workingPath+"/"+e:e}workingPathForURL(e){const t=e.split(/[\\/]/g);return t.pop(),t.join("/")+"/"}parse(e){throw new Error("LoaderBase: Parse not implemented.")}}function $r(n){if(n===null||n.byteLength<4)return"";let e;if(n instanceof DataView?e=n:e=new DataView(n),String.fromCharCode(e.getUint8(0))==="{")return null;let t="";for(let r=0;r<4;r++)t+=String.fromCharCode(e.getUint8(r));return t}class Jw extends Oo{parse(e){const t=new DataView(e),r=$r(t);console.assert(r==="b3dm");const i=t.getUint32(4,!0);console.assert(i===1);const s=t.getUint32(8,!0);console.assert(s===e.byteLength);const o=t.getUint32(12,!0),a=t.getUint32(16,!0),l=t.getUint32(20,!0),c=t.getUint32(24,!0),u=28,h=e.slice(u,u+o+a),d=new Ro(h,0,o,a),f=u+o+a,p=e.slice(f,f+l+c),m=new Oc(p,d.getData("BATCH_LENGTH"),0,l,c),g=f+l+c,_=new Uint8Array(e,g,s-g);return{version:i,featureTable:d,batchTable:m,glbBytes:_}}}function eT(n){let e=0;for(const r in n.attributes){const i=n.getAttribute(r);e+=i.count*i.itemSize*i.array.BYTES_PER_ELEMENT}const t=n.getIndex();return e+=t?t.count*t.itemSize*t.array.BYTES_PER_ELEMENT:0,e}function kh(n,e){if(e===yf)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===Ur||e===xo){let t=n.getIndex();if(t===null){const o=[],a=n.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);n.setIndex(o),t=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const r=t.count-2,i=[];if(e===Ur)for(let o=1;o<=r;o++)i.push(t.getX(0)),i.push(t.getX(o)),i.push(t.getX(o+1));else for(let o=0;o<r;o++)o%2===0?(i.push(t.getX(o)),i.push(t.getX(o+1)),i.push(t.getX(o+2))):(i.push(t.getX(o+2)),i.push(t.getX(o+1)),i.push(t.getX(o)));i.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=n.clone();return s.setIndex(i),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}let kc=class extends Eo{constructor(n){super(n),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new sT(e)}),this.register(function(e){return new oT(e)}),this.register(function(e){return new mT(e)}),this.register(function(e){return new gT(e)}),this.register(function(e){return new _T(e)}),this.register(function(e){return new lT(e)}),this.register(function(e){return new cT(e)}),this.register(function(e){return new uT(e)}),this.register(function(e){return new hT(e)}),this.register(function(e){return new iT(e)}),this.register(function(e){return new dT(e)}),this.register(function(e){return new aT(e)}),this.register(function(e){return new fT(e)}),this.register(function(e){return new pT(e)}),this.register(function(e){return new nT(e)}),this.register(function(e){return new vT(e)}),this.register(function(e){return new yT(e)})}load(n,e,t,r){const i=this;let s;if(this.resourcePath!=="")s=this.resourcePath;else if(this.path!==""){const l=Bt.extractUrlBase(n);s=Bt.resolveURL(l,this.path)}else s=Bt.extractUrlBase(n);this.manager.itemStart(n);const o=function(l){r?r(l):console.error(l),i.manager.itemError(n),i.manager.itemEnd(n)},a=new jr(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(n,function(l){try{i.parse(l,s,function(c){e(c),i.manager.itemEnd(n)},o)}catch(c){o(c)}},t,o)}setDRACOLoader(n){return this.dracoLoader=n,this}setKTX2Loader(n){return this.ktx2Loader=n,this}setMeshoptDecoder(n){return this.meshoptDecoder=n,this}register(n){return this.pluginCallbacks.indexOf(n)===-1&&this.pluginCallbacks.push(n),this}unregister(n){return this.pluginCallbacks.indexOf(n)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(n),1),this}parse(n,e,t,r){let i;const s={},o={},a=new TextDecoder;if(typeof n=="string")i=JSON.parse(n);else if(n instanceof ArrayBuffer)if(a.decode(new Uint8Array(n,0,4))===im){try{s[q.KHR_BINARY_GLTF]=new bT(n)}catch(c){r&&r(c);return}i=JSON.parse(s[q.KHR_BINARY_GLTF].content)}else i=JSON.parse(a.decode(n));else i=n;if(i.asset===void 0||i.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new LT(i,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const u=this.pluginCallbacks[c](l);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[u.name]=u,s[u.name]=!0}if(i.extensionsUsed)for(let c=0;c<i.extensionsUsed.length;++c){const u=i.extensionsUsed[c],h=i.extensionsRequired||[];switch(u){case q.KHR_MATERIALS_UNLIT:s[u]=new rT;break;case q.KHR_DRACO_MESH_COMPRESSION:s[u]=new wT(i,this.dracoLoader);break;case q.KHR_TEXTURE_TRANSFORM:s[u]=new TT;break;case q.KHR_MESH_QUANTIZATION:s[u]=new xT;break;default:h.indexOf(u)>=0&&o[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(s),l.setPlugins(o),l.parse(t,r)}parseAsync(n,e){const t=this;return new Promise(function(r,i){t.parse(n,e,r,i)})}};function tT(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const q={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};let nT=class{constructor(n){this.parser=n,this.name=q.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const n=this.parser,e=this.parser.json.nodes||[];for(let t=0,r=e.length;t<r;t++){const i=e[t];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&n._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(n){const e=this.parser,t="light:"+n;let r=e.cache.get(t);if(r)return r;const i=e.json,s=((i.extensions&&i.extensions[this.name]||{}).lights||[])[n];let o;const a=new ke(16777215);s.color!==void 0&&a.setRGB(s.color[0],s.color[1],s.color[2],on);const l=s.range!==void 0?s.range:0;switch(s.type){case"directional":o=new Tf(a),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new wf(a),o.distance=l;break;case"spot":o=new bf(a),o.distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=s.spot.innerConeAngle!==void 0?s.spot.innerConeAngle:0,s.spot.outerConeAngle=s.spot.outerConeAngle!==void 0?s.spot.outerConeAngle:Math.PI/4,o.angle=s.spot.outerConeAngle,o.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return o.position.set(0,0,0),It(o,s),s.intensity!==void 0&&(o.intensity=s.intensity),o.name=e.createUniqueName(s.name||"light_"+n),r=Promise.resolve(o),e.cache.add(t,r),r}getDependency(n,e){if(n==="light")return this._loadLight(e)}createNodeAttachment(n){const e=this,t=this.parser,r=t.json.nodes[n],i=(r.extensions&&r.extensions[this.name]||{}).light;return i===void 0?null:this._loadLight(i).then(function(s){return t._getNodeRef(e.cache,i,s)})}},rT=class{constructor(){this.name=q.KHR_MATERIALS_UNLIT}getMaterialType(){return $e}extendParams(n,e,t){const r=[];n.color=new ke(1,1,1),n.opacity=1;const i=e.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const s=i.baseColorFactor;n.color.setRGB(s[0],s[1],s[2],on),n.opacity=s[3]}i.baseColorTexture!==void 0&&r.push(t.assignTexture(n,"map",i.baseColorTexture,Br))}return Promise.all(r)}},iT=class{constructor(n){this.parser=n,this.name=q.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(n,e){const t=this.parser.json.materials[n];if(!t.extensions||!t.extensions[this.name])return Promise.resolve();const r=t.extensions[this.name].emissiveStrength;return r!==void 0&&(e.emissiveIntensity=r),Promise.resolve()}},sT=class{constructor(n){this.parser=n,this.name=q.KHR_MATERIALS_CLEARCOAT}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:ve}extendMaterialParams(n,e){const t=this.parser,r=t.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];if(s.clearcoatFactor!==void 0&&(e.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&i.push(t.assignTexture(e,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&i.push(t.assignTexture(e,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(i.push(t.assignTexture(e,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){const o=s.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new Z(o,o)}return Promise.all(i)}},oT=class{constructor(n){this.parser=n,this.name=q.KHR_MATERIALS_DISPERSION}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:ve}extendMaterialParams(n,e){const t=this.parser.json.materials[n];if(!t.extensions||!t.extensions[this.name])return Promise.resolve();const r=t.extensions[this.name];return e.dispersion=r.dispersion!==void 0?r.dispersion:0,Promise.resolve()}},aT=class{constructor(n){this.parser=n,this.name=q.KHR_MATERIALS_IRIDESCENCE}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:ve}extendMaterialParams(n,e){const t=this.parser,r=t.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return s.iridescenceFactor!==void 0&&(e.iridescence=s.iridescenceFactor),s.iridescenceTexture!==void 0&&i.push(t.assignTexture(e,"iridescenceMap",s.iridescenceTexture)),s.iridescenceIor!==void 0&&(e.iridescenceIOR=s.iridescenceIor),e.iridescenceThicknessRange===void 0&&(e.iridescenceThicknessRange=[100,400]),s.iridescenceThicknessMinimum!==void 0&&(e.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),s.iridescenceThicknessMaximum!==void 0&&(e.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),s.iridescenceThicknessTexture!==void 0&&i.push(t.assignTexture(e,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(i)}},lT=class{constructor(n){this.parser=n,this.name=q.KHR_MATERIALS_SHEEN}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:ve}extendMaterialParams(n,e){const t=this.parser,r=t.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[];e.sheenColor=new ke(0,0,0),e.sheenRoughness=0,e.sheen=1;const s=r.extensions[this.name];if(s.sheenColorFactor!==void 0){const o=s.sheenColorFactor;e.sheenColor.setRGB(o[0],o[1],o[2],on)}return s.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=s.sheenRoughnessFactor),s.sheenColorTexture!==void 0&&i.push(t.assignTexture(e,"sheenColorMap",s.sheenColorTexture,Br)),s.sheenRoughnessTexture!==void 0&&i.push(t.assignTexture(e,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(i)}},cT=class{constructor(n){this.parser=n,this.name=q.KHR_MATERIALS_TRANSMISSION}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:ve}extendMaterialParams(n,e){const t=this.parser,r=t.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return s.transmissionFactor!==void 0&&(e.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&i.push(t.assignTexture(e,"transmissionMap",s.transmissionTexture)),Promise.all(i)}},uT=class{constructor(n){this.parser=n,this.name=q.KHR_MATERIALS_VOLUME}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:ve}extendMaterialParams(n,e){const t=this.parser,r=t.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];e.thickness=s.thicknessFactor!==void 0?s.thicknessFactor:0,s.thicknessTexture!==void 0&&i.push(t.assignTexture(e,"thicknessMap",s.thicknessTexture)),e.attenuationDistance=s.attenuationDistance||1/0;const o=s.attenuationColor||[1,1,1];return e.attenuationColor=new ke().setRGB(o[0],o[1],o[2],on),Promise.all(i)}},hT=class{constructor(n){this.parser=n,this.name=q.KHR_MATERIALS_IOR}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:ve}extendMaterialParams(n,e){const t=this.parser.json.materials[n];if(!t.extensions||!t.extensions[this.name])return Promise.resolve();const r=t.extensions[this.name];return e.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}},dT=class{constructor(n){this.parser=n,this.name=q.KHR_MATERIALS_SPECULAR}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:ve}extendMaterialParams(n,e){const t=this.parser,r=t.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];e.specularIntensity=s.specularFactor!==void 0?s.specularFactor:1,s.specularTexture!==void 0&&i.push(t.assignTexture(e,"specularIntensityMap",s.specularTexture));const o=s.specularColorFactor||[1,1,1];return e.specularColor=new ke().setRGB(o[0],o[1],o[2],on),s.specularColorTexture!==void 0&&i.push(t.assignTexture(e,"specularColorMap",s.specularColorTexture,Br)),Promise.all(i)}},pT=class{constructor(n){this.parser=n,this.name=q.EXT_MATERIALS_BUMP}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:ve}extendMaterialParams(n,e){const t=this.parser,r=t.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return e.bumpScale=s.bumpFactor!==void 0?s.bumpFactor:1,s.bumpTexture!==void 0&&i.push(t.assignTexture(e,"bumpMap",s.bumpTexture)),Promise.all(i)}},fT=class{constructor(n){this.parser=n,this.name=q.KHR_MATERIALS_ANISOTROPY}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:ve}extendMaterialParams(n,e){const t=this.parser,r=t.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return s.anisotropyStrength!==void 0&&(e.anisotropy=s.anisotropyStrength),s.anisotropyRotation!==void 0&&(e.anisotropyRotation=s.anisotropyRotation),s.anisotropyTexture!==void 0&&i.push(t.assignTexture(e,"anisotropyMap",s.anisotropyTexture)),Promise.all(i)}},mT=class{constructor(n){this.parser=n,this.name=q.KHR_TEXTURE_BASISU}loadTexture(n){const e=this.parser,t=e.json,r=t.textures[n];if(!r.extensions||!r.extensions[this.name])return null;const i=r.extensions[this.name],s=e.options.ktx2Loader;if(!s){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(n,i.source,s)}},gT=class{constructor(n){this.parser=n,this.name=q.EXT_TEXTURE_WEBP}loadTexture(n){const e=this.name,t=this.parser,r=t.json,i=r.textures[n];if(!i.extensions||!i.extensions[e])return null;const s=i.extensions[e],o=r.images[s.source];let a=t.textureLoader;if(o.uri){const l=t.options.manager.getHandler(o.uri);l!==null&&(a=l)}return t.loadTextureImage(n,s.source,a)}},_T=class{constructor(n){this.parser=n,this.name=q.EXT_TEXTURE_AVIF}loadTexture(n){const e=this.name,t=this.parser,r=t.json,i=r.textures[n];if(!i.extensions||!i.extensions[e])return null;const s=i.extensions[e],o=r.images[s.source];let a=t.textureLoader;if(o.uri){const l=t.options.manager.getHandler(o.uri);l!==null&&(a=l)}return t.loadTextureImage(n,s.source,a)}},vT=class{constructor(n){this.name=q.EXT_MESHOPT_COMPRESSION,this.parser=n}loadBufferView(n){const e=this.parser.json,t=e.bufferViews[n];if(t.extensions&&t.extensions[this.name]){const r=t.extensions[this.name],i=this.parser.getDependency("buffer",r.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(o){const a=r.byteOffset||0,l=r.byteLength||0,c=r.count,u=r.byteStride,h=new Uint8Array(o,a,l);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(c,u,h,r.mode,r.filter).then(function(d){return d.buffer}):s.ready.then(function(){const d=new ArrayBuffer(c*u);return s.decodeGltfBuffer(new Uint8Array(d),c,u,h,r.mode,r.filter),d})})}else return null}},yT=class{constructor(n){this.name=q.EXT_MESH_GPU_INSTANCING,this.parser=n}createNodeMesh(n){const e=this.parser.json,t=e.nodes[n];if(!t.extensions||!t.extensions[this.name]||t.mesh===void 0)return null;const r=e.meshes[t.mesh];for(const a of r.primitives)if(a.mode!==gt.TRIANGLES&&a.mode!==gt.TRIANGLE_STRIP&&a.mode!==gt.TRIANGLE_FAN&&a.mode!==void 0)return null;const i=t.extensions[this.name].attributes,s=[],o={};for(const a in i)s.push(this.parser.getDependency("accessor",i[a]).then(l=>(o[a]=l,o[a])));return s.length<1?null:(s.push(this.parser.createNodeMesh(n)),Promise.all(s).then(a=>{const l=a.pop(),c=l.isGroup?l.children:[l],u=a[0].count,h=[];for(const d of c){const f=new H,p=new P,m=new Fe,g=new P(1,1,1),_=new bc(d.geometry,d.material,u);for(let v=0;v<u;v++)o.TRANSLATION&&p.fromBufferAttribute(o.TRANSLATION,v),o.ROTATION&&m.fromBufferAttribute(o.ROTATION,v),o.SCALE&&g.fromBufferAttribute(o.SCALE,v),_.setMatrixAt(v,f.compose(p,m,g));for(const v in o)if(v==="_COLOR_0"){const y=o[v];_.instanceColor=new xf(y.array,y.itemSize,y.normalized)}else v!=="TRANSLATION"&&v!=="ROTATION"&&v!=="SCALE"&&d.geometry.setAttribute(v,o[v]);ti.prototype.copy.call(_,d),this.parser.assignFinalMaterial(_),h.push(_)}return l.isGroup?(l.clear(),l.add(...h),l):h[0]}))}};const im="glTF",ai=12,Lh={JSON:1313821514,BIN:5130562};let bT=class{constructor(n){this.name=q.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(n,0,ai),t=new TextDecoder;if(this.header={magic:t.decode(new Uint8Array(n.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==im)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-ai,i=new DataView(n,ai);let s=0;for(;s<r;){const o=i.getUint32(s,!0);s+=4;const a=i.getUint32(s,!0);if(s+=4,a===Lh.JSON){const l=new Uint8Array(n,ai+s,o);this.content=t.decode(l)}else if(a===Lh.BIN){const l=ai+s;this.body=n.slice(l,l+o)}s+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},wT=class{constructor(n,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=q.KHR_DRACO_MESH_COMPRESSION,this.json=n,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(n,e){const t=this.json,r=this.dracoLoader,i=n.extensions[this.name].bufferView,s=n.extensions[this.name].attributes,o={},a={},l={};for(const c in s){const u=Al[c]||c.toLowerCase();o[u]=s[c]}for(const c in n.attributes){const u=Al[c]||c.toLowerCase();if(s[c]!==void 0){const h=t.accessors[n.attributes[c]],d=Pr[h.componentType];l[u]=d.name,a[u]=h.normalized===!0}}return e.getDependency("bufferView",i).then(function(c){return new Promise(function(u,h){r.decodeDracoFile(c,function(d){for(const f in d.attributes){const p=d.attributes[f],m=a[f];m!==void 0&&(p.normalized=m)}u(d)},o,l,on,h)})})}},TT=class{constructor(){this.name=q.KHR_TEXTURE_TRANSFORM}extendTexture(n,e){return(e.texCoord===void 0||e.texCoord===n.channel)&&e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(n=n.clone(),e.texCoord!==void 0&&(n.channel=e.texCoord),e.offset!==void 0&&n.offset.fromArray(e.offset),e.rotation!==void 0&&(n.rotation=e.rotation),e.scale!==void 0&&n.repeat.fromArray(e.scale),n.needsUpdate=!0),n}},xT=class{constructor(){this.name=q.KHR_MESH_QUANTIZATION}},sm=class extends Vf{constructor(n,e,t,r){super(n,e,t,r)}copySampleValue_(n){const e=this.resultBuffer,t=this.sampleValues,r=this.valueSize,i=n*r*3+r;for(let s=0;s!==r;s++)e[s]=t[i+s];return e}interpolate_(n,e,t,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=o*2,l=o*3,c=r-e,u=(t-e)/c,h=u*u,d=h*u,f=n*l,p=f-l,m=-2*d+3*h,g=d-h,_=1-m,v=g-h+u;for(let y=0;y!==o;y++){const T=s[p+y+o],A=s[p+y+a]*c,w=s[f+y+o],x=s[f+y]*c;i[y]=_*T+v*A+m*w+g*x}return i}};const ET=new Fe;let AT=class extends sm{interpolate_(n,e,t,r){const i=super.interpolate_(n,e,t,r);return ET.fromArray(i).normalize().toArray(i),i}};const gt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Pr={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ih={9728:wc,9729:Ui,9984:Cf,9985:Sf,9986:Mf,9987:Ao},Dh={33071:Of,33648:Rf,10497:zr},ea={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Al={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},un={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},PT={CUBICSPLINE:void 0,LINEAR:Mo,STEP:Bf},ta={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function MT(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new es({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:zf})),n.DefaultMaterial}function In(n,e,t){for(const r in t.extensions)n[r]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=t.extensions[r])}function It(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function ST(n,e,t){let r=!1,i=!1,s=!1;for(let c=0,u=e.length;c<u;c++){const h=e[c];if(h.POSITION!==void 0&&(r=!0),h.NORMAL!==void 0&&(i=!0),h.COLOR_0!==void 0&&(s=!0),r&&i&&s)break}if(!r&&!i&&!s)return Promise.resolve(n);const o=[],a=[],l=[];for(let c=0,u=e.length;c<u;c++){const h=e[c];if(r){const d=h.POSITION!==void 0?t.getDependency("accessor",h.POSITION):n.attributes.position;o.push(d)}if(i){const d=h.NORMAL!==void 0?t.getDependency("accessor",h.NORMAL):n.attributes.normal;a.push(d)}if(s){const d=h.COLOR_0!==void 0?t.getDependency("accessor",h.COLOR_0):n.attributes.color;l.push(d)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const u=c[0],h=c[1],d=c[2];return r&&(n.morphAttributes.position=u),i&&(n.morphAttributes.normal=h),s&&(n.morphAttributes.color=d),n.morphTargetsRelative=!0,n})}function CT(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,r=e.weights.length;t<r;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let r=0,i=t.length;r<i;r++)n.morphTargetDictionary[t[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function RT(n){let e;const t=n.extensions&&n.extensions[q.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+na(t.attributes):e=n.indices+":"+na(n.attributes)+":"+n.mode,n.targets!==void 0)for(let r=0,i=n.targets.length;r<i;r++)e+=":"+na(n.targets[r]);return e}function na(n){let e="";const t=Object.keys(n).sort();for(let r=0,i=t.length;r<i;r++)e+=t[r]+":"+n[t[r]]+";";return e}function Pl(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function OT(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":n.search(/\.ktx2($|\?)/i)>0||n.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const kT=new H;let LT=class{constructor(n={},e={}){this.json=n,this.extensions={},this.plugins={},this.options=e,this.cache=new tT,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let t=!1,r=-1,i=!1,s=-1;if(typeof navigator<"u"){const o=navigator.userAgent;t=/^((?!chrome|android).)*safari/i.test(o)===!0;const a=o.match(/Version\/(\d+)/);r=t&&a?parseInt(a[1],10):-1,i=o.indexOf("Firefox")>-1,s=i?o.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||t&&r<17||i&&s<98?this.textureLoader=new To(this.options.manager):this.textureLoader=new Ef(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new jr(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(n){this.extensions=n}setPlugins(n){this.plugins=n}parse(n,e){const t=this,r=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([t.getDependencies("scene"),t.getDependencies("animation"),t.getDependencies("camera")])}).then(function(s){const o={scene:s[0][r.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:r.asset,parser:t,userData:{}};return In(i,o,r),It(o,r),Promise.all(t._invokeAll(function(a){return a.afterRoot&&a.afterRoot(o)})).then(function(){for(const a of o.scenes)a.updateMatrixWorld();n(o)})}).catch(e)}_markDefs(){const n=this.json.nodes||[],e=this.json.skins||[],t=this.json.meshes||[];for(let r=0,i=e.length;r<i;r++){const s=e[r].joints;for(let o=0,a=s.length;o<a;o++)n[s[o]].isBone=!0}for(let r=0,i=n.length;r<i;r++){const s=n[r];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(t[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(n,e){e!==void 0&&(n.refs[e]===void 0&&(n.refs[e]=n.uses[e]=0),n.refs[e]++)}_getNodeRef(n,e,t){if(n.refs[e]<=1)return t;const r=t.clone(),i=(s,o)=>{const a=this.associations.get(s);a!=null&&this.associations.set(o,a);for(const[l,c]of s.children.entries())i(c,o.children[l])};return i(t,r),r.name+="_instance_"+n.uses[e]++,r}_invokeOne(n){const e=Object.values(this.plugins);e.push(this);for(let t=0;t<e.length;t++){const r=n(e[t]);if(r)return r}return null}_invokeAll(n){const e=Object.values(this.plugins);e.unshift(this);const t=[];for(let r=0;r<e.length;r++){const i=n(e[r]);i&&t.push(i)}return t}getDependency(n,e){const t=n+":"+e;let r=this.cache.get(t);if(!r){switch(n){case"scene":r=this.loadScene(e);break;case"node":r=this._invokeOne(function(i){return i.loadNode&&i.loadNode(e)});break;case"mesh":r=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(e)});break;case"accessor":r=this.loadAccessor(e);break;case"bufferView":r=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(e)});break;case"buffer":r=this.loadBuffer(e);break;case"material":r=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(e)});break;case"texture":r=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(e)});break;case"skin":r=this.loadSkin(e);break;case"animation":r=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(e)});break;case"camera":r=this.loadCamera(e);break;default:if(r=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(n,e)}),!r)throw new Error("Unknown type: "+n);break}this.cache.add(t,r)}return r}getDependencies(n){let e=this.cache.get(n);if(!e){const t=this,r=this.json[n+(n==="mesh"?"es":"s")]||[];e=Promise.all(r.map(function(i,s){return t.getDependency(n,s)})),this.cache.add(n,e)}return e}loadBuffer(n){const e=this.json.buffers[n],t=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&n===0)return Promise.resolve(this.extensions[q.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(i,s){t.load(Bt.resolveURL(e.uri,r.path),i,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(n){const e=this.json.bufferViews[n];return this.getDependency("buffer",e.buffer).then(function(t){const r=e.byteLength||0,i=e.byteOffset||0;return t.slice(i,i+r)})}loadAccessor(n){const e=this,t=this.json,r=this.json.accessors[n];if(r.bufferView===void 0&&r.sparse===void 0){const s=ea[r.type],o=Pr[r.componentType],a=r.normalized===!0,l=new o(r.count*s);return Promise.resolve(new Ce(l,s,a))}const i=[];return r.bufferView!==void 0?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),r.sparse!==void 0&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then(function(s){const o=s[0],a=ea[r.type],l=Pr[r.componentType],c=l.BYTES_PER_ELEMENT,u=c*a,h=r.byteOffset||0,d=r.bufferView!==void 0?t.bufferViews[r.bufferView].byteStride:void 0,f=r.normalized===!0;let p,m;if(d&&d!==u){const g=Math.floor(h/d),_="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+g+":"+r.count;let v=e.cache.get(_);v||(p=new l(o,g*d,r.count*d/c),v=new Af(p,d/c),e.cache.add(_,v)),m=new Pf(v,a,h%d/c,f)}else o===null?p=new l(r.count*a):p=new l(o,h,r.count*a),m=new Ce(p,a,f);if(r.sparse!==void 0){const g=ea.SCALAR,_=Pr[r.sparse.indices.componentType],v=r.sparse.indices.byteOffset||0,y=r.sparse.values.byteOffset||0,T=new _(s[1],v,r.sparse.count*g),A=new l(s[2],y,r.sparse.count*a);o!==null&&(m=new Ce(m.array.slice(),m.itemSize,m.normalized)),m.normalized=!1;for(let w=0,x=T.length;w<x;w++){const b=T[w];if(m.setX(b,A[w*a]),a>=2&&m.setY(b,A[w*a+1]),a>=3&&m.setZ(b,A[w*a+2]),a>=4&&m.setW(b,A[w*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}m.normalized=f}return m})}loadTexture(n){const e=this.json,t=this.options,r=e.textures[n].source,i=e.images[r];let s=this.textureLoader;if(i.uri){const o=t.manager.getHandler(i.uri);o!==null&&(s=o)}return this.loadTextureImage(n,r,s)}loadTextureImage(n,e,t){const r=this,i=this.json,s=i.textures[n],o=i.images[e],a=(o.uri||o.bufferView)+":"+s.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(e,t).then(function(c){c.flipY=!1,c.name=s.name||o.name||"",c.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(c.name=o.uri);const u=(i.samplers||{})[s.sampler]||{};return c.magFilter=Ih[u.magFilter]||Ui,c.minFilter=Ih[u.minFilter]||Ao,c.wrapS=Dh[u.wrapS]||zr,c.wrapT=Dh[u.wrapT]||zr,c.generateMipmaps=!c.isCompressedTexture&&c.minFilter!==wc&&c.minFilter!==Ui,r.associations.set(c,{textures:n}),c}).catch(function(){return null});return this.textureCache[a]=l,l}loadImageSource(n,e){const t=this,r=this.json,i=this.options;if(this.sourceCache[n]!==void 0)return this.sourceCache[n].then(u=>u.clone());const s=r.images[n],o=self.URL||self.webkitURL;let a=s.uri||"",l=!1;if(s.bufferView!==void 0)a=t.getDependency("bufferView",s.bufferView).then(function(u){l=!0;const h=new Blob([u],{type:s.mimeType});return a=o.createObjectURL(h),a});else if(s.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+n+" is missing URI and bufferView");const c=Promise.resolve(a).then(function(u){return new Promise(function(h,d){let f=h;e.isImageBitmapLoader===!0&&(f=function(p){const m=new ji(p);m.needsUpdate=!0,h(m)}),e.load(Bt.resolveURL(u,i.path),f,void 0,d)})}).then(function(u){return l===!0&&o.revokeObjectURL(a),It(u,s),u.userData.mimeType=s.mimeType||OT(s.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),u});return this.sourceCache[n]=c,c}assignTexture(n,e,t,r){const i=this;return this.getDependency("texture",t.index).then(function(s){if(!s)return null;if(t.texCoord!==void 0&&t.texCoord>0&&(s=s.clone(),s.channel=t.texCoord),i.extensions[q.KHR_TEXTURE_TRANSFORM]){const o=t.extensions!==void 0?t.extensions[q.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const a=i.associations.get(s);s=i.extensions[q.KHR_TEXTURE_TRANSFORM].extendTexture(s,o),i.associations.set(s,a)}}return r!==void 0&&(s.colorSpace=r),n[e]=s,s})}assignFinalMaterial(n){const e=n.geometry;let t=n.material;const r=e.attributes.tangent===void 0,i=e.attributes.color!==void 0,s=e.attributes.normal===void 0;if(n.isPoints){const o="PointsMaterial:"+t.uuid;let a=this.cache.get(o);a||(a=new ni,Ar.prototype.copy.call(a,t),a.color.copy(t.color),a.map=t.map,a.sizeAttenuation=!1,this.cache.add(o,a)),t=a}else if(n.isLine){const o="LineBasicMaterial:"+t.uuid;let a=this.cache.get(o);a||(a=new _c,Ar.prototype.copy.call(a,t),a.color.copy(t.color),a.map=t.map,this.cache.add(o,a)),t=a}if(r||i||s){let o="ClonedMaterial:"+t.uuid+":";r&&(o+="derivative-tangents:"),i&&(o+="vertex-colors:"),s&&(o+="flat-shading:");let a=this.cache.get(o);a||(a=t.clone(),i&&(a.vertexColors=!0),s&&(a.flatShading=!0),r&&(a.normalScale&&(a.normalScale.y*=-1),a.clearcoatNormalScale&&(a.clearcoatNormalScale.y*=-1)),this.cache.add(o,a),this.associations.set(a,this.associations.get(t))),t=a}n.material=t}getMaterialType(){return es}loadMaterial(n){const e=this,t=this.json,r=this.extensions,i=t.materials[n];let s;const o={},a=i.extensions||{},l=[];if(a[q.KHR_MATERIALS_UNLIT]){const u=r[q.KHR_MATERIALS_UNLIT];s=u.getMaterialType(),l.push(u.extendParams(o,i,e))}else{const u=i.pbrMetallicRoughness||{};if(o.color=new ke(1,1,1),o.opacity=1,Array.isArray(u.baseColorFactor)){const h=u.baseColorFactor;o.color.setRGB(h[0],h[1],h[2],on),o.opacity=h[3]}u.baseColorTexture!==void 0&&l.push(e.assignTexture(o,"map",u.baseColorTexture,Br)),o.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,o.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(l.push(e.assignTexture(o,"metalnessMap",u.metallicRoughnessTexture)),l.push(e.assignTexture(o,"roughnessMap",u.metallicRoughnessTexture))),s=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(n)}),l.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(n,o)})))}i.doubleSided===!0&&(o.side=vc);const c=i.alphaMode||ta.OPAQUE;if(c===ta.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,c===ta.MASK&&(o.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&s!==$e&&(l.push(e.assignTexture(o,"normalMap",i.normalTexture)),o.normalScale=new Z(1,1),i.normalTexture.scale!==void 0)){const u=i.normalTexture.scale;o.normalScale.set(u,u)}if(i.occlusionTexture!==void 0&&s!==$e&&(l.push(e.assignTexture(o,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&s!==$e){const u=i.emissiveFactor;o.emissive=new ke().setRGB(u[0],u[1],u[2],on)}return i.emissiveTexture!==void 0&&s!==$e&&l.push(e.assignTexture(o,"emissiveMap",i.emissiveTexture,Br)),Promise.all(l).then(function(){const u=new s(o);return i.name&&(u.name=i.name),It(u,i),e.associations.set(u,{materials:n}),i.extensions&&In(r,u,i),u})}createUniqueName(n){const e=kf.sanitizeNodeName(n||"");return e in this.nodeNamesUsed?e+"_"+ ++this.nodeNamesUsed[e]:(this.nodeNamesUsed[e]=0,e)}loadGeometries(n){const e=this,t=this.extensions,r=this.primitiveCache;function i(o){return t[q.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,e).then(function(a){return Nh(a,o,e)})}const s=[];for(let o=0,a=n.length;o<a;o++){const l=n[o],c=RT(l),u=r[c];if(u)s.push(u.promise);else{let h;l.extensions&&l.extensions[q.KHR_DRACO_MESH_COMPRESSION]?h=i(l):h=Nh(new xt,l,e),r[c]={primitive:l,promise:h},s.push(h)}}return Promise.all(s)}loadMesh(n){const e=this,t=this.json,r=this.extensions,i=t.meshes[n],s=i.primitives,o=[];for(let a=0,l=s.length;a<l;a++){const c=s[a].material===void 0?MT(this.cache):this.getDependency("material",s[a].material);o.push(c)}return o.push(e.loadGeometries(s)),Promise.all(o).then(function(a){const l=a.slice(0,a.length-1),c=a[a.length-1],u=[];for(let d=0,f=c.length;d<f;d++){const p=c[d],m=s[d];let g;const _=l[d];if(m.mode===gt.TRIANGLES||m.mode===gt.TRIANGLE_STRIP||m.mode===gt.TRIANGLE_FAN||m.mode===void 0)g=i.isSkinnedMesh===!0?new Lf(p,_):new Tt(p,_),g.isSkinnedMesh===!0&&g.normalizeSkinWeights(),m.mode===gt.TRIANGLE_STRIP?g.geometry=kh(g.geometry,xo):m.mode===gt.TRIANGLE_FAN&&(g.geometry=kh(g.geometry,Ur));else if(m.mode===gt.LINES)g=new Po(p,_);else if(m.mode===gt.LINE_STRIP)g=new vf(p,_);else if(m.mode===gt.LINE_LOOP)g=new If(p,_);else if(m.mode===gt.POINTS)g=new Ji(p,_);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);Object.keys(g.geometry.morphAttributes).length>0&&CT(g,i),g.name=e.createUniqueName(i.name||"mesh_"+n),It(g,i),m.extensions&&In(r,g,m),e.assignFinalMaterial(g),u.push(g)}for(let d=0,f=u.length;d<f;d++)e.associations.set(u[d],{meshes:n,primitives:d});if(u.length===1)return i.extensions&&In(r,u[0],i),u[0];const h=new Ae;i.extensions&&In(r,h,i),e.associations.set(h,{meshes:n});for(let d=0,f=u.length;d<f;d++)h.add(u[d]);return h})}loadCamera(n){let e;const t=this.json.cameras[n],r=t[t.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return t.type==="perspective"?e=new Df(j.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):t.type==="orthographic"&&(e=new Nf(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),t.name&&(e.name=this.createUniqueName(t.name)),It(e,t),Promise.resolve(e)}loadSkin(n){const e=this.json.skins[n],t=[];for(let r=0,i=e.joints.length;r<i;r++)t.push(this._loadNodeShallow(e.joints[r]));return e.inverseBindMatrices!==void 0?t.push(this.getDependency("accessor",e.inverseBindMatrices)):t.push(null),Promise.all(t).then(function(r){const i=r.pop(),s=r,o=[],a=[];for(let l=0,c=s.length;l<c;l++){const u=s[l];if(u){o.push(u);const h=new H;i!==null&&h.fromArray(i.array,l*16),a.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[l])}return new Ff(o,a)})}loadAnimation(n){const e=this.json,t=this,r=e.animations[n],i=r.name?r.name:"animation_"+n,s=[],o=[],a=[],l=[],c=[];for(let u=0,h=r.channels.length;u<h;u++){const d=r.channels[u],f=r.samplers[d.sampler],p=d.target,m=p.node,g=r.parameters!==void 0?r.parameters[f.input]:f.input,_=r.parameters!==void 0?r.parameters[f.output]:f.output;p.node!==void 0&&(s.push(this.getDependency("node",m)),o.push(this.getDependency("accessor",g)),a.push(this.getDependency("accessor",_)),l.push(f),c.push(p))}return Promise.all([Promise.all(s),Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c)]).then(function(u){const h=u[0],d=u[1],f=u[2],p=u[3],m=u[4],g=[];for(let v=0,y=h.length;v<y;v++){const T=h[v],A=d[v],w=f[v],x=p[v],b=m[v];if(T===void 0)continue;T.updateMatrix&&T.updateMatrix();const E=t._createAnimationTracks(T,A,w,x,b);if(E)for(let M=0;M<E.length;M++)g.push(E[M])}const _=new Uf(i,void 0,g);return It(_,r),_})}createNodeMesh(n){const e=this.json,t=this,r=e.nodes[n];return r.mesh===void 0?null:t.getDependency("mesh",r.mesh).then(function(i){const s=t._getNodeRef(t.meshCache,r.mesh,i);return r.weights!==void 0&&s.traverse(function(o){if(o.isMesh)for(let a=0,l=r.weights.length;a<l;a++)o.morphTargetInfluences[a]=r.weights[a]}),s})}loadNode(n){const e=this.json,t=this,r=e.nodes[n],i=t._loadNodeShallow(n),s=[],o=r.children||[];for(let l=0,c=o.length;l<c;l++)s.push(t.getDependency("node",o[l]));const a=r.skin===void 0?Promise.resolve(null):t.getDependency("skin",r.skin);return Promise.all([i,Promise.all(s),a]).then(function(l){const c=l[0],u=l[1],h=l[2];h!==null&&c.traverse(function(d){d.isSkinnedMesh&&d.bind(h,kT)});for(let d=0,f=u.length;d<f;d++)c.add(u[d]);return c})}_loadNodeShallow(n){const e=this.json,t=this.extensions,r=this;if(this.nodeCache[n]!==void 0)return this.nodeCache[n];const i=e.nodes[n],s=i.name?r.createUniqueName(i.name):"",o=[],a=r._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(n)});return a&&o.push(a),i.camera!==void 0&&o.push(r.getDependency("camera",i.camera).then(function(l){return r._getNodeRef(r.cameraCache,i.camera,l)})),r._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(n)}).forEach(function(l){o.push(l)}),this.nodeCache[n]=Promise.all(o).then(function(l){let c;if(i.isBone===!0?c=new jf:l.length>1?c=new Ae:l.length===1?c=l[0]:c=new ti,c!==l[0])for(let u=0,h=l.length;u<h;u++)c.add(l[u]);if(i.name&&(c.userData.name=i.name,c.name=s),It(c,i),i.extensions&&In(t,c,i),i.matrix!==void 0){const u=new H;u.fromArray(i.matrix),c.applyMatrix4(u)}else i.translation!==void 0&&c.position.fromArray(i.translation),i.rotation!==void 0&&c.quaternion.fromArray(i.rotation),i.scale!==void 0&&c.scale.fromArray(i.scale);if(!r.associations.has(c))r.associations.set(c,{});else if(i.mesh!==void 0&&r.meshCache.refs[i.mesh]>1){const u=r.associations.get(c);r.associations.set(c,{...u})}return r.associations.get(c).nodes=n,c}),this.nodeCache[n]}loadScene(n){const e=this.extensions,t=this.json.scenes[n],r=this,i=new Ae;t.name&&(i.name=r.createUniqueName(t.name)),It(i,t),t.extensions&&In(e,i,t);const s=t.nodes||[],o=[];for(let a=0,l=s.length;a<l;a++)o.push(r.getDependency("node",s[a]));return Promise.all(o).then(function(a){for(let c=0,u=a.length;c<u;c++)i.add(a[c]);const l=c=>{const u=new Map;for(const[h,d]of r.associations)(h instanceof Ar||h instanceof ji)&&u.set(h,d);return c.traverse(h=>{const d=r.associations.get(h);d!=null&&u.set(h,d)}),u};return r.associations=l(i),i})}_createAnimationTracks(n,e,t,r,i){const s=[],o=n.name?n.name:n.uuid,a=[];un[i.path]===un.weights?n.traverse(function(h){h.morphTargetInfluences&&a.push(h.name?h.name:h.uuid)}):a.push(o);let l;switch(un[i.path]){case un.weights:l=Js;break;case un.rotation:l=eo;break;case un.translation:case un.scale:l=Qs;break;default:switch(t.itemSize){case 1:l=Js;break;case 2:case 3:default:l=Qs;break}break}const c=r.interpolation!==void 0?PT[r.interpolation]:Mo,u=this._getArrayFromAccessor(t);for(let h=0,d=a.length;h<d;h++){const f=new l(a[h]+"."+un[i.path],e.array,u,c);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(f),s.push(f)}return s}_getArrayFromAccessor(n){let e=n.array;if(n.normalized){const t=Pl(e.constructor),r=new Float32Array(e.length);for(let i=0,s=e.length;i<s;i++)r[i]=e[i]*t;e=r}return e}_createCubicSplineTrackInterpolant(n){n.createInterpolant=function(e){const t=this instanceof eo?AT:sm;return new t(this.times,this.values,this.getValueSize()/3,e)},n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}};function IT(n,e,t){const r=e.attributes,i=new Tc;if(r.POSITION!==void 0){const a=t.json.accessors[r.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(i.set(new P(l[0],l[1],l[2]),new P(c[0],c[1],c[2])),a.normalized){const u=Pl(Pr[a.componentType]);i.min.multiplyScalar(u),i.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const a=new P,l=new P;for(let c=0,u=s.length;c<u;c++){const h=s[c];if(h.POSITION!==void 0){const d=t.json.accessors[h.POSITION],f=d.min,p=d.max;if(f!==void 0&&p!==void 0){if(l.setX(Math.max(Math.abs(f[0]),Math.abs(p[0]))),l.setY(Math.max(Math.abs(f[1]),Math.abs(p[1]))),l.setZ(Math.max(Math.abs(f[2]),Math.abs(p[2]))),d.normalized){const m=Pl(Pr[d.componentType]);l.multiplyScalar(m)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(a)}n.boundingBox=i;const o=new sr;i.getCenter(o.center),o.radius=i.min.distanceTo(i.max)/2,n.boundingSphere=o}function Nh(n,e,t){const r=e.attributes,i=[];function s(o,a){return t.getDependency("accessor",o).then(function(l){n.setAttribute(a,l)})}for(const o in r){const a=Al[o]||o.toLowerCase();a in n.attributes||i.push(s(r[o],a))}if(e.indices!==void 0&&!n.index){const o=t.getDependency("accessor",e.indices).then(function(a){n.setIndex(a)});i.push(o)}return dh.workingColorSpace!==on&&"COLOR_0"in r&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${dh.workingColorSpace}" not supported.`),It(n,e),IT(n,e,t),Promise.all(i).then(function(){return e.targets!==void 0?ST(n,e.targets,t):n})}class om extends Jw{constructor(e=So){super(),this.manager=e,this.adjustmentTransform=new H}parse(e){const t=super.parse(e),r=t.glbBytes.slice().buffer;return new Promise((i,s)=>{const o=this.manager,a=this.fetchOptions,l=o.getHandler("path.gltf")||new kc(o);a.credentials==="include"&&a.mode==="cors"&&l.setCrossOrigin("use-credentials"),"credentials"in a&&l.setWithCredentials(a.credentials==="include"),a.headers&&l.setRequestHeader(a.headers);let c=this.workingPath;!/[\\/]$/.test(c)&&c.length&&(c+="/");const u=this.adjustmentTransform;l.parse(r,c,h=>{const{batchTable:d,featureTable:f}=t,{scene:p}=h,m=f.getData("RTC_CENTER",1,"FLOAT","VEC3");m&&(p.position.x+=m[0],p.position.y+=m[1],p.position.z+=m[2]),h.scene.updateMatrix(),h.scene.matrix.multiply(u),h.scene.matrix.decompose(h.scene.position,h.scene.quaternion,h.scene.scale),h.batchTable=d,h.featureTable=f,p.batchTable=d,p.featureTable=f,i(h)},s)})}}class DT extends Oo{parse(e){const t=new DataView(e),r=$r(t);console.assert(r==="pnts");const i=t.getUint32(4,!0);console.assert(i===1);const s=t.getUint32(8,!0);console.assert(s===e.byteLength);const o=t.getUint32(12,!0),a=t.getUint32(16,!0),l=t.getUint32(20,!0),c=t.getUint32(24,!0),u=28,h=e.slice(u,u+o+a),d=new Ro(h,0,o,a),f=u+o+a,p=e.slice(f,f+l+c),m=new Oc(p,d.getData("BATCH_LENGTH")||d.getData("POINTS_LENGTH"),0,l,c);return Promise.resolve({version:i,featureTable:d,batchTable:m})}}function NT(n){const e=n>>11,t=n>>5&63,r=n&31,i=Math.round(e/31*255),s=Math.round(t/63*255),o=Math.round(r/31*255);return[i,s,o]}const li=new Z;function FT(n,e,t=new P){li.set(n,e).divideScalar(256).multiplyScalar(2).subScalar(1),t.set(li.x,li.y,1-Math.abs(li.x)-Math.abs(li.y));const r=j.clamp(-t.z,0,1);return t.x>=0?t.setX(t.x-r):t.setX(t.x+r),t.y>=0?t.setY(t.y-r):t.setY(t.y+r),t.normalize(),t}const Fh={RGB:"color",POSITION:"position"};class am extends DT{constructor(e=So){super(),this.manager=e}parse(e){return super.parse(e).then(async t=>{const{featureTable:r,batchTable:i}=t,s=new ni,o=r.header.extensions,a=new P;let l;if(o&&o["3DTILES_draco_point_compression"]){const{byteOffset:h,byteLength:d,properties:f}=o["3DTILES_draco_point_compression"],p=this.manager.getHandler("draco.drc");if(p==null)throw new Error("PNTSLoader: dracoLoader not available.");const m={};for(const v in f)if(v in Fh&&v in f){const y=Fh[v];m[y]=f[v]}const g={attributeIDs:m,attributeTypes:{position:"Float32Array",color:"Uint8Array"},useUniqueIDs:!0},_=r.getBuffer(h,d);l=await p.decodeGeometry(_,g),l.attributes.color&&(s.vertexColors=!0)}else{const h=r.getData("POINTS_LENGTH"),d=r.getData("POSITION",h,"FLOAT","VEC3"),f=r.getData("NORMAL",h,"FLOAT","VEC3"),p=r.getData("NORMAL",h,"UNSIGNED_BYTE","VEC2"),m=r.getData("RGB",h,"UNSIGNED_BYTE","VEC3"),g=r.getData("RGBA",h,"UNSIGNED_BYTE","VEC4"),_=r.getData("RGB565",h,"UNSIGNED_SHORT","SCALAR"),v=r.getData("CONSTANT_RGBA",h,"UNSIGNED_BYTE","VEC4"),y=r.getData("POSITION_QUANTIZED",h,"UNSIGNED_SHORT","VEC3"),T=r.getData("QUANTIZED_VOLUME_SCALE",h,"FLOAT","VEC3"),A=r.getData("QUANTIZED_VOLUME_OFFSET",h,"FLOAT","VEC3");if(l=new xt,y){const w=new Float32Array(h*3);for(let x=0;x<h;x++)for(let b=0;b<3;b++){const E=3*x+b;w[E]=y[E]/65535*T[b]}a.x=A[0],a.y=A[1],a.z=A[2],l.setAttribute("position",new Ce(w,3,!1))}else l.setAttribute("position",new Ce(d,3,!1));if(f!==null)l.setAttribute("normal",new Ce(f,3,!1));else if(p!==null){const w=new Float32Array(h*3),x=new P;for(let b=0;b<h;b++){const E=p[b*2],M=p[b*2+1],S=FT(E,M,x);w[b*3]=S.x,w[b*3+1]=S.y,w[b*3+2]=S.z}l.setAttribute("normal",new Ce(w,3,!1))}if(g!==null)l.setAttribute("color",new Ce(g,4,!0)),s.vertexColors=!0,s.transparent=!0,s.depthWrite=!1;else if(m!==null)l.setAttribute("color",new Ce(m,3,!0)),s.vertexColors=!0;else if(_!==null){const w=new Uint8Array(h*3);for(let x=0;x<h;x++){const b=NT(_[x]);for(let E=0;E<3;E++){const M=3*x+E;w[M]=b[E]}}l.setAttribute("color",new Ce(w,3,!0)),s.vertexColors=!0}else if(v!==null){const w=new ke(v[0],v[1],v[2]);s.color=w;const x=v[3]/255;x<1&&(s.opacity=x,s.transparent=!0,s.depthWrite=!1)}}const c=new Ji(l,s);c.position.copy(a),t.scene=c,t.scene.featureTable=r,t.scene.batchTable=i;const u=r.getData("RTC_CENTER",1,"FLOAT","VEC3");return u&&(t.scene.position.x+=u[0],t.scene.position.y+=u[1],t.scene.position.z+=u[2]),t})}}class UT extends Oo{parse(e){const t=new DataView(e),r=$r(t);console.assert(r==="i3dm");const i=t.getUint32(4,!0);console.assert(i===1);const s=t.getUint32(8,!0);console.assert(s===e.byteLength);const o=t.getUint32(12,!0),a=t.getUint32(16,!0),l=t.getUint32(20,!0),c=t.getUint32(24,!0),u=t.getUint32(28,!0),h=32,d=e.slice(h,h+o+a),f=new Ro(d,0,o,a),p=h+o+a,m=e.slice(p,p+l+c),g=new Oc(m,f.getData("INSTANCES_LENGTH"),0,l,c),_=p+l+c,v=new Uint8Array(e,_,s-_);let y=null,T=null,A=null;if(u)y=v,T=Promise.resolve();else{const w=this.resolveExternalURL(nm(v)),x=w.split(/[\\/]/g);x.pop(),A=x.join("/"),T=fetch(w,this.fetchOptions).then(b=>{if(!b.ok)throw new Error(`I3DMLoaderBase : Failed to load file "${w}" with status ${b.status} : ${b.statusText}`);return b.arrayBuffer()}).then(b=>{y=new Uint8Array(b)})}return T.then(()=>({version:i,featureTable:f,batchTable:g,glbBytes:y,gltfWorkingPath:A}))}}new to;new P;function jT(n){const{x:e,y:t,z:r}=n;n.x=r,n.y=e,n.z=t}function BT(n){return-n+Math.PI/2}const Uh=new to,hn=new P,dt=new P,ra=new P,dn=new H,kt=new H,jh=new H,ia=new sr,We=new yc,Bh=new P,zh=new P,Vh=new P,Dn=new P,$h=new Rt,zT=1e-12,VT=.1,gs=0,Hh=1,_s=2;class Lc{constructor(e=1,t=1,r=1){this.name="",this.radius=new P(e,t,r)}intersectRay(e,t){return dn.makeScale(...this.radius).invert(),ia.center.set(0,0,0),ia.radius=1,$h.copy(e).applyMatrix4(dn),$h.intersectSphere(ia,t)?(dn.makeScale(...this.radius),t.applyMatrix4(dn),t):null}getEastNorthUpFrame(e,t,r,i){return r.isMatrix4&&(i=r,r=0,console.warn('Ellipsoid: The signature for "getEastNorthUpFrame" has changed.')),this.getEastNorthUpAxes(e,t,Bh,zh,Vh),this.getCartographicToPosition(e,t,r,Dn),i.makeBasis(Bh,zh,Vh).setPosition(Dn)}getOrientedEastNorthUpFrame(e,t,r,i,s,o,a){return this.getObjectFrame(e,t,r,i,s,o,a,gs)}getObjectFrame(e,t,r,i,s,o,a,l=_s){return this.getEastNorthUpFrame(e,t,r,dn),We.set(s,o,-i,"ZXY"),a.makeRotationFromEuler(We).premultiply(dn),l===Hh?(We.set(Math.PI/2,0,0,"XYZ"),kt.makeRotationFromEuler(We),a.multiply(kt)):l===_s&&(We.set(-Math.PI/2,0,Math.PI,"XYZ"),kt.makeRotationFromEuler(We),a.multiply(kt)),a}getCartographicFromObjectFrame(e,t,r=_s){return r===Hh?(We.set(-Math.PI/2,0,0,"XYZ"),kt.makeRotationFromEuler(We).premultiply(e)):r===_s?(We.set(-Math.PI/2,0,Math.PI,"XYZ"),kt.makeRotationFromEuler(We).premultiply(e)):kt.copy(e),Dn.setFromMatrixPosition(kt),this.getPositionToCartographic(Dn,t),this.getEastNorthUpFrame(t.lat,t.lon,0,dn).invert(),kt.premultiply(dn),We.setFromRotationMatrix(kt,"ZXY"),t.azimuth=-We.z,t.elevation=We.x,t.roll=We.y,t}getEastNorthUpAxes(e,t,r,i,s,o=Dn){this.getCartographicToPosition(e,t,0,o),this.getCartographicToNormal(e,t,s),r.set(-o.y,o.x,0).normalize(),i.crossVectors(s,r).normalize()}getAzElRollFromRotationMatrix(e,t,r,i,s=gs){return console.warn('Ellipsoid: "getAzElRollFromRotationMatrix" is deprecated. Use "getCartographicFromObjectFrame", instead.'),this.getCartographicToPosition(e,t,0,Dn),jh.copy(r).setPosition(Dn),this.getCartographicFromObjectFrame(jh,i,s),delete i.height,delete i.lat,delete i.lon,i}getRotationMatrixFromAzElRoll(e,t,r,i,s,o,a=gs){return console.warn('Ellipsoid: "getRotationMatrixFromAzElRoll" function has been deprecated. Use "getObjectFrame", instead.'),this.getObjectFrame(e,t,0,r,i,s,o,a),o.setPosition(0,0,0),o}getFrame(e,t,r,i,s,o,a,l=gs){return console.warn('Ellipsoid: "getFrame" function has been deprecated. Use "getObjectFrame", instead.'),this.getObjectFrame(e,t,o,r,i,s,a,l)}getCartographicToPosition(e,t,r,i){this.getCartographicToNormal(e,t,hn);const s=this.radius;dt.copy(hn),dt.x*=s.x**2,dt.y*=s.y**2,dt.z*=s.z**2;const o=Math.sqrt(hn.dot(dt));return dt.divideScalar(o),i.copy(dt).addScaledVector(hn,r)}getPositionToCartographic(e,t){this.getPositionToSurfacePoint(e,dt),this.getPositionToNormal(e,hn);const r=ra.subVectors(e,dt);return t.lon=Math.atan2(hn.y,hn.x),t.lat=Math.asin(hn.z),t.height=Math.sign(r.dot(e))*r.length(),t}getCartographicToNormal(e,t,r){return Uh.set(1,BT(e),t),r.setFromSpherical(Uh).normalize(),jT(r),r}getPositionToNormal(e,t){const r=this.radius;return t.copy(e),t.x/=r.x**2,t.y/=r.y**2,t.z/=r.z**2,t.normalize(),t}getPositionToSurfacePoint(e,t){const r=this.radius,i=1/r.x**2,s=1/r.y**2,o=1/r.z**2,a=e.x*e.x*i,l=e.y*e.y*s,c=e.z*e.z*o,u=a+l+c,h=Math.sqrt(1/u),d=dt.copy(e).multiplyScalar(h);if(u<VT)return isFinite(h)?t.copy(d):null;const f=ra.set(d.x*i*2,d.y*s*2,d.z*o*2);let p=(1-h)*e.length()/(.5*f.length()),m=0,g,_,v,y,T,A,w,x,b,E,M;do{p-=m,v=1/(1+p*i),y=1/(1+p*s),T=1/(1+p*o),A=v*v,w=y*y,x=T*T,b=A*v,E=w*y,M=x*T,g=a*A+l*w+c*x-1,_=a*b*i+l*E*s+c*M*o;const S=-2*_;m=g/S}while(Math.abs(g)>zT);return t.set(e.x*v,e.y*y,e.z*T)}calculateHorizonDistance(e,t){const r=this.calculateEffectiveRadius(e);return Math.sqrt(2*r*t+t**2)}calculateEffectiveRadius(e){const t=this.radius.x,r=1-this.radius.z**2/t**2,i=e*j.DEG2RAD,s=Math.sin(i)**2;return t/Math.sqrt(1-r*s)}getPositionElevation(e){this.getPositionToSurfacePoint(e,dt);const t=ra.subVectors(e,dt);return Math.sign(t.dot(e))*t.length()}copy(e){return this.radius.copy(e.radius),this}clone(){return new this.constructor().copy(this)}}const Hr=new Lc(Rh,Rh,Gw);Hr.name="WGS84 Earth";const Gh=new P,sa=new P,oa=new P,aa=new P,la=new Fe,vs=new P,ys=new H,Wh=new H,Kh=new P,qh=new H,ca=new Fe,ua={};class lm extends UT{constructor(e=So){super(),this.manager=e,this.adjustmentTransform=new H,this.ellipsoid=Hr.clone()}resolveExternalURL(e){return this.manager.resolveURL(super.resolveExternalURL(e))}parse(e){return super.parse(e).then(t=>{const{featureTable:r,batchTable:i}=t,s=t.glbBytes.slice().buffer;return new Promise((o,a)=>{const l=this.fetchOptions,c=this.manager,u=c.getHandler("path.gltf")||new kc(c);l.credentials==="include"&&l.mode==="cors"&&u.setCrossOrigin("use-credentials"),"credentials"in l&&u.setWithCredentials(l.credentials==="include"),l.headers&&u.setRequestHeader(l.headers);let h=t.gltfWorkingPath??this.workingPath;/[\\/]$/.test(h)||(h+="/");const d=this.adjustmentTransform;u.parse(s,h,f=>{const p=r.getData("INSTANCES_LENGTH"),m=r.getData("POSITION",p,"FLOAT","VEC3"),g=r.getData("NORMAL_UP",p,"FLOAT","VEC3"),_=r.getData("NORMAL_RIGHT",p,"FLOAT","VEC3"),v=r.getData("SCALE_NON_UNIFORM",p,"FLOAT","VEC3"),y=r.getData("SCALE",p,"FLOAT","SCALAR"),T=r.getData("RTC_CENTER",1,"FLOAT","VEC3"),A=r.getData("EAST_NORTH_UP");["QUANTIZED_VOLUME_OFFSET","QUANTIZED_VOLUME_SCALE","POSITION_QUANTIZED","NORMAL_UP_OCT32P","NORMAL_RIGHT_OCT32P"].forEach(E=>{E in r.header&&console.warn(`I3DMLoader: Unsupported FeatureTable feature "${E}" detected.`)});const w=new P;for(let E=0;E<p;E++)w.x+=m[E*3+0]/p,w.y+=m[E*3+1]/p,w.z+=m[E*3+2]/p;const x=[],b=[];f.scene.updateMatrixWorld(),f.scene.traverse(E=>{if(E.isMesh){b.push(E);const{geometry:M,material:S}=E,O=new bc(M,S,p);O.position.copy(w),T&&(O.position.x+=T[0],O.position.y+=T[1],O.position.z+=T[2]),x.push(O)}});for(let E=0;E<p;E++){aa.set(m[E*3+0]-w.x,m[E*3+1]-w.y,m[E*3+2]-w.z),la.identity(),g&&(sa.set(g[E*3+0],g[E*3+1],g[E*3+2]),oa.set(_[E*3+0],_[E*3+1],_[E*3+2]),Gh.crossVectors(oa,sa).normalize(),ys.makeBasis(oa,sa,Gh),la.setFromRotationMatrix(ys)),vs.set(1,1,1),v&&vs.set(v[E*3+0],v[E*3+1],v[E*3+2]),y&&vs.multiplyScalar(y[E]);for(let M=0,S=x.length;M<S;M++){const O=x[M];ca.copy(la),A&&(O.updateMatrixWorld(),Kh.copy(aa).applyMatrix4(O.matrixWorld),this.ellipsoid.getPositionToCartographic(Kh,ua),this.ellipsoid.getEastNorthUpFrame(ua.lat,ua.lon,qh),ca.setFromRotationMatrix(qh)),ys.compose(aa,ca,vs).multiply(d);const L=b[M];Wh.multiplyMatrices(ys,L.matrixWorld),O.setMatrixAt(E,Wh)}}f.scene.clear(),f.scene.add(...x),f.batchTable=i,f.featureTable=r,f.scene.batchTable=i,f.scene.featureTable=r,o(f)},a)})})}}class $T extends Oo{parse(e){const t=new DataView(e),r=$r(t);console.assert(r==="cmpt",'CMPTLoader: The magic bytes equal "cmpt".');const i=t.getUint32(4,!0);console.assert(i===1,'CMPTLoader: The version listed in the header is "1".');const s=t.getUint32(8,!0);console.assert(s===e.byteLength,"CMPTLoader: The contents buffer length listed in the header matches the file.");const o=t.getUint32(12,!0),a=[];let l=16;for(let c=0;c<o;c++){const u=new DataView(e,l,12),h=$r(u),d=u.getUint32(4,!0),f=u.getUint32(8,!0),p=new Uint8Array(e,l,f);a.push({type:h,buffer:p,version:d}),l+=f}return{version:i,tiles:a}}}class HT extends $T{constructor(e=So){super(),this.manager=e,this.adjustmentTransform=new H,this.ellipsoid=Hr.clone()}parse(e){const t=super.parse(e),{manager:r,ellipsoid:i,adjustmentTransform:s}=this,o=[];for(const a in t.tiles){const{type:l,buffer:c}=t.tiles[a];switch(l){case"b3dm":{const u=c.slice(),h=new om(r);h.workingPath=this.workingPath,h.fetchOptions=this.fetchOptions,h.adjustmentTransform.copy(s);const d=h.parse(u.buffer);o.push(d);break}case"pnts":{const u=c.slice(),h=new am(r);h.workingPath=this.workingPath,h.fetchOptions=this.fetchOptions;const d=h.parse(u.buffer);o.push(d);break}case"i3dm":{const u=c.slice(),h=new lm(r);h.workingPath=this.workingPath,h.fetchOptions=this.fetchOptions,h.ellipsoid.copy(i),h.adjustmentTransform.copy(s);const d=h.parse(u.buffer);o.push(d);break}}}return Promise.all(o).then(a=>{const l=new Ae;return a.forEach(c=>{l.add(c.scene)}),{tiles:a,scene:l}})}}const ci=new H;class GT extends Ae{constructor(e){super(),this.isTilesGroup=!0,this.name="TilesRenderer.TilesGroup",this.tilesRenderer=e,this.matrixWorldInverse=new H}raycast(e,t){return this.tilesRenderer.optimizeRaycast?(this.tilesRenderer.raycast(e,t),!1):!0}updateMatrixWorld(e){if(this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldNeedsUpdate||e){this.parent===null?ci.copy(this.matrix):ci.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1;const t=ci.elements,r=this.matrixWorld.elements;let i=!1;for(let s=0;s<16;s++){const o=t[s],a=r[s];if(Math.abs(o-a)>Number.EPSILON){i=!0;break}}if(i){this.matrixWorld.copy(ci),this.matrixWorldInverse.copy(ci).invert();const s=this.children;for(let o=0,a=s.length;o<a;o++)s[o].updateMatrixWorld()}}}updateWorldMatrix(e,t){this.parent&&e&&this.parent.updateWorldMatrix(e,!1),this.updateMatrixWorld(!0)}}const cm=new Rt,ha=new P,bs=[];function um(n,e){return n.distance-e.distance}function hm(n,e,t,r){const{scene:i}=n.cached;t.invokeOnePlugin(s=>s.raycastTile&&s.raycastTile(n,i,e,r))||e.intersectObject(i,!0,r)}function WT(n,e,t){hm(n,e,t,bs),bs.sort(um);const r=bs[0]||null;return bs.length=0,r}function dm(n){return"__used"in n}function pm(n,e,t,r=null){const{group:i,activeTiles:s}=n;r===null&&(r=cm,r.copy(t.ray).applyMatrix4(i.matrixWorldInverse));const o=[],a=e.children;for(let u=0,h=a.length;u<h;u++){const d=a[u];!dm(d)||!d.__used||d.cached.boundingVolume.intersectRay(r,ha)!==null&&(ha.applyMatrix4(i.matrixWorld),o.push({distance:ha.distanceToSquared(t.ray.origin),tile:d}))}o.sort(um);let l=null,c=1/0;if(s.has(e)){const u=WT(e,t,n);u&&(l=u,c=u.distance*u.distance)}for(let u=0,h=o.length;u<h;u++){const d=o[u],f=d.distance,p=d.tile;if(f>c)break;const m=pm(n,p,t,r);if(m){const g=m.distance*m.distance;g<c&&(l=m,c=g)}}return l}function fm(n,e,t,r,i=null){if(!dm(e))return;const{group:s,activeTiles:o}=n,{boundingVolume:a}=e.cached;if(i===null&&(i=cm,i.copy(t.ray).applyMatrix4(s.matrixWorldInverse)),!e.__used||!a.intersectsRay(i))return;o.has(e)&&hm(e,t,n,r);const l=e.children;for(let c=0,u=l.length;c<u;c++)fm(n,l[c],t,r,i)}const ws=new P,Ts=new P,Ke=new P,xs=new Rt;class Xh{constructor(e=new Tc,t=new H){this.box=e.clone(),this.transform=t.clone(),this.inverseTransform=new H,this.points=new Array(8).fill().map(()=>new P),this.planes=new Array(6).fill().map(()=>new ts)}copy(e){return this.box.copy(e.box),this.transform.copy(e.transform),this.update(),this}clone(){return new this.constructor().copy(this)}clampPoint(e,t){return t.copy(e).applyMatrix4(this.inverseTransform).clamp(this.box.min,this.box.max).applyMatrix4(this.transform)}distanceToPoint(e){return this.clampPoint(e,Ke).distanceTo(e)}containsPoint(e){return Ke.copy(e).applyMatrix4(this.inverseTransform),this.box.containsPoint(Ke)}intersectsRay(e){return xs.copy(e).applyMatrix4(this.inverseTransform),xs.intersectsBox(this.box)}intersectRay(e,t){return xs.copy(e).applyMatrix4(this.inverseTransform),xs.intersectBox(this.box,t)?(t.applyMatrix4(this.transform),t):null}update(){const{points:e,inverseTransform:t,transform:r,box:i}=this;t.copy(r).invert();const{min:s,max:o}=i;let a=0;for(let l=-1;l<=1;l+=2)for(let c=-1;c<=1;c+=2)for(let u=-1;u<=1;u+=2)e[a].set(l<0?s.x:o.x,c<0?s.y:o.y,u<0?s.z:o.z).applyMatrix4(r),a++;this.updatePlanes()}updatePlanes(){ws.copy(this.box.min).applyMatrix4(this.transform),Ts.copy(this.box.max).applyMatrix4(this.transform),Ke.set(0,0,1).transformDirection(this.transform),this.planes[0].setFromNormalAndCoplanarPoint(Ke,ws),this.planes[1].setFromNormalAndCoplanarPoint(Ke,Ts).negate(),Ke.set(0,1,0).transformDirection(this.transform),this.planes[2].setFromNormalAndCoplanarPoint(Ke,ws),this.planes[3].setFromNormalAndCoplanarPoint(Ke,Ts).negate(),Ke.set(1,0,0).transformDirection(this.transform),this.planes[4].setFromNormalAndCoplanarPoint(Ke,ws),this.planes[5].setFromNormalAndCoplanarPoint(Ke,Ts).negate()}intersectsSphere(e){return this.clampPoint(e.center,Ke),Ke.distanceToSquared(e.center)<=e.radius*e.radius}intersectsFrustum(e){return this._intersectsPlaneShape(e.planes,e.points)}intersectsOBB(e){return this._intersectsPlaneShape(e.planes,e.points)}_intersectsPlaneShape(e,t){const r=this.points,i=this.planes;for(let s=0;s<6;s++){const o=e[s];let a=-1/0;for(let l=0;l<8;l++){const c=r[l],u=o.distanceToPoint(c);a=a<u?u:a}if(a<0)return!1}for(let s=0;s<6;s++){const o=i[s];let a=-1/0;for(let l=0;l<8;l++){const c=t[l],u=o.distanceToPoint(c);a=a<u?u:a}if(a<0)return!1}return!0}}const mn=Math.PI,Es=mn/2,ui=new P,cr=new P,ur=new P,Yh=new H;let bi=0;const da=[];function KT(n=!1){return n?(da[bi]||(da[bi]=new P),bi++,da[bi-1]):new P}function Zh(){bi=0}class mm extends Lc{constructor(e,t,r,i=-Es,s=Es,o=0,a=2*mn,l=0,c=0){super(e,t,r),this.latStart=i,this.latEnd=s,this.lonStart=o,this.lonEnd=a,this.heightStart=l,this.heightEnd=c}_getPoints(e=!1){const{latStart:t,latEnd:r,lonStart:i,lonEnd:s,heightStart:o,heightEnd:a}=this,l=j.mapLinear(.5,0,1,t,r),c=j.mapLinear(.5,0,1,i,s),u=Math.floor(i/Es)*Es,h=[[-mn/2,0],[mn/2,0],[0,u],[0,u+mn/2],[0,u+mn],[0,u+3*mn/2],[t,s],[r,s],[t,i],[r,i],[0,i],[0,s],[l,c],[t,c],[r,c],[l,i],[l,s]],d=[],f=h.length;for(let p=0;p<=1;p++){const m=j.mapLinear(p,0,1,o,a);for(let g=0,_=f;g<_;g++){const[v,y]=h[g];if(v>=t&&v<=r&&y>=i&&y<=s){const T=KT(e);d.push(T),this.getCartographicToPosition(v,y,m,T)}}}return d}getBoundingBox(e,t){Zh();const{latStart:r,latEnd:i,lonStart:s,lonEnd:o}=this;if(i-r<mn/2){const l=j.mapLinear(.5,0,1,r,i),c=j.mapLinear(.5,0,1,s,o);this.getCartographicToNormal(l,c,ur),cr.set(0,0,1),ui.crossVectors(cr,ur),cr.crossVectors(ui,ur),t.makeBasis(ui,cr,ur)}else ui.set(1,0,0),cr.set(0,1,0),ur.set(0,0,1),t.makeBasis(ui,cr,ur);Yh.copy(t).invert();const a=this._getPoints(!0);for(let l=0,c=a.length;l<c;l++)a[l].applyMatrix4(Yh);e.makeEmpty(),e.setFromPoints(a)}getBoundingSphere(e,t){Zh();const r=this._getPoints(!0);e.makeEmpty(),e.setFromPoints(r,t)}}const Ht=new P,Gt=new P,Wt=new P,Qh=new P,Jh=new P;class qT{constructor(){this.sphere=null,this.obb=null,this.region=null,this.regionObb=null}intersectsRay(e){const t=this.sphere,r=this.obb||this.regionObb;return!(t&&!e.intersectsSphere(t)||r&&!r.intersectsRay(e))}intersectRay(e,t=null){const r=this.sphere,i=this.obb||this.regionObb;let s=-1/0,o=-1/0;r&&e.intersectSphere(r,Qh)&&(s=r.containsPoint(e.origin)?0:e.origin.distanceToSquared(Qh)),i&&i.intersectRay(e,Jh)&&(o=i.containsPoint(e.origin)?0:e.origin.distanceToSquared(Jh));const a=Math.max(s,o);return a===-1/0?null:(e.at(Math.sqrt(a),t),t)}distanceToPoint(e){const t=this.sphere,r=this.obb||this.regionObb;let i=-1/0,s=-1/0;return t&&(i=Math.max(t.distanceToPoint(e),0)),r&&(s=r.distanceToPoint(e)),i>s?i:s}intersectsFrustum(e){const t=this.obb||this.regionObb,r=this.sphere;return r&&!e.intersectsSphere(r)||t&&!t.intersectsFrustum(e)?!1:!!(r||t)}intersectsSphere(e){const t=this.obb||this.regionObb,r=this.sphere;return r&&!r.intersectsSphere(e)||t&&!t.intersectsSphere(e)?!1:!!(r||t)}intersectsOBB(e){const t=this.obb||this.regionObb,r=this.sphere;return r&&!e.intersectsSphere(r)||t&&!t.intersectsOBB(e)?!1:!!(r||t)}getOBB(e,t){const r=this.obb||this.regionObb;r?(e.copy(r.box),t.copy(r.transform)):(this.getAABB(e),t.identity())}getAABB(e){if(this.sphere)this.sphere.getBoundingBox(e);else{const t=this.obb||this.regionObb;e.copy(t.box).applyMatrix4(t.transform)}}getSphere(e){if(this.sphere)e.copy(this.sphere);else if(this.region)this.region.getBoundingSphere(e);else{const t=this.obb||this.regionObb;t.box.getBoundingSphere(e),e.applyMatrix4(t.transform)}}setObbData(e,t){const r=new Xh;Ht.set(e[3],e[4],e[5]),Gt.set(e[6],e[7],e[8]),Wt.set(e[9],e[10],e[11]);const i=Ht.length(),s=Gt.length(),o=Wt.length();Ht.normalize(),Gt.normalize(),Wt.normalize(),i===0&&Ht.crossVectors(Gt,Wt),s===0&&Gt.crossVectors(Ht,Wt),o===0&&Wt.crossVectors(Ht,Gt),r.transform.set(Ht.x,Gt.x,Wt.x,e[0],Ht.y,Gt.y,Wt.y,e[1],Ht.z,Gt.z,Wt.z,e[2],0,0,0,1).premultiply(t),r.box.min.set(-i,-s,-o),r.box.max.set(i,s,o),r.update(),this.obb=r}setSphereData(e,t,r,i,s){const o=new sr;o.center.set(e,t,r),o.radius=i,o.applyMatrix4(s),this.sphere=o}setRegionData(e,t,r,i,s,o,a){const l=new mm(...e.radius,r,s,t,i,o,a),c=new Xh;l.getBoundingBox(c.box,c.transform),c.update(),this.region=l,this.regionObb=c}}const XT=new Db;function YT(n,e,t,r){const i=XT.set(n.normal.x,n.normal.y,n.normal.z,e.normal.x,e.normal.y,e.normal.z,t.normal.x,t.normal.y,t.normal.z);return r.set(-n.constant,-e.constant,-t.constant),r.applyMatrix3(i.invert()),r}class ZT extends Ib{constructor(){super(),this.points=Array(8).fill().map(()=>new P)}setFromProjectionMatrix(e,t){return super.setFromProjectionMatrix(e,t),this.calculateFrustumPoints(),this}calculateFrustumPoints(){const{planes:e,points:t}=this;[[e[0],e[3],e[4]],[e[1],e[3],e[4]],[e[0],e[2],e[4]],[e[1],e[2],e[4]],[e[0],e[3],e[5]],[e[1],e[3],e[5]],[e[0],e[2],e[5]],[e[1],e[2],e[5]]].forEach((r,i)=>{YT(r[0],r[1],r[2],t[i])})}}function QT(n){const{TextureUtils:e}=V;if(!e)return 0;const t=new Set;let r=0;return n.traverse(i=>{if(i.geometry&&!t.has(i.geometry)&&(r+=eT(i.geometry),t.add(i.geometry)),i.material){const s=i.material;for(const o in s){const a=s[o];if(a&&a.isTexture&&!t.has(a)){const{format:l,type:c,image:u}=a,{width:h,height:d}=u,f=e.getByteLength(h,d,l,c);r+=a.generateMipmaps?f*4/3:f,t.add(a)}}}}),r}const ed=new H,td=new yc,gm=Symbol("INITIAL_FRUSTUM_CULLED"),As=new H,hi=new P,pa=new Z,Ps={inView:!1,error:1/0},JT=new P(1,0,0),ex=new P(0,1,0);function nd(n,e){n.traverse(t=>{t.frustumCulled=t[gm]&&e})}class Ml extends Yw{get autoDisableRendererCulling(){return this._autoDisableRendererCulling}set autoDisableRendererCulling(e){this._autoDisableRendererCulling!==e&&(super._autoDisableRendererCulling=e,this.forEachLoadedModel(t=>{nd(t,!e)}))}get optimizeRaycast(){return this._optimizeRaycast}set optimizeRaycast(e){console.warn('TilesRenderer: The "optimizeRaycast" option has been deprecated.'),this._optimizeRaycast=e}constructor(...e){super(...e),this.group=new GT(this),this.ellipsoid=Hr.clone(),this.cameras=[],this.cameraMap=new Map,this.cameraInfo=[],this._optimizeRaycast=!0,this._upRotationMatrix=new H,this.lruCache.computeMemoryUsageCallback=r=>r.cached.bytesUsed??null,this._autoDisableRendererCulling=!0;const t=new Nb;t.setURLModifier(r=>this.preprocessURL?this.preprocessURL(r):r),this.manager=t,this._listeners={}}addEventListener(...e){yi.prototype.addEventListener.call(this,...e)}hasEventListener(...e){yi.prototype.hasEventListener.call(this,...e)}removeEventListener(...e){yi.prototype.removeEventListener.call(this,...e)}dispatchEvent(...e){yi.prototype.dispatchEvent.call(this,...e)}getBoundingBox(e){if(!this.root)return!1;const t=this.root.cached.boundingVolume;return t?(t.getAABB(e),!0):!1}getOrientedBoundingBox(e,t){if(!this.root)return!1;const r=this.root.cached.boundingVolume;return r?(r.getOBB(e,t),!0):!1}getBoundingSphere(e){if(!this.root)return!1;const t=this.root.cached.boundingVolume;return t?(t.getSphere(e),!0):!1}forEachLoadedModel(e){this.traverse(t=>{const r=t.cached&&t.cached.scene;r&&e(r,t)},null,!1)}raycast(e,t){if(this.root)if(e.firstHitOnly){const r=pm(this,this.root,e);r&&t.push(r)}else fm(this,this.root,e,t)}hasCamera(e){return this.cameraMap.has(e)}setCamera(e){const t=this.cameras,r=this.cameraMap;return r.has(e)?!1:(r.set(e,new Z),t.push(e),this.dispatchEvent({type:"add-camera",camera:e}),!0)}setResolution(e,t,r){const i=this.cameraMap;if(!i.has(e))return!1;const s=t.isVector2?t.x:t,o=t.isVector2?t.y:r,a=i.get(e);return(a.width!==s||a.height!==o)&&(a.set(s,o),this.dispatchEvent({type:"camera-resolution-change"})),!0}setResolutionFromRenderer(e,t){return t.getSize(pa),this.setResolution(e,pa.x,pa.y)}deleteCamera(e){const t=this.cameras,r=this.cameraMap;if(r.has(e)){const i=t.indexOf(e);return t.splice(i,1),r.delete(e),this.dispatchEvent({type:"delete-camera",camera:e}),!0}return!1}loadRootTileSet(...e){return super.loadRootTileSet(...e).then(t=>{const{asset:r,extensions:i={}}=t;switch((r&&r.gltfUpAxis||"y").toLowerCase()){case"x":this._upRotationMatrix.makeRotationAxis(ex,-Math.PI/2);break;case"y":this._upRotationMatrix.makeRotationAxis(JT,Math.PI/2);break}if("3DTILES_ellipsoid"in i){const s=i["3DTILES_ellipsoid"],{ellipsoid:o}=this;o.name=s.body,s.radii?o.radius.set(...s.radii):o.radius.set(1,1,1)}return t})}update(){let e=null;if(this.invokeAllPlugins(o=>{if(o.doTilesNeedUpdate){const a=o.doTilesNeedUpdate();e===null?e=a:e=!!(e||a)}}),e===!1){this.dispatchEvent({type:"update-before"}),this.dispatchEvent({type:"update-after"});return}this.dispatchEvent({type:"update-before"});const t=this.group,r=this.cameras,i=this.cameraMap,s=this.cameraInfo;for(;s.length>r.length;)s.pop();for(;s.length<r.length;)s.push({frustum:new ZT,isOrthographic:!1,sseDenominator:-1,position:new P,invScale:-1,pixelSize:0});hi.setFromMatrixScale(t.matrixWorldInverse),Math.abs(Math.max(hi.x-hi.y,hi.x-hi.z))>1e-6&&console.warn("ThreeTilesRenderer : Non uniform scale used for tile which may cause issues when calculating screen space error.");for(let o=0,a=s.length;o<a;o++){const l=r[o],c=s[o],u=c.frustum,h=c.position,d=i.get(l);(d.width===0||d.height===0)&&console.warn("TilesRenderer: resolution for camera error calculation is not set.");const f=l.projectionMatrix.elements;if(c.isOrthographic=f[15]===1,c.isOrthographic){const p=2/f[0],m=2/f[5];c.pixelSize=Math.max(m/d.height,p/d.width)}else c.sseDenominator=2/f[5]/d.height;As.copy(t.matrixWorld),As.premultiply(l.matrixWorldInverse),As.premultiply(l.projectionMatrix),u.setFromProjectionMatrix(As),h.set(0,0,0),h.applyMatrix4(l.matrixWorld),h.applyMatrix4(t.matrixWorldInverse)}if(super.update(),this.dispatchEvent({type:"update-after"}),r.length===0&&this.root){let o=!1;this.invokeAllPlugins(a=>o=o||!!(a!==this&&a.calculateTileViewError)),o===!1&&console.warn("TilesRenderer: no cameras defined. Cannot update 3d tiles.")}}preprocessNode(e,t,r=null){super.preprocessNode(e,t,r);const i=new H;if(e.transform){const a=e.transform;for(let l=0;l<16;l++)i.elements[l]=a[l]}r&&i.premultiply(r.cached.transform);const s=new H().copy(i).invert(),o=new qT;"sphere"in e.boundingVolume&&o.setSphereData(...e.boundingVolume.sphere,i),"box"in e.boundingVolume&&o.setObbData(e.boundingVolume.box,i),"region"in e.boundingVolume&&o.setRegionData(this.ellipsoid,...e.boundingVolume.region),e.cached={transform:i,transformInverse:s,active:!1,boundingVolume:o,metadata:null,scene:null,geometry:null,materials:null,textures:null}}async parseTile(e,t,r,i,s){const o=t.cached,a=i.split(/[\\/]/g);a.pop();const l=a.join("/"),c=this.fetchOptions,u=this.manager;let h=null;const d=o.transform,f=this._upRotationMatrix,p=($r(e)||r).toLowerCase();switch(p){case"b3dm":{const A=new om(u);A.workingPath=l,A.fetchOptions=c,A.adjustmentTransform.copy(f),h=A.parse(e);break}case"pnts":{const A=new am(u);A.workingPath=l,A.fetchOptions=c,h=A.parse(e);break}case"i3dm":{const A=new lm(u);A.workingPath=l,A.fetchOptions=c,A.adjustmentTransform.copy(f),A.ellipsoid.copy(this.ellipsoid),h=A.parse(e);break}case"cmpt":{const A=new HT(u);A.workingPath=l,A.fetchOptions=c,A.adjustmentTransform.copy(f),A.ellipsoid.copy(this.ellipsoid),h=A.parse(e).then(w=>w.scene);break}case"gltf":case"glb":{const A=u.getHandler("path.gltf")||u.getHandler("path.glb")||new kc(u);A.setWithCredentials(c.credentials==="include"),A.setRequestHeader(c.headers||{}),c.credentials==="include"&&c.mode==="cors"&&A.setCrossOrigin("use-credentials");let w=A.resourcePath||A.path||l;!/[\\/]$/.test(w)&&w.length&&(w+="/"),h=A.parseAsync(e,w).then(x=>{x.scene=x.scene||new Ae;const{scene:b}=x;return b.updateMatrix(),b.matrix.multiply(f).decompose(b.position,b.quaternion,b.scale),x});break}default:{h=this.invokeOnePlugin(A=>A.parseToMesh&&A.parseToMesh(e,t,r,i,s));break}}const m=await h;if(m===null)throw new Error(`TilesRenderer: Content type "${p}" not supported.`);let g,_;m.isObject3D?(g=m,_=null):(g=m.scene,_=m),await this.invokeAllPlugins(A=>A.processTileModel&&A.processTileModel(g,t)),g.updateMatrix(),g.matrix.premultiply(d),g.matrix.decompose(g.position,g.quaternion,g.scale),g.traverse(A=>{A[gm]=A.frustumCulled}),nd(g,!this.autoDisableRendererCulling);const v=[],y=[],T=[];if(g.traverse(A=>{if(A.geometry&&y.push(A.geometry),A.material){const w=A.material;v.push(A.material);for(const x in w){const b=w[x];b&&b.isTexture&&T.push(b)}}}),s.aborted){for(let A=0,w=T.length;A<w;A++){const x=T[A];x.image instanceof ImageBitmap&&x.image.close(),x.dispose()}return}o.materials=v,o.geometry=y,o.textures=T,o.scene=g,o.metadata=_,o.bytesUsed=QT(g)}disposeTile(e){super.disposeTile(e);const t=e.cached;if(t.scene){const r=t.materials,i=t.geometry,s=t.textures,o=t.scene.parent;t.scene.traverse(a=>{a.userData.meshFeatures&&a.userData.meshFeatures.dispose(),a.userData.structuralMetadata&&a.userData.structuralMetadata.dispose()});for(let a=0,l=i.length;a<l;a++)i[a].dispose();for(let a=0,l=r.length;a<l;a++)r[a].dispose();for(let a=0,l=s.length;a<l;a++){const c=s[a];c.image instanceof ImageBitmap&&c.image.close(),c.dispose()}o&&o.remove(t.scene),this.dispatchEvent({type:"dispose-model",scene:t.scene,tile:e}),t.scene=null,t.materials=null,t.textures=null,t.geometry=null,t.metadata=null}}setTileVisible(e,t){const r=e.cached.scene,i=this.group;t?r&&(i.add(r),r.updateMatrixWorld(!0)):r&&i.remove(r),super.setTileVisible(e,t),this.dispatchEvent({type:"tile-visibility-change",scene:r,tile:e,visible:t})}calculateTileViewError(e,t){const r=e.cached,i=this.cameras,s=this.cameraInfo,o=r.boundingVolume;let a=!1,l=-1/0,c=1/0,u=-1/0,h=1/0;for(let d=0,f=i.length;d<f;d++){const p=s[d];let m,g;if(p.isOrthographic){const v=p.pixelSize;m=e.geometricError/v,g=1/0}else{const v=p.sseDenominator;g=o.distanceToPoint(p.position),m=e.geometricError/(g*v)}const _=s[d].frustum;o.intersectsFrustum(_)&&(a=!0,l=Math.max(l,m),c=Math.min(c,g)),u=Math.max(u,m),h=Math.min(h,g)}this.invokeAllPlugins(d=>{d!==this&&d.calculateTileViewError&&(d.calculateTileViewError(e,Ps),Ps.inView&&(a=!0,l=Math.max(l,Ps.error)),u=Math.max(u,Ps.error))}),a?(t.inView=!0,t.error=l,t.distanceFromCamera=c):(t.inView=!1,t.error=u,t.distanceFromCamera=h)}setLatLonToYUp(e,t){console.warn("TilesRenderer: setLatLonToYUp is deprecated. Use the ReorientationPlugin, instead.");const{ellipsoid:r,group:i}=this;td.set(Math.PI/2,Math.PI/2,0),ed.makeRotationFromEuler(td),r.getEastNorthUpFrame(e,t,0,i.matrix).multiply(ed).invert().decompose(i.position,i.quaternion,i.scale),i.updateMatrixWorld(!0)}dispose(){super.dispose(),this.group.removeFromParent()}}class tx extends Tt{constructor(){super(new xc(0,0),new nx),this.renderOrder=1/0}onBeforeRender(e){const t=this.material.uniforms;e.getSize(t.resolution.value)}updateMatrixWorld(){this.matrixWorld.makeTranslation(this.position)}dispose(){this.geometry.dispose(),this.material.dispose()}}class nx extends Fb{constructor(){super({depthWrite:!1,depthTest:!1,transparent:!0,uniforms:{resolution:{value:new Z},size:{value:15},thickness:{value:2},opacity:{value:1}},vertexShader:`

				uniform float pixelRatio;
				uniform float size;
				uniform float thickness;
				uniform vec2 resolution;
				varying vec2 vUv;

				void main() {

					vUv = uv;

					float aspect = resolution.x / resolution.y;
					vec2 offset = uv * 2.0 - vec2( 1.0 );
					offset.y *= aspect;

					vec4 screenPoint = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
					screenPoint.xy += offset * ( size + thickness ) * screenPoint.w / resolution.x;

					gl_Position = screenPoint;

				}
			`,fragmentShader:`

				uniform float size;
				uniform float thickness;
				uniform float opacity;

				varying vec2 vUv;
				void main() {

					float ht = 0.5 * thickness;
					float planeDim = size + thickness;
					float offset = ( planeDim - ht - 2.0 ) / planeDim;
					float texelThickness = ht / planeDim;

					vec2 vec = vUv * 2.0 - vec2( 1.0 );
					float dist = abs( length( vec ) - offset );
					float fw = fwidth( dist ) * 0.5;
					float a = smoothstep( texelThickness - fw, texelThickness + fw, dist );

					gl_FragColor = vec4( 1, 1, 1, opacity * ( 1.0 - a ) );

				}
			`})}}const rd=new Z,id=new Z;class rx{constructor(){this.domElement=null,this.buttons=0,this.pointerType=null,this.pointerOrder=[],this.previousPositions={},this.pointerPositions={},this.startPositions={},this.pointerSetThisFrame={},this.hoverPosition=new Z,this.hoverSet=!1}reset(){this.buttons=0,this.pointerType=null,this.pointerOrder=[],this.previousPositions={},this.pointerPositions={},this.startPositions={},this.pointerSetThisFrame={},this.hoverPosition=new Z,this.hoverSet=!1}updateFrame(){const{previousPositions:e,pointerPositions:t}=this;for(const r in t)e[r].copy(t[r])}setHoverEvent(e){(e.pointerType==="mouse"||e.type==="wheel")&&(this.getAdjustedPointer(e,this.hoverPosition),this.hoverSet=!0)}getLatestPoint(e){return this.pointerType!==null?(this.getCenterPoint(e),e):this.hoverSet?(e.copy(this.hoverPosition),e):null}getAdjustedPointer(e,t){const r=(this.domElement?this.domElement:e.target).getBoundingClientRect(),i=e.clientX-r.left,s=e.clientY-r.top;t.set(i,s)}addPointer(e){const t=e.pointerId,r=new Z;this.getAdjustedPointer(e,r),this.pointerOrder.push(t),this.pointerPositions[t]=r,this.previousPositions[t]=r.clone(),this.startPositions[t]=r.clone(),this.getPointerCount()===1&&(this.pointerType=e.pointerType,this.buttons=e.buttons)}updatePointer(e){const t=e.pointerId;return t in this.pointerPositions?(this.getAdjustedPointer(e,this.pointerPositions[t]),!0):!1}deletePointer(e){const t=e.pointerId,r=this.pointerOrder;r.splice(r.indexOf(t),1),delete this.pointerPositions[t],delete this.previousPositions[t],delete this.startPositions[t],this.getPointerCount.length===0&&(this.buttons=0,this.pointerType=null)}getPointerCount(){return this.pointerOrder.length}getCenterPoint(e,t=this.pointerPositions){const r=this.pointerOrder;if(this.getPointerCount()===1||this.getPointerType()==="mouse"){const i=r[0];return e.copy(t[i]),e}else if(this.getPointerCount()===2){const i=this.pointerOrder[0],s=this.pointerOrder[1],o=t[i],a=t[s];return e.addVectors(o,a).multiplyScalar(.5),e}return null}getPreviousCenterPoint(e){return this.getCenterPoint(e,this.previousPositions)}getStartCenterPoint(e){return this.getCenterPoint(e,this.startPositions)}getMoveDistance(){return this.getCenterPoint(rd),this.getPreviousCenterPoint(id),rd.sub(id).length()}getTouchPointerDistance(e=this.pointerPositions){if(this.getPointerCount()<=1||this.getPointerType()==="mouse")return 0;const{pointerOrder:t}=this,r=t[0],i=t[1],s=e[r],o=e[i];return s.distanceTo(o)}getPreviousTouchPointerDistance(){return this.getTouchPointerDistance(this.previousPositions)}getStartTouchPointerDistance(){return this.getTouchPointerDistance(this.startPositions)}getPointerType(){return this.pointerType}isPointerTouch(){return this.getPointerType()==="touch"}getPointerButtons(){return this.buttons}isLeftClicked(){return!!(this.buttons&1)}isRightClicked(){return!!(this.buttons&2)}}const bn=new H,sd=new Rt,Sl=new P;function Mr(n,e,t){return t.makeTranslation(-n.x,-n.y,-n.z),bn.makeRotationFromQuaternion(e),t.premultiply(bn),bn.makeTranslation(n.x,n.y,n.z),t.premultiply(bn),t}function fr(n,e,t,r){r.x=(n-t.offsetLeft)/t.clientWidth*2-1,r.y=-((e-t.offsetTop)/t.clientHeight)*2+1,r.isVector3&&(r.z=0)}function fa(n,e,t){return e.intersectRay(n,t)?t:(bn.makeScale(...e.radius).invert(),sd.copy(n).applyMatrix4(bn),Sl.set(0,0,0),sd.closestPointToPoint(Sl,t).normalize(),bn.makeScale(...e.radius),t.applyMatrix4(bn))}function ix(n,e,t){const r=n.origin.length(),i=Math.acos(e/r);t.copy(n.origin).multiplyScalar(-1).normalize();const s=Sl.crossVectors(t,n.direction).normalize();t.multiplyScalar(-1).applyAxisAngle(s,-i).normalize().multiplyScalar(e)}function _t(n,e,t){const r=n instanceof Rt?n:n.ray,{origin:i,direction:s}=r;i.set(e.x,e.y,-1).unproject(t),s.set(e.x,e.y,1).unproject(t).sub(i),n.isRay||(n.near=0,n.far=s.length(),n.camera=t),s.normalize()}const Mt=0,gn=1,Kt=2,mr=3,ma=4,ga=.05,_a=.025,pn=new H,Ms=new H,nt=new P,W=new P,Ss=new P,Cs=new P,Se=new P,pt=new P,va=new P,Rs=new P,At=new Fe,od=new ts,fe=new P,Os=new P,ya=new P,sx=new Fe,ee=new Rt,di=new Z,xe=new Z,ad=new Z,pi=new Z,ba=new Z,ld=new Z,cd={type:"change"},ud={type:"start"},hd={type:"end"};class ox extends yi{get enabled(){return this._enabled}set enabled(e){e!==this.enabled&&(this._enabled=e,this.resetState(),this.pointerTracker.reset(),this.enabled||(this.dragInertia.set(0,0,0),this.rotationInertia.set(0,0)))}constructor(e=null,t=null,r=null,i=null){super(),this.isEnvironmentControls=!0,this.domElement=null,this.camera=null,this.scene=null,this.tilesRenderer=null,this._enabled=!0,this.cameraRadius=5,this.rotationSpeed=1,this.minAltitude=0,this.maxAltitude=.45*Math.PI,this.minDistance=10,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.zoomSpeed=1,this.adjustHeight=!0,this.enableDamping=!1,this.dampingFactor=.15,this.fallbackPlane=new ts(new P(0,1,0),0),this.useFallbackPlane=!0,this.scaleZoomOrientationAtEdges=!1,this.autoAdjustCameraRotation=!0,this.state=Mt,this.pointerTracker=new rx,this.needsUpdate=!1,this.actionHeightOffset=0,this.pivotPoint=new P,this.zoomDirectionSet=!1,this.zoomPointSet=!1,this.zoomDirection=new P,this.zoomPoint=new P,this.zoomDelta=0,this.rotationInertiaPivot=new P,this.rotationInertia=new Z,this.dragInertia=new P,this.inertiaTargetDistance=1/0,this.inertiaStableFrames=0,this.pivotMesh=new tx,this.pivotMesh.raycast=()=>{},this.pivotMesh.scale.setScalar(.25),this.raycaster=new Ub,this.raycaster.firstHitOnly=!0,this.up=new P(0,1,0),this.clock=new jb,this._detachCallback=null,this._upInitialized=!1,this._lastUsedState=Mt,this._zoomPointWasSet=!1,this._tilesOnChangeCallback=()=>this.zoomPointSet=!1,r&&this.attach(r),t&&this.setCamera(t),e&&this.setScene(e),i&&this.setTilesRenderer(i)}setScene(e){this.scene=e}setCamera(e){this.camera=e,this._upInitialized=!1,this.zoomDirectionSet=!1,this.zoomPointSet=!1,this.needsUpdate=!0,this.raycaster.camera=e,this.resetState()}setTilesRenderer(e){console.warn('EnvironmentControls: "setTilesRenderer" has been deprecated. Use "setScene" and "setEllipsoid", instead.'),this.tilesRenderer=e,this.tilesRenderer!==null&&this.setScene(this.tilesRenderer.group)}attach(e){if(this.domElement)throw new Error("EnvironmentControls: Controls already attached to element");this.domElement=e,this.pointerTracker.domElement=e,e.style.touchAction="none";const t=c=>{this.enabled&&c.preventDefault()},r=c=>{if(!this.enabled)return;c.preventDefault();const{camera:u,raycaster:h,domElement:d,up:f,pivotMesh:p,pointerTracker:m,scene:g,pivotPoint:_,enabled:v}=this;if(m.addPointer(c),this.needsUpdate=!0,m.isPointerTouch()){if(p.visible=!1,m.getPointerCount()===0)d.setPointerCapture(c.pointerId);else if(m.getPointerCount()>2){this.resetState();return}}m.getCenterPoint(xe),fr(xe.x,xe.y,d,xe),_t(h,xe,u);const y=Math.abs(h.ray.direction.dot(f));if(y<ga||y<_a)return;const T=this._raycast(h);T&&(m.getPointerCount()===2||m.isRightClicked()||m.isLeftClicked()&&c.shiftKey?(this.setState(m.isPointerTouch()?ma:Kt),_.copy(T.point),p.position.copy(T.point),p.visible=m.isPointerTouch()?!1:v,p.updateMatrixWorld(),g.add(p)):m.isLeftClicked()&&(this.setState(gn),_.copy(T.point),p.position.copy(T.point),p.updateMatrixWorld(),g.add(p)))};let i=!1;const s=c=>{if(!this.enabled)return;c.preventDefault();const{pivotMesh:u,enabled:h}=this;this.zoomDirectionSet=!1,this.zoomPointSet=!1,this.state!==Mt&&(this.needsUpdate=!0);const{pointerTracker:d}=this;d.setHoverEvent(c),d.updatePointer(c)&&(d.isPointerTouch()&&d.getPointerCount()===2&&(i||(i=!0,queueMicrotask(()=>{i=!1,d.getCenterPoint(ba);const f=d.getStartTouchPointerDistance(),p=d.getTouchPointerDistance(),m=p-f;if(this.state===Mt||this.state===ma){d.getCenterPoint(ba),d.getStartCenterPoint(ld);const g=2*window.devicePixelRatio,_=ba.distanceTo(ld);(Math.abs(m)>g||_>g)&&(Math.abs(m)>_?(this.setState(mr),this.zoomDirectionSet=!1):this.setState(Kt))}if(this.state===mr){const g=d.getPreviousTouchPointerDistance();this.zoomDelta+=p-g,u.visible=!1}else this.state===Kt&&(u.visible=h)}))),this.dispatchEvent(cd))},o=c=>{if(!this.enabled)return;const{pointerTracker:u}=this;u.deletePointer(c),u.getPointerType()==="touch"&&u.getPointerCount()===0&&e.releasePointerCapture(c.pointerId),this.resetState(),this.needsUpdate=!0},a=c=>{if(!this.enabled)return;c.preventDefault();const{pointerTracker:u}=this;u.setHoverEvent(c),u.updatePointer(c),this.dispatchEvent(ud);let h;switch(c.deltaMode){case 2:h=c.deltaY*800;break;case 1:h=c.deltaY*40;break;case 0:h=c.deltaY;break}const d=Math.sign(h),f=Math.abs(h);this.zoomDelta-=.25*d*f,this.needsUpdate=!0,this._lastUsedState=mr,this.dispatchEvent(hd)},l=c=>{if(!this.enabled)return;const{pointerTracker:u}=this;c.buttons!==u.getPointerButtons()&&(u.deletePointer(c),this.resetState())};e.addEventListener("contextmenu",t),e.addEventListener("pointerdown",r),e.addEventListener("pointermove",s),e.addEventListener("pointerup",o),e.addEventListener("wheel",a,{passive:!1}),e.addEventListener("pointerenter",l),this._detachCallback=()=>{e.removeEventListener("contextmenu",t),e.removeEventListener("pointerdown",r),e.removeEventListener("pointermove",s),e.removeEventListener("pointerup",o),e.removeEventListener("wheel",a),e.removeEventListener("pointerenter",l)}}detach(){this.domElement=null,this._detachCallback&&(this._detachCallback(),this._detachCallback=null,this.pointerTracker.reset())}getUpDirection(e,t){t.copy(this.up)}getCameraUpDirection(e){this.getUpDirection(this.camera.position,e)}getPivotPoint(e){let t=null;this._lastUsedState===mr?this._zoomPointWasSet&&(t=e.copy(this.zoomPoint)):(this._lastUsedState===Kt||this._lastUsedState===gn)&&(t=e.copy(this.pivotPoint));const{camera:r,raycaster:i}=this;t!==null&&(W.copy(t).project(r),(W.x<-1||W.x>1||W.y<-1||W.y>1)&&(t=null)),_t(i,{x:0,y:0},r);const s=this._raycast(i);return s&&(t===null||s.distance<t.distanceTo(i.ray.origin))&&(t=e.copy(s.point)),t}resetState(){this.state!==Mt&&this.dispatchEvent(hd),this.state=Mt,this.pivotMesh.removeFromParent(),this.pivotMesh.visible=this.enabled,this.actionHeightOffset=0}setState(e=this.state,t=!0){this.state!==e&&(this.state===Mt&&t&&this.dispatchEvent(ud),this.pivotMesh.visible=this.enabled,this.dragInertia.set(0,0,0),this.rotationInertia.set(0,0),this.inertiaStableFrames=0,this.state=e,e!==Mt&&e!==ma&&(this._lastUsedState=e))}update(e=Math.min(this.clock.getDelta(),64/1e3)){if(!this.enabled||!this.camera||e===0)return;const{camera:t,cameraRadius:r,pivotPoint:i,up:s,state:o,adjustHeight:a,autoAdjustCameraRotation:l}=this;t.updateMatrixWorld(),this.getCameraUpDirection(fe),this._upInitialized||(this._upInitialized=!0,this.up.copy(fe)),this.zoomPointSet=!1;const c=this._inertiaNeedsUpdate(),u=this.needsUpdate||c;if(this.needsUpdate||c){const d=this.zoomDelta;this._updateZoom(),this._updatePosition(e),this._updateRotation(e),o===gn||o===Kt?(Se.set(0,0,-1).transformDirection(t.matrixWorld),this.inertiaTargetDistance=W.copy(i).sub(t.position).dot(Se)):o===Mt&&this._updateInertia(e),(o!==Mt||d!==0||c)&&this.dispatchEvent(cd),this.needsUpdate=!1}const h=t.isOrthographicCamera?null:a&&this._getPointBelowCamera()||null;if(this.getCameraUpDirection(fe),this._setFrame(fe),(this.state===gn||this.state===Kt)&&this.actionHeightOffset!==0){const{actionHeightOffset:d}=this;t.position.addScaledVector(s,-d),i.addScaledVector(s,-d),h&&(h.distance-=d)}if(this.actionHeightOffset=0,h){const d=h.distance;if(d<r){const f=r-d;t.position.addScaledVector(s,f),i.addScaledVector(s,f),this.actionHeightOffset=f}}this.pointerTracker.updateFrame(),u&&l&&(this.getCameraUpDirection(fe),this._alignCameraUp(fe,1),this.getCameraUpDirection(fe),this._clampRotation(fe))}adjustCamera(e){const{adjustHeight:t,cameraRadius:r}=this;if(e.isPerspectiveCamera){this.getUpDirection(e.position,fe);const i=t&&this._getPointBelowCamera(e.position,fe)||null;if(i){const s=i.distance;s<r&&e.position.addScaledVector(fe,r-s)}}}dispose(){this.detach()}_updateInertia(e){const{rotationInertia:t,pivotPoint:r,dragInertia:i,enableDamping:s,dampingFactor:o,camera:a,cameraRadius:l,minDistance:c,inertiaTargetDistance:u}=this;if(!this.enableDamping||this.inertiaStableFrames>1){i.set(0,0,0),t.set(0,0,0);return}const h=Math.pow(2,-e/o),d=Math.max(a.near,l,c,u),f=.25*(2/(2*1e3));if(t.lengthSq()>0){_t(ee,W.set(0,0,-1),a),ee.applyMatrix4(a.matrixWorldInverse),ee.direction.normalize(),ee.recast(-ee.direction.dot(ee.origin)).at(d/ee.direction.z,W),W.applyMatrix4(a.matrixWorld),_t(ee,nt.set(f,f,-1),a),ee.applyMatrix4(a.matrixWorldInverse),ee.direction.normalize(),ee.recast(-ee.direction.dot(ee.origin)).at(d/ee.direction.z,nt),nt.applyMatrix4(a.matrixWorld),W.sub(r).normalize(),nt.sub(r).normalize();const p=W.angleTo(nt)/e;t.multiplyScalar(h),(t.lengthSq()<p**2||!s)&&t.set(0,0)}if(i.lengthSq()>0){_t(ee,W.set(0,0,-1),a),ee.applyMatrix4(a.matrixWorldInverse),ee.direction.normalize(),ee.recast(-ee.direction.dot(ee.origin)).at(d/ee.direction.z,W),W.applyMatrix4(a.matrixWorld),_t(ee,nt.set(f,f,-1),a),ee.applyMatrix4(a.matrixWorldInverse),ee.direction.normalize(),ee.recast(-ee.direction.dot(ee.origin)).at(d/ee.direction.z,nt),nt.applyMatrix4(a.matrixWorld);const p=W.distanceTo(nt)/e;i.multiplyScalar(h),(i.lengthSq()<p**2||!s)&&i.set(0,0,0)}t.lengthSq()>0&&this._applyRotation(t.x*e,t.y*e,r),i.lengthSq()>0&&(a.position.addScaledVector(i,e),a.updateMatrixWorld())}_inertiaNeedsUpdate(){const{rotationInertia:e,dragInertia:t}=this;return e.lengthSq()!==0||t.lengthSq()!==0}_updateZoom(){const{zoomPoint:e,zoomDirection:t,camera:r,minDistance:i,maxDistance:s,pointerTracker:o,domElement:a,minZoom:l,maxZoom:c,zoomSpeed:u,state:h}=this;let d=this.zoomDelta;if(this.zoomDelta=0,!(!o.getLatestPoint(xe)||d===0&&h!==mr))if(this.rotationInertia.set(0,0),this.dragInertia.set(0,0,0),r.isOrthographicCamera){this._updateZoomDirection();const f=this.zoomPointSet||this._updateZoomPoint();Os.unproject(r);const p=Math.pow(.95,Math.abs(d*.05));let m=d>0?1/Math.abs(p):p;m*=u,m>1?c<r.zoom*m&&(m=1):l>r.zoom*m&&(m=1),r.zoom*=m,r.updateProjectionMatrix(),f&&(fr(xe.x,xe.y,a,ya),ya.unproject(r),r.position.sub(ya).add(Os),r.updateMatrixWorld())}else{this._updateZoomDirection();const f=W.copy(t);if(this.zoomPointSet||this._updateZoomPoint()){const p=e.distanceTo(r.position);if(d<0){const m=Math.min(0,p-s);d=d*p*u*.0025,d=Math.max(d,m)}else{const m=Math.max(0,p-i);d=d*Math.max(p-i,0)*u*.0025,d=Math.min(d,m)}r.position.addScaledVector(t,d),r.updateMatrixWorld()}else{const p=this._getPointBelowCamera();if(p){const m=p.distance;f.set(0,0,-1).transformDirection(r.matrixWorld),r.position.addScaledVector(f,d*m*.01),r.updateMatrixWorld()}}}}_updateZoomDirection(){if(this.zoomDirectionSet)return;const{domElement:e,raycaster:t,camera:r,zoomDirection:i,pointerTracker:s}=this;s.getLatestPoint(xe),fr(xe.x,xe.y,e,Os),_t(t,Os,r),i.copy(t.ray.direction).normalize(),this.zoomDirectionSet=!0}_updateZoomPoint(){const{camera:e,zoomDirectionSet:t,zoomDirection:r,raycaster:i,zoomPoint:s,pointerTracker:o,domElement:a}=this;if(this._zoomPointWasSet=!1,!t)return!1;e.isOrthographicCamera&&o.getLatestPoint(di)?(fr(di.x,di.y,a,di),_t(i,di,e)):(i.ray.origin.copy(e.position),i.ray.direction.copy(r),i.near=0,i.far=1/0);const l=this._raycast(i);return l?(s.copy(l.point),this.zoomPointSet=!0,this._zoomPointWasSet=!0,!0):!1}_getPointBelowCamera(e=this.camera.position,t=this.up){const{raycaster:r}=this;r.ray.direction.copy(t).multiplyScalar(-1),r.ray.origin.copy(e).addScaledVector(t,1e5),r.near=0,r.far=1/0;const i=this._raycast(r);return i&&(i.distance-=1e5),i}_updatePosition(e){const{raycaster:t,camera:r,pivotPoint:i,up:s,pointerTracker:o,domElement:a,state:l,dragInertia:c}=this;if(l===gn){if(o.getCenterPoint(xe),fr(xe.x,xe.y,a,xe),od.setFromNormalAndCoplanarPoint(s,i),_t(t,xe,r),Math.abs(t.ray.direction.dot(s))<ga){const u=Math.acos(ga);Rs.crossVectors(t.ray.direction,s).normalize(),t.ray.direction.copy(s).applyAxisAngle(Rs,u).multiplyScalar(-1)}if(this.getUpDirection(i,fe),Math.abs(t.ray.direction.dot(fe))<_a){const u=Math.acos(_a);Rs.crossVectors(t.ray.direction,fe).normalize(),t.ray.direction.copy(fe).applyAxisAngle(Rs,u).multiplyScalar(-1)}t.ray.intersectPlane(od,W)&&(nt.subVectors(i,W),r.position.add(nt),r.updateMatrixWorld(),nt.multiplyScalar(1/e),o.getMoveDistance()/e<2*window.devicePixelRatio?this.inertiaStableFrames++:(c.copy(nt),this.inertiaStableFrames=0))}}_updateRotation(e){const{pivotPoint:t,pointerTracker:r,domElement:i,state:s,rotationInertia:o}=this;s===Kt&&(r.getCenterPoint(xe),r.getPreviousCenterPoint(ad),pi.subVectors(xe,ad).multiplyScalar(2*Math.PI/i.clientHeight),this._applyRotation(pi.x,pi.y,t),pi.multiplyScalar(1/e),r.getMoveDistance()/e<2*window.devicePixelRatio?this.inertiaStableFrames++:(o.copy(pi),this.inertiaStableFrames=0))}_applyRotation(e,t,r){if(e===0&&t===0)return;const{camera:i,minAltitude:s,maxAltitude:o,rotationSpeed:a}=this,l=-e*a;let c=t*a;Se.set(0,0,1).transformDirection(i.matrixWorld),pt.set(1,0,0).transformDirection(i.matrixWorld),this.getUpDirection(r,fe);let u;fe.dot(Se)>1-1e-10?u=0:(W.crossVectors(fe,Se).normalize(),u=Math.sign(W.dot(pt))*fe.angleTo(Se)),c>0?(c=Math.min(u-s,c),c=Math.max(0,c)):(c=Math.max(u-o,c),c=Math.min(0,c)),At.setFromAxisAngle(fe,l),Mr(r,At,pn),i.matrixWorld.premultiply(pn),pt.set(1,0,0).transformDirection(i.matrixWorld),At.setFromAxisAngle(pt,-c),Mr(r,At,pn),i.matrixWorld.premultiply(pn),i.matrixWorld.decompose(i.position,i.quaternion,W)}_setFrame(e){const{up:t,camera:r,zoomPoint:i,zoomDirectionSet:s,zoomPointSet:o,scaleZoomOrientationAtEdges:a}=this;if(s&&(o||this._updateZoomPoint())){if(At.setFromUnitVectors(t,e),a){this.getUpDirection(i,W);let l=Math.max(W.dot(t)-.6,0)/.4;l=j.mapLinear(l,0,.5,0,1),l=Math.min(l,1),r.isOrthographicCamera&&(l*=.1),At.slerp(sx,1-l)}Mr(i,At,pn),r.updateMatrixWorld(),r.matrixWorld.premultiply(pn),r.matrixWorld.decompose(r.position,r.quaternion,W),this.zoomDirectionSet=!1,this._updateZoomDirection()}t.copy(e),r.updateMatrixWorld()}_raycast(e){const{scene:t,useFallbackPlane:r,fallbackPlane:i}=this,s=e.intersectObject(t)[0]||null;if(s)return s;if(r){const o=i;if(e.ray.intersectPlane(o,W))return{point:W.clone(),distance:e.ray.origin.distanceTo(W)}}return null}_alignCameraUp(e,t=1){const{camera:r,state:i,pivotPoint:s,zoomPoint:o,zoomPointSet:a}=this;r.updateMatrixWorld(),Se.set(0,0,-1).transformDirection(r.matrixWorld),pt.set(-1,0,0).transformDirection(r.matrixWorld);let l=j.mapLinear(1-Math.abs(Se.dot(e)),0,.2,0,1);l=j.clamp(l,0,1),t*=l,va.crossVectors(e,Se),va.lerp(pt,1-t).normalize(),At.setFromUnitVectors(pt,va),r.quaternion.premultiply(At);let c=null;i===gn||i===Kt?c=Ss.copy(s):a&&(c=Ss.copy(o)),c&&(Ms.copy(r.matrixWorld).invert(),W.copy(c).applyMatrix4(Ms),r.updateMatrixWorld(),W.applyMatrix4(r.matrixWorld),Cs.subVectors(c,W),r.position.add(Cs)),r.updateMatrixWorld()}_clampRotation(e){const{camera:t,minAltitude:r,maxAltitude:i,state:s,pivotPoint:o,zoomPoint:a,zoomPointSet:l}=this;t.updateMatrixWorld(),Se.set(0,0,1).transformDirection(t.matrixWorld),pt.set(1,0,0).transformDirection(t.matrixWorld);let c;e.dot(Se)>1-1e-10?c=0:(W.crossVectors(e,Se),c=Math.sign(W.dot(pt))*e.angleTo(Se));let u;if(c>i)u=i;else if(c<r)u=r;else return;Se.copy(e),At.setFromAxisAngle(pt,u),Se.applyQuaternion(At).normalize(),W.crossVectors(Se,pt).normalize(),pn.makeBasis(pt,W,Se),t.quaternion.setFromRotationMatrix(pn);let h=null;s===gn||s===Kt?h=Ss.copy(o):l&&(h=Ss.copy(a)),h&&(Ms.copy(t.matrixWorld).invert(),W.copy(h).applyMatrix4(Ms),t.updateMatrixWorld(),W.applyMatrix4(t.matrixWorld),Cs.subVectors(h,W),t.position.add(Cs)),t.updateMatrixWorld()}}const dd=new H,hr=new H,qe=new P,J=new P,qt=new P,rt=new P,ax=new P,dr=new P,Xt=new Fe,pd=new P,Nn=new P,te=new Rt,wa=new Lc,fi=new Z,fd={},lx=2550;class cx extends ox{get tilesGroup(){return console.warn('GlobeControls: "tilesGroup" has been deprecated. Use "ellipsoidGroup", instead.'),this.ellipsoidFrame}get ellipsoidFrame(){return this.ellipsoidGroup.matrixWorld}get ellipsoidFrameInverse(){const{ellipsoidGroup:e,ellipsoidFrame:t,_ellipsoidFrameInverse:r}=this;return e.matrixWorldInverse?e.matrixWorldInverse:r.copy(t).invert()}constructor(e=null,t=null,r=null,i=null){super(e,t,r),this.isGlobeControls=!0,this._dragMode=0,this._rotationMode=0,this.maxZoom=.01,this.nearMargin=.25,this.farMargin=0,this.useFallbackPlane=!1,this.autoAdjustCameraRotation=!1,this.globeInertia=new Fe,this.globeInertiaFactor=0,this.ellipsoid=Hr.clone(),this.ellipsoidGroup=new Ae,this._ellipsoidFrameInverse=new H,i!==null&&this.setTilesRenderer(i)}setTilesRenderer(e){super.setTilesRenderer(e),e!==null&&this.setEllipsoid(e.ellipsoid,e.group)}setEllipsoid(e,t){this.ellipsoid=e||Hr.clone(),this.ellipsoidGroup=t||new Ae}getPivotPoint(e){const{camera:t,ellipsoidFrame:r,ellipsoidFrameInverse:i,ellipsoid:s}=this;return rt.set(0,0,-1).transformDirection(t.matrixWorld),te.origin.copy(t.position),te.direction.copy(rt),te.applyMatrix4(i),fa(te,s,J),J.applyMatrix4(r),(super.getPivotPoint(e)===null||qe.subVectors(e,te.origin).dot(te.direction)>qe.subVectors(J,te.origin).dot(te.direction))&&e.copy(J),e}getVectorToCenter(e){const{ellipsoidFrame:t,camera:r}=this;return e.setFromMatrixPosition(t).sub(r.position)}getDistanceToCenter(){return this.getVectorToCenter(J).length()}getUpDirection(e,t){const{ellipsoidFrame:r,ellipsoidFrameInverse:i,ellipsoid:s}=this;J.copy(e).applyMatrix4(i),s.getPositionToNormal(J,t),t.transformDirection(r)}getCameraUpDirection(e){const{ellipsoidFrame:t,ellipsoidFrameInverse:r,ellipsoid:i,camera:s}=this;s.isOrthographicCamera?(this._getVirtualOrthoCameraPosition(J),J.applyMatrix4(r),i.getPositionToNormal(J,e),e.transformDirection(t)):this.getUpDirection(s.position,e)}update(e=Math.min(this.clock.getDelta(),64/1e3)){if(!this.enabled||!this.camera||e===0)return;const{camera:t,pivotMesh:r}=this;this._isNearControls()?this.scaleZoomOrientationAtEdges=this.zoomDelta<0:(this.state!==Mt&&this._dragMode!==1&&this._rotationMode!==1&&(r.visible=!1),this.scaleZoomOrientationAtEdges=!1);const i=this.needsUpdate||this._inertiaNeedsUpdate();super.update(e),this.adjustCamera(t),i&&this._isNearControls()&&(this.getCameraUpDirection(dr),this._alignCameraUp(dr,1),this.getCameraUpDirection(dr),this._clampRotation(dr))}adjustCamera(e){super.adjustCamera(e);const{ellipsoidFrame:t,ellipsoidFrameInverse:r,ellipsoid:i,nearMargin:s,farMargin:o}=this,a=Math.max(...i.radius);if(e.isPerspectiveCamera){const l=J.setFromMatrixPosition(t).sub(e.position).length(),c=s*a,u=j.clamp((l-a)/c,0,1),h=j.lerp(1,1e3,u);e.near=Math.max(h,l-a-c),qe.copy(e.position).applyMatrix4(r),i.getPositionToCartographic(qe,fd);const d=Math.max(i.getPositionElevation(qe),lx),f=i.calculateHorizonDistance(fd.lat,d);e.far=f+.1+a*o,e.updateProjectionMatrix()}else{this._getVirtualOrthoCameraPosition(e.position,e),e.updateMatrixWorld(),dd.copy(e.matrixWorld).invert(),J.setFromMatrixPosition(t).applyMatrix4(dd);const l=-J.z;e.near=l-a*(1+s),e.far=l+.1+a*o,e.position.addScaledVector(rt,e.near),e.far-=e.near,e.near=0,e.updateProjectionMatrix(),e.updateMatrixWorld()}}resetState(){super.resetState(),this._dragMode=0,this._rotationMode=0}_updateInertia(e){super._updateInertia(e);const{globeInertia:t,enableDamping:r,dampingFactor:i,camera:s,cameraRadius:o,minDistance:a,inertiaTargetDistance:l,ellipsoidFrame:c}=this;if(!this.enableDamping||this.inertiaStableFrames>1){this.globeInertiaFactor=0,this.globeInertia.identity();return}const u=Math.pow(2,-e/i),h=Math.max(s.near,o,a,l),d=.25*(2/(2*1e3));if(qt.setFromMatrixPosition(c),this.globeInertiaFactor!==0){_t(te,J.set(0,0,-1),s),te.applyMatrix4(s.matrixWorldInverse),te.direction.normalize(),te.recast(-te.direction.dot(te.origin)).at(h/te.direction.z,J),J.applyMatrix4(s.matrixWorld),_t(te,qe.set(d,d,-1),s),te.applyMatrix4(s.matrixWorldInverse),te.direction.normalize(),te.recast(-te.direction.dot(te.origin)).at(h/te.direction.z,qe),qe.applyMatrix4(s.matrixWorld),J.sub(qt).normalize(),qe.sub(qt).normalize(),this.globeInertiaFactor*=u;const f=J.angleTo(qe)/e;(2*Math.acos(t.w)*this.globeInertiaFactor<f||!r)&&(this.globeInertiaFactor=0,t.identity())}this.globeInertiaFactor!==0&&(t.w===1&&(t.x!==0||t.y!==0||t.z!==0)&&(t.w=Math.min(t.w,1-1e-9)),qt.setFromMatrixPosition(c),Xt.identity().slerp(t,this.globeInertiaFactor*e),Mr(qt,Xt,hr),s.matrixWorld.premultiply(hr),s.matrixWorld.decompose(s.position,s.quaternion,J))}_inertiaNeedsUpdate(){return super._inertiaNeedsUpdate()||this.globeInertiaFactor!==0}_updatePosition(e){if(this.state===gn){this._dragMode===0&&(this._dragMode=this._isNearControls()?1:-1);const{raycaster:t,camera:r,pivotPoint:i,pointerTracker:s,domElement:o,ellipsoidFrame:a,ellipsoidFrameInverse:l}=this,c=qe,u=ax;s.getCenterPoint(fi),fr(fi.x,fi.y,o,fi),_t(t,fi,r),t.ray.applyMatrix4(l);const h=J.copy(i).applyMatrix4(l).length();wa.radius.setScalar(h),r.isPerspectiveCamera?wa.intersectRay(t.ray,J)||ix(t.ray,h,J):fa(t.ray,wa,J),J.applyMatrix4(a),qt.setFromMatrixPosition(a),c.subVectors(i,qt).normalize(),u.subVectors(J,qt).normalize(),Xt.setFromUnitVectors(u,c),Mr(qt,Xt,hr),r.matrixWorld.premultiply(hr),r.matrixWorld.decompose(r.position,r.quaternion,J),s.getMoveDistance()/e<2*window.devicePixelRatio?this.inertiaStableFrames++:(this.globeInertia.copy(Xt),this.globeInertiaFactor=1/e,this.inertiaStableFrames=0)}}_updateRotation(...e){this._rotationMode===1||this._isNearControls()?(this._rotationMode=1,super._updateRotation(...e)):(this.pivotMesh.visible=!1,this._rotationMode=-1)}_updateZoom(){const{zoomDelta:e,ellipsoid:t,zoomSpeed:r,zoomPoint:i,camera:s,maxZoom:o,state:a}=this;if(a!==mr&&e===0)return;this.rotationInertia.set(0,0),this.dragInertia.set(0,0,0),this.globeInertia.identity(),this.globeInertiaFactor=0;const l=j.clamp(j.mapLinear(Math.abs(e),0,20,0,1),0,1);if(this._isNearControls()||e>0){if(this._updateZoomDirection(),e<0&&(this.zoomPointSet||this._updateZoomPoint())){rt.set(0,0,-1).transformDirection(s.matrixWorld).normalize(),Nn.copy(this.up).multiplyScalar(-1),this.getUpDirection(i,pd);const c=j.clamp(j.mapLinear(-pd.dot(Nn),1,.95,0,1),0,1),u=1-rt.dot(Nn),h=s.isOrthographicCamera?.05:1,d=j.clamp(l*3,0,1),f=Math.min(c*u*h*d,.1);Nn.lerpVectors(rt,Nn,f).normalize(),Xt.setFromUnitVectors(rt,Nn),Mr(i,Xt,hr),s.matrixWorld.premultiply(hr),s.matrixWorld.decompose(s.position,s.quaternion,Nn),this.zoomDirection.subVectors(i,s.position).normalize()}super._updateZoom()}else if(s.isPerspectiveCamera){const c=this._getPerspectiveTransitionDistance(),u=this._getMaxPerspectiveDistance(),h=j.mapLinear(this.getDistanceToCenter(),c,u,0,1);this._tiltTowardsCenter(j.lerp(0,.4,h*l)),this._alignCameraUpToNorth(j.lerp(0,.2,h*l));const d=this.getDistanceToCenter()-t.radius.x,f=e*d*r*.0025,p=Math.max(f,Math.min(this.getDistanceToCenter()-u,0));this.getVectorToCenter(J).normalize(),this.camera.position.addScaledVector(J,p),this.camera.updateMatrixWorld(),this.zoomDelta=0}else{const c=this._getOrthographicTransitionZoom(),u=this._getMinOrthographicZoom(),h=j.mapLinear(s.zoom,c,u,0,1);this._tiltTowardsCenter(j.lerp(0,.4,h*l)),this._alignCameraUpToNorth(j.lerp(0,.2,h*l));const d=this.zoomDelta,f=Math.pow(.95,Math.abs(d*.05)),p=d>0?1/Math.abs(f):f,m=u/s.zoom,g=Math.max(p*r,Math.min(m,1));s.zoom=Math.min(o,s.zoom*g),s.updateProjectionMatrix(),this.zoomDelta=0,this.zoomDirectionSet=!1}}_alignCameraUpToNorth(e){const{ellipsoidFrame:t}=this;dr.set(0,0,1).transformDirection(t),this._alignCameraUp(dr,e)}_tiltTowardsCenter(e){const{camera:t,ellipsoidFrame:r}=this;rt.set(0,0,-1).transformDirection(t.matrixWorld).normalize(),J.setFromMatrixPosition(r).sub(t.position).normalize(),J.lerp(rt,1-e).normalize(),Xt.setFromUnitVectors(rt,J),t.quaternion.premultiply(Xt),t.updateMatrixWorld()}_getPerspectiveTransitionDistance(){const{camera:e,ellipsoid:t}=this;if(!e.isPerspectiveCamera)throw new Error;const r=Math.max(...t.radius),i=2*Math.atan(Math.tan(j.DEG2RAD*e.fov*.5)*e.aspect),s=r/Math.tan(j.DEG2RAD*e.fov*.5),o=r/Math.tan(i*.5);return Math.max(s,o)}_getMaxPerspectiveDistance(){const{camera:e,ellipsoid:t}=this;if(!e.isPerspectiveCamera)throw new Error;const r=Math.max(...t.radius),i=2*Math.atan(Math.tan(j.DEG2RAD*e.fov*.5)*e.aspect),s=r/Math.tan(j.DEG2RAD*e.fov*.5),o=r/Math.tan(i*.5);return 2*Math.max(s,o)}_getOrthographicTransitionZoom(){const{camera:e,ellipsoid:t}=this;if(!e.isOrthographicCamera)throw new Error;const r=e.top-e.bottom,i=e.right-e.left,s=Math.max(r,i),o=2*Math.max(...t.radius);return 2*s/o}_getMinOrthographicZoom(){const{camera:e,ellipsoid:t}=this;if(!e.isOrthographicCamera)throw new Error;const r=e.top-e.bottom,i=e.right-e.left,s=Math.min(r,i),o=2*Math.max(...t.radius);return .7*s/o}_getVirtualOrthoCameraPosition(e,t=this.camera){const{ellipsoidFrame:r,ellipsoidFrameInverse:i,ellipsoid:s}=this;if(!t.isOrthographicCamera)throw new Error;te.origin.copy(t.position),te.direction.set(0,0,-1).transformDirection(t.matrixWorld),te.applyMatrix4(i),fa(te,s,qe),qe.applyMatrix4(r);const o=t.top-t.bottom,a=t.right-t.left,l=Math.max(o,a)/t.zoom;rt.set(0,0,-1).transformDirection(t.matrixWorld);const c=qe.sub(t.position).dot(rt);e.copy(t.position).addScaledVector(rt,c-l*4)}_isNearControls(){const{camera:e}=this;return e.isPerspectiveCamera?this.getDistanceToCenter()<this._getPerspectiveTransitionDistance():e.zoom>this._getOrthographicTransitionZoom()}_raycast(e){const t=super._raycast(e);if(t===null){const{ellipsoid:r,ellipsoidFrame:i,ellipsoidFrameInverse:s}=this;te.copy(e.ray).applyMatrix4(s);const o=r.intersectRay(te,J);return o!==null?{point:o.clone().applyMatrix4(i)}:null}else return t}}const Gn=Symbol("TILE_X"),Wn=Symbol("TILE_Y"),_n=Symbol("TILE_LEVEL");class ux{get tiling(){return this.imageSource.tiling}constructor(e={}){const{pixelSize:t=.01,center:r=!1,useRecommendedSettings:i=!0,imageSource:s=null}=e;this.priority=-10,this.tiles=null,this.imageSource=s,this.pixelSize=t,this.center=r,this.useRecommendedSettings=i}init(e){this.useRecommendedSettings&&(e.errorTarget=1),this.tiles=e,this.imageSource.fetchOptions=e.fetchOptions,this.imageSource.fetchData=(t,r)=>(e.invokeAllPlugins(i=>t=i.preprocessURL?i.preprocessURL(t,null):t),e.invokeOnePlugin(i=>i!==this&&i.fetchData&&i.fetchData(t,r)))}async loadRootTileSet(){const{tiles:e,imageSource:t}=this;let r=e.rootURL;return e.invokeAllPlugins(i=>r=i.preprocessURL?i.preprocessURL(r,null):r),await t.init(r),this.getTileset(r)}async parseToMesh(e,t,r,i,s){if(s.aborted)return null;const o=t[Gn],a=t[Wn],l=t[_n],c=await this.imageSource.processBufferToTexture(e);this.imageSource.setData(o,a,l,c);let u=1,h=1,d=0,f=0,p=0;const m=t.boundingVolume.box;m&&([d,f,p]=m,u=m[3],h=m[7]);const g=new Tt(new xc(2*u,2*h),new $e({map:c,transparent:!0}));return g.position.set(d,f,p),g}preprocessNode(e){const{tiling:t}=this,r=t.maxLevel;e[_n]<r&&e.parent!==null&&this.expandChildren(e)}disposeTile(e){const t=e[Gn],r=e[Wn],i=e[_n],{imageSource:s}=this;s.has(t,r,i)&&s.release(t,r,i)}getTileset(e){const{tiling:t,tiles:r}=this,i=t.minLevel,{tileCountX:s,tileCountY:o}=t.getLevel(i),a=[];for(let c=0;c<s;c++)for(let u=0;u<o;u++){const h=this.createChild(c,u,i);h!==null&&a.push(h)}const l={asset:{version:"1.1"},geometricError:1e5,root:{refine:"REPLACE",geometricError:1e5,boundingVolume:this.createBoundingVolume(0,0,-1),children:a,[_n]:-1,[Gn]:0,[Wn]:0}};return r.preprocessTileSet(l,e),l}getUrl(e,t,r){return this.imageSource.getUrl(e,t,r)}createBoundingVolume(e,t,r){const{center:i,pixelSize:s,tiling:o}=this,{pixelWidth:a,pixelHeight:l}=o.getLevel(o.maxLevel),[c,u,h,d]=r===-1?o.getFullBounds(!0):o.getTileBounds(e,t,r,!0);let f=(h-c)/2,p=(d-u)/2,m=c+f,g=u+p;return i&&(m-=.5,g-=.5),m*=a*s,f*=a*s,g*=l*s,p*=l*s,{box:[m,g,0,f,0,0,0,p,0,0,0,0]}}createChild(e,t,r){const{pixelSize:i,tiling:s}=this;if(!s.getTileExists(e,t,r))return null;const{pixelWidth:o,pixelHeight:a}=s.getLevel(s.maxLevel),{pixelWidth:l,pixelHeight:c}=s.getLevel(r);return{refine:"REPLACE",geometricError:i*(Math.max(o/l,a/c)-1),boundingVolume:this.createBoundingVolume(e,t,r),content:{uri:this.getUrl(e,t,r)},children:[],[Gn]:e,[Wn]:t,[_n]:r}}expandChildren(e){const t=e[_n],r=e[Gn],i=e[Wn];for(let s=0;s<2;s++)for(let o=0;o<2;o++){const a=this.createChild(2*r+s,2*i+o,t+1);a&&e.children.push(a)}}}const Ta=new P,ks=new P;function hx(n,e,t){const r=t+1e-5;let i=e+1e-5;Math.abs(i)>Math.PI/2&&(i=i-1e-5),n.getCartographicToPosition(e,t,0,Ta),n.getCartographicToPosition(i,t,0,ks);const s=Ta.distanceTo(ks)/1e-5;return n.getCartographicToPosition(e,r,0,ks),[Ta.distanceTo(ks)/1e-5,s]}const dx=30,px=15,xa=new P,Ea=new P,Fn=new Z,Aa=new sr;class fx extends ux{get projection(){return this.tiling.projection}constructor(e={}){const{shape:t="planar",endCaps:r=!0,...i}=e;super(i),this.shape=t,this.endCaps=r}async parseToMesh(e,t,...r){const i=await super.parseToMesh(e,t,...r),{shape:s,projection:o,tiles:a,tiling:l}=this;if(s==="ellipsoid"){const c=a.ellipsoid,u=t[_n],h=t[Gn],d=t[Wn],[f,p,m,g]=l.getTileBounds(h,d,u,!0),[_,v,y,T]=t.boundingVolume.region,A=Math.ceil((T-v)*j.RAD2DEG*.25),w=Math.ceil((y-_)*j.RAD2DEG*.25),x=Math.max(px,A),b=Math.max(dx,w),E=new xc(1,1,b,x),{position:M,normal:S,uv:O}=E.attributes,L=M.count;t.cached.boundingVolume.getSphere(Aa);for(let I=0;I<L;I++){xa.fromBufferAttribute(M,I),Ea.fromBufferAttribute(S,I),Fn.fromBufferAttribute(O,I);const N=j.mapLinear(Fn.x,0,1,_,y);let R=j.mapLinear(Fn.y,0,1,v,T);if(o.isMercator&&Fn.y!==0&&Fn.y!==1){const $=o.convertProjectionToLatitude(1),B=1/x,G=j.mapLinear(Fn.y-B,0,1,v,T),ye=j.mapLinear(Fn.y+B,0,1,v,T);R>$&&G<$&&(R=$),R<-$&&ye>-$&&(R=-$)}c.getCartographicToPosition(R,N,0,xa).sub(Aa.center),c.getCartographicToNormal(R,N,Ea);const z=j.mapLinear(o.convertLongitudeToProjection(N),f,m,0,1),F=j.mapLinear(o.convertLatitudeToProjection(R),p,g,0,1);O.setXY(I,z,F),M.setXYZ(I,...xa),S.setXYZ(I,...Ea)}i.geometry=E,i.position.copy(Aa.center)}return i}createBoundingVolume(e,t,r){if(this.shape==="ellipsoid"){const{tiling:i,endCaps:s}=this,o=r===-1,a=o?i.getFullBounds(!0):i.getTileBounds(e,t,r,!0),l=o?i.getFullBounds():i.getTileBounds(e,t,r);return s&&(a[3]===1&&(l[3]=Math.PI/2),a[1]===0&&(l[1]=-Math.PI/2)),{region:[...l,-1,1]}}else return super.createBoundingVolume(e,t,r)}preprocessNode(e,...t){super.preprocessNode(e,t);const{shape:r,projection:i,tiling:s}=this;if(r==="ellipsoid"){const o=e[_n],a=e[Gn],l=e[Wn];if(o===-1)return e.geometricError=1e50,parent;const[c,u,h,d]=s.getTileBounds(a,l,o,!0),{tilePixelWidth:f,tilePixelHeight:p}=s.getLevel(o),{pixelWidth:m,pixelHeight:g}=s.getLevel(s.maxLevel),_=(h-c)/f,v=(d-u)/p,y=1/m,T=1/g,[,A,w,x]=s.getTileBounds(a,l,o),b=A>0!=x>0?0:Math.min(Math.abs(A),Math.abs(x)),E=i.convertLatitudeToProjection(b),M=i.getLongitudeDerivativeAtProjection(c),S=i.getLatitudeDerivativeAtProjection(E),[O,L]=hx(this.tiles.ellipsoid,b,w),I=Math.max(_*M*O,v*S*L),N=Math.max(y*M*O,T*S*L);e.geometricError=I-N,e.parent===null&&(e.geometricError=1e50)}return e}}class mx{get isMercator(){return this.scheme==="EPSG:3857"}constructor(e="EPSG:4326"){this.scheme=e,this.tileCountX=1,this.tileCountY=1,this.setScheme(e)}setScheme(e){switch(this.scheme=e,e){case"EPSG:4326":this.tileCountX=2,this.tileCountY=1;break;case"EPSG:3857":this.tileCountX=1,this.tileCountY=1;break;default:throw new Error}}convertProjectionToLatitude(e){if(this.isMercator){const t=j.mapLinear(e,0,1,-1,1);return 2*Math.atan(Math.exp(t*Math.PI))-Math.PI/2}else return j.mapLinear(e,0,1,-Math.PI/2,Math.PI/2)}convertProjectionToLongitude(e){return j.mapLinear(e,0,1,-Math.PI,Math.PI)}convertLatitudeToProjection(e){if(this.isMercator){const t=Math.log(Math.tan(Math.PI/4+e/2));return 1/2+1*t/(2*Math.PI)}else return j.mapLinear(e,-Math.PI/2,Math.PI/2,0,1)}convertLongitudeToProjection(e){return(e+Math.PI)/(2*Math.PI)}getLongitudeDerivativeAtProjection(e){return 2*Math.PI}getLatitudeDerivativeAtProjection(e){let t=e-1e-5;return t<0&&(t=e+1e-5),this.isMercator?Math.abs(this.convertProjectionToLatitude(e)-this.convertProjectionToLatitude(t))/1e-5:Math.PI}getBounds(){return[this.convertProjectionToLongitude(0),this.convertProjectionToLatitude(0),this.convertProjectionToLongitude(1),this.convertProjectionToLatitude(1)]}}function mi(...n){return n.join("_")}class gx{constructor(){this.cache={},this.count=0,this.cachedBytes=0}fetchItem(){}disposeItem(){}getMemoryUsage(e){return 0}setData(...e){const{cache:t}=this,r=e.pop(),i=mi(...e);if(i in t)throw new Error(`DataCache: "${i}" is already present.`);return this.cache[i]={abortController:new AbortController,result:r,count:1,bytes:this.getMemoryUsage(r)},this.count++,this.cachedBytes+=this.cache[i].bytes,r}lock(...e){const{cache:t}=this,r=mi(...e);if(r in t)t[r].count++;else{const i=new AbortController,s={abortController:i,result:null,count:1,bytes:0};s.result=this.fetchItem(...e,i.signal),s.result instanceof Promise?s.result.then(o=>(s.result=o,s.bytes=this.getMemoryUsage(o),this.cachedBytes+=s.bytes,o)):(s.bytes=this.getMemoryUsage(s.result),this.cachedBytes+=s.bytes),this.cache[r]=s,this.count++}return t[r].result}release(...e){const t=mi(...e);this.releaseViaFullKey(t)}get(...e){const{cache:t}=this,r=mi(...e);return r in t&&t[r].count>0?t[r].result:null}has(...e){const{cache:t}=this;return mi(...e)in t}dispose(){const{cache:e}=this;for(const t in e){const{abortController:r}=e[t];r.abort(),this.releaseViaFullKey(t,!0)}this.cache={}}releaseViaFullKey(e,t=!1){const{cache:r}=this;if(e in r&&r[e].count>0){const i=r[e];if(i.count--,i.count===0||t){const s=()=>{if(r[e]!==i)return;const{result:o,abortController:a}=i;a.abort(),o instanceof Promise?o.then(l=>this.disposeItem(l)).catch(()=>{}):this.disposeItem(o),delete r[e],this.count--,this.cachedBytes-=i.bytes};t?s():queueMicrotask(()=>{i.count===0&&s()})}return!0}throw new Error("DataCache: Attempting to release key that does not exist")}}function ft(n,e,t){return Math.min(Math.max(n,e),t)}class _x{get levelCount(){return this._levels.length}get maxLevel(){return this.levelCount-1}get minLevel(){const e=this._levels;for(let t=0;t<e.length;t++)if(e[t]!==null)return t;return-1}get rootBounds(){return this._rootBounds??this.projection?.getBounds()??[0,0,1,1]}get rootOrigin(){const e=this.rootBounds;return this._rootOrigin??[e[0],e[1]]}get aspect(){const{pixelWidth:e,pixelHeight:t}=this.getLevel(this.maxLevel);return e/t}constructor(){this.flipY=!1,this.pixelOverlap=0,this._rootBounds=null,this._rootOrigin=null,this.projection=null,this._levels=[]}setLevel(e,t={}){const r=this._levels;for(;r.length<e;)r.push(null);const{tilePixelWidth:i=256,tilePixelHeight:s=256,tileCountX:o=2**e,tileCountY:a=2**e}=t,{pixelWidth:l=i*o,pixelHeight:c=s*a}=t;r[e]={tilePixelWidth:i,tilePixelHeight:s,pixelWidth:l,pixelHeight:c,tileCountX:o,tileCountY:a}}generateLevels(e,t,r,i={}){const{minLevel:s=0,tilePixelWidth:o=256,tilePixelHeight:a=256}=i,l=e-1,{pixelWidth:c=o*t*2**l,pixelHeight:u=a*r*2**l}=i;for(let h=s;h<e;h++){const d=e-h-1,f=Math.ceil(c*2**-d),p=Math.ceil(u*2**-d),m=Math.ceil(f/o),g=Math.ceil(p/a);this.setLevel(h,{tilePixelWidth:o,tilePixelHeight:a,pixelWidth:f,pixelHeight:p,tileCountX:m,tileCountY:g})}}getLevel(e){return this._levels[e]}setOrigin(e,t){this._rootOrigin=[e,t]}setBounds(e,t,r,i){this._rootBounds=[e,t,r,i]}setProjection(e){this.projection=e}getTileAtPoint(e,t,r,i=!1){const{projection:s,flipY:o}=this,{tileCountX:a,tileCountY:l}=this.getLevel(r),c=1/a,u=1/l;s&&!i&&(e=s.convertLongitudeToProjection(e),t=s.convertLatitudeToProjection(t));const h=Math.floor(e/c);let d=Math.floor(t/u);return o&&(d=l-1-d),[h,d]}getTilesInRange(e,t,r,i,s,o=!1){const a=this.getTileAtPoint(e,t,s,o,!1),l=this.getTileAtPoint(r,i,s,o,!1);this.flipY&&([a[1],l[1]]=[l[1],a[1]]);const{tileCountX:c,tileCountY:u}=this.getLevel(s),[h,d]=a,[f,p]=l;return f<0||p<0||h>=c||d>=u?[0,0,-1,-1]:[ft(h,0,c-1),ft(d,0,u-1),ft(f,0,c-1),ft(p,0,u-1)]}getTileExists(e,t,r){const[i,s,o,a]=this.rootBounds,[l,c,u,h]=this.getTileBounds(e,t,r);return!(l>=u||c>=h)&&l<=o&&c<=a&&u>=i&&h>=s}getFullBounds(e=!1){const{projection:t}=this,r=[...this.rootBounds];return t&&e&&(r[0]=t.convertLongitudeToProjection(r[0]),r[1]=t.convertLatitudeToProjection(r[1]),r[2]=t.convertLongitudeToProjection(r[2]),r[3]=t.convertLatitudeToProjection(r[3])),r}getTileBounds(e,t,r,i=!1){const{flipY:s,pixelOverlap:o,projection:a}=this,{tilePixelWidth:l,tilePixelHeight:c,pixelWidth:u,pixelHeight:h}=this.getLevel(r);let d=l*e-o,f=c*t-o,p=d+l+o*2,m=f+c+o*2;if(d=Math.max(d,0),f=Math.max(f,0),p=Math.min(p,u),m=Math.min(m,h),d=d/u,p=p/u,f=f/h,m=m/h,s){const _=(m-f)/2,v=1-(f+m)/2;f=v-_,m=v+_}const g=[d,f,p,m];return a&&!i&&(g[0]=a.convertProjectionToLongitude(g[0]),g[1]=a.convertProjectionToLatitude(g[1]),g[2]=a.convertProjectionToLongitude(g[2]),g[3]=a.convertProjectionToLatitude(g[3])),g}toNormalizedPoint(e,t){const{projection:r}=this,i=[e,t];return this.projection&&(i[0]=r.convertLongitudeToProjection(i[0]),i[1]=r.convertLatitudeToProjection(i[1])),i}toNormalizedRange(e){return[...this.toNormalizedPoint(e[0],e[1]),...this.toNormalizedPoint(e[2],e[3])]}clampToBounds(e,t=!1){const r=[...e],{projection:i}=this;if(t||!i)r[0]=ft(r[0],0,1),r[1]=ft(r[1],0,1),r[2]=ft(r[2],0,1),r[3]=ft(r[3],0,1);else{const[s,o,a,l]=i.getBounds();r[0]=ft(r[0],s,a),r[1]=ft(r[1],o,l),r[2]=ft(r[2],s,a),r[3]=ft(r[3],o,l)}return r}}class vx extends gx{constructor(){super(),this.tiling=new _x,this.fetchOptions={},this.fetchData=(...e)=>fetch(...e)}init(e){}async processBufferToTexture(e){const t=new Blob([e]),r=await createImageBitmap(t,{premultiplyAlpha:"none",colorSpaceConversion:"none",imageOrientation:"flipY"}),i=new ji(r);return i.generateMipmaps=!1,i.colorSpace=Br,i.needsUpdate=!0,i}getMemoryUsage(e){const{TextureUtils:t}=V;if(!t)return 0;const{format:r,type:i,image:s,generateMipmaps:o}=e,{width:a,height:l}=s,c=t.getByteLength(a,l,r,i);return o?c*4/3:c}fetchItem(...e){const t=this.getUrl(...e);return this.fetchData(t,this.fetchOptions).then(r=>r.arrayBuffer()).then(r=>this.processBufferToTexture(r))}disposeItem(e){e.dispose(),e.image instanceof ImageBitmap&&e.image.close()}getUrl(...e){}}class yx extends vx{constructor(e={}){super();const{levels:t=20,tileDimension:r=256}=e;this.tileDimension=r,this.levels=t,this.url=null}getUrl(e,t,r){return this.url.replace("{z}",r).replace("{x}",e).replace("{y}",t)}init(e){const{tiling:t,tileDimension:r,levels:i}=this;return t.flipY=!0,t.setProjection(new mx("EPSG:3857")),t.generateLevels(i,1,1,{tilePixelWidth:r,tilePixelHeight:r}),this.url=e,Promise.resolve()}}class bx extends fx{constructor(e={}){const{levels:t=20,tileDimension:r=256,pixelSize:i=1e-5,...s}=e;super({pixelSize:i,...s}),this.name="XYZ_TILES_PLUGIN",this.imageSource=new yx({levels:t,tileDimension:r})}}const Pa=new H;class wx{constructor(){this.name="UPDATE_ON_CHANGE_PLUGIN",this.tiles=null,this.needsUpdate=!1,this.cameraMatrices=new Map}init(e){this.tiles=e,this._needsUpdateCallback=()=>{this.needsUpdate=!0},this._onCameraAdd=({camera:t})=>{this.needsUpdate=!0,this.cameraMatrices.set(t,new H)},this._onCameraDelete=({camera:t})=>{this.needsUpdate=!0,this.cameraMatrices.delete(t)},e.addEventListener("needs-update",this._needsUpdateCallback),e.addEventListener("add-camera",this._onCameraAdd),e.addEventListener("delete-camera",this._onCameraDelete),e.addEventListener("camera-resolution-change",this._needsUpdateCallback),e.cameras.forEach(t=>{this._onCameraAdd({camera:t})})}doTilesNeedUpdate(){const e=this.tiles;let t=!1;this.cameraMatrices.forEach((i,s)=>{Pa.copy(e.group.matrixWorld).premultiply(s.matrixWorldInverse).premultiply(s.projectionMatrixInverse),t=t||!Pa.equals(i),i.copy(Pa)});const r=this.needsUpdate;return this.needsUpdate=!1,r||t}preprocessNode(){this.needsUpdate=!0}dispose(){const e=this.tiles;e.removeEventListener("camera-resolution-change",this._needsUpdateCallback),e.removeEventListener("load-content",this._needsUpdateCallback),e.removeEventListener("camera-add",this._onCameraAdd),e.removeEventListener("camera-delete",this._onCameraDelete)}}const{clamp:Ma}=j;class Tx{constructor(){this.duration=250,this.fadeCount=0,this._lastTick=-1,this._fadeState=new Map,this.onFadeComplete=null,this.onFadeStart=null,this.onFadeSetComplete=null,this.onFadeSetStart=null}deleteObject(e){e&&this.completeFade(e)}guaranteeState(e){const t=this._fadeState;if(t.has(e))return!1;const r={fadeInTarget:0,fadeOutTarget:0,fadeIn:0,fadeOut:0};return t.set(e,r),!0}completeFade(e){const t=this._fadeState;if(!t.has(e))return;const r=t.get(e).fadeOutTarget===0;t.delete(e),this.fadeCount--,this.onFadeComplete&&this.onFadeComplete(e,r),this.fadeCount===0&&this.onFadeSetComplete&&this.onFadeSetComplete()}completeAllFades(){this._fadeState.forEach((e,t)=>{this.completeFade(t)})}forEachObject(e){this._fadeState.forEach((t,r)=>{e(r,t)})}fadeIn(e){const t=this.guaranteeState(e),r=this._fadeState.get(e);r.fadeInTarget=1,r.fadeOutTarget=0,r.fadeOut=0,t&&(this.fadeCount++,this.fadeCount===1&&this.onFadeSetStart&&this.onFadeSetStart(),this.onFadeStart&&this.onFadeStart(e))}fadeOut(e){const t=this.guaranteeState(e),r=this._fadeState.get(e);r.fadeOutTarget=1,t&&(r.fadeInTarget=1,r.fadeIn=1,this.fadeCount++,this.fadeCount===1&&this.onFadeSetStart&&this.onFadeSetStart(),this.onFadeStart&&this.onFadeStart(e))}isFading(e){return this._fadeState.has(e)}isFadingOut(e){const t=this._fadeState.get(e);return t&&t.fadeOutTarget===1}update(){const e=window.performance.now();this._lastTick===-1&&(this._lastTick=e);const t=Ma((e-this._lastTick)/this.duration,0,1);this._lastTick=e,this._fadeState.forEach((r,i)=>{const{fadeOutTarget:s,fadeInTarget:o}=r;let{fadeOut:a,fadeIn:l}=r;const c=Math.sign(o-l);l=Ma(l+c*t,0,1);const u=Math.sign(s-a);a=Ma(a+u*t,0,1),r.fadeIn=l,r.fadeOut=a,((a===1||a===0)&&(l===1||l===0)||a>=l)&&this.completeFade(i)})}}const Sa=Symbol("FADE_PARAMS");function _m(n,e){if(n[Sa])return n[Sa];const t={fadeIn:{value:0},fadeOut:{value:0},fadeTexture:{value:null}};return n[Sa]=t,n.defines={...n.defines||{},FEATURE_FADE:0},n.onBeforeCompile=r=>{e&&e(r),r.uniforms={...r.uniforms,...t},r.vertexShader=r.vertexShader.replace(/void\s+main\(\)\s+{/,i=>`
					#ifdef USE_BATCHING_FRAG

					varying float vBatchId;

					#endif

					${i}

						#ifdef USE_BATCHING_FRAG

						// add 0.5 to the value to avoid floating error that may cause flickering
						vBatchId = getIndirectIndex( gl_DrawID ) + 0.5;

						#endif
				`),r.fragmentShader=r.fragmentShader.replace(/void main\(/,i=>`
				#if FEATURE_FADE

				// adapted from https://www.shadertoy.com/view/Mlt3z8
				float bayerDither2x2( vec2 v ) {

					return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );

				}

				float bayerDither4x4( vec2 v ) {

					vec2 P1 = mod( v, 2.0 );
					vec2 P2 = floor( 0.5 * mod( v, 4.0 ) );
					return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );

				}

				// the USE_BATCHING define is not available in fragment shaders
				#ifdef USE_BATCHING_FRAG

				// functions for reading the fade state of a given batch id
				uniform sampler2D fadeTexture;
				varying float vBatchId;
				vec2 getFadeValues( const in float i ) {

					int size = textureSize( fadeTexture, 0 ).x;
					int j = int( i );
					int x = j % size;
					int y = j / size;
					return texelFetch( fadeTexture, ivec2( x, y ), 0 ).rg;

				}

				#else

				uniform float fadeIn;
				uniform float fadeOut;

				#endif

				#endif

				${i}
			`).replace(/#include <dithering_fragment>/,i=>`

				${i}

				#if FEATURE_FADE

				#ifdef USE_BATCHING_FRAG

				vec2 fadeValues = getFadeValues( vBatchId );
				float fadeIn = fadeValues.r;
				float fadeOut = fadeValues.g;

				#endif

				float bayerValue = bayerDither4x4( floor( mod( gl_FragCoord.xy, 4.0 ) ) );
				float bayerBins = 16.0;
				float dither = ( 0.5 + bayerValue ) / bayerBins;
				if ( dither >= fadeIn ) {

					discard;

				}

				if ( dither < fadeOut ) {

					discard;

				}

				#endif

			`)},t}class xx{constructor(){this._fadeParams=new WeakMap,this.fading=0}setFade(e,t,r){if(!e)return;const i=this._fadeParams;e.traverse(s=>{const o=s.material;if(o){const a=i.get(o);a.fadeIn.value=t,a.fadeOut.value=r;const l=+(!(t===0||t===1)||!(r===0||r===1));o.defines.FEATURE_FADE!==l&&(this.fading+=l===1?1:-1,o.defines.FEATURE_FADE=l,o.needsUpdate=!0)}})}prepareScene(e){e.traverse(t=>{t.material&&this.prepareMaterial(t.material)})}deleteScene(e){if(!e)return;this.setFade(e,1,0);const t=this._fadeParams;e.traverse(r=>{const i=r.material;i&&t.delete(i)})}prepareMaterial(e){const t=this._fadeParams;t.has(e)||t.set(e,_m(e,e.onBeforeCompile))}}class Ex{constructor(e,t=new $e){this.other=e,this.material=t,this.visible=!0,this.parent=null,this._instanceInfo=[],this._visibilityChanged=!0;const r=new Proxy(this,{get(i,s){if(s in i)return i[s];{const o=e[s];return o instanceof Function?(...a)=>(i.syncInstances(),o.call(r,...a)):e[s]}},set(i,s,o){return s in i?i[s]=o:e[s]=o,!0},deleteProperty(i,s){return s in i?delete i[s]:delete e[s]}});return r}syncInstances(){const e=this._instanceInfo,t=this.other._instanceInfo;for(;t.length>e.length;){const r=e.length;e.push(new Proxy({visible:!1},{get(i,s){return s in i?i[s]:t[r][s]},set(i,s,o){return s in i?i[s]=o:t[r][s]=o,!0}}))}}}class Ax extends Ex{constructor(...e){super(...e);const t=this.material,r=_m(t,t.onBeforeCompile);t.defines.FEATURE_FADE=1,t.defines.USE_BATCHING_FRAG=1,t.needsUpdate=!0,this.fadeTexture=null,this._fadeParams=r}setFadeAt(e,t,r){this._initFadeTexture(),this.fadeTexture.setValueAt(e,t*255,r*255)}_initFadeTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=e*e*2,r=this.fadeTexture;if(!r||r.image.data.length!==t){const i=new Uint8Array(t),s=new Px(i,e,e,Bb,zb);if(r){r.dispose();const o=r.image.data,a=this.fadeTexture.image.data,l=Math.min(o.length,a.length);a.set(new o.constructor(o.buffer,0,l))}this.fadeTexture=s,this._fadeParams.fadeTexture.value=s,s.needsUpdate=!0}}dispose(){this.fadeTexture&&this.fadeTexture.dispose()}}class Px extends Vb{setValueAt(e,...t){const{data:r,width:i,height:s}=this.image,o=Math.floor(r.length/(i*s));let a=!1;for(let l=0;l<o;l++){const c=e*o+l,u=r[c],h=t[l]||0;u!==h&&(r[c]=h,a=!0)}a&&(this.needsUpdate=!0)}}const md=Symbol("HAS_POPPED_IN"),gd=new P,_d=new P,vd=new Fe,yd=new Fe,bd=new P;function Mx(){const n=this._fadeManager,e=this.tiles;this._fadingBefore=n.fadeCount,this._displayActiveTiles=e.displayActiveTiles,e.displayActiveTiles=!0}function Sx(){const n=this._fadeManager,e=this._fadeMaterialManager,t=this._displayActiveTiles,r=this._fadingBefore,i=this._prevCameraTransforms,{tiles:s,maximumFadeOutTiles:o,batchedMesh:a}=this,{cameras:l}=s;s.displayActiveTiles=t,n.update();const c=n.fadeCount;if(r!==0&&c!==0&&(s.dispatchEvent({type:"fade-change"}),s.dispatchEvent({type:"needs-render"})),t||s.visibleTiles.forEach(u=>{const h=u.cached.scene;h&&(h.visible=u.__inFrustum),this.forEachBatchIds(u,(d,f,p)=>{f.setVisibleAt(d,u.__inFrustum),p.batchedMesh.setVisibleAt(d,u.__inFrustum)})}),o<this._fadingOutCount){let u=!0;l.forEach(h=>{if(!i.has(h))return;const d=h.matrixWorld,f=i.get(h);d.decompose(_d,yd,bd),f.decompose(gd,vd,bd);const p=yd.angleTo(vd),m=_d.distanceTo(gd);u=u&&(p>.25||m>.1)}),u&&n.completeAllFades()}if(l.forEach(u=>{i.get(u).copy(u.matrixWorld)}),n.forEachObject((u,{fadeIn:h,fadeOut:d})=>{const f=u.cached.scene,p=n.isFadingOut(u);s.markTileUsed(u),f&&(e.setFade(f,h,d),p&&(f.visible=!0)),this.forEachBatchIds(u,(m,g,_)=>{g.setFadeAt(m,h,d),g.setVisibleAt(m,!0),_.batchedMesh.setVisibleAt(m,!1)})}),a){const u=s.getPluginByName("BATCHED_TILES_PLUGIN").batchedMesh.material;a.material.map=u.map}}class Cx{get fadeDuration(){return this._fadeManager.duration}set fadeDuration(e){this._fadeManager.duration=Number(e)}get fadingTiles(){return this._fadeManager.fadeCount}constructor(e){e={maximumFadeOutTiles:50,fadeRootTiles:!1,fadeDuration:250,...e},this.name="FADE_TILES_PLUGIN",this.priority=-2,this.tiles=null,this.batchedMesh=null,this._fadeManager=new Tx,this._fadeMaterialManager=new xx,this._prevCameraTransforms=null,this._fadingOutCount=0,this.maximumFadeOutTiles=e.maximumFadeOutTiles,this.fadeRootTiles=e.fadeRootTiles,this.fadeDuration=e.fadeDuration}init(e){this._onLoadModel=({scene:i})=>{this._fadeMaterialManager.prepareScene(i)},this._onDisposeModel=({tile:i,scene:s})=>{this._fadeManager.deleteObject(i),this._fadeMaterialManager.deleteScene(s)},this._onAddCamera=({camera:i})=>{this._prevCameraTransforms.set(i,new H)},this._onDeleteCamera=({camera:i})=>{this._prevCameraTransforms.delete(i)},this._onTileVisibilityChange=({tile:i,visible:s})=>{const o=i.cached.scene;o&&(o.visible=!0),this.forEachBatchIds(i,(a,l,c)=>{l.setFadeAt(a,0,0),l.setVisibleAt(a,!1),c.batchedMesh.setVisibleAt(a,!1)})},this._onUpdateBefore=()=>{Mx.call(this)},this._onUpdateAfter=()=>{Sx.call(this)},e.addEventListener("load-model",this._onLoadModel),e.addEventListener("dispose-model",this._onDisposeModel),e.addEventListener("add-camera",this._onAddCamera),e.addEventListener("delete-camera",this._onDeleteCamera),e.addEventListener("update-before",this._onUpdateBefore),e.addEventListener("update-after",this._onUpdateAfter),e.addEventListener("tile-visibility-change",this._onTileVisibilityChange);const t=this._fadeManager;t.onFadeSetStart=()=>{e.dispatchEvent({type:"fade-start"}),e.dispatchEvent({type:"needs-render"})},t.onFadeSetComplete=()=>{e.dispatchEvent({type:"fade-end"}),e.dispatchEvent({type:"needs-render"})},t.onFadeComplete=(i,s)=>{this._fadeMaterialManager.setFade(i.cached.scene,0,0),this.forEachBatchIds(i,(o,a,l)=>{a.setFadeAt(o,0,0),a.setVisibleAt(o,!1),l.batchedMesh.setVisibleAt(o,s)}),s||(e.invokeOnePlugin(o=>o!==this&&o.setTileVisible&&o.setTileVisible(i,!1)),this._fadingOutCount--)};const r=new Map;e.cameras.forEach(i=>{r.set(i,new H)}),e.forEachLoadedModel((i,s)=>{this._onLoadModel({scene:i})}),this.tiles=e,this._fadeManager=t,this._prevCameraTransforms=r}initBatchedMesh(){const e=this.tiles.getPluginByName("BATCHED_TILES_PLUGIN")?.batchedMesh;if(e){if(this.batchedMesh===null){this._onBatchedMeshDispose=()=>{this.batchedMesh.dispose(),this.batchedMesh.removeFromParent(),this.batchedMesh=null,e.removeEventListener("dispose",this._onBatchedMeshDispose)};const t=e.material.clone();t.onBeforeCompile=e.material.onBeforeCompile,this.batchedMesh=new Ax(e,t),this.tiles.group.add(this.batchedMesh)}}else this.batchedMesh!==null&&(this._onBatchedMeshDispose(),this._onBatchedMeshDispose=null)}setTileVisible(e,t){const r=this._fadeManager,i=r.isFading(e);if(r.isFadingOut(e)&&this._fadingOutCount--,t?e.__depthFromRenderedParent===1?((e[md]||this.fadeRootTiles)&&this._fadeManager.fadeIn(e),e[md]=!0):this._fadeManager.fadeIn(e):(this._fadingOutCount++,r.fadeOut(e)),i)return!0;const s=this._fadeManager.isFading(e);return!!(!t&&s)}dispose(){const e=this.tiles;this._fadeManager.completeAllFades(),this.batchedMesh!==null&&this._onBatchedMeshDispose(),e.removeEventListener("load-model",this._onLoadModel),e.removeEventListener("dispose-model",this._onDisposeModel),e.removeEventListener("add-camera",this._onAddCamera),e.removeEventListener("delete-camera",this._onDeleteCamera),e.removeEventListener("update-before",this._onUpdateBefore),e.removeEventListener("update-after",this._onUpdateAfter),e.removeEventListener("tile-visibility-change",this._onTileVisibilityChange),e.forEachLoadedModel((t,r)=>{this._fadeManager.deleteObject(r),t&&(t.visible=!0)})}forEachBatchIds(e,t){if(this.initBatchedMesh(),this.batchedMesh){const r=this.tiles.getPluginByName("BATCHED_TILES_PLUGIN"),i=r.getTileBatchIds(e);i&&i.forEach(s=>{t(s,this.batchedMesh,r)})}}}const Pt=new P,wd=["x","y","z"];class Rx extends Po{constructor(e,t=16776960,r=40){const i=new xt,s=[];for(let o=0;o<3;o++){const a=wd[o],l=wd[(o+1)%3];Pt.set(0,0,0);for(let c=0;c<r;c++){let u;u=2*Math.PI*c/(r-1),Pt[a]=Math.sin(u),Pt[l]=Math.cos(u),s.push(Pt.x,Pt.y,Pt.z),u=2*Math.PI*(c+1)/(r-1),Pt[a]=Math.sin(u),Pt[l]=Math.cos(u),s.push(Pt.x,Pt.y,Pt.z)}}i.setAttribute("position",new Ce(new Float32Array(s),3)),i.computeBoundingSphere(),super(i,new _c({color:t,toneMapped:!1})),this.sphere=e,this.type="SphereHelper"}updateMatrixWorld(e){const t=this.sphere;this.position.copy(t.center),this.scale.setScalar(t.radius),super.updateMatrixWorld(e)}}const Ca=new P,Ls=new P,Lt=new P;new P;new P;function Ox(n,{computeNormals:e=!1}={}){const{latStart:t=-Math.PI/2,latEnd:r=Math.PI/2,lonStart:i=0,lonEnd:s=2*Math.PI,heightStart:o=0,heightEnd:a=0}=n,l=new $f(1,1,1,32,32),{normal:c,position:u}=l.attributes,h=u.clone();for(let d=0,f=u.count;d<f;d++){Lt.fromBufferAttribute(u,d);const p=j.mapLinear(Lt.x,-.5,.5,t,r),m=j.mapLinear(Lt.y,-.5,.5,i,s);let g=o;n.getCartographicToNormal(p,m,Ca),Lt.z<0&&(g=a),n.getCartographicToPosition(p,m,g,Lt),u.setXYZ(d,...Lt)}e&&l.computeVertexNormals();for(let d=0,f=h.count;d<f;d++){Lt.fromBufferAttribute(h,d);const p=j.mapLinear(Lt.x,-.5,.5,t,r),m=j.mapLinear(Lt.y,-.5,.5,i,s);Ca.fromBufferAttribute(c,d),n.getCartographicToNormal(p,m,Ls),Math.abs(Ca.dot(Ls))>.1&&(Lt.z>0&&Ls.multiplyScalar(-1),c.setXYZ(d,...Ls))}return l}class kx extends Po{constructor(e=new mm,t=16776960){super(),this.ellipsoidRegion=e,this.material.color.set(t),this.update()}update(){const e=Ox(this.ellipsoidRegion);this.geometry.dispose(),this.geometry=new $b(e,80)}dispose(){this.geometry.dispose(),this.material.dispose()}}const Td=Symbol("ORIGINAL_MATERIAL"),Ra=Symbol("HAS_RANDOM_COLOR"),Oa=Symbol("HAS_RANDOM_NODE_COLOR"),ka=Symbol("LOAD_TIME"),Un=Symbol("PARENT_BOUND_REF_COUNT"),xd=new sr,La=()=>{},Ia={};function Da(n){if(!Ia[n]){const e=Math.random(),t=.5+Math.random()*.5,r=.375+Math.random()*.25;Ia[n]=new ke().setHSL(e,t,r)}return Ia[n]}const wi=0,vm=1,ym=2,bm=3,wm=4,Tm=5,xm=6,zs=7,Vs=8,Em=9,Cl=10,Lx=Object.freeze({NONE:wi,SCREEN_ERROR:vm,GEOMETRIC_ERROR:ym,DISTANCE:bm,DEPTH:wm,RELATIVE_DEPTH:Tm,IS_LEAF:xm,RANDOM_COLOR:zs,RANDOM_NODE_COLOR:Vs,CUSTOM_COLOR:Em,LOAD_ORDER:Cl});class Ix{static get ColorModes(){return Lx}get unlit(){return this._unlit}set unlit(e){e!==this._unlit&&(this._unlit=e,this.materialsNeedUpdate=!0)}get colorMode(){return this._colorMode}set colorMode(e){e!==this._colorMode&&(this._colorMode=e,this.materialsNeedUpdate=!0)}constructor(e){e={displayParentBounds:!1,displayBoxBounds:!1,displaySphereBounds:!1,displayRegionBounds:!1,colorMode:wi,maxDebugDepth:-1,maxDebugDistance:-1,maxDebugError:-1,customColorCallback:null,unlit:!1,enabled:!0,...e},this.name="DEBUG_TILES_PLUGIN",this.tiles=null,this._colorMode=null,this._unlit=null,this.materialsNeedUpdate=!1,this.extremeDebugDepth=-1,this.extremeDebugError=-1,this.boxGroup=null,this.sphereGroup=null,this.regionGroup=null,this._enabled=e.enabled,this._displayParentBounds=e.displayParentBounds,this.displayBoxBounds=e.displayBoxBounds,this.displaySphereBounds=e.displaySphereBounds,this.displayRegionBounds=e.displayRegionBounds,this.colorMode=e.colorMode,this.maxDebugDepth=e.maxDebugDepth,this.maxDebugDistance=e.maxDebugDistance,this.maxDebugError=e.maxDebugError,this.customColorCallback=e.customColorCallback,this.unlit=e.unlit,this.getDebugColor=(t,r)=>{r.setRGB(t,t,t)}}get enabled(){return this._enabled}set enabled(e){e!==this._enabled&&this.tiles!==null&&(e?this.init(this.tiles):this.dispose()),this._enabled=e}get displayParentBounds(){return this._displayParentBounds}set displayParentBounds(e){this._displayParentBounds!==e&&(this._displayParentBounds=e,e?this.tiles.traverse(t=>{t.__visible&&this._onTileVisibilityChange(t,!0)}):El(this.tiles.root,null,t=>{t[Un]=null,this._onTileVisibilityChange(t,t.__visible)}))}init(e){if(this.tiles=e,!this.enabled)return;const t=e.group;this.boxGroup=new Ae,this.boxGroup.name="DebugTilesRenderer.boxGroup",t.add(this.boxGroup),this.boxGroup.updateMatrixWorld(),this.sphereGroup=new Ae,this.sphereGroup.name="DebugTilesRenderer.sphereGroup",t.add(this.sphereGroup),this.sphereGroup.updateMatrixWorld(),this.regionGroup=new Ae,this.regionGroup.name="DebugTilesRenderer.regionGroup",t.add(this.regionGroup),this.regionGroup.updateMatrixWorld(),this._onLoadTileSetCB=()=>{this._initExtremes()},this._onLoadModelCB=({scene:r,tile:i})=>{this._onLoadModel(r,i)},this._onDisposeModelCB=({tile:r})=>{this._onDisposeModel(r)},this._onUpdateAfterCB=()=>{this._onUpdateAfter()},this._onTileVisibilityChangeCB=({scene:r,tile:i,visible:s})=>{this._onTileVisibilityChange(i,s)},e.addEventListener("load-tile-set",this._onLoadTileSetCB),e.addEventListener("load-model",this._onLoadModelCB),e.addEventListener("dispose-model",this._onDisposeModelCB),e.addEventListener("update-after",this._onUpdateAfterCB),e.addEventListener("tile-visibility-change",this._onTileVisibilityChangeCB),this._initExtremes(),e.traverse(r=>{r.cached.scene&&this._onLoadModel(r.cached.scene,r)}),e.visibleTiles.forEach(r=>{this._onTileVisibilityChange(r,!0)})}getTileInformationFromActiveObject(e){let t=null;return this.tiles.activeTiles.forEach(r=>{if(t)return!0;const i=r.cached.scene;i&&i.traverse(s=>{s===e&&(t=r)})}),t?{distanceToCamera:t.__distanceFromCamera,geometricError:t.geometricError,screenSpaceError:t.__error,depth:t.__depth,isLeaf:t.__isLeaf}:null}_initExtremes(){if(!(this.tiles&&this.tiles.root))return;let e=-1,t=-1;El(this.tiles.root,null,(r,i,s)=>{e=Math.max(e,s),t=Math.max(t,r.geometricError)}),this.extremeDebugDepth=e,this.extremeDebugError=t}_onUpdateAfter(){const{tiles:e,colorMode:t}=this;if(!e.root)return;this.materialsNeedUpdate&&(e.forEachLoadedModel(c=>{this._updateMaterial(c)}),this.materialsNeedUpdate=!1),this.boxGroup.visible=this.displayBoxBounds,this.sphereGroup.visible=this.displaySphereBounds,this.regionGroup.visible=this.displayRegionBounds;let r=-1;this.maxDebugDepth===-1?r=this.extremeDebugDepth:r=this.maxDebugDepth;let i=-1;this.maxDebugError===-1?i=this.extremeDebugError:i=this.maxDebugError;let s=-1;this.maxDebugDistance===-1?(e.getBoundingSphere(xd),s=xd.radius):s=this.maxDebugDistance;const{errorTarget:o,visibleTiles:a}=e;let l;t===Cl&&(l=Array.from(a).sort((c,u)=>c[ka]-u[ka])),a.forEach(c=>{const u=c.cached.scene;let h,d,f;t===zs&&(h=Math.random(),d=.5+Math.random()*.5,f=.375+Math.random()*.25),u.traverse(p=>{if(t===Vs&&(h=Math.random(),d=.5+Math.random()*.5,f=.375+Math.random()*.25),p.material)switch(t!==zs&&delete p.material[Ra],t!==Vs&&delete p.material[Oa],t){case wm:{const m=c.__depth/r;this.getDebugColor(m,p.material.color);break}case Tm:{const m=c.__depthFromRenderedParent/r;this.getDebugColor(m,p.material.color);break}case vm:{const m=c.__error/o;m>1?p.material.color.setRGB(1,0,0):this.getDebugColor(m,p.material.color);break}case ym:{const m=Math.min(c.geometricError/i,1);this.getDebugColor(m,p.material.color);break}case bm:{const m=Math.min(c.__distanceFromCamera/s,1);this.getDebugColor(m,p.material.color);break}case xm:{!c.children||c.children.length===0?this.getDebugColor(1,p.material.color):this.getDebugColor(0,p.material.color);break}case Vs:{p.material[Oa]||(p.material.color.setHSL(h,d,f),p.material[Oa]=!0);break}case zs:{p.material[Ra]||(p.material.color.setHSL(h,d,f),p.material[Ra]=!0);break}case Em:{this.customColorCallback?this.customColorCallback(c,p):console.warn("DebugTilesRenderer: customColorCallback not defined");break}case Cl:{const m=l.indexOf(c);this.getDebugColor(m/(l.length-1),p.material.color);break}}})})}_onTileVisibilityChange(e,t){this.displayParentBounds?Kw(e,r=>{r[Un]==null&&(r[Un]=0),t?r[Un]++:r[Un]>0&&r[Un]--;const i=r===e&&t||this.displayParentBounds&&r[Un]>0;this._updateBoundHelper(r,i)}):this._updateBoundHelper(e,t)}_createBoundHelper(e){const t=this.tiles,r=e.cached,{sphere:i,obb:s,region:o}=r.boundingVolume;if(s){const a=new Ae;a.name="DebugTilesRenderer.boxHelperGroup",a.matrix.copy(s.transform),a.matrixAutoUpdate=!1;const l=new Hb(s.box,Da(e.__depth));l.raycast=La,a.add(l),r.boxHelperGroup=a,t.visibleTiles.has(e)&&this.displayBoxBounds&&(this.boxGroup.add(a),a.updateMatrixWorld(!0))}if(i){const a=new Rx(i,Da(e.__depth));a.raycast=La,r.sphereHelper=a,t.visibleTiles.has(e)&&this.displaySphereBounds&&(this.sphereGroup.add(a),a.updateMatrixWorld(!0))}if(o){const a=new kx(o,Da(e.__depth));a.raycast=La;const l=new sr;o.getBoundingSphere(l),a.position.copy(l.center),l.center.multiplyScalar(-1),a.geometry.translate(...l.center),r.regionHelper=a,t.visibleTiles.has(e)&&this.displayRegionBounds&&(this.regionGroup.add(a),a.updateMatrixWorld(!0))}}_updateHelperMaterial(e,t){e.__visible||!this.displayParentBounds?t.opacity=1:t.opacity=.2;const r=t.transparent;t.transparent=t.opacity<1,t.transparent!==r&&(t.needsUpdate=!0)}_updateBoundHelper(e,t){const r=e.cached;if(!r)return;const i=this.sphereGroup,s=this.boxGroup,o=this.regionGroup;t&&r.boxHelperGroup==null&&r.sphereHelper==null&&r.regionHelper==null&&this._createBoundHelper(e);const a=r.boxHelperGroup,l=r.sphereHelper,c=r.regionHelper;t?(a&&(s.add(a),a.updateMatrixWorld(!0),this._updateHelperMaterial(e,a.children[0].material)),l&&(i.add(l),l.updateMatrixWorld(!0),this._updateHelperMaterial(e,l.material)),c&&(o.add(c),c.updateMatrixWorld(!0),this._updateHelperMaterial(e,c.material))):(a&&s.remove(a),l&&i.remove(l),c&&o.remove(c))}_updateMaterial(e){const{colorMode:t,unlit:r}=this;e.traverse(i=>{if(!i.material)return;const s=i.material,o=i[Td];if(s!==o&&s.dispose(),t!==wi||r){if(i.isPoints){const a=new ni;a.size=o.size,a.sizeAttenuation=o.sizeAttenuation,i.material=a}else r?i.material=new $e:(i.material=new es,i.material.flatShading=!0);t===wi&&(i.material.map=o.map,i.material.color.set(o.color))}else i.material=o})}_onLoadModel(e,t){t[ka]=performance.now(),e.traverse(r=>{const i=r.material;i&&(r[Td]=i)}),this._updateMaterial(e)}_onDisposeModel(e){const t=e.cached;t.boxHelperGroup&&(t.boxHelperGroup.children[0].geometry.dispose(),delete t.boxHelperGroup),t.sphereHelper&&(t.sphereHelper.geometry.dispose(),delete t.sphereHelper),t.regionHelper&&(t.regionHelper.geometry.dispose(),delete t.regionHelper)}dispose(){if(!this.enabled)return;const e=this.tiles;e.removeEventListener("load-tile-set",this._onLoadTileSetCB),e.removeEventListener("load-model",this._onLoadModelCB),e.removeEventListener("dispose-model",this._onDisposeModelCB),e.removeEventListener("update-after",this._onUpdateAfterCB),e.removeEventListener("tile-visibility-change",this._onTileVisibilityChangeCB),this.colorMode=wi,this.unlit=!1,e.forEachLoadedModel(t=>{this._updateMaterial(t)}),e.traverse(t=>{this._onDisposeModel(t)}),this.boxGroup?.removeFromParent(),this.sphereGroup?.removeFromParent(),this.regionGroup?.removeFromParent()}}const Dx=["object"],Nx=ue({__name:"XYZTiles",props:{url:{},lruCacheMinSize:{default:900},lruCacheMaxSize:{default:1300},parseQueueMaxJobs:{default:10},errorTarget:{default:10},displayActiveTiles:{type:Boolean,default:!0},autoDisableRendererCulling:{type:Boolean,default:!0},tilesPlugins:{default:()=>({fadePlugin:{maximumFadeOutTiles:200},xyzPlugin:{center:!0,shape:"ellipsoid"}})}},setup(n){const{camera:e,renderer:t}=Qr(),r=n;let i=wl(new Ml(r.url));function s(){i&&i.dispose(),i=wl(new Ml(r.url)),i.registerPlugin(new Cx(r.tilesPlugins.fadePlugin)),i.registerPlugin(new wx),i.registerPlugin(new bx(r.tilesPlugins.xyzPlugin)),i.lruCache.minSize=r.lruCacheMinSize,i.lruCache.maxSize=r.lruCacheMaxSize,i.parseQueue.maxJobs=r.parseQueueMaxJobs,i.setCamera(e.value),i.setResolutionFromRenderer(e.value,t),i.errorTarget=r.errorTarget,i.displayActiveTiles=r.displayActiveTiles,i.autoDisableRendererCulling=r.autoDisableRendererCulling}s(),U(()=>r.url,(a,l)=>{a!==l&&s()}),U(()=>r,()=>{s()},{deep:!0});const{onBeforeRender:o}=Yi();return o(()=>{i&&(i.setResolutionFromRenderer(e.value,t),i.update())}),tt(()=>{i&&i.dispose()}),(a,l)=>C(i)?(re(),Ee("primitive",{key:0,object:C(i).group},null,8,Dx)):at("",!0)}}),Fx=ue({__name:"TDTTiles",props:{url:{default:"https://t0.tianditu.gov.cn"},service:{default:"WMTS"},request:{default:"GetTile"},version:{default:"1.0.0"},layer:{default:"vec"},tileStyle:{default:"default"},tileMatrixSet:{default:"w"},format:{default:"tiles"},tk:{default:"您的密钥"}},setup(n){const e=n,t=gc(()=>`${e.url}/${e.layer}_${e.tileMatrixSet}/${e.service.toLowerCase()}?SERVICE=${e.service.toUpperCase()}&REQUEST=${e.request}&VERSION=${e.version}&LAYER=${e.layer}&STYLE=${e.tileStyle}&TILEMATRIXSET=${e.tileMatrixSet}&FORMAT=${e.format}&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=${e.tk}`);return(r,i)=>(re(),Ft(Nx,{url:t.value},null,8,["url"]))}}),Ux=(n,e)=>{n.addEventListener("tile-visibility-change",({tile:t,visible:r})=>{const i=t.cached.scene;r&&e(i,t)})},jx=(n,e)=>{n.addEventListener("tile-visibility-change",({tile:t,visible:r})=>{const i=t.cached.scene,s=n.group;r||(i&&(s.add(i),i.updateMatrixWorld(!0)),e(i,t).then(()=>{i&&s.remove(i)}))})};function Qt(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Am(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}/*!
 * GSAP 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var ct={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Gr={duration:.5,overwrite:!1,delay:0},Ic,Oe,ae,yt=1e8,se=1/yt,Rl=Math.PI*2,Bx=Rl/4,zx=0,Pm=Math.sqrt,Vx=Math.cos,$x=Math.sin,Pe=function(n){return typeof n=="string"},de=function(n){return typeof n=="function"},an=function(n){return typeof n=="number"},Dc=function(n){return typeof n>"u"},zt=function(n){return typeof n=="object"},Ye=function(n){return n!==!1},Nc=function(){return typeof window<"u"},Is=function(n){return de(n)||Pe(n)},Mm=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},De=Array.isArray,Ol=/(?:-?\.?\d|\.)+/gi,Sm=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,wr=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Na=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,Cm=/[+-]=-?[.\d]+/,Rm=/[^,'"\[\]\s]+/gi,Hx=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,le,Dt,kl,Fc,ut={},lo={},Om,km=function(n){return(lo=Wr(n,ut))&&et},Uc=function(n,e){return console.warn("Invalid property",n,"set to",e,"Missing plugin? gsap.registerPlugin()")},zi=function(n,e){return!e&&console.warn(n)},Lm=function(n,e){return n&&(ut[n]=e)&&lo&&(lo[n]=e)||ut},Vi=function(){return 0},Gx={suppressEvents:!0,isStart:!0,kill:!1},$s={suppressEvents:!0,kill:!1},Wx={suppressEvents:!0},jc={},An=[],Ll={},Im,st={},Fa={},Ed=30,Hs=[],Bc="",zc=function(n){var e=n[0],t,r;if(zt(e)||de(e)||(n=[n]),!(t=(e._gsap||{}).harness)){for(r=Hs.length;r--&&!Hs[r].targetTest(e););t=Hs[r]}for(r=n.length;r--;)n[r]&&(n[r]._gsap||(n[r]._gsap=new ig(n[r],t)))||n.splice(r,1);return n},Zn=function(n){return n._gsap||zc(bt(n))[0]._gsap},Dm=function(n,e,t){return(t=n[e])&&de(t)?n[e]():Dc(t)&&n.getAttribute&&n.getAttribute(e)||t},Ze=function(n,e){return(n=n.split(",")).forEach(e)||n},pe=function(n){return Math.round(n*1e5)/1e5||0},_e=function(n){return Math.round(n*1e7)/1e7||0},Sr=function(n,e){var t=e.charAt(0),r=parseFloat(e.substr(2));return n=parseFloat(n),t==="+"?n+r:t==="-"?n-r:t==="*"?n*r:n/r},Kx=function(n,e){for(var t=e.length,r=0;n.indexOf(e[r])<0&&++r<t;);return r<t},co=function(){var n=An.length,e=An.slice(0),t,r;for(Ll={},An.length=0,t=0;t<n;t++)r=e[t],r&&r._lazy&&(r.render(r._lazy[0],r._lazy[1],!0)._lazy=0)},Vc=function(n){return!!(n._initted||n._startAt||n.add)},Nm=function(n,e,t,r){An.length&&!Oe&&co(),n.render(e,t,!!(Oe&&e<0&&Vc(n))),An.length&&!Oe&&co()},Fm=function(n){var e=parseFloat(n);return(e||e===0)&&(n+"").match(Rm).length<2?e:Pe(n)?n.trim():n},Um=function(n){return n},ht=function(n,e){for(var t in e)t in n||(n[t]=e[t]);return n},qx=function(n){return function(e,t){for(var r in t)r in e||r==="duration"&&n||r==="ease"||(e[r]=t[r])}},Wr=function(n,e){for(var t in e)n[t]=e[t];return n},Ad=function n(e,t){for(var r in t)r!=="__proto__"&&r!=="constructor"&&r!=="prototype"&&(e[r]=zt(t[r])?n(e[r]||(e[r]={}),t[r]):t[r]);return e},uo=function(n,e){var t={},r;for(r in n)r in e||(t[r]=n[r]);return t},Mi=function(n){var e=n.parent||le,t=n.keyframes?qx(De(n.keyframes)):ht;if(Ye(n.inherit))for(;e;)t(n,e.vars.defaults),e=e.parent||e._dp;return n},Xx=function(n,e){for(var t=n.length,r=t===e.length;r&&t--&&n[t]===e[t];);return t<0},jm=function(n,e,t,r,i){var s=n[r],o;if(i)for(o=e[i];s&&s[i]>o;)s=s._prev;return s?(e._next=s._next,s._next=e):(e._next=n[t],n[t]=e),e._next?e._next._prev=e:n[r]=e,e._prev=s,e.parent=e._dp=n,e},ko=function(n,e,t,r){t===void 0&&(t="_first"),r===void 0&&(r="_last");var i=e._prev,s=e._next;i?i._next=s:n[t]===e&&(n[t]=s),s?s._prev=i:n[r]===e&&(n[r]=i),e._next=e._prev=e.parent=null},Rn=function(n,e){n.parent&&(!e||n.parent.autoRemoveChildren)&&n.parent.remove&&n.parent.remove(n),n._act=0},Qn=function(n,e){if(n&&(!e||e._end>n._dur||e._start<0))for(var t=n;t;)t._dirty=1,t=t.parent;return n},Yx=function(n){for(var e=n.parent;e&&e.parent;)e._dirty=1,e.totalDuration(),e=e.parent;return n},Il=function(n,e,t,r){return n._startAt&&(Oe?n._startAt.revert($s):n.vars.immediateRender&&!n.vars.autoRevert||n._startAt.render(e,!0,r))},Zx=function n(e){return!e||e._ts&&n(e.parent)},Pd=function(n){return n._repeat?Kr(n._tTime,n=n.duration()+n._rDelay)*n:0},Kr=function(n,e){var t=Math.floor(n=_e(n/e));return n&&t===n?t-1:t},ho=function(n,e){return(n-e._start)*e._ts+(e._ts>=0?0:e._dirty?e.totalDuration():e._tDur)},Lo=function(n){return n._end=_e(n._start+(n._tDur/Math.abs(n._ts||n._rts||se)||0))},Io=function(n,e){var t=n._dp;return t&&t.smoothChildTiming&&n._ts&&(n._start=_e(t._time-(n._ts>0?e/n._ts:((n._dirty?n.totalDuration():n._tDur)-e)/-n._ts)),Lo(n),t._dirty||Qn(t,n)),n},Bm=function(n,e){var t;if((e._time||!e._dur&&e._initted||e._start<n._time&&(e._dur||!e.add))&&(t=ho(n.rawTime(),e),(!e._dur||is(0,e.totalDuration(),t)-e._tTime>se)&&e.render(t,!0)),Qn(n,e)._dp&&n._initted&&n._time>=n._dur&&n._ts){if(n._dur<n.duration())for(t=n;t._dp;)t.rawTime()>=0&&t.totalTime(t._tTime),t=t._dp;n._zTime=-se}},Ut=function(n,e,t,r){return e.parent&&Rn(e),e._start=_e((an(t)?t:t||n!==le?mt(n,t,e):n._time)+e._delay),e._end=_e(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),jm(n,e,"_first","_last",n._sort?"_start":0),Dl(e)||(n._recent=e),r||Bm(n,e),n._ts<0&&Io(n,n._tTime),n},zm=function(n,e){return(ut.ScrollTrigger||Uc("scrollTrigger",e))&&ut.ScrollTrigger.create(e,n)},Vm=function(n,e,t,r,i){if(Hc(n,e,i),!n._initted)return 1;if(!t&&n._pt&&!Oe&&(n._dur&&n.vars.lazy!==!1||!n._dur&&n.vars.lazy)&&Im!==ot.frame)return An.push(n),n._lazy=[i,r],1},Qx=function n(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||n(t))},Dl=function(n){var e=n.data;return e==="isFromStart"||e==="isStart"},Jx=function(n,e,t,r){var i=n.ratio,s=e<0||!e&&(!n._start&&Qx(n)&&!(!n._initted&&Dl(n))||(n._ts<0||n._dp._ts<0)&&!Dl(n))?0:1,o=n._rDelay,a=0,l,c,u;if(o&&n._repeat&&(a=is(0,n._tDur,e),c=Kr(a,o),n._yoyo&&c&1&&(s=1-s),c!==Kr(n._tTime,o)&&(i=1-s,n.vars.repeatRefresh&&n._initted&&n.invalidate())),s!==i||Oe||r||n._zTime===se||!e&&n._zTime){if(!n._initted&&Vm(n,e,r,t,a))return;for(u=n._zTime,n._zTime=e||(t?se:0),t||(t=e&&!u),n.ratio=s,n._from&&(s=1-s),n._time=0,n._tTime=a,l=n._pt;l;)l.r(s,l.d),l=l._next;e<0&&Il(n,e,t,!0),n._onUpdate&&!t&&lt(n,"onUpdate"),a&&n._repeat&&!t&&n.parent&&lt(n,"onRepeat"),(e>=n._tDur||e<0)&&n.ratio===s&&(s&&Rn(n,1),!t&&!Oe&&(lt(n,s?"onComplete":"onReverseComplete",!0),n._prom&&n._prom()))}else n._zTime||(n._zTime=e)},eE=function(n,e,t){var r;if(t>e)for(r=n._first;r&&r._start<=t;){if(r.data==="isPause"&&r._start>e)return r;r=r._next}else for(r=n._last;r&&r._start>=t;){if(r.data==="isPause"&&r._start<e)return r;r=r._prev}},qr=function(n,e,t,r){var i=n._repeat,s=_e(e)||0,o=n._tTime/n._tDur;return o&&!r&&(n._time*=s/n._dur),n._dur=s,n._tDur=i?i<0?1e10:_e(s*(i+1)+n._rDelay*i):s,o>0&&!r&&Io(n,n._tTime=n._tDur*o),n.parent&&Lo(n),t||Qn(n.parent,n),n},Md=function(n){return n instanceof ze?Qn(n):qr(n,n._dur)},tE={_start:0,endTime:Vi,totalDuration:Vi},mt=function n(e,t,r){var i=e.labels,s=e._recent||tE,o=e.duration()>=yt?s.endTime(!1):e._dur,a,l,c;return Pe(t)&&(isNaN(t)||t in i)?(l=t.charAt(0),c=t.substr(-1)==="%",a=t.indexOf("="),l==="<"||l===">"?(a>=0&&(t=t.replace(/=/,"")),(l==="<"?s._start:s.endTime(s._repeat>=0))+(parseFloat(t.substr(1))||0)*(c?(a<0?s:r).totalDuration()/100:1)):a<0?(t in i||(i[t]=o),i[t]):(l=parseFloat(t.charAt(a-1)+t.substr(a+1)),c&&r&&(l=l/100*(De(r)?r[0]:r).totalDuration()),a>1?n(e,t.substr(0,a-1),r)+l:o+l)):t==null?o:+t},Si=function(n,e,t){var r=an(e[1]),i=(r?2:1)+(n<2?0:1),s=e[i],o,a;if(r&&(s.duration=e[1]),s.parent=t,n){for(o=s,a=t;a&&!("immediateRender"in o);)o=a.vars.defaults||{},a=Ye(a.vars.inherit)&&a.parent;s.immediateRender=Ye(o.immediateRender),n<2?s.runBackwards=1:s.startAt=e[i-1]}return new ge(e[0],s,e[i+1])},Ln=function(n,e){return n||n===0?e(n):e},is=function(n,e,t){return t<n?n:t>e?e:t},Ie=function(n,e){return!Pe(n)||!(e=Hx.exec(n))?"":e[1]},nE=function(n,e,t){return Ln(t,function(r){return is(n,e,r)})},Nl=[].slice,$m=function(n,e){return n&&zt(n)&&"length"in n&&(!e&&!n.length||n.length-1 in n&&zt(n[0]))&&!n.nodeType&&n!==Dt},rE=function(n,e,t){return t===void 0&&(t=[]),n.forEach(function(r){var i;return Pe(r)&&!e||$m(r,1)?(i=t).push.apply(i,bt(r)):t.push(r)})||t},bt=function(n,e,t){return ae&&!e&&ae.selector?ae.selector(n):Pe(n)&&!t&&(kl||!Xr())?Nl.call((e||Fc).querySelectorAll(n),0):De(n)?rE(n,t):$m(n)?Nl.call(n,0):n?[n]:[]},Fl=function(n){return n=bt(n)[0]||zi("Invalid scope")||{},function(e){var t=n.current||n.nativeElement||n;return bt(e,t.querySelectorAll?t:t===n?zi("Invalid scope")||Fc.createElement("div"):n)}},Hm=function(n){return n.sort(function(){return .5-Math.random()})},Gm=function(n){if(de(n))return n;var e=zt(n)?n:{each:n},t=Jn(e.ease),r=e.from||0,i=parseFloat(e.base)||0,s={},o=r>0&&r<1,a=isNaN(r)||o,l=e.axis,c=r,u=r;return Pe(r)?c=u={center:.5,edges:.5,end:1}[r]||0:!o&&a&&(c=r[0],u=r[1]),function(h,d,f){var p=(f||e).length,m=s[p],g,_,v,y,T,A,w,x,b;if(!m){if(b=e.grid==="auto"?0:(e.grid||[1,yt])[1],!b){for(w=-yt;w<(w=f[b++].getBoundingClientRect().left)&&b<p;);b<p&&b--}for(m=s[p]=[],g=a?Math.min(b,p)*c-.5:r%b,_=b===yt?0:a?p*u/b-.5:r/b|0,w=0,x=yt,A=0;A<p;A++)v=A%b-g,y=_-(A/b|0),m[A]=T=l?Math.abs(l==="y"?y:v):Pm(v*v+y*y),T>w&&(w=T),T<x&&(x=T);r==="random"&&Hm(m),m.max=w-x,m.min=x,m.v=p=(parseFloat(e.amount)||parseFloat(e.each)*(b>p?p-1:l?l==="y"?p/b:b:Math.max(b,p/b))||0)*(r==="edges"?-1:1),m.b=p<0?i-p:i,m.u=Ie(e.amount||e.each)||0,t=t&&p<0?tg(t):t}return p=(m[h]-m.min)/m.max||0,_e(m.b+(t?t(p):p)*m.v)+m.u}},Ul=function(n){var e=Math.pow(10,((n+"").split(".")[1]||"").length);return function(t){var r=_e(Math.round(parseFloat(t)/n)*n*e);return(r-r%1)/e+(an(t)?0:Ie(t))}},Wm=function(n,e){var t=De(n),r,i;return!t&&zt(n)&&(r=t=n.radius||yt,n.values?(n=bt(n.values),(i=!an(n[0]))&&(r*=r)):n=Ul(n.increment)),Ln(e,t?de(n)?function(s){return i=n(s),Math.abs(i-s)<=r?i:s}:function(s){for(var o=parseFloat(i?s.x:s),a=parseFloat(i?s.y:0),l=yt,c=0,u=n.length,h,d;u--;)i?(h=n[u].x-o,d=n[u].y-a,h=h*h+d*d):h=Math.abs(n[u]-o),h<l&&(l=h,c=u);return c=!r||l<=r?n[c]:s,i||c===s||an(s)?c:c+Ie(s)}:Ul(n))},Km=function(n,e,t,r){return Ln(De(n)?!e:t===!0?!!(t=0):!r,function(){return De(n)?n[~~(Math.random()*n.length)]:(t=t||1e-5)&&(r=t<1?Math.pow(10,(t+"").length-2):1)&&Math.floor(Math.round((n-t/2+Math.random()*(e-n+t*.99))/t)*t*r)/r})},iE=function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return function(r){return e.reduce(function(i,s){return s(i)},r)}},sE=function(n,e){return function(t){return n(parseFloat(t))+(e||Ie(t))}},oE=function(n,e,t){return Xm(n,e,0,1,t)},qm=function(n,e,t){return Ln(t,function(r){return n[~~e(r)]})},aE=function n(e,t,r){var i=t-e;return De(e)?qm(e,n(0,e.length),t):Ln(r,function(s){return(i+(s-e)%i)%i+e})},lE=function n(e,t,r){var i=t-e,s=i*2;return De(e)?qm(e,n(0,e.length-1),t):Ln(r,function(o){return o=(s+(o-e)%s)%s||0,e+(o>i?s-o:o)})},$i=function(n){for(var e=0,t="",r,i,s,o;~(r=n.indexOf("random(",e));)s=n.indexOf(")",r),o=n.charAt(r+7)==="[",i=n.substr(r+7,s-r-7).match(o?Rm:Ol),t+=n.substr(e,r-e)+Km(o?i:+i[0],o?0:+i[1],+i[2]||1e-5),e=s+1;return t+n.substr(e,n.length-e)},Xm=function(n,e,t,r,i){var s=e-n,o=r-t;return Ln(i,function(a){return t+((a-n)/s*o||0)})},cE=function n(e,t,r,i){var s=isNaN(e+t)?0:function(f){return(1-f)*e+f*t};if(!s){var o=Pe(e),a={},l,c,u,h,d;if(r===!0&&(i=1)&&(r=null),o)e={p:e},t={p:t};else if(De(e)&&!De(t)){for(u=[],h=e.length,d=h-2,c=1;c<h;c++)u.push(n(e[c-1],e[c]));h--,s=function(f){f*=h;var p=Math.min(d,~~f);return u[p](f-p)},r=t}else i||(e=Wr(De(e)?[]:{},e));if(!u){for(l in t)$c.call(a,e,l,"get",t[l]);s=function(f){return Kc(f,a)||(o?e.p:e)}}}return Ln(r,s)},Sd=function(n,e,t){var r=n.labels,i=yt,s,o,a;for(s in r)o=r[s]-e,o<0==!!t&&o&&i>(o=Math.abs(o))&&(a=s,i=o);return a},lt=function(n,e,t){var r=n.vars,i=r[e],s=ae,o=n._ctx,a,l,c;if(i)return a=r[e+"Params"],l=r.callbackScope||n,t&&An.length&&co(),o&&(ae=o),c=a?i.apply(l,a):i.call(l),ae=s,c},Ti=function(n){return Rn(n),n.scrollTrigger&&n.scrollTrigger.kill(!!Oe),n.progress()<1&&lt(n,"onInterrupt"),n},Tr,Ym=[],Zm=function(n){if(n)if(n=!n.name&&n.default||n,Nc()||n.headless){var e=n.name,t=de(n),r=e&&!t&&n.init?function(){this._props=[]}:n,i={init:Vi,render:Kc,add:$c,kill:AE,modifier:EE,rawVars:0},s={targetTest:0,get:0,getSetter:Wc,aliases:{},register:0};if(Xr(),n!==r){if(st[e])return;ht(r,ht(uo(n,i),s)),Wr(r.prototype,Wr(i,uo(n,s))),st[r.prop=e]=r,n.targetTest&&(Hs.push(r),jc[e]=1),e=(e==="css"?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}Lm(e,r),n.register&&n.register(et,r,Qe)}else Ym.push(n)},ie=255,xi={aqua:[0,ie,ie],lime:[0,ie,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,ie],navy:[0,0,128],white:[ie,ie,ie],olive:[128,128,0],yellow:[ie,ie,0],orange:[ie,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[ie,0,0],pink:[ie,192,203],cyan:[0,ie,ie],transparent:[ie,ie,ie,0]},Ua=function(n,e,t){return n+=n<0?1:n>1?-1:0,(n*6<1?e+(t-e)*n*6:n<.5?t:n*3<2?e+(t-e)*(2/3-n)*6:e)*ie+.5|0},Qm=function(n,e,t){var r=n?an(n)?[n>>16,n>>8&ie,n&ie]:0:xi.black,i,s,o,a,l,c,u,h,d,f;if(!r){if(n.substr(-1)===","&&(n=n.substr(0,n.length-1)),xi[n])r=xi[n];else if(n.charAt(0)==="#"){if(n.length<6&&(i=n.charAt(1),s=n.charAt(2),o=n.charAt(3),n="#"+i+i+s+s+o+o+(n.length===5?n.charAt(4)+n.charAt(4):"")),n.length===9)return r=parseInt(n.substr(1,6),16),[r>>16,r>>8&ie,r&ie,parseInt(n.substr(7),16)/255];n=parseInt(n.substr(1),16),r=[n>>16,n>>8&ie,n&ie]}else if(n.substr(0,3)==="hsl"){if(r=f=n.match(Ol),!e)a=+r[0]%360/360,l=+r[1]/100,c=+r[2]/100,s=c<=.5?c*(l+1):c+l-c*l,i=c*2-s,r.length>3&&(r[3]*=1),r[0]=Ua(a+1/3,i,s),r[1]=Ua(a,i,s),r[2]=Ua(a-1/3,i,s);else if(~n.indexOf("="))return r=n.match(Sm),t&&r.length<4&&(r[3]=1),r}else r=n.match(Ol)||xi.transparent;r=r.map(Number)}return e&&!f&&(i=r[0]/ie,s=r[1]/ie,o=r[2]/ie,u=Math.max(i,s,o),h=Math.min(i,s,o),c=(u+h)/2,u===h?a=l=0:(d=u-h,l=c>.5?d/(2-u-h):d/(u+h),a=u===i?(s-o)/d+(s<o?6:0):u===s?(o-i)/d+2:(i-s)/d+4,a*=60),r[0]=~~(a+.5),r[1]=~~(l*100+.5),r[2]=~~(c*100+.5)),t&&r.length<4&&(r[3]=1),r},Jm=function(n){var e=[],t=[],r=-1;return n.split(Pn).forEach(function(i){var s=i.match(wr)||[];e.push.apply(e,s),t.push(r+=s.length+1)}),e.c=t,e},Cd=function(n,e,t){var r="",i=(n+r).match(Pn),s=e?"hsla(":"rgba(",o=0,a,l,c,u;if(!i)return n;if(i=i.map(function(h){return(h=Qm(h,e,1))&&s+(e?h[0]+","+h[1]+"%,"+h[2]+"%,"+h[3]:h.join(","))+")"}),t&&(c=Jm(n),a=t.c,a.join(r)!==c.c.join(r)))for(l=n.replace(Pn,"1").split(wr),u=l.length-1;o<u;o++)r+=l[o]+(~a.indexOf(o)?i.shift()||s+"0,0,0,0)":(c.length?c:i.length?i:t).shift());if(!l)for(l=n.split(Pn),u=l.length-1;o<u;o++)r+=l[o]+i[o];return r+l[u]},Pn=function(){var n="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in xi)n+="|"+e+"\\b";return new RegExp(n+")","gi")}(),uE=/hsl[a]?\(/,eg=function(n){var e=n.join(" "),t;if(Pn.lastIndex=0,Pn.test(e))return t=uE.test(e),n[1]=Cd(n[1],t),n[0]=Cd(n[0],t,Jm(n[1])),!0},Hi,ot=function(){var n=Date.now,e=500,t=33,r=n(),i=r,s=1e3/240,o=s,a=[],l,c,u,h,d,f,p=function m(g){var _=n()-i,v=g===!0,y,T,A,w;if((_>e||_<0)&&(r+=_-t),i+=_,A=i-r,y=A-o,(y>0||v)&&(w=++h.frame,d=A-h.time*1e3,h.time=A=A/1e3,o+=y+(y>=s?4:s-y),T=1),v||(l=c(m)),T)for(f=0;f<a.length;f++)a[f](A,d,w,g)};return h={time:0,frame:0,tick:function(){p(!0)},deltaRatio:function(m){return d/(1e3/(m||60))},wake:function(){Om&&(!kl&&Nc()&&(Dt=kl=window,Fc=Dt.document||{},ut.gsap=et,(Dt.gsapVersions||(Dt.gsapVersions=[])).push(et.version),km(lo||Dt.GreenSockGlobals||!Dt.gsap&&Dt||{}),Ym.forEach(Zm)),u=typeof requestAnimationFrame<"u"&&requestAnimationFrame,l&&h.sleep(),c=u||function(m){return setTimeout(m,o-h.time*1e3+1|0)},Hi=1,p(2))},sleep:function(){(u?cancelAnimationFrame:clearTimeout)(l),Hi=0,c=Vi},lagSmoothing:function(m,g){e=m||1/0,t=Math.min(g||33,e)},fps:function(m){s=1e3/(m||240),o=h.time*1e3+s},add:function(m,g,_){var v=g?function(y,T,A,w){m(y,T,A,w),h.remove(v)}:m;return h.remove(m),a[_?"unshift":"push"](v),Xr(),v},remove:function(m,g){~(g=a.indexOf(m))&&a.splice(g,1)&&f>=g&&f--},_listeners:a},h}(),Xr=function(){return!Hi&&ot.wake()},Q={},hE=/^[\d.\-M][\d.\-,\s]/,dE=/["']/g,pE=function(n){for(var e={},t=n.substr(1,n.length-3).split(":"),r=t[0],i=1,s=t.length,o,a,l;i<s;i++)a=t[i],o=i!==s-1?a.lastIndexOf(","):a.length,l=a.substr(0,o),e[r]=isNaN(l)?l.replace(dE,"").trim():+l,r=a.substr(o+1).trim();return e},fE=function(n){var e=n.indexOf("(")+1,t=n.indexOf(")"),r=n.indexOf("(",e);return n.substring(e,~r&&r<t?n.indexOf(")",t+1):t)},mE=function(n){var e=(n+"").split("("),t=Q[e[0]];return t&&e.length>1&&t.config?t.config.apply(null,~n.indexOf("{")?[pE(e[1])]:fE(n).split(",").map(Fm)):Q._CE&&hE.test(n)?Q._CE("",n):t},tg=function(n){return function(e){return 1-n(1-e)}},ng=function n(e,t){for(var r=e._first,i;r;)r instanceof ze?n(r,t):r.vars.yoyoEase&&(!r._yoyo||!r._repeat)&&r._yoyo!==t&&(r.timeline?n(r.timeline,t):(i=r._ease,r._ease=r._yEase,r._yEase=i,r._yoyo=t)),r=r._next},Jn=function(n,e){return n&&(de(n)?n:Q[n]||mE(n))||e},or=function(n,e,t,r){t===void 0&&(t=function(o){return 1-e(1-o)}),r===void 0&&(r=function(o){return o<.5?e(o*2)/2:1-e((1-o)*2)/2});var i={easeIn:e,easeOut:t,easeInOut:r},s;return Ze(n,function(o){Q[o]=ut[o]=i,Q[s=o.toLowerCase()]=t;for(var a in i)Q[s+(a==="easeIn"?".in":a==="easeOut"?".out":".inOut")]=Q[o+"."+a]=i[a]}),i},rg=function(n){return function(e){return e<.5?(1-n(1-e*2))/2:.5+n((e-.5)*2)/2}},ja=function n(e,t,r){var i=t>=1?t:1,s=(r||(e?.3:.45))/(t<1?t:1),o=s/Rl*(Math.asin(1/i)||0),a=function(c){return c===1?1:i*Math.pow(2,-10*c)*$x((c-o)*s)+1},l=e==="out"?a:e==="in"?function(c){return 1-a(1-c)}:rg(a);return s=Rl/s,l.config=function(c,u){return n(e,c,u)},l},Ba=function n(e,t){t===void 0&&(t=1.70158);var r=function(s){return s?--s*s*((t+1)*s+t)+1:0},i=e==="out"?r:e==="in"?function(s){return 1-r(1-s)}:rg(r);return i.config=function(s){return n(e,s)},i};Ze("Linear,Quad,Cubic,Quart,Quint,Strong",function(n,e){var t=e<5?e+1:e;or(n+",Power"+(t-1),e?function(r){return Math.pow(r,t)}:function(r){return r},function(r){return 1-Math.pow(1-r,t)},function(r){return r<.5?Math.pow(r*2,t)/2:1-Math.pow((1-r)*2,t)/2})});Q.Linear.easeNone=Q.none=Q.Linear.easeIn;or("Elastic",ja("in"),ja("out"),ja());(function(n,e){var t=1/e,r=2*t,i=2.5*t,s=function(o){return o<t?n*o*o:o<r?n*Math.pow(o-1.5/e,2)+.75:o<i?n*(o-=2.25/e)*o+.9375:n*Math.pow(o-2.625/e,2)+.984375};or("Bounce",function(o){return 1-s(1-o)},s)})(7.5625,2.75);or("Expo",function(n){return Math.pow(2,10*(n-1))*n+n*n*n*n*n*n*(1-n)});or("Circ",function(n){return-(Pm(1-n*n)-1)});or("Sine",function(n){return n===1?1:-Vx(n*Bx)+1});or("Back",Ba("in"),Ba("out"),Ba());Q.SteppedEase=Q.steps=ut.SteppedEase={config:function(n,e){n===void 0&&(n=1);var t=1/n,r=n+(e?0:1),i=e?1:0,s=1-se;return function(o){return((r*is(0,s,o)|0)+i)*t}}};Gr.ease=Q["quad.out"];Ze("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(n){return Bc+=n+","+n+"Params,"});var ig=function(n,e){this.id=zx++,n._gsap=this,this.target=n,this.harness=e,this.get=e?e.get:Dm,this.set=e?e.getSetter:Wc},Gi=function(){function n(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,qr(this,+t.duration,1,1),this.data=t.data,ae&&(this._ctx=ae,ae.data.push(this)),Hi||ot.wake()}var e=n.prototype;return e.delay=function(t){return t||t===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+t-this._delay),this._delay=t,this):this._delay},e.duration=function(t){return arguments.length?this.totalDuration(this._repeat>0?t+(t+this._rDelay)*this._repeat:t):this.totalDuration()&&this._dur},e.totalDuration=function(t){return arguments.length?(this._dirty=0,qr(this,this._repeat<0?t:(t-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(t,r){if(Xr(),!arguments.length)return this._tTime;var i=this._dp;if(i&&i.smoothChildTiming&&this._ts){for(Io(this,t),!i._dp||i.parent||Bm(i,this);i&&i.parent;)i.parent._time!==i._start+(i._ts>=0?i._tTime/i._ts:(i.totalDuration()-i._tTime)/-i._ts)&&i.totalTime(i._tTime,!0),i=i.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&t<this._tDur||this._ts<0&&t>0||!this._tDur&&!t)&&Ut(this._dp,this,this._start-this._delay)}return(this._tTime!==t||!this._dur&&!r||this._initted&&Math.abs(this._zTime)===se||!t&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=t),Nm(this,t,r)),this},e.time=function(t,r){return arguments.length?this.totalTime(Math.min(this.totalDuration(),t+Pd(this))%(this._dur+this._rDelay)||(t?this._dur:0),r):this._time},e.totalProgress=function(t,r){return arguments.length?this.totalTime(this.totalDuration()*t,r):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},e.progress=function(t,r){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-t:t)+Pd(this),r):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(t,r){var i=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(t-1)*i,r):this._repeat?Kr(this._tTime,i)+1:1},e.timeScale=function(t,r){if(!arguments.length)return this._rts===-se?0:this._rts;if(this._rts===t)return this;var i=this.parent&&this._ts?ho(this.parent._time,this):this._tTime;return this._rts=+t||0,this._ts=this._ps||t===-se?0:this._rts,this.totalTime(is(-Math.abs(this._delay),this.totalDuration(),i),r!==!1),Lo(this),Yx(this)},e.paused=function(t){return arguments.length?(this._ps!==t&&(this._ps=t,t?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Xr(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==se&&(this._tTime-=se)))),this):this._ps},e.startTime=function(t){if(arguments.length){this._start=t;var r=this.parent||this._dp;return r&&(r._sort||!this.parent)&&Ut(r,this,t-this._delay),this}return this._start},e.endTime=function(t){return this._start+(Ye(t)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(t){var r=this.parent||this._dp;return r?t&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?ho(r.rawTime(t),this):this._tTime:this._tTime},e.revert=function(t){t===void 0&&(t=Wx);var r=Oe;return Oe=t,Vc(this)&&(this.timeline&&this.timeline.revert(t),this.totalTime(-.01,t.suppressEvents)),this.data!=="nested"&&t.kill!==!1&&this.kill(),Oe=r,this},e.globalTime=function(t){for(var r=this,i=arguments.length?t:r.rawTime();r;)i=r._start+i/(Math.abs(r._ts)||1),r=r._dp;return!this.parent&&this._sat?this._sat.globalTime(t):i},e.repeat=function(t){return arguments.length?(this._repeat=t===1/0?-2:t,Md(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(t){if(arguments.length){var r=this._time;return this._rDelay=t,Md(this),r?this.time(r):this}return this._rDelay},e.yoyo=function(t){return arguments.length?(this._yoyo=t,this):this._yoyo},e.seek=function(t,r){return this.totalTime(mt(this,t),Ye(r))},e.restart=function(t,r){return this.play().totalTime(t?-this._delay:0,Ye(r)),this._dur||(this._zTime=-se),this},e.play=function(t,r){return t!=null&&this.seek(t,r),this.reversed(!1).paused(!1)},e.reverse=function(t,r){return t!=null&&this.seek(t||this.totalDuration(),r),this.reversed(!0).paused(!1)},e.pause=function(t,r){return t!=null&&this.seek(t,r),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(t){return arguments.length?(!!t!==this.reversed()&&this.timeScale(-this._rts||(t?-se:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-se,this},e.isActive=function(){var t=this.parent||this._dp,r=this._start,i;return!!(!t||this._ts&&this._initted&&t.isActive()&&(i=t.rawTime(!0))>=r&&i<this.endTime(!0)-se)},e.eventCallback=function(t,r,i){var s=this.vars;return arguments.length>1?(r?(s[t]=r,i&&(s[t+"Params"]=i),t==="onUpdate"&&(this._onUpdate=r)):delete s[t],this):s[t]},e.then=function(t){var r=this;return new Promise(function(i){var s=de(t)?t:Um,o=function(){var a=r.then;r.then=null,de(s)&&(s=s(r))&&(s.then||s===r)&&(r.then=a),i(s),r.then=a};r._initted&&r.totalProgress()===1&&r._ts>=0||!r._tTime&&r._ts<0?o():r._prom=o})},e.kill=function(){Ti(this)},n}();ht(Gi.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-se,_prom:0,_ps:!1,_rts:1});var ze=function(n){Am(e,n);function e(r,i){var s;return r===void 0&&(r={}),s=n.call(this,r)||this,s.labels={},s.smoothChildTiming=!!r.smoothChildTiming,s.autoRemoveChildren=!!r.autoRemoveChildren,s._sort=Ye(r.sortChildren),le&&Ut(r.parent||le,Qt(s),i),r.reversed&&s.reverse(),r.paused&&s.paused(!0),r.scrollTrigger&&zm(Qt(s),r.scrollTrigger),s}var t=e.prototype;return t.to=function(r,i,s){return Si(0,arguments,this),this},t.from=function(r,i,s){return Si(1,arguments,this),this},t.fromTo=function(r,i,s,o){return Si(2,arguments,this),this},t.set=function(r,i,s){return i.duration=0,i.parent=this,Mi(i).repeatDelay||(i.repeat=0),i.immediateRender=!!i.immediateRender,new ge(r,i,mt(this,s),1),this},t.call=function(r,i,s){return Ut(this,ge.delayedCall(0,r,i),s)},t.staggerTo=function(r,i,s,o,a,l,c){return s.duration=i,s.stagger=s.stagger||o,s.onComplete=l,s.onCompleteParams=c,s.parent=this,new ge(r,s,mt(this,a)),this},t.staggerFrom=function(r,i,s,o,a,l,c){return s.runBackwards=1,Mi(s).immediateRender=Ye(s.immediateRender),this.staggerTo(r,i,s,o,a,l,c)},t.staggerFromTo=function(r,i,s,o,a,l,c,u){return o.startAt=s,Mi(o).immediateRender=Ye(o.immediateRender),this.staggerTo(r,i,o,a,l,c,u)},t.render=function(r,i,s){var o=this._time,a=this._dirty?this.totalDuration():this._tDur,l=this._dur,c=r<=0?0:_e(r),u=this._zTime<0!=r<0&&(this._initted||!l),h,d,f,p,m,g,_,v,y,T,A,w;if(this!==le&&c>a&&r>=0&&(c=a),c!==this._tTime||s||u){if(o!==this._time&&l&&(c+=this._time-o,r+=this._time-o),h=c,y=this._start,v=this._ts,g=!v,u&&(l||(o=this._zTime),(r||!i)&&(this._zTime=r)),this._repeat){if(A=this._yoyo,m=l+this._rDelay,this._repeat<-1&&r<0)return this.totalTime(m*100+r,i,s);if(h=_e(c%m),c===a?(p=this._repeat,h=l):(T=_e(c/m),p=~~T,p&&p===T&&(h=l,p--),h>l&&(h=l)),T=Kr(this._tTime,m),!o&&this._tTime&&T!==p&&this._tTime-T*m-this._dur<=0&&(T=p),A&&p&1&&(h=l-h,w=1),p!==T&&!this._lock){var x=A&&T&1,b=x===(A&&p&1);if(p<T&&(x=!x),o=x?0:c%l?l:c,this._lock=1,this.render(o||(w?0:_e(p*m)),i,!l)._lock=0,this._tTime=c,!i&&this.parent&&lt(this,"onRepeat"),this.vars.repeatRefresh&&!w&&(this.invalidate()._lock=1),o&&o!==this._time||g!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(l=this._dur,a=this._tDur,b&&(this._lock=2,o=x?l:-1e-4,this.render(o,!0),this.vars.repeatRefresh&&!w&&this.invalidate()),this._lock=0,!this._ts&&!g)return this;ng(this,w)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(_=eE(this,_e(o),_e(h)),_&&(c-=h-(h=_._start))),this._tTime=c,this._time=h,this._act=!v,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=r,o=0),!o&&c&&!i&&!T&&(lt(this,"onStart"),this._tTime!==c))return this;if(h>=o&&r>=0)for(d=this._first;d;){if(f=d._next,(d._act||h>=d._start)&&d._ts&&_!==d){if(d.parent!==this)return this.render(r,i,s);if(d.render(d._ts>0?(h-d._start)*d._ts:(d._dirty?d.totalDuration():d._tDur)+(h-d._start)*d._ts,i,s),h!==this._time||!this._ts&&!g){_=0,f&&(c+=this._zTime=-se);break}}d=f}else{d=this._last;for(var E=r<0?r:h;d;){if(f=d._prev,(d._act||E<=d._end)&&d._ts&&_!==d){if(d.parent!==this)return this.render(r,i,s);if(d.render(d._ts>0?(E-d._start)*d._ts:(d._dirty?d.totalDuration():d._tDur)+(E-d._start)*d._ts,i,s||Oe&&Vc(d)),h!==this._time||!this._ts&&!g){_=0,f&&(c+=this._zTime=E?-se:se);break}}d=f}}if(_&&!i&&(this.pause(),_.render(h>=o?0:-se)._zTime=h>=o?1:-1,this._ts))return this._start=y,Lo(this),this.render(r,i,s);this._onUpdate&&!i&&lt(this,"onUpdate",!0),(c===a&&this._tTime>=this.totalDuration()||!c&&o)&&(y===this._start||Math.abs(v)!==Math.abs(this._ts))&&(this._lock||((r||!l)&&(c===a&&this._ts>0||!c&&this._ts<0)&&Rn(this,1),!i&&!(r<0&&!o)&&(c||o||!a)&&(lt(this,c===a&&r>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(c<a&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(r,i){var s=this;if(an(i)||(i=mt(this,i,r)),!(r instanceof Gi)){if(De(r))return r.forEach(function(o){return s.add(o,i)}),this;if(Pe(r))return this.addLabel(r,i);if(de(r))r=ge.delayedCall(0,r);else return this}return this!==r?Ut(this,r,i):this},t.getChildren=function(r,i,s,o){r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=!0),o===void 0&&(o=-yt);for(var a=[],l=this._first;l;)l._start>=o&&(l instanceof ge?i&&a.push(l):(s&&a.push(l),r&&a.push.apply(a,l.getChildren(!0,i,s)))),l=l._next;return a},t.getById=function(r){for(var i=this.getChildren(1,1,1),s=i.length;s--;)if(i[s].vars.id===r)return i[s]},t.remove=function(r){return Pe(r)?this.removeLabel(r):de(r)?this.killTweensOf(r):(r.parent===this&&ko(this,r),r===this._recent&&(this._recent=this._last),Qn(this))},t.totalTime=function(r,i){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=_e(ot.time-(this._ts>0?r/this._ts:(this.totalDuration()-r)/-this._ts))),n.prototype.totalTime.call(this,r,i),this._forcing=0,this):this._tTime},t.addLabel=function(r,i){return this.labels[r]=mt(this,i),this},t.removeLabel=function(r){return delete this.labels[r],this},t.addPause=function(r,i,s){var o=ge.delayedCall(0,i||Vi,s);return o.data="isPause",this._hasPause=1,Ut(this,o,mt(this,r))},t.removePause=function(r){var i=this._first;for(r=mt(this,r);i;)i._start===r&&i.data==="isPause"&&Rn(i),i=i._next},t.killTweensOf=function(r,i,s){for(var o=this.getTweensOf(r,s),a=o.length;a--;)wn!==o[a]&&o[a].kill(r,i);return this},t.getTweensOf=function(r,i){for(var s=[],o=bt(r),a=this._first,l=an(i),c;a;)a instanceof ge?Kx(a._targets,o)&&(l?(!wn||a._initted&&a._ts)&&a.globalTime(0)<=i&&a.globalTime(a.totalDuration())>i:!i||a.isActive())&&s.push(a):(c=a.getTweensOf(o,i)).length&&s.push.apply(s,c),a=a._next;return s},t.tweenTo=function(r,i){i=i||{};var s=this,o=mt(s,r),a=i,l=a.startAt,c=a.onStart,u=a.onStartParams,h=a.immediateRender,d,f=ge.to(s,ht({ease:i.ease||"none",lazy:!1,immediateRender:!1,time:o,overwrite:"auto",duration:i.duration||Math.abs((o-(l&&"time"in l?l.time:s._time))/s.timeScale())||se,onStart:function(){if(s.pause(),!d){var p=i.duration||Math.abs((o-(l&&"time"in l?l.time:s._time))/s.timeScale());f._dur!==p&&qr(f,p,0,1).render(f._time,!0,!0),d=1}c&&c.apply(f,u||[])}},i));return h?f.render(0):f},t.tweenFromTo=function(r,i,s){return this.tweenTo(i,ht({startAt:{time:mt(this,r)}},s))},t.recent=function(){return this._recent},t.nextLabel=function(r){return r===void 0&&(r=this._time),Sd(this,mt(this,r))},t.previousLabel=function(r){return r===void 0&&(r=this._time),Sd(this,mt(this,r),1)},t.currentLabel=function(r){return arguments.length?this.seek(r,!0):this.previousLabel(this._time+se)},t.shiftChildren=function(r,i,s){s===void 0&&(s=0);for(var o=this._first,a=this.labels,l;o;)o._start>=s&&(o._start+=r,o._end+=r),o=o._next;if(i)for(l in a)a[l]>=s&&(a[l]+=r);return Qn(this)},t.invalidate=function(r){var i=this._first;for(this._lock=0;i;)i.invalidate(r),i=i._next;return n.prototype.invalidate.call(this,r)},t.clear=function(r){r===void 0&&(r=!0);for(var i=this._first,s;i;)s=i._next,this.remove(i),i=s;return this._dp&&(this._time=this._tTime=this._pTime=0),r&&(this.labels={}),Qn(this)},t.totalDuration=function(r){var i=0,s=this,o=s._last,a=yt,l,c,u;if(arguments.length)return s.timeScale((s._repeat<0?s.duration():s.totalDuration())/(s.reversed()?-r:r));if(s._dirty){for(u=s.parent;o;)l=o._prev,o._dirty&&o.totalDuration(),c=o._start,c>a&&s._sort&&o._ts&&!s._lock?(s._lock=1,Ut(s,o,c-o._delay,1)._lock=0):a=c,c<0&&o._ts&&(i-=c,(!u&&!s._dp||u&&u.smoothChildTiming)&&(s._start+=c/s._ts,s._time-=c,s._tTime-=c),s.shiftChildren(-c,!1,-1/0),a=0),o._end>i&&o._ts&&(i=o._end),o=l;qr(s,s===le&&s._time>i?s._time:i,1,1),s._dirty=0}return s._tDur},e.updateRoot=function(r){if(le._ts&&(Nm(le,ho(r,le)),Im=ot.frame),ot.frame>=Ed){Ed+=ct.autoSleep||120;var i=le._first;if((!i||!i._ts)&&ct.autoSleep&&ot._listeners.length<2){for(;i&&!i._ts;)i=i._next;i||ot.sleep()}}},e}(Gi);ht(ze.prototype,{_lock:0,_hasPause:0,_forcing:0});var gE=function(n,e,t,r,i,s,o){var a=new Qe(this._pt,n,e,0,1,ug,null,i),l=0,c=0,u,h,d,f,p,m,g,_;for(a.b=t,a.e=r,t+="",r+="",(g=~r.indexOf("random("))&&(r=$i(r)),s&&(_=[t,r],s(_,n,e),t=_[0],r=_[1]),h=t.match(Na)||[];u=Na.exec(r);)f=u[0],p=r.substring(l,u.index),d?d=(d+1)%5:p.substr(-5)==="rgba("&&(d=1),f!==h[c++]&&(m=parseFloat(h[c-1])||0,a._pt={_next:a._pt,p:p||c===1?p:",",s:m,c:f.charAt(1)==="="?Sr(m,f)-m:parseFloat(f)-m,m:d&&d<4?Math.round:0},l=Na.lastIndex);return a.c=l<r.length?r.substring(l,r.length):"",a.fp=o,(Cm.test(r)||g)&&(a.e=0),this._pt=a,a},$c=function(n,e,t,r,i,s,o,a,l,c){de(r)&&(r=r(i||0,n,s));var u=n[e],h=t!=="get"?t:de(u)?l?n[e.indexOf("set")||!de(n["get"+e.substr(3)])?e:"get"+e.substr(3)](l):n[e]():u,d=de(u)?l?wE:lg:Gc,f;if(Pe(r)&&(~r.indexOf("random(")&&(r=$i(r)),r.charAt(1)==="="&&(f=Sr(h,r)+(Ie(h)||0),(f||f===0)&&(r=f))),!c||h!==r||jl)return!isNaN(h*r)&&r!==""?(f=new Qe(this._pt,n,e,+h||0,r-(h||0),typeof u=="boolean"?xE:cg,0,d),l&&(f.fp=l),o&&f.modifier(o,this,n),this._pt=f):(!u&&!(e in n)&&Uc(e,r),gE.call(this,n,e,h,r,d,a||ct.stringFilter,l))},_E=function(n,e,t,r,i){if(de(n)&&(n=Ci(n,i,e,t,r)),!zt(n)||n.style&&n.nodeType||De(n)||Mm(n))return Pe(n)?Ci(n,i,e,t,r):n;var s={},o;for(o in n)s[o]=Ci(n[o],i,e,t,r);return s},sg=function(n,e,t,r,i,s){var o,a,l,c;if(st[n]&&(o=new st[n]).init(i,o.rawVars?e[n]:_E(e[n],r,i,s,t),t,r,s)!==!1&&(t._pt=a=new Qe(t._pt,i,n,0,1,o.render,o,0,o.priority),t!==Tr))for(l=t._ptLookup[t._targets.indexOf(i)],c=o._props.length;c--;)l[o._props[c]]=a;return o},wn,jl,Hc=function n(e,t,r){var i=e.vars,s=i.ease,o=i.startAt,a=i.immediateRender,l=i.lazy,c=i.onUpdate,u=i.runBackwards,h=i.yoyoEase,d=i.keyframes,f=i.autoRevert,p=e._dur,m=e._startAt,g=e._targets,_=e.parent,v=_&&_.data==="nested"?_.vars.targets:g,y=e._overwrite==="auto"&&!Ic,T=e.timeline,A,w,x,b,E,M,S,O,L,I,N,R,z;if(T&&(!d||!s)&&(s="none"),e._ease=Jn(s,Gr.ease),e._yEase=h?tg(Jn(h===!0?s:h,Gr.ease)):0,h&&e._yoyo&&!e._repeat&&(h=e._yEase,e._yEase=e._ease,e._ease=h),e._from=!T&&!!i.runBackwards,!T||d&&!i.stagger){if(O=g[0]?Zn(g[0]).harness:0,R=O&&i[O.prop],A=uo(i,jc),m&&(m._zTime<0&&m.progress(1),t<0&&u&&a&&!f?m.render(-1,!0):m.revert(u&&p?$s:Gx),m._lazy=0),o){if(Rn(e._startAt=ge.set(g,ht({data:"isStart",overwrite:!1,parent:_,immediateRender:!0,lazy:!m&&Ye(l),startAt:null,delay:0,onUpdate:c&&function(){return lt(e,"onUpdate")},stagger:0},o))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Oe||!a&&!f)&&e._startAt.revert($s),a&&p&&t<=0&&r<=0){t&&(e._zTime=t);return}}else if(u&&p&&!m){if(t&&(a=!1),x=ht({overwrite:!1,data:"isFromStart",lazy:a&&!m&&Ye(l),immediateRender:a,stagger:0,parent:_},A),R&&(x[O.prop]=R),Rn(e._startAt=ge.set(g,x)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Oe?e._startAt.revert($s):e._startAt.render(-1,!0)),e._zTime=t,!a)n(e._startAt,se,se);else if(!t)return}for(e._pt=e._ptCache=0,l=p&&Ye(l)||l&&!p,w=0;w<g.length;w++){if(E=g[w],S=E._gsap||zc(g)[w]._gsap,e._ptLookup[w]=I={},Ll[S.id]&&An.length&&co(),N=v===g?w:v.indexOf(E),O&&(L=new O).init(E,R||A,e,N,v)!==!1&&(e._pt=b=new Qe(e._pt,E,L.name,0,1,L.render,L,0,L.priority),L._props.forEach(function(F){I[F]=b}),L.priority&&(M=1)),!O||R)for(x in A)st[x]&&(L=sg(x,A,e,N,E,v))?L.priority&&(M=1):I[x]=b=$c.call(e,E,x,"get",A[x],N,v,0,i.stringFilter);e._op&&e._op[w]&&e.kill(E,e._op[w]),y&&e._pt&&(wn=e,le.killTweensOf(E,I,e.globalTime(t)),z=!e.parent,wn=0),e._pt&&l&&(Ll[S.id]=1)}M&&hg(e),e._onInit&&e._onInit(e)}e._onUpdate=c,e._initted=(!e._op||e._pt)&&!z,d&&t<=0&&T.render(yt,!0,!0)},vE=function(n,e,t,r,i,s,o,a){var l=(n._pt&&n._ptCache||(n._ptCache={}))[e],c,u,h,d;if(!l)for(l=n._ptCache[e]=[],h=n._ptLookup,d=n._targets.length;d--;){if(c=h[d][e],c&&c.d&&c.d._pt)for(c=c.d._pt;c&&c.p!==e&&c.fp!==e;)c=c._next;if(!c)return jl=1,n.vars[e]="+=0",Hc(n,o),jl=0,a?zi(e+" not eligible for reset"):1;l.push(c)}for(d=l.length;d--;)u=l[d],c=u._pt||u,c.s=(r||r===0)&&!i?r:c.s+(r||0)+s*c.c,c.c=t-c.s,u.e&&(u.e=pe(t)+Ie(u.e)),u.b&&(u.b=c.s+Ie(u.b))},yE=function(n,e){var t=n[0]?Zn(n[0]).harness:0,r=t&&t.aliases,i,s,o,a;if(!r)return e;i=Wr({},e);for(s in r)if(s in i)for(a=r[s].split(","),o=a.length;o--;)i[a[o]]=i[s];return i},bE=function(n,e,t,r){var i=e.ease||r||"power1.inOut",s,o;if(De(e))o=t[n]||(t[n]=[]),e.forEach(function(a,l){return o.push({t:l/(e.length-1)*100,v:a,e:i})});else for(s in e)o=t[s]||(t[s]=[]),s==="ease"||o.push({t:parseFloat(n),v:e[s],e:i})},Ci=function(n,e,t,r,i){return de(n)?n.call(e,t,r,i):Pe(n)&&~n.indexOf("random(")?$i(n):n},og=Bc+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",ag={};Ze(og+",id,stagger,delay,duration,paused,scrollTrigger",function(n){return ag[n]=1});var ge=function(n){Am(e,n);function e(r,i,s,o){var a;typeof i=="number"&&(s.duration=i,i=s,s=null),a=n.call(this,o?i:Mi(i))||this;var l=a.vars,c=l.duration,u=l.delay,h=l.immediateRender,d=l.stagger,f=l.overwrite,p=l.keyframes,m=l.defaults,g=l.scrollTrigger,_=l.yoyoEase,v=i.parent||le,y=(De(r)||Mm(r)?an(r[0]):"length"in i)?[r]:bt(r),T,A,w,x,b,E,M,S;if(a._targets=y.length?zc(y):zi("GSAP target "+r+" not found. https://gsap.com",!ct.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=f,p||d||Is(c)||Is(u)){if(i=a.vars,T=a.timeline=new ze({data:"nested",defaults:m||{},targets:v&&v.data==="nested"?v.vars.targets:y}),T.kill(),T.parent=T._dp=Qt(a),T._start=0,d||Is(c)||Is(u)){if(x=y.length,M=d&&Gm(d),zt(d))for(b in d)~og.indexOf(b)&&(S||(S={}),S[b]=d[b]);for(A=0;A<x;A++)w=uo(i,ag),w.stagger=0,_&&(w.yoyoEase=_),S&&Wr(w,S),E=y[A],w.duration=+Ci(c,Qt(a),A,E,y),w.delay=(+Ci(u,Qt(a),A,E,y)||0)-a._delay,!d&&x===1&&w.delay&&(a._delay=u=w.delay,a._start+=u,w.delay=0),T.to(E,w,M?M(A,E,y):0),T._ease=Q.none;T.duration()?c=u=0:a.timeline=0}else if(p){Mi(ht(T.vars.defaults,{ease:"none"})),T._ease=Jn(p.ease||i.ease||"none");var O=0,L,I,N;if(De(p))p.forEach(function(R){return T.to(y,R,">")}),T.duration();else{w={};for(b in p)b==="ease"||b==="easeEach"||bE(b,p[b],w,p.easeEach);for(b in w)for(L=w[b].sort(function(R,z){return R.t-z.t}),O=0,A=0;A<L.length;A++)I=L[A],N={ease:I.e,duration:(I.t-(A?L[A-1].t:0))/100*c},N[b]=I.v,T.to(y,N,O),O+=N.duration;T.duration()<c&&T.to({},{duration:c-T.duration()})}}c||a.duration(c=T.duration())}else a.timeline=0;return f===!0&&!Ic&&(wn=Qt(a),le.killTweensOf(y),wn=0),Ut(v,Qt(a),s),i.reversed&&a.reverse(),i.paused&&a.paused(!0),(h||!c&&!p&&a._start===_e(v._time)&&Ye(h)&&Zx(Qt(a))&&v.data!=="nested")&&(a._tTime=-se,a.render(Math.max(0,-u)||0)),g&&zm(Qt(a),g),a}var t=e.prototype;return t.render=function(r,i,s){var o=this._time,a=this._tDur,l=this._dur,c=r<0,u=r>a-se&&!c?a:r<se?0:r,h,d,f,p,m,g,_,v,y;if(!l)Jx(this,r,i,s);else if(u!==this._tTime||!r||s||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==c||this._lazy){if(h=u,v=this.timeline,this._repeat){if(p=l+this._rDelay,this._repeat<-1&&c)return this.totalTime(p*100+r,i,s);if(h=_e(u%p),u===a?(f=this._repeat,h=l):(m=_e(u/p),f=~~m,f&&f===m?(h=l,f--):h>l&&(h=l)),g=this._yoyo&&f&1,g&&(y=this._yEase,h=l-h),m=Kr(this._tTime,p),h===o&&!s&&this._initted&&f===m)return this._tTime=u,this;f!==m&&(v&&this._yEase&&ng(v,g),this.vars.repeatRefresh&&!g&&!this._lock&&h!==p&&this._initted&&(this._lock=s=1,this.render(_e(p*f),!0).invalidate()._lock=0))}if(!this._initted){if(Vm(this,c?r:h,s,i,u))return this._tTime=0,this;if(o!==this._time&&!(s&&this.vars.repeatRefresh&&f!==m))return this;if(l!==this._dur)return this.render(r,i,s)}if(this._tTime=u,this._time=h,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=_=(y||this._ease)(h/l),this._from&&(this.ratio=_=1-_),!o&&u&&!i&&!m&&(lt(this,"onStart"),this._tTime!==u))return this;for(d=this._pt;d;)d.r(_,d.d),d=d._next;v&&v.render(r<0?r:v._dur*v._ease(h/this._dur),i,s)||this._startAt&&(this._zTime=r),this._onUpdate&&!i&&(c&&Il(this,r,i,s),lt(this,"onUpdate")),this._repeat&&f!==m&&this.vars.onRepeat&&!i&&this.parent&&lt(this,"onRepeat"),(u===this._tDur||!u)&&this._tTime===u&&(c&&!this._onUpdate&&Il(this,r,!0,!0),(r||!l)&&(u===this._tDur&&this._ts>0||!u&&this._ts<0)&&Rn(this,1),!i&&!(c&&!o)&&(u||o||g)&&(lt(this,u===a?"onComplete":"onReverseComplete",!0),this._prom&&!(u<a&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(r){return(!r||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(r),n.prototype.invalidate.call(this,r)},t.resetTo=function(r,i,s,o,a){Hi||ot.wake(),this._ts||this.play();var l=Math.min(this._dur,(this._dp._time-this._start)*this._ts),c;return this._initted||Hc(this,l),c=this._ease(l/this._dur),vE(this,r,i,s,o,c,l,a)?this.resetTo(r,i,s,o,1):(Io(this,0),this.parent||jm(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(r,i){if(i===void 0&&(i="all"),!r&&(!i||i==="all"))return this._lazy=this._pt=0,this.parent?Ti(this):this.scrollTrigger&&this.scrollTrigger.kill(!!Oe),this;if(this.timeline){var s=this.timeline.totalDuration();return this.timeline.killTweensOf(r,i,wn&&wn.vars.overwrite!==!0)._first||Ti(this),this.parent&&s!==this.timeline.totalDuration()&&qr(this,this._dur*this.timeline._tDur/s,0,1),this}var o=this._targets,a=r?bt(r):o,l=this._ptLookup,c=this._pt,u,h,d,f,p,m,g;if((!i||i==="all")&&Xx(o,a))return i==="all"&&(this._pt=0),Ti(this);for(u=this._op=this._op||[],i!=="all"&&(Pe(i)&&(p={},Ze(i,function(_){return p[_]=1}),i=p),i=yE(o,i)),g=o.length;g--;)if(~a.indexOf(o[g])){h=l[g],i==="all"?(u[g]=i,f=h,d={}):(d=u[g]=u[g]||{},f=i);for(p in f)m=h&&h[p],m&&((!("kill"in m.d)||m.d.kill(p)===!0)&&ko(this,m,"_pt"),delete h[p]),d!=="all"&&(d[p]=1)}return this._initted&&!this._pt&&c&&Ti(this),this},e.to=function(r,i){return new e(r,i,arguments[2])},e.from=function(r,i){return Si(1,arguments)},e.delayedCall=function(r,i,s,o){return new e(i,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:r,onComplete:i,onReverseComplete:i,onCompleteParams:s,onReverseCompleteParams:s,callbackScope:o})},e.fromTo=function(r,i,s){return Si(2,arguments)},e.set=function(r,i){return i.duration=0,i.repeatDelay||(i.repeat=0),new e(r,i)},e.killTweensOf=function(r,i,s){return le.killTweensOf(r,i,s)},e}(Gi);ht(ge.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Ze("staggerTo,staggerFrom,staggerFromTo",function(n){ge[n]=function(){var e=new ze,t=Nl.call(arguments,0);return t.splice(n==="staggerFromTo"?5:4,0,0),e[n].apply(e,t)}});var Gc=function(n,e,t){return n[e]=t},lg=function(n,e,t){return n[e](t)},wE=function(n,e,t,r){return n[e](r.fp,t)},TE=function(n,e,t){return n.setAttribute(e,t)},Wc=function(n,e){return de(n[e])?lg:Dc(n[e])&&n.setAttribute?TE:Gc},cg=function(n,e){return e.set(e.t,e.p,Math.round((e.s+e.c*n)*1e6)/1e6,e)},xE=function(n,e){return e.set(e.t,e.p,!!(e.s+e.c*n),e)},ug=function(n,e){var t=e._pt,r="";if(!n&&e.b)r=e.b;else if(n===1&&e.e)r=e.e;else{for(;t;)r=t.p+(t.m?t.m(t.s+t.c*n):Math.round((t.s+t.c*n)*1e4)/1e4)+r,t=t._next;r+=e.c}e.set(e.t,e.p,r,e)},Kc=function(n,e){for(var t=e._pt;t;)t.r(n,t.d),t=t._next},EE=function(n,e,t,r){for(var i=this._pt,s;i;)s=i._next,i.p===r&&i.modifier(n,e,t),i=s},AE=function(n){for(var e=this._pt,t,r;e;)r=e._next,e.p===n&&!e.op||e.op===n?ko(this,e,"_pt"):e.dep||(t=1),e=r;return!t},PE=function(n,e,t,r){r.mSet(n,e,r.m.call(r.tween,t,r.mt),r)},hg=function(n){for(var e=n._pt,t,r,i,s;e;){for(t=e._next,r=i;r&&r.pr>e.pr;)r=r._next;(e._prev=r?r._prev:s)?e._prev._next=e:i=e,(e._next=r)?r._prev=e:s=e,e=t}n._pt=i},Qe=function(){function n(t,r,i,s,o,a,l,c,u){this.t=r,this.s=s,this.c=o,this.p=i,this.r=a||cg,this.d=l||this,this.set=c||Gc,this.pr=u||0,this._next=t,t&&(t._prev=this)}var e=n.prototype;return e.modifier=function(t,r,i){this.mSet=this.mSet||this.set,this.set=PE,this.m=t,this.mt=i,this.tween=r},n}();Ze(Bc+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(n){return jc[n]=1});ut.TweenMax=ut.TweenLite=ge;ut.TimelineLite=ut.TimelineMax=ze;le=new ze({sortChildren:!1,defaults:Gr,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});ct.stringFilter=eg;var er=[],Gs={},ME=[],Rd=0,SE=0,za=function(n){return(Gs[n]||ME).map(function(e){return e()})},Bl=function(){var n=Date.now(),e=[];n-Rd>2&&(za("matchMediaInit"),er.forEach(function(t){var r=t.queries,i=t.conditions,s,o,a,l;for(o in r)s=Dt.matchMedia(r[o]).matches,s&&(a=1),s!==i[o]&&(i[o]=s,l=1);l&&(t.revert(),a&&e.push(t))}),za("matchMediaRevert"),e.forEach(function(t){return t.onMatch(t,function(r){return t.add(null,r)})}),Rd=n,za("matchMedia"))},dg=function(){function n(t,r){this.selector=r&&Fl(r),this.data=[],this._r=[],this.isReverted=!1,this.id=SE++,t&&this.add(t)}var e=n.prototype;return e.add=function(t,r,i){de(t)&&(i=r,r=t,t=de);var s=this,o=function(){var a=ae,l=s.selector,c;return a&&a!==s&&a.data.push(s),i&&(s.selector=Fl(i)),ae=s,c=r.apply(s,arguments),de(c)&&s._r.push(c),ae=a,s.selector=l,s.isReverted=!1,c};return s.last=o,t===de?o(s,function(a){return s.add(null,a)}):t?s[t]=o:o},e.ignore=function(t){var r=ae;ae=null,t(this),ae=r},e.getTweens=function(){var t=[];return this.data.forEach(function(r){return r instanceof n?t.push.apply(t,r.getTweens()):r instanceof ge&&!(r.parent&&r.parent.data==="nested")&&t.push(r)}),t},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(t,r){var i=this;if(t?function(){for(var o=i.getTweens(),a=i.data.length,l;a--;)l=i.data[a],l.data==="isFlip"&&(l.revert(),l.getChildren(!0,!0,!1).forEach(function(c){return o.splice(o.indexOf(c),1)}));for(o.map(function(c){return{g:c._dur||c._delay||c._sat&&!c._sat.vars.immediateRender?c.globalTime(0):-1/0,t:c}}).sort(function(c,u){return u.g-c.g||-1/0}).forEach(function(c){return c.t.revert(t)}),a=i.data.length;a--;)l=i.data[a],l instanceof ze?l.data!=="nested"&&(l.scrollTrigger&&l.scrollTrigger.revert(),l.kill()):!(l instanceof ge)&&l.revert&&l.revert(t);i._r.forEach(function(c){return c(t,i)}),i.isReverted=!0}():this.data.forEach(function(o){return o.kill&&o.kill()}),this.clear(),r)for(var s=er.length;s--;)er[s].id===this.id&&er.splice(s,1)},e.revert=function(t){this.kill(t||{})},n}(),CE=function(){function n(t){this.contexts=[],this.scope=t,ae&&ae.data.push(this)}var e=n.prototype;return e.add=function(t,r,i){zt(t)||(t={matches:t});var s=new dg(0,i||this.scope),o=s.conditions={},a,l,c;ae&&!s.selector&&(s.selector=ae.selector),this.contexts.push(s),r=s.add("onMatch",r),s.queries=t;for(l in t)l==="all"?c=1:(a=Dt.matchMedia(t[l]),a&&(er.indexOf(s)<0&&er.push(s),(o[l]=a.matches)&&(c=1),a.addListener?a.addListener(Bl):a.addEventListener("change",Bl)));return c&&r(s,function(u){return s.add(null,u)}),this},e.revert=function(t){this.kill(t||{})},e.kill=function(t){this.contexts.forEach(function(r){return r.kill(t,!0)})},n}(),po={registerPlugin:function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];e.forEach(function(r){return Zm(r)})},timeline:function(n){return new ze(n)},getTweensOf:function(n,e){return le.getTweensOf(n,e)},getProperty:function(n,e,t,r){Pe(n)&&(n=bt(n)[0]);var i=Zn(n||{}).get,s=t?Um:Fm;return t==="native"&&(t=""),n&&(e?s((st[e]&&st[e].get||i)(n,e,t,r)):function(o,a,l){return s((st[o]&&st[o].get||i)(n,o,a,l))})},quickSetter:function(n,e,t){if(n=bt(n),n.length>1){var r=n.map(function(c){return et.quickSetter(c,e,t)}),i=r.length;return function(c){for(var u=i;u--;)r[u](c)}}n=n[0]||{};var s=st[e],o=Zn(n),a=o.harness&&(o.harness.aliases||{})[e]||e,l=s?function(c){var u=new s;Tr._pt=0,u.init(n,t?c+t:c,Tr,0,[n]),u.render(1,u),Tr._pt&&Kc(1,Tr)}:o.set(n,a);return s?l:function(c){return l(n,a,t?c+t:c,o,1)}},quickTo:function(n,e,t){var r,i=et.to(n,ht((r={},r[e]="+=0.1",r.paused=!0,r.stagger=0,r),t||{})),s=function(o,a,l){return i.resetTo(e,o,a,l)};return s.tween=i,s},isTweening:function(n){return le.getTweensOf(n,!0).length>0},defaults:function(n){return n&&n.ease&&(n.ease=Jn(n.ease,Gr.ease)),Ad(Gr,n||{})},config:function(n){return Ad(ct,n||{})},registerEffect:function(n){var e=n.name,t=n.effect,r=n.plugins,i=n.defaults,s=n.extendTimeline;(r||"").split(",").forEach(function(o){return o&&!st[o]&&!ut[o]&&zi(e+" effect requires "+o+" plugin.")}),Fa[e]=function(o,a,l){return t(bt(o),ht(a||{},i),l)},s&&(ze.prototype[e]=function(o,a,l){return this.add(Fa[e](o,zt(a)?a:(l=a)&&{},this),l)})},registerEase:function(n,e){Q[n]=Jn(e)},parseEase:function(n,e){return arguments.length?Jn(n,e):Q},getById:function(n){return le.getById(n)},exportRoot:function(n,e){n===void 0&&(n={});var t=new ze(n),r,i;for(t.smoothChildTiming=Ye(n.smoothChildTiming),le.remove(t),t._dp=0,t._time=t._tTime=le._time,r=le._first;r;)i=r._next,(e||!(!r._dur&&r instanceof ge&&r.vars.onComplete===r._targets[0]))&&Ut(t,r,r._start-r._delay),r=i;return Ut(le,t,0),t},context:function(n,e){return n?new dg(n,e):ae},matchMedia:function(n){return new CE(n)},matchMediaRefresh:function(){return er.forEach(function(n){var e=n.conditions,t,r;for(r in e)e[r]&&(e[r]=!1,t=1);t&&n.revert()})||Bl()},addEventListener:function(n,e){var t=Gs[n]||(Gs[n]=[]);~t.indexOf(e)||t.push(e)},removeEventListener:function(n,e){var t=Gs[n],r=t&&t.indexOf(e);r>=0&&t.splice(r,1)},utils:{wrap:aE,wrapYoyo:lE,distribute:Gm,random:Km,snap:Wm,normalize:oE,getUnit:Ie,clamp:nE,splitColor:Qm,toArray:bt,selector:Fl,mapRange:Xm,pipe:iE,unitize:sE,interpolate:cE,shuffle:Hm},install:km,effects:Fa,ticker:ot,updateRoot:ze.updateRoot,plugins:st,globalTimeline:le,core:{PropTween:Qe,globals:Lm,Tween:ge,Timeline:ze,Animation:Gi,getCache:Zn,_removeLinkedListItem:ko,reverting:function(){return Oe},context:function(n){return n&&ae&&(ae.data.push(n),n._ctx=ae),ae},suppressOverwrites:function(n){return Ic=n}}};Ze("to,from,fromTo,delayedCall,set,killTweensOf",function(n){return po[n]=ge[n]});ot.add(ze.updateRoot);Tr=po.to({},{duration:0});var RE=function(n,e){for(var t=n._pt;t&&t.p!==e&&t.op!==e&&t.fp!==e;)t=t._next;return t},OE=function(n,e){var t=n._targets,r,i,s;for(r in e)for(i=t.length;i--;)s=n._ptLookup[i][r],s&&(s=s.d)&&(s._pt&&(s=RE(s,r)),s&&s.modifier&&s.modifier(e[r],n,t[i],r))},Va=function(n,e){return{name:n,headless:1,rawVars:1,init:function(t,r,i){i._onInit=function(s){var o,a;if(Pe(r)&&(o={},Ze(r,function(l){return o[l]=1}),r=o),e){o={};for(a in r)o[a]=e(r[a]);r=o}OE(s,r)}}}},et=po.registerPlugin({name:"attr",init:function(n,e,t,r,i){var s,o,a;this.tween=t;for(s in e)a=n.getAttribute(s)||"",o=this.add(n,"setAttribute",(a||0)+"",e[s],r,i,0,0,s),o.op=s,o.b=a,this._props.push(s)},render:function(n,e){for(var t=e._pt;t;)Oe?t.set(t.t,t.p,t.b,t):t.r(n,t.d),t=t._next}},{name:"endArray",headless:1,init:function(n,e){for(var t=e.length;t--;)this.add(n,t,n[t]||0,e[t],0,0,0,0,0,1)}},Va("roundProps",Ul),Va("modifiers"),Va("snap",Wm))||po;ge.version=ze.version=et.version="3.13.0";Om=1;Nc()&&Xr();Q.Power0;Q.Power1;Q.Power2;Q.Power3;Q.Power4;Q.Linear;Q.Quad;Q.Cubic;Q.Quart;Q.Quint;Q.Strong;Q.Elastic;Q.Back;Q.SteppedEase;Q.Bounce;Q.Sine;Q.Expo;Q.Circ;/*!
 * CSSPlugin 3.13.0
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var Od,Tn,Cr,qc,qn,kd,Xc,kE=function(){return typeof window<"u"},ln={},$n=180/Math.PI,Rr=Math.PI/180,pr=Math.atan2,Ld=1e8,Yc=/([A-Z])/g,LE=/(left|right|width|margin|padding|x)/i,IE=/[\s,\(]\S/,jt={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},zl=function(n,e){return e.set(e.t,e.p,Math.round((e.s+e.c*n)*1e4)/1e4+e.u,e)},DE=function(n,e){return e.set(e.t,e.p,n===1?e.e:Math.round((e.s+e.c*n)*1e4)/1e4+e.u,e)},NE=function(n,e){return e.set(e.t,e.p,n?Math.round((e.s+e.c*n)*1e4)/1e4+e.u:e.b,e)},FE=function(n,e){var t=e.s+e.c*n;e.set(e.t,e.p,~~(t+(t<0?-.5:.5))+e.u,e)},pg=function(n,e){return e.set(e.t,e.p,n?e.e:e.b,e)},fg=function(n,e){return e.set(e.t,e.p,n!==1?e.b:e.e,e)},UE=function(n,e,t){return n.style[e]=t},jE=function(n,e,t){return n.style.setProperty(e,t)},BE=function(n,e,t){return n._gsap[e]=t},zE=function(n,e,t){return n._gsap.scaleX=n._gsap.scaleY=t},VE=function(n,e,t,r,i){var s=n._gsap;s.scaleX=s.scaleY=t,s.renderTransform(i,s)},$E=function(n,e,t,r,i){var s=n._gsap;s[e]=t,s.renderTransform(i,s)},ce="transform",Je=ce+"Origin",HE=function n(e,t){var r=this,i=this.target,s=i.style,o=i._gsap;if(e in ln&&s){if(this.tfm=this.tfm||{},e!=="transform")e=jt[e]||e,~e.indexOf(",")?e.split(",").forEach(function(a){return r.tfm[a]=en(i,a)}):this.tfm[e]=o.x?o[e]:en(i,e),e===Je&&(this.tfm.zOrigin=o.zOrigin);else return jt.transform.split(",").forEach(function(a){return n.call(r,a,t)});if(this.props.indexOf(ce)>=0)return;o.svg&&(this.svgo=i.getAttribute("data-svg-origin"),this.props.push(Je,t,"")),e=ce}(s||t)&&this.props.push(e,t,s[e])},mg=function(n){n.translate&&(n.removeProperty("translate"),n.removeProperty("scale"),n.removeProperty("rotate"))},GE=function(){var n=this.props,e=this.target,t=e.style,r=e._gsap,i,s;for(i=0;i<n.length;i+=3)n[i+1]?n[i+1]===2?e[n[i]](n[i+2]):e[n[i]]=n[i+2]:n[i+2]?t[n[i]]=n[i+2]:t.removeProperty(n[i].substr(0,2)==="--"?n[i]:n[i].replace(Yc,"-$1").toLowerCase());if(this.tfm){for(s in this.tfm)r[s]=this.tfm[s];r.svg&&(r.renderTransform(),e.setAttribute("data-svg-origin",this.svgo||"")),i=Xc(),(!i||!i.isStart)&&!t[ce]&&(mg(t),r.zOrigin&&t[Je]&&(t[Je]+=" "+r.zOrigin+"px",r.zOrigin=0,r.renderTransform()),r.uncache=1)}},gg=function(n,e){var t={target:n,props:[],revert:GE,save:HE};return n._gsap||et.core.getCache(n),e&&n.style&&n.nodeType&&e.split(",").forEach(function(r){return t.save(r)}),t},_g,Vl=function(n,e){var t=Tn.createElementNS?Tn.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),n):Tn.createElement(n);return t&&t.style?t:Tn.createElement(n)},wt=function n(e,t,r){var i=getComputedStyle(e);return i[t]||i.getPropertyValue(t.replace(Yc,"-$1").toLowerCase())||i.getPropertyValue(t)||!r&&n(e,Yr(t)||t,1)||""},Id="O,Moz,ms,Ms,Webkit".split(","),Yr=function(n,e,t){var r=e||qn,i=r.style,s=5;if(n in i&&!t)return n;for(n=n.charAt(0).toUpperCase()+n.substr(1);s--&&!(Id[s]+n in i););return s<0?null:(s===3?"ms":s>=0?Id[s]:"")+n},$l=function(){kE()&&window.document&&(Od=window,Tn=Od.document,Cr=Tn.documentElement,qn=Vl("div")||{style:{}},Vl("div"),ce=Yr(ce),Je=ce+"Origin",qn.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",_g=!!Yr("perspective"),Xc=et.core.reverting,qc=1)},Dd=function(n){var e=n.ownerSVGElement,t=Vl("svg",e&&e.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),r=n.cloneNode(!0),i;r.style.display="block",t.appendChild(r),Cr.appendChild(t);try{i=r.getBBox()}catch{}return t.removeChild(r),Cr.removeChild(t),i},Nd=function(n,e){for(var t=e.length;t--;)if(n.hasAttribute(e[t]))return n.getAttribute(e[t])},vg=function(n){var e,t;try{e=n.getBBox()}catch{e=Dd(n),t=1}return e&&(e.width||e.height)||t||(e=Dd(n)),e&&!e.width&&!e.x&&!e.y?{x:+Nd(n,["x","cx","x1"])||0,y:+Nd(n,["y","cy","y1"])||0,width:0,height:0}:e},yg=function(n){return!!(n.getCTM&&(!n.parentNode||n.ownerSVGElement)&&vg(n))},rr=function(n,e){if(e){var t=n.style,r;e in ln&&e!==Je&&(e=ce),t.removeProperty?(r=e.substr(0,2),(r==="ms"||e.substr(0,6)==="webkit")&&(e="-"+e),t.removeProperty(r==="--"?e:e.replace(Yc,"-$1").toLowerCase())):t.removeAttribute(e)}},xn=function(n,e,t,r,i,s){var o=new Qe(n._pt,e,t,0,1,s?fg:pg);return n._pt=o,o.b=r,o.e=i,n._props.push(t),o},Fd={deg:1,rad:1,turn:1},WE={grid:1,flex:1},On=function n(e,t,r,i){var s=parseFloat(r)||0,o=(r+"").trim().substr((s+"").length)||"px",a=qn.style,l=LE.test(t),c=e.tagName.toLowerCase()==="svg",u=(c?"client":"offset")+(l?"Width":"Height"),h=100,d=i==="px",f=i==="%",p,m,g,_;if(i===o||!s||Fd[i]||Fd[o])return s;if(o!=="px"&&!d&&(s=n(e,t,r,"px")),_=e.getCTM&&yg(e),(f||o==="%")&&(ln[t]||~t.indexOf("adius")))return p=_?e.getBBox()[l?"width":"height"]:e[u],pe(f?s/p*h:s/100*p);if(a[l?"width":"height"]=h+(d?o:i),m=i!=="rem"&&~t.indexOf("adius")||i==="em"&&e.appendChild&&!c?e:e.parentNode,_&&(m=(e.ownerSVGElement||{}).parentNode),(!m||m===Tn||!m.appendChild)&&(m=Tn.body),g=m._gsap,g&&f&&g.width&&l&&g.time===ot.time&&!g.uncache)return pe(s/g.width*h);if(f&&(t==="height"||t==="width")){var v=e.style[t];e.style[t]=h+i,p=e[u],v?e.style[t]=v:rr(e,t)}else(f||o==="%")&&!WE[wt(m,"display")]&&(a.position=wt(e,"position")),m===e&&(a.position="static"),m.appendChild(qn),p=qn[u],m.removeChild(qn),a.position="absolute";return l&&f&&(g=Zn(m),g.time=ot.time,g.width=m[u]),pe(d?p*s/h:p&&s?h/p*s:0)},en=function(n,e,t,r){var i;return qc||$l(),e in jt&&e!=="transform"&&(e=jt[e],~e.indexOf(",")&&(e=e.split(",")[0])),ln[e]&&e!=="transform"?(i=Ki(n,r),i=e!=="transformOrigin"?i[e]:i.svg?i.origin:mo(wt(n,Je))+" "+i.zOrigin+"px"):(i=n.style[e],(!i||i==="auto"||r||~(i+"").indexOf("calc("))&&(i=fo[e]&&fo[e](n,e,t)||wt(n,e)||Dm(n,e)||(e==="opacity"?1:0))),t&&!~(i+"").trim().indexOf(" ")?On(n,e,i,t)+t:i},KE=function(n,e,t,r){if(!t||t==="none"){var i=Yr(e,n,1),s=i&&wt(n,i,1);s&&s!==t?(e=i,t=s):e==="borderColor"&&(t=wt(n,"borderTopColor"))}var o=new Qe(this._pt,n.style,e,0,1,ug),a=0,l=0,c,u,h,d,f,p,m,g,_,v,y,T;if(o.b=t,o.e=r,t+="",r+="",r.substring(0,6)==="var(--"&&(r=wt(n,r.substring(4,r.indexOf(")")))),r==="auto"&&(p=n.style[e],n.style[e]=r,r=wt(n,e)||r,p?n.style[e]=p:rr(n,e)),c=[t,r],eg(c),t=c[0],r=c[1],h=t.match(wr)||[],T=r.match(wr)||[],T.length){for(;u=wr.exec(r);)m=u[0],_=r.substring(a,u.index),f?f=(f+1)%5:(_.substr(-5)==="rgba("||_.substr(-5)==="hsla(")&&(f=1),m!==(p=h[l++]||"")&&(d=parseFloat(p)||0,y=p.substr((d+"").length),m.charAt(1)==="="&&(m=Sr(d,m)+y),g=parseFloat(m),v=m.substr((g+"").length),a=wr.lastIndex-v.length,v||(v=v||ct.units[e]||y,a===r.length&&(r+=v,o.e+=v)),y!==v&&(d=On(n,e,p,v)||0),o._pt={_next:o._pt,p:_||l===1?_:",",s:d,c:g-d,m:f&&f<4||e==="zIndex"?Math.round:0});o.c=a<r.length?r.substring(a,r.length):""}else o.r=e==="display"&&r==="none"?fg:pg;return Cm.test(r)&&(o.e=0),this._pt=o,o},Ud={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},qE=function(n){var e=n.split(" "),t=e[0],r=e[1]||"50%";return(t==="top"||t==="bottom"||r==="left"||r==="right")&&(n=t,t=r,r=n),e[0]=Ud[t]||t,e[1]=Ud[r]||r,e.join(" ")},XE=function(n,e){if(e.tween&&e.tween._time===e.tween._dur){var t=e.t,r=t.style,i=e.u,s=t._gsap,o,a,l;if(i==="all"||i===!0)r.cssText="",a=1;else for(i=i.split(","),l=i.length;--l>-1;)o=i[l],ln[o]&&(a=1,o=o==="transformOrigin"?Je:ce),rr(t,o);a&&(rr(t,ce),s&&(s.svg&&t.removeAttribute("transform"),r.scale=r.rotate=r.translate="none",Ki(t,1),s.uncache=1,mg(r)))}},fo={clearProps:function(n,e,t,r,i){if(i.data!=="isFromStart"){var s=n._pt=new Qe(n._pt,e,t,0,0,XE);return s.u=r,s.pr=-10,s.tween=i,n._props.push(t),1}}},Wi=[1,0,0,1,0,0],bg={},wg=function(n){return n==="matrix(1, 0, 0, 1, 0, 0)"||n==="none"||!n},jd=function(n){var e=wt(n,ce);return wg(e)?Wi:e.substr(7).match(Sm).map(pe)},Zc=function(n,e){var t=n._gsap||Zn(n),r=n.style,i=jd(n),s,o,a,l;return t.svg&&n.getAttribute("transform")?(a=n.transform.baseVal.consolidate().matrix,i=[a.a,a.b,a.c,a.d,a.e,a.f],i.join(",")==="1,0,0,1,0,0"?Wi:i):(i===Wi&&!n.offsetParent&&n!==Cr&&!t.svg&&(a=r.display,r.display="block",s=n.parentNode,(!s||!n.offsetParent&&!n.getBoundingClientRect().width)&&(l=1,o=n.nextElementSibling,Cr.appendChild(n)),i=jd(n),a?r.display=a:rr(n,"display"),l&&(o?s.insertBefore(n,o):s?s.appendChild(n):Cr.removeChild(n))),e&&i.length>6?[i[0],i[1],i[4],i[5],i[12],i[13]]:i)},Hl=function(n,e,t,r,i,s){var o=n._gsap,a=i||Zc(n,!0),l=o.xOrigin||0,c=o.yOrigin||0,u=o.xOffset||0,h=o.yOffset||0,d=a[0],f=a[1],p=a[2],m=a[3],g=a[4],_=a[5],v=e.split(" "),y=parseFloat(v[0])||0,T=parseFloat(v[1])||0,A,w,x,b;t?a!==Wi&&(w=d*m-f*p)&&(x=y*(m/w)+T*(-p/w)+(p*_-m*g)/w,b=y*(-f/w)+T*(d/w)-(d*_-f*g)/w,y=x,T=b):(A=vg(n),y=A.x+(~v[0].indexOf("%")?y/100*A.width:y),T=A.y+(~(v[1]||v[0]).indexOf("%")?T/100*A.height:T)),r||r!==!1&&o.smooth?(g=y-l,_=T-c,o.xOffset=u+(g*d+_*p)-g,o.yOffset=h+(g*f+_*m)-_):o.xOffset=o.yOffset=0,o.xOrigin=y,o.yOrigin=T,o.smooth=!!r,o.origin=e,o.originIsAbsolute=!!t,n.style[Je]="0px 0px",s&&(xn(s,o,"xOrigin",l,y),xn(s,o,"yOrigin",c,T),xn(s,o,"xOffset",u,o.xOffset),xn(s,o,"yOffset",h,o.yOffset)),n.setAttribute("data-svg-origin",y+" "+T)},Ki=function(n,e){var t=n._gsap||new ig(n);if("x"in t&&!e&&!t.uncache)return t;var r=n.style,i=t.scaleX<0,s="px",o="deg",a=getComputedStyle(n),l=wt(n,Je)||"0",c,u,h,d,f,p,m,g,_,v,y,T,A,w,x,b,E,M,S,O,L,I,N,R,z,F,$,B,G,ye,Y,he;return c=u=h=p=m=g=_=v=y=0,d=f=1,t.svg=!!(n.getCTM&&yg(n)),a.translate&&((a.translate!=="none"||a.scale!=="none"||a.rotate!=="none")&&(r[ce]=(a.translate!=="none"?"translate3d("+(a.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(a.rotate!=="none"?"rotate("+a.rotate+") ":"")+(a.scale!=="none"?"scale("+a.scale.split(" ").join(",")+") ":"")+(a[ce]!=="none"?a[ce]:"")),r.scale=r.rotate=r.translate="none"),w=Zc(n,t.svg),t.svg&&(t.uncache?(z=n.getBBox(),l=t.xOrigin-z.x+"px "+(t.yOrigin-z.y)+"px",R=""):R=!e&&n.getAttribute("data-svg-origin"),Hl(n,R||l,!!R||t.originIsAbsolute,t.smooth!==!1,w)),T=t.xOrigin||0,A=t.yOrigin||0,w!==Wi&&(M=w[0],S=w[1],O=w[2],L=w[3],c=I=w[4],u=N=w[5],w.length===6?(d=Math.sqrt(M*M+S*S),f=Math.sqrt(L*L+O*O),p=M||S?pr(S,M)*$n:0,_=O||L?pr(O,L)*$n+p:0,_&&(f*=Math.abs(Math.cos(_*Rr))),t.svg&&(c-=T-(T*M+A*O),u-=A-(T*S+A*L))):(he=w[6],ye=w[7],$=w[8],B=w[9],G=w[10],Y=w[11],c=w[12],u=w[13],h=w[14],x=pr(he,G),m=x*$n,x&&(b=Math.cos(-x),E=Math.sin(-x),R=I*b+$*E,z=N*b+B*E,F=he*b+G*E,$=I*-E+$*b,B=N*-E+B*b,G=he*-E+G*b,Y=ye*-E+Y*b,I=R,N=z,he=F),x=pr(-O,G),g=x*$n,x&&(b=Math.cos(-x),E=Math.sin(-x),R=M*b-$*E,z=S*b-B*E,F=O*b-G*E,Y=L*E+Y*b,M=R,S=z,O=F),x=pr(S,M),p=x*$n,x&&(b=Math.cos(x),E=Math.sin(x),R=M*b+S*E,z=I*b+N*E,S=S*b-M*E,N=N*b-I*E,M=R,I=z),m&&Math.abs(m)+Math.abs(p)>359.9&&(m=p=0,g=180-g),d=pe(Math.sqrt(M*M+S*S+O*O)),f=pe(Math.sqrt(N*N+he*he)),x=pr(I,N),_=Math.abs(x)>2e-4?x*$n:0,y=Y?1/(Y<0?-Y:Y):0),t.svg&&(R=n.getAttribute("transform"),t.forceCSS=n.setAttribute("transform","")||!wg(wt(n,ce)),R&&n.setAttribute("transform",R))),Math.abs(_)>90&&Math.abs(_)<270&&(i?(d*=-1,_+=p<=0?180:-180,p+=p<=0?180:-180):(f*=-1,_+=_<=0?180:-180)),e=e||t.uncache,t.x=c-((t.xPercent=c&&(!e&&t.xPercent||(Math.round(n.offsetWidth/2)===Math.round(-c)?-50:0)))?n.offsetWidth*t.xPercent/100:0)+s,t.y=u-((t.yPercent=u&&(!e&&t.yPercent||(Math.round(n.offsetHeight/2)===Math.round(-u)?-50:0)))?n.offsetHeight*t.yPercent/100:0)+s,t.z=h+s,t.scaleX=pe(d),t.scaleY=pe(f),t.rotation=pe(p)+o,t.rotationX=pe(m)+o,t.rotationY=pe(g)+o,t.skewX=_+o,t.skewY=v+o,t.transformPerspective=y+s,(t.zOrigin=parseFloat(l.split(" ")[2])||!e&&t.zOrigin||0)&&(r[Je]=mo(l)),t.xOffset=t.yOffset=0,t.force3D=ct.force3D,t.renderTransform=t.svg?ZE:_g?Tg:YE,t.uncache=0,t},mo=function(n){return(n=n.split(" "))[0]+" "+n[1]},$a=function(n,e,t){var r=Ie(e);return pe(parseFloat(e)+parseFloat(On(n,"x",t+"px",r)))+r},YE=function(n,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,Tg(n,e)},jn="0deg",gi="0px",Bn=") ",Tg=function(n,e){var t=e||this,r=t.xPercent,i=t.yPercent,s=t.x,o=t.y,a=t.z,l=t.rotation,c=t.rotationY,u=t.rotationX,h=t.skewX,d=t.skewY,f=t.scaleX,p=t.scaleY,m=t.transformPerspective,g=t.force3D,_=t.target,v=t.zOrigin,y="",T=g==="auto"&&n&&n!==1||g===!0;if(v&&(u!==jn||c!==jn)){var A=parseFloat(c)*Rr,w=Math.sin(A),x=Math.cos(A),b;A=parseFloat(u)*Rr,b=Math.cos(A),s=$a(_,s,w*b*-v),o=$a(_,o,-Math.sin(A)*-v),a=$a(_,a,x*b*-v+v)}m!==gi&&(y+="perspective("+m+Bn),(r||i)&&(y+="translate("+r+"%, "+i+"%) "),(T||s!==gi||o!==gi||a!==gi)&&(y+=a!==gi||T?"translate3d("+s+", "+o+", "+a+") ":"translate("+s+", "+o+Bn),l!==jn&&(y+="rotate("+l+Bn),c!==jn&&(y+="rotateY("+c+Bn),u!==jn&&(y+="rotateX("+u+Bn),(h!==jn||d!==jn)&&(y+="skew("+h+", "+d+Bn),(f!==1||p!==1)&&(y+="scale("+f+", "+p+Bn),_.style[ce]=y||"translate(0, 0)"},ZE=function(n,e){var t=e||this,r=t.xPercent,i=t.yPercent,s=t.x,o=t.y,a=t.rotation,l=t.skewX,c=t.skewY,u=t.scaleX,h=t.scaleY,d=t.target,f=t.xOrigin,p=t.yOrigin,m=t.xOffset,g=t.yOffset,_=t.forceCSS,v=parseFloat(s),y=parseFloat(o),T,A,w,x,b;a=parseFloat(a),l=parseFloat(l),c=parseFloat(c),c&&(c=parseFloat(c),l+=c,a+=c),a||l?(a*=Rr,l*=Rr,T=Math.cos(a)*u,A=Math.sin(a)*u,w=Math.sin(a-l)*-h,x=Math.cos(a-l)*h,l&&(c*=Rr,b=Math.tan(l-c),b=Math.sqrt(1+b*b),w*=b,x*=b,c&&(b=Math.tan(c),b=Math.sqrt(1+b*b),T*=b,A*=b)),T=pe(T),A=pe(A),w=pe(w),x=pe(x)):(T=u,x=h,A=w=0),(v&&!~(s+"").indexOf("px")||y&&!~(o+"").indexOf("px"))&&(v=On(d,"x",s,"px"),y=On(d,"y",o,"px")),(f||p||m||g)&&(v=pe(v+f-(f*T+p*w)+m),y=pe(y+p-(f*A+p*x)+g)),(r||i)&&(b=d.getBBox(),v=pe(v+r/100*b.width),y=pe(y+i/100*b.height)),b="matrix("+T+","+A+","+w+","+x+","+v+","+y+")",d.setAttribute("transform",b),_&&(d.style[ce]=b)},QE=function(n,e,t,r,i){var s=360,o=Pe(i),a=parseFloat(i)*(o&&~i.indexOf("rad")?$n:1),l=a-r,c=r+l+"deg",u,h;return o&&(u=i.split("_")[1],u==="short"&&(l%=s,l!==l%(s/2)&&(l+=l<0?s:-s)),u==="cw"&&l<0?l=(l+s*Ld)%s-~~(l/s)*s:u==="ccw"&&l>0&&(l=(l-s*Ld)%s-~~(l/s)*s)),n._pt=h=new Qe(n._pt,e,t,r,l,DE),h.e=c,h.u="deg",n._props.push(t),h},Bd=function(n,e){for(var t in e)n[t]=e[t];return n},JE=function(n,e,t){var r=Bd({},t._gsap),i="perspective,force3D,transformOrigin,svgOrigin",s=t.style,o,a,l,c,u,h,d,f;r.svg?(l=t.getAttribute("transform"),t.setAttribute("transform",""),s[ce]=e,o=Ki(t,1),rr(t,ce),t.setAttribute("transform",l)):(l=getComputedStyle(t)[ce],s[ce]=e,o=Ki(t,1),s[ce]=l);for(a in ln)l=r[a],c=o[a],l!==c&&i.indexOf(a)<0&&(d=Ie(l),f=Ie(c),u=d!==f?On(t,a,l,f):parseFloat(l),h=parseFloat(c),n._pt=new Qe(n._pt,o,a,u,h-u,zl),n._pt.u=f||0,n._props.push(a));Bd(o,r)};Ze("padding,margin,Width,Radius",function(n,e){var t="Top",r="Right",i="Bottom",s="Left",o=(e<3?[t,r,i,s]:[t+s,t+r,i+r,i+s]).map(function(a){return e<2?n+a:"border"+a+n});fo[e>1?"border"+n:n]=function(a,l,c,u,h){var d,f;if(arguments.length<4)return d=o.map(function(p){return en(a,p,c)}),f=d.join(" "),f.split(d[0]).length===5?d[0]:f;d=(u+"").split(" "),f={},o.forEach(function(p,m){return f[p]=d[m]=d[m]||d[(m-1)/2|0]}),a.init(l,f,h)}});var xg={name:"css",register:$l,targetTest:function(n){return n.style&&n.nodeType},init:function(n,e,t,r,i){var s=this._props,o=n.style,a=t.vars.startAt,l,c,u,h,d,f,p,m,g,_,v,y,T,A,w,x;qc||$l(),this.styles=this.styles||gg(n),x=this.styles.props,this.tween=t;for(p in e)if(p!=="autoRound"&&(c=e[p],!(st[p]&&sg(p,e,t,r,n,i)))){if(d=typeof c,f=fo[p],d==="function"&&(c=c.call(t,r,n,i),d=typeof c),d==="string"&&~c.indexOf("random(")&&(c=$i(c)),f)f(this,n,p,c,t)&&(w=1);else if(p.substr(0,2)==="--")l=(getComputedStyle(n).getPropertyValue(p)+"").trim(),c+="",Pn.lastIndex=0,Pn.test(l)||(m=Ie(l),g=Ie(c)),g?m!==g&&(l=On(n,p,l,g)+g):m&&(c+=m),this.add(o,"setProperty",l,c,r,i,0,0,p),s.push(p),x.push(p,0,o[p]);else if(d!=="undefined"){if(a&&p in a?(l=typeof a[p]=="function"?a[p].call(t,r,n,i):a[p],Pe(l)&&~l.indexOf("random(")&&(l=$i(l)),Ie(l+"")||l==="auto"||(l+=ct.units[p]||Ie(en(n,p))||""),(l+"").charAt(1)==="="&&(l=en(n,p))):l=en(n,p),h=parseFloat(l),_=d==="string"&&c.charAt(1)==="="&&c.substr(0,2),_&&(c=c.substr(2)),u=parseFloat(c),p in jt&&(p==="autoAlpha"&&(h===1&&en(n,"visibility")==="hidden"&&u&&(h=0),x.push("visibility",0,o.visibility),xn(this,o,"visibility",h?"inherit":"hidden",u?"inherit":"hidden",!u)),p!=="scale"&&p!=="transform"&&(p=jt[p],~p.indexOf(",")&&(p=p.split(",")[0]))),v=p in ln,v){if(this.styles.save(p),d==="string"&&c.substring(0,6)==="var(--"&&(c=wt(n,c.substring(4,c.indexOf(")"))),u=parseFloat(c)),y||(T=n._gsap,T.renderTransform&&!e.parseTransform||Ki(n,e.parseTransform),A=e.smoothOrigin!==!1&&T.smooth,y=this._pt=new Qe(this._pt,o,ce,0,1,T.renderTransform,T,0,-1),y.dep=1),p==="scale")this._pt=new Qe(this._pt,T,"scaleY",T.scaleY,(_?Sr(T.scaleY,_+u):u)-T.scaleY||0,zl),this._pt.u=0,s.push("scaleY",p),p+="X";else if(p==="transformOrigin"){x.push(Je,0,o[Je]),c=qE(c),T.svg?Hl(n,c,0,A,0,this):(g=parseFloat(c.split(" ")[2])||0,g!==T.zOrigin&&xn(this,T,"zOrigin",T.zOrigin,g),xn(this,o,p,mo(l),mo(c)));continue}else if(p==="svgOrigin"){Hl(n,c,1,A,0,this);continue}else if(p in bg){QE(this,T,p,h,_?Sr(h,_+c):c);continue}else if(p==="smoothOrigin"){xn(this,T,"smooth",T.smooth,c);continue}else if(p==="force3D"){T[p]=c;continue}else if(p==="transform"){JE(this,c,n);continue}}else p in o||(p=Yr(p)||p);if(v||(u||u===0)&&(h||h===0)&&!IE.test(c)&&p in o)m=(l+"").substr((h+"").length),u||(u=0),g=Ie(c)||(p in ct.units?ct.units[p]:m),m!==g&&(h=On(n,p,l,g)),this._pt=new Qe(this._pt,v?T:o,p,h,(_?Sr(h,_+u):u)-h,!v&&(g==="px"||p==="zIndex")&&e.autoRound!==!1?FE:zl),this._pt.u=g||0,m!==g&&g!=="%"&&(this._pt.b=l,this._pt.r=NE);else if(p in o)KE.call(this,n,p,l,_?_+c:c);else if(p in n)this.add(n,p,l||n[p],_?_+c:c,r,i);else if(p!=="parseTransform"){Uc(p,c);continue}v||(p in o?x.push(p,0,o[p]):typeof n[p]=="function"?x.push(p,2,n[p]()):x.push(p,1,l||n[p])),s.push(p)}}w&&hg(this)},render:function(n,e){if(e.tween._time||!Xc())for(var t=e._pt;t;)t.r(n,t.d),t=t._next;else e.styles.revert()},get:en,aliases:jt,getSetter:function(n,e,t){var r=jt[e];return r&&r.indexOf(",")<0&&(e=r),e in ln&&e!==Je&&(n._gsap.x||en(n,"x"))?t&&kd===t?e==="scale"?zE:BE:(kd=t||{})&&(e==="scale"?VE:$E):n.style&&!Dc(n.style[e])?UE:~e.indexOf("-")?jE:Wc(n,e)},core:{_removeProperty:rr,_getMatrix:Zc}};et.utils.checkPrefix=Yr;et.core.getStyleSaver=gg;(function(n,e,t,r){var i=Ze(n+","+e+","+t,function(s){ln[s]=1});Ze(e,function(s){ct.units[s]="deg",bg[s]=1}),jt[i[13]]=n+","+e,Ze(r,function(s){var o=s.split(":");jt[o[1]]=i[o[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Ze("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(n){ct.units[n]="px"});et.registerPlugin(xg);var Qc=et.registerPlugin(xg)||et;Qc.core.Tween;const Gl={linear:"none",easeInQuad:"power2.in",easeOutQuad:"power2.out"};class e1{constructor(e,t,r={}){this.target=e,this.toVars=t,this.config=r}tween=null;start(){return new Promise(e=>{this.tween&&this.tween.kill();const{duration:t=.5,easing:r=Gl.linear,delay:i=0,repeat:s=0,yoyo:o=!1,onStart:a,onUpdate:l,onComplete:c,onPause:u,onResume:h}=this.config;this.tween=Qc.to(this.target.scale,{...this.toVars,duration:t,ease:r,delay:i,repeat:s,yoyo:o,onStart:()=>{a?.()},onUpdate:()=>{this.target.updateMatrixWorld(!0);const d=this.tween?.progress()||0;l?.(d,this.target)},onComplete:()=>{c?.(),e()},onPause:()=>{u?.()},onResume:()=>{h?.()}})})}stop(){this.tween&&(this.tween.kill(),this.tween=null)}isRunning(){return this.tween?this.tween.isActive():!1}pause(){this.tween&&this.tween.pause()}resume(){this.tween&&this.tween.resume()}progress(e){return this.tween?e!==void 0?(this.tween.progress(e),e):this.tween.progress():0}}function t1(n,e,t,r={}){return n.scale.copy(e),new e1(n,{x:t.x,y:t.y,z:t.z},r)}function zd(n,e,t,r={}){const i=new V.Vector3(1,e,1),s=new V.Vector3(1,t,1);return t1(n,i,s,r)}class Eg{animations=new Map;timeline=null;constructor(){this.timeline=Qc.timeline()}async startAnimation(e,t,r=!0){r&&this.animations.has(e)&&this.stopAnimation(e),this.animations.set(e,t);try{await t.start()}finally{this.animations.delete(e)}}stopAnimation(e){const t=this.animations.get(e);t&&(t.stop(),this.animations.delete(e))}pauseAnimation(e){const t=this.animations.get(e);t&&t.pause()}resumeAnimation(e){const t=this.animations.get(e);t&&t.resume()}setAnimationProgress(e,t){const r=this.animations.get(e);r&&r.progress(t)}stopAllAnimations(){this.animations.forEach(e=>e.stop()),this.animations.clear()}pauseAllAnimations(){this.animations.forEach(e=>e.pause())}resumeAllAnimations(){this.animations.forEach(e=>e.resume())}isAnimationRunning(e){const t=this.animations.get(e);return t?t.isRunning():!1}getRunningAnimationsCount(){return Array.from(this.animations.values()).filter(e=>e.isRunning()).length}getAnimationKeys(){return Array.from(this.animations.keys())}cleanup(){this.stopAllAnimations(),this.timeline&&(this.timeline.kill(),this.timeline=null)}}new Eg;const Vd={quickIn:{easing:Gl.easeOutQuad,duration:.3},quickOut:{easing:Gl.easeInQuad,duration:.2}},n1=["object"],IP=ue({__name:"Tileset",props:{url:{}},setup(n,{expose:e}){const t=n,{camera:r,renderer:i}=Qr();let s=wl(new Ml(t.url));s.fetchOptions.mode="cors",s.lruCache.minSize=900,s.lruCache.maxSize=1300,s.errorTarget=12,s.registerPlugin(new Ix),s.getPluginByName("DEBUG_TILES_PLUGIN").displayBoxBounds=!0;const o=new Eg;U(r,()=>{r.value&&(s.setCamera(r.value),s.setResolutionFromRenderer(r.value,i))},{immediate:!0}),s.addEventListener("load-model",({scene:c})=>{c.traverse(u=>{if(u.material){const h=u;Array.isArray(h.material)?h.material.forEach(d=>{d.side=V.DoubleSide}):h.material.side=V.DoubleSide}})});function a(c){return`tile_${c.uuid}`}Ux(s,async(c,u)=>{if(c){const h=c.children[0],d=a(h),f=zd(h,0,1,{...Vd.quickIn,duration:.2});await o.startAnimation(d,f,!0)}}),jx(s,async(c,u)=>{if(c){const h=c.children[0],d=a(h),f=zd(h,1,0,{...Vd.quickOut,duration:.2});await o.startAnimation(d,f,!0)}});const{onBeforeRender:l}=Yi();return l(()=>{s.update()}),tt(()=>{console.log("清理动画管理器"),o.cleanup()}),e({animationManager:o,pauseAllAnimations:()=>o.pauseAllAnimations(),resumeAllAnimations:()=>o.resumeAllAnimations(),stopAllAnimations:()=>o.stopAllAnimations(),getRunningAnimationsCount:()=>o.getRunningAnimationsCount(),getAnimationKeys:()=>o.getAnimationKeys()}),(c,u)=>C(s)?(re(),Ee("primitive",{key:0,object:C(s)?.group},null,8,n1)):at("",!0)}}),r1=parseInt(Gb.replace(/\D+/g,""));function $d(n,e){if(e===yf)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===Ur||e===xo){let t=n.getIndex();if(t===null){const o=[],a=n.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);n.setIndex(o),t=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const r=t.count-2,i=[];if(t)if(e===Ur)for(let o=1;o<=r;o++)i.push(t.getX(0)),i.push(t.getX(o)),i.push(t.getX(o+1));else for(let o=0;o<r;o++)o%2===0?(i.push(t.getX(o)),i.push(t.getX(o+1)),i.push(t.getX(o+2))):(i.push(t.getX(o+2)),i.push(t.getX(o+1)),i.push(t.getX(o)));i.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=n.clone();return s.setIndex(i),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}function go(n){if(typeof TextDecoder<"u")return new TextDecoder().decode(n);let e="";for(let t=0,r=n.length;t<r;t++)e+=String.fromCharCode(n[t]);try{return decodeURIComponent(escape(e))}catch{return e}}const Xn="srgb",sn="srgb-linear",Hd=3001,i1=3e3;class s1 extends Eo{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new u1(t)}),this.register(function(t){return new h1(t)}),this.register(function(t){return new b1(t)}),this.register(function(t){return new w1(t)}),this.register(function(t){return new T1(t)}),this.register(function(t){return new p1(t)}),this.register(function(t){return new f1(t)}),this.register(function(t){return new m1(t)}),this.register(function(t){return new g1(t)}),this.register(function(t){return new c1(t)}),this.register(function(t){return new _1(t)}),this.register(function(t){return new d1(t)}),this.register(function(t){return new y1(t)}),this.register(function(t){return new v1(t)}),this.register(function(t){return new a1(t)}),this.register(function(t){return new x1(t)}),this.register(function(t){return new E1(t)})}load(e,t,r,i){const s=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const c=Bt.extractUrlBase(e);o=Bt.resolveURL(c,this.path)}else o=Bt.extractUrlBase(e);this.manager.itemStart(e);const a=function(c){i?i(c):console.error(c),s.manager.itemError(e),s.manager.itemEnd(e)},l=new jr(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{s.parse(c,o,function(u){t(u),s.manager.itemEnd(e)},a)}catch(u){a(u)}},r,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,i){let s;const o={},a={};if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(go(new Uint8Array(e.slice(0,4)))===Ag){try{o[X.KHR_BINARY_GLTF]=new A1(e)}catch(c){i&&i(c);return}s=JSON.parse(o[X.KHR_BINARY_GLTF].content)}else s=JSON.parse(go(new Uint8Array(e)));else s=e;if(s.asset===void 0||s.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new U1(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const u=this.pluginCallbacks[c](l);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[u.name]=u,o[u.name]=!0}if(s.extensionsUsed)for(let c=0;c<s.extensionsUsed.length;++c){const u=s.extensionsUsed[c],h=s.extensionsRequired||[];switch(u){case X.KHR_MATERIALS_UNLIT:o[u]=new l1;break;case X.KHR_DRACO_MESH_COMPRESSION:o[u]=new P1(s,this.dracoLoader);break;case X.KHR_TEXTURE_TRANSFORM:o[u]=new M1;break;case X.KHR_MESH_QUANTIZATION:o[u]=new S1;break;default:h.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(o),l.setPlugins(a),l.parse(r,i)}parseAsync(e,t){const r=this;return new Promise(function(i,s){r.parse(e,t,i,s)})}}function o1(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const X={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class a1{constructor(e){this.parser=e,this.name=X.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let r=0,i=t.length;r<i;r++){const s=t[r];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,r="light:"+e;let i=t.cache.get(r);if(i)return i;const s=t.json,o=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let a;const l=new ke(16777215);o.color!==void 0&&l.setRGB(o.color[0],o.color[1],o.color[2],sn);const c=o.range!==void 0?o.range:0;switch(o.type){case"directional":a=new Tf(l),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new wf(l),a.distance=c;break;case"spot":a=new bf(l),a.distance=c,o.spot=o.spot||{},o.spot.innerConeAngle=o.spot.innerConeAngle!==void 0?o.spot.innerConeAngle:0,o.spot.outerConeAngle=o.spot.outerConeAngle!==void 0?o.spot.outerConeAngle:Math.PI/4,a.angle=o.spot.outerConeAngle,a.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return a.position.set(0,0,0),a.decay=2,Jt(a,o),o.intensity!==void 0&&(a.intensity=o.intensity),a.name=t.createUniqueName(o.name||"light_"+e),i=Promise.resolve(a),t.cache.add(r,i),i}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,r=this.parser,i=r.json.nodes[e],s=(i.extensions&&i.extensions[this.name]||{}).light;return s===void 0?null:this._loadLight(s).then(function(o){return r._getNodeRef(t.cache,s,o)})}}class l1{constructor(){this.name=X.KHR_MATERIALS_UNLIT}getMaterialType(){return $e}extendParams(e,t,r){const i=[];e.color=new ke(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],sn),e.opacity=o[3]}s.baseColorTexture!==void 0&&i.push(r.assignTexture(e,"map",s.baseColorTexture,Xn))}return Promise.all(i)}}class c1{constructor(e){this.parser=e,this.name=X.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name].emissiveStrength;return i!==void 0&&(t.emissiveIntensity=i),Promise.resolve()}}class u1{constructor(e){this.parser=e,this.name=X.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:ve}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&s.push(r.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&s.push(r.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(s.push(r.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Z(a,a)}return Promise.all(s)}}class h1{constructor(e){this.parser=e,this.name=X.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:ve}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name];return t.dispersion=i.dispersion!==void 0?i.dispersion:0,Promise.resolve()}}class d1{constructor(e){this.parser=e,this.name=X.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:ve}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&s.push(r.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&s.push(r.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}}class p1{constructor(e){this.parser=e,this.name=X.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:ve}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new ke(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=i.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],sn)}return o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&s.push(r.assignTexture(t,"sheenColorMap",o.sheenColorTexture,Xn)),o.sheenRoughnessTexture!==void 0&&s.push(r.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class f1{constructor(e){this.parser=e,this.name=X.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:ve}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&s.push(r.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class m1{constructor(e){this.parser=e,this.name=X.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:ve}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&s.push(r.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new ke().setRGB(a[0],a[1],a[2],sn),Promise.all(s)}}class g1{constructor(e){this.parser=e,this.name=X.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:ve}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name];return t.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class _1{constructor(e){this.parser=e,this.name=X.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:ve}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&s.push(r.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new ke().setRGB(a[0],a[1],a[2],sn),o.specularColorTexture!==void 0&&s.push(r.assignTexture(t,"specularColorMap",o.specularColorTexture,Xn)),Promise.all(s)}}class v1{constructor(e){this.parser=e,this.name=X.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:ve}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return t.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&s.push(r.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(s)}}class y1{constructor(e){this.parser=e,this.name=X.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:ve}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&s.push(r.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(s)}}class b1{constructor(e){this.parser=e,this.name=X.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,r=t.json,i=r.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const s=i.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,o)}}class w1{constructor(e){this.parser=e,this.name=X.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,i=r.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=i.images[o.source];let l=r.textureLoader;if(a.uri){const c=r.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return r.loadTextureImage(e,o.source,l);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class T1{constructor(e){this.parser=e,this.name=X.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,i=r.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=i.images[o.source];let l=r.textureLoader;if(a.uri){const c=r.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return r.loadTextureImage(e,o.source,l);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class x1{constructor(e){this.name=X.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,r=t.bufferViews[e];if(r.extensions&&r.extensions[this.name]){const i=r.extensions[this.name],s=this.parser.getDependency("buffer",i.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const l=i.byteOffset||0,c=i.byteLength||0,u=i.count,h=i.byteStride,d=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(u,h,d,i.mode,i.filter).then(function(f){return f.buffer}):o.ready.then(function(){const f=new ArrayBuffer(u*h);return o.decodeGltfBuffer(new Uint8Array(f),u,h,d,i.mode,i.filter),f})})}else return null}}class E1{constructor(e){this.name=X.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,r=t.nodes[e];if(!r.extensions||!r.extensions[this.name]||r.mesh===void 0)return null;const i=t.meshes[r.mesh];for(const l of i.primitives)if(l.mode!==vt.TRIANGLES&&l.mode!==vt.TRIANGLE_STRIP&&l.mode!==vt.TRIANGLE_FAN&&l.mode!==void 0)return null;const s=r.extensions[this.name].attributes,o=[],a={};for(const l in s)o.push(this.parser.getDependency("accessor",s[l]).then(c=>(a[l]=c,a[l])));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then(l=>{const c=l.pop(),u=c.isGroup?c.children:[c],h=l[0].count,d=[];for(const f of u){const p=new H,m=new P,g=new Fe,_=new P(1,1,1),v=new bc(f.geometry,f.material,h);for(let y=0;y<h;y++)a.TRANSLATION&&m.fromBufferAttribute(a.TRANSLATION,y),a.ROTATION&&g.fromBufferAttribute(a.ROTATION,y),a.SCALE&&_.fromBufferAttribute(a.SCALE,y),v.setMatrixAt(y,p.compose(m,g,_));for(const y in a)if(y==="_COLOR_0"){const T=a[y];v.instanceColor=new xf(T.array,T.itemSize,T.normalized)}else y!=="TRANSLATION"&&y!=="ROTATION"&&y!=="SCALE"&&f.geometry.setAttribute(y,a[y]);ti.prototype.copy.call(v,f),this.parser.assignFinalMaterial(v),d.push(v)}return c.isGroup?(c.clear(),c.add(...d),c):d[0]}))}}const Ag="glTF",_i=12,Gd={JSON:1313821514,BIN:5130562};class A1{constructor(e){this.name=X.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,_i);if(this.header={magic:go(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Ag)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-_i,i=new DataView(e,_i);let s=0;for(;s<r;){const o=i.getUint32(s,!0);s+=4;const a=i.getUint32(s,!0);if(s+=4,a===Gd.JSON){const l=new Uint8Array(e,_i+s,o);this.content=go(l)}else if(a===Gd.BIN){const l=_i+s;this.body=e.slice(l,l+o)}s+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class P1{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=X.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const r=this.json,i=this.dracoLoader,s=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const u in o){const h=Wl[u]||u.toLowerCase();a[h]=o[u]}for(const u in e.attributes){const h=Wl[u]||u.toLowerCase();if(o[u]!==void 0){const d=r.accessors[e.attributes[u]],f=Or[d.componentType];c[h]=f.name,l[h]=d.normalized===!0}}return t.getDependency("bufferView",s).then(function(u){return new Promise(function(h,d){i.decodeDracoFile(u,function(f){for(const p in f.attributes){const m=f.attributes[p],g=l[p];g!==void 0&&(m.normalized=g)}h(f)},a,c,sn,d)})})}}class M1{constructor(){this.name=X.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class S1{constructor(){this.name=X.KHR_MESH_QUANTIZATION}}class Pg extends Vf{constructor(e,t,r,i){super(e,t,r,i)}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,s=e*i*3+i;for(let o=0;o!==i;o++)t[o]=r[s+o];return t}interpolate_(e,t,r,i){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,u=i-t,h=(r-t)/u,d=h*h,f=d*h,p=e*c,m=p-c,g=-2*f+3*d,_=f-d,v=1-g,y=_-d+h;for(let T=0;T!==a;T++){const A=o[m+T+a],w=o[m+T+l]*u,x=o[p+T+a],b=o[p+T]*u;s[T]=v*A+y*w+g*x+_*b}return s}}const C1=new Fe;class R1 extends Pg{interpolate_(e,t,r,i){const s=super.interpolate_(e,t,r,i);return C1.fromArray(s).normalize().toArray(s),s}}const vt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Or={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Wd={9728:wc,9729:Ui,9984:Cf,9985:Sf,9986:Mf,9987:Ao},Kd={33071:Of,33648:Rf,10497:zr},Ha={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Wl={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...r1>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},fn={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},O1={CUBICSPLINE:void 0,LINEAR:Mo,STEP:Bf},Ga={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function k1(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new es({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:zf})),n.DefaultMaterial}function zn(n,e,t){for(const r in t.extensions)n[r]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=t.extensions[r])}function Jt(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function L1(n,e,t){let r=!1,i=!1,s=!1;for(let c=0,u=e.length;c<u;c++){const h=e[c];if(h.POSITION!==void 0&&(r=!0),h.NORMAL!==void 0&&(i=!0),h.COLOR_0!==void 0&&(s=!0),r&&i&&s)break}if(!r&&!i&&!s)return Promise.resolve(n);const o=[],a=[],l=[];for(let c=0,u=e.length;c<u;c++){const h=e[c];if(r){const d=h.POSITION!==void 0?t.getDependency("accessor",h.POSITION):n.attributes.position;o.push(d)}if(i){const d=h.NORMAL!==void 0?t.getDependency("accessor",h.NORMAL):n.attributes.normal;a.push(d)}if(s){const d=h.COLOR_0!==void 0?t.getDependency("accessor",h.COLOR_0):n.attributes.color;l.push(d)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const u=c[0],h=c[1],d=c[2];return r&&(n.morphAttributes.position=u),i&&(n.morphAttributes.normal=h),s&&(n.morphAttributes.color=d),n.morphTargetsRelative=!0,n})}function I1(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,r=e.weights.length;t<r;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let r=0,i=t.length;r<i;r++)n.morphTargetDictionary[t[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function D1(n){let e;const t=n.extensions&&n.extensions[X.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+Wa(t.attributes):e=n.indices+":"+Wa(n.attributes)+":"+n.mode,n.targets!==void 0)for(let r=0,i=n.targets.length;r<i;r++)e+=":"+Wa(n.targets[r]);return e}function Wa(n){let e="";const t=Object.keys(n).sort();for(let r=0,i=t.length;r<i;r++)e+=t[r]+":"+n[t[r]]+";";return e}function Kl(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function N1(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const F1=new H;class U1{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new o1,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,i=!1,s=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(r=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,i=navigator.userAgent.indexOf("Firefox")>-1,s=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||r||i&&s<98?this.textureLoader=new To(this.options.manager):this.textureLoader=new Ef(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new jr(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const r=this,i=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(o){const a={scene:o[0][i.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:i.asset,parser:r,userData:{}};return zn(s,a,i),Jt(a,i),Promise.all(r._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){for(const l of a.scenes)l.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[];for(let i=0,s=t.length;i<s;i++){const o=t[i].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let i=0,s=e.length;i<s;i++){const o=e[i];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(r[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;const i=r.clone(),s=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,u]of o.children.entries())s(u,a.children[c])};return s(r,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let r=0;r<t.length;r++){const i=e(t[r]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const r=[];for(let i=0;i<t.length;i++){const s=e(t[i]);s&&r.push(s)}return r}getDependency(e,t){const r=e+":"+t;let i=this.cache.get(r);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":i=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e);break}this.cache.add(r,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const r=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(s,o){return r.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],r=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[X.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(s,o){r.load(Bt.resolveURL(t.uri,i.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(r){const i=t.byteLength||0,s=t.byteOffset||0;return r.slice(s,s+i)})}loadAccessor(e){const t=this,r=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0){const o=Ha[i.type],a=Or[i.componentType],l=i.normalized===!0,c=new a(i.count*o);return Promise.resolve(new Ce(c,o,l))}const s=[];return i.bufferView!==void 0?s.push(this.getDependency("bufferView",i.bufferView)):s.push(null),i.sparse!==void 0&&(s.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(s).then(function(o){const a=o[0],l=Ha[i.type],c=Or[i.componentType],u=c.BYTES_PER_ELEMENT,h=u*l,d=i.byteOffset||0,f=i.bufferView!==void 0?r.bufferViews[i.bufferView].byteStride:void 0,p=i.normalized===!0;let m,g;if(f&&f!==h){const _=Math.floor(d/f),v="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+_+":"+i.count;let y=t.cache.get(v);y||(m=new c(a,_*f,i.count*f/u),y=new Af(m,f/u),t.cache.add(v,y)),g=new Pf(y,l,d%f/u,p)}else a===null?m=new c(i.count*l):m=new c(a,d,i.count*l),g=new Ce(m,l,p);if(i.sparse!==void 0){const _=Ha.SCALAR,v=Or[i.sparse.indices.componentType],y=i.sparse.indices.byteOffset||0,T=i.sparse.values.byteOffset||0,A=new v(o[1],y,i.sparse.count*_),w=new c(o[2],T,i.sparse.count*l);a!==null&&(g=new Ce(g.array.slice(),g.itemSize,g.normalized));for(let x=0,b=A.length;x<b;x++){const E=A[x];if(g.setX(E,w[x*l]),l>=2&&g.setY(E,w[x*l+1]),l>=3&&g.setZ(E,w[x*l+2]),l>=4&&g.setW(E,w[x*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g})}loadTexture(e){const t=this.json,r=this.options,i=t.textures[e].source,s=t.images[i];let o=this.textureLoader;if(s.uri){const a=r.manager.getHandler(s.uri);a!==null&&(o=a)}return this.loadTextureImage(e,i,o)}loadTextureImage(e,t,r){const i=this,s=this.json,o=s.textures[e],a=s.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,r).then(function(u){u.flipY=!1,u.name=o.name||a.name||"",u.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(u.name=a.uri);const h=(s.samplers||{})[o.sampler]||{};return u.magFilter=Wd[h.magFilter]||Ui,u.minFilter=Wd[h.minFilter]||Ao,u.wrapS=Kd[h.wrapS]||zr,u.wrapT=Kd[h.wrapT]||zr,i.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const r=this,i=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(h=>h.clone());const o=i.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=r.getDependency("bufferView",o.bufferView).then(function(h){c=!0;const d=new Blob([h],{type:o.mimeType});return l=a.createObjectURL(d),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(l).then(function(h){return new Promise(function(d,f){let p=d;t.isImageBitmapLoader===!0&&(p=function(m){const g=new ji(m);g.needsUpdate=!0,d(g)}),t.load(Bt.resolveURL(h,s.path),p,void 0,f)})}).then(function(h){return c===!0&&a.revokeObjectURL(l),Jt(h,o),h.userData.mimeType=o.mimeType||N1(o.uri),h}).catch(function(h){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),h});return this.sourceCache[e]=u,u}assignTexture(e,t,r,i){const s=this;return this.getDependency("texture",r.index).then(function(o){if(!o)return null;if(r.texCoord!==void 0&&r.texCoord>0&&(o=o.clone(),o.channel=r.texCoord),s.extensions[X.KHR_TEXTURE_TRANSFORM]){const a=r.extensions!==void 0?r.extensions[X.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=s.associations.get(o);o=s.extensions[X.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),s.associations.set(o,l)}}return i!==void 0&&(typeof i=="number"&&(i=i===Hd?Xn:sn),"colorSpace"in o?o.colorSpace=i:o.encoding=i===Xn?Hd:i1),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let r=e.material;const i=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+r.uuid;let l=this.cache.get(a);l||(l=new ni,Ar.prototype.copy.call(l,r),l.color.copy(r.color),l.map=r.map,l.sizeAttenuation=!1,this.cache.add(a,l)),r=l}else if(e.isLine){const a="LineBasicMaterial:"+r.uuid;let l=this.cache.get(a);l||(l=new _c,Ar.prototype.copy.call(l,r),l.color.copy(r.color),l.map=r.map,this.cache.add(a,l)),r=l}if(i||s||o){let a="ClonedMaterial:"+r.uuid+":";i&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=r.clone(),s&&(l.vertexColors=!0),o&&(l.flatShading=!0),i&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(r))),r=l}e.material=r}getMaterialType(){return es}loadMaterial(e){const t=this,r=this.json,i=this.extensions,s=r.materials[e];let o;const a={},l=s.extensions||{},c=[];if(l[X.KHR_MATERIALS_UNLIT]){const h=i[X.KHR_MATERIALS_UNLIT];o=h.getMaterialType(),c.push(h.extendParams(a,s,t))}else{const h=s.pbrMetallicRoughness||{};if(a.color=new ke(1,1,1),a.opacity=1,Array.isArray(h.baseColorFactor)){const d=h.baseColorFactor;a.color.setRGB(d[0],d[1],d[2],sn),a.opacity=d[3]}h.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",h.baseColorTexture,Xn)),a.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,a.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",h.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",h.metallicRoughnessTexture))),o=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(e,a)})))}s.doubleSided===!0&&(a.side=vc);const u=s.alphaMode||Ga.OPAQUE;if(u===Ga.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===Ga.MASK&&(a.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&o!==$e&&(c.push(t.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new Z(1,1),s.normalTexture.scale!==void 0)){const h=s.normalTexture.scale;a.normalScale.set(h,h)}if(s.occlusionTexture!==void 0&&o!==$e&&(c.push(t.assignTexture(a,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&o!==$e){const h=s.emissiveFactor;a.emissive=new ke().setRGB(h[0],h[1],h[2],sn)}return s.emissiveTexture!==void 0&&o!==$e&&c.push(t.assignTexture(a,"emissiveMap",s.emissiveTexture,Xn)),Promise.all(c).then(function(){const h=new o(a);return s.name&&(h.name=s.name),Jt(h,s),t.associations.set(h,{materials:e}),s.extensions&&zn(i,h,s),h})}createUniqueName(e){const t=kf.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,r=this.extensions,i=this.primitiveCache;function s(a){return r[X.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return qd(l,a,t)})}const o=[];for(let a=0,l=e.length;a<l;a++){const c=e[a],u=D1(c),h=i[u];if(h)o.push(h.promise);else{let d;c.extensions&&c.extensions[X.KHR_DRACO_MESH_COMPRESSION]?d=s(c):d=qd(new xt,c,t),i[u]={primitive:c,promise:d},o.push(d)}}return Promise.all(o)}loadMesh(e){const t=this,r=this.json,i=this.extensions,s=r.meshes[e],o=s.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const u=o[l].material===void 0?k1(this.cache):this.getDependency("material",o[l].material);a.push(u)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),u=l[l.length-1],h=[];for(let f=0,p=u.length;f<p;f++){const m=u[f],g=o[f];let _;const v=c[f];if(g.mode===vt.TRIANGLES||g.mode===vt.TRIANGLE_STRIP||g.mode===vt.TRIANGLE_FAN||g.mode===void 0)_=s.isSkinnedMesh===!0?new Lf(m,v):new Tt(m,v),_.isSkinnedMesh===!0&&_.normalizeSkinWeights(),g.mode===vt.TRIANGLE_STRIP?_.geometry=$d(_.geometry,xo):g.mode===vt.TRIANGLE_FAN&&(_.geometry=$d(_.geometry,Ur));else if(g.mode===vt.LINES)_=new Po(m,v);else if(g.mode===vt.LINE_STRIP)_=new vf(m,v);else if(g.mode===vt.LINE_LOOP)_=new If(m,v);else if(g.mode===vt.POINTS)_=new Ji(m,v);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(_.geometry.morphAttributes).length>0&&I1(_,s),_.name=t.createUniqueName(s.name||"mesh_"+e),Jt(_,s),g.extensions&&zn(i,_,g),t.assignFinalMaterial(_),h.push(_)}for(let f=0,p=h.length;f<p;f++)t.associations.set(h[f],{meshes:e,primitives:f});if(h.length===1)return s.extensions&&zn(i,h[0],s),h[0];const d=new Ae;s.extensions&&zn(i,d,s),t.associations.set(d,{meshes:e});for(let f=0,p=h.length;f<p;f++)d.add(h[f]);return d})}loadCamera(e){let t;const r=this.json.cameras[e],i=r[r.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return r.type==="perspective"?t=new Df(j.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):r.type==="orthographic"&&(t=new Nf(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),Jt(t,r),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],r=[];for(let i=0,s=t.joints.length;i<s;i++)r.push(this._loadNodeShallow(t.joints[i]));return t.inverseBindMatrices!==void 0?r.push(this.getDependency("accessor",t.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(i){const s=i.pop(),o=i,a=[],l=[];for(let c=0,u=o.length;c<u;c++){const h=o[c];if(h){a.push(h);const d=new H;s!==null&&d.fromArray(s.array,c*16),l.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new Ff(a,l)})}loadAnimation(e){const t=this.json,r=this,i=t.animations[e],s=i.name?i.name:"animation_"+e,o=[],a=[],l=[],c=[],u=[];for(let h=0,d=i.channels.length;h<d;h++){const f=i.channels[h],p=i.samplers[f.sampler],m=f.target,g=m.node,_=i.parameters!==void 0?i.parameters[p.input]:p.input,v=i.parameters!==void 0?i.parameters[p.output]:p.output;m.node!==void 0&&(o.push(this.getDependency("node",g)),a.push(this.getDependency("accessor",_)),l.push(this.getDependency("accessor",v)),c.push(p),u.push(m))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(u)]).then(function(h){const d=h[0],f=h[1],p=h[2],m=h[3],g=h[4],_=[];for(let v=0,y=d.length;v<y;v++){const T=d[v],A=f[v],w=p[v],x=m[v],b=g[v];if(T===void 0)continue;T.updateMatrix&&T.updateMatrix();const E=r._createAnimationTracks(T,A,w,x,b);if(E)for(let M=0;M<E.length;M++)_.push(E[M])}return new Uf(s,void 0,_)})}createNodeMesh(e){const t=this.json,r=this,i=t.nodes[e];return i.mesh===void 0?null:r.getDependency("mesh",i.mesh).then(function(s){const o=r._getNodeRef(r.meshCache,i.mesh,s);return i.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,c=i.weights.length;l<c;l++)a.morphTargetInfluences[l]=i.weights[l]}),o})}loadNode(e){const t=this.json,r=this,i=t.nodes[e],s=r._loadNodeShallow(e),o=[],a=i.children||[];for(let c=0,u=a.length;c<u;c++)o.push(r.getDependency("node",a[c]));const l=i.skin===void 0?Promise.resolve(null):r.getDependency("skin",i.skin);return Promise.all([s,Promise.all(o),l]).then(function(c){const u=c[0],h=c[1],d=c[2];d!==null&&u.traverse(function(f){f.isSkinnedMesh&&f.bind(d,F1)});for(let f=0,p=h.length;f<p;f++)u.add(h[f]);return u})}_loadNodeShallow(e){const t=this.json,r=this.extensions,i=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],o=s.name?i.createUniqueName(s.name):"",a=[],l=i._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),s.camera!==void 0&&a.push(i.getDependency("camera",s.camera).then(function(c){return i._getNodeRef(i.cameraCache,s.camera,c)})),i._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let u;if(s.isBone===!0?u=new jf:c.length>1?u=new Ae:c.length===1?u=c[0]:u=new ti,u!==c[0])for(let h=0,d=c.length;h<d;h++)u.add(c[h]);if(s.name&&(u.userData.name=s.name,u.name=o),Jt(u,s),s.extensions&&zn(r,u,s),s.matrix!==void 0){const h=new H;h.fromArray(s.matrix),u.applyMatrix4(h)}else s.translation!==void 0&&u.position.fromArray(s.translation),s.rotation!==void 0&&u.quaternion.fromArray(s.rotation),s.scale!==void 0&&u.scale.fromArray(s.scale);return i.associations.has(u)||i.associations.set(u,{}),i.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const t=this.extensions,r=this.json.scenes[e],i=this,s=new Ae;r.name&&(s.name=i.createUniqueName(r.name)),Jt(s,r),r.extensions&&zn(t,s,r);const o=r.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(i.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let u=0,h=l.length;u<h;u++)s.add(l[u]);const c=u=>{const h=new Map;for(const[d,f]of i.associations)(d instanceof Ar||d instanceof ji)&&h.set(d,f);return u.traverse(d=>{const f=i.associations.get(d);f!=null&&h.set(d,f)}),h};return i.associations=c(s),s})}_createAnimationTracks(e,t,r,i,s){const o=[],a=e.name?e.name:e.uuid,l=[];fn[s.path]===fn.weights?e.traverse(function(d){d.morphTargetInfluences&&l.push(d.name?d.name:d.uuid)}):l.push(a);let c;switch(fn[s.path]){case fn.weights:c=Js;break;case fn.rotation:c=eo;break;case fn.position:case fn.scale:c=Qs;break;default:switch(r.itemSize){case 1:c=Js;break;case 2:case 3:default:c=Qs;break}break}const u=i.interpolation!==void 0?O1[i.interpolation]:Mo,h=this._getArrayFromAccessor(r);for(let d=0,f=l.length;d<f;d++){const p=new c(l[d]+"."+fn[s.path],t.array,h,u);i.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(p),o.push(p)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const r=Kl(t.constructor),i=new Float32Array(t.length);for(let s=0,o=t.length;s<o;s++)i[s]=t[s]*r;t=i}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(t){const r=this instanceof eo?R1:Pg;return new r(this.times,this.values,this.getValueSize()/3,t)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function j1(n,e,t){const r=e.attributes,i=new Tc;if(r.POSITION!==void 0){const a=t.json.accessors[r.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(i.set(new P(l[0],l[1],l[2]),new P(c[0],c[1],c[2])),a.normalized){const u=Kl(Or[a.componentType]);i.min.multiplyScalar(u),i.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const a=new P,l=new P;for(let c=0,u=s.length;c<u;c++){const h=s[c];if(h.POSITION!==void 0){const d=t.json.accessors[h.POSITION],f=d.min,p=d.max;if(f!==void 0&&p!==void 0){if(l.setX(Math.max(Math.abs(f[0]),Math.abs(p[0]))),l.setY(Math.max(Math.abs(f[1]),Math.abs(p[1]))),l.setZ(Math.max(Math.abs(f[2]),Math.abs(p[2]))),d.normalized){const m=Kl(Or[d.componentType]);l.multiplyScalar(m)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(a)}n.boundingBox=i;const o=new sr;i.getCenter(o.center),o.radius=i.min.distanceTo(i.max)/2,n.boundingSphere=o}function qd(n,e,t){const r=e.attributes,i=[];function s(o,a){return t.getDependency("accessor",o).then(function(l){n.setAttribute(a,l)})}for(const o in r){const a=Wl[o]||o.toLowerCase();a in n.attributes||i.push(s(r[o],a))}if(e.indices!==void 0&&!n.index){const o=t.getDependency("accessor",e.indices).then(function(a){n.setIndex(a)});i.push(o)}return Jt(n,e),j1(n,e,t),Promise.all(i).then(function(){return e.targets!==void 0?L1(n,e.targets,t):n})}const Ka=new WeakMap;class B1 extends Eo{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,i){const s=new jr(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,o=>{const a={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(o,a).then(t).catch(i)},r,i)}decodeDracoFile(e,t,r,i){const s={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!r};this.decodeGeometry(e,s).then(t)}decodeGeometry(e,t){for(const l in t.attributeTypes){const c=t.attributeTypes[l];c.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[l]=c.name)}const r=JSON.stringify(t);if(Ka.has(e)){const l=Ka.get(e);if(l.key===r)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const s=this.workerNextTaskID++,o=e.byteLength,a=this._getWorker(s,o).then(l=>(i=l,new Promise((c,u)=>{i._callbacks[s]={resolve:c,reject:u},i.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return a.catch(()=>!0).then(()=>{i&&s&&this._releaseTask(i,s)}),Ka.set(e,{key:r,promise:a}),a}_createGeometry(e){const t=new xt;e.index&&t.setIndex(new Ce(e.index.array,1));for(let r=0;r<e.attributes.length;r++){const i=e.attributes[r],s=i.name,o=i.array,a=i.itemSize;t.setAttribute(s,new Ce(o,a))}return t}_loadLibrary(e,t){const r=new jr(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),r.setWithCredentials(this.withCredentials),new Promise((i,s)=>{r.load(e,i,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(r=>{const i=r[0];e||(this.decoderConfig.wasmBinary=r[1]);const s=z1.toString(),o=["/* draco decoder */",i,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const i=new Worker(this.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:this.decoderConfig}),i.onmessage=function(s){const o=s.data;switch(o.type){case"decode":i._callbacks[o.id].resolve(o);break;case"error":i._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(i)}else this.workerPool.sort(function(i,s){return i._taskLoad>s._taskLoad?-1:1});const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function z1(){let n,e;onmessage=function(o){const a=o.data;switch(a.type){case"init":n=a.decoderConfig,e=new Promise(function(u){n.onModuleLoaded=function(h){u({draco:h})},DracoDecoderModule(n)});break;case"decode":const l=a.buffer,c=a.taskConfig;e.then(u=>{const h=u.draco,d=new h.Decoder,f=new h.DecoderBuffer;f.Init(new Int8Array(l),l.byteLength);try{const p=t(h,d,f,c),m=p.attributes.map(g=>g.array.buffer);p.index&&m.push(p.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:p},m)}catch(p){console.error(p),self.postMessage({type:"error",id:a.id,error:p.message})}finally{h.destroy(f),h.destroy(d)}});break}};function t(o,a,l,c){const u=c.attributeIDs,h=c.attributeTypes;let d,f;const p=a.GetEncodedGeometryType(l);if(p===o.TRIANGULAR_MESH)d=new o.Mesh,f=a.DecodeBufferToMesh(l,d);else if(p===o.POINT_CLOUD)d=new o.PointCloud,f=a.DecodeBufferToPointCloud(l,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!f.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+f.error_msg());const m={index:null,attributes:[]};for(const g in u){const _=self[h[g]];let v,y;if(c.useUniqueIDs)y=u[g],v=a.GetAttributeByUniqueId(d,y);else{if(y=a.GetAttributeId(d,o[u[g]]),y===-1)continue;v=a.GetAttribute(d,y)}m.attributes.push(i(o,a,d,g,_,v))}return p===o.TRIANGULAR_MESH&&(m.index=r(o,a,d)),o.destroy(d),m}function r(o,a,l){const c=l.num_faces()*3,u=c*4,h=o._malloc(u);a.GetTrianglesUInt32Array(l,u,h);const d=new Uint32Array(o.HEAPF32.buffer,h,c).slice();return o._free(h),{array:d,itemSize:1}}function i(o,a,l,c,u,h){const d=h.num_components(),f=l.num_points()*d,p=f*u.BYTES_PER_ELEMENT,m=s(o,u),g=o._malloc(p);a.GetAttributeDataArrayForAllPoints(l,h,m,p,g);const _=new u(o.HEAPF32.buffer,g,f).slice();return o._free(g),{name:c,array:_,itemSize:d}}function s(o,a){switch(a){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}class V1 extends Eo{gltfLoader;constructor(e){super(e),this.gltfLoader=new s1(e)}load(e,t,r,i){const s=Array.isArray(e)?e[0]:e;this.gltfLoader.load(s,t,r,i)}async loadAsync(e){const t=Array.isArray(e)?e[0]:e;return this.gltfLoader.loadAsync(t)}setDRACOLoader(e){return this.gltfLoader.setDRACOLoader(e)}}const $1=V1;function H1(n,e){let t=null;return{loaderExtension:r=>{n.draco&&(t||(t=new B1),t.setDecoderPath(n.decoderPath||"https://www.gstatic.com/draco/versioned/decoders/1.4.3/"),r.setDRACOLoader&&r.setDRACOLoader(t))},dracoLoader:()=>t}}async function G1(n,e={draco:!1},t){const{loaderExtension:r,dracoLoader:i}=H1(e),s=await bv($1,n,{extensions:r}),o=i();return o&&o.dispose(),s}const W1=["object"],DP=ue({__name:"GeoGLTF",props:{url:{},draco:{type:Boolean,default:!1},decoderPath:{default:"./draco/"},renderOrder:{default:1}},setup(n){const e=n,t=Re();return Me(async()=>{const{scene:r}=await G1(e.url,{draco:e.draco,decoderPath:e.draco?e.decoderPath:void 0});t.value=r,t.value.userData.tiles=[],t.value.renderOrder=e.renderOrder}),(r,i)=>t.value?(re(),Ee("primitive",{key:0,object:t.value,scale:1,position:[0,0,0]},null,8,W1)):at("",!0)}}),K1=ue({__name:"GeoCSS2DRenderer",setup(n){const{camera:e,renderer:t}=Qr(),r=Re(),i=()=>{r.value?.setSize(window.innerWidth,window.innerHeight)};return Me(()=>{e.value&&e.value.layers.enableAll(),r.value=new Kb,r.value.setSize(window.innerWidth,window.innerHeight),r.value.domElement.style.position="fixed",r.value.domElement.style.top="0",r.value.domElement.style.left="0",r.value.domElement.style.pointerEvents="none",t.domElement?.parentElement?.appendChild(r.value.domElement);const{onRender:s}=Yi();s(({scene:o,camera:a})=>{r.value?.render(o.value,a.value)}),window.addEventListener("resize",i)}),Sb(()=>{window.removeEventListener("resize",i),t.domElement?.parentElement?.removeChild(r.value.domElement)}),()=>{}}}),NP=ue({__name:"GeoCanvas",props:{canvasConfig:{default:()=>({windowSize:!0,alpha:!0,antialias:!0,shadows:!1,autoClear:!0,disableRender:!0,outputColorSpace:V.SRGBColorSpace,toneMapping:V.NoToneMapping,pixelRatio:1})},cameraConfig:{default:()=>({fov:29,aspect:window.innerWidth/window.innerHeight,near:1,far:1e4,position:[0,0,1.75*1e7],lookAt:[0,0,0]})}},setup(n){const e=n,{canvasConfig:t,cameraConfig:r}=e,i=Ne(null);return Me(()=>{const s=i.value?.context?.renderer?.instance;s&&(window.devicePixelRatio=t.pixelRatio,s.setPixelRatio(window.devicePixelRatio))}),(s,o)=>(re(),Ft(C(Eb),Cb({clearColor:"#fff"},C(t),{ref_key:"canvasRef",ref:i}),{default:Qi(()=>[nr("TresPerspectiveCamera",Ob(kb(C(r))),null,16),Rb(K1),Ct(s.$slots,"default")]),_:3},16))}}),Xd={type:"change"},Jc={type:"start"},Mg={type:"end"},Ds=new Rt,Yd=new ts,q1=Math.cos(70*j.DEG2RAD),be=new P,Xe=2*Math.PI,ne={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},qa=1e-6;class X1 extends Wb{constructor(e,t=null){super(e,t),this.state=ne.NONE,this.target=new P,this.cursor=new P,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:nn.ROTATE,MIDDLE:nn.DOLLY,RIGHT:nn.PAN},this.touches={ONE:yn.ROTATE,TWO:yn.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new P,this._lastQuaternion=new Fe,this._lastTargetPosition=new P,this._quat=new Fe().setFromUnitVectors(e.up,new P(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new to,this._sphericalDelta=new to,this._scale=1,this._panOffset=new P,this._rotateStart=new Z,this._rotateEnd=new Z,this._rotateDelta=new Z,this._panStart=new Z,this._panEnd=new Z,this._panDelta=new Z,this._dollyStart=new Z,this._dollyEnd=new Z,this._dollyDelta=new Z,this._dollyDirection=new P,this._mouse=new Z,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Z1.bind(this),this._onPointerDown=Y1.bind(this),this._onPointerUp=Q1.bind(this),this._onContextMenu=sA.bind(this),this._onMouseWheel=tA.bind(this),this._onKeyDown=nA.bind(this),this._onTouchStart=rA.bind(this),this._onTouchMove=iA.bind(this),this._onMouseDown=J1.bind(this),this._onMouseMove=eA.bind(this),this._interceptControlDown=oA.bind(this),this._interceptControlUp=aA.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(Xd),this.update(),this.state=ne.NONE}update(e=null){const t=this.object.position;be.copy(t).sub(this.target),be.applyQuaternion(this._quat),this._spherical.setFromVector3(be),this.autoRotate&&this.state===ne.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let r=this.minAzimuthAngle,i=this.maxAzimuthAngle;isFinite(r)&&isFinite(i)&&(r<-Math.PI?r+=Xe:r>Math.PI&&(r-=Xe),i<-Math.PI?i+=Xe:i>Math.PI&&(i-=Xe),r<=i?this._spherical.theta=Math.max(r,Math.min(i,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(r+i)/2?Math.max(r,this._spherical.theta):Math.min(i,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=o!=this._spherical.radius}if(be.setFromSpherical(this._spherical),be.applyQuaternion(this._quatInverse),t.copy(this.target).add(be),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const a=be.length();o=this._clampDistance(a*this._scale);const l=a-o;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),s=!!l}else if(this.object.isOrthographicCamera){const a=new P(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=l!==this.object.zoom;const c=new P(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(a),this.object.updateMatrixWorld(),o=be.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(Ds.origin.copy(this.object.position),Ds.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(Ds.direction))<q1?this.object.lookAt(this.target):(Yd.setFromNormalAndCoplanarPoint(this.object.up,this.target),Ds.intersectPlane(Yd,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,s||this._lastPosition.distanceToSquared(this.object.position)>qa||8*(1-this._lastQuaternion.dot(this.object.quaternion))>qa||this._lastTargetPosition.distanceToSquared(this.target)>qa?(this.dispatchEvent(Xd),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Xe/60*this.autoRotateSpeed*e:Xe/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){be.setFromMatrixColumn(t,0),be.multiplyScalar(-e),this._panOffset.add(be)}_panUp(e,t){this.screenSpacePanning===!0?be.setFromMatrixColumn(t,1):(be.setFromMatrixColumn(t,0),be.crossVectors(this.object.up,be)),be.multiplyScalar(e),this._panOffset.add(be)}_pan(e,t){const r=this.domElement;if(this.object.isPerspectiveCamera){const i=this.object.position;be.copy(i).sub(this.target);let s=be.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*s/r.clientHeight,this.object.matrix),this._panUp(2*t*s/r.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/r.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/r.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const r=this.domElement.getBoundingClientRect(),i=e-r.left,s=t-r.top,o=r.width,a=r.height;this._mouse.x=i/o*2-1,this._mouse.y=-(s/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Xe*this._rotateDelta.x/t.clientHeight),this._rotateUp(Xe*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(Xe*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-Xe*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(Xe*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-Xe*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._rotateStart.set(r,i)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panStart.set(r,i)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),r=e.pageX-t.x,i=e.pageY-t.y,s=Math.sqrt(r*r+i*i);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const r=this._getSecondPointerPosition(e),i=.5*(e.pageX+r.x),s=.5*(e.pageY+r.y);this._rotateEnd.set(i,s)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Xe*this._rotateDelta.x/t.clientHeight),this._rotateUp(Xe*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panEnd.set(r,i)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),r=e.pageX-t.x,i=e.pageY-t.y,s=Math.sqrt(r*r+i*i);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(e.pageX+t.x)*.5,a=(e.pageY+t.y)*.5;this._updateZoomParameters(o,a)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new Z,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,r={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:r.deltaY*=16;break;case 2:r.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(r.deltaY*=10),r}}function Y1(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(n)&&(this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n)))}function Z1(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function Q1(n){switch(this._removePointer(n),this._pointers.length){case 0:this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(Mg),this.state=ne.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function J1(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case nn.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(n),this.state=ne.DOLLY;break;case nn.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=ne.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=ne.ROTATE}break;case nn.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=ne.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=ne.PAN}break;default:this.state=ne.NONE}this.state!==ne.NONE&&this.dispatchEvent(Jc)}function eA(n){switch(this.state){case ne.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(n);break;case ne.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(n);break;case ne.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(n);break}}function tA(n){this.enabled===!1||this.enableZoom===!1||this.state!==ne.NONE||(n.preventDefault(),this.dispatchEvent(Jc),this._handleMouseWheel(this._customWheelEvent(n)),this.dispatchEvent(Mg))}function nA(n){this.enabled!==!1&&this._handleKeyDown(n)}function rA(n){switch(this._trackPointer(n),this._pointers.length){case 1:switch(this.touches.ONE){case yn.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(n),this.state=ne.TOUCH_ROTATE;break;case yn.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(n),this.state=ne.TOUCH_PAN;break;default:this.state=ne.NONE}break;case 2:switch(this.touches.TWO){case yn.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(n),this.state=ne.TOUCH_DOLLY_PAN;break;case yn.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(n),this.state=ne.TOUCH_DOLLY_ROTATE;break;default:this.state=ne.NONE}break;default:this.state=ne.NONE}this.state!==ne.NONE&&this.dispatchEvent(Jc)}function iA(n){switch(this._trackPointer(n),this.state){case ne.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(n),this.update();break;case ne.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(n),this.update();break;case ne.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(n),this.update();break;case ne.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(n),this.update();break;default:this.state=ne.NONE}}function sA(n){this.enabled!==!1&&n.preventDefault()}function oA(n){n.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function aA(n){n.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}class lA extends X1{constructor(e,t){super(e,t),this.screenSpacePanning=!1,this.mouseButtons={LEFT:nn.PAN,MIDDLE:nn.DOLLY,RIGHT:nn.ROTATE},this.touches={ONE:yn.PAN,TWO:yn.DOLLY_ROTATE}}}const cA={type:"change"},Ns=new Rt,Zd=new ts,K=new P,Xa=new Tt(new $f(10,10,10),new $e({color:16711680})),uA=Math.cos(70*j.DEG2RAD),Fs=2*Math.PI,hA={NONE:-1},Ya=1e-6,dA=He(0,89.99999,0).normalize();console.log(dA);const pA=n=>{const e=new P;return Cn.WGS84.getSurfaceNormal(n,e),e};class fA extends lA{_persistentPanOffset=new P(0,0,0);resetPanOffset(){this._persistentPanOffset.set(0,0,0)}constructor(e,t,r=!1){super(e,t),r&&e.parent?.add(Xa)}targetUp=new P(0,1,0);_panUp(e,t){K.setFromMatrixColumn(t,0),K.crossVectors(this.targetUp,K),K.multiplyScalar(e),this._panOffset.add(K)}_panLeft(e,t){K.setFromMatrixColumn(t,0),K.projectOnPlane(this.targetUp),K.normalize(),K.multiplyScalar(-e),this._panOffset.add(K)}targetPosition={heading:0,pitch:0,distance:0,x:0,y:0};_calculatePersistentPanOffset(e=0,t=0){const r=new P,i=this.object.matrix;return e!==0&&(K.setFromMatrixColumn(i,0),K.projectOnPlane(this.targetUp),K.normalize(),K.multiplyScalar(-e),r.add(K)),t!==0&&(K.setFromMatrixColumn(i,0),K.crossVectors(this.targetUp,K),K.multiplyScalar(t),r.add(K)),r}getTarget(){return this._persistentPanOffset?this.target.clone().add(this._persistentPanOffset):this.target}lookAt(){this.object.lookAt(this.getTarget())}invertCameraHPD(){const e=this.object.position,t=this.getTarget(),r=e.distanceTo(t),i=new P,s=new P,o=new P;Cn.WGS84.getEastNorthUpVectors(this.target,i,s,o);const a=new P().subVectors(t,e).normalize(),l=new P().copy(a);l.projectOnPlane(o).normalize();const c=Math.atan2(l.dot(s),l.dot(i)),u=j.radToDeg(c),h=Math.asin(-a.dot(o)),d=j.radToDeg(h);let f=0,p=0;if(this._persistentPanOffset.lengthSq()>0){const m=this.object.matrix;K.setFromMatrixColumn(m,0),K.projectOnPlane(this.targetUp),K.normalize(),f=-this._persistentPanOffset.dot(K),K.setFromMatrixColumn(m,0),K.crossVectors(this.targetUp,K),K.normalize(),p=this._persistentPanOffset.dot(K)}return{heading:u,pitch:d,distance:r,x:f,y:p}}setCameraPosition(e){this.targetPosition=e;const{heading:t,pitch:r,distance:i,x:s=0,y:o=0}=e;this._persistentPanOffset.copy(this._calculatePersistentPanOffset(s,o));const a=this.getTarget(),l=new P,c=new P,u=new P;Cn.WGS84.getEastNorthUpVectors(this.target,l,c,u);const h=j.degToRad(t),d=j.degToRad(r),f=new P().copy(l).multiplyScalar(Math.cos(h)).add(c.clone().multiplyScalar(Math.sin(h))),p=new P().copy(f).multiplyScalar(Math.cos(d)).add(u.clone().multiplyScalar(Math.sin(-d))).normalize().multiplyScalar(i);this.object.position.copy(a).sub(p),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),Xa.position.copy(this.getTarget())}updateUp(e){this.targetUp.copy(e),this._quat=new Fe().setFromUnitVectors(e,new P(0,1,0)),this._quatInverse=this._quat.clone().invert(),this.object?.up.copy(this.targetUp),this.setCameraPosition(this.targetPosition)}update(e){if(!this._persistentPanOffset)return!1;let t;const r=this.object.position;let i=this.getTarget();K.copy(r).sub(i),K.applyQuaternion(this._quat),this._spherical.setFromVector3(K),this.autoRotate&&this.state===hA.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let s=this.minAzimuthAngle,o=this.maxAzimuthAngle;isFinite(s)&&isFinite(o)&&(s<-Math.PI?s+=Fs:s>Math.PI&&(s-=Fs),o<-Math.PI?o+=Fs:o>Math.PI&&(o-=Fs),s<=o?this._spherical.theta=Math.max(s,Math.min(o,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(s+o)/2?Math.max(s,this._spherical.theta):Math.min(o,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this._persistentPanOffset.addScaledVector(this._panOffset,this.dampingFactor):this._persistentPanOffset.add(this._panOffset),this._persistentPanOffset.sub(this.cursor),this._persistentPanOffset.clampLength(this.minTargetRadius,this.maxTargetRadius),this._persistentPanOffset.add(this.cursor),i.copy(this.getTarget());let a=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const l=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),a=l!=this._spherical.radius}if(K.setFromSpherical(this._spherical),K.applyQuaternion(this._quatInverse),r.copy(i).add(K),this.object.lookAt(i),Xa.position.copy(this.getTarget()),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let l=null;if(this.object.isPerspectiveCamera){const c=K.length();l=this._clampDistance(c*this._scale);const u=c-l;this.object.position.addScaledVector(this._dollyDirection,u),this.object.updateMatrixWorld(),a=!!u}else if(this.object.isOrthographicCamera){const c=new P(this._mouse.x,this._mouse.y,0);c.unproject(this.object);const u=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),a=u!==this.object.zoom;const h=new P(this._mouse.x,this._mouse.y,0);h.unproject(this.object),this.object.position.sub(h).add(c),this.object.updateMatrixWorld(),l=K.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;l!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(l).add(this.object.position):(Ns.origin.copy(this.object.position),Ns.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(Ns.direction))<uA?this.object.lookAt(i):(Zd.setFromNormalAndCoplanarPoint(this.object.up,this.target),Ns.intersectPlane(Zd,this.target))))}else if(this.object.isOrthographicCamera){const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),l!==this.object.zoom&&(this.object.updateProjectionMatrix(),a=!0)}return this._scale=1,this._performCursorZoom=!1,(a||this._lastPosition.distanceToSquared(this.object.position)>Ya||8*(1-this._lastQuaternion.dot(this.object.quaternion))>Ya||this._lastTargetPosition.distanceToSquared(this.target)>Ya)&&(this.dispatchEvent(cA),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),t=!0,this.targetPosition=this.invertCameraHPD(),this.dispatchEvent({type:"target-change"})),t=!1,t}}const Za=new P,Qa=new P,Qd=new H,Jd={},mA=2550,gA=new P;class _A extends cx{isWorldPosition=!1;adjustCamera(e,t){super.adjustCamera(e);const{ellipsoidFrame:r,ellipsoidFrameInverse:i,ellipsoid:s,nearMargin:o,farMargin:a}=this,l=Math.max(...s.radius);if("isPerspectiveCamera"in e){const c=new P;this.isWorldPosition?e.getWorldPosition(c):c.copy(e.position);const u=Za.setFromMatrixPosition(r).sub(c).length(),h=o*l,d=j.clamp((u-l)/h,0,1),f=j.lerp(1,1e3,d);this.isWorldPosition?t&&(e.near=e.position.distanceTo(t)*.05):e.near=Math.max(f,u-l-h),Qa.copy(c).applyMatrix4(i),s.getPositionToCartographic(Qa,Jd);const p=Math.max(s.getPositionElevation(Qa),mA),m=s.calculateHorizonDistance(Jd.lat,p);e.far=m+.1+l*a,e.updateProjectionMatrix()}else{this._getVirtualOrthoCameraPosition(e.position,e),e.updateMatrixWorld(),Qd.copy(e.matrixWorld).invert(),Za.setFromMatrixPosition(r).applyMatrix4(Qd);const c=-Za.z;e.near=c-l*(1+o),e.far=c+.1+l*a,e.position.addScaledVector(gA,e.near),e.far-=e.near,e.near=0,e.updateProjectionMatrix(),e.updateMatrixWorld()}}}const FP=ue({__name:"GeoControls",props:Lb({enableDamping:{type:Boolean,default:!0},adjustHeight:{type:Boolean,default:!1},minDistance:{default:150},target:{default:null}},{position:{required:!0},positionModifiers:{},"target-position":{required:!1},"target-positionModifiers":{}}),emits:["update:position","update:target-position"],setup(n){const{scene:e,camera:t,renderer:r}=Qr(),i=ah(n,"position"),s=ah(n,"target-position"),o=(g,_,v)=>{let y;const T=()=>{y=U(g,_,v)},A=()=>{y()};return T(),w=>{A(),w().then(()=>{T()})}},a=n,{onRender:l}=Yi();let c=null,u=Re(null);const h=()=>{if(a.target){const g=He(a.target.lon,a.target.lat,a.target.height||0);u.value?.target.copy(g),u.value?.updateUp(pA(g))}},d=o([s],()=>{s.value&&u.value&&u.value.setCameraPosition(s.value)});U([u],()=>{s.value&&u.value&&u.value.setCameraPosition(s.value)},{immediate:!0});const f=()=>{a.target?(c&&(c.isWorldPosition=!0,c.enabled=!1),!u.value&&t.value&&r&&(u.value=new fA(t.value,r.domElement),u.value.enableDamping=a.enableDamping,u.value.minDistance=a.minDistance,u.value.addEventListener("target-change",()=>{d(async()=>{s.value=u.value?.targetPosition||s.value})})),u.value&&(u.value.enabled=!0,u.value.resetPanOffset(),h(),u.value)):(c&&(c.isWorldPosition=!1),u.value&&(u.value.enabled=!1),c&&(c.enabled=!0,t.value?.up.set(0,1,0)))};Me(()=>{t.value&&r&&e.value&&(c=new _A(e.value,t.value,r.domElement),c.setTilesRenderer({group:e.value}),c.enableDamping=a.enableDamping,c.adjustHeight=a.adjustHeight,c.minDistance=a.minDistance,f())});const p=()=>{t.value&&!a.target&&ew(t.value,i.value.distance,i.value.heading,i.value.pitch,i.value.longitude,i.value.latitude)};U(()=>a.target,()=>{f(),a.target||p()},{immediate:!0,deep:!0});const m=o([i,t],()=>{p()});return l(()=>{if(a.target&&u.value?.enabled?(u.value.update(),t.value&&c?.adjustCamera(t.value,u.value.target)):a.target||c?.update(),t.value&&!a.target){const g=sw(t.value);g&&m(async()=>{i.value=g})}}),tt(()=>{c?.dispose(),u.value?.dispose()}),(g,_)=>null}}),vA=["color","intensity"],yA=["color","intensity","position"],UP=ue({__name:"GeoScene",props:{sceneConfig:{default:()=>({ambientLight:{color:"#fff",intensity:1},directionalLight:{color:"#fff",intensity:2,position:[-1500,500,500]},background:"/farm_field_puresky_2k.jpg"})}},setup(n){const e=n,{sceneConfig:t}=e,r=lh(t.ambientLight),i=lh(t.directionalLight),s=Ne(null),o=Ne(null),{scene:a}=Qr();return Me(()=>{const l=new V.TextureLoader;if(t.background){const c=l.load(t.background);c.mapping=V.EquirectangularReflectionMapping,c.colorSpace=V.SRGBColorSpace,a.value.background=c}}),(l,c)=>(re(),Ee("TresGroup",null,[Ct(l.$slots,"default"),nr("TresAmbientLight",{ref_key:"ambientLightRef",ref:s,color:r.color,intensity:r.intensity},null,8,vA),nr("TresDirectionalLight",{ref_key:"directionalLightRef",ref:o,color:i.color,intensity:i.intensity,position:i.position},null,8,yA)]))}}),{defineComponent:bA}=await Vt("vue"),{unref:ep,openBlock:wA,createBlock:TA}=await Vt("vue"),jP=bA({__name:"DevTDTTiles",props:{layer:{type:String,default:"vec"}},setup(n){const e="https://t0.tianditu.gov.cn";return(t,r)=>(wA(),TA(ep(Fx),{layer:n.layer,url:ep(e),tk:"890a908c5d3f6c77232b60964d74f180"},null,8,["layer","url"]))}});export{vw as $d,DP as By,FP as Gy,UP as Hy,AP as J_,EP as Q_,K1 as T_,IP as Uy,xP as Z_,Sc as _a,jP as _sfc_main,OP as ay,LP as cy,PP as ey,SP as iy,kP as ly,Th as ol,RP as oy,wh as rl,CP as ry,MP as ty,NP as zy};
