import{P as t}from"./tweakpane.yHWGBmom1731552996711.js";import{b as n,l as o}from"./pagesShow.vue_vue_type_script_setup_true_lang.PBzOUcTS1731552996711.js";import{e}from"./@tresjs.01P8tiuF1731552996711.js";import{z as r}from"./three-custom-shader-material.B7Wbwjde1731552996711.js";import{$ as i,a0 as u,C as c,_ as a,cc as s,m as l,a$ as f}from"./three.KG0QRRig1731552996711.js";import{d as p,a3 as d,w as m,o as g,D as v,u as h,a6 as y,r as C,f as w,g as _,j as b,m as x}from"./@vue.-THQH3GC1731552996711.js";import"./@vueuse.YduQ9gvc1731552996711.js";const M=j;!function(t,n){const o=j,e=T();for(;;)try{if(884844===parseInt(o(370))/1+parseInt(o(412))/2*(-parseInt(o(395))/3)+parseInt(o(423))/4+-parseInt(o(413))/5+parseInt(o(389))/6+-parseInt(o(419))/7*(-parseInt(o(406))/8)+-parseInt(o(394))/9)break;e.push(e.shift())}catch(r){e.push(e.shift())}}();const S=function(){let t=!0;return function(n,o){const e=t?function(){if(o){const t=o[j(387)](n,arguments);return o=null,t}}:function(){};return t=!1,e}}();!function(){S(this,(function(){const t=j,n=new RegExp(t(401)),o=new RegExp(t(396),"i"),e=O(t(405));n[t(376)](e+"chain")&&o[t(376)](e+"input")?O():e("0")}))()}();const I=function(){let t=!0;return function(n,o){const e=t?function(){if(o){const t=o[j(387)](n,arguments);return o=null,t}}:function(){};return t=!1,e}}();function T(){const t=["computeBoundingSphere","bind","6283724MyeloS","gradient","length","counter","exception","Color","renderOrder","\n\t\tvarying vec4 vPosition;\n\t\tvoid main() {\n\t\t\tvPosition = modelMatrix * vec4(position,1.0);\n\t\t\tcsm_Position = position * vec3(1.0);\n\t\t}\n\t\t","trace","#ffff00","1391980mYhYeb","string","computeBoundingBox","console","land","__proto__","test","error","while (true) {}","toString","uniforms",'{}.constructor("return this")( )',"info","side","__csm","setStyle","bModel","apply","boundingBox","7859190yTdogF","bulidingsColor","prototype","#e523ff","debu","22388994DohTEx","4536867XjqlXy","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","DoubleSide","stateObject","uTime","material","function *\\( *\\)","#ffffff","uGradient","dispose","init","8OPVdxs","opacity","gger","warn","table","value","2wfzciq","623715rRmtbp","constructor","topColor","landColor","color","model","5157362hpENaQ","primitive"];return(T=function(){return t})()}function j(t,n){const o=T();return(j=function(t,n){return o[t-=365]})(t,n)}I(void 0,(function(){const t=j;let n;try{n=Function("return (function() "+t(381)+");")()}catch(r){n=window}const o=n[t(373)]=n[t(373)]||{},e=["log",t(409),t(382),t(377),t(427),t(410),t(368)];for(let i=0;i<e[t(425)];i++){const n=I[t(414)][t(391)][t(422)](I),r=e[i],u=o[r]||n;n[t(375)]=I[t(422)](I),n[t(379)]=u[t(379)].bind(u),o[r]=n}}))();const P=["object"],F=p({__name:M(386),props:{model:{},bulidingsColor:{default:M(392)},landColor:{default:"#112233"},topColor:{default:M(369)},opacity:{default:.9},gradient:{type:Boolean,default:!0}},setup(t){const n=M,o=t,s=o.model.city;o.model[n(418)].children[0].material=new i({color:n(369)}),s[n(366)]=1001;const l=o[n(418)][n(374)];(()=>{const t=n,{geometry:e}=s;e[t(372)](),e[t(421)]();const{max:i,min:u}=e[t(388)];if(s[t(400)][t(384)])return;const l=new r({baseMaterial:s[t(400)],vertexShader:t(367),fragmentShader:"\n\t\tuniform mat4 modelMatrix;\n\t\tvarying vec4 vPosition;\n\t\tuniform vec3 uMax; \n\t\tuniform vec3 uMin; \n\t\tuniform float uOpacity;  \n\t\tuniform float uBorderWidth; \n\t\tuniform vec3 uLightColor;\n\t\tuniform vec3 uColor;\n\t\tuniform float uCircleTime; \n\t\tuniform float uTime; \n\t\tuniform vec3 uTopColor;\t\t\t\t\t//顶部颜色\n\t\tuniform bool uGradient;\n\t\tvec4 uMax_world;\n\t\tvec4 uMin_world;\n\t\tvoid main() {\n\t\t\t// 转世界坐标\n\t\t\tuMax_world =  modelMatrix * vec4(uMax,1.0);\n\t\t\tuMin_world =  modelMatrix * vec4(uMin,1.0);\n\t\t\tvec3 distColor = uColor;\n\t\t\tfloat residue = uTime - floor(uTime / uCircleTime) * uCircleTime;\n\t\t\tfloat rate = residue / uCircleTime;\n\t\t\tfloat lightOffset = rate * (uMax_world.y - uMin_world.y);\n\n\t\t\tif (uMin_world.y + lightOffset < vPosition.y && uMin_world.y + lightOffset + uBorderWidth > vPosition.y) {\n\t\t\t\tcsm_DiffuseColor = vec4(uLightColor, uOpacity);\n\t\t\t} else {\n\t\t\t\tcsm_DiffuseColor = vec4(distColor, uOpacity);\n\t\t\t}\n\n\t\t\t//根据高度计算颜色\n\t\t\tif(uGradient){\n\t\t\t\tfloat rateHight = (vPosition.y - uMin_world.y) / (uMax_world.y - uMin_world.y); \n\t\t\t\tvec3 outColor = mix(csm_DiffuseColor.xyz, uTopColor, rateHight*2.0);\n\t\t\t\tcsm_DiffuseColor = vec4(outColor, uOpacity);\n\t\t\t}\n    }\n\t\t",silent:!0,uniforms:{uMax:{value:i},uMin:{value:u},uBorderWidth:{value:5},uCircleTime:{value:5},uColor:{value:new c(o[t(390)])},uOpacity:{value:o.opacity},uLightColor:{value:new c(t(402))},uTopColor:{value:new(a[t(365)])(o[t(415)])},uTime:{value:0},uGradient:{value:o[t(424)]}},depthWrite:!0,depthTest:!0,transparent:!0,side:a[t(397)]});s[t(400)][t(404)](),s[t(400)]=l})();const{onLoop:f}=e();f((({delta:t})=>{const o=n;s.material.uniforms[o(399)][o(411)]+=t})),d((()=>{const t=n;o.bulidingsColor&&s[t(400)][t(380)].uColor[t(411)][t(385)](o[t(390)]),o[t(416)]&&((t,e)=>{const r=n;let i;"cu"===t||"land"===t&&(i=Array.isArray(l[r(400)])?l[r(400)]:[l.material],i.forEach((t=>{const n=r;t[e].setStyle(o[n(416)]),t[n(383)]=u})))})(t(374),t(417)),o.opacity&&(s.material[t(380)].uOpacity[t(411)]=o[t(407)])})),m(o,((t,o)=>{const e=n;s.material[e(380)][e(403)].value=t[e(424)]}));const p=o[n(418)][n(418)].clone();return(t,o)=>{const e=n;return g(),v(e(420),{object:h(p)},null,8,P)}}});function O(t){function n(t){const o=j;if(typeof t===o(371))return function(t){}[o(414)](o(378))[o(387)](o(426));1!==(""+t/t).length||t%20==0?function(){return!0}.constructor(o(393)+"gger").call("action"):function(){return!1}.constructor("debu"+o(408))[o(387)](o(398)),n(++t)}try{if(t)return n;n(0)}catch(o){}}const z=G;!function(t,n){const o=G,e=E();for(;;)try{if(284097===parseInt(o(330))/1+parseInt(o(297))/2+parseInt(o(323))/3+-parseInt(o(338))/4+parseInt(o(311))/5+-parseInt(o(337))/6+parseInt(o(320))/7*(-parseInt(o(296))/8))break;e.push(e.shift())}catch(r){e.push(e.shift())}}();const B=function(){let t=!0;return function(n,o){const e=t?function(){if(o){const t=o[G(328)](n,arguments);return o=null,t}}:function(){};return t=!1,e}}();!function(){B(this,(function(){const t=G,n=new RegExp(t(326)),o=new RegExp(t(308),"i"),e=$(t(302));n[t(300)](e+"chain")&&o[t(300)](e+t(304))?$():e("0")}))()}();const A=function(){let t=!0;return function(n,o){const e=t?function(){if(o){const t=o[G(328)](n,arguments);return o=null,t}}:function(){};return t=!1,e}}();function E(){const t=["linewidth","425278vPvzeX","call","#000","487386ChRzPE","prototype","gradual","function *\\( *\\)","return (function() ","apply","clone","185697itKeMA","uScale","width","toString","stateObject","string","uGradual","179364hzQFug","721448clnMvt","material","counter","constructor","table","error","__proto__","bLine","bind","8XClCoH","78452VHsFWf","geometry","length","test","primitive","init","srcColor","input","exception","uniforms","scale","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","action","value","838610SwmYZg","uTime","gger","builds","debu","uSrcColor","color","speed"];return(E=function(){return t})()}function G(t,n){const o=E();return(G=function(t,n){return o[t-=290]})(t,n)}A(void 0,(function(){const t=G,n=function(){const t=G;let n;try{n=Function(t(327)+'{}.constructor("return this")( ));')()}catch(o){n=window}return n}(),o=n.console=n.console||{},e=["log","warn","info",t(292),t(305),t(291),"trace"];for(let r=0;r<e.length;r++){const n=A.constructor[t(324)][t(295)](A),i=e[r],u=o[i]||n;n[t(293)]=A[t(295)](A),n[t(333)]=u[t(333)][t(295)](u),o[i]=n}}))();const R=["object"],Z=p({__name:z(294),props:{builds:{},color:{default:"#FFF"},srcColor:{default:z(322)},scale:{default:2e3},gradual:{default:10},speed:{default:.5}},setup(t){const n=z,o=t;let r=null;const i={transparent:!0,uniforms:{uColor:{value:new c(o[n(317)])},uSrcColor:{value:new c(o[n(303)])},uScale:{value:o[n(307)]},uTime:{value:0},uGradual:{value:o[n(325)]}},vertexShader:"varying vec3 vPosition;\nvoid main(){\n\tvPosition=position;\n\tvec4 viewPosition=modelViewMatrix*vec4(position,1.);\n\tgl_Position=projectionMatrix*viewPosition;\n}",fragmentShader:"uniform float uScale;//最大扩散\nuniform float uGradual;//建变系数\nuniform float uTime;\nuniform vec3 uColor;//扩散颜色\nuniform vec3 uSrcColor;//原始颜色\nvarying vec3 vPosition;\n\nvoid main(){\n\tfloat dis=distance(vPosition.xz,vec2(.0,.0));\n\tif(dis>uScale){\n\t\tdiscard;\n\t}\n\tfloat opacity=smoothstep(uScale/uGradual*uTime,uScale*uTime,dis);\n\topacity*=step(dis,uScale*uTime);\n\t\n\tif(opacity<.3){\n\t\tgl_FragColor=vec4(uSrcColor,1.-opacity);\n\t}else{\n\t\tgl_FragColor=vec4(uColor,opacity);\n\t}\n\t// gl_FragColor=vec4(uColor,opacity);\n}\n"};let u=new s(o[n(314)][n(298)])[n(329)]();u=u.applyMatrix4(o[n(314)].matrix);const a=new l(i);r=new f(u,a),r[n(339)][n(319)]=o[n(332)],r.renderOrder=1e3,d((()=>{const t=n;o[t(317)]&&(i.uniforms.uColor[t(310)]=new c(o.color)),o[t(303)]&&(i[t(306)][t(316)][t(310)]=new c(o[t(303)])),o[t(307)]&&(i.uniforms[t(331)][t(310)]=o[t(307)]),o[t(325)]&&(i[t(306)][t(336)][t(310)]=o[t(325)])}));const{onLoop:p}=e();return p((({delta:t})=>{const e=n;i[e(306)][e(312)][e(310)]+=t*o[e(318)],i[e(306)].uTime[e(310)]%=1})),(t,o)=>{const e=n;return g(),v(e(301),{object:h(r)},null,8,R)}}});function $(t){function n(t){const o=G;if(typeof t===o(335))return function(t){}[o(290)]("while (true) {}").apply(o(340));1!==(""+t/t)[o(299)]||t%20==0?function(){return!0}.constructor(o(315)+"gger")[o(321)](o(309)):function(){return!1}[o(290)](o(315)+o(313)).apply(o(334)),n(++t)}try{if(t)return n;n(0)}catch(o){}}const k=W;!function(t,n){const o=W,e=X();for(;;)try{if(991472===parseInt(o(328))/1+parseInt(o(313))/2+parseInt(o(343))/3*(-parseInt(o(317))/4)+-parseInt(o(341))/5+-parseInt(o(339))/6*(-parseInt(o(309))/7)+-parseInt(o(319))/8+parseInt(o(314))/9)break;e.push(e.shift())}catch(r){e.push(e.shift())}}();const D=function(){let t=!0;return function(n,o){const e=t?function(){if(o){const t=o.apply(n,arguments);return o=null,t}}:function(){};return t=!1,e}}();!function(){D(this,(function(){const t=W,n=new RegExp(t(325)),o=new RegExp("\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","i"),e=V(t(312));n[t(326)](e+"chain")&&o.test(e+t(335))?V():e("0")}))()}();const L=function(){let t=!0;return function(n,o){const e=t?function(){if(o){const t=o[W(332)](n,arguments);return o=null,t}}:function(){};return t=!1,e}}();function X(){const t=["model","init","2802110cChumd","165537hqApWF","最大扩散","prototype","1375256IlLXbY","string","6912512kKGcpB","#FFF","__proto__","length","#999","addBinding","function *\\( *\\)","test","trace","1344601lZkTgz","gradual","gger","#112233","apply","stateObject","call","input","toString","scale","constructor","6BsmfQf","#000","8162200ZexSkm","color","3SCGznV","效果参数","error","srcColor","return (function() ","speed","exception","counter","#000000","线原颜色","console","bind",'{}.constructor("return this")( )',"warn","action","debu","7474187XXVoJN","buildingsEffectA"];return(X=function(){return t})()}function W(t,n){const o=X();return(W=function(t,n){return o[t-=302]})(t,n)}L(void 0,(function(){const t=W,n=function(){const t=W;let n;try{n=Function(t(347)+t(305)+");")()}catch(o){n=window}return n}(),o=n.console=n[t(303)]||{},e=["log",t(306),"info",t(345),t(349),"table",t(327)];for(let r=0;r<e[t(322)];r++){const n=L.constructor[t(316)][t(304)](L),i=e[r],u=o[i]||n;n[t(321)]=L.bind(L),n.toString=u[t(336)][t(304)](u),o[i]=n}}))();const H=p({__name:k(310),async setup(e){const r=k;let i,u;const c=([i,u]=y((()=>o())),i=await i,u(),i),a=C({color:r(320),srcColor:r(340),scale:2e3,gradual:6.6,speed:.3}),s=new t({title:r(344),expanded:!0});return s[r(324)](a,r(346),{label:r(302)}),s[r(324)](a,r(342),{label:"线扫颜色"}),s.addBinding(a,r(348),{label:"速度",min:.1,max:1,step:.1}),s[r(324)](a,r(337),{label:r(315),min:10,max:2e3,step:10}),s[r(324)](a,r(329),{label:"扩散系数",min:1.1,max:10,step:.1}),(t,o)=>{const e=r;return g(),w(n,{showAxesHelper:!1,autoRotate:!1,showBuildings:!1},{ability:_((()=>[b(F,{model:h(c),bulidingsColor:e(351),landColor:e(331),topColor:e(323)},null,8,[e(311)]),b(Z,x({builds:h(c).city},a),null,16,["builds"])])),_:1})}}});function V(t){function n(t){const o=W;if(typeof t===o(318))return function(t){}[o(338)]("while (true) {}")[o(332)](o(350));1!==(""+t/t)[o(322)]||t%20==0?function(){return!0}[o(338)](o(308)+"gger")[o(334)](o(307)):function(){return!1}[o(338)](o(308)+o(330))[o(332)](o(333)),n(++t)}try{if(t)return n;n(0)}catch(o){}}export{H as default};
