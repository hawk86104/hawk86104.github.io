import{importShared as e}from"./3d-tiles-renderer.de6b_qgz1767149344623.js";import{Pane as t}from"./tweakpane.BbuIEN141767149344623.js";import{OrbitControls as o}from"./OrbitControls.DxR6LX8d1767149344623.js";import{Fs as n,_l as a}from"./index.Btae5S5d1767149344623.js";import{MERC as r,PlaneProvider as i,MartiniTerrainProvider as l,MapProvider as s,TerrainMeshProvider as p,Map as m,lonLatToWebMerctor as c}from"./TerrainMeshProvider.CLjD1uZ_1767149344623.js";import{raycasterEvent as u}from"./raycasterEvent.vcsHN5GW1767149344623.js";import{flyToNative as d}from"./utils.DGn9vLJM1767149344623.js";const{defineComponent:g}=await e("vue"),{unref:f,openBlock:w,createElementBlock:h}=await e("vue"),b=["object","rotation"],v=await e("three"),{watchEffect:x,watch:C}=await e("vue"),B=g({__name:"tileMapMesh",props:{bbox:{default:[104.955976,20.149765,120.998419,30.528687]},maxZoom:{default:20},opposite:{type:Boolean,default:!1},genBright:{default:1},genContrast:{default:1},genSaturation:{default:1},monochrome:{default:"#fff"},isMonochrome:{type:Boolean,default:!1},mapCenter:{},tweenInstance:{default:null}},setup(e,{expose:t}){const c=e,{renderer:u,scene:d}=n(),g=new i;g.coordType=r;const B=new l;B.source="https://api.maptiler.com/tiles/terrain-rgb-v2/[z]/[x]/[y].webp?key=L55MtSxL94Yb4hQeWewp",B.coordType=r;const M=new s;M.source="https://webrd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",M.showTileNo=!1,M.useWorker=!0;const y=new p(g,M);if(y.showBoundingBox=!1,y.wireframe=!1,y.flatShading=!1,y.useStandardMaterial=!1,y.filter={opposite:c.opposite,monochrome:c.isMonochrome?{r:.299,g:.587,b:.114}:null,genBright:c.genBright,genContrast:c.genContrast,genSaturation:c.genSaturation},c.monochrome){let e=new v.Color(c.monochrome);y.filter&&(y.filter.monochrome={r:e.r,g:e.g,b:e.b})}const S=new m;S.provider=y,S.bbox=c.bbox,S.maxZoom=c.maxZoom;const j=new v.PerspectiveCamera(60,window.innerWidth/window.innerHeight,1,1e8);j.up=new v.Vector3(0,1,0),j.position.set(c.mapCenter[0],c.mapCenter[2],-c.mapCenter[1]),j.lookAt(new v.Vector3(j.position.x,0,j.position.z-2e3)),S.camera=j;let k=null;x(()=>{u&&!k&&(k=new o(j,u.domElement),k.enableDamping=!0,k.dampingFactor=.05,k.minDistance=600,k.position0.set(j.position.x,j.position.y,j.position.z),k.target.set(j.position.x,0,j.position.z-2e3))}),C(()=>[c.opposite,c.isMonochrome,c.monochrome],([e,t,o])=>{if(y.filter){let n=new v.Color(o);y.filter.opposite=e,y.filter.monochrome=t?{r:n.r,g:n.g,b:n.b}:null}}),C(()=>[c.genBright,c.genContrast,c.genSaturation],([e,t,o])=>{y.filter&&(y.filter.genBright=e,y.filter.genContrast=t,y.filter.genSaturation=o)});const{onBeforeRender:z}=a();return z(()=>{if(u){c.tweenInstance?.update(),k&&k.update(),S.update();const e=50*Math.abs(j.position.y);j.far=e+5e3,j.updateProjectionMatrix(),u.render(d.value,j)}}),t({camera:j,map:S,orbitControl:k}),(e,t)=>(w(),h("primitive",{object:f(S),rotation:[-Math.PI/2,0,0]},null,8,b))}}),{defineComponent:M}=await e("vue"),{mergeProps:y,createVNode:S,resolveComponent:j,withCtx:k,Fragment:z,openBlock:T,createElementBlock:_}=await e("vue"),{reactive:I,shallowRef:R}=await e("vue"),E=await e("three"),P=M({__name:"tileMap",setup(e){const o=c(118.779958,32.017136),n=[o[0],o[1],5e3],a=R(),r=I({opposite:!0,genBright:1.3,genContrast:1,genSaturation:1,isMonochrome:!0,monochrome:"#4688b5",mapCenter:n,tweenInstance:null}),i=new t({title:"参数"});i.addBinding(r,"opposite",{label:"反色"}),i.addBinding(r,"genBright",{label:"高亮",min:.1,max:3,step:.1}),i.addBinding(r,"genContrast",{label:"对比度",min:.1,max:3,step:.1}),i.addBinding(r,"genSaturation",{label:"饱和度",min:.1,max:3,step:.1}),i.addBinding(r,"isMonochrome",{label:"单色滤镜"}),i.addBinding(r,"monochrome",{label:"滤镜颜色"});const l={at:c(118.7425,31.9998),xjk:c(118.7842,32.0418),nss:c(118.7503,31.9082)};i.addBlade({view:"list",label:"飞去",options:[{text:"奥体中心",value:"at"},{text:"新街口",value:"xjk"},{text:"牛首山",value:"nss"}],value:"at"}).on("change",e=>{const t=new E.Vector3(l[e.value][0],2e3,-l[e.value][1]);r.tweenInstance=d(a.value.camera,t,a.value.orbitControl,[0,-300],4e3)});const s=I({clearColor:"#201919",antialias:!0,logarithmicDepthBuffer:!0,renderMode:"manual",outputColorSpace:E.SRGBColorSpace,toneMapping:E.NoToneMapping});return setTimeout(()=>{const e=l.at,t=new E.Vector3(e[0],1600,-e[1]);r.tweenInstance=d(a.value.camera,t,a.value.orbitControl,[-2e3,-2e3],2e3)},1e3),(e,t)=>{const o=j("TresCanvas");return T(),_(z,null,[S(o,y(s,{"window-size":""}),{default:k(()=>[S(B,y(r,{ref_key:"tileMapMeshRef",ref:a,bbox:[80,16,128,50]}),null,16)]),_:1},16),S(u,{tileMapRef:a.value},null,8,["tileMapRef"])],64)}}});export{P as default};
