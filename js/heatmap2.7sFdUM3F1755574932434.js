import{P as t}from"./tweakpane.C0HtAJSg1755574932434.js";import{a as e,b as a,l as o}from"./pagesShow.vue_vue_type_script_setup_true_lang.6jWwf-A61755574932434.js";import{h as s}from"./heatmap.js-fix.CYyvEaYE1755574932434.js";import{b as i,ah as n,cg as r,M as l,l as p,B as m,n as u,a3 as c}from"./three.QlBabAUP1755574932434.js";import{r as d}from"./utils.DGgE1p1_1755574932434.js";import{d as v}from"./pinia.BE7EcXOZ1755574932434.js";import{b as h,d as y,a2 as g,G as f,o as j,F as b,I as w,u as _,s as x,V as M,O as D,Q as I,M as P,N as B,aa as S,r as T,j as O,f as U,m as E}from"./@vue.BzMISRrV1755574932434.js";import{c as L,d as C,a as V}from"./three-mesh-bvh.CyUFl1uw1755574932434.js";import{_ as k}from"./@fesjs.C8tWfo4D1755574932434.js";import"./@tresjs.D3Ezko2-1755574932434.js";import"./postprocessing.DBDjiblp1755574932434.js";import"./@vueuse.BcmlNMCY1755574932434.js";import"./three-custom-shader-material.EFGJY8zp1755574932434.js";import"./buildingsCustomShaderMaterial.DyBo--wu1755574932434.js";import"./@amap.CGUF9xH41755574932434.js";import"./vue-router.BQU9In5l1755574932434.js";import"./lodash-es.C7pWAXPe1755574932434.js";import"./@qlin.q6OWdsQV1755574932434.js";import"./@babel.BPq7uOAK1755574932434.js";import"./@floating-ui.BFjFSAYt1755574932434.js";import"./@juggle.CcBCnTIR1755574932434.js";const F=(t,e)=>t.getValueAt(e)+-10,H=v("buildingsHeatmap",(()=>{const t=h(!1),e=h(0);return{showDiv:t,temperature:e,setShowDiv:function(e){t.value=e},setTemperature:function(t){e.value=t}}})),R=["object","rotation-x"],X=["object"],q=y({__name:"buildingsHeatmap",props:{model:{},opacity:{default:1}},setup(t){m.prototype.computeBoundsTree=L,m.prototype.disposeBoundsTree=C,p.prototype.raycast=V;const e=t,a=((t=250,e=250,a=!0)=>{const o=document.createElement("heatmap-canvas");return o.style.position="absolute",a||(o.style.display="none"),o.style.top="0",o.style.left="0",document.body.appendChild(o),s.create({container:o,width:t,height:e,blur:".8",radius:10,gradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"}})})();((t,e)=>{if(!e){let a=0;for(e=[];a<1e3;)e.push({x:i.randInt(1,t._config.width),y:i.randInt(1,t._config.height),value:i.randInt(-10,36)}),a++}t.setData({max:36,min:-10,data:e})})(a);const o=new n(a._renderer.canvas);o.needsUpdate=!0;const v=e.model.city.clone();delete v.geometry.attributes.normal,delete v.geometry.attributes.uv;const h=v.geometry.clone().applyMatrix4(v.matrix),y=e.model.land.clone();delete y.geometry.attributes.normal;const x=y.geometry.clone().applyMatrix4(y.matrix),M=r([h,x]);M.applyMatrix4((new l).makeRotationX(Math.PI/2)),d(M),M.computeBoundsTree();const D=(I=o,new u({vertexShader:"\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t\t\tvUv = uv;\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform sampler2D heightMap;\n\t\tuniform float uOpacity;\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tgl_FragColor = vec4(texture2D(heightMap, vUv.xy).rgb, uOpacity);\n    }\n\t\t",uniforms:{uOpacity:{value:e.opacity},heightMap:{type:"t",value:I}},depthWrite:!0,depthTest:!0,transparent:!0,side:c}));var I;const P=new p(M,D);g((()=>{e.opacity&&(D.uniforms.uOpacity.value=e.opacity)}));const B=H(),S=t=>{if(t){const e={x:t.uv.x*a._config.width,y:(1-t.uv.y)*a._config.height};console.log("数值：",t),console.log("数值———：",F(a,e)),B.setTemperature(F(a,e))}},T=t=>{t&&B.$patch({showDiv:!0})},O=t=>{t&&B.setShowDiv(!1)};return(t,a)=>(j(),f(b,null,[w("primitive",{object:_(P),"rotation-x":-Math.PI/2,onPointerMove:S,onPointerEnter:T,onPointerLeave:O},null,40,R),w("primitive",{object:e.model.model.children[0].clone()},null,8,X)],64))}}),A=k({__name:"dataDiv",setup(t){const e=H(),a=h({top:0,left:0});function o(t){a.value.left=t.clientX+5+"px",a.value.top=t.clientY-20+"px"}return x((()=>{window.addEventListener("mousemove",o)})),M((()=>{window.removeEventListener("mousemove",o)})),(t,o)=>D((j(),f("div",{class:"title",style:B(a.value)},"温度："+P(_(e).temperature)+"℃ ",5)),[[I,_(e).showDiv]])}},[["__scopeId","data-v-fac3e7fd"]]),G=y({__name:"heatmap2",async setup(s){let i,n;const r=h(!1),l=([i,n]=S((()=>o())),i=await i,n(),i);r.value=!0;const p=T({width:1,color:"#000",opacity:1,show:!0}),m=T({opacity:.9});return new t({title:"参数",expanded:!0}).addBinding(m,"opacity",{label:"透明度",min:0,max:1,step:.1}),(t,o)=>(j(),f(b,null,[O(a,{showBuildings:!1,autoRotate:!1},{ability:U((()=>[O(q,E({model:_(l)},m),null,16,["model"]),O(e,E(p,{builds:_(l).city}),null,16,["builds"])])),_:1}),O(A)],64))}});export{G as default};
