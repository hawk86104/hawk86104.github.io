import{SpriteNodeMaterial as f,LineDashedNodeMaterial as T,MeshPhysicalNodeMaterial as m,MeshPhongNodeMaterial as D,MeshStandardNodeMaterial as b,MeshBasicNodeMaterial as d,THREE as g}from"./three.webgpu.TnOrJG3G1767148983502.js";import{tsl as S}from"./three.tsl.CF2W1kUR1767148983502.js";import{Texture as y,MultiplyBlending as E,SubtractiveBlending as v,AdditiveBlending as B,NormalBlending as p,NoBlending as w,DoubleSide as F,BackSide as L,FrontSide as u,NotEqualDepth as q,GreaterEqualDepth as x,GreaterDepth as A,LessEqualDepth as N,LessDepth as k,EqualDepth as G,AlwaysDepth as _,NeverDepth as P}from"./three.CjjHJWB_1767148983502.js";const I=e=>{const n=new Image,a=new y(n);return n.onload=()=>{a.needsUpdate=!0},n.src=e,a},R=(e="MeshBasicNodeMaterial")=>({template:e,Preview:"2d",surfaceType:"Transparent",blendingMode:"NormalBlending",renderFace:"FrontSide",depthWrite:"enable",depthTest:"enable",depthTestFunc:"LessEqualDepth",castShadows:!0}),j=R(),J=e=>{const n=e.replace(/\r\n/g,`
`).match(/\/\/\/\/ view \/\/\/\/ (.*)\n/);return n?JSON.parse(n[1]):null},U={lit:d,unlit:d,subgraph:d,MeshBasicNodeMaterial:d,MeshStandardNodeMaterial:b,MeshPhongNodeMaterial:D,MeshPhysicalNodeMaterial:m,LineDashedNodeMaterial:T,SpriteNodeMaterial:f},W={NoBlending:w,NormalBlending:p,AdditiveBlending:B,SubtractiveBlending:v,MultiplyBlending:E},z={FrontSide:u,BackSide:L,DoubleSide:F},H={NeverDepth:P,AlwaysDepth:_,EqualDepth:G,LessDepth:k,LessEqualDepth:N,GreaterDepth:A,GreaterEqualDepth:x,NotEqualDepth:q},O=(e,n)=>{e.transparent=n.surfaceType==="Transparent",n.surfaceType==="Transparent"?e.blending=W[n.blendingMode]||p:e.blending=p,e.side=z[n.renderFace]||u,e.depthWrite=n.depthWrite==="enable",e.depthTest=n.depthTest==="enable",e.depthFunc=H[n.depthTestFunc]||N},Q=(e,n={},a={})=>{const o={},r=J(e);r&&r.textures?.forEach(s=>{const i=s.binding.varName;if(!a?.[i]){const h=e.match(new RegExp(`//// ${i} //// (.*)\\n`))?.[1];h&&a&&(a[i]=I(h))}});const l=Object.assign({},j,r?.setting),M=U[l.template],t=new M,c={};if(O(t,l),e)try{new Function("material","default_uniforms","__textures__","uniforms","tsl","THREE",e)(o,n||{},a,c,S,g)}catch(s){throw new Error("Invalid TSL format: "+s)}return l.surfaceType==="Transparent"?typeof o.opacityNode>"u"?t.colorNode=o.colorNode||null:(t.colorNode=o.colorNode?.xyz||null,t.opacityNode=o.opacityNode||null):t.colorNode=o.colorNode?.xyz||null,t.vertexNode=o.vertexNode||null,t.positionNode=o.positionNode||null,t.normalNode=o.normalNode||null,t.alphaTestNode=o.alphaTestNode||null,t.depthNode=o.depthNode||null,t.emissiveNode=o.emissiveNode||null,t.envNode=o.envNode||null,t.aoNode=o.aoNode||null,t.backdropNode=o.backdropNode||null,t.backdropAlphaNode=o.backdropAlphaNode||null,l.castShadows&&(t.castShadowNode=o.castShadowNode||null),t.needsUpdate=!0,{material:t,uniforms:c,settings:l}};export{Q as tsg};
