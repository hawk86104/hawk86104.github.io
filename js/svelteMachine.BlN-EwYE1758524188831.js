import{m as e,e as t,a as s,H as o}from"./@tresjs.BL1sBIDK1758524188831.js";import{l as n,a as i}from"./utils.B4XkrJx61758524188831.js";import{am as r,T as a,I as c,M as p,V as l,cD as u,f as d,ch as m}from"./three.CC50Wz7a1758524188831.js";import{d as h,G as v,o as j,F as g,I as y,aa as f,b,s as w,j as z,u as x,r as E,w as _,f as P,e as D,a5 as M,a7 as L,a8 as S}from"./@vue.pEDXJ_3Z1758524188831.js";import"./@fesjs.C0vFiD6Z1758524188831.js";import"./Resource.DxdCIUkg1758524188831.js";/* empty css                                                                             */import{l as A}from"./cssLoaders.1NZwOheM1758524188831.js";import"./three-mesh-ui.module.CE9rtod61758524188831.js";import"./global.B9GyzW9k1758524188831.js";/* empty css                                                              */import"./postprocessing.DYlQqnRh1758524188831.js";import"./@vueuse.C-O_6is-1758524188831.js";import"./jszip.BzP0QdiD1758524188831.js";import"./@amap.CGUF9xH41758524188831.js";import"./file-saver.CjDqjzoC1758524188831.js";import"./vue-router.DFx_OtVs1758524188831.js";import"./lodash-es.C7pWAXPe1758524188831.js";import"./pinia.DVrvLNCY1758524188831.js";import"./@qlin.q6OWdsQV1758524188831.js";import"./@babel.BPq7uOAK1758524188831.js";import"./@floating-ui.BFjFSAYt1758524188831.js";import"./@juggle.CcBCnTIR1758524188831.js";import"./utils.PgMvYI3o1758524188831.js";import"./color.D9QGz8GJ1758524188831.js";import"./color-string.BDbH6wEP1758524188831.js";import"./color-name.BQ5IbGbl1758524188831.js";import"./simple-swizzle.Bkblhu7y1758524188831.js";import"./is-arrayish.CLsR9Wfx1758524188831.js";import"./color-convert.P-wMblBM1758524188831.js";import"./lodash.iw1WOawC1758524188831.js";window.THREE=a;const k={scene:null,renderer:null,camera:null,sizes:null},C={get renderer(){return k.renderer?.value},loader:new r,get scene(){return k.scene?.value},get camera(){return k.camera?.value},get width(){return k.sizes?.width?.value},get height(){return k.sizes?.height?.value},get dom(){return k.renderer?.value.domElement.parentElement},get canvas(){return k.renderer?.value.domElement},events:{},init(e,t,s,o){k.scene=e,k.renderer=t,k.camera=s,k.sizes=o},load(e){const t={"1d0e8871-bd60-47f9-8ab7-232dabd30201":[{name:"SpotLightEvent",source:"this.shadow.mapSize.width = 1024 * 2\nthis.shadow.mapSize.height = 1024 * 2\nthis.shadow.camera.near = 1\nthis.shadow.camera.far = 10\nthis.shadow.bias = -0.0075\nthis.shadow.radius = 24\nthis.target.position.copy(this.position.clone().setY(0))\nfunction update( event ) {}"}],"beea1423-1e37-47ab-9443-f8429259e120":[{name:"dirb",source:"this.shadow.mapSize.width = 1024 * 2\nthis.shadow.mapSize.height = 1024 * 2\nthis.shadow.camera.near = 1\nthis.shadow.camera.far = 50\nthis.shadow.camera.top = 80\nthis.shadow.camera.bottom = -80\nthis.shadow.camera.left = -80\nthis.shadow.camera.right = 80\nthis.shadow.radius = 24\nthis.shadow.bias = -0.0075\nfunction update( event ) {}"}],"31517222-A9A7-4EAF-B5F6-60751C0BABA3":[{name:"senceScirpt",source:"this.environment.mapping = THREE.EquirectangularReflectionMapping;\nthis.environment.colorSpace = THREE.SRGBColorSpace;\nfunction update( event ) {}"}]};this.events={init:[],start:[],stop:[],keydown:[],keyup:[],pointerdown:[],pointerup:[],pointermove:[],update:[]};let s="player,renderer,scene,camera";const o={};for(const i in this.events)s+=`,${i}`,o[i]=i;const n=JSON.stringify(o).replace(/\"/g,"");for(const i in t){let o=i;i===e.uuid&&(o=this.scene.uuid);const r=this.scene.getObjectByProperty("uuid",o,!0);if(void 0===r){console.warn("player: Script without object.",o);continue}const a=t[i];for(let e=0;e<a.length;e++){const t=a[e],o=new Function(s,`${t.source}\nreturn ${n};`).bind(r)(this,this.renderer,this.scene,this.camera);for(const e in o)void 0!==o[e]&&(void 0!==this.events[e]?this.events[e].push(o[e].bind(r)):console.warn("player: Event type not supported (",e,")"))}this.dispatch(this.events.init,arguments)}},dispatch(e,t){for(let s=0,o=e.length;s<o;s++)e[s](t)},setCamera(e){console.warn("暂时不考虑摄像机的设置函数",e)},setScene(e){console.warn("暂时不考虑场景的设置函数",e)},setPixelRatio(e){console.warn("暂时不考虑像素比的设置函数",e)},setSize(e){console.warn("暂时不考虑尺寸的设置函数",e)},dispose(){console.warn("暂时不考虑释放资源的函数")},onKeyDown(e){C.dispatch(C.events.keydown,e)},onKeyUp(e){C.dispatch(C.events.keyup,e)},onPointerDown(e){C.dispatch(C.events.pointerdown,e)},onPointerUp(e){C.dispatch(C.events.pointerup,e)},onPointerMove(e){C.dispatch(C.events.pointermove,e)},play(){document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp),document.addEventListener("pointerdown",this.onPointerDown),document.addEventListener("pointerup",this.onPointerUp),document.addEventListener("pointermove",this.onPointerMove),this.dispatch(this.events.start,null)},stop(){document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("pointerdown",this.onPointerDown),document.removeEventListener("pointerup",this.onPointerUp),document.removeEventListener("pointermove",this.onPointerMove),this.dispatch(this.events.stop,arguments)},render(e,t){this.dispatch(this.events.update,{time:e,delta:t})}};const R=function(e){const t=e.points,s=[];for(const n of t){const e=n.x,t=n.y,o=n.z;s.unshift(new l(e,t,o))}const o=new u(s);return o.closed=e.closed,o}({points:[{x:-16.017528533935547,y:2.4581613540649414,z:53.098697662353516},{x:-11.40013599395752,y:2.4513251781463623,z:43.62754821777344},{x:-7.9051361083984375,y:2.4462289810180664,z:36.4436149597168},{x:-5.53253173828125,y:2.442873001098633,z:31.546899795532227},{x:-4.282320976257324,y:2.4412572383880615,z:28.937395095825195},{x:-3.9756288528442383,y:2.4410974979400635,z:28.24086570739746},{x:-3.7963345050811768,y:2.4410974979400635,z:27.74983024597168},{x:-3.6438193321228027,y:2.4410974979400635,z:27.253768920898438},{x:-3.5180840492248535,y:2.4410974979400635,z:26.75269317626953},{x:-3.419203519821167,y:2.4411063194274902,z:26.243703842163086},{x:-3.3517673015594482,y:2.4416656494140625,z:25.55027961730957},{x:-3.318483829498291,y:2.4430952072143555,z:24.5682430267334},{x:-3.319352865219116,y:2.445394515991211,z:23.297592163085938},{x:-3.354374647140503,y:2.448564052581787,z:21.73832893371582},{x:-3.4121222496032715,y:2.4521596431732178,z:19.611284255981445},{x:-3.461057662963867,y:2.454956293106079,z:16.145946502685547},{x:-3.49935245513916,y:2.456882953643799,z:11.297648429870605},{x:-3.5270066261291504,y:2.457939386367798,z:5.066390037536621},{x:-3.544764518737793,y:2.4581613540649414,z:-2.423649311065674},{x:-3.565464973449707,y:2.4581613540649414,z:-9.03036880493164},{x:-3.5937604904174805,y:2.4581613540649414,z:-13.977668762207031},{x:-3.629650592803955,y:2.4581613540649414,z:-17.265522003173828},{x:-3.673135280609131,y:2.4581613540649414,z:-18.893949508666992},{x:-3.7082104682922363,y:2.4581613540649414,z:-19.473438262939453},{x:-3.7077581882476807,y:2.4581613540649414,z:-20.038450241088867},{x:-3.6713337898254395,y:2.4581613540649414,z:-20.605941772460938},{x:-3.5989370346069336,y:2.4581613540649414,z:-21.175914764404297},{x:-3.3510568141937256,y:2.4581613540649414,z:-22.262161254882812},{x:-1.7961064577102661,y:2.4581615924835205,z:-28.032060623168945},{x:1.3139424324035645,y:2.4581618309020996,z:-39.39905548095703},{x:5.9790754318237305,y:2.458162546157837,z:-56.36309814453125},{x:12.19931411743164,y:2.458163261413574,z:-78.92425537109375}],closed:!1}),U=new p;const B=["object"],K=["object"],O=["object"],T=["object"],$=["object"],F=["object"],H=["object"],W=h({__name:"firstLevel-bf61e255d699",props:{object:{}},setup(s){const o=s,{scene:n}=e(),i=function(e){const t=R.points.length/2,s=new c(e.geometry,e.material,t);s.userData={progresses:[]};for(let o=0;o<t;o++){const e=o/(t-1),n=R.getPointAt(e);s.userData.progresses[o]=e,U.setPosition(n),s.setMatrixAt(o,U)}return s}(o.object[1]);n.value.add(i);const r=function(e){const t=[];t.push(e[2].clone()),t.push(e[4].clone()),t.push(e[5].clone()),t.push(e[2].clone()),t.push(e[5].clone()),t.push(e[4].clone()),t.push(e[2].clone()),t.push(e[4].clone());for(let s=0;s<t.length;s++){const e=s/t.length*.6;t[s].userData={progress:e};const o=R.getPointAt(e);t[s].position.copy(o),t[s].visible=!0}return t}(o.object),a=new d;a.position.set(0,1,0),a.add(...r),n.value.add(a);const p=function(e){const t=[];for(let s=0;s<6;s++){t.push(e[3].clone());const o=1-s/6*.4-.04;t[s].userData={progress:o};const n=R.getPointAt(o);t[s].position.copy(n),t[s].visible=!0}return t}(o.object),l=new d;l.add(...p),l.position.set(0,1,0),n.value.add(l);const{onLoop:u}=t();return u((({delta:e,elapsed:t})=>{i&&function(e){const t=e.userData.progresses;for(let s=0;s<e.count;s++){const o=R.getPointAt(t[s]);U.setPosition(o),e.setMatrixAt(s,U),t[s]+=5e-4,t[s]>1&&(t[s]=0)}e.instanceMatrix.needsUpdate=!0,e.computeBoundingSphere()}(i),r&&function(e){for(let t=0;t<e.length;t++){e[t].userData.progress+=5e-4,e[t].userData.progress>.6&&(e[t].userData.progress=0);const s=e[t].userData.progress,o=R.getPointAt(s);"flat_item"===e[t].name&&(o.y=1.5),e[t].position.copy(o)}}(r),p&&function(e){for(let t=0;t<e.length;t++){e[t].userData.progress+=5e-4,e[t].userData.progress>1&&(e[t].userData.progress=1-5/6*.4-.04);const s=e[t].userData.progress,o=R.getPointAt(s);e[t].position.copy(o)}}(p)})),(e,t)=>(j(),v(g,null,[y("primitive",{object:e.object[0]},null,8,B),y("primitive",{object:e.object[1],visible:!1},null,8,K),y("primitive",{object:e.object[2]},null,8,O),y("primitive",{object:e.object[4]},null,8,T),y("primitive",{object:e.object[5]},null,8,$),y("primitive",{object:e.object[6]},null,8,F),y("primitive",{object:e.object[3]},null,8,H)],64))}}),G=["object"],I=["object"],q=["object"],J=["object"],N=["object"],Y=h({__name:"scene",async setup(s){let o,r;const{scene:a,renderer:c,camera:p,sizes:l}=e();C.init(a,c,p,l);const u=new m,d=([o,r]=f((()=>n("./plugins/tresEditor/svelteMachine/json/scene.json"))),o=await o,r(),o);if(d.geometries)for(const e of d.geometries)if(e.data&&e.data.startsWith("url:")){let t=e.data.slice(4);t.startsWith("geometries/")&&(t=`./plugins/tresEditor/svelteMachine/${t}`),e.data=([o,r]=f((()=>n(t))),o=await o,r(),o)}if(d.images)for(const e of d.images)if(e.url&&e.url.startsWith("url:")){let t=e.url.slice(4);t.startsWith("images/")&&(t=`./plugins/tresEditor/svelteMachine/${t}`),e.url=([o,r]=f((()=>i(t))),o=await o,r(),o)}const h=u.parse(d),E=b(null);w((()=>{if(a.value.background=h.background,a.value.environment=h.environment,a.value.fog=h.fog,C.load(h),C.play(),E.value){const e=E.value;e.target.position.set(-3.8,0,-2.3),a.value.add(e.target),e.angle=Math.PI/2.5}}));const{onLoop:_}=t();return _((({delta:e,elapsed:t})=>{if(C.renderer&&C.render(1e3*t,1e3*e),E.value){E.value.intensity=100+100*Math.sin(2*t)}})),(e,t)=>(j(),v(g,null,[y("primitive",{object:x(h).children[0]},[z(W,{object:x(h).children[0].children},null,8,["object"])],8,G),y("primitive",{object:x(h).children[1]},null,8,I),y("primitive",{object:x(h).children[2]},null,8,q),y("primitive",{object:x(h).children[3]},null,8,J),y("primitive",{object:x(h).children[4],ref_key:"spotLightRef",ref:E},null,8,N)],64))}}),V=h({__name:"svelteMachine",setup(e){const t=E({clearColor:"#201919",windowSize:!0,antialias:!0,shadows:!0,shadowMapType:2,toneMapping:3,toneMappingExposure:1.75}),n=(new m).parse({metadata:{version:4.6,type:"Object",generator:"Object3D.toJSON"},object:{type:"PerspectiveCamera",name:"Camera",layers:1,matrix:[-.6267758441936044,-27755575615628914e-33,.7791996157182023,0,.48061725621232265,.787112942007701,.3866009176850464,0,-.6133181019392243,.6168088978962458,-.49334337870258826,0,-80.48773984917322,89.13969162136891,-91.54490099940386,1],up:[0,1,0],fov:50,zoom:1,near:.01,far:1e3,focus:10,aspect:1.1063238359972203,filmGauge:35,filmOffset:0}}),i=b(null);return _((()=>i.value),(e=>{e.copy(n)})),(e,n)=>(j(),v(g,null,[z(x(A)),z(x(o),L(S(t)),{default:P((()=>[z(x(s)),y("TresPerspectiveCamera",{ref_key:"cameraRef",ref:i,uuid:"9ca45c84-3c16-48da-b0a2-9e469abea3d1",name:"Camera"},null,512),(j(),D(M,null,{default:P((()=>[z(Y)])),_:1}))])),_:1},16)],64))}});export{V as default};
