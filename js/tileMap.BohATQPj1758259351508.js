import{P as e}from"./tweakpane.C0HtAJSg1758259351508.js";import{B as t,c as o,C as r,q as s,V as n,d3 as a,N as i,_ as l}from"./three.CtgP63ME1758259351508.js";import{m as p,e as m}from"./@tresjs.CywMBpUh1758259351508.js";import{U as u,b as c,c as h,P as d,M as g,T as w,a as f,d as b,r as j}from"./raycasterEvent.8SpJNp-I1758259351508.js";import"./HeightCorrection.Bq98L9tL1758259351508.js";import{d as x,a2 as v,w as k,G as M,o as y,u as C,v as _,r as B,h as W,j as I,f as T,m as S,F as z}from"./@vue.pEDXJ_3Z1758259351508.js";import"./three-custom-shader-material.gu_n-VhD1758259351508.js";import{c as Z}from"./utils.Bil7I9_D1758259351508.js";import"./postprocessing.DJgHFhS91758259351508.js";import"./@vueuse.C5HLo59K1758259351508.js";import"./@mapbox.B8uYRbGC1758259351508.js";import"./three-mesh-bvh.Bx1dVRfz1758259351508.js";import"./@fesjs.uDzWZsaX1758259351508.js";import"./vue-router.BT0ZZbwZ1758259351508.js";import"./lodash-es.C7pWAXPe1758259351508.js";import"./pinia.C_K98KJs1758259351508.js";import"./@qlin.q6OWdsQV1758259351508.js";import"./@babel.BPq7uOAK1758259351508.js";import"./@floating-ui.BFjFSAYt1758259351508.js";import"./@juggle.CcBCnTIR1758259351508.js";import"./@tweenjs.Dhzs71lh1758259351508.js";import"./utils.Dl9Mu6yL1758259351508.js";import"./d3-geo.D2Fk1Txq1758259351508.js";function L(e){return new Worker(""+new URL("../static/MartiniWorker-C696QXDI.js",import.meta.url).href,{name:e?.name})}class D{constructor(){this.maxZoom=12,this.coordType=u,this.utmZone=50,this._useWorker=!0,this.source="https://api.maptiler.com/tiles/terrain-rgb-v2/[z]/[x]/[y].webp?key=L55MtSxL94Yb4hQeWewp"}set useWorker(e){this._useWorker=e,this._useWorker||(this._worker?.terminate(),this._worker=void 0)}get useWorker(){return this._useWorker}async getTile(e){return this._useWorker?this.getInWorkerThread(e):this.getInMainThread()}async getInMainThread(){return new t}async getInWorkerThread(e){this._worker||(this._worker=new c(L));const r={tileNo:e,id:this.getId(e),url:this.getUrl(e),maxZ:this.maxZoom,coordType:this.coordType,utmZone:this.utmZone},s=await this._worker.postMessage(r),n=new t;return n.setAttribute("position",new o(s.positions,3)),n.setAttribute("uv",new o(s.uv,2)),n.setIndex(new o(s.triangles,1)),n}async abort(e){this._useWorker&&this._worker?.postMessage({id:this.getId(e),abort:!0})}async dispose(e,t){t.dispose(),this._useWorker&&this._worker?.postMessage({id:this.getId(e),dispose:!0})}getId(e){return e.join("-")}getUrl(e){const[t,o,r]=e;return this.source.replace("[x]",t+"").replace("[y]",o+"").replace("[z]",r+"")}}const P=["object","rotation"],R=x({__name:"tileMapMesh",props:{bbox:{default:[104.955976,20.149765,120.998419,30.528687]},maxZoom:{default:20},opposite:{type:Boolean,default:!1},genBright:{default:1},genContrast:{default:1},genSaturation:{default:1},monochrome:{default:"#fff"},isMonochrome:{type:Boolean,default:!1},mapCenter:{},tweenInstance:{default:null}},setup(e,{expose:t}){const o=e,{renderer:i,scene:l}=p(),u=new d;u.coordType=h;const c=new D;c.source="https://api.maptiler.com/tiles/terrain-rgb-v2/[z]/[x]/[y].webp?key=L55MtSxL94Yb4hQeWewp",c.coordType=h;const b=new g;b.source="https://webrd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",b.showTileNo=!1,b.useWorker=!0;const j=new w(u,b);if(j.showBoundingBox=!1,j.wireframe=!1,j.flatShading=!1,j.useStandardMaterial=!1,j.filter={opposite:o.opposite,monochrome:o.isMonochrome?{r:.299,g:.587,b:.114}:null,genBright:o.genBright,genContrast:o.genContrast,genSaturation:o.genSaturation},o.monochrome){let e=new r(o.monochrome);j.filter&&(j.filter.monochrome={r:e.r,g:e.g,b:e.b})}const x=new f;x.provider=j,x.bbox=o.bbox,x.maxZoom=o.maxZoom;const _=new s(60,window.innerWidth/window.innerHeight,1,1e8);_.up=new n(0,1,0),_.position.set(o.mapCenter[0],o.mapCenter[2],-o.mapCenter[1]),_.lookAt(new n(_.position.x,0,_.position.z-2e3)),x.camera=_;let B=null;v((()=>{i.value&&!B&&(B=new a(_,i.value.domElement),B.enableDamping=!0,B.dampingFactor=.05,B.minDistance=600,B.position0.set(_.position.x,_.position.y,_.position.z),B.target.set(_.position.x,0,_.position.z-2e3))})),k((()=>[o.opposite,o.isMonochrome,o.monochrome]),(([e,t,o])=>{if(j.filter){let s=new r(o);j.filter.opposite=e,j.filter.monochrome=t?{r:s.r,g:s.g,b:s.b}:null}})),k((()=>[o.genBright,o.genContrast,o.genSaturation]),(([e,t,o])=>{j.filter&&(j.filter.genBright=e,j.filter.genContrast=t,j.filter.genSaturation=o)}));const{onLoop:W}=m();return W((()=>{if(i.value){o.tweenInstance?.update(),B&&B.update(),x.update();const e=50*Math.abs(_.position.y);_.far=e+5e3,_.updateProjectionMatrix(),i.value.render(l.value,_)}})),t({camera:_,map:x,orbitControl:B}),(e,t)=>(y(),M("primitive",{object:C(x),rotation:[-Math.PI/2,0,0]},null,8,P))}}),U=x({__name:"tileMap",setup(t){const o=b(118.779958,32.017136),r=[o[0],o[1],5e3],s=_(),a=B({opposite:!0,genBright:1.3,genContrast:1,genSaturation:1,isMonochrome:!0,monochrome:"#4688b5",mapCenter:r,tweenInstance:null}),p=new e({title:"参数"});p.addBinding(a,"opposite",{label:"反色"}),p.addBinding(a,"genBright",{label:"高亮",min:.1,max:3,step:.1}),p.addBinding(a,"genContrast",{label:"对比度",min:.1,max:3,step:.1}),p.addBinding(a,"genSaturation",{label:"饱和度",min:.1,max:3,step:.1}),p.addBinding(a,"isMonochrome",{label:"单色滤镜"}),p.addBinding(a,"monochrome",{label:"滤镜颜色"});const m={at:b(118.7425,31.9998),xjk:b(118.7842,32.0418),nss:b(118.7503,31.9082)};p.addBlade({view:"list",label:"飞去",options:[{text:"奥体中心",value:"at"},{text:"新街口",value:"xjk"},{text:"牛首山",value:"nss"}],value:"at"}).on("change",(e=>{const t=new n(m[e.value][0],2e3,-m[e.value][1]);a.tweenInstance=Z(s.value.camera,t,s.value.orbitControl,[0,-300],4e3)}));const u=B({clearColor:"#201919",antialias:!0,logarithmicDepthBuffer:!0,renderMode:"manual",outputColorSpace:l,toneMapping:i});return setTimeout((()=>{const e=m.at,t=new n(e[0],1600,-e[1]);a.tweenInstance=Z(s.value.camera,t,s.value.orbitControl,[-2e3,-2e3],2e3)}),1e3),(e,t)=>{const o=W("TresCanvas");return y(),M(z,null,[I(o,S(u,{"window-size":""}),{default:T((()=>[I(R,S(a,{ref_key:"tileMapMeshRef",ref:s,bbox:[80,16,128,50]}),null,16)])),_:1},16),I(j,{tileMapRef:s.value},null,8,["tileMapRef"])],64)}}});export{U as default};
