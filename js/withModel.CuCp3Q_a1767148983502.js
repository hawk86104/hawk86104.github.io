import{importShared as u}from"./3d-tiles-renderer.DZNovkLO1767148983502.js";import{kk as A,yk as q,vU as E,Kk as D}from"./index.DTe2qqjO1767148983502.js";import{MqttClientWrapper as L}from"./mqttTvt.Rmkf1-Ry1767148983502.js";import{useMessage as I,NMessageProvider as U}from"./use-message.BBJznJob1767148983502.js";import{NCard as z}from"./Card.CLGorf6I1767148983502.js";import{NFormItem as x}from"./FormItem.BV0Pjtsh1767148983502.js";import{NTag as Q}from"./Tag.B40cK7ZV1767148983502.js";import{NDivider as k,NLog as R}from"./Log.Dg2CPyw71767148983502.js";import{NInput as B}from"./Input.FhrARThI1767148983502.js";import{NSwitch as M}from"./Switch.BWmbzq8P1767148983502.js";import"./customShaderMaterial.vue_vue_type_script_setup_true_lang.B7dQ_CiZ1767148983502.js";import"./index.vue_vue_type_script_setup_true_lang.CjsHShHS1767148983502.js";import{useGLTF as G}from"./index.Bk2zy1aS1767148983502.js";const{defineComponent:J}=await u("vue"),{createElementVNode:Y,createTextVNode:m,unref:l,withCtx:i,createVNode:a,openBlock:H,createElementBlock:K}=await u("vue"),W={class:"w-100 absolute z-99999 mqttdebugger",style:{"margin-top":"40px"}},{ref:_,onUnmounted:X,onMounted:Z,watch:ee,inject:te}=await u("vue"),oe=null,ne=J({__name:"widthMqtt",setup(N){const d=I(),c=_(!1),p=_(!1),t={host:"a5183db3.ala.asia-southeast1.emqxsl.com",port:8084,protocol:"wss",clientId:`tvt-test-client-${Math.random().toString(16).slice(2,8)}`,username:"tvt.js",password:"test",topic:"tvtDevices/#"},o=_(null),r=_(!1),f=_([]);function T(){o.value&&w(),o.value=new L(t),o.value.on("connected",()=>{r.value=!0,console.log("MQTT 连接成功"),b()}),o.value.on("close",()=>{r.value=!1,console.log("MQTT 连接关闭")}),o.value.on("error",n=>{console.error(`MQTT 错误: ${n.message}`)}),o.value.on("message",(n,e)=>{f.value.push(`[${n}] ${JSON.stringify(e)}`),f.value.length>100&&f.value.shift(),!p.value&&e&&e.status&&(c.value=e.status==="运行"),e&&e.detail&&d.info("mqtt["+e.deviceId+"] 设备详情："+e.detail+"程序已运行："+e.uptime,{keepAliveOnHover:!0,duration:18e3})}),o.value.connect()}function b(){o.value&&o.value.subscribe(t.topic,n=>{n?console.error(`订阅失败: ${n.message}`):console.log(`已订阅主题: ${t.topic}`)})}function w(){o.value&&(o.value.removeAllListeners(),o.value.disconnect(),o.value=null,r.value=!1)}Z(()=>{T()});function y(){o.value,w()}X(()=>{y()});let C=null;function s(n){p.value=!0;const e={deviceId:"tvtDevice001",status:n?"运行":"关闭"};o.value.publish("tvtDevices/tvtDevice001/control",e),clearTimeout(C),C=setTimeout(()=>{p.value=!1},1e3)}const h=te("animationPlay");return ee(()=>c.value,n=>{h.value=n},{immediate:!0}),(n,e)=>(H(),K("div",W,[a(l(z),{title:"MQTT 调试面板",style:{"background-color":"#d6d0c540"}},{default:i(()=>[a(l(x),{label:"注意："},{default:i(()=>[a(l(Q),{style:{padding:"30px 21px","line-height":"21px"},type:"warning"},{default:i(()=>[...e[1]||(e[1]=[m("免费服务每月流量/次数有限",-1),Y("br",null,null,-1),m("若连接失败请自行更换自己的mqtt服务",-1)])]),_:1})]),_:1}),a(l(k),{style:{"margin-top":"-10px"}},{default:i(()=>[...e[2]||(e[2]=[m("mqtt配置信息",-1)])]),_:1}),a(l(B),{value:JSON.stringify(t,null,2),type:"textarea",rows:9,disabled:""},null,8,["value"]),a(l(k),null,{default:i(()=>[...e[3]||(e[3]=[m("连接状态",-1)])]),_:1}),a(l(x),{label:"mqtt代理通路"},{default:i(()=>[a(l(M),{value:r.value},{checked:i(()=>[...e[4]||(e[4]=[m(" 已连接 ",-1)])]),unchecked:i(()=>[...e[5]||(e[5]=[m(" 连接中 ",-1)])]),_:1},8,["value"])]),_:1}),a(l(x),{label:"订阅主题"},{default:i(()=>[a(l(B),{value:t.topic,disabled:""},null,8,["value"])]),_:1}),a(l(k),null,{default:i(()=>[...e[6]||(e[6]=[m("信息日志列表",-1)])]),_:1}),a(l(R),{log:f.value.join(`
`),rows:12},null,8,["log"]),a(l(k),null,{default:i(()=>[...e[7]||(e[7]=[m("通过mqtt交互状态",-1)])]),_:1}),e[8]||(e[8]=m(" 开关电风扇 : ",-1)),a(l(M),{loading:p.value,round:!1,value:c.value,"onUpdate:value":[e[0]||(e[0]=v=>c.value=v),s]},null,8,["loading","value"])]),_:1})]))}}),{withAsyncContext:le,defineComponent:ae}=await u("vue"),{unref:S,createElementVNode:re,withCtx:ie,createVNode:O,Fragment:se,openBlock:ue,createElementBlock:ce}=await u("vue"),me=["object"],{watch:V,inject:de,toRaw:pe}=await u("vue"),fe=ae({__name:"efanModel",props:{color:{type:String,required:!0}},async setup(N){let d,c;const p=N,{nodes:t,animations:o}=([d,c]=le(()=>G("https://opensource.cdn.icegl.cn/model/eCommerce/eFan/nFan.gltf")),d=await d,c(),d),r=s=>t.Sketchfab_model.getObjectByName(s).geometry.attributes.uv.array,f={Object_4:new Float32Array(r("Object_4")),Object_8:new Float32Array(r("Object_8")),Object_6:new Float32Array(r("Object_6")),Object_6001:new Float32Array(r("Object_6001"))},T=s=>{const h={"#ff8b04":0,"#999999":.04,"#d3ac10":.19,"#ffbec4":-.06,"#d0d5c6":.55};for(const[n,e]of Object.entries(f)){for(let v=0;v<r(n).length;v++)r(n)[v]=e[v]+h[s];t.Sketchfab_model.getObjectByName(n).geometry.getAttribute("uv").needsUpdate=!0}},b=t.Sketchfab_model.getObjectByName("Object_6001"),{actions:w}=A(o,t.Sketchfab_model),y=w.Animation,C=de("animationPlay");return V(()=>p.color,s=>{T(s)},{immediate:!0}),V(()=>C.value,s=>{s?(y.reset().play(),b?.rotateY(-Math.PI)):(y.fadeOut(.6).paused=!0,b?.rotateY(Math.PI))},{immediate:!0}),(s,h)=>(ue(),ce(se,null,[O(S(q),{range:[-.5,-.5],speed:2},{default:ie(()=>[re("primitive",{position:[-2,0,0],object:pe(S(t).Sketchfab_model),scale:3},null,8,me)]),_:1}),O(S(E),{opacity:.3,blur:2.6,position:[0,-2,0]})],64))}}),{defineComponent:ve}=await u("vue"),{createElementVNode:$,unref:P,createVNode:g,Suspense:_e,withCtx:j,openBlock:F,createBlock:ge,resolveComponent:be,normalizeProps:we,guardReactiveProps:ye,Fragment:Ce,createElementBlock:he}=await u("vue"),{ref:ke,provide:$e}=await u("vue"),{BasicShadowMap:Ne,SRGBColorSpace:Te}=await u("three"),Le=ve({__name:"withModel",setup(N){const d={shadows:!0,alpha:!0,shadowMapType:Ne,outputColorSpace:Te,windowSize:!0,clearColor:"#ffffff"},c=ke(!1);return $e("animationPlay",c),(p,t)=>{const o=be("TresCanvas");return F(),he(Ce,null,[g(o,we(ye(d)),{default:j(()=>[t[0]||(t[0]=$("TresPerspectiveCamera",{position:[10,5,-8],fov:45,near:.1,far:1e5},null,-1)),g(P(D),{enableDamping:""}),(F(),ge(_e,null,{default:j(()=>[g(fe,{color:"#ff8b04"})]),_:1})),t[1]||(t[1]=$("TresAmbientLight",{intensity:2},null,-1)),t[2]||(t[2]=$("TresPointLight",{position:[0,0,10],intensity:1},null,-1)),t[3]||(t[3]=$("TresDirectionalLight",{position:[3,3,3],intensity:3},null,-1))]),_:1},16),g(P(U),null,{default:j(()=>[g(ne)]),_:1})],64)}}});export{Le as default};
