import{c as I,g as E}from"./_commonjsHelpers.5-cIlDoe1715934934621.js";var F={exports:{}};(function(R){(function(x,O,b){R.exports?R.exports=b():O[x]=b()})("h337",I,function(){var x={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}},O=function(){var _=function(r){this._coordinator={},this._data=[],this._radi=[],this._min=10,this._max=1,this._xField=r.xField||r.defaultXField,this._yField=r.yField||r.defaultYField,this._valueField=r.valueField||r.defaultValueField,r.radius&&(this._cfgRadius=r.radius)},f=x.defaultRadius;return _.prototype={_organiseData:function(s,r){var t=s[this._xField],a=s[this._yField],i=this._radi,e=this._data,h=this._max,n=this._min,o=s[this._valueField]||1,c=s.radius||this._cfgRadius||f;e[t]||(e[t]=[],i[t]=[]),e[t][a]?e[t][a]+=o:(e[t][a]=o,i[t][a]=c);var d=e[t][a];return d>h?(r?this.setDataMax(d):this._max=d,!1):d<n?(r?this.setDataMin(d):this._min=d,!1):{x:t,y:a,value:o,radius:c,min:n,max:h}},_unOrganizeData:function(){var s=[],r=this._data,t=this._radi;for(var a in r)for(var i in r[a])s.push({x:a,y:i,radius:t[a][i],value:r[a][i]});return{min:this._min,max:this._max,data:s}},_onExtremaChange:function(){this._coordinator.emit("extremachange",{min:this._min,max:this._max})},addData:function(){if(arguments[0].length>0)for(var s=arguments[0],r=s.length;r--;)this.addData.call(this,s[r]);else{var t=this._organiseData(arguments[0],!0);t&&(this._data.length===0&&(this._min=this._max=t.value),this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[t]}))}return this},setData:function(s){var r=s.data,t=r.length;this._data=[],this._radi=[];for(var a=0;a<t;a++)this._organiseData(r[a],!1);return this._max=s.max,this._min=s.min||0,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},removeData:function(){},setDataMax:function(s){return this._max=s,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setDataMin:function(s){return this._min=s,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setCoordinator:function(s){this._coordinator=s},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}},getData:function(){return this._unOrganizeData()}},_}(),b=function(){var _=function(t){var a=t.gradient||t.defaultGradient,i=document.createElement("canvas"),e=i.getContext("2d");i.width=256,i.height=1;var h=e.createLinearGradient(0,0,256,1);for(var n in a)h.addColorStop(n,a[n]);return e.fillStyle=h,e.fillRect(0,0,256,1),e.getImageData(0,0,256,1).data},f=function(t,a){var i=document.createElement("canvas"),e=i.getContext("2d"),h=t,n=t;if(i.width=i.height=t*2,a==1)e.beginPath(),e.arc(h,n,t,0,2*Math.PI,!1),e.fillStyle="rgba(0,0,0,1)",e.fill();else{var o=e.createRadialGradient(h,n,t*a,h,n,t);o.addColorStop(0,"rgba(0,0,0,1)"),o.addColorStop(1,"rgba(0,0,0,0)"),e.fillStyle=o,e.fillRect(0,0,2*t,2*t)}return i},s=function(n){for(var a=[],i=n.min,e=n.max,h=n.radi,n=n.data,o=Object.keys(n),c=o.length;c--;)for(var d=o[c],u=Object.keys(n[d]),C=u.length;C--;){var l=u[C],g=n[d][l],p=h[d][l];a.push({x:d,y:l,value:g,radius:p})}return{min:i,max:e,data:a}};function r(t){var a=t.container,i=this.shadowCanvas=document.createElement("canvas"),e=this.canvas=t.canvas||document.createElement("canvas");this._renderBoundaries=[1e4,1e4,0,0];var h=getComputedStyle(t.container)||{};e.className="heatmap-canvas",this._width=e.width=i.width=t.width||+h.width.replace(/px/,""),this._height=e.height=i.height=t.height||+h.height.replace(/px/,""),this.shadowCtx=i.getContext("2d"),this.ctx=e.getContext("2d"),e.style.cssText=i.style.cssText="position:absolute;left:0;top:0;",a.style.position="relative",a.appendChild(e),this._palette=_(t),this._templates={},this._setStyles(t)}return r.prototype={renderPartial:function(t){t.data.length>0&&(this._drawAlpha(t),this._colorize())},renderAll:function(t){this._clear(),t.data.length>0&&(this._drawAlpha(s(t)),this._colorize())},_updateGradient:function(t){this._palette=_(t)},updateConfig:function(t){t.gradient&&this._updateGradient(t),this._setStyles(t)},setDimensions:function(t,a){this._width=t,this._height=a,this.canvas.width=this.shadowCanvas.width=t,this.canvas.height=this.shadowCanvas.height=a},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height),this.ctx.clearRect(0,0,this._width,this._height)},_setStyles:function(t){this._blur=t.blur==0?0:t.blur||t.defaultBlur,t.backgroundColor&&(this.canvas.style.backgroundColor=t.backgroundColor),this._width=this.canvas.width=this.shadowCanvas.width=t.width||this._width,this._height=this.canvas.height=this.shadowCanvas.height=t.height||this._height,this._opacity=(t.opacity||0)*255,this._maxOpacity=(t.maxOpacity||t.defaultMaxOpacity)*255,this._minOpacity=(t.minOpacity||t.defaultMinOpacity)*255,this._useGradientOpacity=!!t.useGradientOpacity},_drawAlpha:function(e){for(var a=this._min=e.min,i=this._max=e.max,e=e.data||[],h=e.length,n=1-this._blur;h--;){var o=e[h],c=o.x,d=o.y,u=o.radius,C=Math.min(o.value,i),l=c-u,g=d-u,p=this.shadowCtx,v;this._templates[u]?v=this._templates[u]:this._templates[u]=v=f(u,n);var w=(C-a)/(i-a);p.globalAlpha=w<.01?.01:w,p.drawImage(v,l,g),l<this._renderBoundaries[0]&&(this._renderBoundaries[0]=l),g<this._renderBoundaries[1]&&(this._renderBoundaries[1]=g),l+2*u>this._renderBoundaries[2]&&(this._renderBoundaries[2]=l+2*u),g+2*u>this._renderBoundaries[3]&&(this._renderBoundaries[3]=g+2*u)}},_colorize:function(){var t=this._renderBoundaries[0],a=this._renderBoundaries[1],i=this._renderBoundaries[2]-t,e=this._renderBoundaries[3]-a,h=this._width,n=this._height,o=this._opacity,c=this._maxOpacity,d=this._minOpacity,u=this._useGradientOpacity;t<0&&(t=0),a<0&&(a=0),t+i>h&&(i=h-t),a+e>n&&(e=n-a);for(var C=this.shadowCtx.getImageData(t,a,i,e),l=C.data,g=l.length,p=this._palette,v=3;v<g;v+=4){var w=l[v],D=w*4;if(D){var y;o>0?y=o:w<c?w<d?y=d:y=w:y=c,l[v-3]=p[D],l[v-2]=p[D+1],l[v-1]=p[D+2],l[v]=u?p[D+3]:y}}this.ctx.putImageData(C,t,a),this._renderBoundaries=[1e3,1e3,0,0]},getValueAt:function(t){var a,i=this.shadowCtx,e=i.getImageData(t.x,t.y,1,1),h=e.data[3],n=this._max,o=this._min;return a=Math.abs(n-o)*(h/255)>>0,a},getDataURL:function(){return this.canvas.toDataURL()}},r}(),B=function(){var _=!1;return x.defaultRenderer==="canvas2d"&&(_=b),_}(),S={merge:function(){for(var m={},_=arguments.length,f=0;f<_;f++){var s=arguments[f];for(var r in s)m[r]=s[r]}return m}},M=function(){var _=function(){function t(){this.cStore={}}return t.prototype={on:function(a,i,e){var h=this.cStore;h[a]||(h[a]=[]),h[a].push(function(n){return i.call(e,n)})},emit:function(a,i){var e=this.cStore;if(e[a])for(var h=e[a].length,n=0;n<h;n++){var o=e[a][n];o(i)}}},t}(),f=function(r){var t=r._renderer,a=r._coordinator,i=r._store;a.on("renderpartial",t.renderPartial,t),a.on("renderall",t.renderAll,t),a.on("extremachange",function(e){r._config.onExtremaChange&&r._config.onExtremaChange({min:e.min,max:e.max,gradient:r._config.gradient||r._config.defaultGradient})}),i.setCoordinator(a)};function s(){var r=this._config=S.merge(x,arguments[0]||{});if(this._coordinator=new _,r.plugin){var t=r.plugin;if(x.plugins[t]){var a=x.plugins[t];this._renderer=new a.renderer(r),this._store=new a.store(r)}else throw new Error("Plugin '"+t+"' not found. Maybe it was not registered.")}else this._renderer=new B(r),this._store=new O(r);f(this)}return s.prototype={addData:function(){return this._store.addData.apply(this._store,arguments),this},removeData:function(){return this._store.removeData&&this._store.removeData.apply(this._store,arguments),this},setData:function(){return this._store.setData.apply(this._store,arguments),this},setDataMax:function(){return this._store.setDataMax.apply(this._store,arguments),this},setDataMin:function(){return this._store.setDataMin.apply(this._store,arguments),this},configure:function(r){return this._config=S.merge(this._config,r),this._renderer.updateConfig(this._config),this._coordinator.emit("renderall",this._store._getInternalData()),this},repaint:function(){return this._coordinator.emit("renderall",this._store._getInternalData()),this},getData:function(){return this._store.getData()},getDataURL:function(){return this._renderer.getDataURL()},getValueAt:function(r){return this._store.getValueAt?this._store.getValueAt(r):this._renderer.getValueAt?this._renderer.getValueAt(r):null}},s}(),G={create:function(m){return new M(m)},register:function(m,_){x.plugins[m]=_}};return G})})(F);var z=F.exports;const H=E(z);export{H as h};
