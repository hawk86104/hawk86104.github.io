import{m as n,e as t,U as e}from"./@tresjs.FlKhQDQ71735866388381.js";import{_ as r,d4 as o,a3 as a,a7 as i}from"./three.Rja0AEnA1735866388381.js";import{P as c}from"./tweakpane.yHWGBmom1735866388381.js";import{d as l,b as u,r as s,w as p,q as v,o as m,D as f,J as _,u as d,e as g,x as h,j as x,g as y,aj as b,ak as w,f as S,al as z,m as j,F as I}from"./@vue.yG49nQHr1735866388381.js";import{_ as k}from"./@fesjs.u6K5q1hz1735866388381.js";import"./@vueuse.YI3Exu6_1735866388381.js";import"./vue-router.9bMbssc81735866388381.js";import"./lodash-es.kYt-_xTG1735866388381.js";import"./@qlin.yHhFDldE1735866388381.js";import"./pinia.U7dsyb111735866388381.js";import"./vue-demi.C4xddsk91735866388381.js";import"./@floating-ui.BPbuo5Gx1735866388381.js";import"./@juggle.7yjBMqoW1735866388381.js";function D(n,t){const e=M();return(D=function(n,t){return e[n-=480]})(n,t)}const V=D;!function(n,t){const e=D,r=M();for(;;)try{if(163060===parseInt(e(511))/1+-parseInt(e(541))/2*(-parseInt(e(484))/3)+parseInt(e(531))/4+-parseInt(e(553))/5*(-parseInt(e(527))/6)+parseInt(e(507))/7+parseInt(e(544))/8+parseInt(e(537))/9*(-parseInt(e(496))/10))break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const R=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[D(540)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();!function(){R(this,(function(){const n=D,t=new RegExp("function *\\( *\\)"),e=new RegExp(n(519),"i"),r=T(n(509));t[n(480)](r+n(528))&&e[n(480)](r+n(503))?T():r("0")}))()}();const F=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[D(540)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();F(void 0,(function(){const n=D;let t;try{t=Function(n(506)+'{}.constructor("return this")( ));')()}catch(o){t=window}const e=t[n(489)]=t.console||{},r=[n(551),n(515),n(552),n(550),n(493),n(534),n(488)];for(let a=0;a<r[n(530)];a++){const t=F[n(505)][n(539)].bind(F),o=r[a],i=e[o]||t;t[n(549)]=F.bind(F),t[n(520)]=i[n(520)][n(543)](i),e[o]=t}}))();const L=[V(533)],O=[V(502),V(546),V(516)],P=41;function M(){const n=["isoValue","rotation-x","table","u_volume","Error fetching volume data:","2158866hTBwfh","gger","prototype","apply","269398nIrNRI","Cross Section Settings","bind","6048OfoIha","Vector3","vertexShader","value","addFolder","__proto__","error","log","info","25OjSFSU","test","u_isoValue","start","LinearFilter","3wurIui","TresShaderMaterial","wrapT","basicVolumeRendering","trace","console","while (true) {}","format","arrayBuffer","exception","needsUpdate","u_alphaVal","30AidGAL","minFilter","innerWidth","magFilter","u_dt","action","uniforms","input","stateObject","constructor","return (function() ","1897588SzLgnb","getElapsedTime","init","TresMesh","2316fdajqf","Display Settings","RedFormat","u_color","warn","fragmentShader","u_time","meshRef","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","toString","innerHeight","alphaVal","color","expanded","then","addBinding","276366lNiRlQ","chain","TresSphereGeometry","length","974088kvwRRY"];return(M=function(){return n})()}const A=l({__name:V(487),setup(e){var l;const g=V,h=window[g(498)],x=window[g(521)],y=u(null),b=u(null),w=new i;w[g(482)]();const S=(new c)[g(548)]({title:g(512)}),z=S[g(548)]({title:g(542)}),j=new(r[g(545)])(.5,.5,.5);z.addBinding(j,"x",{label:"X",min:.02,max:.5,step:.02}),z[g(526)](j,"y",{label:"Y",min:.02,max:.5,step:.02}),z[g(526)](j,"z",{label:"Z",min:.02,max:.5,step:.02}),z[g(524)]=!0;const{camera:I}=n(),k=s({u_camera:{value:null==(l=I[g(547)])?void 0:l.position},u_resolution:{value:new(r[g(545)])(h,x,1)},u_dt:{value:.004},u_time:{value:0},u_crossSectionSize:{value:j},u_color:{value:1},u_volume:{value:null},u_isoValue:{value:.2},u_alphaVal:{value:.2}}),D=S.addFolder({title:"Algorithm Settings"});D[g(526)](k[g(500)],"value",{label:"dt",min:4e-4,max:.016,step:2e-4}),D[g(526)](k[g(514)],g(547),{label:g(523),min:1,max:3,step:1}),D.addBinding(k[g(495)],g(547),{label:g(522),min:.01,max:1,step:.01}),D[g(526)](k[g(481)],g(547),{label:g(532),min:0,max:1,step:.04}),p(b,(n=>{const t=g;if(n){const e=new o(n,P,P,P);e[t(491)]=r[t(513)],e[t(497)]=r[t(483)],e[t(499)]=r[t(483)],e[t(486)]=a,e[t(494)]=!0,k[t(535)][t(547)]=e}}));const{onLoop:R}=t();return R((()=>{const n=g;k[n(517)][n(547)]=w[n(508)]()})),v((()=>{(()=>{const n=g;fetch("/plugins/volumeRendering/image/nucleon_41x41x41_uint8.raw")[n(525)]((t=>t[n(492)]()))[n(525)]((t=>{const e=n,r=new Uint8Array(t),o=new Uint8Array(68921);for(let n=0;n<r[e(530)];n++)o[n]=r[n];b.value=o})).catch((t=>{const e=n;console.error(e(536),t)}))})()})),(n,t)=>{const e=g;return m(),f(e(510),{ref_key:e(518),ref:y,"rotation-x":Math.PI/-2},[t[0]||(t[0]=_(e(529),{args:[1,16,16]},null,-1)),_(e(485),{uniforms:k,vertexShader:d("precision mediump float;\n\nuniform vec3 u_camera;\nuniform vec3 u_resolution;\nuniform float u_time;\n\nvarying vec3 v_hitPos;\nvarying vec3 v_hitPosWorldSpace;\nvarying vec3 v_cameraObjectSpace;\n\nvoid main() {\n  vec3 pos = position;\n\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\n\n  v_hitPos = position.xyz;\n\n  v_hitPosWorldSpace = (modelMatrix * vec4(position, 1.0)).xyz;\n\n  v_cameraObjectSpace = (inverse(modelMatrix) * vec4(u_camera, 1.0)).xyz;\n}"),fragmentShader:d("precision mediump int;\nprecision mediump float;\n\nuniform vec3 u_camera;\nuniform vec3 u_resolution;\nuniform mediump sampler3D u_volume;\nuniform vec3 u_crossSectionSize;\nuniform float u_dt;\nuniform float u_time;\nuniform float u_color;\nuniform float u_isoValue;\nuniform float u_alphaVal;\n\nvec3 palette(in float t) {\n  vec3 a = vec3(0.5, 0.5, 0.5);\n  vec3 b = vec3(0.5, 0.5, 0.5);\n  vec3 c = vec3(1.0, 1.0, 1.0);\n  vec3 d = vec3(0.00, 0.33, 0.67);\n\n  return a + b * cos(6.28318 * (c * t + d));\n}\n\nvarying vec3 v_hitPos;\nvarying vec3 v_hitPosWorldSpace;\nvarying vec3 v_cameraObjectSpace;\n\nvec2 intersect_box(vec3 orig, vec3 dir) {\n\n  vec3 box_min = vec3(-u_crossSectionSize);\n  vec3 box_max = vec3(u_crossSectionSize);\n  vec3 inv_dir = 1.0 / dir;\n  vec3 tmin_tmp = (box_min - orig) * inv_dir;\n  vec3 tmax_tmp = (box_max - orig) * inv_dir;\n  vec3 tmin = min(tmin_tmp, tmax_tmp);\n  vec3 tmax = max(tmin_tmp, tmax_tmp);\n  float t0 = max(tmin.x, max(tmin.y, tmin.z));\n  float t1 = min(tmax.x, min(tmax.y, tmax.z));\n  return vec2(t0, t1);\n}\n\nvoid main() {\n  vec3 rayOrigin = vec3(0.0, 0.0, -3.0);\n  rayOrigin = v_cameraObjectSpace;\n\n  vec2 uv = 2.0 * gl_FragCoord.xy / u_resolution.xy - 1.0;\n  vec3 rayDir = normalize(vec3(uv, 1.0));\n  rayDir = normalize(v_hitPos - rayOrigin);\n\n  vec2 t_hit = intersect_box(rayOrigin, rayDir);\n  if (t_hit.x > t_hit.y) {\n    discard;\n  }\n\n  t_hit.x = max(t_hit.x, 0.0);\n\n  float dt = u_dt;\n\n  vec4 color = vec4(0.0);\n\n  vec3 p = rayOrigin + t_hit.x * rayDir + 0.5;\n  for (float t = t_hit.x; t < t_hit.y; t += dt) {\n\n    float textureVal = texture(u_volume, p).r;\n\n    vec4 val_color = vec4(0.0);\n    float val_color_alpha = textureVal * 0.1;\n\n    val_color_alpha = smoothstep(0.0, u_alphaVal, val_color_alpha);\n\n    vec3 red = vec3(1.0, 0.0, 0.0);\n    vec3 white = vec3(1.0);\n    if (abs(u_color - 1.0) <= 0.01) {\n      val_color = vec4(white, val_color_alpha);\n    } else if (abs(u_color - 2.0) <= 0.01) {\n      val_color = vec4(mix(red, white, val_color_alpha), val_color_alpha);\n    } else {\n      val_color = vec4(palette(textureVal), val_color_alpha);\n    }\n\n    color.rgb += (1.0 - color.a) * val_color.a * val_color.rgb;\n    color.a += (1.0 - color.a) * val_color.a;\n\n    if (textureVal > u_isoValue) {\n      float gxLess = texture(u_volume, vec3(p.x - rayDir.x * u_dt, p.y, p.z)).r;\n      float gxMore = texture(u_volume, vec3(p.x + rayDir.x * u_dt, p.y, p.z)).r;\n      float dgx = gxMore - gxLess;\n\n      float gyLess = texture(u_volume, vec3(p.x, p.y - rayDir.y * u_dt, p.z)).r;\n      float gyMore = texture(u_volume, vec3(p.x, p.y + rayDir.y * u_dt, p.z)).r;\n      float dgy = gyMore - gyLess;\n\n      float gzLess = texture(u_volume, vec3(p.x, p.y, p.z - rayDir.z * u_dt)).r;\n      float gzMore = texture(u_volume, vec3(p.x, p.y, p.z + rayDir.z * u_dt)).r;\n      float dgz = gzMore - gzLess;\n      vec3 n = normalize(vec3(dgx, dgy, dgz));\n\n      vec3 lightSource = vec3(1.0);\n      vec3 lightDir = normalize(lightSource);\n      float diffuseStrength = max(dot(n, lightDir), 0.0);\n\n      vec3 viewSource = normalize(rayOrigin);\n      vec3 reflectSource = normalize(reflect(-lightSource, n));\n      float specularStrength = max(0.0, dot(viewSource, reflectSource));\n      specularStrength = pow(specularStrength, 64.0);\n\n      color.rgb = diffuseStrength * val_color.rgb + specularStrength * val_color.rgb;\n      color.rgb *= val_color.rgb;\n      color.a = 0.95;\n      break;\n    }\n\n    if (color.a >= 0.95) {\n      break;\n    }\n\n    p += rayDir * dt;\n  }\n\n  gl_FragColor = color;\n}")},null,8,O)],8,L)}}});function T(n){function t(n){const e=D;if("string"==typeof n)return function(n){}[e(505)](e(490))[e(540)]("counter");1!==(""+n/n)[e(530)]||n%20==0?function(){return!0}[e(505)]("debu"+e(538)).call(e(501)):function(){return!1}.constructor("debu"+e(538))[e(540)](e(504)),t(++n)}try{if(n)return t;t(0)}catch(e){}}function C(n,t){const e=E();return(C=function(n,t){return e[n-=410]})(n,t)}const B=C;!function(n,t){const e=C,r=E();for(;;)try{if(714810===parseInt(e(450))/1+-parseInt(e(432))/2+parseInt(e(438))/3+-parseInt(e(430))/4*(parseInt(e(422))/5)+-parseInt(e(421))/6*(parseInt(e(444))/7)+-parseInt(e(424))/8*(-parseInt(e(447))/9)+parseInt(e(416))/10*(parseInt(e(420))/11))break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const U=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e.apply(t,arguments);return e=null,n}}:function(){};return n=!1,r}}();!function(){U(this,(function(){const n=C,t=new RegExp(n(429)),e=new RegExp(n(445),"i"),r=N(n(455));t[n(426)](r+n(414))&&e[n(426)](r+n(413))?N():r("0")}))()}();const Z=function(){let n=!0;return function(t,e){const r=n?function(){if(e){const n=e[C(435)](t,arguments);return e=null,n}}:function(){};return n=!1,r}}();function E(){const n=["793565xNOCPI","__proto__","8ulrAtv","TresGridHelper","test","gger","basicVolume","function *\\( *\\)","20neQnBU","constructor","2096364igwsBL","log","while (true) {}","apply","TresPerspectiveCamera","table","791082UCwFiF","error","_blank","toString","#201919","console","19166LWbRFa","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","counter","9678978KKrtPg"," https://klacansky.com/open-scivis-datasets/skull/skull_256x256x256_uint8.raw ","TresCanvas","799283NupNZt","div","warn","action","bind","init","TresAmbientLight","https://klacansky.com/open-scivis-datasets/skull/skull_256x256x256_uint8.raw","stateObject","debu","input","chain","call","790PkyhMR","length","trace","info","158488dnHTLY","1578yFhbnL"];return(E=function(){return n})()}Z(void 0,(function(){const n=C,t=function(){let n;try{n=Function('return (function() {}.constructor("return this")( ));')()}catch(t){n=window}return n}(),e=t[n(443)]=t.console||{},r=[n(433),n(452),n(419),n(439),"exception",n(437),n(418)];for(let o=0;o<r.length;o++){const t=Z[n(431)].prototype[n(454)](Z),a=r[o],i=e[a]||t;t[n(423)]=Z[n(454)](Z),t[n(441)]=i[n(441)][n(454)](i),e[a]=t}}))();function N(n){function t(n){const e=C;if("string"==typeof n)return function(n){}[e(431)](e(434))[e(435)](e(446));1!==(""+n/n)[e(417)]||n%20==0?function(){return!0}[e(431)](e(412)+e(427))[e(415)](e(453)):function(){return!1}[e(431)](e(412)+e(427))[e(435)](e(411)),t(++n)}try{if(n)return t;t(0)}catch(e){}}const W=k(l({__name:B(428),setup(n){const t=s({windowSize:!0,alpha:!0,antialias:!0,autoClear:!1,disableRender:!0}),r=s({enableDamping:!0,enableZoom:!0,enablePan:!0,enableRotate:!0,makeDefault:!0});return(n,o)=>{const a=C,i=g(a(449));return m(),f(I,null,[o[3]||(o[3]=_(a(451),{class:a(419)},[_("a",{href:a(410),target:a(440)},a(448)),_("br"),h(" 请自行下载数据集, 复制到 /plugins/volumeRendering/image/skull_256x256x256_uint8.raw 并更改文件请求指向和 dim 大小 ")],-1)),x(i,j({clearColor:a(442)},t),{default:y((()=>[o[0]||(o[0]=_(a(436),{fov:75,near:.001,far:1e3,position:[-1,.4,-1],"look-at":[0,0,0],up:[0,1,0]},null,-1)),o[1]||(o[1]=_(a(456),{intensity:2},null,-1)),x(d(e),b(w(r)),null,16),(m(),S(z,null,{default:y((()=>[x(A,{position:[0,0,0]})])),_:1})),o[2]||(o[2]=_(a(425),{args:[50,50],position:[0,-5,0]},null,-1))])),_:1},16)],64)}}}),[["__scopeId","data-v-925b4c37"]]);export{W as default};
