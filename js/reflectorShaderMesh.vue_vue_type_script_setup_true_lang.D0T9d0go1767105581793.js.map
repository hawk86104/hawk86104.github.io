{"version":3,"file":"reflectorShaderMesh.vue_vue_type_script_setup_true_lang.D0T9d0go1767105581793.js","sources":["../../src/plugins/floor/components/reflectorShaderMesh.vue"],"sourcesContent":["<!--\n * @Description: \n * @Version: 1.668\n * @Autor: 地虎降天龙\n * @Date: 2023-12-22 16:05:20\n * @LastEditors: 地虎降天龙\n * @LastEditTime: 2025-10-14 15:58:04\n-->\n\n<template>\n    <TresGroup v-if=\"!isLoading\">\n        <primitive :object=\"meshOB\" />\n        <primitive :object=\"gridHelp\" :position=\"[0, 0.01, 0]\"/>\n    </TresGroup>\n</template>\n\n<script lang=\"ts\" setup>\nimport { Vector2, PlaneGeometry, Mesh, RepeatWrapping, Color, GridHelper } from 'three'\nimport { useTres } from '@tresjs/core'\nimport { useTextures } from '@tresjs/cientos'\nimport { Reflector, ReflectorMaterial } from '../lib/alienJS/all.three.js'\nimport { watchEffect, watch } from 'vue'\nimport { fixSpritesForMirror } from '../common/utils.js'\nconst props = withDefaults(\n    defineProps<{\n        reflectivity?: Number // 反射率\n        mirror?: Number // 去除纹理 镜面化\n        mixStrength?: Number //混合\n        showGridHelper?: boolean\n        color?: string\n    }>(),\n    {\n        reflectivity: 0.2,\n        mirror: 0.1,\n        mixStrength: 9,\n        showGridHelper: true,\n        color: '#ffffff',\n    },\n)\n\nconst { scene } = useTres()\n\nconst { textures: pTexture, isLoading } = useTextures([\n    './plugins/floor/image/concrete_wet_floor_basecolor.jpg',\n    './plugins/floor/image/concrete_wet_floor_normal.jpg',\n])\n\nlet material = null as any\nlet meshOB = null as any\nlet gridHelp = null as any\n\nwatch([pTexture, isLoading], ([pTexture, isLoading]) => {\n    if (pTexture && pTexture.length === 2 && !isLoading) {\n        pTexture[0].wrapS = RepeatWrapping\n        pTexture[0].wrapT = RepeatWrapping\n        pTexture[1].wrapS = RepeatWrapping\n        pTexture[1].wrapT = RepeatWrapping\n\n        const reflector = new Reflector()\n\n        material = new ReflectorMaterial({\n            reflectivity: props.reflectivity, //反射率\n            mirror: props.mirror,\n            mixStrength: props.mixStrength,\n            color: new Color(props.color),\n            map: pTexture[0],\n            normalMap: pTexture[1],\n            normalScale: new Vector2(5, 5),\n            fog: scene.value.fog,\n            dithering: true,\n        })\n\n        material.uniforms.tReflect = reflector.renderTargetUniform\n        material.uniforms.uMatrix = reflector.textureMatrixUniform\n\n        const geometry = new PlaneGeometry(10, 10)\n        meshOB = new Mesh(geometry, material)\n        meshOB.name = 'reflectorShaderMesh'\n        meshOB.position.y = -0.01\n        meshOB.rotation.x = -Math.PI / 2\n\n        meshOB.add(reflector)\n        meshOB.onBeforeRender = (rendererSelf, sceneSelf, cameraSelf) => {\n            meshOB.visible = false\n            fixSpritesForMirror(sceneSelf)\n            reflector.update(rendererSelf, sceneSelf, cameraSelf)\n            fixSpritesForMirror(sceneSelf,false)\n            meshOB.visible = true\n        }\n        gridHelp = new GridHelper(9.5, 10)\n        gridHelp.visible = props.showGridHelper\n    }\n})\n\nwatchEffect(() => {\n    if (props.reflectivity && material) {\n        material.uniforms.uReflectivity.value = props.reflectivity\n    }\n    if (props.mirror && material) {\n        material.uniforms.uMirror.value = props.mirror\n    }\n    if (props.mixStrength && material) {\n        material.uniforms.uMixStrength.value = props.mixStrength\n    }\n    if (props.color && material) {\n        material.uniforms.uColor.value = new Color(props.color)\n    }\n})\nwatch(\n    () => props.showGridHelper,\n    (newVal) => {\n        gridHelp.visible = newVal\n    },\n)\n</script>\n"],"names":["useTres","useTextures","pTexture","isLoading"],"mappings":"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"}