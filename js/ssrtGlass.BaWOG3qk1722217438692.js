import{_ as t}from"./index.byhbbwDx1722217438692.js";import{a6 as n,o as e,W as r,Z as o,q as i,z as a,k as c,j as s}from"./three.ej3u8izI1722217438692.js";import{p as l,$ as u,N as f,a as p,d as v}from"./@tresjs.vs5lCFs11722217438692.js";import{_ as d}from"./whiteFloorMesh.vue_vue_type_script_setup_true_lang.YBPyOPaV1722217438692.js";import{_ as m}from"./skyBoxAmesh.vue_vue_type_script_setup_true_lang.64N_xVXb1722217438692.js";import{P as h}from"./tweakpane.yHWGBmom1722217438692.js";import{d as x,a4 as g,a1 as w,w as y,o as b,D as C,u as S,r as _,e as F,j as P,g as I,f as z,al as D,aj as j,ak as k,m as M,F as N,J as R}from"./@vue.Q1VpS3901722217438692.js";import"./default.vue_vue_type_script_setup_true_lang.OB2u4qdb1722217438692.js";import"./@fesjs.oJOSvSTI1722217438692.js";import"./vue-router.K-gJhGrY1722217438692.js";import"./lodash-es.nFpJXAf-1722217438692.js";import"./@vueuse.mG9rDBoo1722217438692.js";import"./@qlin.yHhFDldE1722217438692.js";import"./pinia.iyC53SMr1722217438692.js";import"./@floating-ui.BPbuo5Gx1722217438692.js";import"./@juggle.7yjBMqoW1722217438692.js";!function(t,n){for(var e=B,r=W();;)try{if(683859===parseInt(e(359))/1*(parseInt(e(372))/2)+parseInt(e(357))/3+parseInt(e(360))/4+-parseInt(e(385))/5+-parseInt(e(365))/6+-parseInt(e(393))/7*(parseInt(e(348))/8)+parseInt(e(376))/9*(parseInt(e(392))/10))break;r.push(r.shift())}catch(o){r.push(r.shift())}}();var T=function(){var t=!0;return function(n,e){var r=t?function(){if(e){var t=e[B(363)](n,arguments);return e=null,t}}:function(){};return t=!1,r}}();!function(){T(this,(function(){var t=B,n=new RegExp(t(361)),e=new RegExp("\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","i"),r=A(t(388));n[t(397)](r+t(395))&&e[t(397)](r+t(380))?A():r("0")}))()}();var E=function(){var t=!0;return function(n,e){var r=t?function(){if(e){var t=e[B(363)](n,arguments);return e=null,t}}:function(){};return t=!1,r}}();function W(){var t=["33rdvAmW","593956IRDWQI","function *\\( *\\)","call","apply","log","2668194zPSRXv","camera","return (function() ","toString","add","Mesh","stateObject","43024mrCuxA","gl_FragColor = texture2D(uTexture, vUv);","constructor","  \n                }","6946218wbnuSa","string","debu","counter","input","uTexture","setRenderTarget","material","render","983375MheWoK","uniforms","PerspectiveCamera","init","console","gger","length","10wOTUza","28Edpzmx","\n                varying vec2 vUv;\n\n                void main() {\n                    vUv = uv;\n                    gl_Position = vec4(position.xy, 0.0, 1.0);    \n                }","chain",'{}.constructor("return this")( )',"test","value","ShaderMaterial","1638744IOyUXx","renderer","mesh","\n                uniform sampler2D uTexture;\n\n                varying vec2 vUv;\n\n                void main() {\n                    ","trace","PlaneGeometry","exception","warn","scene","1543254rZjVug","bind"];return(W=function(){return t})()}function B(t,n){var e=W();return(B=function(t,n){return e[t-=348]})(t,n)}E(void 0,(function(){for(var t=B,n=function(){var t,n=B;try{t=Function(n(367)+n(396)+");")()}catch(e){t=window}return t}(),e=n[t(389)]=n.console||{},r=[t(364),t(355),"info","error",t(354),"table",t(352)],o=0;o<r[t(391)];o++){var i=E[t(374)].prototype[t(358)](E),a=r[o],c=e[a]||i;i.__proto__=E[t(358)](E),i[t(368)]=c[t(368)][t(358)](c),e[a]=i}}))();class V{constructor(t,r){var o=B;this[o(383)]=new(n[o(399)])({uniforms:{uTexture:{type:"t",value:null}},vertexShader:o(394),fragmentShader:o(351)+(r||o(373))+o(375),depthTest:!1,depthWrite:!1}),this[o(350)]=new(n[o(370)])(new(n[o(353)])(2,2),this[o(383)]),this[o(366)]=new(n[o(387)])(45,window.innerWidth/window.innerHeight,1,1e3),this[o(349)]=t,this[o(356)]=new e,this[o(356)][o(369)](this.mesh)}blit(t,n){var e=B;this[e(349)][e(382)](n),this[e(383)][e(386)][e(381)][e(398)]=t,this[e(349)][e(384)](this.scene,this[e(366)]),this[e(349)].setRenderTarget(null)}}function A(t){function n(t){var e=B;if(typeof t===e(377))return function(t){}[e(374)]("while (true) {}").apply(e(379));1!==(""+t/t).length||t%20==0?function(){return!0}.constructor(e(378)+e(390))[e(362)]("action"):function(){return!1}[e(374)](e(378)+e(390))[e(363)](e(371)),n(++t)}try{if(t)return n;n(0)}catch(e){}}const H=q;!function(t,n){const e=q,r=U();for(;;)try{if(498774===-parseInt(e(223))/1*(parseInt(e(268))/2)+parseInt(e(241))/3*(parseInt(e(266))/4)+parseInt(e(259))/5+-parseInt(e(237))/6*(-parseInt(e(251))/7)+-parseInt(e(230))/8*(-parseInt(e(271))/9)+parseInt(e(249))/10+-parseInt(e(290))/11)break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const X=function(){let t=!0;return function(n,e){const r=t?function(){if(e){const t=e.apply(n,arguments);return e=null,t}}:function(){};return t=!1,r}}();function U(){const t=["setRenderTarget","Vector2","WebGLRenderTarget","1990167MRGpFm","getFrontFaceTexture","bind","uniforms",'{}.constructor("return this")( )',"call","function *\\( *\\)","gger","3963650ggqEjz","toString","13027CIZhpu","test","__proto__","scene","init","material","mesh","camera","2093255mcZZLj","debu","uSample","uCameraFarInverse","ping","table","traverse","4FwmPva","chain","1853686HEWnAi","pong","frontFaceMaterial","566289YGsNHu","blitProgram","Scene","\n                uniform float uCameraFarInverse;\n\n                varying vec3 vWorldSpaceNormal;\n                varying vec3 vCameraSpacePos;\n\n                void main() {\n                    float currentDepth = abs(vCameraSpacePos.z) * uCameraFarInverse;\n                    gl_FragColor = vec4(vWorldSpaceNormal, currentDepth);    \n                }","length","console","getBackFaceTexture","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","compute","while (true) {}","counter","FrontSide","texture","constructor","far","\n                varying vec3 vCameraSpacePos;\n                varying vec3 vWorldSpaceNormal;\n\n                void main() {\n                    vCameraSpacePos = (modelViewMatrix * vec4(position, 1.0)).xyz;\n                    vWorldSpaceNormal = normal;\n\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);    \n                }","return (function() ","autoClear","FloatType","14235881CJxBLJ","clone","resultBuffer","add","render","exception","1KRVfcm","error","apply","uPrevDepth","ShaderMaterial","renderer","trace","40QvGmgg","info","value","string","Mesh","clear","frontFaceRT","2988MgYBbq"];return(U=function(){return t})()}!function(){X(this,(function(){const t=q,n=new RegExp(t(247)),e=new RegExp(t(278),"i"),r=Y(t(255));n.test(r+t(267))&&e[t(252)](r+"input")?Y():r("0")}))()}();const Z=function(){let t=!0;return function(n,e){const r=t?function(){if(e){const t=e[q(225)](n,arguments);return e=null,t}}:function(){};return t=!1,r}}();Z(void 0,(function(){const t=q;let n;try{n=Function(t(287)+t(245)+");")()}catch(o){n=window}const e=n[t(276)]=n[t(276)]||{},r=["log","warn",t(231),t(224),t(222),t(264),t(229)];for(let i=0;i<r.length;i++){const n=Z[t(284)].prototype[t(243)](Z),o=r[i],a=e[o]||n;n[t(253)]=Z[t(243)](Z),n[t(250)]=a.toString.bind(a),e[o]=n}}))();class O{constructor(t,e,a){const c=q;this[c(257)]=t[c(291)](),this[c(258)]=e,this[c(228)]=a,this[c(254)]=new(n[c(273)]),this[c(254)][c(220)](this.mesh),this[c(272)]=new V(this.renderer),this[c(263)]=new(n[c(240)])(innerWidth,innerHeight,{type:n[c(289)],depthBuffer:!1,stencilBuffer:!1}),this.pong=new r(innerWidth,innerHeight,{type:n[c(289)],depthBuffer:!1,stencilBuffer:!1}),this.frontFaceRT=new r(innerWidth,innerHeight,{type:n[c(289)]}),this.frontFaceMaterial=new(n[c(227)])({uniforms:{uCameraFarInverse:{value:1/this.camera[c(285)]}},vertexShader:c(286),fragmentShader:c(274),depthTest:!0,depthWrite:!0,side:n[c(282)]}),this[c(256)]=new(n[c(227)])({uniforms:{uScreenSize:{value:new(n[c(239)])(innerWidth,innerHeight)},uPrevDepth:{type:"t",value:this.ping[c(283)]},uCameraFarInverse:{value:1/this[c(258)].far},uSample:{value:0}},vertexShader:"\n                varying vec3 vCameraSpacePos;\n                varying vec3 vWorldSpaceNormal;\n\n                void main() {\n                    vCameraSpacePos = (modelViewMatrix * vec4(position, 1.0)).xyz;\n                    vWorldSpaceNormal = normalize((modelMatrix * vec4(normal, 0.0)).xyz);\n\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);    \n                }",fragmentShader:"\n                uniform sampler2D uPrevDepth;\n                uniform float uCameraFarInverse;\n                uniform float uSample;\n                uniform vec2  uScreenSize;\n\n                varying vec3 vWorldSpaceNormal;\n                varying vec3 vCameraSpacePos;\n\n                void main() {\n\n                    vec2 uv = gl_FragCoord.xy / uScreenSize;\n                    float prevRegisteredDepth = texture2D(uPrevDepth, uv).w;\n                    float currentDepth        = abs(vCameraSpacePos.z) * uCameraFarInverse;\n\n                    if(currentDepth <= prevRegisteredDepth) {\n                        discard;\n                    }\n\n                    gl_FragColor = vec4(vWorldSpaceNormal, currentDepth);    \n                }",depthTest:!1,depthWrite:!1,side:o}),this[c(257)][c(265)]((t=>{const n=c;t instanceof i&&(t.material=this[n(256)])}))}[H(279)](t){const e=H;this[e(228)][e(238)](this[e(263)]),this[e(228)].clear(),this[e(228)][e(238)](this[e(269)]),this[e(228)][e(235)](),this.mesh[e(265)]((t=>{const n=e;t instanceof i&&(t[n(256)]=this[n(256)])})),this[e(256)].uniforms[e(262)][e(232)]=1/this.camera[e(285)];for(let n=0;n<t;n++){let t=n%2==0?this[e(263)]:this[e(269)],r=n%2==0?this.pong:this.ping;this[e(256)].uniforms[e(226)][e(232)]=t[e(283)],this[e(256)][e(244)][e(261)].value=n,this[e(228)][e(288)]=!1,this[e(228)].setRenderTarget(r),this[e(228)][e(221)](this[e(254)],this.camera),this.renderer[e(288)]=!0,this[e(272)].blit(r[e(283)],t)}this[e(219)]=t%2==0?this[e(263)]:this[e(269)],this[e(257)].traverse((t=>{const r=e;t instanceof n[r(234)]&&(t.material=this[r(270)])})),this[e(228)][e(238)](this[e(236)]),this.renderer[e(221)](this[e(254)],this[e(258)])}[H(277)](){const t=H;return this[t(219)][t(283)]}[H(242)](){const t=H;return this.frontFaceRT[t(283)]}}function q(t,n){const e=U();return(q=function(t,n){return e[t-=219]})(t,n)}function Y(t){function n(t){const e=q;if(typeof t===e(233))return function(t){}[e(284)](e(280))[e(225)](e(281));1!==(""+t/t)[e(275)]||t%20==0?function(){return!0}.constructor(e(260)+e(248))[e(246)]("action"):function(){return!1}.constructor(e(260)+"gger")[e(225)]("stateObject"),n(++t)}try{if(t)return n;n(0)}catch(e){}}const L=$;function $(t,n){const e=J();return($=function(t,n){return e[t-=251]})(t,n)}!function(t,n){const e=$,r=J();for(;;)try{if(886489===-parseInt(e(270))/1*(parseInt(e(251))/2)+-parseInt(e(294))/3*(-parseInt(e(295))/4)+-parseInt(e(288))/5*(parseInt(e(318))/6)+-parseInt(e(263))/7*(parseInt(e(272))/8)+-parseInt(e(259))/9*(parseInt(e(317))/10)+-parseInt(e(300))/11+parseInt(e(271))/12*(parseInt(e(314))/13))break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const G=function(){let t=!0;return function(n,e){const r=t?function(){if(e){const t=e[$(275)](n,arguments);return e=null,t}}:function(){};return t=!1,r}}();function J(){const t=["extintionCol2Random","warn","stateObject","817126jNsfUa","2195772dhoAEk","16aiNkeJ","action","uniforms","apply","material","traverse","uExtintionColor1","trace",'{}.constructor("return this")( )',"Vector4","test","uExtintionColor2","getFrontFaceTexture","convertLinearToSRGB","rgb(192,123,25)","exposure","215asTRhU","debu","exception","__proto__","ssrtGlassMesh","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","33pBehId","20972JSOwCU","extintionCol1Random","modelName","object","call","11885005WlrkbA","setRenderTarget","ClampToEdgeWrapping","getBackFaceTexture","uBackFaceBuffer","./draco/","rgb(26, 166, 192)","toString","autoClear","clone","bind","constructor","extintionFactor","#fff","559THXxRa","uExtinctionFX1","side","170cThWua","227034XSVFXF","chain","init","getObjectByName","reflectionFactor","gger","uExtintionFactor","FrontSide","error","prototype","uReflectionFactor","uFrontFaceBuffer","Vector3","extintionColor2","table","value","uCameraPos","magFilter","Color","4mEqgMn","extintionColor1","info","compute","LinearMipmapLinearFilter","Mesh","log","modelPath","866979RBcMfq","sub","console","uExposure","3709846NFBvXj","length","while (true) {}","input"];return(J=function(){return t})()}!function(){G(this,(function(){const t=$,n=new RegExp("function *\\( *\\)"),e=new RegExp(t(293),"i"),r=nt(t(320));n[t(282)](r+t(319))&&e[t(282)](r+t(266))?nt():r("0")}))()}();const Q=function(){let t=!0;return function(n,e){const r=t?function(){if(e){const t=e[$(275)](n,arguments);return e=null,t}}:function(){};return t=!1,r}}();Q(void 0,(function(){const t=$,n=function(){const t=$;let n;try{n=Function("return (function() "+t(280)+");")()}catch(e){n=window}return n}(),e=n[t(261)]=n[t(261)]||{},r=[t(257),t(268),t(253),t(326),t(290),t(332),t(279)];for(let o=0;o<r[t(264)];o++){const n=Q[t(311)][t(327)][t(310)](Q),i=r[o],a=e[i]||n;n[t(291)]=Q[t(310)](Q),n.toString=a[t(307)][t(310)](a),e[i]=n}}))();const K=[L(298)],tt=x({__name:L(292),props:{skyBoxTexture:{},modelPath:{},modelName:{},extintionFactor:{default:5},reflectionFactor:{default:1},exposure:{default:0},extintionColor1:{default:L(286)},extintionColor2:{default:L(306)},extintionCol1Random:{type:Boolean,default:!1},extintionCol2Random:{type:Boolean,default:!1}},async setup(t){const e=L;let r,o;const i=t,{map:v}=([r,o]=g((()=>f({map:i.skyBoxTexture}))),r=await r,o(),r);v.wrapS=n[e(302)],v.wrapT=n[e(302)],v[e(335)]=n[e(255)],v.minFilter=a;const{camera:d,renderer:m,scene:h}=l(),x=new c({uniforms:{uSkybox:{type:"t",value:v},uBackFaceBuffer:{type:"t",value:null},uFrontFaceBuffer:{type:"t",value:null},uCameraFarInverse:{value:1/d[e(333)].far},uScreenSizeInv:{value:new s(1/window.innerWidth,1/window.innerHeight)},uCameraPos:{value:new(n[e(330)])(0,0,0)},uTime:{value:0},uExtintionColor1:{value:new(n[e(336)])(e(313))[e(260)](new(n[e(336)])(i[e(252)])[e(285)]())},uExtintionColor2:{value:new(n[e(336)])(e(313))[e(260)](new(n[e(336)])(i[e(331)])[e(285)]())},uExtintionFactor:{value:i[e(312)]},uExposure:{value:i[e(287)]},uReflectionFactor:{value:i.reflectionFactor},uExtinctionFX1:{value:new(n[e(281)])(i.extintionCol1Random?1:0,i[e(267)]?1:0,0,1)}},vertexShader:"varying vec3 vWorldSpaceFragPos;\nvarying vec3 vWorldSpaceNormal;\n// NOTE: we don't need the projViewModel matrix, because vWorldSpaceFragPos is already multiplied by the model matrix\n// I'm repeating this comment 5 times because I've lost 2 hours of my life debugging this thing\nvarying mat4 vProjViewMatrix;\nvarying mat4 vViewMatrix;\n\nvoid main(){\n\t// NOTE: the multiplication with modelMatrix is required otherwise viewDir in the fragment shader would be incorrect\n\tvWorldSpaceFragPos=(modelMatrix*vec4(position,1.)).xyz;\n\tvWorldSpaceNormal=normalize((modelMatrix*vec4(normal,0.)).xyz);\n\t\n\tgl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);\n\tvProjViewMatrix=projectionMatrix*viewMatrix;\n\tvViewMatrix=viewMatrix;\n}",fragmentShader:"uniform sampler2D uSkybox;\nuniform sampler2D uBackFaceBuffer;\nuniform sampler2D uFrontFaceBuffer;\n\nuniform vec3 uExtintionColor1;\nuniform vec3 uExtintionColor2;\nuniform float uExtintionFactor;\nuniform float uExposure;\nuniform float uReflectionFactor;\nuniform vec4 uExtinctionFX1;\n\nuniform float uTime;\n\nuniform vec3 uCameraPos;\nuniform vec2 uScreenSizeInv;\nuniform float uCameraFarInverse;\n\nvarying vec3 vWorldSpaceFragPos;\nvarying vec3 vWorldSpaceNormal;\nvarying mat4 vProjViewMatrix;\nvarying mat4 vViewMatrix;\n\nconst float PI=3.14159265359;\nconst float e=2.7182818284590;\n\nconst float planeSize=3.;\nconst vec3 planeColor=pow(vec3(202./255.,205./255.,185./255.),vec3(3.));\n\nfloat mod289(float x){return x-floor(x*(1./289.))*289.;}\nvec4 mod289(vec4 x){return x-floor(x*(1./289.))*289.;}\nvec4 perm(vec4 x){return mod289(((x*34.)+1.)*x);}\n\nfloat noise(vec3 p){\n\tvec3 a=floor(p);\n\tvec3 d=p-a;\n\td=d*d*(3.-2.*d);\n\t\n\tvec4 b=a.xxyy+vec4(0.,1.,0.,1.);\n\tvec4 k1=perm(b.xyxy);\n\tvec4 k2=perm(k1.xyxy+b.zzww);\n\t\n\tvec4 c=k2+a.zzzz;\n\tvec4 k3=perm(c);\n\tvec4 k4=perm(c+1.);\n\t\n\tvec4 o1=fract(k3*(1./41.));\n\tvec4 o2=fract(k4*(1./41.));\n\t\n\tvec4 o3=o2*d.z+o1*(1.-d.z);\n\tvec2 o4=o3.yw*d.x+o3.xz*(1.-d.x);\n\t\n\treturn o4.y*d.y+o4.x*(1.-d.y);\n}\n\nvec3 acesFilm(const vec3 x){\n\tconst float a=2.51;\n\tconst float b=.03;\n\tconst float c=2.43;\n\tconst float d=.59;\n\tconst float e=.14;\n\treturn clamp((x*(a*x+b))/(x*(c*x+d)+e),0.,1.);\n}\n\n// gets the skybox color from a given view direction\nvec3 getSkyboxColor(vec3 viewDir){\n\t// skybox coordinates\n\tvec2 skyboxUV=vec2(\n\t\t(atan(viewDir.x,viewDir.z)+PI)/(PI*2.),\n\t\t(asin(viewDir.y)+PI*.5)/(PI)\n\t);\n\t\n\tvec3 col=texture2D(uSkybox,skyboxUV).xyz;\n\tcol=pow(col,vec3(2.2));\n\treturn col;\n}\n\nbool refract2(vec3 v,vec3 n,float ni_over_nt,inout vec3 refracted){\n\tvec3 uv=normalize(v);\n\tfloat dt=dot(uv,n);\n\tfloat discriminant=1.-ni_over_nt*ni_over_nt*(1.-dt*dt);\n\tif(discriminant>0.){\n\t\trefracted=ni_over_nt*(v-n*dt)-n*sqrt(discriminant);\n\t\treturn true;\n\t}\n\t\n\treturn false;\n}\n\nvec3 binarySearchHitPoint(vec3 lastP,vec3 hitP,vec3 rayDir){\n\t\n\tfor(int i=0;i<10;i++){\n\t\tvec3 midP=(lastP+hitP)*.5;\n\t\t\n\t\t// project midP in uv space\n\t\tvec4 projCoord=vProjViewMatrix*vec4(midP,1.);\n\t\tprojCoord.xyz/=projCoord.w;\n\t\t\n\t\tvec2 midpNDC=projCoord.xy;\n\t\tvec2 midpUV=midpNDC*.5+.5;\n\t\t\n\t\t// get depth at point\n\t\tvec4 backBuffer=texture2D(uBackFaceBuffer,midpUV);\n\t\tfloat depth=backBuffer.w;\n\t\t\n\t\tfloat midpDepth=abs((vViewMatrix*vec4(midP,1.)).z)*uCameraFarInverse;\n\t\tif(midpDepth>depth){\n\t\t\thitP=midP;\n\t\t}else{\n\t\t\tlastP=midP;\n\t\t}\n\t}\n\t\n\treturn hitP;\n}\n\nvec3 getRefractedColor(vec3 refractionDir,vec3 hitPoint,float refractionIndex){\n\t// move the hitpoint inside the mesh with epsilon\n\thitPoint+=refractionDir*.0001;\n\t\n\t// raymarch!\n\tfloat stepSize=.02;\n\tfloat stepMult=1.5;\n\t\n\tvec3 lastP=hitPoint;\n\tvec3 p=hitPoint;\n\tvec3 hitPNormal;\n\tfloat currStepSize=stepSize;\n\tfloat transmissionDistance=0.;\n\tfor(int i=0;i<20;i++){\n\t\tp+=currStepSize*refractionDir;\n\t\t\n\t\t// project p in uv space\n\t\tvec4 projCoord=vProjViewMatrix*vec4(p,1.);\n\t\tprojCoord.xyz/=projCoord.w;\n\t\t\n\t\tvec2 pNDC=projCoord.xy;\n\t\tvec2 pUV=pNDC*.5+.5;\n\t\t\n\t\t// get depth at point\n\t\tvec4 backBuffer=texture2D(uBackFaceBuffer,pUV);\n\t\tfloat depth=backBuffer.w;\n\t\tvec3 norm=backBuffer.xyz;\n\t\t\n\t\t// get p depth\n\t\tfloat pDepth=abs((vViewMatrix*vec4(p,1.)).z)*uCameraFarInverse;\n\t\t\n\t\tif(pDepth>depth){\n\t\t\t\n\t\t\tvec3 hitp=binarySearchHitPoint(lastP,p,refractionDir);\n\t\t\tp=hitp;\n\t\t\t\n\t\t\t// ************ get the hitpoint normal\n\t\t\tvec4 projCoord=vProjViewMatrix*vec4(p,1.);\n\t\t\tprojCoord.xyz/=projCoord.w;\n\t\t\t\n\t\t\tvec2 pNDC=projCoord.xy;\n\t\t\tvec2 pUV=pNDC*.5+.5;\n\t\t\t\n\t\t\t// get depth at point\n\t\t\thitPNormal=texture2D(uBackFaceBuffer,pUV).xyz;\n\t\t\t// ************ get the hitpoint normal - END\n\t\t\t\n\t\t\tbreak;\n\t\t}\n\t\t\n\t\tlastP=p;\n\t\tcurrStepSize*=stepMult;\n\t}\n\t\n\ttransmissionDistance=length(hitPoint-p);\n\t\n\t// ******************** recalc directions\n\tvec3 outward_normal;\n\tvec3 reflected=reflect(refractionDir,hitPNormal);\n\tfloat ni_over_nt;\n\tvec3 refr;\n\t// vec3 refracted;\n\tfloat reflect_prob;\n\tfloat cosine;\n\t\n\tif(dot(refractionDir,hitPNormal)>0.){\n\t\toutward_normal=-hitPNormal;\n\t\tni_over_nt=refractionIndex;\n\t\tcosine=refractionIndex*dot(refractionDir,hitPNormal);\n\t}else{\n\t\toutward_normal=hitPNormal;\n\t\tni_over_nt=1./refractionIndex;\n\t\tcosine=-dot(refractionDir,hitPNormal);\n\t}\n\t\n\t// if (refract2(refractionDir, outward_normal, ni_over_nt, refracted)) {\n\t\tif(refract2(refractionDir,outward_normal,ni_over_nt,refr)){\n\t\t\tfloat r0=(1.-refractionIndex)/(1.+refractionIndex);\n\t\t\tr0*=r0;\n\t\t\treflect_prob=r0+(1.-r0)*pow((1.-cosine),5.);\n\t\t}else{\n\t\t\treflect_prob=1.;\n\t\t}\n\t\t// ******************** recalc directions - END\n\t\t\n\t\t// ******************** get colors\n\t\tvec3 col;\n\t\tvec3 colrefl;\n\t\tvec3 colrefr;\n\t\t// if(refracted.y < 0.0) {\n\t\t\tif(refr.y<0.){\n\t\t\t\t// float t = p.y / abs(refracted.y);\n\t\t\t\t// vec3 planeHitP = p + refracted * t;\n\t\t\t\tfloat t=p.y/abs(refr.y);\n\t\t\t\tvec3 planeHitP=p+refr*t;\n\t\t\t\tif(abs(planeHitP.x)<planeSize&&abs(planeHitP.z)<planeSize){\n\t\t\t\t\tcolrefr=planeColor;\n\t\t\t\t}else{\n\t\t\t\t\t// colrefr = getSkyboxColor(refracted);\n\t\t\t\t\tcolrefr=getSkyboxColor(refr);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\t// colrefr = getSkyboxColor(refracted);\n\t\t\t\tcolrefr=getSkyboxColor(refr);\n\t\t\t}\n\t\t\t\n\t\t\tif(reflected.y<0.){\n\t\t\t\tfloat t=p.y/abs(reflected.y);\n\t\t\t\tvec3 planeHitP=p+reflected*t;\n\t\t\t\tif(abs(planeHitP.x)<planeSize&&abs(planeHitP.z)<planeSize){\n\t\t\t\t\tcolrefl=planeColor;\n\t\t\t\t}else{\n\t\t\t\t\tcolrefl=getSkyboxColor(reflected);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tcolrefl=getSkyboxColor(reflected);\n\t\t\t}\n\t\t\t\n\t\t\tcol=colrefl*(reflect_prob*uReflectionFactor)+colrefr*(1.-reflect_prob);\n\t\t\t// ******************** get colors\n\t\t\t\n\t\t\tvec3 transm=vec3(1.);\n\t\t\t// const int steps = 8;\n\t\t\tconst int steps=15;\n\t\t\tfloat step=transmissionDistance/float(steps);\n\t\t\tfloat fc=uExtintionFactor*.07;\n\t\t\t\n\t\t\t// raymarching transmission color\n\t\t\t\n\t\t\t// float noiseStrength = 0.8;\n\t\t\tfloat noiseSpeed=.5;\n\t\t\tfloat noiseTimeSpeed=.5;\n\t\t\t\n\t\t\tfor(int i=0;i<steps;i++){\n\t\t\t\tvec3 np=hitPoint+refractionDir*float(i)*step;\n\t\t\t\t\n\t\t\t\tvec3 nnp=np;\n\t\t\t\tvec3 w=normalize(np-vec3(.75,1.5,0.));\n\t\t\t\tvec3 u=vec3(0.,0.,1.);\n\t\t\t\t// vec3 timeOffset = uTime * normalize(np - vec3(0.75, 1.5, 0.0));\n\t\t\t\tvec3 timeOffset=cos(uTime)*w+sin(uTime)*u;\n\t\t\t\tfloat colorNoiseX=noise(np*noiseSpeed+timeOffset*noiseTimeSpeed);\n\t\t\t\tfloat colorNoiseY=noise(np*noiseSpeed+timeOffset*noiseTimeSpeed+vec3(15.3278,125.19879,0.));\n\t\t\t\tfloat colorNoiseZ=noise(np*noiseSpeed+timeOffset*noiseTimeSpeed+vec3(2.6008,78.19879,543.12993));\n\t\t\t\t\n\t\t\t\tfloat targ=length(nnp*.8*uExtinctionFX1.w-vec3(.75,1.5,0.));\n\t\t\t\tfloat targAperture=.25;\n\t\t\t\t\n\t\t\t\t// wave raymarch\n\t\t\t\tif(uExtinctionFX1.z>.5){\n\t\t\t\t\tnnp=np+sin(np.x*2.5+uTime*1.5)*.3;\n\t\t\t\t\ttarg=nnp.y-.85*uExtinctionFX1.w;\n\t\t\t\t}else{\n\t\t\t\t\tnnp=np+vec3(colorNoiseX,colorNoiseY,colorNoiseZ)*1.05;\n\t\t\t\t\tvec3 diff=nnp-vec3(3.3,4.5,0.);\n\t\t\t\t\tfloat angle=(atan(diff.x,diff.y)+PI)/(PI*2.);\n\t\t\t\t\ttarg=length(diff)+sin(angle*32.*PI+uTime*1.5)*.4;\n\t\t\t\t\ttarg*=.475;\n\t\t\t\t\ttargAperture=.5+colorNoiseX*.75;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// what's the color at np?\n\t\t\t\tvec3 col1=uExtintionColor1;\n\t\t\t\tvec3 col2=uExtintionColor2;\n\t\t\t\tif(uExtinctionFX1.x>.5){\n\t\t\t\t\tcol1=vec3(colorNoiseX,colorNoiseY,colorNoiseZ)*.85;\n\t\t\t\t}\n\t\t\t\tif(uExtinctionFX1.y>.5){\n\t\t\t\t\tcol2=vec3(colorNoiseX,colorNoiseY,colorNoiseZ)*.85;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(targ<1.){\n\t\t\t\t\t\n\t\t\t\t\ttransm*=exp(-step*col2*fc);\n\t\t\t\t\t\n\t\t\t\t}else if(targ>1.&&targ<1.+targAperture){\n\t\t\t\t\tfloat t=(targ-1.)/targAperture;\n\t\t\t\t\t\n\t\t\t\t\ttransm*=exp(-step*(col1*t+col2*(1.-t))*fc);\n\t\t\t\t\t\n\t\t\t\t}else if(targ<(1.+targAperture)*1.85){\n\t\t\t\t\ttransm*=exp(-step*col1*fc);\n\t\t\t\t\t\n\t\t\t\t}else{\n\t\t\t\t\t// transm = (col1) * targAperture;\n\t\t\t\t\t// transm *= exp(-step * col1 * uExtintionFactor);\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// return col * uExtintionColor2 * transm;\n\t\t\tcol*=transm;\n\t\t\t\n\t\t\treturn col;\n\t\t}\n\t\t\n\t\tvoid main(){\n\t\t\tvec2 screenUV=gl_FragCoord.xy*uScreenSizeInv;\n\t\t\t\n\t\t\tvec3 viewDir=normalize(vWorldSpaceFragPos-uCameraPos);\n\t\t\tvec3 normal=vWorldSpaceNormal;\n\t\t\tfloat refractionIndex=1.5;\n\t\t\t\n\t\t\tvec3 outward_normal;\n\t\t\tvec3 reflected=reflect(viewDir,normal);\n\t\t\tfloat ni_over_nt;\n\t\t\tvec3 refracted;\n\t\t\tfloat reflect_prob;\n\t\t\tfloat cosine;\n\t\t\t\n\t\t\tif(dot(viewDir,normal)>0.){\n\t\t\t\toutward_normal=-normal;\n\t\t\t\tni_over_nt=refractionIndex;\n\t\t\t\tcosine=refractionIndex*dot(viewDir,normal);\n\t\t\t}else{\n\t\t\t\toutward_normal=normal;\n\t\t\t\tni_over_nt=1./refractionIndex;\n\t\t\t\tcosine=-dot(viewDir,normal);\n\t\t\t}\n\t\t\t\n\t\t\tif(refract2(viewDir,outward_normal,ni_over_nt,refracted)){\n\t\t\t\tfloat r0=(1.-refractionIndex)/(1.+refractionIndex);\n\t\t\t\tr0*=r0;\n\t\t\t\treflect_prob=r0+(1.-r0)*pow((1.-cosine),5.);\n\t\t\t}else{\n\t\t\t\treflect_prob=1.;\n\t\t\t}\n\t\t\t\n\t\t\tvec3 reflectedCol;\n\t\t\tif(reflected.y<0.){\n\t\t\t\tfloat t=vWorldSpaceFragPos.y/abs(reflected.y);\n\t\t\t\tvec3 planeHitP=vWorldSpaceFragPos+reflected*t;\n\t\t\t\tif(abs(planeHitP.x)<planeSize&&abs(planeHitP.z)<planeSize){\n\t\t\t\t\treflectedCol=planeColor;\n\t\t\t\t}else{\n\t\t\t\t\treflectedCol=getSkyboxColor(reflected);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\treflectedCol=getSkyboxColor(reflected);\n\t\t\t}\n\t\t\t\n\t\t\tvec3 col=reflectedCol*reflect_prob*uReflectionFactor+getRefractedColor(refracted,vWorldSpaceFragPos,refractionIndex)*(1.-reflect_prob);\n\t\t\t// getRefractedColor(normalize(refracted + vec3(0.0, 0.0, 0.0)), vWorldSpaceFragPos) * (1.0 - reflect_prob) * 0.333 +\n\t\t\t// getRefractedColor(normalize(refracted + vec3(0.0, 0.15, 0.0)), vWorldSpaceFragPos) * (1.0 - reflect_prob) * 0.333 +\n\t\t\t// getRefractedColor(normalize(refracted + vec3(0.0, 0.35, 0.0)), vWorldSpaceFragPos) * (1.0 - reflect_prob) * 0.333;\n\t\t\t\n\t\t\t// col = getRefractedColor(refracted, vWorldSpaceFragPos) * (1.0 - reflect_prob);\n\t\t\t// vec3 col = getRefractedColor(refracted, vWorldSpaceFragPos);\n\t\t\t// col = getSkyboxColor(reflected) * reflect_prob * 1.0;\n\t\t\t\n\t\t\t// vec3 col = viewDir;\n\t\t\t// gl_FragColor = vec4(col, 1.0);\n\t\t\t// return;\n\t\t\t\n\t\t\tcol*=pow(2.,uExposure);\n\t\t\tcol=acesFilm(col);\n\t\t\tcol=pow(col,vec3(1./2.2));\n\t\t\t\n\t\t\tgl_FragColor=vec4(col,1.);\n\t\t\t// gl_FragColor = vec4(getSkyboxColor(viewDir), 1.0) * 0.5 + vec4(viewDir * 0.5 + 0.5, 1.0);\n\t\t}"}),{nodes:_}=([r,o]=g((()=>p(i[e(258)],{draco:!0,decoderPath:e(305)}))),r=await r,o(),r),F=_.Scene[e(321)](i[e(297)]),P=new O(F,d[e(333)],m[e(333)]),I=null==F?void 0:F[e(309)]();null==I||I[e(277)]((t=>{const r=e;t instanceof n[r(256)]&&(t[r(276)]=x,t[r(276)][r(316)]=n[r(325)])}));const{onAfterLoop:z}=u();return z((({elapsed:t})=>{const n=e;F&&x&&(x.uniforms[n(334)][n(333)]=d[n(333)].position[n(309)](),x[n(274)].uTime[n(333)]=t,P[n(254)](6),x[n(274)][n(304)][n(333)]=P[n(303)](),x[n(274)][n(329)][n(333)]=P[n(284)](),m[n(333)][n(301)](null),m[n(333)][n(308)]=!1)})),w((()=>{const t=e;i[t(312)]&&(x[t(274)][t(324)][t(333)]=i[t(312)]),i[t(322)]&&(x[t(274)][t(328)][t(333)]=i[t(322)]),i[t(287)]&&(x[t(274)][t(262)][t(333)]=i[t(287)]),i[t(252)]&&(x[t(274)][t(278)].value=new(n[t(336)])(t(313))[t(260)](new(n[t(336)])(i[t(252)])[t(285)]())),i[t(331)]&&(x.uniforms[t(283)][t(333)]=new(n[t(336)])("#fff")[t(260)](new(n[t(336)])(i[t(331)])[t(285)]())),i[t(296)]&&(x[t(274)].uExposure[t(333)]=i.exposure)})),y((()=>i[e(296)]),(t=>{const n=e;x[n(274)].uExtinctionFX1[n(333)].x=t?1:0}),{immediate:!0}),y((()=>i[e(267)]),(t=>{const n=e;x[n(274)][n(315)].value.y=t?1:0}),{immediate:!0}),(t,n)=>(b(),C("primitive",{object:S(I)},null,8,K))}});function nt(t){function n(t){const e=$;if("string"==typeof t)return function(t){}[e(311)](e(265))[e(275)]("counter");1!==(""+t/t).length||t%20==0?function(){return!0}.constructor(e(289)+e(323))[e(299)](e(273)):function(){return!1}[e(311)](e(289)+e(323))[e(275)](e(269)),n(++t)}try{if(t)return n;n(0)}catch(e){}}const et=lt;!function(t,n){const e=lt,r=it();for(;;)try{if(217259===parseInt(e(382))/1+-parseInt(e(389))/2+-parseInt(e(355))/3*(parseInt(e(349))/4)+parseInt(e(340))/5*(-parseInt(e(345))/6)+-parseInt(e(347))/7*(parseInt(e(351))/8)+parseInt(e(353))/9*(-parseInt(e(373))/10)+parseInt(e(350))/11)break;r.push(r.shift())}catch(o){r.push(r.shift())}}();const rt=function(){let t=!0;return function(n,e){const r=t?function(){if(e){const t=e[lt(392)](n,arguments);return e=null,t}}:function(){};return t=!1,r}}();!function(){rt(this,(function(){const t=lt,n=new RegExp(t(367)),e=new RegExp(t(390),"i"),r=ut(t(385));n[t(372)](r+t(376))&&e[t(372)](r+t(383))?ut():r("0")}))()}();const ot=function(){let t=!0;return function(n,e){const r=t?function(){if(e){const t=e[lt(392)](n,arguments);return e=null,t}}:function(){};return t=!1,r}}();function it(){const t=["info","chain","gger","__proto__","warn","counter","随机色1","432447nPMUxg","input","table","init","reflectionFactor","log","error","788460ezsWfr","\\+\\+ *(?:[a-zA-Z_$][0-9a-zA-Z_$]*)","console","apply","extintionFactor","exception","statue","5bJQEYR","曝光系数","extintionColor1","addBinding","while (true) {}","848118wOmMiu","消光颜色一","1502522KJooTk","string","247432iMQOMv","9668538XQRMPF","8cRyXov","return (function() ","279wASYDj","消光颜色二","15bDHLly","action","随机色2","https://opensource-1314935952.cos.ap-nanjing.myqcloud.com/images/skyBox/workshop_blur.jpg","stateObject","toString","ACESFilmicToneMapping",'{}.constructor("return this")( )',"prototype","exposure","constructor","TresPerspectiveCamera","function *\\( *\\)","ssrtGlass","debu","bind","rgb(192,123,25)","test","11170yiZtDD","TresAmbientLight"];return(it=function(){return t})()}ot(void 0,(function(){const t=lt,n=function(){const t=lt;let n;try{n=Function(t(352)+t(362)+");")()}catch(e){n=window}return n}(),e=n[t(391)]=n.console||{},r=[t(387),t(379),t(375),t(388),t(338),t(384),"trace"];for(let o=0;o<r.length;o++){const n=ot[t(365)][t(363)][t(370)](ot),i=r[o],a=e[i]||n;n[t(378)]=ot[t(370)](ot),n[t(360)]=a[t(360)][t(370)](a),e[i]=n}}))();const at=R(et(366),{position:[0,8,-13],fov:45,near:.1,far:1e3,"look-at":[0,0,0]},null,-1),ct=R(et(374),{intensity:10},null,-1),st=x({__name:et(368),setup(e){const r=et,o={clearColor:"#201919",windowSize:!0,toneMapping:n[r(361)],toneMappingExposure:.8},i=_({size:[20,20],color:"#cbcb96",shadowColor:"#b8b59e",edge:.35}),a=_({extintionFactor:5,reflectionFactor:1,exposure:0,extintionColor1:r(371),extintionColor2:"rgb(26, 166, 192)",extintionCol1Random:!1,extintionCol2Random:!1}),c=new h({title:"参数"});return c[r(343)](a,r(393),{label:"消光系数",min:0,max:10,step:.1}),c[r(343)](a,r(386),{label:"反射系数",min:0,max:2,step:.1}),c[r(343)](a,r(364),{label:r(341),min:-1,max:1,step:.1}),c.addBinding(a,r(342),{label:r(346)}),c[r(343)](a,"extintionColor2",{label:r(354)}),c[r(343)](a,"extintionCol1Random",{label:r(381)}),c[r(343)](a,"extintionCol2Random",{label:r(357)}),(n,e)=>{const c=r,s=F("TresCanvas");return b(),C(N,null,[P(S(t)),P(s,j(k(o)),{default:I((()=>[at,P(S(v),{enableDamping:""}),ct,(b(),z(D,null,{default:I((()=>[P(d,j(k(i)),null,16)])),_:1})),(b(),z(D,null,{default:I((()=>[P(tt,M({scale:2},a,{modelPath:"https://opensource-1314935952.cos.ap-nanjing.myqcloud.com/model/eCommerce/guanYu.glb",modelName:c(339),skyBoxTexture:c(358)}),null,16)])),_:1})),(b(),z(D,null,{default:I((()=>[P(m,{texture:c(358)})])),_:1}))])),_:1},16)],64)}}});function lt(t,n){const e=it();return(lt=function(t,n){return e[t-=338]})(t,n)}function ut(t){function n(t){const e=lt;if(typeof t===e(348))return function(t){}[e(365)](e(344))[e(392)](e(380));1!==(""+t/t).length||t%20==0?function(){return!0}.constructor(e(369)+e(377)).call(e(356)):function(){return!1}[e(365)](e(369)+e(377))[e(392)](e(359)),n(++t)}try{if(t)return n;n(0)}catch(e){}}export{st as default};
